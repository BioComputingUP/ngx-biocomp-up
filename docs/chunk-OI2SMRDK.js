import{c as I}from"./chunk-KRYPOJUJ.js";import{$a as N,E as Y,Ha as m,Ia as f,Nb as ce,Qb as A,R as Z,Rb as se,T as J,Tb as O,Ua as oe,Wa as b,Xa as D,Za as ne,_ as M,_a as B,a as S,ab as R,b as q,bb as d,cb as l,da as ee,db as ie,e as de,fb as X,gb as L,hb as a,ja as P,m as y,mb as g,nb as re,ob as U,pb as $,qa as te,qb as V,ra as h,sa as x,tb as _,u as j,ub as k}from"./chunk-M6PASJEJ.js";var v=(()=>{let o=class o{constructor(){this.selected$=new y(void 0)}set selected(t){this.selected$.next(t)}get selected(){return this.selected$.value}onMouseDown(t,e){this.selected=this.selected?void 0:{start:e,end:e,type:"range"}}onMouseEnter(t,e){t.buttons===1&&this.selected&&(this.selected=q(S({},this.selected),{end:e}))}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=M({token:o,factory:o.\u0275fac,providedIn:"platform"});let i=o;return i})();var E=(()=>{let o=class o{set positions(t){this.input$.next(t)}get positions(){return this.input$.value}constructor(t){this.selectionService=t,this.input$=new y([])}};o.\u0275fac=function(e){return new(e||o)(ee(v))},o.\u0275prov=M({token:o,factory:o.\u0275fac,providedIn:"platform"});let i=o;return i})();var w={};de(w,{ClustalX:()=>z,Physical:()=>ae});var z={A:{background:"#FFBF00",color:"#000000"},R:{background:"#FF0000",color:"#FFFFFF"},N:{background:"#00FFFF",color:"#000000"},D:{background:"#0000FF",color:"#FFFFFF"},C:{background:"#FFFF00",color:"#000000"},Q:{background:"#00FF00",color:"#000000"},E:{background:"#FF00FF",color:"#FFFFFF"},G:{background:"#808080",color:"#FFFFFF"},H:{background:"#008000",color:"#FFFFFF"},I:{background:"#FFA500",color:"#000000"},L:{background:"#FFA500",color:"#000000"},K:{background:"#FF0000",color:"#FFFFFF"},M:{background:"#FFA500",color:"#000000"},F:{background:"#FFA500",color:"#000000"},P:{background:"#800080",color:"#FFFFFF"},S:{background:"#00FF00",color:"#000000"},T:{background:"#00FF00",color:"#000000"},W:{background:"#FFA500",color:"#000000"},Y:{background:"#FFA500",color:"#000000"},V:{background:"#FFA500",color:"#000000"},B:{background:"#FFA500",color:"#000000"},Z:{background:"#FFA500",color:"#000000"},X:{background:"#FFA500",color:"#000000"},"-":{background:"#FFFFFF",color:"#000000"}},ae={G:{background:"#808080",color:"#FFFFFF"},A:{background:"#808080",color:"#FFFFFF"},V:{background:"#808080",color:"#FFFFFF"},L:{background:"#808080",color:"#FFFFFF"},I:{background:"#808080",color:"#FFFFFF"},M:{background:"#808080",color:"#FFFFFF"},F:{background:"#808080",color:"#FFFFFF"},W:{background:"#808080",color:"#FFFFFF"},P:{background:"#808080",color:"#FFFFFF"},S:{background:"#00FF00",color:"#000000"},T:{background:"#00FF00",color:"#000000"},C:{background:"#00FF00",color:"#000000"},Y:{background:"#00FF00",color:"#000000"},N:{background:"#00FF00",color:"#000000"},Q:{background:"#00FF00",color:"#000000"},D:{background:"#FF0000",color:"#FFFFFF"},E:{background:"#FF0000",color:"#FFFFFF"},R:{background:"#0000FF",color:"#FFFFFF"},H:{background:"#0000FF",color:"#FFFFFF"},K:{background:"#0000FF",color:"#FFFFFF"},B:{background:"#FFA500",color:"#000000"},Z:{background:"#FFA500",color:"#000000"},X:{background:"#FFA500",color:"#000000"},"-":{background:"#FFFFFF",color:"#000000"}};function pe(i,o){if(i&1){let c=X();d(0,"div",4),L("mouseenter",function(e){let n=h(c).$index,r=a();return x(r.onMouseEnter(e,r.index[n]))})("mousedown",function(e){let n=h(c).$index,r=a();return x(r.onMouseDown(e,r.index[n]))})("mouseup",function(e){h(c);let n=a();return x(n.onMouseUp(e))}),g(1),l()}if(i&2){let c=o.$implicit,t=o.$index,e=a();D("background",c==null?null:c.background)("color",c==null?null:c.color),b("id","index-residue-"+t),m(),U(" ",e.index[t]," ")}}function me(i,o){if(i&1){let c=X();d(0,"div",5),L("mouseenter",function(e){let n=h(c).$index,r=a();return x(r.onMouseEnter(e,r.index[n]))})("mousedown",function(e){let n=h(c).$index,r=a();return x(r.onMouseDown(e,r.index[n]))})("mouseup",function(e){h(c);let n=a();return x(n.onMouseUp(e))}),g(1),l()}if(i&2){let c=o.$implicit,t=o.$index,e=a();D("background",e.colors[c].background||e.colors["-"].background)("color",e.colors[c].color||e.colors["-"].color),b("id","sequence-residue-"+t),m(),U(" ",c," ")}}var G=(()=>{let o=class o{set positions(t){this.positionsService.positions=t}get positions(){return this.positionsService.positions}constructor(t,e){this.positionsService=t,this.selectionService=e,this.selected$=this.selectionService.selected$,this.positions$=this.selectionService.selected$.pipe(j(n=>q(S({},n),{background:"#FFFFFF",color:"#000000"})),J(void 0),Y(this.positionsService.input$),j(([n,r])=>{r=[...r];let s=new Map(this.index.map((F,p)=>[F,p])),u=n?.start,C=n?.end;if(u!=null&&C!=null){let F=s.get(u),p=s.get(C);F>p&&([F,p]=[p,F]),r.splice(F,p-F+1,...Array(p-F+1).fill(n))}return r}),Z(1))}ngOnChanges(t){if(t){if(t.sequence||t.index){if(typeof this.sequence=="string"){if(!this.description&&this.sequence[0]===">"){let[s,...u]=this.sequence.split(`
`);this.description=s,this.sequence=u.join(`
`)}this.sequence=this.sequence.replace(/[\n\r\s\t]+/g,"").split("")}this.index||(this.index=Array.from({length:this.sequence.length},(s,u)=>u+1))}this.colors||(this.colors=z);let e=new Map(this.index.map((s,u)=>[s,u])),n=new Array(this.index.length).fill(void 0),r=(this.loci||[]).map(({start:s,end:u,type:C,background:F,color:p})=>{let H=e.get(s),K=u!==void 0?e.get(u):s,Q={start:H,end:K,type:C,background:F,color:p};for(let T=H;T<=K;T++)n[T]=Q;return Q});r.sort((s,u)=>s.start-u.start||(s.end||0)-(u.end||0)),this.loci=r,this.positions=n}}onMouseUp(t){}onMouseDown(t,e){this.selectionService.onMouseDown(t,e)}onMouseEnter(t,e){this.selectionService.onMouseEnter(t,e)}};o.\u0275fac=function(e){return new(e||o)(f(E),f(v))},o.\u0275cmp=P({type:o,selectors:[["ngx-sequence-viewer"]],inputs:{loci:"loci",index:"index",sequence:"sequence",colors:"colors",description:"description"},outputs:{selected$:"selected"},standalone:!0,features:[$([E,v]),te,V],decls:7,vars:2,consts:[[1,"index"],[1,"index-residue",3,"id","background","color"],[1,"sequence"],[1,"sequence-residue",3,"id","background","color"],[1,"index-residue",3,"mouseenter","mousedown","mouseup","id"],[1,"sequence-residue",3,"mouseenter","mousedown","mouseup","id"]],template:function(e,n){e&1&&(d(0,"div",0),N(1,pe,2,6,"div",1,B),_(3,"async"),l(),d(4,"div",2),N(5,me,2,6,"div",3,B),l()),e&2&&(m(),R(k(3,0,n.positions$)),m(4),R(n.sequence))},dependencies:[O,A],styles:["[_nghost-%COMP%]{cursor:default;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .sequence[_ngcontent-%COMP%], [_nghost-%COMP%]   .index[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-items:stretch}[_nghost-%COMP%]   .sequence[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], [_nghost-%COMP%]   .index[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 auto;display:block;height:1rem;width:1rem;text-align:center;font-size:inherit;line-height:1rem}[_nghost-%COMP%]   .sequence[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center;vertical-align:center}[_nghost-%COMP%]   .index[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:auto;text-align:left;transform:rotate(-180deg);writing-mode:vertical-rl;white-space:nowrap;padding-bottom:.25rem;padding-top:.25rem}"]});let i=o;return i})();function ge(i,o){if(i&1&&ie(0,"ngx-sequence-viewer",6),i&2){let c=a();b("sequence",c.sequence)("index",c.index)("loci",c.loci)("colors",c.colors)}}var Ve=(()=>{let o=class o{constructor(t,e){this.structureService=t,this.location=e,this.loci=[{start:"12",end:"43",type:"range",background:"#007A78",color:"#FFC745"},{start:"57",end:"58",type:"range",background:"#BDE673",color:"#000000"}],this.colors=w.ClustalX,this.structure$=this.structureService.structure$,this._structure=this.structure$.subscribe(()=>{this.sequence=this.structureService.residues.map(({authCompId1:r})=>r),this.index=this.structureService.residues.map(({authSeqId:r,pdbInsCode:s})=>r+s)});let n=this.location.prepareExternalUrl("assets/8vap.A.cif");this.source=this.structureService.source={type:"remote",label:"8VAP",binary:!1,format:"mmcif",link:n}}ngOnDestroy(){this._structure.unsubscribe()}};o.\u0275fac=function(e){return new(e||o)(f(I),f(ce))},o.\u0275cmp=P({type:o,selectors:[["app-page-sequence-viewer"]],standalone:!0,features:[$([I]),V],decls:17,vars:6,consts:[[1,"container","pt-3"],[1,"row"],[1,"col-7"],[1,"col-5"],[1,"rounded","bg-body-tertiary","p-3"],["id","sequence-viewer-structure",1,"d-block","rounded","border","w-100","h-auto",2,"overflow-x","auto","overflow-y","hidden"],[3,"sequence","index","loci","colors"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"h1"),g(2,"Sequence viewer"),l(),d(3,"div")(4,"h2"),g(5,"Visualize structure"),l(),d(6,"div",1)(7,"div",2),g(8," In this example, the sequence underlying the PDB structure `1BRR`, chain `A` is shown. The colouring scheme chosen is based on the structural characteristics of the amino acids. "),l(),d(9,"div",3)(10,"code")(11,"pre",4),g(12),_(13,"json"),l()()()(),d(14,"div",5),oe(15,ge,1,4,"ngx-sequence-viewer",6),_(16,"async"),l()()()),e&2&&(m(12),re(k(13,2,n.source)),m(3),ne(15,k(16,4,n.structure$)?15:-1))},dependencies:[O,A,se,G]});let i=o;return i})();export{Ve as PageSequenceViewerComponent};
