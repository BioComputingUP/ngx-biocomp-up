(self.webpackChunkdemo_showcase=self.webpackChunkdemo_showcase||[]).push([[179],{872:(R1,WV,Fr)=>{"use strict";var O1={};Fr.r(O1),Fr.d(O1,{atomicHet:()=>oOe,atomicSequence:()=>aOe,bundleElementImpl:()=>aZ,bundleGenerator:()=>iZ,defaultBondTest:()=>YN,spheres:()=>sOe,water:()=>iOe});var H3={};Fr.r(H3),Fr.d(H3,{all:()=>uZ,atoms:()=>ZN,bondedAtomicPairs:()=>gOe,chains:()=>lOe,none:()=>KN,querySelection:()=>vOe,residues:()=>cOe,rings:()=>mOe});var j3={};Fr.r(j3),Fr.d(j3,{exceptBy:()=>s4e,expandProperty:()=>c4e,includeConnected:()=>l4e,includeSurroundings:()=>a4e,intersectBy:()=>o4e,querySelection:()=>i4e,surroundingLigands:()=>f4e,union:()=>u4e,wholeResidues:()=>t4e});var q3={};Fr.r(q3),Fr.d(q3,{areIntersectedBy:()=>w4e,first:()=>S4e,getCurrentStructureProperties:()=>VT,isConnectedTo:()=>P4e,pick:()=>_4e,withSameAtomProperties:()=>x4e,within:()=>A4e});var W3={};Fr.r(W3),Fr.d(W3,{intersect:()=>R4e,merge:()=>M4e});var Y3={};Fr.r(Y3),Fr.d(Y3,{atomCount:()=>O4e,countQuery:()=>F4e,propertySet:()=>N4e});var X3={};Fr.r(X3),Fr.d(X3,{Download:()=>IJ,DownloadBlob:()=>PJ,ImportJson:()=>I6e,ImportString:()=>E6e,LazyVolume:()=>M6e,ParseBlob:()=>y6e,ParseCcp4:()=>A6e,ParseCif:()=>b6e,ParseCube:()=>_6e,ParseDsn6:()=>T6e,ParseDx:()=>D6e,ParseJson:()=>P6e,ParsePly:()=>w6e,ParsePrmtop:()=>C6e,ParsePsf:()=>S6e,ParseTop:()=>x6e,RawData:()=>MJ,ReadFile:()=>RJ});var K3={};Fr.r(K3),Fr.d(K3,{CreateGroup:()=>R6e});var Z3={};Fr.r(Z3),Fr.d(Z3,{CoordinatesFromDcd:()=>lqe,CoordinatesFromNctraj:()=>pqe,CoordinatesFromTrr:()=>fqe,CoordinatesFromXtc:()=>dqe,CustomModelProperties:()=>Cre,CustomStructureProperties:()=>wre,ModelFromTrajectory:()=>gre,MultiStructureSelectionFromExpression:()=>Fqe,ShapeFromPly:()=>Vqe,StructureComplexElement:()=>Lqe,StructureComplexElementTypes:()=>Sre,StructureComponent:()=>Uqe,StructureFromModel:()=>Mqe,StructureFromTrajectory:()=>Pqe,StructureSelectionFromBundle:()=>kqe,StructureSelectionFromExpression:()=>Oqe,StructureSelectionFromScript:()=>Nqe,TopologyFromPrmtop:()=>mqe,TopologyFromPsf:()=>hqe,TopologyFromTop:()=>vqe,TrajectoryFromBlob:()=>yqe,TrajectoryFromCifCore:()=>Dqe,TrajectoryFromCube:()=>Tqe,TrajectoryFromGRO:()=>Sqe,TrajectoryFromMOL:()=>xqe,TrajectoryFromMOL2:()=>Aqe,TrajectoryFromMmCif:()=>bqe,TrajectoryFromModelAndCoordinates:()=>hL,TrajectoryFromPDB:()=>_qe,TrajectoryFromSDF:()=>wqe,TrajectoryFromXYZ:()=>Cqe,TransformStructureConformation:()=>Rqe});var Q3={};Fr.r(Q3),Fr.d(Q3,{AssignColorVolume:()=>Jqe,VolumeFromCcp4:()=>Yqe,VolumeFromCube:()=>Kqe,VolumeFromDensityServerCif:()=>Qqe,VolumeFromDsn6:()=>Xqe,VolumeFromDx:()=>Zqe,VolumeFromSegmentationCif:()=>$qe});var $3={};Fr.r($3),Fr.d($3,{BoxShape3D:()=>wZe,getBoxMesh:()=>r5});var J3={};Fr.r(J3),Fr.d(J3,{ClippingStructureRepresentation3DFromBundle:()=>GZe,ClippingStructureRepresentation3DFromScript:()=>zZe,ExplodeStructureRepresentation3D:()=>OZe,ModelUnitcell3D:()=>WZe,OverpaintStructureRepresentation3DFromBundle:()=>kZe,OverpaintStructureRepresentation3DFromScript:()=>NZe,ShapeRepresentation3D:()=>qZe,SpinStructureRepresentation3D:()=>FZe,StructureBoundingBox3D:()=>YZe,StructureRepresentation3D:()=>PE,StructureSelectionsAngle3D:()=>KZe,StructureSelectionsDihedral3D:()=>ZZe,StructureSelectionsDistance3D:()=>XZe,StructureSelectionsLabel3D:()=>QZe,StructureSelectionsOrientation3D:()=>$Ze,StructureSelectionsPlane3D:()=>JZe,SubstanceStructureRepresentation3DFromBundle:()=>VZe,SubstanceStructureRepresentation3DFromScript:()=>UZe,ThemeStrengthRepresentation3D:()=>HZe,TransparencyStructureRepresentation3DFromBundle:()=>LZe,TransparencyStructureRepresentation3DFromScript:()=>BZe,UnwindStructureAssemblyRepresentation3D:()=>RZe,VolumeRepresentation3D:()=>jZe,VolumeRepresentation3DHelpers:()=>pf});var eP={};Fr.r(eP),Fr.d(eP,{ApplyAction:()=>fie,ClearHighlights:()=>gie,Highlight:()=>vie,RemoveObject:()=>pie,SetCurrentObject:()=>lie,Snapshots:()=>yie,SyncBehaviors:()=>cie,ToggleExpanded:()=>hie,ToggleVisibility:()=>mie,Update:()=>die,registerDefault:()=>hQe,setSubtreeVisibility:()=>Ib});var tP={};Fr.r(tP),Fr.d(tP,{SyncRepresentationToCanvas:()=>bie,SyncStructureRepresentation3DState:()=>_ie,UpdateRepresentationVisibility:()=>Sie,registerDefault:()=>vQe});var rP={};Fr.r(rP),Fr.d(rP,{Focus:()=>wie,OrientAxes:()=>Aie,Reset:()=>Cie,ResetAxes:()=>Tie,SetSnapshot:()=>xie,registerDefault:()=>gQe});var nP={};Fr.r(nP),Fr.d(nP,{Canvas3DSetSettings:()=>loe,registerDefault:()=>qJe});var aP={};Fr.r(aP),Fr.d(aP,{DefaultFocusLociBindings:()=>foe,DefaultLociLabelProvider:()=>QJe,DefaultSelectLociBindings:()=>doe,FocusLoci:()=>JJe,HighlightLoci:()=>XJe,SelectLoci:()=>ZJe});var iP={};Fr.r(iP),Fr.d(iP,{CameraAxisHelper:()=>ret,CameraControls:()=>aet,DefaultClickResetCameraOnEmpty:()=>A5,DefaultClickResetCameraOnEmptySelectMode:()=>T5,DefaultFocusLociBindings:()=>poe,FocusLoci:()=>tet});var oP={};Fr.r(oP),Fr.d(oP,{AccessibleSurfaceArea:()=>met,BestDatabaseSequenceMapping:()=>Ent,CrossLinkRestraint:()=>jnt,Interactions:()=>xnt,SecondaryStructure:()=>wnt,StructureInfo:()=>iet,ValenceModel:()=>Ant});var sP={};Fr.r(sP),Fr.d(sP,{AddTrajectory:()=>Dat,DownloadStructure:()=>_at,EnableModelCustomProps:()=>Aat,EnableStructureCustomProps:()=>Tat,LoadTrajectory:()=>Eat,PdbDownloadProvider:()=>zse,UpdateTrajectory:()=>wat});var uP={};Fr.r(uP),Fr.d(uP,{AssignColorVolume:()=>Gse,DownloadDensity:()=>Iat});var cP={};function YV(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,a)}function lx(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function o(u){YV(i,n,a,o,s,"next",u)}function s(u){YV(i,n,a,o,s,"throw",u)}o(void 0)})}}Fr.r(cP),Fr.d(cP,{DownloadFile:()=>Pat,OpenFiles:()=>Hse});let Co=null,dx=1;const a0=Symbol("SIGNAL");function bi(e){const t=Co;return Co=e,t}function XV(e){if((!N1(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==dx)){if(!e.producerMustRecompute(e)&&!dP(e))return e.dirty=!1,void(e.lastCleanEpoch=dx);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=dx}}function dP(e){o0(e);for(let t=0;t<e.producerNode.length;t++){const r=e.producerNode[t],n=e.producerLastReadVersion[t];if(n!==r.version||(XV(r),n!==r.version))return!0}return!1}function fx(e,t){if(function r8(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),o0(e),1===e.liveConsumerNode.length)for(let n=0;n<e.producerNode.length;n++)fx(e.producerNode[n],e.producerIndexOfThis[n]);const r=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[r],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[r],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const n=e.liveConsumerIndexOfThis[t],a=e.liveConsumerNode[t];o0(a),a.producerIndexOfThis[n]=t}}function N1(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function o0(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let n8=null;function Va(e){return"function"==typeof e}function pP(e){const r=e(n=>{Error.call(n),n.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}const hP=pP(e=>function(r){e(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((n,a)=>`${a+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function px(e,t){if(e){const r=e.indexOf(t);0<=r&&e.splice(r,1)}}class Us{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const i of r)i.remove(this);else r.remove(this);const{initialTeardown:n}=this;if(Va(n))try{n()}catch(i){t=i instanceof hP?i.errors:[i]}const{_finalizers:a}=this;if(a){this._finalizers=null;for(const i of a)try{u8(i)}catch(o){t=t??[],o instanceof hP?t=[...t,...o.errors]:t.push(o)}}if(t)throw new hP(t)}}add(t){var r;if(t&&t!==this)if(this.closed)u8(t);else{if(t instanceof Us){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}}_hasParent(t){const{_parentage:r}=this;return r===t||Array.isArray(r)&&r.includes(t)}_addParent(t){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t}_removeParent(t){const{_parentage:r}=this;r===t?this._parentage=null:Array.isArray(r)&&px(r,t)}remove(t){const{_finalizers:r}=this;r&&px(r,t),t instanceof Us&&t._removeParent(this)}}Us.EMPTY=(()=>{const e=new Us;return e.closed=!0,e})();const o8=Us.EMPTY;function s8(e){return e instanceof Us||e&&"closed"in e&&Va(e.remove)&&Va(e.add)&&Va(e.unsubscribe)}function u8(e){Va(e)?e():e.unsubscribe()}const Zm={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},hx={setTimeout(e,t,...r){const{delegate:n}=hx;return n?.setTimeout?n.setTimeout(e,t,...r):setTimeout(e,t,...r)},clearTimeout(e){const{delegate:t}=hx;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function c8(e){hx.setTimeout(()=>{const{onUnhandledError:t}=Zm;if(!t)throw e;t(e)})}function mP(){}const mpe=vP("C",void 0,void 0);function vP(e,t,r){return{kind:e,value:t,error:r}}let Qm=null;function mx(e){if(Zm.useDeprecatedSynchronousErrorHandling){const t=!Qm;if(t&&(Qm={errorThrown:!1,error:null}),e(),t){const{errorThrown:r,error:n}=Qm;if(Qm=null,r)throw n}}else e()}class gP extends Us{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,s8(t)&&t.add(this)):this.destination=Cpe}static create(t,r,n){return new k1(t,r,n)}next(t){this.isStopped?bP(function gpe(e){return vP("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?bP(function vpe(e){return vP("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?bP(mpe,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const bpe=Function.prototype.bind;function yP(e,t){return bpe.call(e,t)}class _pe{constructor(t){this.partialObserver=t}next(t){const{partialObserver:r}=this;if(r.next)try{r.next(t)}catch(n){vx(n)}}error(t){const{partialObserver:r}=this;if(r.error)try{r.error(t)}catch(n){vx(n)}else vx(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(r){vx(r)}}}class k1 extends gP{constructor(t,r,n){let a;if(super(),Va(t)||!t)a={next:t??void 0,error:r??void 0,complete:n??void 0};else{let i;this&&Zm.useDeprecatedNextContext?(i=Object.create(t),i.unsubscribe=()=>this.unsubscribe(),a={next:t.next&&yP(t.next,i),error:t.error&&yP(t.error,i),complete:t.complete&&yP(t.complete,i)}):a=t}this.destination=new _pe(a)}}function vx(e){Zm.useDeprecatedSynchronousErrorHandling?function ype(e){Zm.useDeprecatedSynchronousErrorHandling&&Qm&&(Qm.errorThrown=!0,Qm.error=e)}(e):c8(e)}function bP(e,t){const{onStoppedNotification:r}=Zm;r&&hx.setTimeout(()=>r(e,t))}const Cpe={closed:!0,next:mP,error:function Spe(e){throw e},complete:mP},_P="function"==typeof Symbol&&Symbol.observable||"@@observable";function mh(e){return e}function l8(...e){return d8(e)}function d8(e){return 0===e.length?mh:1===e.length?e[0]:function(r){return e.reduce((n,a)=>a(n),r)}}let ko=(()=>{class e{constructor(r){r&&(this._subscribe=r)}lift(r){const n=new e;return n.source=this,n.operator=r,n}subscribe(r,n,a){const i=function wpe(e){return e&&e instanceof gP||function xpe(e){return e&&Va(e.next)&&Va(e.error)&&Va(e.complete)}(e)&&s8(e)}(r)?r:new k1(r,n,a);return mx(()=>{const{operator:o,source:s}=this;i.add(o?o.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(r){try{return this._subscribe(r)}catch(n){r.error(n)}}forEach(r,n){return new(n=f8(n))((a,i)=>{const o=new k1({next:s=>{try{r(s)}catch(u){i(u),o.unsubscribe()}},error:i,complete:a});this.subscribe(o)})}_subscribe(r){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(r)}[_P](){return this}pipe(...r){return d8(r)(this)}toPromise(r){return new(r=f8(r))((n,a)=>{let i;this.subscribe(o=>i=o,o=>a(o),()=>n(i))})}}return e.create=t=>new e(t),e})();function f8(e){var t;return null!==(t=e??Zm.Promise)&&void 0!==t?t:Promise}const Ape=pP(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Cn=(()=>{class e extends ko{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const n=new p8(this,this);return n.operator=r,n}_throwIfClosed(){if(this.closed)throw new Ape}next(r){mx(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(r)}})}error(r){mx(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:n}=this;for(;n.length;)n.shift().error(r)}})}complete(){mx(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:n,isStopped:a,observers:i}=this;return n||a?o8:(this.currentObservers=null,i.push(r),new Us(()=>{this.currentObservers=null,px(i,r)}))}_checkFinalizedStatuses(r){const{hasError:n,thrownError:a,isStopped:i}=this;n?r.error(a):i&&r.complete()}asObservable(){const r=new ko;return r.source=this,r}}return e.create=(t,r)=>new p8(t,r),e})();class p8 extends Cn{constructor(t,r){super(),this.destination=t,this.source=r}next(t){var r,n;null===(n=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===n||n.call(r,t)}error(t){var r,n;null===(n=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===n||n.call(r,t)}complete(){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===r||r.call(t)}_subscribe(t){var r,n;return null!==(n=null===(r=this.source)||void 0===r?void 0:r.subscribe(t))&&void 0!==n?n:o8}}class Li extends Cn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const r=super._subscribe(t);return!r.closed&&t.next(this._value),r}getValue(){const{hasError:t,thrownError:r,_value:n}=this;if(t)throw r;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}function h8(e){return Va(e?.lift)}function _i(e){return t=>{if(h8(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Si(e,t,r,n,a){return new Tpe(e,t,r,n,a)}class Tpe extends gP{constructor(t,r,n,a,i,o){super(t),this.onFinalize=i,this.shouldUnsubscribe=o,this._next=r?function(s){try{r(s)}catch(u){t.error(u)}}:super._next,this._error=a?function(s){try{a(s)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(s){t.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:r}=this;super.unsubscribe(),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function yr(e,t){return _i((r,n)=>{let a=0;r.subscribe(Si(n,i=>{n.next(e.call(t,i,a++))}))})}class Ot extends Error{constructor(t,r){super(function s0(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,r)),this.code=t}}function la(e){for(let t in e)if(e[t]===la)return t;throw Error("Could not find renamed property on target object.")}function xo(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(xo).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function SP(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Ipe=la({__forward_ref__:la});function CP(e){return e.__forward_ref__=CP,e.toString=function(){return xo(this())},e}function Pr(e){return gx(e)?e():e}function gx(e){return"function"==typeof e&&e.hasOwnProperty(Ipe)&&e.__forward_ref__===CP}function xP(e){return e&&!!e.\u0275providers}const B1=la({\u0275cmp:la}),wP=la({\u0275dir:la}),AP=la({\u0275pipe:la}),y8=la({\u0275mod:la}),Ff=la({\u0275fac:la}),L1=la({__NG_ELEMENT_ID__:la}),b8=la({__NG_ENV_ID__:la});function Lr(e){return"string"==typeof e?e:null==e?"":String(e)}function TP(e,t){throw new Ot(-201,!1)}function mu(e,t){null==e&&function Mr(e,t,r,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${r} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function hr(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function yx(e){return{providers:e.providers||[],imports:e.imports||[]}}function bx(e){return _8(e,Sx)||_8(e,S8)}function _8(e,t){return e.hasOwnProperty(t)?e[t]:null}function _x(e){return e&&(e.hasOwnProperty(DP)||e.hasOwnProperty(Lpe))?e[DP]:null}const Sx=la({\u0275prov:la}),DP=la({\u0275inj:la}),S8=la({ngInjectableDef:la}),Lpe=la({ngInjectorDef:la});var vn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(vn||{});let EP;function vu(e){const t=EP;return EP=e,t}function x8(e,t,r){const n=bx(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:r&vn.Optional?null:void 0!==t?t:void TP()}const aa=globalThis;class ur{constructor(t,r){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=hr({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const U1={},OP="__NG_DI_FLAG__",Cx="ngTempTokenPath",zpe=/\n/gm,A8="__source";let u0;function gh(e){const t=u0;return u0=e,t}function jpe(e,t=vn.Default){if(void 0===u0)throw new Ot(-203,!1);return null===u0?x8(e,void 0,t):u0.get(e,t&vn.Optional?null:void 0,t)}function Xr(e,t=vn.Default){return(function C8(){return EP}()||jpe)(Pr(e),t)}function Gt(e,t=vn.Default){return Xr(e,xx(t))}function xx(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function FP(e){const t=[];for(let r=0;r<e.length;r++){const n=Pr(e[r]);if(Array.isArray(n)){if(0===n.length)throw new Ot(900,!1);let a,i=vn.Default;for(let o=0;o<n.length;o++){const s=n[o],u=qpe(s);"number"==typeof u?-1===u?a=s.token:i|=u:a=s}t.push(Xr(a,i))}else t.push(Xr(n))}return t}function qpe(e){return e[OP]}function Nf(e){return{toString:e}.toString()}var wx=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(wx||{}),El=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(El||{});const gd={},zn=[];var Il=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Il||{});function D8(e,t,r){let n=e.length;for(;;){const a=e.indexOf(t,r);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const i=t.length;if(a+i===n||e.charCodeAt(a+i)<=32)return a}r=a+1}}function NP(e,t,r){let n=0;for(;n<r.length;){const a=r[n];if("number"==typeof a){if(0!==a)break;n++;const i=r[n++],o=r[n++],s=r[n++];e.setAttribute(t,o,s,i)}else{const i=a,o=r[++n];I8(i)?e.setProperty(t,i,o):e.setAttribute(t,i,o),n++}}return n}function E8(e){return 3===e||4===e||6===e}function I8(e){return 64===e.charCodeAt(0)}function z1(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let r=-1;for(let n=0;n<t.length;n++){const a=t[n];"number"==typeof a?r=a:0===r||P8(e,r,a,null,-1===r||2===r?t[++n]:null)}}return e}function P8(e,t,r,n,a){let i=0,o=e.length;if(-1===t)o=-1;else for(;i<e.length;){const s=e[i++];if("number"==typeof s){if(s===t){o=-1;break}if(s>t){o=i-1;break}}}for(;i<e.length;){const s=e[i];if("number"==typeof s)break;if(s===r){if(null===n)return void(null!==a&&(e[i+1]=a));if(n===e[i+1])return void(e[i+2]=a)}i++,null!==n&&i++,null!==a&&i++}-1!==o&&(e.splice(o,0,t),i=o+1),e.splice(i++,0,r),null!==n&&e.splice(i++,0,n),null!==a&&e.splice(i++,0,a)}const M8="ng-template";function Xpe(e,t,r){let n=0,a=!0;for(;n<e.length;){let i=e[n++];if("string"==typeof i&&a){const o=e[n++];if(r&&"class"===i&&-1!==D8(o.toLowerCase(),t,0))return!0}else{if(1===i){for(;n<e.length&&"string"==typeof(i=e[n++]);)if(i.toLowerCase()===t)return!0;return!1}"number"==typeof i&&(a=!1)}}return!1}function R8(e){return 4===e.type&&e.value!==M8}function Kpe(e,t,r){return t===(4!==e.type||r?e.value:M8)}function Zpe(e,t,r){let n=4;const a=e.attrs||[],i=function Jpe(e){for(let t=0;t<e.length;t++)if(E8(e[t]))return t;return e.length}(a);let o=!1;for(let s=0;s<t.length;s++){const u=t[s];if("number"!=typeof u){if(!o)if(4&n){if(n=2|1&n,""!==u&&!Kpe(e,u,r)||""===u&&1===t.length){if(Pl(n))return!1;o=!0}}else{const c=8&n?u:t[++s];if(8&n&&null!==e.attrs){if(!Xpe(e.attrs,c,r)){if(Pl(n))return!1;o=!0}continue}const d=Qpe(8&n?"class":u,a,R8(e),r);if(-1===d){if(Pl(n))return!1;o=!0;continue}if(""!==c){let f;f=d>i?"":a[d+1].toLowerCase();const p=8&n?f:null;if(p&&-1!==D8(p,c,0)||2&n&&c!==f){if(Pl(n))return!1;o=!0}}}}else{if(!o&&!Pl(n)&&!Pl(u))return!1;if(o&&Pl(u))continue;o=!1,n=u|1&n}}return Pl(n)||o}function Pl(e){return 0==(1&e)}function Qpe(e,t,r,n){if(null===t)return-1;let a=0;if(n||!r){let i=!1;for(;a<t.length;){const o=t[a];if(o===e)return a;if(3===o||6===o)i=!0;else{if(1===o||2===o){let s=t[++a];for(;"string"==typeof s;)s=t[++a];continue}if(4===o)break;if(0===o){a+=4;continue}}a+=i?1:2}return-1}return function ehe(e,t){let r=e.indexOf(4);if(r>-1)for(r++;r<e.length;){const n=e[r];if("number"==typeof n)return-1;if(n===t)return r;r++}return-1}(t,e)}function O8(e,t,r=!1){for(let n=0;n<t.length;n++)if(Zpe(e,t[n],r))return!0;return!1}function F8(e,t){return e?":not("+t.trim()+")":t}function rhe(e){let t=e[0],r=1,n=2,a="",i=!1;for(;r<e.length;){let o=e[r];if("string"==typeof o)if(2&n){const s=e[++r];a+="["+o+(s.length>0?'="'+s+'"':"")+"]"}else 8&n?a+="."+o:4&n&&(a+=" "+o);else""!==a&&!Pl(o)&&(t+=F8(i,a),a=""),n=o,i=i||!Pl(n);r++}return""!==a&&(t+=F8(i,a)),t}function yh(e){return Nf(()=>{const t=k8(e),r={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===wx.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||El.Emulated,styles:e.styles||zn,_:null,schemas:e.schemas||null,tView:null,id:""};B8(r);const n=e.dependencies;return r.directiveDefs=Ax(n,!1),r.pipeDefs=Ax(n,!0),r.id=function uhe(e){let t=0;const r=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const a of r)t=Math.imul(31,t)+a.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(r),r})}function ihe(e){return fn(e)||wo(e)}function ohe(e){return null!==e}function kP(e){return Nf(()=>({type:e.type,bootstrap:e.bootstrap||zn,declarations:e.declarations||zn,imports:e.imports||zn,exports:e.exports||zn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function N8(e,t){if(null==e)return gd;const r={};for(const n in e)if(e.hasOwnProperty(n)){const a=e[n];let i,o,s=Il.None;Array.isArray(a)?(s=a[0],i=a[1],o=a[2]??i):(i=a,o=a),t?(r[i]=s!==Il.None?[n,s]:n,t[i]=o):r[i]=n}return r}function Vs(e){return Nf(()=>{const t=k8(e);return B8(t),t})}function gu(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function fn(e){return e[B1]||null}function wo(e){return e[wP]||null}function es(e){return e[AP]||null}function cs(e,t){const r=e[y8]||null;if(!r&&!0===t)throw new Error(`Type ${xo(e)} does not have '\u0275mod' property.`);return r}function k8(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||gd,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||zn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:N8(e.inputs,t),outputs:N8(e.outputs),debugInfo:null}}function B8(e){e.features?.forEach(t=>t(e))}function Ax(e,t){if(!e)return null;const r=t?es:ihe;return()=>("function"==typeof e?e():e).map(n=>r(n)).filter(ohe)}const Qa=0,Ft=1,br=2,Ui=3,Ml=4,ls=5,Rl=6,c0=7,Pa=8,zs=9,kf=10,jr=11,G1=12,L8=13,l0=14,di=15,H1=16,d0=17,yd=18,j1=19,U8=20,_h=21,Tx=22,$m=23,Ur=25,BP=1,bd=7,f0=9,Vi=10;var LP=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(LP||{});function ds(e){return Array.isArray(e)&&"object"==typeof e[BP]}function fs(e){return Array.isArray(e)&&!0===e[BP]}function UP(e){return 0!=(4&e.flags)}function Jm(e){return e.componentOffset>-1}function Ex(e){return 1==(1&e.flags)}function Ol(e){return!!e.template}function VP(e){return 0!=(512&e[br])}function ev(e,t){return e.hasOwnProperty(Ff)?e[Ff]:null}class fhe{constructor(t,r,n){this.previousValue=t,this.currentValue=r,this.firstChange=n}isFirstChange(){return this.firstChange}}function H8(e,t,r,n){null!==t?t.applyValueToInputSignal(t,n):e[r]=n}function Sh(){return j8}function j8(e){return e.type.prototype.ngOnChanges&&(e.setInput=hhe),phe}function phe(){const e=W8(this),t=e?.current;if(t){const r=e.previous;if(r===gd)e.previous=t;else for(let n in t)r[n]=t[n];e.current=null,this.ngOnChanges(t)}}function hhe(e,t,r,n,a){const i=this.declaredInputs[n],o=W8(e)||function mhe(e,t){return e[q8]=t}(e,{previous:gd,current:null}),s=o.current||(o.current={}),u=o.previous,c=u[i];s[i]=new fhe(c&&c.currentValue,r,u===gd),H8(e,t,a,r)}Sh.ngInherit=!0;const q8="__ngSimpleChanges__";function W8(e){return e[q8]||null}const _d=function(e,t,r){};let K8=!1;function ya(e){for(;Array.isArray(e);)e=e[Qa];return e}function Gs(e,t){return ya(t[e.index])}function Y1(e,t){return e.data[t]}function Wu(e,t){const r=t[e];return ds(r)?r:r[Qa]}function qP(e){return 128==(128&e[br])}function Sd(e,t){return null==t?null:e[t]}function Z8(e){e[d0]=0}function She(e){1024&e[br]||(e[br]|=1024,qP(e)&&X1(e))}function $8(e){return 9216&e[br]||e[$m]?.dirty}function WP(e){$8(e)?X1(e):64&e[br]&&(function ghe(){return K8}()?(e[br]|=1024,X1(e)):e[kf].changeDetectionScheduler?.notify())}function X1(e){e[kf].changeDetectionScheduler?.notify();let t=tv(e);for(;null!==t&&!(8192&t[br])&&(t[br]|=8192,qP(t));)t=tv(t)}function tv(e){const t=e[Ui];return fs(t)?t[Ui]:t}const Rr={lFrame:uz(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function ez(){return Rr.bindingsEnabled}function ct(){return Rr.lFrame.lView}function Dn(){return Rr.lFrame.tView}function ba(){let e=tz();for(;null!==e&&64===e.type;)e=e.parent;return e}function tz(){return Rr.lFrame.currentTNode}function Cd(e,t){const r=Rr.lFrame;r.currentTNode=e,r.isParent=t}function XP(){return Rr.lFrame.isParent}function xd(){return Rr.lFrame.bindingIndex++}function Fhe(e,t){const r=Rr.lFrame;r.bindingIndex=r.bindingRootIndex=e,ZP(t)}function ZP(e){Rr.lFrame.currentDirectiveIndex=e}function iz(){return Rr.lFrame.currentQueryIndex}function $P(e){Rr.lFrame.currentQueryIndex=e}function khe(e){const t=e[Ft];return 2===t.type?t.declTNode:1===t.type?e[ls]:null}function oz(e,t,r){if(r&vn.SkipSelf){let a=t,i=e;for(;!(a=a.parent,null!==a||r&vn.Host||(a=khe(i),null===a||(i=i[l0],10&a.type))););if(null===a)return!1;t=a,e=i}const n=Rr.lFrame=sz();return n.currentTNode=t,n.lView=e,!0}function JP(e){const t=sz(),r=e[Ft];Rr.lFrame=t,t.currentTNode=r.firstChild,t.lView=e,t.tView=r,t.contextLView=e,t.bindingIndex=r.bindingStartIndex,t.inI18n=!1}function sz(){const e=Rr.lFrame,t=null===e?null:e.child;return null===t?uz(e):t}function uz(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function cz(){const e=Rr.lFrame;return Rr.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const lz=cz;function eM(){const e=cz();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function ps(){return Rr.lFrame.selectedIndex}function rv(e){Rr.lFrame.selectedIndex=e}let fz=!0;function Px(){return fz}function Ch(e){fz=e}function Mx(e,t){for(let r=t.directiveStart,n=t.directiveEnd;r<n;r++){const i=e.data[r].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;o&&(e.contentHooks??=[]).push(-r,o),s&&((e.contentHooks??=[]).push(r,s),(e.contentCheckHooks??=[]).push(r,s)),u&&(e.viewHooks??=[]).push(-r,u),c&&((e.viewHooks??=[]).push(r,c),(e.viewCheckHooks??=[]).push(r,c)),null!=l&&(e.destroyHooks??=[]).push(r,l)}}function Rx(e,t,r){pz(e,t,3,r)}function Ox(e,t,r,n){(3&e[br])===r&&pz(e,t,r,n)}function tM(e,t){let r=e[br];(3&r)===t&&(r&=16383,r+=1,e[br]=r)}function pz(e,t,r,n){const i=n??-1,o=t.length-1;let s=0;for(let u=void 0!==n?65535&e[d0]:0;u<o;u++)if("number"==typeof t[u+1]){if(s=t[u],null!=n&&s>=n)break}else t[u]<0&&(e[d0]+=65536),(s<i||-1==i)&&(Hhe(e,r,t,u),e[d0]=(4294901760&e[d0])+u+2),u++}function hz(e,t){_d(4,e,t);const r=bi(null);try{t.call(e)}finally{bi(r),_d(5,e,t)}}function Hhe(e,t,r,n){const a=r[n]<0,i=r[n+1],s=e[a?-r[n]:r[n]];a?e[br]>>14<e[d0]>>16&&(3&e[br])===t&&(e[br]+=16384,hz(s,i)):hz(s,i)}const m0=-1;class Z1{constructor(t,r,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=n}}function nM(e){return e!==m0}function Q1(e){return 32767&e}function $1(e,t){let r=function Xhe(e){return e>>16}(e),n=t;for(;r>0;)n=n[l0],r--;return n}let aM=!0;function Fx(e){const t=aM;return aM=e,t}const mz=255,vz=5;let Khe=0;const wd={};function Nx(e,t){const r=gz(e,t);if(-1!==r)return r;const n=t[Ft];n.firstCreatePass&&(e.injectorIndex=t.length,iM(n.data,e),iM(t,null),iM(n.blueprint,null));const a=kx(e,t),i=e.injectorIndex;if(nM(a)){const o=Q1(a),s=$1(a,t),u=s[Ft].data;for(let c=0;c<8;c++)t[i+c]=s[o+c]|u[o+c]}return t[i+8]=a,i}function iM(e,t){e.push(0,0,0,0,0,0,0,0,t)}function gz(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function kx(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let r=0,n=null,a=t;for(;null!==a;){if(n=wz(a),null===n)return m0;if(r++,a=a[l0],-1!==n.injectorIndex)return n.injectorIndex|r<<16}return m0}function oM(e,t,r){!function Zhe(e,t,r){let n;"string"==typeof r?n=r.charCodeAt(0)||0:r.hasOwnProperty(L1)&&(n=r[L1]),null==n&&(n=r[L1]=Khe++);const a=n&mz;t.data[e+(a>>vz)]|=1<<a}(e,t,r)}function yz(e,t,r){if(r&vn.Optional||void 0!==e)return e;TP()}function bz(e,t,r,n){if(r&vn.Optional&&void 0===n&&(n=null),!(r&(vn.Self|vn.Host))){const a=e[zs],i=vu(void 0);try{return a?a.get(t,n,r&vn.Optional):x8(t,n,r&vn.Optional)}finally{vu(i)}}return yz(n,0,r)}function _z(e,t,r,n=vn.Default,a){if(null!==e){if(2048&t[br]&&!(n&vn.Self)){const o=function tme(e,t,r,n,a){let i=e,o=t;for(;null!==i&&null!==o&&2048&o[br]&&!(512&o[br]);){const s=Sz(i,o,r,n|vn.Self,wd);if(s!==wd)return s;let u=i.parent;if(!u){const c=o[U8];if(c){const l=c.get(r,wd,n);if(l!==wd)return l}u=wz(o),o=o[l0]}i=u}return a}(e,t,r,n,wd);if(o!==wd)return o}const i=Sz(e,t,r,n,wd);if(i!==wd)return i}return bz(t,r,n,a)}function Sz(e,t,r,n,a){const i=function Jhe(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(L1)?e[L1]:void 0;return"number"==typeof t?t>=0?t&mz:eme:t}(r);if("function"==typeof i){if(!oz(t,e,n))return n&vn.Host?yz(a,0,n):bz(t,r,n,a);try{let o;if(o=i(n),null!=o||n&vn.Optional)return o;TP()}finally{lz()}}else if("number"==typeof i){let o=null,s=gz(e,t),u=m0,c=n&vn.Host?t[di][ls]:null;for((-1===s||n&vn.SkipSelf)&&(u=-1===s?kx(e,t):t[s+8],u!==m0&&xz(n,!1)?(o=t[Ft],s=Q1(u),t=$1(u,t)):s=-1);-1!==s;){const l=t[Ft];if(Cz(i,s,l.data)){const d=$he(s,t,r,o,n,c);if(d!==wd)return d}u=t[s+8],u!==m0&&xz(n,t[Ft].data[s+8]===c)&&Cz(i,s,t)?(o=l,s=Q1(u),t=$1(u,t)):s=-1}}return a}function $he(e,t,r,n,a,i){const o=t[Ft],s=o.data[e+8],l=Bx(s,o,r,null==n?Jm(s)&&aM:n!=o&&0!=(3&s.type),a&vn.Host&&i===s);return null!==l?nv(t,o,l,s):wd}function Bx(e,t,r,n,a){const i=e.providerIndexes,o=t.data,s=1048575&i,u=e.directiveStart,l=i>>20,f=a?s+l:e.directiveEnd;for(let p=n?s:s+l;p<f;p++){const h=o[p];if(p<u&&r===h||p>=u&&h.type===r)return p}if(a){const p=o[u];if(p&&Ol(p)&&p.type===r)return u}return null}function nv(e,t,r,n){let a=e[r];const i=t.data;if(function jhe(e){return e instanceof Z1}(a)){const o=a;o.resolving&&function Mpe(e,t){const r=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Ot(-200,`Circular dependency in DI detected for ${e}${r}`)}(function Zn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Lr(e)}(i[r]));const s=Fx(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?vu(o.injectImpl):null;oz(e,n,vn.Default);try{a=e[r]=o.factory(void 0,i,e,n),t.firstCreatePass&&r>=n.directiveStart&&function Ghe(e,t,r){const{ngOnChanges:n,ngOnInit:a,ngDoCheck:i}=t.type.prototype;if(n){const o=j8(t);(r.preOrderHooks??=[]).push(e,o),(r.preOrderCheckHooks??=[]).push(e,o)}a&&(r.preOrderHooks??=[]).push(0-e,a),i&&((r.preOrderHooks??=[]).push(e,i),(r.preOrderCheckHooks??=[]).push(e,i))}(r,i[r],t)}finally{null!==c&&vu(c),Fx(s),o.resolving=!1,lz()}}return a}function Cz(e,t,r){return!!(r[t+(e>>vz)]&1<<e)}function xz(e,t){return!(e&vn.Self||e&vn.Host&&t)}class Ao{constructor(t,r){this._tNode=t,this._lView=r}get(t,r,n){return _z(this._tNode,this._lView,t,xx(n),r)}}function eme(){return new Ao(ba(),ct())}function sM(e){return Nf(()=>{const t=e.prototype.constructor,r=t[Ff]||uM(t),n=Object.prototype;let a=Object.getPrototypeOf(e.prototype).constructor;for(;a&&a!==n;){const i=a[Ff]||uM(a);if(i&&i!==r)return i;a=Object.getPrototypeOf(a)}return i=>new i})}function uM(e){return gx(e)?()=>{const t=uM(Pr(e));return t&&t()}:ev(e)}function wz(e){const t=e[Ft],r=t.type;return 2===r?t.declTNode:1===r?e[ls]:null}function x0(e,t){e.forEach(r=>Array.isArray(r)?x0(r,t):t(r))}function Tz(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Ux(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const av=new ur(""),Rz=new ur("",-1),vM=new ur("");class Hx{get(t,r=U1){if(r===U1){const n=new Error(`NullInjectorError: No provider for ${xo(t)}!`);throw n.name="NullInjectorError",n}return r}}function jx(e){return{\u0275providers:e}}function xme(...e){return{\u0275providers:Oz(0,e),\u0275fromNgModule:!0}}function Oz(e,...t){const r=[],n=new Set;let a;const i=o=>{r.push(o)};return x0(t,o=>{const s=o;qx(s,i,[],n)&&(a||=[],a.push(s))}),void 0!==a&&Fz(a,i),r}function Fz(e,t){for(let r=0;r<e.length;r++){const{ngModule:n,providers:a}=e[r];gM(a,i=>{t(i,n)})}}function qx(e,t,r,n){if(!(e=Pr(e)))return!1;let a=null,i=_x(e);const o=!i&&fn(e);if(i||o){if(o&&!o.standalone)return!1;a=e}else{const u=e.ngModule;if(i=_x(u),!i)return!1;a=u}const s=n.has(a);if(o){if(s)return!1;if(n.add(a),o.dependencies){const u="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of u)qx(c,t,r,n)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;n.add(a);try{x0(i.imports,l=>{qx(l,t,r,n)&&(c||=[],c.push(l))})}finally{}void 0!==c&&Fz(c,t)}if(!s){const c=ev(a)||(()=>new a);t({provide:a,useFactory:c,deps:zn},a),t({provide:vM,useValue:a,multi:!0},a),t({provide:av,useValue:()=>Xr(a),multi:!0},a)}const u=i.providers;if(null!=u&&!s){const c=e;gM(u,l=>{t(l,c)})}}}return a!==e&&void 0!==e.providers}function gM(e,t){for(let r of e)xP(r)&&(r=r.\u0275providers),Array.isArray(r)?gM(r,t):t(r)}const wme=la({provide:String,useValue:la});function yM(e){return null!==e&&"object"==typeof e&&wme in e}function iv(e){return"function"==typeof e}const bM=new ur(""),Wx={},Tme={};let _M;function Yx(){return void 0===_M&&(_M=new Hx),_M}class Fl{}class T0 extends Fl{get destroyed(){return this._destroyed}constructor(t,r,n,a){super(),this.parent=r,this.source=n,this.scopes=a,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,CM(t,o=>this.processProvider(o)),this.records.set(Rz,D0(void 0,this)),a.has("environment")&&this.records.set(Fl,D0(void 0,this));const i=this.records.get(bM);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(vM,zn,vn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const r=gh(this),n=vu(void 0);try{return t()}finally{gh(r),vu(n)}}get(t,r=U1,n=vn.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(b8))return t[b8](this);n=xx(n);const i=gh(this),o=vu(void 0);try{if(!(n&vn.SkipSelf)){let u=this.records.get(t);if(void 0===u){const c=function Mme(e){return"function"==typeof e||"object"==typeof e&&e instanceof ur}(t)&&bx(t);u=c&&this.injectableDefInScope(c)?D0(SM(t),Wx):null,this.records.set(t,u)}if(null!=u)return this.hydrate(t,u)}return(n&vn.Self?Yx():this.parent).get(t,r=n&vn.Optional&&r===U1?null:r)}catch(s){if("NullInjectorError"===s.name){if((s[Cx]=s[Cx]||[]).unshift(xo(t)),i)throw s;return function Wpe(e,t,r,n){const a=e[Cx];throw t[A8]&&a.unshift(t[A8]),e.message=function Ype(e,t,r,n=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let a=xo(t);if(Array.isArray(t))a=t.map(xo).join(" -> ");else if("object"==typeof t){let i=[];for(let o in t)if(t.hasOwnProperty(o)){let s=t[o];i.push(o+":"+("string"==typeof s?JSON.stringify(s):xo(s)))}a=`{${i.join(", ")}}`}return`${r}${n?"("+n+")":""}[${a}]: ${e.replace(zpe,"\n  ")}`}("\n"+e.message,a,r,n),e.ngTokenPath=a,e[Cx]=null,e}(s,t,"R3InjectorError",this.source)}throw s}finally{vu(o),gh(i)}}resolveInjectorInitializers(){const t=gh(this),r=vu(void 0);try{const a=this.get(av,zn,vn.Self);for(const i of a)i()}finally{gh(t),vu(r)}}toString(){const t=[],r=this.records;for(const n of r.keys())t.push(xo(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ot(205,!1)}processProvider(t){let r=iv(t=Pr(t))?t:Pr(t&&t.provide);const n=function Eme(e){return yM(e)?D0(void 0,e.useValue):D0(function Bz(e,t,r){let n;if(iv(e)){const a=Pr(e);return ev(a)||SM(a)}if(yM(e))n=()=>Pr(e.useValue);else if(function kz(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...FP(e.deps||[]));else if(function Nz(e){return!(!e||!e.useExisting)}(e))n=()=>Xr(Pr(e.useExisting));else{const a=Pr(e&&(e.useClass||e.provide));if(!function Ime(e){return!!e.deps}(e))return ev(a)||SM(a);n=()=>new a(...FP(e.deps))}return n}(e),Wx)}(t);if(!iv(t)&&!0===t.multi){let a=this.records.get(r);a||(a=D0(void 0,Wx,!0),a.factory=()=>FP(a.multi),this.records.set(r,a)),r=t,a.multi.push(t)}this.records.set(r,n)}hydrate(t,r){return r.value===Wx&&(r.value=Tme,r.value=r.factory()),"object"==typeof r.value&&r.value&&function Pme(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(r.value)&&this._ngOnDestroyHooks.add(r.value),r.value}injectableDefInScope(t){if(!t.providedIn)return!1;const r=Pr(t.providedIn);return"string"==typeof r?"any"===r||this.scopes.has(r):this.injectorDefTypes.has(r)}removeOnDestroy(t){const r=this._onDestroyHooks.indexOf(t);-1!==r&&this._onDestroyHooks.splice(r,1)}}function SM(e){const t=bx(e),r=null!==t?t.factory:ev(e);if(null!==r)return r;if(e instanceof ur)throw new Ot(204,!1);if(e instanceof Function)return function Dme(e){if(e.length>0)throw new Ot(204,!1);const r=function Bpe(e){return e&&(e[Sx]||e[S8])||null}(e);return null!==r?()=>r.factory(e):()=>new e}(e);throw new Ot(204,!1)}function D0(e,t,r=!1){return{factory:e,value:t,multi:r?[]:void 0}}function CM(e,t){for(const r of e)Array.isArray(r)?CM(r,t):r&&xP(r)?CM(r.\u0275providers,t):t(r)}function E0(e,t){e instanceof T0&&e.assertNotDestroyed();const n=gh(e),a=vu(void 0);try{return t()}finally{gh(n),vu(a)}}function zz(e,t=null,r=null,n){const a=Gz(e,t,r,n);return a.resolveInjectorInitializers(),a}function Gz(e,t=null,r=null,n,a=new Set){const i=[r||zn,xme(e)];return n=n||("object"==typeof e?void 0:xo(e)),new T0(i,t||Yx(),n||null,a)}let AM,Tc=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=U1;static#t=this.NULL=new Hx;static create(r,n){if(Array.isArray(r))return zz({name:""},n,r,"");{const a=r.name??"";return zz({name:a},r.parent,r.providers,a)}}static#r=this.\u0275prov=hr({token:e,providedIn:"any",factory:()=>Xr(Rz)});static#n=this.__NG_ELEMENT_ID__=-1}return e})();const TM=new ur("",{providedIn:"root",factory:()=>Vme}),Vme="ng",jz=new ur(""),I0=new ur("",{providedIn:"platform",factory:()=>"unknown"}),qz=new ur("",{providedIn:"root",factory:()=>function wh(){if(void 0!==AM)return AM;if(typeof document<"u")return document;throw new Ot(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function Wz(e){return e.ownerDocument.defaultView}function Xu(e){return e instanceof Function?e():e}function $x(e){return 128==(128&e.flags)}var Dh=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Dh||{});const MM=new Map;let $me=0;const OM="__ngContext__";function hs(e,t){ds(t)?(e[OM]=t[j1],function eve(e){MM.set(e[j1],e)}(t)):e[OM]=t}let FM;function NM(e,t){return FM(e,t)}function M0(e,t,r,n,a){if(null!=n){let i,o=!1;fs(n)?i=n:ds(n)&&(o=!0,n=n[Qa]);const s=ya(n);0===e&&null!==r?null==a?hG(t,r,s):ov(t,r,s,a||null,!0):1===e&&null!==r?ov(t,r,s,a||null,!0):2===e?function iw(e,t,r){const n=nw(e,t);n&&function vve(e,t,r,n){e.removeChild(t,r,n)}(e,n,t,r)}(t,s,o):3===e&&t.destroyNode(s),null!=i&&function bve(e,t,r,n,a){const i=r[bd];i!==ya(r)&&M0(t,e,n,i,a);for(let s=Vi;s<r.length;s++){const u=r[s];ow(u[Ft],u,e,t,n,i)}}(t,e,i,r,a)}}function tw(e,t,r){return e.createElement(t,r)}function dG(e,t){ow(e,t,t[jr],2,null,null)}function fG(e,t){const r=e[f0],n=r.indexOf(t);r.splice(n,1)}function i_(e,t){if(e.length<=Vi)return;const r=Vi+t,n=e[r];if(n){const a=n[H1];null!==a&&a!==e&&fG(a,n),t>0&&(e[r-1][Ml]=n[Ml]);const i=Ux(e,Vi+t);!function cve(e,t){dG(e,t),t[Qa]=null,t[ls]=null}(n[Ft],n);const o=i[yd];null!==o&&o.detachView(i[Ft]),n[Ui]=null,n[Ml]=null,n[br]&=-129}return n}function rw(e,t){if(!(256&t[br])){const r=t[jr];r.destroyNode&&ow(e,t,r,3,null,null),function dve(e){let t=e[G1];if(!t)return BM(e[Ft],e);for(;t;){let r=null;if(ds(t))r=t[G1];else{const n=t[Vi];n&&(r=n)}if(!r){for(;t&&!t[Ml]&&t!==e;)ds(t)&&BM(t[Ft],t),t=t[Ui];null===t&&(t=e),ds(t)&&BM(t[Ft],t),r=t&&t[Ml]}t=r}}(t)}}function BM(e,t){if(!(256&t[br])){t[br]&=-129,t[br]|=256,t[$m]&&function e8(e){if(o0(e),N1(e))for(let t=0;t<e.producerNode.length;t++)fx(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}(t[$m]),function mve(e,t){let r;if(null!=e&&null!=(r=e.destroyHooks))for(let n=0;n<r.length;n+=2){const a=t[r[n]];if(!(a instanceof Z1)){const i=r[n+1];if(Array.isArray(i))for(let o=0;o<i.length;o+=2){const s=a[i[o]],u=i[o+1];_d(4,s,u);try{u.call(s)}finally{_d(5,s,u)}}else{_d(4,a,i);try{i.call(a)}finally{_d(5,a,i)}}}}}(e,t),function hve(e,t){const r=e.cleanup,n=t[c0];if(null!==r)for(let i=0;i<r.length-1;i+=2)if("string"==typeof r[i]){const o=r[i+3];o>=0?n[o]():n[-o].unsubscribe(),i+=2}else r[i].call(n[r[i+1]]);null!==n&&(t[c0]=null);const a=t[_h];if(null!==a){t[_h]=null;for(let i=0;i<a.length;i++)(0,a[i])()}}(e,t),1===t[Ft].type&&t[jr].destroy();const r=t[H1];if(null!==r&&fs(t[Ui])){r!==t[Ui]&&fG(r,t);const n=t[yd];null!==n&&n.detachView(e)}!function tve(e){MM.delete(e[j1])}(t)}}function LM(e,t,r){return function pG(e,t,r){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return r[Qa];{const{componentOffset:a}=n;if(a>-1){const{encapsulation:i}=e.data[n.directiveStart+a];if(i===El.None||i===El.Emulated)return null}return Gs(n,r)}}(e,t.parent,r)}function ov(e,t,r,n,a){e.insertBefore(t,r,n,a)}function hG(e,t,r){e.appendChild(t,r)}function mG(e,t,r,n,a){null!==n?ov(e,t,r,n,a):hG(e,t,r)}function nw(e,t){return e.parentNode(t)}let UM,yG=function gG(e,t,r){return 40&e.type?Gs(e,r):null};function aw(e,t,r,n){const a=LM(e,n,t),i=t[jr],s=function vG(e,t,r){return yG(e,t,r)}(n.parent||t[ls],n,t);if(null!=a)if(Array.isArray(r))for(let u=0;u<r.length;u++)mG(i,a,r[u],s,!1);else mG(i,a,r,s,!1);void 0!==UM&&UM(i,n,t,r,a)}function o_(e,t){if(null!==t){const r=t.type;if(3&r)return Gs(t,e);if(4&r)return VM(-1,e[t.index]);if(8&r){const n=t.child;if(null!==n)return o_(e,n);{const a=e[t.index];return fs(a)?VM(-1,a):ya(a)}}if(32&r)return NM(t,e)()||ya(e[t.index]);{const n=_G(e,t);return null!==n?Array.isArray(n)?n[0]:o_(tv(e[di]),n):o_(e,t.next)}}return null}function _G(e,t){return null!==t?e[di][ls].projection[t.projection]:null}function VM(e,t){const r=Vi+e+1;if(r<t.length){const n=t[r],a=n[Ft].firstChild;if(null!==a)return o_(n,a)}return t[bd]}function zM(e,t,r,n,a,i,o){for(;null!=r;){const s=n[r.index],u=r.type;if(o&&0===t&&(s&&hs(ya(s),n),r.flags|=2),32!=(32&r.flags))if(8&u)zM(e,t,r.child,n,a,i,!1),M0(t,e,a,s,i);else if(32&u){const c=NM(r,n);let l;for(;l=c();)M0(t,e,a,l,i);M0(t,e,a,s,i)}else 16&u?CG(e,t,n,r,a,i):M0(t,e,a,s,i);r=o?r.projectionNext:r.next}}function ow(e,t,r,n,a,i){zM(r,n,e.firstChild,t,a,i,!1)}function CG(e,t,r,n,a,i){const o=r[di],u=o[ls].projection[n.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)M0(t,e,a,u[c],i);else{let c=u;const l=o[Ui];$x(n)&&(c.flags|=128),zM(e,t,c,l,a,i,!0)}}function xG(e,t,r){""===r?e.removeAttribute(t,"class"):e.setAttribute(t,"class",r)}function wG(e,t,r){const{mergedAttrs:n,classes:a,styles:i}=r;null!==n&&NP(e,t,n),null!==a&&xG(e,t,a),null!==i&&function Sve(e,t,r){e.setAttribute(t,"style",r)}(e,t,i)}class LG{}let UG=()=>null;function tR(e,t,r=!1){return UG(e,t,r)}class tge{}class jG{}class nge{resolveComponentFactory(t){throw function rge(e){const t=Error(`No component factory found for ${xo(e)}.`);return t.ngComponent=e,t}(t)}}let mw=(()=>{class e{static#e=this.NULL=new nge}return e})();function age(){return B0(ba(),ct())}function B0(e,t){return new Ih(Gs(e,t))}let Ih=(()=>{class e{constructor(r){this.nativeElement=r}static#e=this.__NG_ELEMENT_ID__=age}return e})();function ige(e){return e instanceof Ih?e.nativeElement:e}class WG{}let sge=(()=>{class e{static#e=this.\u0275prov=hr({token:e,providedIn:"root",factory:()=>null})}return e})();const iR={};function p_(e,t,r,n,a=!1){for(;null!==r;){const i=t[r.index];null!==i&&n.push(ya(i)),fs(i)&&eH(i,n);const o=r.type;if(8&o)p_(e,t,r.child,n);else if(32&o){const s=NM(r,t);let u;for(;u=s();)n.push(u)}else if(16&o){const s=_G(t,r);if(Array.isArray(s))n.push(...s);else{const u=tv(t[di]);p_(u[Ft],u,s,n,!0)}}r=a?r.projectionNext:r.next}return n}function eH(e,t){for(let r=Vi;r<e.length;r++){const n=e[r],a=n[Ft].firstChild;null!==a&&p_(n[Ft],n,a,t)}e[bd]!==e[Qa]&&t.push(e[bd])}let tH=[];const Cge={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{X1(e.lView)},consumerOnSignalRead(){this.lView[$m]=this}};function rH(e){return aH(e[G1])}function nH(e){return aH(e[Ml])}function aH(e){for(;null!==e&&!fs(e);)e=e[Ml];return e}function uR(e){return e.ngOriginalError}class Vf{constructor(){this._console=console}handleError(t){const r=this._findOriginalError(t);this._console.error("ERROR",t),r&&this._console.error("ORIGINAL ERROR",r)}_findOriginalError(t){let r=t&&uR(t);for(;r&&uR(r);)r=uR(r);return r||null}}const oH=new ur("",{providedIn:"root",factory:()=>Gt(Vf).handleError.bind(void 0)}),uH=new ur("",{providedIn:"root",factory:()=>!1}),qr={};function Ph(e=1){fH(Dn(),ct(),ps()+e,!1)}function fH(e,t,r,n){if(!n)if(3==(3&t[br])){const i=e.preOrderCheckHooks;null!==i&&Rx(t,i,r)}else{const i=e.preOrderHooks;null!==i&&Ox(t,i,0,r)}rv(r)}function Tr(e,t=vn.Default){const r=ct();return null===r?Xr(e,t):_z(ba(),r,Pr(e),t)}function pH(e,t,r,n,a,i){const o=bi(null);try{let s=null;a&Il.SignalBased&&(s=t[n][a0]),null!==s&&void 0!==s.transformFn&&(i=s.transformFn(i)),a&Il.HasDecoratorInputTransform&&(i=e.inputTransforms[n].call(t,i)),null!==e.setInput?e.setInput(t,s,i,r,n):H8(t,s,n,i)}finally{bi(o)}}function _w(e,t,r,n,a,i,o,s,u,c,l){const d=t.blueprint.slice();return d[Qa]=a,d[br]=204|n,(null!==c||e&&2048&e[br])&&(d[br]|=2048),Z8(d),d[Ui]=d[l0]=e,d[Pa]=r,d[kf]=o||e&&e[kf],d[jr]=s||e&&e[jr],d[zs]=u||e&&e[zs]||null,d[ls]=i,d[j1]=function Jme(){return $me++}(),d[Rl]=l,d[U8]=c,d[di]=2==t.type?e[di]:d,d}function L0(e,t,r,n,a){let i=e.data[t];if(null===i)i=function cR(e,t,r,n,a){const i=tz(),o=XP(),u=e.data[t]=function Lge(e,t,r,n,a,i){let o=t?t.injectorIndex:-1,s=0;return function h0(){return null!==Rr.skipHydrationRootTNode}()&&(s|=128),{type:r,index:n,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:s,providerIndexes:0,value:a,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?i:i&&i.parent,r,t,n,a);return null===e.firstChild&&(e.firstChild=u),null!==i&&(o?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u,u.prev=i)),u}(e,t,r,n,a),function Ohe(){return Rr.lFrame.inI18n}()&&(i.flags|=32);else if(64&i.type){i.type=r,i.value=n,i.attrs=a;const o=function K1(){const e=Rr.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();i.injectorIndex=null===o?-1:o.injectorIndex}return Cd(i,!0),i}function h_(e,t,r,n){if(0===r)return-1;const a=t.length;for(let i=0;i<r;i++)t.push(n),e.blueprint.push(n),e.data.push(null);return a}function hH(e,t,r,n,a){const i=ps(),o=2&n;try{rv(-1),o&&t.length>Ur&&fH(e,t,Ur,!1),_d(o?2:0,a),r(n,a)}finally{rv(i),_d(o?3:1,a)}}function lR(e,t,r){if(UP(t)){const n=bi(null);try{const i=t.directiveEnd;for(let o=t.directiveStart;o<i;o++){const s=e.data[o];s.contentQueries&&s.contentQueries(1,r[o],o)}}finally{bi(n)}}}function dR(e,t,r){ez()&&(function qge(e,t,r,n){const a=r.directiveStart,i=r.directiveEnd;Jm(r)&&function $ge(e,t,r){const n=Gs(t,e),a=mH(r);let o=16;r.signals?o=4096:r.onPush&&(o=64);const s=Sw(e,_w(e,a,null,o,n,t,null,e[kf].rendererFactory.createRenderer(n,r),null,null,null));e[t.index]=s}(t,r,e.data[a+r.componentOffset]),e.firstCreatePass||Nx(r,t),hs(n,t);const o=r.initialInputs;for(let s=a;s<i;s++){const u=e.data[s],c=nv(t,e,s,r);hs(c,t),null!==o&&Jge(0,s-a,c,u,0,o),Ol(u)&&(Wu(r.index,t)[Pa]=nv(t,e,s,r))}}(e,t,r,Gs(r,t)),64==(64&r.flags)&&_H(e,t,r))}function fR(e,t,r=Gs){const n=t.localNames;if(null!==n){let a=t.index+1;for(let i=0;i<n.length;i+=2){const o=n[i+1],s=-1===o?r(t,e):e[o];e[a++]=s}}}function mH(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=pR(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function pR(e,t,r,n,a,i,o,s,u,c,l){const d=Ur+n,f=d+a,p=function Rge(e,t){const r=[];for(let n=0;n<t;n++)r.push(n<e?null:qr);return r}(d,f),h="function"==typeof c?c():c;return p[Ft]={type:e,blueprint:p,template:r,queries:null,viewQuery:s,declTNode:t,data:p.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:u,consts:h,incompleteFirstPass:!1,ssrId:l}}let vH=()=>null;function gH(e,t,r,n,a){for(let i in t){if(!t.hasOwnProperty(i))continue;const o=t[i];if(void 0===o)continue;n??={};let s,u=Il.None;Array.isArray(o)?(s=o[0],u=o[1]):s=o;let c=i;if(null!==a){if(!a.hasOwnProperty(i))continue;c=a[i]}0===e?yH(n,r,c,s,u):yH(n,r,c,s)}return n}function yH(e,t,r,n,a){let i;e.hasOwnProperty(r)?(i=e[r]).push(t,n):i=e[r]=[t,n],void 0!==a&&i.push(a)}function hR(e,t,r,n){if(ez()){const a=null===n?null:{"":-1},i=function Yge(e,t){const r=e.directiveRegistry;let n=null,a=null;if(r)for(let i=0;i<r.length;i++){const o=r[i];if(O8(t,o.selectors,!1))if(n||(n=[]),Ol(o))if(null!==o.findHostDirectiveDefs){const s=[];a=a||new Map,o.findHostDirectiveDefs(o,s,a),n.unshift(...s,o),mR(e,t,s.length)}else n.unshift(o),mR(e,t,0);else a=a||new Map,o.findHostDirectiveDefs?.(o,n,a),n.push(o)}return null===n?null:[n,a]}(e,r);let o,s;null===i?o=s=null:[o,s]=i,null!==o&&bH(e,t,r,o,a,s),a&&function Xge(e,t,r){if(t){const n=e.localNames=[];for(let a=0;a<t.length;a+=2){const i=r[t[a+1]];if(null==i)throw new Ot(-301,!1);n.push(t[a],i)}}}(r,n,a)}r.mergedAttrs=z1(r.mergedAttrs,r.attrs)}function bH(e,t,r,n,a,i){for(let c=0;c<n.length;c++)oM(Nx(r,t),e,n[c].type);!function Zge(e,t,r){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+r,e.providerIndexes=t}(r,e.data.length,n.length);for(let c=0;c<n.length;c++){const l=n[c];l.providersResolver&&l.providersResolver(l)}let o=!1,s=!1,u=h_(e,t,n.length,null);for(let c=0;c<n.length;c++){const l=n[c];r.mergedAttrs=z1(r.mergedAttrs,l.hostAttrs),Qge(e,r,t,u,l),Kge(u,l,a),null!==l.contentQueries&&(r.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(r.flags|=64);const d=l.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((e.preOrderHooks??=[]).push(r.index),o=!0),!s&&(d.ngOnChanges||d.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(r.index),s=!0),u++}!function Uge(e,t,r){const a=t.directiveEnd,i=e.data,o=t.attrs,s=[];let u=null,c=null;for(let l=t.directiveStart;l<a;l++){const d=i[l],f=r?r.get(d):null,h=f?f.outputs:null;u=gH(0,d.inputs,l,u,f?f.inputs:null),c=gH(1,d.outputs,l,c,h);const m=null===u||null===o||R8(t)?null:e0e(u,l,o);s.push(m)}null!==u&&(u.hasOwnProperty("class")&&(t.flags|=8),u.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=s,t.inputs=u,t.outputs=c}(e,r,i)}function _H(e,t,r){const n=r.directiveStart,a=r.directiveEnd,i=r.index,o=function Nhe(){return Rr.lFrame.currentDirectiveIndex}();try{rv(i);for(let s=n;s<a;s++){const u=e.data[s],c=t[s];ZP(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&Wge(u,c)}}finally{rv(-1),ZP(o)}}function Wge(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function mR(e,t,r){t.componentOffset=r,(e.components??=[]).push(t.index)}function Kge(e,t,r){if(r){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)r[t.exportAs[n]]=e;Ol(t)&&(r[""]=e)}}function Qge(e,t,r,n,a){e.data[n]=a;const i=a.factory||(a.factory=ev(a.type)),o=new Z1(i,Ol(a),Tr);e.blueprint[n]=o,r[n]=o,function Hge(e,t,r,n,a){const i=a.hostBindings;if(i){let o=e.hostBindingOpCodes;null===o&&(o=e.hostBindingOpCodes=[]);const s=~t.index;(function jge(e){let t=e.length;for(;t>0;){const r=e[--t];if("number"==typeof r&&r<0)return r}return 0})(o)!=s&&o.push(s),o.push(r,n,i)}}(e,t,n,h_(e,r,a.hostVars,qr),a)}function Jge(e,t,r,n,a,i){const o=i[t];if(null!==o)for(let s=0;s<o.length;)pH(n,r,o[s++],o[s++],o[s++],o[s++])}function e0e(e,t,r){let n=null,a=0;for(;a<r.length;){const i=r[a];if(0!==i)if(5!==i){if("number"==typeof i)break;if(e.hasOwnProperty(i)){null===n&&(n=[]);const o=e[i];for(let s=0;s<o.length;s+=3)if(o[s]===t){n.push(i,o[s+1],o[s+2],r[a+1]);break}}a+=2}else a+=2;else a+=4}return n}function SH(e,t,r,n){return[e,!0,0,t,null,n,null,r,null,null]}function CH(e,t){const r=e.contentQueries;if(null!==r){const n=bi(null);try{for(let a=0;a<r.length;a+=2){const o=r[a+1];if(-1!==o){const s=e.data[o];$P(r[a]),s.contentQueries(2,t[o],o)}}}finally{bi(n)}}}function Sw(e,t){return e[G1]?e[L8][Ml]=t:e[G1]=t,e[L8]=t,t}function gR(e,t,r){$P(0);const n=bi(null);try{t(e,r)}finally{bi(n)}}function xH(e){return e[c0]||(e[c0]=[])}function wH(e){return e.cleanup||(e.cleanup=[])}function Cw(e,t){const r=e[zs],n=r?r.get(Vf,null):null;n&&n.handleError(t)}function yR(e,t,r,n,a){for(let i=0;i<r.length;){const o=r[i++],s=r[i++],u=r[i++];pH(e.data[o],t[o],n,s,u,a)}}function zf(e,t,r){const n=function W1(e,t){return ya(t[e])}(t,e);!function lG(e,t,r){e.setValue(t,r)}(e[jr],n,r)}function n0e(e,t,r,n){const a=t[br];if(256==(256&a))return;t[kf].inlineEffectRunner?.flush(),JP(t);let o=null,s=null;(function a0e(e){return 2!==e.type})(e)&&(s=function bge(e){return e[$m]??function _ge(e){const t=tH.pop()??Object.create(Cge);return t.lView=e,t}(e)}(t),o=function $V(e){return e&&(e.nextProducerIndex=0),bi(e)}(s));try{Z8(t),function nz(e){return Rr.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==r&&hH(e,t,r,2,n);const u=3==(3&a);if(u){const d=e.preOrderCheckHooks;null!==d&&Rx(t,d,null)}else{const d=e.preOrderHooks;null!==d&&Ox(t,d,0,null),tM(t,0)}if(function i0e(e){for(let t=rH(e);null!==t;t=nH(t)){if(!(t[br]&LP.HasTransplantedViews))continue;const r=t[f0];for(let n=0;n<r.length;n++){She(r[n])}}}(t),TH(t,0),null!==e.contentQueries&&CH(e,t),u){const d=e.contentCheckHooks;null!==d&&Rx(t,d)}else{const d=e.contentHooks;null!==d&&Ox(t,d,1),tM(t,1)}!function Mge(e,t){const r=e.hostBindingOpCodes;if(null!==r)try{for(let n=0;n<r.length;n++){const a=r[n];if(a<0)rv(~a);else{const i=a,o=r[++n],s=r[++n];Fhe(o,i),s(2,t[i])}}}finally{rv(-1)}}(e,t);const c=e.components;null!==c&&EH(t,c,0);const l=e.viewQuery;if(null!==l&&gR(2,l,n),u){const d=e.viewCheckHooks;null!==d&&Rx(t,d)}else{const d=e.viewHooks;null!==d&&Ox(t,d,2),tM(t,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[Tx]){for(const d of t[Tx])d();t[Tx]=null}t[br]&=-73}catch(u){throw X1(t),u}finally{null!==s&&(function JV(e,t){if(bi(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(N1(e))for(let r=e.nextProducerIndex;r<e.producerNode.length;r++)fx(e.producerNode[r],e.producerIndexOfThis[r]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}(s,o),function Sge(e){e.lView[$m]!==e&&(e.lView=null,tH.push(e))}(s)),eM()}}function TH(e,t){for(let r=rH(e);null!==r;r=nH(r))for(let n=Vi;n<r.length;n++)DH(r[n],t)}function o0e(e,t,r){DH(Wu(t,e),r)}function DH(e,t){qP(e)&&_R(e,t)}function _R(e,t){const n=e[Ft],a=e[br],i=e[$m];let o=!!(0===t&&16&a);if(o||=!!(64&a&&0===t),o||=!!(1024&a),o||=!(!i?.dirty||!dP(i)),i&&(i.dirty=!1),e[br]&=-9217,o)n0e(n,e,n.template,e[Pa]);else if(8192&a){TH(e,1);const s=n.components;null!==s&&EH(e,s,1)}}function EH(e,t,r){for(let n=0;n<t.length;n++)o0e(e,t[n],r)}function m_(e){for(e[kf].changeDetectionScheduler?.notify();e;){e[br]|=64;const t=tv(e);if(VP(e)&&!t)return e;e=t}return null}class v_{get rootNodes(){const t=this._lView,r=t[Ft];return p_(r,t,r.firstChild,[])}constructor(t,r,n=!0){this._lView=t,this._cdRefInjectingView=r,this.notifyErrorHandler=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Pa]}set context(t){this._lView[Pa]=t}get destroyed(){return 256==(256&this._lView[br])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Ui];if(fs(t)){const r=t[8],n=r?r.indexOf(this):-1;n>-1&&(i_(t,n),Ux(r,n))}this._attachedToViewContainer=!1}rw(this._lView[Ft],this._lView)}onDestroy(t){!function Ix(e,t){if(256==(256&e[br]))throw new Ot(911,!1);null===e[_h]&&(e[_h]=[]),e[_h].push(t)}(this._lView,t)}markForCheck(){m_(this._cdRefInjectingView||this._lView)}detach(){this._lView[br]&=-129}reattach(){WP(this._lView),this._lView[br]|=128}detectChanges(){this._lView[br]|=1024,function bR(e,t=!0){const r=e[kf],n=r.rendererFactory;n.begin?.();try{!function r0e(e){_R(e,0);let t=0;for(;$8(e);){if(100===t)throw new Ot(103,!1);t++,_R(e,1)}}(e)}catch(i){throw t&&Cw(e,i),i}finally{n.end?.(),r.inlineEffectRunner?.flush()}}(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ot(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,dG(this._lView[Ft],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Ot(902,!1);this._appRef=t,WP(this._lView)}}let xw=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=s0e}return e})();function s0e(e){return function u0e(e,t,r){if(Jm(e)&&!r){const n=Wu(e.index,t);return new v_(n,n)}return 47&e.type?new v_(t[di],t):null}(ba(),ct(),16==(16&e))}const IH=new Set;function sv(e){IH.has(e)||(IH.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function CR(e){return t=>{setTimeout(e,void 0,t)}}const ts=class g0e extends Cn{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,r,n){let a=t,i=r||(()=>null),o=n;if(t&&"object"==typeof t){const u=t;a=u.next?.bind(u),i=u.error?.bind(u),o=u.complete?.bind(u)}this.__isAsync&&(i=CR(i),a&&(a=CR(a)),o&&(o=CR(o)));const s=super.subscribe({next:a,error:i,complete:o});return t instanceof Us&&t.add(s),s}};function PH(...e){}class _a{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ts(!1),this.onMicrotaskEmpty=new ts(!1),this.onStable=new ts(!1),this.onError=new ts(!1),typeof Zone>"u")throw new Ot(908,!1);Zone.assertZonePatched();const a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!n&&r,a.shouldCoalesceRunChangeDetection=n,a.lastRequestAnimationFrameId=-1,a.nativeRequestAnimationFrame=function y0e(){const e="function"==typeof aa.requestAnimationFrame;let t=aa[e?"requestAnimationFrame":"setTimeout"],r=aa[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&r){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:r}}().nativeRequestAnimationFrame,function S0e(e){const t=()=>{!function _0e(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(aa,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,wR(e),e.isCheckStableRunning=!0,xR(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),wR(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,n,a,i,o,s)=>{if(function C0e(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(s))return r.invokeTask(a,i,o,s);try{return MH(e),r.invokeTask(a,i,o,s)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||e.shouldCoalesceRunChangeDetection)&&t(),RH(e)}},onInvoke:(r,n,a,i,o,s,u)=>{try{return MH(e),r.invoke(a,i,o,s,u)}finally{e.shouldCoalesceRunChangeDetection&&t(),RH(e)}},onHasTask:(r,n,a,i)=>{r.hasTask(a,i),n===a&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,wR(e),xR(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(r,n,a,i)=>(r.handleError(a,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(a)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!_a.isInAngularZone())throw new Ot(909,!1)}static assertNotInAngularZone(){if(_a.isInAngularZone())throw new Ot(909,!1)}run(t,r,n){return this._inner.run(t,r,n)}runTask(t,r,n,a){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+a,t,b0e,PH,PH);try{return i.runTask(o,r,n)}finally{i.cancelTask(o)}}runGuarded(t,r,n){return this._inner.runGuarded(t,r,n)}runOutsideAngular(t){return this._outer.run(t)}}const b0e={};function xR(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function wR(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function MH(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function RH(e){e._nesting--,xR(e)}let g_=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){const r=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const a of r)a();return!!this.handler?.execute()||r.length>0}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=hr({token:e,providedIn:"root",factory:()=>new e})}return e})();function T0e(e,t){const r=Wu(t,e),n=r[Ft];!function D0e(e,t){for(let r=t.length;r<e.blueprint.length;r++)t.push(e.blueprint[r])}(n,r);const a=r[Qa];null!==a&&null===r[Rl]&&(r[Rl]=tR(a,r[zs])),AR(n,r,r[Pa])}function AR(e,t,r){JP(t);try{const n=e.viewQuery;null!==n&&gR(1,n,r);const a=e.template;null!==a&&hH(e,t,a,1,r),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&CH(e,t),e.staticViewQueries&&gR(2,e.viewQuery,r);const i=e.components;null!==i&&function E0e(e,t){for(let r=0;r<t.length;r++)T0e(e,t[r])}(t,i)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[br]&=-5,eM()}}function ww(e,t,r){let n=r?e.styles:null,a=r?e.classes:null,i=0;if(null!==t)for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?i=s:1==i?a=SP(a,s):2==i&&(n=SP(n,s+": "+t[++o]+";"))}r?e.styles=n:e.stylesWithoutHost=n,r?e.classes=a:e.classesWithoutHost=a}class LH extends mw{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const r=fn(t);return new y_(r,this.ngModule)}}function UH(e){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const n=e[r];void 0!==n&&t.push({propName:Array.isArray(n)?n[0]:n,templateName:r})}return t}class P0e{constructor(t,r){this.injector=t,this.parentInjector=r}get(t,r,n){n=xx(n);const a=this.injector.get(t,iR,n);return a!==iR||r===iR?a:this.parentInjector.get(t,r,n)}}class y_ extends jG{get inputs(){const t=this.componentDef,r=t.inputTransforms,n=UH(t.inputs);if(null!==r)for(const a of n)r.hasOwnProperty(a.propName)&&(a.transform=r[a.propName]);return n}get outputs(){return UH(this.componentDef.outputs)}constructor(t,r){super(),this.componentDef=t,this.ngModule=r,this.componentType=t.type,this.selector=function nhe(e){return e.map(rhe).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!r}create(t,r,n,a){let i=(a=a||this.ngModule)instanceof Fl?a:a?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const o=i?new P0e(t,i):t,s=o.get(WG,null);if(null===s)throw new Ot(407,!1);const d={rendererFactory:s,sanitizer:o.get(sge,null),inlineEffectRunner:null,afterRenderEventManager:o.get(g_,null),changeDetectionScheduler:o.get(LG,null)},f=s.createRenderer(null,this.componentDef),p=this.componentDef.selectors[0][0]||"div",h=n?function Oge(e,t,r,n){const i=n.get(uH,!1)||r===El.ShadowDom,o=e.selectRootElement(t,i);return function Fge(e){vH(e)}(o),o}(f,n,this.componentDef.encapsulation,o):tw(f,p,function I0e(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(p));let m=512;this.componentDef.signals?m|=4096:this.componentDef.onPush||(m|=16);let v=null;null!==h&&(v=tR(h,o,!0));const g=pR(0,null,null,1,0,null,null,null,null,null,null),y=_w(null,g,null,m,null,null,d,f,o,null,v);let b,_;JP(y);try{const C=this.componentDef;let x,A=null;C.findHostDirectiveDefs?(x=[],A=new Map,C.findHostDirectiveDefs(C,x,A),x.push(C)):x=[C];const T=function R0e(e,t){const r=e[Ft],n=Ur;return e[n]=t,L0(r,n,2,"#host",null)}(y,h),w=function O0e(e,t,r,n,a,i,o){const s=a[Ft];!function F0e(e,t,r,n){for(const a of e)t.mergedAttrs=z1(t.mergedAttrs,a.hostAttrs);null!==t.mergedAttrs&&(ww(t,t.mergedAttrs,!0),null!==r&&wG(n,r,t))}(n,e,t,o);let u=null;null!==t&&(u=tR(t,a[zs]));const c=i.rendererFactory.createRenderer(t,r);let l=16;r.signals?l=4096:r.onPush&&(l=64);const d=_w(a,mH(r),null,l,a[e.index],e,i,c,null,null,u);return s.firstCreatePass&&mR(s,e,n.length-1),Sw(a,d),a[e.index]=d}(T,h,C,x,y,d,f);_=Y1(g,Ur),h&&function k0e(e,t,r,n){if(n)NP(e,r,["ng-version","17.1.2"]);else{const{attrs:a,classes:i}=function ahe(e){const t=[],r=[];let n=1,a=2;for(;n<e.length;){let i=e[n];if("string"==typeof i)2===a?""!==i&&t.push(i,e[++n]):8===a&&r.push(i);else{if(!Pl(a))break;a=i}n++}return{attrs:t,classes:r}}(t.selectors[0]);a&&NP(e,r,a),i&&i.length>0&&xG(e,r,i.join(" "))}}(f,C,h,n),void 0!==r&&function B0e(e,t,r){const n=e.projection=[];for(let a=0;a<t.length;a++){const i=r[a];n.push(null!=i?Array.from(i):null)}}(_,this.ngContentSelectors,r),b=function N0e(e,t,r,n,a,i){const o=ba(),s=a[Ft],u=Gs(o,a);bH(s,a,o,r,null,n);for(let l=0;l<r.length;l++)hs(nv(a,s,o.directiveStart+l,o),a);_H(s,a,o),u&&hs(u,a);const c=nv(a,s,o.directiveStart+o.componentOffset,o);if(e[Pa]=a[Pa]=c,null!==i)for(const l of i)l(c,t);return lR(s,o,e),c}(w,C,x,A,y,[L0e]),AR(g,y,null)}finally{eM()}return new M0e(this.componentType,b,B0(_,y),y,_)}}class M0e extends tge{constructor(t,r,n,a,i){super(),this.location=n,this._rootLView=a,this._tNode=i,this.previousInputValues=null,this.instance=r,this.hostView=this.changeDetectorRef=new v_(a,void 0,!1),this.componentType=t}setInput(t,r){const n=this._tNode.inputs;let a;if(null!==n&&(a=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),r))return;const i=this._rootLView;yR(i[Ft],i,a,t,r),this.previousInputValues.set(t,r),m_(Wu(this._tNode.index,i))}}get injector(){return new Ao(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function L0e(){const e=ba();Mx(ct()[Ft],e)}let QH=()=>null;function U0(e,t){return QH(e,t)}function x_(e,t,r,n){const a=t.tView,s=_w(e,a,r,4096&e[br]?4096:16,null,t,null,null,null,n?.injector??null,n?.dehydratedView??null);s[H1]=e[t.index];const c=e[yd];return null!==c&&(s[yd]=c.createEmbeddedView(a)),AR(a,s,r),s}function $H(e,t){const r=Vi+t;if(r<e.length)return e[r]}function V0(e,t){return!t||null===t.firstChild||$x(e)}function w_(e,t,r,n=!0){const a=t[Ft];if(function fve(e,t,r,n){const a=Vi+n,i=r.length;n>0&&(r[a-1][Ml]=t),n<i-Vi?(t[Ml]=r[a],Tz(r,Vi+n,t)):(r.push(t),t[Ml]=null),t[Ui]=r;const o=t[H1];null!==o&&r!==o&&function pve(e,t){const r=e[f0];t[di]!==t[Ui][Ui][di]&&(e[br]|=LP.HasTransplantedViews),null===r?e[f0]=[t]:r.push(t)}(o,t);const s=t[yd];null!==s&&s.insertView(e),WP(t),t[br]|=128}(a,t,e,r),n){const o=VM(r,e),s=t[jr],u=nw(s,e[bd]);null!==u&&function lve(e,t,r,n,a,i){n[Qa]=a,n[ls]=t,ow(e,n,r,1,a,i)}(a,e[ls],s,t,u,o)}const i=t[Rl];null!==i&&null!==i.firstChild&&(i.firstChild=null)}function MR(e,t){const r=i_(e,t);return void 0!==r&&rw(r[Ft],r),r}let Nl=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=vye}return e})();function vye(){return t9(ba(),ct())}const gye=Nl,JH=class extends gye{constructor(t,r,n){super(),this._lContainer=t,this._hostTNode=r,this._hostLView=n}get element(){return B0(this._hostTNode,this._hostLView)}get injector(){return new Ao(this._hostTNode,this._hostLView)}get parentInjector(){const t=kx(this._hostTNode,this._hostLView);if(nM(t)){const r=$1(t,this._hostLView),n=Q1(t);return new Ao(r[Ft].data[n+8],r)}return new Ao(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const r=e9(this._lContainer);return null!==r&&r[t]||null}get length(){return this._lContainer.length-Vi}createEmbeddedView(t,r,n){let a,i;"number"==typeof n?a=n:null!=n&&(a=n.index,i=n.injector);const o=U0(this._lContainer,t.ssrId),s=t.createEmbeddedViewImpl(r||{},i,o);return this.insertImpl(s,a,V0(this._hostTNode,o)),s}createComponent(t,r,n,a,i){const o=t&&!function J1(e){return"function"==typeof e}(t);let s;if(o)s=r;else{const h=r||{};s=h.index,n=h.injector,a=h.projectableNodes,i=h.environmentInjector||h.ngModuleRef}const u=o?t:new y_(fn(t)),c=n||this.parentInjector;if(!i&&null==u.ngModule){const m=(o?c:this.parentInjector).get(Fl,null);m&&(i=m)}const l=fn(u.componentType??{}),d=U0(this._lContainer,l?.id??null),p=u.create(c,a,d?.firstChild??null,i);return this.insertImpl(p.hostView,s,V0(this._hostTNode,d)),p}insert(t,r){return this.insertImpl(t,r,!0)}insertImpl(t,r,n){const a=t._lView;if(function _he(e){return fs(e[Ui])}(a)){const s=this.indexOf(t);if(-1!==s)this.detach(s);else{const u=a[Ui],c=new JH(u,u[ls],u[Ui]);c.detach(c.indexOf(t))}}const i=this._adjustIndex(r),o=this._lContainer;return w_(o,a,i,n),t.attachToViewContainerRef(),Tz(RR(o),i,t),t}move(t,r){return this.insert(t,r)}indexOf(t){const r=e9(this._lContainer);return null!==r?r.indexOf(t):-1}remove(t){const r=this._adjustIndex(t,-1),n=i_(this._lContainer,r);n&&(Ux(RR(this._lContainer),r),rw(n[Ft],n))}detach(t){const r=this._adjustIndex(t,-1),n=i_(this._lContainer,r);return n&&null!=Ux(RR(this._lContainer),r)?new v_(n):null}_adjustIndex(t,r=0){return t??this.length+r}};function e9(e){return e[8]}function RR(e){return e[8]||(e[8]=[])}function t9(e,t){let r;const n=t[e.index];return fs(n)?r=n:(r=SH(n,t,null,e),t[e.index]=r,Sw(t,r)),r9(r,t,e,n),new JH(r,e,t)}let r9=function a9(e,t,r,n){if(e[bd])return;let a;a=8&r.type?ya(n):function yye(e,t){const r=e[jr],n=r.createComment(""),a=Gs(t,e);return ov(r,nw(r,a),n,function gve(e,t){return e.nextSibling(t)}(r,a),!1),n}(t,r),e[bd]=a},OR=()=>!1;function eo(e,t,r){return!Object.is(e[t],r)&&(e[t]=r,!0)}function z0(e,t,r,n,a,i,o,s){const u=ct(),c=Dn(),l=e+Ur,d=c.firstCreatePass?function Cye(e,t,r,n,a,i,o,s,u){const c=t.consts,l=L0(t,e,4,o||null,Sd(c,s));hR(t,r,l,Sd(c,u)),Mx(t,l);const d=l.tView=pR(2,l,n,a,i,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return null!==t.queries&&(t.queries.template(t,l),d.queries=t.queries.embeddedTView(l)),l}(l,c,u,t,r,n,a,i,o):c.data[l];Cd(d,!1);const f=i9(c,u,d,e);Px()&&aw(c,u,f,d),hs(f,u);const p=SH(f,u,f,d);return u[l]=p,Sw(u,p),function n9(e,t,r){return OR(e,t,r)}(p,d,u),Ex(d)&&dR(c,u,d),null!=o&&fR(u,d,s),z0}let i9=function o9(e,t,r,n){return Ch(!0),t[jr].createComment("")};function Bw(e,t,r){const n=ct();return eo(n,xd(),t)&&function Ku(e,t,r,n,a,i,o,s){const u=Gs(t,r);let l,c=t.inputs;!s&&null!=c&&(l=c[n])?(yR(e,r,l,n,a),Jm(t)&&function zge(e,t){const r=Wu(t,e);16&r[br]||(r[br]|=64)}(r,t.index)):3&t.type&&(n=function Vge(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),a=null!=o?o(a,t.value||"",n):a,i.setProperty(u,n,a))}(Dn(),function za(){const e=Rr.lFrame;return Y1(e.tView,e.selectedIndex)}(),n,e,t,n[jr],r,!1),Bw}function WR(e,t,r,n,a){const o=a?"class":"style";yR(e,r,t.inputs[o],o,n)}class Obe{destroy(t){}updateValue(t,r){}swap(t,r){const n=Math.min(t,r),a=Math.max(t,r),i=this.detach(a);if(a-n>1){const o=this.detach(n);this.attach(n,i),this.attach(a,o)}else this.attach(n,i)}move(t,r){this.attach(r,this.detach(t))}}function XR(e,t,r,n,a){return e===r&&Object.is(t,n)?1:Object.is(a(e,t),a(r,n))?-1:0}function KR(e,t,r,n){return!(void 0===t||!t.has(n)||(e.attach(r,t.get(n)),t.delete(n),0))}function J9(e,t,r,n,a){if(KR(e,t,n,r(n,a)))e.updateValue(n,a);else{const i=e.create(n,a);e.attach(n,i)}}function e7(e,t,r,n){const a=new Set;for(let i=t;i<=r;i++)a.add(n(i,e.at(i)));return a}class t7{constructor(){this.kvMap=new Map,this._vMap=void 0}has(t){return this.kvMap.has(t)}delete(t){if(!this.has(t))return!1;const r=this.kvMap.get(t);return void 0!==this._vMap&&this._vMap.has(r)?(this.kvMap.set(t,this._vMap.get(r)),this._vMap.delete(r)):this.kvMap.delete(t),!0}get(t){return this.kvMap.get(t)}set(t,r){if(this.kvMap.has(t)){let n=this.kvMap.get(t);void 0===this._vMap&&(this._vMap=new Map);const a=this._vMap;for(;a.has(n);)n=a.get(n);a.set(n,r)}else this.kvMap.set(t,r)}forEach(t){for(let[r,n]of this.kvMap)if(t(n,r),void 0!==this._vMap){const a=this._vMap;for(;a.has(n);)n=a.get(n),t(n,r)}}}class Nbe{constructor(t,r,n){this.lContainer=t,this.$implicit=r,this.$index=n}get $count(){return this.lContainer.length-Vi}}function n7(e){return e}class Bbe{constructor(t,r,n){this.hasEmptyBlock=t,this.trackByFn=r,this.liveCollection=n}}class Lbe extends Obe{constructor(t,r,n){super(),this.lContainer=t,this.hostLView=r,this.templateTNode=n,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Vi}at(t){return this.getLView(t)[Pa].$implicit}attach(t,r){const n=r[Rl];this.needsIndexUpdate||=t!==this.length,w_(this.lContainer,r,t,V0(this.templateTNode,n))}detach(t){return this.needsIndexUpdate||=t!==this.length-1,function Ube(e,t){return i_(e,t)}(this.lContainer,t)}create(t,r){const n=U0(this.lContainer,this.templateTNode.tView.ssrId);return x_(this.hostLView,this.templateTNode,new Nbe(this.lContainer,r,t),{dehydratedView:n})}destroy(t){rw(t[Ft],t)}updateValue(t,r){this.getLView(t)[Pa].$implicit=r}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let t=0;t<this.length;t++)this.getLView(t)[Pa].$index=t}getLView(t){return function Vbe(e,t){return $H(e,t)}(this.lContainer,t)}}function ZR(e,t){return e[t]}function QR(e,t){return Y1(e,t)}function fi(e,t,r,n){const a=ct(),i=Dn(),o=Ur+e,s=a[jr],u=i.firstCreatePass?function zbe(e,t,r,n,a,i){const o=t.consts,u=L0(t,e,2,n,Sd(o,a));return hR(t,r,u,Sd(o,i)),null!==u.attrs&&ww(u,u.attrs,!1),null!==u.mergedAttrs&&ww(u,u.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,u),u}(o,i,a,t,r,n):i.data[o],c=o7(i,a,u,s,t,e);a[o]=c;const l=Ex(u);return Cd(u,!0),wG(s,c,u),32!=(32&u.flags)&&Px()&&aw(i,a,c,u),0===function Che(){return Rr.lFrame.elementDepthCount}()&&hs(c,a),function xhe(){Rr.lFrame.elementDepthCount++}(),l&&(dR(i,a,u),lR(i,u,a)),null!==n&&fR(a,u),fi}function Ci(){let e=ba();XP()?function KP(){Rr.lFrame.isParent=!1}():(e=e.parent,Cd(e,!1));const t=e;(function Ahe(e){return Rr.skipHydrationRootTNode===e})(t)&&function Ihe(){Rr.skipHydrationRootTNode=null}(),function whe(){Rr.lFrame.elementDepthCount--}();const r=Dn();return r.firstCreatePass&&(Mx(r,e),UP(e)&&r.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Whe(e){return 0!=(8&e.flags)}(t)&&WR(r,t,ct(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Yhe(e){return 0!=(16&e.flags)}(t)&&WR(r,t,ct(),t.stylesWithoutHost,!1),Ci}function Zu(e,t,r,n){return fi(e,t,r,n),Ci(),Zu}let o7=(e,t,r,n,a,i)=>(Ch(!0),tw(n,a,function dz(){return Rr.lFrame.currentNamespace}()));const iy="en-US";let p7=iy;function Hw(e){return!!e&&"function"==typeof e.then}function L7(e){return!!e&&"function"==typeof e.subscribe}function jw(e,t,r,n){const a=ct(),i=Dn(),o=ba();return function V7(e,t,r,n,a,i,o){const s=Ex(n),c=e.firstCreatePass&&wH(e),l=t[Pa],d=xH(t);let f=!0;if(3&n.type||o){const m=Gs(n,t),v=o?o(m):m,g=d.length,y=o?_=>o(ya(_[n.index])):n.index;let b=null;if(!o&&s&&(b=function j1e(e,t,r,n){const a=e.cleanup;if(null!=a)for(let i=0;i<a.length-1;i+=2){const o=a[i];if(o===r&&a[i+1]===n){const s=t[c0],u=a[i+2];return s.length>u?s[u]:null}"string"==typeof o&&(i+=2)}return null}(e,t,a,n.index)),null!==b)(b.__ngLastListenerFn__||b).__ngNextListenerFn__=i,b.__ngLastListenerFn__=i,f=!1;else{i=G7(n,t,l,i,!1);const _=r.listen(v,a,i);d.push(i,_),c&&c.push(a,y,g,g+1)}}else i=G7(n,t,l,i,!1);const p=n.outputs;let h;if(f&&null!==p&&(h=p[a])){const m=h.length;if(m)for(let v=0;v<m;v+=2){const C=t[h[v]][h[v+1]].subscribe(i),x=d.length;d.push(i,C),c&&c.push(a,n.index,x,-(x+1))}}}(i,a,a[jr],o,e,t,n),jw}function z7(e,t,r,n){try{return _d(6,t,r),!1!==r(n)}catch(a){return Cw(e,a),!1}finally{_d(7,t,r)}}function G7(e,t,r,n,a){return function i(o){if(o===Function)return n;m_(e.componentOffset>-1?Wu(e.index,t):t);let u=z7(t,r,n,o),c=i.__ngNextListenerFn__;for(;c;)u=z7(t,r,c,o)&&u,c=c.__ngNextListenerFn__;return a&&!1===u&&o.preventDefault(),u}}function rO(e=1){return function Bhe(e){return(Rr.lFrame.contextLView=function Q8(e,t){for(;e>0;)t=t[l0],e--;return t}(e,Rr.lFrame.contextLView))[Pa]}(e)}function X1e(){return this._results[Symbol.iterator]()}class aO{static#e=Symbol.iterator;get changes(){return this._changes??=new ts}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const r=aO.prototype;r[Symbol.iterator]||(r[Symbol.iterator]=X1e)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,r){return this._results.reduce(t,r)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,r){this.dirty=!1;const n=function yu(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function ome(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let a=e[n],i=t[n];if(r&&(a=r(a),i=r(i)),i!==a)return!1}return!0}(this._results,n,r))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}let Gf=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Q1e}return e})();const K1e=Gf,Z1e=class extends K1e{constructor(t,r,n){super(),this._declarationLView=t,this._declarationTContainer=r,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,r){return this.createEmbeddedViewImpl(t,r)}createEmbeddedViewImpl(t,r,n){const a=x_(this._declarationLView,this._declarationTContainer,t,{injector:r,dehydratedView:n});return new v_(a)}};function Q1e(){return qw(ba(),ct())}function qw(e,t){return 4&e.type?new Z1e(t,e,B0(e,t)):null}class iO{constructor(t){this.queryList=t,this.matches=null}clone(){return new iO(this.queryList)}setDirty(){this.queryList.setDirty()}}class oO{constructor(t=[]){this.queries=t}createEmbeddedView(t){const r=t.queries;if(null!==r){const n=null!==t.contentQueries?t.contentQueries[0]:r.length,a=[];for(let i=0;i<n;i++){const o=r.getByIndex(i);a.push(this.queries[o.indexInDeclarationView].clone())}return new oO(a)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let r=0;r<this.queries.length;r++)null!==rj(t,r).matches&&this.queries[r].setDirty()}}class $7{constructor(t,r,n=null){this.predicate=t,this.flags=r,this.read=n}}class sO{constructor(t=[]){this.queries=t}elementStart(t,r){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,r)}elementEnd(t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementEnd(t)}embeddedTView(t){let r=null;for(let n=0;n<this.length;n++){const a=null!==r?r.length:0,i=this.getByIndex(n).embeddedTView(t,a);i&&(i.indexInDeclarationView=n,null!==r?r.push(i):r=[i])}return null!==r?new sO(r):null}template(t,r){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,r)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class uO{constructor(t,r=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=r}elementStart(t,r){this.isApplyingToNode(r)&&this.matchTNode(t,r)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,r){this.elementStart(t,r)}embeddedTView(t,r){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,r),new uO(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const r=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==r;)n=n.parent;return r===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,r){const n=this.metadata.predicate;if(Array.isArray(n))for(let a=0;a<n.length;a++){const i=n[a];this.matchTNodeWithReadOption(t,r,$1e(r,i)),this.matchTNodeWithReadOption(t,r,Bx(r,t,i,!1,!1))}else n===Gf?4&r.type&&this.matchTNodeWithReadOption(t,r,-1):this.matchTNodeWithReadOption(t,r,Bx(r,t,n,!1,!1))}matchTNodeWithReadOption(t,r,n){if(null!==n){const a=this.metadata.read;if(null!==a)if(a===Ih||a===Nl||a===Gf&&4&r.type)this.addMatch(r.index,-2);else{const i=Bx(r,t,a,!1,!1);null!==i&&this.addMatch(r.index,i)}else this.addMatch(r.index,n)}}addMatch(t,r){null===this.matches?this.matches=[t,r]:this.matches.push(t,r)}}function $1e(e,t){const r=e.localNames;if(null!==r)for(let n=0;n<r.length;n+=2)if(r[n]===t)return r[n+1];return null}function e_e(e,t,r,n){return-1===r?function J1e(e,t){return 11&e.type?B0(e,t):4&e.type?qw(e,t):null}(t,e):-2===r?function t_e(e,t,r){return r===Ih?B0(t,e):r===Gf?qw(t,e):r===Nl?t9(t,e):void 0}(e,t,n):nv(e,e[Ft],r,t)}function J7(e,t,r,n){const a=t[yd].queries[n];if(null===a.matches){const i=e.data,o=r.matches,s=[];for(let u=0;u<o.length;u+=2){const c=o[u];s.push(c<0?null:e_e(t,i[c],o[u+1],r.metadata.read))}a.matches=s}return a.matches}function cO(e,t,r,n){const a=e.queries.getByIndex(r),i=a.matches;if(null!==i){const o=J7(e,t,a,r);for(let s=0;s<i.length;s+=2){const u=i[s];if(u>0)n.push(o[s/2]);else{const c=i[s+1],l=t[-u];for(let d=Vi;d<l.length;d++){const f=l[d];f[H1]===f[Ui]&&cO(f[Ft],f,c,n)}if(null!==l[f0]){const d=l[f0];for(let f=0;f<d.length;f++){const p=d[f];cO(p[Ft],p,c,n)}}}}}return n}function rj(e,t){return e.queries.getByIndex(t)}function Ww(e,t,r){const n=Dn();n.firstCreatePass&&(function tj(e,t,r){null===e.queries&&(e.queries=new sO),e.queries.track(new uO(t,r))}(n,new $7(e,t,r),-1),2==(2&t)&&(n.staticViewQueries=!0)),function ej(e,t,r){const n=new aO(4==(4&r));(function Bge(e,t,r,n){const a=xH(t);a.push(r),e.firstCreatePass&&wH(e).push(n,a.length-1)})(e,t,n,n.destroy),null===t[yd]&&(t[yd]=new oO),t[yd].queries.push(new iO(n))}(n,ct(),t)}function N_(e){const t=ct(),r=Dn(),n=iz();$P(n+1);const a=rj(r,n);if(e.dirty&&function bhe(e){return 4==(4&e[br])}(t)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{const i=a.crossesNgTemplate?cO(r,t,n,[]):J7(r,t,a,n);e.reset(i,ige),e.notifyOnChanges()}return!0}return!1}function k_(){return function r_e(e,t){return e[yd].queries[t].queryList}(ct(),iz())}function Ra(e,t=""){const r=ct(),n=Dn(),a=e+Ur,i=n.firstCreatePass?L0(n,a,1,t,null):n.data[a],o=pj(n,r,i,t,e);r[a]=o,Px()&&aw(n,r,o,i),Cd(i,!1)}let pj=(e,t,r,n,a)=>(Ch(!0),function ew(e,t){return e.createText(t)}(t[jr],n));function Oh(e,t,r){const n=ct(),a=function K0(e,t,r,n){return eo(e,xd(),r)?t+Lr(r)+n:qr}(n,e,t,r);return a!==qr&&zf(n,ps(),a),Oh}class pv{}class wj{}class hO extends pv{constructor(t,r,n){super(),this._parent=r,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new LH(this);const a=cs(t);this._bootstrapComponents=Xu(a.bootstrap),this._r3Injector=Gz(t,r,[{provide:pv,useValue:this},{provide:mw,useValue:this.componentFactoryResolver},...n],xo(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class mO extends wj{constructor(t){super(),this.moduleType=t}create(t){return new hO(this.moduleType,t,[])}}class Aj extends pv{constructor(t){super(),this.componentFactoryResolver=new LH(this),this.instance=null;const r=new T0([...t.providers,{provide:pv,useValue:this},{provide:mw,useValue:this.componentFactoryResolver}],t.parent||Yx(),t.debugName,new Set(["environment"]));this.injector=r,t.runEnvironmentInitializers&&r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Tj(e,t,r=null){return new Aj({providers:e,parent:t,debugName:r,runEnvironmentInitializers:!0}).injector}let w_e=(()=>{class e{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){const n=Oz(0,r.type),a=n.length>0?Tj([n],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,a)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(const r of this.cachedInjectors.values())null!==r&&r.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=hr({token:e,providedIn:"environment",factory:()=>new e(Xr(Fl))})}return e})();function hv(e){sv("NgStandalone"),e.getStandaloneInjector=t=>t.get(w_e).getOrCreateStandaloneInjector(e)}function Nj(e,t,r,n,a,i){const o=t+r;return eo(e,o,a)?function Td(e,t,r){return e[t]=r}(e,o+1,i?n.call(i,a):n(a)):function B_(e,t){const r=e[t];return r===qr?void 0:r}(e,o+1)}function L_(e,t){const r=Dn();let n;const a=e+Ur;r.firstCreatePass?(n=function q_e(e,t){if(t)for(let r=t.length-1;r>=0;r--){const n=t[r];if(e===n.name)return n}}(t,r.pipeRegistry),r.data[a]=n,n.onDestroy&&(r.destroyHooks??=[]).push(a,n.onDestroy)):n=r.data[a];const i=n.factory||(n.factory=ev(n.type)),s=vu(Tr);try{const u=Fx(!1),c=i();return Fx(u),function a_e(e,t,r,n){r>=e.data.length&&(e.data[r]=null,e.blueprint[r]=null),t[r]=n}(r,ct(),a,c),c}finally{vu(s)}}function U_(e,t,r){const n=e+Ur,a=ct(),i=function p0(e,t){return e[t]}(a,n);return function V_(e,t){return e[Ft].data[t].pure}(a,n)?Nj(a,function Hs(){const e=Rr.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),t,i.transform,r,i):i.transform(r)}let tq=(()=>{class e{log(r){console.log(r)}warn(r){console.warn(r)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();class y2e{constructor(t,r){this.ngModuleFactory=t,this.componentFactories=r}}let b2e=(()=>{class e{compileModuleSync(r){return new mO(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){const n=this.compileModuleSync(r),i=Xu(cs(r).declarations).reduce((o,s)=>{const u=fn(s);return u&&o.push(new y_(u)),o},[]);return new y2e(n,i)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Qw=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Li(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const oq=new ur(""),Y2e=new ur("");let AO=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,n)=>{this.resolve=r,this.reject=n}),this.appInits=Gt(Y2e,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const r=[];for(const a of this.appInits){const i=a();if(Hw(i))r.push(i);else if(L7(i)){const o=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});r.push(o)}}const n=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{n()}).catch(a=>{this.reject(a)}),0===r.length&&n(),this.initialized=!0}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const TO=new ur("");let mv=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Gt(oH),this.afterRenderEffectManager=Gt(g_),this.componentTypes=[],this.components=[],this.isStable=Gt(Qw).hasPendingTasks.pipe(yr(r=>!r)),this._injector=Gt(Fl)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,n){const a=r instanceof jG;if(!this._injector.get(AO).done)throw!a&&function bh(e){const t=fn(e)||wo(e)||es(e);return null!==t&&t.standalone}(r),new Ot(405,!1);let o;o=a?r:this._injector.get(mw).resolveComponentFactory(r),this.componentTypes.push(o.componentType);const s=function K2e(e){return e.isBoundToModule}(o)?void 0:this._injector.get(pv),c=o.create(Tc.NULL,[],n||o.selector,s),l=c.location.nativeElement,d=c.injector.get(oq,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),eA(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new Ot(101,!1);try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this.internalErrorHandler(r)}finally{try{this.afterRenderEffectManager.execute()}catch(r){this.internalErrorHandler(r)}this._runningTick=!1}}attachView(r){const n=r;this._views.push(n),n.attachToAppRef(this)}detachView(r){const n=r;eA(this._views,n),n.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);const n=this._injector.get(TO,[]);[...this._bootstrapListeners,...n].forEach(a=>a(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>eA(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new Ot(406,!1);const r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function eA(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}let Q2e=(()=>{class e{constructor(){this.zone=Gt(_a),this.applicationRef=Gt(mv)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function dq(e){return[{provide:_a,useFactory:e},{provide:av,multi:!0,useFactory:()=>{const t=Gt(Q2e,{optional:!0});return()=>t.initialize()}},{provide:av,multi:!0,useFactory:()=>{const t=Gt(eSe);return()=>{t.initialize()}}},{provide:oH,useFactory:$2e}]}function $2e(){const e=Gt(_a),t=Gt(Vf);return r=>e.runOutsideAngular(()=>t.handleError(r))}function J2e(e){return jx([[],dq(()=>new _a(function fq(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}(e)))])}let eSe=(()=>{class e{constructor(){this.subscription=new Us,this.initialized=!1,this.zone=Gt(_a),this.pendingTasks=Gt(Qw)}initialize(){if(this.initialized)return;this.initialized=!0;let r=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(r=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{_a.assertNotInAngularZone(),queueMicrotask(()=>{null!==r&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(r),r=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{_a.assertInAngularZone(),r??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Hf=new ur("",{providedIn:"root",factory:()=>Gt(Hf,vn.Optional|vn.SkipSelf)||function tSe(){return typeof $localize<"u"&&$localize.locale||iy}()}),DO=new ur("");let Fh=null;function ASe(e){try{const{rootComponent:t,appProviders:r,platformProviders:n}=e,a=function oSe(e=[]){if(Fh)return Fh;const t=function mq(e=[],t){return Tc.create({name:t,providers:[{provide:bM,useValue:"platform"},{provide:DO,useValue:new Set([()=>Fh=null])},...e]})}(e);return Fh=t,function sq(){!function lpe(e){n8=e}(()=>{throw new Ot(600,!1)})}(),function vq(e){e.get(jz,null)?.forEach(r=>r())}(t),t}(n),i=[J2e(),...r||[]],s=new Aj({providers:i,parent:a,debugName:"",runEnvironmentInitializers:!1}).injector,u=s.get(_a);return u.run(()=>{s.resolveInjectorInitializers();const c=s.get(Vf,null);let l;u.runOutsideAngular(()=>{l=u.onError.subscribe({next:p=>{c.handleError(p)}})});const d=()=>s.destroy(),f=a.get(DO);return f.add(d),s.onDestroy(()=>{l.unsubscribe(),f.delete(d)}),function uq(e,t,r){try{const n=r();return Hw(n)?n.catch(a=>{throw t.runOutsideAngular(()=>e.handleError(a)),a}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(c,u,()=>{const p=s.get(AO);return p.runInitializers(),p.donePromise.then(()=>{!function h7(e){mu(e,"Expected localeId to be defined"),"string"==typeof e&&(p7=e.toLowerCase().replace(/_/g,"-"))}(s.get(Hf,iy)||iy);const m=s.get(mv);return void 0!==t&&m.bootstrap(t),m})})})}catch(t){return Promise.reject(t)}}let Vq=null;function cy(){return Vq}class VSe{}const Id=new ur("");let zq=(()=>{class e{historyGo(r){throw new Error("")}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>Gt(zSe),providedIn:"platform"})}return e})(),zSe=(()=>{class e extends zq{constructor(){super(),this._doc=Gt(Id),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return cy().getBaseHref(this._doc)}onPopState(r){const n=cy().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",r,!1),()=>n.removeEventListener("popstate",r)}onHashChange(r){const n=cy().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",r,!1),()=>n.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,n,a){this._history.pushState(r,n,a)}replaceState(r,n,a){this._history.replaceState(r,n,a)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function Gq(e,t){if(0==e.length)return t;if(0==t.length)return e;let r=0;return e.endsWith("/")&&r++,t.startsWith("/")&&r++,2==r?e+t.substring(1):1==r?e+t:e+"/"+t}function Hq(e){const t=e.match(/#|\?|$/),r=t&&t.index||e.length;return e.slice(0,r-("/"===e[r-1]?1:0))+e.slice(r)}function gv(e){return e&&"?"!==e[0]?"?"+e:e}let cA=(()=>{class e{historyGo(r){throw new Error("")}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>Gt(HSe),providedIn:"root"})}return e})();const GSe=new ur("");let HSe=(()=>{class e extends cA{constructor(r,n){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??Gt(Id).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return Gq(this._baseHref,r)}path(r=!1){const n=this._platformLocation.pathname+gv(this._platformLocation.search),a=this._platformLocation.hash;return a&&r?`${n}${a}`:n}pushState(r,n,a,i){const o=this.prepareExternalUrl(a+gv(i));this._platformLocation.pushState(r,n,o)}replaceState(r,n,a,i){const o=this.prepareExternalUrl(a+gv(i));this._platformLocation.replaceState(r,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(zq),Xr(GSe,8))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),q_=(()=>{class e{constructor(r){this._subject=new ts,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;const n=this._locationStrategy.getBaseHref();this._basePath=function WSe(e){if(new RegExp("^(https?:)?//").test(e)){const[,r]=e.split(/\/\/[^\/]+/);return r}return e}(Hq(jq(n))),this._locationStrategy.onPopState(a=>{this._subject.emit({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,n=""){return this.path()==this.normalize(r+gv(n))}normalize(r){return e.stripTrailingSlash(function qSe(e,t){if(!e||!t.startsWith(e))return t;const r=t.substring(e.length);return""===r||["/",";","?","#"].includes(r[0])?r:t}(this._basePath,jq(r)))}prepareExternalUrl(r){return r&&"/"!==r[0]&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,n="",a=null){this._locationStrategy.pushState(a,"",r,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+gv(n)),a)}replaceState(r,n="",a=null){this._locationStrategy.replaceState(a,"",r,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+gv(n)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{const n=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(n,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",n){this._urlChangeListeners.forEach(a=>a(r,n))}subscribe(r,n,a){return this._subject.subscribe({next:r,error:n,complete:a})}static#e=this.normalizeQueryParams=gv;static#t=this.joinWithSlash=Gq;static#r=this.stripTrailingSlash=Hq;static#n=this.\u0275fac=function(n){return new(n||e)(Xr(cA))};static#a=this.\u0275prov=hr({token:e,factory:()=>function jSe(){return new q_(Xr(cA))}(),providedIn:"root"})}return e})();function jq(e){return e.replace(/\/index.html$/,"")}let XO=(()=>{class e{transform(r){return JSON.stringify(r,null,2)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275pipe=gu({name:"json",type:e,pure:!1,standalone:!0})}return e})(),QO=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=kP({type:e});static#r=this.\u0275inj=yx({})}return e})();function oW(e){return"server"===e}class Fxe extends VSe{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class eF extends Fxe{static makeCurrent(){!function USe(e){Vq??=e}(new eF)}onAndCancel(t,r,n){return t.addEventListener(r,n),()=>{t.removeEventListener(r,n)}}dispatchEvent(t,r){t.dispatchEvent(r)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,r){return(r=r||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,r){return"window"===r?window:"document"===r?t:"body"===r?t.body:null}getBaseHref(t){const r=function Nxe(){return X_=X_||document.querySelector("base"),X_?X_.getAttribute("href"):null}();return null==r?null:function kxe(e){return new URL(e,document.baseURI).pathname}(r)}resetBaseElement(){X_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function PCe(e,t){t=encodeURIComponent(t);for(const r of e.split(";")){const n=r.indexOf("="),[a,i]=-1==n?[r,""]:[r.slice(0,n),r.slice(n+1)];if(a.trim()===t)return decodeURIComponent(i)}return null}(document.cookie,t)}}let X_=null,Lxe=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac})}return e})();const tF=new ur("");let lW=(()=>{class e{constructor(r,n){this._zone=n,this._eventNameToPlugin=new Map,r.forEach(a=>{a.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,n,a){return this._findPluginFor(n).addEventListener(r,n,a)}getZone(){return this._zone}_findPluginFor(r){let n=this._eventNameToPlugin.get(r);if(n)return n;if(n=this._plugins.find(i=>i.supports(r)),!n)throw new Ot(5101,!1);return this._eventNameToPlugin.set(r,n),n}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(tF),Xr(_a))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac})}return e})();class dW{constructor(t){this._doc=t}}const rF="ng-app-id";let fW=(()=>{class e{constructor(r,n,a,i={}){this.doc=r,this.appId=n,this.nonce=a,this.platformId=i,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=oW(i),this.resetHostNodes()}addStyles(r){for(const n of r)1===this.changeUsageCount(n,1)&&this.onStyleAdded(n)}removeStyles(r){for(const n of r)this.changeUsageCount(n,-1)<=0&&this.onStyleRemoved(n)}ngOnDestroy(){const r=this.styleNodesInDOM;r&&(r.forEach(n=>n.remove()),r.clear());for(const n of this.getAllStyles())this.onStyleRemoved(n);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(const n of this.getAllStyles())this.addStyleToHost(r,n)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(const n of this.hostNodes)this.addStyleToHost(n,r)}onStyleRemoved(r){const n=this.styleRef;n.get(r)?.elements?.forEach(a=>a.remove()),n.delete(r)}collectServerRenderedStyles(){const r=this.doc.head?.querySelectorAll(`style[${rF}="${this.appId}"]`);if(r?.length){const n=new Map;return r.forEach(a=>{null!=a.textContent&&n.set(a.textContent,a)}),n}return null}changeUsageCount(r,n){const a=this.styleRef;if(a.has(r)){const i=a.get(r);return i.usage+=n,i.usage}return a.set(r,{usage:n,elements:[]}),n}getStyleElement(r,n){const a=this.styleNodesInDOM,i=a?.get(n);if(i?.parentNode===r)return a.delete(n),i.removeAttribute(rF),i;{const o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=n,this.platformIsServer&&o.setAttribute(rF,this.appId),r.appendChild(o),o}}addStyleToHost(r,n){const a=this.getStyleElement(r,n),i=this.styleRef,o=i.get(n)?.elements;o?o.push(a):i.set(n,{elements:[a],usage:1})}resetHostNodes(){const r=this.hostNodes;r.clear(),r.add(this.doc.head)}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(Id),Xr(TM),Xr(qz,8),Xr(I0))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac})}return e})();const nF={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},aF=/%COMP%/g,Gxe=new ur("",{providedIn:"root",factory:()=>!0});function hW(e,t){return t.map(r=>r.replace(aF,e))}let mW=(()=>{class e{constructor(r,n,a,i,o,s,u,c=null){this.eventManager=r,this.sharedStylesHost=n,this.appId=a,this.removeStylesOnCompDestroy=i,this.doc=o,this.platformId=s,this.ngZone=u,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=oW(s),this.defaultRenderer=new iF(r,o,u,this.platformIsServer)}createRenderer(r,n){if(!r||!n)return this.defaultRenderer;this.platformIsServer&&n.encapsulation===El.ShadowDom&&(n={...n,encapsulation:El.Emulated});const a=this.getOrCreateRenderer(r,n);return a instanceof gW?a.applyToHost(r):a instanceof oF&&a.applyStyles(),a}getOrCreateRenderer(r,n){const a=this.rendererByCompId;let i=a.get(n.id);if(!i){const o=this.doc,s=this.ngZone,u=this.eventManager,c=this.sharedStylesHost,l=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(n.encapsulation){case El.Emulated:i=new gW(u,c,n,this.appId,l,o,s,d);break;case El.ShadowDom:return new Wxe(u,c,r,n,o,s,this.nonce,d);default:i=new oF(u,c,n,l,o,s,d)}a.set(n.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(lW),Xr(fW),Xr(TM),Xr(Gxe),Xr(Id),Xr(I0),Xr(_a),Xr(qz))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac})}return e})();class iF{constructor(t,r,n,a){this.eventManager=t,this.doc=r,this.ngZone=n,this.platformIsServer=a,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,r){return r?this.doc.createElementNS(nF[r]||r,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,r){(vW(t)?t.content:t).appendChild(r)}insertBefore(t,r,n){t&&(vW(t)?t.content:t).insertBefore(r,n)}removeChild(t,r){t&&t.removeChild(r)}selectRootElement(t,r){let n="string"==typeof t?this.doc.querySelector(t):t;if(!n)throw new Ot(-5104,!1);return r||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,r,n,a){if(a){r=a+":"+r;const i=nF[a];i?t.setAttributeNS(i,r,n):t.setAttribute(r,n)}else t.setAttribute(r,n)}removeAttribute(t,r,n){if(n){const a=nF[n];a?t.removeAttributeNS(a,r):t.removeAttribute(`${n}:${r}`)}else t.removeAttribute(r)}addClass(t,r){t.classList.add(r)}removeClass(t,r){t.classList.remove(r)}setStyle(t,r,n,a){a&(Dh.DashCase|Dh.Important)?t.style.setProperty(r,n,a&Dh.Important?"important":""):t.style[r]=n}removeStyle(t,r,n){n&Dh.DashCase?t.style.removeProperty(r):t.style[r]=""}setProperty(t,r,n){null!=t&&(t[r]=n)}setValue(t,r){t.nodeValue=r}listen(t,r,n){if("string"==typeof t&&!(t=cy().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${r}`);return this.eventManager.addEventListener(t,r,this.decoratePreventDefault(n))}decoratePreventDefault(t){return r=>{if("__ngUnwrap__"===r)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(r)):t(r))&&r.preventDefault()}}}function vW(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Wxe extends iF{constructor(t,r,n,a,i,o,s,u){super(t,i,o,u),this.sharedStylesHost=r,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=hW(a.id,a.styles);for(const l of c){const d=document.createElement("style");s&&d.setAttribute("nonce",s),d.textContent=l,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,r){return super.appendChild(this.nodeOrShadowRoot(t),r)}insertBefore(t,r,n){return super.insertBefore(this.nodeOrShadowRoot(t),r,n)}removeChild(t,r){return super.removeChild(this.nodeOrShadowRoot(t),r)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class oF extends iF{constructor(t,r,n,a,i,o,s,u){super(t,i,o,s),this.sharedStylesHost=r,this.removeStylesOnCompDestroy=a,this.styles=u?hW(u,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class gW extends oF{constructor(t,r,n,a,i,o,s,u){const c=a+"-"+n.id;super(t,r,n,i,o,s,u,c),this.contentAttr=function Hxe(e){return"_ngcontent-%COMP%".replace(aF,e)}(c),this.hostAttr=function jxe(e){return"_nghost-%COMP%".replace(aF,e)}(c)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,r){const n=super.createElement(t,r);return super.setAttribute(n,this.contentAttr,""),n}}let Yxe=(()=>{class e extends dW{constructor(r){super(r)}supports(r){return!0}addEventListener(r,n,a){return r.addEventListener(n,a,!1),()=>this.removeEventListener(r,n,a)}removeEventListener(r,n,a){return r.removeEventListener(n,a)}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(Id))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac})}return e})();const yW=["alt","control","meta","shift"],Xxe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Kxe={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Zxe=(()=>{class e extends dW{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,n,a){const i=e.parseEventName(n),o=e.eventCallback(i.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>cy().onAndCancel(r,i.domEventName,o))}static parseEventName(r){const n=r.toLowerCase().split("."),a=n.shift();if(0===n.length||"keydown"!==a&&"keyup"!==a)return null;const i=e._normalizeKey(n.pop());let o="",s=n.indexOf("code");if(s>-1&&(n.splice(s,1),o="code."),yW.forEach(c=>{const l=n.indexOf(c);l>-1&&(n.splice(l,1),o+=c+".")}),o+=i,0!=n.length||0===i.length)return null;const u={};return u.domEventName=a,u.fullKey=o,u}static matchEventFullKeyCode(r,n){let a=Xxe[r.key]||r.key,i="";return n.indexOf("code.")>-1&&(a=r.code,i="code."),!(null==a||!a)&&(a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),yW.forEach(o=>{o!==a&&(0,Kxe[o])(r)&&(i+=o+".")}),i+=a,i===n)}static eventCallback(r,n,a){return i=>{e.matchEventFullKeyCode(i,r)&&a.runGuarded(()=>n(i))}}static _normalizeKey(r){return"esc"===r?"escape":r}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(Id))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac})}return e})();function bW(e){return{appProviders:[...nwe,...e?.providers??[]],platformProviders:twe}}const twe=[{provide:I0,useValue:"browser"},{provide:jz,useValue:function $xe(){eF.makeCurrent()},multi:!0},{provide:Id,useFactory:function ewe(){return function Ume(e){AM=e}(document),document},deps:[]}],nwe=[{provide:bM,useValue:"root"},{provide:Vf,useFactory:function Jxe(){return new Vf},deps:[]},{provide:tF,useClass:Yxe,multi:!0,deps:[Id,_a,I0]},{provide:tF,useClass:Zxe,multi:!0,deps:[Id]},mW,fW,lW,{provide:WG,useExisting:mW},{provide:class dxe{},useClass:Lxe,deps:[]},[]];let awe=(()=>{class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(Id))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var sF=function(e,t){return(sF=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)};function qt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}sF(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var R=function(){return R=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++)for(var i in r=arguments[n])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},R.apply(this,arguments)};function ce(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(d){o(d)}}function u(l){try{c(n.throw(l))}catch(d){o(d)}}function c(l){l.done?i(l.value):function a(i){return i instanceof r?i:new r(function(o){o(i)})}(l.value).then(s,u)}c((n=n.apply(e,t||[])).next())})}function le(e,t){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return function u(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(r=0)),r;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,a=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(6===c[0]&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(l){c=[6,l],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function sr(e,t,r){if(r||2===arguments.length)for(var i,n=0,a=t.length;n<a;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function Nh(e){return this instanceof Nh?(this.v=e,this):new Nh(e)}function AW(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function cF(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(o){return new Promise(function(s,u){!function a(i,o,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},o)}(s,u,(o=e[i](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const TW=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function DW(e){return Va(e?.then)}function EW(e){return Va(e[_P])}function IW(e){return Symbol.asyncIterator&&Va(e?.[Symbol.asyncIterator])}function PW(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const MW=function Dwe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function RW(e){return Va(e?.[MW])}function OW(e){return function wW(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,n=r.apply(e,t||[]),i=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(f){n[f]&&(a[f]=function(p){return new Promise(function(h,m){i.push([f,p,h,m])>1||s(f,p)})})}function s(f,p){try{!function u(f){f.value instanceof Nh?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}(n[f](p))}catch(h){d(i[0][3],h)}}function c(f){s("next",f)}function l(f){s("throw",f)}function d(f,p){f(p),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function*(){const r=e.getReader();try{for(;;){const{value:n,done:a}=yield Nh(r.read());if(a)return yield Nh(void 0);yield yield Nh(n)}}finally{r.releaseLock()}})}function FW(e){return Va(e?.getReader)}function $u(e){if(e instanceof ko)return e;if(null!=e){if(EW(e))return function Ewe(e){return new ko(t=>{const r=e[_P]();if(Va(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(TW(e))return function Iwe(e){return new ko(t=>{for(let r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}(e);if(DW(e))return function Pwe(e){return new ko(t=>{e.then(r=>{t.closed||(t.next(r),t.complete())},r=>t.error(r)).then(null,c8)})}(e);if(IW(e))return NW(e);if(RW(e))return function Mwe(e){return new ko(t=>{for(const r of e)if(t.next(r),t.closed)return;t.complete()})}(e);if(FW(e))return function Rwe(e){return NW(OW(e))}(e)}throw PW(e)}function NW(e){return new ko(t=>{(function Owe(e,t){var r,n,a,i;return ce(this,void 0,void 0,function*(){try{for(r=AW(e);!(n=yield r.next()).done;)if(t.next(n.value),t.closed)return}catch(o){a={error:o}}finally{try{n&&!n.done&&(i=r.return)&&(yield i.call(r))}finally{if(a)throw a.error}}t.complete()})})(e,t).catch(r=>t.error(r))})}function Wf(e,t,r,n=0,a=!1){const i=t.schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!a)return i}function kW(e,t=0){return _i((r,n)=>{r.subscribe(Si(n,a=>Wf(n,e,()=>n.next(a),t),()=>Wf(n,e,()=>n.complete(),t),a=>Wf(n,e,()=>n.error(a),t)))})}function BW(e,t=0){return _i((r,n)=>{n.add(e.schedule(()=>r.subscribe(n),t))})}function LW(e,t){if(!e)throw new Error("Iterable cannot be null");return new ko(r=>{Wf(r,t,()=>{const n=e[Symbol.asyncIterator]();Wf(r,t,()=>{n.next().then(a=>{a.done?r.complete():r.next(a.value)})},0,!0)})})}function no(e,t){return t?function Uwe(e,t){if(null!=e){if(EW(e))return function Fwe(e,t){return $u(e).pipe(BW(t),kW(t))}(e,t);if(TW(e))return function kwe(e,t){return new ko(r=>{let n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}(e,t);if(DW(e))return function Nwe(e,t){return $u(e).pipe(BW(t),kW(t))}(e,t);if(IW(e))return LW(e,t);if(RW(e))return function Bwe(e,t){return new ko(r=>{let n;return Wf(r,t,()=>{n=e[MW](),Wf(r,t,()=>{let a,i;try{({value:a,done:i}=n.next())}catch(o){return void r.error(o)}i?r.complete():r.next(a)},0,!0)}),()=>Va(n?.return)&&n.return()})}(e,t);if(FW(e))return function Lwe(e,t){return LW(OW(e),t)}(e,t)}throw PW(e)}(e,t):$u(e)}function UW(e){return e&&Va(e.schedule)}function lF(e){return e[e.length-1]}function VW(e){return Va(lF(e))?e.pop():void 0}function Z_(e){return UW(lF(e))?e.pop():void 0}function Kr(...e){return no(e,Z_(e))}const xA=pP(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:zwe}=Array,{getPrototypeOf:Gwe,prototype:Hwe,keys:jwe}=Object;const{isArray:Ywe}=Array;function zW(e){return yr(t=>function Xwe(e,t){return Ywe(t)?e(...t):e(t)}(e,t))}function GW(...e){const t=Z_(e),r=VW(e),{args:n,keys:a}=function qwe(e){if(1===e.length){const t=e[0];if(zwe(t))return{args:t,keys:null};if(function Wwe(e){return e&&"object"==typeof e&&Gwe(e)===Hwe}(t)){const r=jwe(t);return{args:r.map(n=>t[n]),keys:r}}}return{args:e,keys:null}}(e);if(0===n.length)return no([],t);const i=new ko(HW(n,t,a?o=>function Kwe(e,t){return e.reduce((r,n,a)=>(r[n]=t[a],r),{})}(a,o):mh));return r?i.pipe(zW(r)):i}function HW(e,t,r=mh){return n=>{jW(t,()=>{const{length:a}=e,i=new Array(a);let o=a,s=a;for(let u=0;u<a;u++)jW(t,()=>{const c=no(e[u],t);let l=!1;c.subscribe(Si(n,d=>{i[u]=d,l||(l=!0,s--),s||n.next(r(i.slice()))},()=>{--o||n.complete()}))},n)},n)}}function jW(e,t,r){e?Wf(r,e,t):t()}function Ys(e,t,r=1/0){return Va(t)?Ys((n,a)=>yr((i,o)=>t(n,i,a,o))($u(e(n,a))),r):("number"==typeof t&&(r=t),_i((n,a)=>function Zwe(e,t,r,n,a,i,o,s){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&t.complete()},p=m=>c<n?h(m):u.push(m),h=m=>{i&&t.next(m),c++;let v=!1;$u(r(m,l++)).subscribe(Si(t,g=>{a?.(g),i?p(g):t.next(g)},()=>{v=!0},void 0,()=>{if(v)try{for(c--;u.length&&c<n;){const g=u.shift();o?Wf(t,o,()=>h(g)):h(g)}f()}catch(g){t.error(g)}}))};return e.subscribe(Si(t,p,()=>{d=!0,f()})),()=>{s?.()}}(n,a,e,r)))}function wA(e=1/0){return Ys(mh,e)}function dF(...e){return function Qwe(){return wA(1)}()(no(e,Z_(e)))}function qW(e){return new ko(t=>{$u(e()).subscribe(t)})}function AA(e,t){const r=Va(e)?e:()=>e,n=a=>a.error(r());return new ko(t?a=>t.schedule(n,0,a):n)}const Pd=new ko(e=>e.complete());function fF(){return _i((e,t)=>{let r=null;e._refCount++;const n=Si(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(r=null);const a=e._connection,i=r;r=null,a&&(!i||a===i)&&a.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(r=e.connect())})}class WW extends ko{constructor(t,r){super(),this.source=t,this.subjectFactory=r,this._subject=null,this._refCount=0,this._connection=null,h8(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Us;const r=this.getSubject();t.add(this.source.subscribe(Si(r,void 0,()=>{this._teardown(),r.complete()},n=>{this._teardown(),r.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Us.EMPTY)}return t}refCount(){return fF()(this)}}function Io(e,t){return _i((r,n)=>{let a=null,i=0,o=!1;const s=()=>o&&!a&&n.complete();r.subscribe(Si(n,u=>{a?.unsubscribe();let c=0;const l=i++;$u(e(u,l)).subscribe(a=Si(n,d=>n.next(t?t(u,d,l,c++):d),()=>{a=null,s()}))},()=>{o=!0,s()}))})}function yv(e){return e<=0?()=>Pd:_i((t,r)=>{let n=0;t.subscribe(Si(r,a=>{++n<=e&&(r.next(a),e<=n&&r.complete())}))})}function pF(...e){const t=Z_(e);return _i((r,n)=>{(t?dF(e,r,t):dF(e,r)).subscribe(n)})}function Yf(e,t){return _i((r,n)=>{let a=0;r.subscribe(Si(n,i=>e.call(t,i,a++)&&n.next(i)))})}function TA(e){return _i((t,r)=>{let n=!1;t.subscribe(Si(r,a=>{n=!0,r.next(a)},()=>{n||r.next(e),r.complete()}))})}function YW(e=Jwe){return _i((t,r)=>{let n=!1;t.subscribe(Si(r,a=>{n=!0,r.next(a)},()=>n?r.complete():r.error(e())))})}function Jwe(){return new xA}function bv(e,t){const r=arguments.length>=2;return n=>n.pipe(e?Yf((a,i)=>e(a,i,n)):mh,yv(1),r?TA(t):YW(()=>new xA))}function DA(e,t){return Va(t)?Ys(e,t,1):Ys(e,1)}function En(e,t,r){const n=Va(e)||t||r?{next:e,error:t,complete:r}:e;return n?_i((a,i)=>{var o;null===(o=n.subscribe)||void 0===o||o.call(n);let s=!0;a.subscribe(Si(i,u=>{var c;null===(c=n.next)||void 0===c||c.call(n,u),i.next(u)},()=>{var u;s=!1,null===(u=n.complete)||void 0===u||u.call(n),i.complete()},u=>{var c;s=!1,null===(c=n.error)||void 0===c||c.call(n,u),i.error(u)},()=>{var u,c;s&&(null===(u=n.unsubscribe)||void 0===u||u.call(n)),null===(c=n.finalize)||void 0===c||c.call(n)}))}):mh}function dy(e){return _i((t,r)=>{let i,n=null,a=!1;n=t.subscribe(Si(r,void 0,void 0,o=>{i=$u(e(o,dy(e)(t))),n?(n.unsubscribe(),n=null,i.subscribe(r)):a=!0})),a&&(n.unsubscribe(),n=null,i.subscribe(r))})}function hF(e){return e<=0?()=>Pd:_i((t,r)=>{let n=[];t.subscribe(Si(r,a=>{n.push(a),e<n.length&&n.shift()},()=>{for(const a of n)r.next(a);r.complete()},void 0,()=>{n=null}))})}function mF(e){return _i((t,r)=>{try{t.subscribe(r)}finally{r.add(e)}})}const on="primary",Q_=Symbol("RouteTitle");class iAe{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const r=this.params[t];return Array.isArray(r)?r[0]:r}return null}getAll(t){if(this.has(t)){const r=this.params[t];return Array.isArray(r)?r:[r]}return[]}get keys(){return Object.keys(this.params)}}function fy(e){return new iAe(e)}function oAe(e,t,r){const n=r.path.split("/");if(n.length>e.length||"full"===r.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const a={};for(let i=0;i<n.length;i++){const o=n[i],s=e[i];if(o.startsWith(":"))a[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,n.length),posParams:a}}function Md(e,t){const r=e?vF(e):void 0,n=t?vF(t):void 0;if(!r||!n||r.length!=n.length)return!1;let a;for(let i=0;i<r.length;i++)if(a=r[i],!XW(e[a],t[a]))return!1;return!0}function vF(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function XW(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const r=[...e].sort(),n=[...t].sort();return r.every((a,i)=>n[i]===a)}return e===t}function KW(e){return e.length>0?e[e.length-1]:null}function kh(e){return function uwe(e){return!!e&&(e instanceof ko||Va(e.lift)&&Va(e.subscribe))}(e)?e:Hw(e)?no(Promise.resolve(e)):Kr(e)}const uAe={exact:function $W(e,t,r){if(!_v(e.segments,t.segments)||!EA(e.segments,t.segments,r)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!$W(e.children[n],t.children[n],r))return!1;return!0},subset:JW},ZW={exact:function cAe(e,t){return Md(e,t)},subset:function lAe(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(r=>XW(e[r],t[r]))},ignored:()=>!0};function QW(e,t,r){return uAe[r.paths](e.root,t.root,r.matrixParams)&&ZW[r.queryParams](e.queryParams,t.queryParams)&&!("exact"===r.fragment&&e.fragment!==t.fragment)}function JW(e,t,r){return eY(e,t,t.segments,r)}function eY(e,t,r,n){if(e.segments.length>r.length){const a=e.segments.slice(0,r.length);return!(!_v(a,r)||t.hasChildren()||!EA(a,r,n))}if(e.segments.length===r.length){if(!_v(e.segments,r)||!EA(e.segments,r,n))return!1;for(const a in t.children)if(!e.children[a]||!JW(e.children[a],t.children[a],n))return!1;return!0}{const a=r.slice(0,e.segments.length),i=r.slice(e.segments.length);return!!(_v(e.segments,a)&&EA(e.segments,a,n)&&e.children[on])&&eY(e.children[on],t,i,n)}}function EA(e,t,r){return t.every((n,a)=>ZW[r](e[a].parameters,n.parameters))}class py{constructor(t=new Sa([],{}),r={},n=null){this.root=t,this.queryParams=r,this.fragment=n}get queryParamMap(){return this._queryParamMap??=fy(this.queryParams),this._queryParamMap}toString(){return pAe.serialize(this)}}class Sa{constructor(t,r){this.segments=t,this.children=r,this.parent=null,Object.values(r).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return IA(this)}}class $_{constructor(t,r){this.path=t,this.parameters=r}get parameterMap(){return this._parameterMap??=fy(this.parameters),this._parameterMap}toString(){return nY(this)}}function _v(e,t){return e.length===t.length&&e.every((r,n)=>r.path===t[n].path)}let hy=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>new gF,providedIn:"root"})}return e})();class gF{parse(t){const r=new wAe(t);return new py(r.parseRootSegment(),r.parseQueryParams(),r.parseFragment())}serialize(t){const r=`/${J_(t.root,!0)}`,n=function vAe(e){const t=Object.entries(e).map(([r,n])=>Array.isArray(n)?n.map(a=>`${PA(r)}=${PA(a)}`).join("&"):`${PA(r)}=${PA(n)}`).filter(r=>r);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${r}${n}${"string"==typeof t.fragment?`#${function hAe(e){return encodeURI(e)}(t.fragment)}`:""}`}}const pAe=new gF;function IA(e){return e.segments.map(t=>nY(t)).join("/")}function J_(e,t){if(!e.hasChildren())return IA(e);if(t){const r=e.children[on]?J_(e.children[on],!1):"",n=[];return Object.entries(e.children).forEach(([a,i])=>{a!==on&&n.push(`${a}:${J_(i,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=function fAe(e,t){let r=[];return Object.entries(e.children).forEach(([n,a])=>{n===on&&(r=r.concat(t(a,n)))}),Object.entries(e.children).forEach(([n,a])=>{n!==on&&(r=r.concat(t(a,n)))}),r}(e,(n,a)=>a===on?[J_(e.children[on],!1)]:[`${a}:${J_(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[on]?`${IA(e)}/${r[0]}`:`${IA(e)}/(${r.join("//")})`}}function tY(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function PA(e){return tY(e).replace(/%3B/gi,";")}function yF(e){return tY(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function MA(e){return decodeURIComponent(e)}function rY(e){return MA(e.replace(/\+/g,"%20"))}function nY(e){return`${yF(e.path)}${function mAe(e){return Object.entries(e).map(([t,r])=>`;${yF(t)}=${yF(r)}`).join("")}(e.parameters)}`}const gAe=/^[^\/()?;#]+/;function bF(e){const t=e.match(gAe);return t?t[0]:""}const yAe=/^[^\/()?;=#]+/,_Ae=/^[^=?&#]+/,CAe=/^[^&#]+/;class wAe{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Sa([],{}):new Sa([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let r={};this.peekStartsWith("/(")&&(this.capture("/"),r=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(r).length>0)&&(n[on]=new Sa(t,r)),n}parseSegment(){const t=bF(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Ot(4009,!1);return this.capture(t),new $_(MA(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const r=function bAe(e){const t=e.match(yAe);return t?t[0]:""}(this.remaining);if(!r)return;this.capture(r);let n="";if(this.consumeOptional("=")){const a=bF(this.remaining);a&&(n=a,this.capture(n))}t[MA(r)]=MA(n)}parseQueryParam(t){const r=function SAe(e){const t=e.match(_Ae);return t?t[0]:""}(this.remaining);if(!r)return;this.capture(r);let n="";if(this.consumeOptional("=")){const o=function xAe(e){const t=e.match(CAe);return t?t[0]:""}(this.remaining);o&&(n=o,this.capture(n))}const a=rY(r),i=rY(n);if(t.hasOwnProperty(a)){let o=t[a];Array.isArray(o)||(o=[o],t[a]=o),o.push(i)}else t[a]=i}parseParens(t){const r={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=bF(this.remaining),a=this.remaining[n.length];if("/"!==a&&")"!==a&&";"!==a)throw new Ot(4010,!1);let i;n.indexOf(":")>-1?(i=n.slice(0,n.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=on);const o=this.parseChildren();r[i]=1===Object.keys(o).length?o[on]:new Sa([],o),this.consumeOptional("//")}return r}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Ot(4011,!1)}}function aY(e){return e.segments.length>0?new Sa([],{[on]:e}):e}function iY(e){const t={};for(const[n,a]of Object.entries(e.children)){const i=iY(a);if(n===on&&0===i.segments.length&&i.hasChildren())for(const[o,s]of Object.entries(i.children))t[o]=s;else(i.segments.length>0||i.hasChildren())&&(t[n]=i)}return function AAe(e){if(1===e.numberOfChildren&&e.children[on]){const t=e.children[on];return new Sa(e.segments.concat(t.segments),t.children)}return e}(new Sa(e.segments,t))}function my(e){return e instanceof py}function oY(e){let t;const n=function r(i){const o={};for(const u of i.children){const c=r(u);o[u.outlet]=c}const s=new Sa(i.url,o);return i===e&&(t=s),s}(e.root),a=aY(n);return t??a}function sY(e,t,r,n){let a=e;for(;a.parent;)a=a.parent;if(0===t.length)return _F(a,a,a,r,n);const i=function DAe(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new cY(!0,0,e);let t=0,r=!1;const n=e.reduce((a,i,o)=>{if("object"==typeof i&&null!=i){if(i.outlets){const s={};return Object.entries(i.outlets).forEach(([u,c])=>{s[u]="string"==typeof c?c.split("/"):c}),[...a,{outlets:s}]}if(i.segmentPath)return[...a,i.segmentPath]}return"string"!=typeof i?[...a,i]:0===o?(i.split("/").forEach((s,u)=>{0==u&&"."===s||(0==u&&""===s?r=!0:".."===s?t++:""!=s&&a.push(s))}),a):[...a,i]},[]);return new cY(r,t,n)}(t);if(i.toRoot())return _F(a,a,new Sa([],{}),r,n);const o=function EAe(e,t,r){if(e.isAbsolute)return new OA(t,!0,0);if(!r)return new OA(t,!1,NaN);if(null===r.parent)return new OA(r,!0,0);const n=RA(e.commands[0])?0:1;return function IAe(e,t,r){let n=e,a=t,i=r;for(;i>a;){if(i-=a,n=n.parent,!n)throw new Ot(4005,!1);a=n.segments.length}return new OA(n,!1,a-i)}(r,r.segments.length-1+n,e.numberOfDoubleDots)}(i,a,e),s=o.processChildren?t2(o.segmentGroup,o.index,i.commands):lY(o.segmentGroup,o.index,i.commands);return _F(a,o.segmentGroup,s,r,n)}function RA(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function e2(e){return"object"==typeof e&&null!=e&&e.outlets}function _F(e,t,r,n,a){let o,i={};n&&Object.entries(n).forEach(([u,c])=>{i[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`}),o=e===t?r:uY(e,t,r);const s=aY(iY(o));return new py(s,i,a)}function uY(e,t,r){const n={};return Object.entries(e.children).forEach(([a,i])=>{n[a]=i===t?r:uY(i,t,r)}),new Sa(e.segments,n)}class cY{constructor(t,r,n){if(this.isAbsolute=t,this.numberOfDoubleDots=r,this.commands=n,t&&n.length>0&&RA(n[0]))throw new Ot(4003,!1);const a=n.find(e2);if(a&&a!==KW(n))throw new Ot(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class OA{constructor(t,r,n){this.segmentGroup=t,this.processChildren=r,this.index=n}}function lY(e,t,r){if(e??=new Sa([],{}),0===e.segments.length&&e.hasChildren())return t2(e,t,r);const n=function MAe(e,t,r){let n=0,a=t;const i={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(n>=r.length)return i;const o=e.segments[a],s=r[n];if(e2(s))break;const u=`${s}`,c=n<r.length-1?r[n+1]:null;if(a>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!fY(u,c,o))return i;n+=2}else{if(!fY(u,{},o))return i;n++}a++}return{match:!0,pathIndex:a,commandIndex:n}}(e,t,r),a=r.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const i=new Sa(e.segments.slice(0,n.pathIndex),{});return i.children[on]=new Sa(e.segments.slice(n.pathIndex),e.children),t2(i,0,a)}return n.match&&0===a.length?new Sa(e.segments,{}):n.match&&!e.hasChildren()?SF(e,t,r):n.match?t2(e,0,a):SF(e,t,r)}function t2(e,t,r){if(0===r.length)return new Sa(e.segments,{});{const n=function PAe(e){return e2(e[0])?e[0].outlets:{[on]:e}}(r),a={};if(Object.keys(n).some(i=>i!==on)&&e.children[on]&&1===e.numberOfChildren&&0===e.children[on].segments.length){const i=t2(e.children[on],t,r);return new Sa(e.segments,i.children)}return Object.entries(n).forEach(([i,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(a[i]=lY(e.children[i],t,o))}),Object.entries(e.children).forEach(([i,o])=>{void 0===n[i]&&(a[i]=o)}),new Sa(e.segments,a)}}function SF(e,t,r){const n=e.segments.slice(0,t);let a=0;for(;a<r.length;){const i=r[a];if(e2(i)){const u=RAe(i.outlets);return new Sa(n,u)}if(0===a&&RA(r[0])){n.push(new $_(e.segments[t].path,dY(r[0]))),a++;continue}const o=e2(i)?i.outlets[on]:`${i}`,s=a<r.length-1?r[a+1]:null;o&&s&&RA(s)?(n.push(new $_(o,dY(s))),a+=2):(n.push(new $_(o,{})),a++)}return new Sa(n,{})}function RAe(e){const t={};return Object.entries(e).forEach(([r,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=SF(new Sa([],{}),0,n))}),t}function dY(e){const t={};return Object.entries(e).forEach(([r,n])=>t[r]=`${n}`),t}function fY(e,t,r){return e==r.path&&Md(t,r.parameters)}const r2="imperative";var In=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(In||{});class Rd{constructor(t,r){this.id=t,this.url=r}}class CF extends Rd{constructor(t,r,n="imperative",a=null){super(t,r),this.type=In.NavigationStart,this.navigationTrigger=n,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Sv extends Rd{constructor(t,r,n){super(t,r),this.urlAfterRedirects=n,this.type=In.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Mc=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Mc||{}),xF=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(xF||{});class vy extends Rd{constructor(t,r,n,a){super(t,r),this.reason=n,this.code=a,this.type=In.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class n2 extends Rd{constructor(t,r,n,a){super(t,r),this.reason=n,this.code=a,this.type=In.NavigationSkipped}}class FA extends Rd{constructor(t,r,n,a){super(t,r),this.error=n,this.target=a,this.type=In.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class pY extends Rd{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=In.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class OAe extends Rd{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=In.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class FAe extends Rd{constructor(t,r,n,a,i){super(t,r),this.urlAfterRedirects=n,this.state=a,this.shouldActivate=i,this.type=In.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class NAe extends Rd{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=In.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class kAe extends Rd{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=In.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class BAe{constructor(t){this.route=t,this.type=In.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class LAe{constructor(t){this.route=t,this.type=In.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class UAe{constructor(t){this.snapshot=t,this.type=In.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class VAe{constructor(t){this.snapshot=t,this.type=In.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class zAe{constructor(t){this.snapshot=t,this.type=In.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GAe{constructor(t){this.snapshot=t,this.type=In.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wF{}class AF{constructor(t){this.url=t}}class HAe{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new a2,this.attachRef=null}}let a2=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,n){const a=this.getOrCreateContext(r);a.outlet=n,this.contexts.set(r,a)}onChildOutletDestroyed(r){const n=this.getContext(r);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let n=this.getContext(r);return n||(n=new HAe,this.contexts.set(r,n)),n}getContext(r){return this.contexts.get(r)||null}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class hY{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const r=this.pathFromRoot(t);return r.length>1?r[r.length-2]:null}children(t){const r=TF(t,this._root);return r?r.children.map(n=>n.value):[]}firstChild(t){const r=TF(t,this._root);return r&&r.children.length>0?r.children[0].value:null}siblings(t){const r=DF(t,this._root);return r.length<2?[]:r[r.length-2].children.map(a=>a.value).filter(a=>a!==t)}pathFromRoot(t){return DF(t,this._root).map(r=>r.value)}}function TF(e,t){if(e===t.value)return t;for(const r of t.children){const n=TF(e,r);if(n)return n}return null}function DF(e,t){if(e===t.value)return[t];for(const r of t.children){const n=DF(e,r);if(n.length)return n.unshift(t),n}return[]}class Vl{constructor(t,r){this.value=t,this.children=r}toString(){return`TreeNode(${this.value})`}}function gy(e){const t={};return e&&e.children.forEach(r=>t[r.value.outlet]=r),t}class mY extends hY{constructor(t,r){super(t),this.snapshot=r,PF(this,t)}toString(){return this.snapshot.toString()}}function vY(e){const t=function jAe(e){const i=new IF([],{},{},"",{},on,e,null,{});return new gY("",new Vl(i,[]))}(e),r=new Li([new $_("",{})]),n=new Li({}),a=new Li({}),i=new Li({}),o=new Li(""),s=new yy(r,n,i,o,a,on,e,t.root);return s.snapshot=t.root,new mY(new Vl(s,[]),t)}class yy{constructor(t,r,n,a,i,o,s,u){this.urlSubject=t,this.paramsSubject=r,this.queryParamsSubject=n,this.fragmentSubject=a,this.dataSubject=i,this.outlet=o,this.component=s,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(yr(c=>c[Q_]))??Kr(void 0),this.url=t,this.params=r,this.queryParams=n,this.fragment=a,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(yr(t=>fy(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(yr(t=>fy(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function EF(e,t,r="emptyOnly"){let n;const{routeConfig:a}=e;return n=null===t||"always"!==r&&""!==a?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.data,...a?.data,...e._resolvedData}},a&&bY(a)&&(n.resolve[Q_]=a.title),n}class IF{get title(){return this.data?.[Q_]}constructor(t,r,n,a,i,o,s,u,c){this.url=t,this.params=r,this.queryParams=n,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=fy(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=fy(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class gY extends hY{constructor(t,r){super(r),this.url=t,PF(this,r)}toString(){return yY(this._root)}}function PF(e,t){t.value._routerState=e,t.children.forEach(r=>PF(e,r))}function yY(e){const t=e.children.length>0?` { ${e.children.map(yY).join(", ")} } `:"";return`${e.value}${t}`}function MF(e){if(e.snapshot){const t=e.snapshot,r=e._futureSnapshot;e.snapshot=r,Md(t.queryParams,r.queryParams)||e.queryParamsSubject.next(r.queryParams),t.fragment!==r.fragment&&e.fragmentSubject.next(r.fragment),Md(t.params,r.params)||e.paramsSubject.next(r.params),function sAe(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!Md(e[r],t[r]))return!1;return!0}(t.url,r.url)||e.urlSubject.next(r.url),Md(t.data,r.data)||e.dataSubject.next(r.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function RF(e,t){const r=Md(e.params,t.params)&&function dAe(e,t){return _v(e,t)&&e.every((r,n)=>Md(r.parameters,t[n].parameters))}(e.url,t.url);return r&&!(!e.parent!=!t.parent)&&(!e.parent||RF(e.parent,t.parent))}function bY(e){return"string"==typeof e.title||null===e.title}let OF=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=on,this.activateEvents=new ts,this.deactivateEvents=new ts,this.attachEvents=new ts,this.detachEvents=new ts,this.parentContexts=Gt(a2),this.location=Gt(Nl),this.changeDetector=Gt(xw),this.environmentInjector=Gt(Fl),this.inputBinder=Gt(NA,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){const{firstChange:n,previousValue:a}=r.name;if(n)return;this.isTrackedInParentContexts(a)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(a)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ot(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ot(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ot(4012,!1);this.location.detach();const r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,n){this.activated=r,this._activatedRoute=n,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){const r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,n){if(this.isActivated)throw new Ot(4013,!1);this._activatedRoute=r;const a=this.location,o=r.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new qAe(r,s,a.injector);this.activated=a.createComponent(o,{index:a.length,injector:u,environmentInjector:n??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275dir=Vs({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Sh]})}return e})();class qAe{constructor(t,r,n){this.route=t,this.childContexts=r,this.parent=n}get(t,r){return t===yy?this.route:t===a2?this.childContexts:this.parent.get(t,r)}}const NA=new ur("");function i2(e,t,r){if(r&&e.shouldReuseRoute(t.value,r.value.snapshot)){const n=r.value;n._futureSnapshot=t.value;const a=function YAe(e,t,r){return t.children.map(n=>{for(const a of r.children)if(e.shouldReuseRoute(n.value,a.value.snapshot))return i2(e,n,a);return i2(e,n)})}(e,t,r);return new Vl(n,a)}{if(e.shouldAttach(t.value)){const i=e.retrieve(t.value);if(null!==i){const o=i.route;return o.value._futureSnapshot=t.value,o.children=t.children.map(s=>i2(e,s)),o}}const n=function XAe(e){return new yy(new Li(e.url),new Li(e.params),new Li(e.queryParams),new Li(e.fragment),new Li(e.data),e.outlet,e.component,e)}(t.value),a=t.children.map(i=>i2(e,i));return new Vl(n,a)}}const SY="ngNavigationCancelingError";function CY(e,t){const{redirectTo:r,navigationBehaviorOptions:n}=my(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,a=xY(!1,Mc.Redirect);return a.url=r,a.navigationBehaviorOptions=n,a}function xY(e,t){const r=new Error(`NavigationCancelingError: ${e||""}`);return r[SY]=!0,r.cancellationCode=t,r}function wY(e){return!!e&&e[SY]}let AY=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=yh({type:e,selectors:[["ng-component"]],standalone:!0,features:[hv],decls:1,vars:0,template:function(n,a){1&n&&Zu(0,"router-outlet")},dependencies:[OF],encapsulation:2})}return e})();function FF(e){const t=e.children&&e.children.map(FF),r=t?{...e,children:t}:{...e};return!r.component&&!r.loadComponent&&(t||r.loadChildren)&&r.outlet&&r.outlet!==on&&(r.component=AY),r}function Od(e){return e.outlet||on}function o2(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const r=t.routeConfig;if(r?._loadedInjector)return r._loadedInjector;if(r?._injector)return r._injector}return null}class rTe{constructor(t,r,n,a,i){this.routeReuseStrategy=t,this.futureState=r,this.currState=n,this.forwardEvent=a,this.inputBindingEnabled=i}activate(t){const r=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(r,n,t),MF(this.futureState.root),this.activateChildRoutes(r,n,t)}deactivateChildRoutes(t,r,n){const a=gy(r);t.children.forEach(i=>{const o=i.value.outlet;this.deactivateRoutes(i,a[o],n),delete a[o]}),Object.values(a).forEach(i=>{this.deactivateRouteAndItsChildren(i,n)})}deactivateRoutes(t,r,n){const a=t.value,i=r?r.value:null;if(a===i)if(a.component){const o=n.getContext(a.outlet);o&&this.deactivateChildRoutes(t,r,o.children)}else this.deactivateChildRoutes(t,r,n);else i&&this.deactivateRouteAndItsChildren(r,n)}deactivateRouteAndItsChildren(t,r){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,r):this.deactivateRouteAndOutlet(t,r)}detachAndStoreRouteSubtree(t,r){const n=r.getContext(t.value.outlet),a=n&&t.value.component?n.children:r,i=gy(t);for(const o of Object.values(i))this.deactivateRouteAndItsChildren(o,a);if(n&&n.outlet){const o=n.outlet.detach(),s=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:o,route:t,contexts:s})}}deactivateRouteAndOutlet(t,r){const n=r.getContext(t.value.outlet),a=n&&t.value.component?n.children:r,i=gy(t);for(const o of Object.values(i))this.deactivateRouteAndItsChildren(o,a);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,r,n){const a=gy(r);t.children.forEach(i=>{this.activateRoutes(i,a[i.value.outlet],n),this.forwardEvent(new GAe(i.value.snapshot))}),t.children.length&&this.forwardEvent(new VAe(t.value.snapshot))}activateRoutes(t,r,n){const a=t.value,i=r?r.value:null;if(MF(a),a===i)if(a.component){const o=n.getOrCreateContext(a.outlet);this.activateChildRoutes(t,r,o.children)}else this.activateChildRoutes(t,r,n);else if(a.component){const o=n.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const s=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),MF(s.route.value),this.activateChildRoutes(t,null,o.children)}else{const s=o2(a.snapshot);o.attachRef=null,o.route=a,o.injector=s,o.outlet&&o.outlet.activateWith(a,o.injector),this.activateChildRoutes(t,null,o.children)}}else this.activateChildRoutes(t,null,n)}}class TY{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class kA{constructor(t,r){this.component=t,this.route=r}}function nTe(e,t,r){const n=e._root;return s2(n,t?t._root:null,r,[n.value])}function by(e,t){const r=Symbol(),n=t.get(e,r);return n===r?"function"!=typeof e||function kpe(e){return null!==bx(e)}(e)?t.get(e):e:n}function s2(e,t,r,n,a={canDeactivateChecks:[],canActivateChecks:[]}){const i=gy(t);return e.children.forEach(o=>{(function iTe(e,t,r,n,a={canDeactivateChecks:[],canActivateChecks:[]}){const i=e.value,o=t?t.value:null,s=r?r.getContext(e.value.outlet):null;if(o&&i.routeConfig===o.routeConfig){const u=function oTe(e,t,r){if("function"==typeof r)return r(e,t);switch(r){case"pathParamsChange":return!_v(e.url,t.url);case"pathParamsOrQueryParamsChange":return!_v(e.url,t.url)||!Md(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!RF(e,t)||!Md(e.queryParams,t.queryParams);default:return!RF(e,t)}}(o,i,i.routeConfig.runGuardsAndResolvers);u?a.canActivateChecks.push(new TY(n)):(i.data=o.data,i._resolvedData=o._resolvedData),s2(e,t,i.component?s?s.children:null:r,n,a),u&&s&&s.outlet&&s.outlet.isActivated&&a.canDeactivateChecks.push(new kA(s.outlet.component,o))}else o&&u2(t,s,a),a.canActivateChecks.push(new TY(n)),s2(e,null,i.component?s?s.children:null:r,n,a)})(o,i[o.value.outlet],r,n.concat([o.value]),a),delete i[o.value.outlet]}),Object.entries(i).forEach(([o,s])=>u2(s,r.getContext(o),a)),a}function u2(e,t,r){const n=gy(e),a=e.value;Object.entries(n).forEach(([i,o])=>{u2(o,a.component?t?t.children.getContext(i):null:t,r)}),r.canDeactivateChecks.push(new kA(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}function c2(e){return"function"==typeof e}function DY(e){return e instanceof xA||"EmptyError"===e?.name}const BA=Symbol("INITIAL_VALUE");function _y(){return Io(e=>GW(e.map(t=>t.pipe(yv(1),pF(BA)))).pipe(yr(t=>{for(const r of t)if(!0!==r){if(r===BA)return BA;if(!1===r||r instanceof py)return r}return!0}),Yf(t=>t!==BA),yv(1)))}function EY(e){return l8(En(t=>{if(my(t))throw CY(0,t)}),yr(t=>!0===t))}class NF{constructor(t){this.segmentGroup=t||null}}class kF extends Error{constructor(t){super(),this.urlTree=t}}function Sy(e){return AA(new NF(e))}class ATe{constructor(t,r){this.urlSerializer=t,this.urlTree=r}lineralizeSegments(t,r){let n=[],a=r.root;for(;;){if(n=n.concat(a.segments),0===a.numberOfChildren)return Kr(n);if(a.numberOfChildren>1||!a.children[on])return AA(new Ot(4e3,!1));a=a.children[on]}}applyRedirectCommands(t,r,n){const a=this.applyRedirectCreateUrlTree(r,this.urlSerializer.parse(r),t,n);if(r.startsWith("/"))throw new kF(a);return a}applyRedirectCreateUrlTree(t,r,n,a){const i=this.createSegmentGroup(t,r.root,n,a);return new py(i,this.createQueryParams(r.queryParams,this.urlTree.queryParams),r.fragment)}createQueryParams(t,r){const n={};return Object.entries(t).forEach(([a,i])=>{if("string"==typeof i&&i.startsWith(":")){const s=i.substring(1);n[a]=r[s]}else n[a]=i}),n}createSegmentGroup(t,r,n,a){const i=this.createSegments(t,r.segments,n,a);let o={};return Object.entries(r.children).forEach(([s,u])=>{o[s]=this.createSegmentGroup(t,u,n,a)}),new Sa(i,o)}createSegments(t,r,n,a){return r.map(i=>i.path.startsWith(":")?this.findPosParam(t,i,a):this.findOrReturn(i,n))}findPosParam(t,r,n){const a=n[r.path.substring(1)];if(!a)throw new Ot(4001,!1);return a}findOrReturn(t,r){let n=0;for(const a of r){if(a.path===t.path)return r.splice(n),a;n++}return t}}const BF={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function TTe(e,t,r,n,a){const i=LF(e,t,r);return i.matched?(n=function ZAe(e,t){return e.providers&&!e._injector&&(e._injector=Tj(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,n),function CTe(e,t,r,n){const a=t.canMatch;return a&&0!==a.length?Kr(a.map(o=>{const s=by(o,e);return kh(function fTe(e){return e&&c2(e.canMatch)}(s)?s.canMatch(t,r):E0(e,()=>s(t,r)))})).pipe(_y(),EY()):Kr(!0)}(n,t,r).pipe(yr(o=>!0===o?i:{...BF}))):Kr(i)}function LF(e,t,r){if("**"===t.path)return function DTe(e){return{matched:!0,parameters:e.length>0?KW(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(r);if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||r.length>0)?{...BF}:{matched:!0,consumedSegments:[],remainingSegments:r,parameters:{},positionalParamSegments:{}};const a=(t.matcher||oAe)(r,e,t);if(!a)return{...BF};const i={};Object.entries(a.posParams??{}).forEach(([s,u])=>{i[s]=u.path});const o=a.consumed.length>0?{...i,...a.consumed[a.consumed.length-1].parameters}:i;return{matched:!0,consumedSegments:a.consumed,remainingSegments:r.slice(a.consumed.length),parameters:o,positionalParamSegments:a.posParams??{}}}function IY(e,t,r,n){return r.length>0&&function PTe(e,t,r){return r.some(n=>LA(e,t,n)&&Od(n)!==on)}(e,r,n)?{segmentGroup:new Sa(t,ITe(n,new Sa(r,e.children))),slicedSegments:[]}:0===r.length&&function MTe(e,t,r){return r.some(n=>LA(e,t,n))}(e,r,n)?{segmentGroup:new Sa(e.segments,ETe(e,r,n,e.children)),slicedSegments:r}:{segmentGroup:new Sa(e.segments,e.children),slicedSegments:r}}function ETe(e,t,r,n){const a={};for(const i of r)if(LA(e,t,i)&&!n[Od(i)]){const o=new Sa([],{});a[Od(i)]=o}return{...n,...a}}function ITe(e,t){const r={};r[on]=t;for(const n of e)if(""===n.path&&Od(n)!==on){const a=new Sa([],{});r[Od(n)]=a}return r}function LA(e,t,r){return(!(e.hasChildren()||t.length>0)||"full"!==r.pathMatch)&&""===r.path}class FTe{}class BTe{constructor(t,r,n,a,i,o,s){this.injector=t,this.configLoader=r,this.rootComponentType=n,this.config=a,this.urlTree=i,this.paramsInheritanceStrategy=o,this.urlSerializer=s,this.applyRedirects=new ATe(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new Ot(4002,`'${t.segmentGroup}'`)}recognize(){const t=IY(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(yr(r=>{const n=new IF([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},on,this.rootComponentType,null,{}),a=new Vl(n,r),i=new gY("",a),o=function TAe(e,t,r=null,n=null){return sY(oY(e),t,r,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(i._root,null),{state:i,tree:o}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,on).pipe(dy(n=>{if(n instanceof kF)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof NF?this.noMatchError(n):n}))}inheritParamsAndData(t,r){const n=t.value,a=EF(n,r,this.paramsInheritanceStrategy);n.params=Object.freeze(a.params),n.data=Object.freeze(a.data),t.children.forEach(i=>this.inheritParamsAndData(i,n))}processSegmentGroup(t,r,n,a){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,r,n):this.processSegment(t,r,n,n.segments,a,!0).pipe(yr(i=>i instanceof Vl?[i]:[]))}processChildren(t,r,n){const a=[];for(const i of Object.keys(n.children))"primary"===i?a.unshift(i):a.push(i);return no(a).pipe(DA(i=>{const o=n.children[i],s=function eTe(e,t){const r=e.filter(n=>Od(n)===t);return r.push(...e.filter(n=>Od(n)!==t)),r}(r,i);return this.processSegmentGroup(t,s,o,i)}),function tAe(e,t){return _i(function eAe(e,t,r,n,a){return(i,o)=>{let s=r,u=t,c=0;i.subscribe(Si(o,l=>{const d=c++;u=s?e(u,l,d):(s=!0,l),n&&o.next(u)},a&&(()=>{s&&o.next(u),o.complete()})))}}(e,t,arguments.length>=2,!0))}((i,o)=>(i.push(...o),i)),TA(null),function rAe(e,t){const r=arguments.length>=2;return n=>n.pipe(e?Yf((a,i)=>e(a,i,n)):mh,hF(1),r?TA(t):YW(()=>new xA))}(),Ys(i=>{if(null===i)return Sy(n);const o=PY(i);return function LTe(e){e.sort((t,r)=>t.value.outlet===on?-1:r.value.outlet===on?1:t.value.outlet.localeCompare(r.value.outlet))}(o),Kr(o)}))}processSegment(t,r,n,a,i,o){return no(r).pipe(DA(s=>this.processSegmentAgainstRoute(s._injector??t,r,s,n,a,i,o).pipe(dy(u=>{if(u instanceof NF)return Kr(null);throw u}))),bv(s=>!!s),dy(s=>{if(DY(s))return function OTe(e,t,r){return 0===t.length&&!e.children[r]}(n,a,i)?Kr(new FTe):Sy(n);throw s}))}processSegmentAgainstRoute(t,r,n,a,i,o,s){return function RTe(e,t,r,n){return!!(Od(e)===n||n!==on&&LA(t,r,e))&&LF(t,e,r).matched}(n,a,i,o)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,a,n,i,o):this.allowRedirects&&s?this.expandSegmentAgainstRouteUsingRedirect(t,a,r,n,i,o):Sy(a):Sy(a)}expandSegmentAgainstRouteUsingRedirect(t,r,n,a,i,o){const{matched:s,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=LF(r,a,i);if(!s)return Sy(r);a.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const d=this.applyRedirects.applyRedirectCommands(u,a.redirectTo,c);return this.applyRedirects.lineralizeSegments(a,d).pipe(Ys(f=>this.processSegment(t,n,r,f.concat(l),o,!1)))}matchSegmentAgainstRoute(t,r,n,a,i){const o=TTe(r,n,a,t);return"**"===n.path&&(r.children={}),o.pipe(Io(s=>s.matched?this.getChildConfig(t=n._injector??t,n,a).pipe(Io(({routes:u})=>{const c=n._loadedInjector??t,{consumedSegments:l,remainingSegments:d,parameters:f}=s,p=new IF(l,f,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function VTe(e){return e.data||{}}(n),Od(n),n.component??n._loadedComponent??null,n,function zTe(e){return e.resolve||{}}(n)),{segmentGroup:h,slicedSegments:m}=IY(r,l,d,u);if(0===m.length&&h.hasChildren())return this.processChildren(c,u,h).pipe(yr(g=>null===g?null:new Vl(p,g)));if(0===u.length&&0===m.length)return Kr(new Vl(p,[]));const v=Od(n)===i;return this.processSegment(c,u,h,m,v?on:i,!0).pipe(yr(g=>new Vl(p,g instanceof Vl?[g]:[])))})):Sy(r)))}getChildConfig(t,r,n){return r.children?Kr({routes:r.children,injector:t}):r.loadChildren?void 0!==r._loadedRoutes?Kr({routes:r._loadedRoutes,injector:r._loadedInjector}):function STe(e,t,r,n){const a=t.canLoad;return void 0===a||0===a.length?Kr(!0):Kr(a.map(o=>{const s=by(o,e);return kh(function uTe(e){return e&&c2(e.canLoad)}(s)?s.canLoad(t,r):E0(e,()=>s(t,r)))})).pipe(_y(),EY())}(t,r,n).pipe(Ys(a=>a?this.configLoader.loadChildren(t,r).pipe(En(i=>{r._loadedRoutes=i.routes,r._loadedInjector=i.injector})):function wTe(e){return AA(xY(!1,Mc.GuardRejected))}())):Kr({routes:[],injector:t})}}function UTe(e){const t=e.value.routeConfig;return t&&""===t.path}function PY(e){const t=[],r=new Set;for(const n of e){if(!UTe(n)){t.push(n);continue}const a=t.find(i=>n.value.routeConfig===i.value.routeConfig);void 0!==a?(a.children.push(...n.children),r.add(a)):t.push(n)}for(const n of r){const a=PY(n.children);t.push(new Vl(n.value,a))}return t.filter(n=>!r.has(n))}function MY(e){const t=e.children.map(r=>MY(r)).flat();return[e,...t]}function UF(e){return Io(t=>{const r=e(t);return r?no(r).pipe(yr(()=>t)):Kr(t)})}let RY=(()=>{class e{buildTitle(r){let n,a=r.root;for(;void 0!==a;)n=this.getResolvedTitleForRoute(a)??n,a=a.children.find(i=>i.outlet===on);return n}getResolvedTitleForRoute(r){return r.data[Q_]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>Gt(YTe),providedIn:"root"})}return e})(),YTe=(()=>{class e extends RY{constructor(r){super(),this.title=r}updateTitle(r){const n=this.buildTitle(r);void 0!==n&&this.title.setTitle(n)}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(awe))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const l2=new ur("",{providedIn:"root",factory:()=>({})}),UA=new ur("");let OY=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Gt(b2e)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return Kr(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);const n=kh(r.loadComponent()).pipe(yr(FY),En(i=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=i}),mF(()=>{this.componentLoaders.delete(r)})),a=new WW(n,()=>new Cn).pipe(fF());return this.componentLoaders.set(r,a),a}loadChildren(r,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Kr({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);const i=function XTe(e,t,r,n){return kh(e.loadChildren()).pipe(yr(FY),Ys(a=>a instanceof wj||Array.isArray(a)?Kr(a):no(t.compileModuleAsync(a))),yr(a=>{n&&n(e);let i,o,s=!1;return Array.isArray(a)?(o=a,!0):(i=a.create(r).injector,o=i.get(UA,[],{optional:!0,self:!0}).flat()),{routes:o.map(FF),injector:i}}))}(n,this.compiler,r,this.onLoadEndListener).pipe(mF(()=>{this.childrenLoaders.delete(n)})),o=new WW(i,()=>new Cn).pipe(fF());return this.childrenLoaders.set(n,o),o}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function FY(e){return function KTe(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let VF=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>Gt(ZTe),providedIn:"root"})}return e})(),ZTe=(()=>{class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,n){return r}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const NY=new ur("");let VA=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Cn,this.transitionAbortSubject=new Cn,this.configLoader=Gt(OY),this.environmentInjector=Gt(Fl),this.urlSerializer=Gt(hy),this.rootContexts=Gt(a2),this.location=Gt(q_),this.inputBindingEnabled=null!==Gt(NA,{optional:!0}),this.titleStrategy=Gt(RY),this.options=Gt(l2,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Gt(VF),this.createViewTransition=Gt(NY,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Kr(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=a=>this.events.next(new LAe(a)),this.configLoader.onLoadStartListener=a=>this.events.next(new BAe(a))}complete(){this.transitions?.complete()}handleNavigationRequest(r){const n=++this.navigationId;this.transitions?.next({...this.transitions.value,...r,id:n})}setupNavigations(r,n,a){return this.transitions=new Li({id:0,currentUrlTree:n,currentRawUrl:n,extractedUrl:this.urlHandlingStrategy.extract(n),urlAfterRedirects:this.urlHandlingStrategy.extract(n),rawUrl:n,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:r2,restoredState:null,currentSnapshot:a.snapshot,targetSnapshot:null,currentRouterState:a,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Yf(i=>0!==i.id),yr(i=>({...i,extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),Io(i=>{this.currentTransition=i;let o=!1,s=!1;return Kr(i).pipe(En(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Io(u=>{const c=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!c&&"reload"!==(u.extras.onSameUrlNavigation??r.onSameUrlNavigation)){const d="";return this.events.next(new n2(u.id,this.urlSerializer.serialize(u.rawUrl),d,xF.IgnoredSameUrlNavigation)),u.resolve(null),Pd}if(this.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return Kr(u).pipe(Io(d=>{const f=this.transitions?.getValue();return this.events.next(new CF(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?Pd:Promise.resolve(d)}),function GTe(e,t,r,n,a,i){return Ys(o=>function NTe(e,t,r,n,a,i,o="emptyOnly"){return new BTe(e,t,r,n,a,o,i).recognize()}(e,t,r,n,o.extractedUrl,a,i).pipe(yr(({state:s,tree:u})=>({...o,targetSnapshot:s,urlAfterRedirects:u}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),En(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:d.urlAfterRedirects};const f=new pY(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){const{id:d,extractedUrl:f,source:p,restoredState:h,extras:m}=u,v=new CF(d,this.urlSerializer.serialize(f),p,h);this.events.next(v);const g=vY(this.rootComponentType).snapshot;return this.currentTransition=i={...u,targetSnapshot:g,urlAfterRedirects:f,extras:{...m,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=f,Kr(i)}{const d="";return this.events.next(new n2(u.id,this.urlSerializer.serialize(u.extractedUrl),d,xF.IgnoredByUrlHandlingStrategy)),u.resolve(null),Pd}}),En(u=>{const c=new OAe(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(c)}),yr(u=>(this.currentTransition=i={...u,guards:nTe(u.targetSnapshot,u.currentSnapshot,this.rootContexts)},i)),function pTe(e,t){return Ys(r=>{const{targetSnapshot:n,currentSnapshot:a,guards:{canActivateChecks:i,canDeactivateChecks:o}}=r;return 0===o.length&&0===i.length?Kr({...r,guardsResult:!0}):function hTe(e,t,r,n){return no(e).pipe(Ys(a=>function _Te(e,t,r,n,a){const i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return i&&0!==i.length?Kr(i.map(s=>{const u=o2(t)??a,c=by(s,u);return kh(function dTe(e){return e&&c2(e.canDeactivate)}(c)?c.canDeactivate(e,t,r,n):E0(u,()=>c(e,t,r,n))).pipe(bv())})).pipe(_y()):Kr(!0)}(a.component,a.route,r,t,n)),bv(a=>!0!==a,!0))}(o,n,a,e).pipe(Ys(s=>s&&function sTe(e){return"boolean"==typeof e}(s)?function mTe(e,t,r,n){return no(t).pipe(DA(a=>dF(function gTe(e,t){return null!==e&&t&&t(new UAe(e)),Kr(!0)}(a.route.parent,n),function vTe(e,t){return null!==e&&t&&t(new zAe(e)),Kr(!0)}(a.route,n),function bTe(e,t,r){const n=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(o=>function aTe(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(o)).filter(o=>null!==o).map(o=>qW(()=>Kr(o.guards.map(u=>{const c=o2(o.node)??r,l=by(u,c);return kh(function lTe(e){return e&&c2(e.canActivateChild)}(l)?l.canActivateChild(n,e):E0(c,()=>l(n,e))).pipe(bv())})).pipe(_y())));return Kr(i).pipe(_y())}(e,a.path,r),function yTe(e,t,r){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return Kr(!0);const a=n.map(i=>qW(()=>{const o=o2(t)??r,s=by(i,o);return kh(function cTe(e){return e&&c2(e.canActivate)}(s)?s.canActivate(t,e):E0(o,()=>s(t,e))).pipe(bv())}));return Kr(a).pipe(_y())}(e,a.route,r))),bv(a=>!0!==a,!0))}(n,i,e,t):Kr(s)),yr(s=>({...r,guardsResult:s})))})}(this.environmentInjector,u=>this.events.next(u)),En(u=>{if(i.guardsResult=u.guardsResult,my(u.guardsResult))throw CY(0,u.guardsResult);const c=new FAe(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(c)}),Yf(u=>!!u.guardsResult||(this.cancelNavigationTransition(u,"",Mc.GuardRejected),!1)),UF(u=>{if(u.guards.canActivateChecks.length)return Kr(u).pipe(En(c=>{const l=new NAe(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),Io(c=>{let l=!1;return Kr(c).pipe(function HTe(e,t){return Ys(r=>{const{targetSnapshot:n,guards:{canActivateChecks:a}}=r;if(!a.length)return Kr(r);const i=new Set(a.map(u=>u.route)),o=new Set;for(const u of i)if(!o.has(u))for(const c of MY(u))o.add(c);let s=0;return no(o).pipe(DA(u=>i.has(u)?function jTe(e,t,r,n){const a=e.routeConfig,i=e._resolve;return void 0!==a?.title&&!bY(a)&&(i[Q_]=a.title),function qTe(e,t,r,n){const a=vF(e);if(0===a.length)return Kr({});const i={};return no(a).pipe(Ys(o=>function WTe(e,t,r,n){const a=o2(t)??n,i=by(e,a);return kh(i.resolve?i.resolve(t,r):E0(a,()=>i(t,r)))}(e[o],t,r,n).pipe(bv(),En(s=>{i[o]=s}))),hF(1),function nAe(e){return yr(()=>e)}(i),dy(o=>DY(o)?Pd:AA(o)))}(i,e,t,n).pipe(yr(o=>(e._resolvedData=o,e.data=EF(e,e.parent,r).resolve,null)))}(u,n,e,t):(u.data=EF(u,u.parent,e).resolve,Kr(void 0))),En(()=>s++),hF(1),Ys(u=>s===o.size?Kr(r):Pd))})}(this.paramsInheritanceStrategy,this.environmentInjector),En({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(c,"",Mc.NoDataFromResolver)}}))}),En(c=>{const l=new kAe(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}))}),UF(u=>{const c=l=>{const d=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(l.routeConfig).pipe(En(f=>{l.component=f}),yr(()=>{})));for(const f of l.children)d.push(...c(f));return d};return GW(c(u.targetSnapshot.root)).pipe(TA(null),yv(1))}),UF(()=>this.afterPreactivation()),Io(()=>{const{currentSnapshot:u,targetSnapshot:c}=i,l=this.createViewTransition?.(this.environmentInjector,u.root,c.root);return l?no(l).pipe(yr(()=>i)):Kr(i)}),yr(u=>{const c=function WAe(e,t,r){const n=i2(e,t._root,r?r._root:void 0);return new mY(n,t)}(r.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=i={...u,targetRouterState:c},this.currentNavigation.targetRouterState=c,i}),En(()=>{this.events.next(new wF)}),((e,t,r,n)=>yr(a=>(new rTe(t,a.targetRouterState,a.currentRouterState,r,n).activate(e),a)))(this.rootContexts,r.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),yv(1),En({next:u=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Sv(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),this.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{o=!0}}),function aAe(e){return _i((t,r)=>{$u(e).subscribe(Si(r,()=>r.complete(),mP)),!r.closed&&t.subscribe(r)})}(this.transitionAbortSubject.pipe(En(u=>{throw u}))),mF(()=>{!o&&!s&&this.cancelNavigationTransition(i,"",Mc.SupersededByNewNavigation),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),dy(u=>{if(s=!0,wY(u))this.events.next(new vy(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode)),function KAe(e){return wY(e)&&my(e.url)}(u)?this.events.next(new AF(u.url)):i.resolve(!1);else{this.events.next(new FA(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0));try{i.resolve(r.errorHandler(u))}catch(c){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(c)}}return Pd}))}))}cancelNavigationTransition(r,n,a){const i=new vy(r.id,this.urlSerializer.serialize(r.extractedUrl),n,a);this.events.next(i),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function JTe(e){return e!==r2}let eDe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>Gt(rDe),providedIn:"root"})}return e})();class tDe{shouldDetach(t){return!1}store(t,r){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,r){return t.routeConfig===r.routeConfig}}let rDe=(()=>{class e extends tDe{static#e=this.\u0275fac=(()=>{let r;return function(a){return(r||(r=sM(e)))(a||e)}})();static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),BY=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:()=>Gt(nDe),providedIn:"root"})}return e})(),nDe=(()=>{class e extends BY{constructor(){super(...arguments),this.location=Gt(q_),this.urlSerializer=Gt(hy),this.options=Gt(l2,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Gt(VF),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new py,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=vY(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(n=>{"popstate"===n.type&&r(n.url,n.state)})}handleRouterEvent(r,n){if(r instanceof CF)this.stateMemento=this.createStateMemento();else if(r instanceof n2)this.rawUrlTree=n.initialUrl;else if(r instanceof pY){if("eager"===this.urlUpdateStrategy&&!n.extras.skipLocationChange){const a=this.urlHandlingStrategy.merge(n.finalUrl,n.initialUrl);this.setBrowserUrl(a,n)}}else r instanceof wF?(this.currentUrlTree=n.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(n.finalUrl,n.initialUrl),this.routerState=n.targetRouterState,"deferred"===this.urlUpdateStrategy&&(n.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,n))):r instanceof vy&&(r.code===Mc.GuardRejected||r.code===Mc.NoDataFromResolver)?this.restoreHistory(n):r instanceof FA?this.restoreHistory(n,!0):r instanceof Sv&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,n){const a=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(a)||n.extras.replaceUrl){const o={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId)};this.location.replaceState(a,"",o)}else{const i={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId+1)};this.location.go(a,"",i)}}restoreHistory(r,n=!1){if("computed"===this.canceledNavigationResolution){const i=this.currentPageId-this.browserPageId;0!==i?this.location.historyGo(i):this.currentUrlTree===r.finalUrl&&0===i&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,n){return"computed"===this.canceledNavigationResolution?{navigationId:r,\u0275routerPageId:n}:{navigationId:r}}static#e=this.\u0275fac=(()=>{let r;return function(a){return(r||(r=sM(e)))(a||e)}})();static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var d2=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(d2||{});function aDe(e){throw e}const iDe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},oDe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Xf=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Gt(tq),this.stateManager=Gt(BY),this.options=Gt(l2,{optional:!0})||{},this.pendingTasks=Gt(Qw),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Gt(VA),this.urlSerializer=Gt(hy),this.location=Gt(q_),this.urlHandlingStrategy=Gt(VF),this._events=new Cn,this.errorHandler=this.options.errorHandler||aDe,this.navigated=!1,this.routeReuseStrategy=Gt(eDe),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Gt(UA,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Gt(NA,{optional:!0}),this.eventsSubscription=new Us,this.isNgZoneEnabled=Gt(_a)instanceof _a&&_a.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const r=this.navigationTransitions.events.subscribe(n=>{try{const a=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(null!==a&&null!==i)if(this.stateManager.handleRouterEvent(n,i),n instanceof vy&&n.code!==Mc.Redirect&&n.code!==Mc.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof Sv)this.navigated=!0;else if(n instanceof AF){const o=this.urlHandlingStrategy.merge(n.url,a.currentRawUrl),s={info:a.extras.info,skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||JTe(a.source)};this.scheduleNavigation(o,r2,null,s,{resolve:a.resolve,reject:a.reject,promise:a.promise})}(function uDe(e){return!(e instanceof wF||e instanceof AF)})(n)&&this._events.next(n)}catch(a){this.navigationTransitions.transitionAbortSubject.next(a)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),r2,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,n)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",n)},0)})}navigateToSyncWithBrowser(r,n,a){const i={replaceUrl:!0},o=a?.navigationId?a:null;if(a){const u={...a};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(i.state=u)}const s=this.parseUrl(r);this.scheduleNavigation(s,n,o,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(FF),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,n={}){const{relativeTo:a,queryParams:i,fragment:o,queryParamsHandling:s,preserveFragment:u}=n,c=u?this.currentUrlTree.fragment:o;let d,l=null;switch(s){case"merge":l={...this.currentUrlTree.queryParams,...i};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}null!==l&&(l=this.removeEmptyProps(l));try{d=oY(a?a.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof r[0]||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return sY(d,r,l,c??null)}navigateByUrl(r,n={skipLocationChange:!1}){const a=my(r)?r:this.parseUrl(r),i=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(i,r2,null,n)}navigate(r,n={skipLocationChange:!1}){return function sDe(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Ot(4008,!1)}(r),this.navigateByUrl(this.createUrlTree(r,n),n)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,n){let a;if(a=!0===n?{...iDe}:!1===n?{...oDe}:n,my(r))return QW(this.currentUrlTree,r,a);const i=this.parseUrl(r);return QW(this.currentUrlTree,i,a)}removeEmptyProps(r){return Object.entries(r).reduce((n,[a,i])=>(null!=i&&(n[a]=i),n),{})}scheduleNavigation(r,n,a,i,o){if(this.disposed)return Promise.resolve(!1);let s,u,c;o?(s=o.resolve,u=o.reject,c=o.promise):c=new Promise((d,f)=>{s=d,u=f});const l=this.pendingTasks.add();return function LY(e,t){e.events.pipe(Yf(r=>r instanceof Sv||r instanceof vy||r instanceof FA||r instanceof n2),yr(r=>r instanceof Sv||r instanceof n2?d2.COMPLETE:r instanceof vy&&(r.code===Mc.Redirect||r.code===Mc.SupersededByNewNavigation)?d2.REDIRECTING:d2.FAILED),Yf(r=>r!==d2.REDIRECTING),yv(1)).subscribe(()=>{t()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(l))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const GF=new ur("");function VY(e){return e.routerState.root}function zY(){const e=Gt(Tc);return t=>{const r=e.get(mv);if(t!==r.components[0])return;const n=e.get(Xf),a=e.get(GY);1===e.get(HF)&&n.initialNavigation(),e.get(HY,null,vn.Optional)?.setUpPreloading(),e.get(GF,null,vn.Optional)?.init(),n.resetRootComponentType(r.componentTypes[0]),a.closed||(a.next(),a.complete(),a.unsubscribe())}}const GY=new ur("",{factory:()=>new Cn}),HF=new ur("",{providedIn:"root",factory:()=>1}),HY=new ur(""),jF={now:()=>(jF.delegate||Date).now(),delegate:void 0};class Kf extends Cn{constructor(t=1/0,r=1/0,n=jF){super(),this._bufferSize=t,this._windowTime=r,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=r===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,r)}next(t){const{isStopped:r,_buffer:n,_infiniteTimeWindow:a,_timestampProvider:i,_windowTime:o}=this;r||(n.push(t),!a&&n.push(i.now()+o)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const r=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:a}=this,i=a.slice();for(let o=0;o<i.length&&!t.closed;o+=n?1:2)t.next(i[o]);return this._checkFinalizedStatuses(t),r}_trimBuffer(){const{_bufferSize:t,_timestampProvider:r,_buffer:n,_infiniteTimeWindow:a}=this,i=(a?1:2)*t;if(t<1/0&&i<n.length&&n.splice(0,n.length-i),!a){const o=r.now();let s=0;for(let u=1;u<n.length&&n[u]<=o;u+=2)s=u;s&&n.splice(0,s+1)}}}function qF(e,t,...r){if(!0===t)return void e();if(!1===t)return;const n=new k1({next:()=>{n.unsubscribe(),e()}});return $u(t(...r)).subscribe(n)}function Cv(e,t,r){let n,a=!1;return e&&"object"==typeof e?({bufferSize:n=1/0,windowTime:t=1/0,refCount:a=!1,scheduler:r}=e):n=e??1/0,function gDe(e={}){const{connector:t=(()=>new Cn),resetOnError:r=!0,resetOnComplete:n=!0,resetOnRefCountZero:a=!0}=e;return i=>{let o,s,u,c=0,l=!1,d=!1;const f=()=>{s?.unsubscribe(),s=void 0},p=()=>{f(),o=u=void 0,l=d=!1},h=()=>{const m=o;p(),m?.unsubscribe()};return _i((m,v)=>{c++,!d&&!l&&f();const g=u=u??t();v.add(()=>{c--,0===c&&!d&&!l&&(s=qF(h,a))}),g.subscribe(v),!o&&c>0&&(o=new k1({next:y=>g.next(y),error:y=>{d=!0,f(),s=qF(p,r,y),g.error(y)},complete:()=>{l=!0,f(),s=qF(p,n),g.complete()}}),$u(m).subscribe(o))})(i)}}({connector:()=>new Kf(n,t,r),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}const{isArray:yDe}=Array;function bDe(e){return 1===e.length&&yDe(e[0])?e[0]:e}function qY(...e){const t=VW(e);return t?l8(qY(...e),zW(t)):_i((r,n)=>{HW([r,...bDe(e)])(n)})}function WF(...e){return qY(...e)}var rs,e,sn;(e=rs||(rs={})).create=function t(a){return a},e.has=function r(a,i){return 0!=(a&i)},e.hasAll=function n(a,i){return!!i&&(a&i)===i},function(e){e.create=function t(_){return void 0===_&&(_=512),{current:[],offset:0,capacity:_,chunks:[]}},e.getString=function r(_){return _.chunks.length?(_.offset>0&&(_.chunks[_.chunks.length]=_.current.length===_.offset?_.current.join(""):_.current.slice(0,_.offset).join("")),_.chunks.join("")):_.current.length===_.offset?_.current.join(""):_.current.splice(0,_.offset).join("")},e.getSize=function n(_){for(var C=0,x=0,A=_.chunks;x<A.length;x++)C+=A[x].length;for(var w=0;w<_.offset;w++)C+=_.current[w].length;return C},e.getChunks=function a(_){return _.offset>0&&(_.chunks[_.chunks.length]=_.current.length===_.offset?_.current.join(""):_.current.slice(0,_.offset).join(""),_.offset=0),_.chunks};var i=[];function s(_,C){C>0&&l(_,i[C])}function l(_,C){_.offset===_.capacity&&(_.chunks[_.chunks.length]=_.current.join(""),_.offset=0),_.current[_.offset++]=C}!function(){for(var _="",C=0;C<512;C++)i[C]=_,_+=" "}(),e.newline=function o(_){l(_,"\n")},e.whitespace=s,e.whitespace1=function u(_){l(_," ")},e.write=function c(_,C){C&&(_.offset===_.capacity&&(_.chunks[_.chunks.length]=_.current.join(""),_.offset=0),_.current[_.offset++]=C)},e.writeSafe=l,e.writePadLeft=function d(_,C,x){C?(s(_,x-C.length),l(_,C)):s(_,x)},e.writePadRight=function f(_,C,x){if(C){var A=x-C.length;l(_,C),s(_,A)}else s(_,x)},e.writeInteger=function p(_,C){l(_,""+C)},e.writeIntegerAndSpace=function h(_,C){l(_,C+" ")},e.writeIntegerPadLeft=function m(_,C,x){var A=""+C;s(_,x-A.length),l(_,A)},e.writeIntegerPadRight=function v(_,C,x){var A=""+C,T=x-A.length;l(_,A),s(_,T)},e.writeFloat=function g(_,C,x){l(_,""+Math.round(x*C)/x)},e.writeFloatPadLeft=function y(_,C,x,A){var T=""+Math.round(x*C)/x;s(_,A-T.length),l(_,T)},e.writeFloatPadRight=function b(_,C,x,A){var T=""+Math.round(x*C)/x,w=A-T.length;l(_,T),s(_,w)}}(sn||(sn={}));var Gn,WY,f2,da=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}return typeof process<"u"&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function YF(e,t){if(void 0===t&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/36e5),n=Math.floor(e/6e4%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&"0"===i[i.length-1];)i=i.substr(0,i.length-1);return r>0?"".concat(r,"h").concat(n,"m").concat(a,".").concat(i,"s"):n>0?"".concat(n,"m").concat(a,".").concat(i,"s"):a>0?"".concat(a,".").concat(i,"s"):"".concat(e.toFixed(0),"ms")}function _De(e,t){return e-t}function ms(e,t){void 0===e&&(e=0),void 0===t&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}!function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];e.create22=function n(){for(var o=+new Date+da(),s=0;s<16;s++)r[s]=String.fromCharCode((o+255*Math.random())%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},e.createv4=function a(){var o=+new Date+da();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var c=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===u?c:3&c|8).toString(16)})},e.is=function i(o){return"string"==typeof o}}(Gn||(Gn={})),function(e){var t=function(){function p(){this.size=0}return p.prototype.has=function(h){return!1},p.prototype.forEach=function(h,m){return m},p}(),r=function(){function p(h){this.idx=h,this.size=1}return p.prototype.has=function(h){return h===this.idx},p.prototype.forEach=function(h,m){return h(this.idx,m),m},p}(),n=function(){function p(h,m){this.mask=h,this.size=m,this.length=h.length}return p.prototype.has=function(h){return h<this.length&&!!this.mask[h]},p.prototype._forEach=function(h,m){for(var v=0;v<this.length;v++)this.mask[v]&&h(v,m)},p.prototype.forEach=function(h,m){return this._forEach(h,m),m},p}(),a=function(){function p(h){this.size=h}return p.prototype.has=function(h){return!0},p.prototype._forEach=function(h,m){for(var v=0;v<this.size;v++)h(v,m)},p.prototype.forEach=function(h,m){return this._forEach(h,m),m},p}(),i=function(){function p(h){this.set=h,this._flat=void 0,this.size=h.size}return p.prototype.has=function(h){return this.set.has(h)},p.prototype._forEach=function(h,m){for(var v=0,g=this.flatten();v<g.length;v++)h(g[v],m)},p.prototype.flatten=function(){if(this._flat)return this._flat;var h=new Int32Array(this.size),m=0;return this.set.forEach(function(v){return h[m++]=v}),function SDe(e){Array.prototype.sort.call(e,_De)}(h),this._flat=h,this._flat},p.prototype.forEach=function(h,m){return this._forEach(h,m),m},p}();function s(p){return new i(p)}function l(p,h){return new n(p,h)}e.always=function o(p){return new a(p)},e.never=new t,e.ofSet=s,e.singleton=function u(p){return new r(p)},e.ofUniqueIndices=function c(p){var h=p.length;if(0===h)return new t;if(1===h)return new r(p[0]);for(var m=0,v=0,g=p;v<g.length;v++)(y=g[v])>m&&(m=y);if(h===m)return new a(h);if(h/m<1/12){for(var _=new Set,C=0,x=p;C<x.length;C++)_.add(y=x[C]);return new i(_)}for(var A=new Int8Array(m+1),T=0,w=p;T<w.length;T++){var y;A[y=w[T]]=1}return new n(A,p.length)},e.ofMask=l,e.hasAny=function d(p,h){for(var m=0,v=h;m<v.length;m++)if(p.has(v[m]))return!0;return!1},e.complement=function f(p,h){var m=0,v=0;if(h.forEach(function(b){p.has(b)||(m++,b>v&&(v=b))}),m/v<1/12){var g=new Set;return h.forEach(function(b){p.has(b)||g.add(b)}),s(g)}var y=new Uint8Array(v+1);return h.forEach(function(b){p.has(b)||(y[b]=1)}),l(y,m)}}(WY||(WY={})),function(e){e.create=function t(n){return{ref:n}},e.set=function r(n,a){return n.ref=a,n}}(f2||(f2={}));var Bh,O,CDe=ms(0,2147483647);!function(e){e.create=function t(n,a){return{id:CDe(),version:0,value:n,metadata:a}},e.withValue=function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}}(Bh||(Bh={})),function(e){function r(i,o){return f2.set(i,Bh.withValue(i.ref,o))}e.create=function t(i,o){return f2.create(Bh.create(i,o))},e.update=r,e.set=function n(i,o){return f2.set(i,o)},e.updateIfChanged=function a(i,o){return i.ref.value!==o?r(i,o):i}}(O||(O={}));var Cy=function(){};function Xs(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var zA=Object.prototype.hasOwnProperty;function Nd(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!Nd(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&"object"==typeof e&&"object"==typeof t){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,c=t instanceof RegExp;if(u&&c)return e.toString()===t.toString();if(u!==c)return!1;for(a=0;a<i.length;a++)if(!zA.call(t,i[a]))return!1;for(a=0;a<i.length;a++)if(!Nd(e[i[a]],t[i[a]]))return!1;return!0}return!1}function p2(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?function xDe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}(e,t):r===n&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&GA(e,t)}function GA(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!zA.call(e,i)||e[i]!==t[i])return!1}return!0}function Po(e,t){return void 0!==e?e:t}function xy(e,t){return{start:t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,end:t&&typeof t.end<"u"?Math.min(t.end,e):e}}function h2(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=xy(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function Bo(e,t,r){var n=h2(e,r);return function EDe(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}(t,n.array,n.start)}function XF(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT}function HA(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=xy(a,t),u=s.start,c=s.end;return 0===u&&c===a?e:new r(n,i+o*u,Math.min(a,c-u))}var gn=1e-6;function ia(e,t,r){return Math.abs(e-t)<=r}function ao(e,t,r){return Math.max(t,Math.min(r,e))}function oa(e,t,r){return e+(t-e)*r}function jA(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a;return(2*t-2*r+o+s)*(a*u)+(-3*t+3*r-2*o-s)*u+o*a+t}function QF(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function KY(e,t,r){return(r=function ZF(e){return ao(e,0,1)}(function KF(e,t,r){return(e-t)/(r-t)}(r,e,t)))*r*(3-2*r)}var $F=isFinite;function S(){return S.zero()}!function(e){function t(){var oe=[.1,0,0];return oe[0]=0,oe}function l(oe,be,Se){var Qe=t();return Qe[0]=oe,Qe[1]=be,Qe[2]=Se,Qe}function p(oe,be){return oe[0]=be[0],oe[1]=be[1],oe[2]=be[2],oe}function h(oe,be,Se){return oe[0]=be[0]+Se[0],oe[1]=be[1]+Se[1],oe[2]=be[2]+Se[2],oe}function m(oe,be,Se){return oe[0]=be[0]-Se[0],oe[1]=be[1]-Se[1],oe[2]=be[2]-Se[2],oe}function y(oe,be,Se){return oe[0]=be[0]*Se,oe[1]=be[1]*Se,oe[2]=be[2]*Se,oe}function b(oe,be,Se,Qe){return oe[0]=be[0]+Se[0]*Qe,oe[1]=be[1]+Se[1]*Qe,oe[2]=be[2]+Se[2]*Qe,oe}function G(oe){var be=oe[0],Se=oe[1],Qe=oe[2];return be*be+Se*Se+Qe*Qe}function Q(oe,be){return oe[0]=-be[0],oe[1]=-be[1],oe[2]=-be[2],oe}function K(oe,be){var Se=be[0],Qe=be[1],Et=be[2],At=Se*Se+Qe*Qe+Et*Et;return At>0&&(At=1/Math.sqrt(At),oe[0]=be[0]*At,oe[1]=be[1]*At,oe[2]=be[2]*At),oe}function ne(oe,be){return oe[0]*be[0]+oe[1]*be[1]+oe[2]*be[2]}function X(oe,be,Se){var Qe=be[0],Et=be[1],At=be[2],Zt=Se[0],Ir=Se[1],rr=Se[2];return oe[0]=Et*rr-At*Ir,oe[1]=At*Zt-Qe*rr,oe[2]=Qe*Ir-Et*Zt,oe}e.zero=t,e.clone=function r(oe){var be=t();return be[0]=oe[0],be[1]=oe[1],be[2]=oe[2],be},e.isFinite=function n(oe){return $F(oe[0])&&$F(oe[1])&&$F(oe[2])},e.hasNaN=function a(oe){return isNaN(oe[0])||isNaN(oe[1])||isNaN(oe[2])},e.setNaN=function i(oe){return oe[0]=NaN,oe[1]=NaN,oe[2]=NaN,oe},e.fromObj=function o(oe){return l(oe.x,oe.y,oe.z)},e.toObj=function s(oe){return{x:oe[0],y:oe[1],z:oe[2]}},e.fromArray=function u(oe,be,Se){return oe[0]=be[Se+0],oe[1]=be[Se+1],oe[2]=be[Se+2],oe},e.toArray=function c(oe,be,Se){return be[Se+0]=oe[0],be[Se+1]=oe[1],be[Se+2]=oe[2],be},e.create=l,e.ofArray=function d(oe){var be=t();return be[0]=oe[0],be[1]=oe[1],be[2]=oe[2],be},e.set=function f(oe,be,Se,Qe){return oe[0]=be,oe[1]=Se,oe[2]=Qe,oe},e.copy=p,e.add=h,e.sub=m,e.mul=function v(oe,be,Se){return oe[0]=be[0]*Se[0],oe[1]=be[1]*Se[1],oe[2]=be[2]*Se[2],oe},e.div=function g(oe,be,Se){return oe[0]=be[0]/Se[0],oe[1]=be[1]/Se[1],oe[2]=be[2]/Se[2],oe},e.scale=y,e.scaleAndAdd=b,e.scaleAndSub=function _(oe,be,Se,Qe){return oe[0]=be[0]-Se[0]*Qe,oe[1]=be[1]-Se[1]*Qe,oe[2]=be[2]-Se[2]*Qe,oe},e.addScalar=function C(oe,be,Se){return oe[0]=be[0]+Se,oe[1]=be[1]+Se,oe[2]=be[2]+Se,oe},e.subScalar=function x(oe,be,Se){return oe[0]=be[0]-Se,oe[1]=be[1]-Se,oe[2]=be[2]-Se,oe},e.round=function A(oe,be){return oe[0]=Math.round(be[0]),oe[1]=Math.round(be[1]),oe[2]=Math.round(be[2]),oe},e.ceil=function T(oe,be){return oe[0]=Math.ceil(be[0]),oe[1]=Math.ceil(be[1]),oe[2]=Math.ceil(be[2]),oe},e.floor=function w(oe,be){return oe[0]=Math.floor(be[0]),oe[1]=Math.floor(be[1]),oe[2]=Math.floor(be[2]),oe},e.trunc=function E(oe,be){return oe[0]=Math.trunc(be[0]),oe[1]=Math.trunc(be[1]),oe[2]=Math.trunc(be[2]),oe},e.abs=function I(oe,be){return oe[0]=Math.abs(be[0]),oe[1]=Math.abs(be[1]),oe[2]=Math.abs(be[2]),oe},e.min=function M(oe,be,Se){return oe[0]=Math.min(be[0],Se[0]),oe[1]=Math.min(be[1],Se[1]),oe[2]=Math.min(be[2],Se[2]),oe},e.max=function F(oe,be,Se){return oe[0]=Math.max(be[0],Se[0]),oe[1]=Math.max(be[1],Se[1]),oe[2]=Math.max(be[2],Se[2]),oe},e.clamp=function N(oe,be,Se,Qe){return oe[0]=Math.max(Se[0],Math.min(Qe[0],be[0])),oe[1]=Math.max(Se[1],Math.min(Qe[1],be[1])),oe[2]=Math.max(Se[2],Math.min(Qe[2],be[2])),oe},e.distance=function j(oe,be){var Se=be[0]-oe[0],Qe=be[1]-oe[1],Et=be[2]-oe[2];return Math.sqrt(Se*Se+Qe*Qe+Et*Et)},e.squaredDistance=function k(oe,be){var Se=be[0]-oe[0],Qe=be[1]-oe[1],Et=be[2]-oe[2];return Se*Se+Qe*Qe+Et*Et},e.magnitude=function H(oe){var be=oe[0],Se=oe[1],Qe=oe[2];return Math.sqrt(be*be+Se*Se+Qe*Qe)},e.squaredMagnitude=G,e.setMagnitude=function U(oe,be,Se){return y(oe,K(oe,be),Se)},e.negate=Q,e.inverse=function W(oe,be){return oe[0]=1/be[0],oe[1]=1/be[1],oe[2]=1/be[2],oe},e.normalize=K,e.dot=ne,e.cross=X,e.lerp=function L(oe,be,Se,Qe){var Et=be[0],At=be[1],Zt=be[2];return oe[0]=Et+Qe*(Se[0]-Et),oe[1]=At+Qe*(Se[1]-At),oe[2]=Zt+Qe*(Se[2]-Zt),oe};var Y=t();function ue(oe,be){var Se=Math.sqrt(G(oe)*G(be));if(0===Se)return Math.PI/2;var Qe=ne(oe,be)/Se;return Math.acos(ao(Qe,-1,1))}e.slerp=function $(oe,be,Se,Qe){var Et=ao(ne(be,Se),-1,1),At=Math.acos(Et)*Qe;return b(Y,Se,be,-Et),K(Y,Y),h(oe,y(oe,be,Math.cos(At)),y(Y,Y,Math.sin(At)))},e.hermite=function Z(oe,be,Se,Qe,Et,At){var Zt=At*At,Ir=Zt*(2*At-3)+1,rr=Zt*(At-2)+At,mn=Zt*(At-1),na=Zt*(3-2*At);return oe[0]=be[0]*Ir+Se[0]*rr+Qe[0]*mn+Et[0]*na,oe[1]=be[1]*Ir+Se[1]*rr+Qe[1]*mn+Et[1]*na,oe[2]=be[2]*Ir+Se[2]*rr+Qe[2]*mn+Et[2]*na,oe},e.bezier=function q(oe,be,Se,Qe,Et,At){var Zt=1-At,Ir=Zt*Zt,rr=At*At,mn=Ir*Zt,na=3*At*Ir,_o=3*rr*Zt,Za=rr*At;return oe[0]=be[0]*mn+Se[0]*na+Qe[0]*_o+Et[0]*Za,oe[1]=be[1]*mn+Se[1]*na+Qe[1]*_o+Et[1]*Za,oe[2]=be[2]*mn+Se[2]*na+Qe[2]*_o+Et[2]*Za,oe},e.quadraticBezier=function z(oe,be,Se,Qe,Et){return oe[0]=QF(be[0],Se[0],Qe[0],Et),oe[1]=QF(be[1],Se[1],Qe[1],Et),oe[2]=QF(be[2],Se[2],Qe[2],Et),oe},e.spline=function te(oe,be,Se,Qe,Et,At,Zt){return oe[0]=jA(be[0],Se[0],Qe[0],Et[0],At,Zt),oe[1]=jA(be[1],Se[1],Qe[1],Et[1],At,Zt),oe[2]=jA(be[2],Se[2],Qe[2],Et[2],At,Zt),oe},e.random=function ae(oe,be){var Se=2*Math.random()*Math.PI,Qe=2*Math.random()-1,Et=Math.sqrt(1-Qe*Qe)*be;return oe[0]=Math.cos(Se)*Et,oe[1]=Math.sin(Se)*Et,oe[2]=Qe*be,oe},e.transformMat4=function fe(oe,be,Se){var Qe=be[0],Et=be[1],At=be[2],Zt=1/(Se[3]*Qe+Se[7]*Et+Se[11]*At+Se[15]||1);return oe[0]=(Se[0]*Qe+Se[4]*Et+Se[8]*At+Se[12])*Zt,oe[1]=(Se[1]*Qe+Se[5]*Et+Se[9]*At+Se[13])*Zt,oe[2]=(Se[2]*Qe+Se[6]*Et+Se[10]*At+Se[14])*Zt,oe},e.transformDirection=function he(oe,be,Se){var Qe=be[0],Et=be[1],At=be[2];return oe[0]=Se[0]*Qe+Se[4]*Et+Se[8]*At,oe[1]=Se[1]*Qe+Se[5]*Et+Se[9]*At,oe[2]=Se[2]*Qe+Se[6]*Et+Se[10]*At,K(oe,oe)},e.transformMat4Offset=function pe(oe,be,Se,Qe,Et,At){var Zt=be[0+Et],Ir=be[1+Et],rr=be[2+Et],mn=1/(Se[3+At]*Zt+Se[7+At]*Ir+Se[11+At]*rr+Se[15+At]||1);return oe[0+Qe]=(Se[0+At]*Zt+Se[4+At]*Ir+Se[8+At]*rr+Se[12+At])*mn,oe[1+Qe]=(Se[1+At]*Zt+Se[5+At]*Ir+Se[9+At]*rr+Se[13+At])*mn,oe[2+Qe]=(Se[2+At]*Zt+Se[6+At]*Ir+Se[10+At]*rr+Se[14+At])*mn,oe},e.transformMat3=function re(oe,be,Se){var Qe=be[0],Et=be[1],At=be[2];return oe[0]=Qe*Se[0]+Et*Se[3]+At*Se[6],oe[1]=Qe*Se[1]+Et*Se[4]+At*Se[7],oe[2]=Qe*Se[2]+Et*Se[5]+At*Se[8],oe},e.transformQuat=function ee(oe,be,Se){var Qe=be[0],Et=be[1],At=be[2],Zt=Se[0],Ir=Se[1],rr=Se[2],mn=Se[3],na=mn*Qe+Ir*At-rr*Et,_o=mn*Et+rr*Qe-Zt*At,Za=mn*At+Zt*Et-Ir*Qe,Ji=-Zt*Qe-Ir*Et-rr*At;return oe[0]=na*mn+Ji*-Zt+_o*-rr-Za*-Ir,oe[1]=_o*mn+Ji*-Ir+Za*-Zt-na*-rr,oe[2]=Za*mn+Ji*-rr+na*-Ir-_o*-Zt,oe},e.angle=ue;var ge=t(),Ce=t(),ze=t(),je=t(),V=t(),J=t(),ye=t();e.dihedralAngle=function we(oe,be,Se,Qe){m(ge,oe,be),m(Ce,Se,be),m(ze,be,Se),m(je,Qe,Se),X(V,ge,Ce),X(J,ze,je);var Et=ue(V,J);return X(ye,V,J),ne(Ce,ye)>0?Et:-Et},e.directionFromSpherical=function Ee(oe,be,Se,Qe){return e.set(oe,Qe*Math.cos(Se)*Math.sin(be),Qe*Math.sin(Se)*Math.sin(be),Qe*Math.cos(be))},e.exactEquals=function Fe(oe,be){return oe[0]===be[0]&&oe[1]===be[1]&&oe[2]===be[2]},e.equals=function ke(oe,be){var Se=oe[0],Qe=oe[1],Et=oe[2],At=be[0],Zt=be[1],Ir=be[2];return Math.abs(Se-At)<=gn*Math.max(1,Math.abs(Se),Math.abs(At))&&Math.abs(Qe-Zt)<=gn*Math.max(1,Math.abs(Qe),Math.abs(Zt))&&Math.abs(Et-Ir)<=gn*Math.max(1,Math.abs(Et),Math.abs(Ir))};var Ue=t();e.makeRotation=function $e(oe,be,Se){var Qe=ue(be,Se);if(Math.abs(Qe)<1e-4)return me.setIdentity(oe);if(Math.abs(Qe-Math.PI)<gn)return me.fromScaling(oe,e.negUnit);var Et=X(Ue,be,Se);return me.fromRotation(oe,Qe,Et)},e.isZero=function Pe(oe){return 0===oe[0]&&0===oe[1]&&0===oe[2]},e.projectPointOnVector=function He(oe,be,Se,Qe){return m(oe,be,Qe),h(oe,y(oe,Se,ne(Se,oe)/G(Se)),Qe)};var Je=t();function ut(oe,be,Se){return y(oe,Se,ne(Se,be)/G(Se))}e.projectPointOnPlane=function vt(oe,be,Se,Qe){return K(Je,Se),m(oe,be,Qe),m(oe,be,y(Je,Je,ne(oe,Je)))},e.projectOnVector=ut;var _t=t();e.projectOnPlane=function wt(oe,be,Se){return ut(_t,be,Se),m(oe,be,_t)},e.orthogonalize=function Le(oe,be,Se){return K(oe,X(oe,X(oe,be,Se),be))},e.matchDirection=function st(oe,be,Se){return ne(be,Se)>0?p(oe,be):Q(oe,p(oe,be)),oe};var St=t(),bt=t();e.triangleNormal=function Mt(oe,be,Se,Qe){return m(St,Se,be),m(bt,Qe,be),K(oe,X(oe,St,bt))},e.toString=function Rt(oe,be){return"[".concat(oe[0].toPrecision(be)," ").concat(oe[1].toPrecision(be)," ").concat(oe[2].toPrecision(be),"]")},e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)}(S||(S={}));var Cr,ie,Qr,eN,Av,g2,m2=Math.PI/2,ZY=Math.PI/180;function Zr(e){return e*ZY}function Ju(e){return e/ZY}function v2(e){return 0!==e&&0==(e&e-1)}function QY(e,t){return e*t}function me(){return me.zero()}function Qt(){return Qt.zero()}function Ne(){return Ne.zero()}function fr(){return fr.zero()}function qA(e){return Object.keys(e)}function xn(e){throw new Error("unreachable")}function WA(e){return"function"==typeof e?.then}function yn(){return yn.zero()}function xv(e,t,r){for(;t<r&&32===e.charCodeAt(t);)t++;return Lh(e,t,r)}function Lh(e,t,r){var n=t,a=0,i=1;for(45===e.charCodeAt(n)?(i=-1,++n):43===e.charCodeAt(n)&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function $Y(e,t,r,n){return 43===t.charCodeAt(r)&&r++,e*Math.pow(10,Lh(t,r,n))}function Zf(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(45===e.charCodeAt(n)?(a=-1,++n):43===e.charCodeAt(n)&&++n;n<r;){var u=e.charCodeAt(n)-48;if(!(u>=0&&u<10)){if(-2===u){for(++n;n<r;){if(!((u=e.charCodeAt(n)-48)>=0&&u<10))return 53===u||21===u?$Y(a*(i+o/s),e,n+1,r):a*(i+o/s);o=10*o+u,s*=10,++n}return a*(i+o/s)}if(53===u||21===u)return $Y(a*i,e,n+1,r);break}i=10*i+u,++n}return a*i}function eX(e,t,r,n){return{schema:r,__array:void 0,isDefined:0===n,rowCount:t,value:function(i){return e},valueKind:function(i){return n},toArray:function(i){for(var o=h2(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function YA(e){var t=e.value,a=e.rowCount;return{schema:e.schema,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:e.valueKind||function(o){return 0},toArray:function(o){for(var s=h2(a,o),u=s.array,c=s.start,l=0,d=u.length;l<d;l++)u[l]=t(l+c);return u},areValuesEqual:e.areValuesEqual||function(o,s){return t(o)===t(s)}}}function Qf(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.T,o="str"===r.valueType?"lowercase"===r.transform?function(u){var c=t[u];return"string"==typeof c?c.toLowerCase():"".concat(c??i).toLowerCase()}:"uppercase"===r.transform?function(u){var c=t[u];return"string"==typeof c?c.toUpperCase():"".concat(c??i).toUpperCase()}:function(u){var c=t[u];return"string"==typeof c?c:"".concat(c??i)}:function(u){return t[u]},s=XF(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:o,valueKind:n||function(u){return 0},toArray:"str"===r.valueType?"lowercase"===r.transform?function(u){for(var c=xy(a,u),l=c.start,d=c.end,f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,h=d-l;p<h;p++){var m=t[l+p];f[p]="string"==typeof m?m.toLowerCase():"".concat(m??i).toLowerCase()}return f}:"uppercase"===r.transform?function(u){for(var c=xy(a,u),l=c.start,d=c.end,f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,h=d-l;p<h;p++){var m=t[l+p];f[p]="string"==typeof m?m.toUpperCase():"".concat(m??i).toUpperCase()}return f}:function(u){for(var c=xy(a,u),l=c.start,d=c.end,f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,h=d-l;p<h;p++){var m=t[l+p];f[p]="string"==typeof m?m:"".concat(m??i)}return f}:s?function(u){return HA(t,u)}:function(u){var c=xy(a,u),l=c.start,d=c.end;if(0===l&&d===t.length)return t;for(var f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,h=d-l;p<h;p++)f[p]=t[l+p];return f},areValuesEqual:function(u,c){return t[u]===t[c]}}}function XA(e,t,r){return e[t]-e[r]}function wv(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function tX(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function YDe(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,tX(i,n,t,r));n(i,u,t)>0;)--u;for(var c=t+1;c<=u;c++){var l=n(i,c,t);if(l>0){for(a(i,c,u),--u;n(i,u,t)>0;)--u;c--}else 0===l&&(a(i,c,s),s++)}for(c=t;c<s;c++)a(i,c,t+u-c);o[0]=u-s+t+1,o[1]=u}function XDe(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s-=1}function KA(e,t,r){for(var n=e.parts;t<r;){if(r-t<16)return void XDe(e,t,r);YDe(e,t,r);var a=n[0],i=n[1];a-t<r-i?(KA(e,t,a-1),t=i+1):(KA(e,i+1,r),r=a-1)}}function KDe(e,t,r,n){var a=r+1,i=n;wv(e,r,tX(e,XA,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(wv(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(wv(e,s,a),++a)}for(s=r;s<a;s++)wv(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function ZDe(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i-=1;e[i+1]=a}}function JF(e,t,r,n){for(;r<n;){if(n-r<16)return void ZDe(e,r,n);KDe(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(JF(e,t,r,a-1),r=i+1):(JF(e,t,i+1,n),n=a-1)}}function Rc(e,t){return void 0===t&&(t=XA),function QDe(e,t,r,n){return void 0===n&&(n=XA),n===XA?JF(e,[0,0],t,r-1):KA({data:e,cmp:n,swap:wv,parts:[0,0]},t,r-1),e}(e,0,e.length,t)}function rX(e,t,r,n,a){return KA({data:e,cmp:n,swap:a,parts:[0,0]},t,r-1),e}function Su(e,t){return{value:e,unit:t}}function ec(e){return e}!function(e){function t(){var V=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return V[0]=0,V}function r(){var V=t();return V[0]=1,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=1,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=1,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V}function n(V){return V[0]=1,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=1,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=1,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V}function a(V){for(var J=0;J<16;J++)V[J]=0;return V}e.zero=t,e.identity=r,e.setIdentity=n,e.setZero=a,e.ofRows=function i(V){for(var J=t(),ye=0;ye<4;ye++)for(var we=V[ye],Ee=0;Ee<4;Ee++)J[4*Ee+ye]=we[Ee];return J};var o=r();function c(V,J,ye){for(var we=0;we<16;we++)if(Math.abs(V[we]-J[we])>ye)return!1;return!0}function l(V,J,ye,we){V[4*ye+J]=we}function m(V,J){return V[0]=J[0],V[1]=J[1],V[2]=J[2],V[3]=J[3],V[4]=J[4],V[5]=J[5],V[6]=J[6],V[7]=J[7],V[8]=J[8],V[9]=J[9],V[10]=J[10],V[11]=J[11],V[12]=J[12],V[13]=J[13],V[14]=J[14],V[15]=J[15],V}function b(V,J){var ye=J[0]+J[5]+J[10],we=0;return ye>0?(we=2*Math.sqrt(ye+1),V[3]=.25*we,V[0]=(J[6]-J[9])/we,V[1]=(J[8]-J[2])/we,V[2]=(J[1]-J[4])/we):J[0]>J[5]&&J[0]>J[10]?(we=2*Math.sqrt(1+J[0]-J[5]-J[10]),V[3]=(J[6]-J[9])/we,V[0]=.25*we,V[1]=(J[1]+J[4])/we,V[2]=(J[8]+J[2])/we):J[5]>J[10]?(we=2*Math.sqrt(1+J[5]-J[0]-J[10]),V[3]=(J[8]-J[2])/we,V[0]=(J[1]+J[4])/we,V[1]=.25*we,V[2]=(J[6]+J[9])/we):(we=2*Math.sqrt(1+J[10]-J[0]-J[5]),V[3]=(J[1]-J[4])/we,V[0]=(J[8]+J[2])/we,V[1]=(J[6]+J[9])/we,V[2]=.25*we),V}function x(V,J){var ye=J[0],we=J[1],Ee=J[2],Fe=J[3],ke=J[4],Ue=J[5],$e=J[6],Pe=J[7],He=J[8],Je=J[9],vt=J[10],ut=J[11],_t=J[12],wt=J[13],Le=J[14],st=J[15],St=ye*Ue-we*ke,bt=ye*$e-Ee*ke,Mt=ye*Pe-Fe*ke,Rt=we*$e-Ee*Ue,oe=we*Pe-Fe*Ue,be=Ee*Pe-Fe*$e,Se=He*wt-Je*_t,Qe=He*Le-vt*_t,Et=He*st-ut*_t,At=Je*Le-vt*wt,Zt=Je*st-ut*wt,Ir=vt*st-ut*Le,rr=St*Ir-bt*Zt+Mt*At+Rt*Et-oe*Qe+be*Se;return!!rr&&(V[0]=(Ue*Ir-$e*Zt+Pe*At)*(rr=1/rr),V[1]=(Ee*Zt-we*Ir-Fe*At)*rr,V[2]=(wt*be-Le*oe+st*Rt)*rr,V[3]=(vt*oe-Je*be-ut*Rt)*rr,V[4]=($e*Et-ke*Ir-Pe*Qe)*rr,V[5]=(ye*Ir-Ee*Et+Fe*Qe)*rr,V[6]=(Le*Mt-_t*be-st*bt)*rr,V[7]=(He*be-vt*Mt+ut*bt)*rr,V[8]=(ke*Zt-Ue*Et+Pe*Se)*rr,V[9]=(we*Et-ye*Zt-Fe*Se)*rr,V[10]=(_t*oe-wt*Mt+st*St)*rr,V[11]=(Je*Mt-He*oe-ut*St)*rr,V[12]=(Ue*Qe-ke*At-$e*Se)*rr,V[13]=(ye*At-we*Qe+Ee*Se)*rr,V[14]=(wt*bt-_t*Rt-Le*St)*rr,V[15]=(He*Rt-Je*bt+vt*St)*rr,!0)}function T(V,J,ye){var we=J[0],Ee=J[1],Fe=J[2],ke=J[3],Ue=J[4],$e=J[5],Pe=J[6],He=J[7],Je=J[8],vt=J[9],ut=J[10],_t=J[11],wt=J[12],Le=J[13],st=J[14],St=J[15],bt=ye[0],Mt=ye[1],Rt=ye[2],oe=ye[3];return V[0]=bt*we+Mt*Ue+Rt*Je+oe*wt,V[1]=bt*Ee+Mt*$e+Rt*vt+oe*Le,V[2]=bt*Fe+Mt*Pe+Rt*ut+oe*st,V[3]=bt*ke+Mt*He+Rt*_t+oe*St,V[4]=(bt=ye[4])*we+(Mt=ye[5])*Ue+(Rt=ye[6])*Je+(oe=ye[7])*wt,V[5]=bt*Ee+Mt*$e+Rt*vt+oe*Le,V[6]=bt*Fe+Mt*Pe+Rt*ut+oe*st,V[7]=bt*ke+Mt*He+Rt*_t+oe*St,V[8]=(bt=ye[8])*we+(Mt=ye[9])*Ue+(Rt=ye[10])*Je+(oe=ye[11])*wt,V[9]=bt*Ee+Mt*$e+Rt*vt+oe*Le,V[10]=bt*Fe+Mt*Pe+Rt*ut+oe*st,V[11]=bt*ke+Mt*He+Rt*_t+oe*St,V[12]=(bt=ye[12])*we+(Mt=ye[13])*Ue+(Rt=ye[14])*Je+(oe=ye[15])*wt,V[13]=bt*Ee+Mt*$e+Rt*vt+oe*Le,V[14]=bt*Fe+Mt*Pe+Rt*ut+oe*st,V[15]=bt*ke+Mt*He+Rt*_t+oe*St,V}function k(V,J,ye){var we=ye[0],Ee=ye[1],Fe=ye[2],ke=Math.sqrt(we*we+Ee*Ee+Fe*Fe);if(Math.abs(ke)<gn)return n(V);we*=ke=1/ke,Ee*=ke,Fe*=ke;var Ue=Math.sin(J),$e=Math.cos(J),Pe=1-$e;return V[0]=we*we*Pe+$e,V[1]=Ee*we*Pe+Fe*Ue,V[2]=Fe*we*Pe-Ee*Ue,V[3]=0,V[4]=we*Ee*Pe-Fe*Ue,V[5]=Ee*Ee*Pe+$e,V[6]=Fe*Ee*Pe+we*Ue,V[7]=0,V[8]=we*Fe*Pe+Ee*Ue,V[9]=Ee*Fe*Pe-we*Ue,V[10]=Fe*Fe*Pe+$e,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V}e.isIdentity=function s(V,J){return c(V,o,typeof J>"u"?gn:J)},e.hasNaN=function u(V){for(var J=0;J<16;J++)if(isNaN(V[J]))return!0;return!1},e.areEqual=c,e.setValue=l,e.getValue=function d(V,J,ye){return V[4*ye+J]},e.toArray=function f(V,J,ye){return J[ye+0]=V[0],J[ye+1]=V[1],J[ye+2]=V[2],J[ye+3]=V[3],J[ye+4]=V[4],J[ye+5]=V[5],J[ye+6]=V[6],J[ye+7]=V[7],J[ye+8]=V[8],J[ye+9]=V[9],J[ye+10]=V[10],J[ye+11]=V[11],J[ye+12]=V[12],J[ye+13]=V[13],J[ye+14]=V[14],J[ye+15]=V[15],J},e.fromArray=function p(V,J,ye){return V[0]=J[ye+0],V[1]=J[ye+1],V[2]=J[ye+2],V[3]=J[ye+3],V[4]=J[ye+4],V[5]=J[ye+5],V[6]=J[ye+6],V[7]=J[ye+7],V[8]=J[ye+8],V[9]=J[ye+9],V[10]=J[ye+10],V[11]=J[ye+11],V[12]=J[ye+12],V[13]=J[ye+13],V[14]=J[ye+14],V[15]=J[ye+15],V},e.fromBasis=function h(V,J,ye,we){return a(V),l(V,0,0,J[0]),l(V,1,0,J[1]),l(V,2,0,J[2]),l(V,0,1,ye[0]),l(V,1,1,ye[1]),l(V,2,1,ye[2]),l(V,0,2,we[0]),l(V,1,2,we[1]),l(V,2,2,we[2]),l(V,3,3,1),V},e.copy=m,e.clone=function v(V){return m(t(),V)},e.getTranslation=function g(V,J){return V[0]=J[12],V[1]=J[13],V[2]=J[14],V},e.getScaling=function y(V,J){var ye=J[0],we=J[1],Ee=J[2],Fe=J[4],ke=J[5],Ue=J[6],$e=J[8],Pe=J[9],He=J[10];return V[0]=Math.sqrt(ye*ye+we*we+Ee*Ee),V[1]=Math.sqrt(Fe*Fe+ke*ke+Ue*Ue),V[2]=Math.sqrt($e*$e+Pe*Pe+He*He),V},e.getRotation=b,e.extractRotation=function _(V,J){var ye=1/Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]),we=1/Math.sqrt(J[4]*J[4]+J[5]*J[5]+J[6]*J[6]),Ee=1/Math.sqrt(J[8]*J[8]+J[9]*J[9]+J[10]*J[10]);return V[0]=J[0]*ye,V[1]=J[1]*ye,V[2]=J[2]*ye,V[3]=0,V[4]=J[4]*we,V[5]=J[5]*we,V[6]=J[6]*we,V[7]=0,V[8]=J[8]*Ee,V[9]=J[9]*Ee,V[10]=J[10]*Ee,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V},e.transpose=function C(V,J){if(V===J){var ye=J[1],we=J[2],Ee=J[3],Fe=J[6],ke=J[7],Ue=J[11];V[1]=J[4],V[2]=J[8],V[3]=J[12],V[4]=ye,V[6]=J[9],V[7]=J[13],V[8]=we,V[9]=Fe,V[11]=J[14],V[12]=Ee,V[13]=ke,V[14]=Ue}else V[0]=J[0],V[1]=J[4],V[2]=J[8],V[3]=J[12],V[4]=J[1],V[5]=J[5],V[6]=J[9],V[7]=J[13],V[8]=J[2],V[9]=J[6],V[10]=J[10],V[11]=J[14],V[12]=J[3],V[13]=J[7],V[14]=J[11],V[15]=J[15];return V},e.tryInvert=x,e.invert=function A(V,J){return x(V,J)||console.warn("non-invertible matrix.",J),V},e.mul=T,e.mulOffset=function w(V,J,ye,we,Ee,Fe){var ke=J[0+Ee],Ue=J[1+Ee],$e=J[2+Ee],Pe=J[3+Ee],He=J[4+Ee],Je=J[5+Ee],vt=J[6+Ee],ut=J[7+Ee],_t=J[8+Ee],wt=J[9+Ee],Le=J[10+Ee],st=J[11+Ee],St=J[12+Ee],bt=J[13+Ee],Mt=J[14+Ee],Rt=J[15+Ee],oe=ye[0+Fe],be=ye[1+Fe],Se=ye[2+Fe],Qe=ye[3+Fe];return V[0+we]=oe*ke+be*He+Se*_t+Qe*St,V[1+we]=oe*Ue+be*Je+Se*wt+Qe*bt,V[2+we]=oe*$e+be*vt+Se*Le+Qe*Mt,V[3+we]=oe*Pe+be*ut+Se*st+Qe*Rt,V[4+we]=(oe=ye[4+Fe])*ke+(be=ye[5+Fe])*He+(Se=ye[6+Fe])*_t+(Qe=ye[7+Fe])*St,V[5+we]=oe*Ue+be*Je+Se*wt+Qe*bt,V[6+we]=oe*$e+be*vt+Se*Le+Qe*Mt,V[7+we]=oe*Pe+be*ut+Se*st+Qe*Rt,V[8+we]=(oe=ye[8+Fe])*ke+(be=ye[9+Fe])*He+(Se=ye[10+Fe])*_t+(Qe=ye[11+Fe])*St,V[9+we]=oe*Ue+be*Je+Se*wt+Qe*bt,V[10+we]=oe*$e+be*vt+Se*Le+Qe*Mt,V[11+we]=oe*Pe+be*ut+Se*st+Qe*Rt,V[12+we]=(oe=ye[12+Fe])*ke+(be=ye[13+Fe])*He+(Se=ye[14+Fe])*_t+(Qe=ye[15+Fe])*St,V[13+we]=oe*Ue+be*Je+Se*wt+Qe*bt,V[14+we]=oe*$e+be*vt+Se*Le+Qe*Mt,V[15+we]=oe*Pe+be*ut+Se*st+Qe*Rt,V},e.mul3=function E(V,J,ye,we){return T(V,T(V,J,ye),we)},e.translate=function I(V,J,ye){var ke,Ue,$e,Pe,He,Je,vt,ut,_t,wt,Le,st,we=ye[0],Ee=ye[1],Fe=ye[2];return J===V?(V[12]=J[0]*we+J[4]*Ee+J[8]*Fe+J[12],V[13]=J[1]*we+J[5]*Ee+J[9]*Fe+J[13],V[14]=J[2]*we+J[6]*Ee+J[10]*Fe+J[14],V[15]=J[3]*we+J[7]*Ee+J[11]*Fe+J[15]):(Ue=J[1],$e=J[2],Pe=J[3],He=J[4],Je=J[5],vt=J[6],ut=J[7],_t=J[8],wt=J[9],Le=J[10],st=J[11],V[0]=ke=J[0],V[1]=Ue,V[2]=$e,V[3]=Pe,V[4]=He,V[5]=Je,V[6]=vt,V[7]=ut,V[8]=_t,V[9]=wt,V[10]=Le,V[11]=st,V[12]=ke*we+He*Ee+_t*Fe+J[12],V[13]=Ue*we+Je*Ee+wt*Fe+J[13],V[14]=$e*we+vt*Ee+Le*Fe+J[14],V[15]=Pe*we+ut*Ee+st*Fe+J[15]),V},e.fromTranslation=function M(V,J){return V[0]=1,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=1,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=1,V[11]=0,V[12]=J[0],V[13]=J[1],V[14]=J[2],V[15]=1,V},e.setTranslation=function F(V,J){return V[12]=J[0],V[13]=J[1],V[14]=J[2],V},e.setAxes=function N(V,J,ye,we){return V[0]=ye[0],V[4]=ye[1],V[8]=ye[2],V[1]=we[0],V[5]=we[1],V[9]=we[2],V[2]=J[0],V[6]=J[1],V[10]=J[2],V},e.rotate=function j(V,J,ye,we){var Ee=we[0],Fe=we[1],ke=we[2],Ue=Math.sqrt(Ee*Ee+Fe*Fe+ke*ke);if(Math.abs(Ue)<gn)return r();Ee*=Ue=1/Ue,Fe*=Ue,ke*=Ue;var $e=Math.sin(ye),Pe=Math.cos(ye),He=1-Pe,Je=J[0],vt=J[1],ut=J[2],_t=J[3],wt=J[4],Le=J[5],st=J[6],St=J[7],bt=J[8],Mt=J[9],Rt=J[10],oe=J[11],be=Ee*Ee*He+Pe,Se=Fe*Ee*He+ke*$e,Qe=ke*Ee*He-Fe*$e,Et=Ee*Fe*He-ke*$e,At=Fe*Fe*He+Pe,Zt=ke*Fe*He+Ee*$e,Ir=Ee*ke*He+Fe*$e,rr=Fe*ke*He-Ee*$e,mn=ke*ke*He+Pe;return V[0]=Je*be+wt*Se+bt*Qe,V[1]=vt*be+Le*Se+Mt*Qe,V[2]=ut*be+st*Se+Rt*Qe,V[3]=_t*be+St*Se+oe*Qe,V[4]=Je*Et+wt*At+bt*Zt,V[5]=vt*Et+Le*At+Mt*Zt,V[6]=ut*Et+st*At+Rt*Zt,V[7]=_t*Et+St*At+oe*Zt,V[8]=Je*Ir+wt*rr+bt*mn,V[9]=vt*Ir+Le*rr+Mt*mn,V[10]=ut*Ir+st*rr+Rt*mn,V[11]=_t*Ir+St*rr+oe*mn,J!==V&&(V[12]=J[12],V[13]=J[13],V[14]=J[14],V[15]=J[15]),V},e.fromRotation=k,e.scale=function H(V,J,ye){var we=ye[0],Ee=ye[1],Fe=ye[2];return V[0]=J[0]*we,V[1]=J[1]*we,V[2]=J[2]*we,V[3]=J[3]*we,V[4]=J[4]*Ee,V[5]=J[5]*Ee,V[6]=J[6]*Ee,V[7]=J[7]*Ee,V[8]=J[8]*Fe,V[9]=J[9]*Fe,V[10]=J[10]*Fe,V[11]=J[11]*Fe,V[12]=J[12],V[13]=J[13],V[14]=J[14],V[15]=J[15],V},e.scaleUniformly=function G(V,J,ye){return V[0]=J[0]*ye,V[1]=J[1]*ye,V[2]=J[2]*ye,V[3]=J[3]*ye,V[4]=J[4]*ye,V[5]=J[5]*ye,V[6]=J[6]*ye,V[7]=J[7]*ye,V[8]=J[8]*ye,V[9]=J[9]*ye,V[10]=J[10]*ye,V[11]=J[11]*ye,V[12]=J[12],V[13]=J[13],V[14]=J[14],V[15]=J[15],V},e.fromScaling=function U(V,J){return V[0]=J[0],V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=J[1],V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=J[2],V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V},e.fromUniformScaling=function Q(V,J){return V[0]=J,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=J,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=J,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V},e.fromMat3=function W(V,J){return V[0]=J[0],V[1]=J[1],V[2]=J[2],V[4]=J[3],V[5]=J[4],V[6]=J[5],V[8]=J[6],V[9]=J[7],V[10]=J[8],V},e.compose=function K(V,J,ye,we){var Ee=ye[0],Fe=ye[1],ke=ye[2],Ue=ye[3],$e=Ee+Ee,Pe=Fe+Fe,He=ke+ke,Je=Ee*$e,vt=Ee*Pe,ut=Ee*He,_t=Fe*Pe,wt=Fe*He,Le=ke*He,st=Ue*$e,St=Ue*Pe,bt=Ue*He,Mt=we[0],Rt=we[1],oe=we[2];return V[0]=(1-(_t+Le))*Mt,V[1]=(vt+bt)*Mt,V[2]=(ut-St)*Mt,V[3]=0,V[4]=(vt-bt)*Rt,V[5]=(1-(Je+Le))*Rt,V[6]=(wt+st)*Rt,V[7]=0,V[8]=(ut+St)*oe,V[9]=(wt-st)*oe,V[10]=(1-(Je+_t))*oe,V[11]=0,V[12]=J[0],V[13]=J[1],V[14]=J[2],V[15]=1,V};var ne=[0,0,0],X=t();function $(V){var J=V[0],ye=V[1],we=V[2],Ee=V[3],Fe=V[4],ke=V[5],Ue=V[6],$e=V[7],Pe=V[8],He=V[9],Je=V[10],vt=V[11],ut=V[12],_t=V[13],wt=V[14],Le=V[15];return(J*ke-ye*Fe)*(Je*Le-vt*wt)-(J*Ue-we*Fe)*(He*Le-vt*_t)+(J*$e-Ee*Fe)*(He*wt-Je*_t)+(ye*Ue-we*ke)*(Pe*Le-vt*ut)-(ye*$e-Ee*ke)*(Pe*wt-Je*ut)+(we*$e-Ee*Ue)*(Pe*_t-He*ut)}e.decompose=function L(V,J,ye,we){var Ee=S.magnitude(S.set(ne,V[0],V[1],V[2])),Fe=S.magnitude(S.set(ne,V[4],V[5],V[6])),ke=S.magnitude(S.set(ne,V[8],V[9],V[10]));$(V)<0&&(Ee=-Ee),J[0]=V[12],J[1]=V[13],J[2]=V[14],m(X,V);var $e=1/Ee,Pe=1/Fe,He=1/ke;return X[0]*=$e,X[1]*=$e,X[2]*=$e,X[4]*=Pe,X[5]*=Pe,X[6]*=Pe,X[8]*=He,X[9]*=He,X[10]*=He,b(ye,X),we[0]=Ee,we[1]=Fe,we[2]=ke,V},e.makeTable=function Y(V){for(var J="",ye=0;ye<4;ye++){for(var we=0;we<4;we++)J+=V[4*we+ye].toString(),we<3&&(J+=" ");ye<3&&(J+="\n")}return J},e.determinant=$,e.isRotationAndTranslation=function Z(V,J){return function q(V,J){var ye=V[0],we=V[1],Ee=V[2],Fe=V[3],ke=V[4],Ue=V[5],$e=V[6],Pe=V[7],He=V[8],Je=V[9],vt=V[10],ut=V[11];return!!(ia(V[15],1,J)&&ia(Fe,0,J)&&ia(Pe,0,J)&&ia(ut,0,J))&&!!ia(Math.abs(ye*(Ue*vt-$e*Je)-we*(ke*vt-$e*He)+Ee*(ke*Je-Ue*He)),1,J)}(V,typeof J<"u"?J:gn)},e.isTranslationAndUniformScaling=function z(V,J){return function te(V,J){var ye=V[0];return ia(V[1],0,J)&&ia(V[2],0,J)&&ia(V[3],0,J)&&ia(V[4],0,J)&&ia(V[5],ye,J)&&ia(V[6],0,J)&&ia(V[7],0,J)&&ia(V[8],0,J)&&ia(V[9],0,J)&&ia(V[10],ye,J)&&ia(V[11],0,J)&&ia(V[15],1,J)}(V,typeof J<"u"?J:gn)},e.fromQuat=function ae(V,J){var ye=J[0],we=J[1],Ee=J[2],Fe=J[3],ke=ye+ye,Ue=we+we,$e=Ee+Ee,Pe=ye*ke,He=we*ke,Je=we*Ue,vt=Ee*ke,ut=Ee*Ue,_t=Ee*$e,wt=Fe*ke,Le=Fe*Ue,st=Fe*$e;return V[0]=1-Je-_t,V[1]=He+st,V[2]=vt-Le,V[3]=0,V[4]=He-st,V[5]=1-Pe-_t,V[6]=ut+wt,V[7]=0,V[8]=vt+Le,V[9]=ut-wt,V[10]=1-Pe-Je,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V},e.fromEuler=function fe(V,J,ye){var we=J[0],Ee=J[1],Fe=J[2],ke=Math.cos(we),Ue=Math.sin(we),$e=Math.cos(Ee),Pe=Math.sin(Ee),He=Math.cos(Fe),Je=Math.sin(Fe);if("XYZ"===ye){var vt=ke*He,ut=ke*Je,_t=Ue*He,wt=Ue*Je;V[0]=$e*He,V[4]=-$e*Je,V[8]=Pe,V[1]=ut+_t*Pe,V[5]=vt-wt*Pe,V[9]=-Ue*$e,V[2]=wt-vt*Pe,V[6]=_t+ut*Pe,V[10]=ke*$e}else if("YXZ"===ye){var st=$e*Je,St=Pe*He;V[0]=(Le=$e*He)+(bt=Pe*Je)*Ue,V[4]=St*Ue-st,V[8]=ke*Pe,V[1]=ke*Je,V[5]=ke*He,V[9]=-Ue,V[2]=st*Ue-St,V[6]=bt+Le*Ue,V[10]=ke*$e}else if("ZXY"===ye){var Le,bt;st=$e*Je,St=Pe*He,V[0]=(Le=$e*He)-(bt=Pe*Je)*Ue,V[4]=-ke*Je,V[8]=St+st*Ue,V[1]=st+St*Ue,V[5]=ke*He,V[9]=bt-Le*Ue,V[2]=-ke*Pe,V[6]=Ue,V[10]=ke*$e}else if("ZYX"===ye)vt=ke*He,ut=ke*Je,_t=Ue*He,wt=Ue*Je,V[0]=$e*He,V[4]=_t*Pe-ut,V[8]=vt*Pe+wt,V[1]=$e*Je,V[5]=wt*Pe+vt,V[9]=ut*Pe-_t,V[2]=-Pe,V[6]=Ue*$e,V[10]=ke*$e;else if("YZX"===ye){var Mt=ke*$e,Rt=ke*Pe,oe=Ue*$e,be=Ue*Pe;V[0]=$e*He,V[4]=be-Mt*Je,V[8]=oe*Je+Rt,V[1]=Je,V[5]=ke*He,V[9]=-Ue*He,V[2]=-Pe*He,V[6]=Rt*Je+oe,V[10]=Mt-be*Je}else"XZY"===ye&&(Mt=ke*$e,Rt=ke*Pe,oe=Ue*$e,be=Ue*Pe,V[0]=$e*He,V[4]=-Je,V[8]=Pe*He,V[1]=Mt*Je+be,V[5]=ke*He,V[9]=Rt*Je-oe,V[2]=oe*Je-Rt,V[6]=Ue*He,V[10]=be*Je+Mt);return V[3]=0,V[7]=0,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V},e.perspective=function he(V,J,ye,we,Ee,Fe,ke){var $e=2*Fe/(we-Ee),Pe=(ye+J)/(ye-J),He=(we+Ee)/(we-Ee),Je=-(ke+Fe)/(ke-Fe),vt=-2*ke*Fe/(ke-Fe);return V[0]=2*Fe/(ye-J),V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=$e,V[6]=0,V[7]=0,V[8]=Pe,V[9]=He,V[10]=Je,V[11]=-1,V[12]=0,V[13]=0,V[14]=vt,V[15]=0,V},e.ortho=function pe(V,J,ye,we,Ee,Fe,ke){var Ue=1/(ye-J),$e=1/(we-Ee),Pe=1/(ke-Fe),He=(ye+J)*Ue,Je=(we+Ee)*$e,vt=(ke+Fe)*Pe;return V[0]=2*Ue,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=2*$e,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=-2*Pe,V[11]=0,V[12]=-He,V[13]=-Je,V[14]=-vt,V[15]=1,V},e.lookAt=function re(V,J,ye,we){var Ee,Fe,ke,Ue,$e,Pe,He,Je,vt,ut,_t=J[0],wt=J[1],Le=J[2],st=we[0],St=we[1],bt=we[2],Mt=ye[0],Rt=ye[1],oe=ye[2];return Math.abs(_t-Mt)<gn&&Math.abs(wt-Rt)<gn&&Math.abs(Le-oe)<gn?n(V):(He=_t-Mt,Je=wt-Rt,vt=Le-oe,Ee=St*(vt*=ut=1/Math.sqrt(He*He+Je*Je+vt*vt))-bt*(Je*=ut),Fe=bt*(He*=ut)-st*vt,ke=st*Je-St*He,(ut=Math.sqrt(Ee*Ee+Fe*Fe+ke*ke))?(Ee*=ut=1/ut,Fe*=ut,ke*=ut):(Ee=0,Fe=0,ke=0),Ue=Je*ke-vt*Fe,$e=vt*Ee-He*ke,Pe=He*Fe-Je*Ee,(ut=Math.sqrt(Ue*Ue+$e*$e+Pe*Pe))?(Ue*=ut=1/ut,$e*=ut,Pe*=ut):(Ue=0,$e=0,Pe=0),V[0]=Ee,V[1]=Ue,V[2]=He,V[3]=0,V[4]=Fe,V[5]=$e,V[6]=Je,V[7]=0,V[8]=ke,V[9]=Pe,V[10]=vt,V[11]=0,V[12]=-(Ee*_t+Fe*wt+ke*Le),V[13]=-(Ue*_t+$e*wt+Pe*Le),V[14]=-(He*_t+Je*wt+vt*Le),V[15]=1,V)},e.targetTo=function ee(V,J,ye,we){var Ee=J[0],Fe=J[1],ke=J[2],Ue=we[0],$e=we[1],Pe=we[2],He=Ee-ye[0],Je=Fe-ye[1],vt=ke-ye[2],ut=He*He+Je*Je+vt*vt;ut>0&&(He*=ut=1/Math.sqrt(ut),Je*=ut,vt*=ut);var _t=$e*vt-Pe*Je,wt=Pe*He-Ue*vt,Le=Ue*Je-$e*He;return(ut=_t*_t+wt*wt+Le*Le)>0&&(_t*=ut=1/Math.sqrt(ut),wt*=ut,Le*=ut),V[0]=_t,V[1]=wt,V[2]=Le,V[3]=0,V[4]=Je*Le-vt*wt,V[5]=vt*_t-He*Le,V[6]=He*wt-Je*_t,V[7]=0,V[8]=He,V[9]=Je,V[10]=vt,V[11]=0,V[12]=Ee,V[13]=Fe,V[14]=ke,V[15]=1,V},e.fromPermutation=function ue(V,J){a(V);for(var ye=0;ye<4;ye++)l(V,ye,J[ye],1);return V},e.getMaxScaleOnAxis=function ge(V){return Math.sqrt(Math.max(V[0]*V[0]+V[1]*V[1]+V[2]*V[2],V[4]*V[4]+V[5]*V[5]+V[6]*V[6],V[8]*V[8]+V[9]*V[9]+V[10]*V[10]))};var Ce=[1,0,0],ze=[0,1,0],je=[0,0,1];e.rotX90=k(t(),Zr(90),Ce),e.rotX180=k(t(),Zr(180),Ce),e.rotY90=k(t(),Zr(90),ze),e.rotY180=k(t(),Zr(180),ze),e.rotY270=k(t(),Zr(270),ze),e.rotZ90=k(t(),Zr(90),je),e.rotZ180=k(t(),Zr(180),je),e.rotXY90=T(t(),e.rotX90,e.rotY90),e.rotZY90=T(t(),e.rotZ90,e.rotY90),e.rotZYZ90=T(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=T(t(),e.rotZ90,e.rotX180),e.rotY90Z180=T(t(),e.rotY90,e.rotZ180),e.id=r()}(me||(me={})),function(e){function t(){var L=[.1,0,0,0,0,0,0,0,0];return L[0]=0,L}function r(){var L=t();return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=1,L[5]=0,L[6]=0,L[7]=0,L[8]=1,L}function s(L,Y){return L[0]=Y[0],L[1]=Y[1],L[2]=Y[2],L[3]=Y[4],L[4]=Y[5],L[5]=Y[6],L[6]=Y[8],L[7]=Y[9],L[8]=Y[10],L}e.zero=t,e.identity=r,e.setIdentity=function n(L){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=1,L[5]=0,L[6]=0,L[7]=0,L[8]=1,L},e.toArray=function a(L,Y,$){return Y[$+0]=L[0],Y[$+1]=L[1],Y[$+2]=L[2],Y[$+3]=L[3],Y[$+4]=L[4],Y[$+5]=L[5],Y[$+6]=L[6],Y[$+7]=L[7],Y[$+8]=L[8],Y},e.fromArray=function i(L,Y,$){return L[0]=Y[$+0],L[1]=Y[$+1],L[2]=Y[$+2],L[3]=Y[$+3],L[4]=Y[$+4],L[5]=Y[$+5],L[6]=Y[$+6],L[7]=Y[$+7],L[8]=Y[$+8],L},e.fromColumns=function o(L,Y,$,Z){return L[0]=Y[0],L[1]=Y[1],L[2]=Y[2],L[3]=$[0],L[4]=$[1],L[5]=$[2],L[6]=Z[0],L[7]=Z[1],L[8]=Z[2],L},e.fromMat4=s,e.create=function u(L,Y,$,Z,q,z,te,ae,fe){var he=t();return he[0]=L,he[1]=Y,he[2]=$,he[3]=Z,he[4]=q,he[5]=z,he[6]=te,he[7]=ae,he[8]=fe,he};var c=r();function p(L,Y,$){for(var Z=0;Z<9;Z++)if(Math.abs(L[Z]-Y[Z])>$)return!1;return!0}function v(L,Y){return L[0]=Y[0],L[1]=Y[1],L[2]=Y[2],L[3]=Y[3],L[4]=Y[4],L[5]=Y[5],L[6]=Y[6],L[7]=Y[7],L[8]=Y[8],L}function g(L,Y){if(L===Y){var $=Y[1],Z=Y[2],q=Y[5];L[1]=Y[3],L[2]=Y[6],L[3]=$,L[5]=Y[7],L[6]=Z,L[7]=q}else L[0]=Y[0],L[1]=Y[3],L[2]=Y[6],L[3]=Y[1],L[4]=Y[4],L[5]=Y[7],L[6]=Y[2],L[7]=Y[5],L[8]=Y[8];return L}function y(L,Y){var $=Y[0],Z=Y[1],q=Y[2],z=Y[3],te=Y[4],ae=Y[5],fe=Y[6],he=Y[7],pe=Y[8],re=pe*te-ae*he,ee=-pe*z+ae*fe,ue=he*z-te*fe,ge=$*re+Z*ee+q*ue;return ge?(L[0]=re*(ge=1/ge),L[1]=(-pe*Z+q*he)*ge,L[2]=(ae*Z-q*te)*ge,L[3]=ee*ge,L[4]=(pe*$-q*fe)*ge,L[5]=(-ae*$+q*z)*ge,L[6]=ue*ge,L[7]=(-he*$+Z*fe)*ge,L[8]=(te*$-Z*z)*ge,L):(console.warn("non-invertible matrix.",Y),L)}function C(L){var q=L[3],z=L[4],te=L[5],ae=L[6],fe=L[7],he=L[8];return L[0]*(he*z-te*fe)+L[1]*(-he*q+te*ae)+L[2]*(fe*q-z*ae)}function x(L){return L[0]+L[4]+L[8]}function A(L,Y,$){return L[0]=Y[0]-$[0],L[1]=Y[1]-$[1],L[2]=Y[2]-$[2],L[3]=Y[3]-$[3],L[4]=Y[4]-$[4],L[5]=Y[5]-$[5],L[6]=Y[6]-$[6],L[7]=Y[7]-$[7],L[8]=Y[8]-$[8],L}function M(L,Y,$){return L[0]=Y[0]*$,L[1]=Y[1]*$,L[2]=Y[2]*$,L[3]=Y[3]*$,L[4]=Y[4]*$,L[5]=Y[5]*$,L[6]=Y[6]*$,L[7]=Y[7]*$,L[8]=Y[8]*$,L}e.isIdentity=function l(L,Y){return p(L,c,typeof Y>"u"?gn:Y)},e.hasNaN=function d(L){for(var Y=0;Y<9;Y++)if(isNaN(L[Y]))return!0;return!1},e.clone=function f(L){return v(t(),L)},e.areEqual=p,e.setValue=function h(L,Y,$,Z){L[3*$+Y]=Z},e.getValue=function m(L,Y,$){return L[3*$+Y]},e.copy=v,e.transpose=g,e.invert=y,e.symmtricFromUpper=function b(L,Y){return L===Y?(L[3]=Y[1],L[6]=Y[2],L[7]=Y[5]):(L[0]=Y[0],L[1]=Y[1],L[2]=Y[2],L[3]=Y[1],L[4]=Y[4],L[5]=Y[5],L[6]=Y[2],L[7]=Y[5],L[8]=Y[8]),L},e.symmtricFromLower=function _(L,Y){return L===Y?(L[1]=Y[3],L[2]=Y[6],L[5]=Y[7]):(L[0]=Y[0],L[1]=Y[3],L[2]=Y[6],L[3]=Y[3],L[4]=Y[4],L[5]=Y[7],L[6]=Y[6],L[7]=Y[7],L[8]=Y[8]),L},e.determinant=C,e.trace=x,e.sub=A,e.add=function T(L,Y,$){return L[0]=Y[0]+$[0],L[1]=Y[1]+$[1],L[2]=Y[2]+$[2],L[3]=Y[3]+$[3],L[4]=Y[4]+$[4],L[5]=Y[5]+$[5],L[6]=Y[6]+$[6],L[7]=Y[7]+$[7],L[8]=Y[8]+$[8],L},e.mul=function w(L,Y,$){var Z=Y[0],q=Y[1],z=Y[2],te=Y[3],ae=Y[4],fe=Y[5],he=Y[6],pe=Y[7],re=Y[8],ee=$[0],ue=$[1],ge=$[2],Ce=$[3],ze=$[4],je=$[5],V=$[6],J=$[7],ye=$[8];return L[0]=ee*Z+ue*te+ge*he,L[1]=ee*q+ue*ae+ge*pe,L[2]=ee*z+ue*fe+ge*re,L[3]=Ce*Z+ze*te+je*he,L[4]=Ce*q+ze*ae+je*pe,L[5]=Ce*z+ze*fe+je*re,L[6]=V*Z+J*te+ye*he,L[7]=V*q+J*ae+ye*pe,L[8]=V*z+J*fe+ye*re,L},e.subScalar=function E(L,Y,$){return L[0]=Y[0]-$,L[1]=Y[1]-$,L[2]=Y[2]-$,L[3]=Y[3]-$,L[4]=Y[4]-$,L[5]=Y[5]-$,L[6]=Y[6]-$,L[7]=Y[7]-$,L[8]=Y[8]-$,L},e.addScalar=function I(L,Y,$){return L[0]=Y[0]+$,L[1]=Y[1]+$,L[2]=Y[2]+$,L[3]=Y[3]+$,L[4]=Y[4]+$,L[5]=Y[5]+$,L[6]=Y[6]+$,L[7]=Y[7]+$,L[8]=Y[8]+$,L},e.mulScalar=M;var F=Math.PI/3,N=t();e.symmetricEigenvalues=function j(L,Y){var $=Y[1]*Y[1]+Y[2]*Y[2]+Y[5]*Y[5];if(0===$)L[0]=Y[0],L[1]=Y[4],L[2]=Y[8];else{var Z=x(Y)/3,q=Y[0]-Z,z=Y[4]-Z,te=Y[8]-Z,fe=Math.sqrt((q*q+z*z+te*te+2*$)/6);M(N,e.Identity,Z),A(N,Y,N),M(N,N,1/fe);var he=C(N)/2,pe=he<=-1?F:he>=1?0:Math.acos(he)/3;L[0]=Z+2*fe*Math.cos(pe),L[2]=Z+2*fe*Math.cos(pe+2*F),L[1]=3*Z-L[0]-L[2]}return L};var k=[.1,0,0],H=[.1,0,0],G=[.1,0,0],U=[.1,0,0],Q=[.1,0,0],W=[.1,0,0];e.eigenvector=function K(L,Y,$){S.set(k,Y[0]-$,Y[1],Y[2]),S.set(H,Y[1],Y[4]-$,Y[5]),S.set(G,Y[2],Y[5],Y[8]-$),S.cross(U,k,H),S.cross(Q,k,G),S.cross(W,H,G);var Z=S.dot(U,U),q=S.dot(Q,Q),z=S.dot(W,W),te=Z,ae=0;return q>te&&(te=q,ae=1),z>te&&(ae=2),0===ae?S.scale(L,U,1/Math.sqrt(Z)):1===ae?S.scale(L,Q,1/Math.sqrt(q)):S.scale(L,W,1/Math.sqrt(z)),L},e.directionTransform=function ne(L,Y){return s(L,Y),y(L,L),g(L,L),L},e.Identity=r(),e.innerProduct=function X(L,Y){return L[0]*Y[0]+L[1]*Y[1]+L[2]*Y[2]+L[3]*Y[3]+L[4]*Y[4]+L[5]*Y[5]+L[6]*Y[6]+L[7]*Y[7]+L[8]*Y[8]}}(Qt||(Qt={})),function(e){function t(){var T=[.1,0];return T[0]=0,T}e.zero=t,e.clone=function r(T){var w=t();return w[0]=T[0],w[1]=T[1],w},e.create=function n(T,w){var E=t();return E[0]=T,E[1]=w,E},e.hasNaN=function a(T){return isNaN(T[0])||isNaN(T[1])},e.toArray=function i(T,w,E){return w[E+0]=T[0],w[E+1]=T[1],w},e.fromArray=function o(T,w,E){return T[0]=w[E+0],T[1]=w[E+1],T},e.copy=function s(T,w){return T[0]=w[0],T[1]=w[1],T},e.set=function u(T,w,E){return T[0]=w,T[1]=E,T},e.add=function c(T,w,E){return T[0]=w[0]+E[0],T[1]=w[1]+E[1],T},e.sub=function l(T,w,E){return T[0]=w[0]-E[0],T[1]=w[1]-E[1],T},e.mul=function d(T,w,E){return T[0]=w[0]*E[0],T[1]=w[1]*E[1],T},e.div=function f(T,w,E){return T[0]=w[0]/E[0],T[1]=w[1]/E[1],T},e.scale=function p(T,w,E){return T[0]=w[0]*E,T[1]=w[1]*E,T},e.round=function h(T,w){return T[0]=Math.round(w[0]),T[1]=Math.round(w[1]),T},e.ceil=function m(T,w){return T[0]=Math.ceil(w[0]),T[1]=Math.ceil(w[1]),T},e.floor=function v(T,w){return T[0]=Math.floor(w[0]),T[1]=Math.floor(w[1]),T},e.distance=function g(T,w){var E=w[0]-T[0],I=w[1]-T[1];return Math.sqrt(E*E+I*I)},e.squaredDistance=function y(T,w){var E=w[0]-T[0],I=w[1]-T[1];return E*E+I*I},e.magnitude=function b(T){var w=T[0],E=T[1];return Math.sqrt(w*w+E*E)},e.squaredMagnitude=function _(T){var w=T[0],E=T[1];return w*w+E*E},e.inverse=function C(T,w){return T[0]=1/w[0],T[1]=1/w[1],T},e.areEqual=function x(T,w){return T[0]===w[0]&&T[1]===w[1]},e.toString=function A(T,w){return"[".concat(T[0].toPrecision(w)," ").concat(T[1].toPrecision(w),"}]")}}(Ne||(Ne={})),function(e){function t(){var M=[.1,0,0,0];return M[0]=0,M}function a(M,F){return M[0]=F.center[0],M[1]=F.center[1],M[2]=F.center[2],M[3]=F.radius,M}e.zero=t,e.clone=function r(M){var F=t();return F[0]=M[0],F[1]=M[1],F[2]=M[2],F[3]=M[3],F},e.create=function n(M,F,N,j){var k=t();return k[0]=M,k[1]=F,k[2]=N,k[3]=j,k},e.fromSphere=a,e.ofSphere=function i(M){return a(t(),M)},e.hasNaN=function o(M){return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])},e.toArray=function s(M,F,N){return F[N+0]=M[0],F[N+1]=M[1],F[N+2]=M[2],F[N+3]=M[3],F},e.fromArray=function u(M,F,N){return M[0]=F[N+0],M[1]=F[N+1],M[2]=F[N+2],M[3]=F[N+3],M},e.toVec3Array=function c(M,F,N){F[N+0]=M[0],F[N+1]=M[1],F[N+2]=M[2]},e.fromVec3Array=function l(M,F,N){return M[0]=F[N+0],M[1]=F[N+1],M[2]=F[N+2],M[3]=0,M},e.copy=function d(M,F){return M[0]=F[0],M[1]=F[1],M[2]=F[2],M[3]=F[3],M},e.set=function f(M,F,N,j,k){return M[0]=F,M[1]=N,M[2]=j,M[3]=k,M},e.add=function p(M,F,N){return M[0]=F[0]+N[0],M[1]=F[1]+N[1],M[2]=F[2]+N[2],M[3]=F[3]+N[3],M},e.distance=function h(M,F){var N=F[0]-M[0],j=F[1]-M[1],k=F[2]-M[2],H=F[3]-M[3];return Math.sqrt(N*N+j*j+k*k+H*H)},e.scale=function m(M,F,N){return M[0]=F[0]*N,M[1]=F[1]*N,M[2]=F[2]*N,M[4]=F[4]*N,M},e.round=function v(M,F){return M[0]=Math.round(F[0]),M[1]=Math.round(F[1]),M[2]=Math.round(F[2]),M[3]=Math.round(F[3]),M},e.ceil=function g(M,F){return M[0]=Math.ceil(F[0]),M[1]=Math.ceil(F[1]),M[2]=Math.ceil(F[2]),M[3]=Math.ceil(F[3]),M},e.floor=function y(M,F){return M[0]=Math.floor(F[0]),M[1]=Math.floor(F[1]),M[2]=Math.floor(F[2]),M[3]=Math.floor(F[3]),M},e.squaredDistance=function b(M,F){var N=F[0]-M[0],j=F[1]-M[1],k=F[2]-M[2],H=F[3]-M[3];return N*N+j*j+k*k+H*H},e.norm=function _(M){var F=M[0],N=M[1],j=M[2],k=M[3];return Math.sqrt(F*F+N*N+j*j+k*k)},e.squaredNorm=function C(M){var F=M[0],N=M[1],j=M[2],k=M[3];return F*F+N*N+j*j+k*k},e.transformMat4=function x(M,F,N){var j=F[0],k=F[1],H=F[2],G=F[3];return M[0]=N[0]*j+N[4]*k+N[8]*H+N[12]*G,M[1]=N[1]*j+N[5]*k+N[9]*H+N[13]*G,M[2]=N[2]*j+N[6]*k+N[10]*H+N[14]*G,M[3]=N[3]*j+N[7]*k+N[11]*H+N[15]*G,M},e.dot=function A(M,F){return M[0]*F[0]+M[1]*F[1]+M[2]*F[2]+M[3]*F[3]},e.inverse=function T(M,F){return M[0]=1/F[0],M[1]=1/F[1],M[2]=1/F[2],M[3]=1/F[3],M},e.exactEquals=function w(M,F){return M[0]===F[0]&&M[1]===F[1]&&M[2]===F[2]&&M[3]===F[3]},e.equals=function E(M,F){var N=M[0],j=M[1],k=M[2],H=M[3],G=F[0],U=F[1],Q=F[2],W=F[3];return Math.abs(N-G)<=gn*Math.max(1,Math.abs(N),Math.abs(G))&&Math.abs(j-U)<=gn*Math.max(1,Math.abs(j),Math.abs(U))&&Math.abs(k-Q)<=gn*Math.max(1,Math.abs(k),Math.abs(Q))&&Math.abs(H-W)<=gn*Math.max(1,Math.abs(H),Math.abs(W))},e.toString=function I(M,F){return"[".concat(M[0].toPrecision(F)," ").concat(M[1].toPrecision(F)," ").concat(M[2].toPrecision(F),"  ").concat(M[3].toPrecision(F),"]")}}(fr||(fr={})),function(e){function t(){var X=[.1,0,0,0];return X[0]=0,X}function r(){var X=t();return X[3]=1,X}function o(X,L,Y){Y*=.5;var $=Math.sin(Y);return X[0]=$*L[0],X[1]=$*L[1],X[2]=$*L[2],X[3]=Math.cos(Y),X}function p(X,L,Y,$){var re,ee,ue,ge,Ce,Z=L[0],q=L[1],z=L[2],te=L[3],ae=Y[0],fe=Y[1],he=Y[2],pe=Y[3];return(ee=Z*ae+q*fe+z*he+te*pe)<0&&(ee=-ee,ae=-ae,fe=-fe,he=-he,pe=-pe),1-ee>1e-6?(re=Math.acos(ee),ue=Math.sin(re),ge=Math.sin((1-$)*re)/ue,Ce=Math.sin($*re)/ue):(ge=1-$,Ce=$),X[0]=ge*Z+Ce*ae,X[1]=ge*q+Ce*fe,X[2]=ge*z+Ce*he,X[3]=ge*te+Ce*pe,X}function g(X,L){var $,Y=L[0]+L[4]+L[8];if(Y>0)$=Math.sqrt(Y+1),X[3]=.5*$,X[0]=(L[5]-L[7])*($=.5/$),X[1]=(L[6]-L[2])*$,X[2]=(L[1]-L[3])*$;else{var Z=0;L[4]>L[0]&&(Z=1),L[8]>L[3*Z+Z]&&(Z=2);var q=(Z+1)%3,z=(Z+2)%3;$=Math.sqrt(L[3*Z+Z]-L[3*q+q]-L[3*z+z]+1),X[Z]=.5*$,X[3]=(L[3*q+z]-L[3*z+q])*($=.5/$),X[q]=(L[3*q+Z]+L[3*Z+q])*$,X[z]=(L[3*z+Z]+L[3*Z+z])*$}return X}e.zero=t,e.identity=r,e.setIdentity=function n(X){X[0]=0,X[1]=0,X[2]=0,X[3]=1},e.hasNaN=function a(X){return isNaN(X[0])||isNaN(X[1])||isNaN(X[2])||isNaN(X[3])},e.create=function i(X,L,Y,$){var Z=r();return Z[0]=X,Z[1]=L,Z[2]=Y,Z[3]=$,Z},e.setAxisAngle=o,e.getAxisAngle=function s(X,L){var Y=2*Math.acos(L[3]),$=Math.sin(Y/2);return 0!==$?(X[0]=L[0]/$,X[1]=L[1]/$,X[2]=L[2]/$):(X[0]=1,X[1]=0,X[2]=0),Y},e.multiply=function u(X,L,Y){var $=L[0],Z=L[1],q=L[2],z=L[3],te=Y[0],ae=Y[1],fe=Y[2],he=Y[3];return X[0]=$*he+z*te+Z*fe-q*ae,X[1]=Z*he+z*ae+q*te-$*fe,X[2]=q*he+z*fe+$*ae-Z*te,X[3]=z*he-$*te-Z*ae-q*fe,X},e.rotateX=function c(X,L,Y){Y*=.5;var $=L[0],Z=L[1],q=L[2],z=L[3],te=Math.sin(Y),ae=Math.cos(Y);return X[0]=$*ae+z*te,X[1]=Z*ae+q*te,X[2]=q*ae-Z*te,X[3]=z*ae-$*te,X},e.rotateY=function l(X,L,Y){Y*=.5;var $=L[0],Z=L[1],q=L[2],z=L[3],te=Math.sin(Y),ae=Math.cos(Y);return X[0]=$*ae-q*te,X[1]=Z*ae+z*te,X[2]=q*ae+$*te,X[3]=z*ae-Z*te,X},e.rotateZ=function d(X,L,Y){Y*=.5;var $=L[0],Z=L[1],q=L[2],z=L[3],te=Math.sin(Y),ae=Math.cos(Y);return X[0]=$*ae+Z*te,X[1]=Z*ae-$*te,X[2]=q*ae+z*te,X[3]=z*ae-q*te,X},e.calculateW=function f(X,L){var Y=L[0],$=L[1],Z=L[2];return X[0]=Y,X[1]=$,X[2]=Z,X[3]=Math.sqrt(Math.abs(1-Y*Y-$*$-Z*Z)),X},e.slerp=p,e.invert=function h(X,L){var Y=L[0],$=L[1],Z=L[2],q=L[3],z=Y*Y+$*$+Z*Z+q*q,te=z?1/z:0;return X[0]=-Y*te,X[1]=-$*te,X[2]=-Z*te,X[3]=q*te,X},e.conjugate=function m(X,L){return X[0]=-L[0],X[1]=-L[1],X[2]=-L[2],X[3]=L[3],X},e.dot=function v(X,L){return X[0]*L[0]+X[1]*L[1]+X[2]*L[2]+X[3]*L[3]},e.fromMat3=g,e.fromEuler=function y(X,L,Y){var $=L[0],Z=L[1],q=L[2],z=Math.cos($/2),te=Math.cos(Z/2),ae=Math.cos(q/2),fe=Math.sin($/2),he=Math.sin(Z/2),pe=Math.sin(q/2);switch(Y){case"XYZ":X[0]=fe*te*ae+z*he*pe,X[1]=z*he*ae-fe*te*pe,X[2]=z*te*pe+fe*he*ae,X[3]=z*te*ae-fe*he*pe;break;case"YXZ":X[0]=fe*te*ae+z*he*pe,X[1]=z*he*ae-fe*te*pe,X[2]=z*te*pe-fe*he*ae,X[3]=z*te*ae+fe*he*pe;break;case"ZXY":X[0]=fe*te*ae-z*he*pe,X[1]=z*he*ae+fe*te*pe,X[2]=z*te*pe+fe*he*ae,X[3]=z*te*ae-fe*he*pe;break;case"ZYX":X[0]=fe*te*ae-z*he*pe,X[1]=z*he*ae+fe*te*pe,X[2]=z*te*pe-fe*he*ae,X[3]=z*te*ae+fe*he*pe;break;case"YZX":X[0]=fe*te*ae+z*he*pe,X[1]=z*he*ae+fe*te*pe,X[2]=z*te*pe-fe*he*ae,X[3]=z*te*ae-fe*he*pe;break;case"XZY":X[0]=fe*te*ae-z*he*pe,X[1]=z*he*ae-fe*te*pe,X[2]=z*te*pe+fe*he*ae,X[3]=z*te*ae+fe*he*pe;break;default:xn()}return X};var b=[0,0,0];function F(X,L){var Y=L[0],$=L[1],Z=L[2],q=L[3],z=Y*Y+$*$+Z*Z+q*q;return z>0&&(z=1/Math.sqrt(z),X[0]=Y*z,X[1]=$*z,X[2]=Z*z,X[3]=q*z),X}e.fromUnitVec3=function _(X,L,Y){var $=S.dot(L,Y)+1;return $<gn?($=0,Math.abs(L[0])>Math.abs(L[2])?S.set(b,-L[1],L[0],0):S.set(b,0,-L[2],L[1])):S.cross(b,L,Y),X[0]=b[0],X[1]=b[1],X[2]=b[2],X[3]=$,F(X,X),X},e.clone=function C(X){var L=t();return L[0]=X[0],L[1]=X[1],L[2]=X[2],L[3]=X[3],L},e.toArray=function x(X,L,Y){return L[Y+0]=X[0],L[Y+1]=X[1],L[Y+2]=X[2],L[Y+3]=X[3],L},e.fromArray=function A(X,L,Y){return X[0]=L[Y+0],X[1]=L[Y+1],X[2]=L[Y+2],X[3]=L[Y+3],X},e.copy=function T(X,L){return X[0]=L[0],X[1]=L[1],X[2]=L[2],X[3]=L[3],X},e.set=function w(X,L,Y,$,Z){return X[0]=L,X[1]=Y,X[2]=$,X[3]=Z,X},e.exactEquals=function E(X,L){return X[0]===L[0]&&X[1]===L[1]&&X[2]===L[2]&&X[3]===L[3]},e.equals=function I(X,L){var Y=X[0],$=X[1],Z=X[2],q=X[3],z=L[0],te=L[1],ae=L[2],fe=L[3];return Math.abs(Y-z)<=gn*Math.max(1,Math.abs(Y),Math.abs(z))&&Math.abs($-te)<=gn*Math.max(1,Math.abs($),Math.abs(te))&&Math.abs(Z-ae)<=gn*Math.max(1,Math.abs(Z),Math.abs(ae))&&Math.abs(q-fe)<=gn*Math.max(1,Math.abs(q),Math.abs(fe))},e.add=function M(X,L,Y){return X[0]=L[0]+Y[0],X[1]=L[1]+Y[1],X[2]=L[2]+Y[2],X[3]=L[3]+Y[3],X},e.normalize=F;var N=[0,0,0],j=[1,0,0],k=[0,1,0];e.rotationTo=function H(X,L,Y){var $=S.dot(L,Y);return $<-.999999?(S.cross(N,j,L),S.magnitude(N)<1e-6&&S.cross(N,k,L),S.normalize(N,N),o(X,N,Math.PI),X):$>.999999?(X[0]=0,X[1]=0,X[2]=0,X[3]=1,X):(S.cross(N,L,Y),X[0]=N[0],X[1]=N[1],X[2]=N[2],X[3]=1+$,F(X,X))};var G=t(),U=t();e.sqlerp=function Q(X,L,Y,$,Z,q){return p(G,L,Z,q),p(U,Y,$,q),p(X,G,U,2*q*(1-q)),X};var W=[0,0,0,0,0,0,0,0,0];e.setAxes=function K(X,L,Y,$){return W[0]=Y[0],W[3]=Y[1],W[6]=Y[2],W[1]=$[0],W[4]=$[1],W[7]=$[2],W[2]=-L[0],W[5]=-L[1],W[8]=-L[2],F(X,g(X,W))},e.toString=function ne(X,L){return"[".concat(X[0].toPrecision(L)," ").concat(X[1].toPrecision(L)," ").concat(X[2].toPrecision(L),"  ").concat(X[3].toPrecision(L),"]")},e.Identity=r()}(yn||(yn={})),function(e){function n(C,x,A){var T=function t(C,x,A){for(var T=[],w=0;w<x.length;w++)T[w]=x[x.length-w-1];var E=[1];for(w=1;w<C.length;w++)E[w]=C[T[w-1]];return{dimensions:C,axisOrderFastToSlow:T,axisOrderSlowToFast:x,accessDimensions:E,defaultCtor:A||Float64Array}}(C,x,A),w=function p(C){var x=C.dimensions,A=C.axisOrderFastToSlow;switch(x.length){case 1:return{get:function(Z,q){return Z[q]},set:function(Z,q,z){return Z[q]=z},add:function(Z,q,z){return Z[q]+=z},dataOffset:function(Z){return Z},getCoords:function(Z,q){return q[0]=Z,q}};case 2:if(0===A[0]&&1===A[1]){var T=x[0];return{get:function(Z,q,z){return Z[z*T+q]},set:function(Z,q,z,te){return Z[z*T+q]=te},add:function(Z,q,z,te){return Z[z*T+q]+=te},dataOffset:function(Z,q){return q*T+Z},getCoords:function(Z,q){return q[0]=Z%T,q[1]=Math.floor(Z/T),q}}}if(1===A[0]&&0===A[1]){var w=x[1];return{get:function(Z,q,z){return Z[q*w+z]},set:function(Z,q,z,te){return Z[q*w+z]=te},add:function(Z,q,z,te){return Z[q*w+z]+=te},dataOffset:function(Z,q){return Z*w+q},getCoords:function(Z,q){return q[0]=Math.floor(Z/w),q[1]=Z%w,q}}}throw new Error("bad axis order");case 3:if(0===A[0]&&1===A[1]&&2===A[2]){var E=x[0],I=x[1],M=E*I;return{get:function(Z,q,z,te){return Z[q+z*E+te*M]},set:function(Z,q,z,te,ae){return Z[q+z*E+te*M]=ae},add:function(Z,q,z,te,ae){return Z[q+z*E+te*M]+=ae},dataOffset:function(Z,q,z){return Z+q*E+z*M},getCoords:function(Z,q){var z=Math.floor(Z/E);return q[0]=Z%E,q[1]=z%I,q[2]=Math.floor(z/I),q}}}if(0===A[0]&&2===A[1]&&1===A[2]){var F=x[0],N=x[2],j=F*N;return{get:function(Z,q,z,te){return Z[q+te*F+z*j]},set:function(Z,q,z,te,ae){return Z[q+te*F+z*j]=ae},add:function(Z,q,z,te,ae){return Z[q+te*F+z*j]+=ae},dataOffset:function(Z,q,z){return Z+z*F+q*j},getCoords:function(Z,q){var z=Math.floor(Z/F);return q[0]=Z%F,q[1]=Math.floor(z/N),q[2]=z%N,q}}}if(1===A[0]&&0===A[1]&&2===A[2]){var k=x[1],H=x[0],G=k*H;return{get:function(Z,q,z,te){return Z[z+q*k+te*G]},set:function(Z,q,z,te,ae){return Z[z+q*k+te*G]=ae},add:function(Z,q,z,te,ae){return Z[z+q*k+te*G]+=ae},dataOffset:function(Z,q,z){return q+Z*k+z*G},getCoords:function(Z,q){var z=Math.floor(Z/k);return q[0]=z%H,q[1]=Z%k,q[2]=Math.floor(z/H),q}}}if(1===A[0]&&2===A[1]&&0===A[2]){var U=x[1],Q=x[2],W=U*Q;return{get:function(Z,q,z,te){return Z[z+te*U+q*W]},set:function(Z,q,z,te,ae){return Z[z+te*U+q*W]=ae},add:function(Z,q,z,te,ae){return Z[z+te*U+q*W]+=ae},dataOffset:function(Z,q,z){return q+z*U+Z*W},getCoords:function(Z,q){var z=Math.floor(Z/U);return q[0]=Math.floor(z/Q),q[1]=Z%U,q[2]=z%Q,q}}}if(2===A[0]&&0===A[1]&&1===A[2]){var K=x[2],ne=x[0],X=K*ne;return{get:function(Z,q,z,te){return Z[te+q*K+z*X]},set:function(Z,q,z,te,ae){return Z[te+q*K+z*X]=ae},add:function(Z,q,z,te,ae){return Z[te+q*K+z*X]+=ae},dataOffset:function(Z,q,z){return z+Z*K+q*X},getCoords:function(Z,q){var z=Math.floor(Z/K);return q[0]=z%ne,q[1]=Math.floor(z/ne),q[2]=Z%K,q}}}if(2===A[0]&&1===A[1]&&0===A[2]){var L=x[2],Y=x[1],$=L*Y;return{get:function(Z,q,z,te){return Z[te+z*L+q*$]},set:function(Z,q,z,te,ae){return Z[te+z*L+q*$]=ae},add:function(Z,q,z,te,ae){return Z[te+z*L+q*$]+=ae},dataOffset:function(Z,q,z){return z+q*L+Z*$},getCoords:function(Z,q){var z=Math.floor(Z/L);return q[0]=Math.floor(z/Y),q[1]=z%Y,q[2]=Z%L,q}}}throw new Error("bad axis order");default:return{get:function(Z){for(var q=[],z=1;z<arguments.length;z++)q[z-1]=arguments[z];return Z[m(C,q)]},set:function(Z){for(var q=[],z=1;z<arguments.length;z++)q[z-1]=arguments[z];return Z[m(C,q)]=q[q.length-1]},add:function(Z){for(var q=[],z=1;z<arguments.length;z++)q[z-1]=arguments[z];return Z[m(C,q)]+=q[q.length-1]},dataOffset:function(){for(var Z=[],q=0;q<arguments.length;q++)Z[q]=arguments[q];return m(C,Z)},getCoords:function(Z,q){return function v(C,x,A){for(var T=C.dimensions,w=C.axisOrderFastToSlow,E=T.length,I=x,M=0;M<E;M++){var F=T[w[M]];A[w[M]]=I%F,I=Math.floor(I/F)}return A[w[E+1]]=I,A}(C,Z,q)}}}}(T),E=w.get,I=w.set,M=w.add,F=w.dataOffset,N=w.getCoords;return{rank:C.length,dimensions:C,axisOrderSlowToFast:x,create:h(T),get:E,set:I,add:M,dataOffset:F,getCoords:N}}function h(C){for(var x=C.dimensions,A=1,T=0,w=x.length;T<w;T++)A*=x[T];return function(E){return new(E||C.defaultCtor)(A)}}function m(C,x){for(var A=C.accessDimensions,T=C.axisOrderFastToSlow,w=A.length-1,E=A[w]*x[T[w]],I=w-1;I>=0;I--)E=(E+x[T[I]])*A[I];return E}function y(C,x){for(var A=[],T=0;T<C.length;T++)A[T]=C[x[T]];return A}e.create=function r(C,x){return{space:C,data:x}},e.Space=n,e.Data1=function a(C){return C},e.Vector=function i(C,x){return n([C],[0],x)},e.ColumnMajorMatrix=function o(C,x,A){return n([C,x],[1,0],A)},e.RowMajorMatrix=function s(C,x,A){return n([C,x],[0,1],A)},e.toMat4=function u(C,x,A){if(2!==x.rank)throw new Error("Invalid tensor rank");for(var T=Math.min(4,x.dimensions[0]),w=Math.min(4,x.dimensions[1]),E=0;E<T;E++)for(var I=0;I<w;I++)me.setValue(C,E,I,x.get(A,E,I));return C},e.toMat3=function c(C,x,A){if(2!==x.rank)throw new Error("Invalid tensor rank");for(var T=Math.min(3,x.dimensions[0]),w=Math.min(3,x.dimensions[1]),E=0;E<T;E++)for(var I=0;I<w;I++)Qt.setValue(C,E,I,x.get(A,E,I));return C},e.toVec3=function l(C,x,A){if(1!==x.rank)throw new Error("Invalid tensor rank");for(var T=Math.min(3,x.dimensions[0]),w=0;w<T;w++)C[w]=A[w];return C},e.toVec4=function d(C,x,A){if(1!==x.rank)throw new Error("Invalid tensor rank");for(var T=Math.min(4,x.dimensions[0]),w=0;w<T;w++)C[w]=A[w];return C},e.areEqualExact=function f(C,x){var A=C.length;if(A!==x.length)return!1;for(var T=0;T<A;T++)if(C[T]!==x[T])return!1;return!0},e.invertAxisOrder=function g(C){for(var x=[],A=0;A<C.length;A++)x[A]=C[C.length-A-1];return x},e.convertToCanonicalAxisIndicesFastToSlow=function b(C){for(var x=new Int32Array(C.length),A=0;A<C.length;A++)x[C[A]]=A;return function(T){return y(T,x)}},e.convertToCanonicalAxisIndicesSlowToFast=function _(C){for(var x=new Int32Array(C.length),A=0;A<C.length;A++)x[C[C.length-A-1]]=A;return function(T){return y(T,x)}}}(Cr||(Cr={})),function(e){var t;function n(E,I){return eX(I.T,E,I,1)}function i(E){return YA(E)}!function(E){function N(U,Q){return void 0===Q&&(Q=E.float),{"@type":"tensor",T:U.create(),space:U,valueType:"tensor",baseType:Q}}E.str={"@type":"str",T:"",valueType:"str"},E.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},E.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},E.int={"@type":"int",T:0,valueType:"int"},E.coord={"@type":"coord",T:0,valueType:"float"},E.float={"@type":"float",T:0,valueType:"float"},E.Str=function I(U){var Q;return{"@type":"str",T:null!==(Q=U?.defaultValue)&&void 0!==Q?Q:"",transform:U?.transform,valueType:"str"}},E.Int=function M(U){return void 0===U&&(U=0),{"@type":"int",T:U,valueType:"int"}},E.Float=function F(U){return void 0===U&&(U=0),{"@type":"float",T:U,valueType:"float"}},E.Tensor=N,E.Vector=function j(U,Q){return void 0===Q&&(Q=E.float),N(Cr.Vector(U,"int"===Q["@type"]?Int32Array:Float64Array),Q)},E.Matrix=function k(U,Q,W){return void 0===W&&(W=E.float),N(Cr.ColumnMajorMatrix(U,Q,"int"===W["@type"]?Int32Array:Float64Array),W)},E.Aliased=function H(U){return U},E.List=function G(U,Q,W){return void 0===W&&(W=[]),{"@type":"list",T:W,separator:U,itemParse:Q,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function r(E){return!!E&&!!E.schema&&!!E.value},e.ValueKind={Present:0,NotPresent:1,Unknown:2},e.Undefined=n,e.ofConst=function a(E,I,M){return eX(E,I,M,0)},e.ofLambda=i,e.range=function o(E,I){return i({value:function(M){return M+E},rowCount:Math.max(I-E+1,0),schema:t.int})},e.ofArray=function s(E){return Qf(E)},e.ofIntArray=function u(E){return Qf({array:E,schema:t.int})},e.ofFloatArray=function c(E){return Qf({array:E,schema:t.float})},e.ofStringArray=function l(E){return Qf({array:E,schema:t.str})},e.ofStringAliasArray=function d(E){return Qf({array:E,schema:t.Aliased(t.str)})},e.ofStringListArray=function f(E,I){return void 0===I&&(I=","),Qf({array:E,schema:t.List(I,function(M){return M})})},e.ofIntTokens=function p(E){var M=E.data,F=E.indices;return YA({value:function(N){return Lh(M,F[2*N],F[2*N+1])||0},rowCount:E.count,schema:t.int})},e.ofFloatTokens=function h(E){var M=E.data,F=E.indices;return YA({value:function(N){return Zf(M,F[2*N],F[2*N+1])||0},rowCount:E.count,schema:t.float})},e.ofStringTokens=function m(E){var M=E.data,F=E.indices;return YA({value:function(N){var j=M.substring(F[2*N],F[2*N+1]);return"."===j||"?"===j?"":j},rowCount:E.count,schema:t.str})},e.window=function v(E,I,M){return function NDe(e,t,r){return e.isDefined?0===t&&r===e.rowCount?e:e.__array&&XF(e.__array)?function kDe(e,t,r){var n=HA(e.__array,{start:t,end:r}),a=e.valueKind;return Qf({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}(e,t,r):function BDe(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=0===t?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:0===t?a:function(u){return a(u+t)},toArray:function(u){for(var c=h2(s,u).array,l=0,d=c.length;l<d;l++)c[l]=n(l+t);return c},areValuesEqual:0===t?i:function(u,c){return i(u+t,c+t)}}}(e,t,r):ie.Undefined(r-t,e.schema)}(E,I,M)},e.view=function g(E,I,M){return void 0===M&&(M=!0),function UDe(e,t,r){return 0===e.rowCount||r&&function LDe(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?function VDe(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return Qf({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}(e,t):function zDe(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:function(s){return r(t[s])},valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=h2(o,s).array,c=0,l=u.length;c<l;c++)u[c]=r(t[c]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}(e,t)}(E,I,M)},e.createFirstIndexMap=function y(E){return function ODe(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}(E)},e.createIndexer=function b(E){return function FDe(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}(E)},e.mapToArray=function _(E,I,M){return function GDe(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}(E,I,M||Array)},e.areEqual=function C(E,I){return function HDe(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function jDe(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}(e,t):function qDe(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}(e,t))}(E,I)},e.indicesOf=function x(E,I){return function WDe(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}(E,I)},e.asArrayColumn=function A(E,I){return E.__array?E:E.isDefined?Qf({array:E.toArray({array:I}),schema:E.schema,valueKind:E.valueKind}):n(E.rowCount,E.schema)},e.copyToArray=function T(E,I,M){if(void 0===M&&(M=0),E.isDefined){var F=E.__array;if(F)for(var N=0,j=F.length;N<j;N++)I[M+N]=F[N];else for(N=0,j=E.rowCount;N<j;N++)I[M+N]=E.value(N)}},e.isIdentity=function w(E){for(var I=0,M=E.rowCount;I<M;I++)if(I!==E.value(I))return!1;return!0}}(ie||(ie={})),function(e){function u(_,C,x){var A=Object.create(null),T=Object.keys(C);A._rowCount=x.length,A._columns=T,A._schema=C;for(var w=0,E=T;w<E.length;w++){var I=E[w];A[I]=ie.view(_[I],x)}return A}function m(_,C){for(var x=Object.create(null),A=_._columns,T=0;T<A.length;T++){var w=A[T];x[w]=_[w].value(C)}return x}e.is=function t(_){return _&&"number"==typeof _._rowCount&&!!_._columns&&!!_._schema},e.pickColumns=function r(_,C,x){void 0===x&&(x={});var A=Object.create(null),T=Object.keys(_);A._rowCount=C._rowCount,A._columns=T,A._schema=_;for(var w=0,E=T;w<E.length;w++){var I=E[w];if(C[I])A[I]=C[I];else{if(!x[I])throw Error("Cannot find column '".concat(I,"'."));A[I]=x[I]}}return A},e.ofColumns=function n(_,C){var x=Object.keys(C);return R({_rowCount:C[x[0]].rowCount,_columns:x,_schema:_},C)},e.ofPartialColumns=function a(_,C,x){var A=Object.create(null),T=Object.keys(_);A._rowCount=x,A._columns=T,A._schema=_;for(var w=0,E=T;w<E.length;w++){var I=E[w];A[I]=I in C?C[I]:ie.Undefined(x,_[I])}return A},e.ofUndefinedColumns=function i(_,C){var x=Object.create(null),A=Object.keys(_);x._rowCount=C,x._columns=A,x._schema=_;for(var T=0,w=A;T<w.length;T++){var E=w[T];x[E]=ie.Undefined(C,_[E])}return x},e.ofRows=function o(_,C){var x=Object.create(null),A=C.length,T=Object.keys(_);x._rowCount=A,x._columns=T,x._schema=_;for(var w=function(F){x[F]=ie.ofLambda({rowCount:A,schema:_[F],value:function(N){return C[N][F]},valueKind:function(N){return typeof C[N][F]>"u"?1:0}})},E=0,I=T;E<I.length;E++)w(I[E]);return x},e.ofArrays=function s(_,C){var x,A=Object.create(null),T=Object.keys(_);A._rowCount=0,A._columns=T,A._schema=_;for(var w=0,E=T;w<E.length;w++){var I=E[w];typeof C[I]<"u"?(A[I]=ie.ofArray({array:C[I],schema:_[I]}),A._rowCount=null===(x=C[I])||void 0===x?void 0:x.length):A[I]=ie.Undefined(A._rowCount,_[I])}return A},e.view=u,e.pick=function c(_,C,x){for(var A=[],T=0,w=_._rowCount;T<w;++T)x(T)&&A.push(T);return u(_,C,A)},e.window=function l(_,C,x,A){if(0===x&&A===_._rowCount)return _;var T=Object.create(null),w=Object.keys(C);T._rowCount=A-x,T._columns=w,T._schema=C;for(var E=0,I=w;E<I.length;E++){var M=I[E];T[M]=ie.window(_[M],x,A)}return T},e.concat=function d(_,C){var x=Object.create(null),A=Object.keys(C);x._rowCount=0;for(var T=0,w=_;T<w.length;T++)x._rowCount+=(E=w[T])._rowCount;for(var I={},M=0,F=A;M<F.length;M++)I[F[M]]=new Array(x._rowCount);x._columns=A,x._schema=C;for(var j=0,k=0,H=_;k<H.length;k++){for(var E=H[k],G=0,U=A;G<U.length;G++)ie.copyToArray(E[Q=U[G]],I[Q],j);j+=E._rowCount}for(var W=0,K=A;W<K.length;W++){var Q;x[Q=K[W]]=ie.ofArray({array:I[Q],schema:C[Q]})}return x},e.columnToArray=function f(_,C,x){_[C]=ie.asArrayColumn(_[C],x)},e.sort=function p(_,C){for(var x=new Int32Array(_._rowCount),A=0,T=x.length;A<T;A++)x[A]=A;Rc(x,function(N,j,k){return C(j,k)});var w=!0;for(A=0,T=x.length;A<T;A++)if(x[A]!==A){w=!1;break}if(w)return _;var E=Object.create(null);E._rowCount=_._rowCount,E._columns=_._columns,E._schema=_._schema;for(var I=0,M=_._columns;I<M.length;I++){var F=M[I];E[F]=ie.view(_[F],x,!1)}return E},e.areEqual=function h(_,C){if(_._rowCount!==C._rowCount||_._columns.length!==C._columns.length)return!1;for(var x=0,A=_._columns;x<A.length;x++)if(!C[T=A[x]])return!1;for(var w=0,E=_._columns;w<E.length;w++){var T;if(!ie.areEqual(_[T=E[w]],C[T]))return!1}return!0},e.getRow=m,e.pickRow=function v(_,C){for(var x=0,A=_._rowCount;x<A;++x)if(C(x))return m(_,x)},e.getRows=function g(_){for(var C=[],x=_._rowCount,A=0;A<x;A++)C[A]=m(_,A);return C},e.toArrays=function y(_){for(var C={},x=_._columns,A=0;A<x.length;A++){var T=x[A];C[T]=_[T].toArray()}return C},e.formatToString=function b(_){var C=sn.create(),x=_._columns,A=_._rowCount,T=1;sn.write(C,"|");for(var w=0;w<x.length;w++)sn.write(C,x[w]),sn.write(C,"|"),T+=x[w].length+1;sn.newline(C),sn.write(C,new Array(T+1).join("-")),sn.newline(C);for(var E=0;E<A;E++){for(sn.write(C,"|"),w=0;w<x.length;w++){var I=_[x[w]];0===I.valueKind(E)?(sn.write(C,I.value(E)),sn.write(C,"|")):sn.write(C,".|")}sn.newline(C)}return sn.getString(C)}}(Qr||(Qr={})),function(e){e.ofTables=function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var c=0,l=o;c<l.length;c++){var d=l[c];Qr.is(i[d])&&(s[d]=i[d],u[u.length]=d)}return s},e.getTablesAsRows=function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=Qr.getRows(n[s])}return a}}(eN||(eN={})),function(e){e.create=function t(u,c,l){var d=!!u[0].cell,f=!!u[0].velocities,p=!!u[0].forces;return{id:Gn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:c,timeOffset:l}},e.getAtomicConformation=function r(u,c,l){var d,f,p=u.x,h=u.y,m=u.z;return u.xyzOrdering.frozen?l?u.xyzOrdering.isIdentity?(p=o(p,l),h=o(h,l),m=o(m,l)):Xs(u.xyzOrdering.index,l)||(p=i(p,u.xyzOrdering.index,l),h=i(h,u.xyzOrdering.index,l),m=i(m,u.xyzOrdering.index,l)):u.xyzOrdering.isIdentity||(p=s(p,u.xyzOrdering.index),h=s(h,u.xyzOrdering.index),m=s(m,u.xyzOrdering.index)):l&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=l,a(p,l),a(h,l),a(m,l)):Xs(u.xyzOrdering.index,l)||(p=i(p,u.xyzOrdering.index,l),h=i(h,u.xyzOrdering.index,l),m=i(m,u.xyzOrdering.index,l))),u.xyzOrdering.frozen=!0,{id:Gn.create22(),atomId:c.atomId,occupancy:null!==(d=c.occupancy)&&void 0!==d?d:ie.ofConst(1,u.elementCount,ie.Schema.int),B_iso_or_equiv:null!==(f=c.B_iso_or_equiv)&&void 0!==f?f:ie.ofConst(0,u.elementCount,ie.Schema.float),xyzDefined:!0,x:p,y:h,z:m}};var n=[.123];function a(u,c){for(var l=n,d=0,f=u.length;d<f;d++)l[d]=u[c[d]];for(d=0,f=u.length;d<f;d++)u[d]=l[d]}function i(u,c,l){for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;f++)d[f]=u[c[l[f]]];return d}function o(u,c){for(var l=new Float32Array(u.length),d=0,f=u.length;d<f;d++)l[d]=u[c[d]];return l}function s(u,c){for(var l=new Float32Array(u.length),d=0,f=u.length;d<f;d++)l[c[d]]=u[d];return l}}(Av||(Av={})),function(e){e.create=function t(r,n,a,i){return{id:Gn.create22(),label:r,basic:n,sourceData:i,bonds:a}}}(g2||(g2={})),function(e){e.getUUID=function t(r){return r.__key||(r.__key=Gn.create22()),r.__key}}(ec||(ec={}));var zl=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;this._refs.set(t,Math.max(n+=r?1:-1,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++)i[a].dispose();r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++)n[r].dispose()})},e}(),ZA=Object.prototype.hasOwnProperty;function JDe(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(ZA.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function tN(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!ZA.call(e,i)||e[i]!==t[i])return!1}return!0}function Gl(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=Gl(e[r]);return t}if("object"==typeof e&&!("prototype"in e)){for(var a in t={},e)ZA.call(e,a)&&(t[a]=Gl(e[a]));return t}throw new Error("Can't clone, type \"".concat(typeof e,'" unsupported'))}function Ks(e,t){if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function kd(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function QA(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function tc(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function aX(e,t,r){void 0===t&&(t=1),void 0===r&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function $A(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=0),aX(e,t,r)/(e.length/t)}function JA(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function rc(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function y2(e,t){for(var r=0,n=!1,a=e.length;r<a;r++)if(e[r]===t){n=!0;break}return!!n&&(b2(e,r),!0)}function b2(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function $a(e,t){return!(e.indexOf(t)>=0||(e.push(t),0))}function Tv(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function eT(e,t){for(var r=0,n=0,a=e.length;n<a;++n)t.includes(e[n])&&(r+=1);return r}function iX(e,t){if(!e||0===e.length)return!t||0===t.length;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function tT(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t)return void(e[n][1]=r);e.push([t,r])}var rN=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,sr([e],r,!1))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:function oEe(){var a,m,v,g,e=(m=typeof window<"u"&&window,v=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,g=typeof global<"u"&&global,m||g||v),t={},r=typeof document<"u"?document:void 0,n=1;function o(m){delete t[m]}function u(m){var v=t[m];o(m),function s(m){var v=m.callback,g=m.args;switch(g.length){case 0:v();break;case 1:v(g[0]);break;case 2:v(g[0],g[1]);break;case 3:v(g[0],g[1],g[2]);break;default:v.apply(void 0,g)}}(v)}return typeof process<"u"&&"[object process]"==={}.toString.call(process)?function c(){a=function(m){process.nextTick(function(){u(m)})}}():function l(){if(e&&e.postMessage&&!e.importScripts){var m=!0,v=e.onmessage;return e.onmessage=function(){m=!1},e.postMessage("","*"),e.onmessage=v,m}}()?function d(){var m="setImmediate$"+Math.random()+"$",v=function(g){g.source===e&&"string"==typeof g.data&&0===g.data.indexOf(m)&&u(+g.data.slice(m.length))};window.addEventListener?window.addEventListener("message",v,!1):window.attachEvent("onmessage",v),a=function(g){window.postMessage(m+g,"*")}}():typeof MessageChannel<"u"?function f(){var m=new MessageChannel;m.port1.onmessage=function(v){u(v.data)},a=function(v){m.port2.postMessage(v)}}():r&&"onreadystatechange"in r.createElement("script")?function p(){var m=r.documentElement;a=function(v){var g=r.createElement("script");g.onreadystatechange=function(){u(v),g.onreadystatechange=null,m.removeChild(g),g=null},m.appendChild(g)}}():function h(){a=function(m){setTimeout(u,0,m)}}(),{setImmediate:function i(m){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];return"function"!=typeof m&&(m=new Function(""+m)),t[n]={callback:m,args:v},a(n),n++},clearImmediate:o}}();function sEe(e){rN.setImmediate(e)}var x2,_2={setImmediate:rN.setImmediate,clearImmediate:rN.clearImmediate,immediatePromise:function(){return new Promise(sEe)},delay:function(e,t){return void 0===t&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},S2=function(){try{return!0}catch{return!1}}(),xr=function(){try{var t=process.env.DEBUG;return"*"===t||"molstar"===t}catch{return!1}}(),Ct=!1,C2=[],nN=typeof performance<"u"&&!!performance.mark&&performance.measure&&Ct;function fEe(e,t,r){void 0===r&&(r=250);var n=uX(e,t,r);return new hX(n,n.root)}function oX(e,t){return aN(t,e)}function sX(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function uX(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:da(),observer:t,abortToken:n,taskId:e.id,root:{progress:sX(e),children:[]},tryAbort:hEe(n)}}function hEe(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function cX(e){return{progress:R({},e.progress),children:e.children.map(cX)}}function lX(e){return e.progress.canAbort&&e.children.every(lX)}function aN(e,t){return ce(this,void 0,void 0,function(){var r,n;return le(this,function(a){switch(a.label){case 0:x2.markStart(e),t.node.progress.startedTime=da(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),x2.markEnd(e),x2.measure(e),t.info.abortToken.abortRequested&&dX(t.info),[2,r];case 3:return n=a.sent(),Ve.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw n;case 7:return[2]}})})}function dX(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,fX(e.root),pX(e,da())),Ve.Aborted(e.abortToken.reason)}function fX(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++)fX(n[r])}function pX(e,t){e.lastNotified=t;var r=function mEe(e){return{root:cX(e.root),canAbort:lX(e.root),requestAbort:e.tryAbort}}(e);e.observer(r)}!function(e){function t(o){return"startTask".concat(o.id)}function r(o){return"endTask".concat(o.id)}e.markStart=function n(o){nN&&performance.mark(t(o))},e.markEnd=function a(o){nN&&performance.mark(r(o))},e.measure=function i(o){nN&&performance.measure("\u2733\ufe0f ".concat(o.name),t(o),r(o))}}(x2||(x2={}));var Ve,mX,qe,hX=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,dX(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),da()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),t){var r=this.node.progress;"string"==typeof t?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=da(),this.updateProgress(t),!r)return pX(this.info,this.lastUpdatedTime),this.checkAborted(),_2.immediatePromise()},e.prototype.runChild=function(t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return le(this,function(l){switch(l.label){case 0:this.updateProgress(r),n={progress:sX(t),children:[]},(a=this.node.children).push(n),i=new e(this.info,n),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,aN(t,i)];case 2:return[2,l.sent()];case 3:if(o=l.sent(),Ve.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if((s=a.indexOf(n))>=0){for(u=s,c=a.length-1;u<c;u++)a[u]=a[u+1];a.pop()}return 0===a.length&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),vEe=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),rT=new vEe;function $f(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=da(),c=0,l=0,f.label=1;case 1:return(c=n(i,r))>0?(o+=c,d=da()-u,l+=d,s+=d,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),i=Math.round(l*o/s)+1,u=da(),l=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function yEe(e,t,r){return e[t].key<e[r].key?-1:1}function iN(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return function bEe(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,c=n;c<a;c++){var l=t(e[c]);i.has(l)?(i.get(l).count++,s!==l&&(u=!1)):(i.set(l,d={key:l,count:1,offset:c}),o[o.length]=d),s=l}var f=new Int32Array(o.length+1);f[o.length]=a;var p=!0;if(r){c=1;for(var h=o.length;c<h;c++)if(o[c-1].key>o[c].key){p=!1;break}}if(u&&p){for(c=0;c<o.length;c++)f[c]=o[c].offset;return f}r&&!p&&rX(o,0,o.length,yEe,wv);var m=0;for(c=0;c<o.length;c++){var v=o[c];v.offset=m,m+=v.count}var g=new Int32Array(a-n);for(c=n;c<a;c++){var d;l=t(e[c]),g[(d=i.get(l)).offset++]=e[c]}for(c=0,h=g.length;c<h;c++)e[c+n]=g[c];for(f[0]=n,c=1;c<o.length;c++)f[c]=o[c-1].offset+n;return f}(e,t,!(!r||!r.sort),n,a)}!function(e){var t=function(){function d(f,p,h){this.name=f,this.f=p,this.onAbort=h,this.id=l()}return d.prototype.run=function(f,p){return void 0===p&&(p=250),f?function dEe(e,t,r){void 0===r&&(r=250);var n=uX(e,t,r);return aN(e,new hX(n,n.root))}(this,f,p):this.f(rT)},d.prototype.runAsChild=function(f,p){return f.isSynchronous?this.f(rT):function pEe(e,t,r){return e.runChild(t,r)}(f,this,p)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(rT):oX(f,this)},d}();function r(d){return!!d&&"number"==typeof d.id&&"string"==typeof d.name&&!!d.run}function i(d,f,p){return new t(d,f,p)}e.is=r,e.isAbort=function n(d){return!!d&&!!d.isAborted},e.Aborted=function a(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted".concat(d?": "+d:"")}}},e.create=i,e.constant=function o(d,f){var p=this;return i(d,function(h){return ce(p,void 0,void 0,function(){return le(this,function(m){return[2,f]})})})},e.empty=function s(){var d=this;return i("",function(f){return ce(d,void 0,void 0,function(){return le(this,function(p){return[2]})})})},e.fail=function u(d,f){var p=this;return i(d,function(h){return ce(p,void 0,void 0,function(){return le(this,function(m){throw new Error(f)})})})},e.resolveInContext=function c(d,f){return r(d)?f?d.runInContext(f):d.run():d};var l=ms(0,1073741823)}(Ve||(Ve={})),function(e){function t(n,a){void 0===a&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message);var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message,"\n").concat(s.join("\n")):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message,"\n").concat(s.join("\n"))}e.format=function r(n){return t(n.root)}}(mX||(mX={})),function(e){function r(f){var p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function l(f,p){var h=f.ctor,m=f.chunks,v=f.currentIndex;if(!m.length)return new h(0);if(1===m.length&&(p||v===f.allocatedSize))return m[0];for(var g=0,y=0,b=m.length-1;y<b;y++)g+=m[y].length;var _=new h(g+=f.currentIndex),C=0;if(_.buffer)for(y=0,b=m.length-1;y<b;y++)_.set(m[y],C),C+=m[y].length;else for(y=0,b=m.length-1;y<b;y++){for(var x=m[y],A=0,T=x.length;A<T;A++)_[C+A]=x[A];C+=x.length}var w=m[m.length-1];if(_.buffer&&v>=f.currentSize)_.set(w,C);else for(A=0,T=w.length;A<T;A++)_[C+A]=w[A];return _}e.is=function t(f){return f.creator&&f.chunkSize},e.add4=function n(f,p,h,m,v){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=h,g[y+2]=m,g[y+3]=v,f.currentIndex+=4,f.elementCount++},e.add3=function a(f,p,h,m){f.currentIndex>=f.currentSize&&r(f);var v=f.currentChunk,g=f.currentIndex;return v[g]=p,v[g+1]=h,v[g+2]=m,f.currentIndex+=3,f.elementCount++},e.add2=function i(f,p,h){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,v=f.currentIndex;return m[v]=p,m[v+1]=h,f.currentIndex+=2,f.elementCount++},e.add=function o(f,p){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++},e.addRepeat=function s(f,p,h){for(var m=0;m<p;m++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=h,f.elementCount++;return f.elementCount},e.addMany=function u(f,p){for(var h=f.elementSize,m=0,v=p.length;m<v;m+=h){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<h;y++)g[f.currentIndex++]=p[m+y];f.elementCount++}return f.elementCount},e.compact=function c(f,p){return void 0===p&&(p=!1),l(f,p)},e._compact=l,e.create=function d(f,p,h,m){var v={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(h)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof m>"u")return v;if("number"==typeof m)return v.currentChunk=new f(m*p),v.allocatedSize=m*p,v.currentSize=v.currentChunk.length,v.chunks[0]=v.currentChunk,v;var g=m;if(g.length%p!=0)throw new Error("initialChunk length must be a multiple of the element size.");return v.currentChunk=g,v.allocatedSize=g.length,v.currentSize=g.length,v.chunks[0]=g,v}}(qe||(qe={}));var wi,_Ee=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}return u=this.createGroup(t,r),this.byHash.set(n,[u]),u.value},e}();function vX(e){var t=e^e>>4;return(t=(3735928559^t)+(t<<5))^t>>11}function Dv(e,t){var r=23;return r=31*(r=31*r+e|0)+t|0,(r=(3735928559^(r^=r>>4))+(r<<5))^r>>11}function oN(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}function nc(e,t){return(e+t)*(e+t+1)/2+t}function w2(e,t){return e<t?nc(e,t):nc(t,e)}function gX(e,t){var r=Math.floor((Math.sqrt(8*t+1)-1)/2),a=t-(r*r+r)/2;return e[0]=r-a,e[1]=a,e}function vs(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function sN(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function nT(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),a=r.value;if(r.done)break;t[t.length]=a}return t}function uN(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function TEe(e,t){for(var r=new(function DEe(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}!function(){function e(t){this.getKey=t,this.map=new Map,this.keys=[],this.groups=[]}e.prototype.add=function(t){var n,r=this.getKey(t);this.map.has(r)?(n=this.map.get(r))[n.length]=t:(this.map.set(r,n=[t]),this.keys[this.keys.length]=r,this.groups[this.groups.length]=n)},e.prototype.getGrouping=function(){return{keys:this.keys,groups:this.groups,map:this.map}}}(),function(e){e.Zero=0;var v,g,t=(v=new ArrayBuffer(8),g=new ArrayBuffer(8),{_int32:new Int32Array(v),_float64:new Float64Array(v),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;e.is=function o(v){return"number"==typeof v},e.create=function s(v,g){return r[0]=v,r[1]=g,n[0]},e.diff=function u(v){return n[0]=v,r[1]-r[0]},e.fst=function c(v){return n[0]=v,r[0]},e.snd=function l(v){return n[0]=v,r[1]},e.areEqual=function d(v,g){return n[0]=v,i[0]=g,r[0]===a[0]&&r[1]===a[1]},e.compare=function f(v,g){n[0]=v,i[0]=g;var y=r[0]-a[0];return 0!==y?y:r[1]-a[1]},e.compareInArray=function p(v,g,y){n[0]=v[g],i[0]=v[y];var b=r[0]-a[0];return 0!==b?b:r[1]-a[1]},e.hashCode=function h(v){return n[0]=v,Dv(r[0],r[1])},e.toString=function m(v){return n[0]=v,"(".concat(r[0],", ").concat(r[1],")")}}(wi||(wi={}));var yX=wi.Zero;function bX(e,t){return wi.create(e,t<e?e:t+1)}function cN(e,t){return wi.create(e,t<=e?e:t)}function EEe(e){return wi.create(0,e<0?0:e)}var IEe=wi.is,Jf=wi.fst,Uh=wi.snd,aT=wi.fst;function iT(e){return wi.snd(e)-1}var Ev=wi.diff,PEe=wi.hashCode,MEe=wi.toString;function REe(e,t){return wi.fst(e)<=t&&t<wi.snd(e)}function OEe(e,t){var r=Jf(e);return t>=r&&t<Uh(e)?t-r:-1}function FEe(e,t){return wi.fst(e)+t}var xe,NEe=wi.areEqual;function _X(e,t){var r=Ev(e),n=Ev(t);return 0===r&&0===n||r>0&&n>0&&iT(e)>=aT(t)&&aT(e)<=iT(t)}function kEe(e,t){return Ev(e)?!Ev(t)||Jf(e)<=Jf(t)&&Uh(e)>=Uh(t):0===Ev(t)}function lN(e,t){var r=Jf(e);if(t<=r)return 0;var n=Uh(e);return t>=n?n-r:t-r}function BEe(e,t,r){var n=Jf(r),a=Jf(e);if(t<=n+a)return n;var i=Uh(r);return t>=i+a?i:t-a}function SX(e,t,r){return cN(lN(e,t),lN(e,r+1))}function LEe(e,t){return _X(e,t)?cN(Math.max(Jf(e),Jf(t)),Math.min(Uh(e),Uh(t))):yX}function UEe(e,t){return Ev(SX(e,aT(t),iT(t)))}!function(e){e.Empty=yX,e.ofSingleton=function(t){return bX(t,t)},e.ofRange=bX,e.ofBounds=cN,e.ofLength=EEe,e.is=IEe,e.has=REe,e.indexOf=OEe,e.getAt=FEe,e.start=Jf,e.end=Uh,e.min=aT,e.max=iT,e.size=Ev,e.hashCode=PEe,e.toString=MEe,e.areEqual=NEe,e.areIntersecting=_X,e.isSubInterval=kEe,e.findPredecessorIndex=lN,e.findPredecessorIndexInInterval=BEe,e.findRange=SX,e.intersectionSize=UEe,e.intersect=LEe}(xe||(xe={}));var A2=[];function VEe(e){return[e]}function zEe(e){return e}function GEe(e){return Rc(e),e}function CX(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function HEe(e){return e&&(Array.isArray(e)||!!e.buffer)}function xX(e){return e[e.length-1]-e[0]+1===e.length}function dN(e){return e[0]}function fN(e){return e[e.length-1]+1}function jEe(e){return e[0]}function qEe(e){return e[e.length-1]}function wX(e){return e.length}function WEe(e){var t=e.length;return t?t>2?function xEe(e,t,r,n){var a=23;return a=31*(a=31*(a=31*(a=31*a+e|0)+t|0)+r|0)+n|0,(a=(3735928559^(a^=a>>4))+(a<<5))^a>>11}(t,e[0],e[t-1],e[t>>1]):function CEe(e,t,r){var n=23;return n=31*(n=31*(n=31*n+e|0)+t|0)+r|0,(n=(3735928559^(n^=n>>4))+(n<<5))^n>>11}(t,e[0],e[t-1]):0}function YEe(e){var t=e.length;return t>5?"[".concat(e[0],", ").concat(e[1],", ..., ").concat(e[t-1],"], length ").concat(t):"[".concat(e.join(", "),"]")}function AX(e,t){var r=e.length;return 0===r?-1:e[0]<=t&&t<=e[r-1]?EX(e,t,0,r):-1}function XEe(e,t,r){return TX(e,t,xe.start(r),xe.end(r))}function TX(e,t,r,n){return 0===e.length||n<=r?-1:e[r]<=t&&t<=e[n-1]?EX(e,t,r,n):-1}function KEe(e,t){return AX(e,t)>=0}function DX(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(xX(e))return!0;r--;for(var n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Iv(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:IX(e,t,0,r)}function ZEe(e,t,r){var n=xe.start(r),a=xe.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?function $Ee(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}(e,t,n+1,a):IX(e,t,n,a)}function QEe(e,t,r){return xe.ofBounds(Iv(e,t),Iv(e,r+1))}function EX(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else{if(!(t>u))return s;a=s+1}}return-1}function IX(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else{if(!(t>u))return s;a=s+1}}return a>i?i+1:e[a]>=t?a:a+1}function JEe(e,t){if(e===t)return!0;for(var r=Pv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else{if(!(s>u))return!0;a++}}return!1}function eIe(e,t){if(e===t)return!0;var r=t.length,n=Pv(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var c=e[a],l=t[i];c<l?a++:c>l?i++:(a++,i++,u++)}return u===r}function PX(e,t){if(e===t)return e;var r=e.length,n=t.length;if(0===r)return t;if(0===n)return e;if(e[0]>t[0])return PX(t,e);var a=Pv(e,t),i=a.startI,s=a.endI,u=a.endJ,c=pN(e,t,i,a.startJ,s,u);if(c===r&&c===n||c===n)return e;if(c===r)return t;var l=new Int32Array(r+n-c),d=0,f=0,p=0;for(d=0;d<i;d++)l[p++]=e[d];for(;f<u&&e[i]>t[f];)l[p++]=t[f++];for(;d<s&&f<u;){var h=e[d],m=t[f];h<m?(l[p++]=h,d++):h>m?(l[p++]=m,f++):(l[p++]=h,d++,f++)}for(;d<s;d++)l[p++]=e[d];for(;f<u;f++)l[p++]=t[f];for(;d<r;d++)l[p++]=e[d];for(;f<n;f++)l[p++]=t[f];return l}function tIe(e,t){if(e===t)return wX(e);var r=Pv(e,t);return pN(e,t,r.startI,r.startJ,r.endI,r.endJ)}function pN(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var c=e[o],l=t[s];c<l?o++:c>l?s++:(o++,s++,u++)}return u}function rIe(e,t){if(e===t)return e;var r=Pv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=pN(e,t,n,a,i,o),u=e.length,c=t.length;if(!s)return A2;if(s===u&&s===c||s===c)return t;if(s===u)return e;for(var l=new Int32Array(s),d=0,f=n,p=a;f<i&&p<o;){var h=e[f],m=t[p];h<m?f++:(h>m||(l[d++]=h,f++),p++)}return l}function nIe(e,t){if(e===t)return A2;for(var r=e.length,n=Pv(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,c=i,l=0;u<o&&c<s;)(d=e[u])<(f=t[c])?u++:d>f?c++:(u++,c++,l++);if(!l)return e;if(l>=r)return A2;for(var p=new Int32Array(r-l),h=0,m=0;m<a;m++)p[h++]=e[m];for(u=a,c=i;u<o&&c<s;){var d,f;(d=e[u])<(f=t[c])?(p[h++]=d,u++):(d>f||u++,c++)}for(;u<r;u++)p[h++]=e[u];return p}function aIe(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;var a=new Int32Array(t),i=0;for(r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function iIe(e,t){if(DX(e,t))return uN(0,e.length-1);for(var r=Pv(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,c=0;s<i&&u<o;)(l=e[s])<(d=t[u])?s++:l>d?u++:(s++,u++,c++);if(!c)return A2;if(c===e.length)return uN(0,e.length-1);var p=new Int32Array(c),h=0;for(s=n,u=a;s<i&&u<o;){var l,d;(l=e[s])<(d=t[u])?s++:(l>d||(p[h++]=s,s++),u++)}return p}var Xe,ep={startI:0,startJ:0,endI:0,endJ:0};function Pv(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(ep.startI=Iv(e,dN(t)),ep.startJ=Iv(t,dN(e)),ep.endI=Iv(e,fN(t)),ep.endJ=Iv(t,fN(e))):(ep.startI=0,ep.startJ=0,ep.endI=r,ep.endJ=n),ep}!function(e){e.Empty=A2,e.ofUnsortedArray=GEe,e.ofSingleton=VEe,e.ofSortedArray=zEe,e.ofRange=CX,e.ofBounds=function(t,r){return CX(t,r-1)},e.is=HEe,e.isRange=xX,e.has=KEe,e.indexOf=AX,e.indexOfInInterval=XEe,e.indexOfInRange=TX,e.start=dN,e.end=fN,e.min=jEe,e.max=qEe,e.size=wX,e.hashCode=WEe,e.toString=YEe,e.areEqual=DX,e.areIntersecting=JEe,e.isSubset=eIe,e.union=PX,e.intersect=rIe,e.subtract=nIe,e.findPredecessorIndex=Iv,e.findPredecessorIndexInInterval=ZEe,e.findRange=QEe,e.intersectionSize=tIe,e.deduplicate=aIe,e.indicesOf=iIe}(Xe||(Xe={}));var Be,Bd=xe.Empty,oIe=xe.ofSingleton,sIe=xe.ofRange,uIe=xe.ofBounds;function Hl(e){return e.length?Xe.isRange(e)?xe.ofRange(e[0],e[e.length-1]):e:Bd}function Mv(e){return xe.is(e)?xe.size(e):Xe.size(e)}function cIe(e,t){return xe.is(e)?xe.has(e,t):Xe.has(e,t)}function lIe(e,t){return xe.is(e)?xe.indexOf(e,t):Xe.indexOf(e,t)}function hN(e,t){return xe.is(e)?xe.getAt(e,t):e[t]}function wy(e){return xe.is(e)?xe.min(e):Xe.min(e)}function Ay(e){return xe.is(e)?xe.max(e):Xe.max(e)}function dIe(e){return xe.is(e)?xe.start(e):Xe.start(e)}function fIe(e){return xe.is(e)?xe.end(e):Xe.end(e)}function pIe(e){return xe.is(e)?xe.hashCode(e):Xe.hashCode(e)}function mIe(e,t){return xe.is(e)?xe.is(t)?xe.areEqual(e,t):MX(e,t):xe.is(t)?MX(t,e):Xe.areEqual(e,t)}function vIe(e,t){return xe.is(e)?xe.is(t)?xe.areIntersecting(e,t):RX(t,e):xe.is(t)?RX(e,t):Xe.areIntersecting(e,t)}function gIe(e,t){return xe.is(e)?xe.is(t)?xe.isSubInterval(e,t):function TIe(e,t){var r=xe.min(e),n=xe.max(e);if(n-r+1==0)return!1;var a=Xe.min(t),i=Xe.max(t);return a>=r&&i<=n}(e,t):xe.is(t)?function AIe(e,t){var r=xe.min(t),n=xe.max(t);if(n-r+1==0)return!0;var a=Xe.min(e),i=Xe.max(e);if(r<a||n>i)return!1;var o=Xe.findRange(e,r,n);return xe.size(o)===xe.size(t)}(e,t):Xe.isSubset(e,t)}function yIe(e,t){return xe.is(e)?xe.findPredecessorIndex(e,t):Xe.findPredecessorIndex(e,t)}function bIe(e,t,r){return xe.is(e)?xe.findPredecessorIndexInInterval(e,t,r):Xe.findPredecessorIndexInInterval(e,t,r)}function _Ie(e,t,r){return xe.is(e)?xe.findRange(e,t,r):Xe.findRange(e,t,r)}function SIe(e,t){return xe.is(e)?xe.is(t)?xe.intersectionSize(e,t):FX(t,e):xe.is(t)?FX(e,t):Xe.intersectionSize(e,t)}function CIe(e,t){return xe.is(e)?xe.is(t)?function IIe(e,t){if(xe.areEqual(e,t))return e;var r=xe.size(e),n=xe.size(t);if(!n)return e;if(!r)return t;var o,s,u,c,a=xe.min(e),i=xe.min(t);if(function DIe(e,t){var r=Mv(e),n=Mv(t);return 0===r&&0===n||r>0&&n>0&&Ay(e)>=wy(t)&&wy(e)<=Ay(t)}(e,t))return xe.ofRange(Math.min(a,i),Math.max(xe.max(e),xe.max(t)));a<i?(o=r,s=a,u=n,c=i):(o=n,s=i,u=r,c=a);for(var l=new Int32Array(r+n),d=0;d<o;d++)l[d]=d+s;for(d=0;d<u;d++)l[d+o]=d+c;return Hl(l)}(e,t):OX(t,e):xe.is(t)?OX(e,t):Hl(Xe.union(e,t))}function xIe(e,t){return xe.is(e)?xe.is(t)?xe.intersect(e,t):NX(t,e):xe.is(t)?NX(e,t):Hl(Xe.intersect(e,t))}function wIe(e,t){return xe.is(e)?xe.is(t)?function PIe(e,t){if(xe.areEqual(e,t))return Bd;if(!xe.areIntersecting(e,t))return e;var r=xe.min(e),n=xe.max(e),a=xe.min(t),i=xe.max(t);if(n<r||i<a)return e;if(xe.isSubInterval(t,e))return Bd;if(xe.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return xe.ofRange(i+1,i+s);if(s<=0)return xe.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),c=0,l=0;l<o;l++)u[c++]=r+l;for(l=1;l<=s;l++)u[c++]=i+l;return Hl(u)}return r<a?xe.ofRange(r,a-1):xe.ofRange(i+1,n)}(e,t):function RIe(e,t){var r=xe.min(e),n=xe.max(e);if(n<r)return e;var a=n-r+1,i=Xe.findRange(t,r,n),o=xe.start(i),s=xe.end(i),u=s-o;if(0===u)return e;var c=a-u;if(c<=0)return Bd;for(var l=new Int32Array(c),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],h=0,m=r;m<f;m++)l[h++]=m;for(m=f;m<=p;m++)Xe.indexOfInInterval(t,m,i)<0&&(l[h++]=m);for(m=p+1;m<=n;m++)l[h++]=m;return Hl(l)}(e,t):xe.is(t)?function MIe(e,t){var r=xe.min(t),n=xe.max(t);if(n<r)return e;var a=Xe.findRange(e,r,n),i=xe.start(a),o=xe.end(a),s=e.length-(o-i);if(s<=0)return Bd;if(s===e.length)return e;for(var u=new Int32Array(s),c=0,l=0;l<i;l++)u[c++]=e[l];l=o;for(var d=e.length;l<d;l++)u[c++]=e[l];return Hl(u)}(e,t):Hl(Xe.subtract(e,t))}function MX(e,t){return xe.size(e)===Xe.size(t)&&xe.start(e)===Xe.start(t)&&xe.end(e)===Xe.end(t)}function RX(e,t){return 0!==e.length&&0!==xe.size(Xe.findRange(e,xe.min(t),xe.max(t)))}function OX(e,t){var r=xe.size(t);if(!r)return e;if(function EIe(e,t){return Mv(e)?!Mv(t)||wy(e)<=wy(t)&&Ay(e)>=Ay(t):0===Mv(t)}(t,e))return t;for(var n=xe.min(t),a=xe.max(t),i=Xe.findRange(e,n,a),o=xe.start(i),s=xe.end(i),u=new Int32Array(o+(e.length-s)+r),c=0,l=0;l<o;l++)u[c++]=e[l];for(l=n;l<=a;l++)u[c++]=l;l=s;for(var d=e.length;l<d;l++)u[c++]=e[l];return Hl(u)}function FX(e,t){if(!xe.size(t))return 0;var r=Xe.findRange(e,xe.min(t),xe.max(t));return xe.end(r)-xe.start(r)}function NX(e,t){if(!xe.size(t))return Bd;var r=Xe.findRange(e,xe.min(t),xe.max(t)),n=xe.start(r),a=xe.end(r),i=a-n;if(!i)return Bd;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return Hl(o)}function NIe(e,t,r){if(t===r)return e;var n=Mv(e),a=t.length,i=r.length;if(0===n||0===a||0===i)return Bd;for(var o=Xe.findPredecessorIndex(r,t[wy(e)]),s=Xe.findPredecessorIndex(r,t[Ay(e)]+1),u=0,c=0,l=0,d=o;l<n&&d<s;)(f=t[hN(e,l)])<(p=r[d])?l++:(f>p||(u++,l++),d++);if(0===u)return Bd;if(u===a&&u===i)return e;var h=new Int32Array(u);for(c=0,l=0,d=o;l<n&&d<s;){var f,p;(f=t[hN(e,l)])<(p=r[d])?l++:(f>p||(h[c++]=d,l++),d++)}return Hl(h)}function kX(e){for(var t=Xe.ofSortedArray(e),r=Xe.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function kIe(e,t){for(var r=xe.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=xe.end(t)-r,kX(n)}function BIe(e){return e.count}function LIe(e,t){return e.index[t]}function UIe(e,t,r){var n=e.offsets,i=r>=Be.max(n)?-1:Be.findPredecessorIndex(n,r-1);return Be.findRange(t,Be.getAt(n,i),Be.getAt(n,i+1)-1)}!function(e){e.Empty=Bd,e.ofSingleton=oIe,e.ofRange=sIe,e.ofBounds=uIe,e.ofSortedArray=Hl,e.has=cIe,e.indexOf=lIe,e.getAt=hN,e.min=wy,e.max=Ay,e.start=dIe,e.end=fIe,e.size=Mv,e.hashCode=pIe,e.areEqual=mIe,e.areIntersecting=vIe,e.isSubset=gIe,e.union=CIe,e.intersect=xIe,e.indexedIntersect=NIe,e.subtract=wIe,e.findPredecessorIndex=yIe,e.findPredecessorIndexInInterval=bIe,e.findRange=_Ie,e.intersectionSize=SIe,e.forEach=function t(s,u,c){return function OIe(e,t,r){if(xe.is(e))for(var n=xe.min(e),a=n,i=xe.max(e);a<=i;a++)t(a,a-n,r);else for(a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}(s,u,c)},e.forEachSegment=function r(s,u,c,l){return function FIe(e,t,r,n){if(xe.is(e))for(var a=0,i=xe.min(e),o=xe.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(a=0,i=0,o=e.length;i<o;i++){for(s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}(s,u,c,l)},e.isInterval=function n(s){return xe.is(s)},e.isSortedArray=function a(s){return!xe.is(s)},e.toArray=function i(s){var u=[];return e.forEach(s,function(c){return u.push(c)}),u},e.toString=function o(s){return function hIe(e){return xe.is(e)?xe.toString(e):Xe.toString(e)}(s)}}(Be||(Be={}));var tr,VIe=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=xe.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;){if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&xe.size(this.setRange)>0;break}this.updateSegmentRange()}return this.value},e.prototype.updateValue=function(){var r=Be.findPredecessorIndexInInterval(this.set,this.segments[this.segmentMin+1],this.setRange);return this.value.start=xe.start(this.setRange),this.value.end=r,this.setRange=xe.ofBounds(r,xe.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=xe.min(this.setRange),r=xe.max(this.setRange);r<t?this.hasNext=!1:(this.segmentMin=this.segmentMap[Be.getAt(this.set,t)],this.segmentMax=this.segmentMap[Be.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin)},e.prototype.setSegment=function(t){this.setRange=xe.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function zIe(e,t,r){var n=typeof r<"u"?xe.ofBounds(r.start,r.end):xe.ofBounds(0,Be.size(t));return new VIe(e.offsets,e.index,t,n)}!function(e){e.create=kX,e.ofOffsets=kIe,e.count=BIe,e.getSegment=LIe,e.projectValue=UIe,e.transientSegments=zIe}(tr||(tr={}));var Oc,HIe=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var n=this.prev,a=this.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(this.head=i<0?o:i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}();!function(e){function r(){return new Map}e.Empty=new Map,e.keyArray=function t(o){return nT(o.keys())},e.Mutable=r,e.asImmutable=function n(o){return o},e.copy=function a(o){for(var s=r(),u=o.keys();;){var c=u.next(),d=c.value;if(c.done)break;s.set(d,o.get(d))}return s},e.addFrom=function i(o,s){for(var u=s.keys();;){var c=u.next(),d=c.value;if(c.done)break;o.set(d,s.get(d))}return o}}(Oc||(Oc={}));var oT,Cu,jIe=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),BX=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),qIe=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),WIe=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),YIe=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}();function LX(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,c=t.length;u<c;++u)for(var l=t[u],d=o[l],f=o[l+1];d<f;++d){var p=i[d];if(!a.has(p)){if(Xe.has(r,p))return!0;a.add(p),s[s.length]=p}}return n>1&&LX(e,s,r,n-1,a)}!function(e){e.Empty=new BX(0,-1),e.Array=function t(s){return new jIe(s)},e.Value=function r(s){return new qIe(s)},e.Range=function n(s,u){return new BX(s,u)},e.map=function a(s,u){return new WIe(s,u)},e.filter=function i(s,u){return new YIe(s,u)},e.forEach=function o(s,u,c){for(;s.hasNext;)if(u(s.move(),c))return c;return c}}(oT||(oT={})),function(e){e.areEqual=function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var p=d.a,h=d.b,m=d.offset,v=f.a,g=f.b,y=f.offset,b=0,_=d.a.length;b<_;b++)if(p[b]!==v[b])return!1;for(b=0,_=d.b.length;b<_;b++)if(h[b]!==g[b])return!1;for(b=0,_=d.offset.length;b<_;b++)if(m[b]!==y[b])return!1;for(var C=0,x=Object.keys(d.edgeProps);C<x.length;C++){var A=x[C],T=d.edgeProps[A],w=f.edgeProps[A];if(!w)return!1;for(b=0,_=T.length;b<_;b++)if(T[b]!==w[b])return!1}return!0};var r=function(){function d(f,p,h,m,v,g){this.offset=f,this.a=p,this.b=h,this.edgeCount=m,this.props=g,this.vertexCount=f.length-1,this.edgeProps=v||{}}return d.prototype.getEdgeIndex=function(f,p){var h,m;f<p?(h=f,m=p):(h=p,m=f);for(var v=this.offset[h],g=this.offset[h+1];v<g;v++)if(this.b[v]===m)return v;return-1},d.prototype.getDirectedEdgeIndex=function(f,p){for(var h=this.offset[f],m=this.offset[f+1];h<m;h++)if(this.b[h]===p)return h;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,p,h,m,v){return new r(d,f,p,h,m,v)}e.create=n;var a=function(){function d(f,p,h){this.vertexCount=f,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var m=new Int32Array(this.vertexCount),v=0,g=this.xs.length;v<g;v++)m[this.xs[v]]++;for(v=0,g=this.ys.length;v<g;v++)m[this.ys[v]]++;var y=0;for(v=0;v<this.vertexCount;v++)this.offsets[v]=y,y+=m[v];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],h=this.offsets[f]+this.bucketFill[f];this.a[h]=f,this.b[h]=p,this.bucketFill[f]++;var m=this.offsets[p]+this.bucketFill[p];this.a[m]=p,this.b[m]=f,this.bucketFill[p]++,this.current++,this.curA=h,this.curB=m},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p,f[this.curB]=p},d.prototype.assignDirectedProperty=function(f,p,h,m){f[this.curA]=p,f[this.curB]=m,h[this.curB]=p,h[this.curA]=m},d}();e.EdgeBuilder=a;var i=function(){function d(f,p,h){this.vertexCount=f,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var m=new Int32Array(this.vertexCount),v=0,g=this.xs.length;v<g;v++)m[this.xs[v]]++;var y=0;for(v=0;v<this.vertexCount;v++)this.offsets[v]=y,y+=m[v];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],h=this.offsets[f]+this.bucketFill[f];this.a[h]=f,this.b[h]=p,this.bucketFill[f]++,this.current++,this.curA=h},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p},d}();e.DirectedEdgeBuilder=i;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,p){var h=f,m=p;f>p&&(h=p,m=f);var v=nc(h,m);return!this.included.has(v)&&(this.included.add(v),this.xs[this.xs.length]=h,this.ys[this.ys.length]=m,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},d}();function s(d,f,p){var h=new e.EdgeBuilder(d,f,p);return h.addAllEdges(),h.createGraph({})}e.UniqueEdgeBuilder=o,e.fromVertexPairs=s,e.induceByVertices=function u(d,f,p){for(var h=d.b,m=d.offset,v=d.vertexCount,g=d.edgeProps,y=new Int32Array(v),b=0,_=f.length;b<_;b++)y[f[b]]=b+1;var C=0;for(b=0;b<v;b++)if(0!==y[b])for(var x=m[b],A=m[b+1];x<A;x++)h[x]>b&&0!==y[h[x]]&&C++;var T=new Int32Array(f.length+1),w=new Int32Array(2*C),E=new Int32Array(2*C),I=new Int32Array(2*C),M=0,F=0;for(b=0;b<v;b++)if(0!==y[b]){var N=y[b]-1;for(x=m[b],A=m[b+1];x<A;x++){var j=y[h[x]];0!==j&&(E[M]=N,I[M]=j-1,w[M]=x,M++)}T[++F]=M}for(var k={},H=0,G=Object.keys(g);H<G.length;H++){var U=G[H];k[U]=TEe(g[U],w)}return n(T,E,I,C,k,p)},e.connectedComponents=function c(d){var f=d.vertexCount;if(0===f)return{componentCount:0,componentIndex:new Int32Array(0)};if(0===d.edgeCount){for(var p=new Int32Array(f),h=0,m=f;h<m;h++)p[h]=h;return{componentCount:f,componentIndex:p}}var v=new Int32Array(f);for(h=0,m=f;h<m;h++)v[h]=-1;var g=0;v[0]=g;var y=d.offset,b=d.b,_=[0],C=function GIe(e){return new HIe(e)}(f);for(C.remove(0);_.length>0;){for(var x=_.pop(),A=v[x],T=y[x],w=y[x+1];T<w;T++){var E=b[T];C.has(E)&&(C.remove(E),_.push(E),v[E]=A)}0===_.length&&C.head>=0&&(_.push(C.head),v[C.head]=++g,C.remove(C.head))}return{componentCount:f,componentIndex:v}},e.areVertexSetsConnected=function l(d,f,p,h){if(Xe.areIntersecting(f,p))return!0;if(h<1)return!1;for(var m=new Set,v=0,g=f.length;v<g;++v)m.add(f[v]);return LX(d,f,p,h,m)}}(Cu||(Cu={}));var jl,Lo,ht,Ty,XIe=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){if(!this.map.has(t.sourceData.kind))return!1;var r=this.applicable.get(t.sourceData.kind);return!r||r(t)},e}();function KIe(e,t,r,n){for(var a=new Cu.EdgeBuilder(n,e,t),i=new Int32Array(a.slotCount),o=new Array(a.slotCount),s=new Array(a.slotCount),u=new Int8Array(a.slotCount),c=new Array(a.slotCount),l=new Array(a.slotCount),d=0,f=a.edgeCount;d<f;d++)a.addNextEdge(),a.assignProperty(i,r.key?r.key[d]:-1),a.assignDirectedProperty(o,r.operatorA?r.operatorA[d]:-1,s,r.operatorB?r.operatorB[d]:-1),a.assignProperty(u,r.order?r.order[d]:1),a.assignProperty(c,r.distance?r.distance[d]:-1),a.assignProperty(l,r.flag?r.flag[d]:1);return a.createGraph({key:i,operatorA:o,operatorB:s,order:u,distance:c,flag:l})}function er(e){return function(t){return mN(e,t)}}function mN(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o="str"===i?function(s){return r.substring(n[2*s],n[2*s+1])}:"int"===i?function(s){return Lh(r,n[2*s],n[2*s+1])||0}:function(s){return Zf(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return Bo(a,o,s)},areValuesEqual:UX(e)}}function UX(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function ZIe(e){for(var t=e.count,r=e.indices,n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function VX(e,t){return{name:t,blocks:e}}function vN(e,t,r,n){return void 0===n&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split(".");return t[i[0]].getField(i[1]||"")}}}function io(e,t,r,n){return{rowCount:t,name:e,fieldNames:sr([],r,!0),getField:function(a){return n[a]}}}function Ld(e,t,r){return function o3e(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=c3e(o,e[o],t,r)}return eN.ofTables(t.header,e,n)}(e,t,r)}function zX(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}!function(e){e.create=function t(r,n){var a=r.name,i=new XIe;return{descriptor:r,formatRegistry:i,isApplicable:function(o){return i.isApplicable(o)},get:function(o){var s=n?.asDynamic?o._dynamicPropertyData:o._staticPropertyData;if(s[a])return s[a];if(!o.customProperties.has(r)){var u=i.get(o.sourceData.kind);if(u)return s[a]=u(o),o.customProperties.add(r),s[a]}},set:function(o,s){n?.asDynamic?o._dynamicPropertyData[a]=s:o._staticPropertyData[a]=s},delete:function(o){n?.asDynamic?delete o._dynamicPropertyData[a]:delete o._staticPropertyData[a]}}}}(jl||(jl={})),function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=jl.create(e.Descriptor,{asDynamic:!0}),e.DefaultProps={maxDistance:-1},e.fromData=function t(n,a){void 0===a&&(a={});var i=R(R({},e.DefaultProps),a),o=n.pairs,s=n.count;return{bonds:KIe(o.indexA.toArray(),o.indexB.toArray(),{key:o.key&&o.key.toArray(),operatorA:o.operatorA&&o.operatorA.toArray(),operatorB:o.operatorB&&o.operatorB.toArray(),order:o.order&&o.order.toArray(),distance:o.distance&&o.distance.toArray(),flag:o.flag&&o.flag.toArray()},s),maxDistance:i.maxDistance}},e.getEdgeIndexForOperators=function r(n,a,i,o,s){var u,c,l,d;a<i?(u=a,c=i,l=o,d=s):(u=i,c=a,l=s,d=o);for(var f=n.offset[u],p=n.offset[u+1];f<p;f++)if(n.b[f]===c&&n.edgeProps.operatorA[f]===l&&n.edgeProps.operatorB[f]===d)return f;return-1}}(Lo||(Lo={})),function(e){function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.empty=function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}},e.ofFields=r,e.ofTable=function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var c=u[s];o[c]=ht.ofColumn(i[c])}return r(a,o)}}(io||(io={})),function(e){function r(s){var u=s.length,c=function(p){var h=s[p];return h&&"."!==h&&"?"!==h?h:""},l=function(p){var h=s[p];return Lh(h,0,h.length)||0},d=function(p){var h=s[p];return Zf(h,0,h.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:c,int:l,float:d,valueKind:function(p){var h=s[p],m=h.length;if(m>1)return 0;if(0===m)return 1;var v=h.charCodeAt(0);return 46===v?1:63===v?2:0},areValuesEqual:function(p,h){return s[p]===s[h]},toStringArray:function(p){return p?Bo(u,c,p):s},toIntArray:function(p){return Bo(u,l,p)},toFloatArray:function(p){return Bo(u,d,p)}}}function i(s){var f,p,h,u=s.rowCount,c=s.valueKind,l=s.areValuesEqual,d=s.isDefined;switch(s.schema.valueType){case"float":case"int":f=function(v){return""+s.value(v)},p=s.value,h=s.value;break;case"str":f=s.value,p=function(v){var g=s.value(v);return Lh(g,0,g.length)||0},h=function(v){var g=s.value(v);return Zf(g,0,g.length)||0};break;case"list":var m=s.schema.separator;f=function(v){return s.value(v).join(m)},p=function(v){return NaN},h=function(v){return NaN};break;default:throw new Error("unsupported valueType '".concat(s.schema.valueType,"'"))}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:p,float:h,valueKind:c,areValuesEqual:l,toStringArray:function(v){return Bo(u,f,v)},toIntArray:function(v){return Bo(u,p,v)},toFloatArray:function(v){return Bo(u,h,v)}}}e.ofString=function t(s){return r([s])},e.ofStrings=r,e.ofNumbers=function n(s){var u=s.length,c=function(p){return""+s[p]},l=function(p){return s[p]},f=function(p){return!p||p.array&&s instanceof p.array?s:Bo(u,l,p)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:c,int:l,float:l,valueKind:function(p){return 0},areValuesEqual:function(p,h){return s[p]===s[h]},toStringArray:function(p){return Bo(u,c,p)},toIntArray:f,toFloatArray:f}},e.ofTokens=function a(s){var u=s.data,c=s.indices,l=s.count,d=function(m){var v=u.substring(c[2*m],c[2*m+1]);return"."===v||"?"===v?"":v},f=function(m){return Lh(u,c[2*m],c[2*m+1])||0},p=function(m){return Zf(u,c[2*m],c[2*m+1])||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:d,int:f,float:p,valueKind:function(m){var v=c[2*m],g=c[2*m+1]-v;if(g>1)return 0;if(0===g)return 1;var y=u.charCodeAt(v);return 46===y?1:63===y?2:0},areValuesEqual:UX(s),toStringArray:function(m){return Bo(l,d,m)},toIntArray:function(m){return Bo(l,f,m)},toFloatArray:function(m){return Bo(l,p,m)}}},e.ofColumn=i,e.ofUndefined=function o(s,u){return i(ie.Undefined(s,u))}}(ht||(ht={})),function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t,e.equal=function r(a,i){return t(a)===t(i)},e.create=function n(a,i,o){void 0===o&&(o=!1);var s="".concat(a).concat(i?".".concat(i):"");return o?t(s):s}}(Ty||(Ty={}));var sa,GX=function(){return function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(i[d])return i[d];var f=r[d];if("list"===f.valueType)i[d]=function a3e(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(c){return a(c.trim())}).filter(function(c){return!!c})}:function(u){return[]};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,c){return Xs(o(u),o(c))},toArray:function(u){return Bo(t.rowCount,o,u)}}}(f,t,d);else if("tensor"===f.valueType)i[d]=function i3e(e,t,r){var n=e.space,a=t.fieldNames.includes("".concat(r,"[0]"))||t.fieldNames.includes("".concat(r,"[0][0]"))||t.fieldNames.includes("".concat(r,"[0][0][0]")),i=a?0:1,o=t.fieldNames.includes("".concat(r,"_1"))||t.fieldNames.includes("".concat(r,"_11"))||t.fieldNames.includes("".concat(r,"_111"))?"underscore":"brackets",s=function $Ie(e,t,r,n){var a=r?0:1;switch(t){case 1:return"brackets"===n?function(i){return"".concat(e,"[").concat(i+a,"]")}:function(i){return"".concat(e,"_").concat(i+a)};case 2:return"brackets"===n?function(i,o){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"]")}:function(i,o){return"".concat(e,"_").concat(i+a).concat(o+a)};case 3:return"brackets"===n?function(i,o,s){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"][").concat(s+a,"]")}:function(i,o,s){return"".concat(e,"_").concat(i+a).concat(o+a).concat(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(r,n.rank,a,o),u=t.getField(s(i,i,i))||ie.Undefined(t.rowCount,e),c=function(d){return function JIe(e,t,r,n){var a=t.create();if(1===t.rank)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(2===t.rank){i=t.dimensions[0];var u=t.dimensions[1];for(o=0;o<i;o++)for(var c=0;c<u;c++)s=e.getField(n(o,c)),t.set(a,o,c,s?s.float(r):0)}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");var l=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2];for(o=0;o<l;o++)for(c=0;c<d;c++)for(var p=0;p<f;p++)s=e.getField(n(o,c,p)),t.set(a,o,c,p,s?s.float(r):0)}return a}(t,n,d,s)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:c,valueKind:u.valueKind,areValuesEqual:function(d,f){return Cr.areEqualExact(c(d),c(f))},toArray:function(d){return Bo(t.rowCount,c,d)}}}(f,t,d);else{var p=function r3e(e){switch(e.valueType){case"str":return function(t,r,n){return function n3e(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:"lowercase"===e.transform?function(a){return r(a).toLowerCase()}:"uppercase"===e.transform?function(a){return r(a).toUpperCase()}:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:"lowercase"===e.transform?function(a){return Array.from(n(a)).map(function(i){return i.toLowerCase()})}:"uppercase"===e.transform?function(a){return Array.from(n(a)).map(function(i){return i.toUpperCase()})}:n}}(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return zX(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return zX(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}(f),h=t.getField(d);i[d]=h?p(h,t,d):ie.Undefined(t.rowCount,f)}return i[d]},enumerable:!0,configurable:!1})},s=this,u=0,c=a;u<c.length;u++)o(c[u])}}();function u3e(e,t,r,n){var a=Ty.create(t,e),i=Ty.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var c=Ty.canonical(s[o]);if(c in r)return r[c]}}function c3e(e,t,r,n){var a=r.categories[e];if(n){for(var i=function s3e(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i];t[Ty.create(a,s,!0)]=e.categories[a].getField(s)}return t}(r),o=Object.create(null),s=[],u=0,c=0,l=Object.keys(t);c<l.length;c++){var d=l[c],f=u3e(d,e,i,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}a={rowCount:u,name:e,fieldNames:sr([],s,!0),getField:function(p){return o[p]}}}return new GX(a||io.empty(e),t,!!a)}function Dy(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}function l3e(e){return 0}function gN(e){return function(r){return e[r]}}function sT(e){return 0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]}function f3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],c=r[12];return sT(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+c}:function(d){var f=n[d],p=a[d],h=i[d];return(o*f+s*p+u*h+c)/(r[3]*f+r[7]*p+r[11]*h+r[15]||1)}}function p3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],c=r[13];return sT(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+c}:function(d){var f=n[d],p=a[d],h=i[d];return(o*f+s*p+u*h+c)/(r[3]*f+r[7]*p+r[11]*h+r[15]||1)}}function h3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],c=r[14];return sT(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+c}:function(d){var f=n[d],p=a[d],h=i[d];return(o*f+s*p+u*h+c)/(r[3]*f+r[7]*p+r[11]*h+r[15]||1)}}!function(e){function t(v,g,y){var b=y||{},_=b.assembly,C=b.ncsId,x=b.hkl,A=b.spgrOp,T=b.key,w=x?S.clone(x):S();A=A??-1,T=T??-1,C=C||-1;var E=me.isIdentity(g),I=function n(v,g){if(!v)return"";if(v.assembly)return function r(v){return!!v&&!!v.matrix&&!!v.inverse&&"string"==typeof v.name}(v)?v.suffix:g?"":"_".concat(v.assembly.operId);if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&-1!==v.spgrOp){var y=v.hkl,b=y[0],_=y[1],C=y[2];return"-".concat(v.spgrOp+1,"_").concat(5+b).concat(5+_).concat(5+C)}return-1!==v.ncsId?"_".concat(v.ncsId):""}(y,E);return E?{name:v,assembly:_,matrix:g,inverse:me.identity(),isIdentity:!0,hkl:w,spgrOp:A,ncsId:C,suffix:I,key:T}:(me.isRotationAndTranslation(g,e.RotationTranslationEpsilon)||console.warn("Symmetry operator (".concat(v,") should be a composition of rotation and translation.")),{name:v,assembly:_,matrix:g,inverse:me.invert(me(),g),isIdentity:!1,hkl:w,spgrOp:A,key:T,ncsId:C,suffix:I})}e.DefaultName="1_555",e.Default=t(e.DefaultName,me.identity()),e.RotationTranslationEpsilon=.005,e.create=t,e.checkIfRotationAndTranslation=function a(v,g){for(var y=me.identity(),b=0;b<3;b++)for(var _=0;_<3;_++)me.setValue(y,b,_,Qt.getValue(v,b,_));return me.setTranslation(y,g),me.isRotationAndTranslation(y,e.RotationTranslationEpsilon)},e.ofRotationAndOffset=function i(v,g,y,b){for(var _=me.identity(),C=0;C<3;C++)for(var x=0;x<3;x++)me.setValue(_,C,x,Qt.getValue(g,C,x));return me.setTranslation(_,y),t(v,_,{ncsId:b})};var o=yn.identity(),s=yn(),u=yn(),c=S();function m(v,g){return v.isIdentity?function m3e(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}(g):function v3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return sT(r)?function(s,u){var c=n[s],l=a[s],d=i[s];return u[0]=r[0]*c+r[4]*l+r[8]*d+r[12],u[1]=r[1]*c+r[5]*l+r[9]*d+r[13],u[2]=r[2]*c+r[6]*l+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],S.transformMat4(u,u,r),u}}(v,g)}e.lerpFromIdentity=function l(v,g,y){var b=g.inverse;if(g.isIdentity)return me.copy(v,b);var _=1-y;me.getRotation(s,b),yn.slerp(s,o,s,_);var C=yn.getAxisAngle(c,s);return me.fromRotation(v,C,c),me.setValue(v,0,3,_*me.getValue(b,0,3)),me.setValue(v,1,3,_*me.getValue(b,1,3)),me.setValue(v,2,3,_*me.getValue(b,2,3)),v},e.slerp=function d(v,g,y,b){if(Math.abs(b)<=1e-5)return me.copy(v,g);if(Math.abs(b-1)<=1e-5)return me.copy(v,y);me.getRotation(s,g),me.getRotation(u,y),yn.slerp(u,s,u,b);var _=yn.getAxisAngle(c,u);return me.fromRotation(v,_,c),me.setValue(v,0,3,oa(me.getValue(g,0,3),me.getValue(y,0,3),b)),me.setValue(v,1,3,oa(me.getValue(g,1,3),me.getValue(y,1,3),b)),me.setValue(v,2,3,oa(me.getValue(g,2,3),me.getValue(y,2,3),b)),v},e.compose=function f(v,g){var y=me.mul(me(),g.matrix,v.matrix);return t(g.name,y,g)},e.createMapping=function h(v,g,y){return void 0===y&&(y=l3e),function p(v,g,y){var b=m(e.Default,g),_=v.isIdentity?b:m(v,g),C=function d3e(e,t){return e.isIdentity?{x:gN(t.x),y:gN(t.y),z:gN(t.z)}:{x:f3e(e,t),y:p3e(e,t),z:h3e(e,t)}}(v,g);return{operator:v,coordinates:g,invariantPosition:b,position:_,x:C.x,y:C.y,z:C.z,r:y}}(v,g,y)},e.createCoordinateMapper=m}(sa||(sa={}));var yN=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],g3e=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],y3e=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],T2={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function _3e(e){if(e<146)return e+1;if(146===e)return 1146;if(e<149)return e+1-1;if(149===e)return 1148;if(e<157)return e+1-2;if(157===e)return 1155;if(e<163)return e+1-3;if(163===e)return 1160;if(e<165)return e+1-4;if(165===e)return 1161;if(e<171)return e+1-5;if(171===e)return 1166;if(e<173)return e+1-6;if(173===e)return 1167;if(e<237)return e+1-7;if(237===e)return 1003;if(238===e)return 1004;if(239===e)return 1005;if(240===e)return 2005;if(241===e)return 3005;if(242===e)return 4005;if(243===e)return 5005;if(244===e)return 1006;if(245===e)return 1007;if(246===e)return 1008;if(247===e)return 1009;if(248===e)return 1010;if(249===e)return 1011;if(250===e)return 1012;if(251===e)return 1013;if(252===e)return 1014;if(253===e)return 2014;if(254===e)return 3014;if(255===e)return 1015;if(256===e)return 1017;if(257===e)return 2017;if(258===e)return 1018;if(259===e)return 2018;if(260===e)return 3018;if(261===e)return 1020;if(262===e)return 1021;if(263===e)return 1022;if(264===e)return 1023;if(265===e)return 1059;if(266===e)return 1094;if(267===e)return 1197;throw new Error("unknown spacegroup index '".concat(e,"'"))}var gs,xu,Fc,Hi,HX=function(){for(var e=Object.create(null),t=0,r=Object.keys(T2);t<r.length;t++){var n=r[t];e[T2[n]]=n}return e}(),S3e=function(){for(var e=Object.create(null),t=0,r=Object.keys(T2);t<r.length;t++){var a=T2[r[t]];e[a]=_3e(a)}return e}();function Uo(){return Uo.empty()}function bN(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function x3e(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}!function(e){function r(n,a,i){var o=function C3e(e){var t="number"==typeof e?function b3e(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}(e):T2[e];return typeof t>"u"||typeof HX[t]>"u"?-1:t}(n);if(o<0)return console.warn("Unknown spacegroup '".concat(n,"', returning a 'P 1' with cellsize [1, 1, 1]")),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],c=i[1],l=i[2],d=a[0],f=a[1],p=a[2],h=Math.cos(c),m=(Math.cos(u)-Math.cos(c)*Math.cos(l))/Math.sin(l),v=Math.sqrt(1-h*h-m*m),g=[d,0,0],y=[Math.cos(l)*f,Math.sin(l)*f,0],b=[h*p,m*p,v*p],_=me.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:me.invert(me.zero(),_),fromFractional:_}}e.Zero=r("P 1",S.create(1,1,1),S.create(Math.PI/2,Math.PI/2,Math.PI/2)),e.isZero=function t(n){return!n||0===n.index&&1===n.size[0]&&1===n.size[1]&&1===n.size[1]},e.create=r}(gs||(gs={})),function(e){function t(v){var g=y3e[v.index].map(function(_){return function d(v){return me.ofRows([yN[v[0]],yN[v[1]],yN[v[2]],[0,0,0,1]])}(g3e[_])});return{name:HX[v.index],num:S3e[v.index],cell:v,operators:g}}e.ZeroP1=t(gs.Zero),e.create=t;var r=S(),n=me();function a(v,g,y,b,_,C){return S.set(r,y,b,_),me.fromTranslation(n,r),me.mul(C,me.mul(C,me.mul(C,v.cell.fromFractional,n),v.operators[g]),v.cell.toFractional)}e.setOperatorMatrix=a,e.getSymmetryOperator=function i(v,g,y,b,_){var C=a(v,g,y,b,_,me.zero());return sa.create("".concat(g+1,"_").concat(5+y).concat(5+b).concat(5+_),C,{hkl:S.create(y,b,_),spgrOp:g})};var o=S(),s=S(),u=S(),c=S();function p(v,g,y){var b=[];if(v>0?b.push("+X"):v<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),1===b.length)return"+"===b[0].charAt(0)?b[0].substr(1):b[0];if(2===b.length){var _=b[0].charAt(0),C=b[1].charAt(0);if("+"===_)return"".concat(b[0].substr(1)).concat(b[1]);if("+"===C)return"".concat(b[1].substr(1)).concat(b[0])}throw new Error("unknown rotation '".concat(b,"', ").concat(v," ").concat(g," ").concat(y))}function h(v){switch(v){case.5:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function m(v,g){return""===g?v:v.length>2?"".concat(v,"+").concat(g):"-"===v.charAt(0)?"".concat(g).concat(v):"".concat(g,"+").concat(v)}e.getSymmetryOperatorRef=function l(v,g,y,b,_,C){var x=me.zero();S.set(r,y,b,_),S.floor(o,C),me.copy(x,v.operators[g]),S.floor(s,S.transformMat4(s,C,x)),me.getTranslation(c,x),S.sub(c,c,s),S.add(c,c,o),S.add(c,c,r),me.setTranslation(x,c),me.mul(x,v.cell.fromFractional,x),me.mul(x,x,v.cell.toFractional),S.sub(u,s,o);var A=y-u[0],T=b-u[1],w=_-u[2];return sa.create("".concat(g+1,"_").concat(5+A).concat(5+T).concat(5+w),x,{hkl:S.create(A,T,w),spgrOp:g})},e.getOperatorXyz=function f(v){return[m(p(v[0],v[4],v[8]),h(v[12])),m(p(v[1],v[5],v[9]),h(v[13])),m(p(v[2],v[6],v[10]),h(v[14]))].join(",")}}(xu||(xu={})),function(e){e.add=function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o},e.reset=function r(i){i.count=0},e.create=function n(){return{count:0,indices:[],squaredDistances:[]}},e.copy=function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}}(Fc||(Fc={})),function(e){function r(){return{origin:S(),dirA:S(),dirB:S(),dirC:S()}}function n(f,p){return S.copy(f.origin,p.origin),S.copy(f.dirA,p.dirA),S.copy(f.dirB,p.dirB),S.copy(f.dirC,p.dirC),f}function i(f,p){return S.set(f,2*S.magnitude(p.dirA),2*S.magnitude(p.dirB),2*S.magnitude(p.dirC))}e.create=function t(f,p,h,m){return{origin:f,dirA:p,dirB:h,dirC:m}},e.empty=r,e.copy=n,e.clone=function a(f){return n(r(),f)},e.size=i;var o=S();e.volume=function s(f){return i(o,f),o[0]*o[1]*o[2]},e.normalize=function u(f,p){return S.copy(f.origin,p.origin),S.normalize(f.dirA,p.dirA),S.normalize(f.dirB,p.dirB),S.normalize(f.dirC,p.dirC),f};var c=Qt();e.transform=function l(f,p,h){S.transformMat4(f.origin,p.origin,h);var m=Qt.directionTransform(c,h);return S.transformMat3(f.dirA,p.dirA,m),S.transformMat3(f.dirB,p.dirB,m),S.transformMat3(f.dirC,p.dirC,m),f},e.scale=function d(f,p,h){return S.scale(f.dirA,p.dirA,h),S.scale(f.dirB,p.dirB,h),S.scale(f.dirC,p.dirC,h),f}}(Uo||(Uo={})),function(e){e.create=function t(f,p,h){void 0===h&&(h=Float32Array);var m=f*p;return{data:new h(m),size:m,cols:f,rows:p}},e.get=function r(f,p,h){return f.data[f.rows*h+p]},e.set=function n(f,p,h,m){return f.data[f.rows*h+p]=m,f},e.add=function a(f,p,h,m){return f.data[f.rows*h+p]+=m,f},e.makeZero=function i(f){return f.data.fill(0),f},e.clone=function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}},e.fromArray=function s(f,p,h){return{data:f,size:p*h,cols:p,rows:h}},e.transpose=function u(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");for(var h=p.rows,m=p.cols,v=p.data,g=f.data,y=0,b=0,_=0;y<h;_+=1,b+=m,++y)for(var C=_,x=0;x<m;C+=h,x++)g[C]=v[b+x];return f},e.multiplyABt=function c(f,p,h){for(var m=p.cols,v=p.rows,g=h.rows,y=p.data,b=h.data,_=f.data,C=0,x=0,A=0;C<v;x+=m,C++)for(var T=0,w=0;w<g;A++,w++){for(var E=0,I=x,M=0;M<m;I++,T++,M++)E+=y[I]*b[T];_[A]=E}return f},e.meanRows=function l(f){for(var p=f.rows,h=f.cols,m=f.data,v=new Array(h),g=0;g<h;++g)v[g]=0;for(var y=0,b=0;y<p;++y)for(g=0;g<h;++g,++b)v[g]+=m[b];for(g=0;g<h;++g)v[g]/=p;return v},e.subRows=function d(f,p){for(var h=f.rows,m=f.cols,v=f.data,g=0,y=0;g<h;++g)for(var b=0;b<m;++b,++y)v[y]-=p[b];return f}}(Hi||(Hi={}));var ql;function De(){return De.zero()}function Nt(){return Nt.zero()}!function(e){function r(o){if(3===o.length)return Uo.create(S.fromArray(S(),o,0),S.create(1,0,0),S.create(0,1,0),S.create(0,0,1));var s=Hi.fromArray(o,3,o.length/3),u=s.rows,c=u/3,l=Hi.create(3,3),d=Hi.create(1,3),f=Hi.create(3,3),p=Hi.create(3,3),h=Hi.meanRows(s),m=Hi.subRows(Hi.clone(s),h),v=Hi.transpose(Hi.create(u,3),m);Hi.multiplyABt(l,v,v),function D3e(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,c=s;u<c&&(a=1,i=u,u=c,c=i);var l=Hi.create(u,u),d=Hi.create(1,c),f=Hi.create(c,c);if(0===a)Hi.transpose(l,e);else{for(i=0;i<s*o;i++)l.data[i]=e.data[i];for(;i<c*u;i++)l.data[i]=0}if(function T3e(e,t,r,n,a,i,o,s){for(var l=0,d=0,f=0,p=0,h=Math.max(i,30),m=0,v=0,g=0,y=0,b=0,_=0,C=0,x=0,A=0,T=0,w=0,E=0,I=0,F=0,N=0,j=0,k=4660,G=0,U=0,Q=new Float64Array(o<<3);l<o;l++){for(f=0,w=0;f<i;f++)w+=(x=e[l*t+f])*x;if(Q[l]=w,n){for(f=0;f<o;f++)n[l*a+f]=0;n[l*a+l]=1}}for(;p<h;p++){for(b=0,l=0;l<o-1;l++)for(d=l+1;d<o;d++){for(F=Q[l],N=0,j=Q[d],f=2,N+=e[m=l*t|0]*e[v=d*t|0],N+=e[m+1]*e[v+1];f<i;f++)N+=e[m+f]*e[v+f];if(!(Math.abs(N)<=2.384185792e-7*Math.sqrt(F*j))){for(I=x3e(N*=2,E=F-j),E<0?_=N/(I*(C=Math.sqrt(.5*(I-E)/I))*2):C=N/(I*(_=Math.sqrt((I+E)/(2*I)))*2),F=0,j=0,f=2,T=-C*e[m]+_*e[v],e[m]=A=_*e[m]+C*e[v],e[v]=T,F+=A*A,j+=T*T,T=-C*e[m+1]+_*e[v+1],e[m+1]=A=_*e[m+1]+C*e[v+1],e[v+1]=T,F+=A*A,j+=T*T;f<i;f++)T=-C*e[m+f]+_*e[v+f],e[m+f]=A=_*e[m+f]+C*e[v+f],e[v+f]=T,F+=A*A,j+=T*T;if(Q[l]=F,Q[d]=j,b=1,n)for(f=2,T=-C*n[g=l*a|0]+_*n[y=d*a|0],n[g]=A=_*n[g]+C*n[y],n[y]=T,T=-C*n[g+1]+_*n[y+1],n[g+1]=A=_*n[g+1]+C*n[y+1],n[y+1]=T;f<o;f++)T=-C*n[g+f]+_*n[y+f],n[g+f]=A=_*n[g+f]+C*n[y+f],n[y+f]=T}}if(0===b)break}for(l=0;l<o;l++){for(f=0,w=0;f<i;f++)w+=(x=e[l*t+f])*x;Q[l]=Math.sqrt(w)}for(l=0;l<o-1;l++){for(d=l,f=l+1;f<o;f++)Q[d]<Q[f]&&(d=f);if(l!==d&&(bN(Q,l,d,w),n)){for(f=0;f<i;f++)bN(e,l*t+f,d*t+f,x);for(f=0;f<o;f++)bN(n,l*a+f,d*a+f,x)}}for(l=0;l<o;l++)r[l]=Q[l];if(n)for(l=0;l<s;l++){for(w=l<o?Q[l]:0;w<=1e-37;){for(G=1/i,f=0;f<i;f++)e[l*t+f]=256&(k=214013*k+2531011)>>16?G:-G;for(p=0;p<2;p++)for(d=0;d<l;d++){for(w=0,f=0;f<i;f++)w+=e[l*t+f]*e[d*t+f];for(U=0,f=0;f<i;f++)e[l*t+f]=x=e[l*t+f]-w*e[d*t+f],U+=Math.abs(x);for(U=U?1/U:0,f=0;f<i;f++)e[l*t+f]*=U}for(w=0,f=0;f<i;f++)w+=(x=e[l*t+f])*x;w=Math.sqrt(w)}for(C=1/w,f=0;f<i;f++)e[l*t+f]*=C}}(l.data,u,d.data,f.data,c,u,c,u),t){for(i=0;i<c;i++)t.data[i]=d.data[i];for(;i<s;i++)t.data[i]=0}0===a?(r&&Hi.transpose(r,l),n&&Hi.transpose(n,f)):(r&&Hi.transpose(r,f),n&&Hi.transpose(n,l))}(l,d,f,p);var g=S.create(h[0],h[1],h[2]),y=S.create(f.data[0],f.data[3],f.data[6]),b=S.create(f.data[1],f.data[4],f.data[7]),_=S.create(f.data[2],f.data[5],f.data[8]);return S.scale(y,y,Math.sqrt(d.data[0]/c)),S.scale(b,b,Math.sqrt(d.data[1]/c)),S.scale(_,_,Math.sqrt(d.data[2]/c)),Uo.create(g,y,b,_)}function n(o){var s=Uo.clone(o);return S.magnitude(s.dirC)<gn&&S.cross(s.dirC,s.dirA,s.dirB),Uo.normalize(s,s)}e.ofPositions=function t(o){var s=r(o);return{momentsAxes:s,boxAxes:i(o,s)}},e.calculateMomentsAxes=r,e.calculateNormalizedAxes=n;var a=S();function i(o,s){if(3===o.length)return Uo.clone(s);for(var u=-1/0,c=-1/0,l=-1/0,d=-1/0,f=-1/0,p=-1/0,h=S(),m=S(),v=s.origin,g=n(s),y=0,b=o.length;y<b;y+=3){S.projectPointOnVector(h,S.fromArray(h,o,y),g.dirA,v);var _=S.dot(g.dirA,S.normalize(m,S.sub(m,h,v))),C=S.distance(h,v);_>0?C>u&&(u=C):C>c&&(c=C),S.projectPointOnVector(h,S.fromArray(h,o,y),g.dirB,v);var x=S.dot(g.dirB,S.normalize(m,S.sub(m,h,v))),A=S.distance(h,v);x>0?A>l&&(l=A):A>d&&(d=A),S.projectPointOnVector(h,S.fromArray(h,o,y),g.dirC,v);var T=S.dot(g.dirC,S.normalize(m,S.sub(m,h,v))),w=S.distance(h,v);T>0?w>f&&(f=w):w>p&&(p=w)}var E=S.setMagnitude(S(),g.dirA,(u+c)/2),I=S.setMagnitude(S(),g.dirB,(l+d)/2),M=S.setMagnitude(S(),g.dirC,(f+p)/2),F=S.isFinite(E),N=S.isFinite(I),j=S.isFinite(M),k=S(),H=function(G,U,Q){S.copy(a,v),F&&S.scaleAndAdd(a,a,g.dirA,G),N&&S.scaleAndAdd(a,a,g.dirB,U),j&&S.scaleAndAdd(a,a,g.dirC,Q),S.add(k,k,a)};return H(u,l,f),H(u,l,-p),H(u,-d,-p),H(u,-d,f),H(-c,-d,-p),H(-c,-d,f),H(-c,l,f),H(-c,l,-p),S.scale(k,k,1/8),Uo.create(k,E,I,M)}e.calculateBoxAxes=i}(ql||(ql={})),function(e){function t(M){return void 0!==M.extrema}function r(M,F){return{center:M,radius:F}}function s(M,F){var N;return void 0!==M.extrema?(M.extrema.length=0,(N=M.extrema).push.apply(N,F)):M.extrema=F,M}e.hasExtrema=t,e.create=r,e.zero=function n(){return{center:S(),radius:0}},e.clone=function a(M){var F=r(S.clone(M.center),M.radius);return t(M)&&(F.extrema=M.extrema.map(function(N){return S.clone(N)})),F},e.set=function i(M,F,N){return S.copy(M.center,F),M.radius=N,M},e.copy=function o(M,F){return S.copy(M.center,F.center),M.radius=F.radius,t(F)&&s(M,F.extrema.map(function(N){return S.clone(N)})),M},e.setExtrema=s,e.computeBounding=function u(M){for(var F=M.x,N=M.y,j=M.z,k=M.indices,H=0,G=0,U=0,Q=0,W=Be.size(k),K=0;K<W;K++)H+=F[ne=Be.getAt(k,K)],G+=N[ne],U+=j[ne];for(W>0&&(H/=W,G/=W,U/=W),K=0;K<W;K++){var ne,X=F[ne=Be.getAt(k,K)]-H,L=N[ne]-G,Y=j[ne]-U,$=X*X+L*L+Y*Y;$>Q&&(Q=$)}return{center:S.create(H,G,U),radius:Math.sqrt(Q)}},e.transform=function c(M,F,N){return S.transformMat4(M.center,F.center,N),M.radius=F.radius*me.getMaxScaleOnAxis(N),t(F)&&s(M,F.extrema.map(function(j){return S.transformMat4(S(),j,N)})),M},e.translate=function l(M,F,N){return S.add(M.center,F.center,N),t(F)&&s(M,F.extrema.map(function(j){return S.add(S(),j,N)})),M},e.toArray=function d(M,F,N){return S.toArray(M.center,F,N),F[N+3]=M.radius,F},e.fromArray=function f(M,F,N){return S.fromArray(M.center,F,N),M.radius=F[N+3],M},e.fromBox3D=function p(M,F){return S.scale(M.center,S.add(M.center,F.max,F.min),.5),M.radius=S.distance(M.center,F.max),e.setExtrema(M,[S.create(F.min[0],F.min[1],F.min[2]),S.create(F.max[0],F.max[1],F.max[2]),S.create(F.max[0],F.min[1],F.min[2]),S.create(F.min[0],F.max[1],F.max[2]),S.create(F.min[0],F.min[1],F.max[2]),S.create(F.max[0],F.min[1],F.max[2]),S.create(F.max[0],F.max[1],F.min[2]),S.create(F.min[0],F.max[1],F.min[2])]),M},e.fromAxes3D=function h(M,F){return S.copy(M.center,F.origin),M.radius=Math.max(S.magnitude(F.dirA),S.magnitude(F.dirB),S.magnitude(F.dirC)),M};var m=S();e.fromDimensionsAndTransform=function v(M,F,N){var j=F[0],k=F[1],H=F[2],G=S.create(0,0,0);S.transformMat4(G,G,N);var U=S.create(j,k,H);S.transformMat4(U,U,N);var Q=S.create(j,0,0);S.transformMat4(Q,Q,N);var W=S.create(0,k,H);S.transformMat4(W,W,N);var K=S.create(0,0,H);S.transformMat4(K,K,N);var ne=S.create(j,0,H);S.transformMat4(ne,ne,N);var X=S.create(j,k,0);S.transformMat4(X,X,N);var L=S.create(0,k,0);S.transformMat4(L,L,N),S.add(m,G,U),S.scale(m,m,.5);var Y=Math.max(S.distance(G,U),S.distance(Q,W));return e.set(M,m,Y/2),e.setExtrema(M,[G,U,Q,W,K,ne,X,L]),M};var g=S();e.addVec3=function y(M,F,N){return S.distance(F.center,N)<F.radius?e.copy(M,F):(S.sub(g,F.center,N),S.sub(g,F.center,g),S.setMagnitude(g,g,F.radius),S.scale(M.center,S.add(g,g,N),.5),M.radius=S.distance(M.center,N),M)},e.expandBySphere=function b(M,F,N){return S.copy(M.center,F.center),M.radius=Math.max(F.radius,S.distance(F.center,N.center)+N.radius),t(F)&&t(N)&&s(M,sr(sr([],F.extrema.map(function(j){return S.clone(j)}),!0),N.extrema.map(function(j){return S.clone(j)}),!0)),M};var _=S();e.expand=function C(M,F,N){var j,k;if(S.copy(M.center,F.center),M.radius=F.radius+N,F.radius<1e-12||(null!==(k=null===(j=F.extrema)||void 0===j?void 0:j.length)&&void 0!==k?k:0)<=1)return M.extrema=void 0,M;if(t(F)){for(var H=new Float32Array(3*F.extrema.length),G=0;G<F.extrema.length;G++)S.toArray(F.extrema[G],H,3*G);var U=ql.calculateMomentsAxes(H);Uo.scale(U,Uo.normalize(U,U),N),s(M,F.extrema.map(function(Q){S.normalize(_,S.sub(_,Q,F.center));var W=S.clone(Q),K=S.dot(_,U.dirA)<0?-1:1;S.scaleAndAdd(W,W,U.dirA,K);var ne=S.dot(_,U.dirB)<0?-1:1;S.scaleAndAdd(W,W,U.dirB,ne);var X=S.dot(_,U.dirC)<0?-1:1;return S.scaleAndAdd(W,W,U.dirC,X),S.distance(M.center,W)>M.radius&&(F.extrema.length>=14&&S.normalize(_,S.sub(_,W,F.center)),S.scaleAndAdd(W,M.center,_,M.radius)),W}))}return M},e.exactEquals=function x(M,F){return M.radius===F.radius&&S.exactEquals(M.center,F.center)},e.equals=function A(M,F){var N=M.radius,j=F.radius;return Math.abs(N-j)<=gn*Math.max(1,Math.abs(N),Math.abs(j))&&S.equals(M.center,F.center)},e.includes=function T(M,F){if(t(F)){for(var N=0,j=F.extrema;N<j.length;N++)if(S.distance(M.center,j[N])>M.radius)return!1;return!0}return S.distance(M.center,F.center)+F.radius<=M.radius},e.overlaps=function w(M,F){return S.distance(M.center,F.center)<=M.radius+F.radius},e.distance=function E(M,F){return S.distance(M.center,F.center)-M.radius+F.radius},e.distanceToVec=function I(M,F){var j=M.radius;return S.distance(F,M.center)-j}}(De||(De={})),function(e){function r(){return{min:S(),max:S()}}function n(w,E){return S.copy(w.min,E.min),S.copy(w.max,E.max),w}e.create=function t(w,E){return{min:w,max:E}},e.zero=r,e.copy=n,e.clone=function a(w){return n(r(),w)};var i=S();function s(w,E){for(var I=0,M=E.length;I<M;I++)v(w,E[I]);return w}function u(w,E){return m(w),s(w,E),w}function f(w,E){return S.sub(w,E.max,E.min)}e.fromSphere3D=function o(w,E){return De.hasExtrema(E)&&E.extrema.length>=14?u(w,E.extrema):(S.set(i,E.radius,E.radius,E.radius),S.sub(w.min,E.center,i),S.add(w.max,E.center,i),w)},e.addVec3Array=s,e.fromVec3Array=u,e.addSphere3D=function c(w,E){return De.hasExtrema(E)&&E.extrema.length>=14?s(w,E.extrema):(v(w,S.subScalar(i,E.center,E.radius)),v(w,S.addScalar(i,E.center,E.radius)),w)},e.intersectsSphere3D=function l(w,E){return S.clamp(i,E.center,w.min,w.max),S.squaredDistance(i,E.center)<=E.radius*E.radius},e.computeBounding=function d(w){for(var E=S.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=S.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),M=w.x,F=w.y,N=w.z,j=w.indices,k=0,H=Be.size(j);k<H;k++){var G=Be.getAt(j,k);E[0]=Math.min(M[G],E[0]),E[1]=Math.min(F[G],E[1]),E[2]=Math.min(N[G],E[2]),I[0]=Math.max(M[G],I[0]),I[1]=Math.max(F[G],I[1]),I[2]=Math.max(N[G],I[2])}return{min:E,max:I}},e.size=f;var p=S();function m(w){return S.set(w.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S.set(w.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),w}function v(w,E){return S.min(w.min,w.min,E),S.max(w.max,w.max,E),w}e.volume=function h(w){return f(p,w),p[0]*p[1]*p[2]},e.setEmpty=m,e.add=v,e.expand=function g(w,E,I){return S.sub(w.min,E.min,I),S.add(w.max,E.max,I),w},e.scale=function y(w,E,I){return S.scale(w.min,E.min,I),S.scale(w.max,E.max,I),w};var b=S();e.transform=function _(w,E,I){var M=E.min,F=M[0],N=M[1],j=M[2],k=E.max,H=k[0],G=k[1],U=k[2];return m(w),v(w,S.transformMat4(b,S.set(b,F,N,j),I)),v(w,S.transformMat4(b,S.set(b,F,N,U),I)),v(w,S.transformMat4(b,S.set(b,F,G,j),I)),v(w,S.transformMat4(b,S.set(b,F,G,U),I)),v(w,S.transformMat4(b,S.set(b,H,N,j),I)),v(w,S.transformMat4(b,S.set(b,H,N,U),I)),v(w,S.transformMat4(b,S.set(b,H,G,j),I)),v(w,S.transformMat4(b,S.set(b,H,G,U),I)),w},e.containsVec3=function C(w,E){return!(E[0]<w.min[0]||E[0]>w.max[0]||E[1]<w.min[1]||E[1]>w.max[1]||E[2]<w.min[2]||E[2]>w.max[2])},e.overlaps=function x(w,E){return!(w.max[0]<E.min[0]||w.min[0]>E.max[0]||w.max[1]<E.min[1]||w.min[1]>E.max[1]||w.max[2]<E.min[2]||w.min[2]>E.max[2])},e.containsSphere3D=function A(w,E){var I=E.center,M=E.radius;return!(I[0]-M<w.min[0]||I[0]+M>w.max[0]||I[1]-M<w.min[1]||I[1]+M>w.max[1]||I[2]-M<w.min[2]||I[2]+M>w.max[2])},e.nearestIntersectionWithRay=function T(w,E,I,M){var $,Z,q,z,te,ae,F=E.min,N=F[0],j=F[1],k=F[2],H=E.max,G=H[0],U=H[1],Q=H[2],W=I[0],K=I[1],ne=I[2],X=1/M[0],L=1/M[1],Y=1/M[2];return X>=0?($=(N-W)*X,Z=(G-W)*X):($=(G-W)*X,Z=(N-W)*X),L>=0?(q=(j-K)*L,z=(U-K)*L):(q=(U-K)*L,z=(j-K)*L),Y>=0?(te=(k-ne)*Y,ae=(Q-ne)*Y):(te=(Q-ne)*Y,ae=(k-ne)*Y),q>$&&($=q),z<Z&&(Z=z),te>$&&($=te),ae<Z&&(Z=ae),S.scale(w,M,$),S.set(w,w[0]+W,w[1]+K,w[2]+ne)}}(Nt||(Nt={}));var E3e=function(){return function e(t,r){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=t,this.value=r,this.prev=this,this.next=this}}(),I3e=function(){function e(t){if(this._index=-1,this._items=[],this._len=0,t){var r=t,n=0;do{this._items[n++]=r,r=r.next}while(t!==r);this._len=n}}return e.prototype.hasNext=function(){return this._index<this._len-1},e.prototype.next=function(){return this._items[++this._index]},e.prototype.reset=function(t){this._index=-1,this._len=0;var r=t,n=0;do{this._items[n++]=r,r=r.next}while(t!==r);this._len=n},e}(),_N=new I3e,jX=function(){function e(t){this._minNode=null,this._nodeCount=0,this._compare=t||this._defaultCompare}return e.prototype.clear=function(){this._minNode=null,this._nodeCount=0},e.prototype.decreaseKey=function(t,r){if(!t)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:r},{key:t.key})>0)throw new Error("New key is larger than old key");t.key=r;var n=t.parent;n&&this._compare(t,n)<0&&(this._cut(t,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(t,this._minNode)<0&&(this._minNode=t)},e.prototype.delete=function(t){var r=t.parent;r&&(this._cut(t,r,this._minNode),this._cascadingCut(r,this._minNode)),this._minNode=t,this.extractMinimum()},e.prototype.extractMinimum=function(){var t=this._minNode;if(t){if(t.child){var r=t.child;do{r.parent=null,r=r.next}while(r!==t.child)}var n=null;t.next!==t&&(n=t.next),this._removeNodeFromList(t),this._nodeCount--,this._minNode=this._mergeLists(n,t.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return t},e.prototype.findMinimum=function(){return this._minNode},e.prototype.insert=function(t,r){var n=new E3e(t,r);return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n},e.prototype.isEmpty=function(){return null===this._minNode},e.prototype.size=function(){return null===this._minNode?0:this._getNodeListSize(this._minNode)},e.prototype.union=function(t){this._minNode=this._mergeLists(this._minNode,t._minNode),this._nodeCount+=t._nodeCount},e.prototype._defaultCompare=function(t,r){return t.key>r.key?1:t.key<r.key?-1:0},e.prototype._cut=function(t,r,n){t.parent=null,r.degree--,r.child=t.next===t?null:t.next,this._removeNodeFromList(t);var a=this._mergeLists(n,t);return t.isMarked=!1,a},e.prototype._cascadingCut=function(t,r){var n=t.parent;return n&&(t.isMarked?(r=this._cut(t,n,r),r=this._cascadingCut(n,r)):t.isMarked=!0),r},e.prototype._consolidate=function(t){var r=[];for(_N.reset(t);_N.hasNext();){for(var n=_N.next(),a=r[n.degree];a;){if(this._compare(n,a)>0){var i=n;n=a,a=i}this._linkHeaps(a,n),r[n.degree]=null,n.degree++,a=r[n.degree]}r[n.degree]=n}for(var o=null,s=0;s<r.length;s++){var u=r[s];u&&(u.next=u,u.prev=u,o=this._mergeLists(o,u))}return o},e.prototype._removeNodeFromList=function(t){var r=t.prev,n=t.next;r.next=n,n.prev=r,t.next=t,t.prev=t},e.prototype._linkHeaps=function(t,r){this._removeNodeFromList(t),r.child=this._mergeLists(t,r.child),t.parent=r,t.isMarked=!1},e.prototype._mergeLists=function(t,r){if(!t)return r||null;if(!r)return t;var n=t.next;return t.next=r.next,t.next.prev=t,r.next=n,r.next.prev=r,this._compare(t,r)<0?t:r},e.prototype._getNodeListSize=function(t){var r=0,n=t;do{r++,n.child&&(r+=this._getNodeListSize(n.child)),n=n.next}while(n!==t);return r},e}();function tp(e,t,r){return new P3e(e,t,r)}var P3e=function(){function e(t,r,n){var a=function R3e(e,t,r){var o,s,n=Nt.expand(Nt(),t.box,S.create(.5,.5,.5)),a=e.indices,i=Nt.size(S(),n),u=Be.size(a),c="number"==typeof r?r:32,l=Array.isArray(r)&&r;if(l&&!S.isZero(l))s=[Math.ceil(i[0]/l[0]),Math.ceil(i[1]/l[1]),Math.ceil(i[2]/l[2])],o=l;else if(u>0){var d=Math.ceil(u/c),f=Math.pow(d/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];return function M3e(e){for(var r=e.size,a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,c=o.z,l=o.radius,d=o.indices,f=e.elementCount,p=e.delta,h=r[0]*a*i,m=e.expandedBox.min,v=m[0],g=m[1],y=m[2],b=0,_=0,C=new Uint32Array(h),x=new Int32Array(f),A=0;A<f;A++){var T=Be.getAt(d,A),M=(Math.floor((s[T]-v)/p[0])*a+Math.floor((u[T]-g)/p[1]))*i+Math.floor((c[T]-y)/p[2]);1===(C[M]+=1)&&(_+=1),x[A]=M}if(l)for(A=0;A<f;A++)l[T=Be.getAt(d,A)]>b&&(b=l[T]);for(var F=new Int32Array(_),N=(T=0,0);T<h;T++){var j=C[T];j>0&&(C[T]=N+1,F[N]=j,N+=1)}var k=new Uint32Array(_);for(T=1;T<_;++T)k[T]+=k[T-1]+F[T-1];var H=new Int32Array(_),G=new Int32Array(f);for(T=0;T<f;T++){var U=C[x[T]];if(U>0){var Q=U-1;G[k[Q]+H[Q]]=T,H[Q]+=1}}return{size:e.size,bucketArray:G,bucketCounts:F,bucketOffset:k,grid:C,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}({size:s,data:{x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o})}(t,r,n);this.ctx=function O3e(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=Fc.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i??this.result;return qX(this.ctx,o),o},e.prototype.nearest=function(t,r,n,a,i,o){void 0===a&&(a=1),this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.k=a,this.ctx.stopIf=i;var s=o??this.result;return function B3e(e,t){var r=e.grid,n=r.min,a=r.expandedBox,i=r.boundingSphere.center,o=r.size,s=o[0],u=o[1],c=o[2],l=r.bucketOffset,d=r.bucketCounts,f=r.bucketArray,p=r.grid,h=r.data,m=h.x,v=h.y,g=h.z,y=h.indices,b=h.radius,_=r.delta,C=r.maxRadius,x=e.x,A=e.y,T=e.z,w=e.k,E=e.stopIf,I=Be.size(y);if(Fc.reset(t),0===I||w<=0)return!1;var M,F,N,ne,j=!1,k=1,H=!0,G=0,U=F3e,Q=N3e,W=0,K=!0,X=!1,L=k3e,Y=C*C;U.length=0,L.length=0,D2.clear(),Ey.clear(),S.set(Vh,x,A,T),Nt.containsVec3(a,Vh)?(M=Math.floor((x-n[0])/_[0]),F=Math.floor((A-n[1])/_[1]),N=Math.floor((T-n[2])/_[2])):(Nt.nearestIntersectionWithRay(Vh,a,Vh,S.normalize(WX,S.sub(WX,i,Vh))),M=Math.max(0,Math.min(s-1,Math.floor((Vh[0]-n[0])/_[0]))),F=Math.max(0,Math.min(u-1,Math.floor((Vh[1]-n[1])/_[1]))),N=Math.max(0,Math.min(c-1,Math.floor((Vh[2]-n[2])/_[2]))));var $=0!==C?Math.max(1,Math.min(s-1,Math.ceil(C/_[0]))):1,Z=0!==C?Math.max(1,Math.min(u-1,Math.ceil(C/_[1]))):1,q=0!==C?Math.max(1,Math.min(c-1,Math.ceil(C/_[2]))):1;for(U.push(M,F,N,(M*u+F)*c+N);t.count<I;){for(var z=4*k,te=0;te<z;te+=4)if(!D2.has(ne=U[te+3])){D2.add(ne),X=D2.size>=p.length;var ae=p[ne];if(0!==ae){for(var fe=W,he=ae-1,pe=l[he],ee=pe+d[he],ue=pe;ue<ee;ue++){var ge=f[ue],Ce=Be.getAt(y,ge),ze=m[Ce]-x,je=v[Ce]-A,V=g[Ce]-T,J=ze*ze+je*je+V*V;if(0!==C){var ye=b[Ce];J-=ye*ye}K&&J>W&&(W=J),Ey.insert(J,ge)}fe<W&&(K=!1)}}for(Q.length=0,G=0,SN.clear(),te=0;te<z;te+=4){M=U[te],F=U[te+1],N=U[te+2];for(var we=-$;we<=$;we++){var Ee=M+we;if(!(Ee<0||Ee>=s))for(var Fe=-Z;Fe<=Z;Fe++){var ke=F+Fe;if(!(ke<0||ke>=u))for(var Ue=-q;Ue<=q;Ue++){var $e=N+Ue;if(!($e<0||$e>=c||(ne=(Ee*u+ke)*c+$e,SN.has(ne)||(SN.add(ne),D2.has(ne))))){if(!H){var Pe=n[0]+Ee*_[0]-x,He=n[1]+ke*_[1]-A,Je=n[2]+$e*_[2]-T;if(Pe*Pe+He*He+Je*Je-Y>W){L.push(Ee,ke,$e,ne);continue}}Q.push(Ee,ke,$e,ne),G++}}}}}if(H=!1,0===G){if(1===w){if(ut=Ey.findMinimum())return Fc.add(t,Le=ut.value,wt=ut.key),!0}else for(;!Ey.isEmpty()&&(X||Ey.findMinimum().key<=W)&&t.count<w;){var wt,Le,ut=Ey.extractMinimum();Fc.add(t,Le=ut.value,wt=ut.key),E&&!j&&(j=E(Le,wt))}if(t.count>=w||j||t.count>=I)return t.count>0;if(H=!0,K=!0,L.length>0){ue=0;for(var st=L.length;ue<st;ue++)U.push(L[ue]);L.length=0,k=U.length}}else{var St=U;U=Q,Q=St,k=G}}}(this.ctx,s),s},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,qX(this.ctx,this.result)},e}();function qX(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,c=r.bucketCounts,l=r.bucketArray,d=r.grid,f=r.data,p=f.x,h=f.y,m=f.z,v=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,_=e.radius,C=e.isCheck,x=e.x,A=e.y,T=e.z,w=_+b,E=w*w;Fc.reset(t);var I=Math.max(0,Math.floor((x-w-n[0])/y[0])),M=Math.max(0,Math.floor((A-w-n[1])/y[1])),F=Math.max(0,Math.floor((T-w-n[2])/y[2])),N=Math.min(i-1,Math.floor((x+w-n[0])/y[0])),j=Math.min(o-1,Math.floor((A+w-n[1])/y[1])),k=Math.min(s-1,Math.floor((T+w-n[2])/y[2]));if(I>N||M>j||F>k)return!1;for(var H=I;H<=N;H++)for(var G=M;G<=j;G++)for(var U=F;U<=k;U++){var Q=d[(H*o+G)*s+U];if(0!==Q)for(var W=Q-1,K=u[W],X=K+c[W],L=K;L<X;L++){var Y=Be.getAt(v,l[L]),$=p[Y]-x,Z=h[Y]-A,q=m[Y]-T,z=$*$+Z*Z+q*q;if(z<=E){if(b>0&&Math.sqrt(z)-g[Y]>_)continue;if(C)return!0;Fc.add(t,l[L],z)}}}return t.count>0}var at,WX=S(),Vh=S(),D2=new Set,SN=new Set,F3e=[.1],N3e=[.1],k3e=[.1],Ey=new jX;!function(e){function t(p,h,m){return{kind:"element-location",structure:p,unit:h,element:m||0}}e.create=t,e.clone=function r(p){return t(p.structure,p.unit,p.element)},e.set=function n(p,h,m,v){return h&&(p.structure=h),m&&(p.unit=m),void 0!==v&&(p.element=v),p},e.copy=function a(p,h){return p.unit=h.unit,p.element=h.element,p},e.is=function i(p){return!!p&&"element-location"===p.kind},e.areEqual=function o(p,h){return p.unit===h.unit&&p.element===h.element};var s=S(),u=S();e.distance=function c(p,h){return p.unit.conformation.position(p.element,s),h.unit.conformation.position(h.element,u),S.distance(s,u)},e.position=function l(p,h){return h.unit.conformation.position(h.element,p)},e.residueIndex=function d(p){return p.unit.model.atomicHierarchy.residueAtomSegments.index[p.element]},e.chainIndex=function f(p){return p.unit.model.atomicHierarchy.chainAtomSegments.index[p.element]}}(at||(at={}));var L3e=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function CN(e,t){return new L3e(e,t)}function xN(){return new U3e}function YX(e){return{previous:null,next:null,inList:!0,value:e}}var On,Ae,oo,zt,Vr,U3e=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=YX(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=YX(t);return null!==this.last&&(this.last.next=r),r.previous=this.last,this.last=r,null===this.first&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){t.inList&&(t.inList=!1,null!==t.previous?t.previous.next=t.next:null===t.previous&&(this.first=t.next),null!==t.next?t.next.previous=t.previous:null===t.next&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;null!==r;){if(r.value===t)return r;r=r.next}},e}();function pt(e,t){var r=t||{},n=r.description,i=r.isOptional,s=r.isRest,c=r.defaultValue;return{type:e,isOptional:void 0!==i&&i,isRest:void 0!==s&&s,defaultValue:void 0===c?void 0:c,description:void 0===n?void 0:n}}function E2(e,t,r,n){var a=function(i){return oo.Apply(oo.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function XX(e,t,r,n){var a=function(i){return oo.Apply(oo.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id="".concat(e,".").concat(t),a.args=zt.None,a.type=r,a}function uT(e){return"function"==typeof e&&!!e.info&&!!e.args&&"string"==typeof e.info.namespace&&!!e.type}function Kt(e,t,r){return E2("",e,t,r)}function KX(e){$X("","",e)}function ZX(e){var t=[];return JX(e,t),t}function QX(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)}).replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)})}function $X(e,t,r){if(uT(r))return r.info.namespace=e,r.info.name=r.info.name||QX(t),void(r.id="".concat(r.info.namespace,".").concat(r.info.name));for(var n="".concat(r["@namespace"]||QX(t)),a=e?"".concat(e,".").concat(n):n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];"object"!=typeof r[s]&&!uT(r[s])||$X(a,s,r[s])}}function JX(e,t){if(uT(e))t.push(e);else for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];"object"!=typeof e[a]&&!uT(e[a])||JX(e[a],t)}}function ji(e,t){return Kt(zt.Dictionary({0:pt(e)}),e,t)}function zh(e,t){return Kt(zt.List(e,{nonEmpty:!0}),e,t)}function Nc(e,t,r){return Kt(zt.Dictionary({0:pt(e),1:pt(e)}),t,r)}!function(e){e.create=function t(){return{keys:new Set,array:[]}},e.add=function r(a,i,o){var s=a.keys,u=a.array;return!s.has(i)&&(s.add(i),u[u.length]=o,!0)},e.has=function n(a,i){return a.keys.has(i)}}(On||(On={})),function(e){function r(s,u,c){return{kind:"value",namespace:s,name:u,parent:c}}function i(s,u,c,l){for(var d=Object.create(null),f=0,p=l;f<p.length;f++)d[p[f]]=!0;return{kind:"oneof",namespace:s,name:u,type:c,values:d}}e.Variable=function t(s,u,c){return{kind:"variable",name:s,type:u,isConstraint:c}},e.Value=r,e.Container=function n(s,u,c,l){return{kind:"container",namespace:s,name:u,child:c,alias:l}},e.Union=function a(s){return{kind:"union",types:s}},e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]),e.oneOfValues=function o(s){return Object.keys(s.values).sort()}}(Ae||(Ae={})),function(e){function o(u){return!!u&&!!u.head&&"object"==typeof u}function s(u){return!!u&&"string"==typeof u.name}e.Symbol=function t(u){return{name:u}},e.Apply=function r(u,c){return c?{head:u,args:c}:{head:u}},e.isArgumentsArray=function n(u){return!!u&&Array.isArray(u)},e.isArgumentsMap=function a(u){return!!u&&!Array.isArray(u)},e.isLiteral=function i(u){return!o(u)&&!s(u)},e.isApply=o,e.isSymbol=s}(oo||(oo={})),function(e){function t(n){return{kind:"dictionary",map:n,"@type":0}}e.None=t({}),e.Dictionary=t,e.List=function r(n,a){var i=(a||{}).nonEmpty;return{kind:"list",type:n,nonEmpty:void 0!==i&&i,"@type":0}}}(zt||(zt={})),function(e){e.AnyVar=Ae.Variable("a",Ae.Any),e.AnyValueVar=Ae.Variable("a",Ae.Any),e.ConstrainedVar=Ae.Variable("a",Ae.Any,!0),e.Regex=Ae.Value("Core","Regex"),e.Set=function(t){return Ae.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return Ae.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return Ae.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return Ae.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(Ae.Num,"BitFlags")}(Vr||(Vr={})),zt.Dictionary({0:pt(Ae.Num),1:pt(Ae.Num)});var wN={"@header":"Language Primitives",type:{"@header":"Types",bool:Kt(zt.Dictionary({0:pt(Ae.AnyValue)}),Ae.Bool,"Convert a value to boolean."),num:Kt(zt.Dictionary({0:pt(Ae.AnyValue)}),Ae.Num,"Convert a value to number."),str:Kt(zt.Dictionary({0:pt(Ae.AnyValue)}),Ae.Str,"Convert a value to string."),regex:Kt(zt.Dictionary({0:pt(Ae.Str,{description:"Expression"}),1:pt(Ae.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Vr.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Kt(zt.List(Vr.AnyVar),Vr.List()),set:Kt(zt.List(Vr.AnyValueVar),Vr.Set()),bitflags:Kt(zt.Dictionary({0:pt(Ae.Num)}),Vr.BitFlags,"Interpret a number as bitflags."),compositeKey:Kt(zt.List(Ae.AnyValue),Ae.AnyValue)},logic:{"@header":"Logic",not:ji(Ae.Bool),and:zh(Ae.Bool),or:zh(Ae.Bool)},ctrl:{"@header":"Control",eval:Kt(zt.Dictionary({0:pt(Vr.Fn(Vr.AnyVar))}),Vr.AnyVar,"Evaluate a function."),fn:Kt(zt.Dictionary({0:pt(Vr.AnyVar)}),Vr.Fn(Vr.AnyVar),'Wrap an expression to a "lazy" function.'),if:Kt(zt.Dictionary({0:pt(Ae.Bool,{description:"Condition"}),1:pt(Ae.Variable("a",Ae.Any),{description:"If true"}),2:pt(Ae.Variable("b",Ae.Any),{description:"If false"})}),Ae.Union([Ae.Variable("a",Ae.Any),Ae.Variable("b",Ae.Any)])),assoc:Kt(zt.Dictionary({0:pt(Ae.Str,{description:"Name"}),1:pt(Ae.Variable("a",Ae.Any),{description:"Value to assign"})}),Ae.Variable("a",Ae.Any))},rel:{"@header":"Relational",eq:Nc(Ae.Variable("a",Ae.AnyValue,!0),Ae.Bool),neq:Nc(Ae.Variable("a",Ae.AnyValue,!0),Ae.Bool),lt:Nc(Ae.Num,Ae.Bool),lte:Nc(Ae.Num,Ae.Bool),gr:Nc(Ae.Num,Ae.Bool),gre:Nc(Ae.Num,Ae.Bool),inRange:Kt(zt.Dictionary({0:pt(Ae.Num,{description:"Value to test"}),1:pt(Ae.Num,{description:"Minimum value"}),2:pt(Ae.Num,{description:"Maximum value"})}),Ae.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},math:{"@header":"Math",add:zh(Ae.Num),sub:zh(Ae.Num),mult:zh(Ae.Num),div:Nc(Ae.Num,Ae.Num),pow:Nc(Ae.Num,Ae.Num),mod:Nc(Ae.Num,Ae.Num),min:zh(Ae.Num),max:zh(Ae.Num),cantorPairing:Nc(Ae.Num,Ae.Num),sortedCantorPairing:Nc(Ae.Num,Ae.Num),invertCantorPairing:Kt(zt.Dictionary({0:pt(Ae.Num)}),Vr.List(Ae.Num)),floor:ji(Ae.Num),ceil:ji(Ae.Num),roundInt:ji(Ae.Num),trunc:ji(Ae.Num),abs:ji(Ae.Num),sign:ji(Ae.Num),sqrt:ji(Ae.Num),cbrt:ji(Ae.Num),sin:ji(Ae.Num),cos:ji(Ae.Num),tan:ji(Ae.Num),asin:ji(Ae.Num),acos:ji(Ae.Num),atan:ji(Ae.Num),sinh:ji(Ae.Num),cosh:ji(Ae.Num),tanh:ji(Ae.Num),exp:ji(Ae.Num),log:ji(Ae.Num),log10:ji(Ae.Num),atan2:Nc(Ae.Num,Ae.Num)},str:{"@header":"Strings",concat:zh(Ae.Str),match:Kt(zt.Dictionary({0:pt(Vr.Regex),1:pt(Ae.Str)}),Ae.Bool)},list:{"@header":"Lists",getAt:Kt(zt.Dictionary({0:pt(Vr.List()),1:pt(Ae.Num)}),Vr.AnyVar),equal:Kt(zt.Dictionary({0:pt(Vr.List()),1:pt(Vr.List())}),Ae.Bool)},set:{"@header":"Sets",has:Kt(zt.Dictionary({0:pt(Vr.Set(Vr.ConstrainedVar)),1:pt(Vr.ConstrainedVar)}),Ae.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Kt(zt.Dictionary({0:pt(Vr.Set(Vr.ConstrainedVar)),1:pt(Vr.Set(Vr.ConstrainedVar))}),Ae.Bool,"Check if the the 1st argument is a subset of the 2nd.")},flags:{"@header":"Flags",hasAny:Kt(zt.Dictionary({0:pt(Vr.Flags(Vr.ConstrainedVar)),1:pt(Vr.Flags(Vr.ConstrainedVar))}),Ae.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Kt(zt.Dictionary({0:pt(Vr.Flags(Vr.ConstrainedVar)),1:pt(Vr.Flags(Vr.ConstrainedVar))}),Ae.Bool,"Check if the the 1st argument has all 2nd one's flags.")}};KX(wN);var Tt,K3e=ZX(wN);function Nr(e,t){return Kt(zt.Dictionary({0:pt(Tt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function Iy(e,t){return Kt(zt.None,e,t)}!function(){for(var e=Object.create(null),t=0,r=K3e;t<r.length;t++){var n=r[t];e[n.id]=n}}(),function(e){e.ElementSymbol=Ae.Value("Structure","ElementSymbol"),e.AtomName=Ae.Value("Structure","AtomName"),e.BondFlag=Ae.OneOf("Structure","BondFlag",Ae.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=Vr.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=Ae.OneOf("Structure","SecondaryStructureFlag",Ae.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=Vr.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=Ae.Value("Structure","RingFingerprint"),e.EntityType=Ae.OneOf("Structure","EntityType",Ae.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=Ae.OneOf("Structure","EntitySubtype",Ae.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=Ae.OneOf("Structure","ObjectPrimitive",Ae.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=Ae.Value("Structure","ResidueId"),e.ElementSet=Ae.Value("Structure","ElementSet"),e.ElementSelection=Ae.Value("Structure","ElementSelection"),e.ElementReference=Ae.Value("Structure","ElementReference"),e.ElementSelectionQuery=Vr.Fn(e.ElementSelection,"ElementSelectionQuery")}(Tt||(Tt={}));var _e={core:wN,structureQuery:{"@header":"Structure Queries",type:{"@header":"Types",elementSymbol:Kt(zt.Dictionary({0:pt(Ae.Str)}),Tt.ElementSymbol,"Create element symbol representation from a string value."),atomName:Kt(zt.Dictionary({0:pt(Ae.AnyValue)}),Tt.AtomName,"Convert a value to an atom name."),entityType:Kt(zt.Dictionary({0:pt(Tt.EntityType)}),Tt.EntityType,"Create normalized representation of entity type: ".concat(Ae.oneOfValues(Tt.EntityType).join(", "),".")),bondFlags:Kt(zt.List(Tt.BondFlag),Tt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: ".concat(Ae.oneOfValues(Tt.BondFlag).join(", "),".")),ringFingerprint:Kt(zt.List(Tt.ElementSymbol,{nonEmpty:!0}),Tt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Kt(zt.List(Tt.SecondaryStructureFlag),Tt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: ".concat(Ae.oneOfValues(Tt.SecondaryStructureFlag).join(", "),".")),authResidueId:Kt(zt.Dictionary({0:pt(Ae.Str,{description:"auth_asym_id"}),1:pt(Ae.Num,{description:"auth_seq_id"}),2:pt(Ae.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Tt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Kt(zt.Dictionary({0:pt(Ae.Str,{description:"label_entity_id"}),1:pt(Ae.Str,{description:"label_asym_id"}),2:pt(Ae.Num,{description:"label_seq_id"}),3:pt(Ae.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Tt.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')},slot:{"@header":"Iteration Slots",element:Kt(zt.None,Tt.ElementReference,"A reference to the current element."),elementSetReduce:Kt(zt.None,Ae.Variable("a",Ae.AnyValue,!0),"Current value of the element set reducer.")},generator:{"@header":"Generators",all:Kt(zt.None,Tt.ElementSelectionQuery,"The entire structure."),atomGroups:Kt(zt.Dictionary({"entity-test":pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":pt(Ae.Bool,{isOptional:!0,defaultValue:!0}),"group-by":pt(Ae.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Tt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Kt(zt.Dictionary({0:pt(Ae.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Tt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Kt(zt.Dictionary({fingerprint:pt(Tt.RingFingerprint,{isOptional:!0}),"only-aromatic":pt(Ae.Bool,{isOptional:!0,defaultValue:!1})}),Tt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),query:pt(Tt.ElementSelectionQuery),"in-complement":pt(Ae.Bool,{isOptional:!0,defaultValue:!1})}),Tt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Kt(zt.None,Tt.ElementSelectionQuery,"Nada.")},modifier:{"@header":"Selection Modifications",queryEach:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),query:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),by:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),by:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),by:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),"min-distance":pt(Ae.Num,{isOptional:!0,defaultValue:0}),"max-distance":pt(Ae.Num),"min-size":pt(Ae.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":pt(Ae.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Tt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),radius:pt(Ae.Num),"atom-radius":pt(Ae.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":pt(Ae.Bool,{isOptional:!0})}),Tt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),radius:pt(Ae.Num),"include-water":pt(Ae.Bool,{isOptional:!0,defaultValue:!0})}),Tt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),"bond-test":pt(Ae.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":pt(Ae.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":pt(Ae.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":pt(Ae.Bool,{isOptional:!0})}),Tt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),property:pt(Ae.AnyValue)}),Tt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},filter:{"@header":"Selection Filters",pick:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),test:pt(Ae.Bool)}),Tt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),source:pt(Tt.ElementSelectionQuery),property:pt(Ae.Any)}),Tt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),by:pt(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),target:pt(Tt.ElementSelectionQuery),"min-radius":pt(Ae.Num,{isOptional:!0,defaultValue:0}),"max-radius":pt(Ae.Num),"atom-radius":pt(Ae.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:pt(Ae.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Tt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery),target:pt(Tt.ElementSelectionQuery),"bond-test":pt(Ae.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:pt(Ae.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Tt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},combinator:{"@header":"Selection Combinators",intersect:Kt(zt.List(Tt.ElementSelectionQuery),Tt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Kt(zt.List(Tt.ElementSelectionQuery),Tt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Kt(zt.Dictionary({matrix:pt(Vr.List(Vr.List(Ae.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:pt(Vr.List(Tt.ElementSelectionQuery),{description:"A list of held selections."})}),Tt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},atomSet:{"@header":"Atom Sets",atomCount:Kt(zt.None,Ae.Num),countQuery:Kt(zt.Dictionary({0:pt(Tt.ElementSelectionQuery)}),Ae.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Kt(zt.Dictionary({initial:pt(Ae.Variable("a",Ae.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:pt(Ae.Variable("a",Ae.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),Ae.Variable("a",Ae.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Kt(zt.Dictionary({0:pt(Vr.ConstrainedVar)}),Vr.Set(Vr.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},atomProperty:{"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Nr(Tt.ElementSymbol),vdw:Nr(Ae.Num,"Van der Waals radius"),mass:Nr(Ae.Num,"Atomic weight"),atomicNumber:Nr(Ae.Num,"Atomic number"),x:Nr(Ae.Num,"Cartesian X coordinate"),y:Nr(Ae.Num,"Cartesian Y coordinate"),z:Nr(Ae.Num,"Cartesian Z coordinate"),atomKey:Nr(Ae.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Kt(zt.Dictionary({0:pt(Tt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:pt(Tt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),Ae.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Nr(Ae.Num,"Index of the atom/element in the input file."),operatorName:Nr(Ae.Str,"Name of the symmetry operator applied to this element."),operatorKey:Nr(Ae.Num,"Key of the symmetry operator applied to this element."),modelIndex:Nr(Ae.Num,"Index of the model in the input file."),modelLabel:Nr(Ae.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Nr(Ae.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Nr(Tt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Nr(Tt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Nr(Ae.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Nr(Ae.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Nr(Ae.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Nr(Ae.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Nr(Ae.Num,"_atom_site.id"),label_atom_id:Nr(Tt.AtomName),label_alt_id:Nr(Ae.Str),label_comp_id:Nr(Ae.Str),label_asym_id:Nr(Ae.Str),label_entity_id:Nr(Ae.Str),label_seq_id:Nr(Ae.Num),auth_atom_id:Nr(Tt.AtomName),auth_comp_id:Nr(Ae.Str),auth_asym_id:Nr(Ae.Str),auth_seq_id:Nr(Ae.Num),pdbx_PDB_ins_code:Nr(Ae.Str),pdbx_formal_charge:Nr(Ae.Num),occupancy:Nr(Ae.Num),B_iso_or_equiv:Nr(Ae.Num),entityType:Nr(Tt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Nr(Tt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Nr(Ae.Str,"The PRD ID of the entity."),entityDescription:Nr(Vr.List(Ae.Str)),objectPrimitive:Nr(Tt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Nr(Ae.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Nr(Tt.SecondaryStructureFlags),isModified:Nr(Ae.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Nr(Ae.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Nr(Ae.Bool,"True if this is a non-standard residue."),chemCompType:Nr(Ae.Str,"Type of the chemical component as defined in mmCIF.")}},bondProperty:{"@header":"Bond Properties",flags:Iy(Tt.BondFlags),order:Iy(Ae.Num),key:Iy(Ae.Num),length:Iy(Ae.Num),atomA:Iy(Tt.ElementReference),atomB:Iy(Tt.ElementReference)}},internal:{"@header":"Internal Queries",generator:{"@header":"Generators",bundleElement:Kt(zt.Dictionary({groupedUnits:pt(Ae.Any),set:pt(Ae.Any),ranges:pt(Ae.Any)}),Ae.Any),bundle:Kt(zt.Dictionary({elements:pt(Ae.Any)}),Tt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Kt(zt.None,Tt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")}}};KX(_e);var de,uPe=ZX(_e);function qi(){return qi.zero()}function Wl(){return Wl.zero()}function dt(e){return e}function zr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function cT(e,t,r){var n={};for(var a in e){var i=e[a];i=dt.saturate(i,t),i=dt.darken(i,-r),n[a]=i}return n}function eK(e,t){return void 0===t&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1".concat(t,"$2"))}!function(){for(var e=Object.create(null),t=0,r=uPe;t<r.length;t++){var n=r[t];e[n.id]=n}}(),function(e){e.core=_e.core,e.struct=_e.structureQuery,e.internal=_e.internal,e.atomName=function t(y){return e.struct.type.atomName([y])},e.es=function r(y){return e.struct.type.elementSymbol([y])},e.list=function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)},e.set=function a(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)},e.re=function i(y,b){return e.core.type.regex([y,b])},e.fn=function o(y){return e.core.ctrl.fn([y])},e.evaluate=function s(y){return e.core.ctrl.eval([y])};var u=e.struct.atomProperty.core,c=e.struct.atomProperty.macromolecular,l=e.struct.atomProperty.topology;function d(y){return u[y]()}function f(y){return l[y]()}function p(y){return c[y]()}e.acp=d,e.atp=f,e.ammp=p;var h=e.struct.atomSet.propertySet;e.acpSet=function m(y){return h([d(y)])},e.atpSet=function v(y){return h([f(y)])},e.ammpSet=function g(y){return h([p(y)])}}(de||(de={})),function(e){function t(){var M=[.1,0,0];return M[0]=0,M}function u(M,F){var N=F[0],j=F[1],k=F[2],H=Math.sqrt(j*j+k*k),G=(Ju(Math.atan2(k,j))+360)%360;return 0===Math.round(1e4*H)&&(G=Number.NaN),M[0]=G,M[1]=H,M[2]=N,M}function l(M,F,N){return M[0]=F[0]-m*N,M[1]=F[1],M[2]=F[2],M}e.zero=t,e.create=function r(M,F,N){var j=t();return j[0]=M,j[1]=F,j[2]=N,j},e.set=function n(M,F,N,j){return M[0]=F,M[1]=N,M[2]=j,M},e.distance=function a(M,F){var N=F[0]-M[0],j=F[1]-M[1],k=F[2]-M[2];return Math.sqrt(N*N+j*j+k*k)},e.fromColor=function i(M,F){var N=dt.toRgb(F),G=function I(M,F,N){return[E((.4124564*(M=w(M))+.3575761*(F=w(F))+.1804375*(N=w(N)))/v),E((.2126729*M+.7151522*F+.072175*N)/g),E((.0193339*M+.119192*F+.9503041*N)/y)]}(N[0],N[1],N[2]),U=G[0],Q=G[1],W=G[2],K=116*Q-16;return M[0]=K<0?0:K,M[1]=500*(U-Q),M[2]=200*(Q-W),M},e.fromHcl=function o(M,F){return Wl.toLab(M,F)},e.toColor=function s(M){var F=(M[0]+16)/116,N=isNaN(M[1])?F:F+M[1]/500,j=isNaN(M[2])?F:F-M[2]/200;F=g*T(F);var k=A(3.2404542*(N=v*T(N))-1.5371385*F-.4985314*(j=y*T(j))),H=A(-.969266*N+1.8760108*F+.041556*j),G=A(.0556434*N-.2040259*F+1.0572252*j);return dt.fromRgb(Math.round(ao(k,0,255)),Math.round(ao(H,0,255)),Math.round(ao(G,0,255)))},e.toHcl=u,e.copy=function c(M,F){return M[0]=F[0],M[1]=F[1],M[2]=F[2],M},e.darken=l,e.lighten=function d(M,F,N){return l(M,F,-N)};var f=[0,0,0];function p(M,F,N){return u(f,F),Wl.toLab(M,Wl.saturate(f,f,N))}e.saturate=p,e.desaturate=function h(M,F,N){return p(M,F,-N)};var m=18,v=.95047,g=1,y=1.08883,b=.137931034,_=.206896552,C=.12841855,x=.008856452;function A(M){return 255*(M<=.00304?12.92*M:1.055*Math.pow(M,1/2.4)-.055)}function T(M){return M>_?M*M*M:C*(M-b)}function w(M){return(M/=255)<=.04045?M/12.92:Math.pow((M+.055)/1.055,2.4)}function E(M){return M>x?Math.pow(M,1/3):M/C+b}}(qi||(qi={})),function(e){function t(){var y=[.1,0,0];return y[0]=0,y}e.zero=t,e.create=function r(y,b,_){var C=t();return C[0]=y,C[1]=b,C[2]=_,C},e.set=function n(y,b,_,C){return y[0]=b,y[1]=_,y[2]=C,y},e.hasHue=function a(y){return!isNaN(y[0])};var i=[0,0,0];e.fromColor=function o(y,b){return qi.toHcl(y,qi.fromColor(i,b))},e.fromLab=function s(y,b){return qi.toHcl(y,b)};var u=[0,0,0];function l(y,b){var _=b[0],C=b[1],x=b[2];return isNaN(_)&&(_=0),_=Zr(_),y[0]=x,y[1]=Math.cos(_)*C,y[2]=Math.sin(_)*C,y}function f(y,b,_){return y[0]=b[0],y[1]=Math.max(0,b[1]+g*_),y[2]=b[2],y}e.toColor=function c(y){return qi.toColor(l(u,y))},e.toLab=l,e.copy=function d(y,b){return y[0]=b[0],y[1]=b[1],y[2]=b[2],y},e.saturate=f,e.desaturate=function p(y,b,_){return f(y,b,-_)};var h=[0,0,0];function m(y,b,_){return l(h,b),qi.toHcl(y,qi.darken(h,h,_))}e.darken=m,e.lighten=function v(y,b,_){return m(y,b,-_)};var g=18}(Wl||(Wl={})),function(e){function c(k,H,G){return k<<16|H<<8|G}function l(k,H,G){return 255*k<<16|255*H<<8|255*G}function y(k){var H=k>>16&255;return H!==(k>>8&255)||H!==(255&k)}e.toStyle=function t(k){return"rgb(".concat(k>>16&255,", ").concat(k>>8&255,", ").concat(255&k,")")},e.toHexStyle=function r(k){return"#"+("000000"+k.toString(16)).slice(-6)},e.toHexString=function n(k){return"0x"+("000000"+k.toString(16)).slice(-6)},e.toRgbString=function a(k){return"RGB: ".concat(e.toRgb(k).join(", "))},e.toRgb=function i(k){return[k>>16&255,k>>8&255,255&k]},e.toRgbNormalized=function o(k){return[(k>>16&255)/255,(k>>8&255)/255,(255&k)/255]},e.fromHexStyle=function s(k){return parseInt(k.replace("#","0x"))},e.fromHexString=function u(k){return parseInt(k)},e.fromRgb=c,e.fromNormalizedRgb=l,e.fromArray=function d(k,H){return c(k[H],k[H+1],k[H+2])},e.fromNormalizedArray=function f(k,H){return l(k[H],k[H+1],k[H+2])},e.toArray=function p(k,H,G){return H[G]=k>>16&255,H[G+1]=k>>8&255,H[G+2]=255&k,H},e.toArrayNormalized=function h(k,H,G){return H[G]=(k>>16&255)/255,H[G+1]=(k>>8&255)/255,H[G+2]=(255&k)/255,H},e.toVec3=function m(k,H){return k[0]=H>>16&255,k[1]=H>>8&255,k[2]=255&H,k},e.toVec3Normalized=function v(k,H){return k[0]=(H>>16&255)/255,k[1]=(H>>8&255)/255,k[2]=(255&H)/255,k},e.interpolate=function g(k,H,G){var U=k>>16&255,Q=k>>8&255,W=255&k;return U+((H>>16&255)-U)*G<<16|Q+((H>>8&255)-Q)*G<<8|W+((255&H)-W)*G},e.hasHue=y;var b=[0,0,0];function _(k,H){return y(k)?(Wl.fromColor(b,k),Wl.toColor(Wl.saturate(b,b,H))):k}e.saturate=_,e.desaturate=function C(k,H){return _(k,-H)};var x=[0,0,0];function A(k,H){return qi.fromColor(x,k),qi.toColor(qi.darken(x,x,H))}function w(k){return k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4)}function E(k){return.2126*w((k>>16&255)/255)+.7152*w((k>>8&255)/255)+.0722*w((255&k)/255)}function M(k){return k<.04045?.0773993808*k:Math.pow(.9478672986*k+.0521327014,2.4)}function N(k){return k<.0031308?12.92*k:1.055*Math.pow(k,.41666)-.055}e.darken=A,e.lighten=function T(k,H){return A(k,-H)},e.luminance=E,e.contrast=function I(k,H){var G=E(k),U=E(H);return G>U?(G+.05)/(U+.05):(U+.05)/(G+.05)},e.sRGBToLinear=function F(k){return l(M((k>>16&255)/255),M((k>>8&255)/255),M((255&k)/255))},e.linearToSRGB=function j(k){return l(N((k>>16&255)/255),N((k>>8&255)/255),N((255&k)/255))}}(dt||(dt={}));var dPe=function(e){return e.toUpperCase()};function Rv(e){return e.toLowerCase().replace(/^\w|\s\w/g,dPe)}function kc(e){return Rv(eK(function tK(e){return e.replace(/_/g," ")}(function rK(e){return e.replace(/-/g," ")}(e))))}function Ja(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function AN(e){return e.replace(/<\/?[^>]+>/g,"")}function I2(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var wu={"orange-red":zr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":zr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":zr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:zr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":zr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":zr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":zr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:zr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":zr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:zr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":zr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:zr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":zr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:zr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":zr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":zr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:zr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":zr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:zr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":zr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":zr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":zr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":zr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":zr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":zr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":zr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":zr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":zr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:zr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":zr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":zr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":zr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:zr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":zr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":zr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":zr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:zr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:zr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:zr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:zr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:zr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:zr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:zr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:zr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":zr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},nK=Object.keys(wu).map(function(e){return[e,wu[e].label,Rv(wu[e].type)]});function rp(e){return e in wu?wu[e]:(console.warn("unknown color list named '".concat(e,"'")),wu["red-yellow-blue"])}function Gh(e){return{kind:"table-legend",table:e}}nK.filter(function(e){return"diverging"===wu[e[0]].type||"sequential"===wu[e[0]].type}),nK.filter(function(e){return"qualitative"===wu[e[0]].type});var Bc,vPe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""};!function(e){e.create=function t(r){var n=R(R({},vPe),r),a=n.domain,i=n.reverse,o=n.listOrName,s="string"==typeof o?rp(o).list:o,u=i?s.slice().reverse():s,c=u.length-1,l=0,d=0,f=0;function p(x,A){l=(f=A)-(d=x)||1}p(a[0],a[1]);var v,h=Po(r.minLabel,d.toString()),m=Po(r.maxLabel,f.toString());if(u.every(function(x){return Array.isArray(x)})){var y=sr([],u,!0);y.sort(function(x,A){return x[1]-A[1]});var b=y.map(function(x){return x[0]}),_=Xe.ofSortedArray(y.map(function(x){return x[1]})),C=b.length-1;v=function(x){var A=ao((x-d)/l,0,1),T=Xe.findPredecessorIndex(_,A);if(0===T)return b[d];if(T>C)return b[C];var w=_[T-1],I=ao((A-w)/(_[T]-w),0,1);return dt.interpolate(b[T-1],b[T],I)}}else v=function(x){var A=Math.min(u.length-1,Math.max(0,(x-d)/l*c)),T=Math.floor(A),w=u[T],E=u[Math.ceil(A)];return dt.interpolate(w,E,A-T)};return{color:v,colorToArray:function(x,A,T){dt.toArray(v(x),A,T)},normalizedColorToArray:function(x,A,T){dt.toArrayNormalized(v(x),A,T)},setDomain:p,get legend(){return function mPe(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}(h,m,u)}}}}(Bc||(Bc={}));var Au,Tu,aK=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WOO","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6X","X6Y","XBP","XDP","XDX","XGP","XIL","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]),Fn=function(e){return e[e.FilledSphere=0]="FilledSphere",e[e.FilledCube=1]="FilledCube",e[e.CrossedCube=2]="CrossedCube",e[e.DividedDiamond=3]="DividedDiamond",e[e.FilledCone=4]="FilledCone",e[e.DevidedCone=5]="DevidedCone",e[e.FlatBox=6]="FlatBox",e[e.FilledStar=7]="FilledStar",e[e.FilledDiamond=8]="FilledDiamond",e[e.FlatDiamond=9]="FlatDiamond",e[e.FlatHexagon=10]="FlatHexagon",e[e.Pentagon=11]="Pentagon",e[e.DiamondPrism=12]="DiamondPrism",e[e.PentagonalPrism=13]="PentagonalPrism",e[e.HexagonalPrism=14]="HexagonalPrism",e[e.HeptagonalPrism=15]="HeptagonalPrism",e}(Fn||{}),xt=function(e){return e[e.Hexose=0]="Hexose",e[e.HexNAc=1]="HexNAc",e[e.Hexosamine=2]="Hexosamine",e[e.Hexuronate=3]="Hexuronate",e[e.Deoxyhexose=4]="Deoxyhexose",e[e.DeoxyhexNAc=5]="DeoxyhexNAc",e[e.DiDeoxyhexose=6]="DiDeoxyhexose",e[e.Pentose=7]="Pentose",e[e.Deoxynonulosonate=8]="Deoxynonulosonate",e[e.DiDeoxynonulosonate=9]="DiDeoxynonulosonate",e[e.Unknown=10]="Unknown",e[e.Assigned=11]="Assigned",e}(xt||{});(Au={})[xt.Hexose]="Hexose",Au[xt.HexNAc]="HexNAc",Au[xt.Hexosamine]="Hexosamine",Au[xt.Hexuronate]="Hexuronate",Au[xt.Deoxyhexose]="Deoxyhexose",Au[xt.DeoxyhexNAc]="DeoxyhexNAc",Au[xt.DiDeoxyhexose]="Di-deoxyhexose",Au[xt.Pentose]="Pentose",Au[xt.Deoxynonulosonate]="Deoxynonulosonate",Au[xt.DiDeoxynonulosonate]="Di-deoxynonulosonate",Au[xt.Unknown]="Unknown",Au[xt.Assigned]="Assigned";var yPe=((Tu={})[xt.Hexose]=Fn.FilledSphere,Tu[xt.HexNAc]=Fn.FilledCube,Tu[xt.Hexosamine]=Fn.CrossedCube,Tu[xt.Hexuronate]=Fn.DividedDiamond,Tu[xt.Deoxyhexose]=Fn.FilledCone,Tu[xt.DeoxyhexNAc]=Fn.DevidedCone,Tu[xt.DiDeoxyhexose]=Fn.FlatBox,Tu[xt.Pentose]=Fn.FilledStar,Tu[xt.Deoxynonulosonate]=Fn.FilledDiamond,Tu[xt.DiDeoxynonulosonate]=Fn.FlatDiamond,Tu[xt.Unknown]=Fn.FlatHexagon,Tu[xt.Assigned]=Fn.Pentagon,Tu);function bPe(e,t){return e===xt.Unknown?4===t?Fn.DiamondPrism:5===t?Fn.PentagonalPrism:6===t?Fn.HexagonalPrism:7===t?Fn.HeptagonalPrism:Fn.FlatHexagon:yPe[e]}var fa,TN={abbr:"Unk",name:"Unknown",color:15854817,type:xt.Unknown},Py=[{abbr:"Glc",name:"Glucose",color:37052,type:xt.Hexose},{abbr:"Man",name:"Mannose",color:42577,type:xt.Hexose},{abbr:"Gal",name:"Galactose",color:16765952,type:xt.Hexose},{abbr:"Gul",name:"Gulose",color:16021792,type:xt.Hexose},{abbr:"Alt",name:"Altrose",color:16162465,type:xt.Hexose},{abbr:"All",name:"Allose",color:10830745,type:xt.Hexose},{abbr:"Tal",name:"Talose",color:9424105,type:xt.Hexose},{abbr:"Ido",name:"Idose",color:10582605,type:xt.Hexose},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:37052,type:xt.HexNAc},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:42577,type:xt.HexNAc},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:16765952,type:xt.HexNAc},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:16021792,type:xt.HexNAc},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:16162465,type:xt.HexNAc},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:10830745,type:xt.HexNAc},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:9424105,type:xt.HexNAc},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:10582605,type:xt.HexNAc},{abbr:"GlcN",name:"Glucosamine",color:37052,type:xt.Hexosamine},{abbr:"ManN",name:"Mannosamine",color:42577,type:xt.Hexosamine},{abbr:"GalN",name:"Galactosamine",color:16765952,type:xt.Hexosamine},{abbr:"GulN",name:"Gulosamine",color:16021792,type:xt.Hexosamine},{abbr:"AltN",name:"Altrosamine",color:16162465,type:xt.Hexosamine},{abbr:"AllN",name:"Allosamine",color:10830745,type:xt.Hexosamine},{abbr:"TalN",name:"Talosamine",color:9424105,type:xt.Hexosamine},{abbr:"IdoN",name:"Idosamine",color:10582605,type:xt.Hexosamine},{abbr:"GlcA",name:"Glucuronic Acid",color:37052,type:xt.Hexuronate},{abbr:"ManA",name:"Mannuronic Acid",color:42577,type:xt.Hexuronate},{abbr:"GalA",name:"Galacturonic Acid",color:16765952,type:xt.Hexuronate},{abbr:"GulA",name:"Guluronic Acid",color:16021792,type:xt.Hexuronate},{abbr:"AltA",name:"Altruronic Acid",color:16162465,type:xt.Hexuronate},{abbr:"AllA",name:"Alluronic Acid",color:10830745,type:xt.Hexuronate},{abbr:"TalA",name:"Taluronic Acid",color:9424105,type:xt.Hexuronate},{abbr:"IdoA",name:"Iduronic Acid",color:10582605,type:xt.Hexuronate},{abbr:"Qui",name:"Quinovose",color:37052,type:xt.Deoxyhexose},{abbr:"Rha",name:"Rhamnose",color:42577,type:xt.Deoxyhexose},{abbr:"6dGul",name:"6-Deoxy Gulose",color:16021792,type:xt.Deoxyhexose},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:16162465,type:xt.Deoxyhexose},{abbr:"6dTal",name:"6-Deoxy Talose",color:9424105,type:xt.Deoxyhexose},{abbr:"Fuc",name:"Fucose",color:15539236,type:xt.Deoxyhexose},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:37052,type:xt.DeoxyhexNAc},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:42577,type:xt.DeoxyhexNAc},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:16162465,type:xt.DeoxyhexNAc},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:9424105,type:xt.DeoxyhexNAc},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:15539236,type:xt.DeoxyhexNAc},{abbr:"Oli",name:"Olivose",color:37052,type:xt.DiDeoxyhexose},{abbr:"Tyv",name:"Tyvelose",color:42577,type:xt.DiDeoxyhexose},{abbr:"Abe",name:"Abequose",color:16021792,type:xt.DiDeoxyhexose},{abbr:"Par",name:"Paratose",color:16162465,type:xt.DiDeoxyhexose},{abbr:"Dig",name:"Digitoxose",color:10830745,type:xt.DiDeoxyhexose},{abbr:"Col",name:"Colitose",color:9424105,type:xt.DiDeoxyhexose},{abbr:"Ara",name:"Arabinose",color:42577,type:xt.Pentose},{abbr:"Lyx",name:"Lyxose",color:16765952,type:xt.Pentose},{abbr:"Xyl",name:"Xylose",color:16021792,type:xt.Pentose},{abbr:"Rib",name:"Ribose",color:16162465,type:xt.Pentose},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:42577,type:xt.Deoxynonulosonate},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:10830745,type:xt.Deoxynonulosonate},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:9424105,type:xt.Deoxynonulosonate},{abbr:"Neu",name:"Neuraminic Acid",color:10582605,type:xt.Deoxynonulosonate},{abbr:"Sia",name:"Sialic acid",color:15539236,type:xt.Deoxynonulosonate},{abbr:"Pse",name:"Pseudaminic Acid",color:42577,type:xt.DiDeoxynonulosonate},{abbr:"Leg",name:"Legionaminic Acid",color:16765952,type:xt.DiDeoxynonulosonate},{abbr:"Aci",name:"Acinetaminic Acid",color:16162465,type:xt.DiDeoxynonulosonate},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:9424105,type:xt.DiDeoxynonulosonate},{abbr:"Bac",name:"Bacillosamine",color:37052,type:xt.Unknown},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:42577,type:xt.Unknown},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:16765952,type:xt.Unknown},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:16021792,type:xt.Unknown},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:16162465,type:xt.Unknown},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:10830745,type:xt.Unknown},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:9424105,type:xt.Unknown},{abbr:"Mur",name:"Muramic Acid",color:10582605,type:xt.Unknown},{abbr:"Api",name:"Apicose",color:42577,type:xt.Assigned},{abbr:"Fru",name:"Fructose",color:42577,type:xt.Assigned},{abbr:"Tag",name:"Tagatose",color:16765952,type:xt.Assigned},{abbr:"Sor",name:"Sorbose",color:16021792,type:xt.Assigned},{abbr:"Psi",name:"Psicose",color:16162465,type:xt.Assigned}],_Pe=function(){for(var e=new Map,t=0,r=Py.length;t<r;++t){var n=Py[t];e.set(n.abbr,n)}return e}(),SPe=[["Glc-family",37052],["Man-family",42577],["Gal-family",16765952],["Gul-family",16021792],["Alt-family",16162465],["All-family",10830745],["Tal-family",9424105],["Ido-family",10582605],["Fuc-family",15539236],["Generic/Unknown/Secondary",15854817]],iK={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},oK={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},CPe={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"],Abe:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"],Bac:["0BC","3BC","0bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"]},sK=function(){for(var e=new Map,t=0,r=Py.length;t<r;++t){var n=Py[t],a=iK[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n);var s=oK[n.abbr];if(s)for(i=0,o=s.length;i<o;++i)e.set(s[i],n)}return aK.forEach(function(u){e.has(u)||e.set(u,TN)}),e}(),xPe=function(){for(var e=new Map,t=0,r=Py.length;t<r;++t){var n=Py[t],a=iK[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n);var s=oK[n.abbr];if(s)for(i=0,o=s.length;i<o;++i)e.set(s[i],n);var u=CPe[n.abbr];if(u)for(i=0,o=u.length;i<o;++i)e.has(u[i])||e.set(u[i],n)}return aK.forEach(function(c){e.has(c)||e.set(c,TN)}),e}(),np=sK;!function(e){e.toArray=function t(p){return nT(p.values())},e.isSuperset=function r(p,h){if(p.size<h.size)return!1;var m=!0;return h.forEach(function(v){m&&!p.has(v)&&(m=!1)}),m},e.add=function n(p){for(var h=[],m=1;m<arguments.length;m++)h[m-1]=arguments[m];for(var v=0;v<h.length;v++)h[v].forEach(function(g){return p.add(g)});return p},e.union=function a(p,h){var m=new Set(p);return h.forEach(function(v){return m.add(v)}),m},e.unionMany=function i(){for(var p=[],h=0;h<arguments.length;h++)p[h]=arguments[h];if(0===p.length)return new Set;for(var m=new Set(p[0]),v=1,g=p.length;v<g;v++)p[v].forEach(function(y){return m.add(y)});return m},e.unionManyArrays=function o(p){if(0===p.length)return new Set;for(var h=new Set(p[0]),m=1;m<p.length;m++)for(var v=0,g=p[m];v<g.length;v++)h.add(g[v]);return h},e.intersection=function s(p,h){var m=new Set;return h.forEach(function(v){p.has(v)&&m.add(v)}),m},e.areIntersecting=function u(p,h){var m;p.size<h.size&&(p=(m=[h,p])[0],h=m[1]);var v=!1;return h.forEach(function(g){!v&&p.has(g)&&(v=!0)}),v},e.intersectionSize=function c(p,h){var m;p.size<h.size&&(p=(m=[h,p])[0],h=m[1]);var v=0;return h.forEach(function(g){p.has(g)&&(v+=1)}),v},e.difference=function l(p,h){var m=new Set(p);return h.forEach(function(v){return m.delete(v)}),m},e.differenceSize=function d(p,h){var m=p.size;return p.forEach(function(v){h.has(v)&&(m-=1)}),m},e.areEqual=function f(p,h){if(p.size!==h.size)return!1;var m=!0;return h.forEach(function(v){m&&!p.has(v)&&(m=!1)}),m}}(fa||(fa={}));var ap,uK=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),cK=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),APe=function(){for(var e=Object.create(null),t=[],r=65;r<=90;r++)t[t.length]=String.fromCharCode(r);for(r=97;r<=122;r++)t[t.length]=String.fromCharCode(r);for(r=48;r<=57;r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var c=0,l=t;c<l.length;c++){var d=l[c];e[i+u+d]=(i+u+d).toUpperCase()}}}return e}();function Ov(e){return APe[e]||e.toUpperCase()}var cn,Gr,lK=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],Ov(e[1])]})),EPe=((ap={})[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},ap[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},ap[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},ap[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},ap[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},ap[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},ap[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},ap),ip=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),lT=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),dK=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),fK=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),IPe=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),PPe=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),MPe=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),pK=new Set(["peptide linking","peptide-like"]),RPe=fa.unionMany(dK,fK,pK),hK=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),mK=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),vK=fa.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),OPe=new Set(["non-polymer","other"]),FPe=new Set(["ion"]),NPe=new Set(["lipid"]),dT=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),DN=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),gK=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),P2=fa.unionMany(DN,gK),kPe=new Set(["NME","ACE","NH2","FOR","FMT"]),M2=new Set(["A","C","T","G","I","U","N"]),R2=new Set(["DA","DC","DT","DG","DI","DU","DN"]),EN=new Set(["APN","CPN","TPN","GPN"]),BPe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),LPe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),fT=fa.unionMany(M2,R2,EN),UPe=function(e){return BPe.has(e.toUpperCase())},VPe=function(e){return LPe.has(e.toUpperCase())},My=fa.unionMany(P2,fT);function Hh(e,t){return t=t.toUpperCase(),EN.has(t)?8:RPe.has(e)?5:mK.has(e)?6:hK.has(e)?7:vK.has(e)?9:dT.has(t)?2:cK.has(t)?3:uK.has(t)?4:OPe.has(e)?np.has(t)?9:P2.has(t)?5:M2.has(t)?6:R2.has(t)?7:1:0}function zPe(e,t){return 5===t?IPe.has(e)?2:PPe.has(e)?3:MPe.has(e)?0:1:6===t?4:7===t?5:8===t?6:0}function yK(e){return e=e.toUpperCase(),P2.has(e)?"peptide linking":M2.has(e)?"rna linking":R2.has(e)?"dna linking":np.has(e)?"saccharide":"other"}function HPe(e){return e=e.toUpperCase(),dT.has(e)?"water":My.has(e)?"polymer":np.has(e)?"branched":"non-polymer"}function jPe(e,t){return e=e.toUpperCase(),fK.has(t)?"polypeptide(L)":dK.has(t)?"polypeptide(D)":mK.has(t)?"polyribonucleotide":hK.has(t)?"polydeoxyribonucleotide":vK.has(t)||np.has(e)?"oligosaccharide":EN.has(e)?"peptide nucleic acid":DN.has(e)?"polypeptide(L)":gK.has(e)?"polypeptide(D)":M2.has(e)?"polyribonucleotide":R2.has(e)?"polydeoxyribonucleotide":FPe.has(t)||cK.has(e)?"ion":NPe.has(t)||uK.has(e)?"lipid":pK.has(t)?"peptide-like":"other"}function pT(e){return Zs(e)||bK(e)}function Zs(e){return 7===e||6===e||8===e}function bK(e){return 5===e}!function(e){e.is=rs.has,e.create=rs.create,e.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}}(cn||(cn={})),function(e){function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.is=rs.has,e.create=function t(s){return rs.create(s)},e.isCovalent=function r(s){return 0!=(1&s)},e.isAll=function n(s){return s===Math.pow(2,6)-1},e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32},e.isName=function a(s){return s in e.Names},e.fromName=i,e.fromNames=function o(s){for(var u=0,c=0,l=s.length;c<l;++c)u|=i(s[c]);return u}}(Gr||(Gr={}));var IN={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]},qPe=S.add,WPe=S.squaredDistance,YPe=S.distance,Fv=function(){function e(){this.count=0,this.center=S(),this.radiusSq=0}return e.prototype.reset=function(){S.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){qPe(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){0!==this.count&&S.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=WPe(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=YPe(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=De()),S.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();!function(e){var t=new e,r=S(),n=S();e.fromArrays=function a(s,u){var c=s.x,l=s.y,d=s.z;t.reset();for(var f=c.length,p=0;p<f;p++)S.set(r,c[p],l[p],d[p]),t.includeStep(r);for(t.finishedIncludeStep(),p=0;p<f;p++)S.set(r,c[p],l[p],d[p]),t.radiusStep(r);return S.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u},e.fromProvider=function i(s,u,c){t.reset();for(var l=0;l<s;l++)u(l,r),t.includeStep(r);for(t.finishedIncludeStep(),l=0;l<s;l++)u(l,r),t.radiusStep(r);return S.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c},e.fromPairProvider=function o(s,u,c){t.reset();for(var l=0;l<s;l++)u(l,r,n),t.includeStep(r),t.includeStep(n);for(t.finishedIncludeStep(),l=0;l<s;l++)u(l,r,n),t.radiusStep(r),t.radiusStep(n);return S.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}}(Fv||(Fv={}));var Nv=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(c){var l=s.unitA,d=s.unitB,f=e.getEdgeKey(u,l,c.indexB,d);a.set(f,n.length);var p=e.getVertexKey(u,l),h=i.get(p);void 0===h?i.set(p,[n.length]):h.push(n.length),n.push(R(R({},c),{indexA:u,unitA:l,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):_K},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return void 0!==o?o:-1},e.prototype.hasEdge=function(t,r,n,a){return-1!==this.getEdgeIndex(t,r,n,a)},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return-1!==i?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();!function(e){var t=function(){function o(s,u,c,l,d){this.unitA=s,this.unitB=u,this.edgeCount=c,this.connectedIndices=l,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):_K},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}e.UnitPairEdges=t,e.getEdgeKey=function r(o,s,u,c){return"".concat(o,"|").concat(s,"|").concat(u,"|").concat(c)},e.getVertexKey=function n(o,s){return"".concat(o,"|").concat(s)};var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=On.create(),this.linkedB=On.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){0!==this.linkCount&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,c){a(this.mapAB,s,{indexB:u,props:c}),a(this.mapBA,u,{indexB:s,props:c}),On.add(this.linkedA,s,s),On.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i}(Nv||(Nv={}));var PN,_K=[];!function(e){e.Empty=Cu.create([],[],[],0,{flags:[],order:[],key:[]})}(PN||(PN={}));var O2=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t.prototype.getBondFromLocation=function(r){return Oe.isAtomic(r.aUnit)&&Oe.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return Oe.isAtomic(r.aUnit)&&Oe.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(Nv);!function(e){var t=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return qt(n,r),n}(Nv.UnitPairEdges);e.UnitPairBonds=t}(O2||(O2={}));var SK={forceCompute:!1,noCompute:!1,maxRadius:4},MN={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},KPe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},ZPe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},CK=2.001,F2=function(){for(var t=new Set,r=0,n=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"];r<n.length;r++)t.add(MN[n[r]]);return t}();function Ud(e){var t=MN[e];return void 0===t?-1:t}function jh(e){if(e<0)return CK;var t=KPe[e];return void 0===t?CK:t}function hT(e,t,r,n){var a=function $Pe(e,t){if(e<0||t<0)return-1;var r=ZPe[function QPe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}(e,t)];return void 0===r?-1:r}(e,t);return a>0?a:t<0?r:(r+n)/1.95}var JPe=MN.H;function op(e){return e===JPe}var eMe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function tMe(e,t,r){var n;return t=(n=t<r?[t,r]:[r,t])[0],r=n[1],P2.has(e)&&"C"===t&&"O"===r||fT.has(e)&&"OP1"===t&&"P"===r?2:eMe.get("".concat(e,"|").concat(t,"|").concat(r))||1}var rMe=new Map([["LYS|NZ|RET|C15",2]]);function xK(e,t,r,n){var a,i;return e>r&&(e=(a=[r,e])[0],r=a[1],t=(i=[n,t])[0],n=i[1]),rMe.get("".concat(e,"|").concat(t,"|").concat(r,"|").concat(n))||1}var Jr,sp=ie.Schema,se=sp.str,Ie=sp.int,vr=sp.float,RN=sp.coord,It=sp.Aliased,qh=sp.Matrix,mT=sp.Vector,bn=sp.lstr,kv=sp.List,kr={atom_site:{auth_asym_id:se,auth_atom_id:se,auth_comp_id:se,auth_seq_id:Ie,B_iso_or_equiv:vr,Cartn_x:RN,Cartn_y:RN,Cartn_z:RN,group_PDB:It(se),id:Ie,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_entity_id:se,label_seq_id:Ie,occupancy:vr,type_symbol:se,pdbx_PDB_ins_code:se,pdbx_PDB_model_num:Ie,pdbx_formal_charge:Ie,pdbx_label_index:Ie,pdbx_sifts_xref_db_name:se,pdbx_sifts_xref_db_acc:se,pdbx_sifts_xref_db_num:se,pdbx_sifts_xref_db_res:se,ihm_model_id:Ie},atom_site_anisotrop:{id:Ie,type_symbol:se,U:qh(3,3),U_esd:qh(3,3),pdbx_auth_seq_id:se,pdbx_auth_asym_id:se,pdbx_auth_atom_id:se,pdbx_auth_comp_id:se,pdbx_label_seq_id:Ie,pdbx_label_alt_id:se,pdbx_label_asym_id:se,pdbx_label_atom_id:se,pdbx_label_comp_id:se,pdbx_PDB_ins_code:se},atom_sites:{entry_id:se,fract_transf_matrix:qh(3,3),fract_transf_vector:mT(3)},audit_author:{name:se,pdbx_ordinal:Ie,identifier_ORCID:se},audit_conform:{dict_location:se,dict_name:se,dict_version:se},cell:{angle_alpha:vr,angle_beta:vr,angle_gamma:vr,entry_id:se,length_a:vr,length_b:vr,length_c:vr,Z_PDB:Ie,pdbx_unique_axis:se},chem_comp:{formula:se,formula_weight:vr,id:se,mon_nstd_flag:It(bn),name:se,type:It(bn),pdbx_synonyms:kv(";",function(e){return e})},chem_comp_bond:{atom_id_1:se,atom_id_2:se,comp_id:se,value_order:It(bn),pdbx_ordinal:Ie,pdbx_stereo_config:It(bn),pdbx_aromatic_flag:It(bn)},citation:{book_publisher:se,country:se,id:se,journal_abbrev:se,journal_id_ASTM:se,journal_id_CSD:se,journal_id_ISSN:se,journal_volume:se,page_first:se,page_last:se,title:se,year:Ie,pdbx_database_id_DOI:se,pdbx_database_id_PubMed:Ie},citation_author:{citation_id:se,name:se,ordinal:Ie},database_2:{database_id:It(bn),database_code:se},entity:{details:se,formula_weight:vr,id:se,src_method:It(bn),type:It(bn),pdbx_description:kv(",",function(e){return e}),pdbx_number_of_molecules:Ie,pdbx_mutation:se,pdbx_fragment:se,pdbx_ec:kv(",",function(e){return e})},entity_poly:{entity_id:se,nstd_linkage:It(bn),nstd_monomer:It(bn),type:It(se),pdbx_strand_id:kv(",",function(e){return e}),pdbx_seq_one_letter_code:se,pdbx_seq_one_letter_code_can:se,pdbx_target_identifier:se},entity_poly_seq:{entity_id:se,hetero:It(bn),mon_id:se,num:Ie},entry:{id:se},exptl:{entry_id:se,method:It(se)},software:{classification:se,date:se,description:se,name:se,type:It(bn),version:se,pdbx_ordinal:Ie},struct:{entry_id:se,title:se,pdbx_descriptor:se},struct_asym:{details:se,entity_id:se,id:se,pdbx_modified:se,pdbx_blank_PDB_chainid_flag:It(se)},struct_conf:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:Ie,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:Ie,conf_type_id:It(bn),details:se,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:Ie,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:Ie,id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se,pdbx_PDB_helix_class:se,pdbx_PDB_helix_length:Ie,pdbx_PDB_helix_id:se},struct_conn:{conn_type_id:It(bn),details:se,id:se,ptnr1_label_asym_id:se,ptnr1_label_atom_id:se,ptnr1_label_comp_id:se,ptnr1_label_seq_id:Ie,ptnr1_auth_asym_id:se,ptnr1_auth_comp_id:se,ptnr1_auth_seq_id:Ie,ptnr1_symmetry:se,ptnr2_label_asym_id:se,ptnr2_label_atom_id:se,ptnr2_label_comp_id:se,ptnr2_label_seq_id:Ie,ptnr2_auth_asym_id:se,ptnr2_auth_comp_id:se,ptnr2_auth_seq_id:Ie,ptnr2_symmetry:se,pdbx_ptnr1_PDB_ins_code:se,pdbx_ptnr1_label_alt_id:se,pdbx_ptnr1_standard_comp_id:se,pdbx_ptnr2_PDB_ins_code:se,pdbx_ptnr2_label_alt_id:se,pdbx_ptnr3_PDB_ins_code:se,pdbx_ptnr3_label_alt_id:se,pdbx_ptnr3_label_asym_id:se,pdbx_ptnr3_label_atom_id:se,pdbx_ptnr3_label_comp_id:se,pdbx_ptnr3_label_seq_id:Ie,pdbx_PDB_id:se,pdbx_dist_value:vr,pdbx_value_order:It(bn)},struct_conn_type:{criteria:se,id:It(bn),reference:se},struct_keywords:{entry_id:se,text:kv(",",function(e){return e}),pdbx_keywords:se},struct_ncs_oper:{code:It(se),details:se,id:Ie,matrix:qh(3,3),vector:mT(3)},struct_sheet_range:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:Ie,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:Ie,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:Ie,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:Ie,id:se,sheet_id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se},struct_site:{details:se,id:se,pdbx_num_residues:Ie,pdbx_evidence_code:se,pdbx_auth_asym_id:se,pdbx_auth_comp_id:se,pdbx_auth_seq_id:se,pdbx_auth_ins_code:se},struct_site_gen:{details:se,id:se,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_seq_id:Ie,auth_asym_id:se,auth_comp_id:se,auth_seq_id:se,site_id:se,symmetry:se,pdbx_auth_ins_code:se,pdbx_num_res:Ie},symmetry:{entry_id:se,cell_setting:It(bn),Int_Tables_number:Ie,space_group_name_Hall:se,"space_group_name_H-M":se},pdbx_database_status:{status_code:It(se),status_code_sf:It(se),status_code_mr:It(se),entry_id:se,recvd_initial_deposition_date:se,SG_entry:It(bn),deposit_site:It(se),process_site:It(se),status_code_cs:It(se),methods_development_category:It(se),pdb_format_compatible:It(bn)},pdbx_nonpoly_scheme:{asym_id:se,entity_id:se,mon_id:se,pdb_strand_id:se,ndb_seq_num:se,pdb_seq_num:se,auth_seq_num:se,pdb_mon_id:se,auth_mon_id:se,pdb_ins_code:se},pdbx_database_related:{db_name:se,details:se,db_id:se,content_type:It(se)},pdbx_entity_nonpoly:{entity_id:se,comp_id:se,name:se},pdbx_chem_comp_synonyms:{name:se,comp_id:se,provenance:It(se)},pdbx_chem_comp_identifier:{comp_id:se,identifier:se,type:It(se),program:se,program_version:se},pdbx_unobs_or_zero_occ_residues:{id:Ie,polymer_flag:It(bn),occupancy_flag:It(Ie),PDB_model_num:Ie,auth_asym_id:se,auth_comp_id:se,auth_seq_id:se,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ie},pdbx_struct_mod_residue:{id:Ie,auth_asym_id:se,auth_comp_id:se,auth_seq_id:Ie,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ie,parent_comp_id:se,details:se},pdbx_struct_oper_list:{id:se,type:It(se),name:se,symmetry_operation:se,matrix:qh(3,3),vector:mT(3)},pdbx_struct_assembly:{method_details:se,oligomeric_details:se,oligomeric_count:Ie,details:se,id:se},pdbx_struct_assembly_gen:{asym_id_list:kv(",",function(e){return e}),assembly_id:se,oper_expression:se},pdbx_reference_entity_list:{prd_id:se,ref_entity_id:se,type:It(bn),details:se,component_id:Ie},pdbx_reference_entity_link:{link_id:Ie,prd_id:se,details:se,ref_entity_id_1:se,ref_entity_id_2:se,entity_seq_num_1:Ie,entity_seq_num_2:Ie,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:It(bn),component_1:Ie,component_2:Ie,link_class:It(se)},pdbx_reference_entity_poly_link:{link_id:Ie,prd_id:se,ref_entity_id:se,component_id:Ie,entity_seq_num_1:Ie,entity_seq_num_2:Ie,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:It(bn)},pdbx_molecule:{prd_id:se,instance_id:Ie,asym_id:se},pdbx_molecule_features:{prd_id:se,class:It(bn),type:It(bn),name:se,details:se},entity_src_nat:{entity_id:se,pdbx_organism_scientific:se,pdbx_plasmid_name:se,pdbx_src_id:Ie,pdbx_beg_seq_num:Ie,pdbx_end_seq_num:Ie},entity_src_gen:{entity_id:se,pdbx_gene_src_gene:kv(",",function(e){return e}),pdbx_gene_src_scientific_name:se,plasmid_name:se,pdbx_src_id:Ie,pdbx_beg_seq_num:Ie,pdbx_end_seq_num:Ie},pdbx_entity_src_syn:{organism_scientific:se,entity_id:se,pdbx_src_id:Ie,pdbx_beg_seq_num:Ie,pdbx_end_seq_num:Ie},pdbx_entity_branch_descriptor:{entity_id:se,descriptor:se,type:It(bn),program:se,program_version:se,ordinal:Ie},pdbx_entity_instance_feature:{details:se,feature_type:It(se),auth_asym_id:se,asym_id:se,auth_seq_num:se,seq_num:Ie,comp_id:se,auth_comp_id:se,ordinal:Ie},pdbx_entity_branch_list:{entity_id:se,hetero:It(bn),comp_id:se,num:Ie},pdbx_entity_branch_link:{link_id:Ie,details:se,entity_id:se,entity_branch_list_num_1:Ie,entity_branch_list_num_2:Ie,comp_id_1:se,comp_id_2:se,atom_id_1:se,leaving_atom_id_1:se,atom_stereo_config_1:It(bn),atom_id_2:se,leaving_atom_id_2:se,atom_stereo_config_2:It(bn),value_order:It(bn)},pdbx_entity_branch:{entity_id:se,type:It(se)},pdbx_branch_scheme:{entity_id:se,hetero:It(bn),asym_id:se,mon_id:se,num:Ie,pdb_asym_id:se,pdb_seq_num:se,pdb_mon_id:se,auth_asym_id:se,auth_seq_num:se,auth_mon_id:se},pdbx_chem_comp_related:{comp_id:se,related_comp_id:se,relationship_type:It(se),details:se},ihm_starting_model_details:{starting_model_id:se,entity_id:se,entity_description:se,asym_id:se,entity_poly_segment_id:Ie,starting_model_source:It(se),starting_model_auth_asym_id:se,starting_model_sequence_offset:Ie,dataset_list_id:Ie},ihm_starting_comparative_models:{id:Ie,starting_model_id:se,starting_model_auth_asym_id:se,starting_model_seq_id_begin:Ie,starting_model_seq_id_end:Ie,template_auth_asym_id:se,template_seq_id_begin:Ie,template_seq_id_end:Ie,template_sequence_identity:vr,template_sequence_identity_denominator:It(Ie),template_dataset_list_id:Ie,alignment_file_id:Ie},ihm_starting_model_seq_dif:{id:Ie,entity_id:se,asym_id:se,seq_id:Ie,comp_id:se,starting_model_id:se,db_asym_id:se,db_seq_id:Ie,db_comp_id:se,details:se},ihm_model_representation:{id:Ie,name:se,details:se},ihm_model_representation_details:{id:Ie,representation_id:Ie,entity_poly_segment_id:Ie,entity_id:se,entity_description:se,entity_asym_id:se,model_object_primitive:It(se),starting_model_id:se,model_mode:It(se),model_granularity:It(se),model_object_count:Ie},ihm_struct_assembly_details:{id:Ie,assembly_id:Ie,parent_assembly_id:Ie,entity_description:se,entity_id:se,asym_id:se,entity_poly_segment_id:Ie},ihm_struct_assembly:{id:Ie,name:se,description:se},ihm_modeling_protocol:{id:Ie,num_steps:Ie,protocol_name:se},ihm_modeling_protocol_details:{id:Ie,protocol_id:Ie,step_id:Ie,struct_assembly_id:Ie,dataset_group_id:Ie,struct_assembly_description:se,step_name:se,step_method:se,num_models_begin:Ie,num_models_end:Ie,multi_scale_flag:It(bn),multi_state_flag:It(bn),ordered_flag:It(bn),script_file_id:Ie,software_id:Ie},ihm_multi_state_modeling:{state_id:Ie,state_group_id:Ie,population_fraction:vr,population_fraction_sd:vr,state_type:se,state_name:se,experiment_type:It(se),details:se},ihm_modeling_post_process:{id:Ie,protocol_id:Ie,analysis_id:Ie,step_id:Ie,type:It(se),feature:It(se),num_models_begin:Ie,num_models_end:Ie},ihm_ensemble_info:{ensemble_id:Ie,ensemble_name:se,post_process_id:Ie,model_group_id:Ie,ensemble_clustering_method:It(se),ensemble_clustering_feature:It(se),num_ensemble_models:Ie,num_ensemble_models_deposited:Ie,ensemble_precision_value:vr,ensemble_file_id:Ie},ihm_model_list:{model_id:Ie,model_name:se,assembly_id:Ie,protocol_id:Ie,representation_id:Ie},ihm_model_group:{id:Ie,name:se,details:se},ihm_model_group_link:{model_id:Ie,group_id:Ie},ihm_model_representative:{id:Ie,model_group_id:Ie,model_id:Ie,selection_criteria:It(se)},ihm_dataset_list:{id:Ie,data_type:It(se),database_hosted:It(bn)},ihm_dataset_group:{id:Ie,name:se,application:It(se),details:se},ihm_dataset_group_link:{dataset_list_id:Ie,group_id:Ie},ihm_related_datasets:{dataset_list_id_derived:Ie,dataset_list_id_primary:Ie},ihm_dataset_related_db_reference:{id:Ie,dataset_list_id:Ie,db_name:It(se),accession_code:se,version:se,details:se},ihm_external_reference_info:{reference_id:Ie,reference_provider:se,reference_type:It(se),reference:se,refers_to:It(se),associated_url:se},ihm_external_files:{id:Ie,reference_id:Ie,file_path:se,content_type:It(se),file_size_bytes:vr,details:se},ihm_dataset_external_reference:{id:Ie,dataset_list_id:Ie,file_id:Ie},ihm_localization_density_files:{id:Ie,file_id:Ie,ensemble_id:Ie,entity_id:se,entity_poly_segment_id:Ie,asym_id:se},ihm_predicted_contact_restraint:{id:Ie,group_id:Ie,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ie,seq_id_2:Ie,rep_atom_1:It(se),rep_atom_2:It(se),distance_lower_limit:vr,distance_upper_limit:vr,probability:vr,restraint_type:It(se),model_granularity:It(se),dataset_list_id:Ie,software_id:Ie},ihm_cross_link_list:{id:Ie,group_id:Ie,entity_description_1:se,entity_description_2:se,entity_id_1:se,entity_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ie,seq_id_2:Ie,linker_type:It(se),dataset_list_id:Ie},ihm_cross_link_restraint:{id:Ie,group_id:Ie,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ie,seq_id_2:Ie,atom_id_1:se,atom_id_2:se,restraint_type:It(se),conditional_crosslink_flag:It(se),model_granularity:It(se),distance_threshold:vr,psi:vr,sigma_1:vr,sigma_2:vr},ihm_cross_link_result_parameters:{id:Ie,restraint_id:Ie,model_id:Ie,psi:vr,sigma_1:vr,sigma_2:vr},ihm_2dem_class_average_restraint:{id:Ie,dataset_list_id:Ie,number_raw_micrographs:Ie,pixel_size_width:vr,pixel_size_height:vr,image_resolution:vr,image_segment_flag:It(bn),number_of_projections:Ie,struct_assembly_id:Ie,details:se},ihm_2dem_class_average_fitting:{id:Ie,restraint_id:Ie,model_id:Ie,cross_correlation_coefficient:vr,rot_matrix:qh(3,3),tr_vector:mT(3)},ihm_3dem_restraint:{id:Ie,dataset_list_id:Ie,model_id:Ie,struct_assembly_id:Ie,fitting_method:se,number_of_gaussians:Ie,cross_correlation_coefficient:vr},ihm_sas_restraint:{id:Ie,dataset_list_id:Ie,model_id:Ie,struct_assembly_id:Ie,profile_segment_flag:It(bn),fitting_atom_type:se,fitting_method:se,fitting_state:It(se),radius_of_gyration:vr,chi_value:vr,details:se},ihm_starting_model_coord:{ordinal_id:Ie,starting_model_id:se,group_PDB:It(se),id:Ie,type_symbol:se,entity_id:se,atom_id:se,comp_id:se,seq_id:Ie,asym_id:se,Cartn_x:vr,Cartn_y:vr,Cartn_z:vr,B_iso_or_equiv:vr},ihm_sphere_obj_site:{id:Ie,entity_id:se,seq_id_begin:Ie,seq_id_end:Ie,asym_id:se,Cartn_x:vr,Cartn_y:vr,Cartn_z:vr,object_radius:vr,rmsf:vr,model_id:Ie},ihm_gaussian_obj_site:{id:Ie,entity_id:se,seq_id_begin:Ie,seq_id_end:Ie,asym_id:se,mean_Cartn_x:vr,mean_Cartn_y:vr,mean_Cartn_z:vr,weight:vr,covariance_matrix:qh(3,3),model_id:Ie},ihm_gaussian_obj_ensemble:{id:Ie,entity_id:se,seq_id_begin:Ie,seq_id_end:Ie,asym_id:se,mean_Cartn_x:vr,mean_Cartn_y:vr,mean_Cartn_z:vr,weight:vr,covariance_matrix:qh(3,3),ensemble_id:Ie},ihm_feature_list:{feature_id:Ie,feature_type:It(se),entity_type:It(se)},ihm_poly_residue_feature:{ordinal_id:Ie,feature_id:Ie,entity_id:se,asym_id:se,comp_id_begin:se,comp_id_end:se,seq_id_begin:Ie,seq_id_end:Ie},ihm_derived_distance_restraint:{id:Ie,group_id:Ie,feature_id_1:Ie,feature_id_2:Ie,group_conditionality:It(se),random_exclusion_fraction:vr,distance_upper_limit:vr,restraint_type:It(se),dataset_list_id:Ie},ma_model_list:{ordinal_id:Ie,model_id:Ie,model_group_id:Ie,model_name:se,model_group_name:se,model_type:It(se),data_id:Ie},ma_target_entity:{entity_id:se,data_id:Ie,origin:It(se)},ma_target_entity_instance:{asym_id:se,entity_id:se,details:se},ma_target_ref_db_details:{target_entity_id:se,db_name:It(se),db_code:se,db_accession:se,seq_db_isoform:se,seq_db_align_begin:se,seq_db_align_end:se,ncbi_taxonomy_id:se,organism_scientific:se},ma_data:{id:Ie,content_type:It(se),content_type_other_details:se,name:se},ma_software_group:{ordinal_id:Ie,group_id:Ie,software_id:Ie},ma_qa_metric:{id:Ie,name:se,type:It(se),mode:It(se),software_group_id:Ie},ma_qa_metric_global:{ordinal_id:Ie,model_id:Ie,metric_id:Ie,metric_value:vr},ma_qa_metric_local:{ordinal_id:Ie,model_id:Ie,label_asym_id:se,label_seq_id:Ie,label_comp_id:se,metric_id:Ie,metric_value:vr}};!function(e){var i;(i=e.IntDataType||(e.IntDataType={}))[i.Int8=1]="Int8",i[i.Int16=2]="Int16",i[i.Int32=3]="Int32",i[i.Uint8=4]="Uint8",i[i.Uint16=5]="Uint16",i[i.Uint32=6]="Uint32",function(i){i[i.Float32=32]="Float32",i[i.Float64=33]="Float64"}(e.FloatDataType||(e.FloatDataType={})),e.getDataType=function n(i){return i instanceof Int8Array?e.IntDataType.Int8:i instanceof Int16Array?e.IntDataType.Int16:i instanceof Int32Array?e.IntDataType.Int32:i instanceof Uint8Array?e.IntDataType.Uint8:i instanceof Uint16Array?e.IntDataType.Uint16:i instanceof Uint32Array?e.IntDataType.Uint32:i instanceof Float32Array?e.FloatDataType.Float32:i instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32},e.isSignedIntegerDataType=function a(i){if(i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array)return!0;for(var o=0,s=i.length;o<s;o++)if(o<0)return!1;return!0}}(Jr||(Jr={}));var N2,NN,aMe=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],ON=28672;function vT(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=sMe(t,e.encoding[r]);return t}function sMe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case Jr.IntDataType.Uint8:return e;case Jr.IntDataType.Int8:return function uMe(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case Jr.IntDataType.Int16:return function cMe(e){return Ry(e,2,Int16Array)}(e);case Jr.IntDataType.Uint16:return function lMe(e){return Ry(e,2,Uint16Array)}(e);case Jr.IntDataType.Int32:return function dMe(e){return Ry(e,4,Int32Array)}(e);case Jr.IntDataType.Uint32:return function fMe(e){return Ry(e,4,Uint32Array)}(e);case Jr.FloatDataType.Float32:return function pMe(e){return Ry(e,4,Float32Array)}(e);case Jr.FloatDataType.Float64:return function hMe(e){return Ry(e,8,Float64Array)}(e);default:xn()}case"FixedPoint":return function mMe(e,t){for(var r=e.length,n=AK(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}(e,t);case"IntervalQuantization":return function vMe(e,t){for(var r=e.length,n=AK(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}(e,t);case"RunLength":return function gMe(e,t){for(var r=wK(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}(e,t);case"Delta":return function yMe(e,t){var r=e.length,n=wK(t.srcType,r);if(!r)return e;n[0]=e[0]+(0|t.origin);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}(e,t);case"IntegerPacking":return function SMe(e,t){return e.length===t.srcSize?e:t.isUnsigned?function _Me(e,t){for(var r=1===t.byteCount?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,u=e[++i];a[o]=s+=u,i++,o++}return a}(e,t):function bMe(e,t){for(var r=1===t.byteCount?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,c=e[o];c===r||c===n;)u+=c,c=e[++o];i[s]=u+=c,o++,s++}return i}(e,t)}(e,t);case"StringArray":return function CMe(e,t){var r=vT({encoding:t.offsetEncoding,data:t.offsets}),n=vT({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);var u=0,c=new Array(n.length);for(o=0,s=n.length;o<s;o++)c[u++]=i[n[o]+1];return c}(e,t)}}function wK(e,t){switch(e){case Jr.IntDataType.Int8:return new Int8Array(t);case Jr.IntDataType.Int16:return new Int16Array(t);case Jr.IntDataType.Int32:return new Int32Array(t);case Jr.IntDataType.Uint8:return new Uint8Array(t);case Jr.IntDataType.Uint16:return new Uint16Array(t);case Jr.IntDataType.Uint32:return new Uint32Array(t);default:xn()}}function AK(e,t){switch(e){case Jr.FloatDataType.Float32:return new Float32Array(t);case Jr.FloatDataType.Float64:return new Float64Array(t);default:xn()}}function Ry(e,t,r){return new r(aMe?e.buffer:function iMe(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}(e,t))}function xMe(e,t,r){var a,n=1;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function TK(e,t){return parseFloat(e.toPrecision(t))}function FN(e){return N2.classify(e)}!function(e){function t(p,h){return p>=0?Math.ceil((p+1)/h):Math.ceil((p+1)/(-h-1))}function a(p,h,m){var g=p.limit16;h.pack8+=t(m,p.limit8),h.pack16+=t(m,g),h.count+=1}function i(p,h){p.pack8+=t(h,127),p.pack16+=t(h,32767),p.count+=1}function o(p){return 4*p.count<2*p.pack16?{length:4*p.count,elem:4}:2*p.pack16<p.pack8?{length:2*p.pack16,elem:2}:{length:p.pack8,elem:1}}function s(p,h){for(var m={pack8:0,pack16:0,count:0},v=0,g=p.length;v<g;v++)a(h,m,p[v]);return R(R({},o(m)),{kind:"pack"})}function u(p,h){for(var m={pack8:0,pack16:0,count:0},v=p[0],g=1,y=p.length;g<y;g++)i(m,p[g]-v),v=p[g];return R(R({},o(m)),{kind:"delta"})}function c(p,h){for(var m={pack8:0,pack16:0,count:0},v=1,g=1,y=p.length;g<y;g++)p[g-1]!==p[g]?(a(h,m,p[g-1]),a(h,m,v),v=1):v++;return a(h,m,p[p.length-1]),a(h,m,v),R(R({},o(m)),{kind:"rle"})}function l(p,h){for(var m={pack8:0,pack16:0,count:0},v=1,g=0,y=0,b=1,_=p.length;b<_;b++){var C=p[b]-g;y!==C?(i(m,y),i(m,v),v=1):v++,y=C,g=p[b]}return i(m,y),i(m,v),R(R({},o(m)),{kind:"delta-rle"})}function d(p){var h=function r(p){for(var h=!1,m=0,v=p.length;m<v;m++)if(p[m]<0){h=!0;break}return h?{signed:h,limit8:127,limit16:32767}:{signed:h,limit8:255,limit16:65535}}(p),m=[s(p,h),c(p,h),u(p),l(p)];return m.sort(function(v,g){return v.length-g.length}),m}e.getSize=d,e.classify=function f(p){if(p.length<2)return Br.by(Br.byteArray);switch(d(p)[0].kind){case"pack":return Br.by(Br.integerPacking);case"rle":return Br.by(Br.runLength).and(Br.integerPacking);case"delta":return Br.by(Br.delta).and(Br.integerPacking);case"delta-rle":return Br.by(Br.delta).and(Br.runLength).and(Br.integerPacking);default:xn()}}}(N2||(N2={})),function(e){e.classify=function r(a){var o=function AMe(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=xMe(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var c=Math.floor(Math.log10(Math.abs(u)))+1;c>a&&(a=c)}}return{mantissaDigits:n,integerDigits:a}}(a,4,1e-6),s=o.mantissaDigits;if(s<0||s+o.integerDigits>10)return Br.by(Br.byteArray);if(0===s)return N2.classify(a);for(var c=function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}(s),l=new Int32Array(a.length),d=0,f=a.length;d<f;d++)l[d]=Math.round(c*a[d]);var h=N2.getSize(l)[0],m=Br.by(Br.fixedPoint(c));switch(h.kind){case"pack":return m.and(Br.integerPacking);case"rle":return m.and(Br.runLength).and(Br.integerPacking);case"delta":return m.and(Br.delta).and(Br.integerPacking);case"delta-rle":return m.and(Br.delta).and(Br.runLength).and(Br.integerPacking);default:xn()}}}(NN||(NN={}));var Wh,Br,kN,ac,BN,DK=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var o=(0,a[n])(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++)r.push(u[s])}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}();function LN(e){return function(t,r){return r[e].value(t)}}function EMe(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function UN(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,sr([a[e].value(n)],t,!1))}}function k2(e){return function(t,r){return r[e].valueKind(t)}}function IMe(e,t){var r=[],a=k2(e);if(1===t.rank)for(var i=t.dimensions[0],o=0;o<i;o++){var s="".concat(e,"[").concat(o+1,"]");r.push({name:s,type:2,value:UN(e,o),valueKind:a})}else if(2===t.rank){i=t.dimensions[0];var u=t.dimensions[1];for(o=0;o<i;o++)for(var c=0;c<u;c++){var l="".concat(e,"[").concat(o+1,"][").concat(c+1,"]");r.push({name:l,type:2,value:UN(e,o,c),valueKind:a})}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");var d=t.dimensions[0],f=t.dimensions[1],p=t.dimensions[2];for(o=0;o<d;o++)for(c=0;c<f;c++)for(var h=0;h<p;h++){var m="".concat(e,"[").concat(o+1,"][").concat(c+1,"][").concat(h+1,"]");r.push({name:m,type:2,value:UN(e,o,c,h),valueKind:a})}}return r}function EK(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];"int"===i.valueType?t.push({name:a,type:1,value:LN(a),valueKind:k2(a)}):"float"===i.valueType?t.push({name:a,type:2,value:LN(a),valueKind:k2(a)}):"str"===i.valueType?t.push({name:a,type:0,value:LN(a),valueKind:k2(a)}):"list"===i.valueType?t.push({name:a,type:0,value:EMe(a),valueKind:k2(a)}):"tensor"===i.valueType?t.push.apply(t,IMe(a,i.space)):xn()}return t}function PMe(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function VN(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function IK(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});return n.length?{instance:r,rowCount:n.reduce(function(o,s){return o+s.rowCount},0),source:n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():oT.Range(0,o.rowCount-1)},rowCount:o.rowCount}})}:{instance:r,rowCount:0,source:[]}}!function(e){function t(a){return new DK([a])}function n(a){switch(a.kind){case"ByteArray":return Br.byteArray;case"FixedPoint":return Br.fixedPoint(a.factor);case"IntervalQuantization":return Br.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return Br.runLength;case"Delta":return Br.delta;case"IntegerPacking":return Br.integerPacking;case"StringArray":return Br.stringArray}}e.by=t,e.fromEncoding=function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}}(Wh||(Wh={})),function(e){var t,r;e.by=function n(x){return new DK([x])};var o=((t={})[Jr.IntDataType.Int16]=function(x,A,T){x.setInt16(2*A,T,!0)},t[Jr.IntDataType.Uint16]=function(x,A,T){x.setUint16(2*A,T,!0)},t[Jr.IntDataType.Int32]=function(x,A,T){x.setInt32(4*A,T,!0)},t[Jr.IntDataType.Uint32]=function(x,A,T){x.setUint32(4*A,T,!0)},t[Jr.FloatDataType.Float32]=function(x,A,T){x.setFloat32(4*A,T,!0)},t[Jr.FloatDataType.Float64]=function(x,A,T){x.setFloat64(8*A,T,!0)},t),s=((r={})[Jr.IntDataType.Int16]=2,r[Jr.IntDataType.Uint16]=2,r[Jr.IntDataType.Int32]=4,r[Jr.IntDataType.Uint32]=4,r[Jr.FloatDataType.Float32]=4,r[Jr.FloatDataType.Float64]=8,r);function u(x){var A=Jr.getDataType(x);if(A===Jr.IntDataType.Int8)return function i(x){return{encodings:[{kind:"ByteArray",type:Jr.IntDataType.Int8}],data:new Uint8Array(x.buffer,x.byteOffset)}}(x);if(A===Jr.IntDataType.Uint8)return function a(x){return{encodings:[{kind:"ByteArray",type:Jr.IntDataType.Uint8}],data:x}}(x);for(var T=new Uint8Array(x.length*s[A]),w=o[A],E=new DataView(T.buffer),I=0,M=x.length;I<M;I++)w(E,I,x[I]);return{encodings:[{kind:"ByteArray",type:A}],data:T}}function v(x,A){for(var T=0,w=0,E=x.length;w<E;w++)T+=x[w]/A|0;return T+x.length}function g(x,A){for(var T=-A-1,w=0,E=0,I=x.length;E<I;E++){var M=x[E];w+=M>=0?M/A|0:M/T|0}return w+x.length}e.byteArray=u,e.fixedPoint=function l(x){return function(A){return function c(x,A){for(var T=Jr.getDataType(x),w=new Int32Array(x.length),E=0,I=x.length;E<I;E++)w[E]=Math.round(x[E]*A);return{encodings:[{kind:"FixedPoint",factor:A,srcType:T}],data:w}}(A,x)}},e.intervalQuantizaiton=function f(x,A,T,w){return void 0===w&&(w=Int32Array),function(E){return function d(x,A,T,w,E){var I=Jr.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:A,max:T,numSteps:w,srcType:I}],data:new Int32Array(0)};if(T<A){var M=A;A=T,T=M}for(var F=(T-A)/(w-1),N=new E(x.length),j=0,k=x.length;j<k;j++){var H=x[j];N[j]=H<=A?0:H>=T?w-1:0|Math.round((H-A)/F)}return{encodings:[{kind:"IntervalQuantization",min:A,max:T,numSteps:w,srcType:I}],data:N}}(E,x,A,T,w)}},e.runLength=function p(x){var A=Jr.getDataType(x);if(void 0===A&&(x=new Int32Array(x),A=Jr.IntDataType.Int32),!x.length)return{encodings:[{kind:"RunLength",srcType:A,srcSize:0}],data:new Int32Array(0)};for(var T=2,w=1,E=x.length;w<E;w++)x[w-1]!==x[w]&&(T+=2);var I=new Int32Array(T),M=0,F=1;for(w=1,E=x.length;w<E;w++)x[w-1]!==x[w]?(I[M]=x[w-1],I[M+1]=F,F=1,M+=2):++F;return I[M]=x[x.length-1],I[M+1]=F,{encodings:[{kind:"RunLength",srcType:A,srcSize:x.length}],data:I}},e.delta=function h(x){if(!Jr.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var A=Jr.getDataType(x);if(void 0===A&&(x=new Int32Array(x),A=Jr.IntDataType.Int32),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:A}],data:new x.constructor(0)};var T=new x.constructor(x.length),w=x[0];T[0]=x[0];for(var E=1,I=x.length;E<I;E++)T[E]=x[E]-x[E-1];return T[0]=0,{encodings:[{kind:"Delta",origin:w,srcType:A}],data:T}},e.integerPacking=function _(x){var A=function y(x){var A=function m(x){for(var A=0,T=x.length;A<T;A++)if(x[A]<0)return!0;return!1}(x),T=A?g(x,127):v(x,255),w=A?g(x,32767):v(x,65535);return 4*x.length<2*w?{isSigned:A,size:x.length,bytesPerElement:4}:2*w<T?{isSigned:A,size:w,bytesPerElement:2}:{isSigned:A,size:T,bytesPerElement:1}}(x);return 4===A.bytesPerElement?u(x):function b(x,A){for(var T=A.isSigned?1===A.bytesPerElement?127:32767:1===A.bytesPerElement?255:65535,w=-T-1,E=x.length,I=A.isSigned?1===A.bytesPerElement?new Int8Array(A.size):new Int16Array(A.size):1===A.bytesPerElement?new Uint8Array(A.size):new Uint16Array(A.size),M=0,F=0;F<E;F++){var N=x[F];if(N>=0)for(;N>=T;)I[M]=T,++M,N-=T;else for(;N<=w;)I[M]=w,++M,N-=w;I[M]=N,++M}var j=u(I);return{encodings:[{kind:"IntegerPacking",byteCount:A.bytesPerElement,isUnsigned:!A.isSigned,srcSize:E},j.encodings[0]],data:j.data}}(x,A)},e.stringArray=function C(x){var A=Object.create(null),T=[],w=new Int32Array(x.length),E=qe.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));qe.add(E,0);for(var I=0,M=0,F=0,N=x;F<N.length;F++){var j=N[F];if(null!=j){var k=A[j];void 0===k&&(I+=j.length,T[k=T.length]=j,A[j]=k,qe.add(E,I)),w[M++]=k}else w[M++]=-1}var H=qe.compact(E),U=FN(H).encode(H),W=FN(w).encode(w);return{encodings:[{kind:"StringArray",dataEncoding:W.encoding,stringData:T.join(""),offsetEncoding:U.encoding,offsets:U.data}],data:W.data}}}(Br||(Br={})),function(e){function r(s,u,c){return{name:s,type:1,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}e.str=function t(s,u,c){return{name:s,type:0,value:u,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}},e.int=r,e.float=function n(s,u,c){return{name:s,type:2,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount<"u"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}},e.index=function a(s){return r(s,function(u,c,l){return l+1},{typedArray:Int32Array,encoder:Br.by(Br.delta).and(Br.runLength).and(Br.integerPacking)})};var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,c,l){return this.fields.push(e.str(u,c,l)),this},s.prototype.int=function(u,c,l){return this.fields.push(e.int(u,c,l)),this},s.prototype.vec=function(u,c,l){for(var d=0;d<c.length;d++)this.fields.push(e.int("".concat(u,"[").concat(d+1,"]"),c[d],l));return this},s.prototype.float=function(u,c,l){return this.fields.push(e.float(u,c,l)),this},s.prototype.many=function(u){for(var c=0;c<u.length;c++)this.fields.push(u[c]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i,e.build=function o(){return new i}}(kN||(kN={})),function(e){e.Empty={fields:[],source:[]},e.filterOf=function t(n){for(var a=[],i=[],o=[],s=[],u=0,c=n.split(/[\r\n]+/);u<c.length;u++){var l=c[u];if(0!==(l=l.trim()).length){var d=/^!/.test(l);d&&(l=l.substr(1));var f=l.split(/\./),p=f[1],h=d?p?s:i:p?o:a;h[h.length]=l,p&&!a.includes(f[0])&&(a[a.length]=f[0])}}var m=o.map(function(v){return v.split(".")[0]});return{includeCategory:function(v){return!i.includes(v)&&(a.length<=0||-1!==a.indexOf(v))},includeField:function(v,g){var y=v+"."+g;return!s.includes(y)&&(!m.includes(v)||o.includes(y))}}},e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}},e.ofTable=function r(n,a){return a?{fields:EK(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return oT.Array(a)}}]}:{fields:EK(n._schema),source:[{data:n,rowCount:n._rowCount}]}}}(ac||(ac={})),function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(l){n.writeCategory({name:l,instance:function(){return ac.ofTable(i[l])}})},s=0,u=i._tableNames;s<u.length;s++)o(u[s])}e.writeDatabase=t,e.writeDatabaseCollection=function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}}(BN||(BN={}));var MMe=function(){function e(){this.builder=sn.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=ac.DefaultFilter,this.formatter=ac.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||ac.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||ac.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,sn.write(this.builder,"data_".concat((t||"").replace(/[ \n\t]/g,"").toUpperCase(),"\n#\n"))},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(n?.ignoreFilter||this.filter.includeCategory(t.name)){var a=IK(t,r),i=a.instance,o=a.rowCount,s=a.source;o&&(1===o?function RMe(e,t,r,n,a,i){var o=VN(t),s=r[0],u=s.data,c=o.reduce(function(v,g){return a.includeField(e.name,g.name)?Math.max(v,g.name.length):0},0);if(0!==c){c+=e.name.length+6;for(var d=s.keys().move(),f=MK(e.name,t.fields,i),p=0;p<o.length;p++){var h=o[p];a.includeField(e.name,h.name)&&(sn.writePadRight(n,"_".concat(e.name,".").concat(h.name),c),PK(n,u,d,h,f[p],0)||sn.newline(n))}sn.write(n,"#\n")}}(t,i,s,this.builder,this.filter,this.formatter):function OMe(e,t,r,n,a,i){var o=VN(t),s=a===ac.DefaultFilter?o:o.filter(function(b){return a.includeField(e.name,b.name)}),u=s.length;if(0!==u){var c=MK(e.name,s,i);RK(n,"loop_");for(var l=0;l<u;l++)RK(n,"_".concat(e.name,".").concat(s[l].name));for(var d=0,f=0;f<r.length;f++){var p=r[f],h=p.data;if(0!==p.rowCount)for(var m=p.keys();m.hasNext;){for(var v=m.move(),g=!1,y=0;y<u;y++)g=PK(n,h,v,s[y],c[y],d);g||sn.newline(n),d++}}sn.write(n,"#\n")}}(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=sn.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return sn.getSize(this.builder)},e.prototype.getData=function(){return sn.getString(this.builder)},e}();function PK(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(0!==s)1===s?function BMe(e){sn.writeSafe(e,". ")}(e):function LMe(e){sn.writeSafe(e,"? ")}(e);else{var u=n.value(r,t,i),c=n.type;if(0===c)return function FMe(e){return"string"==typeof e&&e.indexOf("\n")>=0}(u)?(gT(e,u),!0):function UMe(e,t){if(!t)return sn.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++)switch(t.charCodeAt(s)){case 9:case 32:n=!0;break;case 10:return gT(e,t),!0;case 34:if(s&&s===u)break;if(i)return gT(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return gT(e,t),!0;i=!0,n=!0,a=1}return!n&&(35===r||36===r||59===r||91===r||93===r||95===r)&&(n=!0),n?(sn.writeSafe(e,a?'"':"'"),sn.writeSafe(e,t),sn.writeSafe(e,a?'" ':"' ")):(sn.writeSafe(e,t),sn.writeSafe(e," ")),!1}(e,u);1===c?function NMe(e,t){sn.writeInteger(e,t),sn.whitespace1(e)}(e,u):function kMe(e,t,r){sn.writeFloat(e,t,r),sn.whitespace1(e)}(e,u,a)}return!1}function MK(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);n[n.length]=s&&typeof s.digitCount<"u"?2===o.type?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:2===o.type?Math.pow(10,PMe(o)):0}return n}function RK(e,t){sn.write(e,t),sn.newline(e)}function gT(e,t){sn.writeSafe(e,"\n;"+t),sn.writeSafe(e,"\n;\n")}function Oy(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128)e[t++]=i>>>0&127|0;else if(i<2048)e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;else if(i<65536)e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;else{if(!(i<1114112))throw new Error("bad codepoint "+i);e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128}}}var VMe=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function OK(e){throw new Error(e)}var FK=typeof TextDecoder<"u"?new TextDecoder:void 0;function zN(e,t,r){if(FK){var n=t||r!==e.length?e.subarray(t,t+r):e;return FK.decode(n)}return function zMe(e,t,r){for(var n=VMe,a=void 0,i=0,o=[],u=t,c=t+r;u<c;u++){var l=e[u];128&l?192==(224&l)?o[i++]=n[(15&l)<<6|63&e[++u]]:224==(240&l)?o[i++]=String.fromCharCode((15&l)<<12|(63&e[++u])<<6|(63&e[++u])<<0):240==(248&l)?o[i++]=String.fromCharCode((7&l)<<18|(63&e[++u])<<12|(63&e[++u])<<6|(63&e[++u])<<0):OK("Invalid byte "+l.toString(16)):o[i++]=n[l],512===i&&((a=a||[])[a.length]=o.join(""),i=0)}return a?(i>0&&(a[a.length]=o.slice(0,i).join("")),a.join("")):o.slice(0,i).join("")}(e,t,r)}function yT(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);a<128?t+=1:a<2048?t+=2:a<65536?t+=3:a<1114112?t+=4:OK("bad codepoint "+a)}return t}function GMe(e){var t=new ArrayBuffer(bT(e)),r=new DataView(t),n=new Uint8Array(t);return _T(e,r,n,0),n}function bT(e){var t=typeof e;if("string"===t){var r=yT(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null==e)return 1;if("object"===t){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=bT(e[o])}else{var s=Object.keys(e);for(a=s.length,o=0;o<a;o++){var u=s[o];i+=bT(u)+bT(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function _T(e,t,r,n){var a=typeof e;if("string"===a){var i=yT(e);if(i<32)return t.setUint8(n,160|i),Oy(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),Oy(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),Oy(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),Oy(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if("number"===a){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null==e)return t.setUint8(n,192),1;if("boolean"===a)return t.setUint8(n,e?195:194),1;if("object"===a){var u,c=0,l=Array.isArray(e),d=void 0;if((u=l?e.length:(d=Object.keys(e)).length)<16?(t.setUint8(n,u|(l?144:128)),c=1):u<65536?(t.setUint8(n,l?220:222),t.setUint16(n+1,u),c=3):u<4294967296&&(t.setUint8(n,l?221:223),t.setUint32(n+1,u),c=5),l)for(var f=0;f<u;f++)c+=_T(e[f],t,r,n+c);else{f=0;for(var p=d.length;f<p;f++){var h=d[f];c+=_T(h,t,r,n+c),c+=_T(e[h],t,r,n+c)}}return c}throw new Error("Unknown type "+a)}var Fa,Bv,ic,HMe=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=ac.DefaultFilter,this.formatter=ac.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:"0.3.0",dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||ac.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||ac.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(n?.ignoreFilter||this.filter.includeCategory(t.name)){var a=IK(t,r),o=a.rowCount,s=a.source;if(o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=0,d=VN(a.instance);l<d.length;l++){var f=d[l];if(this.filter.includeField(t.name,f.name)){var p=this.formatter.getFormat(t.name,f.name);u.columns.push(XMe(t.name,f,s,o,p,this.binaryEncodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=GMe(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function XMe(e,t,r,n,a,i,o){var s=function KMe(e,t,r,n){for(var a=0===e.type,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,c=!0,l=0,d=0;d<n.length;d++)for(var f=n[d].data,p=n[d].keys();p.hasNext;){var h=p.move(),m=s?s(h,f):0;if(0!==m)o[l]=m,a&&(i[l]=""),c=!1;else{var v=u(h,f,l);"string"!=typeof v||v?o[l]=0:(o[l]=1,c=!1),i[l]=v}l++}return{array:i,allPresent:c,mask:o}}(t,function jMe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:0===e.type?Array:1===e.type?Int32Array:Float64Array}(t,a),n,r),u=s.array,c=s.allPresent,l=s.mask,d=function WMe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}(e,t,a,i);d||(d=o?function YMe(e,t){return 0===e?Wh.by(Br.stringArray):1===e?FN(t):function DMe(e){return NN.classify(e)}(t)}(t.type,u):function qMe(e){return Wh.by(0===e?Br.stringArray:Br.byteArray)}(t.type));var f=d.encode(u),p=void 0;if(!c){var h=Wh.by(Br.runLength).and(Br.byteArray).encode(l);p=h.data.length<l.length?h:Wh.by(Br.byteArray).encode(l)}return{name:t.name,data:f,mask:p}}!function(e){e.Encoder=BN,e.Category=ac,e.Field=kN,e.Encoding=Br,e.createEncoder=function t(u){var c=u||{},l=c.binary,f=c.encoderName;return void 0!==l&&l?new HMe(void 0===f?"mol*":f,u?u.binaryEncodingPovider:void 0,!!u&&!!u.binaryAutoClassifyEncoding):new MMe},e.fields=function r(){return e.Field.build()};var n=e.Encoding;function s(u){var c=u.precision;if(void 0!==c){var l=Math.pow(10,c),d=n.by(n.fixedPoint(l));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)},e.categoryInstance=function a(u,c){return{fields:u,source:[c]}},e.createEncodingProviderFromCifFrame=function i(u){return{get:function(c,l){var d=u.categories[c];if(d){var f=d.getField(l);return f&&f.binaryEncoding?Wh.fromEncoding(f.binaryEncoding):void 0}}}},e.createEncodingProviderFromJsonConfig=function o(u){return{get:function(c,l){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===c&&f.columnName===l)return s(f)}}}}}(Fa||(Fa={})),function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return Fa.Category.Empty;var o=i.data;if(!o)return Fa.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,c=o._rowCount,l=[],d=0;d<c;d++)s.has(u.value(d))&&(l[l.length]=d);return Fa.Category.ofTable(o,l)}}]}},e.Provider=jl.create(e.Descriptor),e.chemCompBondFromTable=function t(a,i){return Qr.pick(i,kr.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})},e.getEntriesFromChemCompBond=function r(a){var i=new Map;function o(T){if(i.has(T))return i.get(T);var w=new n(T);return i.set(T,w),w}for(var s=a.comp_id,u=a.atom_id_1,c=a.atom_id_2,l=a.value_order,d=a.pdbx_aromatic_flag,f=a._rowCount,p=a.pdbx_ordinal,h=o(s.value(0)),m=0;m<f;m++){var v=s.value(m),g=u.value(m),y=c.value(m),b=l.value(m),_="y"===d.value(m),C=p.value(m);h.id!==v&&(h=o(v));var x=1,A=1;switch(_&&(x|=16),b.toLowerCase()){case"delo":x|=16;break;case"doub":A=2;break;case"trip":A=3;break;case"quad":A=4}h.add(g,y,A,x,C)}return i};var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,c,l){void 0===l&&(l=!0);var d=this.map.get(i);if(void 0!==d)void 0===d.get(o)&&d.set(o,{order:s,flags:u,key:c});else{var p=new Map;p.set(o,{order:s,flags:u,key:c}),this.map.set(i,p)}l&&this.add(o,i,s,u,c,!1)},a}();e.Entry=n}(Bv||(Bv={})),function(e){function r(i,o){for(var s=i.units,u=0,c=s.length;u<c;u++)if(Xe.indexOf(s[u].elements,o)>=0)return!0;return!1}e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||0===o.entries.length)return Fa.Category.Empty;for(var s=i.structures[0],u=[],c=0,l=o.entries;c<l.length;c++){var d=l[c];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return Fa.Category.ofTable(o.data,u)}}]}},e.Provider=jl.create(e.Descriptor),e.isExhaustive=function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95},e.getAtomIndexFromEntries=function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var c=u[s],l=c.partnerA.atomIndex,d=c.partnerB.atomIndex;o.has(l)?o.get(l).push(c):o.set(l,[c]),o.has(d)?o.get(d).push(c):o.set(d,[c])}return o},e.getEntriesFromStructConn=function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,c=i.pdbx_value_order,l={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},f=Array.from(o.entities.data.id.toArray()),p=function(x,A){if(0===A.label_asym_id.valueKind(x)){var T=A.label_asym_id.value(x),w=A.label_atom_id.value(x);if(w)for(var E=A.auth_seq_id.valueKind(x)===ie.ValueKind.Present?A.auth_seq_id.value(x):A.label_seq_id.value(x),I=A.ins_code.value(x),M=A.label_alt_id.value(x),F=0,N=f;F<N.length;F++){var k=o.atomicHierarchy.index.findResidue(N[F],T,E,I);if(!(k<0)){var H=o.atomicHierarchy.index.findAtomOnResidue(k,w,M);if(!(H<0))return{residueIndex:k,atomIndex:H,symmetry:A.symmetry.value(x)}}}}},h=[],m=0;m<i._rowCount;m++){var v=p(m,l),g=p(m,d);if(void 0!==v&&void 0!==g){var y=s.value(m),_=0,C=1;switch(c.value(m)||""){case"sing":C=1;break;case"doub":C=2;break;case"trip":C=3;break;case"quad":C=4;break;default:C=xK(i.ptnr1_label_comp_id.value(m),i.ptnr1_label_atom_id.value(m),i.ptnr2_label_comp_id.value(m),i.ptnr2_label_atom_id.value(m))}switch(y){case"covale":_=1;break;case"disulf":_=9;break;case"hydrog":_=4;break;case"metalc":_=2}h.push({rowIndex:m,flags:_,order:C,distance:u.value(m),partnerA:v,partnerB:g})}}return h}}(ic||(ic={}));var ZMe=S.distance;function NK(e,t,r,n,a,i,o){for(var s=new Cu.EdgeBuilder(i,e,t),u=new Uint16Array(s.slotCount),c=new Int8Array(s.slotCount),l=new Uint32Array(s.slotCount),d=0,f=s.edgeCount;d<f;d++)s.addNextEdge(),s.assignProperty(u,n[d]),s.assignProperty(c,r[d]),s.assignProperty(l,a[d]);return s.createGraph({flags:u,order:c,key:l},{canRemap:o})}var kK=S(),BK=S();function QMe(e,t,r){return e.conformation.position(t,kK),e.conformation.position(r,BK),ZMe(kK,BK)}var $Me=new Set;var rRe=S.distance,nRe=S.set,aRe=S.squaredDistance,iRe=S.transformMat4,LK=S(),UK=S();function VK(e,t,r,n){return e.conformation.position(t,LK),r.conformation.position(n,UK),rRe(LK,UK)}var Ht,oRe=me(),Lv=S(),uRe=R(R({},SK),{ignoreWater:!0,ignoreIon:!0});function lRe(e,t){var r=R(R({},uRe),t);return function cRe(e,t){var r=new Nv.Builder,n=e.models.some(function(i){return Lo.Provider.get(i)}),a=e.models.some(function(i){return ic.isExhaustive(i)});return t.noCompute||e.isCoarseGrained&&!n&&!a||Ye.eachUnitPair(e,function(i,o){!function sRe(e,t,r,n){var a=r.maxRadius,i=e.elements,o=e.residueIndex,s=e.model.atomicConformation,u=s.x,c=s.y,l=s.z,d=t.elements,f=t.residueIndex,p=e.elements.length,h=e.model.atomicHierarchy.atoms,m=h.type_symbol,v=h.label_alt_id,g=h.label_atom_id,y=h.label_comp_id,b=t.model.atomicHierarchy.atoms,_=b.type_symbol,C=b.label_alt_id,x=b.label_atom_id,A=b.label_comp_id,T=e.model.atomicHierarchy.residues.auth_seq_id,w=t.model.atomicHierarchy.residues.auth_seq_id,E=e.model.atomicConformation.occupancy,I=t.model.atomicConformation.occupancy,M=E.isDefined&&I.isDefined,F=e.model===t.model&&ic.Provider.get(e.model),N=!r.forceCompute&&e.model===t.model&&Lo.Provider.get(e.model),j=e.model.atomicHierarchy.atomSourceIndex,k=(N?ir.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,H=e.model===t.model&&ic.isExhaustive(e.model),G=me.mul(oRe,t.conformation.operator.inverse,e.conformation.operator.matrix),U=!me.isIdentity(G),Q=t.boundary.sphere,W=Q.center,K=Q.radius,ne=(K+a)*(K+a);n.startUnitPair(e.id,t.id);for(var X=e.conformation.operator.key,L=t.conformation.operator.key,Y=0;Y<p;Y++){var $=i[Y];if(nRe(Lv,u[$],c[$],l[$]),U&&iRe(Lv,Lv,G),!(aRe(Lv,W)>ne)){if(!r.forceCompute&&N){for(var Z=N.maxDistance,q=N.bonds,z=q.offset,te=q.b,ae=q.edgeProps,fe=ae.order,he=ae.distance,pe=ae.flag,re=ae.key,ee=ae.operatorA,ue=ae.operatorB,ge=j.value($),Ce=Ud(m.value($)),ze=z[ge],je=z[ge+1];ze<je;++ze)if(!((J=Xe.indexOf(t.elements,V=k[te[ze]]))<0)){var ye=ee[ze],we=ue[ze];if(!(ye>=0&&ye!==X&&ye!==L||we>=0&&we!==L&&we!==X)){var Ee=Ud(m.value(V)),Fe=he[ze],ke=VK(e,$,t,V),Ue=!1;Fe>=0?Ue=ia(ke,Fe,.3):Z>=0?Ue=ke<Z:(Ue=ke<hT(Ce,Ee,jh(Ce),jh(Ee)),op(Ce)&&op(Ee)&&(Ue=!1)),Ue&&n.add(Y,J,{order:fe[ze],flag:pe[ze],key:re[ze]})}}continue}var Pe=r.forceCompute?void 0:F&&F.byAtomIndex.get($);if(Pe&&Pe.length){for(var He=!1,Je=0,vt=Pe;Je<vt.length;Je++){var ut=vt[Je],_t=ut.partnerA,Le=_t.atomIndex===$?ut.partnerB:_t;(J=Xe.indexOf(t.elements,Le.atomIndex))<0||VK(e,$,t,Le.atomIndex)>a||(n.add(Y,J,{order:ut.order,flag:ut.flags,key:ut.rowIndex}),He=!0)}if(He)continue}if(!H){var st=E.value($),bt=t.lookup3d.find(Lv[0],Lv[1],Lv[2],a),Mt=bt.indices,Rt=bt.count,oe=bt.squaredDistances;if(0!==Rt)for(var be=Ud(m.value($)),Se=op(be),Qe=jh(be),Et=v.value($),At=F2.has(be),Zt=g.value($),Ir=y.value(o[$]),rr=0;rr<Rt;rr++){var J,V,mn=C.value(V=d[J=Mt[rr]]);if(!(Et&&mn&&Et!==mn||M&&I.value(V)<1&&st<1&&T.value($)===w.value(V))){var na=op(Ee=Ud(_.value(V)));if(!Se||!na){var _o=(At||F2.has(Ee))&&!(Se||na);if(0!==(ke=Math.sqrt(oe[rr]))&&ke<=hT(be,Ee,Qe,jh(Ee))){var Za=x.value(V),Ji=A.value(f[V]);n.add(Y,J,{order:xK(Ir,Ji,Zt,Za),flag:32|(_o?2:1),key:-1})}}}}}}}n.finishUnitPair()}(i,o,t,r)},{maxRadius:t.maxRadius,validUnit:function(i){return t.validUnit(i)},validUnitPair:function(i,o){return t.validUnitPair(e,i,o)}}),new O2(r.getMap())}(e,R(R({},r),{validUnit:t&&t.validUnit||function(n){return Oe.isAtomic(n)},validUnitPair:t&&t.validUnitPair||function(n,a,i){if(!Ye.validUnitPair(n,a,i))return!1;var s=a.model.atomicHierarchy.derived.residue.moleculeType,u=i.model.atomicHierarchy.derived.residue.moleculeType,c=!(Oe.isAtomic(a)&&2===s[a.residueIndex[a.elements[0]]]||Oe.isAtomic(i)&&2===u[i.residueIndex[i.elements[0]]]),l=!Oe.isAtomic(a)||3!==s[a.residueIndex[a.elements[0]]],d=!Oe.isAtomic(i)||3!==u[i.residueIndex[i.elements[0]]];return!(!c&&r.ignoreWater||!(l&&d||!r.ignoreIon))||function dRe(e,t){if(e.model!==t.model||!Oe.isAtomic(e)||!Oe.isAtomic(t))return!1;var r=ic.Provider.get(e.model);if(!r)return!1;for(var i=(e.elements.length<t.elements.length?e:t).elements,o=(e.elements.length>=t.elements.length?e:t).elements,s=Xe.indexOf,u=0,c=i.length;u<c;u++){var l=i[u],d=r.byAtomIndex.get(l);if(d?.length)for(var f=0,p=d;f<p.length;f++){var h=p[f];if(s(o,h.partnerA.atomIndex===l?h.partnerB.atomIndex:h.partnerA.atomIndex)>=0)return!0}}return!1}(a,i)}}))}function zK(e){e.count=e.endVertex-e.startVertex;for(var t=e.isRingAtom,r=e.pred,n=e.color,a=e.depth,i=e.marked,o=0;o<e.count;o++)t[o]=0,r[o]=-1,i[o]=-1,n[o]=0,a[o]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function GK(e){for(var t=e.depth,r=0;r<e.count;r++)t[r]=e.count+1}function HK(e,t){var r=e.bonds.offset,n=e.startVertex+t,o=r[n+1]-r[n];return!(o<=1||e.isRingAtom[t]&&2===o)}function mRe(e,t,r){if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var n=e.unit.elements,a=[],i=e.startVertex;i<e.endVertex;i++)$a(a,o=e.altLoc.value(n[i]));Tv(a,"");var s=1;if(0===a.length)for(zK(e),i=0;i<e.count;i++)HK(e,i)&&(GK(e),s=jK(e,i,s));else for(var u=0;u<a.length;u++)for(zK(e),e.hasAltLoc=!0,e.currentAltLoc=a[u],i=0;i<e.count;i++)if(HK(e,i)){var o;(o=e.altLoc.value(n[e.startVertex+i]))&&o!==e.currentAltLoc||(GK(e),s=jK(e,i,s))}i=0;for(var c=e.currentRings.length;i<c;i++)e.rings.push(e.currentRings[i])}}function vRe(e,t,r,n){if(r<t)return!1;for(var a=e.pred,i=e.color,o=e.left,s=e.right,u=++e.currentColor,c=t,l=0;l<5&&(i[c]=u,!((c=a[c])<0));l++);var d=0,f=0,p=!1,h=0;for(c=r,l=0;l<5;l++){if(i[c]===u){h=c,p=!0;break}if(s[f++]=c,(c=a[c])<0)break}if(!p)return!1;for(c=t,l=0;l<5&&(o[d++]=c,!(h===c||(c=a[c],c<0)));l++);var m=d+f;if(m<3)return!1;var v=new Int32Array(m),g=0;for(l=0;l<d;l++)v[g++]=e.startVertex+o[l],n[o[l]]=1;for(l=f-1;l>=0;l--)v[g++]=e.startVertex+s[l],n[s[l]]=1;Rc(v);for(var y=0,b=e.currentRings.length;y<b;y++){var _=e.currentRings[y];if(v.length===_.length){if(Xe.areEqual(v,_))return!1}else if(v.length>_.length&&Xe.isSubset(v,_))return!1}return e.currentRings.push(Xe.ofSortedArray(v)),!0}function jK(e,t,r){var n=e.bonds,a=e.startVertex,i=e.endVertex,o=e.isRingAtom,s=e.marked,u=e.queue,c=e.pred,l=e.depth,d=e.unit.elements,f=n.b,p=n.edgeProps.flags,h=n.offset;s[t]=r,l[t]=0,u[0]=t;for(var m=0,v=1;m<v;)for(var g=u[m++],y=l[g],b=a+g,C=h[b+1],x=h[b];x<C;x++){var A=f[x];if(!(A<a||A>=i)&&Gr.isCovalent(p[x])){if(e.hasAltLoc){var T=e.altLoc.value(d[A]);if(T&&e.currentAltLoc!==T)continue}var w=A-a;if(s[w]===r){if(c[w]!==g&&c[g]!==w&&vRe(e,g,w,o))return r+1;continue}var E=Math.min(l[w],y+1);E>5||(l[w]=E,s[w]=r,u[v++]=w,c[w]=g)}}return r+1}function qK(e){for(var t=e.length,r=new Int32Array(2*t),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(n=r[s-o-1];-1!==n&&(a=e[s%t])!==(i=e[(o+n+1)%t]);)a<i&&(o=s-n-1),n=r[n];-1===n&&(a=e[s%t])!==(i=e[(o+n+1)%t])?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1}return o}function WK(e,t){var a,r=e.length,n=[];for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function GN(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=function bRe(e,t){var n=e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Hh(n.type,r)}return 0}!function(e){function t(v,g,y,b,_,C){return{kind:"bond-location",aStructure:v,aUnit:g,aIndex:y,bStructure:b,bUnit:_,bIndex:C}}function n(v,g){return v.aStructure.label===g.aStructure.label&&v.bStructure.label===g.bStructure.label&&v.aIndex===g.aIndex&&v.bIndex===g.bIndex&&v.aUnit.id===g.aUnit.id&&v.bUnit.id===g.bUnit.id}function a(v,g){return{kind:"bond-loci",structure:v,bonds:g}}e.Location=t,e.isLocation=function r(v){return!!v&&"bond-location"===v.kind},e.areLocationsEqual=n,e.Loci=a,e.isLoci=function i(v){return!!v&&"bond-loci"===v.kind},e.areLociEqual=function o(v,g){if(v.structure!==g.structure||v.bonds.length!==g.bonds.length)return!1;for(var y=0,b=v.bonds.length;y<b;++y)if(!n(v.bonds[y],g.bonds[y]))return!1;return!0},e.isLociEmpty=function s(v){return 0===v.bonds.length},e.remapLoci=function u(v,g){if(g===v.structure)return v;var y=[];return v.bonds.forEach(function(b){var _=g.unitMap.get(b.aUnit.id);if(_){var C=g.unitMap.get(b.bUnit.id);if(C){var A=Xe.indexOf(_.elements,b.aUnit.elements[b.aIndex]);if(-1!==A){var w=Xe.indexOf(C.elements,b.bUnit.elements[b.bIndex]);-1!==w&&y.push(t(v.structure,_,A,v.structure,C,w))}}}}),a(g,y)},e.toStructureElementLoci=function c(v){for(var g=[],y=new Map,b=0,_=v.bonds;b<_.length;b++){var C=_[b],x=C.aIndex,A=C.aUnit,T=C.bIndex,w=C.bUnit;A===w?y.has(A.id)?y.get(A.id).push(x,T):y.set(A.id,[x,T]):(y.has(A.id)?y.get(A.id).push(x):y.set(A.id,[x]),y.has(w.id)?y.get(w.id).push(T):y.set(w.id,[T]))}return y.forEach(function(E,I){g.push({unit:v.structure.unitMap.get(I),indices:Xe.deduplicate(Xe.ofUnsortedArray(E))})}),Re(v.structure,g)},e.toFirstStructureElementLoci=function l(v){var g=v.bonds[0];return Re(v.structure,[{unit:g.aUnit,indices:Be.ofSingleton(g.aIndex)}])},e.getType=function d(v,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,b=y.getEdgeIndex(g.aIndex,g.bIndex);return Gr.create(b<0?0:y.edgeProps.flags[b])}var _=v.interUnitBonds.getBondFromLocation(g);return Gr.create(_?_.props.flag:0)},e.getOrder=function f(v,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,b=y.getEdgeIndex(g.aIndex,g.bIndex);return b<0?0:y.edgeProps.order[b]}var _=v.interUnitBonds.getBondFromLocation(g);return _?_.props.order:0},e.getIntraUnitBondCount=function p(v){for(var g=0,y=0,b=v.units.length;y<b;++y){var _=v.units[y];Oe.isAtomic(_)&&(g+=_.bonds.edgeCount)}return g};var h=function(){function v(){this.current={},this.hasNext=!1}return v.prototype.move=function(){return this.advance(),this.current},v.prototype.setElement=function(g,y,b){this.structure=g,this.unit=y,this.index=b,this.interBondIndices=g.interUnitBonds.getEdgeIndices(b,y.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=y.bonds.offset[b+1],this.intraBondIndex=y.bonds.offset[b],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},v.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else{if(!(this.interBondIndex<this.interBondCount))return void(this.hasNext=!1);var g=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},v}();e.ElementBondIterator=h,e.getBoundingSphere=function m(v,g){return Fv.fromPairProvider(v.bonds.length,function(y,b,_){var C=v.bonds[y],x=C.aUnit,T=C.bUnit,w=C.bIndex;x.conformation.position(x.elements[C.aIndex],b),T.conformation.position(T.elements[w],_)},g)}}(Ht||(Ht={}));var _Re=new Set;function Yh(e,t){var r=EPe[e];if(void 0!==r){var n=r[t];if(void 0!==n)return n}return _Re}var YK=S.zero();function XK(e,t){for(var r=e.conformation.position,n=new Float32Array(3*t.length),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],YK),S.toArray(YK,n,3*i);return n}var Lc,wn,ST=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index||(this._index=function yRe(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var s=0,u=(o=e[a]).length;s<u;s++)r.has(c=o[s])?r.get(c).push(a):r.set(c,[a]);for(var l=0,d=t.length;l<d;l++)for(s=0,u=(o=e[a=t[l]]).length;s<u;s++)n.has(c=o[s])?n.get(c).push(a):n.set(c,[a]);var f=new Cu.UniqueEdgeBuilder(e.length);for(a=0,i=e.length;a<i;a++){var o;for(s=0,u=(o=e[a]).length;s<u;s++){var c,p=r.get(c=o[s]);if(1!==p.length)for(var h=0,m=p.length;h<m;h++){var v=p[h];a>=v||f.addEdge(a,v)}}}var g=Cu.connectedComponents(f.getGraph()),y=g.componentIndex,b=[];for(s=0;s<g.componentCount;s++)b[s]=[];for(a=0,i=e.length;a<i;a++)b[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}(this.all,this.aromaticRings)),this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint||(this._byFingerprint=function SRe(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var s=Lc.fingerprint(e,t[a]);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}(this.unit,this.all)),this._byFingerprint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings||(this._aromaticRings=function wRe(e,t){for(var r=[],n=0,a=t.length;n<a;++n)Lc.isAromatic(e,t[n])&&r.push(n);return r}(this.unit,this.all)),this._aromaticRings},enumerable:!1,configurable:!0}),e}();function CRe(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function xRe(e,t,r){var n=e.byFingerprint.get(t);if(n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=CRe(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}(function(e){function r(s){return function gRe(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];var a=qK(e),i=qK(r),o=!1;for(n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?WK(e,a):WK(r,i)}(s)}e.fingerprint=function t(s,u){for(var c=s.elements,l=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,p=u.length;f<p;f++)d[d.length]=l.value(c[u[f]]);return r(d)},e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]);e.isAromatic=function i(s,u){var c=s.elements,l=s.bonds,d=l.b,f=l.offset,p=l.edgeProps.flags,h=s.model.atomicHierarchy.atoms,m=h.type_symbol;if("PRO"===h.label_comp_id.value(s.elements[u[0]]))return!1;for(var g=0,y=!1,b=0,_=u.length;b<_;++b){var C=u[b];!y&&n.has(m.value(c[C]))&&(y=!0);for(var x=f[C],A=f[C+1];x<A;++x)Gr.is(16,p[x])&&Xe.has(u,d[x])&&(g+=1)}if(g===2*u.length)return!0;if(!y||u.length<5||g>0)return!1;var T=ql.calculateMomentsAxes(XK(s,u));return S.magnitude(T.dirC)<.05},e.getAltId=function o(s,u){for(var c=s.model.atomicHierarchy.atoms.label_alt_id,l=s.elements,d=0,f=u.length;d<f;++d){var h=c.value(l[u[d]]);if(h)return h}return""}})(Lc||(Lc={})),function(e){e.create=function t(n){var a=function fRe(e){for(var t=function hRe(e){for(var t=tr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}(e),r=function pRe(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}(e,t),n=tr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();mRe(r,a.start,a.end)}return r.rings}(n);return new e(a,n)},e.byFingerprintAndResidue=function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++)xRe(n,a[o],i);return i}}(ST||(ST={})),function(e){function i(_){return _[_.length-1]}function s(_){return _.length/2}function u(_,C){return _[2*C]}function c(_,C){return _[2*C+1]+1}function l(_,C){return _[2*C]}function d(_,C){return _[2*C+1]}function v(_,C){return g(_,C,0)}function g(_,C,x){if(l(_,x)>Be.max(C)||i(_)<Be.min(C))return-1;for(var A=x,T=s(_);A<T;++A){var w=xe.ofRange(l(_,A),d(_,A));if(Be.areIntersecting(w,C))return A}return-1}e.ofSortedRanges=function t(_){return Xe.ofSortedArray(_)},e.start=function r(_){return _[0]},e.end=function n(_){return _[_.length-1]+1},e.min=function a(_){return _[0]},e.max=i,e.size=function o(_){for(var C=0,x=0,A=_.length;x<A;x+=2)C+=_[x+1]-_[x]+1;return C},e.count=s,e.startAt=u,e.endAt=c,e.minAt=l,e.maxAt=d,e.areEqual=function f(_,C){if(_.length!==C.length)return!1;for(var x=0,A=_.length;x<A;++x)if(_[x]!==C[x])return!1;return!0},e.forEach=function p(_,C){for(var x=0,A=0,T=_.length;A<T;A+=2)for(var w=_[A],E=_[A+1];w<=E;++w)C(w,x),++x},e.has=function h(_,C){return-1!==v(_,C)},e.hasFrom=function m(_,C,x){return-1!==g(_,C,x)},e.firstIntersectionIndex=v,e.firstIntersectionIndexFrom=g,e.transientSegments=function y(_,C){return new b(_,C)};var b=function(){function _(C,x){this.ranges=C,this.set=x,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=v(C,x),this.hasNext=-1!==this.curIndex}return _.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Be.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Be.findPredecessorIndex(this.set,c(this.ranges,this.curIndex))},_.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=-1!==this.curIndex),this.value},_}();e.Iterator=b}(wn||(wn={}));var KK=S.zero();function ZK(e){var t=function MRe(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(3*r.length),a=0,i=r.length;a<i;a++)t(r[a],KK),S.toArray(KK,n,3*a);return n}(e);return ql.ofPositions(t)}var QK=S.dot,$K=S.copy,RRe=S.scaleAndSub,ORe=S.scaleAndAdd,oc=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new Fv,this.dir=function FRe(e){var t;switch(e){case"6":t=sr([],CT,!0);break;case"14":t=sr(sr([],CT,!0),HN,!0);break;case"26":t=sr(sr(sr([],CT,!0),HN,!0),JK,!0);break;case"98":t=sr(sr(sr(sr(sr(sr([],CT,!0),HN,!0),JK,!0),NRe,!0),kRe,!0),BRe,!0)}return t.map(function(r){var n=S.create(r[0],r[1],r[2]);return S.normalize(n,n)})}(t),this.dirLength=this.dir.length,this.reset()}return e.prototype.computeExtrema=function(t,r){var n=QK(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,$K(this.extrema[2*t],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,$K(this.extrema[2*t+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=this.dir[t],i=QK(a,r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,RRe(this.extrema[2*t],r,a,n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,ORe(this.extrema[2*t+1],r,a,n))},e.prototype.includeSphere=function(t){if(De.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++)this.includePosition(n[r]);else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0;r<this.dirLength;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(De.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++)this.radiusPosition(n[r]);else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return De.setExtrema(this.centroidHelper.getSphere(t),this.extrema.slice())},e.prototype.getBox=function(t){return Nt.fromVec3Array(t||Nt(),this.extrema)},e.prototype.reset=function(){for(var t=0;t<this.dirLength;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[2*t]=S(),this.extrema[2*t+1]=S();this.centroidHelper.reset()},e}(),CT=[[1,0,0],[0,1,0],[0,0,1]],HN=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],JK=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],NRe=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],kRe=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],BRe=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],eZ=S.set,LRe=new oc("14"),URe=new oc("98");function jN(e){var t=Nt.computeBounding(e);return{box:t,sphere:De.fromBox3D(De(),t)}}var xT=S();function up(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=Be.size(i);if(o>25e4)return jN(e);var s=function VRe(e){return e>1e4?LRe:URe}(o);s.reset();for(var u=0;u<o;u++){var c=Be.getAt(i,u);eZ(xT,t[c],r[c],n[c]),s.includePositionRadius(xT,a&&a[c]||0)}for(s.finishedIncludeStep(),u=0;u<o;u++)c=Be.getAt(i,u),eZ(xT,t[c],r[c],n[c]),s.radiusPositionRadius(xT,a&&a[c]||0);var l=s.getSphere();if(!a&&De.hasExtrema(l)&&o<=l.extrema.length){var d=[];for(u=0;u<o;u++)c=Be.getAt(i,u),d.push(S.create(t[c],r[c],n[c]));De.setExtrema(l,d)}return{box:s.getBox(),sphere:l}}var B2,ei,Oe,Fy,zRe=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Xe.hashCode(t);if(this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],s=i[1];if(Xe.areEqual(t,i[0]))return s}},e.prototype.set=function(t,r){var n=Xe.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(Xe.areEqual(t,s[0]))return void(s[1]=r)}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),qN=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators||(this._operators=this.operatorsProvider()),this._operators},enumerable:!1,configurable:!0}),e}();function HRe(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,c=t.asym_id_list,l=0,d=t._rowCount;l<d;l++)s.value(l)===a&&(o[o.length]={assemblyId:a,expression:u.value(l),asymIds:c.value(l)});return qN.create(a,i,function jRe(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],s=WRe(XRe(i.expression)),u=YRe(t,s,n,i.assemblyId),c=_n.generators.atoms({chainTest:_n.pred.and(_n.pred.eq(function(l){return it.unit.operator_name(l.element)},sa.DefaultName),_n.pred.inSet(function(l){return it.chain.label_asym_id(l.element)},i.asymIds))});r[r.length]={selector:c,operators:u,asymIds:i.asymIds},n+=u.length}return r}}(o,n))}function WRe(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return tZ(e,t,e.length-1,r),t}function tZ(e,t,r,n){if(r<0)t[t.length]=n.slice(0);else for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],tZ(e,t,r-1,n)}function YRe(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],c=me.identity(),l=0;l<u.length;l++)me.mul(c,c,e.get(u[l]));i++,a[a.length]=sa.create("ASM_".concat(i),c,{assembly:{id:n,operId:i,operList:u}})}return a}function XRe(e){for(var a,t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[];a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var c=parseInt(s.substring(0,u)),l=parseInt(s.substr(u+1)),d=c;d<=l;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}function $Re(e){if(0!==e._rowCount){for(var t=e.id,r=e.matrix,n=e.vector,a=kr.struct_ncs_oper.matrix.space,i=kr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Cr.toMat3(Qt(),a,r.value(s)),c=Cr.toVec3(S(),i,n.value(s));if(sa.checkIfRotationAndTranslation(u,c)&&("given"!==e.code.value(s)||Qt.isIdentity(u)||S.isZero(c))){var l=t.value(s);o[o.length]=sa.ofRotationAndOffset("ncs_".concat(l),u,c,l)}}return o}}function eOe(e){for(var t=e.bonds,r=t.b,a=t.offset,o=t.edgeProps.flags,s=e.rings.elementAromaticRingIndices,u=[],c=new Map,l=new Map,d=function(_,C,x){var A=u.length;u.push(Xe.ofUnsortedArray([_,C,x])),c.set(w2(_,C),x),l.has(_)?l.get(_).push(A):l.set(_,[A])},f=0;f<e.elements.length;f++)if(!(s.has(f)||a[f+1]-a[f]+1<2)){for(var h=[],m=a[f],v=a[f+1];m<v;m++)Gr.is(o[m],16)&&h.push(r[m]);if(h.length>=2){d(f,h[0],h[1]);for(var y=1,b=h.length;y<b;y++)d(f,h[y],h[0])}}return{getThirdElement:function(_,C){return c.get(w2(_,C))},getTripletIndices:function(_){return l.get(_)},triplets:u}}function rZ(){return{result:Fy.create(),closeUnitsResult:Fc.create(),unitGroupResult:Fc.create()}}!function(e){e.create=function t(r,n,a){return new e(r,n,a)}}(qN||(qN={})),function(e){e.Default={assemblies:[],spacegroup:xu.ZeroP1,isNonStandardCrystalFrame:!1},e.findAssembly=function t(n,a){var i=a.toLocaleLowerCase(),o=ei.Provider.get(n);return o?sN(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0},e.getUnitcellLabel=function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,c=i.anglesInRadians,l=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),p=Ju(c[0]).toFixed(2),h=Ju(c[1]).toFixed(2),m=Ju(c[2]).toFixed(2),v=[];return v.push("Unit Cell <b>".concat(o,"</b> #").concat(s)),v.push("".concat(l,"\xd7").concat(d,"\xd7").concat(f," \u212b")),v.push("\u03b1=".concat(p,"\xb0 \u03b2=").concat(h,"\xb0 \u03b3=").concat(m,"\xb0")),v.join(" | ")}}(B2||(B2={})),function(e){e.Descriptor={name:"model_symmetry"},e.Provider=jl.create(e.Descriptor),e.fromData=function t(n){var a=function GRe(e,t,r){if(!e._rowCount)return[];for(var n=function qRe(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=S(),s=0,u=e._rowCount;s<u;s++){var c=Cr.toMat4(me(),a.matrix.space,r.value(s));Cr.toVec3(o,a.vector.space,n.value(s)),me.setTranslation(c,o),me.setValue(c,3,3,1),i.set(t.value(s),c)}return i}(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=HRe(e,t,i,n);return a}(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=function QRe(e,t){if(0===e._rowCount||0===t._rowCount)return xu.ZeroP1;var r=t.length_a.value(0),n=t.length_b.value(0),a=t.length_c.value(0);if(0===r||0===n||0===a)return xu.ZeroP1;var i=t.angle_alpha.value(0),o=t.angle_beta.value(0),s=t.angle_gamma.value(0);if(0===i||0===o||0===s)return xu.ZeroP1;var u=function ZRe(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}(e),c=gs.create(u,S.create(r,n,a),S.scale(S(),S.create(i,o,s),Math.PI/180));return xu.create(c)}(n.symmetry,n.cell);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:!1,ncsOperators:$Re(n.struct_ncs_oper)}},e.fromCell=function r(n,a){var i=gs.create("P 1",n,a);return{assemblies:[],spacegroup:xu.create(i),isNonStandardCrystalFrame:!1}}}(ei||(ei={})),function(e){var G,f,p;function u(G){for(var U=[],Q=0,W=G.length;Q<W;Q++)U.push(G[Q].id);return vs(U)}function c(G){var U={};return{elements:G[0].elements,units:G,get unitIndexMap(){return U.unitIndexMap||(U.unitIndexMap=function s(G){for(var U=Oc.Mutable(),Q=0,W=G.length;Q<W;Q++)U.set(G[Q].id,Q);return U}(G)),U.unitIndexMap},hashCode:d(G[0]),transformHash:u(G)}}function d(G){return Dv(G.invariantId,Xe.hashCode(G.elements))}(G=e.Kinds||(e.Kinds={}))[G.Atomic=0]="Atomic",G[G.Spheres=1]="Spheres",G[G.Gaussians=2]="Gaussians",e.isAtomic=function r(G){return 0===G.kind},e.isCoarse=function n(G){return 1===G.kind||2===G.kind},e.isSpheres=function a(G){return 1===G.kind},e.isGaussians=function i(G){return 2===G.kind},e.create=function o(G,U,Q,W,K,ne,X,L,Y){switch(K){case 0:return new g(G,U,Q,W,ne,L,sa.createMapping(X,ne.atomicConformation),Y??{});case 1:return T(G,U,Q,W,ne,1,L,sa.createMapping(X,ne.coarseConformation.spheres,function m(G){var U=G.coarseConformation.spheres.radius;return function(Q){return U[Q]}}(ne)),Y??{});case 2:return T(G,U,Q,W,ne,2,L,sa.createMapping(X,ne.coarseConformation.gaussians,function(U){return 0}),Y??{})}},e.SymmetryGroup=c,function(G){G.areInvariantElementsEqual=function U(W,K){return W.hashCode===K.hashCode&&Xe.areEqual(W.elements,K.elements)},G.getUnitSymmetryGroupsIndexMap=function Q(W){for(var K=Oc.Mutable(),ne=0,X=W.length;ne<X;++ne)for(var L=W[ne],Y=0,$=L.units.length;Y<$;++Y)K.set(L.units[Y].id,ne);return K}}(c=e.SymmetryGroup||(e.SymmetryGroup={})),e.conformationId=function l(G){return e.isAtomic(G)?G.model.atomicConformation.id:G.model.coarseConformation.id},e.hashUnit=d,function(G){G[G.None=0]="None",G[G.MultiChain=1]="MultiChain",G[G.Partitioned=2]="Partitioned",G[G.FastBoundary=4]="FastBoundary"}(f=e.Trait||(e.Trait={})),function(G){G.is=rs.has,G.create=rs.create}(p=e.Traits||(e.Traits={}));var g=function(){function G(U,Q,W,K,ne,X,L,Y){this.kind=0,this.objectPrimitive="atomistic",this.id=U,this.invariantId=Q,this.chainGroupId=W,this.traits=K,this.model=ne,this.elements=X,this.conformation=L,this.residueIndex=ne.atomicHierarchy.residueAtomSegments.index,this.chainIndex=ne.atomicHierarchy.chainAtomSegments.index,this.props=Y}return G.prototype.getChild=function(U){return U.length===this.elements.length?this:new G(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,U,this.conformation,{})},G.prototype.applyOperator=function(U,Q,W){void 0===W&&(W=!1);var K=W?Q:sa.compose(this.conformation.operator,Q);return new G(U,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,sa.createMapping(K,this.model.atomicConformation,this.conformation.r),this.props)},G.prototype.remapModel=function(U,Q,W){var K,ne;W||(W=R(R({},this.props),{bonds:!Q||null!==(ne=null===(K=this.props.bonds)||void 0===K?void 0:K.props)&&void 0!==ne&&ne.canRemap?M(this,this.props.bonds,U,Q):void 0}),e.isSameConformation(this,U)||(W.boundary=void 0,W.lookup3d=void 0,W.principalAxes=void 0));var X=this.conformation.operator,L=ei.Provider.get(U);if(-1!==X.spgrOp&&L&&L!==ei.Provider.get(this.model)){var Y=X.hkl,$=Y[0],Z=Y[1],q=Y[2],z=L.spacegroup.cell.toFractional,te=S.transformMat4(S(),ir.getCenter(U),z);X=xu.getSymmetryOperatorRef(L.spacegroup,X.spgrOp,$,Z,q,te)}var ae=this.model.atomicConformation!==U.atomicConformation||X!==this.conformation.operator?sa.createMapping(X,U.atomicConformation):this.conformation;return new G(this.id,this.invariantId,this.chainGroupId,this.traits,U,this.elements,ae,W)},Object.defineProperty(G.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var U=this.model.atomicConformation,Q=U.x,W=U.y,K=U.z;return this.props.boundary=p.is(this.traits,f.FastBoundary)?jN({x:Q,y:W,z:K,indices:this.elements}):up({x:Q,y:W,z:K,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var U=this.model.atomicConformation;return this.props.lookup3d=tp({x:U.x,y:U.y,z:U.z,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"principalAxes",{get:function(){return this.props.principalAxes||(this.props.principalAxes=ZK(this)),this.props.principalAxes},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var U=zRe.get(this.model),Q=U.get(this.elements);return Q||(Q=function tRe(e,t){var r=R(R({},SK),t);return r.noCompute||ir.isCoarseGrained(e.model)&&!Lo.Provider.get(e.model)&&!ic.isExhaustive(e.model)?PN.Empty:!r.forceCompute&&Lo.Provider.get(e.model)?function JMe(e){for(var t=Lo.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.maxDistance,o=t.bonds,s=o.offset,u=o.b,c=o.edgeProps,l=c.order,d=c.distance,f=c.flag,p=c.key,h=c.operatorA,m=c.operatorB,v=e.model.atomicHierarchy.atomSourceIndex,g=ir.getInvertedAtomSourceIndex(e.model).invertedIndex,y=[],b=[],_=[],C=[],x=[],A=e.conformation.operator.key,T=0;T<a;T++)for(var w=r[T],E=Ud(n.value(w)),I=op(E),M=v.value(w),F=s[M],N=s[M+1];F<N;++F){var j=g[u[F]];if(!(w>=j)){var k=Xe.indexOf(e.elements,j);if(!(k<0)){var H=h[F],G=m[F];if(!(H>=0&&H!==A||G>=0&&G!==A)){var U=Ud(n.value(j)),Q=d[F],W=QMe(e,w,j),K=!1;Q>=0?K=ia(W,Q,.3):i>=0?K=W<i:(K=W<hT(E,U,jh(E),jh(U)),I&&op(U)&&(K=!1)),K&&(y[y.length]=T,b[b.length]=k,C[C.length]=l[F],_[_.length]=f[F],x[x.length]=p[F])}}}}return NK(y,b,C,_,x,a,!1)}(e):function eRe(e,t){for(var r=t.maxRadius,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,c=e.residueIndex,l=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,p=d.label_atom_id,h=d.label_alt_id,m=d.label_comp_id,v=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,_=ic.Provider.get(e.model),C=Bv.Provider.get(e.model),x=ic.isExhaustive(e.model),A=[],T=[],w=[],E=[],I=[],M=-1,F=void 0,N=!0,j=!0,k=!0,H=$Me,G=0;G<s;G++){var U=u[G],Q=f.value(U);N&&"H"!==Q&&"O"!==Q&&(N=!1);var W=t.forceCompute?void 0:_&&_.byAtomIndex.get(U),K=!1;if(W)for(var ne=0,X=W;ne<X.length;ne++){var L=X[ne],Y=L.partnerA,$=L.partnerB;Y.symmetry===$.symmetry&&((q=Xe.indexOf(e.elements,(Y.atomIndex===U?$:Y).atomIndex))<0||u[q]<U||(A[A.length]=G,T[T.length]=q,w[w.length]=L.flags,E[E.length]=L.order,I[I.length]=L.rowIndex,K||H.clear(),K=!0,H.add(q)))}if(!x){var z=c[U],te=v.value(z),ae=m.value(U);if(!t.forceCompute&&z!==M)if(C&&C.entries.has(ae)){var fe=y[g.getEntityFromChain(l[U])];F=fe&&fe.sequence.microHet.has(te)?void 0:C.entries.get(ae).map}else F=void 0;M=z;for(var he=Ud(Q),pe=p.value(U),re=F?F.get(pe):void 0,ee=b.find(a[U],i[U],o[U],r),ue=ee.indices,ge=ee.count,Ce=ee.squaredDistances,ze=op(he),je=jh(he),V=h.value(U),J=F2.has(he),ye=0;ye<ge;ye++){var q=ue[ye];if(!K||!H.has(q)){var we=u[q];if(!(we<=U)){var Ee=h.value(we);if(!V||!Ee||V===Ee){var Fe=Ud(f.value(we)),ke=op(Fe);if(!ze||!ke){var Ue=(J||F2.has(Fe))&&!(ze||ke),$e=c[we];if(z===$e&&re){var Pe=re.get(p.value(we));if(Pe){A[A.length]=G,T[T.length]=q,E[E.length]=Pe.order;var He=Pe.flags;Ue&&(1|He&&(He^=1),He|=2),w[w.length]=He,I[I.length]=Pe.key}continue}var Je=Math.sqrt(Ce[ye]);if(0!==Je&&Je<=hT(he,Fe,je,jh(Fe))){A[A.length]=G,T[T.length]=q,E[E.length]=tMe(ae,pe,p.value(we)),w[w.length]=32|(Ue?2:1),I[I.length]=-1;var ut=v.value($e);te===ut&&(j=!1),Math.abs(te-ut)>1&&(k=!1)}}}}}}}}return NK(A,T,E,w,I,s,N||j&&k)}(e,r)}(this),U.set(this.elements,Q)),this.props.bonds=Q,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"rings",{get:function(){return this.props.rings||(this.props.rings=ST.create(this)),this.props.rings},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"resonance",{get:function(){return this.props.resonance||(this.props.resonance=function JRe(e){return{delocalizedTriplets:eOe(e)}}(this)),this.props.resonance},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"polymerElements",{get:function(){return this.props.polymerElements||(this.props.polymerElements=function ARe(e){for(var t=[],r=e.elements,a=e.model.atomicHierarchy.residueAtomSegments,i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=wn.transientSegments(e.model.atomicRanges.polymerRanges,r),s=tr.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var c=s.move(),f=c.index;if(Be.areIntersecting(xe.ofRange(r[c.start],r[c.end-1]),r)){var p=i[f];t.push(-1===p?a.offsets[f]:p)}}}return Xe.ofSortedArray(t)}(this)),this.props.polymerElements},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"gapElements",{get:function(){return this.props.gapElements||(this.props.gapElements=function DRe(e){for(var t=[],r=e.elements,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=wn.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),c=a[r[u.start]],l=a[r[u.end-1]],d=o[c],f=o[l];t.push(-1===d?i.offsets[c]:d),t.push(-1===f?i.offsets[l]:f)}return Xe.ofSortedArray(t)}(this)),this.props.gapElements},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements||(this.props.nucleotideElements=function IRe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,c=s.traceElementIndex,l=tr.transientSegments(a.chainAtomSegments,r),d=tr.transientSegments(o,r);l.hasNext;)for(d.setSegment(l.move());d.hasNext;){var f=d.move().index;if(Zs(u[f])){var p=c[f];t.push(-1===p?o.offsets[f]:p)}}return Xe.ofSortedArray(t)}(this)),this.props.nucleotideElements},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"proteinElements",{get:function(){return this.props.proteinElements||(this.props.proteinElements=function PRe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,c=s.traceElementIndex,l=tr.transientSegments(a.chainAtomSegments,r),d=tr.transientSegments(o,r);l.hasNext;)for(d.setSegment(l.move());d.hasNext;){var f=d.move().index;if(bK(u[f])){var p=c[f];t.push(-1===p?o.offsets[f]:p)}}return Xe.ofSortedArray(t)}(this)),this.props.proteinElements},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"residueCount",{get:function(){if(void 0!==this.props.residueCount)return this.props.residueCount;for(var U=0,Q=tr.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);Q.hasNext;)Q.move(),U+=1;return this.props.residueCount=U,this.props.residueCount},enumerable:!1,configurable:!0}),G.prototype.getResidueIndex=function(U){return this.residueIndex[this.elements[U]]},G}();e.Atomic=g;var b=function(){function G(U,Q,W,K,ne,X,L,Y,$){this.kind=X,this.objectPrimitive=1===X?"sphere":"gaussian",this.id=U,this.invariantId=Q,this.chainGroupId=W,this.traits=K,this.model=ne,this.elements=L,this.conformation=Y,this.coarseElements=1===X?ne.coarseHierarchy.spheres:ne.coarseHierarchy.gaussians,this.coarseConformation=1===X?ne.coarseConformation.spheres:ne.coarseConformation.gaussians,this.props=$}return G.prototype.getChild=function(U){return U.length===this.elements.length?this:T(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,U,this.conformation,{})},G.prototype.applyOperator=function(U,Q,W){void 0===W&&(W=!1);var K=W?Q:sa.compose(this.conformation.operator,Q);return T(U,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,sa.createMapping(K,this.getCoarseConformation(),this.conformation.r),this.props)},G.prototype.remapModel=function(U,Q,W){var K=this.getCoarseConformation(),ne=_(this.kind,U);W||(W=R({},this.props),e.isSameConformation(this,U)||(W.boundary=void 0,W.lookup3d=void 0,W.principalAxes=void 0));var X=K!==ne?sa.createMapping(this.conformation.operator,ne):this.conformation;return new G(this.id,this.invariantId,this.chainGroupId,this.traits,U,this.kind,this.elements,X,W)},Object.defineProperty(G.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var U=this.getCoarseConformation(),Q=U.x,W=U.y,K=U.z;return this.props.boundary=p.is(this.traits,f.FastBoundary)?jN({x:Q,y:W,z:K,indices:this.elements}):up({x:Q,y:W,z:K,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var U=this.getCoarseConformation();return this.props.lookup3d=tp({x:U.x,y:U.y,z:U.z,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"principalAxes",{get:function(){return this.props.principalAxes||(this.props.principalAxes=ZK(this)),this.props.principalAxes},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"polymerElements",{get:function(){return this.props.polymerElements||(this.props.polymerElements=function TRe(e){for(var t=[],r=e.elements,a=e.model.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Oe.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=wn.transientSegments(s,r);u.hasNext;)for(var c=u.move(),d=c.end,f=c.start;f<d;++f)t.push(r[f]);return Xe.ofSortedArray(t)}(this)),this.props.polymerElements},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"gapElements",{get:function(){return this.props.gapElements||(this.props.gapElements=function ERe(e){for(var t=[],r=e.elements,a=e.model.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Oe.isSpheres(e)?i.gapRanges:o.gapRanges,u=wn.transientSegments(s,r);u.hasNext;){var c=u.move();t.push(r[c.start],r[c.end-1])}return Xe.ofSortedArray(t)}(this)),this.props.gapElements},enumerable:!1,configurable:!0}),G.prototype.getCoarseConformation=function(){return _(this.kind,this.model)},G}();function _(G,U){return 1===G?U.coarseConformation.spheres:U.coarseConformation.gaussians}var x=function(G){function U(){return null!==G&&G.apply(this,arguments)||this}return qt(U,G),U}(b);e.Spheres=x;var A=function(G){function U(){return null!==G&&G.apply(this,arguments)||this}return qt(U,G),U}(b);function T(G,U,Q,W,K,ne,X,L,Y){return new b(G,U,Q,W,K,ne,X,L,Y)}function M(G,U,Q,W){var K;if(U){if(G.model.atomicConformation.id===Q.atomicConformation.id)return U;var ne=Lo.Provider.get(G.model);if(ne){var X=Lo.Provider.get(Q);return X&&ne!==X?void 0:U}return null!==(K=U.props)&&void 0!==K&&K.canRemap||!W||F(G,Q)?U:void 0}}function F(G,U){var Q=ir.CoordinatesHistory.get(ir.getRoot(U));if(Q)return Q.areEqual(G.elements,G.kind,U);for(var W=G.elements,K=G.conformation.coordinates,ne=K.x,X=K.y,L=K.z,Y=N(G.kind,U),$=Y.x,Z=Y.y,q=Y.z,z=0,te=W.length;z<te;z++){var ae=W[z];if(ne[ae]!==$[ae]||X[ae]!==Z[ae]||L[ae]!==q[ae])return!1}return!0}function N(G,U){return 0===G?U.atomicConformation:1===G?U.coarseConformation.spheres:U.coarseConformation.gaussians}function k(G,U){return 0===G?U.atomicHierarchy:1===G?U.coarseHierarchy.spheres:U.coarseHierarchy.gaussians}e.Gaussians=A,e.areSameChainOperatorGroup=function w(G,U){return G.chainGroupId===U.chainGroupId&&G.conformation.operator.name===U.conformation.operator.name},e.areOperatorsEqual=function E(G,U){return me.areEqual(G.conformation.operator.matrix,U.conformation.operator.matrix,1e-6)},e.areConformationsEqual=function I(G,U){return G===U||!!Xe.areEqual(G.elements,U.elements)&&F(G,U.model)},e.isSameConformation=F,e.getModelConformationOfKind=N,e.getConformation=function j(G){return N(G.kind,G.model)},e.getModelHierarchyOfKind=k,e.getHierarchy=function H(G){return k(G.kind,G.model)}}(Oe||(Oe={})),function(e){e.add=function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++},e.create=function r(){return{count:0,indices:[],units:[],squaredDistances:[]}},e.copy=function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}}(Fy||(Fy={}));var mt,en,tOe=function(){function e(t){this.structure=t,this.pivot=S(),this.heap=new jX,this.findContext=rZ();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),c=S(),l=0;l<a;l++){var d=r[l],f=d.boundary.sphere;S.transformMat4(c,f.center,d.conformation.operator.matrix),i[l]=c[0],o[l]=c[1],s[l]=c[2],u[l]=f.radius}var p={x:i,y:o,z:s,radius:u,indices:Be.ofBounds(0,a)};this.unitLookup=tp(p,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i??this.findContext)},e.prototype._find=function(t,r,n,a,i){Fc.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(0===s.count)return i.result;for(var u=0,c=s.count;u<c;u++){var l=o[s.indices[u]];S.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);for(var f=l.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),p=0,h=f.count;p<h;p++)Fy.add(i.result,l,f.indices[p],f.squaredDistances[p])}return i.result},e.prototype.nearest=function(t,r,n,a,i){return void 0===a&&(a=1),this._nearest(t,r,n,a,i??this.findContext)},e.prototype._nearest=function(t,r,n,a,i){var o=i.result,s=this.heap;Fc.reset(o),s.clear();var u=this.structure.units,c=0,l=this.unitLookup.nearest(t,r,n,u.length,function(E){return(c+=u[E].elements.length)>=a},i.closeUnitsResult);if(0===l.count)return o;for(var d=0,f=-Number.MAX_VALUE,p=0,h=l.count;p<h&&!(d>=a&&f<l.squaredDistances[p]);p++){S.set(this.pivot,t,r,n),(v=u[l.indices[p]]).conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,v.conformation.operator.inverse);var y=v.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],a,void 0,i.unitGroupResult);if(0!==y.count){d+=y.count,f=Math.max(f,y.squaredDistances[y.count-1]);for(var b=0,_=y.count;b<_;b++)s.insert(y.squaredDistances[b],{index:y.indices[b],unit:v})}}if(1===a){if(C=s.findMinimum()){var A=C.value;Fy.add(o,v=A.unit,A.index,C.key)}}else for(;!s.isEmpty()&&o.count<a;){var C,v,w=(C=s.extractMinimum()).value;Fy.add(o,v=w.unit,w.index,C.key)}return o},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(0!==s.count)for(var u=0,c=s.count;u<c;u++){var l=o[s.indices[u]];S.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var f=l.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(0!==f.count){var p=l.elements;i.beginUnit(l.id);for(var h=0,m=f.count;h<m;h++)i.addElement(p[f.indices[h]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(0!==u.count)for(var c=at.create(this.structure),l=0,d=u.count;l<d;l++){var f=s[u.indices[l]];S.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var h=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(0!==h.count){var m=f.elements;c.unit=f,i.beginUnit(f.id);for(var v=0,g=h.count;v<g;v++)c.element=m[h.indices[v]],o(c)&&i.addElement(c.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var c=this.structure.units,l=this.unitLookup.find(t,r,n,o);if(0!==l.count)for(var d=at.create(this.structure),f=a+i+o,p=0,h=l.count;p<h;p++){var m=c[l.indices[p]];S.set(this.pivot,t,r,n),m.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,m.conformation.operator.inverse);var g=m.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(0!==g.count){var y=m.elements;d.unit=m,u.beginUnit(m.id);for(var b=0,_=g.count;b<_;b++){d.element=y[g.indices[b]];var C=s(d);Math.sqrt(g.squaredDistances[b])-a-C>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(0===o.count)return!1;for(var s=0,u=o.count;s<u;s++){var c=i[o.indices[s]];if(S.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse),c.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function L2(e,t){if(0===t.length)return Ye.Empty;if(1===t.length)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var c=o[s];if(r.has(c.id)){if(n.has(c.id))continue;var l=Xe.union(r.get(c.id),c.elements);r.set(c.id,l),l.length===e.unitMap.get(c.id).elements.length&&n.add(c.id)}else r.set(c.id,c.elements),c.elements.length===e.unitMap.get(c.id).elements.length&&n.add(c.id)}var d=e.subsetBuilder(!0);return r.forEach(rOe,d),d.getStructure()}function rOe(e,t){this.setUnit(t,e)}function nOe(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Xe.areEqual(o.elements,s.elements))return!1}return!0}function wT(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(i.has(u.id)){var c=i.get(u.id);if(Xe.areIntersecting(u.elements,c.elements))return!0}}return!1}function nZ(e,t){if(e===t)return e;if(!wT(e,t))return Ye.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var c=a[s];if(i.has(c.id)){var l=i.get(c.id);if(Xe.areIntersecting(c.elements,l.elements)){var d=Xe.intersect(c.elements,l.elements);o[o.length]=c.getChild(d)}}}return Ye.create(o,{parent:e.parent||t.parent})}function WN(e,t){if(e===t)return Ye.Empty;if(!wT(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(n.has(s.id)){var u=n.get(s.id),c=Xe.subtract(s.elements,u.elements);c.length>0&&(a[a.length]=s.getChild(c))}else a[a.length]=s}return Ye.create(a,{parent:e.parent||t.parent})}function YN(e){return Gr.isCovalent(e.atomicBond.type)}function aOe(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(0===s.kind){n.unit=s;var u=s.elements;if(n.element=u[0],"polymer"===it.entity.type(n)){for(var c=tr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),l=0;c.hasNext;)l++,c.move();l<8||a.push(s)}}}return mt.Singletons(r,Ye.create(a,{parent:r}))}}function iOe(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];0===s.kind&&(n.unit=s,n.element=s.elements[0],"water"===it.entity.type(n)&&a.push(s))}return mt.Singletons(r,Ye.create(a,{parent:r}))}}function oOe(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(0===s.kind){n.unit=s;var u=s.elements;if(n.element=u[0],"water"!==it.entity.type(n)){if("polymer"===it.entity.type(n)){for(var c=tr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),l=0;c.hasNext;)l++,c.move();if(l>=8)continue}a.push(s)}}}return mt.Singletons(r,Ye.create(a,{parent:r}))}}function sOe(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];1===o.kind&&n.push(o)}return mt.Singletons(r,Ye.create(n,{parent:r}))}}function aZ(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function iZ(e){return function(r){return mt.Sequence(r.inputStructure,[en.toStructure({hash:r.inputStructure.hashCode,elements:e},r.inputStructure)])}}!function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}function r(g,y){return{kind:"sequence",source:g,structures:y}}function n(g){return t(g,Ye.Empty)}function a(g){return"singletons"===g.kind}function i(g){return a(g)?0===g.structure.units.length:0===g.structures.length}function s(g){return i(g)?Ye.Empty:a(g)?g.structure:L2(g.source,g.structures)}function l(g,y,b){return 0===y.length?n(g):b?t(g,L2(g,y)):r(g,y)}e.Singletons=t,e.Sequence=r,e.Empty=n,e.isSingleton=a,e.isEmpty=i,e.structureCount=function o(g){return a(g)?g.structure.elementCount:g.structures.length},e.unionStructure=s,e.toLociWithCurrentUnits=function u(g){for(var y=[],b=g.source.unitMap,_=0,C=s(g).units;_<C.length;_++){var x=C[_];y[y.length]=x===b.get(x.id)?{unit:x,indices:Be.ofBounds(0,x.elements.length)}:{unit:x,indices:Be.ofSortedArray(Xe.indicesOf(b.get(x.id).elements,x.elements))}}return Re(g.source,y)},e.toLociWithSourceUnits=function c(g){for(var y=[],b=g.source.unitMap,_=0,C=s(g).units;_<C.length;_++){var x=C[_],A=b.get(x.id);y[y.length]=A===x?{unit:A,indices:Be.ofBounds(0,A.elements.length)}:{unit:A,indices:Be.ofSortedArray(Xe.indicesOf(A.elements,x.elements))}}return Re(g.source,y)};var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;0!==b&&(this.structures[this.structures.length]=y,1!==b&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return l(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=CN(Ye.hashCode,Ye.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;0===b||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,1!==b&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return l(this.structure,this.structures,this.allSingletons)},g}();e.LinearBuilder=function p(g){return new d(g)},e.UniqueBuilder=function h(g){return new f(g)},e.forEach=function m(g,y){var b=0;if(e.isSingleton(g))for(var _=0,C=g.structure.units;_<C.length;_++)for(var x=C[_],A=x.elements,T=0,w=A.length;T<w;T++)y(Ye.create([x.getChild(Xe.ofSingleton(A[T]))],{parent:g.source}),b++);else for(var I=0,M=g.structures;I<M.length;I++)y(M[I],b++)},e.withInputStructure=function v(g,y){return a(g)?t(y,g.structure):r(y,g.structures)}}(mt||(mt={})),function(e){function n(l){for(var d=[],f=0,p=l.elements;f<p.length;f++){var m=(h=p[f]).unit,v=h.indices;if(0!==Be.size(v)){var g=[],y=[];if(Be.isInterval(v))1===Be.size(v)?y.push(xe.min(v)):g.push(xe.min(v),xe.max(v));else for(var b=0,_=v.length;b<_;){var C=b;for(b++;b<_&&v[b-1]+1===v[b];)b++;var x=b;if(x-C>2)g.push(v[C],v[x-1]);else for(var A=C;A<x;A++)y[y.length]=v[A]}d.push({unit:m,set:Xe.ofSortedArray(y),ranges:wn.ofSortedRanges(g)})}}for(var T=new Map,w=(b=0,d.length);b<w;++b){var h,I,E=Dv(vs((h=d[b]).ranges),vs(h.set));T.has(E)?(I=T.get(E).groupedUnits).has(h.unit.invariantId)?I.get(h.unit.invariantId).push(h.unit.id):I.set(h.unit.invariantId,[h.unit.id]):((I=new Map).set(h.unit.invariantId,[h.unit.id]),T.set(E,{groupedUnits:I,set:h.set,ranges:h.ranges}))}var M=[];return T.forEach(function(F){var N=[];F.groupedUnits.forEach(function(j){return N.push(Xe.ofUnsortedArray(j))}),N.sort(function(j,k){return j[0]-k[0]}),M.push({groupedUnits:N,set:F.set,ranges:F.ranges})}),{hash:l.structure.hashCode,elements:M}}function a(l,d){for(var f=[],p=0,h=l.length;p<h;++p){var m=l[p];d.unitMap.has(m)&&f.push(d.unitMap.get(m))}return f}function s(l){return de.internal.generator.bundleElement({groupedUnits:de.core.type.list(l.groupedUnits.map(function(d){return de.core.type.list(d)})),ranges:de.core.type.list(l.ranges),set:de.core.type.list(l.set)})}e.Empty={hash:-1,elements:[]},e.fromSubStructure=function t(l,d){return n(mt.toLociWithSourceUnits(mt.Singletons(l,d)))},e.fromSelection=function r(l){return n(mt.toLociWithSourceUnits(l))},e.fromLoci=n,e.toLoci=function i(l,d){-1!==l.hash&&l.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");for(var f=[],p=0,h=l.elements;p<h.length;p++)for(var m=h[p],v=function(_){var C=a(_,d);if(0===C.length)return"continue";var x=void 0;if(0===m.ranges.length)x=m.set;else if(0===m.set.length)if(2===m.ranges.length)x=xe.ofRange(m.ranges[0],m.ranges[1]);else{var A=new Int32Array(wn.size(m.ranges));wn.forEach(m.ranges,function(F,N){return A[N]=F}),x=Xe.ofSortedArray(A)}else{var T=wn.size(m.ranges),w=new Int32Array(m.set.length+T);wn.forEach(m.ranges,function(F,N){return w[N]=F}),w.set(m.set,T),x=Xe.ofUnsortedArray(w)}for(var E=0,I=C;E<I.length;E++)f.push({unit:I[E],indices:x})},g=0,y=m.groupedUnits;g<y.length;g++)v(y[g]);return Re(d,f)},e.toStructure=function o(l,d){-1!==l.hash&&l.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");for(var f=[],p=0,h=l.elements;p<h.length;p++)for(var m=h[p],v=function(_){var C=a(_,d);if(0===C.length)return"continue";var x=C[0].elements,A=wn.size(m.ranges),T=m.set.length,w=new Int32Array(T+A),E=void 0;if(0===A){for(var I=0,M=T;I<M;++I)w[I]=x[m.set[I]];E=Xe.ofSortedArray(w)}else if(0===T)wn.forEach(m.ranges,function(k,H){return w[H]=x[k]}),E=Xe.ofSortedArray(w);else if(Xe.min(m.set)>wn.max(m.ranges)){for(wn.forEach(m.ranges,function(k,H){return w[H]=x[k]}),I=0,M=T;I<M;++I)w[I+A]=x[m.set[I]];E=Xe.ofSortedArray(w)}else if(wn.min(m.ranges)>Xe.max(m.set)){for(I=0,M=T;I<M;++I)w[I]=x[m.set[I]];wn.forEach(m.ranges,function(k,H){return w[H+T]=x[k]}),E=Xe.ofSortedArray(w)}else{for(wn.forEach(m.ranges,function(k,H){return w[H]=x[k]}),I=0,M=T;I<M;++I)w[I+A]=x[m.set[I]];E=Xe.ofUnsortedArray(w)}for(var F=0,N=C;F<N.length;F++)f.push(N[F].getChild(E))},g=0,y=m.groupedUnits;g<y.length;g++)v(y[g]);return Ye.create(f,{parent:d})},e.toExpression=function u(l){return de.internal.generator.bundle({elements:de.core.type.list(l.elements.map(s))})},e.areEqual=function c(l,d){if(l.elements.length!==d.elements.length)return!1;for(var f=0,p=l.elements.length;f<p;++f){var h=l.elements[f],m=d.elements[f];if(h.groupedUnits.length!==m.groupedUnits.length)return!1;for(var v=0,g=m.groupedUnits.length;v<g;++v)if(!Xe.areEqual(h.groupedUnits[v],m.groupedUnits[v]))return!1;if(!Xe.areEqual(h.set,m.set)||!wn.areEqual(h.ranges,m.ranges))return!1}return!0}}(en||(en={}));var sZ,Uc=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=da(),this.element=at.create(void 0),this.currentStructure=void 0,this.atomicBond=new oZ,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=at.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new oZ,this.atomicBond},e.prototype.popCurrentBond=function(){this.atomicBond=this.currentAtomicBondStack.length>0?this.currentAtomicBondStack.pop():void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructure=this.currentStructureStack.length?this.currentStructureStack.pop():void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(0===this.inputStructureStack.length)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(0!==this.timeoutMs&&da()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> ".concat(this.timeoutMs/1e3,"s)."))},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),oZ=function(){function e(){this.a=at.create(void 0),this.aIndex=0,this.b=at.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.key=-1,this.testFn=YN}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||YN},e.prototype.test=function(t,r){return!!this.testFn(t)||!!r&&(this.swap(),this.testFn(t))},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return at.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}();!function(e){e.run=function t(r,n,a){return r(new Uc(n,a))}}(sZ||(sZ={}));var XN=function(){function e(t){this.source=t,this.set=CN(Ye.hashCode,Ye.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){t.elementCount&&(1!==t.elementCount&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?mt.Singletons(this.source,L2(this.source,this.structures)):mt.Sequence(this.source,this.structures)},e}(),uOe=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=at.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return mt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return mt.Sequence(this.source,t)},e.prototype.getSelection=function(){return 0===this.builders.length?mt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),KN=function(e){return mt.Sequence(e.inputStructure,[])},uZ=function(e){return mt.Singletons(e.inputStructure,e.inputStructure)};function cOe(e){return ZN(R(R({},e),{groupBy:function(t){return it.residue.key(t.element)}}))}function lOe(e){return ZN(R(R({},e),{groupBy:function(t){return it.chain.key(t.element)}}))}function Xh(e){return!0}function dOe(e){return 0}function ZN(e){if(!e||!(e.atomTest||e.residueTest||e.chainTest||e.entityTest||e.unitTest||e.groupBy))return uZ;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return function fOe(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var c=u[s];i.unit=c;var l=c.elements;o.beginUnit(c.id);for(var d=0,f=l.length;d<f;d++)i.element=l[d],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),mt.Singletons(n,o.getStructure())}}(e.atomTest);var t={unitTest:e.unitTest||Xh,entityTest:e.entityTest||Xh,chainTest:e.chainTest||Xh,residueTest:e.residueTest||Xh,atomTest:e.atomTest||Xh,groupBy:e.groupBy||dOe};return e.groupBy?function hOe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var c=u.inputStructure,l=c.units,d=u.pushCurrentElement(),f=new uOe(c);d.structure=c;for(var p=0,h=l;p<h.length;p++){var m=h[p];if(d.unit=m,t(u)){var v=m.elements,g=m.model;if(0===m.kind)for(var y=tr.transientSegments(g.atomicHierarchy.chainAtomSegments,v),b=tr.transientSegments(g.atomicHierarchy.residueAtomSegments,v);y.hasNext;){var _=y.move();if(d.element=v[_.start],r(u)&&n(u))for(b.setSegment(_);b.hasNext;){var C=b.move();if(d.element=v[C.start],a(u))for(var x=C.start,A=C.end;x<A;x++)d.element=v[x],i(u)&&f.add(o(u),m.id,d.element)}}else for(y=tr.transientSegments(g.coarseHierarchy.spheres.chainElementSegments,v);y.hasNext;)if(_=y.move(),d.element=v[_.start],r(u)&&n(u))for(x=_.start,A=_.end;x<A;x++)d.element=v[x],a(u)&&f.add(o(u),m.id,d.element);u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}(t):function pOe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,c=u.units,l=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=a===Xh&&i===Xh,p=i===Xh;l.structure=u;for(var h=0,m=c;h<m.length;h++){var v=m[h];if(l.unit=v,t(s)){var g=v.elements,y=v.model;if(d.beginUnit(v.id),0===v.kind)for(var b=tr.transientSegments(v.model.atomicHierarchy.chainAtomSegments,g),_=tr.transientSegments(v.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var C=b.move();if(l.element=g[C.start],r(s)&&n(s)){if(f){d.addElementRange(g,C.start,C.end);continue}for(_.setSegment(C);_.hasNext;){var x=_.move();if(l.element=g[x.start],a(s)){if(p){d.addElementRange(g,x.start,x.end);continue}for(var A=x.start,T=x.end;A<T;A++)l.element=g[A],i(s)&&d.addElement(l.element)}}}}else for(b=tr.transientSegments(y.coarseHierarchy.spheres.chainElementSegments,g);b.hasNext;)if(C=b.move(),l.element=g[C.start],r(s)&&n(s)){if(f){d.addElementRange(g,C.start,C.end);continue}for(A=C.start,T=C.end;A<T;A++)l.element=g[A],a(s)&&d.addElement(l.element)}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),mt.Singletons(u,d.getStructure())}}(t)}function QN(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return Ye.create([e.getChild(Xe.ofSortedArray(n))],{parent:r})}function mOe(e,t){return function(n){var a=n.inputStructure.units,i=mt.LinearBuilder(n.inputStructure);if(e&&0!==e.length){for(var h=On.create(),m=0;m<e.length;m++)On.add(h,e[m],e[m]);for(var v=0,g=a;v<g.length;v++)if(Oe.isAtomic(u=g[v]))for(var y=u.rings,b=0,_=h.array;b<_.length;b++){var C=_[b];if(y.byFingerprint.has(C))for(var x=0,A=y.byFingerprint.get(C);x<A.length;x++)d=A[x],t&&!y.aromaticRings.includes(d)||i.add(QN(u,y.all[d],n.inputStructure))}}else for(var o=0,s=a;o<s.length;o++){var u;if(Oe.isAtomic(u=s[o]))if(t)for(var c=0,l=u.rings.aromaticRings;c<l.length;c++)i.add(QN(u,u.rings.all[d=l[c]],n.inputStructure));else for(var f=0,p=u.rings.all;f<p.length;f++){var d;i.add(QN(u,d=p[f],n.inputStructure))}}return i.getSelection()}}function vOe(e,t,r){return void 0===r&&(r=!1),function(a){var i=e(a);if(0===mt.structureCount(i))return i;var o=r?WN(a.inputStructure,mt.unionStructure(i)):mt.unionStructure(i);if(0===o.elementCount)return mt.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),mt.withInputStructure(s,a.inputStructure)}}function gOe(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=mt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var c=u[s];if(0===c.kind){var l=c.bonds,d=l.offset,f=l.b,p=l.edgeProps,h=p.flags,m=p.order,v=p.key;o.a.unit=c,o.b.unit=c;for(var g=0,y=c.elements.length;g<y;g++){o.aIndex=g,o.a.element=c.elements[g];for(var b=d[g],_=d[g+1];b<_;b++)o.bIndex=f[b],o.b.element=c.elements[f[b]],o.type=h[b],o.order=m[b],o.key=v[b],o.test(r,!1)&&((C=n.subsetBuilder(!1)).beginUnit(c.id),C.addElement(o.a.element),C.addElement(o.b.element),C.commitUnit(),i.add(C.getStructure()))}}}for(var x=0,A=a.edges;x<A.length;x++){var C,T=A[x];o.a.unit=n.unitMap.get(T.unitA),o.a.element=o.a.unit.elements[T.indexA],o.aIndex=T.indexA,o.b.unit=n.unitMap.get(T.unitB),o.b.element=o.b.unit.elements[T.indexB],o.bIndex=T.indexB,o.order=T.props.order,o.type=T.props.flag,o.key=T.props.key,o.test(r,!1)&&((C=n.subsetBuilder(!1)).addToUnit(o.a.unit.id,o.a.element),C.addToUnit(o.b.unit.id,o.b.element),i.add(C.getStructure()))}return r.popCurrentBond(),i.getSelection()}}var Ke,Nn,AT=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Oc.Mutable(),this.parentId=-1,this.currentUnit=On.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)On.add(n,r,r)&&this.elementCount++;else{var a=On.create();On.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return!!n&&On.has(n,r)},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.unitMap.has(t)?this.unitMap.get(t):this.currentUnit.array.length>0?On.create():this.currentUnit},e.prototype.addElement=function(t){On.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){0===this.currentUnit.array.length||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return Ye.Empty;var t=[];Rc(this.ids);for(var r=Hd.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array;if(s.length!==o.elements.length){s.length>1&&Rc(s);var c=o.getChild(Xe.ofSortedArray(s)),l=r.add(c.id,c);c!==l&&(c=l.applyOperator(c.id,c.conformation.operator,!0)),t[t.length]=c}else t[t.length]=o,r.add(o.id,o)}return Ye.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.elementCount},enumerable:!1,configurable:!0}),e}();function lt(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function cZ(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position}function lZ(e){return!(e.length-e.position<2||39!==e.data.charCodeAt(e.position+1)||39!==e.data.charCodeAt(e.position+2))}function IOe(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||46===e.data.charCodeAt(n+i)}function dZ(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t;return t}function fZ(e,t){return e.data.substring(e.tokenStart,t)}function $N(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function pZ(e){var t=function wOe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:13!==t&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}(e);if(e.position>=e.length)e.tokenType=6;else{e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:(function xOe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(10===t||13===t)return;++e.position}})(e),e.tokenType=5;break;case 39:if(lZ(e)){(function _Oe(e){for(e.position+=3;e.position<e.length;){if(39===e.data.charCodeAt(e.position)&&lZ(e))return e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,void(e.position+=3);++e.position}e.tokenEnd=e.position})(e),e.tokenType=3;break}case 34:(function bOe(e,t){var r,n;for(++e.position;e.position<e.length;)if((n=e.data.charCodeAt(e.position))===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;default:if(void 0===r)return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===n||13===n)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position})(e,r),e.tokenType=3;break;case 59:10===t||13===t?function SOe(e){for(var n,t=59,r=e.position+1;r<e.length;){if(59===(n=e.data.charCodeAt(r))&&(10===t||13===t)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);10===n||13===n;)r--,n=e.data.charCodeAt(r);return e.tokenEnd=r+1,void(e.isEscaped=!0)}(13===n||10===n&&13!==t)&&e.lineNumber++,t=n,++r}e.position=r}(e):cZ(e),e.tokenType=3;break;default:e.isImportGet?function COe(e){for(;e.position<e.length;){if(93===e.data.charCodeAt(e.position))return++e.position,e.tokenEnd=e.position,void(e.isImportGet=!1);++e.position}}(e):cZ(e),e.isEscaped?e.tokenType=3:95===e.data.charCodeAt(e.tokenStart)?(e.inSaveFrame&&function EOe(e){return!(e.tokenEnd-e.tokenStart!=11||105!==e.data.charCodeAt(e.tokenStart+1)||109!==e.data.charCodeAt(e.tokenStart+2)||112!==e.data.charCodeAt(e.tokenStart+3)||111!==e.data.charCodeAt(e.tokenStart+4)||114!==e.data.charCodeAt(e.tokenStart+5)||116!==e.data.charCodeAt(e.tokenStart+6)||46!==e.data.charCodeAt(e.tokenStart+7)||103!==e.data.charCodeAt(e.tokenStart+8)||101!==e.data.charCodeAt(e.tokenStart+9)||116!==e.data.charCodeAt(e.tokenStart+10))}(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenType=e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?function AOe(e){var t=e.data.charCodeAt(e.tokenStart);return!(68!==t&&100!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t)||(t=e.data.charCodeAt(e.tokenStart+2),84!==t&&116!==t)||(t=e.data.charCodeAt(e.tokenStart+3),65!==t&&97!==t))}(e)?0:function TOe(e){var t=e.data.charCodeAt(e.tokenStart);return!(83!==t&&115!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t)||(t=e.data.charCodeAt(e.tokenStart+2),86!==t&&118!==t)||(t=e.data.charCodeAt(e.tokenStart+3),69!==t&&101!==t))}(e)?1:function DOe(e){if(e.tokenEnd-e.tokenStart!=5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(76!==t&&108!==t||(t=e.data.charCodeAt(e.tokenStart+1),79!==t&&111!==t)||(t=e.data.charCodeAt(e.tokenStart+2),79!==t&&111!==t)||(t=e.data.charCodeAt(e.tokenStart+3),80!==t&&112!==t))}(e)?2:3:3}}}function Kh(e){for(pZ(e);5===e.tokenType;)pZ(e)}function TT(){return{categoryNames:[],categoryData:Object.create(null)}}function JN(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=io(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function hZ(e,t,r){return vN(e.categoryNames,JN(e.categoryNames,e.categoryData),t,r)}function e4(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function FOe(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;3===r.tokenType&&o<e;)Ke.add(n[i++%a],r.tokenStart,r.tokenEnd),Kh(r),o++;return t.tokenCount=i,o}function NOe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function kOe(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:for(r=e.lineNumber,Kh(e),n=fZ(e,dZ(e)),a=function POe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return!1;return!0}(e),i=[];4===e.tokenType;)i[i.length]=a?$N(e):$N(e).substring(n.length+1),Kh(e);for(o="_atom_site"===n?e.data.length/100|0:32,s=[],u=i.length,f=0;f<u;f++)s[f]=Ke.create(e.data,o);return[4,$f(e.runtimeCtx,1e6,c={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},FOe,NOe)];case 1:if(p.sent(),c.tokenCount%u!=0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line ".concat(r," is not a multiple of the number of columns.")}];if(l=c.tokenCount/u|0,a)for(f=0;f<u;f++)d={"":ht.ofTokens(s[f])},e4(t,i[f].substr(1),l,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[i[f]]=ht.ofTokens(s[f]);e4(t,n.substr(1),l,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function Ny(e,t){return Nn.error(t,e)}function BOe(e){return Nn.success(e)}function LOe(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:r=[],n=function MOe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}(e,t),a="",i=TT(),o=[],s=TT(),u=function QIe(e,t,r){return{categoryNames:e,header:r,categories:t}}(s.categoryNames,JN(s.categoryNames,s.categoryData),""),c="",t.update({message:"Parsing...",current:0,max:e.length}),Kh(n),f.label=1;case 1:return 6===n.tokenType?[3,7]:0!==(l=n.tokenType)?[3,2]:n.inSaveFrame?[2,Ny(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(hZ(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=TT(),o=[],Kh(n),[3,6]);case 2:if(1!==l)return[3,3];if(n.tokenEnd-n.tokenStart==5)s.categoryNames.length>0&&(o[o.length]=function ROe(e,t){return vN(e.categoryNames,JN(e.categoryNames,e.categoryData),t)}(s,c)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,Ny(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,c=e.substring(n.tokenStart+5,n.tokenEnd),s=TT()}return Kh(n),[3,6];case 3:return 2!==l?[3,5]:[4,kOe(n,n.inSaveFrame?s:i)];case 4:return(d=f.sent()).hasError?[2,Ny(d.errorLine,d.errorMessage)]:[3,6];case 5:if(4!==l)return console.log(n.tokenType,lt.getTokenString(n)),[2,Ny(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];if(d=function OOe(e,t){for(var r=e.tokenStart,n=dZ(e),a=fZ(e,n),i=Object.create(null),o=[],s=!0;s;){if(4!==e.tokenType||!IOe(e,r,n)){s=!1;break}var u=$N(e).substring(a.length+1);if(Kh(e),3!==e.tokenType)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=ht.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,Kh(e)}return e4(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}(n,n.inSaveFrame?s:i),d.hasError)return[2,Ny(d.errorLine,d.errorMessage)];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,Ny(n.lineNumber,"Unfinished save frame (".concat(u.header,")."))]:((i.categoryNames.length>0||o.length>0)&&r.push(hZ(i,a,o)),[2,BOe(VX(r))])}})})}function mZ(e){var t=this;return Ve.create("Parse CIF",function(r){return ce(t,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,LOe(e,r)];case 1:return[2,n.sent()]}})})})}function vZ(e){return ET({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function t4(e,t){for(var r={},n=0;n<t;n++)r[ET(e)]=ET(e);return r}function r4(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function DT(e,t){var r=zN(e.buffer,e.offset,t);return e.offset+=t,r}function n4(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=ET(e);return r}function ET(e){var r,n,t=e.buffer[e.offset];if(!(128&t))return e.offset++,t;if(128==(240&t))return n=15&t,e.offset++,t4(e,n);if(144==(240&t))return n=15&t,e.offset++,n4(e,n);if(160==(224&t))return n=31&t,e.offset++,DT(e,n);if(224==(224&t))return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,r4(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,r4(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,r4(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,DT(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,DT(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,DT(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n4(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n4(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,t4(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,t4(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function zOe(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(s)return r[o]||(r[o]=function UOe(e){var t=e.mask?vT(e.mask):void 0,r=vT(e.data),n=XF(r),a=n?t?function(c){return 0===t[c]?""+r[c]:""}:function(c){return""+r[c]}:t?function(c){return 0===t[c]?r[c]:""}:function(c){return r[c]},i=n?function(c){return r[c]}:function(c){var l=r[c];return Lh(l,0,l.length)},o=n?function(c){return r[c]}:function(c){var l=r[c];return Zf(l,0,l.length)},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:t?function(c){return t[c]}:function(c){return 0},areValuesEqual:function(c,l){return r[c]===r[l]},toStringArray:function(c){return Bo(u,a,c)},toIntArray:n?function(c){return HA(r,c)}:function(c){return Bo(u,i,c)},toFloatArray:n?function(c){return HA(r,c)}:function(c){return Bo(u,o,c)}}}(s)),r[o]}}}function gZ(e){var t=this;return Ve.create("Parse BinaryCIF",function(r){return ce(t,void 0,void 0,function(){var n,a,i;return le(this,function(o){n=[0,3];try{return a=vZ(e),function VOe(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=VX(a.dataBlocks.map(function(s){for(var u=Object.create(null),c=0,l=s.categories;c<l.length;c++){var d=l[c];u[d.name.substr(1)]=zOe(d)}return vN(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,Nn.success(i)]):[2,Nn.error("Unsupported format version. Current ".concat(a.version,", required ").concat(n.join("."),"."))]}catch(s){return[2,Nn.error(""+s)]}return[2]})})})}!function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,10===b.charCodeAt(y.position)&&++y.position,!0;default:++y.position}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}function i(y){return y.tokenStart=y.position,n(y)}function u(y,b,_){for(var C=0,x=0;x<b;x++){if(!i(y))return C;Ke.addUnchecked(_,y.tokenStart,y.tokenEnd),C++}return C}function g(y,b,_){for(var C=y.data,x=b,A=_-1,T=C.charCodeAt(x);(9===T||32===T)&&x<=A;)T=C.charCodeAt(++x);for(T=C.charCodeAt(A);(9===T||32===T)&&A>=x;)T=C.charCodeAt(--A);return y.tokenStart=x,y.tokenEnd=A+1,y.position=_,y}e.getTokenString=t,e.reset=function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0},e.eatLine=n,e.markStart=function a(y){y.tokenStart=y.position},e.markLine=i,e.readLine=function o(y){return i(y),t(y)},e.readLineTrim=function s(y){i(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)},e.markLines=function c(y,b){var _=Ke.create(y.data,2*b);return u(y,b,_),_},e.readLines=function l(y,b){for(var _=[],C=0;C<b;C++)_.push(e.readLine(y));return _},e.readLinesAsync=function d(y,b,_,C){return void 0===C&&(C=1e5),ce(this,void 0,void 0,function(){var x,A;return le(this,function(T){switch(T.label){case 0:return x=Ke.create(y.data,2*b),A=0,[4,$f(_,C,y,function(w,E){var I=Math.min(b-A,w);return u(E,I,x),A+=I,I},function(w,E){return w.update({message:"Parsing...",current:E.position,max:E.length})})];case 1:return T.sent(),[2,x]}})})},e.readAllLines=function f(y){for(var b=e(y),_=Ke.create(b.data,Math.max(y.length/80,2));i(b);)Ke.add(_,b.tokenStart,b.tokenEnd);return _},e.readAllLinesAsync=function h(y,b,_){return void 0===_&&(_=1e5),ce(this,void 0,void 0,function(){var C,x;return le(this,function(A){switch(A.label){case 0:return C=e(y),x=Ke.create(C.data,Math.max(y.length/80,2)),[4,$f(b,_,C,function(T,w){return function p(y,b,_){for(var C=0,x=0;x<b;x++){if(!i(y))return C;Ke.add(_,y.tokenStart,y.tokenEnd),C++}}(w,T,x),w.position<w.length?T:0},function(T,w){return T.update({message:"Parsing...",current:w.position,max:w.length})})];case 1:return A.sent(),[2,x]}})})},e.eatValue=function m(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:return void(y.tokenEnd=y.position);default:++y.position}y.tokenEnd=y.position},e.skipWhitespace=function v(y){for(var b=-1;y.position<y.length;){var _=y.data.charCodeAt(y.position);switch(_){case 9:case 32:b=_,++y.position;break;case 10:13!==b&&++y.lineNumber,b=_,++y.position;break;case 13:b=_,++y.position,++y.lineNumber;break;default:return b}}return b},e.trim=g}(lt||(lt={})),function(e){function r(o,s,u){var c=o;c.offset>c.indicesLenMinus2&&function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}(c),c.indices[c.offset++]=s,c.indices[c.offset++]=u,o.count++}e.add=r,e.addToken=function n(o,s){r(o,s.tokenStart,s.tokenEnd)},e.addUnchecked=function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++},e.create=function i(o,s){return{data:o,indicesLenMinus2:(s=Math.max(10,s))-2|0,count:0,offset:0,indices:new Uint32Array(s)}}}(Ke||(Ke={})),function(e){e.error=function t(i,o){return void 0===o&&(o=-1),new n(i,o)},e.success=function r(i,o){return void 0===o&&(o=[]),new a(i,o)};var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line ".concat(this.line,"] ").concat(this.message):this.message},i}();e.Error=n;var a=function(){return function i(o,s){this.result=o,this.warnings=s,this.isError=!1}}();e.Success=a}(Nn||(Nn={}));var o4,Vv,Uv=ie.Schema,Hn=Uv.str,yZ=Uv.List,Vd=Uv.lstr,sc=Uv.Aliased,U2=Uv.int,ky=Uv.coord,HOe={chem_comp:{formula:Hn,formula_weight:Uv.float,id:Hn,mon_nstd_parent_comp_id:yZ(",",function(e){return e}),name:Hn,one_letter_code:Hn,three_letter_code:Hn,type:sc(Vd),pdbx_synonyms:yZ(";",function(e){return e}),pdbx_type:Hn,pdbx_ambiguous_flag:Hn,pdbx_replaced_by:Hn,pdbx_replaces:Hn,pdbx_formal_charge:U2,pdbx_model_coordinates_details:Hn,pdbx_model_coordinates_db_code:Hn,pdbx_ideal_coordinates_details:Hn,pdbx_ideal_coordinates_missing_flag:sc(Vd),pdbx_model_coordinates_missing_flag:sc(Vd),pdbx_initial_date:Hn,pdbx_modified_date:Hn,pdbx_release_status:sc(Hn),pdbx_processing_site:sc(Hn)},chem_comp_atom:{alt_atom_id:Hn,atom_id:Hn,charge:U2,model_Cartn_x:ky,model_Cartn_y:ky,model_Cartn_z:ky,comp_id:Hn,type_symbol:Hn,pdbx_align:U2,pdbx_ordinal:U2,pdbx_model_Cartn_x_ideal:ky,pdbx_model_Cartn_y_ideal:ky,pdbx_model_Cartn_z_ideal:ky,pdbx_stereo_config:sc(Vd),pdbx_aromatic_flag:sc(Vd),pdbx_leaving_atom_flag:sc(Vd)},chem_comp_bond:{atom_id_1:Hn,atom_id_2:Hn,comp_id:Hn,value_order:sc(Vd),pdbx_ordinal:U2,pdbx_stereo_config:sc(Vd),pdbx_aromatic_flag:sc(Vd)},pdbx_chem_comp_descriptor:{comp_id:Hn,descriptor:Hn,type:sc(Vd),program:Hn,program_version:Hn},pdbx_chem_comp_identifier:{comp_id:Hn,identifier:Hn,type:sc(Hn),program:Hn,program_version:Hn}},V2=ie.Schema,cr=V2.str,cp=V2.lstr,Qs=V2.Aliased,Vc=V2.int,qOe={pdbx_reference_molecule:{prd_id:cr,formula_weight:V2.float,formula:cr,type:Qs(cp),type_evidence_code:cr,class:Qs(cp),class_evidence_code:cr,name:cr,represent_as:Qs(cp),chem_comp_id:cr,compound_details:cr,description:cr,representative_PDB_id_code:cr,release_status:Qs(cp),replaces:cr,replaced_by:cr},pdbx_reference_entity_list:{prd_id:cr,ref_entity_id:cr,type:Qs(cp),details:cr,component_id:Vc},pdbx_reference_entity_nonpoly:{prd_id:cr,ref_entity_id:cr,name:cr,chem_comp_id:cr},pdbx_reference_entity_link:{link_id:Vc,prd_id:cr,details:cr,ref_entity_id_1:cr,ref_entity_id_2:cr,entity_seq_num_1:Vc,entity_seq_num_2:Vc,comp_id_1:cr,comp_id_2:cr,atom_id_1:cr,atom_id_2:cr,value_order:Qs(cp),component_1:Vc,component_2:Vc,link_class:Qs(cr)},pdbx_reference_entity_poly_link:{link_id:Vc,prd_id:cr,ref_entity_id:cr,component_id:Vc,entity_seq_num_1:Vc,entity_seq_num_2:Vc,comp_id_1:cr,comp_id_2:cr,atom_id_1:cr,atom_id_2:cr,value_order:Qs(cp)},pdbx_reference_entity_poly:{prd_id:cr,ref_entity_id:cr,type:Qs(cr),db_code:cr,db_name:cr},pdbx_reference_entity_poly_seq:{prd_id:cr,ref_entity_id:cr,mon_id:cr,parent_mon_id:cr,num:Vc,observed:Qs(cp),hetero:Qs(cp)},pdbx_reference_entity_sequence:{prd_id:cr,ref_entity_id:cr,type:Qs(cr),NRP_flag:Qs(cr),one_letter_codes:cr},pdbx_reference_entity_src_nat:{prd_id:cr,ref_entity_id:cr,ordinal:Vc,organism_scientific:cr,taxid:cr,db_code:cr,db_name:cr},pdbx_prd_audit:{prd_id:cr,date:cr,processing_site:Qs(cr),action_type:Qs(cr)}},bZ=ie.Schema,Ai=bZ.str,tFe={datablock:{id:Ai,description:Ai},dictionary:{title:Ai,datablock_id:Ai,version:Ai},dictionary_history:{version:Ai,update:Ai,revision:Ai},sub_category:{id:Ai,description:Ai},category_group_list:{id:Ai,parent_id:Ai,description:Ai},item_type_list:{code:Ai,primitive_code:Ai,construct:Ai,detail:Ai},item_units_list:{code:Ai,detail:Ai},item_units_conversion:{from_code:Ai,to_code:Ai,operator:Ai,factor:bZ.float}},z2=ie.Schema,zd=z2.str,IT=z2.int,lp=z2.float,PT=z2.Aliased,Zh=z2.Vector,_Z=(PT(zd),PT(zd),PT(zd),PT(zd),Zh(3),Zh(3),{volume_data_3d_info:{name:zd,axis_order:Zh(3,IT),origin:Zh(3),dimensions:Zh(3),sample_rate:IT,sample_count:Zh(3,IT),spacegroup_number:IT,spacegroup_cell_size:Zh(3),spacegroup_cell_angles:Zh(3),mean_source:lp,mean_sampled:lp,sigma_source:lp,sigma_sampled:lp,min_source:lp,min_sampled:lp,max_source:lp,max_sampled:lp},volume_data_3d:{values:lp}}),MT=ie.Schema,ti=MT.float,a4=MT.int,Jn=MT.str,nFe={cell:{angle_alpha:ti,angle_beta:ti,angle_gamma:ti,formula_units_z:a4,length_a:ti,length_b:ti,length_c:ti,volume:ti},chemical:{melting_point:ti,name_common:Jn,name_systematic:Jn},chemical_formula:{moiety:Jn,sum:Jn,weight:ti},space_group:{crystal_system:Jn,it_number:a4,"name_h-m_full":Jn},space_group_symop:{operation_xyz:Jn},geom_bond:{atom_site_label_1:Jn,atom_site_label_2:Jn,distance:ti,publ_flag:Jn,site_symmetry_1:Jn,site_symmetry_2:Jn,valence:ti},audit:{block_doi:Jn},database_code:{cod:Jn,csd:Jn,depnum_ccdc_archive:Jn,depnum_ccdc_fiz:Jn,icsd:Jn,mdf:Jn,nbs:Jn},atom_site:{adp_type:Jn,calc_flag:Jn,disorder_assembly:Jn,disorder_group:Jn,fract_x:ti,fract_y:ti,fract_z:ti,label:Jn,occupancy:ti,refinement_flags:Jn,site_symmetry_multiplicity:a4,type_symbol:Jn,u_iso_or_equiv:ti},atom_site_aniso:{label:Jn,u_11:ti,u:(0,MT.Matrix)(3,3),u_12:ti,u_13:ti,u_22:ti,u_23:ti,u_33:ti},atom_type:{description:Jn,symbol:Jn},atom_type_scat:{dispersion_imag:ti,dispersion_real:ti,source:Jn}},aFe={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},i4=ie.Schema.int,oFe={volume_data_3d_info:_Z.volume_data_3d_info,segmentation_data_table:{set_id:i4,segment_id:i4},segmentation_data_3d:{values:i4}},Yl={parse:function(e){return"string"==typeof e?mZ(e):gZ(e)},parseText:mZ,parseBinary:gZ,toDatabaseCollection:function e3e(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=Ld(e,o,r)}return n},toDatabase:Ld,schema:{mmCIF:function(e){return Ld(kr,e)},CCD:function(e){return Ld(HOe,e)},BIRD:function(e){return Ld(qOe,e)},dic:function(e){return Ld(tFe,e)},cifCore:function(e){return Ld(nFe,e,aFe)},densityServer:function(e){return Ld(_Z,e)},segmentation:function(e){return Ld(oFe,e)}}},sFe={type_symbol:ie.Schema.Aliased(kr.atom_site.type_symbol),label_atom_id:kr.atom_site.label_atom_id,auth_atom_id:kr.atom_site.auth_atom_id,label_alt_id:kr.atom_site.label_alt_id,label_comp_id:kr.atom_site.label_comp_id,auth_comp_id:kr.atom_site.auth_comp_id,pdbx_formal_charge:kr.atom_site.pdbx_formal_charge},uFe={group_PDB:kr.atom_site.group_PDB,label_seq_id:kr.atom_site.label_seq_id,auth_seq_id:kr.atom_site.auth_seq_id,pdbx_PDB_ins_code:kr.atom_site.pdbx_PDB_ins_code},cFe={label_asym_id:kr.atom_site.label_asym_id,auth_asym_id:kr.atom_site.auth_asym_id,label_entity_id:kr.atom_site.label_entity_id};!function(e){e.EmptyResidueKey=function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}}(o4||(o4={})),function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainStartResidueIndex=t,e.chainEndResidueIndexExcl=r,e.chainResidueCount=function n(a,i){return r(a,i)-t(a,i)}}(Vv||(Vv={}));var zv,RT={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},lFe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},dFe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},fFe=1.7,hFe=0;function G2(e){var t=RT[e];return void 0===t?fFe:lFe[t]}function H2(e){var t=RT[e];return void 0===t?hFe:t}function SZ(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}function bFe(e,t,r,n,a,i){for(var o=e.residues,c=o.pdbx_PDB_ins_code,l=r.endSeqId,d=r.endInsCode,f=r.key,p=r.type,h="label"===t?o.label_seq_id:o.auth_seq_id,m=n;m<a;){var v=h.value(m);if(i.type[m]=p,i.key[m]=f,v>l||v===l&&c.value(m)===d)break;m++}}!function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=jl.create(e.Descriptor),e.fromStruct=function t(r,n,a){var i=new Map,o=[{kind:"none"}],s=function vFe(e,t){if(e._rowCount>0){if(0!==e.beg_label_seq_id.valueKind(0)||0!==e.end_label_seq_id.valueKind(0))return"auth"}else if(t&&(0!==t.beg_label_seq_id.valueKind(0)||0!==t.end_label_seq_id.valueKind(0)))return"auth";return"label"}(r,n);(function gFe(e,t,r,n){if(e._rowCount)for(var a=e.beg_label_asym_id,s=e.pdbx_beg_PDB_ins_code,l=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,p=e.details,h="label"===t?e.beg_label_seq_id:e.beg_auth_seq_id,m="label"===t?e.end_label_seq_id:e.end_auth_seq_id,v=0,g=e._rowCount;v<g;v++){var y=cn.create(0===d.valueKind(v)?cn.SecondaryStructurePdb[d.value(v)]:0===f.valueKind(v)?cn.SecondaryStructureMmcif[f.value(v)]:536870912),b={kind:"helix",flags:y,type_id:0===f.valueKind(v)?f.value(v):"helx_p",helix_class:d.value(v),details:0===p.valueKind(v)?p.value(v):void 0},_={startSeqId:h.value(v),startInsCode:s.value(v),endSeqId:m.value(v),endInsCode:l.value(v),type:y,key:n.length};n[n.length]=b;var C=a.value(v);if(r.has(C)){var x=r.get(C);x.has(_.startSeqId)?x.get(_.startSeqId).push(_):x.set(_.startSeqId,[_])}else r.set(C,new Map([[_.startSeqId,[_]]]))}})(r,s,i,o),function yFe(e,t,r,n,a){if(e._rowCount)for(var i=e.beg_label_asym_id,u=e.pdbx_beg_PDB_ins_code,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,p="label"===t?e.beg_label_seq_id:e.beg_auth_seq_id,h="label"===t?e.end_label_seq_id:e.end_auth_seq_id,m=new Map,v=n+1,g=0,y=e._rowCount;g<y;g++){var b=f.value(g),_=void 0;m.has(b)?_=m.get(b):(_=v++,m.set(b,_));var C=cn.create(8388612),x={kind:"sheet",flags:C,sheet_id:b,symmetry:void 0},A={startSeqId:p.value(g),startInsCode:u.value(g),endSeqId:h.value(g),endInsCode:d.value(g),type:C,key:a.length};a[a.length]=x;var T=i.value(g);if(r.has(T)){var w=r.get(T);w.has(A.startSeqId)?w.get(A.startSeqId).push(A):w.set(A.startSeqId,[A])}else r.set(T,new Map([[A.startSeqId,[A]]]))}}(n,s,i,r._rowCount,o);var u=a.residues._rowCount,l={type:new Int32Array(u),key:new Int32Array(u),elements:o};return i.size>0&&function _Fe(e,t,r,n){for(var a=e.chainAtomSegments.count,i=e.chains.label_asym_id,o=e.residues,c=o.pdbx_PDB_ins_code,l="label"===t?o.label_seq_id:o.auth_seq_id,d=0;d<a;d++){var f=Vv.chainStartResidueIndex(e,d),p=Vv.chainEndResidueIndexExcl(e,d),h=i.value(d);if(r.has(h))for(var m=r.get(h),v=f;v<p;v++){var g=l.value(v);if(m.has(g))for(var b=0,_=m.get(g);b<_.length;b++){var C=_[b],x=c.value(v);C.startInsCode===x&&bFe(e,t,C,v,p,n)}}}}(a,s,i,l),SZ(l.type,l.key,l.elements,function(d){return d})}}(zv||(zv={}));var Gd,Gv,SFe={U:kr.atom_site_anisotrop.U,U_esd:kr.atom_site_anisotrop.U_esd};!function(e){e.Schema=SFe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){return e.Provider.get(n.firstModel)&&Pn.is(n.firstModel.sourceData)?Fa.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop):Fa.Category.Empty}}]}},e.Provider=jl.create(e.Descriptor),e.getElementToAnsiotrop=function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);for(u.fill(-1),o=0,s=a.rowCount;o<s;++o){var c=i[a.value(o)];-1!==c&&(u[c]=o)}return u},e.getElementToAnsiotropFromLabel=function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);for(u.fill(-1),o=0,s=a.rowCount;o<s;++o){var c=i[a.value(o)];void 0!==c&&(u[c]=o)}return u}}(Gd||(Gd={})),function(e){var t,r="molstar_global_model_transform_info";function a(u){return e.Provider.get(u)}e.Schema=((t={})[r]={matrix:ie.Schema.Matrix(4,4,ie.Schema.float)},t),e.Descriptor=ec({name:r,cifExport:{categories:[{name:r,instance:function(u){var c=a(u.firstModel);if(!c)return Fa.Category.Empty;var l=Qr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:c}]);return Fa.Category.ofTable(l)}}],prefix:"molstar"}}),e.Provider=jl.create(e.Descriptor),e.attach=function n(u,c){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,c)},e.get=a,e.fromMmCif=function i(u){if(Pn.is(u.sourceData)){var c=u.sourceData.data.frame.categories[r];if(c){var l=function t3e(e,t){return new GX(t,e,!0)}(e.Schema[r],c);if(0!==l._rowCount)return l.matrix.value(0)}}},e.hasData=function o(u){if(!Pn.is(u.sourceData))return!1;var c=u.sourceData.data.frame.categories[r];return!!c&&c.rowCount>0},e.writeMmCif=function s(u,c){u.writeCategory({name:r,instance:function(){var l=Qr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:c}]);return Fa.Category.ofTable(l)}})}}(Gv||(Gv={})),R(R({},kr.chem_comp_bond),{molstar_protonation_variant:ie.Schema.Str()});var CFe=R(R({},kr.chem_comp),{type:ie.Schema.Aliased(ie.Schema.str)});function xFe(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=Qr.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=Qr.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}function CZ(e){for(var t=0,r=e.rowCount;t<r;t++)if(0===e.valueKind(t))return!0;return!1}function OT(e,t,r){(!e[t].isDefined||!CZ(e[t]))&&(e[t]=e[r]),(!e[r].isDefined||!CZ(e[r]))&&(e[r]=e[t])}var Vo={entry:kr.entry,struct:kr.struct,struct_asym:kr.struct_asym,ihm_model_list:kr.ihm_model_list,ihm_model_group:kr.ihm_model_group,ihm_model_group_link:kr.ihm_model_group_link,entity:kr.entity,entity_poly:kr.entity_poly,entity_poly_seq:kr.entity_poly_seq,pdbx_entity_branch:kr.pdbx_entity_branch,chem_comp:CFe,pdbx_chem_comp_identifier:kr.pdbx_chem_comp_identifier,atom_site:kr.atom_site,ihm_sphere_obj_site:kr.ihm_sphere_obj_site,ihm_gaussian_obj_site:kr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:kr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:kr.pdbx_molecule};function zc(e,t){void 0===t&&(t=!1);for(var r=Object.create(null),n=0,a=Object.keys(Vo);n<a.length;n++){var i=a[n];r[i]=i in e?e[i]:Qr.ofUndefinedColumns(Vo[i],0)}return t&&(r.atom_site=function wFe(e){var t=Qr.ofColumns(e._schema,e);return OT(t,"label_atom_id","auth_atom_id"),OT(t,"label_comp_id","auth_comp_id"),OT(t,"label_seq_id","auth_seq_id"),OT(t,"label_asym_id","auth_asym_id"),t}(r.atom_site)),r}var Pn,j2,Xl=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push("".concat(this.count)),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return 2===r?(void 0===this.waterId&&(this.set("water",a?.customName||"Water"),this.waterId="".concat(this.count)),this.waterId):pT(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",a?.customName||"Polymer ".concat(this.chainMap.size+1)),this.chainMap.set(n,"".concat(this.count))),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",a?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,"".concat(this.count))),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Qr.ofPartialColumns(Vo.entity,{id:ie.ofStringArray(this.ids),type:ie.ofStringAliasArray(this.types),pdbx_description:ie.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains;this.set("polymer",a.description);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],"".concat(this.count))}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),AFe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],TFe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],DFe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],EFe=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),xZ=function(){var e=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(function(r){return e.set(r.id,r)}),e}(),wZ=function(){var e=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(function(r){return e.set(r.id,r)}),e}(),Kl=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(My.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){if(this.seqId.value(t)!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!fa.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,AFe)?"peptide linking":this.hasAtomIds(t,TFe)?"rna linking":this.hasAtomIds(t,DFe)?"dna linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(xZ.has(t))this.set(xZ.get(t));else if(dT.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(EFe.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else if(np.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"saccharide"});else{var n=this.getAtomIds(r);if(1===n.size&&wZ.has(t))this.set(wZ.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Qr.ofPartialColumns(Vo.chem_comp,{id:ie.ofStringArray(this.ids),name:ie.ofStringArray(this.names),type:ie.ofStringAliasArray(this.types),mon_nstd_flag:ie.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function s4(e,t){var r=Pn.fromFrame(e,void 0,void 0,t),n=zc(r.data.db,!0);return Ve.create("Create mmCIF Model",function(a){return Wd(n,r,a)})}function NFe(e){var t=j2.fromFrame(e);return Ve.create("Create CCD Models",function(r){return function kFe(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s;return le(this,function(u){switch(u.label){case 0:return[4,AZ(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},r)];case 1:return n=u.sent(),[4,AZ(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},r)];case 2:for(a=u.sent(),i=[],n&&i.push(n),a&&i.push(a),o=0,s=i.length;o<s;++o)ir.TrajectoryInfo.set(i[o],{index:o,size:i.length});return[2,new mp(i)]}})})}(t.data.db,j2.fromFrame(e),r)})}function AZ(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j,k,H,G,U,Q,W,ne,X,L;return le(this,function(Y){switch(Y.label){case 0:for(i=e.chem_comp_atom,o=e.chem_comp_bond,s=r.coordinateType,u=r.cartn_x,c=r.cartn_y,l=r.cartn_z,d=(a=e.chem_comp).name.value(0),f=a.id.value(0),p=i.atom_id,h=i.charge,m=i.comp_id,v=i.pdbx_ordinal,g=i.type_symbol,y=i._rowCount,b=[],_=0;_<y;_++)i[u].valueKind(_)>0||(b[b.length]=_);return x=ie.ofConst("A",C=b.length,ie.Schema.str),A=ie.ofConst(1,C,ie.Schema.int),T=ie.ofConst("1",C,ie.Schema.str),w=ie.ofConst(1,C,ie.Schema.float),E=ie.ofConst(1,C,ie.Schema.int),I=ie.view(p,b),M=ie.view(m,b),F=ie.view(i[u],b),N=ie.view(i[c],b),j=ie.view(i[l],b),k=ie.view(v,b),H=ie.view(g,b),G=ie.view(h,b),U=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:x,auth_atom_id:I,auth_comp_id:M,auth_seq_id:A,Cartn_x:F,Cartn_y:N,Cartn_z:j,id:k,label_asym_id:x,label_atom_id:I,label_comp_id:M,label_seq_id:A,label_entity_id:T,occupancy:w,type_symbol:H,pdbx_PDB_model_num:E,pdbx_formal_charge:G},C),(Q=new Xl).setNames([[f,"".concat(d," (").concat(s,")")]]),Q.getEntityId(f,0,"A"),(W=new Kl(A,g)).setNames([[f,"".concat(d," (").concat(s,")")]]),W.add(f,0),[4,Wd(zc({entity:Q.getEntityTable(),chem_comp:W.getChemCompTable(),atom_site:U}),t,n)];case 1:return(ne=Y.sent()).representative?(X=ne.representative,L=Bv.getEntriesFromChemCompBond(o),Bv.Provider.set(X,{data:o,entries:L}),j2.CoordinateType.set(X,s),[2,ne.representative]):[2]}})})}ei.Provider.formatRegistry.add("mmCIF",function IFe(e){if(Pn.is(e.sourceData))return ei.fromData(e.sourceData.data.db)}),zv.Provider.formatRegistry.add("mmCIF",function PFe(e){if(Pn.is(e.sourceData)){var t=e.sourceData.data.db;return zv.fromStruct(t.struct_conf,t.struct_sheet_range,e.atomicHierarchy)}}),Gd.Provider.formatRegistry.add("mmCIF",function MFe(e){if(Pn.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop;return{data:Qr.ofColumns(Gd.Schema,t),elementToAnsiotrop:Gd.getElementToAnsiotrop(e.atomicConformation.atomId,t.id)}}},function RFe(e){return!!Pn.is(e.sourceData)&&e.sourceData.data.db.atom_site_anisotrop.U.isDefined}),Bv.Provider.formatRegistry.add("mmCIF",function OFe(e){if(Pn.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(0!==t._rowCount)return{data:t,entries:Bv.getEntriesFromChemCompBond(t)}}}),ic.Provider.formatRegistry.add("mmCIF",function FFe(e){if(Pn.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(0!==t._rowCount){var r=ic.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:ic.getAtomIndexFromEntries(r),entries:r}}}}),Gv.Provider.formatRegistry.add("mmCIF",Gv.fromMmCif,Gv.hasData),function(e){e.is=function t(n){return"mmCIF"===n?.kind},e.fromFrame=function r(n,a,i,o){return a||(a=Yl.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,file:o,frame:n,source:i}}}}(Pn||(Pn={})),function(e){var t="__CcdCoordinateType__";e.CoordinateType={get:function(a){return a._staticPropertyData[t]},set:function(a,i){return a._staticPropertyData[t]=i}},e.is=function r(a){return"CCD"===a?.kind},e.fromFrame=function n(a,i){return i||(i=Yl.schema.CCD(a)),{kind:"CCD",name:i._name,data:{db:i,frame:a}}}}(j2||(j2={}));var Hv=typeof process<"u"&&null!=process.versions&&null!=process.versions.node,q2=function BFe(){return typeof XMLHttpRequest>"u"||Hv?Fr(744):XMLHttpRequest}(),u4=function LFe(){return typeof File>"u"||Hv?function(){function t(r,n,a){var i;this.blob=new Blob(r,a),this.size=this.blob.size,this.type=this.blob.type,this.name=n,this.lastModified=null!==(i=a?.lastModified)&&void 0!==i?i:0,this.webkitRelativePath=""}return t.prototype.arrayBuffer=function(){return this.blob.arrayBuffer()},t.prototype.slice=function(r,n,a){return this.blob.slice(r,n,a)},t.prototype.stream=function(){return this.blob.stream()},t.prototype.text=function(){return this.blob.text()},t}():File}();function Qh(e,t){return e[t]|e[t+1]<<8}function jv(e,t,r){e[t]=255&r,e[t+1]=r>>8&255}function qv(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])}function dp(e,t,r){e[t]=255&r,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function zFe(e){return e.length<2?"0"+e:e}function TZ(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if(4294967168&a)if(4294965248&a)if(4294901760&a){if(4292870144&a)throw new Error("e");r+=4}else r+=3;else r+=2;else r++}return r}var jFe=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}();function DZ(e,t,r){return 4294967295^function qFe(e,t,r,n){for(var a=0;a<n;a++)e=jFe[255&(e^t[r+a])]^e>>>8;return e}(4294967295,e,t,r)}var gt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();function W2(e,t,r){for(var n=e.length,a=gt.rev15,i=0;i<n;i+=2)if(0!==e[i+1])for(var s=e[i+1],u=i>>1<<4|s,c=t-s,l=e[i]<<c,d=l+(1<<c);l!==d;)r[a[l]>>>15-t]=u,l++}function $h(e,t){for(var r=e.length,n=gt.bl_count,a=0;a<=t;a++)n[a]=0;for(a=1;a<r;a+=2)n[e[a]]++;var i=gt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)i[s]=o=o+n[s-1]<<1;for(var u=0;u<r;u+=2){var c=e[u+1];0!==c&&(e[u]=i[c],i[c]++)}}function Y2(e,t){for(var r=gt.rev15,n=15-t,a=0;a<e.length;a+=2)e[a]=r[e[a]<<t-e[a+1]]>>>n}function XFe(e,t,r){return ce(this,void 0,void 0,function(){var n;return le(this,function(a){switch(a.label){case 0:if(3===t[0]&&0===t[1])return[2,r||new Uint8Array(0)];n=function WFe(e,t){var r=void 0===t;return void 0===t&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}(t,r),a.label=1;case 1:return 0!==n.BFINAL?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return function YFe(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;0===i&&u<t;){var c=void 0,l=void 0,d=0,f=0;i=l4(r,s,1),u+=1;var p=l4(r,s+1,2);if(s+=3,0!==p){if(n&&(a=c4(a,o+(1<<17))),1===p)c=gt.flmap,l=gt.fdmap,d=511,f=31;else{if(2!==p)throw new Error("unknown BTYPE ".concat(p));var v=Jh(r,s,5)+257,g=Jh(r,s+5,5)+1,y=Jh(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)gt.itree[b]=0,gt.itree[b+1]=0;var _=1;for(b=0;b<y;b++){var C=Jh(r,s+3*b,3);gt.itree[1+(gt.ordr[b]<<1)]=C,C>_&&(_=C)}s+=3*y,$h(gt.itree,_),W2(gt.itree,_,gt.imap),c=gt.lmap,l=gt.dmap,s=KFe(gt.imap,(1<<_)-1,v+g,r,s,gt.ttree);var x=EZ(gt.ttree,0,v,gt.ltree);d=(1<<x)-1;var A=EZ(gt.ttree,v,g,gt.dtree);f=(1<<A)-1,$h(gt.ltree,x),W2(gt.ltree,x,c),$h(gt.dtree,A),W2(gt.dtree,A,l)}for(;;){var T=c[d4(r,s)&d];s+=15&T;var w=T>>>4;if(w>>>8){if(256===w)break;var E=o+w-254;if(w>264){var I=gt.ldef[w-257];E=o+(I>>>3)+Jh(r,s,7&I),s+=7&I}var M=l[d4(r,s)&f],N=gt.ddef[M>>>4],j=(N>>>4)+l4(r,s+=15&M,15&N);for(s+=15&N,n&&(a=c4(a,o+(1<<17)));o<E;)a[o]=a[o++-j],a[o]=a[o++-j],a[o]=a[o++-j],a[o]=a[o++-j];o=E}else a[o++]=w}}else{7&s&&(s+=8-(7&s));var h=4+(s>>>3),m=r[h-4]|r[h-3]<<8;n&&(a=c4(a,o+m)),a.set(new Uint8Array(r.buffer,r.byteOffset+h,m),o),s=h+m<<3,o+=m}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function c4(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function KFe(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[d4(n,a)&t];a+=15&s;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var c=0,l=0;16===u?(l=3+Jh(n,a,2),a+=2,c=i[o-1]):17===u?(l=3+Jh(n,a,3),a+=3):18===u&&(l=11+Jh(n,a,7),a+=7);for(var d=o+l;o<d;)i[o]=c,o++}}return a}function EZ(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[1+(i<<1)]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[1+(i<<1)]=0,i++;return a}function Jh(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1}function l4(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1}function d4(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}function f4(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(o=0;o<a;o++)0!==e[o]&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(0===s)return 0;if(1===s){var c=n[0].lit,l=0===c?1:0;return t[1+(c<<1)]=1,t[1+(l<<1)]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],p=0,h=1,m=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};h!==s-1;)d=p!==h&&(m===s||n[p].f<n[m].f)?n[p++]:n[m++],f=p!==h&&(m===s||n[p].f<n[m].f)?n[p++]:n[m++],n[h++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var v=p4(n[h-1],0);for(v>r&&(function ZFe(e,t,r){var n=0,a=0,i=1<<r-t;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a>>>=r-t;a>0;)(o=e[n].d)<t?(e[n].d++,a-=1<<t-o-1):n++;for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);0!==a&&console.log("debt left")}(u,r,v),v=r),o=0;o<s;o++)t[1+(u[o].lit<<1)]=u[o].d;return v}function p4(e,t){return-1!==e.lit?(e.d=t,t):Math.max(p4(e.l,t+1),p4(e.r,t+1))}!function(){for(var t=0;t<32768;t++){var r=t;gt.rev15[t]=((r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8)>>>16|r<<16)>>>17}function n(a,i,o){for(;0!=i--;)a.push(0,o)}for(t=0;t<32;t++)gt.ldef[t]=gt.of0[t]<<3|gt.exb[t],gt.ddef[t]=gt.df0[t]<<4|gt.dxb[t];n(gt.fltree,144,8),n(gt.fltree,112,9),n(gt.fltree,24,7),n(gt.fltree,8,8),$h(gt.fltree,9),W2(gt.fltree,9,gt.flmap),Y2(gt.fltree,9),n(gt.fdtree,32,5),$h(gt.fdtree,5),W2(gt.fdtree,5,gt.fdmap),Y2(gt.fdtree,5),n(gt.itree,19,0),n(gt.ltree,286,0),n(gt.dtree,30,0),n(gt.ttree,320,0)}();var JFe=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function eNe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:if(i=function QFe(e,t,r,n){return{data:e,out:t,opt:JFe[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:gt.lits,strt:gt.strt,prev:gt.prev}}(t,r,n,a),o=i.dlen,0===a){for(s=i.i,u=i.pos;s<o;)c=Math.min(65535,o-s),Wv(r,u,s+c===o?1:0),u=PZ(t,s,c,r,u+8),s+=c;return[2,u>>>3]}o>2&&(i.nc=h4(t,0),i.strt[i.nc]=0),g.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return function $Fe(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,c=e.li,l=e.lc,d=e.bs,f=e.ebits,p=e.c,h=e.nc,m=gt.lits,v=gt.strt,g=gt.prev,y=Math.min(o+t,n);o<y;o++){if(p=h,o+1<n-2){h=h4(r,o+1);var b=o+1&32767;g[b]=v[h],v[h]=b}if(u<=o){(c>14e3||l>26697)&&n-o>100&&(u<o&&(m[c]=o-u,c+=2,u=o),s=IZ(o===n-1||u===n?1:0,m,c,f,r,d,o-d,a,s),c=l=f=0,d=o);var _=0;if(o<n-2&&(_=tNe(r,o,g,p,Math.min(i[2],n-o),i[3])),0!==_){var C=_>>>16,x=65535&_,A=OZ(C,gt.of0);gt.lhst[257+A]++;var T=OZ(x,gt.df0);gt.dhst[T]++,f+=gt.exb[A]+gt.dxb[T],m[c]=C<<23|o-u,m[c+1]=x<<16|A<<8|T,c+=2,u=o+C}else gt.lhst[r[o]]++;l++}}e.i=o,e.pos=s,e.cvrd=u,e.li=c,e.lc=l,e.bs=d,e.ebits=f,e.c=p,e.nc=h}(i,1048576),[3,1];case 4:for(l=i.li,d=i.cvrd,f=i.pos,h=i.lits,v=i.ebits,((m=i.bs)!==(p=i.i)||0===t.length)&&(d<p&&(h[l]=p-d,l+=2,d=p),f=IZ(1,h,l,v,t,m,p-m,r,f));7&f;)f++;return[2,f>>>3]}})})}function tNe(e,t,r,n,a,i){var o=32767&t,s=r[o],u=o-s+32768&32767;if(s===o||n!==h4(e,t-u))return 0;for(var c=0,l=0,d=Math.min(32767,t);u<=d&&0!=--i&&s!==o;){if(0===c||e[t+c]===e[t+c-u]){var f=rNe(e,t,u);if(f>c){if(l=u,(c=f)>=a)break;u+2<f&&(f=u+2);for(var p=0,h=0;h<f-2;h++){var m=t-u+h+32768&32767,g=m-r[m]+32768&32767;g>p&&(p=g,s=m)}}}u+=(o=s)-(s=r[o])+32768&32767}return c<<16|l}function rNe(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function h4(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function IZ(e,t,r,n,a,i,o,s,u){gt.lhst[256]++;var c=function nNe(){for(var e=f4(gt.lhst,gt.ltree,15),t=f4(gt.dhst,gt.dtree,15),r=[],n=RZ(gt.ltree,r),a=[],i=RZ(gt.dtree,a),o=0;o<r.length;o+=2)gt.ihst[r[o]]++;for(o=0;o<a.length;o+=2)gt.ihst[a[o]]++;for(var s=f4(gt.ihst,gt.itree,7),u=19;u>4&&0===gt.itree[1+(gt.ordr[u-1]<<1)];)u--;return[e,t,s,n,i,u,r,a]}(),l=c[0],d=c[1],f=c[2],p=c[3],h=c[4],m=c[5],v=c[6],g=c[7],y=32+(u+3&7?8-(u+3&7):0)+(o<<3),b=n+X2(gt.fltree,gt.lhst)+X2(gt.fdtree,gt.dhst),_=n+X2(gt.ltree,gt.lhst)+X2(gt.dtree,gt.dhst);_+=14+3*m+X2(gt.itree,gt.ihst)+(2*gt.ihst[16]+3*gt.ihst[17]+7*gt.ihst[18]);for(var C=0;C<286;C++)gt.lhst[C]=0;for(C=0;C<30;C++)gt.dhst[C]=0;for(C=0;C<19;C++)gt.ihst[C]=0;var x=y<b&&y<_?0:b<_?1:2;if(FT(s,u,e),FT(s,u+1,x),u+=3,0===x){for(;7&u;)u++;u=PZ(a,i,o,s,u)}else{var A=void 0,T=void 0;if(1===x)A=gt.fltree,T=gt.fdtree;else if(2===x){$h(gt.ltree,l),Y2(gt.ltree,l),$h(gt.dtree,d),Y2(gt.dtree,d),$h(gt.itree,f),Y2(gt.itree,f),A=gt.ltree,T=gt.dtree,Wv(s,u,p-257),Wv(s,u+=5,h-1),Wv(s,u+=5,m-4),u+=4;for(var w=0;w<m;w++)Wv(s,u+3*w,gt.itree[1+(gt.ordr[w]<<1)]);u=MZ(v,gt.itree,s,u+=3*m),u=MZ(g,gt.itree,s,u)}else xn();for(var E=i,I=0;I<r;I+=2){for(var M=t[I],F=M>>>23,N=E+(8388607&M);E<N;)u=K2(a[E++],A,s,u);if(0!==F){var j=t[I+1],k=j>>16,H=j>>8&255,G=255&j;Wv(s,u=K2(257+H,A,s,u),F-gt.of0[H]),FT(s,u=K2(G,T,s,u+=gt.exb[H]),k-gt.df0[G]),u+=gt.dxb[G],E+=F}}u=K2(256,A,s,u)}return u}function PZ(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function X2(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[1+(n<<1)];return r}function MZ(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=K2(i,t,r,n);var s=16===i?2:17===i?3:7;i>15&&(Wv(r,n,o),n+=s)}return n}function RZ(e,t){for(var r=e.length;2!==r&&0===e[r-1];)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=0===n?-1:e[n-1];if(0===a&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;(c=Math.min(u+1-n>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),n+=2*c-2}else if(a===s&&i===a&&o===a){for(u=n+5;u+2<r&&e[u+2]===a;)u+=2;var c=Math.min(u+1-n>>>1,6);t.push(16,c-3),n+=2*c-2}else t.push(a,0)}return r>>>1}function OZ(e,t){var r=0;return t[16|r]<=e&&(r|=16),t[8|r]<=e&&(r|=8),t[4|r]<=e&&(r|=4),t[2|r]<=e&&(r|=2),t[1|r]<=e&&(r|=1),r}function K2(e,t,r,n){return FT(r,n,t[e<<1]),n+t[1+(e<<1)]}function Wv(e,t,r){var n=t>>>3;e[n]|=r<<=7&t,e[n+1]|=r>>>8}function FT(e,t,r){var n=t>>>3;e[n]|=r<<=7&t,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function Z2(e,t,r){return void 0===r&&(r=!1),ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m;return le(this,function(v){switch(v.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;101010256!==qv(a,i);)i--;o=i,o+=4,s=Qh(a,o+=4),o+=2,o+=2,u=qv(a,o+=4),o+=4,o=u,c=0,v.label=1;case 1:return c<s?(o+=4,o+=4,o+=4,o+=4,l=qv(a,o+=4),d=qv(a,o+=4),f=Qh(a,o+=4),p=Qh(a,o+2),h=Qh(a,o+4),o+=6,m=qv(a,o+=8),o+=4,o+=f+p+h,[4,aNe(e,a,m,n,l,d,r)]):[3,4];case 2:v.sent(),v.label=3;case 3:return c++,[3,1];case 4:return[2,n]}})})}function aNe(e,t,r,n,a,i,o){return ce(this,void 0,void 0,function(){var s,u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:return r+=4,r+=2,s=Qh(t,r+=2),r+=2,r+=4,r+=4,u=Qh(t,r+=8),c=Qh(t,r+=2),l=function GFe(e,t,r){for(var a,n="",i=0;i<r;i++)n+="%"+zFe(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return function VFe(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}(e,t,r)}return a}(t,r+=2,u),r+=u,r+=c,o?(n[l]={size:i,csize:a},[2]):(d=new Uint8Array(t.buffer,r),0!==s?[3,1]:(n[l]=new Uint8Array(d.buffer.slice(r,r+a)),[3,4]));case 1:return 8!==s?[3,3]:(f=new Uint8Array(i),[4,m4(e,d,f)]);case 2:return p.sent(),n[l]=f,[3,4];case 3:throw new Error("unknown compression method: ".concat(s));case 4:return[2]}})})}function m4(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(n){return[2,XFe(e,t,r)]})})}function iNe(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:if(a=10,4&(n=t[3])&&(i=Qh(t,a),a+=i),8&n){for(o=a;0!==t[o];)++o;a=o+1}if(16&n){for(o=a;0!==t[o];)++o;a=o+1}return 1&n&&(a+=2),s=function UFe(e){return e>>0}(qv(t,t.length-8)),u=qv(t,t.length-4),void 0===r&&(r=new Uint8Array(u)),c=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,m4(e,c,r)];case 1:return l=f.sent(),d=DZ(l,0,l.length),s!==d&&console.error("ungzip: checksums don't match"),[2,l]}})})}function oNe(e,t,r){return ce(this,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return void 0===r&&(r={level:6}),n=new Uint8Array(50+Math.floor(1.1*t.length)),[4,eNe(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function sNe(e,t){return void 0===t&&(t=!1),Ve.create("Zip",function(r){return function uNe(e,t,r){return void 0===r&&(r=!1),ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A;return le(this,function(T){switch(T.label){case 0:for(s in n=0,a={},o=[],i=t)o.push(s);u=0,T.label=1;case 1:return u<o.length?(s=o[u])in i?(c=!function cNe(e){var t=e.split(".").pop().toLowerCase();return-1!=="png,jpg,jpeg,zip".indexOf(t)}(_=s)&&!r,d=DZ(l=t[_],0,l.length),f=a,p=_,A={cpr:c,usize:l.length,crc:d},c?[4,oNe(e,l)]:[3,3]):[3,5]:[3,6];case 2:return h=T.sent(),[3,4];case 3:h=l,T.label=4;case 4:f[p]=(A.file=h,A),T.label=5;case 5:return u++,[3,1];case 6:for(_ in a)n+=a[_].file.length+30+46+2*TZ(_);for(_ in n+=22,m=new Uint8Array(n),v=0,g=[],a)C=a[_],g.push(v),v=FZ(m,v,_,C,0);for(_ in y=0,b=v,a)C=a[_],g.push(v),v=FZ(m,v,_,C,1,g[y++]);return x=v-b,dp(m,v,101010256),v+=4,jv(m,v+=4,y),jv(m,v+=2,y),dp(m,v+=2,x),dp(m,v+=4,b),v+=4,v+=2,[2,m.buffer]}})})}(r,e,t)})}function FZ(e,t,r,n,a,i){void 0===i&&(i=0);var o=n.file;dp(e,t,0===a?67324752:33639248),t+=4,1===a&&(t+=2),jv(e,t,20),jv(e,t+=2,0),jv(e,t+=2,n.cpr?8:0),dp(e,t+=2,0),dp(e,t+=4,n.crc),dp(e,t+=4,o.length),dp(e,t+=4,n.usize),jv(e,t+=4,TZ(r)),jv(e,t+=2,0),t+=2,1===a&&(t+=2,t+=2,dp(e,t+=6,i),t+=4);var s=function HFe(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if(4294967168&o)if(4294965248&o)if(4294901760&o){if(4292870144&o)throw new Error("e");e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4}else e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else e[t+a]=o,a++}return a}(e,t,r);return t+=s,0===a&&(e.set(o,t),t+=o.length),t}var Gc=function(e){return e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip",e}(Gc||{});function fp(e,t){return function g4(e,t){var r=this;if(Hv)return function pNe(e,t){var r=this;return Ve.create("Read File",function(n){return ce(r,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return a="zip"===t?Gc.None:BZ(e.name),[4,n.update({message:"Opening file...",canAbort:!1})];case 1:return o.sent(),"binary"===t||"zip"===t||a!==Gc.None?[4,e.arrayBuffer()]:[3,3];case 2:return i=o.sent(),[3,5];case 3:return[4,e.text()];case 4:i=o.sent(),o.label=5;case 5:return[4,n.update({message:"Processing file...",canAbort:!1})];case 6:return o.sent(),[4,LZ(n,i,t,a)];case 7:return[2,o.sent()]}})})})}(e,t);var n=void 0;return Ve.create("Read File",function(a){return ce(r,void 0,void 0,function(){var i,o;return le(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i="zip"===t?Gc.None:BZ(e.name),"binary"===t||"zip"===t||i!==Gc.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,kZ(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,LZ(a,o.result,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}(e,t)}function v4(e){return"string"==typeof e?UZ(e,e,"string"):UZ(e.title,e.url,e.type||"string",e.body,e.headers)}function NZ(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function kZ(e,t,r){return new Promise(function(n,a){if(function lNe(e){if(!Hv&&e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof q2)return e.readyState===q2.DONE;throw new Error("unknown data type")}(r)){var i=r.error;null!=i?a(i??NZ(r instanceof q2)):n(r)}else{var o=!1;r.onerror=function(s){o||a(s.target.error??NZ(r instanceof q2))},r.onprogress=function(s){if(e.shouldUpdate&&!o)try{e.update(s.lengthComputable?{message:t,isIndeterminate:!1,current:s.loaded,max:s.total}:{message:"".concat(t," ").concat((s.loaded/1024/1024).toFixed(2)," MB"),isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}}})}function BZ(e){return/\.gz$/i.test(e)?Gc.Gzip:/\.zip$/i.test(e)?Gc.Zip:Gc.None}var dNe=/^(__MACOSX|.DS_Store)/;function fNe(e,t,r){return ce(this,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:switch(r){case Gc.None:return[3,1];case Gc.Gzip:return[3,2];case Gc.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,iNe(e,t)];case 3:return[4,Z2(e,t.buffer)];case 4:if(a=o.sent(),1!==(i=Object.keys(a).filter(function(s){return!dNe.test(s)})).length)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function LZ(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i;return le(this,function(s){switch(s.label){case 0:if(null===(a=t instanceof ArrayBuffer?new Uint8Array(t):t))throw new Error("no data given");if(n===Gc.None)return[3,4];if(!(a instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,fNe(e,a,n)];case 1:return i=s.sent(),"string"!==r?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return s.sent(),a=zN(i,0,i.length),[3,4];case 3:a=i,s.label=4;case 4:return"binary"===r&&a instanceof Uint8Array?[2,a]:[3,5];case 5:return"zip"===r&&a instanceof Uint8Array?[4,Z2(e,a.buffer)]:[3,7];case 6:return[2,s.sent()];case 7:if("string"===r&&"string"==typeof a)return[2,a];if("xml"===r&&"string"==typeof a)return[2,(new DOMParser).parseFromString(a,"application/xml")];if("json"===r&&"string"==typeof a)return[2,JSON.parse(a)];s.label=8;case 8:throw new Error("could not get requested response data '".concat(r,"'"))}})})}var y4=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new q2},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function UZ(e,t,r,n,a){var i=this;if(Hv&&t.startsWith("file://"))return function gNe(e,t,r,n,a){if(!Hv)throw new Error("This function should only be used when running in Node.js");if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");var i=t.substring(7),o=function vNe(){if(!b4)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return b4}().readFileSync(i);return fp(new u4([o],"raw-data"),r)}(0,t,r);var o=void 0;return Ve.create(e||"Download",function(s){return ce(i,void 0,void 0,function(){var u,c,l,p,h;return le(this,function(m){switch(m.label){case 0:if((o=y4.get()).open(n?"post":"get",t,!0),a)for(u=0,c=a;u<c.length;u++)o.setRequestHeader((l=c[u])[0],l[1]);return o.responseType=function mNe(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":case"zip":return"arraybuffer"}}(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return m.sent(),[4,kZ(s,"Downloading...",o)];case 2:return p=m.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return m.sent(),h=function hNe(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(y4.deposit(e),("binary"===t||"zip"===t)&&r instanceof ArrayBuffer)return new Uint8Array(r);if("string"===t&&"string"==typeof r)return r;if("xml"===t&&r instanceof XMLDocument)return r;if("json"===t&&"object"==typeof r)return r;throw new Error("could not get requested response data '".concat(t,"'"))}throw y4.deposit(e),new Error("Download failed with status code ".concat(e.status))}(p,r),[2,h]}})})},function(){o&&(o.abort(),o=void 0)})}var pn,b4=void 0;function yNe(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,h,m;return le(this,function(v){switch(v.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(v.sent(),o=[],s=[],u=0,c=Math.min(a,n);u<c;u++)o.push(zZ(u,(h=r[u]).id,t.resolve(pn.getUrlAsset(t,h.url),h.isBinary?"binary":"string").runAsChild(e))),s.push(u);l=0,v.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=v.sent(),f=r[d.index],p=s.indexOf(d.index),l++,"error"===d.kind&&!f.canFail)throw new Error("".concat(f.url,": ").concat(d.error));return e.shouldUpdate?[4,e.update({message:"Downloading...",current:l,max:a})]:[3,5];case 4:v.sent(),v.label=5;case 5:return i[d.index]=d,o=o.filter(VZ,p),s=s.filter(VZ,p),u<a&&(m=t.resolve(pn.getUrlAsset(t,(h=r[u]).url),h.isBinary?"binary":"string").runAsChild(e),o.push(zZ(u,h.id,m)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function VZ(e,t){return this!==t}function zZ(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return[2,{kind:"ok",result:i.sent(),index:e,id:t}];case 2:return[2,{kind:"error",error:i.sent(),index:e,id:t}];case 3:return[2]}})})}!function(e){function t(u,c){return R({kind:"url",id:Gn.create22(),url:u},c)}e.Url=t,e.File=function r(u){return{kind:"file",id:Gn.create22(),name:u.name,file:u}},e.isUrl=function n(u){return"url"===u?.kind},e.isFile=function a(u){return"file"===u?.kind},e.Wrapper=function i(u,c,l){return{data:u,dispose:function(){l.release(c)}}},e.getUrl=function o(u){return"string"==typeof u?u:u.url},e.getUrlAsset=function s(u,c,l){return"string"==typeof c?u.tryFindUrl(c,l)||t(c,{body:l}):c}}(pn||(pn={}));var D,bNe=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return nT(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(pn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.get=function(t){return this._assets.get(t.id)},e.prototype.delete=function(t){return this._assets.delete(t.id)},e.prototype.has=function(t){return this._assets.has(t.id)},e.prototype.resolve=function(t,r,n){var a=this;return void 0===n&&(n=!0),pn.isUrl(t)?Ve.create("Download ".concat(t.title||t.url),function(i){return ce(a,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return this._assets.has(t.id)?((o=this._assets.get(t.id)).refCount++,u=(s=pn).Wrapper,[4,fp(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[m.sent(),t,this])];case 2:return n?[3,4]:(l=(c=pn).Wrapper,[4,v4(R(R({},t),{type:r})).runInContext(i)]);case 3:return[2,l.apply(c,[m.sent(),t,this])];case 4:return[4,v4(R(R({},t),{type:"binary"})).runInContext(i)];case 5:return d=m.sent(),f=new u4([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),h=(p=pn).Wrapper,[4,fp(f,r).runInContext(i)];case 6:return[2,h.apply(p,[m.sent(),t,this])]}})})}):Ve.create("Read ".concat(t.name),function(i){return ce(a,void 0,void 0,function(){var o,s,u,c,l;return le(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?((o=this._assets.get(t.id)).refCount++,u=(s=pn).Wrapper,[4,fp(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof u4))throw new Error("Cannot resolve file asset '".concat(t.name,"' (").concat(t.id,")"));return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),l=(c=pn).Wrapper,[4,fp(t.file,r).runInContext(i)];case 3:return[2,l.apply(c,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e.prototype.clear=function(){this._assets.clear()},e.prototype.dispose=function(){this.clear()},e}();!function(e){function t(re,ee){return ee&&(ee.label&&(re.label=ee.label),ee.description&&(re.description=ee.description),ee.legend&&(re.legend=ee.legend),ee.fieldLabels&&(re.fieldLabels=ee.fieldLabels),ee.isHidden&&(re.isHidden=ee.isHidden),ee.shortLabel&&(re.shortLabel=ee.shortLabel),ee.twoColumns&&(re.twoColumns=ee.twoColumns),ee.isEssential&&(re.isEssential=ee.isEssential),ee.category&&(re.category=ee.category),ee.hideIf&&(re.hideIf=ee.hideIf),ee.help&&(re.help=ee.help)),re}function a(re,ee,ue){return t({type:"select",defaultValue:pe(re,ee),options:ee,cycle:ue?.cycle},ue)}function m(re,ee){return ee&&(typeof ee.min<"u"&&(re.min=ee.min),typeof ee.max<"u"&&(re.max=ee.max),typeof ee.step<"u"&&(re.step=ee.step)),re}function b(re,ee){var ue=t({type:"group",defaultValue:ee?.customDefault||k(re),params:re},ee);return ee?.presets&&(ue.presets=ee.presets),ee?.isExpanded&&(ue.isExpanded=ee.isExpanded),ee?.isFlat&&(ue.isFlat=ee.isFlat),ee?.pivot&&(ue.pivot=ee.pivot),ue}function T(){return k(this.element)}function w(){throw new Error("getValue not set. Fix runtime.")}function k(re){for(var ee={},ue=0,ge=Object.keys(re);ue<ge.length;ue++){var Ce=ge[ue];re[Ce].isOptional||(ee[Ce]=re[Ce].defaultValue)}return ee}function H(re,ee,ue){return function(){return re(ee,ue)}}function G(re,ee,ue){if(ee)if("value-ref"===re.type)(ge=ee).getValue=ge.ref?H(re.resolveRef,ge.ref,ue):function(){throw new Error("Unset ref in ValueRef value.")};else if("data-ref"===re.type)(ge=ee).getValue=ge.ref?H(ue,ge.ref,ue):function(){throw new Error("Unset ref in ValueRef value.")};else if("group"===re.type)W(re.params,ee,ue);else if("mapped"===re.type){var ge;G(re.map((ge=ee).name),ge.params,ue)}else if("object-list"===re.type){if(!Q(re.element))return;for(var ze=0,je=ee;ze<je.length;ze++)W(re.element,je[ze],ue)}}function U(re){if("value-ref"===re.type||"data-ref"===re.type)return!0;if("group"===re.type){if(Q(re.params))return!0}else if("mapped"===re.type){for(var ee=0,ue=re.select.options;ee<ue.length;ee++)if(U(re.map(ue[ee][0])))return!0}else if("object-list"===re.type)return Q(re.element);return!1}function Q(re){for(var ee=0,ue=Object.keys(re);ee<ue.length;ee++)if(U(re[ue[ee]]))return!0;return!1}function W(re,ee,ue){for(var ge=0,Ce=Object.keys(re);ge<Ce.length;ge++){var ze=Ce[ge];G(re[ze],ee?.[ze],ue)}}function L(re,ee,ue){if(ee===ue)return!0;if("object"!=typeof ee||"object"!=typeof ue)return!1;for(var ge=0,Ce=Object.keys(re);ge<Ce.length;ge++){var ze=Ce[ge];if(!Y(re[ze],ee[ze],ue[ze]))return!1}return!0}function Y(re,ee,ue){if(ee===ue)return!0;if("group"===re.type)return L(re.params,ee,ue);if("mapped"===re.type)return(ge=ee).name===(Ce=ue).name&&Y(re.map(ge.name),ge.params,Ce.params);if("multi-select"===re.type){if((ge=ee).length!==(Ce=ue).length)return!1;if(ge.length<10){for(var je=0,V=ge.length;je<V;je++)if(ge[je]!==Ce[je]&&Ce.indexOf(ge[je])<0)return!1}else{var J=new Set(Ce);for(je=0,V=ge.length;je<V;je++)if(ge[je]!==Ce[je]&&!J.has(ge[je]))return!1}return!0}if("interval"===re.type)return ee[0]===ue[0]&&ee[1]===ue[1];if("line-graph"===re.type){if((ge=ee).length!==(Ce=ue).length)return!1;for(je=0,V=ge.length;je<V;je++)if(!Ne.areEqual(ge[je],Ce[je]))return!1;return!0}if("vec3"===re.type)return S.equals(ee,ue);if("mat4"===re.type)return me.areEqual(ee,ue,gn);if("script"===re.type)return(ge=ee).language===(Ce=ue).language&&ge.expression===Ce.expression;if("object-list"===re.type){var ge,Ce,ye=(ge=ee).length;if(ye!==(Ce=ue).length)return!1;for(je=0;je<ye;je++)if(!L(re.element,ge[je],Ce[je]))return!1;return!0}return"object"==typeof ee&&"object"==typeof ue&&GA(ee,ue)}function $(re,ee,ue){if(void 0===ee)return R({},ue);if(void 0===ue)return R({},ee);for(var ge=Object.create(null),Ce=0,ze=Object.keys(re);Ce<ze.length;Ce++){var je=ze[Ce];ge[je]=Z(re[je],ee[je],ue[je])}return ge}function Z(re,ee,ue){if(void 0===ee)return"object"!=typeof ue||Array.isArray(ue)?ue:R({},ue);if(void 0===ue)return"object"!=typeof ee||Array.isArray(ee)?ee:R({},ee);if("group"===re.type)return $(re.params,ee,ue);if("mapped"===re.type){var ge=ee,Ce=ue;if(ge.name!==Ce.name)return R({},Ce);var ze=re.map(Ce.name);return{name:Ce.name,params:Z(ze,ge.params,Ce.params)}}return"value"===re.type?ue:"object"==typeof ee&&"object"==typeof ue?Array.isArray(ue)?ue:R(R({},ee),ue):ue}function q(re,ee){for(var ue=0,ge=re.options;ue<ge.length;ue++)if(ge[ue][0]===ee)return!0;return!1}function z(re,ee,ue){if(null==ee)return ue?re.defaultValue:void 0;if("value"===re.type)return ee;if("group"===re.type){for(var ge=Object.create(null),Ce=0,ze=Object.keys(re.params);Ce<ze.length;Ce++){var je=ze[Ce],V=re.params[je];void 0===ee[je]?ue&&(ge[je]=V.defaultValue):ge[je]=z(V,ee[je],ue)}return ge}if("mapped"===re.type){var J=ee;return"string"!=typeof J.name?re.defaultValue:typeof J.params>"u"?ue?re.defaultValue:void 0:q(re.select,J.name)?(V=re.map(J.name),{name:J.name,params:z(V,J.params,ue)}):re.defaultValue}return"select"===re.type?q(re,ee)?ee:re.defaultValue:"multi-select"===re.type?Array.isArray(ee)?(ge=ee.filter(function(we){return q(this,we)},re),ee.length>0&&0===ge.length?re.defaultValue:ge):re.defaultValue:"object-list"===re.type?Array.isArray(ee)?ee.map(function(ye){return te(re.element,ye,ue?"all":"skip")}):re.defaultValue:ee}function te(re,ee,ue){if("object"!=typeof ee||null===ee)return ue?k(re):ee;for(var ge=Object.create(null),Ce=0,ze=Object.keys(re);Ce<ze.length;Ce++){var je=ze[Ce],V=re[je];void 0===ee[je]?"all"===ue&&(ge[je]=V.defaultValue):ge[je]=z(V,ee[je],"skip"!==ue)}return ge}function pe(re,ee){for(var ue=0,ge=ee;ue<ge.length;ue++)if(ge[ue][0]===re)return re;return ee.length>0?ee[0][0]:void 0}e.Essential={isEssential:!0},e.Optional=function r(re){var ee=R({},re);return ee.isOptional=!0,ee},e.Value=function n(re,ee){return t({type:"value",defaultValue:re},ee)},e.Select=a,e.MultiSelect=function i(re,ee,ue){var ge=t({type:"multi-select",defaultValue:re,options:ee},ue);return ue?.emptyValue&&(ge.emptyValue=ue.emptyValue),ge},e.Boolean=function o(re,ee){return t({type:"boolean",defaultValue:re},ee)},e.Text=function s(re,ee){return void 0===re&&(re=""),t({type:"text",defaultValue:re},ee)},e.Color=function u(re,ee){var ue=t({type:"color",defaultValue:re},ee);return ee?.isExpanded&&(ue.isExpanded=ee.isExpanded),ue},e.ColorList=function c(re,ee){var ue;if("string"==typeof re){var ge=rp(re);ue={kind:"qualitative"!==ge.type?"interpolate":"set",colors:ge.list}}else ue=re;return t({type:"color-list",presetKind:ee?.presetKind||"all",defaultValue:ue,offsets:!!ee?.offsets},ee)},e.Vec3=function l(re,ee,ue){return t(m({type:"vec3",defaultValue:re},ee),ue)},e.Mat4=function d(re,ee){return t({type:"mat4",defaultValue:re},ee)},e.Url=function f(re,ee){return t({type:"url",defaultValue:"string"==typeof re?pn.Url(re):pn.Url(re.url,{body:re.body})},ee)},e.File=function p(re){var ee=t({type:"file",defaultValue:null},re);return re?.accept&&(ee.accept=re.accept),ee},e.FileList=function h(re){var ee=t({type:"file-list",defaultValue:null},re);return re?.accept&&(ee.accept=re.accept),ee},e.Numeric=function v(re,ee,ue){var ge=t(m({type:"number",defaultValue:re},ee),ue);return ue?.immediateUpdate&&(ge.immediateUpdate=!0),ge},e.Interval=function g(re,ee,ue){return t(m({type:"interval",defaultValue:re},ee),ue)},e.LineGraph=function y(re,ee){var ue=t({type:"line-graph",defaultValue:re},ee);return ee?.getVolume&&(ue.getVolume=ee.getVolume),ue},e.Group=b,e.EmptyGroup=function _(re){return b({},re)},e.Mapped=function C(re,ee,ue,ge){var Ce=pe(re,ee);return t({type:"mapped",defaultValue:{name:Ce,params:ue(Ce).defaultValue},select:a(Ce,ee,ge),map:ue},ge)},e.MappedStatic=function x(re,ee,ue){var ge=ue?.options?ue.options:Object.keys(ee).map(function(ze){return[ze,ee[ze].label||kc(ze)]}),Ce=pe(re,ge);return t({type:"mapped",defaultValue:{name:Ce,params:ee[Ce].defaultValue},select:a(Ce,ge,ue),map:function(ze){return ee[ze]}},ue)},e.ObjectList=function A(re,ee,ue){return t({type:"object-list",element:re,getLabel:ee,ctor:T,defaultValue:ue?.defaultValue||[]},ue)},e.ValueRef=function E(re,ee,ue){var ge;return t({type:"value-ref",defaultValue:{ref:null!==(ge=ue?.defaultRef)&&void 0!==ge?ge:"",getValue:w},getOptions:re,resolveRef:ee},ue)},e.DataRef=function I(re){var ee;return t({type:"data-ref",defaultValue:{ref:null!==(ee=re?.defaultRef)&&void 0!==ee?ee:"",getValue:w}},re)},e.Converted=function M(re,ee,ue){return t({type:"converted",defaultValue:ee(ue.defaultValue),converted:ue,fromValue:re,toValue:ee},ue)},e.Conditioned=function F(re,ee,ue,ge,Ce){var ze=Object.keys(ee).map(function(je){return[je,je]});return t({type:"conditioned",select:a(ue(re),ze,Ce),defaultValue:re,conditionParams:ee,conditionForValue:ue,conditionedValue:ge},Ce)},e.Script=function N(re,ee){return t({type:"script",defaultValue:re},ee)},e.For=function j(re){return 0},e.getDefaultValues=k,e.resolveRefs=W,e.setDefaultValues=function K(re,ee){for(var ue=0,ge=Object.keys(re);ue<ge.length;ue++){var Ce=ge[ue];re[Ce].isOptional||(re[Ce].defaultValue=ee[Ce])}},e.clone=function ne(re){return Gl(re)},e.validate=function X(re,ee){},e.areEqual=L,e.isParamEqual=Y,e.merge=$,e.mergeParam=Z,e.normalizeParams=te,e.objectToOptions=function ae(re,ee){for(var ue=[],ge=0,Ce=Object.keys(re);ge<Ce.length;ge++){var ze=Ce[ge];if(ee){var je=ee(ze,re[ze]);ue.push("string"==typeof je?[ze,je]:[ze,je[0],je[1]])}else ue.push("string"==typeof re[ze]?[ze,re[ze]]:[ze,null===ee?ze:kc(ze)])}return ue},e.arrayToOptions=function fe(re,ee){for(var ue=[],ge=0,Ce=re;ge<Ce.length;ge++){var ze=Ce[ge];ue.push(ee?[ze,ee(ze)]:[ze,null===ee?ze:kc(ze)])}return ue},e.optionLabel=function he(re,ee){for(var ue=0,ge=re.options;ue<ge.length;ue++){var Ce=ge[ue];if(Ce[0]===ee)return Ce[1]}return""}}(D||(D={}));var mr,SNe=9,NT=-27.888,CNe=-.5,GZ=-9.9;function xNe(e,t,r,n){var a=S.distance(e,n),i=S.distance(t,n),o=S.distance(t,r),s=S.distance(e,r),l=NT/a-NT/i+(NT/o-NT/s);return l<GZ?GZ:l}!function(e){e.is=rs.has,e.create=rs.create}(mr||(mr={}));var kT=function(){return function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}}();function ENe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(0===t.type){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function INe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&0===t.nextLadder&&(0===e.type?HZ(e,t):HZ(t,e))}function HZ(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function jZ(e){return mr.is(e,8)||mr.is(e,1)||mr.is(e,16)}var pp,kNe={oldDefinition:D.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:D.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function BNe(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,d,p,h,m,v,g,y,b,_,C,x;return le(this,function(A){for(r=function NNe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),c=new Int32Array(a),l=0;l<a;++l){var d=n[r[l]];i[l]=d,o[l]=t.findAtomOnResidue(d,"C"),s[l]=t.findAtomOnResidue(d,"H"),u[l]=t.findAtomOnResidue(d,"O"),c[l]=t.findAtomOnResidue(d,"N")}return{residueIndices:Xe.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:c}}(e),a=function FNe(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,c=t.length;u<c;++u)s[u]=o[t[u]];var l={x:n,y:a,z:i,indices:Xe.ofSortedArray(s)};return tp(l,up(l))}(e,n=r.residueIndices),i=function wNe(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,c=e.conformation.invariantPosition,l=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],p=[],h=[],m=S(),v=S(),g=S(),y=S(),b=S(),_=S(),C=S(),x=0,A=n.length;x<A;++x){var T=x,w=n[x],E=s[T],I=a[T],M=l[w];if(-1!==E&&-1!==I&&-1===u.findAtomOnResidue(w,"OXT")){c(E,m),c(I,v),c(M,g);for(var F=r.find(g[0],g[1],g[2],SNe),N=F.indices,j=F.count,k=0;k<j;++k){var H=N[k];if(H!==T&&H-1!==T&&H+1!==T){var G=o[H];if(-1!==G){c(G,y);var U=i[H];if(-1===U){if(0===H)continue;var Q=H-1,W=s[Q],K=a[Q];if(-1===W||-1===K)continue;c(W,C),c(K,_),S.sub(b,_,C);var ne=S.distance(C,_);S.scaleAndAdd(b,y,b,1/ne)}else c(U,b);var X=xNe(m,v,y,b);X>CNe||(f[f.length]=T,p[p.length]=H,h[h.length]=X)}}}}}return function ANe(e,t,r,n){for(var a=new Cu.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}(d,f,p,h)}(e,r,a),o=n.length,s=new Uint32Array(o),u=function ONe(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,c=function(x,A){return-1===x?S.setNaN(A):i(x,A)},l=S(),d=S(),f=S(),p=S(),h=S(),m=S(),v=S(),g=S(),y=S();if(0===u)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),_=new Float32Array(u-1);c(-1,l),c(-1,d),c(-1,f),c(r[0],p),c(s[a[0]],h),c(n[0],m),c(r[1],v),c(s[a[1]],g),c(n[1],y);for(var C=0;C<u-1;++C)-1===o.findAtomOnResidue(a[C],"OXT")&&(b[C]=Ju(S.dihedralAngle(l,m,h,p)),_[C]=Ju(S.dihedralAngle(m,h,p,y)),l=p,d=h,f=m,p=v,h=g,m=y,c(r[C+1],v),c(s[a[C+1]],g),c(n[C+1],y));return{phi:b,psi:_}}(e,r),function TNe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(-1!==r.getDirectedEdgeIndex(o,o+i+3))if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=64|a[i+3];else for(u=0;u<=i+3;++u)n[o+u]|=64|a[i+3]}(p={params:t,getResidueFlag:d=t.oldDefinition?VNe:GNe,getFlagName:t.oldOrdering?zNe:HNe,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:[],bridges:[]}),function DNe(e){for(var r=e.flags,n=e.proteinInfo.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],c=1,l=n-u;c<l;c++){var d=mr.create(r[c]),f=mr.create(r[c-1]),p=mr.create(r[c+1]);if(e.params.oldOrdering){if(3===u&&(mr.is(d,1)||mr.is(p,1))||5===u&&(mr.is(d,1)||mr.is(d,8)||mr.is(p,1)||mr.is(p,8)))continue}else if(4===u&&(mr.is(d,8)||mr.is(p,8))||5===u&&(mr.is(d,1)||mr.is(d,8)||mr.is(p,1)||mr.is(p,8)))continue;if(mr.is(d,a[u])&&mr.is(d,a[u-3])&&mr.is(f,a[u])&&mr.is(f,a[u-3]))if(e.params.oldDefinition)for(var h=0;h<u;h++)r[c+h]|=i[u];else for(h=-1;h<=u;h++)r[c+h]|=i[u]}}(p),function _Ne(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,c=function(I,M){return-1===I?S.setNaN(M):a(I,M)},l=S(),d=S(),f=S(),p=S(),h=S(),m=S(),v=S();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(c(i[b],p),c(s[b+1],h),S.squaredDistance(p,h)>6.25)continue e}var T=i[o[g]],w=i[o[g+2]];c(i[o[g-2]],l),c(T,d),c(w,f),S.sub(m,l,d),S.sub(v,d,f);var E=Ju(S.angle(m,v));E&&E>70&&(r[g]|=32)}}(p),function MNe(e){for(var s,u,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,c=0,l=e.proteinInfo.residueIndices.length;c<l;++c)for(var d=i[c],f=i[c+1];d<f;d++){var p=o[d];c>p||((s=c+1)!==(u=p)&&-1!==r.getDirectedEdgeIndex(u,s+1)&&(n[s]|=2,n[u]|=2,a[a.length]=new kT(s,u,0)),(s=c)!==(u=p-1)&&-1!==r.getDirectedEdgeIndex(u-1,s)&&(n[s]|=2,n[u]|=2,a[a.length]=new kT(u,s,0)),(s=c)!==(u=p)&&-1!==r.getDirectedEdgeIndex(u,s)&&(n[s]|=2,n[u]|=2,a[a.length]=new kT(u,s,1)),(s=c+1)!==(u=p-1)&&-1!==r.getDirectedEdgeIndex(u-1,s+1)&&(n[s]|=2,n[u]|=2,a[a.length]=new kT(u,s,1)))}a.sort(function(h,m){return h.partner1>m.partner1?1:h.partner1<m.partner1?-1:0})}(p),function PNe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];ENe(s,a)&&(i=!0,s.firstEnd++,0===a.type?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var c=r[u],l=u;l<r.length;l++){var d=r[l];INe(c,d)&&(c.nextLadder=l,d.previousLadder=u)}}(p),function RNe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var s=a.secondStart-(a.firstStart-i);a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!jZ(r[i])&&mr.is(r[i],4)&&(r[i]|=2),!jZ(r[s])&&mr.is(r[s],4)&&(r[s]|=2))}if(0!==a.nextLadder){var u=t[a.nextLadder];for(i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(0===a.type)for(i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}(p),h=function jNe(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=mr.create(e[n]);r[n]=t(i)}return r}(s,d),m=new Uint32Array(o),v=[],g=[],y=function(T){return Xe.indexOf(n,T)},b=0,_=n.length;b<_;++b)m[b]=C=h[b],x=d(s[b]),(0===g.length||x!==g[g.length-1].flags)&&(g[g.length]=LNe(UNe(C),s[b],d)),v[b]=g.length-1;return[2,SZ(m,v,g,y)]})})}function LNe(e,t,r){return"helix"===e?{kind:"helix",flags:r(t)}:"sheet"===e?{kind:"sheet",flags:r(t)}:"turn"===e||"bend"===e?{kind:"turn",flags:r(t)}:{kind:"none"}}function UNe(e){return e===cn.SecondaryStructureDssp.H||e===cn.SecondaryStructureDssp.G||e===cn.SecondaryStructureDssp.I?"helix":e===cn.SecondaryStructureDssp.B||e===cn.SecondaryStructureDssp.E?"sheet":e===cn.SecondaryStructureDssp.T?"turn":e===cn.SecondaryStructureDssp.S?"bend":"none"}function VNe(e){return mr.is(e,1)?cn.SecondaryStructureDssp.H:mr.is(e,4)?cn.SecondaryStructureDssp.E:mr.is(e,2)?cn.SecondaryStructureDssp.B:mr.is(e,8)?cn.SecondaryStructureDssp.G:mr.is(e,16)?cn.SecondaryStructureDssp.I:mr.is(e,64)?cn.SecondaryStructureDssp.T:mr.is(e,32)?cn.SecondaryStructureDssp.S:0}function zNe(e){return mr.is(e,1)?"H":mr.is(e,4)?"E":mr.is(e,2)?"B":mr.is(e,8)?"G":mr.is(e,16)?"I":mr.is(e,64)?"T":mr.is(e,32)?"S":"-"}function GNe(e){return mr.is(e,16)?cn.SecondaryStructureDssp.I:mr.is(e,1)?cn.SecondaryStructureDssp.H:mr.is(e,4)?cn.SecondaryStructureDssp.E:mr.is(e,2)?cn.SecondaryStructureDssp.B:mr.is(e,8)?cn.SecondaryStructureDssp.G:mr.is(e,64)?cn.SecondaryStructureDssp.T:mr.is(e,32)?cn.SecondaryStructureDssp.S:0}function HNe(e){return mr.is(e,16)?"I":mr.is(e,1)?"H":mr.is(e,4)?"E":mr.is(e,2)?"B":mr.is(e,8)?"G":mr.is(e,64)?"T":mr.is(e,32)?"S":"-"}function qZ(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(ir.isFromPdbArchive(a)||ir.hasSecondaryStructure(a)){t="model";break}}}return{type:D.MappedStatic(t,{model:D.EmptyGroup({label:"Model"}),dssp:D.Group(kNe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}!function(e){function t(n){var a=this,i=n.descriptor.name,o="root"===n.type?"inheritedPropertyData":"currentPropertyData",s=function(c){return i in c[o]||(c[o][i]={props:R({},D.getDefaultValues(n.getParams(c))),data:Bh.create(void 0)}),c[o][i]},u=function(c,l,d){var f=s(c);c[o][i]={props:l,data:Bh.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(c){var l=D.clone(n.getParams(c));return D.setDefaultValues(l,s(c).props),l},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(c,l,d,f){return void 0===d&&(d={}),ce(a,void 0,void 0,function(){var p,h,m,v,g,y;return le(this,function(b){switch(b.label){case 0:return f&&l.customPropertyDescriptors.reference(n.descriptor,!0),"root"===n.type&&(l=l.root),p=s(l.root).props,h=s(l),m=D.merge(n.defaultParams,p,d),h.data.value&&D.areEqual(n.defaultParams,h.props,m)?[2]:[4,n.obtain(c,l,m)];case 1:return v=b.sent(),g=v.value,y=v.assets,l.customPropertyDescriptors.add(n.descriptor),l.customPropertyDescriptors.assets(n.descriptor,y),u(l,m,g),[2]}})})},ref:function(c,l){return c.customPropertyDescriptors.reference(n.descriptor,l)},get:function(c){return s(c).data},set:function(c,l,d){void 0===l&&(l={}),"root"===n.type&&(c=c.root);var f=s(c),p=D.merge(n.defaultParams,f.props,l);D.areEqual(n.defaultParams,f.props,p)||(u(c,p,d),c.customPropertyDescriptors.assets(n.descriptor))},props:function(c){return s(c).props}}}e.createProvider=t,e.createSimple=function r(n,a,i){var o=this,s={value:D.Value(i,{isHidden:!0})};return t({label:kc(n),descriptor:ec({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:D.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,c,l){return ce(o,void 0,void 0,function(){return le(this,function(d){return[2,R(R({},D.getDefaultValues(s)),l)]})})}})}}(pp||(pp={}));var WZ=qZ(),Hc=pp.createProvider({label:"Secondary Structure",descriptor:ec({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:WZ,getParams:qZ,isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,o;return le(this,function(s){switch(s.label){case 0:switch((n=R(R({},D.getDefaultValues(WZ)),r)).type.name){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,qNe(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,WNe(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function qNe(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o;return le(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?Oe.isAtomic(i=e.unitSymmetryGroups[n].units[0])&&!ir.isCoarseGrained(i.model)?[4,BNe(i,t)]:[3,3]:[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function WNe(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i;return le(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)Oe.isAtomic(a=e.unitSymmetryGroups[r].units[0])&&(i=zv.Provider.get(a.model))&&t.set(a.invariantId,i);return[2,t]})})}function Na(){throw new Error("Property only available for atomic models.")}function hp(e){throw e?new Error("Property only available for coarse models (".concat(e,").")):new Error("Property only available for coarse models.")}var Q2={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Na()},occupancy:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Na()},B_iso_or_equiv:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Na()},sourceIndex:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Na()},label_atom_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Na()},auth_atom_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Na()},label_alt_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Na()},label_comp_id:BT,auth_comp_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Na()},pdbx_formal_charge:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Na()},vdw_radius:function(e){return Oe.isAtomic(e.unit)?G2(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Na()}};function BT(e){return Oe.isAtomic(e.unit)||Na(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function _4(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Na()}function YZ(e){Oe.isAtomic(e.unit)||Na();var t=e.unit.model.sequence.byEntityKey[$s(e)];return t&&t.sequence.microHet.get(_4(e))||[BT(e)]}var KNe={key:function(e){return Oe.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Na()},group_PDB:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Na()},label_seq_id:_4,auth_seq_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Na()},pdbx_PDB_ins_code:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Na()},isNonStandard:function(e){return Oe.isAtomic(e.unit)?YZ(e).some(function(t){return"n"===e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]}):Na()},hasMicroheterogeneity:function XNe(e){Oe.isAtomic(e.unit)||Na();var t=e.unit.model.sequence.byEntityKey[$s(e)];return t&&t.sequence.microHet.has(_4(e))},microheterogeneityCompIds:YZ,secondary_structure_type:function(e){var t;Oe.isAtomic(e.unit)||Na();var r=null===(t=Hc.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId);return r?r.type[r.getIndex(e.unit.residueIndex[e.element])]:536870912},secondary_structure_key:function(e){var t;Oe.isAtomic(e.unit)||Na();var r=null===(t=Hc.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId);return r?r.key[r.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:function(e){return Oe.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(BT(e)).type:Na()}},ZNe={key:function(e){return Oe.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Na()},label_asym_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Na()},auth_asym_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Na()},label_entity_id:function(e){return Oe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Na()}},QNe={key:Q2.key,entityKey:function(e){return Oe.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:hp()},x:Q2.x,y:Q2.y,z:Q2.z,asym_id:function(e){return Oe.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):hp()},entity_id:function(e){return Oe.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):hp()},seq_id_begin:function(e){return Oe.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):hp()},seq_id_end:function(e){return Oe.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):hp()},sphere_radius:function(e){return Oe.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:hp("spheres")},sphere_rmsf:function(e){return Oe.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:hp("spheres")},gaussian_weight:function(e){return Oe.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:hp("gaussians")},gaussian_covariance_matrix:function(e){return Oe.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:hp("gaussians")}};function $s(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var $Ne={key:$s,id:function(e){return e.unit.model.entities.data.id.value($s(e))},type:function(e){return e.unit.model.entities.data.type.value($s(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value($s(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value($s(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value($s(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value($s(e))},details:function(e){return e.unit.model.entities.data.details.value($s(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value($s(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value($s(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value($s(e))},subtype:function(e){return e.unit.model.entities.subtype.value($s(e))},prd_id:function(e){var t,r;return null!==(r=null===(t=e.unit.model.entities.prd_id)||void 0===t?void 0:t.value($s(e)))&&void 0!==r?r:""}},JNe=[],e4e={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return Oe.Traits.is(e.unit.traits,Oe.Trait.MultiChain)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},operator_key:function(e){return e.unit.conformation.operator.key},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.id)||sa.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.operList)||JNe},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},it={constant:{true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}},atom:Q2,residue:KNe,chain:ZNe,entity:$Ne,unit:e4e,coarse:QNe},$2=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=null!==(r=t?.checkOperator)&&void 0!==r&&r}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||this.index.set(t.label_asym_id,r=new Map);var n=r.get(t.label_seq_id);return n||r.set(t.label_seq_id,n=[]),!this._find(t,n)&&(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=XZ(t);if(this.index.has(a)){var i=this.index.get(a),o=KZ(t);if(i.has(o))for(var s=i.get(o),u=ZZ(t),c=QZ(t),l=$Z(t),d=null!==(r=JZ(t))&&void 0!==r?r:"1_555",f=0,p=s;f<p.length;f++){var h=p[f];if(h.label_comp_id===u&&h.label_alt_id===c&&h.ins_code===l&&(!this.checkOperator||(null!==(n=h.operator_name)&&void 0!==n?n:"1_555")===d))return h}}},e.getLabel=function(t,r){var n;return void 0===r&&(r=!1),"".concat(t.label_asym_id," ").concat(t.label_comp_id," ").concat(t.label_seq_id,":").concat(t.ins_code,":").concat(t.label_alt_id).concat(r?" "+(null!==(n=t.operator_name)&&void 0!==n?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:XZ(t),label_comp_id:ZZ(t),label_seq_id:KZ(t),label_alt_id:QZ(t),ins_code:$Z(t),operator_name:null!==(r=JZ(t))&&void 0!==r?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(s.label_comp_id===t.label_comp_id&&s.label_alt_id===t.label_alt_id&&s.ins_code===t.ins_code&&(!this.checkOperator||(null!==(n=s.operator_name)&&void 0!==n?n:"1_555")===(null!==(a=t.operator_name)&&void 0!==a?a:"1_555")))return!0}return!1},e}(),XZ=it.chain.label_asym_id,KZ=it.residue.label_seq_id,ZZ=it.atom.label_comp_id,QZ=it.atom.label_alt_id,$Z=it.residue.pdbx_PDB_ins_code,JZ=it.unit.operator_name;function By(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(0===o.kind){var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,c=o.elements;n.beginUnit(o.id);for(var l=tr.transientSegments(s,c);l.hasNext;)for(var d=l.move().index,f=s.offsets[d],p=s.offsets[d+1];f<p;f++)Xe.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}else n.setUnit(o.id,o.elements)}return n.getStructure()}function t4e(e){return function(r){var n=e(r);if(mt.isSingleton(n))return mt.Singletons(r.inputStructure,By(r,r.inputStructure,n.structure));for(var a=new XN(r.inputStructure),i=0,o=n.structures;i<o.length;i++)a.add(By(r,r.inputStructure,o[i]));return a.getSelection()}}function S4(e,t,r,n){for(var a=new AT(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var c=u[s],l=c.conformation,d=l.x,f=l.y,p=l.z,h=c.elements,m=0,v=h.length;m<v;m++){var g=h[m];i.findIntoBuilder(d(g),f(g),p(g),o,a)}e.throwIfTimedOut()}return n.wholeResidues?By(e,t,a.getStructure()):a.getStructure()}function eQ(e,t,r,n){var a=new AT(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,c=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var l=0,d=r.units;l<d.length;l++){var f=d[l];e.element.unit=f;for(var p=f.conformation,h=p.x,m=p.y,v=p.z,g=f.elements,y=0,b=g.length;y<b;y++){var _=g[y];e.element.element=_;var C=o(e);i.findIntoBuilderWithRadius(h(_),m(_),v(_),C,u,c,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?By(e,t,a.getStructure()):a.getStructure()}function r4e(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function n4e(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){e.element.element=o[s];var l=t(e);l>r&&(r=l)}}return e.throwIfTimedOut(),r}function a4e(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=R(R({},t),{elementRadius:t.elementRadius,elementRadiusClosure:r4e(n,t.elementRadius),sourceMaxRadius:n4e(n,t.elementRadius)});if(mt.isSingleton(a)){var o=eQ(n,n.inputStructure,a.structure,i);return mt.Singletons(n.inputStructure,o)}for(var u=new XN(n.inputStructure),c=0,l=a.structures;c<l.length;c++)u.add(eQ(n,n.inputStructure,l[c],i));return u.getSelection()}if(mt.isSingleton(a))return o=S4(n,n.inputStructure,a.structure,t),mt.Singletons(n.inputStructure,o);u=new XN(n.inputStructure);for(var f=0,p=a.structures;f<p.length;f++)u.add(S4(n,n.inputStructure,p[f],t));return u.getSelection()}}function i4e(e,t){return function(n){var a=e(n);if(0===mt.structureCount(a))return a;var i=mt.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return mt.forEach(a,function(s,u){n.pushInputStructure(s),mt.forEach(t(n),o),n.popInputStructure(),u%10==0&&n.throwIfTimedOut()}),i.getSelection()}}function o4e(e,t){return function(n){var a=e(n);if(0===mt.structureCount(a))return a;var i=t(n);if(0===mt.structureCount(i))return mt.Empty(n.inputStructure);var o=mt.unionStructure(i),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(a,function(u,c){var l=nZ(o,u);0!==l.elementCount&&s.add(l),c%50==0&&n.throwIfTimedOut()}),s.getSelection()}}function s4e(e,t){return function(n){var a=e(n);if(0===mt.structureCount(a))return a;var i=t(n);if(0===mt.structureCount(i))return a;var o=mt.unionStructure(i),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(a,function(u,c){var l=WN(u,o);0!==l.elementCount&&s.add(l),c%50==0&&n.throwIfTimedOut()}),s.getSelection()}}function u4e(e){return function(r){var n=mt.LinearBuilder(r.inputStructure);return n.add(mt.unionStructure(e(r))),n.getSelection()}}function c4e(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),mt.forEach(a,function(C,x){n.element.structure=C;for(var A=0,T=C.units;A<T.length;A++){var w=T[A];n.element.unit=w;for(var E=w.elements,I=0,M=E.length;I<M;I++){n.element.element=E[I];var F=t(n),N=void 0;i.has(F)?N=i.get(F):(N=On.create(),i.set(F,N)),On.add(N,x,x)}}o[x]=n.inputStructure.subsetBuilder(!0),x%10==0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var c=u[s];n.element.unit=c;for(var l=c.elements,d=0,f=l.length;d<f;d++){n.element.element=l[d];var p=t(n);if(i.has(p))for(var h=i.get(p).array,m=0,v=h.length;m<v;m++)o[h[m]].addToUnit(c.id,l[d])}}n.popCurrentElement();for(var g=mt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++)g.add(b[y].getStructure());return g.getSelection()}}function l4e(e){var t=e.query,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(e.layerCount,0);return function(u){var c=mt.UniqueBuilder(u.inputStructure),l=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),mt.forEach(l,function(d,f){var p=d;if(i)for(;;){var h=p.elementCount;if((p=tQ(u,n,p)).elementCount===h)break}else for(var m=0;m<o;m++)p=tQ(u,n,p);c.add(p),f%10==0&&u.throwIfTimedOut()}),u.popCurrentBond(),c.getSelection()}}function tQ(e,t,r){var n=function d4e(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new AT(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(0===u.kind){var d=r.unitMap.get(u.id),f=d.bonds,p=f.offset,h=f.b,m=f.edgeProps,v=m.flags,g=m.order,y=m.key;for(i.setStructure(r),i.a.unit=d,i.b.unit=d,c=0,l=u.elements.length;c<l;c++){a.addToUnit(u.id,u.elements[c]);for(var b=Xe.indexOf(d.elements,u.elements[c]),_=p[b],C=p[b+1];_<C;_++){var x=h[_];Xe.has(u.elements,A=d.elements[x])||a.has(u.id,A)||(i.aIndex=b,i.a.element=u.elements[c],i.bIndex=x,i.b.element=A,i.type=v[_],i.order=g[_],i.key=y[_],i.test(e,!0)&&a.addToUnit(u.id,A))}}for(var T=0,w=n.getConnectedUnits(d.id);T<w.length;T++)for(var E=w[T],I=t.unitMap.get(E.unitB),M=r.unitMap.get(E.unitB),F=0,N=E.connectedIndices;F<N.length;F++){var j=N[F];if(Xe.has(u.elements,d.elements[j]))for(var k=0,H=E.getEdges(j);k<H.length;k++){var G=H[k],A=M.elements[G.indexB];I&&Xe.has(I.elements,A)||a.has(E.unitB,A)||(i.a.unit=d,i.aIndex=j,i.a.element=d.elements[j],i.b.unit=M,i.bIndex=G.indexB,i.b.element=A,i.type=G.props.flag,i.order=G.props.order,i.key=G.props.key,i.test(e,!0)&&a.addToUnit(E.unitB,A))}}}else{a.beginUnit(u.id);for(var c=0,l=u.elements.length;c<l;c++)a.addElement(u.elements[c]);a.commitUnit()}}return a.getStructure()}(e,r);return t?By(e,e.inputStructure,n):n}function f4e(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=mt.unionStructure(t(i)),s=By(i,i.inputStructure,S4(i,i.inputStructure,o,{radius:r})),u=function m4e(e){var t=e.models[0],r=new Set;if(!Pn.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}(i.inputStructure),c=function v4e(e){var t,r,n=e.models[0],a=new g4e;if(!Pn.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,c=i.ptnr1_label_seq_id,l=i.ptnr1_symmetry,d=i.pdbx_ptnr1_label_alt_id,f=i.pdbx_ptnr1_PDB_ins_code,p=i.ptnr2_label_asym_id,h=i.ptnr2_label_comp_id,m=i.ptnr2_label_seq_id,v=i.ptnr2_symmetry,g=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,b=0;b<i._rowCount;b++){var _=o.value(b);if("covale"===_||"metalc"===_){var C={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:c.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:null!==(t=l.value(b))&&void 0!==t?t:"1_555"},x={label_asym_id:p.value(b),label_comp_id:h.value(b),label_seq_id:m.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:null!==(r=v.value(b))&&void 0!==r?r:"1_555"};a.addEdge(C,x)}}return a}(i.inputStructure),l=at.create(s),d=new Map,f=new $2({checkOperator:!0}),p=0,h=s.units;p<h.length;p++)if(0===(m=h[p]).kind){l.unit=m;for(var g=tr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,v=m.elements),y=tr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,v);g.hasNext;){var b=g.move();l.element=v[b.start];var _=it.chain.label_asym_id(l),C=it.unit.operator_name(l);if(u.has(_))d.has(_)?$a(d.get(_),C):d.set(_,[C]);else{var x=it.entity.type(l);if("water"!==x&&"polymer"!==x)for(y.setSegment(b);y.hasNext;){var A=y.move();l.element=v[A.start],c.addComponent($2.getEntryFromLocation(l),f)}}}i.throwIfTimedOut()}for(var T=i.inputStructure.subsetBuilder(!0),w=0,E=i.inputStructure.units;w<E.length;w++)if(0===(m=E[w]).kind){for(l.unit=m,g=tr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,v=m.elements),y=tr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,v),T.beginUnit(m.id);g.hasNext;)if(b=g.move(),l.element=v[b.start],_=it.chain.label_asym_id(l),C=it.unit.operator_name(l),d.has(_)&&d.get(_).indexOf(C)>=0)T.addElementRange(v,b.start,b.end);else if(f.hasLabelAsymId(_))for(y.setSegment(b);y.hasNext;)A=y.move(),l.element=v[A.start],f.has(l)&&T.addElementRange(v,A.start,A.end);T.commitUnit(),i.throwIfTimedOut()}var I=L2(i.inputStructure,[T.getStructure(),o]);if(n){for(var M=new AT(i.inputStructure),F=i.inputStructure.lookup3d,N=0,j=I.units;N<j.length;N++){for(var m,v,k=(m=j[N]).conformation,H=k.x,G=k.y,U=k.z,Q=0,W=(v=m.elements).length;Q<W;Q++){var K=v[Q];F.findIntoBuilderIf(H(K),G(K),U(K),r,M,h4e),M.addToUnit(m.id,K)}i.throwIfTimedOut()}return mt.Sequence(i.inputStructure,[M.getStructure()])}return mt.Sequence(i.inputStructure,[I])}}var p4e=it.entity.type;function h4e(e){return"water"===p4e(e)}var LT,UT,C4,g4e=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=$2.getLabel(t),a=$2.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),$a(this.edges.get(n),a),$a(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=$2.getLabel(t);if(this.vertices.has(n)){var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),c=0,l=this.edges.get(s);c<l.length;c++){var d=l[c];if(!a.has(d)&&(o.push(d),!i.has(d))){i.add(d);var f=this.vertices.get(d);r.add(u.operator_name===f.operator_name?R(R({},f),{operator_name:t.operator_name}):f)}}}}else r.add(t)},e}();function _4e(e,t){return function(r){var n=e(r),a=mt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),mt.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function S4e(e){return function(t){var r=e(t),n=mt.LinearBuilder(t.inputStructure);if("singletons"===r.kind){if(r.structure.elementCount>0){var a=r.structure.units[0],i=Ye.create([a.getChild(Xe.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function VT(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,c=t;if(c){for(var l=0,d=u.length;l<d;l++)a.element=u[l],r.add(c(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function x4e(e,t,r){return function(n){var a=e(n),i=function C4e(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),mt.forEach(a,function(i,o){e.currentStructure=i,VT(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}(n,t,r),o=mt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),mt.forEach(a,function(s,u){n.currentStructure=s;var c=VT(n,r,new Set);fa.isSuperset(i,c)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function w4e(e,t){return function(r){var n=mt.unionStructure(t(r)),a=mt.LinearBuilder(r.inputStructure);return mt.forEach(e(r),function(i,o){wT(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function A4e(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return 0===r.minRadius&&typeof e.minRadius>"u"?function T4e(e){var t=e.queryCtx,r=e.selection,a=e.maxRadius,i=e.invert,o=mt.unionStructure(e.target).lookup3d,s=mt.LinearBuilder(t.inputStructure),u=S.zero();return mt.forEach(r,function(c,l){for(var d=c.units,f=!1,p=0,h=d.length;p<h;p++){for(var m=d[p],v=m.elements,g=m.conformation,y=g.position,b=g.r,_=0,C=v.length;_<C;_++){var x=v[_];if(y(x,u),o.check(u[0],u[1],u[2],a+b(x))){f=!0;break}}if(f)break}i&&(f=!f),f&&s.add(c),l%10==0&&t.throwIfTimedOut()}),s.getSelection()}(r):0===r.minRadius?function D4e(e){var t=e.queryCtx,r=e.selection,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=mt.unionStructure(e.target),u=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(c,l){var d=function b4e(e,t,r,n,a){return 0===t.elementCount||0===r.elementCount||(t.elementCount<=r.elementCount?UT.check(e,t,r,n,a):UT.check(e,r,t,n,a))}(t,s,c,a,o);i&&(d=!d),d&&u.add(c),l%10==0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}(r):function E4e(e){var t=e.queryCtx,r=e.selection,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=mt.unionStructure(e.target),c=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(l,d){var f=function y4e(e,t,r,n,a,i){return 0===t.elementCount||0===r.elementCount||(t.elementCount<=r.elementCount?LT.check(e,t,r,n,a,i):LT.check(e,r,t,n,a,i))}(t,u,l,a,i,s);o&&(f=!f),f&&c.add(l),d%10==0&&t.throwIfTimedOut()}),t.popCurrentElement(),c.getSelection()}(r)}}function P4e(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(mt.isEmpty(s))return s;var u=t(o);if(mt.isEmpty(u))return u;var c={queryCtx:o,input:o.inputStructure,disjunct:n,target:mt.unionStructure(s)},l=mt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),mt.forEach(u,function(d,f){(function I4e(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,c=t.units;u<c.length;u++){var l=c[u];if(Oe.isAtomic(l))for(var d=n.unitMap.get(l.id),f=d.bonds,p=f.offset,h=f.b,m=f.edgeProps,v=m.flags,g=m.order,y=m.key,b=s.getConnectedUnits(l.id),_=b.length,C=l.elements,x=d.elements,A=0,T=C.length;A<T;A++){var w=Xe.indexOf(x,C[A]);o.a.unit=d,o.b.unit=d;for(var E=p[w],I=p[w+1];E<I;E++)if(o.b.element=d.elements[h[E]],(!i||!Xe.has(l.elements,o.b.element))&&a.hasElement(o.b)&&(o.aIndex=w,o.a.element=C[A],o.bIndex=h[E],o.type=v[E],o.order=g[E],o.key=y[E],o.test(r,!0)))return!0;for(var M=0;M<_;M++)for(var F=b[M],N=n.unitMap.get(F.unitB),j=N.elements,k=F.getEdges(w),H=0,G=k.length;H<G;H++){var U=k[H];if(o.b.unit=N,o.b.element=j[U.indexB],a.hasElement(o.b)&&(!i||!t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=w,o.a.element=C[A],o.bIndex=U.indexB,o.type=U.props.flag,o.order=U.props.order,o.key=U.props.key,o.test(r,!0)))return!0}}}return!1}(c,d)||a)&&l.add(d),f%5==0&&o.throwIfTimedOut()}),o.popCurrentBond(),l.getSelection()}}function M4e(e){return 0===e.length?KN:1===e.length?e[0]:function(t){for(var r=mt.UniqueBuilder(t.inputStructure),n=function(i){mt.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function R4e(e){return 0===e.length?KN:1===e.length?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));var a=0,i=mt.structureCount(r[0]);for(n=1;n<r.length;n++){var o=mt.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=CN(function(l){return l.hashCode},Ye.areUnitIdsAndIndicesEqual);mt.forEach(r[a],function(l){return s.add(l)});for(var u=mt.UniqueBuilder(t.inputStructure),c=0;c<r.length;c++)c!==a&&(mt.forEach(r[c],function(l){s.has(l)&&u.add(l)}),t.throwIfTimedOut());return u.getSelection()}}function O4e(e){return e.currentStructure.elementCount}function F4e(e){return function(t){var r=e(t);return mt.structureCount(r)}}function N4e(e){return function(t){return VT(t,e,new Set)}}!function(e){var t=S.zero();function r(o,s,u,c,l,d,f){var p=s.elements,h=s.conformation.position,m=t;o.element.unit=s;for(var v=!1,g=0,y=p.length;g<y;g++){var b=p[g];o.element.element=b;var _=Math.max(0,S.distance(u,h(b,m))-c-f(o));if(_<l)return 0;_<d&&(v=!0)}return v?1:2}function n(o,s,u,c,l,d,f){for(var p=s.units,h=!1,m=0,v=p.length;m<v;m++){var g=r(o,p[m],u,c,l,d,f);if(0===g)return 0;1===g&&(h=!0)}return h?1:2}var a=S.zero();e.check=function i(o,s,u,c,l,d){if(0===s.elementCount||0===u.elementCount)return 0;var f=s.units,p=!1;o.element.structure=s;for(var h=0,m=f.length;h<m;h++){var v=f[h],g=v.elements,y=v.conformation.position;o.element.unit=v;for(var b=0,_=g.length;b<_;b++){var C=g[b];o.element.element=C;var x=n(o,u,y(C,a),d(o),c,l,d);if(0===x)return!1;1===x&&(p=!0)}}return p}}(LT||(LT={})),function(e){var t=S.zero();function r(o,s,u,c,l,d){var f=s.elements,p=s.conformation.position,h=t;o.element.unit=s;for(var m=0,v=f.length;m<v;m++){var g=f[m];if(o.element.element=g,Math.max(0,S.distance(u,p(g,h))-c-d(o))<=l)return!0}return!1}function n(o,s,u,c,l,d){for(var f=s.units,p=0,h=f.length;p<h;p++)if(r(o,f[p],u,c,l,d))return!0;return!1}var a=S.zero();e.check=function i(o,s,u,c,l){if(0===s.elementCount||0===u.elementCount)return 0;var d=s.units;o.element.structure=s;for(var f=0,p=d.length;f<p;f++){var h=d[f];o.element.unit=h;for(var m=h.elements,v=h.conformation.position,g=0,y=m.length;g<y;g++){var b=m[g];if(o.element.element=b,n(o,u,v(b,a),l(o),c,l))return!0}}return!1}}(UT||(UT={})),function(e){function s(f){return!0}function u(f){return!1}e.eq=function r(f,p){return function(h){return f(h)===p}},e.lt=function n(f,p){return function(h){return f(h)<p}},e.lte=function a(f,p){return function(h){return f(h)<=p}},e.gt=function i(f,p){return function(h){return f(h)>p}},e.gte=function o(f,p){return function(h){return f(h)>=p}},e.inSet=function c(f,p){if(function t(f){return!!f&&!!f.has}(p))return function(v){return p.has(f(v))};if(0===p.length)return u;for(var h=new Set,m=0;m<p.length;m++)h.add(p[m]);return function(v){return h.has(f(v))}},e.and=function l(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return s;case 1:return f[0];case 2:var h=f[0],m=f[1];return function(U){return h(U)&&m(U)};case 3:var v=f[0],g=f[1],y=f[2];return function(U){return v(U)&&g(U)&&y(U)};case 4:var b=f[0],_=f[1],C=f[2],x=f[3];return function(U){return b(U)&&_(U)&&C(U)&&x(U)};case 5:var A=f[0],T=f[1],w=f[2],E=f[3],I=f[4];return function(U){return A(U)&&T(U)&&w(U)&&E(U)&&I(U)};case 6:var M=f[0],F=f[1],N=f[2],j=f[3],k=f[4],H=f[5];return function(U){return M(U)&&F(U)&&N(U)&&j(U)&&k(U)&&H(U)};default:var G=f.length;return function(U){for(var Q=0;Q<G;Q++)if(!f[Q])return!1;return!0}}},e.or=function d(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return u;case 1:return f[0];case 2:var h=f[0],m=f[1];return function(U){return h(U)||m(U)};case 3:var v=f[0],g=f[1],y=f[2];return function(U){return v(U)||g(U)||y(U)};case 4:var b=f[0],_=f[1],C=f[2],x=f[3];return function(U){return b(U)||_(U)||C(U)||x(U)};case 5:var A=f[0],T=f[1],w=f[2],E=f[3],I=f[4];return function(U){return A(U)||T(U)||w(U)||E(U)||I(U)};case 6:var M=f[0],F=f[1],N=f[2],j=f[3],k=f[4],H=f[5];return function(U){return M(U)||F(U)||N(U)||j(U)||k(U)||H(U)};default:var G=f.length;return function(U){for(var Q=0;Q<G;Q++)if(f[Q])return!0;return!1}}}}(C4||(C4={}));var Hd,_n={generators:H3,filters:q3,modifiers:j3,combinators:W3,pred:C4,internal:O1,atomset:Y3};function k4e(e){return _n.generators.atoms({chainTest:_n.pred.and(_n.pred.eq(function(t){return it.unit.operator_name(t.element)},sa.DefaultName),_n.pred.inSet(function(t){return it.chain.label_asym_id(t.element)},e))})}function rQ(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],c=o.cell.toFractional,l=S.transformMat4(S(),i,c),d=xu.getSymmetryOperatorRef(o,t,r,n,a,l);if(s&&s.length)for(var f=0,p=s.length;f<p;++f){var h=s[f],m=me.mul(me(),d.matrix,h.matrix),v=sa.create("".concat(d.name," ").concat(h.name),m,{assembly:d.assembly,ncsId:h.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(v)}else u.push(d);return u}function nQ(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=xu.getSymmetryOperator(a,0,0,0,0));for(var u=0;u<a.operators.length;u++)for(var c=t[0];c<=r[0];c++)for(var l=t[1];l<=r[1];l++)for(var d=t[2];d<=r[2];d++)!o&&0===u&&0===c&&0===l&&0===d||s.push.apply(s,rQ(e,u,c,l,d,n));return s}function aQ(e,t){for(var r=Ye.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++)r.addWithOperator(u[s],o);return r.getStructure()}!function(e){function o(l,d){return l.invariantId===d.invariantId&&l.model.id===d.model.id&&Xe.areEqual(l.elements,d.elements)}function s(){return function SEe(e,t){return new _Ee(e,t)}(Oe.hashUnit,o)}e.buildAssembly=function t(l,d){var f=this;return Ve.create("Build Assembly",function(p){return ce(f,void 0,void 0,function(){var h,m,v,g,y,b,_,C,x,A,T,w,E,I,M;return le(this,function(N){if(1!==(h=l.models).length)throw new Error("Can only build assemblies from structures based on 1 model.");if(!(m=B2.findAssembly(h[0],d)))throw new Error("Assembly '".concat(d,"' is not defined."));for(v=sa.create(m.id,me.identity(),{assembly:{id:m.id,operId:0,operList:[]}}),g=Ye.Builder({coordinateSystem:v,label:l.label,dynamicBonds:l.dynamicBonds}),y=new Uc(l),b=0,_=m.operatorGroups;b<_.length;b++)if(x=(C=_[b]).selector(y),0!==mt.structureCount(x))for(A=mt.unionStructure(x).units,T=0,w=C.operators;T<w.length;T++)for(E=w[T],I=0,M=A;I<M.length;I++)g.addWithOperator(M[I],E);return[2,g.getStructure()]})})})},e.buildSymmetryAssembly=function r(l,d,f){var p=this;return Ve.create("Build Symmetry Assembly",function(h){return ce(p,void 0,void 0,function(){var m,v,g,y,b,_,C,x,A,T,w,E,I,F,H,G,U,Q,W,K;return le(this,function(X){if(1!==(m=l.models).length)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(v=S(),g=Ye.Builder({label:l.label,representativeModel:m[0],dynamicBonds:l.dynamicBonds}),y=new Uc(l),b=0,_=d;b<_.length;b++)if(x=k4e((C=_[b]).asymIds),A=x(y),0!==mt.structureCount(A))for(T=mt.unionStructure(A).units,w=0,E=C.operators;w<E.length;w++)for(H=rQ(f,(I=E[w]).index,(F=I.shift)[0],F[1],F[2],v),G=0,U=T;G<U.length;G++)for(Q=U[G],W=0,K=H;W<K.length;W++)g.addWithOperator(Q,K[W]);return[2,g.getStructure()]})})})},e.builderSymmetryMates=function n(l,d){return Ve.create("Find Symmetry Mates",function(f){return function V4e(e,t,r){return ce(this,void 0,void 0,function(){function n(E,I){return"".concat(E.invariantId,"|").concat(I.name)}var a,i,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,w;return le(this,function(E){switch(E.label){case 0:if(1!==(a=t.models).length)throw new Error("Can only build symmetries from structures based on 1 model.");return(i=ei.Provider.get(a[0]))?gs.isZero(i.spacegroup.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]:[2,t];case 1:E.sent(),E.label=2;case 2:s=ir.getCenter(a[0]),u=function B4e(e,t){return e._operators_333&&S.equals(t,e._operators_333.ref)||(e._operators_333={ref:S.clone(t),operators:nQ(e,S.create(-3,-3,-3),S.create(3,3,3),t)}),e._operators_333.operators}(i,s),c=t.lookup3d,l=new Set,d=Ye.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),f=t.units,p=S.zero(),h=0,m=u,E.label=3;case 3:if(!(h<m.length))return[3,6];for(v=m[h],g=0,y=f;g<y.length;g++)for(S.transformMat4(p,(_=(b=y[g]).lookup3d.boundary.sphere).center,v.matrix),C=c.findUnitIndices(p[0],p[1],p[2],_.radius+r),x=0,A=C.count;x<A;x++)f[C.indices[x]].lookup3d.check(p[0],p[1],p[2],_.radius+r)&&(w=n(b,v),l.has(w)||(d.addWithOperator(b,v),l.add(w)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:E.sent(),E.label=5;case 5:return h++,[3,3];case 6:return[2,d.getStructure()]}})})}(f,l,d)})},e.buildSymmetryRange=function a(l,d,f){return Ve.create("Build Symmetry",function(p){return function U4e(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,s,u;return le(this,function(c){if(1!==(a=t.models).length)throw new Error("Can only build symmetries from structures based on 1 model.");return(i=ei.Provider.get(a[0]))?gs.isZero(i.spacegroup.cell)?[2,t]:(s=ir.getCenter(a[0]),u=nQ(i,r,n,s),[2,aQ(t,u)]):[2,t]})})}(0,l,d,f)})},e.buildNcs=function i(l){return Ve.create("Build NCS",function(d){return function L4e(e,t){return ce(this,void 0,void 0,function(){var r,n,a;return le(this,function(i){if(1!==(r=t.models).length)throw new Error("Can only build NCS from structures based on 1 model.");return(n=ei.Provider.get(r[0]))&&(a=n.ncsOperators)&&a.length?[2,aQ(t,a)]:[2,t]})})}(0,l)})},e.areUnitsEquivalent=o,e.UnitEquivalenceBuilder=s,e.computeTransformGroups=function u(l){for(var d=s(),f=0,p=l.units;f<p.length;f++){var h=p[f];d.add(h.id,h)}for(var m=[],v=0,g=d.groups;v<g.length;v++)m.push(Oe.SymmetryGroup(g[v].map(function(b){return l.unitMap.get(b)})));return m},e.areTransformGroupsEquivalent=function c(l,d){if(l.length!==d.length)return!1;for(var f=0,p=l.length;f<p;++f){var h=l[f].units,m=d[f].units;if(h.length!==m.length||l[f].hashCode!==d[f].hashCode)return!1;for(var v=0,g=h.length;v<g;v++)if(h[v].conformation!==m[v].conformation)return!1}return!0}}(Hd||(Hd={}));var z4e=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Oc.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){0!==this.currentUnit.length&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return Ye.Empty;var r=[];Rc(this.ids);for(var n=Hd.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),c=!1;if(t&&(this.isSorted||Rc(u),u=Xe.deduplicate(Xe.ofSortedArray(this.currentUnit)),c=!0),u.length!==s.elements.length){!this.isSorted&&!c&&u.length>1&&Rc(u);var d=s.getChild(Xe.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}else r[r.length]=s,n.add(s.id,s)}return Ye.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.elementCount},enumerable:!1,configurable:!0}),e}();function iQ(e,t){for(var r=1;t--;)r*=e--;return r}var j4e=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=function G4e(e,t){return t>e?0:iQ(e,t)/iQ(t,t)}(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)1&n&&(this.value[r++]=this.array[t]);this.index=function H4e(e){var t=e&-e,r=e+t;return r|((r&-r)/t>>1)-1}(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function oQ(e,t){for(var r=[],n=new j4e(e,t);n.hasNext;)r.push(n.move().slice());return r}var Yv=[],q4e={links:Yv,terminalLinks:Yv,elements:Yv,partialElements:Yv,getElementIndices:function(){return Yv},getLinkIndices:function(){return Yv},getTerminalLinkIndices:function(){return Yv}},so=Ov("C"),J2=Ov("O"),W4e=[Lc.elementFingerprint([so,so,so,J2]),Lc.elementFingerprint([so,so,so,so,J2]),Lc.elementFingerprint([so,so,so,so,so,J2]),Lc.elementFingerprint([so,so,so,so,so,so,J2])];function Y4e(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,c=s.label_atom_id,l=e.bonds,d=l.b,f=l.offset,p=0,h=t.length;p<h;++p){var m=o[t[p]];if(u.value(m)===so){for(var v=0,g=0,y=f[t[p]],b=f[t[p]+1];y<b;++y){var C=u.value(o[d[y]]);C===J2?++v:C===so&&++g}if(2===v){r=m;break}1===v&&1===g?n=m:c.value(m).startsWith("C1")?a=m:i=m}}return-1!==r?r:-1!==n?n:-1!==a?a:-1!==i?i:o[t[0]]}function K4e(e,t,r,n){return S.normalize(e,S.sub(e,n,(0,t.conformation.position)(r,e))),e}function sQ(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function Z4e(e,t){if(t&&t.length){for(var r=e.unit,n=e.all,a=new Set,i=oQ(rc(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],c=n[t[u[0]]],l=n[t[u[1]]];Xe.areIntersecting(c,l)&&Lc.getAltId(r,c)===Lc.getAltId(r,l)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){var d=[];for(o=0,s=t.length;o<s;++o)a.has(t[o])||d.push(t[o]);return d}return t}}function Q4e(e,t){return t.properties.saccharideComponentMap.get(e)}var zT=De(),eke=new oc("14"),tke=new oc("98");var Ye=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i?.child,this._target=i?.target,this._proxy=void 0}return e.prototype.subsetBuilder=function(t){return new z4e(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return-1===this.state.bondCount&&(this.state.bondCount=this.interUnitBonds.edgeCount+Ht.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new zl),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return-1===this.state.polymerResidueCount&&(this.state.polymerResidueCount=function dke(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return-1===this.state.polymerGapCount&&(this.state.polymerGapCount=function fke(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return-1===this.state.polymerUnitCount&&(this.state.polymerUnitCount=function pke(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return-1===this.state.uniqueElementCount&&(this.state.uniqueElementCount=function lke(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return-1===this.state.atomicResidueCount&&(this.state.atomicResidueCount=function hke(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(Oe.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,c=-1,l=0,d=o.length;l<d;++l)(u=s[o[l]])!==c&&(r+=1,c=u)}return r}(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return ir.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.units.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return-1!==this.state.hashCode?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return-1!==this.state.transformHash||(this.state.transformHash=vs(this.units.map(function(t){return t.id}))),this.state.transformHash},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*(t=31*t+a.id|0)+Xe.hashCode(a.elements)|0}return-1===(t=vX(t=31*t+this.elementCount|0))&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){var t;return null!==(t=this.state.parent)&&void 0!==t?t:this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary||(this.state.boundary=function nke(e){var t=e.units,r=function rke(e){return e>500?eke:tke}(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var o=(i=t[n]).boundary;(s=i.conformation.operator).isIdentity?r.includeSphere(o.sphere):(De.transform(zT,o.sphere,s.matrix),r.includeSphere(zT))}for(r.finishedIncludeStep(),n=0,a=t.length;n<a;n++){var i,s;o=(i=t[n]).boundary,(s=i.conformation.operator).isIdentity?r.radiusSphere(o.sphere):(De.transform(zT,o.sphere,s.matrix),r.radiusSphere(zT))}return{box:r.getBox(),sphere:r.getSphere()}}(this)),this.state.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d||(this.state.lookup3d=new tOe(this)),this.state.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds||(this.state.interUnitBonds=this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&0===this.parent.state.interUnitBonds.edgeCount?new O2(new Map):lRe(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair})),this.state.interUnitBonds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dynamicBonds",{get:function(){return this.state.dynamicBonds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interBondsValidUnit",{get:function(){return this.state.interBondsValidUnit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interBondsValidUnitPair",{get:function(){return this.state.interBondsValidUnitPair},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups||(this.state.unitSymmetryGroups=Hd.computeTransformGroups(this)),this.state.unitSymmetryGroups},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap||(this.state.unitSymmetryGroupsIndexMap=Oe.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups)),this.state.unitSymmetryGroupsIndexMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates||(this.state.carbohydrates=function $4e(e){if(0===e.models.reduce(function(he,pe){return he+pe.properties.saccharideComponentMap.size},0))return q4e;var t=[],r=[],n=[],a=[],i=new Map;function o(he,pe,re){return"".concat(he,"|").concat(pe,"|").concat(re)}function s(he,pe){i.has(he)?i.get(he).push(pe):i.set(he,[pe])}function u(he,pe){S.sub(n[he].geometry.direction,n[pe].geometry.center,n[he].geometry.center),S.normalize(n[he].geometry.direction,n[he].geometry.direction)}var c=S();function l(he,pe,re){var ue=n[he].geometry;S.sub(ue.direction,(0,re.conformation.position)(re.elements[pe],c),ue.center),S.normalize(ue.direction,ue.direction)}for(var d=0,f=e.units.length;d<f;++d)if(Oe.isAtomic(p=e.units[d]))for(var h=p.model,m=p.rings,v=h.atomicHierarchy,y=v.residueAtomSegments,_=v.atoms.label_comp_id,C=tr.transientSegments(v.chainAtomSegments,p.elements),x=tr.transientSegments(y,p.elements),A=void 0;C.hasNext;)for(x.setSegment(C.move());x.hasNext;){var T=x.move().index,w=Q4e(_.value(y.offsets[T]),h);if(w){A||(A=ST.byFingerprintAndResidue(m,W4e));var E=Z4e(m,A.get(T));if(!E||!E.length){a.push({unit:p,residueIndex:T,component:w});continue}for(var I=[],M=0,F=E.length;M<F;++M){var N=m.all[E[M]],j=Y4e(p,N),k=ql.calculateMomentsAxes(XK(p,N)),H=ql.calculateNormalizedAxes(k),G=S.copy(S(),H.origin),U=S.copy(S(),H.dirC),Q=K4e(S(),p,j,G);S.orthogonalize(Q,U,Q);var W=Lc.getAltId(p,N),K=n.length;I.push(K),s(o(T,p.id,W),K),W&&s(o(T,p.id,""),K),n.push({geometry:{center:G,normal:U,direction:Q},component:w,ringIndex:E[M],altId:W,unit:p,residueIndex:T})}var ne=oQ(rc(new Array(E.length)),2);for(M=0,F=ne.length;M<F;++M){var X=ne[M];if(Cu.areVertexSetsConnected(p.bonds,m.all[E[X[0]]],m.all[E[X[1]]],3)){var $=I[X[0]],Z=I[X[1]];n[$].altId===n[Z].altId&&(u($,Z),u(Z,$),t.push({carbohydrateIndexA:$,carbohydrateIndexB:Z}),t.push({carbohydrateIndexA:Z,carbohydrateIndexB:$}))}}}}function q(he,pe){return i.get(o(he.getResidueIndex(pe),he.id,function X4e(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}(he,pe)))||[]}for(d=0,f=n.length;d<f;++d){var z=n[d],p=z.unit;for(M=d+1;M<f;++M){var te=n[M];p===te.unit&&z.residueIndex!==te.residueIndex&&Cu.areVertexSetsConnected(p.bonds,p.rings.all[z.ringIndex],p.rings.all[te.ringIndex],3)&&(u(d,M),u(M,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:M}),t.push({carbohydrateIndexA:M,carbohydrateIndexB:d}))}}for(d=0,f=e.units.length;d<f;++d)Oe.isAtomic(p=e.units[d])&&e.interUnitBonds.getConnectedUnits(p.id).forEach(function(ee){ee.connectedIndices.forEach(function(ue){ee.getEdges(ue).forEach(function(ge){var ze=ge.indexB;if(Gr.isCovalent(ge.props.flag)){var je=e.unitMap.get(ee.unitA),V=e.unitMap.get(ee.unitB),J=q(je,ue),ye=q(V,ze);if(J.length>0&&ye.length>0)for(var we=J.length,Ee=ye.length,Fe=0,ke=Math.max(we,Ee);Fe<ke;++Fe){var Ue=J[Math.min(Fe,we-1)],$e=ye[Math.min(Fe,Ee-1)];((Pe=sQ(je,ue)).startsWith("O1")||Pe.startsWith("C1"))&&u(Ue,$e),t.push({carbohydrateIndexA:Ue,carbohydrateIndexB:$e})}else if(0===ye.length)for(var He=0,Je=J;He<Je.length;He++){var Pe;Ue=Je[He],((Pe=sQ(je,ue)).startsWith("O1")||Pe.startsWith("C1"))&&l(Ue,ze,V),r.push({carbohydrateIndex:Ue,elementIndex:ze,elementUnit:V,fromCarbohydrate:!0})}else if(0===J.length)for(var vt=0,ut=ye;vt<ut.length;vt++)r.push({carbohydrateIndex:$e=ut[vt],elementIndex:ue,elementUnit:je,fromCarbohydrate:!1})}})})});return R({links:t,terminalLinks:r,elements:n,partialElements:a},function J4e(e,t,r){function n(F,N){return nc(F.id,N)}function a(F,N,j){var k=[],H=F.get(n(N,j));if(void 0!==H)for(var G=0,U=H;G<U.length;G++)$a(k,U[G]);return k}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],f=0,p=(d=(c=u.unit).rings.all[u.ringIndex]).length;f<p;++f){var h=n(c,c.elements[d[f]]);void 0===(m=i.get(h))?i.set(h,[o]):m.push(o)}var g=new Map;for(o=0,s=t.length;o<s;++o){var b=e[t[o].carbohydrateIndexA];for(f=0,p=(d=(c=b.unit).rings.all[b.ringIndex]).length;f<p;++f)h=n(c,c.elements[d[f]]),void 0===(m=g.get(h))?g.set(h,[o]):m.push(o)}var C=new Map;for(o=0,s=r.length;o<s;++o){var x=r[o],w=x.elementUnit,E=x.elementIndex;if(x.fromCarbohydrate){var c,d,I=e[x.carbohydrateIndex];for(f=0,p=(d=(c=I.unit).rings.all[I.ringIndex]).length;f<p;++f)h=n(c,c.elements[d[f]]),void 0===(m=C.get(h))?C.set(h,[o]):m.push(o)}else{var m;h=n(w,w.elements[E]),void 0===(m=C.get(h))?C.set(h,[o]):m.push(o)}}return{getElementIndices:function v(F,N){return a(i,F,N)},getLinkIndices:function _(F,N){return a(g,F,N)},getTerminalLinkIndices:function M(F,N){return a(C,F,N)}}}(n,t,r))}(this)),this.state.carbohydrates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models||(this.state.models=function ike(e){for(var t=e.units,r=On.create(),n=0,a=t;n<a.length;n++){var i=a[n];On.add(r,i.model.id,i.model)}return r.array}(this)),this.state.models},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=function oke(e){for(var t=it.residue.microheterogeneityCompIds,r=new Set,n=at.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var s=i[a].units[0];if(Oe.isAtomic(s)){var u=tr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var c=u.move();n.element=s.elements[c.start];for(var d=0,f=t(n);d<f.length;d++)r.add(f[d])}}}return r}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=function ske(e){for(var t=it.atom.type_symbol,r=new Set,n=at.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var s=i[a].units[0];if(Oe.isAtomic(s)){n.unit=s;for(var u=0,c=s.elements.length;u<c;++u)n.element=s.elements[u],r.add(t(n))}}return r}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=function uke(e){for(var t=e.units,r=at.create(e),n=On.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=0===o.kind?it.entity.key:it.coarse.entityKey;r.unit=o;for(var u=o.elements,c=tr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);c.hasNext;){var l=c.move();r.element=u[l.start];var d=s(r);On.add(n,d,d)}}return Rc(n.array),n.array}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=function cke(e){for(var t=new Map,r=[],a=0,i=e.unitSymmetryGroups;a<i.length;a++){var s=i[a].units[0];if(Oe.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=On.create(),r.push(s.model.id),t.set(s.model.id,u));for(var c=tr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);c.hasNext;){var l=c.move();On.add(u,l.index,l.index)}}}for(var d=new Map,f=0,p=r;f<p.length;f++){var h=p[f],m=t.get(h).array;Rc(m),d.set(h,m)}return d}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(!Oe.isAtomic(r[t]))return!1;return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(Oe.isAtomic(r[t]))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(!Oe.isCoarse(r[t]))return!1;return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(Oe.isCoarse(r[t]))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=function mke(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,c=t.length;s<c;++s){a[s]=u;for(var l=t[s].elements,d=0,f=l.length;d<f;++d){var p=u+d;i[p]=s,o[p]=l[d]}u+=l.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(h,m){return a[n.get(h.id)]+Be.indexOf(h.elements,m)}}}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return!!this.unitMap.has(t.unit.id)&&Xe.has(this.unitMap.get(t.unit.id).elements,t.element)},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=this.state,n=r.dynamicBonds,a=r.interUnitBonds,i=r.parent,o=[],s=0,u=this.unitSymmetryGroups;s<u.length;s++){var c=u[s],l=c.units[0].remapModel(t,n);o.push(l);for(var d=1,f=c.units.length;d<f;++d)o.push(c.units[d].remapModel(t,n,l.props))}return e.create(o,{parent:i?.remapModel(t),label:this.label,interUnitBonds:n?void 0:a,dynamicBonds:n,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})},e.prototype.asParent=function(){if(this._proxy)return this._proxy;if(this.parent){var t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,R(R({},r.state),{dynamicBonds:this.dynamicBonds}),{child:this,target:this.parent})}else this._proxy=this;return this._proxy},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return null!==(t=this._target)&&void 0!==t?t:this},enumerable:!1,configurable:!0}),e}();function ake(e,t,r){return e[t].id-e[r].id}!function(e){function t(q){return{kind:"structure-loci",structure:q}}function u(q,z){void 0===z&&(z={});for(var te=Oc.Mutable(),ae=Oc.Mutable(),fe=0,he=!0,pe=q.length>0?q[0].id:0,re=0,ee=q.length;re<ee;re++){var ue=q[re];te.set(ue.id,ue),fe+=ue.elements.length,ue.id<pe&&(he=!1),pe=ue.id}for(he||rX(q,0,q.length,ake,wv),re=0,ee=q.length;re<ee;re++)ae.set(q[re].id,re);var ge={hashCode:-1,transformHash:-1,elementCount:fe,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:sa.Default,label:""};return z.parent&&(ge.parent=z.parent.parent||z.parent),z.interUnitBonds&&(ge.interUnitBonds=z.interUnitBonds),z.interBondsValidUnit?ge.interBondsValidUnit=z.interBondsValidUnit:z.parent&&(ge.interBondsValidUnit=z.parent.interBondsValidUnit),z.interBondsValidUnitPair?ge.interBondsValidUnitPair=z.interBondsValidUnitPair:z.parent&&(ge.interBondsValidUnitPair=z.parent.interBondsValidUnitPair),z.dynamicBonds?ge.dynamicBonds=z.dynamicBonds:z.parent&&(ge.dynamicBonds=z.parent.dynamicBonds),z.coordinateSystem?ge.coordinateSystem=z.coordinateSystem:z.parent&&(ge.coordinateSystem=z.parent.coordinateSystem),z.label?ge.label=z.label:z.parent&&(ge.label=z.parent.label),z.masterModel?ge.masterModel=z.masterModel:z.parent&&(ge.masterModel=z.parent.masterModel),z.representativeModel?ge.representativeModel=z.representativeModel:z.parent&&(ge.representativeModel=z.parent.representativeModel),new e(q,te,ae,ge)}e.Empty=u([]),e.Loci=t,e.toStructureElementLoci=function r(q){for(var z=[],te=0,ae=q.units;te<ae.length;te++){var fe=ae[te];z.push({unit:fe,indices:xe.ofBounds(0,fe.elements.length)})}return Re(q,z)},e.toSubStructureElementLoci=function n(q,z){return mt.toLociWithSourceUnits(mt.Singletons(q,z))},e.isLoci=function a(q){return!!q&&"structure-loci"===q.kind},e.areLociEqual=function i(q,z){return q.structure===z.structure},e.isLociEmpty=function o(q){return q.structure.isEmpty},e.remapLoci=function s(q,z){return z===q.structure?q:t(z)},e.create=u,e.ofTrajectory=function c(q,z){return ce(this,void 0,void 0,function(){var te,ae,fe,he,pe,re,ee,ue,ge,Ce,V;return le(this,function(J){switch(J.label){case 0:if(0===q.frameCount)return[2,e.Empty];te=[],ae=void 0,fe=0,he=0,pe=q.frameCount,J.label=1;case 1:return he<pe?[4,Ve.resolveInContext(q.getFrameAtIndex(he),z)]:[3,4];case 2:for(re=J.sent(),ae||(ae=re),ee=d(re),ue=0,ge=ee.units.length;ue<ge;++ue)V=Oe.create(te.length,(Ce=ee.units[ue]).invariantId+fe,Ce.chainGroupId+fe,Ce.traits,Ce.kind,Ce.model,Ce.conformation.operator,Ce.elements),te.push(V);fe=te.length,J.label=3;case 3:return++he,[3,1];case 4:return[2,u(te,{representativeModel:ae,label:ae.label})]}})})};var l=!1;function d(q,z){void 0===z&&(z={});for(var te=q.atomicHierarchy.chainAtomSegments,ae=q.atomicHierarchy.index,fe=q.atomicHierarchy.chains.auth_asym_id,he=q.atomicChainOperatorMappinng,pe=new y(R({label:q.label},z)),re=0;re<te.count;re++){var ee=he.get(re)||sa.Default,ue=te.offsets[re],ge=Vv.chainResidueCount(q.atomicHierarchy,re)===te.offsets[re+1]-te.offsets[re],Ce=!1;if(f(q,re))for(;re+1<te.count&&f(q,re+1)&&he.get(re)===he.get(re+1);)Ce=!0,re++;else for(;re+1<te.count&&te.offsets[re+1]-te.offsets[re]==1&&te.offsets[re+2]-te.offsets[re+1]==1&&(ge=!0,ae.getEntityFromChain(re)===ae.getEntityFromChain(re+1))&&fe.value(re)===fe.value(re+1)&&he.get(re)===he.get(re+1);)Ce=!0,re++;var Ee=Xe.ofBounds(ue,te.offsets[re+1]);l?ge&&!p(q,re)?h(q,Ee,pe,Ce,ee):Ee.length>2e5||f(q,re)?m(q,Ee,pe,Ce,ee):pe.addUnit(0,q,ee,Ee,Ce?Oe.Trait.MultiChain:Oe.Trait.None):pe.addUnit(0,q,ee,Ee,Ce?Oe.Trait.MultiChain:Oe.Trait.None)}var Fe=q.coarseHierarchy;return Fe.isDefined&&(Fe.spheres.count>0&&v(pe,q,q.coarseHierarchy.spheres,1),Fe.gaussians.count>0&&v(pe,q,q.coarseHierarchy.gaussians,2)),pe.getStructure()}function f(q,z){var te=q.atomicHierarchy.index.getEntityFromChain(z);return"water"===q.entities.data.type.value(te)}function p(q,z){var te=q.atomicHierarchy.index.getEntityFromChain(z);return"polymer"===q.entities.data.type.value(te)}function h(q,z,te,ae,fe){var he=q.atomicConformation,ue={x:he.x,y:he.y,z:he.z,indices:z},Ce=tp(ue,up(ue),8192).buckets,ze=Ce.offset,je=Ce.count,V=Ce.array,J=(ae?Oe.Trait.MultiChain:Oe.Trait.None)|(ze.length>1?Oe.Trait.Partitioned:Oe.Trait.None);te.beginChainGroup();for(var ye=0,we=ze.length;ye<we;ye++){for(var Ee=ze[ye],Fe=new Int32Array(je[ye]),ke=0,Ue=je[ye];ke<Ue;ke++)Fe[ke]=z[V[Ee+ke]];te.addUnit(0,q,fe,Xe.ofSortedArray(Fe),J)}te.endChainGroup()}function m(q,z,te,ae,fe){for(var pe=[],re=[],ee=tr.transientSegments(q.atomicHierarchy.residueAtomSegments,z);ee.hasNext;){var ue=ee.move();pe[pe.length]=z[ue.start],re[re.length]=z[ue.end]}var Ce=512*(re[0]-pe[0]),ze=q.atomicConformation,ye={x:ze.x,y:ze.y,z:ze.z,indices:Xe.ofSortedArray(pe)},Ee=tp(ye,up(ye),Ce).buckets,Fe=Ee.offset,ke=Ee.count,Ue=Ee.array,$e=(ae?Oe.Trait.MultiChain:Oe.Trait.None)|(Fe.length>1?Oe.Trait.Partitioned:Oe.Trait.None);te.beginChainGroup();for(var Pe=0,He=Fe.length;Pe<He;Pe++){for(var Je=Fe[Pe],vt=[],ut=0,_t=ke[Pe];ut<_t;ut++)for(var wt=Ue[Je+ut],Le=pe[wt],st=re[wt];Le<st;Le++)vt[vt.length]=Le;te.addUnit(0,q,fe,Xe.ofSortedArray(new Int32Array(vt)),$e)}te.endChainGroup()}function v(q,z,te,ae){for(var fe=te.chainElementSegments,he=0;he<fe.count;he++){var pe=Xe.ofBounds(fe.offsets[he],fe.offsets[he+1]);q.addUnit(ae,z,sa.Default,pe,Oe.Trait.None)}}e.ofModel=d,e.transform=function g(q,z){if(me.isIdentity(z))return q;if(!me.isRotationAndTranslation(z,sa.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var te=[],ae=0,fe=q.units;ae<fe.length;ae++){var he=fe[ae],pe=he.conformation.operator,re=sa.create(pe.name,z,pe);te.push(he.applyOperator(he.id,re))}var ee=q.coordinateSystem;return u(te,{parent:q,coordinateSystem:sa.compose(sa.create(ee.name,z,ee),ee)})};var y=function(){function q(z){void 0===z&&(z={}),this.props=z,this.units=[],this.invariantId=ms(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=S(),this.singleElementUnits=new Map}return q.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},q.prototype.endChainGroup=function(){this.inChainGroup=!1},q.prototype.addUnit=function(z,te,ae,fe,he,pe){void 0===pe&&(pe=this.invariantId());var re=this.inChainGroup?this.chainGroupId:++this.chainGroupId,ee=Oe.create(this.units.length,pe,re,he,z,te,ae,fe);return this.add(ee)},q.prototype.add=function(z){if(1===z.elements.length){z.conformation.position(z.elements[0],this.p);var te=[z.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(te))return this.singleElementUnits.get(te);this.singleElementUnits.set(te,z)}return this.units.push(z),z},q.prototype.addWithOperator=function(z,te,ae){return void 0===ae&&(ae=!1),this.add(z.applyOperator(this.units.length,te,ae))},q.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(q.prototype,"isEmpty",{get:function(){return 0===this.units.length},enumerable:!1,configurable:!0}),q}();function x(q,z){if(q===z)return!0;if(q.elementCount!==z.elementCount)return!1;var te=q.units.length;if(te!==z.units.length)return!1;for(var ae=0;ae<te;ae++)if(q.units[ae].id!==z.units[ae].id)return!1;return!0}function w(q,z){return q===z||q.hashCode===z.hashCode&&Hd.areTransformGroupsEquivalent(q.unitSymmetryGroups,z.unitSymmetryGroups)}e.StructureBuilder=y,e.Builder=function b(q){return void 0===q&&(q={}),new y(q)},e.hashCode=function _(q){return q.hashCode},e.conformationHash=function C(q){return oN(q.units.map(function(z){return Oe.conformationId(z)}).join("|"))},e.areUnitIdsEqual=x,e.areUnitIdsAndIndicesEqual=function A(q,z){if(q===z)return!0;if(!x(q,z))return!1;for(var te=0,ae=q.units.length;te<ae;te++)if(!Xe.areEqual(q.units[te].elements,z.units[te].elements))return!1;return!0},e.areHierarchiesEqual=function T(q,z){if(q.hashCode!==z.hashCode)return!1;var te=q.models.length;if(te!==z.models.length)return!1;for(var ae=0;ae<te;ae++)if(!ir.areHierarchiesEqual(q.models[ae],z.models[ae]))return!1;return!0},e.areEquivalent=w,e.areRootsEquivalent=function E(q,z){return w(q.root,z.root)},e.areRootsEqual=function I(q,z){return q.root===z.root};var M=function(){function q(z){this.structure=z,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=at.create(z),this.hasNext=z.elementCount>0,this.hasNext&&(this.elements=z.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=z.units[0])}return q.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},q.prototype.advance=function(){if(this.idx<this.maxIdx)return this.idx++,void(this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length));this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length?this.hasNext=!1:(this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,0===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length))},q}();e.ElementLocationIterator=M;var F=S();function N(q,z,te){for(var ae=q.elements,fe=q.conformation,he=fe.position,pe=fe.r,re=F,ee=Number.MAX_VALUE,ue=0,ge=ae.length;ue<ge;ue++){var Ce=ae[ue],ze=S.distance(z,he(Ce,re))-te-pe(Ce);ze<ee&&(ee=ze)}return ee}function j(q,z,te){for(var ae=q.units,fe=Number.MAX_VALUE,he=0,pe=ae.length;he<pe;he++){var ee=N(ae[he],z,te);ee<fe&&(fe=ee)}return fe}e.minDistanceToPoint=j;var L,q,k=S();function K(q){return q.unitSymmetryGroups.filter(function(z){return z.units[0].polymerElements.length>0})}e.distance=function H(q,z){if(0===q.elementCount||0===z.elementCount)return 0;for(var te=q.units,ae=Number.MAX_VALUE,fe=0,he=te.length;fe<he;fe++)for(var pe=te[fe],re=pe.elements,ee=pe.conformation,ue=ee.position,ge=ee.r,Ce=0,ze=re.length;Ce<ze;Ce++){var je=re[Ce],V=j(z,ue(je,k),ge(je));V<ae&&(ae=V)}return ae},e.elementDescription=function G(q){return 1===q.elementCount?"1 element":"".concat(q.elementCount," elements")},e.validUnitPair=function U(q,z,te){return q.masterModel?z.model===te.model||z.model===q.masterModel||te.model===q.masterModel:z.model===te.model},e.eachUnitPair=function Q(q,z,te){var ae=te.maxRadius,fe=te.validUnit,he=te.validUnitPair;if(q.units.some(function(J){return fe(J)}))for(var pe=q.lookup3d,re=S(),ee=0,ue=q.units;ee<ue.length;ee++){var ge=ue[ee];if(fe(ge)){var Ce=ge.boundary.sphere;S.transformMat4(re,Ce.center,ge.conformation.operator.matrix);for(var ze=pe.findUnitIndices(re[0],re[1],re[2],Ce.radius+ae),je=0;je<ze.count;je++){var V=q.units[ze.indices[je]];ge.id>=V.id||!fe(V)||!he(ge,V)||(V.elements.length>=ge.elements.length?z(ge,V):z(V,ge))}}}},e.eachAtomicHierarchyElement=function W(q,z){for(var te=z.chain,ae=z.residue,fe=z.atom,he=at.create(q),pe=0,re=q.units;pe<re.length;pe++){var ee=re[pe];if(0===ee.kind){he.unit=ee;for(var ue=ee.elements,ge=tr.transientSegments(ee.model.atomicHierarchy.chainAtomSegments,ue),Ce=tr.transientSegments(ee.model.atomicHierarchy.residueAtomSegments,ue);ge.hasNext;){var ze=ge.move();if(te&&(he.element=ue[ze.start],te(he)),ae||fe)for(Ce.setSegment(ze);Ce.hasNext;){var je=Ce.move();if(ae&&(he.element=ue[je.start],ae(he)),fe)for(var V=je.start,J=je.end;V<J;V++)he.element=ue[V],fe(he)}}}}},e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15},(q=L=e.Size||(e.Size={}))[q.Small=0]="Small",q[q.Medium=1]="Medium",q[q.Large=2]="Large",q[q.Huge=3]="Huge",q[q.Gigantic=4]="Gigantic",e.getSize=function Y(q,z,te){void 0===z&&(z={}),void 0===te&&(te=1);var ae=R(R({},e.DefaultSizeThresholds),z);return q.polymerResidueCount>=ae.largeResidueCount*te?function X(q,z){var te=K(q);return te.length>=1&&te[0].units.length>z.highSymmetryUnitCount}(q,ae)?L.Huge:L.Gigantic:function ne(q,z){var te=K(q);return 1===te.length&&te[0].units.length>2&&te[0].units[0].polymerElements.length<z.fiberResidueCount}(q,ae)||q.polymerResidueCount<ae.smallResidueCount*te?L.Small:q.polymerResidueCount<ae.mediumResidueCount*te?L.Medium:L.Large},e.Index=pp.createSimple("index","root"),e.MaxIndex=pp.createSimple("max_index","root");var $="__PrincipalAxes__";e.getPrincipalAxes=function Z(q){if(q.currentPropertyData[$])return q.currentPropertyData[$];var z=Re.getPrincipalAxes(e.toStructureElementLoci(q));return q.currentPropertyData[$]=z,z}}(Ye||(Ye={}));var jd,Xv,qd,vke=wi.diff;function Re(e,t){return{kind:"element-loci",structure:e,elements:t}}!function(e){function n(Z){for(var q=0,z=Z.elements;q<z.length;q++)if(Be.size(z[q].indices)>0)return!1;return!0}function i(Z){for(var q=0,z=0,te=Z.elements;z<te.length;z++){var ae=te[z].indices;q+="number"==typeof ae?vke(ae):ae.length}return q}function c(Z){return n(Z)?Z:e(Z.structure,[{unit:Z.elements[0].unit,indices:Be.ofSingleton(Be.start(Z.elements[0].indices))}])}function _(Z){return Z.length>3&&Xe.isRange(Z)?xe.ofRange(Z[0],Z[Z.length-1]):Xe.ofSortedArray(Z)}function C(Z,q){for(var z=[],te=new Set,ae=0,fe=Z.elements;ae<fe.length;ae++){var he=fe[ae];if(A(he))z[z.length]=he;else if(0===he.unit.kind){for(var pe=he.unit.elements,ee=he.unit.model.atomicHierarchy.atoms.label_alt_id,ue=he.unit.model.atomicHierarchy.residueAtomSegments,ge=ue.index,Ce=ue.offsets,ze=[],je=he.indices,V=Be.size(je),J=0;J<V;){te.clear();var ye=pe[Be.getAt(je,J)],we=ge[ye];for(te.add(ee.value(ye)),J++;J<V;){var Ee=pe[Be.getAt(je,J)];if(ge[Ee]!==we)break;te.add(ee.value(Ee)),J++}for(var Fe=te.has(""),ke=Ce[we],Ue=Ce[we+1];ke<Ue;ke++){var $e=Be.indexOf(pe,ke);if($e>=0){var Pe=ee.value(ke);(!q||Fe||!Pe||te.has(Pe))&&(ze[ze.length]=$e)}}}z[z.length]={unit:he.unit,indices:_(ze)}}else z[z.length]=he}return e(Z.structure,z)}function x(Z){switch(Z.kind){case 0:return Z.model.atomicHierarchy.chainAtomSegments;case 1:return Z.model.coarseHierarchy.spheres.chainElementSegments;case 2:return Z.model.coarseHierarchy.gaussians.chainElementSegments}}function A(Z){return Z.unit.elements.length===Be.size(Z.indices)}function T(Z,q,z){for(var te=x(Z).index,ae=Z.elements,fe=0,he=0,pe=ae.length;he<pe;he++)q.has(te[ae[he]])&&fe++;if(fe!==Z.elements.length){var ue=new Int32Array(fe);for(fe=0,he=0,pe=ae.length;he<pe;he++)q.has(te[ae[he]])&&(ue[fe++]=he);ue.length>0&&(z[z.length]={unit:Z,indices:_(ue)})}else z[z.length]={unit:Z,indices:xe.ofBounds(0,fe)}}function w(Z,q,z,te,ae){for(var fe=x(Z.elements[0].unit).index,he=new Set,pe=q;pe<z;pe++)for(var re=Z.elements[pe],ee=re.indices,ue=re.unit.elements,ge=0,Ce=Be.size(ee);ge<Ce;ge++)he.add(fe[ue[Be.getAt(ee,ge)]]);if(te)for(var ze=Z.elements[0].unit,je=0,V=Z.structure.units;je<V.length;je++){var J=V[je];Oe.areSameChainOperatorGroup(J,ze)&&T(J,he,ae)}else for(pe=q;pe<z;pe++)T(Z.elements[pe].unit,he,ae)}function E(Z){for(var q=[],z=0,te=Z.elements.length;z<te;z++){var ae=Z.elements[z];if(Oe.Traits.is(ae.unit.traits,Oe.Trait.Partitioned)){for(var fe=z;z<te&&Oe.areSameChainOperatorGroup(Z.elements[z].unit,ae.unit);)z++;var he=z;z--,w(Z,fe,he,!0,q)}else A(ae)?q[q.length]=ae:w(Z,z,z+1,!1,q)}return e(Z.structure,q)}function I(Z){return"".concat(Z.unit.model.id,"|").concat(it.entity.id(Z))}function N(Z,q){for(var z=[],te=0,ae=Be.size(q);te<ae;++te)z.push(Z[Be.getAt(q,te)]);return Xe.ofSortedArray(z)}function j(Z,q){return Xe.isRange(Z)&&Xe.areEqual(Z,q)?xe.ofLength(Z.length):_(Xe.indicesOf(Z,q))}e.is=function t(Z){return!!Z&&"element-loci"===Z.kind},e.areEqual=function r(Z,q){if(Z.structure!==q.structure||Z.elements.length!==q.elements.length)return!1;for(var z=0,te=Z.elements.length;z<te;++z){var ae=Z.elements[z],fe=q.elements[z];if(ae.unit.id!==fe.unit.id||!Be.areEqual(ae.indices,fe.indices))return!1}return!0},e.isEmpty=n,e.isWholeStructure=function a(Z){return i(Z)===Z.structure.elementCount},e.size=i,e.all=function o(Z){return e(Z,Z.units.map(function(q){return{unit:q,indices:Be.ofBounds(0,q.elements.length)}}))},e.none=function s(Z){return e(Z,[])},e.getFirstLocation=function u(Z,q){if(!n(Z)){var z=Z.elements[0].unit,te=z.elements[Be.getAt(Z.elements[0].indices,0)];return q?(q.structure=Z.structure,q.unit=Z.elements[0].unit,q.element=te,q):at.create(Z.structure,z,te)}},e.firstElement=c,e.firstResidue=function l(Z){return n(Z)?Z:C(c(Z))},e.firstChain=function d(Z){return n(Z)?Z:E(c(Z))},e.toStructure=function f(Z){for(var q=[],z=function(he){var pe=he.unit,re=he.indices,ee=new Int32Array(Be.size(re));Be.forEach(re,function(ue,ge){return ee[ge]=pe.elements[ue]}),q.push(pe.getChild(Xe.ofSortedArray(ee)))},te=0,ae=Z.elements;te<ae.length;te++)z(ae[te]);return Ye.create(q,{parent:Z.structure.parent})},e.forEachLocation=function p(Z,q){if(!e.isEmpty(Z))for(var z=at.create(Z.structure),te=0,ae=Z.elements;te<ae.length;te++){var fe=ae[te],pe=fe.indices;z.unit=fe.unit;for(var re=fe.unit.elements,ee=0,ue=Be.size(pe);ee<ue;ee++)z.element=re[Be.getAt(pe,ee)],q(z)}},e.remap=function h(Z,q){if(q===Z.structure)return Z;var z=[];return Z.elements.forEach(function(te){if(q.unitMap.has(te.unit.id)){var ae=q.unitMap.get(te.unit.id),fe=Be.indexedIntersect(te.indices,te.unit.elements,ae.elements);Be.size(fe)>0&&z.push({unit:ae,indices:fe})}}),e(q,z)},e.union=function m(Z,q){if(Z.elements.length>q.elements.length)return m(q,Z);if(e.isEmpty(Z))return q;for(var z=new Map,te=0,ae=Z.elements;te<ae.length;te++)z.set((fe=ae[te]).unit.id,fe.indices);for(var he=[],pe=0,re=q.elements;pe<re.length;pe++){var fe;z.has((fe=re[pe]).unit.id)?(he[he.length]={unit:fe.unit,indices:Be.union(z.get(fe.unit.id),fe.indices)},z.delete(fe.unit.id)):he[he.length]=fe}return z.forEach(function(ee,ue){he[he.length]={unit:Z.structure.unitMap.get(ue),indices:ee}}),e(Z.structure,he)},e.subtract=function v(Z,q){for(var z=new Map,te=0,ae=q.elements;te<ae.length;te++)z.set((fe=ae[te]).unit.id,fe.indices);for(var he=[],pe=0,re=Z.elements;pe<re.length;pe++){var fe;if(z.has((fe=re[pe]).unit.id)){var ee=Be.subtract(fe.indices,z.get(fe.unit.id));if(0===Be.size(ee))continue;he[he.length]={unit:fe.unit,indices:ee}}else he[he.length]=fe}return e(Z.structure,he)},e.intersect=function g(Z,q){for(var z=new Map,te=0,ae=Z.elements;te<ae.length;te++)z.set((fe=ae[te]).unit.id,fe.indices);for(var he=[],pe=0,re=q.elements;pe<re.length;pe++){var fe;if(z.has((fe=re[pe]).unit.id)){var ee=Be.intersect(z.get(fe.unit.id),fe.indices);0!==Be.size(ee)&&(he[he.length]={unit:fe.unit,indices:ee})}}return e(Z.structure,he)},e.areIntersecting=function y(Z,q){if(Z.elements.length>q.elements.length)return y(q,Z);if(e.isEmpty(Z))return e.isEmpty(q);for(var z=new Map,te=0,ae=Z.elements;te<ae.length;te++)z.set((fe=ae[te]).unit.id,fe.indices);for(var he=0,pe=q.elements;he<pe.length;he++){var fe;if(z.has((fe=pe[he]).unit.id)&&Be.areIntersecting(z.get(fe.unit.id),fe.indices))return!0}return!1},e.isSubset=function b(Z,q){if(e.isEmpty(Z))return e.isEmpty(q);for(var z=new Map,te=0,ae=Z.elements;te<ae.length;te++)z.set((fe=ae[te]).unit.id,fe.indices);for(var he=!1,pe=0,re=q.elements;pe<re.length;pe++){var fe;if(z.has((fe=re[pe]).unit.id)){if(!Be.isSubset(z.get(fe.unit.id),fe.indices))return!1;he=!0}}return he},e.extendToWholeResidues=C,e.extendToWholeChains=E,e.extendToWholeEntities=function M(Z){for(var q=[],z=at.create(Z.structure),te=new Set,ae=Z.structure.units,fe=0,he=Z.elements.length;fe<he;fe++){var pe=Z.elements[fe];z.unit=pe.unit,z.element=pe.unit.elements[0],te.add(I(z))}fe=0;for(var re=ae.length;fe<re;++fe){var ee=ae[fe];if(z.unit=ee,z.element=ee.elements[0],te.has(I(z))){var ue=Be.ofBounds(0,ee.elements.length);q[q.length]={unit:ee,indices:ue}}}return e(Z.structure,q)},e.extendToWholeModels=function F(Z){for(var q=[],z=new Set,te=Z.structure.units,ae=0,fe=Z.elements.length;ae<fe;ae++)z.add(Z.elements[ae].unit.model.id);ae=0;for(var pe=te.length;ae<pe;++ae){var re=te[ae];if(z.has(re.model.id)){var ee=Be.ofBounds(0,re.elements.length);q[q.length]={unit:re,indices:ee}}}return e(Z.structure,q)},e.extendToAllInstances=function k(Z){for(var q=[],z=new Map,te=0,ae=Z.elements.length;te<ae;te++){var fe=Z.elements[te],he=fe.unit.model,pe=N(fe.unit.elements,fe.indices);z.has(he)?z.set(he,Xe.union(pe,z.get(he))):z.set(he,pe)}te=0;for(var re=Z.structure.units.length;te<re;++te){var ee=Z.structure.units[te];if(pe=z.get(ee.model)){var ue=j(ee.elements,pe);Be.size(ue)&&(q[q.length]={unit:ee,indices:ue})}}return e(Z.structure,q)},e.extendToWholeOperators=function H(Z){for(var q=[],z=new Set,te=Z.structure.units,ae=0,fe=Z.elements.length;ae<fe;ae++)z.add(Z.elements[ae].unit.conformation.operator.name);ae=0;for(var pe=te.length;ae<pe;++ae){var re=te[ae];if(z.has(re.conformation.operator.name)){var ee=Be.ofBounds(0,re.elements.length);q[q.length]={unit:re,indices:ee}}}return e(Z.structure,q)};var G=new oc("98"),U=S();e.getBoundary=function Q(Z,q){G.reset();for(var z=0,te=Z.elements;z<te.length;z++)for(var he=(ae=te[z]).unit.conformation.position,pe=ae.unit.conformation.r,re=ae.unit.elements,ee=0,ue=Be.size(fe=ae.indices);ee<ue;ee++)he(ge=re[Be.getAt(fe,ee)],U),q&&S.transformMat4(U,U,q),G.includePositionRadius(U,pe(ge));G.finishedIncludeStep();for(var Ce=0,ze=Z.elements;Ce<ze.length;Ce++){var ae,fe;for(he=(ae=ze[Ce]).unit.conformation.position,pe=ae.unit.conformation.r,re=ae.unit.elements,ee=0,ue=Be.size(fe=ae.indices);ee<ue;ee++){var ge;he(ge=re[Be.getAt(fe,ee)],U),q&&S.transformMat4(U,U,q),G.radiusPositionRadius(U,pe(ge))}}return{box:G.getBox(),sphere:G.getSphere()}};var W=S();function K(Z,q,z){void 0===z&&(z=0);for(var te=z,ae=0,fe=Z.elements;ae<fe.length;ae++){for(var he=fe[ae],pe=he.indices,re=he.unit.conformation.position,ee=he.unit.elements,ue=Be.size(pe),ge=0;ge<ue;ge++)re(ee[Be.getAt(pe,ge)],W),S.toArray(W,q,te+3*ge);te+=3*ue}return q}function L(Z,q){return Oe.isAtomic(Z)?Z.model.atomicHierarchy.atomSourceIndex.value(q):q}function $(Z,q,z,te,ae){Rc(q);for(var fe=[],he=[],pe=0,re=q.length;pe<re;){var ee=pe;for(pe++;pe<re&&q[pe-1]+1===q[pe];)pe++;var ue=pe;if(ue-ee>12)fe[fe.length]=q[ee],fe[fe.length]=q[ue-1];else for(var ge=ee;ge<ue;ge++)he[he.length]=q[ge]}return z?{atom:{set:he,ranges:fe},chain:{opName:[Z]},entity:{modelLabel:te,modelIndex:ae}}:{atom:{set:he,ranges:fe},chain:{opName:[Z]}}}e.toPositionsArray=K,e.getPrincipalAxes=function ne(Z){var q=i(Z),z=K(Z,new Float32Array(3*q));return ql.ofPositions(z)},e.getPrincipalAxesMany=function X(Z){var q=0;Z.forEach(function(ae){q+=i(ae)});var z=new Float32Array(3*q),te=0;return Z.forEach(function(ae){K(ae,z,te),te+=3*i(ae)}),ql.ofPositions(z)},e.toExpression=function Y(Z){var q;if(e.isEmpty(Z))return de.struct.generator.empty();for(var z=Z.structure.models,te=new Map,ae=0,fe=Z.elements;ae<fe.length;ae++){var pe=(he=fe[ae]).indices,re=he.unit.elements,ue=void 0;te.has(ee=he.unit.conformation.operator.name)?ue=te.get(ee).xs:(ue=On.create(),te.set(ee,{modelLabel:he.unit.model.label,modelIndex:he.unit.model.modelNum,xs:ue}));for(var ge=0,Ce=Be.size(pe);ge<Ce;ge++){var ze=L(he.unit,re[Be.getAt(pe,ge)]);On.add(ue,ze,ze)}}for(var je=[],V=te.keys();;){var J=V.next();if(J.done)break;var he=te.get(J.value);je.push($(J.value,he.xs.array,z.length>1,he.modelLabel,he.modelIndex))}for(var ye=new Map,we=(ge=0,je.length);ge<we;++ge){var Ee=je[ge],Fe=Dv(vs(Ee.atom.ranges),vs(Ee.atom.set)),ee="".concat(Fe,"|").concat(Ee.entity?Ee.entity.modelLabel+Ee.entity.modelIndex:"");ye.has(ee)?(q=ye.get(ee).chain.opName).push.apply(q,Ee.chain.opName):ye.set(ee,Ee)}var ke=[];return ye.forEach(function(Ue){var $e=Ue.atom,Pe=$e.ranges,He=$e.set,Je=Ue.chain.opName,vt=de.struct.atomProperty.core.operatorName(),ut=de.struct.atomProperty.core.sourceIndex(),_t=[];He.length>0&&(_t[_t.length]=de.core.set.has([de.core.type.set(He),ut]));for(var wt=0,Le=Pe.length/2;wt<Le;wt++)_t[_t.length]=de.core.rel.inRange([ut,Pe[2*wt],Pe[2*wt+1]]);if(Ue.entity){var st=Ue.entity,St=st.modelLabel,bt=st.modelIndex;ke.push(de.struct.generator.atomGroups({"atom-test":_t.length>1?de.core.logic.or(_t):_t[0],"chain-test":Je.length>1?de.core.set.has([de.core.type.set(Je),vt]):de.core.rel.eq([vt,Je[0]]),"entity-test":de.core.logic.and([de.core.rel.eq([de.struct.atomProperty.core.modelLabel(),St]),de.core.rel.eq([de.struct.atomProperty.core.modelIndex(),bt])])}))}else ke.push(de.struct.generator.atomGroups({"atom-test":_t.length>1?de.core.logic.or(_t):_t[0],"chain-test":Je.length>1?de.core.set.has([de.core.type.set(Je),vt]):de.core.rel.eq([vt,Je[0]])}))}),de.struct.modifier.union([1===ke.length?ke[0]:de.struct.combinator.merge(ke.map(function(Ue){return de.struct.modifier.union([Ue])}))])}}(Re||(Re={})),function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:at.create(void 0),firstConformationLoc:at.create(void 0),firstResidueLoc:at.create(void 0),firstChainLoc:at.create(void 0),firstUnitLoc:at.create(void 0),firstStructureLoc:at.create(void 0)}}function r(u,c,l){var d=u.get(c)||0;u.set(c,d+l)}function n(u,c,l){var d=l.indices,f=l.unit,p=f.elements,h=Be.size(d),m=new Map,v=new Map;if(h>0&&at.set(u.firstElementLoc,c,f,p[Be.start(d)]),h===p.length)u.unitCount+=1,1===u.unitCount&&at.set(u.firstUnitLoc,c,f,p[Be.start(d)]);else if(1===h){if(Oe.Traits.is(f.traits,Oe.Trait.MultiChain))return;u.elementCount+=1,1===u.elementCount&&at.set(u.firstElementLoc,c,f,p[Be.start(d)])}else if(Oe.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,_=f.model.atomicHierarchy.atoms.label_alt_id,C=0,x=function(){m.clear();var A=0,T=p[Be.getAt(d,C)],w=y[T];for(r(m,_.value(T),1),++C,++A;C<h;){var E=p[Be.getAt(d,C)];if(y[E]!==w)break;r(m,_.value(E),1),++C,++A}if(b[w+1]-b[w]===A)u.residueCount+=1,1===u.residueCount&&at.set(u.firstResidueLoc,c,f,b[w]);else{v.clear();for(var I=b[w],M=b[w+1];I<M;++I)r(v,_.value(I),1);v.get("")===m.get("")&&m.forEach(function(F,N){if(v.get(N)===F){if(""!==N&&(u.conformationCount+=1,1===u.conformationCount))for(var j=b[w],k=b[w+1];j<k;++j)if(N===_.value(j)){at.set(u.firstConformationLoc,c,f,j);break}A-=F}}),u.elementCount+=A}};C<h;)x();else u.elementCount+=h,1===u.elementCount&&at.set(u.firstElementLoc,c,f,p[Be.start(d)])}function a(u,c,l){var d=l.indices,f=l.unit,p=Be.size(d);if(0!==p){var h=f.elements;if(!Oe.Traits.is(f.traits,Oe.Trait.MultiChain))return void(p===h.length&&(u.chainCount+=1,1===u.chainCount&&at.set(u.firstChainLoc,c,f,h[Be.start(d)])));var m=Oe.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:Oe.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:Oe.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!m)return void console.warn("StructureElement loci stats: unknown unit type");for(var v=m.index,g=m.offsets,y=0;y<p;){var b=0,_=h[Be.getAt(d,y)],C=v[_];for(++y,++b;y<p&&v[h[Be.getAt(d,y)]]===C;)++y,++b;g[C+1]-g[C]===b?(u.chainCount+=1,1===u.chainCount&&at.set(u.firstChainLoc,c,f,g[C])):1===p&&(u.elementCount+=1,1===u.elementCount&&at.set(u.firstElementLoc,c,f,_))}}}function i(u,c,l,d,f){var p=l[d],h=Oe.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:Oe.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:Oe.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(h){for(var m=h.index,v=h.offsets,g=new Map,y=d;y<f;y++){var _=(p=l[y]).unit;if(0!==(C=Be.size(b=p.indices))){var x=_.elements;if(!Oe.Traits.is(_.traits,Oe.Trait.MultiChain)){r(g,m[A=x[Be.start(b)]],x.length);continue}for(var T=0;T<C;){var w=0,E=m[A=x[Be.getAt(b,T)]];for(++T,++w;T<C&&m[x[Be.getAt(b,T)]]===E;)++T,++w;r(g,E,w)}}}var M=-1;if(g.forEach(function(F,N){v[N+1]-v[N]===F&&(u.chainCount+=1,1===u.chainCount&&(M=N))}),!(M<0))for(y=d;y<f;y++){var b,C;if(_=(p=l[y]).unit,0!==(C=Be.size(b=p.indices)))for(x=_.elements,T=0;T<C;){var A;if((E=m[A=x[Be.getAt(b,T)]])===M)return void at.set(u.firstChainLoc,c,_,A)}}}else console.warn("StructureElement loci stats: unknown unit type")}e.create=t,e.ofLoci=function o(u){var c=t();if(Re.isEmpty(u))return c;var l=!1;if(Re.isWholeStructure(u)){if(c.structureCount+=1,1===c.structureCount){var d=u.elements[0],f=d.unit;at.set(c.firstStructureLoc,u.structure,f,f.elements[Be.min(d.indices)])}}else for(var h=0,m=u.elements;h<m.length;h++)n(c,u.structure,v=m[h]),Oe.Traits.is(v.unit.traits,Oe.Trait.Partitioned)?l=!0:a(c,u.structure,v);if(l)for(var g=0,y=u.elements.length;g<y;g++){var v;if(Oe.Traits.is((v=u.elements[g]).unit.traits,Oe.Trait.Partitioned)){for(var b=g;g<y&&Oe.areSameChainOperatorGroup(u.elements[g].unit,v.unit);)g++;var _=g;g--,_-b==1?a(c,u.structure,v):i(c,u.structure,u.elements,b,_)}}return c},e.add=function s(u,c,l){return 1===c.elementCount&&0===l.elementCount?at.copy(u.firstElementLoc,c.firstElementLoc):0===c.elementCount&&1===l.elementCount&&at.copy(u.firstElementLoc,l.firstElementLoc),1===c.conformationCount&&0===l.conformationCount?at.copy(u.firstConformationLoc,c.firstConformationLoc):0===c.conformationCount&&1===l.conformationCount&&at.copy(u.firstConformationLoc,l.firstConformationLoc),1===c.residueCount&&0===l.residueCount?at.copy(u.firstResidueLoc,c.firstResidueLoc):0===c.residueCount&&1===l.residueCount&&at.copy(u.firstResidueLoc,l.firstResidueLoc),1===c.chainCount&&0===l.chainCount?at.copy(u.firstChainLoc,c.firstChainLoc):0===c.chainCount&&1===l.chainCount&&at.copy(u.firstChainLoc,l.firstChainLoc),1===c.unitCount&&0===l.unitCount?at.copy(u.firstUnitLoc,c.firstUnitLoc):0===c.unitCount&&1===l.unitCount&&at.copy(u.firstUnitLoc,l.firstUnitLoc),1===c.structureCount&&0===l.structureCount?at.copy(u.firstStructureLoc,c.firstStructureLoc):0===c.structureCount&&1===l.structureCount&&at.copy(u.firstStructureLoc,l.firstStructureLoc),u.elementCount=c.elementCount+l.elementCount,u.conformationCount=c.conformationCount+l.conformationCount,u.residueCount=c.residueCount+l.residueCount,u.chainCount=c.chainCount+l.chainCount,u.unitCount=c.unitCount+l.unitCount,u.structureCount=c.structureCount+l.structureCount,u}}(jd||(jd={})),function(e){function t(n){var a=this,i=n.descriptor.name,o="static"===n.type?"_staticPropertyData":"_dynamicPropertyData",s=function(c){return i in c[o]||(c[o][i]={props:R({},D.getDefaultValues(n.getParams(c))),data:Bh.create(void 0)}),c[o][i]},u=function(c,l,d){var f=s(c);c[o][i]={props:l,data:Bh.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(c){var l=D.clone(n.getParams(c));return D.setDefaultValues(l,s(c).props),l},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(c,l,d,f){return void 0===d&&(d={}),ce(a,void 0,void 0,function(){var p,h,m,v,g;return le(this,function(y){switch(y.label){case 0:return f&&l.customProperties.reference(n.descriptor,!0),p=s(l),h=D.merge(n.defaultParams,p.props,d),p.data.value&&D.areEqual(n.defaultParams,p.props,h)?[2]:[4,n.obtain(c,l,h)];case 1:return m=y.sent(),v=m.value,g=m.assets,l.customProperties.add(n.descriptor),l.customProperties.assets(n.descriptor,g),u(l,h,v),[2]}})})},ref:function(c,l){return c.customProperties.reference(n.descriptor,l)},get:function(c){var l;return null===(l=s(c))||void 0===l?void 0:l.data},set:function(c,l,d){void 0===l&&(l={});var f=s(c),p=D.merge(n.defaultParams,f.props,l);D.areEqual(n.defaultParams,f.props,p)||(u(c,p,d),c.customProperties.assets(n.descriptor))},props:function(c){return s(c).props}}}e.createProvider=t,e.createSimple=function r(n,a,i){var o=this,s={value:D.Value(i,{isHidden:!0})};return t({label:kc(n),descriptor:ec({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:D.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,c,l){return ce(o,void 0,void 0,function(){return le(this,function(d){return[2,R(R({},D.getDefaultValues(s)),l)]})})}})}}(Xv||(Xv={})),function(e){var t=this;function r(o){if(!Pn.is(o.sourceData))return!1;var s=o.sourceData.data.db.atom_site;return s.pdbx_sifts_xref_db_name.isDefined&&s.pdbx_sifts_xref_db_acc.isDefined&&s.pdbx_sifts_xref_db_num.isDefined&&s.pdbx_sifts_xref_db_res.isDefined}function i(o){if(Pn.is(o.sourceData)){var s=o.sourceData.data.db.atom_site,u=s.pdbx_sifts_xref_db_name,c=s.pdbx_sifts_xref_db_acc,l=s.pdbx_sifts_xref_db_num,d=s.pdbx_sifts_xref_db_res;if(u.isDefined&&c.isDefined&&l.isDefined&&d.isDefined){for(var f=o.atomicHierarchy.atomSourceIndex,p=o.atomicHierarchy.residueAtomSegments,h=p.count,m=p.offsets,v=new Array(h),g=new Array(h),y=new Array(h),b=new Array(h),_=0;_<h;_++){var C=f.value(m[_]);0===u.valueKind(C)?(v[_]=u.value(C),g[_]=c.value(C),y[_]=l.value(C),b[_]=d.value(C)):(v[_]="",g[_]="",y[_]="",b[_]="")}return{dbName:v,accession:g,num:y,residue:b}}}}e.Provider=Xv.createProvider({label:"SIFTS Mapping",descriptor:ec({name:"sifts_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(o){return r(o)},obtain:function(o,s){return ce(t,void 0,void 0,function(){return le(this,function(u){return[2,{value:i(s)}]})})}}),e.isAvailable=r,e.getKey=function n(o){var s=o.unit.model,u=e.Provider.get(s).value;return u?u.accession[s.atomicHierarchy.residueAtomSegments.index[o.element]]:""},e.getLabel=function a(o){var s=o.unit.model,u=e.Provider.get(s).value;if(u){var c=s.atomicHierarchy.residueAtomSegments.index[o.element],l=u.dbName[c];if(l)return"".concat(l," ").concat(u.accession[c]," ").concat(u.num[c]," ").concat(u.residue[c])}}}(qd||(qd={}));function eS(e,t){if(Pn.is(e.sourceData))return e.sourceData.data.db[t]}function pQ(e){if(0===e.length)return[];if(1===e.length)return e[0].entityIndices;for(var t=On.create(),r=0,n=e;r<n.length;r++)for(var i=0,o=n[r].entityIndices;i<o.length;i++){var s=o[i];On.add(t,s,s)}return Rc(t.array),t.array}function qc(e,t){return{name:e,instance:function(r){var n=r.structures;if(t&&!t(n[0]))return Fa.Category.Empty;var a=n[0].model;if(!Pn.is(a.sourceData))return Fa.Category.Empty;var i=a.sourceData.data.db[e];return i&&i._rowCount?Fa.Category.ofTable(i):Fa.Category.Empty}}}var hQ=Fa.Category;w4("struct_asym"),w4("entity_poly"),w4("entity_poly_seq");function w4(e){return{name:e,instance:function(t){return function Lke(e,t,r){var n=eS(e[0].model,t);if(!n)return hQ.Empty;var a=n.entity_id,i=r.uniqueEntityIds||(r.uniqueEntityIds=function Ike(e){if(0===e.length)return new Set;var t=e[0].model.entities.data.id;return new Set(pQ(e).map(function(r){return t.value(r)}))}(e)),o=ie.indicesOf(a,function(s){return i.has(s)});return hQ.ofTable(n,o)}(t.structures,e,t.cache)}}}var A4;!function(e){e.create=function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}}(A4||(A4={}));var E4;function T4(e){return e.units.every(function(t){return t.conformation.operator.isIdentity})}function D4(e){return T4(e)&&e.units.every(function(t){return!t.conformation.operator.assembly&&!t.conformation.operator.suffix})}qc("entry"),qc("exptl"),qc("cell",T4),qc("symmetry",T4),qc("pdbx_struct_assembly",D4),qc("pdbx_struct_assembly_gen",D4),qc("pdbx_struct_oper_list",D4),qc("pdbx_entity_branch"),qc("pdbx_entity_branch_link"),qc("pdbx_branch_scheme"),qc("struct_conn"),qc("atom_sites"),function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])}(E4||(E4={}));var jke={molstar_atom_site_operator_mapping:{label_asym_id:ie.Schema.Str(),auth_asym_id:ie.Schema.Str(),operator_name:ie.Schema.Str(),suffix:ie.Schema.Str(),assembly_id:ie.Schema.Str(),assembly_operator_id:ie.Schema.Int(),symmetry_operator_index:ie.Schema.Int(),symmetry_hkl:ie.Schema.Vector(3),ncs_id:ie.Schema.Int()}},vQ=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},I4=function(e,t){return-1===t[e].operator.spgrOp?1:0};function Uy(e,t){return t?1===t.length?nc(t.charCodeAt(0),e):2===t.length?nc(t.charCodeAt(0),nc(t.charCodeAt(1),e)):"".concat(e," ").concat(t):e}function Kke(e,t,r,n){var a;e.has(t)?(a=e.get(t)).has(r)||a.set(r,n):(e.set(t,a=new Map),a.set(r,n))}function Zke(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}Fa.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return(null===(r=t[e].operator.assembly)||void 0===r?void 0:r.id)||""},{valueKind:vQ}).int("assembly_operator_id",function(e,t){var r;return(null===(r=t[e].operator.assembly)||void 0===r?void 0:r.operId)||0},{valueKind:vQ}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:I4}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:I4}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:I4}).getFields();var tS=o4.EmptyResidueKey(),$ke=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return void 0!==r?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;1===arguments.length?i=t:(tS.label_entity_id=t,tS.label_asym_id=r,tS.auth_seq_id=n,tS.pdbx_PDB_ins_code=a,i=tS);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=Uy(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueLabel=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=Uy(t.label_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=Uy(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=Uy(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=Xe.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=Vv.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=Vv.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?P4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):M4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?P4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):M4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?P4(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):M4(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return function Jke(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e.prototype.findElementOnResidue=function(t,r){return function eBe(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)},e}();function P4(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function M4(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function sBe(e,t,r,n,a,i){var o=function rBe(e){if(0===e._rowCount)return{residues:[],chains:[]};for(var r=e._rowCount,n=[0],a=[0],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,c=e.pdbx_PDB_ins_code,l=1;l<r;l++){var d=!i.areValuesEqual(l-1,l)||!o.areValuesEqual(l-1,l);(d||!s.areValuesEqual(l-1,l)||!u.areValuesEqual(l-1,l)||!c.areValuesEqual(l-1,l))&&(n[n.length]=l),d&&(a[a.length]=l)}return{residues:n,chains:a}}(e),s=function nBe(e,t,r){var n=Qr.ofColumns(sFe,{type_symbol:ie.ofArray({array:ie.mapToArray(e.type_symbol,Ov),schema:ie.Schema.Aliased(ie.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=Qr.view(e,uFe,r.residues),i=Qr.view(e,cFe,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,c=0,l=0,d=0,f=o.length;d<f;++d)s[d]>=u[c+1]&&(c+=1,l=0),o[d]=++l;a.label_seq_id=ie.ofIntArray(o)}return Qr.columnToArray(a,"label_seq_id",Int32Array),Qr.columnToArray(a,"auth_seq_id",Int32Array),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}(e,t,o),u=function oBe(e,t){var r=new Map;if(!Pn.is(t))return r;var n=Ld(jke,t.data.frame).molstar_atom_site_operator_mapping;if(0===n._rowCount)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=0===n.assembly_operator_id.valueKind(o)?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=sa.create(n.operator_name.value(o),me.identity(),{assembly:s,spgrOp:0===n.symmetry_operator_index.valueKind(o)?n.symmetry_operator_index.value(o):void 0,hkl:S.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),c=n.suffix.value(o),l=n.label_asym_id.value(o);a.set("".concat(l).concat(c),{name:l,operator:u});var d=n.auth_asym_id.value(o);i.set("".concat(d).concat(c),d)}var f=e.chains,p=f.label_asym_id,h=f.auth_asym_id,m=new Array(p.rowCount),v=new Array(p.rowCount);for(o=0;o<p.rowCount;o++)if(l=p.value(o),d=h.value(o),a.has(l)){var g=a.get(l),y=g.name;r.set(o,u=g.operator),m[o]=y,v[o]=i.get(d)||d}else m[o]=l,v[o]=d;return e.chains.label_asym_id=ie.ofArray({array:m,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ie.ofArray({array:v,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}(s,a);if(i&&function iBe(e,t){return Qr.areEqual(e.chains,t.chains)&&Qr.areEqual(e.residues,t.residues)&&Qr.areEqual(e.atoms,t.atoms)}(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var c={residueAtomSegments:tr.ofOffsets(o.residues,xe.ofBounds(0,e._rowCount)),chainAtomSegments:tr.ofOffsets(o.chains,xe.ofBounds(0,e._rowCount))},l=function tBe(e,t,r){for(var n=function Qke(e,t,r){return{entities:e,segments:r,label_seq_id:Xe.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,c=u.label_entity_id,l=u.label_asym_id,d=u.auth_asym_id,f=xe.ofBounds(0,e.atoms._rowCount),p=tr.transientSegments(r.chainAtomSegments,f);p.hasNext;){var h=p.move(),m=h.index,v=t.getEntityIndex(c.value(m));v<0&&Zke(c.value(m)),n.chain_index_entity_index[m]=v;var g=d.value(m),y=n.auth_asym_id_auth_seq_id.get(g);y||n.auth_asym_id_auth_seq_id.set(g,y=new Map);var b=l.value(m);n.label_asym_id.has(b)||n.label_asym_id.set(b,v),Kke(n.entity_index_label_asym_id,v,b,m);var _=new Map,C=new Map;n.chain_index_label_seq_id.set(m,_),n.chain_index_auth_seq_id.set(m,C);for(var x=tr.transientSegments(r.residueAtomSegments,f,h);x.hasNext;){var T=x.move().index,w=o.value(T),E=s.value(T);_.set(Uy(i.value(T),E),T),C.set(Uy(w,E),T),y.set(w,m)}}return new $ke(n)}(s,r,c),d=function Xke(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,c=t.residueAtomSegments.offsets,l=new Uint8Array(s),d=0;d<s;++d)l[d]=H2(o.value(d));var f=new Int32Array(u),p=new Int32Array(u),h=new Int32Array(u),m=new Uint8Array(u),v=new Uint8Array(u),g=new Map,y=new Map;for(d=0;d<u;++d){var b=i.value(c[d]),_=n,C=void 0,x=void 0;if(g.has(b))C=g.get(b),x=y.get(b);else{var A=void 0;_.has(b)?A=_.get(b).type:(S2||console.info("chemComp not found",b),A=yK(b)),x=zPe(A,C=Hh(A,b)),g.set(b,C),y.set(b,x)}m[d]=C,v[d]=x;var T=Yh(x,"trace"),w=r.findAtomsOnResidue(d,T);if(-1===w){var E=Yh(x,"coarseBackbone");-1===(w=r.findAtomsOnResidue(d,E))&&pT(C)&&(w=r.findElementOnResidue(d,Ov("C")))}f[d]=w;var I=Yh(x,"directionFrom");p[d]=r.findAtomsOnResidue(d,I);var M=Yh(x,"directionTo");h[d]=r.findAtomsOnResidue(d,M)}return{atom:{atomicNumber:l},residue:{traceElementIndex:f,directionFromElementIndex:p,directionToElementIndex:h,moleculeType:m,polymerType:v}}}(s,c,l,n);return{sameAsPrevious:!1,hierarchy:R(R(R({},s),c),{index:l,derived:d}),chainOperatorMapping:u}}function gQ(e,t,r,n,a,i){var o=sBe(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,c=o.chainOperatorMapping,l=function aBe(e){return{id:Gn.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:ie.ofConst(1,e._rowCount,ie.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}(e);return{sameAsPrevious:s,hierarchy:u,conformation:l,chainOperatorMapping:c}}var yQ={chainKey:[],entityKey:[],findSequenceKey:function(){return-1},findChainKey:function(){return-1},getEntityFromChain:function(){return-1},count:0,entity_id:ie.Undefined(0,ie.Schema.str),asym_id:ie.Undefined(0,ie.Schema.str),seq_id_begin:ie.Undefined(0,ie.Schema.int),seq_id_end:ie.Undefined(0,ie.Schema.int),chainElementSegments:tr.create([]),polymerRanges:wn.ofSortedRanges([]),gapRanges:wn.ofSortedRanges([])},bQ=function(e){return e.Empty={isDefined:!1,spheres:yQ,gaussians:yQ},e}(bQ||{});function uBe(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function cBe(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function dBe(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}function _Q(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,c=new Map,l={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count),h=0;h<o;h++)f[h]=t.getEntityIndex(r.value(h)),f[h]<0&&dBe(r.value(h));for(var m=0;m<s.count;m++){var v=s.offsets[m],g=s.offsets[m+1],y=f[v];p[m]=y;var _=uBe(cBe(c,y),n.value(v),l);for(h=v;h<g;h++)d[h]=_;var C=[],x=[];for(h=v;h<g;h++){var A=a.value(h),T=i.value(h);C.push(h),x.push(A,T)}var w={elementIndices:C,seqRanges:wn.ofSortedRanges(x)};u.set(_,w)}var E=function lBe(e,t,r){var n=e.getEntityIndex;return{findChainKey:function(o,s){var u=n(o);if(u<0)return-1;var c=t.get(u);return c.has(s)?c.get(s):-1},findSequenceKey:function(o,s,u){var c=n(o);if(c<0)return-1;var l=t.get(c);if(void 0===l)return-1;var d=l.get(s);if(void 0===d)return-1;var f=r.get(d),p=f.elementIndices,m=wn.firstIntersectionIndex(f.seqRanges,Be.ofSingleton(u));return-1!==m?p[m]:-1}}}(t,c,u);return{chainKey:d,entityKey:f,findSequenceKey:E.findSequenceKey,findChainKey:E.findChainKey,getEntityFromChain:function(N){return p[N]}}}function SQ(e,t){for(var r=[],n=[],a=tr.transientSegments(e.chainElementSegments,xe.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,c=s.end,l=-1,d=-1,f=u;f<c;++f){var p=o.value(f);f===u?(l=f,d=o.value(f)):i.value(f)-d>1&&(r.push(l,f-1),n.push(f-1,f),l=f),f===c-1&&r.push(l,f),d=p}return{polymerRanges:wn.ofSortedRanges(r),gapRanges:wn.ofSortedRanges(n)}}var CQ={hierarchy:bQ.Empty,conformation:void 0};function xQ(e){var t=e.entity_id,a=e.asym_id;return R({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:e.seq_id_begin,seq_id_end:e.seq_id_end},function mBe(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++)!e.areValuesEqual(a-1,a)&&(n[n.length]=a);return{chainElementSegments:tr.ofOffsets(n,xe.ofBounds(0,e.rowCount))}}(a))}var rS,R4,vBe={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},gBe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},yBe={A:"A",C:"C",G:"G",T:"T",U:"U"};function wQ(e){return vBe[e]||"X"}function AQ(e){return yBe[e]||"X"}function TQ(e){return gBe[e]||"X"}function DQ(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return R4.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},c=[],l=i.rowCount,d=0;d<l;){for(var f=d;d<l-1&&i.areValuesEqual(d,d+1);)d++;d++;var p=i.value(f),h=ie.window(s,f,d),m=ie.window(o,f,d),v=t.getEntityIndex(p);u[v]={entityId:p,sequence:rS.ofResidueNames(h,m)},c.push(u[v])}return{byEntityKey:u,sequences:c}}function EQ(e,t,r,n){return ce(this,void 0,void 0,function(){var a,o,s,u,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return a=uN(r,n-1),o=t.label_asym_id,s=t.label_seq_id,u=iN(a,t.label_entity_id.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:m.sent(),m.label=2;case 2:c=0,l=u.length-1,m.label=3;case 3:if(!(c<l))return[3,10];d=iN(a,o.value,{start:u[c],end:u[c+1]}),f=0,p=d.length-1,m.label=4;case 4:return f<p?0!==s.valueKind(h=d[f])?[3,6]:(iN(a,s.value,{sort:!0,start:h,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6]):[3,7];case 5:m.sent(),m.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:m.sent(),m.label=9;case 9:return c++,[3,3];case 10:return function rEe(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:ie.ofIntArray(a)}]:[2,{atom_site:Qr.view(t,t._schema,a),sourceIndex:ie.ofIntArray(a)}]}})})}function IQ(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,c=i.directionToElementIndex,l=o[e],d=o[t];if(0===l||0===d||-1===s[e]||-1===s[t])return!1;var f=n.findAtomsOnResidue(e,Yh(l,"backboneStart")),p=n.findAtomsOnResidue(t,Yh(d,"backboneEnd"));(-1===f||-1===p)&&(f=n.findAtomsOnResidue(e,Yh(l,"coarseBackbone")),p=n.findAtomsOnResidue(t,Yh(d,"coarseBackbone")));var h=r.x,m=r.y,v=r.z,g=S.create(h[f],m[f],v[f]),y=S.create(h[p],m[p],v[p]),b=-1===u[e]||-1===c[e]||-1===u[t]||-1===c[t];return S.distance(g,y)<(b?10:3)}function PQ(e,t,r,n){for(var v,g,y,b,a=[],i=[],o=new Map,s=tr.transientSegments(e.chainAtomSegments,xe.ofBounds(0,e.atoms._rowCount)),u=tr.transientSegments(e.residueAtomSegments,xe.ofBounds(0,e.atoms._rowCount)),c=e.index,l=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,p=l.residue,h=p.moleculeType,m=p.traceElementIndex;s.hasNext;){var _=s.move();u.setSegment(_),v=-1,g=-1,y=-1,b=-1;var C=t.getEntityIndex(f.value(_.index)),x=n.byEntityKey[C],A=x?x.sequence.seqId.value(x.sequence.seqId.rowCount-1):-1,T=e.residueAtomSegments.index[_.start],w=e.residueAtomSegments.index[_.end-1],E=d.value(T),I=d.value(w);for(1===E&&I===A&&r.xyzDefined&&IQ(T,w,r,c,l)&&(o.set(T,w),o.set(w,T));u.hasNext;){var M=u.move(),F=M.index,N=d.value(F);pT(h[F])&&-1!==m[F]?-1!==b?N!==v+1?(a.push(b,y-1),i.push(g,M.end-1),b=M.start):u.hasNext?r.xyzDefined&&!IQ(e.residueAtomSegments.index[M.start],e.residueAtomSegments.index[y-1],r,e.index,l)&&(a.push(b,y-1),i.push(g,M.end-1),b=M.start):a.push(b,M.end-1):b=M.start:-1!==b&&(a.push(b,y-1),b=-1),g=M.start,y=M.end,v=N}}return{polymerRanges:wn.ofSortedRanges(a),gapRanges:wn.ofSortedRanges(i),cyclicPolymerMap:o}}function MQ(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function bBe(e){for(var t=new Map,r=function(s,u,c){return"".concat(s,"|").concat(u,"|").concat(c)},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,c){return t.has(r(s,u,c))},get:function(s,u,c){return t.get(r(s,u,c))},size:t.size}}function _Be(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),Qr.getRow(e.chem_comp,n));else RQ(e).forEach(function(o){t.set(o,function GPe(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:My.has(e)?"y":"n",pdbx_synonyms:[],type:yK(e)}}(o))});return t}function SBe(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0)for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if("SNFG CARBOHYDRATE SYMBOL"===a.value(o)||"SNFG CARB SYMBOL"===a.value(o)){var u=i.value(o),c=_Pe.get(u);c?t.set(n.value(o),c):console.warn("Unknown SNFG name '".concat(u,"'"))}if(e.chem_comp._rowCount>0){var l=e.chem_comp,d=l.id;for(a=l.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var p=a.value(o);np.has(f)?t.set(f,np.get(f)):9===Hh(p,f)&&t.set(f,TN)}}}else{var h=RQ(e);np.forEach(function(m,v){!t.has(v)&&h.has(v)&&t.set(v,m)})}return t}!function(e){var t,c;(c=t=e.Kind||(e.Kind={})).Protein="protein",c.RNA="RNA",c.DNA="DNA",c.Generic="generic",e.getSequenceString=function r(c){var l=c.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")},e.ofResidueNames=function i(c,l){if(0===l.rowCount)throw new Error("cannot be empty");var d=function n(c){for(var l=0,d=Math.min(c.rowCount,10);l<d;l++){var f=c.value(l)||"";if("X"!==wQ(f))return t.Protein;if("X"!==AQ(f))return t.RNA;if("X"!==TQ(f))return t.DNA}return t.Generic}(c);return new o(d,c,l)};var o=function(){function c(l,d,f){this.kind=l,this.microHet=new Map;for(var p=function a(c,l){var d;switch(c){case t.Protein:d=wQ;break;case t.DNA:d=TQ;break;case t.RNA:d=AQ;break;case t.Generic:d=function(){return"X"};break;default:xn()}return l&&l.size>0?function(f){var p=d(f);return"X"===p&&l.has(f)?d(l.get(f)):p}:d}(l),h=[],m=[],v=[],g=new Map,y=0,b=new Map,_=0,C=f.rowCount;_<C;++_){var x=f.value(_);if(b.has(x))g.has(x)?g.get(x).push(d.value(_)):g.set(x,[m[b.get(x)],d.value(_)]);else{b.set(x,y);var A=d.value(_);m[y]=A,v[y]=x,h[y]=p(A),y+=1}}var T=[];for(_=0,C=y;_<C;++_){var w=g.get(v[_]);if(w){var E=w.map(function(F){var N=p(F);return"X"===N?F:N});T[_]="(".concat(E.join("|"),")")}else T[_]="X"===h[_]?m[_]:h[_]}this.length=y,this.code=ie.ofStringArray(h),this.compId=ie.ofStringArray(m),this.seqId=ie.ofIntArray(v),this.label=ie.ofStringArray(T),this.microHet=g,this.indexMap=b}return c.prototype.index=function(l){return this.indexMap.get(l)},c}();e.ofSequenceRanges=function s(c,l){return new u(t.Generic,c,l)};var u=function(){function c(l,d,f){this.kind=l,this.seqIdStart=d,this.seqIdEnd=f,this.microHet=new Map;for(var p=0,h=Number.MAX_SAFE_INTEGER,m=0,v=this.seqIdStart.rowCount;m<v;m++){var g=this.seqIdStart.value(m),y=this.seqIdEnd.value(m);g<h&&(h=g),p<y&&(p=y)}var b=p-h+1;this.code=ie.ofConst("X",b,ie.Schema.str),this.label=ie.ofConst("",b,ie.Schema.str),this.seqId=ie.ofLambda({value:function(_){return _+h+1},rowCount:b,schema:ie.Schema.int}),this.compId=ie.ofConst("",b,ie.Schema.str),this.length=b,this.minSeqId=h}return c.prototype.index=function(l){return l-this.minSeqId},c}()}(rS||(rS={})),function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var c=[],l={},d=0,f=s.length;d<f;++d)c.push.apply(c,s[d].sequences),Object.assign(l,s[d].byEntityKey);return{sequences:c,byEntityKey:l}}function a(s,u){var c=u.atoms.label_comp_id,l=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,h=d.offsets,m={},v=[];if(1===d.count&&0===h[0]&&0===h[1])return{byEntityKey:m,sequences:v};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(void 0===m[b]&&"polymer"===s.data.type.value(b)){var _=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&"polymer"!==s.data.type.value(b);)g++;g--;for(var C=f.index[h[_]],x=f.index[h[g+1]-1]+1,A=ie.window(l,C,x),T=[],w=C;w<x;++w)T.push(c.value(f.offsets[w]));var E=ie.ofStringArray(T);m[b]={entityId:s.data.id.value(b),sequence:rS.ofResidueNames(E,A)},v.push(m[b])}}return{byEntityKey:m,sequences:v}}function i(s,u){return r(o(s,u.spheres),o(s,u.gaussians))}function o(s,u){var c=u.chainElementSegments,l=u.seq_id_begin,d=u.seq_id_end,f=c.count,p=c.offsets,h={},m=[];if(1===f&&0===p[0]&&0===p[1])return{byEntityKey:h,sequences:m};for(var v=0,g=f;v<g;v++){var y=u.getEntityFromChain(v);if(void 0===h[y]){var b=v;for(v++;v<g&&y===u.getEntityFromChain(v);)v++;v--;var _=p[b],C=p[v+1]-1,x=ie.window(l,_,C),A=ie.window(d,_,C);h[y]={entityId:s.data.id.value(y),sequence:rS.ofSequenceRanges(x,A)},m.push(h[y])}}return{byEntityKey:h,sequences:m}}e.fromHierarchy=function n(s,u,c){return r(a(s,u),c.isDefined?i(s,c):t)},e.fromAtomicHierarchy=a,e.fromCoarseHierarchy=i,e.fromCoarseElements=o}(R4||(R4={}));var RQ=MQ(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,i=n.isDefined?n:r.auth_comp_id,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function OQ(e,t){for(var r=new Map,n=e.chains,a=n.auth_asym_id,i=n.label_asym_id,o=n.label_entity_id,s=0,u=e.chains._rowCount;s<u;s++){var c=i.value(s);r.set(c,{id:c,auth_id:a.value(s),entity_id:o.value(s)})}if(t?.struct_asym._rowCount)for(var l=t.struct_asym,d=l.entity_id,f=(s=0,(c=l.id).rowCount);s<f;++s){var p=c.value(s);r.has(p)||r.set(p,{id:p,auth_id:"",entity_id:d.value(s)})}return r}var CBe=ie.Schema.Aliased(ie.Schema.Str());function FQ(e){var t;if(e.entity.id.isDefined)t=e.entity;else{for(var r=new Set,n=[],a=[],i=e.atom_site,o=i.label_entity_id,s=i.label_comp_id,u=0,c=e.atom_site._rowCount;u<c;u++){var l=o.value(u);r.has(l)||(n.push(l),a.push(HPe(s.value(u))),r.add(l))}var d=e.ihm_sphere_obj_site.entity_id;for(u=0,c=e.ihm_sphere_obj_site._rowCount;u<c;u++)l=d.value(u),r.has(l)||(n.push(l),a.push("polymer"),r.add(l));var f=e.ihm_gaussian_obj_site.entity_id;for(u=0,c=e.ihm_gaussian_obj_site._rowCount;u<c;u++)l=f.value(u),r.has(l)||(n.push(l),a.push("polymer"),r.add(l));t=Qr.ofPartialColumns(Vo.entity,{id:ie.ofArray({array:n,schema:Vo.entity.id}),type:ie.ofArray({array:a,schema:Vo.entity.type})},n.length)}var p=ie.createIndexer(t.id),h=new Array(t._rowCount);h.fill("other");var m=new Set,v=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){var g=e.entity_poly,y=g.entity_id,b=g.type,_=g._rowCount;for(u=0;u<_;++u)h[p(l=y.value(u))]=b.value(u),m.add(l)}else v=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){var C=e.pdbx_entity_branch;for(y=C.entity_id,b=C.type,_=C._rowCount,u=0;u<_;++u)h[p(l=y.value(u))]=b.value(u),m.add(l)}else v=!0;if(m.size<h.length&&(v=!0),v){var x=new Map;if(e.chem_comp){var A=e.chem_comp,T=A.id;for(b=A.type,u=0,c=e.chem_comp._rowCount;u<c;u++)x.set(T.value(u),b.value(u))}if(e.atom_site){var w=e.atom_site;for(o=w.label_entity_id,s=w.label_comp_id,u=0,c=e.atom_site._rowCount;u<c;u++)if(l=o.value(u),!m.has(l)){var E=s.value(u),I=x.get(E)||"other";h[p(l)]=jPe(E,I),m.add(l)}}}return{data:t,subtype:ie.ofArray({array:h,schema:CBe}),getEntityIndex:p}}function NQ(e,t,r){var n;if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;var a=new Array(t.data._rowCount);a.fill("");for(var i=e.pdbx_molecule,o=i.asym_id,s=i.prd_id,u=i._rowCount,c=0;c<u;++c){var l=o.value(c),d=null===(n=r.get(l))||void 0===n?void 0:n.entity_id;void 0!==d&&(a[t.getEntityIndex(d)]=s.value(c))}var f=ie.ofArray({array:a,schema:ie.Schema.str});return R(R({},t),{prd_id:f})}var ir,BQ,mp=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function Wd(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o;return le(this,function(s){switch(s.label){case 0:return n=function xBe(e,t){return{missingResidues:bBe(e),chemicalComponentMap:_Be(e),saccharideComponentMap:SBe(e)}}(e),e.ihm_model_list._rowCount>0?[4,DBe(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,TBe(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)ir.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new mp(a)]}})})}function kQ(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function TBe(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,f;return le(this,function(p){switch(p.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=FQ(t),s=0,p.label=1;case 1:return s<i?(u=kQ(t.atom_site.pdbx_PDB_model_num,s),[4,EQ(e,t.atom_site,s,u)]):[3,3];case 2:return c=p.sent(),f=function wBe(e,t,r,n,a,i,o){var s=gQ(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return R(R({},o),{id:Gn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var c=CQ,l=DQ(e,n,s.hierarchy,c.hierarchy),d=PQ(s.hierarchy,n,s.conformation,l),f=OQ(s.hierarchy),p=0===e.entry.id.valueKind(0)?e.entry.id.value(0):i.name,h=[];return p&&h.push(p),0===e.struct.title.valueKind(0)&&h.push(e.struct.title.value(0)),{id:Gn.create22(),entryId:p,label:h.join(" | "),entry:p,sourceData:i,modelNum:u,parent:void 0,entities:NQ(e,n,f),sequence:l,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:c.hierarchy,coarseConformation:c.conformation,properties:R(R({},a),{structAsymMap:f}),customProperties:new zl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}(t,c.atom_site,c.sourceIndex,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(f),s=u,[3,1];case 3:return[2,a]}})})}function O4(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=kQ(t,a),o=t.value(a);r.set(o,{table:Qr.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function DBe(e,t,r,n){return ce(this,void 0,void 0,function(){var a,o,s,u,c,l,d,f,p,h,m,v,g,y,C,x;return le(this,function(A){switch(A.label){case 0:if(a=FQ(t),o=O4(t.atom_site,t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num),s=O4(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=O4(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),c=[],!t.ihm_model_list)return[3,6];d=(l=t.ihm_model_list).model_id,f=l.model_name,p=0,A.label=1;case 1:return p<t.ihm_model_list._rowCount?(h=d.value(p),m=void 0,v=void 0,o.has(h)?(g=o.get(h),[4,EQ(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=A.sent(),m=y.atom_site,v=y.sourceIndex,[3,4];case 3:m=Qr.window(t.atom_site,t.atom_site._schema,0,0),v=ie.ofIntArray([]),A.label=4;case 4:C={model_id:h,model_name:f.value(p),model_group_name:xFe(h,t),entities:a,atom_site:m,atom_site_sourceIndex:v,ihm_sphere_obj_site:s.has(h)?s.get(h).table:Qr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(h)?u.get(h).table:Qr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},x=function ABe(e,t,r,n){var a=gQ(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=function fBe(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(0===r._rowCount&&0===n._rowCount)return CQ;var a=xQ(r),i=function pBe(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}(r),o=_Q(a,e.entities),s=SQ(a),u=xQ(n),c=function hBe(e){for(var t=Vo.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=Cr.toMat3(Qt(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}(n),l=_Q(u,e.entities),d=SQ(u);return{hierarchy:{isDefined:!0,spheres:R(R(R({},a),o),s),gaussians:R(R(R({},u),l),d)},conformation:{id:Gn.create22(),spheres:i,gaussians:c}}}(t),o=DQ(e,t.entities,a.hierarchy,i.hierarchy),s=PQ(a.hierarchy,t.entities,a.conformation,o),u=0===e.entry.id.valueKind(0)?e.entry.id.value(0):n.name,c=[];u&&c.push(u),0===e.struct.title.valueKind(0)&&c.push(e.struct.title.value(0)),t.model_name&&c.push(t.model_name),t.model_group_name&&c.push(t.model_group_name);var l=OQ(a.hierarchy,e);return{id:Gn.create22(),entryId:u,label:c.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:NQ(e,t.entities,l),sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:R(R({},r),{structAsymMap:l}),customProperties:new zl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}(t,C,r,n),c.push(x),A.label=5;case 5:return p++,[3,1];case 6:return[2,c]}})})}function F4(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}!function(e){function t(k,H){for(var G=[],U=H.frames,Q=k.atomicHierarchy.atomSourceIndex,K=ie.isIdentity(Q)?void 0:Q.toArray({array:Int32Array}),ne=m(k),X=k.atomicHierarchy.atoms._rowCount,L=0,Y=U.length;L<Y;++L){var $=U[L];if($.elementCount!==X)throw new Error("Frame element count mismatch, got ".concat($.elementCount," but expected ").concat(X,"."));var Z=R(R({},k),{id:Gn.create22(),modelNum:L,atomicConformation:Av.getAtomicConformation($,{atomId:k.atomicConformation.atomId,occupancy:k.atomicConformation.occupancy,B_iso_or_equiv:k.atomicConformation.B_iso_or_equiv},K),customProperties:new zl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if($.cell){var q=ei.fromCell($.cell.size,$.cell.anglesInRadians);ei.Provider.set(Z,q)}e.TrajectoryInfo.set(Z,{index:L,size:U.length}),e.CoarseGrained.set(Z,ne),G.push(Z)}return{trajectory:G,srcIndexArray:K}}e.trajectoryFromModelAndCoordinates=function r(k,H){return new mp(t(k,H).trajectory)},e.trajectoryFromTopologyAndCoordinates=function n(k,H){var G=this;return Ve.create("Create Trajectory",function(U){return ce(G,void 0,void 0,function(){var Q,W,K,X,L,Y,$,Z,q;return le(this,function(z){switch(z.label){case 0:return[4,Wd(k.basic,k.sourceData,U)];case 1:if(0===(Q=z.sent()).frameCount)throw new Error("found no model");for(K=t(W=Q.representative,H).trajectory,X=Lo.fromData({pairs:k.bonds,count:W.atomicHierarchy.atoms._rowCount}),L=m(W),Y=0,$=0,Z=K;$<Z.length;$++)Lo.Provider.set(q=Z[$],X),e.TrajectoryInfo.set(q,{index:Y++,size:K.length}),e.CoarseGrained.set(q,L);return[2,new mp(K)]}})})})};var a="__Center__";e.getCenter=function i(k){if(k._dynamicPropertyData[a])return k._dynamicPropertyData[a];var H=function aEe(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,tc(e.x)),n.push.apply(n,tc(e.y)),a.push.apply(a,tc(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,tc(t.spheres.x)),n.push.apply(n,tc(t.spheres.y)),a.push.apply(a,tc(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,tc(t.gaussians.x)),n.push.apply(n,tc(t.gaussians.y)),a.push.apply(a,tc(t.gaussians.z))));var i=tc(r),o=i[0],s=i[1],u=tc(n),c=u[0],l=u[1],d=tc(a),f=d[0];return S.create(o+(s-o)/2,c+(l-c)/2,f+(d[1]-f)/2)}(k.atomicConformation,k.coarseConformation);return k._dynamicPropertyData[a]=H,H};var s="__InvertedAtomSrcIndex__";e.getInvertedAtomSourceIndex=function u(k){if(k._staticPropertyData[s])return k._staticPropertyData[s];var H=function o(k){for(var H=new Int32Array(k.rowCount),G=!1,U=0,Q=k.rowCount;U<Q;U++){var W=k.value(U);W!==U&&(G=!1),H[W]=U}return{isIdentity:G,invertedIndex:H}}(k.atomicHierarchy.atomSourceIndex);return k._staticPropertyData[s]=H,H};var c="__TrajectoryInfo__";e.TrajectoryInfo={get:function(k){return k._dynamicPropertyData[c]||{index:0,size:1}},set:function(k,H){return k._dynamicPropertyData[c]=H}};var l="__AsymIdCount__";e.AsymIdCount={get:function(k){if(k._dynamicPropertyData[l])return k._dynamicPropertyData[l];var H=function iEe(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){t.add(n.auth_id),r.add(a)}),{auth:t.size,label:r.size}}(k);return k._dynamicPropertyData[l]=H,H}},e.AsymIdOffset=Xv.createSimple("asym_id_offset","static"),e.Index=Xv.createSimple("index","static"),e.MaxIndex=Xv.createSimple("max_index","static"),e.getRoot=function d(k){return k.parent||k},e.areHierarchiesEqual=function f(k,H){return k.atomicHierarchy===H.atomicHierarchy&&k.coarseHierarchy===H.coarseHierarchy};var p="__CoordinatesHistory__";e.CoordinatesHistory={get:function(k){return k._staticPropertyData[p]},set:function(k,H){return k._staticPropertyData[p]=H}};var h="__CoarseGrained__";function m(k){var H=e.CoarseGrained.get(k);if(void 0===H){for(var G=0,U=k.atomicHierarchy.derived.residue.polymerType,Q=0;Q<U.length;++Q)0!==U[Q]&&(G+=1);var W=!1,K=!1,ne=k.atomicHierarchy.atoms,X=ne.label_atom_id,L=ne._rowCount;for(Q=0;Q<L;++Q){var Y=X.value(Q);if(!W&&"BB"===Y&&(W=!0),!K&&"SC1"===Y&&(K=!0),W&&K)break}e.CoarseGrained.set(k,H=W&&K||!(!G||!L)&&L/G<3)}return H}function _(k){return!!Pn.is(k.sourceData)&&(null!==k.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)||null!==k.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i))}e.CoarseGrained={get:function(k){return k._staticPropertyData[h]},set:function(k,H){return k._staticPropertyData[h]=H}},e.isCoarseGrained=m,e.hasCarbohydrate=function v(k){return k.properties.saccharideComponentMap.size>0},e.hasProtein=function g(k){for(var H=k.entities.subtype,G=0,U=H.rowCount;G<U;++G)if(H.value(G).startsWith("polypeptide"))return!0;return!1},e.hasNucleic=function y(k){for(var H=k.entities.subtype,G=0,U=H.rowCount;G<U;++G){var Q=H.value(G);if(Q.endsWith("ribonucleotide hybrid")||Q.endsWith("ribonucleotide"))return!0}return!1},e.isFromPdbArchive=function b(k){if(!Pn.is(k.sourceData))return!1;for(var H=k.sourceData.data.db,G=0,U=H.database_2.database_id.rowCount;G<U;++G)if("pdb"===H.database_2.database_id.value(G))return!0;return!1},e.hasPdbId=_,e.hasSecondaryStructure=function C(k){if(Pn.is(k.sourceData)){var H=k.sourceData.data.db;return H.struct_conf.id.isDefined||H.struct_sheet_range.id.isDefined}return zv.Provider.isApplicable(k)};var x=S.create(1.5707963,1.5707963,1.5707963),A=S.create(1,1,1);function w(k){if(!Pn.is(k.sourceData))return!1;for(var H=k.sourceData.data.db,G=0;G<H.exptl.method.rowCount;G++)if(H.exptl.method.value(G).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}function E(k){if(!Pn.is(k.sourceData))return!1;for(var H=k.sourceData.data.db,G=0;G<H.exptl.method.rowCount;G++)if(H.exptl.method.value(G).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}function M(k){if(!Pn.is(k.sourceData)||!w(k))return!1;var G=k.sourceData.data.db.pdbx_database_status.status_code_sf;return G.isDefined&&"REL"===G.value(0)}function F(k){if(!Pn.is(k.sourceData))return!1;for(var H=k.sourceData.data.db,G=H.pdbx_database_related,U=G.db_name,Q=G.content_type,W=0,K=H.pdbx_database_related._rowCount;W<K;++W)if("EMDB"===U.value(W).toUpperCase()&&"associated EM volume"===Q.value(W))return!0;return!1}function N(k){return!!Pn.is(k.sourceData)&&(M(k)||F(k))}e.hasCrystalSymmetry=function T(k){var H,G=null===(H=ei.Provider.get(k))||void 0===H?void 0:H.spacegroup;return!(!G||1===G.num&&S.equals(G.cell.anglesInRadians,x)&&S.equals(G.cell.size,A))},e.isFromXray=w,e.isFromEm=E,e.isFromNmr=function I(k){if(!Pn.is(k.sourceData))return!1;for(var H=k.sourceData.data.db,G=0;G<H.exptl.method.rowCount;G++)if(H.exptl.method.value(G).toUpperCase().indexOf("NMR")>=0)return!0;return!1},e.hasXrayMap=M,e.hasEmMap=F,e.hasDensityMap=N,e.probablyHasDensityMap=function j(k){if(!Pn.is(k.sourceData))return!1;var H=k.sourceData.data.db;return N(k)||_(k)&&(!H.exptl.method.isDefined||w(k)&&(!H.pdbx_database_status.status_code_sf.isDefined||2===H.pdbx_database_status.status_code_sf.valueKind(0))||E(k)&&!H.pdbx_database_related.db_name.isDefined)}}(ir||(ir={})),function(e){e.getCifDataSource=function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];var h=f.getElements(d),m={data:h,rowCount:h.elements.length};return p&&(p[f.id]=m),m},e.fromAtomMap=function r(d){return new LQ(d)},e.fromAtomArray=function n(d){return new LQ(F4(d))};var a=function(d){return d.atomicHierarchy.residueAtomSegments};e.fromResidueMap=function i(d){return new jT("residue",d,a,0)},e.fromResidueArray=function o(d){return new jT("residue",F4(d),a,0)};var s=function(d){return d.atomicHierarchy.chainAtomSegments};e.fromChainMap=function u(d){return new jT("chain",d,s,0)},e.fromChainArray=function c(d){return new jT("chain",F4(d),s,0)},e.fromEntityMap=function l(d){return new EBe(d)}}(BQ||(BQ={}));var vp,ua,nS,jT=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=Gn.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(1!==r.length)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var l=u[s].units[0];if(l.kind===this.kind)for(var d=tr.transientSegments(o,l.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),i[i.length]=at.create(t,l,l.elements[f.start]))}}return i.sort(function(p,h){return p.element-h.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),LQ=function(){function e(t){this.map=t,this.id=Gn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){if(1!==t.models.length)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=[],o=0,s=t.unitSymmetryGroups;o<s.length;o++){var c=s[o].units[0];if(c.kind===this.kind)for(var l=c.elements,d=0,f=l.length;d<f;d++){var p=l[d];!this.has(p)||n.has(p)||(n.add(l[d]),i[i.length]=at.create(t,c,p))}}return i.sort(function(h,m){return h.element-m.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),EBe=function(){function e(t){this.map=t,this.id=Gn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(1!==r.length)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,c=t.unitSymmetryGroups;u<c.length;u++){var d=c[u].units[0];if(d.kind===this.kind)for(var f=tr.transientSegments(s,d.elements);f.hasNext;){var p=f.move(),h=n.getEntityFromChain(p.index);!this.has(h)||a.has(h)||(a.add(h),o[o.length]=at.create(t,d,d.elements[p.start]))}}return o.sort(function(m,v){return m.element-v.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}();!function(e){e.create=function t(n){return n},e.getDuration=function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=null===(o=(i=a.definition).getDuration)||void 0===o?void 0:o.call(i,a.params,n);return"fixed"===s?.kind?s.durationMs:void 0}}(vp||(vp={})),function(e){function r(a){var i;return(i=function(){function o(s,u){this.data=s,this.id=Gn.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}()).type=a,i}e.factory=function t(){return function(a){return r(a)}},e.create=r,e.hasTag=function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++)if(s[o]===i)return!0;return!1},e.Null={id:Gn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}}(ua||(ua={})),function(e){e.is=function t(n){return!!(n&&n.transform&&n.parent&&n.status)},e.resolve=function r(n,a){var i="string"==typeof a?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}}(nS||(nS={})),function(){function e(t){this.state=t,this.version=""}e.prototype.setQuery=function(t){this.query=wr.compile(t)},e.prototype.update=function(){var t=this.state.select(this.query)[0],r=t?t.transform.version:void 0,n=this.cell!==t||this.version!==r;return this.cell=t,this.version=r||"",this.data=t&&t.obj?t.obj.data:void 0,n}}();var Mo,UQ=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return null===(t=this.state)||void 0===t?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return null===(r=null===(t=this.state)||void 0===t?void 0:t.cells.get(this.ref))||void 0===r?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return null===(t=this.obj)||void 0===t?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if("ok"===t.status)return!0;throw"error"===t.status?new Error(t.errorText):t.obj===ua.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&"ok"===t.status&&t.obj!==ua.Null},enumerable:!1,configurable:!0}),e}();!function(e){function r(a,i){if(i)return nS.is(i)?i:"string"==typeof i?a.cells.get(i):i.cell}e.resolveRef=function t(a){var i;if(a)return"string"==typeof a?a:nS.is(a)?a.transform.ref:null===(i=a.cell)||void 0===i?void 0:i.transform.ref},e.resolve=r,e.resolveAndCheck=function n(a,i){var o=r(a,i);if(o&&o.obj&&"ok"===o.status)return o}}(Mo||(Mo={}));var aS="delete",Ga=5,Wc=1<<Ga,Js=Wc-1,Mn={};function Yc(e){e&&(e.value=!0)}function k4(){}function Vy(e){return void 0===e.size&&(e.size=e.__iterate(VQ)),e.size}function rm(e,t){if("number"!=typeof t){var r=t>>>0;if(""+r!==t||4294967295===r)return NaN;t=r}return t<0?Vy(e)+t:t}function VQ(){return!0}function iS(e,t,r){return(0===e&&!GQ(e)||void 0!==r&&e<=-r)&&(void 0===t||void 0!==r&&t>=r)}function zy(e,t){return zQ(e,t,0)}function oS(e,t){return zQ(e,t,t)}function zQ(e,t,r){return void 0===e?r:GQ(e)?t===1/0?t:0|Math.max(0,t+e):void 0===t||t===e?e:0|Math.min(t,e)}function GQ(e){return e<0||0===e&&1/e==-1/0}var HQ="@@__IMMUTABLE_ITERABLE__@@";function eu(e){return!(!e||!e[HQ])}var jQ="@@__IMMUTABLE_KEYED__@@";function ka(e){return!(!e||!e[jQ])}var qQ="@@__IMMUTABLE_INDEXED__@@";function ys(e){return!(!e||!e[qQ])}function sS(e){return ka(e)||ys(e)}var pi=function(t){return eu(t)?t:ru(t)},Xc=function(e){function t(r){return ka(r)?r:nm(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(pi),Kv=function(e){function t(r){return ys(r)?r:$c(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(pi),Gy=function(e){function t(r){return eu(r)&&!sS(r)?r:qy(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(pi);pi.Keyed=Xc,pi.Indexed=Kv,pi.Set=Gy;var WQ="@@__IMMUTABLE_SEQ__@@";function qT(e){return!(!e||!e[WQ])}var YQ="@@__IMMUTABLE_RECORD__@@";function Zv(e){return!(!e||!e[YQ])}function Kc(e){return eu(e)||Zv(e)}var Hy="@@__IMMUTABLE_ORDERED__@@";function Zc(e){return!(!e||!e[Hy])}var uS=0,Zl=1,Qc=2,B4="function"==typeof Symbol&&Symbol.iterator,XQ="@@iterator",WT=B4||XQ,jn=function(t){this.next=t};function Ha(e,t,r,n){var a=0===e?t:1===e?r:[t,r];return n?n.value=a:n={value:a,done:!1},n}function tu(){return{value:void 0,done:!0}}function L4(e){return!!Array.isArray(e)||!!YT(e)}function KQ(e){return e&&"function"==typeof e.next}function U4(e){var t=YT(e);return t&&t.call(e)}function YT(e){var t=e&&(B4&&e[B4]||e[XQ]);if("function"==typeof t)return t}jn.prototype.toString=function(){return"[Iterator]"},jn.KEYS=uS,jn.VALUES=Zl,jn.ENTRIES=Qc,jn.prototype.inspect=jn.prototype.toSource=function(){return this.toString()},jn.prototype[WT]=function(){return this};var jy=Object.prototype.hasOwnProperty;function V4(e){return!(!Array.isArray(e)&&"string"!=typeof e)||e&&"object"==typeof e&&Number.isInteger(e.length)&&e.length>=0&&(0===e.length?1===Object.keys(e).length:e.hasOwnProperty(e.length-1))}var ru=function(e){function t(r){return null==r?G4():Kc(r)?r.toSeq():function RBe(e){var t=j4(e);if(t)return function IBe(e){var t=YT(e);return t&&t===e.entries}(e)?t.fromEntrySeq():function PBe(e){var t=YT(e);return t&&t===e.keys}(e)?t.toSetSeq():t;if("object"==typeof e)return new z4(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,a){var i=this._cache;if(i){for(var o=i.length,s=0;s!==o;){var u=i[a?o-++s:s++];if(!1===n(u[1],u[0],this))break}return s}return this.__iterateUncached(n,a)},t.prototype.__iterator=function(n,a){var i=this._cache;if(i){var o=i.length,s=0;return new jn(function(){if(s===o)return{value:void 0,done:!0};var u=i[a?o-++s:s++];return Ha(n,u[0],u[1])})}return this.__iteratorUncached(n,a)},t}(pi),nm=function(e){function t(r){return null==r?G4().toKeyedSeq():eu(r)?ka(r)?r.toSeq():r.fromEntrySeq():Zv(r)?r.toSeq():H4(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(ru),$c=function(e){function t(r){return null==r?G4():eu(r)?ka(r)?r.entrySeq():r.toIndexedSeq():Zv(r)?r.toSeq().entrySeq():QQ(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(ru),qy=function(e){function t(r){return(eu(r)&&!sS(r)?r:$c(r)).toSetSeq()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(ru);ru.isSeq=qT,ru.Keyed=nm,ru.Set=qy,ru.Indexed=$c,ru.prototype[WQ]=!0;var Qv=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n,a){return this.has(n)?this._array[rm(this,n)]:a},t.prototype.__iterate=function(n,a){for(var i=this._array,o=i.length,s=0;s!==o;){var u=a?o-++s:s++;if(!1===n(i[u],u,this))break}return s},t.prototype.__iterator=function(n,a){var i=this._array,o=i.length,s=0;return new jn(function(){if(s===o)return{value:void 0,done:!0};var u=a?o-++s:s++;return Ha(n,u,i[u])})},t}($c),z4=function(e){function t(r){var n=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n,a){return void 0===a||this.has(n)?this._object[n]:a},t.prototype.has=function(n){return jy.call(this._object,n)},t.prototype.__iterate=function(n,a){for(var i=this._object,o=this._keys,s=o.length,u=0;u!==s;){var c=o[a?s-++u:u++];if(!1===n(i[c],c,this))break}return u},t.prototype.__iterator=function(n,a){var i=this._object,o=this._keys,s=o.length,u=0;return new jn(function(){if(u===s)return{value:void 0,done:!0};var c=o[a?s-++u:u++];return Ha(n,c,i[c])})},t}(nm);z4.prototype[Hy]=!0;var ZQ,MBe=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.__iterateUncached=function(n,a){if(a)return this.cacheResult().__iterate(n,a);var o=U4(this._collection),s=0;if(KQ(o))for(var u;!(u=o.next()).done&&!1!==n(u.value,s++,this););return s},t.prototype.__iteratorUncached=function(n,a){if(a)return this.cacheResult().__iterator(n,a);var o=U4(this._collection);if(!KQ(o))return new jn(tu);var s=0;return new jn(function(){var u=o.next();return u.done?u:Ha(n,s++,u.value)})},t}($c);function G4(){return ZQ||(ZQ=new Qv([]))}function H4(e){var t=j4(e);if(t)return t.fromEntrySeq();if("object"==typeof e)return new z4(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function QQ(e){var t=j4(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function j4(e){return V4(e)?new Qv(e):L4(e)?new MBe(e):void 0}var $Q="@@__IMMUTABLE_MAP__@@";function XT(e){return!(!e||!e[$Q])}function q4(e){return XT(e)&&Zc(e)}function W4(e){return!(!e||"function"!=typeof e.equals||"function"!=typeof e.hashCode)}function zo(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!!(W4(e)&&W4(t)&&e.equals(t))}var cS="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(t,r){var n=65535&(t|=0),a=65535&(r|=0);return n*a+((t>>>16)*a+n*(r>>>16)<<16>>>0)|0};function KT(e){return e>>>1&1073741824|3221225471&e}var OBe=Object.prototype.valueOf;function Du(e){if(null==e)return JQ(e);if("function"==typeof e.hashCode)return KT(e.hashCode(e));var t=function UBe(e){return e.valueOf!==OBe&&"function"==typeof e.valueOf?e.valueOf(e):e}(e);if(null==t)return JQ(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return function FBe(e){if(e!=e||e===1/0)return 0;var t=0|e;for(t!==e&&(t^=4294967295*e);e>4294967295;)t^=e/=4294967295;return KT(t)}(t);case"string":return t.length>VBe?function NBe(e){var t=$4[e];return void 0===t&&(t=Y4(e),Q4===zBe&&(Q4=0,$4={}),Q4++,$4[e]=t),t}(t):Y4(t);case"object":case"function":return function BBe(e){var t;if(X4&&void 0!==(t=K4.get(e))||void 0!==(t=e[$v])||!t$&&(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[$v])||(t=function LBe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e),void 0!==t)))return t;if(t=r$(),X4)K4.set(e,t);else{if(void 0!==e$&&!1===e$(e))throw new Error("Non-extensible objects are not allowed as keys.");if(t$)Object.defineProperty(e,$v,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[$v]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[$v]=t}}return t}(t);case"symbol":return function kBe(e){var t=n$[e];return void 0!==t||(t=r$(),n$[e]=t),t}(t);default:if("function"==typeof t.toString)return Y4(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function JQ(e){return null===e?1108378658:1108378659}function Y4(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return KT(t)}var e$=Object.isExtensible,t$=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function r$(){var e=++Z4;return 1073741824&Z4&&(Z4=0),e}var K4,X4="function"==typeof WeakMap;X4&&(K4=new WeakMap);var n$=Object.create(null),Z4=0,$v="__immutablehash__";"function"==typeof Symbol&&($v=Symbol($v));var VBe=16,zBe=255,Q4=0,$4={},ZT=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n,a){return this._iter.get(n,a)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,a=J4(this,!0);return this._useKeys||(a.valueSeq=function(){return n._iter.toSeq().reverse()}),a},t.prototype.map=function(n,a){var i=this,o=u$(this,n,a);return this._useKeys||(o.valueSeq=function(){return i._iter.toSeq().map(n,a)}),o},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o,s){return n(o,s,i)},a)},t.prototype.__iterator=function(n,a){return this._iter.__iterator(n,a)},t}(nm);ZT.prototype[Hy]=!0;var a$=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this,o=0;return a&&Vy(this),this._iter.__iterate(function(s){return n(s,a?i.size-++o:o++,i)},a)},t.prototype.__iterator=function(n,a){var i=this,o=this._iter.__iterator(Zl,a),s=0;return a&&Vy(this),new jn(function(){var u=o.next();return u.done?u:Ha(n,a?i.size-++s:s++,u.value,u)})},t}($c),i$=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(Zl,a);return new jn(function(){var o=i.next();return o.done?o:Ha(n,o.value,o.value,o)})},t}(qy),o$=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){if(o){p$(o);var s=eu(o);return n(s?o.get(1):o[1],s?o.get(0):o[0],i)}},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(Zl,a);return new jn(function(){for(;;){var o=i.next();if(o.done)return o;var s=o.value;if(s){p$(s);var u=eu(s);return Ha(n,u?s.get(0):s[0],u?s.get(1):s[1],o)}}})},t}(nm);function s$(e){var t=Yd(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=rk,t.__iterateUncached=function(r,n){var a=this;return e.__iterate(function(i,o){return!1!==r(o,i,a)},n)},t.__iteratorUncached=function(r,n){if(r===Qc){var a=e.__iterator(r,n);return new jn(function(){var i=a.next();if(!i.done){var o=i.value[0];i.value[0]=i.value[1],i.value[1]=o}return i})}return e.__iterator(r===Zl?uS:Zl,n)},t}function u$(e,t,r){var n=Yd(e);return n.size=e.size,n.has=function(a){return e.has(a)},n.get=function(a,i){var o=e.get(a,Mn);return o===Mn?i:t.call(r,o,a,e)},n.__iterateUncached=function(a,i){var o=this;return e.__iterate(function(s,u,c){return!1!==a(t.call(r,s,u,c),u,o)},i)},n.__iteratorUncached=function(a,i){var o=e.__iterator(Qc,i);return new jn(function(){var s=o.next();if(s.done)return s;var u=s.value,c=u[0];return Ha(a,c,t.call(r,u[1],c,e),s)})},n}function J4(e,t){var r=this,n=Yd(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var a=s$(e);return a.reverse=function(){return e.flip()},a}),n.get=function(a,i){return e.get(t?a:-1-a,i)},n.has=function(a){return e.has(t?a:-1-a)},n.includes=function(a){return e.includes(a)},n.cacheResult=rk,n.__iterate=function(a,i){var o=this,s=0;return i&&Vy(e),e.__iterate(function(u,c){return a(u,t?c:i?o.size-++s:s++,o)},!i)},n.__iterator=function(a,i){var o=0;i&&Vy(e);var s=e.__iterator(Qc,!i);return new jn(function(){var u=s.next();if(u.done)return u;var c=u.value;return Ha(a,t?c[0]:i?r.size-++o:o++,c[1],u)})},n}function c$(e,t,r,n){var a=Yd(e);return n&&(a.has=function(i){var o=e.get(i,Mn);return o!==Mn&&!!t.call(r,o,i,e)},a.get=function(i,o){var s=e.get(i,Mn);return s!==Mn&&t.call(r,s,i,e)?s:o}),a.__iterateUncached=function(i,o){var s=this,u=0;return e.__iterate(function(c,l,d){if(t.call(r,c,l,d))return u++,i(c,n?l:u-1,s)},o),u},a.__iteratorUncached=function(i,o){var s=e.__iterator(Qc,o),u=0;return new jn(function(){for(;;){var c=s.next();if(c.done)return c;var l=c.value,d=l[0],f=l[1];if(t.call(r,f,d,e))return Ha(i,n?d:u++,f,c)}})},a}function ek(e,t,r,n){var a=e.size;if(iS(t,r,a))return e;var i=zy(t,a),o=oS(r,a);if(i!=i||o!=o)return ek(e.toSeq().cacheResult(),t,r,n);var u,s=o-i;s==s&&(u=s<0?0:s);var c=Yd(e);return c.size=0===u?u:e.size&&u||void 0,!n&&qT(e)&&u>=0&&(c.get=function(l,d){return(l=rm(this,l))>=0&&l<u?e.get(l+i,d):d}),c.__iterateUncached=function(l,d){var f=this;if(0===u)return 0;if(d)return this.cacheResult().__iterate(l,d);var p=0,h=!0,m=0;return e.__iterate(function(v,g){if(!h||!(h=p++<i))return m++,!1!==l(v,n?g:m-1,f)&&m!==u}),m},c.__iteratorUncached=function(l,d){if(0!==u&&d)return this.cacheResult().__iterator(l,d);if(0===u)return new jn(tu);var f=e.__iterator(l,d),p=0,h=0;return new jn(function(){for(;p++<i;)f.next();if(++h>u)return{value:void 0,done:!0};var m=f.next();return n||l===Zl||m.done?m:Ha(l,h-1,l===uS?void 0:m.value[1],m)})},c}function l$(e,t,r,n){var a=Yd(e);return a.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var u=!0,c=0;return e.__iterate(function(l,d,f){if(!u||!(u=t.call(r,l,d,f)))return c++,i(l,n?d:c-1,s)}),c},a.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var u=e.__iterator(Qc,o),c=!0,l=0;return new jn(function(){var d,f,p;do{if((d=u.next()).done)return n||i===Zl?d:Ha(i,l++,i===uS?void 0:d.value[1],d);var h=d.value;f=h[0],p=h[1],c&&(c=t.call(r,p,f,s))}while(c);return i===Qc?d:Ha(i,f,p,d)})},a}function d$(e,t,r){var n=Yd(e);return n.__iterateUncached=function(a,i){if(i)return this.cacheResult().__iterate(a,i);var o=0,s=!1;return function u(c,l){c.__iterate(function(d,f){return(!t||l<t)&&eu(d)?u(d,l+1):(o++,!1===a(d,r?f:o-1,n)&&(s=!0)),!s},i)}(e,0),o},n.__iteratorUncached=function(a,i){if(i)return this.cacheResult().__iterator(a,i);var o=e.__iterator(a,i),s=[],u=0;return new jn(function(){for(;o;){var c=o.next();if(!1===c.done){var l=c.value;if(a===Qc&&(l=l[1]),t&&!(s.length<t)||!eu(l))return r?c:Ha(a,u++,l,c);s.push(o),o=l.__iterator(a,i)}else o=s.pop()}return{value:void 0,done:!0}})},n}function Wy(e,t,r){t||(t=h$);var n=ka(e),a=0,i=e.toSeq().map(function(o,s){return[s,o,a++,r?r(o,s,e):o]}).valueSeq().toArray();return i.sort(function(o,s){return t(o[3],s[3])||o[2]-s[2]}).forEach(n?function(o,s){i[s].length=2}:function(o,s){i[s]=o[1]}),n?nm(i):ys(e)?$c(i):qy(i)}function QT(e,t,r){if(t||(t=h$),r){var n=e.toSeq().map(function(a,i){return[a,r(a,i,e)]}).reduce(function(a,i){return f$(t,a[1],i[1])?i:a});return n&&n[0]}return e.reduce(function(a,i){return f$(t,a,i)?i:a})}function f$(e,t,r){var n=e(r,t);return 0===n&&r!==t&&(null==r||r!=r)||n>0}function $T(e,t,r,n){var a=Yd(e),i=new Qv(r).map(function(o){return o.size});return a.size=n?i.max():i.min(),a.__iterate=function(o,s){for(var c,u=this.__iterator(Zl,s),l=0;!(c=u.next()).done&&!1!==o(c.value,l++,this););return l},a.__iteratorUncached=function(o,s){var u=r.map(function(d){return d=pi(d),U4(s?d.reverse():d)}),c=0,l=!1;return new jn(function(){var d;return l||(d=u.map(function(f){return f.next()}),l=n?d.every(function(f){return f.done}):d.some(function(f){return f.done})),l?{value:void 0,done:!0}:Ha(o,c++,t.apply(null,d.map(function(f){return f.value})))})},a}function Ta(e,t){return e===t?e:qT(e)?t:e.constructor(t)}function p$(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function tk(e){return ka(e)?Xc:ys(e)?Kv:Gy}function Yd(e){return Object.create((ka(e)?nm:ys(e)?$c:qy).prototype)}function rk(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):ru.prototype.cacheResult.call(this)}function h$(e,t){return void 0===e&&void 0===t?0:void 0===e?1:void 0===t?-1:e>t?1:e<t?-1:0}function Xd(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),a=0;a<r;a++)n[a]=e[a+t];return n}function nk(e,t){if(!e)throw new Error(t)}function cc(e){nk(e!==1/0,"Cannot perform this action with an infinite size.")}function m$(e){if(V4(e)&&"string"!=typeof e)return e;if(Zc(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}a$.prototype.cacheResult=ZT.prototype.cacheResult=i$.prototype.cacheResult=o$.prototype.cacheResult=rk;var KBe=Object.prototype.toString;function am(e){return"object"==typeof e&&(Kc(e)||Array.isArray(e)||function ak(e){if(!e||"object"!=typeof e||"[object Object]"!==KBe.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var r=t,n=Object.getPrototypeOf(t);null!==n;)r=n,n=Object.getPrototypeOf(r);return r===t}(e))}function lS(e){try{return"string"==typeof e?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function ik(e,t,r){return Kc(e)?e.get(t,r):function v$(e,t){return Kc(e)?e.has(t):am(e)&&jy.call(e,t)}(e,t)?"function"==typeof e.get?e.get(t):e[t]:r}function JT(e){if(Array.isArray(e))return Xd(e);var t={};for(var r in e)jy.call(e,r)&&(t[r]=e[r]);return t}function Jv(e,t,r,n){n||(n=r,r=void 0);var a=b$(Kc(e),e,m$(t),0,r,n);return a===Mn?r:a}function b$(e,t,r,n,a,i){var o=t===Mn;if(n===r.length){var s=o?a:t,u=i(s);return u===s?t:u}if(!o&&!am(t))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,n).map(lS)+"]: "+t);var c=r[n],l=o?Mn:ik(t,c,Mn),d=b$(l===Mn?e:Kc(l),l,r,n+1,a,i);return d===l?t:d===Mn?function g$(e,t){if(!am(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Kc(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!jy.call(e,t))return e;var r=JT(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}(t,c):function y$(e,t,r){if(!am(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Kc(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(jy.call(e,t)&&r===e[t])return e;var n=JT(e);return n[t]=r,n}(o?e?Ql():{}:t,c,d)}function ok(e,t){return function _$(e,t,r){return Jv(e,t,Mn,function(){return r})}(this,e,t)}function sk(e){return function S$(e,t){return Jv(e,t,function(){return Mn})}(this,e)}function uk(e,t,r,n){return Jv(e,[t],r,n)}function ck(e,t,r){return 1===arguments.length?e(this):uk(this,e,t,r)}function lk(e,t,r){return Jv(this,e,t,r)}function C$(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return w$(this,e)}function x$(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if("function"!=typeof e)throw new TypeError("Invalid merger function: "+e);return w$(this,t,e)}function w$(e,t,r){for(var n=[],a=0;a<t.length;a++){var i=Xc(t[a]);0!==i.size&&n.push(i)}return 0===n.length?e:0!==e.toSeq().size||e.__ownerID||1!==n.length?e.withMutations(function(o){for(var s=r?function(c,l){uk(o,l,Mn,function(d){return d===Mn?c:r(d,c,l)})}:function(c,l){o.set(l,c)},u=0;u<n.length;u++)n[u].forEach(s)}):e.constructor(n[0])}function dS(e,t,r){return fS(e,t,function eLe(e){return function t(r,n,a){return am(r)&&am(n)&&function tLe(e,t){var r=ru(e),n=ru(t);return ys(r)===ys(n)&&ka(r)===ka(n)}(r,n)?fS(r,[n],t):e?e(r,n,a):n}}(r))}function fS(e,t,r){if(!am(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(Kc(e))return"function"==typeof r&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),a=e,i=n?Kv:Xc,o=n?function(u){a===e&&(a=JT(a)),a.push(u)}:function(u,c){var l=jy.call(a,c),d=l&&r?r(a[c],u,c):u;(!l||d!==a[c])&&(a===e&&(a=JT(a)),a[c]=d)},s=0;s<t.length;s++)i(t[s]).forEach(o);return a}function A$(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return dS(this,e)}function T$(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return dS(this,t,e)}function dk(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Jv(this,e,Ql(),function(n){return fS(n,t)})}function fk(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Jv(this,e,Ql(),function(n){return dS(n,t)})}function pS(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function hS(){return this.__ownerID?this:this.__ensureOwner(new k4)}function mS(){return this.__ensureOwner()}function pk(){return this.__altered}var lc=function(e){function t(r){return null==r?Ql():XT(r)&&!Zc(r)?r:Ql().withMutations(function(n){var a=e(r);cc(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return Ql().withMutations(function(i){for(var o=0;o<n.length;o+=2){if(o+1>=n.length)throw new Error("Missing value for key: "+n[o]);i.set(n[o],n[o+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,a){return this._root?this._root.get(0,void 0,n,a):a},t.prototype.set=function(n,a){return I$(this,n,a)},t.prototype.remove=function(n){return I$(this,n,Mn)},t.prototype.deleteAll=function(n){var a=pi(n);return 0===a.size?this:this.withMutations(function(i){a.forEach(function(o){return i.remove(o)})})},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Ql()},t.prototype.sort=function(n){return Jc(Wy(this,n))},t.prototype.sortBy=function(n,a){return Jc(Wy(this,a,n))},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){o.forEach(function(s,u){o.set(u,n.call(a,s,u,i))})})},t.prototype.__iterator=function(n,a){return new rLe(this,n,a)},t.prototype.__iterate=function(n,a){var i=this,o=0;return this._root&&this._root.iterate(function(s){return o++,n(s[1],s[0],i)},a),o},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?mk(this.size,this._root,n,this.__hash):0===this.size?Ql():(this.__ownerID=n,this.__altered=!1,this)},t}(Xc);lc.isMap=XT;var ja=lc.prototype;ja[$Q]=!0,ja[aS]=ja.remove,ja.removeAll=ja.deleteAll,ja.setIn=ok,ja.removeIn=ja.deleteIn=sk,ja.update=ck,ja.updateIn=lk,ja.merge=ja.concat=C$,ja.mergeWith=x$,ja.mergeDeep=A$,ja.mergeDeepWith=T$,ja.mergeIn=dk,ja.mergeDeepIn=fk,ja.withMutations=pS,ja.wasAltered=pk,ja.asImmutable=mS,ja["@@transducer/init"]=ja.asMutable=hS,ja["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])},ja["@@transducer/result"]=function(e){return e.asImmutable()};var vS=function(t,r){this.ownerID=t,this.entries=r};vS.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(zo(n,i[o][0]))return i[o][1];return a},vS.prototype.update=function(t,r,n,a,i,o,s){for(var u=i===Mn,c=this.entries,l=0,d=c.length;l<d&&!zo(a,c[l][0]);l++);var f=l<d;if(f?c[l][1]===i:u)return this;if(Yc(s),(u||!f)&&Yc(o),!u||1!==c.length){if(!f&&!u&&c.length>=uLe)return function nLe(e,t,r,n){e||(e=new k4);for(var a=new gp(e,Du(r),[r,n]),i=0;i<t.length;i++){var o=t[i];a=a.update(e,0,void 0,o[0],o[1])}return a}(t,c,a,i);var p=t&&t===this.ownerID,h=p?c:Xd(c);return f?u?l===d-1?h.pop():h[l]=h.pop():h[l]=[a,i]:h.push([a,i]),p?(this.entries=h,this):new vS(t,h)}};var Yy=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};Yy.prototype.get=function(t,r,n,a){void 0===r&&(r=Du(n));var i=1<<((0===t?r:r>>>t)&Js),o=this.bitmap;return o&i?this.nodes[M$(o&i-1)].get(t+Ga,r,n,a):a},Yy.prototype.update=function(t,r,n,a,i,o,s){void 0===n&&(n=Du(a));var u=(0===r?n:n>>>r)&Js,c=1<<u,l=this.bitmap,d=0!=(l&c);if(!d&&i===Mn)return this;var f=M$(l&c-1),p=this.nodes,h=d?p[f]:void 0,m=vk(h,t,r+Ga,n,a,i,o,s);if(m===h)return this;if(!d&&m&&p.length>=cLe)return function iLe(e,t,r,n,a){for(var i=0,o=new Array(Wc),s=0;0!==r;s++,r>>>=1)o[s]=1&r?t[i++]:void 0;return o[n]=a,new gS(e,i+1,o)}(t,p,l,u,m);if(d&&!m&&2===p.length&&P$(p[1^f]))return p[1^f];if(d&&m&&1===p.length&&P$(m))return m;var v=t&&t===this.ownerID,g=d?m?l:l^c:l|c,y=d?m?R$(p,f,m,v):function sLe(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var a=new Array(n),i=0,o=0;o<n;o++)o===t&&(i=1),a[o]=e[o+i];return a}(p,f,v):function oLe(e,t,r,n){var a=e.length+1;if(n&&t+1===a)return e[t]=r,e;for(var i=new Array(a),o=0,s=0;s<a;s++)s===t?(i[s]=r,o=-1):i[s]=e[s+o];return i}(p,f,m,v);return v?(this.bitmap=g,this.nodes=y,this):new Yy(t,g,y)};var gS=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};gS.prototype.get=function(t,r,n,a){void 0===r&&(r=Du(n));var o=this.nodes[(0===t?r:r>>>t)&Js];return o?o.get(t+Ga,r,n,a):a},gS.prototype.update=function(t,r,n,a,i,o,s){void 0===n&&(n=Du(a));var u=(0===r?n:n>>>r)&Js,l=this.nodes,d=l[u];if(i===Mn&&!d)return this;var f=vk(d,t,r+Ga,n,a,i,o,s);if(f===d)return this;var p=this.count;if(d){if(!f&&--p<lLe)return function aLe(e,t,r,n){for(var a=0,i=0,o=new Array(r),s=0,u=1,c=t.length;s<c;s++,u<<=1){var l=t[s];void 0!==l&&s!==n&&(a|=u,o[i++]=l)}return new Yy(e,a,o)}(t,l,p,u)}else p++;var h=t&&t===this.ownerID,m=R$(l,u,f,h);return h?(this.count=p,this.nodes=m,this):new gS(t,p,m)};var Xy=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};Xy.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(zo(n,i[o][0]))return i[o][1];return a},Xy.prototype.update=function(t,r,n,a,i,o,s){void 0===n&&(n=Du(a));var u=i===Mn;if(n!==this.keyHash)return u?this:(Yc(s),Yc(o),gk(this,t,r,n,[a,i]));for(var c=this.entries,l=0,d=c.length;l<d&&!zo(a,c[l][0]);l++);var f=l<d;if(f?c[l][1]===i:u)return this;if(Yc(s),(u||!f)&&Yc(o),u&&2===d)return new gp(t,this.keyHash,c[1^l]);var p=t&&t===this.ownerID,h=p?c:Xd(c);return f?u?l===d-1?h.pop():h[l]=h.pop():h[l]=[a,i]:h.push([a,i]),p?(this.entries=h,this):new Xy(t,this.keyHash,h)};var gp=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};gp.prototype.get=function(t,r,n,a){return zo(n,this.entry[0])?this.entry[1]:a},gp.prototype.update=function(t,r,n,a,i,o,s){var u=i===Mn,c=zo(a,this.entry[0]);return(c?i===this.entry[1]:u)?this:(Yc(s),u?void Yc(o):c?t&&t===this.ownerID?(this.entry[1]=i,this):new gp(t,this.keyHash,[a,i]):(Yc(o),gk(this,t,r,Du(a),[a,i])))},vS.prototype.iterate=Xy.prototype.iterate=function(e,t){for(var r=this.entries,n=0,a=r.length-1;n<=a;n++)if(!1===e(r[t?a-n:n]))return!1},Yy.prototype.iterate=gS.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,a=r.length-1;n<=a;n++){var i=r[t?a-n:n];if(i&&!1===i.iterate(e,t))return!1}},gp.prototype.iterate=function(e,t){return e(this.entry)};var E$,rLe=function(e){function t(r,n,a){this._type=n,this._reverse=a,this._stack=r._root&&D$(r._root)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.next=function(){for(var n=this._type,a=this._stack;a;){var i=a.node,o=a.index++,s=void 0;if(i.entry){if(0===o)return hk(n,i.entry)}else if(i.entries){if(o<=(s=i.entries.length-1))return hk(n,i.entries[this._reverse?s-o:o])}else if(o<=(s=i.nodes.length-1)){var u=i.nodes[this._reverse?s-o:o];if(u){if(u.entry)return hk(n,u.entry);a=this._stack=D$(u,a)}continue}a=this._stack=this._stack.__prev}return{value:void 0,done:!0}},t}(jn);function hk(e,t){return Ha(e,t[0],t[1])}function D$(e,t){return{node:e,index:0,__prev:t}}function mk(e,t,r,n){var a=Object.create(ja);return a.size=e,a._root=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}function Ql(){return E$||(E$=mk(0))}function I$(e,t,r){var n,a;if(e._root){var i={value:!1},o={value:!1};if(n=vk(e._root,e.__ownerID,0,void 0,t,r,i,o),!o.value)return e;a=e.size+(i.value?r===Mn?-1:1:0)}else{if(r===Mn)return e;a=1,n=new vS(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=a,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?mk(a,n):Ql()}function vk(e,t,r,n,a,i,o,s){return e?e.update(t,r,n,a,i,o,s):i===Mn?e:(Yc(s),Yc(o),new gp(t,n,[a,i]))}function P$(e){return e.constructor===gp||e.constructor===Xy}function gk(e,t,r,n,a){if(e.keyHash===n)return new Xy(t,n,[e.entry,a]);var s,i=(0===r?e.keyHash:e.keyHash>>>r)&Js,o=(0===r?n:n>>>r)&Js,u=i===o?[gk(e,t,r+Ga,n,a)]:(s=new gp(t,n,a),i<o?[e,s]:[s,e]);return new Yy(t,1<<i|1<<o,u)}function M$(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,127&(e+=e>>8)+(e>>16)}function R$(e,t,r,n){var a=n?e:Xd(e);return a[t]=r,a}var uLe=Wc/4,cLe=Wc/2,lLe=Wc/4,O$="@@__IMMUTABLE_LIST__@@";function yk(e){return!(!e||!e[O$])}var yp=function(e){function t(r){var n=eD();if(null==r)return n;if(yk(r))return r;var a=e(r),i=a.size;return 0===i?n:(cc(i),i>0&&i<Wc?bS(0,i,Ga,null,new im(a.toArray())):n.withMutations(function(o){o.setSize(i),a.forEach(function(s,u){return o.set(u,s)})}))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,a){if((n=rm(this,n))>=0&&n<this.size){var i=k$(this,n+=this._origin);return i&&i.array[n&Js]}return a},t.prototype.set=function(n,a){return function dLe(e,t,r){if((t=rm(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function(o){t<0?om(o,t).set(0,r):om(o,0,t+1).set(t,r)});var n=e._tail,a=e._root,i={value:!1};return(t+=e._origin)>=_S(e._capacity)?n=bk(n,e.__ownerID,0,t,r,i):a=bk(a,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=a,e._tail=n,e.__hash=void 0,e.__altered=!0,e):bS(e._origin,e._capacity,e._level,a,n):e}(this,n,a)},t.prototype.remove=function(n){return this.has(n)?0===n?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,a){return this.splice(n,0,a)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Ga,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):eD()},t.prototype.push=function(){var n=arguments,a=this.size;return this.withMutations(function(i){om(i,0,a+n.length);for(var o=0;o<n.length;o++)i.set(a+o,n[o])})},t.prototype.pop=function(){return om(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(a){om(a,-n.length);for(var i=0;i<n.length;i++)a.set(i,n[i])})},t.prototype.shift=function(){return om(this,1)},t.prototype.concat=function(){for(var n=arguments,a=[],i=0;i<arguments.length;i++){var o=n[i],s=e("string"!=typeof o&&L4(o)?o:[o]);0!==s.size&&a.push(s)}return 0===a.length?this:0!==this.size||this.__ownerID||1!==a.length?this.withMutations(function(u){a.forEach(function(c){return c.forEach(function(l){return u.push(l)})})}):this.constructor(a[0])},t.prototype.setSize=function(n){return om(this,0,n)},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){for(var s=0;s<i.size;s++)o.set(s,n.call(a,o.get(s),s,i))})},t.prototype.slice=function(n,a){var i=this.size;return iS(n,a,i)?this:om(this,zy(n,i),oS(a,i))},t.prototype.__iterator=function(n,a){var i=a?this.size:0,o=F$(this,a);return new jn(function(){var s=o();return s===yS?{value:void 0,done:!0}:Ha(n,a?--i:i++,s)})},t.prototype.__iterate=function(n,a){for(var s,i=a?this.size:0,o=F$(this,a);(s=o())!==yS&&!1!==n(s,a?--i:i++,this););return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?bS(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):0===this.size?eD():(this.__ownerID=n,this.__altered=!1,this)},t}(Kv);yp.isList=yk;var uo=yp.prototype;uo[O$]=!0,uo[aS]=uo.remove,uo.merge=uo.concat,uo.setIn=ok,uo.deleteIn=uo.removeIn=sk,uo.update=ck,uo.updateIn=lk,uo.mergeIn=dk,uo.mergeDeepIn=fk,uo.withMutations=pS,uo.wasAltered=pk,uo.asImmutable=mS,uo["@@transducer/init"]=uo.asMutable=hS,uo["@@transducer/step"]=function(e,t){return e.push(t)},uo["@@transducer/result"]=function(e){return e.asImmutable()};var im=function(t,r){this.array=t,this.ownerID=r};im.prototype.removeBefore=function(t,r,n){if(n===r?1<<r:0===this.array.length)return this;var a=n>>>r&Js;if(a>=this.array.length)return new im([],t);var o,i=0===a;if(r>0){var s=this.array[a];if((o=s&&s.removeBefore(t,r-Ga,n))===s&&i)return this}if(i&&!o)return this;var u=Ky(this,t);if(!i)for(var c=0;c<a;c++)u.array[c]=void 0;return o&&(u.array[a]=o),u},im.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r:0)||0===this.array.length)return this;var i,a=n-1>>>r&Js;if(a>=this.array.length)return this;if(r>0){var o=this.array[a];if((i=o&&o.removeAfter(t,r-Ga,n))===o&&a===this.array.length-1)return this}var s=Ky(this,t);return s.array.splice(a+1),i&&(s.array[a]=i),s};var N$,yS={};function F$(e,t){var r=e._origin,n=e._capacity,a=_S(n),i=e._tail;return function o(c,l,d){return 0===l?function s(c,l){var d=l===a?i&&i.array:c&&c.array,f=l>r?0:r-l,p=n-l;return p>Wc&&(p=Wc),function(){if(f===p)return yS;var h=t?--p:f++;return d&&d[h]}}(c,d):function u(c,l,d){var f,p=c&&c.array,h=d>r?0:r-d>>l,m=1+(n-d>>l);return m>Wc&&(m=Wc),function(){for(;;){if(f){var v=f();if(v!==yS)return v;f=null}if(h===m)return yS;var g=t?--m:h++;f=o(p&&p[g],l-Ga,d+(g<<l))}}}(c,l,d)}(e._root,e._level,0)}function bS(e,t,r,n,a,i,o){var s=Object.create(uo);return s.size=t-e,s._origin=e,s._capacity=t,s._level=r,s._root=n,s._tail=a,s.__ownerID=i,s.__hash=o,s.__altered=!1,s}function eD(){return N$||(N$=bS(0,0,Ga))}function bk(e,t,r,n,a,i){var u,o=n>>>r&Js,s=e&&o<e.array.length;if(!s&&void 0===a)return e;if(r>0){var c=e&&e.array[o],l=bk(c,t,r-Ga,n,a,i);return l===c?e:((u=Ky(e,t)).array[o]=l,u)}return s&&e.array[o]===a?e:(i&&Yc(i),u=Ky(e,t),void 0===a&&o===u.array.length-1?u.array.pop():u.array[o]=a,u)}function Ky(e,t){return t&&e&&t===e.ownerID?e:new im(e?e.array.slice():[],t)}function k$(e,t){if(t>=_S(e._capacity))return e._tail;if(t<1<<e._level+Ga){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&Js],n-=Ga;return r}}function om(e,t,r){void 0!==t&&(t|=0),void 0!==r&&(r|=0);var n=e.__ownerID||new k4,a=e._origin,i=e._capacity,o=a+t,s=void 0===r?i:r<0?i+r:a+r;if(o===a&&s===i)return e;if(o>=s)return e.clear();for(var u=e._level,c=e._root,l=0;o+l<0;)c=new im(c&&c.array.length?[void 0,c]:[],n),l+=1<<(u+=Ga);l&&(o+=l,a+=l,s+=l,i+=l);for(var d=_S(i),f=_S(s);f>=1<<u+Ga;)c=new im(c&&c.array.length?[c]:[],n),u+=Ga;var p=e._tail,h=f<d?k$(e,s-1):f>d?new im([],n):p;if(p&&f>d&&o<i&&p.array.length){for(var m=c=Ky(c,n),v=u;v>Ga;v-=Ga){var g=d>>>v&Js;m=m.array[g]=Ky(m.array[g],n)}m.array[d>>>Ga&Js]=p}if(s<i&&(h=h&&h.removeAfter(n,0,s)),o>=f)o-=f,s-=f,u=Ga,c=null,h=h&&h.removeBefore(n,0,o);else if(o>a||f<d){for(l=0;c;){var y=o>>>u&Js;if(y!==f>>>u&Js)break;y&&(l+=(1<<u)*y),u-=Ga,c=c.array[y]}c&&o>a&&(c=c.removeBefore(n,u,o-l)),c&&f<d&&(c=c.removeAfter(n,u,f-l)),l&&(o-=l,s-=l)}return e.__ownerID?(e.size=s-o,e._origin=o,e._capacity=s,e._level=u,e._root=c,e._tail=h,e.__hash=void 0,e.__altered=!0,e):bS(o,s,u,c,h)}function _S(e){return e<Wc?0:e-1>>>Ga<<Ga}var B$,Jc=function(e){function t(r){return null==r?SS():q4(r)?r:SS().withMutations(function(n){var a=Xc(r);cc(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,a){var i=this._map.get(n);return void 0!==i?this._list.get(i)[1]:a},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):SS()},t.prototype.set=function(n,a){return L$(this,n,a)},t.prototype.remove=function(n){return L$(this,n,Mn)},t.prototype.__iterate=function(n,a){var i=this;return this._list.__iterate(function(o){return o&&n(o[1],o[0],i)},a)},t.prototype.__iterator=function(n,a){return this._list.fromEntrySeq().__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?_k(a,i,n,this.__hash):0===this.size?SS():(this.__ownerID=n,this.__altered=!1,this._map=a,this._list=i,this)},t}(lc);function _k(e,t,r,n){var a=Object.create(Jc.prototype);return a.size=e?e.size:0,a._map=e,a._list=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}function SS(){return B$||(B$=_k(Ql(),eD()))}function L$(e,t,r){var s,u,n=e._map,a=e._list,i=n.get(t),o=void 0!==i;if(r===Mn){if(!o)return e;a.size>=Wc&&a.size>=2*n.size?(s=(u=a.filter(function(c,l){return void 0!==c&&i!==l})).toKeyedSeq().map(function(c){return c[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=u.__ownerID=e.__ownerID)):(s=n.remove(t),u=i===a.size-1?a.pop():a.set(i,void 0))}else if(o){if(r===a.get(i)[1])return e;s=n,u=a.set(i,[t,r])}else s=n.set(t,a.size),u=a.set(a.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=u,e.__hash=void 0,e.__altered=!0,e):_k(s,u)}Jc.isOrderedMap=q4,Jc.prototype[Hy]=!0,Jc.prototype[aS]=Jc.prototype.remove;var U$="@@__IMMUTABLE_STACK__@@";function tD(e){return!(!e||!e[U$])}var rD=function(e){function t(r){return null==r?nD():tD(r)?r:nD().pushAll(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,a){var i=this._head;for(n=rm(this,n);i&&n--;)i=i.next;return i?i.value:a},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(0===arguments.length)return this;for(var a=this.size+arguments.length,i=this._head,o=arguments.length-1;o>=0;o--)i={value:n[o],next:i};return this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):CS(a,i)},t.prototype.pushAll=function(n){if(0===(n=e(n)).size)return this;if(0===this.size&&tD(n))return n;cc(n.size);var a=this.size,i=this._head;return n.__iterate(function(o){a++,i={value:o,next:i}},!0),this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):CS(a,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):nD()},t.prototype.slice=function(n,a){if(iS(n,a,this.size))return this;var i=zy(n,this.size);if(oS(a,this.size)!==this.size)return e.prototype.slice.call(this,n,a);for(var s=this.size-i,u=this._head;i--;)u=u.next;return this.__ownerID?(this.size=s,this._head=u,this.__hash=void 0,this.__altered=!0,this):CS(s,u)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?CS(this.size,this._head,n,this.__hash):0===this.size?nD():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,a){var i=this;if(a)return new Qv(this.toArray()).__iterate(function(u,c){return n(u,c,i)},a);for(var o=0,s=this._head;s&&!1!==n(s.value,o++,this);)s=s.next;return o},t.prototype.__iterator=function(n,a){if(a)return new Qv(this.toArray()).__iterator(n,a);var i=0,o=this._head;return new jn(function(){if(o){var s=o.value;return o=o.next,Ha(n,i++,s)}return{value:void 0,done:!0}})},t}(Kv);rD.isStack=tD;var V$,nu=rD.prototype;function CS(e,t,r,n){var a=Object.create(nu);return a.size=e,a._head=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}function nD(){return V$||(V$=CS(0))}nu[U$]=!0,nu.shift=nu.pop,nu.unshift=nu.push,nu.unshiftAll=nu.pushAll,nu.withMutations=pS,nu.wasAltered=pk,nu.asImmutable=mS,nu["@@transducer/init"]=nu.asMutable=hS,nu["@@transducer/step"]=function(e,t){return e.unshift(t)},nu["@@transducer/result"]=function(e){return e.asImmutable()};var z$="@@__IMMUTABLE_SET__@@";function aD(e){return!(!e||!e[z$])}function Sk(e){return aD(e)&&Zc(e)}function Ck(e,t){if(e===t)return!0;if(!eu(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||ka(e)!==ka(t)||ys(e)!==ys(t)||Zc(e)!==Zc(t))return!1;if(0===e.size&&0===t.size)return!0;var r=!sS(e);if(Zc(e)){var n=e.entries();return t.every(function(u,c){var l=n.next().value;return l&&zo(l[1],u)&&(r||zo(l[0],c))})&&n.next().done}var a=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{a=!0;var i=e;e=t,t=i}var o=!0,s=t.__iterate(function(u,c){if(r?!e.has(u):a?!zo(u,e.get(c,Mn)):!zo(e.get(c,Mn),u))return o=!1,!1});return o&&e.size===s}function eg(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function iD(e){if(!e||"object"!=typeof e)return e;if(!eu(e)){if(!am(e))return e;e=ru(e)}if(ka(e)){var t={};return e.__iterate(function(n,a){t[a]=iD(n)}),t}var r=[];return e.__iterate(function(n){r.push(iD(n))}),r}var xS=function(e){function t(r){return null==r?wS():aD(r)&&!Zc(r)?r:wS().withMutations(function(n){var a=e(r);cc(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Xc(n).keySeq())},t.intersect=function(n){return(n=pi(n).toArray()).length?ns.intersect.apply(t(n.pop()),n):wS()},t.union=function(n){return(n=pi(n).toArray()).length?ns.union.apply(t(n.pop()),n):wS()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return oD(this,this._map.set(n,n))},t.prototype.remove=function(n){return oD(this,this._map.remove(n))},t.prototype.clear=function(){return oD(this,this._map.clear())},t.prototype.map=function(n,a){var i=this,o=!1,s=oD(this,this._map.mapEntries(function(u){var c=u[1],l=n.call(a,c,c,i);return l!==c&&(o=!0),[l,l]},a));return o?s:this},t.prototype.union=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return 0===(n=n.filter(function(i){return 0!==i.size})).length?this:0!==this.size||this.__ownerID||1!==n.length?this.withMutations(function(i){for(var o=0;o<n.length;o++)"string"==typeof n[o]?i.add(n[o]):e(n[o]).forEach(function(s){return i.add(s)})}):this.constructor(n[0])},t.prototype.intersect=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(0===n.length)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.every(function(s){return s.includes(o)})||i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.subtract=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(0===n.length)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.some(function(s){return s.includes(o)})&&i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.sort=function(n){return el(Wy(this,n))},t.prototype.sortBy=function(n,a){return el(Wy(this,a,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,a){var i=this;return this._map.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){return this._map.__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n);return n?this.__make(a,n):0===this.size?this.__empty():(this.__ownerID=n,this._map=a,this)},t}(Gy);xS.isSet=aD;var H$,ns=xS.prototype;function oD(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function G$(e,t){var r=Object.create(ns);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function wS(){return H$||(H$=G$(Ql()))}ns[z$]=!0,ns[aS]=ns.remove,ns.merge=ns.concat=ns.union,ns.withMutations=pS,ns.asImmutable=mS,ns["@@transducer/init"]=ns.asMutable=hS,ns["@@transducer/step"]=function(e,t){return e.add(t)},ns["@@transducer/result"]=function(e){return e.asImmutable()},ns.__empty=wS,ns.__make=G$;var xk,j$=function(e){function t(r,n,a){if(!(this instanceof t))return new t(r,n,a);if(nk(0!==a,"Cannot step a Range by 0"),r=r||0,void 0===n&&(n=1/0),a=void 0===a?1:Math.abs(a),n<r&&(a=-a),this._start=r,this._end=n,this._step=a,this.size=Math.max(0,Math.ceil((n-r)/a-1)+1),0===this.size){if(xk)return xk;xk=this}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},t.prototype.get=function(n,a){return this.has(n)?this._start+rm(this,n)*this._step:a},t.prototype.includes=function(n){var a=(n-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},t.prototype.slice=function(n,a){return iS(n,a,this.size)?this:(n=zy(n,this.size),(a=oS(a,this.size))<=n?new t(0,0):new t(this.get(n,this._end),this.get(a,this._end),this._step))},t.prototype.indexOf=function(n){var a=n-this._start;if(a%this._step==0){var i=a/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,a){for(var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;u!==i&&!1!==n(s,a?i-++u:u++,this);)s+=a?-o:o;return u},t.prototype.__iterator=function(n,a){var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;return new jn(function(){if(u===i)return{value:void 0,done:!0};var c=s;return s+=a?-o:o,Ha(n,a?i-++u:u++,c)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:Ck(this,n)},t}($c);function wk(e,t,r){for(var n=m$(t),a=0;a!==n.length;)if((e=ik(e,n[a++],Mn))===Mn)return r;return e}function q$(e,t){return wk(this,e,t)}function Y$(){cc(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}pi.isIterable=eu,pi.isKeyed=ka,pi.isIndexed=ys,pi.isAssociative=sS,pi.isOrdered=Zc,pi.Iterator=jn,eg(pi,{toArray:function(){cc(this.size);var t=new Array(this.size||0),r=ka(this),n=0;return this.__iterate(function(a,i){t[n++]=r?[i,a]:a}),t},toIndexedSeq:function(){return new a$(this)},toJS:function(){return iD(this)},toKeyedSeq:function(){return new ZT(this,!0)},toMap:function(){return lc(this.toKeyedSeq())},toObject:Y$,toOrderedMap:function(){return Jc(this.toKeyedSeq())},toOrderedSet:function(){return el(ka(this)?this.valueSeq():this)},toSet:function(){return xS(ka(this)?this.valueSeq():this)},toSetSeq:function(){return new i$(this)},toSeq:function(){return ys(this)?this.toIndexedSeq():ka(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return rD(ka(this)?this.valueSeq():this)},toList:function(){return yp(ka(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return 0===this.size?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Ta(this,function WBe(e,t){var r=ka(e),n=[e].concat(t).map(function(o){return eu(o)?r&&(o=Xc(o)):o=r?H4(o):QQ(Array.isArray(o)?o:[o]),o}).filter(function(o){return 0!==o.size});if(0===n.length)return e;if(1===n.length){var a=n[0];if(a===e||r&&ka(a)||ys(e)&&ys(a))return a}var i=new Qv(n);return r?i=i.toKeyedSeq():ys(e)||(i=i.toSetSeq()),(i=i.flatten(!0)).size=n.reduce(function(o,s){if(void 0!==o){var u=s.size;if(void 0!==u)return o+u}},0),i}(this,t))},includes:function(t){return this.some(function(r){return zo(r,t)})},entries:function(){return this.__iterator(Qc)},every:function(t,r){cc(this.size);var n=!0;return this.__iterate(function(a,i,o){if(!t.call(r,a,i,o))return n=!1,!1}),n},filter:function(t,r){return Ta(this,c$(this,t,r,!0))},partition:function(t,r){return function jBe(e,t,r){var n=ka(e),a=[[],[]];e.__iterate(function(o,s){a[t.call(r,o,s,e)?1:0].push(n?[s,o]:o)});var i=tk(e);return a.map(function(o){return Ta(e,i(o))})}(this,t,r)},find:function(t,r,n){var a=this.findEntry(t,r);return a?a[1]:n},forEach:function(t,r){return cc(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){cc(this.size),t=void 0!==t?""+t:",";var r="",n=!0;return this.__iterate(function(a){n?n=!1:r+=t,r+=null!=a?a.toString():""}),r},keys:function(){return this.__iterator(uS)},map:function(t,r){return Ta(this,u$(this,t,r))},reduce:function(t,r,n){return X$(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return X$(this,t,r,n,arguments.length<2,!0)},reverse:function(){return Ta(this,J4(this,!0))},slice:function(t,r){return Ta(this,ek(this,t,r,!0))},some:function(t,r){cc(this.size);var n=!1;return this.__iterate(function(a,i,o){if(t.call(r,a,i,o))return n=!0,!1}),n},sort:function(t){return Ta(this,Wy(this,t))},values:function(){return this.__iterator(Zl)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(t,r){return Vy(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return function GBe(e,t,r){var n=lc().asMutable();return e.__iterate(function(a,i){n.update(t.call(r,a,i,e),0,function(o){return o+1})}),n.asImmutable()}(this,t,r)},equals:function(t){return Ck(this,t)},entrySeq:function(){var t=this;if(t._cache)return new Qv(t._cache);var r=t.toSeq().map(hLe).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(Ak(t),r)},findEntry:function(t,r,n){var a=n;return this.__iterate(function(i,o,s){if(t.call(r,i,o,s))return a=[o,i],!1}),a},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(VQ,null,t)},flatMap:function(t,r){return Ta(this,function YBe(e,t,r){var n=tk(e);return e.toSeq().map(function(a,i){return n(t.call(r,a,i,e))}).flatten(!0)}(this,t,r))},flatten:function(t){return Ta(this,d$(this,t,!0))},fromEntrySeq:function(){return new o$(this)},get:function(t,r){return this.find(function(n,a){return zo(a,t)},void 0,r)},getIn:q$,groupBy:function(t,r){return function HBe(e,t,r){var n=ka(e),a=(Zc(e)?Jc():lc()).asMutable();e.__iterate(function(o,s){a.update(t.call(r,o,s,e),function(u){return(u=u||[]).push(n?[s,o]:o),u})});var i=tk(e);return a.map(function(o){return Ta(e,i(o))}).asImmutable()}(this,t,r)},has:function(t){return this.get(t,Mn)!==Mn},hasIn:function fLe(e){return function W$(e,t){return wk(e,t,Mn)!==Mn}(this,e)},isSubset:function(t){return t="function"==typeof t.includes?t:pi(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return(t="function"==typeof t.isSubset?t:pi(t)).isSubset(this)},keyOf:function(t){return this.findKey(function(r){return zo(r,t)})},keySeq:function(){return this.toSeq().map(pLe).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return QT(this,t)},maxBy:function(t,r){return QT(this,r,t)},min:function(t){return QT(this,t?K$(t):Q$)},minBy:function(t,r){return QT(this,r?K$(r):Q$,t)},rest:function(){return this.slice(1)},skip:function(t){return 0===t?this:this.slice(Math.max(0,t))},skipLast:function(t){return 0===t?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return Ta(this,l$(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(Ak(t),r)},sortBy:function(t,r){return Ta(this,Wy(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return Ta(this,function qBe(e,t,r){var n=Yd(e);return n.__iterateUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterate(a,i);var s=0;return e.__iterate(function(u,c,l){return t.call(r,u,c,l)&&++s&&a(u,c,o)}),s},n.__iteratorUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterator(a,i);var s=e.__iterator(Qc,i),u=!0;return new jn(function(){if(!u)return{value:void 0,done:!0};var c=s.next();if(c.done)return c;var l=c.value,d=l[0],f=l[1];return t.call(r,f,d,o)?a===Qc?c:Ha(a,d,f,c):(u=!1,{value:void 0,done:!0})})},n}(this,t,r))},takeUntil:function(t,r){return this.takeWhile(Ak(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function mLe(e){if(e.size===1/0)return 0;var t=Zc(e),r=ka(e),n=t?1:0;return function vLe(e,t){return t=cS(t,3432918353),t=cS(t<<15|t>>>-15,461845907),t=cS(t<<13|t>>>-13,5),t=cS((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=KT((t=cS(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(r?t?function(i,o){n=31*n+$$(Du(i),Du(o))|0}:function(i,o){n=n+$$(Du(i),Du(o))|0}:t?function(i){n=31*n+Du(i)|0}:function(i){n=n+Du(i)|0}),n)}(this))}});var bs=pi.prototype;bs[HQ]=!0,bs[WT]=bs.values,bs.toJSON=bs.toArray,bs.__toStringMapper=lS,bs.inspect=bs.toSource=function(){return this.toString()},bs.chain=bs.flatMap,bs.contains=bs.includes,eg(Xc,{flip:function(){return Ta(this,s$(this))},mapEntries:function(t,r){var n=this,a=0;return Ta(this,this.toSeq().map(function(i,o){return t.call(r,[o,i],a++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return Ta(this,this.toSeq().flip().map(function(a,i){return t.call(r,a,i,n)}).flip())}});var AS=Xc.prototype;AS[jQ]=!0,AS[WT]=bs.entries,AS.toJSON=Y$,AS.__toStringMapper=function(e,t){return lS(t)+": "+lS(e)},eg(Kv,{toKeyedSeq:function(){return new ZT(this,!1)},filter:function(t,r){return Ta(this,c$(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return void 0===r?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return void 0===r?-1:r},reverse:function(){return Ta(this,J4(this,!1))},slice:function(t,r){return Ta(this,ek(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),0===n||2===n&&!r)return this;t=zy(t,t<0?this.count():this.size);var a=this.slice(0,t);return Ta(this,1===n?a:a.concat(Xd(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return Ta(this,d$(this,t,!1))},get:function(t,r){return(t=rm(this,t))<0||this.size===1/0||void 0!==this.size&&t>this.size?r:this.find(function(n,a){return a===t},void 0,r)},has:function(t){return(t=rm(this,t))>=0&&(void 0!==this.size?this.size===1/0||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return Ta(this,function XBe(e,t){var r=Yd(e);return r.size=e.size&&2*e.size-1,r.__iterateUncached=function(n,a){var i=this,o=0;return e.__iterate(function(s){return(!o||!1!==n(t,o++,i))&&!1!==n(s,o++,i)},a),o},r.__iteratorUncached=function(n,a){var s,i=e.__iterator(Zl,a),o=0;return new jn(function(){return(!s||o%2)&&(s=i.next()).done?s:o%2?Ha(n,o++,t):Ha(n,o++,s.value,s)})},r}(this,t))},interleave:function(){var t=[this].concat(Xd(arguments)),r=$T(this.toSeq(),$c.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),Ta(this,n)},keySeq:function(){return j$(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return Ta(this,l$(this,t,r,!1))},zip:function(){return Ta(this,$T(this,Z$,[this].concat(Xd(arguments))))},zipAll:function(){return Ta(this,$T(this,Z$,[this].concat(Xd(arguments)),!0))},zipWith:function(t){var r=Xd(arguments);return r[0]=this,Ta(this,$T(this,t,r))}});var Zy=Kv.prototype;Zy[qQ]=!0,Zy[Hy]=!0,eg(Gy,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var Qy=Gy.prototype;function X$(e,t,r,n,a,i){return cc(e.size),e.__iterate(function(o,s,u){a?(a=!1,r=o):r=t.call(n,r,o,s,u)},i),r}function pLe(e,t){return t}function hLe(e,t){return[t,e]}function Ak(e){return function(){return!e.apply(this,arguments)}}function K$(e){return function(){return-e.apply(this,arguments)}}function Z$(){return Xd(arguments)}function Q$(e,t){return e<t?1:e>t?-1:0}function $$(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}Qy.has=bs.includes,Qy.contains=Qy.includes,Qy.keys=Qy.values,eg(nm,AS),eg($c,Zy),eg(qy,Qy);var el=function(e){function t(r){return null==r?Tk():Sk(r)?r:Tk().withMutations(function(n){var a=Gy(r);cc(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Xc(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(xS);el.isOrderedSet=Sk;var eJ,tg=el.prototype;function J$(e,t){var r=Object.create(tg);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function Tk(){return eJ||(eJ=J$(SS()))}tg[Hy]=!0,tg.zip=Zy.zip,tg.zipWith=Zy.zipWith,tg.zipAll=Zy.zipAll,tg.__empty=Tk,tg.__make=J$;var Ro=function(t,r){var n;!function yLe(e){if(Zv(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(Kc(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(null===e||"object"!=typeof e)throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}(t);var a=function(s){var u=this;if(s instanceof a)return s;if(!(this instanceof a))return new a(s);if(!n){n=!0;var c=Object.keys(t),l=i._indices={};i._name=r,i._keys=c,i._defaultValues=t;for(var d=0;d<c.length;d++){var f=c[d];l[f]=d,i[f]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+Ek(this)+' with property "'+f+'" since that property name is part of the Record API.'):bLe(i,f)}}return this.__ownerID=void 0,this._values=yp().withMutations(function(p){p.setSize(u._keys.length),Xc(s).forEach(function(h,m){p.set(u._indices[m],h===u._defaultValues[m]?void 0:h)})}),this},i=a.prototype=Object.create(Ba);return i.constructor=a,r&&(a.displayName=r),a};Ro.prototype.toString=function(){for(var n,t=Ek(this)+" { ",r=this._keys,a=0,i=r.length;a!==i;a++)t+=(a?", ":"")+(n=r[a])+": "+lS(this.get(n));return t+" }"},Ro.prototype.equals=function(t){return this===t||Zv(t)&&$y(this).equals($y(t))},Ro.prototype.hashCode=function(){return $y(this).hashCode()},Ro.prototype.has=function(t){return this._indices.hasOwnProperty(t)},Ro.prototype.get=function(t,r){if(!this.has(t))return r;var a=this._values.get(this._indices[t]);return void 0===a?this._defaultValues[t]:a},Ro.prototype.set=function(t,r){if(this.has(t)){var n=this._values.set(this._indices[t],r===this._defaultValues[t]?void 0:r);if(n!==this._values&&!this.__ownerID)return Dk(this,n)}return this},Ro.prototype.remove=function(t){return this.set(t)},Ro.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:Dk(this,t)},Ro.prototype.wasAltered=function(){return this._values.wasAltered()},Ro.prototype.toSeq=function(){return $y(this)},Ro.prototype.toJS=function(){return iD(this)},Ro.prototype.entries=function(){return this.__iterator(Qc)},Ro.prototype.__iterator=function(t,r){return $y(this).__iterator(t,r)},Ro.prototype.__iterate=function(t,r){return $y(this).__iterate(t,r)},Ro.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._values.__ensureOwner(t);return t?Dk(this,r,t):(this.__ownerID=t,this._values=r,this)},Ro.isRecord=Zv,Ro.getDescriptiveName=Ek;var au,rt,ln,Ba=Ro.prototype;function Dk(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._values=t,n.__ownerID=r,n}function Ek(e){return e.constructor.displayName||e.constructor.name||"Record"}function $y(e){return H4(e._keys.map(function(t){return[t,e.get(t)]}))}function bLe(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){nk(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}catch{}}Ba[YQ]=!0,Ba[aS]=Ba.remove,Ba.deleteIn=Ba.removeIn=sk,Ba.getIn=q$,Ba.hasIn=bs.hasIn,Ba.merge=C$,Ba.mergeWith=x$,Ba.mergeIn=dk,Ba.mergeDeep=A$,Ba.mergeDeepWith=T$,Ba.mergeDeepIn=fk,Ba.setIn=ok,Ba.update=ck,Ba.updateIn=lk,Ba.withMutations=pS,Ba.asMutable=hS,Ba.asImmutable=mS,Ba[WT]=Ba.entries,Ba.toJSON=Ba.toObject=bs.toObject,Ba.inspect=Ba.toSource=function(){return this.toString()},function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:Gn.create22(),definition:a,createDefaultParams:function(o,s){return a.params?D.getDefaultValues(a.params(o,s)):{}}};return i}var n;e.create=t,e.fromTransformer=function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,c=o.params,l=u.build().to(s.transform.ref).apply(a,c);return u.updateTree(l)}})},(n=e.Builder||(e.Builder={})).build=function(o){return function i(o){return function(s){return t(R({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:"string"==typeof o.display?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:"object"==typeof o.params?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},"function"==typeof s?{run:s}:s))}}(o)},e.build=n.build}(au||(au={})),function(e){var n,m;e.getParamDefinition=function t(m,v,g){return m.definition.params?m.definition.params(v,g):{}},e.is=function r(m){return!!m&&"function"==typeof m.toAction&&"function"==typeof m.apply},(m=n=e.UpdateResult||(e.UpdateResult={}))[m.Unchanged=0]="Unchanged",m[m.Updated=1]="Updated",m[m.Recreate=2]="Recreate",m[m.Null=3]="Null";var p,a=new Map,i=new Map;function l(m,v){var g=v.name,y="".concat(m,".").concat(g);if(a.has(y))throw new Error("A transform with id '".concat(g,"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed."));var b={apply:function(_,C,x){return ln.create(_,b,C,x)},toAction:function(){return au.fromTransformer(b)},namespace:m,id:y,definition:v,createDefaultParams:function(_,C){return v.params?D.getDefaultValues(v.params(_,C)):{}}};return a.set(y,b),function o(m){for(var v=0,g=m.definition.from;v<g.length;v++){var y=g[v];i.has(y.type)?i.get(y.type).push(m):i.set(y.type,[m])}}(b),b}e.getAll=function s(){return Array.from(a.values())},e.get=function u(m){var v=a.get(m);if(!v)throw new Error("A transformer with signature '".concat(m,"' is not registered."));return v},e.fromType=function c(m){return i.get(m)||[]},e.create=l,e.factory=function d(m){return function(v){return l(m,v)}},e.builderFactory=function f(m){return p.build(m)},function(m){m.build=function g(y){return function(b){return function v(y,b){return function(_){return l(y,R({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:"string"==typeof b.display?{name:b.display}:b.display?b.display:{name:Rv(b.name.replace(/[-]/g," "))},params:"object"==typeof b.params?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},_))}}(y,b)}}}(p=e.Builder||(e.Builder={})),e.build=function h(m){return p.build(m)},e.ROOT=l("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})}(rt||(rt={})),function(e){function i(v,g,y,b){var _=b&&b.ref?b.ref:Gn.create22(),C=void 0;return b&&b.tags&&(0===(C="string"==typeof b.tags?[b.tags]:b.tags).length?C=void 0:C.sort()),{parent:v,transformer:g,state:b?.state||{},tags:C,ref:_,dependsOn:b&&b.dependsOn,params:y,version:Gn.create22()}}function d(v,g){return!!v.tags&&v.tags.indexOf(g)>=0}function p(v){return v}e.RootRef="-=root=-",e.areStatesEqual=function t(v,g){return!!v.isHidden!=!!g.isHidden||!!v.isCollapsed!=!!g.isCollapsed||!!v.isGhost!=!!g.isGhost||!!v.isLocked!=!!g.isLocked},e.isStateChange=function r(v,g){return!!g&&(typeof g.isCollapsed<"u"&&v.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&v.isHidden!==g.isHidden||typeof g.isGhost<"u"&&v.isGhost!==g.isGhost||typeof g.isLocked<"u"&&v.isLocked!==g.isLocked)},e.assignState=function n(v,g){if(!g)return!1;for(var y=!1,b=0,_=Object.keys(g);b<_.length;b++){var C=_[b],x=g[C];!!x!=!!v[C]&&(y=!0,v[C]=x)}return y},e.syncState=function a(v,g){if(!g)return!1;for(var y=!1,b=0,_=Object.keys(g);b<_.length;b++)!!(x=g[C=_[b]])!=!!v[C]&&(y=!0,void 0!==x?v[C]=x:delete v[C]);for(var T=0,w=Object.keys(v);T<w.length;T++){var C,x;!!(x=g[C=w[T]])!=!!v[C]&&(y=!0,void 0!==x?v[C]=x:delete v[C])}return y},e.create=i,e.withParams=function o(v,g){return R(R({},v),{params:g,version:Gn.create22()})},e.withState=function s(v,g){return g?R(R({},v),{state:R(R({},v.state),g)}):v},e.withTags=function u(v,g){var y=void 0;return g&&(0===(y="string"==typeof g?[g]:g).length?y=void 0:y.sort()),R(R({},v),{tags:y,version:Gn.create22()})},e.withParent=function c(v,g){return R(R({},v),{parent:g,version:Gn.create22()})},e.createRoot=function l(v){return i(e.RootRef,rt.ROOT,{},{ref:e.RootRef,state:v})},e.hasTag=d,e.hasTags=function f(v,g){if(!v.tags)return"string"!=typeof g&&0===g.length;if("string"==typeof g)return d(v,g);for(var y=0,b=g;y<b.length;y++)if(v.tags.indexOf(b[y])<0)return!1;return!0},e.toJSON=function h(v){for(var g=v.transformer.definition.customSerialization?v.transformer.definition.customSerialization.toJSON:p,y=void 0,b=0,_=Object.keys(v.state);b<_.length;b++){var C=_[b];v.state[C]&&(y||(y={}),y[C]=!0)}return{parent:v.parent,transformer:v.transformer.id,params:v.params?g(v.params):void 0,state:y,tags:v.tags,ref:v.ref,dependsOn:v.dependsOn,version:v.version}},e.fromJSON=function m(v){var g=rt.get(v.transformer);return{parent:v.parent,transformer:g,params:v.params?(g.definition.customSerialization?g.definition.customSerialization.fromJSON:p)(v.params):void 0,state:v.state||{},tags:v.tags,ref:v.ref,dependsOn:v.dependsOn,version:v.version}}}(ln||(ln={}));var hi,wr,bp,wLe=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations||(this._childMutations=new Map),this._childMutations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations||(this._dependencyMutations=new Map),this._dependencyMutations},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(ln.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=ln.RootRef;if(0!==this.children.get(t).size){this.changeChildren();var r=el();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&"remove"===n)return;this.changeDependencies(),a=i?i.asMutable():el().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}"add"===n?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){sD(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,ln.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;this.transforms.has(t.ref)&&this.transforms.get(t.ref).parent!==t.parent&&function DLe(e){throw new Error("Transform '".concat(e,"' is already present in the tree."))}(t.ref);var a=this.children.get(t.parent);if(a||function ELe(e){throw new Error("Parent '".concat(e,"' must be present in the tree."))}(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,el())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++)this.mutateDependency(o[i],r,"add");return this},e.prototype.setParams=function(t,r){sD(this.transforms,t);var n=this.transforms.get(t);return!tN(n.params,r)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,ln.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){sD(this.transforms,t);var n=this.transforms.get(t),a=ln.withParams(n,r);return!iX(n.tags,a.tags)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){sD(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return ln.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=ln.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=hi.subtreePostOrder(this,r);if(t===ln.RootRef){if(n.pop(),0===n.length)return n;this.clearRoot()}else{if(0===n.length)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++)this.transforms.delete((o=i[a]).ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref);for(var s=[],u=0,c=n;u<c.length;u++){var o;if((o=c[u]).dependsOn)for(var l=0,d=o.dependsOn;l<d.length;l++){var f=d[l];this.transforms.has(f)&&this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var p=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var h=0,m=p;h<m.length;h++)if(this.transforms.has(v=m[h]))for(var g=0,y=this.remove(v);g<y.length;g++)s[s.length]=y[g]}}for(var _=0,C=s;_<C.length;_++){var v;n[n.length]=v=C[_]}return n},e.prototype.asImmutable=function(){return this.changedNodes||this.changedChildren||this._childMutations?(this._childMutations&&this._childMutations.forEach(ALe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(TLe,this.dependencies),hi.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies)):this.tree},e}();function ALe(e,t){this.set(t,e.asImmutable())}function TLe(e,t){0===e.size?this.delete(t):this.set(t,e.asImmutable())}function sD(e,t){if(!e.has(t))throw new Error("Node '".concat(t,"' is not present in the tree."))}!function(e){var t=function(){function b(_,C,x){this.transforms=_,this.children=C,this.dependencies=x}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(ln.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new wLe(this)},b}();function n(b,_,C){return new t(b,_,C)}function a(b){i(this,this.tree.transforms.get(b))}function i(b,_){var C=b.tree.children.get(_.ref);C&&C.size&&C.forEach(a,b),b.f(_,b.tree,b.state)}function o(b,_,C,x){var A={tree:b,state:C,f:x};return i(A,_),A.state}function s(b){u(this,this.tree.transforms.get(b))}function u(b,_){var C=b.f(_,b.tree,b.state);if("boolean"!=typeof C||C){var x=b.tree.children.get(_.ref);x&&x.size&&x.forEach(s,b)}}function c(b,_,C,x){var A={tree:b,state:C,f:x};return u(A,_),A.state}function l(b,_,C){C.push(b)}function f(b,_,C){C.push(ln.toJSON(b))}function v(b,_,C){if(_===C)return!0;for(var A=b.children.get(_).values();;){var T=A.next();if(T.done)return!1;if(v(b,T.value,C))return!0}}e.createEmpty=function r(b){var _=b||ln.createRoot();return n(lc([[_.ref,_]]),lc([[_.ref,el()]]),lc())},e.create=n,e.doPostOrder=o,e.doPreOrder=c,e.subtreePostOrder=function d(b,_){return o(b,_,[],l)},e.toJSON=function p(b){var _=[];return c(b,b.root,_,f),{transforms:_}},e.fromJSON=function h(b){for(var _=lc().asMutable(),C=lc().asMutable(),x=lc().asMutable(),A=0,T=b.transforms;A<T.length;A++){var E=ln.fromJSON(w=T[A]);_.set(E.ref,E),C.has(E.ref)||C.set(E.ref,el().asMutable()),E.ref!==E.parent&&C.get(E.parent).add(E.ref)}for(var I=new Set,M=0,F=b.transforms;M<F.length;M++){var w,N=(w=F[M]).ref;if(C.set(N,C.get(N).asImmutable()),w.dependsOn)for(var j=0,k=w.dependsOn;j<k.length;j++){var H=k[j];I.add(H),x.has(H)?x.get(H).add(N):x.set(H,el([N]).asMutable())}}return I.forEach(function(G){x.set(G,x.get(G).asImmutable())}),n(_.asImmutable(),C.asImmutable(),x.asImmutable())},e.dump=function m(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(_){return _.ref}),ch:b.children.keySeq().toArray()})},e.subtreeHasRef=function g(b,_,C){return!(!b.transforms.has(_)||!b.transforms.has(C))&&v(b,_,C)},e.getDecoratorRoot=function y(b,_){var C=b.children.get(_);if(1!==C.size)return _;var x=b.transforms.get(C.first());return x.transformer.definition.isDecorator?y(b,x.ref):_}}(hi||(hi={})),function(e){function t(L,Y){return r(L)(Y)}function r(L){var $,Y=L||c.root;return $=function a(L){return void 0!==L.compile}(Y)?Y.compile():function n(L){return void 0!==L.transform&&void 0!==L.status}(Y)?c.byValue(Y).compile():function i(L){return"function"==typeof L}(Y)?Y:c.byRef(Y).compile(),$}e.select=t,e.compile=r;var c,o={select:function(L){return t(this,L||this.state)}};function s(L,Y){o[L]=function(){for(var $=[],Z=0;Z<arguments.length;Z++)$[Z]=arguments[Z];return Y.call.apply(Y,sr([void 0,this],$,!1))}}function u(L){return Object.create(o,{compile:{writable:!1,configurable:!1,value:L}})}function l(L,Y){var $=r(L);return u(function(){return function(Z){for(var q=[],z=0,te=$(Z);z<te.length;z++)for(var fe=0,he=Y(te[z],Z);fe<he.length;fe++)q.push(he[fe]);return q}})}function d(L,Y){var $=r(L);return u(function(){return function(Z){for(var q=[],z=0,te=$(Z);z<te.length;z++){var fe=Y(te[z],Z);fe&&q.push(fe)}return q}})}function f(L){var Y=r(L);return u(function(){return function($){for(var Z=new Set,q=[],z=0,te=Y($);z<te.length;z++){var ae=te[z];ae&&(Z.has(ae.transform.ref)||(Z.add(ae.transform.ref),q.push(ae)))}return q}})}function p(L){var Y=r(L);return u(function(){return function($){var Z=Y($);return Z.length?[Z[0]]:[]}})}function h(L,Y){return l(L,function($){return Y($)?[$]:[]})}function m(L,Y){return h(L,function($){return $.status===Y})}function v(L,Y){return h(L,function($){return!!$.transform.tags&&$.transform.tags.indexOf(Y)>=0})}function g(L){return l(L,function(Y,$){var Z=[];return hi.doPreOrder($.tree,$.tree.transforms.get(Y.transform.ref),Z,function(q,z,te){te.push(q.ref)}),Z.map(function(q){return $.cells.get(q)})})}function y(L){return l(L,function(Y,$){var Z=[];return $.tree.children.get(Y.transform.ref).forEach(function(q){return Z.push($.cells.get(q))}),Z})}function b(L,Y){return h(L,function($){return!!$.obj&&$.obj.type===Y.type})}function _(L,Y){return f(d(L,function($,Z){return M(Z.tree,Z.cells,$.transform.ref,Y)}))}function C(L,Y){return f(d(L,function($,Z){return j(Z.tree,Z.cells,$.transform.ref,Y)}))}function x(L,Y){return f(d(L,function($,Z){return N(Z.tree,Z.cells,$.transform.ref,Y)}))}function A(L,Y){return h(L,function($){return $.transform.transformer===Y})}function T(L,Y){return f(d(L,function($,Z){return F(Z.tree,Z.cells,$.transform.ref,Y)}))}function w(L,Y){return f(d(L,function($,Z){return k(Z.tree,Z.cells,$.transform.ref,Y)}))}function E(L){return f(d(L,function(Y,$){return $.cells.get($.tree.transforms.get(Y.transform.ref).parent)}))}function I(L,Y,$,Z,q){for(var z=L.transforms.get($),te=void 0;;){z=L.transforms.get(z.parent);var ae=Y.get(z.ref);if(ae.obj&&Z(ae)&&(te=ae,q)||z.ref===ln.RootRef)return te}}function M(L,Y,$,Z){return I(L,Y,$,Z,!0)}function F(L,Y,$,Z){return I(L,Y,$,Z,!1)}function N(L,Y,$,Z){return M(L,Y,$,Array.isArray(Z)?function(q){return Z.indexOf(q.transform.transformer)>=0}:function(q){return q.transform.transformer===Z})}function j(L,Y,$,Z){return M(L,Y,$,H(Z))}function k(L,Y,$,Z){return F(L,Y,$,H(Z))}function H(L){return Array.isArray(L)?function(Y){for(var $=0,Z=L;$<Z.length;$++)if(Z[$].type===Y.obj.type)return!0}:function(Y){return Y.obj.type===L.type}}function U(L,Y,$){if(L.tags)for(var Z=0,q=L.tags;Z<q.length;Z++){var z=q[Z];if($.tags.has(z)){$.refs[z]=L.ref;break}}return!0}function W(L,Y,$){return!(L.tags&&L.tags.indexOf($.tag)>=0&&($.ref=L.ref,1))}function ne(L,Y,$){if(L.tags){for(var Z=$.tags.size,q=0,z=0,te=L.tags;z<te.length;z++)if($.tags.has(te[z])&&++q===Z){$.refs.push(L);break}}else 0===$.tags.size&&$.refs.push(L)}(function(L){function ae(re,ee,ue){var ge=ue.cells.get(re.ref);return!ge||!ge.obj||ge.obj.type!==ue.type||(ue.roots.push(ge),!1)}function fe(re,ee,ue){var ge=ue.cells.get(re.ref);return ge&&ge.obj&&ge.obj.type===ue.type&&ue.ret.push(ge),!0}function he(re,ee,ue){var ge=ue.cells.get(re.ref);return ge&&ge.obj&&ge.transform.transformer===ue.t&&ue.ret.push(ge),!0}function pe(re,ee,ue){var ge=ue.cells.get(re.ref);return ge&&"error"===ge.status&&ge.transform.transformer===ue.t&&ue.ret.push(ge),!0}L.root=u(function(){return function(re){return[re.cells.get(re.tree.root.ref)]}}),L.byRef=function Y(){for(var re=[],ee=0;ee<arguments.length;ee++)re[ee]=arguments[ee];return u(function(){return function(ue){for(var ge=[],Ce=0,ze=re;Ce<ze.length;Ce++){var V=ue.cells.get(ze[Ce]);V&&ge.push(V)}return ge}})},L.byValue=function $(){for(var re=[],ee=0;ee<arguments.length;ee++)re[ee]=arguments[ee];return u(function(){return function(ue){return re}})},L.rootsOfType=function Z(re,ee){return void 0===ee&&(ee=ln.RootRef),u(function(){return function(ue){var ge={roots:[],cells:ue.cells,type:re.type};return hi.doPreOrder(ue.tree,ue.tree.transforms.get(ee),ge,ae),ge.roots}})},L.ofType=function q(re,ee){return void 0===ee&&(ee=ln.RootRef),u(function(){return function(ue){var ge={ret:[],cells:ue.cells,type:re.type};return hi.doPreOrder(ue.tree,ue.tree.transforms.get(ee),ge,fe),ge.ret}})},L.ofTransformer=function z(re,ee){return void 0===ee&&(ee=ln.RootRef),u(function(){return function(ue){var ge={ret:[],cells:ue.cells,t:re};return hi.doPreOrder(ue.tree,ue.tree.transforms.get(ee),ge,he),ge.ret}})},L.ofTransformerWithError=function te(re,ee){return void 0===ee&&(ee=ln.RootRef),u(function(){return function(ue){var ge={ret:[],cells:ue.cells,t:re};return hi.doPreOrder(ue.tree,ue.tree.transforms.get(ee),ge,pe),ge.ret}})}})(c=e.Generators||(e.Generators={})),s("flatMap",l),e.flatMap=l,s("mapObject",d),e.mapObject=d,s("unique",f),e.unique=f,s("first",p),e.first=p,s("filter",h),e.filter=h,s("withStatus",m),e.withStatus=m,s("withTag",v),e.withTag=v,s("subtree",g),e.subtree=g,s("children",y),e.children=y,s("ofType",b),e.ofType=b,s("ancestor",_),e.ancestor=_,s("ancestorOfType",C),e.ancestorOfType=C,s("ancestorWithTransformer",x),e.ancestorWithTransformer=x,s("withTransformer",A),e.withTransformer=A,s("root",T),e.root=T,s("rootOfType",w),e.rootOfType=w,s("parent",E),e.parent=E,e.findAncestor=M,e.findRoot=F,e.findAncestorWithTransformer=N,e.findAncestorOfType=j,e.findRootOfType=k,e.findUniqueTagsInSubtree=function G(L,Y,$){return hi.doPreOrder(L,L.transforms.get(Y),{refs:{},tags:$},U).refs},e.findTagInSubtree=function Q(L,Y,$){return hi.doPreOrder(L,L.transforms.get(Y),{ref:void 0,tag:$},W).ref},e.findWithAllTags=function K(L,Y,$){return hi.doPreOrder(L,L.transforms.get(Y),{refs:[],tags:$},ne).refs},e.tryFindDecorator=function X(L,Y,$){if(L.transforms.get(Y).transformer===$)return L.cells.get(Y);var q=L.tree.children.get(Y);if(1===q.size){var z=q.first();if(L.transforms.get(z).transformer.definition.isDecorator)return X(L,z,$)}}}(wr||(wr={})),function(e){e.create=function t(){var r=new ILe,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}}(bp||(bp={}));var ILe=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new Cn;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new Li(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++)r[t].complete();this._disposed=!0}},e}();function Oo(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function _p(e){return!!e&&!!e[tn]}function Kd(e){var t;return!!e&&(function(r){if(!r||"object"!=typeof r)return!1;var n=Object.getPrototypeOf(r);if(null===n)return!0;var a=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return a===Object||"function"==typeof a&&Function.toString.call(a)===LLe}(e)||Array.isArray(e)||!!e[IS]||!(null===(t=e.constructor)||void 0===t||!t[IS])||cD(e)||lD(e))}function Sp(e,t,r){void 0===r&&(r=!1),0===sm(e)?(r?Object.keys:Jy)(e).forEach(function(n){r&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function sm(e){var t=e[tn];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:cD(e)?2:lD(e)?3:0}function um(e,t){return 2===sm(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function rJ(e,t,r){var n=sm(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function cD(e){return kLe&&e instanceof Map}function lD(e){return BLe&&e instanceof Set}function Fo(e){return e.o||e.t}function Pk(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=lJ(e);delete t[tn];for(var r=Jy(t),n=0;n<r.length;n++){var a=r[n],i=t[a];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function Mk(e,t){return void 0===t&&(t=!1),Rk(e)||_p(e)||!Kd(e)||(sm(e)>1&&(e.set=e.add=e.clear=e.delete=PLe),Object.freeze(e),t&&Sp(e,function(r,n){return Mk(n,!0)},!0)),e}function PLe(){Oo(2)}function Rk(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function Zd(e){var t=zk[e];return t||Oo(18,e),t}function TS(){return ES}function Fk(e,t){t&&(Zd("Patches"),e.u=[],e.s=[],e.v=t)}function dD(e){Nk(e),e.p.forEach(MLe),e.p=null}function Nk(e){e===ES&&(ES=e.l)}function aJ(e){return ES={p:[],l:ES,h:e,m:!0,_:0}}function MLe(e){var t=e[tn];0===t.i||1===t.i?t.j():t.g=!0}function kk(e,t){t._=t.p.length;var r=t.p[0],n=void 0!==e&&e!==r;return t.h.O||Zd("ES5").S(t,e,n),n?(r[tn].P&&(dD(t),Oo(4)),Kd(e)&&(e=fD(t,e),t.l||pD(t,e)),t.u&&Zd("Patches").M(r[tn].t,e,t.u,t.s)):e=fD(t,r,[]),dD(t),t.u&&t.v(t.u,t.s),e!==Vk?e:void 0}function fD(e,t,r){if(Rk(t))return t;var n=t[tn];if(!n)return Sp(t,function(s,u){return iJ(e,n,t,s,u,r)},!0),t;if(n.A!==e)return t;if(!n.P)return pD(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=4===n.i||5===n.i?n.o=Pk(n.k):n.o,i=a,o=!1;3===n.i&&(i=new Set(a),a.clear(),o=!0),Sp(i,function(s,u){return iJ(e,n,a,s,u,r,o)}),pD(e,a,!1),r&&e.u&&Zd("Patches").N(n,r,e.u,e.s)}return n.o}function iJ(e,t,r,n,a,i,o){if(_p(a)){var s=fD(e,a,i&&t&&3!==t.i&&!um(t.R,n)?i.concat(n):void 0);if(rJ(r,n,s),!_p(s))return;e.m=!1}else o&&r.add(a);if(Kd(a)&&!Rk(a)){if(!e.h.D&&e._<1)return;fD(e,a),t&&t.A.l||pD(e,a)}}function pD(e,t,r){void 0===r&&(r=!1),!e.l&&e.h.D&&e.m&&Mk(t,r)}function Bk(e,t){var r=e[tn];return(r?Fo(r):e)[t]}function oJ(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function Eu(e){e.P||(e.P=!0,e.l&&Eu(e.l))}function Lk(e){e.o||(e.o=Pk(e.t))}function DS(e,t,r){var n=cD(t)?Zd("MapSet").F(t,r):lD(t)?Zd("MapSet").T(t,r):e.O?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:TS(),P:!1,I:!1,R:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,c=PS;o&&(u=[s],c=RS);var l=Proxy.revocable(u,c),d=l.revoke,f=l.proxy;return s.k=f,s.j=d,f}(t,r):Zd("ES5").J(t,r);return(r?r.A:TS()).p.push(n),n}function sJ(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Pk(e)}var uJ,ES,Uk=typeof Symbol<"u"&&"symbol"==typeof Symbol("x"),kLe=typeof Map<"u",BLe=typeof Set<"u",cJ=typeof Proxy<"u"&&void 0!==Proxy.revocable&&typeof Reflect<"u",Vk=Uk?Symbol.for("immer-nothing"):((uJ={})["immer-nothing"]=!0,uJ),IS=Uk?Symbol.for("immer-draftable"):"__$immer_draftable",tn=Uk?Symbol.for("immer-state"):"__$immer_state",LLe=(typeof Symbol<"u"&&Symbol,""+Object.prototype.constructor),Jy=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,lJ=Object.getOwnPropertyDescriptors||function(e){var t={};return Jy(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},zk={},PS={get:function(e,t){if(t===tn)return e;var a,s,u,r=Fo(e);if(!um(r,t))return a=e,(u=oJ(r,t))?"value"in u?u.value:null===(s=u.get)||void 0===s?void 0:s.call(a.k):void 0;var n=r[t];return e.I||!Kd(n)?n:n===Bk(e.t,t)?(Lk(e),e.o[t]=DS(e.A.h,n,e)):n},has:function(e,t){return t in Fo(e)},ownKeys:function(e){return Reflect.ownKeys(Fo(e))},set:function(e,t,r){var n=oJ(Fo(e),t);if(n?.set)return n.set.call(e.k,r),!0;if(!e.P){var a=Bk(Fo(e),t),i=a?.[tn];if(i&&i.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(function nJ(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(r,a)&&(void 0!==r||um(e.t,t)))return!0;Lk(e),Eu(e)}return e.o[t]===r&&(void 0!==r||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==Bk(e.t,t)||t in e.t?(e.R[t]=!1,Lk(e),Eu(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Fo(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Oo(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Oo(12)}},RS={};Sp(PS,function(e,t){RS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),RS.deleteProperty=function(e,t){return RS.set.call(this,e,t,void 0)},RS.set=function(e,t,r){return PS.set.call(this,e[0],t,r,e[0])};var ULe=function(){function e(r){var n=this;this.O=cJ,this.D=!0,this.produce=function(a,i,o){if("function"==typeof a&&"function"!=typeof i){var s=i;i=a;var u=n;return function(m){var v=this;void 0===m&&(m=s);for(var g=arguments.length,y=Array(g>1?g-1:0),b=1;b<g;b++)y[b-1]=arguments[b];return u.produce(m,function(_){var C;return(C=i).call.apply(C,[v,_].concat(y))})}}var c;if("function"!=typeof i&&Oo(6),void 0!==o&&"function"!=typeof o&&Oo(7),Kd(a)){var l=aJ(n),d=DS(n,a,void 0),f=!0;try{c=i(d),f=!1}finally{f?dD(l):Nk(l)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(m){return Fk(l,o),kk(m,l)},function(m){throw dD(l),m}):(Fk(l,o),kk(c,l))}if(!a||"object"!=typeof a){if(void 0===(c=i(a))&&(c=a),c===Vk&&(c=void 0),n.D&&Mk(c,!0),o){var p=[],h=[];Zd("Patches").M(a,c,p,h),o(p,h)}return c}Oo(21,a)},this.produceWithPatches=function(a,i){if("function"==typeof a)return function(c){for(var l=arguments.length,d=Array(l>1?l-1:0),f=1;f<l;f++)d[f-1]=arguments[f];return n.produceWithPatches(c,function(p){return a.apply(void 0,[p].concat(d))})};var o,s,u=n.produce(a,i,function(c,l){o=c,s=l});return typeof Promise<"u"&&u instanceof Promise?u.then(function(c){return[c,o,s]}):[u,o,s]},"boolean"==typeof r?.useProxies&&this.setUseProxies(r.useProxies),"boolean"==typeof r?.autoFreeze&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Kd(r)||Oo(8),_p(r)&&(r=function RLe(e){return _p(e)||Oo(22,e),function t(r){if(!Kd(r))return r;var n,a=r[tn],i=sm(r);if(a){if(!a.P&&(a.i<4||!Zd("ES5").K(a)))return a.t;a.I=!0,n=sJ(r,i),a.I=!1}else n=sJ(r,i);return Sp(n,function(o,s){a&&function uD(e,t){return 2===sm(e)?e.get(t):e[t]}(a.t,o)===s||rJ(n,o,t(s))}),3===i?new Set(n):n}(e)}(r));var n=aJ(this),a=DS(this,r,void 0);return a[tn].C=!0,Nk(n),a},t.finishDraft=function(r,n){var i=(r&&r[tn]).A;return Fk(i,n),kk(void 0,i)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!cJ&&Oo(20),this.O=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(0===i.path.length&&"replace"===i.op){r=i.value;break}}a>-1&&(n=n.slice(a+1));var o=Zd("Patches").$;return _p(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),dc=new ULe,OS=dc.produce,VLe=(dc.produceWithPatches.bind(dc),dc.setAutoFreeze.bind(dc));dc.setUseProxies.bind(dc),dc.applyPatches.bind(dc),dc.createDraft.bind(dc),dc.finishDraft.bind(dc);const Gk=OS;var rg;function dJ(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(o)if(r||(r=new Set),"string"==typeof o){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var c=u[s];r.has(c)||(r.add(c),n.push(c))}}return n}!function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,c=o.actions;u<c.length;u++){var l=c[u];switch(l.kind){case"add":s.add(l.transform);break;case"update":s.setParams(l.ref,l.params);break;case"delete":s.remove(l.ref);break;case"insert":var d=s.children.get(l.ref).toArray();s.add(l.transform);for(var f=0,p=d;f<p.length;f++)s.changeParent(p[f],l.transform.ref)}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}e.is=function r(o){return!!o&&"function"==typeof o.getTree},e.isTo=function n(o){return!!o&&"function"==typeof o.getTree&&"string"==typeof o.ref};var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u="string"==typeof s?s:nS.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=Mo.resolveRef(s);return u&&this.state.tree.transforms.has(u)?(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this):this},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,c){if(this.state=s,this.root=c,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '".concat(u,"'."))}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new UQ(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return hi.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,c){if(s.definition.isDecorator)return this.insert(s,u,c);var l=this.getApplyRoot(),d=s.apply(l,u,c);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,c,l){if(this.state.tree.transforms.has(s)){var d=this.to(s);return c&&d.update(c),d}return this.apply(u,c,R(R({},l),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,c,l){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var p=f.next();if(p.done)break;var h=this.state.tree.transforms.get(p.value);if(h&&ln.hasTags(h,s)){var m=this.to(p.value);return m.updateTagged(c,dJ(h.tags,s,l&&l.tags)),m}}var v=u.apply(d,c,R(R({},l),{tags:dJ(s,l&&l.tags)}));return this.state.tree.add(v),this.editInfo.count++,this.editInfo.lastUpdate=v.ref,this.state.actions.push({kind:"add",transform:v}),new o(this.state,v.ref,this.root)},o.prototype.group=function(s,u,c){return this.apply(s,u,c)},o.prototype.insert=function(s,u,c){var l=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,c);this.state.tree.add(d);for(var f=0,p=l;f<p.length;f++)this.state.tree.changeParent(p[f],d.ref);return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var c;if(u){var l=this.state.tree.transforms.get(this.ref);c=OS(l.params,u)}else c="function"==typeof s?OS(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,c)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:c})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i}(rg||(rg={}));var Qd,mD,zLe=function(){function e(){this.ev=bp.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=rt.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(void 0),this},e.prototype.remove=function(t){var r=rt.is(t)?t.toAction().id:Gn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);s&&(Tv(s,n),0===s.length&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++)if((u=s[o]).definition.isApplicable){i=!0;break}if(!i)return a;for(var c=[],l=0,d=a;l<d.length;l++){var u;(u=d[l]).definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&c.push(u):c.push(u)}return c},e.prototype.dispose=function(){this.ev.dispose()},e}();!function(e){e.message=function t(i){return{type:"message",timestamp:new Date,message:i}},e.error=function r(i){return{type:"error",timestamp:new Date,message:i}},e.warning=function n(i){return{type:"warning",timestamp:new Date,message:i}},e.info=function a(i){return{type:"info",timestamp:new Date,message:i}}}(Qd||(Qd={})),function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(this._current)for(var o=this._current;;){if(!(o=this.cells.get(o.transform.parent)).obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===ln.RootRef)return}},a.prototype.getRootOfType=function(i){if(this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===ln.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t,e.getDecoratorChain=function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s?.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u},e.getRootOfType=function n(a,i,o){var s=void 0,u=a.cells.get(o);if(u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===ln.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}}(mD||(mD={}));var GLe=function(){function e(){this.queue=[],this.signal=new Cn}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),1===this.queue.length||this.waitFor(t)},e.prototype.handled=function(t){y2(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=y2(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var s=i.stillPresent;i.v===t&&(a.unsubscribe(),n(s))})})},e}(),vD=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=bp.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:ln.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new zLe,this.cells=new Map,this.spine=new mD.Impl(this.cells),this.tryGetCellData=function(o){var s,u,c=null===(u=null===(s=n.cells.get(o))||void 0===s?void 0:s.obj)||void 0===u?void 0:u.data;if(void 0===c)throw new Error("Cell '".concat(o,"' data undefined."));return c},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new GLe,this._tree=hi.createEmpty(ln.createRoot(r&&r.rootState)).asTransient();var i=this._tree.root;this.runTask=r.runTask,void 0!==r?.historyCapacity&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:R({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new rg.Root(this.tree,this)},e.prototype.addHistory=function(t,r){0!==this.historyCapacity&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){0!==this.history.length&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return Ve.create("Undo",function(r){return ce(t,void 0,void 0,function(){var n;return le(this,function(a){switch(a.label){case 0:if(!(n=this.history.shift()))return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:hi.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=hi.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(n){var a="function"==typeof r?r(n.state):r;ln.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return wr.select(t,this)},e.prototype.selectQ=function(t){return wr.select("string"==typeof t?t:t(wr.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return void 0===n&&(n=ln.RootRef),Ve.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'".concat(n,"' does not exist."));if("ok"!==o.status)throw new Error("Action cannot be applied to a cell with status '".concat(o.status,"'"));return qk(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return Ve.create("State Transaction",function(a){return ce(n,void 0,void 0,function(){var i,o,s,u;return le(this,function(c){switch(c.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,c.label=1;case 1:return c.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return c.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:c.sent(),c.label=4;case 4:return[3,9];case 5:return u=c.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:c.sent(),this.events.log.next(Qd.error("Error during state transaction, reverting")),c.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r?.rethrowErrors)throw u;return console.error(u),[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r?.canUndo?this.addHistory(o,"string"==typeof r.canUndo?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return Ve.create("Update Tree",function(i){return ce(n,void 0,void 0,function(){var s,u,c,l;return le(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(!d.sent())return[2];this._inUpdate=!0,s=r?.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),rg.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return l=d.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:l=d.sent(),d.label=6;case 6:return u=this.reverted,(c=l).ctx.hadError&&(this.inTransactionError=!0),c.cell?[2,new UQ(c.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),r?.canUndo?u||this.addHistory(s,"string"==typeof r.canUndo?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ce(this,void 0,void 0,function(){var a,i;return le(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return((i=s.sent()).ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return ce(this,void 0,void 0,function(){var n,a,i;return le(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,jLe(a)];case 2:return n=o.sent(),rg.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(rg.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:rg.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:R(R({},HLe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var c;return null===(c=o.get(u).obj)||void 0===c?void 0:c.data}};return this.errorFree=!0,s},e}();!function(e){e.create=function t(n,a){return new e(n,a)},(e.ObjectEvent||(e.ObjectEvent={})).isCell=function a(i,o){return!!o&&i.ref===o.transform.ref&&i.state===o.parent}}(vD||(vD={}));var HLe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function jLe(e){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,T,w,E,I,F,N;return le(this,function(j){switch(j.label){case 0:if(n=[],e.editInfo&&1===e.editInfo.count&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree)r=[],a=[e.editInfo.lastUpdate];else{for(r=function XLe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return hi.doPostOrder(e.oldTree,e.oldTree.root,t,YLe),t.deletes}(e),F=e.parent.current,i=!1,o=0,s=r;o<s.length;o++)if((v=s[o])===F){i=!0;break}for(i&&(u=fJ(e.oldTree,F,r,e.cells),e.parent.setCurrent(u)),m=r.length-1;m>=0;m--)(_=e.cells.get(r[m]))&&yD(_.transform,_.obj,_?.transform.params,_.cache,e.parent.globalContext);for(c=0,l=r;c<l.length;c++)(_=e.cells.get(v=l[c]))&&(_.parent=void 0,JLe(_)),d=_&&_.obj,e.cells.delete(v),n.push(d);a=function qLe(e,t){var r={roots:[],cells:e};return hi.doPreOrder(t,t.root,r,WLe),r.roots}(e.cells,e.tree)}for(f=function r5e(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++)hi.doPreOrder(e.tree,e.tree.transforms.get(a[n]),r,e5e);for(var o=0,s=r.added;o<s.length;o++)t5e(s[o],e);var c;return r.visited.forEach(function(l){for(var f=0,p=e.cells.get(l).dependencies.dependentBy;f<p.length;f++){var h=p[f];r.visited.has(h.transform.ref)||(c||(c=On.create()),On.add(c,h.transform.ref,h))}}),{added:r.added,dependent:c?c.array:void 0}}(e,a),p=0,h=f.added;p<h.length;p++)e.parent.events.cell.created.next({state:e.parent,ref:(_=h[p]).transform.ref,cell:_});for(m=0;m<r.length;m++)g=e.oldTree.transforms.get(v=r[m]).parent,e.parent.events.object.removed.next({state:e.parent,ref:v,obj:n[m]}),e.parent.events.cell.removed.next({state:e.parent,ref:v,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)a.push((_=b[y]).transform.ref);(function $Le(e,t){for(var r=0,n=t;r<n.length;r++)hi.doPreOrder(e.tree,e.tree.transforms.get(n[r]),e,QLe)})(e,a),C=0,x=a,j.label=1;case 1:return C<x.length?[4,hJ(e,x[C])]:[3,4];case 2:j.sent(),j.label=3;case 3:return C++,[3,1];case 4:for(e.editInfo||function ZLe(e){hi.doPreOrder(e.tree,e.tree.root,e,KLe)}(e),T=e.newCurrent,w=0,E=e.results;w<E.length;w++)"created"===(I=E[w]).action?(e.parent.events.object.created.next({state:e.parent,ref:I.ref,obj:I.obj}),e.newCurrent||!e.tree.transforms.get(I.ref).state.isGhost&&I.obj!==ua.Null&&(T=I.ref)):"updated"===I.action?e.parent.events.object.updated.next({state:e.parent,ref:I.ref,action:"in-place",obj:I.obj,oldData:I.oldData}):"replaced"===I.action&&e.parent.events.object.updated.next({state:e.parent,ref:I.ref,action:"recreate",obj:I.obj,oldObj:I.oldObj});return T?e.options.doNotUpdateCurrent||e.parent.setCurrent(T):(N=e.cells.get(F=e.parent.current))&&(N.obj===ua.Null||"error"===N.status&&N.errorText===n5e)&&(T=fJ(e.oldTree,F,[],e.cells),e.parent.setCurrent(T)),[2,r.length>0||a.length>0||e.changed]}})})}function WLe(e,t,r){var n=r.cells.get(e.ref);return n&&n.transform.version===e.version?!("error"===n.status||n&&n.obj===ua.Null):(r.roots.push(e.ref),!1)}function YLe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function KLe(e,t,r){var n=r.cells.get(e.ref);!n||!ln.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function gD(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function QLe(e,t,r){r.cells.get(e.ref).transform=e,gD(r,e.ref,"pending")}function JLe(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++)Tv(r[t].dependencies.dependentBy,e)}function e5e(e,t,r){var n=r.ctx,a=r.added;if(r.visited.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:R({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function t5e(e,t){if(e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r];if(!t.tree.transforms.get(a))throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);$a(e.dependencies.dependsOn,o),$a(o.dependencies.dependentBy,e)}}function fJ(e,t,r,n){return pJ(e,t,new Set(r),n)}function pJ(e,t,r,n){if(t===ln.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var c=n.get(u.value);if(c&&"error"!==c.status&&c.obj!==ua.Null){var l=e.transforms.get(u.value);if(!l.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return l.ref;o=l.ref}}}}return o||pJ(e,a.parent,r,n)}function Hk(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Ve.isAbort(r);var i=""+r;gD(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;Hk(e,u.value,void 0,n)}}var ve,kt,$l,bD,n5e="Parent is null";function hJ(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return le(this,function(c){switch(c.label){case 0:gD(e,t,"processing"),r=!1,c.label=1;case 1:return c.trys.push([1,3,,4]),n=da(),[4,i5e(e,t)];case 2:return a=c.sent(),i=da()-n,"none"!==a.action&&(e.changed=!0),gD(e,t,"ok"),e.results.push(a),"created"===a.action?!(r=a.obj===ua.Null)&&!e.options.doNotLogTiming&&e.parent.events.log.next(Qd.info("Created ".concat(a.obj.label," in ").concat(YF(i),"."))):("updated"===a.action||"replaced"===a.action)&&!(r=a.obj===ua.Null)&&!e.options.doNotLogTiming&&e.parent.events.log.next(Qd.info("Updated ".concat(a.obj.label," in ").concat(YF(i),"."))),[3,4];case 3:return o=c.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),Hk(e,t,o,!1),console.error(o),[2];case 4:s=e.tree.children.get(t).values(),c.label=5;case 5:return(u=s.next()).done?[2]:r?(Hk(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,hJ(e,u.value)];case 7:c.sent(),c.label=8;case 8:return[3,5];case 9:return[2]}})})}function i5e(e,t){var r;return ce(this,void 0,void 0,function(){var n,a,i,o,s,c,l,d,f,p,h,m,v,y,_,C;return le(this,function(x){switch(x.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===ln.RootRef)return[2,{action:"none"}];if(s=e.cells.get(i.transform.parent),s?.obj===ua.Null)return i.sourceRef=s.transform.ref,n.transforms.has(t)&&i.params?(yD(o,i.obj,p=i.params.values,h=i.cache,e.parent.globalContext),i.params=void 0,i.obj=ua.Null,[2,{ref:t,action:"updated",obj:i.obj}]):(i.params=void 0,[2,{ref:t,action:"created",obj:ua.Null}]);if(!(c=0===o.transformer.definition.from.length?s:wr.findAncestorOfType(a,e.cells,t,o.transformer.definition.from)))throw new Error("No suitable parent found for '".concat(t,"'"));return e.spine.current=i,l=c.obj,i.sourceRef=c.transform.ref,d=function a5e(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=D.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=D.getDefaultValues(i);t.params=t.params?function $De(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];ZA.call(t,a)&&typeof e[a]>"u"&&(e[a]=t[a])}return e}(t.params,o):o}return D.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}(e,o,l,i),n.transforms.has(t)&&i.params?[3,2]:(i.params=d,[4,vJ(e,i,o.transformer,l,d.values)]);case 1:return jk(f=x.sent(),o),i.obj=f,[2,{ref:t,action:"created",obj:f}];case 2:return p=i.params.values,h=i.cache,m=null===(r=i.obj)||void 0===r?void 0:r.data,v=d.values,i.params=d,i.obj&&i.obj!==ua.Null?[4,o5e(e,i,o.transformer,l,i.obj,p,v)]:[3,4];case 3:return y=x.sent(),[3,5];case 4:y=rt.UpdateResult.Recreate,x.label=5;case 5:switch(y){case rt.UpdateResult.Recreate:return[3,6];case rt.UpdateResult.Updated:return[3,8];case rt.UpdateResult.Null:return[3,9]}return[3,10];case 6:return yD(o,_=i.obj,p,h,e.parent.globalContext),[4,vJ(e,i,o.transformer,l,v)];case 7:return jk(C=x.sent(),o),i.obj=C,[2,{ref:t,action:"replaced",oldObj:_,obj:C}];case 8:return jk(i.obj,o),[2,{ref:t,action:"updated",oldData:m,obj:i.obj}];case 9:return yD(o,i.obj,p,h,e.parent.globalContext),i.obj=ua.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function yD(e,t,r,n,a){var i,o;null===(o=(i=e.transformer.definition).dispose)||void 0===o||o.call(i,{b:t!==ua.Null?t:void 0,params:r,cache:n},a)}function jk(e,t){!e||e===ua.Null||(e.tags=t.tags)}function qk(e,t){return"function"==typeof e.runInContext?e.runInContext(t):e}function mJ(e){if(0!==e.dependencies.dependsOn.length){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function vJ(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),qk(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:mJ(t)},e.parent.globalContext),e.taskCtx)}function o5e(e,t,r,n,a,i,o){return ce(this,void 0,void 0,function(){return le(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,qk(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:mJ(t)},e.parent.globalContext),e.taskCtx)]):[2,rt.UpdateResult.Recreate]})})}!function(e){function n(f){return e.Create(R(R({},f),{typeClass:"Representation3D"}))}e.Create=ua.factory(),e.isRepresentation3D=function t(f){return!!f&&"Representation3D"===f.type.typeClass},e.isBehavior=function r(f){return!!f&&"Behavior"===f.type.typeClass},e.CreateRepresentation3D=n,e.CreateBehavior=function a(f){return e.Create(R(R({},f),{typeClass:"Behavior"}))};var i=function(f){function p(){return null!==f&&f.apply(this,arguments)||this}return qt(p,f),p}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(f){function p(){return null!==f&&f.apply(this,arguments)||this}return qt(p,f),p}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(f){var p=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return qt(g,v),g}(e.Create({name:"String Data",typeClass:"Data"}));f.String=p;var h=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return qt(g,v),g}(e.Create({name:"Binary Data",typeClass:"Data"}));f.Binary=h;var m=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return qt(g,v),g}(e.Create({name:"Data Blob",typeClass:"Data"}));f.Blob=m}(e.Data||(e.Data={})),function(f){var p=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"JSON Data",typeClass:"Data"}));f.Json=p;var h=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"CIF File",typeClass:"Data"}));f.Cif=h;var m=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"Cube File",typeClass:"Data"}));f.Cube=m;var v=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"PSF File",typeClass:"Data"}));f.Psf=v;var g=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"PRMTOP File",typeClass:"Data"}));f.Prmtop=g;var y=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"TOP File",typeClass:"Data"}));f.Top=y;var b=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"PLY File",typeClass:"Data"}));f.Ply=b;var _=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));f.Ccp4=_;var C=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));f.Dsn6=C;var x=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"DX File",typeClass:"Data"}));f.Dx=x;var A=function(T){function w(){return null!==T&&T.apply(this,arguments)||this}return qt(w,T),w}(e.Create({name:"Format Blob",typeClass:"Data"}));f.Blob=A}(e.Format||(e.Format={})),function(f){var p=function(y){function b(){return null!==y&&y.apply(this,arguments)||this}return qt(b,y),b}(e.Create({name:"Coordinates",typeClass:"Object"}));f.Coordinates=p;var h=function(y){function b(){return null!==y&&y.apply(this,arguments)||this}return qt(b,y),b}(e.Create({name:"Topology",typeClass:"Object"}));f.Topology=h;var m=function(y){function b(){return null!==y&&y.apply(this,arguments)||this}return qt(b,y),b}(e.Create({name:"Model",typeClass:"Object"}));f.Model=m;var v=function(y){function b(){return null!==y&&y.apply(this,arguments)||this}return qt(b,y),b}(e.Create({name:"Trajectory",typeClass:"Object"}));f.Trajectory=v;var g=function(y){function b(){return null!==y&&y.apply(this,arguments)||this}return qt(b,y),b}(e.Create({name:"Structure",typeClass:"Object"}));f.Structure=g,function(y){var b=function(x){function A(){return null!==x&&x.apply(this,arguments)||this}return qt(A,x),A}(n({name:"Structure 3D"}));y.Representation3D=b;var _=function(x){function A(){return null!==x&&x.apply(this,arguments)||this}return qt(A,x),A}(e.Create({name:"Structure 3D State",typeClass:"Object"}));y.Representation3DState=_;var C=function(x){function A(){return null!==x&&x.apply(this,arguments)||this}return qt(A,x),A}(e.Create({name:"Selections",typeClass:"Object"}));y.Selections=C}(g=f.Structure||(f.Structure={}))}(e.Molecule||(e.Molecule={})),function(f){var p=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return qt(g,v),g}(e.Create({name:"Volume",typeClass:"Object"}));f.Data=p;var h=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return qt(g,v),g}(e.Create({name:"Lazy Volume",typeClass:"Object"}));f.Lazy=h;var m=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return qt(g,v),g}(n({name:"Volume 3D"}));f.Representation3D=m}(e.Volume||(e.Volume={})),function(f){var p=function(m){function v(){return null!==m&&m.apply(this,arguments)||this}return qt(v,m),v}(e.Create({name:"Shape Provider",typeClass:"Object"}));f.Provider=p;var h=function(m){function v(){return null!==m&&m.apply(this,arguments)||this}return qt(v,m),v}(n({name:"Shape 3D"}));f.Representation3D=h}(e.Shape||(e.Shape={}))}(ve||(ve={})),function(e){e.CreateBuiltIn=rt.factory("ms-plugin"),e.BuiltIn=rt.builderFactory("ms-plugin")}(kt||(kt={})),function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(c){return u.getInt8(c)},readUInt8:function(c){return u.getUint8(c)},writeInt8:function(c,l){return u.setInt8(l,c)},writeUInt8:function(c,l){return u.setUint8(l,c)},readInt16LE:function(c){return u.getInt16(c,!0)},readInt32LE:function(c){return u.getInt32(c,!0)},readUInt16LE:function(c){return u.getUint16(c,!0)},readUInt32LE:function(c){return u.getUint32(c,!0)},readFloatLE:function(c){return u.getFloat32(c,!0)},readDoubleLE:function(c){return u.getFloat64(c,!0)},writeInt16LE:function(c,l){return u.setInt16(l,c,!0)},writeInt32LE:function(c,l){return u.setInt32(l,c,!0)},writeUInt16LE:function(c,l){return u.setUint16(l,c,!0)},writeUInt32LE:function(c,l){return u.setUint32(l,c,!0)},writeFloatLE:function(c,l){return u.setFloat32(l,c,!0)},writeDoubleLE:function(c,l){return u.setFloat64(l,c,!0)},readInt16BE:function(c){return u.getInt16(c,!1)},readInt32BE:function(c){return u.getInt32(c,!1)},readUInt16BE:function(c){return u.getUint16(c,!1)},readUInt32BE:function(c){return u.getUint32(c,!1)},readFloatBE:function(c){return u.getFloat32(c,!1)},readDoubleBE:function(c){return u.getFloat64(c,!1)},writeInt16BE:function(c,l){return u.setInt16(l,c,!1)},writeInt32BE:function(c,l){return u.setInt32(l,c,!1)},writeUInt16BE:function(c,l){return u.setUint16(l,c,!1)},writeUInt32BE:function(c,l){return u.setUint32(l,c,!1)},writeFloatBE:function(c,l){return u.setFloat32(l,c,!1)},writeDoubleBE:function(c,l){return u.setFloat64(l,c,!1)},copy:function(c,l,d,f){return l=Po(l,0),d=Po(d,0),f=Po(f,s.length),c.set(s.subarray(d,f),l),f-d}})}function a(s,u,c,l,d){for(var f=0,p=c;f<p;f+=l)for(var h=0;h<l;h++)u[d+f+l-h-1]=s[d+f+h]}e.fromUint8Array=t,e.fromArrayBuffer=function r(s){return t(new Uint8Array(s))},e.fromBuffer=function n(s){return s},e.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],e.flipByteOrder=a,e.flipByteOrderInPlace2=function i(s,u,c){void 0===u&&(u=0);for(var l=new Int16Array(s,u,c),d=0,f=l.length;d<f;++d){var p=l[d];l[d]=(255&p)<<8|p>>8&255}},e.ensureLittleEndian=function o(s,u,c,l,d){e.IsNativeEndianLittle||!c||l<=1||a(s,u,c,l,d)}}($l||($l={})),function(e){e.fromBuffer=function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,c;if("number"==typeof i){o=Po(o,i);var l=a;u=(d=Math.min(r.length,l+o))-l,c=$l.fromUint8Array(new Uint8Array(r.buffer,l,d-l))}else{o=Po(o,i.length),l=a;var d=Math.min(r.length,l+o);i.set(r.subarray(l,d),s),u=d-l,c=i}return o!==u&&console.warn("byteCount ".concat(o," and bytesRead ").concat(u," differ")),Promise.resolve({bytesRead:u,buffer:c})},writeBuffer:function(a,i,o){return o=Po(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=Po(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:Cy}}}(bD||(bD={}));var co=function(e){return e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16",e}(co||{});function gJ(e){return e===co.Float32?4:e===co.Int16||e===co.Uint16?2:1}function s5e(e,t,r,n){return void 0===r&&(r=0),e===co.Float32?new Float32Array(t,r,n):e===co.Int16?new Int16Array(t,r,n):e===co.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function c5e(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){return le(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(void 0!==i&&i!==$l.IsNativeEndianLittle||!$l.IsNativeEndianLittle)&&$l.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function l5e(e){return ce(this,void 0,void 0,function(){var r,n,a,i,s,u;return le(this,function(l){switch(l.label){case 0:return[4,e.readBuffer(0,1024)];case 1:if(r=l.sent().buffer,"MAP "!==(n=String.fromCharCode(r.readUInt8(208),r.readUInt8(209),r.readUInt8(210),r.readUInt8(211))))throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(212),r.readUInt8(213)],i=!1,68===a[0]&&65===a[1]?i=!0:17===a[0]&&17===a[1]?i=!1:r.readInt32LE(12)<=16&&(i=!0),u=i?function(d){return r.readFloatLE(4*d)}:function(d){return r.readFloatBE(4*d)},[2,{header:{NC:(s=i?function(d){return r.readInt32LE(4*d)}:function(d){return r.readInt32BE(4*d)})(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},littleEndian:i}]}})})}function yJ(e){switch(e){case 0:return co.Int8;case 1:return co.Int16;case 2:return co.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '".concat(e,"'"))}function bJ(e){return-128===e.userFlag1&&127===e.userFlag2}function _J(e){return bJ(e)?co.Float32:yJ(e.MODE)}function p5e(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f;return le(this,function(h){switch(h.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return h.sent(),[4,l5e(e)];case 2:return n=h.sent(),i=n.littleEndian,o=function f5e(e){return 1024+e.NSYMBT}(a=n.header),s=yJ(a.MODE),u=_J(a),c=a.NC*a.NR*a.NS,l=gJ(s),d=c*l,f=function u5e(e,t){var r=gJ(t),n=new ArrayBuffer(r*e),a=$l.fromArrayBuffer(n),i=$l.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:s5e(t,i)}}(c,u),function d5e(e,t,r,n,a,i){ce(this,void 0,void 0,function(){var o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return bJ(e)?[4,r.readBuffer(n,t.readBuffer,a,o=3*a)]:[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),c=.5*(e.AMIN+e.AMAX+(u=(e.AMAX-e.AMIN)/255)),l=0,d=a;l<d;++l)t.values[l]=u*s[l]+c;return[3,4];case 2:return[4,c5e(t,r,n,a,0,i)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}(a,f,e,o,d,i),[2,{header:a,values:f.values,name:e.name}]}})})}function m5e(e,t){return function h5e(e,t){var r=this;return Ve.create("Parse CCP4/MRC/MAP",function(n){return ce(r,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=Nn).success,[4,p5e(e,0,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,Nn.error(o)];case 3:return[2]}})})})}(bD.fromBuffer($l.fromUint8Array(e),t))}var Wk=512;function SJ(e){var r=e.yExtent,n=e.zExtent;return{xBlocks:Math.ceil(e.xExtent/8),yBlocks:Math.ceil(r/8),zBlocks:Math.ceil(n/8)}}function y5e(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i;return le(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,Wk)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||100===t.readInt16LE(36),i=n?function v5e(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}(r):function g5e(e,t){var r=t?function(a){return e.readInt16LE(2*a)}:function(a){return e.readInt16BE(2*a)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}(t,a),[2,{header:i,littleEndian:a}]}})})}function b5e(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x;return le(this,function(T){for(n||$l.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,c=SJ(e),l=c.xBlocks,d=c.yBlocks,f=c.zBlocks,p=0,h=0;h<f;++h)for(m=0;m<d;++m)for(v=0;v<l;++v)for(g=0;g<8;++g)for(y=8*h+g,b=0;b<8;++b)for(_=8*m+b,C=0;C<8;++C){if(!((x=8*v+C)<o&&_<s&&y<u)){p+=8-C;break}r[(x*s+_)*u+y]=(t[p]-i)/a,++p}return[2]})})}function S5e(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(l){switch(l.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return l.sent(),[4,y5e(e)];case 2:return n=l.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(Wk,t-Wk)];case 3:return o=l.sent().buffer,s=function _5e(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=SJ(e),c=8*a.xBlocks*a.yBlocks*8*a.zBlocks*8;return{count:c,byteCount:1*c,valueCount:t*r*n}}(a).valueCount,u=new Float32Array(s),[4,b5e(a,o,u,i)];case 4:return l.sent(),[2,{header:a,values:u,name:e.name}]}})})}function x5e(e,t){return function C5e(e,t){var r=this;return Ve.create("Parse DSN6/BRIX",function(n){return ce(r,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=Nn).success,[4,S5e(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,Nn.error(o)];case 3:return[2]}})})})}(bD.fromBuffer($l.fromUint8Array(e),t),e.length)}var A5e=new Set(Object.keys({char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8}));function Yk(e){if(!A5e.has(e))throw new Error("unknown ply type '".concat(e,"'"));return e}function CJ(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ie.Schema.int;case"float":case"double":case"float32":case"float64":return ie.Schema.float}}function M5e(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],c=[],l=new Map,d=0,f=o;d<f;++d){var p=Ke.create(n.data,2*a);c.push(p)}for(d=0,f=a;d<f;++d)for(var h=0,m=o;h<m;++h)lt.skipWhitespace(n),lt.markStart(n),lt.eatValue(n),Ke.addUnchecked(c[h],n.tokenStart,n.tokenEnd);for(d=0,f=o;d<f;++d){var v=i[d],g=v.type,y=v.name,b=mN(c[d],CJ(g));s.push(y),u.push(g),l.set(y,b)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(_){return l.get(_)}})}function R5e(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=Ke.create(n.data,2*a*3),s=new Uint32Array(a+1),u=0,c=0,l=a;c<l;++c){for(lt.skipWhitespace(n),lt.markStart(n);10!==lt.skipWhitespace(n);)++u,lt.markStart(n),lt.eatValue(n),Ke.addToken(o,n);s[c+1]=u}var d={entries:[],count:0},f=mN(o,CJ(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(p){for(var h=s[p]+1,m=f.value(h-1),v=h,g=h+m;v<g;++v)d.entries[v-h]=f.value(v);return d.count=m,d}})}function O5e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,o,s;return le(this,function(u){return r=function D5e(e,t){return{data:e,tokenizer:lt(e),runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}(e,t),t.update({message:"Parsing...",current:0,max:e.length}),function I5e(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;!function E5e(e){var t=e.data.indexOf("end_header",e.position);if(-1===t)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,lt.eatLine(e)}(t);var i,o,s,a=lt.getTokenString(t).split(/\r?\n/);if("ply"!==a[0])throw new Error("data not starting with 'ply'");if("format ascii 1.0"!==a[1])throw new Error("format not 'ascii 1.0'");function u(){if(void 0!==i&&void 0!==o&&void 0!==s){for(var p=!1,h=0,m=s.length;h<m;++h)if("list"===s[h].kind){p=!0;break}n.push(p?{kind:"list",name:i,count:o,property:s[0]}:{kind:"table",name:i,count:o,properties:s})}}for(var c=2,l=a.length;c<l;++c){var d=a[c],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],i=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(void 0===s)throw new Error("properties outside of element");s.push("list"===f[1]?{kind:"list",countType:Yk(f[2]),dataType:Yk(f[3]),name:f[4]}:{kind:"column",type:Yk(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}(r),function P5e(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];"table"===a.kind?M5e(e,a):"list"===a.kind&&R5e(e,a)}}(r),n=r.elements,i=r.comments,o=r.elementSpecs.map(function(c){return c.name}),s=function T5e(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}(n,o,i),[2,Nn.success(s)]})})}function F5e(e){var t=this;return Ve.create("Parse PLY",function(r){return ce(t,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,O5e(e,r)];case 1:return[2,n.sent()]}})})})}var _D=lt.readLine,xJ=lt.skipWhitespace,wJ=lt.eatValue,N5e=lt.eatLine,Xk=lt.markStart,SD=/\s+/,k5e=/(^\*|REMARK)*/;function L5e(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:return n=Ke.create((r=e.tokenizer).data,2*t),a=Ke.create(r.data,2*t),i=Ke.create(r.data,2*t),o=Ke.create(r.data,2*t),s=Ke.create(r.data,2*t),u=Ke.create(r.data,2*t),c=Ke.create(r.data,2*t),l=Ke.create(r.data,2*t),d=r.position,f=_D(r).trim(),r.position=d,p=7===f.split(SD).length,h=p?6:8,m=r.length,v=0,[4,$f(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-v,y),_=0;_<b;++_){for(var C=0;C<h;++C)if(xJ(r),Xk(r),wJ(r),p)switch(C){case 0:Ke.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Ke.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:Ke.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:Ke.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:Ke.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 5:Ke.addUnchecked(l,r.tokenStart,r.tokenEnd)}else switch(C){case 0:Ke.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Ke.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:Ke.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:Ke.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:Ke.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:Ke.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:Ke.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 7:Ke.addUnchecked(l,r.tokenStart,r.tokenEnd)}N5e(r),Xk(r)}return v+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:m})})];case 1:return g.sent(),[2,{count:t,atomId:er(n)(ie.Schema.int),segmentName:p?er(i)(ie.Schema.str):er(a)(ie.Schema.str),residueId:er(i)(ie.Schema.int),residueName:p?er(i)(ie.Schema.str):er(o)(ie.Schema.str),atomName:er(s)(ie.Schema.str),atomType:er(u)(ie.Schema.str),charge:er(c)(ie.Schema.float),mass:er(l)(ie.Schema.float)}]}})})}function U5e(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o;return le(this,function(s){switch(s.label){case 0:return n=Ke.create((r=e.tokenizer).data,2*t),a=Ke.create(r.data,2*t),i=r.length,o=0,[4,$f(e.runtimeCtx,10,void 0,function(u){for(var c=Math.min(t-o,u),l=0;l<c;++l)for(var d=0;d<2;++d)switch(xJ(r),Xk(r),wJ(r),d){case 0:Ke.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Ke.addUnchecked(a,r.tokenStart,r.tokenEnd)}return o+=c,c},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:er(n)(ie.Schema.int),atomIdB:er(a)(ie.Schema.int)}]}})})}function z5e(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d;return le(this,function(p){switch(p.label){case 0:r=lt(e),n=function B5e(e,t){return{tokenizer:e,runtimeCtx:t}}(r,t),a=void 0,i=void 0,o=void 0,s=_D(n.tokenizer).trim(),p.label=1;case 1:return r.tokenEnd<r.length?(u=_D(n.tokenizer).trim()).includes("!NTITLE")?(c=parseInt(u.split(SD)[0]),a=function V5e(e,t){for(var r=[],n=0;n<t;++n){var a=_D(e.tokenizer);r.push(a.replace(k5e,"").trim())}return r}(n,c),[3,7]):[3,2]:[3,8];case 2:return u.includes("!NATOM")?(l=parseInt(u.split(SD)[0]),[4,L5e(n,l)]):[3,4];case 3:return i=p.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(SD)[0]),[4,U5e(n,d)]):[3,6];case 5:return o=p.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),p.label=7;case 7:return[3,1];case 8:return void 0===a&&(a=[]),void 0===i?[2,Nn.error("no atoms data")]:void 0===o?[2,Nn.error("no bonds data")]:[2,Nn.success({id:s,title:a,atoms:i,bonds:o})]}})})}function G5e(e){var t=this;return Ve.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,z5e(e,r)];case 1:return[2,n.sent()]}})})})}var AJ=.529177210859;function q5e(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=1e6,i=new Float64Array(n),o=0;return $f(e,a,i,function(s,u){for(var c=Math.min(n,o+s),l=o;l<c;l++)lt.skipWhitespace(t),t.tokenStart=t.position,lt.eatValue(t),u[l]=Zf(t.data,t.tokenStart,t.tokenEnd);return o=c,c===n?0:a},function(s,u,c){return s.update({current:Math.min(c,n),max:n})})}function W5e(e,t){var r=this;return Ve.create("Parse Cube",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u;return le(this,function(c){switch(c.label){case 0:return[4,n.update("Reading header...")];case 1:return c.sent(),a=lt(e),i=function H5e(e){var t=lt.readLines(e,6),r=function(E,I){var M=+t[E].trim().split(/\s+/g)[I];return Number.isNaN(M)?0:M},n=function(E){var I=r(E+2,0),M=AJ;return[Math.abs(I),S.create(r(E+2,1)*M,r(E+2,2)*M,r(E+2,3)*M),I]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],c=o[2],l=n(1),d=l[0],f=l[1],p=n(2),h=p[0],m=p[1],v=n(3),g=v[0],y=v[1],b=function j5e(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var c=lt.readLine(e).trim().split(/\s+/g);n[u]=+c[0],a[u]=+c[1],i[u]=+c[2]*r,o[u]=+c[3]*r,s[u]=+c[4]*r}return{count:t,number:ie.ofArray({array:n,schema:ie.Schema.int}),nuclearCharge:ie.ofArray({array:a,schema:ie.Schema.float}),x:ie.ofArray({array:i,schema:ie.Schema.float}),y:ie.ofArray({array:o,schema:ie.Schema.float}),z:ie.ofArray({array:s,schema:ie.Schema.float})}}(e,s,AJ),_=[];if(c>=0){var C=r(2,4);0===C&&(C=1);for(var x=0;x<C;x++)_.push(x)}else for(var A=lt.readLine(e).trim().split(/\s+/g),T=(x=0,+A[0]);x<T;x++)_.push(+A[x+1]);return{header:{orbitals:c<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:S.create(d,h,g),basisX:f,basisY:m,basisZ:y,dataSetIds:_},atoms:b}}(a),s=i.atoms,[4,q5e(n,a,o=i.header)];case 2:return u=c.sent(),[2,Nn.success({header:o,atoms:s,values:u,name:t})]}})})})}function TJ(e){for(var t={h:S()},r=0,n=0,a=/\s+/g;;){var i=lt.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=S.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=S.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),0===n?t.h[0]=parseFloat(o[1]):1===n?t.h[1]=parseFloat(o[2]):2===n&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function Y5e(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=1e6,i=new Float64Array(n),o=0;return $f(e,a,i,function(s,u){for(var c=Math.min(n,o+s),l=o;l<c;l++)lt.skipWhitespace(t),t.tokenStart=t.position,lt.eatValue(t),u[l]=Zf(t.data,t.tokenStart,t.tokenEnd);return o=c,c===n?0:a},function(s,u,c){return s.update({current:Math.min(c,n),max:n})})}function Z5e(e,t){return Ve.create("Parse DX",function(r){return"string"==typeof e?function X5e(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i;return le(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=lt(t),a=TJ(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,Y5e(e,n,a)];case 3:return i=o.sent(),[2,Nn.success({header:a,values:i,name:r})]}})})}(r,e,t):function K5e(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=zN(t,0,1e3),a=lt(n),i=TJ(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],c=new DataView(t.buffer,t.byteOffset+s),l=new Float64Array(u),d=0;d<u;d++)l[d]=c.getFloat64(8*d,!0);return[2,Nn.success({header:o,values:l,name:r})]}})})}(r,e,t)})}var gr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},DJ=(function(){var e=new Map;Object.keys(gr).forEach(function(t){e.set(gr[t],t)})}(),Object.keys({NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""})),CD=lt.readLine,EJ=lt.markLine,$5e=lt.trim;function cm(e,t,r,n){for(var a=e.tokenizer,i=Ke.create(a.data,2*t),o=0;a.tokenEnd<a.length&&"%"!==a.data[a.position];){a.tokenStart=a.position;for(var s=Math.min(o+r,t);o<s;++o){var c=a.position;$5e(a,a.position,a.position+n),Ke.addUnchecked(i,a.tokenStart,a.tokenEnd),a.position=c+n}EJ(a)}return i}function r6e(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,c;return le(this,function(l){switch(l.label){case 0:r=lt(e),n=function J5e(e,t){return{tokenizer:e,runtimeCtx:t}}(r,t),a=Object.create(null),i=0,l.label=1;case 1:return r.tokenEnd<r.length?r.position-i>1e5&&t.shouldUpdate?(i=r.position,[4,t.update({current:r.position,max:r.length})]):[3,3]:[3,4];case 2:l.sent(),l.label=3;case 3:if((o=CD(n.tokenizer).trim()).startsWith("%VERSION"))a.version=o.substring(8).trim();else if(o.startsWith("%FLAG")){if(s=o.substring(5).trim(),!CD(n.tokenizer).trim().startsWith("%FORMAT"))throw new Error("expected %FORMAT");if("TITLE"===s)a.title=function e6e(e){for(var t=e.tokenizer,r=[];t.tokenEnd<t.length&&"%"!==t.data[t.position];){var n=CD(t).trim();n&&r.push(n)}return r}(n);else if("POINTERS"===s)a.pointers=function t6e(e){var t=e.tokenizer,r=Object.create(null);DJ.forEach(function(s){r[s]=0});for(var n=0;t.tokenEnd<t.length&&"%"!==t.data[t.position];)for(var a=CD(t),i=Math.min(n+10,32),o=0;n<i;++o,++n)r[DJ[n]]=parseInt(a.substring(8*o,8*o+8).trim());return r}(n);else if("ATOM_NAME"===s)c=cm(n,a.pointers.NATOM,20,4),a.atomName=er(c)(ie.Schema.str);else if("CHARGE"===s)c=cm(n,a.pointers.NATOM,5,16),a.charge=er(c)(ie.Schema.float);else if("MASS"===s)c=cm(n,a.pointers.NATOM,5,16),a.mass=er(c)(ie.Schema.float);else if("RESIDUE_LABEL"===s)c=cm(n,a.pointers.NRES,20,4),a.residueLabel=er(c)(ie.Schema.str);else if("RESIDUE_POINTER"===s)c=cm(n,a.pointers.NRES,10,8),a.residuePointer=er(c)(ie.Schema.int);else if("BONDS_INC_HYDROGEN"===s)c=cm(n,3*a.pointers.NBONH,10,8),a.bondsIncHydrogen=er(c)(ie.Schema.int);else if("BONDS_WITHOUT_HYDROGEN"===s)c=cm(n,3*a.pointers.NBONA,10,8),a.bondsWithoutHydrogen=er(c)(ie.Schema.int);else if("RADII"===s)c=cm(n,a.pointers.NATOM,5,16),a.radii=er(c)(ie.Schema.float);else for(;r.tokenEnd<r.length&&"%"!==r.data[r.position];)EJ(r)}return[3,1];case 4:return[2,Nn.success(a)]}})})}function n6e(e){var t=this;return Ve.create("Parse PRMTOP",function(r){return ce(t,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,r6e(e,r)];case 1:return[2,n.sent()]}})})})}var a6e={nr:ie.Schema.Int(),type:ie.Schema.Str(),resnr:ie.Schema.Int(),residu:ie.Schema.Str(),atom:ie.Schema.Str(),cgnr:ie.Schema.Int(),charge:ie.Schema.Float(),mass:ie.Schema.Float()},i6e={ai:ie.Schema.Int(),aj:ie.Schema.Int()},o6e={compound:ie.Schema.Str(),molCount:ie.Schema.Int()},Kk=lt.readLine,lm=lt.markLine,dm=lt.skipWhitespace,xD=lt.markStart,Zk=lt.eatValue,s6e=lt.eatLine,c6e=/\[ (.+) \]/,l6e=/\s+/;function v6e(e,t){return ce(this,void 0,void 0,function(){function r(){u&&s.atoms&&(i.compounds[u]=s,s={},u="")}var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:n=lt(e),a=function u6e(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t),o=0,(i=Object.create(null)).compounds={},s={},u="",f.label=1;case 1:return n.tokenEnd<n.length?n.position-o>1e5&&t.shouldUpdate?(o=n.position,[4,t.update({current:n.position,max:n.length})]):[3,3]:[3,4];case 2:f.sent(),f.label=3;case 3:if(!(c=Kk(a.tokenizer).trim())||"*"===c[0]||";"===c[0])return[3,1];if(c.startsWith("#include"))throw new Error("#include statements not allowed");if(c.startsWith("[")){if(null===(l=c.match(c6e)))throw new Error("expected field name");if("moleculetype"===(d=l[1]))r(),u=function d6e(e){for(var t=e.tokenizer,r=void 0;t.tokenEnd<t.length;){dm(t);var n=t.data[t.position];if("["===n)break;if(";"!==n&&"*"!==n){if(void 0!==r)throw new Error("more than one molName");r=Kk(t).split(l6e)[0]}else lm(t)}if(void 0===r)throw new Error("missing molName");return r}(a);else if("atoms"===d)s.atoms=function f6e(e){for(var t=e.tokenizer,r=Ke.create(t.data,64),n=Ke.create(t.data,64),a=Ke.create(t.data,64),i=Ke.create(t.data,64),o=Ke.create(t.data,64),s=Ke.create(t.data,64),u=Ke.create(t.data,64),c=Ke.create(t.data,64);t.tokenEnd<t.length;){dm(t);var l=t.data[t.position];if("["===l)break;if(";"!==l&&"*"!==l){for(var d=0;d<8;++d)switch(dm(t),xD(t),Zk(t),d){case 0:Ke.add(r,t.tokenStart,t.tokenEnd);break;case 1:Ke.add(n,t.tokenStart,t.tokenEnd);break;case 2:Ke.add(a,t.tokenStart,t.tokenEnd);break;case 3:Ke.add(i,t.tokenStart,t.tokenEnd);break;case 4:Ke.add(o,t.tokenStart,t.tokenEnd);break;case 5:Ke.add(s,t.tokenStart,t.tokenEnd);break;case 6:Ke.add(u,t.tokenStart,t.tokenEnd);break;case 7:Ke.add(c,t.tokenStart,t.tokenEnd)}lm(t)}else lm(t)}return Qr.ofColumns(a6e,{nr:er(r)(ie.Schema.int),type:er(n)(ie.Schema.str),resnr:er(a)(ie.Schema.int),residu:er(i)(ie.Schema.str),atom:er(o)(ie.Schema.str),cgnr:er(s)(ie.Schema.int),charge:er(u)(ie.Schema.float),mass:er(c)(ie.Schema.float)})}(a);else if("bonds"===d)s.bonds=function p6e(e){for(var t=e.tokenizer,r=Ke.create(t.data,64),n=Ke.create(t.data,64);t.tokenEnd<t.length;){dm(t);var a=t.data[t.position];if("["===a)break;if(";"!==a&&"*"!==a){for(var i=0;i<2;++i)switch(dm(t),xD(t),Zk(t),i){case 0:Ke.add(r,t.tokenStart,t.tokenEnd);break;case 1:Ke.add(n,t.tokenStart,t.tokenEnd)}lm(t)}else lm(t)}return Qr.ofColumns(i6e,{ai:er(r)(ie.Schema.int),aj:er(n)(ie.Schema.int)})}(a);else if("system"===d)i.system=function h6e(e){for(var t=e.tokenizer,r=void 0;t.tokenEnd<t.length;){dm(t);var n=t.data[t.position];if("["===n)break;if(";"!==n&&"*"!==n){if(void 0!==r)throw new Error("more than one system");r=Kk(t).trim()}else lm(t)}if(void 0===r)throw new Error("missing system");return r}(a);else if("molecules"===d)r(),i.molecules=function m6e(e){for(var t=e.tokenizer,r=Ke.create(t.data,64),n=Ke.create(t.data,64);t.tokenEnd<t.length&&(dm(t),!(t.position>=t.length));){var a=t.data[t.position];if("["===a)break;if(";"!==a&&"*"!==a){for(var i=0;i<2;++i)switch(dm(t),xD(t),Zk(t),i){case 0:Ke.add(r,t.tokenStart,t.tokenEnd);break;case 1:Ke.add(n,t.tokenStart,t.tokenEnd)}s6e(t),xD(t)}else lm(t)}return Qr.ofColumns(o6e,{compound:er(r)(ie.Schema.str),molCount:er(n)(ie.Schema.int)})}(a);else for(;n.tokenEnd<n.length&&"["!==n.data[n.position];)lm(n)}return[3,1];case 4:return[2,Nn.success(i)]}})})}function g6e(e){var t=this;return Ve.create("Parse TOP",function(r){return ce(t,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,v6e(e,r)];case 1:return[2,n.sent()]}})})})}var IJ=kt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ve.Root],to:[ve.Data.String,ve.Data.Binary],params:{url:D.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:D.Optional(D.Text("")),isBinary:D.Optional(D.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Ve.create("Download",function(i){return ce(r,void 0,void 0,function(){var o,s;return le(this,function(u){switch(u.label){case 0:return o=pn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new ve.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ve.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r=e.cache;null===(t=r?.asset)||void 0===t||t.dispose()},update:function(e){var t=e.oldParams,r=e.newParams;return t.url!==r.url||t.isBinary!==r.isBinary?rt.UpdateResult.Recreate:t.label!==r.label?(e.b.label=r.label||("string"==typeof r.url?r.url:r.url.url),rt.UpdateResult.Updated):rt.UpdateResult.Unchanged}}),PJ=kt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ve.Root,to:ve.Data.Blob,params:{sources:D.ObjectList({id:D.Text("",{label:"Unique ID"}),url:D.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:D.Optional(D.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:D.Optional(D.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return"".concat(e.id,": ").concat(e.url)}),maxConcurrency:D.Optional(D.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Ve.create("Download Blob",function(i){return ce(r,void 0,void 0,function(){var o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return o=[],[4,yNe(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],c=0;c<s.length;c++)d=n.sources[c],"error"===(l=s[c]).kind?t.log.warn("Download ".concat(l.id," (").concat(d.url,") failed: ").concat(l.error)):(u.push(l.result),o.push(d.isBinary?{id:l.id,kind:"binary",data:l.result.data}:{id:l.id,kind:"string",data:l.result.data}));return a.assets=u,[2,new ve.Data.Blob(o,{label:"Data Blob",description:"".concat(o.length," ").concat(1===o.length?"entry":"entries")})]}})})})},dispose:function(e,t){var r=e.cache,n=r?.assets;if(n)for(var a=0,i=n;a<i.length;a++)i[a].dispose()}}),MJ=kt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ve.Root],to:[ve.Data.String,ve.Data.Binary],params:{data:D.Value("",{isHidden:!0}),label:D.Optional(D.Text(""))}})({apply:function(e){var t=this,r=e.params;return Ve.create("Raw Data",function(){return ce(t,void 0,void 0,function(){return le(this,function(n){return"string"==typeof r.data?[2,new ve.Data.String(r.data,{label:r.label?r.label:"String"})]:Array.isArray(r.data)||r.data instanceof ArrayBuffer?[2,new ve.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})]:r.data instanceof Uint8Array?[2,new ve.Data.Binary(r.data,{label:r.label?r.label:"Binary"})]:(xn(),[2])})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?rt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if("string"==typeof e.data||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}if(e.data instanceof Uint8Array){for(r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),RJ=kt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ve.Root,to:[ve.Data.String,ve.Data.Binary],params:{file:D.File(),label:D.Optional(D.Text("")),isBinary:D.Optional(D.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Ve.create("Open File",function(i){return ce(r,void 0,void 0,function(){var o;return le(this,function(u){switch(u.label){case 0:return null===n.file?(t.log.error("No file(s) selected"),[2,ua.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,[2,n.isBinary?new ve.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ve.Data.String(o.data,{label:n.label?n.label:n.file.name})]}})})})},dispose:function(e){var t,r=e.cache;null===(t=r?.asset)||void 0===t||t.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams;return r.label!==n.label?(e.b.label=n.label||(null===(t=r.file)||void 0===t?void 0:t.name)||"",rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),y6e=kt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ve.Data.Blob,to:ve.Format.Blob,params:{formats:D.ObjectList({id:D.Text("",{label:"Unique ID"}),format:D.Select("cif",[["cif","cif"]])},function(e){return"".concat(e.id,": ").concat(e.format)})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Parse Blob",function(i){return ce(r,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)o.set((c=u[s]).id,c.format);l=[],d=0,f=n.data,m.label=1;case 1:return d<f.length?o.has((p=f[d]).id)?[4,("string"===p.kind?Yl.parse(p.data):Yl.parseBinary(p.data)).runInContext(i)]:[3,3]:[3,4];case 2:if((h=m.sent()).isError)throw new Error("".concat(p.id,": ").concat(h.message));l.push({id:p.id,kind:"cif",data:h.result}),m.label=3;case 3:return d++,[3,1];case 4:return[2,new ve.Format.Blob(l,{label:"Format Blob",description:"".concat(l.length," ").concat(1===l.length?"entry":"entries")})]}})})})}}),b6e=kt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ve.Data.String,ve.Data.Binary],to:ve.Format.Cif})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse CIF",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,("string"==typeof r.data?Yl.parse(r.data):Yl.parseBinary(r.data)).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return 0===a.result.blocks.length?[2,ua.Null]:[2,new ve.Format.Cif(a.result)]}})})})}}),_6e=kt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ve.Data.String,to:ve.Format.Cube})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse Cube",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,W5e(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Cube(a.result)]}})})})}}),S6e=kt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ve.Data.String],to:ve.Format.Psf})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse PSF",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,G5e(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Psf(a.result)]}})})})}}),C6e=kt.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[ve.Data.String],to:ve.Format.Prmtop})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse PRMTOP",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,n6e(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Prmtop(a.result)]}})})})}}),x6e=kt.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[ve.Data.String],to:ve.Format.Top})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse TOP",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,g6e(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Top(a.result)]}})})})}}),w6e=kt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ve.Data.String],to:ve.Format.Ply})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse PLY",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,F5e(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),A6e=kt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ve.Data.Binary],to:ve.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse CCP4/MRC/MAP",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,m5e(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Ccp4(a.result)]}})})})}}),T6e=kt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ve.Data.Binary],to:ve.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DSN6/BRIX",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,x5e(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Dsn6(a.result)]}})})})}}),D6e=kt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ve.Data.Binary,ve.Data.String],to:ve.Format.Dx})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,Z5e(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Dx(a.result)]}})})})}}),E6e=kt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ve.Root,to:ve.Data.String,params:{data:D.Value(""),label:D.Optional(D.Text(""))}})({apply:function(e){var t=e.params;return new ve.Data.String(t.data,{label:t.label||""})},update:function(e){var t=e.oldParams,r=e.newParams;return t.data!==r.data?rt.UpdateResult.Recreate:t.label!==r.label?(e.b.label=r.label||"",rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),I6e=kt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ve.Root,to:ve.Format.Json,params:{data:D.Value({}),label:D.Optional(D.Text(""))}})({apply:function(e){var t=e.params;return new ve.Format.Json(t.data,{label:t.label||""})},update:function(e){var t=e.oldParams,r=e.newParams;return t.data!==r.data?rt.UpdateResult.Recreate:t.label!==r.label?(e.b.label=r.label||"",rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),P6e=kt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ve.Data.String],to:ve.Format.Json})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse JSON",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new ve.Format.Json(a)]}})})})}}),M6e=kt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ve.Root,to:ve.Volume.Lazy,params:{url:D.Url(""),isBinary:D.Boolean(!1),format:D.Text("ccp4"),entryId:D.Value("",{isHidden:!0}),isovalues:D.ObjectList({type:D.Text("relative"),value:D.Numeric(0),color:D.Color(gr.black),alpha:D.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:D.Numeric(0)},function(e){return"".concat(e.type," ").concat(e.value)})}})({apply:function(e){var t=this,n=e.params;return Ve.create("Lazy Volume",function(a){return ce(t,void 0,void 0,function(){var i;return le(this,function(o){return i=Array.isArray(n.entryId)?n.entryId.join(", "):n.entryId,[2,new ve.Volume.Lazy(n,{label:"".concat(i||n.url),description:"Lazy Volume"})]})})})}}),R6e=kt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ve.Group,params:{label:D.Text("Group"),description:D.Optional(D.Text(""))}})({apply:function(e){return new ve.Group({},e.params)},update:function(e){var r=e.newParams,n=e.b;return GA(e.oldParams,r)?rt.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,rt.UpdateResult.Updated)}});function F6e(e){var t=this;return Ve.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n;return le(this,function(a){try{return n=function O6e(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(84!==i[0])for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(84!==i[0])throw new Error("dcd bad format, header block start");if("CORD"!==String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7)))throw new Error("dcd bad format, format string");var l=!1,d=!1,f=!1;if(0!==i[22]&&(l=!0,0!==i[12]&&(d=!0),1===i[13]&&(f=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],r.DELTA=l?t.getFloat32(44,o):t.getFloat64(44,o),84!==i[22])throw new Error("dcd bad format, header block end");var p=t.getInt32(a=a+84+8,o),h=a+1;if((p-4)%80!=0)throw new Error("dcd bad format, title block start");if(r.TITLE=function oMe(e){if(e.length>ON){for(var t=[],r=0;r<e.length;r+=ON)t.push(String.fromCharCode.apply(null,e.subarray(r,r+ON)));return t.join("")}return String.fromCharCode.apply(null,e)}(e.subarray(h,p)),t.getInt32(h+p+4-1,o)!==p)throw new Error("dcd bad format, title block end");if(4!==t.getInt32(a=a+p+8,o))throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),4!==t.getInt32(a+8,o))throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");var m=r.NATOM,v=4*m;for(u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=m,d&&(g.cell=[t.getFloat64(a+=4,o),t.getFloat64(a+1,o),t.getFloat64(a+16,o),t.getFloat64(a+24,o),t.getFloat64(a+32,o),t.getFloat64(a+40,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==v)throw new Error("dcd bad format, coord block start: ".concat(u,", ").concat(y));a+=4;var b=new Float32Array(e.buffer,a,m);if(0===y?g.x=b:1===y?g.y=b:g.z=b,t.getInt32(a+=v,o)!==v)throw new Error("dcd bad format, coord block end: ".concat(u,", ").concat(y));a+=4}f&&(a+=4+t.getInt32(a,o)+4),n.push(g)}return{header:r,frames:n}}(e),[2,Nn.success(n)]}catch(i){return[2,Nn.error(i)]}return[2]})})})}function z6e(e){return ce(this,void 0,void 0,function(){var t,n,a,i,o,u,c,l,d,f;return le(this,function(h){switch(h.label){case 0:return[4,lt.readLinesAsync(t=e.tokenizer,e.numberOfAtoms,e.runtimeCtx,1e5)];case 1:return n=h.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),e.header.hasVelocities=o=6===i.length,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,c=20+3*(u=e.header.precision.position+5),l=e.header.precision.velocity+4,d=function N6e(e){return function(t,r,n){return function k6e(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u="str"===s?function(c){var l=i[2*c]+t,d=i[2*c+1];if(l>=d)return"";var f=l+r;return f>d&&(f=d),function yOe(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(9===i||32===i)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(9===i||32===i)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}(a,l,f)}:"int"===s?function(c){var l=i[2*c]+t;return l>i[2*c+1]?0:xv(a,l,l+r)}:function(c){var l=i[2*c]+t;return l>i[2*c+1]?0:function MDe(e,t,r){for(;t<r&&32===e.charCodeAt(t);)t++;return Zf(e,t,r)}(a,l,l+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(c){return 0},toArray:function(c){return Bo(o,u,c)},areValuesEqual:function(c,l){return u(c)===u(l)}}}(e,t,r,n)}}(n),f=ie.Undefined(e.numberOfAtoms,ie.Schema.float),[2,{count:e.numberOfAtoms,residueNumber:d(0,5,ie.Schema.int),residueName:d(5,5,ie.Schema.str),atomName:d(10,5,ie.Schema.str),atomNumber:d(15,5,ie.Schema.int),x:d(20,u,ie.Schema.float),y:d(20+u,u,ie.Schema.float),z:d(20+2*u,u,ie.Schema.float),vx:o?d(c,l,ie.Schema.float):f,vy:o?d(c+l,l,ie.Schema.float):f,vz:o?d(c+2*l,l,ie.Schema.float):f}]}})})}function H6e(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i;return le(this,function(s){switch(s.label){case 0:return r=lt(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=function L6e(e,t){return{tokenizer:e,header:{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]},numberOfAtoms:0,runtimeCtx:t}}(r,t),function U6e(e){var t=e.tokenizer,r=e.header,n=lt.readLine(t);0===n.trim().length&&(n=lt.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&","===r.title[r.title.length-1]&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}(a),function V6e(e){var t=e.tokenizer;lt.markLine(t);var r=lt.getTokenString(t);e.numberOfAtoms=parseInt(r)}(a),[4,z6e(a)]):[3,4];case 3:return i=s.sent(),function G6e(e){var r=lt.readLine(e.tokenizer).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return[2,Nn.success({structures:n})]}})})}function j6e(e){var t=this;return Ve.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,H6e(e,r)];case 1:return[2,n.sent()]}})})})}function q6e(e,t,r){var n=this;return void 0===r&&(r=!1),Ve.create("Parse PDB",function(a){return ce(n,void 0,void 0,function(){var i,o,s;return le(this,function(u){switch(u.label){case 0:return o=(i=Nn).success,s={},[4,lt.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}var Iu=S();function ng(e,t,r,n){for(var a=0,i=3*n;a<i;a+=3)S.fromArray(Iu,t,r+a),S.transformMat4(Iu,Iu,e),S.toArray(Iu,t,r+a)}var wD=S(),eb=S(),AD=S(),ni=S(),TD=S();function FJ(e,t,r,n,a){for(var i=0,o=3*a;i<o;i+=3){var s=3*t[i],u=3*t[i+1],c=3*t[i+2];S.fromArray(wD,e,s),S.fromArray(eb,e,u),S.fromArray(AD,e,c),S.sub(ni,AD,eb),S.sub(TD,wD,eb),S.cross(ni,ni,TD),r[s]+=ni[0],r[s+1]+=ni[1],r[s+2]+=ni[2],r[u]+=ni[0],r[u+1]+=ni[1],r[u+2]+=ni[2],r[c]+=ni[0],r[c+1]+=ni[1],r[c+2]+=ni[2]}return function OJ(e,t){for(var r=0,n=3*t;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}(r,n)}function tb(e,t,r){void 0===r&&(r=1);for(var n=kd(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];var c=0;for(s=0;s<t;s++)a[s]=c,c+=o[s];a[t]=c;var l=new Int32Array(c);for(s=0,u=t*r;s<u;s+=r){var d=e[s];l[a[d]+i[d]]=s,++i[d]}return{indices:l,offsets:a}}var Qk=S.fromArray,DD=S.transformMat4Offset;function Ti(e,t,r,n){var a=function X6e(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r),a=(n+=(t-n%t)%t)>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}(e,t),i=a.length,o=a.width,s=a.height;return{array:n=n&&n.length>=i?n:new r(i),width:o,height:s}}var tl=S(),Q6e=new oc("14"),$6e=new oc("98");function BJ(e){return e>1e5?Q6e:$6e}function Cp(e,t,r){var n=3*r,a=BJ(t);a.reset();for(var i=0,o=3*t;i<o;i+=n)Qk(tl,e,i),a.includePosition(tl);for(a.finishedIncludeStep(),i=0,o=3*t;i<o;i+=n)Qk(tl,e,i),a.radiusPosition(tl);var s=a.getSphere();if(t<=14){var u=[];for(i=0,o=3*t;i<o;i+=n)u.push(Qk(S(),e,i));De.setExtrema(s,u)}return s}var $k=me();function lo(e,t,r,n){if(1===r){me.fromArray($k,t,n);var a=De.clone(e);return me.isIdentity($k)?a:De.transform(a,a,$k)}var i=BJ(r);i.reset();var o=e.center,s=e.radius,u=e.extrema;if(u&&r<=14){for(var c=0,l=r;c<l;++c)for(var d=0,f=u;d<f.length;d++)DD(tl,f[d],t,0,0,16*c+n),i.includePosition(tl);for(i.finishedIncludeStep(),c=0,l=r;c<l;++c)for(var h=0,m=u;h<m.length;h++)DD(tl,m[h],t,0,0,16*c+n),i.radiusPosition(tl)}else{for(c=0,l=r;c<l;++c)DD(tl,o,t,0,0,16*c+n),i.includePositionRadius(tl,s);for(i.finishedIncludeStep(),c=0,l=r;c<l;++c)DD(tl,o,t,0,0,16*c+n),i.radiusPositionRadius(tl,s)}return i.getSphere()}var as=new Uint8Array(772);function LJ(e,t){if(0===t)return 0;var r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,a=4*n,i=0;if(n<0)for(var o=0;o<t;++o)i+=e[o]&&1;else{for(o=0;o<n;++o){var s=r[o];i+=as[65535&s]+as[s>>16]}for(o=a;o<t;++o)i+=e[o]&&1}return i/t}function La(e,t,r){var n=Ti(Math.max(1,e),1,Uint8Array,r&&r.tMarker.ref.value.array),a=LJ(n.array,e),i=0===a?0:-1;return r?(O.updateIfChanged(r.uMarker,0),O.update(r.tMarker,n),O.update(r.uMarkerTexDim,Ne.create(n.width,n.height)),O.updateIfChanged(r.markerAverage,a),O.updateIfChanged(r.markerStatus,i),O.updateIfChanged(r.dMarkerType,t),r):{uMarker:O.create(0),tMarker:O.create(n),uMarkerTexDim:O.create(Ne.create(n.width,n.height)),markerAverage:O.create(a),markerStatus:O.create(i),dMarkerType:O.create(t)}}as[1]=1,as[2]=1,as[3]=1,as[256]=1,as[512]=1,as[768]=1,as[257]=2,as[513]=2,as[769]=2,as[258]=2,as[514]=2,as[770]=2,as[259]=2,as[515]=2,as[771]=2,new Uint8Array(1);var fc={kind:"null-location"};function VJ(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function Ln(e,t,r,n,a,i){if(void 0===a&&(a=!1),void 0===i&&(i=function(){return!1}),e%r!=0)throw new Error("incompatible groupCount and stride");var o={location:fc,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,c=0,l=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=c,o.instanceIndex=l,o.index=l*e+c,o.location=n(c,d?-1:l),o.isSecondary=i(c,d?-1:l),(c+=r)===e?(++l,u=!0,l<t&&(c=0)):u=!1,s=c<e),o},reset:function(){o.location=fc,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,c=0,l=0,d=!1},skipInstance:function(){s&&o.instanceIndex===l&&(++l,c=0,s=l<t)},voidInstances:function(){d=!0}}}function fm(e){return{kind:"position-location",position:e?S.clone(e):S()}}var ag,zJ=ms();function ED(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=function eUe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if($t(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}(e,t);throw new Error("Framebuffer status: ".concat(r))}}function GJ(e){var t=e.createFramebuffer();if(null===t)throw new Error("Could not create WebGL framebuffer");return t}function HJ(e){var t=function w8e(e){if($t(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return null===t?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}(e);if(null===t)throw new Error('Could not find support for "instanced_arrays"');var r=function T8e(e){return $t(e)?{}:e.getExtension("OES_element_index_uint")}(e);if(null===r)throw new Error('Could not find support for "element_index_uint"');var n=function A8e(e){if($t(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return null===t?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}(e);if(null===n)throw new Error('Could not find support for "standard_derivatives"');var a=function E8e(e){return $t(e)?{}:e.getExtension("OES_texture_float")}(e);xr&&null===a&&console.log('Could not find support for "texture_float"');var i=function I8e(e){return e.getExtension("OES_texture_float_linear")}(e);xr&&null===i&&console.log('Could not find support for "texture_float_linear"');var o=function P8e(e){if($t(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return null===t?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}(e);xr&&null===o&&console.log('Could not find support for "texture_half_float"');var s=function M8e(e){return e.getExtension("OES_texture_half_float_linear")}(e);xr&&null===s&&console.log('Could not find support for "texture_half_float_linear"');var u=function U8e(e){if($t(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return null===t?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}(e);xr&&null===u&&console.log('Could not find support for "depth_texture"');var c=function R8e(e){if($t(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return null===t?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}(e);xr&&null===c&&console.log('Could not find support for "blend_minmax"');var l=function D8e(e){if($t(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return null===t?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}(e);xr&&null===l&&console.log('Could not find support for "vertex_array_object"');var d=function O8e(e){return $t(e)?{}:e.getExtension("EXT_frag_depth")}(e);xr&&null===d&&console.log('Could not find support for "frag_depth"');var f=function F8e(e){if($t(e))return null===e.getExtension("EXT_color_buffer_float")?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return null===t?(e.getExtension("OES_texture_float"),pee(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}(e);xr&&null===f&&console.log('Could not find support for "color_buffer_float"');var p=function N8e(e){if($t(e))return null===e.getExtension("EXT_color_buffer_half_float")?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return null===t?(e.getExtension("OES_texture_half_float"),pee(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}(e);xr&&null===p&&console.log('Could not find support for "color_buffer_half_float"');var h=function k8e(e){if($t(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return null===t?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}(e);xr&&null===h&&console.log('Could not find support for "draw_buffers"');var m=function B8e(e){var t=e.getExtension("OES_draw_buffers_indexed");return null===t?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}(e);xr&&null===m&&console.log('Could not find support for "draw_buffers_indexed"');var v=function L8e(e){return $t(e)?{}:e.getExtension("EXT_shader_texture_lod")}(e);xr&&null===v&&console.log('Could not find support for "shader_texture_lod"');var g=function V8e(e){if($t(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return null===t?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}(e);xr&&null===g&&console.log('Could not find support for "sRGB"');var y=function z8e(e){var t;return $t(e)?null===(t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"))?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}:null===(t=e.getExtension("EXT_disjoint_timer_query"))?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}(e);xr&&null===y&&console.log('Could not find support for "disjoint_timer_query"');var b=function G8e(e){var t=e.getExtension("KHR_parallel_shader_compile");return null===t?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}(e);xr&&null===b&&console.log('Could not find support for "parallel_shader_compile"');var _=function H8e(e){return $t(e)?{}:e.getExtension("OES_fbo_render_mipmap")}(e);xr&&null===_&&console.log('Could not find support for "fbo_render_mipmap"');var C=function j8e(e){if($t(e)){var t=e.getExtension("WEBGL_provoking_vertex");if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}(e);xr&&null===C&&console.log('Could not find support for "provoking_vertex"');var x=function q8e(e){if($t(e)){var t=e.getExtension("WEBGL_clip_cull_distance");if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}(e);xr&&null===x&&console.log('Could not find support for "clip_cull_distance"');var A=function W8e(e){return $t(e)&&e.getExtension("EXT_conservative_depth")?{}:null}(e);xr&&null===A&&console.log('Could not find support for "conservative_depth"');var T=function Y8e(e){if($t(e)){var t=e.getExtension("WEBGL_stencil_texturing");if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}(e);xr&&null===T&&console.log('Could not find support for "stencil_texturing"');var w=function X8e(e){var t=e.getExtension("EXT_clip_control");return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}(e);xr&&null===w&&console.log('Could not find support for "clip_control"');var E=function K8e(e){if(!$t(e))return!1;if(typeof navigator<"u"){var t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return!t||parseInt(t[1])>=85}return!1}(e);return{instancedArrays:t,standardDerivatives:n,elementIndexUint:r,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,depthTexture:u,blendMinMax:c,vertexArrayObject:l,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:h,drawBuffersIndexed:m,shaderTextureLod:v,sRGB:g,disjointTimerQuery:y,parallelShaderCompile:b,fboRenderMipmap:_,provokingVertex:C,clipCullDistance:x,conservativeDepth:A,stencilTexturing:T,clipControl:w,noNonInstancedActiveAttribs:E}}!function(e){e.create=function t(a,i,o){return{array:a,width:i,height:o}},e.flipY=function r(a){for(var i=a.array,o=a.width,s=a.height,c=o*(i.length/(o*s)),l=0,d=s/2;l<d;++l)for(var f=0,p=c;f<p;++f){var h=l*c+f,m=(s-l-1)*c+f,v=i[h];i[h]=i[m],i[m]=v}return a},e.divideByAlpha=function n(a){for(var i=a.array,o=i instanceof Uint8Array?255:1,s=0,u=i.length;s<u;s+=4){var c=i[s+3]/o;i[s]/=c,i[s+1]/=c,i[s+2]/=c}return a}}(ag||(ag={}));var jJ=ms(),$Ue={apply_fog:"\nfloat preFogAlpha = gl_FragColor.a;\nif (uFog) {\n    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (!uTransparentBackground) {\n        if (gl_FragColor.a < 1.0) {\n            // transparent objects are blended with background color\n            gl_FragColor.a = fogAlpha;\n        } else {\n            // mix opaque objects with background color\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n        }\n    } else {\n        #if defined(dRenderVariant_colorDpoit)\n            if (gl_FragColor.a < 1.0) {\n                // transparent objects are blended with background color\n                gl_FragColor.a = fogAlpha;\n            } else {\n                // opaque objects need to be pre-multiplied alpha\n                gl_FragColor.rgb *= fogAlpha;\n                gl_FragColor.a = fogAlpha;\n            }\n        #else\n            // pre-multiplied alpha expected for transparent background\n            gl_FragColor.rgb *= fogAlpha;\n            gl_FragColor.a = fogAlpha;\n        #endif\n    }\n}\n",apply_interior_color:"\nif (interior) {\n    if (uInteriorColorFlag) {\n        gl_FragColor.rgb = uInteriorColor;\n    } else {\n        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;\n    }\n\n    #ifdef dTransparentBackfaces_opaque\n        gl_FragColor.a = 1.0;\n    #endif\n}\n",apply_light_color:"\n#ifdef dIgnoreLight\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;\n            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;\n        }\n    #endif\n\n    gl_FragColor = material;\n#else\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);\n        }\n    #endif\n\n    vec4 color = material;\n\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n    PhysicalMaterial physicalMaterial;\n    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);\n    #ifdef enabledFragDepth\n        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);\n    #else\n        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));\n        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);\n    #endif\n    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);\n    physicalMaterial.specularF90 = 1.0;\n\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = normalize(vViewPosition);\n\n    IncidentLight directLight;\n    #pragma unroll_loop_start\n    for (int i = 0; i < dLightCount; ++i) {\n        directLight.direction = uLightDirection[i];\n        directLight.color = uLightColor[i] * PI; // * PI for punctual light\n        RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);\n    }\n    #pragma unroll_loop_end\n\n    vec3 irradiance = uAmbientColor * PI; // * PI for punctual light\n    RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);\n\n    // indirect specular only metals\n    vec3 radiance = uAmbientColor * metalness;\n    vec3 iblIrradiance = uAmbientColor * metalness;\n    vec3 clearcoatRadiance = vec3(0.0);\n    RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background\n\n    gl_FragColor = vec4(outgoingLight, color.a);\n#endif\n\n#if defined(dXrayShaded_on)\n    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#elif defined(dXrayShaded_inverted)\n    gl_FragColor.a *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#endif\n\ngl_FragColor.rgb *= uExposure;\n",apply_marker_color:"\n\n#if defined(dColorMarker)\n    if (marker > 0.0) {\n        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering\n        } else {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering\n        }\n    } else if (uMarkerAverage > 0.0) {\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);\n        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering\n    }\n#endif\n",assign_clipping_varying:"\n#if dClipObjectCount != 0 && defined(dClipping)\n    #if defined(dClippingType_instance)\n        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;\n    #endif\n#endif\n",assign_color_varying:"\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_attribute)\n        vColor.rgb = aColor;\n    #elif defined(dColorType_instance)\n        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n    #elif defined(dColorType_group)\n        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n    #elif defined(dColorType_groupInstance)\n        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n    #elif defined(dColorType_vertex)\n        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_vertexInstance)\n        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_volume)\n        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #elif defined(dColorType_volumeInstance)\n        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #endif\n\n    #ifdef dUsePalette\n        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);\n        #elif defined(dOverpaintType_groupInstance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);\n        #elif defined(dOverpaintType_vertexInstance)\n            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);\n        #elif defined(dOverpaintType_volumeInstance)\n            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;\n            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);\n        #endif\n\n        // pre-mix to avoid darkening due to empty overpaint\n        #ifdef dColorType_uniform\n            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #else\n            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #endif\n        vOverpaint *= uOverpaintStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance)\n            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);\n        #elif defined(dSubstanceType_groupInstance)\n            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);\n        #elif defined(dSubstanceType_vertexInstance)\n            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);\n        #elif defined(dSubstanceType_volumeInstance)\n            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;\n            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);\n        #endif\n\n        // pre-mix to avoid artifacts due to empty substance\n        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);\n        vSubstance *= uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #ifdef requiredDrawBuffers\n        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        vInstance = vec4(packIntToRGB(aInstance), 1.0);\n        vGroup = vec4(packIntToRGB(group), 1.0);\n    #else\n        if (uPickType == 1) {\n            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        } else if (uPickType == 2) {\n            vColor = vec4(packIntToRGB(aInstance), 1.0);\n        } else {\n            vColor = vec4(packIntToRGB(group), 1.0);\n        }\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance)\n        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_groupInstance)\n        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_vertexInstance)\n        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_volumeInstance)\n        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;\n        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;\n    #endif\n    vTransparency *= uTransparencyStrength;\n#endif\n",assign_group:"\n#ifdef dGeometryType_textureMesh\n    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);\n#else\n    float group = aGroup;\n#endif\n",assign_marker_varying:"\n#if defined(dNeedsMarker)\n    #if defined(dMarkerType_instance)\n        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n    #endif\n#endif\n",assign_material_color:"\n#if defined(dNeedsMarker)\n    float marker = uMarker;\n    if (uMarker == -1.0) {\n        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    }\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dUsePalette)\n        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);\n    #elif defined(dColorType_uniform)\n        vec4 material = vec4(uColor, uAlpha);\n    #elif defined(dColorType_varying)\n        vec4 material = vec4(vColor.rgb, uAlpha);\n    #endif\n\n    // mix material with overpaint\n    #if defined(dOverpaint)\n        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);\n    #endif\n\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float bumpiness = uBumpiness;\n    #ifdef dSubstance\n        metalness = mix(metalness, vSubstance.r, vSubstance.a);\n        roughness = mix(roughness, vSubstance.g, vSubstance.a);\n        bumpiness = mix(bumpiness, vSubstance.b, vSubstance.a);\n    #endif\n#elif defined(dRenderVariant_depth)\n    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n        discard;\n    }\n\n    #ifndef dXrayShaded\n        #if defined(dTransparency)\n            float dta = 1.0 - vTransparency;\n            if (vTransparency < 0.2) dta = 1.0; // hard cutoff looks better\n\n            if (uRenderMask == MaskTransparent && uAlpha * dta == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha * dta < 1.0) {\n                discard;\n            }\n        #else\n            if (uRenderMask == MaskTransparent && uAlpha == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha < 1.0) {\n                discard;\n            }\n        #endif\n    #else\n        if (uRenderMask == MaskOpaque) {\n            discard;\n        }\n    #endif\n\n    vec4 material = packDepthToRGBA(fragmentDepth);\n#elif defined(dRenderVariant_marking)\n    vec4 material;\n    if(uMarkingType == 1) {\n        if (marker > 0.0)\n            discard;\n        #ifdef enabledFragDepth\n            material = packDepthToRGBA(gl_FragDepthEXT);\n        #else\n            material = packDepthToRGBA(gl_FragCoord.z);\n        #endif\n    } else {\n        if (marker == 0.0)\n            discard;\n        float depthTest = 1.0;\n        if (uMarkingDepthTest) {\n            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n        }\n        bool isHighlight = intMod(marker, 2.0) > 0.1;\n        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n        if (fogFactor == 1.0)\n            discard;\n        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);\n    }\n#endif\n\n// apply per-group transparency\n#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color))\n    float ta = 1.0 - vTransparency;\n    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better\n\n    #if defined(dRenderVariant_pick)\n        if (ta < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n    #elif defined(dRenderVariant_color)\n        material.a *= ta;\n\n        #if defined(dRenderVariant_colorBlended)\n            #if defined(dTransparentBackfaces_off)\n                if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0) ||\n                    (interior && material.a < 1.0)\n                ) {\n                    discard;\n                }\n            #elif defined(dTransparentBackfaces_on)\n                if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0)\n                ) {\n                    discard;\n                }\n            #elif defined(dTransparentBackfaces_opaque)\n                if (interior) {\n                    material.a = 1.0;\n                } else if (\n                    (uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0)\n                ) {\n                    discard;\n                }\n            #endif\n        #endif\n    #endif\n#endif\n",assign_position:"\nmat4 model = uModel * aTransform;\nmat4 modelView = uView * model;\n#ifdef dGeometryType_textureMesh\n    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;\n#else\n    vec3 position = aPosition;\n#endif\nvec4 position4 = vec4(position, 1.0);\n// for accessing tColorGrid in vert shader and for clipping in frag shader\nvModelPosition = (model * position4).xyz;\nvec4 mvPosition = modelView * position4;\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n",assign_size:"\n#if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);\n#elif defined(dSizeType_group)\n    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);\n#elif defined(dSizeType_groupInstance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size /= 100.0; // NOTE factor also set in TypeScript\n#endif\n\nsize *= uSizeFactor;\n",check_picking_alpha:"\nfloat viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\nfloat fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\nfloat alpha = (1.0 - fogFactor) * uAlpha;\n// if not opaque enough ignore so the element below can be picked\nif (uAlpha < uPickingAlphaThreshold || alpha < 0.1) {\n    #ifdef dTransparentBackfaces_opaque\n        if (!interior) discard;\n    #else\n        discard;\n    #endif\n}\n",clip_instance:"\n#if defined(dClipVariant_instance) && dClipObjectCount != 0\n    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);\n    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w)))\n        // move out of [ -w, +w ] to 'discard' in vert shader\n        gl_Position.z = 2.0 * gl_Position.w;\n#endif\n",clip_pixel:"\n#if defined(dClipVariant_pixel) && dClipObjectCount != 0\n    if (clipTest(vec4(vModelPosition, 0.0)))\n        discard;\n#endif\n",color_frag_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n#ifdef bumpEnabled\n    uniform float uBumpFrequency;\n    uniform float uBumpAmplitude;\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_varying)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        uniform sampler2D tPalette;\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        varying vec4 vOverpaint;\n    #endif\n\n    #ifdef dSubstance\n        varying vec4 vSubstance;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat in vec4 vObject;\n            flat in vec4 vInstance;\n            flat in vec4 vGroup;\n        #else\n            flat in vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    varying float vTransparency;\n#endif\n",color_vert_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_attribute)\n        varying vec4 vColor;\n        attribute vec3 aColor;\n    #elif defined(dColorType_texture)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform sampler2D tColor;\n    #elif defined(dColorType_grid)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform vec3 uColorGridDim;\n        uniform vec4 uColorGridTransform;\n        uniform sampler2D tColorGrid;\n    #elif defined(dColorType_direct)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform sampler2D tOverpaint;\n        #elif defined(dOverpaintType_volumeInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform vec3 uOverpaintGridDim;\n            uniform vec4 uOverpaintGridTransform;\n            uniform sampler2D tOverpaintGrid;\n        #endif\n        uniform float uOverpaintStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform sampler2D tSubstance;\n        #elif defined(dSubstanceType_volumeInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform vec3 uSubstanceGridDim;\n            uniform vec4 uSubstanceGridTransform;\n            uniform sampler2D tSubstanceGrid;\n        #endif\n        uniform float uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat out vec4 vObject;\n            flat out vec4 vInstance;\n            flat out vec4 vGroup;\n        #else\n            flat out vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform sampler2D tTransparency;\n    #elif defined(dTransparencyType_volumeInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform vec3 uTransparencyGridDim;\n        uniform vec4 uTransparencyGridTransform;\n        uniform sampler2D tTransparencyGrid;\n    #endif\n    uniform float uTransparencyStrength;\n#endif\n",common_clip:"\n#if dClipObjectCount != 0\n    vec3 quaternionTransform(const in vec4 q, const in vec3 v) {\n        vec3 t = 2.0 * cross(q.xyz, v);\n        return v + q.w * t + cross(q.xyz, t);\n    }\n\n    vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {\n        return vec4(normalize(normal), -dot(normal, inPoint));\n    }\n\n    float planeSD(const in vec4 plane, const in vec3 center) {\n        return -dot(plane.xyz, center - plane.xyz * -plane.w);\n    }\n\n    float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        return (\n            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0\n        ) * min(min(size.x, size.y), size.z);\n    }\n\n    float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;\n        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));\n    }\n\n    float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n    }\n\n    float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        float q = length(t.xy);\n        return dot(size.xy, vec2(q, t.z));\n    }\n\n    float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale) {\n        if (type == 1) {\n            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));\n            vec4 plane = computePlane(normal, position);\n            return planeSD(plane, center);\n        } else if (type == 2) {\n            return sphereSD(position, rotation, scale * 0.5, center);\n        } else if (type == 3) {\n            return cubeSD(position, rotation, scale * 0.5, center);\n        } else if (type == 4) {\n            return cylinderSD(position, rotation, scale * 0.5, center);\n        } else if (type == 5) {\n            return infiniteConeSD(position, rotation, scale * 0.5, center);\n        } else {\n            return 0.1;\n        }\n    }\n\n    #if __VERSION__ == 100\n        // 8-bit\n        int bitwiseAnd(in int a, in int b) {\n            int d = 128;\n            int result = 0;\n            for (int i = 0; i < 8; ++i) {\n                if (d <= 0) break;\n                if (a >= d && b >= d) result += d;\n                if (a >= d) a -= d;\n                if (b >= d) b -= d;\n                d /= 2;\n            }\n            return result;\n        }\n\n        bool hasBit(const in int mask, const in int bit) {\n            return bitwiseAnd(mask, bit) == 0;\n        }\n    #else\n        bool hasBit(const in int mask, const in int bit) {\n            return (mask & bit) == 0;\n        }\n    #endif\n\n    bool clipTest(const in vec4 sphere) {\n        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)\n        #if defined(dClipping)\n            int flag = int(floor(vClipping * 255.0 + 0.5));\n        #else\n            int flag = 0;\n        #endif\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dClipObjectCount; ++i) {\n            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {\n                // TODO take sphere radius into account?\n                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;\n                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {\n                    return true;\n                }\n            }\n        }\n        #pragma unroll_loop_end\n        return false;\n    }\n#endif\n",common_frag_params:'\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform int uPickType;\nuniform int uMarkingType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat in float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat in float vMarker;\n    #endif\n#endif\n\n#if defined(dRenderVariant_colorDpoit)\n    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript\n    uniform sampler2D tDpoitDepth;\n    uniform sampler2D tDpoitFrontColor;\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\nuniform vec2 uViewOffset;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform bool uTransparentBackground;\n\nuniform bool uDoubleSided;\nuniform float uInteriorDarkening;\nuniform bool uInteriorColorFlag;\nuniform vec3 uInteriorColor;\nbool interior;\n\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform mat4 uProjection;\n\nuniform int uRenderMask;\nuniform bool uMarkingDepthTest;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nfloat getDepthPacked(const in vec2 coords) {\n    return unpackRGBAToDepth(texture2D(tDepth, coords));\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\n// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\nvec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {\n    vec3 sigmaS = dFdx(position);\n    vec3 sigmaT = dFdy(position);\n\n    vec3 r1 = cross(sigmaT, normal);\n    vec3 r2 = cross(normal, sigmaS);\n    float det = dot(sigmaS, r1);\n\n    float bs = dFdx(height);\n    float bt = dFdy(height);\n\n    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);\n    return normalize(abs(det) * normal - scale * surfGrad);\n}\n\nfloat hash(in float h) {\n    return fract(sin(h) * 43758.5453123);\n}\n\nfloat noise(in vec3 x) {\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f * f * (3.0 - 2.0 * f);\n\n    float n = p.x + p.y * 157.0 + 113.0 * p.z;\n    return mix(\n        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\n            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\n        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\n            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);\n}\n\nfloat fbm(in vec3 p) {\n    float f = 0.0;\n    f += 0.5 * noise(p);\n    p *= 2.01;\n    f += 0.25 * noise(p);\n    p *= 2.02;\n    f += 0.125 * noise(p);\n\n    return f;\n}\n',common_vert_params:"\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\nuniform vec4 uInvariantBoundingSphere;\n\nuniform bool uDoubleSided;\nuniform int uPickType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        uniform vec2 uClippingTexDim;\n        uniform sampler2D tClipping;\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat out float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat out float vMarker;\n    #endif\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\n#if defined(noNonInstancedActiveAttribs)\n    // int() is needed for some Safari versions\n    // see https://bugs.webkit.org/show_bug.cgi?id=244152\n    #define VertexID int(gl_VertexID)\n#else\n    attribute float aVertex;\n    #define VertexID int(aVertex)\n#endif\n",common:"\n// TODO find a better place for these convenience defines\n\n#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)\n    #define dRenderVariant_color\n#endif\n\n#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)\n    #define dColorType_texture\n#endif\n\n#if defined(dColorType_volume) || defined(dColorType_volumeInstance)\n    #define dColorType_grid\n#endif\n\n#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)\n    #define dColorType_varying\n#endif\n\n#if (defined(dRenderVariant_color) && defined(dColorMarker)) || defined(dRenderVariant_marking)\n    #define dNeedsMarker\n#endif\n\n#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)\n    #define dXrayShaded\n#endif\n\n#define MaskAll 0\n#define MaskOpaque 1\n#define MaskTransparent 2\n\n//\n\n#define PI 3.14159265\n#define RECIPROCAL_PI 0.31830988618\n#define EPSILON 1e-6\n\n#define saturate(a) clamp(a, 0.0, 1.0)\n\n#if __VERSION__ == 100\n    #define round(x) floor((x) + 0.5)\n#endif\n\nfloat intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }\nvec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }\nfloat intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }\nint imod(const in int a, const in int b) { return a - b * (a / b); }\n\nfloat pow2(const in float x) { return x * x; }\n\nvec3 packIntToRGB(in float value) {\n    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\nfloat unpackRGBToInt(const in vec3 rgb) {\n    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;\n}\n\nvec2 packUnitIntervalToRG(const in float v) {\n    vec2 enc;\n    enc.xy = vec2(fract(v * 256.0), v);\n    enc.y -= enc.x * (1.0 / 256.0);\n    enc.xy *=  256.0 / 255.0;\n\n    return enc;\n}\n\nfloat unpackRGToUnitInterval(const in vec2 enc) {\n    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));\n}\n\nvec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {\n    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);\n    p = invProjection * p;\n    return p.xyz / p.w;\n}\n\nconst float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)\nconst vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);\n}\n\nfloat linearizeDepth(const in float depth, const in float near, const in float far) {\n    return (2.0 * near) / (far + near - depth * (far - near));\n}\n\nfloat perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {\n    return (near * far) / ((far - near) * invClipZ - far);\n}\n\nfloat orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {\n    return linearClipZ * (near - far) - near;\n}\n\nfloat depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {\n    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);\n}\n\n#if __VERSION__ == 100\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose2(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose3(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose4(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    // inverse\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    mat2 inverse2(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse3(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse4(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n\n    #define isNaN(x) ((x) != (x))\n    #define isInf(x) ((x) == (x) + 1.0)\n#else\n    #define transpose2(m) transpose(m)\n    #define transpose3(m) transpose(m)\n    #define transpose4(m) transpose(m)\n\n    #define inverse2(m) inverse(m)\n    #define inverse3(m) inverse(m)\n    #define inverse4(m) inverse(m)\n\n    #define isNaN isnan\n    #define isInf isinf\n#endif\n",float_to_rgba:"\n    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba\n    // MIT License, Copyright (c) 2020 Equinor\n\n    float shiftRight (float v, float amt) {\n    v = floor(v) + 0.5;\n    return floor(v / exp2(amt));\n    }\n    float shiftLeft (float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n    }\n    float maskLast (float v, float bits) {\n        return mod(v, shiftLeft(1.0, bits));\n    }\n    float extractBits (float num, float from, float to) {\n        from = floor(from + 0.5); to = floor(to + 0.5);\n        return maskLast(shiftRight(num, from), to - from);\n    }\n\n    vec4 floatToRgba(float texelFloat, bool littleEndian) {\n        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);\n        float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n        texelFloat = abs(texelFloat);\n        float exponent = floor(log2(texelFloat));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return (\n            littleEndian\n                ? vec4(byte4, byte3, byte2, byte1)\n                : vec4(byte1, byte2, byte3, byte4)\n        );\n    }\n",light_frag_params:"\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\nuniform vec3 uAmbientColor;\n\nstruct PhysicalMaterial {\n    vec3 diffuseColor;\n    float roughness;\n    vec3 specularColor;\n    float specularF90;\n};\n\nstruct IncidentLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n    vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n    vec3 position;\n    vec3 normal;\n    vec3 viewDir;\n};\n\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {\n    // Original approximation by Christophe Schlick '94\n    // float fresnel = pow( 1.0 - dotVH, 5.0 );\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\n    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);\n    return f0 * (1.0 - fresnel) + (f90 * fresnel);\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {\n    float a2 = pow2(alpha);\n    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\n    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\n    return 0.5 / max(gv + gl, EPSILON);\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\nfloat D_GGX(const in float alpha, const in float dotNH) {\n    float a2 = pow2(alpha);\n    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1\n    return RECIPROCAL_PI * a2 / pow2(denom);\n}\n\n// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\nvec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {\n    float alpha = pow2(roughness); // UE4's roughness\n    vec3 halfDir = normalize( lightDir + viewDir);\n    float dotNL = saturate(dot(normal, lightDir));\n    float dotNV = saturate(dot(normal, viewDir));\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotVH = saturate(dot(viewDir, halfDir));\n    vec3 F = F_Schlick(f0, f90, dotVH);\n    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return F * (V * D);\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via 'environmentBRDF' from \"Physically Based Shading on Mobile\"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n    float dotNV = saturate(dot(normal, viewDir));\n    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n    vec4 r = roughness * c0 + c1;\n    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;\n    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;\n    return fab;\n}\n\n// Fdez-Ag\xfcera's \"Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting\"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\n    vec2 fab = DFGApprox(normal, viewDir, roughness);\n    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n    float Ess = fab.x + fab.y;\n    float Ems = 1.0 - Ess;\n    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21\n    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\n    singleScatter += FssEss;\n    multiScatter += Fms * Ems;\n}\n\nvoid RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    float dotNL = saturate(dot(geometry.normal, directLight.direction));\n    vec3 irradiance = dotNL * directLight.color;\n    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\n    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    // Both indirect specular and indirect diffuse light accumulate here\n    vec3 singleScattering = vec3(0.0);\n    vec3 multiScattering = vec3(0.0);\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);\n    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));\n    reflectedLight.indirectSpecular += radiance * singleScattering;\n    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n",matrix_scale:"\nfloat matrixScale(in mat4 m){\n    vec4 r = m[0];\n    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);\n}\n",normal_frag_params:"\nvarying vec3 vNormal;\n",read_from_texture:"\nvec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\nvec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {\n    int x = imod(i, int(dim.x));\n    int y = i / int(dim.x);\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n",rgba_to_float:'\n    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float\n    // BSD 3-Clause License\n    //\n    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.\n    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n    //\n    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n    // OF THE POSSIBILITY OF SUCH DAMAGE.\n\n    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n        ivec4 bytes = ivec4(inputFloats * 255.0);\n        return (\n            littleEndian\n                ? bytes.abgr\n                : bytes\n        );\n    }\n\n    // Break the four bytes down into an array of 32 bits.\n    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n            float acc = float(bytes[channelIndex]);\n            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n                float powerOfTwo = exp2(float(indexInByte));\n                bool bit = acc >= powerOfTwo;\n                bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n                acc = mod(acc, powerOfTwo);\n            }\n        }\n    }\n\n    // Compute the exponent of the 32-bit float.\n    float getExponent(bool bits[32]) {\n        const int startIndex = 1;\n        const int bitStringLength = 8;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        float acc = 0.0;\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Compute the mantissa of the 32-bit float.\n    float getMantissa(bool bits[32], bool subnormal) {\n        const int startIndex = 9;\n        const int bitStringLength = 23;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        // Leading/implicit/hidden bit convention:\n        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n        float acc = float(!subnormal) * exp2(float(bitStringLength));\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Parse the float from its 32 bits.\n    float bitsToFloat(bool bits[32]) {\n        float signBit = float(bits[0]) * -2.0 + 1.0;\n        float exponent = getExponent(bits);\n        bool subnormal = abs(exponent - 0.0) < 0.01;\n        float mantissa = getMantissa(bits, subnormal);\n        float exponentBias = 127.0;\n        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n    }\n\n    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n        bool bits[32];\n        bytesToBits(rgbaBytes, bits);\n        return bitsToFloat(bits);\n    }\n',size_vert_params:"\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n#endif\n\nuniform float uSizeFactor;\n",texture3d_from_1d_trilinear:"\nvec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {\n    float gdYZ = gridDim.z * gridDim.y;\n    float gdZ = gridDim.z;\n    vec3 p0 = floor(pos * gridDim);\n    vec3 p1 = ceil(pos * gridDim);\n    vec3 pd = (pos * gridDim - p0) / (p1 - p0);\n    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s00 = mix(s000, s100, pd.x);\n    vec4 s01 = mix(s001, s101, pd.x);\n    vec4 s10 = mix(s010, s110, pd.x);\n    vec4 s11 = mix(s011, s111, pd.x);\n    vec4 s0 = mix(s00, s10, pd.y);\n    vec4 s1 = mix(s01, s11, pd.y);\n    return mix(s0, s1, pd.z);\n}\n",texture3d_from_2d_linear:"\nvec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice0 = floor(pos.z * gridDim.z);\n    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;\n    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));\n    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color0 = texture2D(tex, coord0);\n\n    float zSlice1 = zSlice0 + 1.0;\n    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;\n    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));\n    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color1 = texture2D(tex, coord1);\n\n    float delta0 = abs((pos.z * gridDim.z) - zSlice0);\n    return mix(color0, color1, delta0);\n}\n",texture3d_from_2d_nearest:"\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n",wboit_write:"\n#if defined(dRenderVariant_colorWboit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n            float alpha = gl_FragColor.a;\n            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);\n            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);\n            // extra alpha is to handle pre-multiplied alpha\n            #ifndef dGeometryType_directVolume\n                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);\n            #else\n                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);\n            #endif\n        } else {\n            discard;\n        }\n    }\n#endif\n",dpoit_write:"\n#if defined(dRenderVariant_colorDpoit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n\n            // adapted from https://github.com/tsherif/webgl2examples\n            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao\n\n            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;\n            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);\n\n            vec4 fragColor = gl_FragColor;\n\n            // depth value always increases\n            // so we can use MAX blend equation\n            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);\n\n            // front color always increases\n            // so we can use MAX blend equation\n            gl_FragColor = lastFrontColor;\n\n            // back color is separately blend afterwards each pass\n            gl_FragData[1] = vec4(0.0);\n\n            float nearestDepth = -lastDepth.x;\n            float furthestDepth = lastDepth.y;\n            float alphaMultiplier = 1.0 - lastFrontColor.a;\n\n            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {\n                // Skip this depth since it's been peeled.\n                return;\n            }\n\n            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {\n                // This needs to be peeled.\n                // The ones remaining after MAX blended for\n                // all need-to-peel will be peeled next pass.\n                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);\n                return;\n            }\n\n            // write to back and front color buffer\n            if (fragmentDepth == nearestDepth) {\n                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;\n                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);\n            } else {\n                gl_FragData[1] += fragColor;\n            }\n\n        } else {\n            discard;\n        }\n    }\n#endif\n"},JUe=/^(?!\/\/)\s*#include\s+(\S+)/gm,eVe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,tVe=/[ \t]*\/\/.*\n/g,rVe=/[ \t]*\/\*[\s\S]*?\*\//g,nVe=/\n{2,}/g;function qJ(e){return e.replace(JUe,function(t,r){var n=$Ue[r];if(!n)throw new Error("empty chunk, '".concat(r,"'"));return n}).trim().replace(tVe,"\n").replace(rVe,"\n").replace(nVe,"\n")}function iVe(e,t,r,n){for(var a="",i=parseInt(t);i<parseInt(r);++i)a+=n.replace(/\[\s*i\s*\]/g,"[".concat(i,"]")).replace(/UNROLLED_LOOP_INDEX/g,"".concat(i));return a}function WJ(e,t){return function aVe(e){return e.replace(eVe,iVe)}(function oVe(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,"".concat(t.dLightCount.ref.value))),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,"".concat(t.dClipObjectCount.ref.value))),e}(e,t))}function Un(e,t,r,n,a,i){return void 0===n&&(n={}),void 0===a&&(a={}),{id:jJ(),name:e,vert:qJ(t),frag:qJ(r),extensions:n,outTypes:a,ignoreDefine:i}}function FS(e,t,r){var n;return t.startsWith("color")?"dLightCount"===e&&!(null===(n=r.dIgnoreLight)||void 0===n||!n.ref.value):["dColorType","dUsePalette","dLightCount","dXrayShaded","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker"].includes(e)}function ID(e,t,r){return"dLightCount"===e||FS(e,t,r)}var sVe=Un("points","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvoid main(){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_size\n\n    #ifdef dPointSizeAttenuation\n        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;\n    #else\n        gl_PointSize = size * uPixelRatio;\n    #endif\n    gl_PointSize = max(1.0, gl_PointSize);\n\n    gl_Position = uProjection * mvPosition;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nconst vec2 center = vec2(0.5);\nconst float radius = 0.5;\n\nvoid main(){\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dPointStyle_circle)\n        float dist = distance(gl_PointCoord, center);\n        if (dist > radius) discard;\n    #elif defined(dPointStyle_fuzzy)\n        float dist = distance(gl_PointCoord, center);\n        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);\n        if (fuzzyAlpha < 0.0001) discard;\n    #endif\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #if defined(dPointStyle_fuzzy)\n            gl_FragColor.a *= fuzzyAlpha;\n        #endif\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ID),uVe=Un("spheres","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\nuniform mat4 uInvProjection;\nuniform float uIsOrtho;\n\nuniform vec2 uTexDim;\nuniform sampler2D tPositionGroup;\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#include matrix_scale\n\n/**\n * Bounding rectangle of a clipped, perspective-projected 3D Sphere.\n * Michael Mara, Morgan McGuire. 2013\n *\n * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018\n * https://github.com/zeux/niagara\n */\nvoid sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {\n    vec3 pr = p * r;\n    float pzr2 = p.z * p.z - r * r;\n\n    float vx = sqrt(p.x * p.x + pzr2);\n    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];\n    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];\n\n    float vy = sqrt(p.y * p.y + pzr2);\n    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];\n    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];\n\n    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;\n    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;\n    gl_Position.xy *= gl_Position.w;\n}\n\nvoid main(void){\n    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5\n    #if __VERSION__ == 100\n        int m = imod(VertexID, 6);\n    #else\n        int m = VertexID % 6;\n    #endif\n    if (m == 0) {\n        mapping = vec2(-1.0, 1.0);\n    } else if (m == 1 || m == 3) {\n        mapping = vec2(-1.0, -1.0);\n    } else if (m == 4) {\n        mapping = vec2(1.0, -1.0);\n    }\n\n    vec4 positionGroup = readFromTexture(tPositionGroup, VertexID / 6, uTexDim);\n    vec3 position = positionGroup.rgb;\n    float group = positionGroup.a;\n\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vRadius = size * matrixScale(uModelView);\n\n    vec4 position4 = vec4(position, 1.0);\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    #ifdef dApproximate\n        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n        mvCorner.xy += mapping * vRadius;\n        gl_Position = uProjection * mvCorner;\n    #else\n        if (uIsOrtho == 1.0) {\n            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n            mvCorner.xy += mapping * vRadius;\n            gl_Position = uProjection * mvCorner;\n        } else {\n            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n            sphereProjection(mvPosition.xyz, vRadius, mapping);\n        }\n    #endif\n\n    vec4 vPoint4 = uInvProjection * gl_Position;\n    vPoint = vPoint4.xyz / vPoint4.w;\n    vPointViewPosition = -mvPosition.xyz / mvPosition.w;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * vRadius; // avoid clipping\n        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;\n    }\n\n    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0\n        if (clipTest(vec4(vModelPosition.xyz, 0.0))) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    #else\n        #include clip_instance\n    #endif\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\nuniform mat4 uInvView;\nuniform float uAlphaThickness;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\nbool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){\n    vec3 cameraSpherePos = -vPointViewPosition;\n\n    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);\n    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);\n\n    float B = dot(rayDirection, cameraSphereDir);\n    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);\n\n    if (det < 0.0) return false;\n\n    float sqrtDet = sqrt(det);\n    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);\n    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);\n\n    cameraPos = rayDirection * negT + rayOrigin;\n    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n    fragmentDepth = calcDepth(cameraPos);\n\n    bool objectClipped = false;\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        if (clipTest(vec4(modelPos, 0.0))) {\n            objectClipped = true;\n            fragmentDepth = -1.0;\n        }\n    #endif\n\n    if (fragmentDepth > 0.0) {\n        cameraNormal = normalize(cameraPos - cameraSpherePos);\n        interior = false;\n        return true;\n    } else if (uDoubleSided || solidInterior) {\n        cameraPos = rayDirection * posT + rayOrigin;\n        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n        fragmentDepth = calcDepth(cameraPos);\n        cameraNormal = -normalize(cameraPos - cameraSpherePos);\n        interior = true;\n        if (fragmentDepth > 0.0) {\n            #ifdef dSolidInterior\n                if (!objectClipped) {\n                    fragmentDepth = 0.0 + (0.0000001 / vRadius);\n                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n                }\n            #endif\n            return true;\n        }\n    }\n\n    return false;\n}\n\nvoid main(void){\n    vec3 cameraNormal;\n    float fragmentDepth;\n\n    #ifdef dApproximate\n        vec3 pointDir = -vPointViewPosition - vPoint;\n        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;\n        vec3 vViewPosition = -vPointViewPosition;\n        fragmentDepth = gl_FragCoord.z;\n        #if !defined(dIgnoreLight) || defined(dXrayShaded)\n            pointDir.z -= cos(length(pointDir) / vRadius);\n            cameraNormal = -normalize(pointDir / vRadius);\n        #endif\n        interior = false;\n    #else\n        vec3 modelPos;\n        vec3 cameraPos;\n        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);\n        if (!hit) discard;\n\n        if (fragmentDepth < 0.0) discard;\n        if (fragmentDepth > 1.0) discard;\n\n        gl_FragDepthEXT = fragmentDepth;\n\n        vec3 vModelPosition = modelPos;\n        vec3 vViewPosition = cameraPos;\n    #endif\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        #include clip_pixel\n    #endif\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        vec3 normal = -cameraNormal;\n        #include apply_light_color\n\n        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {\n            gl_FragColor.a *= min(1.0, vRadius / uAlphaThickness);\n        }\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},FS),cVe=Un("cylinders","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec3 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\nattribute float aScale;\nattribute float aCap;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform float uIsOrtho;\nuniform vec3 uCameraDir;\n\nvoid main() {\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelTransform = uModel * aTransform;\n\n    vTransform = aTransform;\n    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;\n    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;\n    vSize = size * aScale;\n    vCap = aCap;\n\n    vModelPosition = (vStart + vEnd) * 0.5;\n    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 dir = vEnd - vStart;\n    // ensure cylinder 'dir' is pointing towards the camera\n    if(dot(camDir, dir) < 0.0) {\n        dir = -dir;\n    }\n\n    vec3 left = cross(camDir, dir);\n    vec3 up = cross(left, dir);\n    left = vSize * normalize(left);\n    up = vSize * normalize(up);\n\n    // move vertex in object-space from center to corner\n    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;\n\n    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);\n    vViewPosition = mvPosition.xyz;\n    gl_Position = uProjection * mvPosition;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping\n        gl_Position.z = (uProjection * mvPosition).z;\n    }\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\nuniform mat4 uView;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform vec3 uCameraDir;\nuniform vec3 uCameraPosition;\nuniform mat4 uInvView;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\n// adapted from https://www.shadertoy.com/view/4lcSRn\n// The MIT License, Copyright 2016 Inigo Quilez\nbool CylinderImpostor(\n    in vec3 rayOrigin, in vec3 rayDir,\n    in vec3 start, in vec3 end, in float radius,\n    out vec3 cameraNormal, out bool interior,\n    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth\n){\n    vec3 ba = end - start;\n    vec3 oc = rayOrigin - start;\n\n    float baba = dot(ba, ba);\n    float bard = dot(ba, rayDir);\n    float baoc = dot(ba, oc);\n\n    float k2 = baba - bard * bard;\n    float k1 = baba * dot(oc, rayDir) - baoc * bard;\n    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;\n\n    float h = k1 * k1 - k2 * k0;\n    if (h < 0.0) return false;\n\n    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;\n    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;\n\n    #ifdef dSolidInterior\n        bool topInterior = !topCap;\n        bool bottomInterior = !bottomCap;\n        topCap = true;\n        bottomCap = true;\n    #else\n        bool topInterior = false;\n        bool bottomInterior = false;\n    #endif\n\n    bool clipped = false;\n    bool objectClipped = false;\n\n    // body outside\n    h = sqrt(h);\n    float t = (-k1 - h) / k2;\n    float y = baoc + t * bard;\n    if (y > 0.0 && y < baba) {\n        interior = false;\n        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;\n        modelPosition = rayOrigin + t * rayDir;\n        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n        fragmentDepth = calcDepth(viewPosition);\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            if (clipTest(vec4(modelPosition, 0.0))) {\n                objectClipped = true;\n                fragmentDepth = -1.0;\n                #ifdef dSolidInterior\n                    topCap = !topInterior;\n                    bottomCap = !bottomInterior;\n                #endif\n            }\n        #endif\n        if (fragmentDepth > 0.0) return true;\n        clipped = true;\n    }\n\n    if (!clipped) {\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = topInterior;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = bottomInterior;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    if (uDoubleSided || solidInterior) {\n        // body inside\n        h = -h;\n        t = (-k1 - h) / k2;\n        y = baoc + t * bard;\n        if (y > 0.0 && y < baba) {\n            interior = true;\n            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;\n            modelPosition = rayOrigin + t * rayDir;\n            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n            fragmentDepth = calcDepth(viewPosition);\n            if (fragmentDepth > 0.0) {\n                #ifdef dSolidInterior\n                    if (!objectClipped) {\n                        fragmentDepth = 0.0 + (0.0000002 / vSize);\n                        cameraNormal = -rayDir;\n                    }\n                #endif\n                return true;\n            }\n        }\n\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    return false;\n}\n\nvoid main() {\n    vec3 rayOrigin = vModelPosition;\n    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n\n    vec3 cameraNormal;\n    vec3 modelPosition;\n    vec3 viewPosition;\n    float fragmentDepth;\n    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);\n    if (!hit) discard;\n\n    if (fragmentDepth < 0.0) discard;\n    if (fragmentDepth > 1.0) discard;\n\n    gl_FragDepthEXT = fragmentDepth;\n\n    vec3 vViewPosition = viewPosition;\n    vec3 vModelPosition = modelPosition;\n\n    #include clip_pixel\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        mat3 normalMatrix = transpose3(inverse3(mat3(uView)));\n        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},FS),lVe=Un("text","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute float aDepth;\nattribute vec2 aTexCoord;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nuniform float uOffsetX;\nuniform float uOffsetY;\nuniform float uOffsetZ;\n\nuniform float uIsOrtho;\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nvarying vec2 vTexCoord;\n\n#include matrix_scale\n\nvoid main(void){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vTexCoord = aTexCoord;\n\n    float scale = matrixScale(uModelView);\n\n    float offsetX = uOffsetX * scale;\n    float offsetY = uOffsetY * scale;\n    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;\n\n    vec4 position4 = vec4(aPosition, 1.0);\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // TODO\n    // #ifdef FIXED_SIZE\n    //     if (ortho) {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;\n    //     } else {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;\n    //     }\n    // #endif\n\n    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n\n    if (vTexCoord.x == 10.0) { // indicates background plane\n        // move a bit to the back, taking distance to camera into account to avoid z-fighting\n        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);\n    }\n\n    mvCorner.xy += aMapping * size * scale;\n    mvCorner.x += offsetX;\n    mvCorner.y += offsetY;\n\n    if (uIsOrtho == 1.0) {\n        mvCorner.z += offsetZ;\n    } else {\n        mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n    }\n\n    gl_Position = uProjection * mvCorner;\n\n    vViewPosition = -mvCorner.xyz;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nuniform sampler2D tFont;\n\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform vec3 uBackgroundColor;\nuniform float uBackgroundOpacity;\n\nvarying vec2 vTexCoord;\n\nconst float smoothness = 32.0;\nconst float gamma = 2.2;\n\nvoid main2(){\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid main(){\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    if (vTexCoord.x > 1.0) {\n        #if defined(dRenderVariant_color)\n            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);\n        #endif\n    } else {\n        // retrieve signed distance\n        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;\n\n        // perform adaptive anti-aliasing of the edges\n        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);\n        float a = smoothstep(0.5 - w, 0.5 + w, sdf);\n\n        // gamma correction for linear attenuation\n        a = pow(a, 1.0 / gamma);\n\n        if (a < 0.5) discard;\n\n        #if defined(dRenderVariant_color)\n            material.a *= a;\n\n            // add border\n            float t = 0.5 + uBorderWidth;\n            if (uBorderWidth > 0.0 && sdf < t) {\n                material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));\n            }\n        #endif\n    }\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ID),dVe=Un("lines","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec2 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n    // trim end segment so it terminates between the camera plane and the near plane\n    // conservative estimate of the near plane\n    float a = uProjection[2][2];  // 3rd entry in 3rd column\n    float b = uProjection[3][2];  // 3rd entry in 4th column\n    float nearEstimate = -0.5 * b / a;\n    float alpha = (nearEstimate - start.z) / (end.z - start.z);\n    end.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main(){\n    float aspect = uViewport.z / uViewport.w;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelView = uView * uModel * aTransform;\n\n    // camera space\n    vec4 start = modelView * vec4(aStart, 1.0);\n    vec4 end = modelView * vec4(aEnd, 1.0);\n\n    // assign position\n    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);\n    vec4 mvPosition = modelView * position4;\n    vViewPosition = mvPosition.xyz;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n    // perhaps there is a more elegant solution -- WestLangley\n    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column\n    if (perspective) {\n        if (start.z < 0.0 && end.z >= 0.0) {\n            trimSegment(start, end);\n        } else if (end.z < 0.0 && start.z >= 0.0) {\n            trimSegment(end, start);\n        }\n    }\n\n    // clip space\n    vec4 clipStart = uProjection * start;\n    vec4 clipEnd = uProjection * end;\n\n    // ndc space\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n    // direction\n    vec2 dir = ndcEnd - ndcStart;\n\n    // account for clip-space aspect ratio\n    dir.x *= aspect;\n    dir = normalize(dir);\n\n    // perpendicular to dir\n    vec2 offset = vec2(dir.y, - dir.x);\n\n    // undo aspect ratio adjustment\n    dir.x /= aspect;\n    offset.x /= aspect;\n\n    // sign flip\n    if (aMapping.x < 0.0) offset *= -1.0;\n\n    // calculate linewidth\n    float linewidth;\n    #ifdef dLineSizeAttenuation\n        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;\n    #else\n        linewidth = size * uPixelRatio;\n    #endif\n    linewidth = max(1.0, linewidth);\n\n    // adjust for linewidth\n    offset *= linewidth;\n\n    // adjust for clip-space to screen-space conversion\n    offset /= uViewport.w;\n\n    // select end\n    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;\n\n    // back to clip space\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position = clip;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nvoid main(){\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ID),YJ=Un("mesh","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include common_clip\n#include texture3d_from_2d_linear\n\n#ifdef dGeometryType_textureMesh\n    uniform vec2 uGeoTexDim;\n    uniform sampler2D tPosition;\n    uniform sampler2D tGroup;\n    uniform sampler2D tNormal;\n#else\n    attribute vec3 aPosition;\n    attribute float aGroup;\n    attribute vec3 aNormal;\n#endif\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec3 vNormal;\n\nvoid main(){\n    #include assign_group\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_color_varying\n    #include clip_instance\n\n    #ifdef dGeometryType_textureMesh\n        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;\n    #else\n        vec3 normal = aNormal;\n    #endif\n    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));\n    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));\n    #if defined(dFlipSided)\n        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR\n            transformedNormal = -transformedNormal;\n        }\n    #endif\n    vNormal = transformedNormal;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include normal_frag_params\n#include common_clip\n\nvoid main() {\n    #include clip_pixel\n\n    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)\n    vec3 fdx = dFdx(vViewPosition);\n    vec3 fdy = dFdy(vViewPosition);\n    vec3 faceNormal = normalize(cross(fdx,fdy));\n    bool frontFacing = dot(vNormal, faceNormal) > 0.0;\n\n    #if defined(dFlipSided)\n        interior = frontFacing;\n    #else\n        interior = !frontFacing;\n    #endif\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        #if defined(dFlatShaded)\n            vec3 normal = -faceNormal;\n        #else\n            vec3 normal = -normalize(vNormal);\n            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;\n        #endif\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},FS),fVe=Un("direct-volume","\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform mat4 uModelView;\nuniform mat4 uProjection;\nuniform vec4 uInvariantBoundingSphere;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform mat4 uTransform;\n\nuniform mat4 uUnitToCartn;\n\nvoid main() {\n    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);\n    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;\n\n    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;\n    vInstance = aInstance;\n    vBoundingSphere = vec4(\n        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,\n        uInvariantBoundingSphere.w\n    );\n    vTransform = aTransform;\n\n    gl_Position = uProjection * mvPosition;\n\n    // move z position to near clip plane (but not too close to get precision issues)\n    gl_Position.z = gl_Position.w - 0.01;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include light_frag_params\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n#endif\n#include common_clip\n\n#include read_from_texture\n#include texture3d_from_1d_trilinear\n#include texture3d_from_2d_nearest\n#include texture3d_from_2d_linear\n\nuniform mat4 uProjection, uTransform, uModelView, uModel, uView;\nuniform vec3 uCameraDir;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform mat4 uInvView;\nuniform vec3 uGridDim;\nuniform vec3 uBboxSize;\nuniform sampler2D tTransferTex;\nuniform float uTransferScale;\nuniform float uStepScale;\nuniform float uJumpLength;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n#endif\n\nuniform float uMetalness;\nuniform float uRoughness;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform bool uTransparentBackground;\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform int uRenderMask;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform vec3 uCellDim;\nuniform vec3 uCameraPosition;\nuniform mat4 uCartnToUnit;\n\n#if __VERSION__ != 100\n    // for webgl1 this is given as a 'define'\n    uniform int uMaxSteps;\n#endif\n\n#if defined(dGridTexType_2d)\n    precision highp sampler2D;\n    uniform sampler2D tGridTex;\n    uniform vec3 uGridTexDim;\n#elif defined(dGridTexType_3d)\n    precision highp sampler3D;\n    uniform sampler3D tGridTex;\n#endif\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_texture)\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#endif\n\n#ifdef dOverpaint\n    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n        uniform vec2 uOverpaintTexDim;\n        uniform sampler2D tOverpaint;\n    #endif\n#endif\n\n#ifdef dUsePalette\n    uniform sampler2D tPalette;\n#endif\n\n#if defined(dGridTexType_2d)\n    vec4 textureVal(vec3 pos) {\n        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n#elif defined(dGridTexType_3d)\n    vec4 textureVal(vec3 pos) {\n        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);\n    }\n#endif\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat transferFunction(float value) {\n    return texture2D(tTransferTex, vec2(value, 0.0)).a;\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nconst float gradOffset = 0.5;\n\nvec3 v3m4(vec3 p, mat4 m) {\n    return (m * vec4(p, 1.0)).xyz;\n}\n\nfloat preFogAlphaBlended = 0.0;\n\nvec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {\n    mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));\n    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);\n    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n        mat4 modelTransform = uModel * vTransform * uTransform;\n    #endif\n    mat4 modelViewTransform = uModelView * vTransform * uTransform;\n\n    vec3 scaleVol = vec3(1.0) / uGridDim;\n    vec3 pos = startLoc;\n    vec4 cell;\n    float prevValue = -1.0;\n    float value = 0.0;\n    vec4 src = vec4(0.0);\n    vec4 dst = vec4(0.0);\n    float fragmentDepth;\n\n    vec3 posMin = vec3(0.0);\n    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;\n\n    vec3 unitPos;\n\n    vec3 nextPos;\n    float nextValue;\n\n    vec4 material;\n    vec4 overpaint;\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n\n    vec3 gradient = vec3(1.0);\n    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);\n    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);\n    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);\n\n    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);\n    float maxDistSq = maxDist * maxDist;\n\n    for (int i = 0; i < uMaxSteps; ++i) {\n        // break when beyond bounding-sphere or far-plane\n        vec3 distVec = startLoc - pos;\n        if (dot(distVec, distVec) > maxDistSq) break;\n\n        unitPos = v3m4(pos, cartnToUnit);\n\n        // continue when outside of grid\n        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||\n            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z\n        ) {\n            prevValue = value;\n            pos += step;\n            continue;\n        }\n\n        cell = textureVal(unitPos);\n        value = cell.a; // current voxel value\n\n        if (uJumpLength > 0.0 && value < 0.01) {\n            nextPos = pos + rayDir * uJumpLength;\n            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;\n            if (nextValue < 0.01) {\n                prevValue = nextValue;\n                pos = nextPos;\n                continue;\n            }\n        }\n\n        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);\n        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))\n            break;\n\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);\n            if (clipTest(vec4(vModelPosition, 0.0))) {\n                prevValue = value;\n                pos += step;\n                continue;\n            }\n        #endif\n\n        vec3 vViewPosition = mvPosition.xyz;\n        material.a = transferFunction(value);\n\n        #ifdef dPackedGroup\n            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);\n        #else\n            vec3 g = floor(unitPos * uGridDim + 0.5);\n            // note that we swap x and z because the texture is flipped around y\n            #if defined(dAxisOrder_012)\n                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210\n            #elif defined(dAxisOrder_021)\n                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120\n            #elif defined(dAxisOrder_102)\n                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201\n            #elif defined(dAxisOrder_120)\n                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021\n            #elif defined(dAxisOrder_201)\n                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102\n            #elif defined(dAxisOrder_210)\n                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012\n            #endif\n        #endif\n\n        #if defined(dColorType_direct) && defined(dUsePalette)\n            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;\n        #elif defined(dColorType_uniform)\n            material.rgb = uColor;\n        #elif defined(dColorType_instance)\n            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;\n        #elif defined(dColorType_group)\n            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #elif defined(dColorType_groupInstance)\n            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #elif defined(dColorType_vertex)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;\n        #elif defined(dColorType_vertexInstance)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;\n        #endif\n\n        #ifdef dOverpaint\n            #if defined(dOverpaintType_groupInstance)\n                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);\n            #elif defined(dOverpaintType_vertexInstance)\n                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));\n            #endif\n\n            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);\n        #endif\n\n        #ifdef dIgnoreLight\n            gl_FragColor.rgb = material.rgb;\n        #else\n            if (material.a >= 0.01) {\n                #ifdef dPackedGroup\n                    // compute gradient by central differences\n                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;\n                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;\n                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;\n                #else\n                    gradient = cell.xyz * 2.0 - 1.0;\n                #endif\n                vec3 normal = -normalize(normalMatrix * normalize(gradient));\n                #include apply_light_color\n            } else {\n                gl_FragColor.rgb = material.rgb;\n            }\n        #endif\n\n        gl_FragColor.a = material.a * uAlpha * uTransferScale;\n\n        #if defined(dColorMarker)\n            float marker = uMarker;\n            if (uMarker == -1.0) {\n                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n            }\n        #endif\n        #include apply_marker_color\n\n        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;\n        fragmentDepth = calcDepth(mvPosition.xyz);\n        #include apply_fog\n\n        src = gl_FragColor;\n\n        if (!uTransparentBackground) {\n            // done in 'apply_fog' otherwise\n            src.rgb *= src.a;\n        }\n        dst = (1.0 - dst.a) * src + dst; // standard blending\n\n        // break if the color is opaque enough\n        if (dst.a > 0.95)\n            break;\n\n        pos += step;\n    }\n\n    return dst;\n}\n\n// TODO: support float texture for higher precision values???\n// TODO: support clipping exclusion texture support\n\nvoid main() {\n    if (gl_FrontFacing)\n        discard;\n\n    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 step = rayDir * uStepScale;\n\n    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;\n    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);\n    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);\n    gl_FragColor = raymarch(start, step, rayDir);\n\n    float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);\n    float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);\n    #include wboit_write\n}\n",{fragDepth:"optional",drawBuffers:"optional"},{},FS),pVe=Un("image","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_vert_params\n\nattribute vec3 aPosition;\nattribute vec2 aUv;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\nvoid main() {\n    #include assign_position\n\n    vUv = aUv;\n    vInstance = aInstance;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_frag_params\n#include common_clip\n\nuniform vec2 uImageTexDim;\nuniform sampler2D tImageTex;\nuniform sampler2D tGroupTex;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\n#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)\n    #define dInterpolation_cubic\n#endif\n\n#if defined(dInterpolation_cubic)\n    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)\n        #if defined(dInterpolation_catmulrom)\n            const float B = 0.0;\n            const float C = 0.5;\n        #elif defined(dInterpolation_mitchell)\n            const float B = 0.333;\n            const float C = 0.333;\n        #endif\n\n        float cubicFilter(float x){\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f < 1.0) {\n                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +\n                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +\n                    (6.0 - 2.0 * B)) / 6.0;\n            }else if (f >= 1.0 && f < 2.0){\n                return ((-B - 6.0 * C) * ( f * f * f)\n                    + (6.0 * B + 30.0 * C) * (f * f) +\n                    (-(12.0 * B) - 48.0 * C) * f +\n                    8.0 * B + 24.0 * C) / 6.0;\n            }else{\n                return 0.0;\n            }\n        }\n    #elif defined(dInterpolation_bspline)\n        float cubicFilter(float x) {\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f >= 0.0 && f <= 1.0){\n                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);\n            } else if (f > 1.0 && f <= 2.0) {\n                return 1.0 / 6.0 * pow((2.0 - f), 3.0);\n            }\n            return 1.0;\n        }\n    #endif\n\n    vec4 biCubic(sampler2D tex, vec2 texCoord) {\n        vec2 texelSize = 1.0 / uImageTexDim;\n        texCoord -= texelSize / 2.0;\n        vec4 nSum = vec4(0.0);\n        float nDenom = 0.0;\n        vec2 cell = fract(texCoord * uImageTexDim);\n        for (float m = -1.0; m <= 2.0; ++m) {\n            for (float n = -1.0; n <= 2.0; ++n) {\n                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));\n                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);\n                nSum += vecData * c;\n                nDenom += c;\n            }\n        }\n        return nSum / nDenom;\n    }\n#endif\n\nvoid main() {\n    #include clip_pixel\n\n    #if defined(dInterpolation_cubic)\n        vec4 imageData = biCubic(tImageTex, vUv);\n    #else\n        vec4 imageData = texture2D(tImageTex, vUv);\n    #endif\n    imageData.a = clamp(imageData.a, 0.0, 1.0);\n    if (imageData.a > 0.9) imageData.a = 1.0;\n\n    float fragmentDepth = gl_FragCoord.z;\n\n    #if defined(dRenderVariant_pick)\n        if (imageData.a < 0.3)\n            discard;\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);\n            gl_FragData[2] = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            gl_FragData[3] = packDepthToRGBA(gl_FragCoord.z);\n        #else\n            gl_FragColor = vColor;\n            if (uPickType == 1) {\n                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            } else if (uPickType == 2) {\n                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);\n            } else {\n                gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            }\n        #endif\n    #elif defined(dRenderVariant_depth)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #elif defined(dRenderVariant_marking)\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n        if (uMarkingType == 1) {\n            if (marker > 0.0 || imageData.a < 0.05)\n                discard;\n            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n        } else {\n            if (marker == 0.0 || imageData.a < 0.05)\n                discard;\n            float depthTest = 1.0;\n            if (uMarkingDepthTest) {\n                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n            }\n            bool isHighlight = intMod(marker, 2.0) > 0.1;\n            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);\n        }\n    #elif defined(dRenderVariant_color)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = imageData;\n        gl_FragColor.a *= uAlpha;\n\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ID);function XJ(e,t){var r;if(void 0===e)return"";var n=(null===(r=e.dRenderVariant)||void 0===r?void 0:r.ref.value)||"",a=[];for(var i in e)if(!t?.(i,n,e)){var s=e[i].ref.value;void 0!==s&&("string"==typeof s?a.push("#define ".concat(i,"_").concat(s)):"number"==typeof s?a.push("#define ".concat(i," ").concat(s)):"boolean"==typeof s?s&&a.push("#define ".concat(i)):xn())}return a.join("\n")+"\n"}var vVe="\n#define attribute in\n#define varying out\n#define texture2D texture\n",gVe="\n#define varying in\n#define texture2D texture\n#define textureCube texture\n#define texture2DLodEXT textureLod\n#define textureCubeLodEXT textureLod\n\n#define gl_FragColor out_FragData0\n#define gl_FragDepthEXT gl_FragDepth\n\n#define depthTextureSupport\n";function CVe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"iv2":case"iv2[]":return e.INT_VEC2;case"iv3":case"iv3[]":return e.INT_VEC3;case"iv4":case"iv4[]":return e.INT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '".concat(t,"'"))}}function wVe(e,t,r){e.uniform1f(t,r)}function AVe(e,t,r){e.uniform1fv(t,r)}function TVe(e,t,r){e.uniform1i(t,r)}function DVe(e,t,r){e.uniform1iv(t,r)}function EVe(e,t,r){e.uniform2fv(t,r)}function IVe(e,t,r){e.uniform3fv(t,r)}function PVe(e,t,r){e.uniform4fv(t,r)}function MVe(e,t,r){e.uniform2iv(t,r)}function RVe(e,t,r){e.uniform3iv(t,r)}function OVe(e,t,r){e.uniform4iv(t,r)}function FVe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function NVe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function KJ(e){switch(e){case"f":return wVe;case"f[]":return AVe;case"i":case"t":case"b":return TVe;case"i[]":case"t[]":case"b[]":return DVe;case"v2":case"v2[]":return EVe;case"v3":case"v3[]":return IVe;case"v4":case"v4[]":return PVe;case"iv2":case"iv2[]":return MVe;case"iv3":case"iv3[]":return RVe;case"iv4":case"iv4[]":return OVe;case"m3":case"m3[]":return FVe;case"m4":case"m4[]":return NVe}}var LVe=ms();function ZJ(e){var t=e.createBuffer();if(null===t)throw new Error("Could not create WebGL buffer");return t}function QJ(e,t,r,n){var a=ZJ(e),i=function UVe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}(e,r),o=function zVe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":if($t(e))return e.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers")}}(e,n),s=function VVe(e,t){return t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int8Array?e.BYTE:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int16Array?e.SHORT:t instanceof Uint32Array?e.UNSIGNED_INT:t instanceof Int32Array?e.INT:t instanceof Float32Array?e.FLOAT:void xn()}(e,t),u=t.BYTES_PER_ELEMENT,c=t.length;function l(f){e.bindBuffer(o,a),e.bufferData(o,f,i)}l(t);var d=!1;return{id:LVe(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:c,getBuffer:function(){return a},updateData:l,updateSubData:function(f,p,h){e.bindBuffer(o,a),h-p===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,p*u,f.subarray(p,p+h))},reset:function(){a=ZJ(e),l(t)},destroy:function(){d||(e.deleteBuffer(a),d=!0)}}}function GVe(e,t,r){if("float32"===t)switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}xn()}var WVe=ms();function Jk(e){var t=e.createProgram();if(null===t)throw new Error("Could not create WebGL program");return t}function QVe(e,t,r,n,a){var p,h,i=a.defineValues,o=a.shaderCode,s=a.schema,u=Jk(e),c=WVe(),l=function SVe(e,t,r,n){var a=XJ(r,n.ignoreDefine),i=XJ(r,n.ignoreDefine),o=$t(e)?function yVe(e,t){var r=["#version 300 es"];if(t.drawBuffers&&e.drawBuffers&&r.push("#define requiredDrawBuffers"),t.clipCullDistance)if(e.clipCullDistance)r.push("#extension GL_ANGLE_clip_cull_distance : enable"),r.push("#define enabledClipCullDistance");else if("required"===t.clipCullDistance)throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available");if(t.conservativeDepth)if(e.conservativeDepth)r.push("#extension GL_EXT_conservative_depth : enable"),r.push("#define enabledConservativeDepth");else if("required"===t.conservativeDepth)throw new Error("required 'GL_EXT_conservative_depth' extension not available");return e.noNonInstancedActiveAttribs&&r.push("#define noNonInstancedActiveAttribs"),r.push(vVe),r.join("\n")+"\n"}(t,n.extensions):function hVe(e,t){var r=[];if(t.drawBuffers)if(e.drawBuffers)r.push("#define requiredDrawBuffers");else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");return r.join("\n")+"\n"}(t,n.extensions),s=$t(e)?function bVe(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp ".concat(n[0]||"vec4"," out_FragData0;")];if(r.fragDepth&&t.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers&&t.drawBuffers){a.push("#define requiredDrawBuffers");for(var o=1,s=e.getParameter(e.MAX_DRAW_BUFFERS);o<s;++o)a.push("layout(location = ".concat(o,") out highp ").concat(n[o]||"vec4"," out_FragData").concat(o,";"))}return r.shaderTextureLod&&t.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push(gVe),a.join("\n")+"\n"}(e,t,n.extensions,n.outTypes):function mVe(e,t){var r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth)if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if("required"===t.fragDepth)throw new Error("required 'GL_EXT_frag_depth' extension not available");if(t.drawBuffers)if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");if(t.shaderTextureLod)if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if("required"===t.shaderTextureLod)throw new Error("required 'GL_EXT_shader_texture_lod' extension not available");return e.depthTexture&&r.push("#define depthTextureSupport"),r.join("\n")+"\n"}(t,n.extensions),u=$t(e)?function _Ve(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}(n.frag):n.frag;return{id:jJ(),name:n.name,vert:"".concat(o).concat(a).concat(WJ(n.vert,r)),frag:"".concat(s).concat(i).concat(WJ(u,r)),extensions:n.extensions,outTypes:n.outTypes}}(e,r,i,o),d=n("vert",l.vert),f=n("frag",l.frag);function m(){d.attach(u),f.attach(u),e.linkProgram(u),xr&&function ZVe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error("Could not compile WebGL program. \n\n".concat(e.getProgramInfoLog(t)))}(e,u),p=function YVe(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if("attribute"===i.type){var o=e.getAttribLocation(t,a);n[a]=o}else"uniform"===i.type?(null===(o=e.getUniformLocation(t,a))&&function xVe(e){return e.endsWith("[]")}(i.kind)&&(o=e.getUniformLocation(t,a+"[0]")),n[a]=o):"texture"===i.type&&(o=e.getUniformLocation(t,a),n[a]=o)}),n}(e,u,s),h=function kVe(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];"uniform"===n.type?t[r]=KJ(n.kind):"texture"===n.type&&(t[r]=KJ("t"))}),t}(s),xr&&(function XVe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||"gl_InstanceID"===o||"gl_VertexID"===o)continue;var u=r[o];if(void 0===u)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if("attribute"!==u.type)throw new Error("'".concat(o,"' must be of type 'attribute' but is '").concat(u.type,"'"));var c=GVe(e,u.kind,u.itemSize);if(c!==s)throw new Error("unexpected attribute type '".concat(c,"' for ").concat(o,", expected '").concat(s,"'"))}}}(e,u,s),function KVe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var c=r[o.replace(/[[0-9]+\]$/,"")];if(void 0===c)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if("uniform"===c.type){if(CVe(e,c.kind)!==s)throw new Error("unexpected uniform type for ".concat(o))}else{if("texture"!==c.type)throw new Error("'".concat(o,"' must be of type 'uniform' or 'texture' but is '").concat(c.type,"'"));if("image-float32"===c.kind||"image-uint8"===c.kind){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '".concat(o,"'"))}else if("volume-float32"===c.kind||"volume-uint8"===c.kind){if(!$t(e))throw new Error("WebGL2 is required to use SAMPLER_3D");if(s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '".concat(o,"'"))}}}}}(e,u,s))}m();var v=!1;return{id:c,use:function(){t.currentProgramId=c,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var _=g[y],C=_[0],x=_[1];if(x){var A=p[C];null!==A&&h[C](e,A,x.ref.value)}}},bindAttributes:function(g){t.clearVertexAttribsState();for(var y=0,b=g.length;y<b;++y){var _=g[y],A=p[_[0]];-1!==A&&_[1].bind(A)}t.disableUnusedVertexAttribs()},bindTextures:function(g,y){for(var b=0,_=g.length;b<_;++b){var C=g[b],x=C[0],T=p[x];null!=T&&(C[1].bind(b+y),h[x](e,T,b+y))}},reset:function(){u=Jk(e),m()},destroy:function(){v||(d.destroy(),f.destroy(),e.deleteProgram(u),v=!0)}}}var $Ve=ms();function MD(e,t){var r=t.type,n=t.source,a=e.createShader("vert"===r?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(null===a)throw new Error("Error creating ".concat(r," shader"));if(e.shaderSource(a,n),e.compileShader(a),xr&&!1===e.getShaderParameter(a,e.COMPILE_STATUS))throw console.warn("'".concat(r,"' shader info log '").concat(e.getShaderInfoLog(a),"'\n").concat(function JVe(e){for(var t=e.split("\n"),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join("\n")}(n))),new Error("Error compiling ".concat(r," shader"));return a}function $J(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=function t8e(e,t){return void 0===t&&(t=0),{value:e,usageCount:t}}(t(a)),n.set(i,o)),o.usageCount+=1,function r8e(e){return{free:function(){e.usageCount-=1},value:e.value}}(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var n8e=ms();function JJ(e){var t=e.createRenderbuffer();if(null===t)throw new Error("Could not create WebGL renderbuffer");return t}var s8e=ms();function eee(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function tee(e){var t=e.vertexArrayObject;if(null===t)throw new Error("VertexArrayObject not supported");return t}function ree(e){return R(R({},e.value),{destroy:function(){e.free()}})}function l8e(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function i(c,l){return a[c].add(l),r.resourceCounts[c]+=1,R(R({},l),{destroy:function(){l.destroy(),a[c].delete(l),r.resourceCounts[c]-=1}})}var o=$J(function(c){return JSON.stringify(c)},function(c){return i("shader",function e8e(e,t){var r=MD(e,t);return{id:$Ve(),attach:function(n){e.attachShader(n,r)},reset:function(){r=MD(e,t)},destroy:function(){e.deleteShader(r)}}}(e,c))},function(c){c.destroy()});function s(c,l){return ree(o.get({type:c,source:l}))}var u=$J(function(c){var l,d=[c.shaderCode.id],f=(null===(l=c.defineValues.dRenderVariant)||void 0===l?void 0:l.ref.value)||"";return Object.keys(c.defineValues).forEach(function(p){var h,m;null!==(m=(h=c.shaderCode).ignoreDefine)&&void 0!==m&&m.call(h,p,f,c.defineValues)||d.push(oN(p),function c8e(e){return"boolean"==typeof e?e?1:0:"number"==typeof e?1e4*e:oN(e)}(c.defineValues[p].ref.value))}),vs(d).toString()},function(c){return i("program",QVe(e,t,n,s,c))},function(c){c.destroy()});return{attribute:function(c,l,d,f){return i("attribute",function HVe(e,t,r,n,a,i,o){void 0===o&&(o="dynamic");var s=r.instancedArrays,u=QJ(e,n,o,"attribute"),c=u._bufferType,l=u._dataType,d=u._bpe;return R(R({},u),{bind:function(f){if(e.bindBuffer(c,u.getBuffer()),16===a)for(var p=0;p<4;++p)t.enableVertexAttrib(f+p),e.vertexAttribPointer(f+p,4,l,!1,16*d,4*p*d),s.vertexAttribDivisor(f+p,i);else t.enableVertexAttrib(f),e.vertexAttribPointer(f,a,l,!1,0,0),s.vertexAttribDivisor(f,i)}})}(e,t,n,c,l,d,f))},elements:function(c,l){return i("elements",function qVe(e,t,r){void 0===r&&(r="static");var n=QJ(e,t,r,"elements");return R(R({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}(e,c,l))},framebuffer:function(){return i("framebuffer",function tUe(e){var t=GJ(e),r=!1;return{id:zJ(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=GJ(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}(e))},program:function(c,l,d){return ree(u.get({defineValues:c,shaderCode:l,schema:d}))},renderbuffer:function(c,l,d,f){return i("renderbuffer",function o8e(e,t,r,n,a){var i=JJ(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=function a8e(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth24":if($t(e))return e.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if($t(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if($t(e))return e.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if($t(e))return e.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}(e,t),u=function i8e(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}(e,r);function c(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}c();var l=!1;return{id:n8e(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),xr&&ED(e)},detachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,null),xr&&ED(e)},setSize:function(d,f){n=d,a=f,c()},reset:function(){i=JJ(e),c()},destroy:function(){l||(e.deleteRenderbuffer(i),l=!0)}}}(e,c,l,d,f))},shader:s,texture:function(c,l,d,f){return i("texture",function ize(e,t,r,n,a,i){var o=tB(),s=bee(e);if(r.endsWith("float32")&&"float"!==a||r.endsWith("float16")&&"fp16"!==a||r.endsWith("uint8")&&"ubyte"!==a||r.endsWith("int32")&&"int"!==a||r.endsWith("depth")&&"ushort"!==a&&"float"!==a)throw new Error("texture kind '".concat(r,"' and type '").concat(a,"' are incompatible"));if(!t.depthTexture&&"depth"===n)throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");var u=function J8e(e,t){switch(t){case"image-uint8":case"image-float32":case"image-float16":case"image-depth":return e.TEXTURE_2D}if($t(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":case"volume-float32":case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '".concat(t,"'"))}(e,r),c=vee(e,i),l=hee(e,n,a),d=function eze(e,t,r){if($t(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rg":switch(r){case"ubyte":return e.RG;case"float":return e.RG32F;case"fp16":return e.RG16F;case"int":return e.RG32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return hee(e,t,r)}(e,n,a),f=function nze(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if($t(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}(e,t,a);function p(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,c),e.texParameteri(u,e.TEXTURE_MIN_FILTER,c),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}p();var g,h=0,m=0,v=0,y=!1,b=!1;function _(T,w,E){if(0===T||0===w||$t(e)&&u===e.TEXTURE_3D&&0===E)throw new Error("empty textures are not allowed");if(h!==T||m!==w||v!==(E||0))if(h=T,m=w,v=E||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,h,m,0,l,f,null);else{if(!$t(e)||u!==e.TEXTURE_3D||void 0===v)throw new Error("unknown texture target");e.texImage3D(u,0,d,h,m,v,0,l,f,null)}}function C(T,w){if(void 0===w&&(w=!1),0===T.width||0===T.height||!gee(T)&&$t(e)&&yee(0,u,e)&&0===T.depth)throw new Error("empty textures are not allowed");if(e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),gee(T))h=T.width,m=T.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,l,f,T);else if(function aze(e,t,r){return t===r.TEXTURE_2D}(0,u,e)){var E=T.filter?vee(e,T.filter):c;e.texParameteri(u,e.TEXTURE_MAG_FILTER,E),e.texParameteri(u,e.TEXTURE_MIN_FILTER,E),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!T.flipY),w?e.texSubImage2D(u,0,0,0,T.width,T.height,l,f,T.array):e.texImage2D(u,0,d,h=T.width,m=T.height,0,l,f,T.array)}else{if(!$t(e)||!yee(0,u,e))throw new Error("unknown texture target");e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,T.width,T.height,T.depth,l,f,T.array):e.texImage3D(u,0,d,h=T.width,m=T.height,v=T.depth,0,l,f,T.array)}e.bindTexture(u,null),g=T}function x(){if(u!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(!($t(e)||v2(h)&&v2(m)))throw new Error("mipmap unsupported for non-power-of-two textures and webgl1");e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(u),e.bindTexture(u,null),y=!0}return _(1,1,$t(e)&&u===e.TEXTURE_3D?1:0),{id:o,target:u,format:l,internalFormat:d,type:f,filter:c,getWidth:function(){return h},getHeight:function(){return m},getDepth:function(){return v},getByteCount:function(){return mee(n,a,h,m,v)},define:_,load:C,mipmap:x,bind:function(T){e.activeTexture(e.TEXTURE0+T),e.bindTexture(u,s)},unbind:function(T){e.activeTexture(e.TEXTURE0+T),e.bindTexture(u,null)},attachFramebuffer:function A(T,w,E){if(T.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,OD(e,t,w),e.TEXTURE_2D,s,0);else{if(!$t(e)||u!==e.TEXTURE_3D)throw new Error("unknown/unsupported texture target");if(void 0===E)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,OD(e,t,w),s,0,E)}},detachFramebuffer:function(T,w){if(T.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,OD(e,t,w),e.TEXTURE_2D,null,0);else{if(!$t(e)||u!==e.TEXTURE_3D)throw new Error("unknown texture target");e.framebufferTextureLayer(e.FRAMEBUFFER,OD(e,t,w),null,0,0)}},reset:function(){s=bee(e),p();var T=[h,m,v];h=0,m=0,v=0,_(T[0],T[1],T[2]),g&&C(g),y&&x()},destroy:function(){b||(e.deleteTexture(s),b=!0)}}}(e,n,c,l,d,f))},cubeTexture:function(c,l,d){return i("cubeTexture",function sze(e,t,r,n){var a=e.TEXTURE_CUBE_MAP,i=e.LINEAR,o=e.RGBA,s=e.RGBA,u=e.UNSIGNED_BYTE,c=0,l=e.createTexture();e.bindTexture(a,l);var d=0;Ks(t,function(p,h){if(p){var v=function oze(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}(e,h),g=new Image;p instanceof File?g.src=URL.createObjectURL(p):WA(p)?p.then(function(y){g.src=URL.createObjectURL(y)}):g.src=p,g.addEventListener("load",function(){0===c&&(c=g.width),e.texImage2D(v,0,o,c,c,0,s,u,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(a,l),e.texImage2D(v,0,o,s,u,g),6===(d+=1)&&(f||(r?(e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(a)):e.texParameteri(a,e.TEXTURE_MIN_FILTER,i),e.texParameteri(a,e.TEXTURE_MAG_FILTER,i)),n?.(f))}),g.addEventListener("error",function(){n?.(!0)})}});var f=!1;return{id:tB(),target:a,format:s,internalFormat:o,type:u,filter:i,getWidth:function(){return c},getHeight:function(){return c},getDepth:function(){return 0},getByteCount:function(){return 6*mee("rgba","ubyte",c,c,0)*(r?2:1)},define:function(){},load:function(){},mipmap:function(){},bind:function(p){e.activeTexture(e.TEXTURE0+p),e.bindTexture(a,l)},unbind:function(p){e.activeTexture(e.TEXTURE0+p),e.bindTexture(a,null)},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){f||(e.deleteTexture(l),f=!0)}}}(e,c,l,d))},vertexArray:function(c,l,d){return i("vertexArray",function u8e(e,t,r,n,a){var i=s8e(),o=eee(t),s=tee(t);function u(){s.bindVertexArray(o),a&&a.bind(),r.bindAttributes(n),s.bindVertexArray(null)}u();var c=!1;return{id:i,bind:function(){s.bindVertexArray(o)},update:u,reset:function(){o=eee(t),s=tee(t),u()},destroy:function(){c||(a&&(s.bindVertexArray(o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(o),c=!0)}}}(e,n,c,l,d))},getByteCounts:function(){var c=0;a.texture.forEach(function(f){c+=f.getByteCount()}),a.cubeTexture.forEach(function(f){c+=f.getByteCount()});var l=0;a.attribute.forEach(function(f){l+=4*f.length});var d=0;return a.elements.forEach(function(f){d+=4*f.length}),{texture:c,attribute:l,elements:d}},reset:function(){a.attribute.forEach(function(c){return c.reset()}),a.elements.forEach(function(c){return c.reset()}),a.framebuffer.forEach(function(c){return c.reset()}),a.renderbuffer.forEach(function(c){return c.reset()}),a.shader.forEach(function(c){return c.reset()}),a.program.forEach(function(c){return c.reset()}),a.vertexArray.forEach(function(c){return c.reset()}),a.texture.forEach(function(c){return c.reset()})},destroy:function(){a.attribute.forEach(function(c){return c.destroy()}),a.elements.forEach(function(c){return c.destroy()}),a.framebuffer.forEach(function(c){return c.destroy()}),a.renderbuffer.forEach(function(c){return c.destroy()}),a.shader.forEach(function(c){return c.destroy()}),a.program.forEach(function(c){return c.destroy()}),a.vertexArray.forEach(function(c){return c.destroy()}),a.texture.forEach(function(c){return c.destroy()}),o.clear(),u.clear()}}}var nee=ms(),aee=function(){function e(t){this.count=t,this.avgs=new Map}return e.prototype.add=function(t,r){var n=this.avgs.get(t)||r;return n=function p8e(e,t,r){return(e-=e/r)+t/r}(n,r,this.count),this.avgs.set(t,n),n},e.prototype.get=function(t){return this.avgs.get(t)},e.prototype.stats=function(){return Object.fromEntries(this.avgs.entries())},e}();function iee(e){e.map(function(t){var r=function g8e(e){var t="".concat((e.gpuElapsed/1e3/1e3).toFixed(2)),r="".concat((e.gpuAvg/1e3/1e3).toFixed(2)),n="".concat(e.cpuElapsed.toFixed(2)),a="".concat(e.cpuAvg.toFixed(2));return"".concat(e.label," ").concat(t," ms (avg. ").concat(r," ms) | CPU: ").concat(n," ms (avg. ").concat(a," ms)")}(t);t.children.length||t.calls?(console.groupCollapsed(r),t.calls&&console.log(t.calls),iee(t.children),console.groupEnd()):console.log(r)})}function oee(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function see(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '".concat(oee(e,t),"'"))}function RD(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var uee=new Uint8Array(4);function cee(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):_2.setImmediate(cee,e,t,r)}function lee(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?_2.setImmediate(cee,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,uee),t())}var dee=!1;function fee(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,uee)}function eB(e,t,r,n,a,i){if(xr&&ED(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else{if(!(i instanceof Int32Array&&$t(e)))throw new Error("unsupported readPixels buffer type");e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i)}xr&&see(e)}function $t(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}var Z8e="\nattribute vec4 aPosition;\n\nvoid main() {\n    gl_Position = aPosition;\n}",Q8e="\nprecision mediump float;\nuniform vec4 uColor;\nuniform sampler2D uTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;\n}",$8e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function pee(e,t){var r=MD(e,{type:"vert",source:Z8e}),n=MD(e,{type:"frag",source:Q8e});if(!r||!n)return!1;var a=Jk(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return xr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,$8e,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),c=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,c);var l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return xr&&console.log("error creating framebuffer for '".concat(t,"'")),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,l),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,.1,.05,1]),e.drawArrays(e.TRIANGLES,0,6);var p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),0!==p[0]||p[1]<248||p[2]<248||p[3]<254)return xr&&console.log("not able to actually render to '".concat(t,"' texture")),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var h=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,h);var m=e.getError();if(m)return xr&&console.log("error reading float pixels: '".concat(oee(e,m),"'")),!1}return!0}var tB=ms();function hee(e,t,r){switch(t){case"alpha":return $t(e)&&"float"===r?e.RED:$t(e)&&"int"===r?e.RED_INTEGER:e.ALPHA;case"rgb":return $t(e)&&"int"===r?e.RGB_INTEGER:e.RGB;case"rg":if($t(e)&&"float"===r)return e.RG;if($t(e)&&"int"===r)return e.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return $t(e)&&"int"===r?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function mee(e,t,r,n,a){var i=function tze(e){switch(e){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":case"depth":return 4}}(e)*function rze(e){switch(e){case"ubyte":return 1;case"ushort":case"fp16":return 2;case"float":case"int":return 4}}(t);return i*r*n*(a||1)}function vee(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function OD(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function gee(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function yee(e,t,r){return t===r.TEXTURE_3D}function bee(e){var t=e.createTexture();if(null===t)throw new Error("Could not create WebGL texture");return t}function _ee(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if("texture"===o.type){var s=r[i];if(s)if("texture"===o.kind)a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function See(e,t,r){var n=new Image;n.onload=function(){r.load(n),O.update(t,r)},n.src=e}var Cee=-1;function Go(e){var t,r=null!==(t=e?.TEXTURE_2D)&&void 0!==t?t:3553;return{id:tB(),target:r,format:Cee,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},mipmap:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:function(){throw new Error("cannot detach null-texture from a framebuffer")},reset:function(){},destroy:function(){}}}function pc(e,t,r,n){var a=function cze(e,t,r,n){switch(r.granularity){case"uniform":return function fze(e,t,r){return function dze(e,t){return t?(O.update(t.uColor,dt.toVec3Normalized(t.uColor.ref.value,e)),O.updateIfChanged(t.dColorType,"uniform"),t):{uColor:O.create(dt.toVec3Normalized(S(),e)),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(Go()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ne.create(1,1)),uColorGridDim:O.create(S.create(1,1,1)),uColorGridTransform:O.create(fr.create(0,0,0,1)),dColorType:O.create("uniform"),dUsePalette:O.create(!1)}}(t(fc,!1),r)}(0,r.color,n);case"instance":return e.nonInstanceable?xee(e,r.color,n):function pze(e,t,r){var a=Ti(Math.max(1,e.instanceCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),u=i.instanceIndex;dt.toArray(t(i.location,i.isSecondary),a.array,3*u),e.skipInstance()}return NS(a,"instance",r)}(e,r.color,n);case"group":return xee(e,r.color,n);case"groupInstance":return function hze(e,t,r){var o=Ti(Math.max(1,e.instanceCount*e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),l=s.index;dt.toArray(t(s.location,s.isSecondary),o.array,3*l)}return NS(o,"groupInstance",r)}(e,r.color,n);case"vertex":return function mze(e,t,r){var a=e.stride,i=Ti(Math.max(1,e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),c=o.groupIndex,l=t(o.location,o.isSecondary),d=0;d<a;++d)dt.toArray(l,i.array,3*(c+d));return NS(i,"vertex",r)}(t,r.color,n);case"vertexInstance":return function vze(e,t,r){var i=e.stride,s=Ti(Math.max(1,e.instanceCount*e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),d=u.index,f=t(u.location,u.isSecondary),p=0;p<i;++p)dt.toArray(f,s.array,3*(d+p));return NS(s,"vertexInstance",r)}(t,r.color,n);case"volume":return wee(r.grid,"volume",n);case"volumeInstance":return wee(r.grid,"volumeInstance",n);case"direct":return function gze(e){return e?(O.updateIfChanged(e.dColorType,"direct"),e):{uColor:O.create(S()),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(Go()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ne.create(1,1)),uColorGridDim:O.create(S.create(1,1,1)),uColorGridTransform:O.create(fr.create(0,0,0,1)),dColorType:O.create("direct"),dUsePalette:O.create(!1)}}(n)}}(e,t,r,n);return r.palette?(O.updateIfChanged(a.dUsePalette,!0),function lze(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var c=dt.toRgb(s[o]),d=c[1],f=c[2];if(a[i++]!==c[0]||a[i++]!==d||a[i++]!==f){r=!1;break}}if(!r){for(var p=new Uint8Array(3*e.colors.length),h=0,m=0,v=e.colors;m<v.length;m++){var g=dt.toRgb(v[m]);d=g[1],f=g[2],p[h++]=g[0],p[h++]=d,p[h++]=f}O.update(t,{array:p,height:1,width:e.colors.length,filter:e.filter})}}(r.palette,a.tPalette)):O.updateIfChanged(a.dUsePalette,!1),a}function NS(e,t,r){return r?(O.update(r.tColor,e),O.update(r.uColorTexDim,Ne.create(e.width,e.height)),O.updateIfChanged(r.dColorType,t),r):{uColor:O.create(S()),tColor:O.create(e),tColorGrid:O.create(Go()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ne.create(e.width,e.height)),uColorGridDim:O.create(S.create(1,1,1)),uColorGridTransform:O.create(fr.create(0,0,0,1)),dColorType:O.create(t),dUsePalette:O.create(!1)}}function xee(e,t,r){var a=Ti(Math.max(1,e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),u=i.groupIndex;dt.toArray(t(i.location,i.isSecondary),a.array,3*u)}return NS(a,"group",r)}function wee(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(O.update(r.tColorGrid,n),O.update(r.uColorTexDim,Ne.create(o,s)),O.update(r.uColorGridDim,S.clone(a)),O.update(r.uColorGridTransform,fr.clone(i)),O.updateIfChanged(r.dColorType,t),r):{uColor:O.create(S()),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(n),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ne.create(o,s)),uColorGridDim:O.create(S.clone(a)),uColorGridTransform:O.create(fr.clone(i)),dColorType:O.create(t),dUsePalette:O.create(!1)}}var Aee=Qt(),yze=me();function rB(e,t,r){var n=function bze(e,t){for(var r=0;r<t;r++)if(Qt.fromMat4(Aee,me.fromArray(yze,e,16*r)),Qt.determinant(Aee)<0)return!0;return!1}(e,t);if(r){O.update(r.matrix,r.matrix.ref.value);var a=r.transform.ref.value.length>=16*t?r.transform.ref.value:new Float32Array(16*t);a.set(e),O.update(r.transform,a),O.updateIfChanged(r.uInstanceCount,t),O.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=16*t?r.aTransform.ref.value:new Float32Array(16*t);O.update(r.aTransform,i);var o=r.extraTransform.ref.value.length>=16*t?r.extraTransform.ref.value:new Float32Array(16*t);O.update(r.extraTransform,FD(o,t));var s=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);O.update(r.aInstance,rc(s,t)),O.update(r.hasReflection,n)}else r={aTransform:O.create(new Float32Array(16*t)),matrix:O.create(me.identity()),transform:O.create(new Float32Array(e)),extraTransform:O.create(FD(new Float32Array(16*t),t)),uInstanceCount:O.create(t),instanceCount:O.create(t),aInstance:O.create(rc(new Float32Array(t))),hasReflection:O.create(n)};return Tee(r),r}var nB=new Float32Array(16);function aB(e){return rB(new Float32Array(nB),1,e)}function FD(e,t){for(var r=0;r<t;r++)e.set(nB,16*r);return e}function Tee(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=16*o;me.mulOffset(t,i,a,s,s,s),me.mulOffset(t,n,t,s,0,s)}O.update(e.aTransform,t)}me.toArray(me.identity(),nB,0);var ea={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"},Dee=dt(13421772),_ze="Gives everything the same, uniform color.",rb={value:D.Color(Dee),saturation:D.Numeric(0,{min:-6,max:6,step:.1}),lightness:D.Numeric(0,{min:-6,max:6,step:.1})};function ig(e,t){var r=Po(t.value,Dee);return r=dt.saturate(r,t.saturation),r=dt.lighten(r,t.lightness),{factory:ig,granularity:"uniform",color:function(){return r},props:t,description:_ze,legend:Gh([["uniform",r]])}}var Cze={name:"uniform",label:"Uniform",category:ea.Misc,factory:ig,getParams:function Sze(e){return rb},defaultValues:D.getDefaultValues(rb),isApplicable:function(e){return!0}},Eee={value:D.Numeric(1,{min:0,max:20,step:.1})};function iB(e,t){var r=t.value;return{factory:iB,granularity:"uniform",size:function(){return r},props:t,description:"Gives everything the same, uniform size."}}var Aze={name:"uniform",label:"Uniform",category:"",factory:iB,getParams:function wze(e){return Eee},defaultValues:D.getDefaultValues(Eee),isApplicable:function(e){return!0}};function _s(e){return R(R({},_s.Zero),e)}function pm(){}!function(e){e.Zero={metalness:0,roughness:0,bumpiness:0},e.toArray=function t(a,i,o){return i[o]=255*a.metalness,i[o+1]=255*a.roughness,i[o+2]=255*a.bumpiness,i},e.toString=function r(a){var o=a.roughness,s=a.bumpiness;return"M ".concat(a.metalness.toFixed(2)," | R ").concat(o.toFixed(2)," | B ").concat(s.toFixed(2))},e.getParam=function n(a){return D.Group({metalness:D.Numeric(0,{min:0,max:1,step:.01}),roughness:D.Numeric(1,{min:0,max:1,step:.01}),bumpiness:D.Numeric(0,{min:0,max:1,step:.01})},R(R({},a),{presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]}))}}(_s||(_s={})),function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:D.Select("pixel",D.arrayToOptions(["instance","pixel"])),objects:D.ObjectList({type:D.Select("plane",D.objectToOptions(e.Type,function(u){return kc(u)})),invert:D.Boolean(!1),position:D.Vec3(S()),rotation:D.Group({axis:D.Vec3(S.create(1,0,0)),angle:D.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:D.Vec3(S.create(1,1,1))},function(u){return kc(u.type)})};var r=yn(),n=yn(),a=S(),i=S();e.getClip=function o(u,c){for(var l=u.objects.length,d=c?.objects||function t(u){return{count:0,type:new Array(u).fill(1),invert:new Array(u).fill(!1),position:new Array(3*u).fill(0),rotation:new Array(4*u).fill(0),scale:new Array(3*u).fill(1)}}(l),f=d.type,p=d.invert,h=d.position,m=d.rotation,v=d.scale,g=0;g<l;++g){var y=u.objects[g];f[g]=e.Type[y.type],p[g]=y.invert,S.toArray(y.position,h,3*g),yn.toArray(yn.setAxisAngle(r,y.rotation.axis,Zr(y.rotation.angle)),m,4*g),S.toArray(y.scale,v,3*g)}return{variant:u.variant,objects:{count:l,type:f,invert:p,position:h,rotation:m,scale:v}}},e.areEqual=function s(u,c){if(u.variant!==c.variant||u.objects.count!==c.objects.count)return!1;for(var l=u.objects,d=c.objects,f=0,p=l.count;f<p;++f)if(l.invert[f]!==d.invert[f]||l.type[f]!==d.type[f]||(S.fromArray(a,l.position,3*f),S.fromArray(i,d.position,3*f),!S.equals(a,i))||(S.fromArray(a,l.scale,3*f),S.fromArray(i,d.scale,3*f),!S.equals(a,i))||(yn.fromArray(r,l.rotation,4*f),yn.fromArray(n,d.rotation,4*f),!yn.equals(r,n)))return!1;return!0}}(pm||(pm={}));var ot,Dze=Object.keys({custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}}),oB=D.arrayToOptions(Dze),Iee={smoothColors:D.MappedStatic("auto",{auto:D.Group({}),on:D.Group({resolutionFactor:D.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:D.Numeric(3,{min:1,max:12,step:1})}),off:D.Group({})})};function xp(e){return!!e.smoothColors}function rl(e,t,r){if(("on"===e.name||"auto"===e.name&&t)&&r&&r<3){var n=3;return"on"===e.name?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-KY(0,1.1,r),(r=Math.max(.5,r))>1.2&&(n=2)),{resolution:r,stride:n}}}function Pee(e,t,r){return e.fill(0,4*t,4*r),!0}!function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&"custom"!==o.quality}},e.Params={alpha:D.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:D.Select("auto",oB,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:_s.getParam(),clip:D.Group(pm.Params),instanceGranularity:D.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."})},e.createSimple=function t(o,s,u){return void 0===o&&(o=gr.grey),void 0===s&&(s=1),u||(u=aB()),{transform:u,locationIterator:Ln(1,u.instanceCount.ref.value,1,function(){return fc},!1,function(){return!1}),theme:{color:ig(0,{value:o,lightness:0,saturation:0}),size:iB(0,{value:s})}}},e.createValues=function r(o,s){var u=pm.getClip(o.clip);return{alpha:O.create(o.alpha),uAlpha:O.create(o.alpha),uVertexCount:O.create(s.vertexCount),uGroupCount:O.create(s.groupCount),drawCount:O.create(s.drawCount),uMetalness:O.create(o.material.metalness),uRoughness:O.create(o.material.roughness),uBumpiness:O.create(o.material.bumpiness),dLightCount:O.create(1),dColorMarker:O.create(!0),dClipObjectCount:O.create(u.objects.count),dClipVariant:O.create(u.variant),uClipObjectType:O.create(u.objects.type),uClipObjectInvert:O.create(u.objects.invert),uClipObjectPosition:O.create(u.objects.position),uClipObjectRotation:O.create(u.objects.rotation),uClipObjectScale:O.create(u.objects.scale),instanceGranularity:O.create(o.instanceGranularity)}},e.updateValues=function n(o,s){O.updateIfChanged(o.alpha,s.alpha),O.updateIfChanged(o.uMetalness,s.material.metalness),O.updateIfChanged(o.uRoughness,s.material.roughness),O.updateIfChanged(o.uBumpiness,s.material.bumpiness);var u=pm.getClip(s.clip);O.updateIfChanged(o.dClipObjectCount,u.objects.count),O.updateIfChanged(o.dClipVariant,u.variant),O.update(o.uClipObjectType,u.objects.type),O.update(o.uClipObjectInvert,u.objects.invert),O.update(o.uClipObjectPosition,u.objects.position),O.update(o.uClipObjectRotation,u.objects.rotation),O.update(o.uClipObjectScale,u.objects.scale),O.updateIfChanged(o.instanceGranularity,s.instanceGranularity)},e.createRenderableState=function a(o){void 0===o&&(o={});var s=void 0===o.alpha||1===o.alpha;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s}},e.updateRenderableState=function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}}(ot||(ot={}));var Mee={array:new Uint8Array(4),width:1,height:1};function wp(e){return e?(O.update(e.tOverpaint,Mee),O.update(e.uOverpaintTexDim,Ne.create(1,1)),e):{tOverpaint:O.create(Mee),uOverpaintTexDim:O.create(Ne.create(1,1)),dOverpaint:O.create(!1),tOverpaintGrid:O.create(Go()),uOverpaintGridDim:O.create(S.create(1,1,1)),uOverpaintGridTransform:O.create(fr.create(0,0,0,1)),dOverpaintType:O.create("groupInstance"),uOverpaintStrength:O.create(1)}}function Ree(e,t){if(0===t||e.length<t)return 0;for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}var Oee={array:new Uint8Array(1),width:1,height:1};function Ap(e){return e?(O.update(e.tTransparency,Oee),O.update(e.uTransparencyTexDim,Ne.create(1,1)),e):{tTransparency:O.create(Oee),uTransparencyTexDim:O.create(Ne.create(1,1)),dTransparency:O.create(!1),transparencyAverage:O.create(0),tTransparencyGrid:O.create(Go()),uTransparencyGridDim:O.create(S.create(1,1,1)),uTransparencyGridTransform:O.create(fr.create(0,0,0,1)),dTransparencyType:O.create("groupInstance"),uTransparencyStrength:O.create(1)}}var Fee={array:new Uint8Array(1),width:1,height:1};function Tp(e){return e?(O.update(e.tClipping,Fee),O.update(e.uClippingTexDim,Ne.create(1,1)),O.updateIfChanged(e.dClipping,!1),e):{tClipping:O.create(Fee),uClippingTexDim:O.create(Ne.create(1,1)),dClipping:O.create(!1),dClippingType:O.create("groupInstance")}}function Nee(e,t,r){return e.fill(0,4*t,4*r),!0}var Lt,kee={array:new Uint8Array(4),width:1,height:1};function Dp(e){return e?(O.update(e.tSubstance,kee),O.update(e.uSubstanceTexDim,Ne.create(1,1)),e):{tSubstance:O.create(kee),uSubstanceTexDim:O.create(Ne.create(1,1)),dSubstance:O.create(!1),tSubstanceGrid:O.create(Go()),uSubstanceGridDim:O.create(S.create(1,1,1)),uSubstanceGridTransform:O.create(fr.create(0,0,0,1)),dSubstanceType:O.create("groupInstance"),uSubstanceStrength:O.create(1)}}!function(e){function t(I,M,F,N,j,k,H){return H?function i(I,M,F,N,j,k,H){return H.vertexCount=j,H.triangleCount=k,O.update(H.vertexBuffer,I),O.update(H.indexBuffer,M),O.update(H.normalBuffer,F),O.update(H.groupBuffer,N),H}(I,M,F,N,j,k,H):function a(I,M,F,N,j,k){var G,H=De(),U=-1,Q=-1,W={kind:"mesh",vertexCount:j,triangleCount:k,vertexBuffer:O.create(I),indexBuffer:O.create(M),normalBuffer:O.create(F),groupBuffer:O.create(N),varyingGroup:O.create(!1),get boundingSphere(){var K=n(W);if(K!==U){var ne=Cp(W.vertexBuffer.ref.value,W.vertexCount,1);De.copy(H,ne),U=K}return H},get groupMapping(){return W.groupBuffer.ref.version!==Q&&(G=tb(W.groupBuffer.ref.value,W.vertexCount),Q=W.groupBuffer.ref.version),G},setBoundingSphere:function(K){De.copy(H,K),U=n(W)},meta:{}};return W}(I,M,F,N,j,k)}function r(I){return t(I?I.vertexBuffer.ref.value:new Float32Array(0),I?I.indexBuffer.ref.value:new Uint32Array(0),I?I.normalBuffer.ref.value:new Float32Array(0),I?I.groupBuffer.ref.value:new Float32Array(0),0,0,I)}function n(I){return vs([I.vertexCount,I.triangleCount,I.vertexBuffer.ref.version,I.indexBuffer.ref.version,I.normalBuffer.ref.version,I.groupBuffer.ref.version])}e.create=t,e.createEmpty=r,e.computeNormals=function o(I){var M=I.vertexCount,F=I.triangleCount,N=I.vertexBuffer.ref.value,j=I.indexBuffer.ref.value,k=I.normalBuffer.ref.value.length>=3*M?I.normalBuffer.ref.value:new Float32Array(3*M);k===I.normalBuffer.ref.value&&k.fill(0,0,3*M),FJ(N,j,k,M,F),O.update(I.normalBuffer,k)},e.checkForDuplicateVertices=function s(I,M){void 0===M&&(M=3);for(var F=I.vertexBuffer.ref.value,N=new Map,k=0,H=S(),G=0,U=I.vertexCount;G<U;++G){S.fromArray(H,F,3*G);var Q="".concat((K=H)[0].toFixed(ne=M),"|").concat(K[1].toFixed(ne),"|").concat(K[2].toFixed(ne)),W=N.get(Q);void 0!==W?(k+=1,N.set(Q,W+1)):N.set(Q,1)}var K,ne;return k};var u=Qt();function f(I){for(var M=I.vertexCount,F=I.triangleCount,N=I.indexBuffer.ref.value,j=[],k=0;k<M;++k)j[k]=[];for(k=0;k<F;++k){var H=N[3*k],G=N[3*k+1],U=N[3*k+2];$a(j[H],G),$a(j[H],U),$a(j[G],H),$a(j[G],U),$a(j[U],H),$a(j[U],G)}return j}function p(I){for(var M=I.triangleCount,F=I.indexBuffer.ref.value,N=new Map,j=function(Q,W){var K=w2(Q,W),ne=N.get(K)||0;N.set(K,ne+1)},k=0;k<M;++k){var H=F[3*k],G=F[3*k+1],U=F[3*k+2];j(H,G),j(H,U),j(G,U)}return N}function h(I){var M=new Set,F=[0,0];return I.forEach(function(N,j){1===N&&(gX(F,j),M.add(F[0]),M.add(F[1]))}),M}function m(I,M,F){var N=new Map,j=function(k,H){N.has(k)?$a(N.get(k),H):N.set(k,[H])};return M.forEach(function(k){for(var G=0,U=I[k];G<U.length;G++){var Q=U[G];M.has(Q)&&1===F.get(w2(k,Q))&&j(k,Q)}}),N}function g(I,M,F,N){for(var j,H=I.indexBuffer,U=I.triangleCount,Q=I.vertexBuffer.ref.value,W=H.ref.value,K=I.normalBuffer.ref.value,ne=qe.create(Uint32Array,3,1024,U),X=0,L=0;L<U;++L)qe.add3(ne,W[3*L],W[3*L+1],W[3*L+2]),X+=1;var Y=S(),$=S(),Z=S(),q=S(),z=S(),te=S(),ae=S(),fe=S(),he=S(),pe=S(),re=Zr(120),ee=new Set,ue=Array.from(F.keys()).filter(function(Ue){return F.get(Ue).length<2}).map(function(Ue){var $e=F.get(Ue);return S.fromArray(Y,Q,3*Ue),S.fromArray($,Q,3*$e[0]),S.fromArray(Z,Q,3*$e[1]),S.sub(z,$,Y),S.sub(te,Z,Y),[Ue,S.angle(z,te)]});ue.sort(function(Ue,$e){return Ue[1]-$e[1]});for(var ge=0,Ce=ue;ge<Ce.length;ge++){var ze=Ce[ge],je=ze[0],V=ze[1];if(!(ee.has(je)||V>re)){var J=F.get(je);if((!M[J[0]].includes(J[1])||null!==(j=F.get(J[0]))&&void 0!==j&&j.includes(J[1]))&&(S.fromArray(Y,Q,3*je),S.fromArray($,Q,3*J[0]),S.fromArray(Z,Q,3*J[1]),S.sub(z,$,Y),S.sub(te,Z,Y),S.add(fe,z,te),!(S.squaredDistance(Y,$)>=N))){for(var ye=!1,we=0,Ee=M[je];we<Ee.length;we++){var Fe=Ee[we];if(!J.includes(Fe)&&(S.fromArray(q,Q,3*Fe),S.sub(ae,q,Y),S.dot(fe,ae)<0)){ye=!0;break}}ye&&(S.fromArray(he,K,3*je),S.triangleNormal(pe,Y,$,Z),S.dot(pe,he)>0?qe.add3(ne,je,J[0],J[1]):qe.add3(ne,J[1],J[0],je),ee.add(je),ee.add(J[0]),ee.add(J[1]),X+=1)}}}var ke=qe.compact(ne);return I.triangleCount=X,O.update(H,ke),I}function _(I,M){var F=I.vertexCount,N=M.instanceCount.ref.value,j=fm(),k=j.position,H=I.vertexBuffer.ref.value,G=M.aTransform.ref.value;return Ln(F,N,1,function(Q,W){return W<0?S.fromArray(k,H,3*Q):S.transformMat4Offset(k,H,G,0,3*Q,16*W),j})}function C(I,M,F,N,j){var k=F.instanceCount,H=F.groupCount,U=pc(F,_(I,M),N.color),Q=j.instanceGranularity?La(k,"instance"):La(k*H,"groupInstance"),W=wp(),K=Ap(),ne=Dp(),X=Tp(),L={drawCount:3*I.triangleCount,vertexCount:I.vertexCount,groupCount:H,instanceCount:k},Y=De.clone(I.boundingSphere),$=lo(Y,M.aTransform.ref.value,k,0);return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("mesh"),aPosition:I.vertexBuffer,aNormal:I.normalBuffer,aGroup:I.groupBuffer,elements:I.indexBuffer,dVaryingGroup:I.varyingGroup,boundingSphere:O.create($),invariantBoundingSphere:O.create(Y),uInvariantBoundingSphere:O.create(fr.ofSphere(Y))},U),Q),W),K),ne),X),M),ot.createValues(j,L)),{uDoubleSided:O.create(j.doubleSided),dFlatShaded:O.create(j.flatShaded),dFlipSided:O.create(j.flipSided),dIgnoreLight:O.create(j.ignoreLight),dXrayShaded:O.create("inverted"===j.xrayShaded?"inverted":!0===j.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(j.transparentBackfaces),uBumpFrequency:O.create(j.bumpFrequency),uBumpAmplitude:O.create(j.bumpAmplitude),meta:O.create(I.meta)})}function E(I,M){ot.updateRenderableState(I,M),I.opaque=I.opaque&&!M.xrayShaded,I.writeDepth=I.opaque}e.transform=function c(I,M){var F=I.vertexBuffer.ref.value;ng(M,F,0,I.vertexCount),me.isTranslationAndUniformScaling(M)||function W6e(e,t,r,n){for(var a=0,i=3*n;a<i;a+=3)S.fromArray(Iu,t,r+a),S.transformMat3(Iu,Iu,e),S.toArray(Iu,t,r+a)}(Qt.directionTransform(u,M),I.normalBuffer.ref.value,0,I.vertexCount),O.update(I.vertexBuffer,F)},e.getOriginalData=function l(I){return("kind"in I?I.meta:I.meta.ref.value).originalData},e.uniformTriangleGroup=function d(I,M){void 0===M&&(M=!0);var F=I.indexBuffer,N=I.vertexBuffer,j=I.groupBuffer,k=I.normalBuffer,H=I.triangleCount,G=I.vertexCount,U=F.ref.value,Q=N.ref.value,W=j.ref.value,K=k.ref.value,ne=qe.create(Uint32Array,3,1024,H),X=qe.create(Float32Array,3,1024,Q);X.currentIndex=3*G,X.elementCount=G;var L=qe.create(Float32Array,3,1024,K);L.currentIndex=3*G,L.elementCount=G;var Y=qe.create(Float32Array,1,1024,W);Y.currentIndex=G,Y.elementCount=G;var $=S(),Z=S(),q=S(),z=S(),te=S(),ae=S();function fe(He){S.fromArray($,Q,3*He),S.fromArray(z,K,3*He),qe.add3(X,$[0],$[1],$[2]),qe.add3(L,z[0],z[1],z[2])}function he(He,Je){S.fromArray($,Q,3*He),S.fromArray(Z,Q,3*Je),S.scale($,S.add($,$,Z),.5),S.fromArray(z,K,3*He),S.fromArray(te,K,3*Je),S.scale(z,S.add(z,z,te),.5),qe.add3(X,$[0],$[1],$[2]),qe.add3(L,z[0],z[1],z[2])}function pe(He,Je,vt){S.fromArray($,Q,3*He),S.fromArray(Z,Q,3*Je),S.fromArray(q,Q,3*vt),S.scale($,S.add($,S.add($,$,Z),q),1/3),S.fromArray(z,K,3*He),S.fromArray(te,K,3*Je),S.fromArray(ae,K,3*vt),S.scale(z,S.add(z,S.add(z,z,te),ae),1/3),qe.add3(X,$[0],$[1],$[2]),qe.add3(L,z[0],z[1],z[2])}function re(He,Je,vt,ut,_t){++ue,fe(He),he(He,Je),he(He,vt),qe.add3(ne,ee,ee+1,ee+2);for(var wt=0;wt<3;++wt)qe.add(Y,ut);for(ee+=3,ue+=2,fe(Je),fe(vt),he(He,Je),he(He,vt),qe.add3(ne,ee,ee+1,ee+3),qe.add3(ne,ee,ee+3,ee+2),wt=0;wt<4;++wt)qe.add(Y,_t);ee+=4}var ee=G,ue=0;if(M)for(var ge=0,Ce=H;ge<Ce;++ge){var we=W[V=U[3*ge+2]];if((J=W[ze=U[3*ge]])===(ye=W[je=U[3*ge+1]])&&J===we)++ue,qe.add3(ne,ze,je,V);else if(J===ye)re(V,ze,je,we,J);else if(J===we)re(je,V,ze,ye,we);else if(ye===we)re(ze,je,V,J,ye);else{ue+=2,fe(ze),he(ze,je),he(ze,V),pe(ze,je,V),qe.add3(ne,ee,ee+1,ee+3),qe.add3(ne,ee,ee+3,ee+2);for(var Ee=0;Ee<4;++Ee)qe.add(Y,J);for(ee+=4,ue+=2,fe(je),he(je,V),he(je,ze),pe(ze,je,V),qe.add3(ne,ee,ee+1,ee+3),qe.add3(ne,ee,ee+3,ee+2),Ee=0;Ee<4;++Ee)qe.add(Y,ye);for(ee+=4,ue+=2,fe(V),he(V,je),he(V,ze),pe(ze,je,V),qe.add3(ne,ee+3,ee+1,ee),qe.add3(ne,ee+2,ee+3,ee),Ee=0;Ee<4;++Ee)qe.add(Y,we);ee+=4}}else for(ge=0,Ce=H;ge<Ce;++ge){var ze,je,V,J,ye;if(we=W[V=U[3*ge+2]],(J=W[ze=U[3*ge]])!==(ye=W[je=U[3*ge+1]])||J!==we){++ue,fe(ze),fe(je),fe(V),qe.add3(ne,ee,ee+1,ee+2);var Fe=ye===we?ye:J;for(Ee=0;Ee<3;++Ee)qe.add(Y,Fe);ee+=3}else++ue,qe.add3(ne,ze,je,V)}var ke=qe.compact(ne),Ue=qe.compact(X),$e=qe.compact(L),Pe=qe.compact(Y);return I.vertexCount=ee,I.triangleCount=ue,O.update(N,Ue),O.update(j,Pe),O.update(F,ke),O.update(k,$e),I.meta.originalData={indexBuffer:U,vertexCount:G,triangleCount:H},I},e.smoothEdges=function b(I,M){!function v(I,M){for(var F=I.indexBuffer,N=I.triangleCount,j=F.ref.value,k=qe.create(Uint32Array,3,1024,N),H=0,G=0;G<N;++G){var U=j[3*G],Q=j[3*G+1],W=j[3*G+2];2===M[U].length||2===M[Q].length||2===M[W].length||(qe.add3(k,U,Q,W),H+=1)}var K=qe.compact(k);I.triangleCount=H,O.update(F,K)}(I,f(I));for(var F=0;F<10;++F){var N=I.triangleCount,j=p(I),k=f(I);if(g(I,k,m(k,h(j),j),M.maxNewEdgeLength*M.maxNewEdgeLength),I.triangleCount===N)break}var U=p(I);return function y(I,M,F){for(var N=F.iterations,j=F.lambda,k=S(),H=S(),G=S(),U=S(),Q=-j,W=new Float32Array(I.vertexBuffer.ref.value.length),K=function(X){var L=I.vertexBuffer.ref.value;W.set(L),M.forEach(function($,Z){if(2===$.length){S.fromArray(k,L,3*Z),S.fromArray(H,L,3*$[0]),S.fromArray(G,L,3*$[1]);var q=1/S.distance(k,H),z=1/S.distance(k,G);S.scale(H,H,q),S.scale(G,G,z),S.add(U,H,G),S.scale(U,U,1/(q+z)),S.sub(U,U,k),S.scale(U,U,X),S.add(U,k,U),S.toArray(U,W,3*Z)}});var Y=I.vertexBuffer.ref.value;O.update(I.vertexBuffer,W),W=Y},ne=0;ne<N;++ne)K(j),K(Q)}(I,m(f(I),h(U),U),{iterations:M.iterations,lambda:.5}),I},e.Params=R(R({},ot.Params),{doubleSided:D.Boolean(!1,ot.CustomQualityParamInfo),flipSided:D.Boolean(!1,ot.ShadingCategory),flatShaded:D.Boolean(!1,ot.ShadingCategory),ignoreLight:D.Boolean(!1,ot.ShadingCategory),xrayShaded:D.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],ot.ShadingCategory),transparentBackfaces:D.Select("off",D.arrayToOptions(["off","on","opaque"]),ot.ShadingCategory),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory),bumpAmplitude:D.Numeric(1,{min:0,max:5,step:.1},ot.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:C,createValuesSimple:function x(I,M,F,N,j){var k=ot.createSimple(F,N,j),H=R(R({},D.getDefaultValues(e.Params)),M);return C(I,k.transform,k.locationIterator,k.theme,H)},updateValues:function A(I,M){ot.updateValues(I,M),O.updateIfChanged(I.uDoubleSided,M.doubleSided),O.updateIfChanged(I.dFlatShaded,M.flatShaded),O.updateIfChanged(I.dFlipSided,M.flipSided),O.updateIfChanged(I.dIgnoreLight,M.ignoreLight),O.updateIfChanged(I.dXrayShaded,"inverted"===M.xrayShaded?"inverted":!0===M.xrayShaded?"on":"off"),O.updateIfChanged(I.dTransparentBackfaces,M.transparentBackfaces),O.updateIfChanged(I.uBumpFrequency,M.bumpFrequency),O.updateIfChanged(I.uBumpAmplitude,M.bumpAmplitude)},updateBoundingSphere:function T(I,M){var F=De.clone(M.boundingSphere),N=lo(F,I.aTransform.ref.value,I.instanceCount.ref.value,0);De.equals(N,I.boundingSphere.ref.value)||O.update(I.boundingSphere,N),De.equals(F,I.invariantBoundingSphere.ref.value)||(O.update(I.invariantBoundingSphere,F),O.update(I.uInvariantBoundingSphere,fr.fromSphere(I.uInvariantBoundingSphere.ref.value,F)))},createRenderableState:function w(I){var M=ot.createRenderableState(I);return E(M,I),M},updateRenderableState:E,createPositionIterator:_}}(Lt||(Lt={}));var Lze={radius:1,detail:0};var Bee=S(),Lee=S(),Uee=S();function ND(e,t){for(var r=t.length,n=nb(r/3),a=0;a<r;a+=3)S.fromArray(Bee,e,3*t[a]),S.fromArray(Lee,e,3*t[a+1]),S.fromArray(Uee,e,3*t[a+2]),n.add(Bee,Lee,Uee);return n.getPrimitive()}var kD=S();function nb(e,t){void 0===t&&(t=3*e);var r=new Float32Array(3*t),n=new Float32Array(3*t),a=new Uint32Array(3*e),i=0,o=0;return{add:function(s,u,c){S.toArray(s,r,i),S.toArray(u,r,i+3),S.toArray(c,r,i+6),S.triangleNormal(kD,s,u,c);for(var l=0;l<3;++l)S.toArray(kD,n,i+3*l),a[o+l]=i/3+l;i+=9,o+=3},addQuad:function(s,u,c,l){S.toArray(s,r,i),S.toArray(u,r,i+3),S.toArray(c,r,i+6),S.toArray(l,r,i+9),S.triangleNormal(kD,s,u,c);for(var d=0;d<4;++d)S.toArray(kD,n,i+3*d);var f=i/3;a[o]=f,a[o+1]=f+1,a[o+2]=f+2,a[o+3]=f+2,a[o+4]=f+3,a[o+5]=f,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var ab=S(),zze=Qt();function sB(e,t){for(var r=e.vertices,n=e.normals,a=Qt.directionTransform(zze,t),i=0,o=r.length;i<o;i+=3)S.transformMat4(ab,S.fromArray(ab,r,i),t),S.toArray(ab,r,i),S.transformMat3(ab,S.fromArray(ab,n,i),a),S.toArray(ab,n,i);return e}function kS(e,t){return{vertices:e,edges:t}}function Vee(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var uB=S.zero();function zee(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)S.transformMat4(uB,S.fromArray(uB,r,n),t),S.toArray(uB,r,n);return e}var cB,nl=(1+Math.sqrt(5))/2,Gee=[-1,nl,0,1,nl,0,-1,-nl,0,1,-nl,0,0,-1,nl,0,1,nl,0,-1,-nl,0,1,-nl,nl,0,-1,nl,0,1,-nl,0,-1,-nl,0,1],Gze=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];kS(Gee,[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9]);var Hee=function jze(){return cB||(cB=ND(Gee,Gze)),cB}(),Wze=Hee.vertices,Yze=Hee.indices;function ib(e){return 10*Math.pow(Math.pow(2,e),2)+2}var jee=new Map,Kze=me.identity();function qee(e){var t=jee.get(e);return void 0===t&&(t=function Xze(e){return function Uze(e,t,r){var n=R(R({},Lze),r),a=n.radius,i=n.detail,o=function Vze(){var e=[],t=[],r=new Map;function n(a){var i="".concat(a[0].toFixed(5),"|").concat(a[1].toFixed(5),"|").concat(a[2].toFixed(5)),o=r.get(i);return void 0===o&&(r.set(i,o=e.length/3),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}(),s=o.vertices,u=o.indices;(function l(f){for(var p=S(),h=S(),m=S(),v=0;v<t.length;v+=3)S.fromArray(p,e,3*t[v+0]),S.fromArray(h,e,3*t[v+1]),S.fromArray(m,e,3*t[v+2]),d(p,h,m,f)})(i),function Y6e(e,t){for(var r=0,n=e.length;r<n;r+=3)S.fromArray(Iu,e,r),S.normalize(Iu,Iu),S.scale(Iu,Iu,t),S.toArray(Iu,e,r)}(s,a);var c=new Float32Array(s.length);return FJ(s,u,c,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(c),indices:new Uint32Array(u)};function d(f,p,h,m){for(var v=Math.pow(2,m),g=[],y=0;y<=v;++y){g[y]=[];var b=S();S.lerp(b,f,h,y/v);var _=S();S.lerp(_,p,h,y/v);for(var C=v-y,x=0;x<=C;++x)if(0===x&&y===v)g[y][x]=b;else{var A=S();S.lerp(A,b,_,x/C),g[y][x]=A}}for(y=0;y<v;++y)for(x=0;x<2*(v-y)-1;++x){var T=Math.floor(x/2);x%2==0?o.add(g[y][T+1],g[y+1][T],g[y][T]):o.add(g[y][T+1],g[y+1][T+1],g[y+1][T])}}}(Wze,Yze,{detail:e,radius:1})}(e),jee.set(e,t)),t}function $r(e,t,r,n){ft.addPrimitive(e,function Zze(e,t,r){return me.scaleUniformly(e,me.fromTranslation(e,t),r)}(Kze,t,r),qee(n))}var Jd={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:2*Math.PI};function ef(e,t,r){void 0===r&&(r=-1);for(var n=new Float32Array(3*e),a=-1===r?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(2*o+i)/e*Math.PI;n[3*o]=Math.cos(u)*a,n[3*o+1]=Math.sin(u)*a,n[3*o+2]=0}return n}var lB,dB,fB,pB,hB,Wee=S(),Yee=S(),Pu=S(),Mu=S(),tf=S(),ob=S(),$ze={height:1,topCap:!0,bottomCap:!0};function sb(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=R(R({},$ze),t),a=n.height,i=n.topCap,o=n.bottomCap,s=2*r,u=4*r,c=(i?1:0)+(o?1:0);3===r?(s+=c,u+=3*c):4===r?(s+=2*c,u+=4*c):(s+=c*r,u+=c*r*3);var l=nb(s,u),d=.5*a;S.set(Wee,0,0,-d),S.set(Yee,0,0,d);for(var f=0;f<r;++f){var p=(f+1)%r;S.set(Pu,e[3*f],e[3*f+1],-d),S.set(Mu,e[3*p],e[3*p+1],-d),S.set(tf,e[3*p],e[3*p+1],d),S.set(ob,e[3*f],e[3*f+1],d),l.addQuad(Pu,Mu,tf,ob)}if(3===r)i&&(S.set(Pu,e[0],e[1],-d),S.set(Mu,e[3],e[4],-d),S.set(tf,e[6],e[7],-d),l.add(tf,Mu,Pu)),o&&(S.set(Pu,e[0],e[1],d),S.set(Mu,e[3],e[4],d),S.set(tf,e[6],e[7],d),l.add(Pu,Mu,tf));else if(4===r)i&&(S.set(Pu,e[0],e[1],-d),S.set(Mu,e[3],e[4],-d),S.set(tf,e[6],e[7],-d),S.set(ob,e[9],e[10],-d),l.addQuad(ob,tf,Mu,Pu)),o&&(S.set(Pu,e[0],e[1],d),S.set(Mu,e[3],e[4],d),S.set(tf,e[6],e[7],d),S.set(ob,e[9],e[10],d),l.addQuad(Pu,Mu,tf,ob));else for(f=0;f<r;++f)p=(f+1)%r,i&&(S.set(Pu,e[3*f],e[3*f+1],-d),S.set(Mu,e[3*p],e[3*p+1],-d),l.add(Wee,Mu,Pu)),o&&(S.set(Pu,e[3*f],e[3*f+1],d),S.set(Mu,e[3*p],e[3*p+1],d),l.add(Pu,Mu,Yee));return l.getPrimitive()}var Xee=new Map,Kee=S.create(0,1,0),al=S(),BD=S(),Zee=S(),rf=me(),Qee=me(),$ee=S(),nf=S(),bB=S();function BS(e,t,r,n,a){return S.setMagnitude(BD,r,n/2),S.add(Zee,t,BD),a?S.matchDirection(bB,Kee,BD):S.copy(bB,Kee),S.set($ee,1,n,1),S.makeRotation(Qee,bB,BD),me.scale(e,Qee,$ee),me.setTranslation(e,Zee)}var af=new Int32Array(9);function LS(e){var t=function aGe(e){var t,r,n,a,i,o,s,u,c;return af[0]=Math.round(1e3*(null!==(t=e.radiusTop)&&void 0!==t?t:Jd.radiusTop)),af[1]=Math.round(1e3*(null!==(r=e.radiusBottom)&&void 0!==r?r:Jd.radiusBottom)),af[2]=Math.round(1e3*(null!==(n=e.height)&&void 0!==n?n:Jd.height)),af[3]=null!==(a=e.radialSegments)&&void 0!==a?a:Jd.radialSegments,af[4]=null!==(i=e.heightSegments)&&void 0!==i?i:Jd.heightSegments,af[5]=(null!==(o=e.topCap)&&void 0!==o?o:Jd.topCap)?1:0,af[6]=(null!==(s=e.bottomCap)&&void 0!==s?s:Jd.bottomCap)?1:0,af[7]=Math.round(1e3*(null!==(u=e.thetaStart)&&void 0!==u?u:Jd.thetaStart)),af[8]=Math.round(1e3*(null!==(c=e.thetaLength)&&void 0!==c?c:Jd.thetaLength)),vs(af)}(e),r=Xee.get(t);return void 0===r&&(r=e.radialSegments&&e.radialSegments<=4?sB(sb(ef(Math.max(3,e.radialSegments),!0,e.radiusTop),e),me.rotX90):function Qze(e){var t=R(R({},Jd),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,c=t.thetaStart,l=t.thetaLength,d=[],f=[],p=[],h=0,m=[],v=a/2;return function g(){for(var b=S.zero(),_=(n-r)/a,C=0;C<=o;++C){for(var x=[],A=C/o,T=A*(n-r)+r,w=0;w<=i;++w){var I=w/i*l+c,M=Math.sin(I),F=Math.cos(I);f.push(T*M,-A*a+v,T*F),S.normalize(b,S.set(b,M,_,F)),p.push.apply(p,b),x.push(h++)}m.push(x)}for(w=0;w<i;++w)for(C=0;C<o;++C){var j=m[C+1][w],k=m[C+1][w+1],H=m[C][w+1];d.push(m[C][w],j,H),d.push(j,k,H)}}(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function y(b){for(var _=!0===b?r:n,C=!0===b?1:-1,x=h,A=1;A<=i;++A)f.push(0,v*C,0),p.push(0,C,0),++h;var T=h;for(A=0;A<=i;++A){var E=A/i*l+c,I=Math.cos(E),M=Math.sin(E);f.push(_*M,v*C,_*I),p.push(0,C,0),++h}for(A=0;A<i;++A){var F=x+A,N=T+A;!0===b?d.push(N,N+1,F):d.push(N+1,N,F)}}}(e),Xee.set(t,r)),r}function Hr(e,t,r,n,a){var i=S.distance(t,r)*n;S.sub(al,r,t),BS(rf,t,al,i,!0),ft.addPrimitive(e,rf,LS(a))}function iGe(e,t,r,n,a,i){var o=S.distance(t,r)*n,s=LS(i);S.sub(al,r,t),S.add(nf,t,a),BS(rf,nf,al,o,!0),ft.addPrimitive(e,rf,s),S.sub(nf,t,a),BS(rf,nf,al,o,!0),ft.addPrimitive(e,rf,s)}function US(e,t,r,n,a,i,o){var s=S.distance(t,r)*n,u=a%2!=0,c=Math.floor((a+1)/2),l=s/(a+.5),d=LS(o);S.setMagnitude(al,S.sub(al,r,t),l),S.copy(nf,t);for(var f=0;f<c;++f)S.add(nf,nf,al),u&&f===c-1&&(!i&&o.topCap&&(o.topCap=!1,d=LS(o)),l/=2),BS(rf,nf,al,l,!1),ft.addPrimitive(e,rf,d),S.add(nf,nf,al)}var ft,ai=S(),Jee=Qt(),Jl=S(),il=S(),Ep=S(),LD=S(),Ss=S.fromArray,oGe=S.triangleNormal,ete=S.copy,UD=S.transformMat4,tte=S.transformMat3,rte=Qt.directionTransform,Cs=qe.add3,VD=qe.add;function VS(e,t,r){return e=ao(Math.round(e),0,16777215)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function _B(e,t,r){return 256*Math.floor(e)*256+256*Math.floor(t)+Math.floor(r)-1}!function(e){function r(f,p,h,m){var v=f.vertices,g=f.normals,y=f.indices,b=f.groups,_=f.currentGroup,C=v.elementCount;Cs(v,p[0],p[1],p[2]),Cs(v,h[0],h[1],h[2]),Cs(v,m[0],m[1],m[2]),oGe(ai,p,h,m);for(var x=0;x<3;++x)Cs(g,ai[0],ai[1],ai[2]),VD(b,_);Cs(y,C,C+1,C+2)}function n(f,p,h,m,v){var g=f.vertices,y=f.normals,b=f.indices,_=f.groups,C=f.currentGroup,x=g.elementCount;Cs(g,p[0],p[1],p[2]),Cs(g,h[0],h[1],h[2]),Cs(g,m[0],m[1],m[2]);for(var A=0;A<3;++A)Cs(y,v[0],v[1],v[2]),VD(_,C);Cs(b,x,x+1,x+2)}function s(f,p,h){for(var m=h.vertices,v=h.normals,g=h.indices,y=f.vertices,b=f.normals,_=f.indices,C=f.groups,x=f.currentGroup,A=y.elementCount,T=rte(Jee,p),w=0,E=m.length;w<E;w+=3)UD(ai,Ss(ai,m,w),p),Cs(y,ai[0],ai[1],ai[2]),tte(ai,Ss(ai,v,w),T),Cs(b,ai[0],ai[1],ai[2]),VD(C,x);for(w=0,E=g.length;w<E;w+=3)Cs(_,g[w]+A,g[w+1]+A,g[w+2]+A)}e.createState=function t(f,p,h){return void 0===f&&(f=2048),void 0===p&&(p=1024),{currentGroup:-1,vertices:qe.create(Float32Array,3,p,h?h.vertexBuffer.ref.value:f),normals:qe.create(Float32Array,3,p,h?h.normalBuffer.ref.value:f),indices:qe.create(Uint32Array,3,3*p,h?h.indexBuffer.ref.value:3*f),groups:qe.create(Float32Array,1,p,h?h.groupBuffer.ref.value:f),mesh:h}},e.addTriangle=r,e.addTriangleWithNormal=n,e.addTriangleStrip=function a(f,p,h){Ss(Ep,p,3*h[0]),Ss(LD,p,3*h[1]);for(var m=2,v=h.length;m<v;m+=2)ete(Jl,Ep),ete(il,LD),Ss(Ep,p,3*h[m]),Ss(LD,p,3*h[m+1]),r(f,Jl,il,Ep),r(f,il,LD,Ep)},e.addTriangleFan=function i(f,p,h){Ss(Jl,p,3*h[0]);for(var m=2,v=h.length;m<v;++m)Ss(il,p,3*h[m-1]),Ss(Ep,p,3*h[m]),r(f,Jl,Ep,il)},e.addTriangleFanWithNormal=function o(f,p,h,m){Ss(Jl,p,3*h[0]);for(var v=2,g=h.length;v<g;++v)Ss(il,p,3*h[v-1]),Ss(Ep,p,3*h[v]),n(f,Jl,Ep,il,m)},e.addPrimitive=s,e.addPrimitiveFlipped=function u(f,p,h){for(var m=h.vertices,v=h.normals,g=h.indices,y=f.vertices,b=f.normals,_=f.indices,C=f.groups,x=f.currentGroup,A=y.elementCount,T=rte(Jee,p),w=0,E=m.length;w<E;w+=3)UD(ai,Ss(ai,m,w),p),Cs(y,ai[0],ai[1],ai[2]),tte(ai,Ss(ai,v,w),T),Cs(b,-ai[0],-ai[1],-ai[2]),VD(C,x);for(w=0,E=g.length;w<E;w+=3)Cs(_,g[w+2]+A,g[w+1]+A,g[w]+A)},e.addCage=function c(f,p,h,m,v,g){for(var y=h.vertices,b=h.edges,_={radiusTop:m,radiusBottom:m,radialSegments:g},C=0,x=b.length;C<x;C+=2)Ss(Jl,y,3*b[C]),Ss(il,y,3*b[C+1]),UD(Jl,Jl,p),UD(il,il,p),$r(f,Jl,m,v),$r(f,il,m,v),Hr(f,Jl,il,1,_)},e.addMesh=function l(f,p,h){s(f,p,{vertices:h.vertexBuffer.ref.value.subarray(0,3*h.vertexCount),normals:h.normalBuffer.ref.value.subarray(0,3*h.vertexCount),indices:h.indexBuffer.ref.value.subarray(0,3*h.triangleCount)})},e.getMesh=function d(f){var h=f.normals,m=f.indices,v=f.groups,g=f.mesh,y=qe.compact(f.vertices,!0),b=qe.compact(m,!0),_=qe.compact(h,!0),C=qe.compact(v,!0);return Lt.create(y,b,_,C,f.vertices.elementCount,f.indices.elementCount,g)}}(ft||(ft={}));var zD=255/256,SB=S.create(16777216,65536,256),sGe=fr.create(zD/SB[0],zD/SB[1],zD/SB[2],zD/1),nte=fr();function Ip(e,t,r){switch(Xi.getGranularity(e,t.granularity)){case"uniform":return function fGe(e,t,r){return function dGe(e,t){return t?(O.update(t.uSize,e),O.updateIfChanged(t.dSizeType,"uniform"),t):R(R({uSize:O.create(e)},function lGe(){return{tSize:O.create(cGe),uSizeTexDim:O.create(Ne.create(1,1))}}()),{dSizeType:O.create("uniform")})}(t(fc),r)}(0,t.size,r);case"group":return function hGe(e,t,r){var a=Ti(Math.max(1,e.groupCount),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();VS(t(i.location)*GD,a.array,3*i.groupIndex)}return CB(a,"group",r)}(e,t.size,r);case"groupInstance":return function mGe(e,t,r){var o=Ti(Math.max(1,e.instanceCount*e.groupCount),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();VS(t(s.location)*GD,o.array,3*s.index)}return CB(o,"groupInstance",r)}(e,t.size,r);case"instance":return function pGe(e,t,r){var a=Ti(Math.max(1,e.instanceCount),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();VS(t(i.location)*GD,a.array,3*i.instanceIndex),e.skipInstance()}return CB(a,"instance",r)}(e,t.size,r)}}var GD=100;function zS(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=_B(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/GD}}var hm,cGe={array:new Uint8Array(3),width:1,height:1};function CB(e,t,r){return r?(O.update(r.tSize,e),O.update(r.uSizeTexDim,Ne.create(e.width,e.height)),O.updateIfChanged(r.dSizeType,t),r):{uSize:O.create(0),tSize:O.create(e),uSizeTexDim:O.create(Ne.create(e.width,e.height)),dSizeType:O.create(t)}}function ate(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];for(ite(n,a,i,o,r),u=0;u<r;u++)e[u*t+s]=a[u]}for(u=0;u<r;u++){for(s=0;s<t;s++)n[s]=e[u*t+s];for(ite(n,a,i,o,t),s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function ite(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);r[++o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}!function(e){function t(h,m,v,g){return g?function i(h,m,v,g){return g.pointCount=v,O.update(g.centerBuffer,h),O.update(g.groupBuffer,m),g}(h,m,v,g):function a(h,m,v){var y,g=De(),b=-1,_=-1,C={kind:"points",pointCount:v,centerBuffer:O.create(h),groupBuffer:O.create(m),get boundingSphere(){var x=n(C);if(x!==b){var A=Cp(C.centerBuffer.ref.value,C.pointCount,1);De.copy(g,A),b=x}return g},get groupMapping(){return C.groupBuffer.ref.version!==_&&(y=tb(C.groupBuffer.ref.value,C.pointCount),_=C.groupBuffer.ref.version),y},setBoundingSphere:function(x){De.copy(g,x),b=n(C)}};return C}(h,m,v)}function r(h){return t(h?h.centerBuffer.ref.value:new Float32Array(0),h?h.groupBuffer.ref.value:new Float32Array(0),0,h)}function n(h){return vs([h.pointCount,h.centerBuffer.ref.version,h.groupBuffer.ref.version])}function s(h,m){var v=h.pointCount,g=m.instanceCount.ref.value,y=fm(),b=y.position,_=h.centerBuffer.ref.value,C=m.aTransform.ref.value;return Ln(v,g,1,function(A,T){return T<0?S.fromArray(b,_,3*A):S.transformMat4Offset(b,_,C,0,3*A,16*T),y})}function u(h,m,v,g,y){var b=v.instanceCount,_=v.groupCount,x=pc(v,s(h,m),g.color),A=Ip(v,g.size),T=y.instanceGranularity?La(b,"instance"):La(b*_,"groupInstance"),w=wp(),E=Ap(),I=Dp(),M=Tp(),F={drawCount:h.pointCount,vertexCount:h.pointCount,groupCount:_,instanceCount:b},N=De.clone(h.boundingSphere),j=lo(N,m.aTransform.ref.value,b,0);return R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("points"),aPosition:h.centerBuffer,aGroup:h.groupBuffer,boundingSphere:O.create(j),invariantBoundingSphere:O.create(N),uInvariantBoundingSphere:O.create(fr.ofSphere(N))},x),A),T),w),E),I),M),m),ot.createValues(y,F)),{uSizeFactor:O.create(y.sizeFactor),dPointSizeAttenuation:O.create(y.pointSizeAttenuation),dPointStyle:O.create(y.pointStyle)})}function p(h,m){ot.updateRenderableState(h,m),h.opaque=h.opaque&&"fuzzy"!==m.pointStyle,h.writeDepth=h.opaque}e.create=t,e.createEmpty=r,e.transform=function o(h,m){var v=h.centerBuffer.ref.value;ng(m,v,0,h.pointCount),O.update(h.centerBuffer,v)},e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params=R(R({},ot.Params),{sizeFactor:D.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:D.Boolean(!1),pointStyle:D.Select("square",D.objectToOptions(e.StyleTypes))}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:function c(h,m,v,g,y){var b=ot.createSimple(v,g,y),_=R(R({},D.getDefaultValues(e.Params)),m);return u(h,b.transform,b.locationIterator,b.theme,_)},updateValues:function l(h,m){ot.updateValues(h,m),O.updateIfChanged(h.uSizeFactor,m.sizeFactor),O.updateIfChanged(h.dPointSizeAttenuation,m.pointSizeAttenuation),O.updateIfChanged(h.dPointStyle,m.pointStyle)},updateBoundingSphere:function d(h,m){var v=De.clone(m.boundingSphere),g=lo(v,h.aTransform.ref.value,h.instanceCount.ref.value,0);De.equals(g,h.boundingSphere.ref.value)||O.update(h.boundingSphere,g),De.equals(v,h.invariantBoundingSphere.ref.value)||(O.update(h.invariantBoundingSphere,v),O.update(h.uInvariantBoundingSphere,fr.fromSphere(h.uInvariantBoundingSphere.ref.value,v)))},createRenderableState:function f(h){var m=ot.createRenderableState(h);return p(m,h),m},updateRenderableState:p,createPositionIterator:s}}(hm||(hm={}));var hc,xB={},ote={fontFamily:D.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:D.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:D.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:D.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:D.Select("normal",[["normal","Normal"],["bold","Bold"]])},gGe=function(){function e(t){void 0===t&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=R(R({},D.getDefaultValues(ote)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(.75*this.lineHeight),this.texture=Ti(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=function bGe(e,t,r){var n;return Hv?(n=function yGe(){throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.")}().createCanvas(e,t)).getContext("2d",r):((n=document.createElement("canvas")).width=e,n.height=t,n.getContext("2d",r))}(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font="".concat(r.fontStyle," ").concat(r.fontVariant," ").concat(r.fontWeight," ").concat(n,"px ").concat(r.fontFamily),this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get("\ufffd")}return e.prototype.get=function(t){if(void 0===this.mapped[t]){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),c=0;c<s;c++){var l=u.data[4*c+3]/255;this.gridOuter[c]=1===l?0:0===l?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-l),2),this.gridInner[c]=1===l?Number.MAX_SAFE_INTEGER:0===l?0:Math.pow(Math.max(0,l-.5),2)}for(ate(this.gridOuter,o,r,this.f,this.d,this.v,this.z),ate(this.gridInner,o,r,this.f,this.d,this.v,this.z),c=0;c<s;c++)a[c]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[c]-this.gridInner[c])/this.radius+this.cutoff))));this.scratchW=o,this.scratchH=r},e}();function ste(e,t,r,n){for(var a=0,i=0,o=0,s=4*r;o<s;++o){var u=2*o,c=Math.abs(e[u]);c>a&&(a=c);var l=Math.abs(e[u+1]);l>a&&(a=l);var d=Math.abs(t[o]);d>i&&(i=d)}return Math.max(i,n+n*a)}!function(e){function t(p,h,m,v,g,y,b,_,C){return C?function i(p,h,m,v,g,y,b,_,C){return C.charCount=_,O.update(C.fontTexture,p),O.update(C.centerBuffer,h),O.update(C.mappingBuffer,m),O.update(C.depthBuffer,v),O.update(C.indexBuffer,g),O.update(C.groupBuffer,y),O.update(C.tcoordBuffer,b),C}(p,h,m,v,g,y,b,_,C):function a(p,h,m,v,g,y,b,_){var x,C=De(),A=-1,T=-1,w={kind:"text",charCount:_,fontTexture:O.create(p),centerBuffer:O.create(h),mappingBuffer:O.create(m),depthBuffer:O.create(v),indexBuffer:O.create(g),groupBuffer:O.create(y),tcoordBuffer:O.create(b),get boundingSphere(){var E=n(w);if(E!==A){var I=Cp(w.centerBuffer.ref.value,4*w.charCount,4);De.copy(C,I),A=E}return C},get groupMapping(){return w.groupBuffer.ref.version!==T&&(x=tb(w.groupBuffer.ref.value,w.charCount,4),T=w.groupBuffer.ref.version),x},setBoundingSphere:function(E){De.copy(C,E),A=n(w)}};return w}(p,h,m,v,g,y,b,_)}function r(p){return t(p?p.fontTexture.ref.value:Ti(0,1,Uint8Array),p?p.centerBuffer.ref.value:new Float32Array(0),p?p.mappingBuffer.ref.value:new Float32Array(0),p?p.depthBuffer.ref.value:new Float32Array(0),p?p.indexBuffer.ref.value:new Uint32Array(0),p?p.groupBuffer.ref.value:new Float32Array(0),p?p.tcoordBuffer.ref.value:new Float32Array(0),0,p)}function n(p){return vs([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function o(p,h){var m=4*p.charCount,v=h.instanceCount.ref.value,g=fm(),y=g.position,b=p.centerBuffer.ref.value,_=h.aTransform.ref.value;return Ln(m,v,4,function(x,A){return A<0?S.fromArray(y,b,3*x):S.transformMat4Offset(y,b,_,0,3*x,16*A),g})}function s(p,h,m,v,g){var y=m.instanceCount,b=m.groupCount,C=pc(m,o(p,h),v.color),x=Ip(m,v.size),A=g.instanceGranularity?La(y,"instance"):La(y*b,"groupInstance"),T=wp(),w=Ap(),E=Dp(),I=Tp(),M={drawCount:2*p.charCount*3,vertexCount:4*p.charCount,groupCount:b,instanceCount:y},F=ste(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,zS(x)),N=De.expand(De(),p.boundingSphere,F),j=lo(N,h.aTransform.ref.value,y,0);return R(R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("text"),aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:O.create(j),invariantBoundingSphere:O.create(N),uInvariantBoundingSphere:O.create(fr.ofSphere(N))},C),x),A),T),w),E),I),h),{aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:O.create(F)}),ot.createValues(g,M)),{uSizeFactor:O.create(g.sizeFactor),uBorderWidth:O.create(ao(g.borderWidth,0,.5)),uBorderColor:O.create(dt.toArrayNormalized(g.borderColor,S.zero(),0)),uOffsetX:O.create(g.offsetX),uOffsetY:O.create(g.offsetY),uOffsetZ:O.create(g.offsetZ),uBackgroundColor:O.create(dt.toArrayNormalized(g.backgroundColor,S.zero(),0)),uBackgroundOpacity:O.create(g.backgroundOpacity)})}function f(p,h){ot.updateRenderableState(p,h),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}e.create=t,e.createEmpty=r,e.Params=R(R(R({},ot.Params),ote),{sizeFactor:D.Numeric(1,{min:0,max:10,step:.1}),borderWidth:D.Numeric(0,{min:0,max:.5,step:.01}),borderColor:D.Color(gr.grey),offsetX:D.Numeric(0,{min:0,max:10,step:.1}),offsetY:D.Numeric(0,{min:0,max:10,step:.1}),offsetZ:D.Numeric(0,{min:0,max:10,step:.1}),background:D.Boolean(!1),backgroundMargin:D.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:D.Color(gr.grey),backgroundOpacity:D.Numeric(1,{min:0,max:1,step:.01}),tether:D.Boolean(!1),tetherLength:D.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:D.Numeric(.3,{min:0,max:1,step:.01}),attachment:D.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:function u(p,h,m,v,g){var y=ot.createSimple(m,v,g),b=R(R({},D.getDefaultValues(e.Params)),h);return s(p,y.transform,y.locationIterator,y.theme,b)},updateValues:function c(p,h){ot.updateValues(p,h),O.updateIfChanged(p.uSizeFactor,h.sizeFactor),O.updateIfChanged(p.uBorderWidth,h.borderWidth),dt.fromNormalizedArray(p.uBorderColor.ref.value,0)!==h.borderColor&&(dt.toArrayNormalized(h.borderColor,p.uBorderColor.ref.value,0),O.update(p.uBorderColor,p.uBorderColor.ref.value)),O.updateIfChanged(p.uOffsetX,h.offsetX),O.updateIfChanged(p.uOffsetY,h.offsetY),O.updateIfChanged(p.uOffsetZ,h.offsetZ),dt.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==h.backgroundColor&&(dt.toArrayNormalized(h.backgroundColor,p.uBackgroundColor.ref.value,0),O.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),O.updateIfChanged(p.uBackgroundOpacity,h.backgroundOpacity)},updateBoundingSphere:function l(p,h){var m=ste(p.aMapping.ref.value,p.aDepth.ref.value,h.charCount,zS(p)),v=De.expand(De(),h.boundingSphere,m),g=lo(v,p.aTransform.ref.value,p.instanceCount.ref.value,0);De.equals(g,p.boundingSphere.ref.value)||O.update(p.boundingSphere,g),De.equals(v,p.invariantBoundingSphere.ref.value)||(O.update(p.invariantBoundingSphere,v),O.update(p.uInvariantBoundingSphere,fr.fromSphere(p.uInvariantBoundingSphere.ref.value,v))),O.update(p.padding,m)},createRenderableState:function d(p){var h=ot.createRenderableState(p);return f(h,p),h},updateRenderableState:f,createPositionIterator:o}}(hc||(hc={}));var Ru,ca,iu=S(),ed=S(),GS=S(),ute=qe.add,HD=qe.add3;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(d,f,p,h,m,v,g){for(var y=0;y<4;++y)HD(o,d,f,p),HD(s,h,m,v),ute(i,g)},l=function(d,f,p,h){var m=S.distance(d,f),v=p%2!=0,g=Math.floor((p+1)/2),y=m/(p+.5);S.setMagnitude(GS,S.sub(GS,f,d),y),S.copy(iu,d);for(var b=0;b<g;++b)S.add(iu,iu,GS),v&&b===g-1?S.copy(ed,f):S.add(ed,iu,GS),u(iu[0],iu[1],iu[2],ed[0],ed[1],ed[2],h),S.add(iu,iu,GS)};return{add:u,addVec:function(d,f,p){for(var h=0;h<4;++h)HD(o,d[0],d[1],d[2]),HD(s,f[0],f[1],f[2]),ute(i,p)},addFixedCountDashes:l,addFixedLengthDashes:function(d,f,p,h){var m=S.distance(d,f);l(d,f,m/p,h)},addCage:function(d,f,p){for(var h=f.vertices,m=f.edges,v=0,g=m.length;v<g;v+=2)S.fromArray(iu,h,3*m[v]),S.fromArray(ed,h,3*m[v+1]),S.transformMat4(iu,iu,d),S.transformMat4(ed,ed,d),u(iu[0],iu[1],iu[2],ed[0],ed[1],ed[2],p)},getLines:function(){var d=i.elementCount/4,f=qe.compact(i,!0),p=qe.compact(o,!0),h=qe.compact(s,!0),m=a&&d<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(8*d),v=a&&d<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(6*d);return(!a||d>a.lineCount)&&function _Ge(e,t,r){for(var n=0;n<e;++n){var a=8*n;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(n=0;n<e;++n){var i=4*n,o=6*n;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}(d,m,v),ca.create(m,v,f,p,h,d,a)}}}}(Ru||(Ru={})),function(e){function t(p,h,m,v,g,y,b){return b?function o(p,h,m,v,g,y,b){return y>b.lineCount&&(O.update(b.mappingBuffer,p),O.update(b.indexBuffer,h)),b.lineCount=y,O.update(b.groupBuffer,m),O.update(b.startBuffer,v),O.update(b.endBuffer,g),b}(p,h,m,v,g,y,b):function i(p,h,m,v,g,y){var _,b=De(),C=-1,x=-1,A={kind:"lines",lineCount:y,mappingBuffer:O.create(p),indexBuffer:O.create(h),groupBuffer:O.create(m),startBuffer:O.create(v),endBuffer:O.create(g),get boundingSphere(){var T=a(A);if(T!==C){var w=Cp(A.startBuffer.ref.value,4*A.lineCount,4),E=Cp(A.endBuffer.ref.value,4*A.lineCount,4);De.expandBySphere(b,w,E),C=T}return b},get groupMapping(){return A.groupBuffer.ref.version!==x&&(_=tb(A.groupBuffer.ref.value,A.lineCount,4),x=A.groupBuffer.ref.version),_},setBoundingSphere:function(T){De.copy(b,T),C=a(A)}};return A}(p,h,m,v,g,y)}function r(p){return t(p?p.mappingBuffer.ref.value:new Float32Array(0),p?p.indexBuffer.ref.value:new Uint32Array(0),p?p.groupBuffer.ref.value:new Float32Array(0),p?p.startBuffer.ref.value:new Float32Array(0),p?p.endBuffer.ref.value:new Float32Array(0),0,p)}function a(p){return vs([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function u(p,h){var m=4*p.lineCount,v=h.instanceCount.ref.value,g=fm(),y=g.position,b=p.startBuffer.ref.value,_=p.endBuffer.ref.value,C=h.aTransform.ref.value;return Ln(m,v,2,function(A,T){var w=A%4==0?b:_;return T<0?S.fromArray(y,w,3*A):S.transformMat4Offset(y,w,C,0,3*A,16*T),g})}function c(p,h,m,v,g){var y=m.instanceCount,b=m.groupCount,C=pc(m,u(p,h),v.color),x=Ip(m,v.size),A=g.instanceGranularity?La(y,"instance"):La(y*b,"groupInstance"),T=wp(),w=Ap(),E=Dp(),I=Tp(),M={drawCount:2*p.lineCount*3,vertexCount:4*p.lineCount,groupCount:b,instanceCount:y},F=De.clone(p.boundingSphere),N=lo(F,h.aTransform.ref.value,y,0);return R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("lines"),aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:O.create(N),invariantBoundingSphere:O.create(F),uInvariantBoundingSphere:O.create(fr.ofSphere(F))},C),x),A),T),w),E),I),h),ot.createValues(g,M)),{uSizeFactor:O.create(g.sizeFactor),dLineSizeAttenuation:O.create(g.lineSizeAttenuation),uDoubleSided:O.create(!0),dFlipSided:O.create(!1)})}e.create=t,e.createEmpty=r,e.fromMesh=function n(p,h){for(var m=p.vertexBuffer.ref.value,v=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,y=Ru.create(3*p.triangleCount,p.triangleCount/10,h),b=0,_=3*p.triangleCount;b<_;b+=3){var C=v[b],x=v[b+1],A=v[b+2],T=m[3*C],w=m[3*C+1],E=m[3*C+2],I=m[3*x],M=m[3*x+1],F=m[3*x+2],N=m[3*A],j=m[3*A+1],k=m[3*A+2];y.add(T,w,E,I,M,F,g[C]),y.add(T,w,E,N,j,k,g[C]),y.add(I,M,F,N,j,k,g[x])}return y.getLines()},e.transform=function s(p,h){var m=p.startBuffer.ref.value;ng(h,m,0,4*p.lineCount),O.update(p.startBuffer,m);var v=p.endBuffer.ref.value;ng(h,v,0,4*p.lineCount),O.update(p.endBuffer,v)},e.Params=R(R({},ot.Params),{sizeFactor:D.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:D.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:c,createValuesSimple:function l(p,h,m,v,g){var y=ot.createSimple(m,v,g),b=R(R({},D.getDefaultValues(e.Params)),h);return c(p,y.transform,y.locationIterator,y.theme,b)},updateValues:function d(p,h){ot.updateValues(p,h),O.updateIfChanged(p.uSizeFactor,h.sizeFactor),O.updateIfChanged(p.dLineSizeAttenuation,h.lineSizeAttenuation)},updateBoundingSphere:function f(p,h){var m=De.clone(h.boundingSphere),v=lo(m,p.aTransform.ref.value,p.instanceCount.ref.value,0);De.equals(v,p.boundingSphere.ref.value)||O.update(p.boundingSphere,v),De.equals(m,p.invariantBoundingSphere.ref.value)||(O.update(p.invariantBoundingSphere,m),O.update(p.uInvariantBoundingSphere,fr.fromSphere(p.uInvariantBoundingSphere.ref.value,m)))},createRenderableState:ot.createRenderableState,updateRenderableState:ot.updateRenderableState,createPositionIterator:u}}(ca||(ca={}));var AB,DB,EB,Yi,jD,qD,nt,Pp=S(),Mp=S(),Rp=S(),ub=S(),ii=ef(4,!0);function cte(e){for(var n=nb(12,e?36:24),a=0;a<4;++a){var i=(a+1)%4;S.set(Pp,ii[3*a],ii[3*a+1],-.5),S.set(Mp,ii[3*i],ii[3*i+1],-.5),S.set(Rp,ii[3*i],ii[3*i+1],.5),S.set(ub,ii[3*a],ii[3*a+1],.5),e?n.add(Pp,Mp,Rp):n.addQuad(Pp,Mp,Rp,ub)}return S.set(Pp,ii[0],ii[1],-.5),S.set(Mp,ii[3],ii[4],-.5),S.set(Rp,ii[6],ii[7],-.5),S.set(ub,ii[9],ii[10],-.5),e?n.add(Rp,Mp,Pp):n.addQuad(ub,Rp,Mp,Pp),S.set(Pp,ii[0],ii[1],.5),S.set(Mp,ii[3],ii[4],.5),S.set(Rp,ii[6],ii[7],.5),S.set(ub,ii[9],ii[10],.5),e?n.add(Pp,Mp,Rp):n.addQuad(Pp,Mp,Rp,ub),n.getPrimitive()}function TB(){return AB||(AB=cte(!1)),AB}function lte(){return EB||(EB=kS([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),EB}function dte(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function fte(e,t){for(var u,c,l,d,r=sr(sr([{x:0,alpha:0},{x:0,alpha:0}],e,!0),[{x:1,alpha:0},{x:1,alpha:0}],!1),a=t?t.ref.value.array:new Uint8Array(256),i=0,f=e.length+1,p=0;p<f;++p){u=r[p].alpha,c=r[p+1].alpha,l=r[p+2].alpha,d=r[p+3].alpha;for(var h=Math.round(256*(r[p+2].x-r[p+1].x)),m=0;m<h;++m)a[i]=Math.max(0,255*jA(u,c,l,d,m/h,.5)),++i}var g={array:a,width:256,height:1};return t?(O.update(t,g),t):O.create(g)}function pte(e,t,r,n){var a=(n-r)/t;0===a&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}function xGe(e,t){var r=this;return Ve.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b;return le(this,function(_){if(a=e.values,i=Cr.Space((n=e.header).dim,[0,1,2],Float64Array),0===n.dataSetIds.length)o=a;else for(u=(s=n.dim)[0],c=s[1],l=s[2],d=(t?.dataIndex||0)+1,f=0,p=0,o=new Float64Array(u*c*l),h=0;h<u;h++)for(m=0;m<c;m++)for(v=0;v<l;v++)o[f++]=a[p],p+=d;return g=Cr.create(i,Cr.Data1(o)),y=me.fromTranslation(me(),n.origin),b=me.fromBasis(me(),n.basisX,n.basisY,n.basisZ),me.mul(y,y,b),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:QA(o),max:kd(o),mean:$A(o),sigma:JA(o)}},sourceData:jD.create(e),customProperties:new zl,_propertyData:Object.create(null)}]})})})}function hte(e,t){var r=this;return Ve.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p;return le(this,function(h){return i=e.volume_data_3d,o=gs.create((a=e.volume_data_3d_info).spacegroup_number.value(0),S.ofArray(a.spacegroup_cell_size.value(0)),S.scale(S.zero(),S.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Cr.convertToCanonicalAxisIndicesFastToSlow(s),c=u(a.sample_count.value(0)),l=Cr.Space(c,Cr.invertAxisOrder(s),Float32Array),d=Cr.create(l,Cr.Data1(i.values.toArray({array:Float32Array}))),f=S.ofArray(u(a.origin.value(0))),p=S.ofArray(u(a.dimensions.value(0))),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Nt.create(f,S.add(S.zero(),f,p))},cells:d,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:qD.create(e),customProperties:new zl,_propertyData:Object.create(null)}]})})})}!function(e){e.One={transform:{kind:"matrix",matrix:me.identity()},cells:Cr.create(Cr.Space([1,1,1],[0,1,2]),Cr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=me.zero(),r=me.zero();e.getGridToCartesianTransform=function n(u){if("matrix"===u.transform.kind)return me.copy(me(),u.transform.matrix);if("spacegroup"===u.transform.kind){var c=u.cells.space,l=me.fromScaling(t,S.div(S.zero(),Nt.size(S.zero(),u.transform.fractionalBox),S.ofArray(c.dimensions))),d=me.fromTranslation(r,u.transform.fractionalBox.min);return me.mul3(me.zero(),u.transform.cell.fromFractional,d,l)}return me.identity()},e.areEquivalent=function a(u,c){return u===c},e.isEmpty=function i(u){return 0===u.cells.data.length},e.getBoundingSphere=function o(u,c){c||(c=De());var l=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return De.fromDimensionsAndTransform(c,l,d)},e.getHistogram=function s(u,c){var l=u._historams;return l||(l=u._historams={}),l[c]||(l[c]=function CGe(e,t,r){if(r)return pte(e,t,r.min,r.max);var n=tc(e);return pte(e,t,n[0],n[1])}(u.cells.data,c,{min:u.stats.min,max:u.stats.max})),l[c]}}(Yi||(Yi={})),function(e){e.is=function t(n){return"cube"===n?.kind},e.create=function r(n){return{kind:"cube",name:n.name,data:n}}}(jD||(jD={})),function(e){e.is=function t(n){return"dscif"===n?.kind},e.create=function r(n){return{kind:"dscif",name:n._name,data:n}}}(qD||(qD={})),function(e){var r;e.is=function t(g){var y,b,_,C;return(null===(C=null===(_=null===(b=null===(y=g?.grid)||void 0===y?void 0:y.cells)||void 0===b?void 0:b.space)||void 0===_?void 0:_.dimensions)||void 0===C?void 0:C.length)&&g?.sourceData&&g?.customProperties&&g?._propertyData},function(g){function A(E,I){return"absolute"===E.kind?E:{kind:"absolute",absoluteValue:g.calcAbsolute(I,E.relativeValue)}}g.areSame=function y(E,I,M){return ia(A(E,M).absoluteValue,A(I,M).absoluteValue,M.sigma/100)},g.absolute=function b(E){return{kind:"absolute",absoluteValue:E}},g.relative=function _(E){return{kind:"relative",relativeValue:E}},g.calcAbsolute=function C(E,I){return I*E.sigma+E.mean},g.calcRelative=function x(E,I){return 0===E.sigma?0:(I-E.mean)/E.sigma},g.toAbsolute=A,g.toRelative=function T(E,I){return"relative"===E.kind?E:{kind:"relative",relativeValue:g.calcRelative(I,E.absoluteValue)}},g.toString=function w(E){return"relative"===E.kind?"".concat(E.relativeValue.toFixed(2)," \u03c3"):"".concat(E.absoluteValue.toPrecision(4))}}(r=e.IsoValue||(e.IsoValue={})),e.adjustedIsoValue=function n(g,y,b){if("relative"===b)return r.relative(y);var _=r.absolute(y);if(qD.is(g.sourceData)){var C={min:g.sourceData.data.volume_data_3d_info.min_source.value(0),max:g.sourceData.data.volume_data_3d_info.max_source.value(0),mean:g.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:g.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(_,C)}return _};var a={min:-1,max:1,mean:0,sigma:.1};function i(g,y){var b=y||a,_=b.min,C=b.max,x=b.mean,A=b.sigma,T=(_-x)/A,w=(C-x)/A,E=g;return"absolute"===g.kind?g.absoluteValue<_?E=e.IsoValue.absolute(_):g.absoluteValue>C&&(E=e.IsoValue.absolute(C)):g.relativeValue<T?E=e.IsoValue.relative(T):g.relativeValue>w&&(E=e.IsoValue.relative(w)),D.Conditioned(E,{absolute:D.Converted(function(I){return e.IsoValue.toAbsolute(I,Yi.One.stats).absoluteValue},function(I){return e.IsoValue.absolute(I)},D.Numeric(x,{min:_,max:C,step:TK(A/100,2)},{immediateUpdate:!0})),relative:D.Converted(function(I){return e.IsoValue.toRelative(I,Yi.One.stats).relativeValue},function(I){return e.IsoValue.relative(I)},D.Numeric(Math.min(1,w),{min:T,max:w,step:TK(Math.round((C-_)/A)/100,2)},{immediateUpdate:!0}))},function(I){return"absolute"===I.kind?"absolute":"relative"},function(I,M){return"absolute"===M?e.IsoValue.toAbsolute(I,b):e.IsoValue.toRelative(I,b)},{isEssential:!0})}e.createIsoValueParam=i,e.IsoValueParam=i(e.IsoValue.relative(2)),e.One={label:"",grid:Yi.One,sourceData:{kind:"",name:"",data:{}},customProperties:new zl,_propertyData:Object.create(null)},e.areEquivalent=function o(g,y){return Yi.areEquivalent(g.grid,y.grid)},e.isEmpty=function s(g){return Yi.isEmpty(g.grid)},e.isOrbitals=function u(g){return!!jD.is(g.sourceData)&&g.sourceData.data.header.orbitals},e.Loci=function c(g){return{kind:"volume-loci",volume:g}},e.isLoci=function l(g){return!!g&&"volume-loci"===g.kind},e.areLociEqual=function d(g,y){return g.volume===y.volume},e.isLociEmpty=function f(g){return Yi.isEmpty(g.volume.grid)},e.getBoundingSphere=function p(g,y){return Yi.getBoundingSphere(g.grid,y)},function(g){g.Loci=function y(T,w){return{kind:"isosurface-loci",volume:T,isoValue:w}},g.isLoci=function b(T){return!!T&&"isosurface-loci"===T.kind},g.areLociEqual=function _(T,w){return T.volume===w.volume&&e.IsoValue.areSame(T.isoValue,w.isoValue,T.volume.grid.stats)},g.isLociEmpty=function C(T){return 0===T.volume.grid.cells.data.length};var x=Nt();g.getBoundingSphere=function A(T,w,E){for(var I=e.IsoValue.toAbsolute(w,T.grid.stats).absoluteValue,M=I<0,F=[0,0,0],N=T.grid.cells.space.getCoords,j=T.grid.cells.data,k=T.grid.cells.space.dimensions,Q=k[0]-1,W=k[1]-1,K=k[2]-1,ne=0,X=0,L=0,Y=0,$=j.length;Y<$;++Y)(M&&j[Y]<=I||!M&&j[Y]>=I)&&(N(Y,F),F[0]<Q&&(Q=F[0]),F[1]<W&&(W=F[1]),F[2]<K&&(K=F[2]),F[0]>ne&&(ne=F[0]),F[1]>X&&(X=F[1]),F[2]>L&&(L=F[2]));S.set(x.min,Q-1,W-1,K-1),S.set(x.max,ne+1,X+1,L+1);var Z=Yi.getGridToCartesianTransform(T.grid);return Nt.transform(x,x,Z),De.fromBox3D(E||De(),x)}}(e.Isosurface||(e.Isosurface={})),function(g){g.Loci=function y(w,E){return{kind:"cell-loci",volume:w,indices:E}},g.isLoci=function b(w){return!!w&&"cell-loci"===w.kind},g.areLociEqual=function _(w,E){return w.volume===E.volume&&Be.areEqual(w.indices,E.indices)},g.isLociEmpty=function C(w){return 0===Be.size(w.indices)};var x=new oc("98"),A=S();g.getBoundingSphere=function T(w,E,I){x.reset();for(var M=Yi.getGridToCartesianTransform(w.grid),F=w.grid.cells.space.getCoords,N=0,j=Be.size(E);N<j;N++)F(Be.getAt(E,N),A),S.transformMat4(A,A,M),x.includePosition(A);for(x.finishedIncludeStep(),N=0,j=Be.size(E);N<j;N++)F(Be.getAt(E,N),A),S.transformMat4(A,A,M),x.radiusPosition(A);var H=x.getSphere(I);return De.expand(H,H,10*me.getMaxScaleOnAxis(M))}}(e.Cell||(e.Cell={})),function(g){g.Loci=function y(E,I){return{kind:"segment-loci",volume:E,segments:Xe.ofUnsortedArray(I)}},g.isLoci=function b(E){return!!E&&"segment-loci"===E.kind},g.areLociEqual=function _(E,I){return E.volume===I.volume&&Xe.areEqual(E.segments,I.segments)},g.isLociEmpty=function C(E){return 0===E.volume.grid.cells.data.length||0===E.segments.length};var x=Nt();g.getBoundingSphere=function A(E,I,M){var F=e.Segmentation.get(E);if(F){Nt.setEmpty(x);for(var N=0,j=I.length;N<j;++N){var k=F.bounds[I[N]];Nt.add(x,k.min),Nt.add(x,k.max)}var H=Yi.getGridToCartesianTransform(E.grid);return Nt.transform(x,x,H),De.fromBox3D(M||De(),x)}return e.getBoundingSphere(E,M)},g.Location=function T(E,I){return{kind:"segment-location",volume:E,segment:I}},g.isLocation=function w(E){return!!E&&"segment-location"===E.kind}}(e.Segment||(e.Segment={})),e.PickingGranularity={set:function(g,y){g._propertyData.__picking_granularity__=y},get:function(g){var y;return null!==(y=g._propertyData.__picking_granularity__)&&void 0!==y?y:"voxel"}},e.Segmentation={set:function(g,y){g._propertyData.__segmentation__=y},get:function(g){return g._propertyData.__segmentation__}}}(nt||(nt={}));var mc,ol,xs,IB=TB();function Rn(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Te(e,t){return{type:"uniform",kind:e,variant:t}}function Xt(e,t,r,n,a){return{type:"texture",kind:e,format:t,dataType:r,filter:n,variant:a}}function cb(e){return{type:"elements",kind:e}}function Ut(e,t){return{type:"define",kind:e,options:t}}function pa(e){return{type:"value",kind:e}}!function(e){function t(v,g,y,b,_,C,x,A,T,w){return w?function a(v,g,y,b,_,C,x,A,T,w){var E=C.getWidth(),I=C.getHeight(),M=C.getDepth();return O.update(w.gridDimension,g),O.update(w.gridTexture,C),O.update(w.gridTextureDim,S.set(w.gridTextureDim.ref.value,E,I,M)),O.update(w.gridStats,fr.set(w.gridStats.ref.value,x.min,x.max,x.mean,x.sigma)),O.update(w.bboxMin,v.min),O.update(w.bboxMax,v.max),O.update(w.bboxSize,S.sub(w.bboxSize.ref.value,v.max,v.min)),O.update(w.transform,y),O.update(w.cellDim,_),O.update(w.unitToCartn,b),O.update(w.cartnToUnit,me.invert(me(),b)),O.updateIfChanged(w.packedGroup,A),O.updateIfChanged(w.axisOrder,S.fromArray(w.axisOrder.ref.value,T,0)),w}(v,g,y,b,_,C,x,A,T,w):function n(v,g,y,b,_,C,x,A,T){var w=De(),E=-1,I=C.getWidth(),M=C.getHeight(),F=C.getDepth(),N={kind:"direct-volume",gridDimension:O.create(g),gridTexture:O.create(C),gridTextureDim:O.create(S.create(I,M,F)),gridStats:O.create(fr.create(x.min,x.max,x.mean,x.sigma)),bboxMin:O.create(v.min),bboxMax:O.create(v.max),bboxSize:O.create(S.sub(S(),v.max,v.min)),transform:O.create(y),cellDim:O.create(_),unitToCartn:O.create(b),cartnToUnit:O.create(me.invert(me(),b)),get boundingSphere(){var j=r(N);if(j!==E){var k=function wGe(e,t){return De.fromDimensionsAndTransform(De(),e,t)}(N.gridDimension.ref.value,N.transform.ref.value);De.copy(w,k),E=j}return w},packedGroup:O.create(A),axisOrder:O.create(T),setBoundingSphere:function(j){De.copy(w,j),E=r(N)}};return N}(v,g,y,b,_,C,x,A,T)}function r(v){return vs([v.bboxSize.ref.version,v.gridDimension.ref.version,v.gridTexture.ref.version,v.transform.ref.version,v.gridStats.ref.version])}function i(v){return t(Nt(),S(),me.identity(),me.identity(),S(),Go(),Yi.One.stats,!1,S.create(0,1,2),v)}function s(v,g){return Math.ceil(S.magnitude(v)*g)}function u(v,g){return Math.min.apply(Math,v)*(1/g)}function c(v){return 1/v}function l(v,g,y,b,_){var C=v.gridTexture,x=v.gridTextureDim,A=v.gridStats,T=v.bboxSize,w=v.bboxMin,E=v.bboxMax,I=v.gridDimension,M=v.transform,F=y.instanceCount,N=y.groupCount,k=pc(y,e.Utils.createPositionIterator(v,g),b.color),H=_.instanceGranularity?La(F,"instance"):La(F*N,"groupInstance"),G=wp(),U=Ap(),Q=Dp(),W=Tp(),K=I.ref.value,Y={drawCount:IB.indices.length,vertexCount:K[0]*K[1]*K[2],groupCount:N,instanceCount:F},$=De.clone(v.boundingSphere),Z=lo($,g.aTransform.ref.value,F,0),z=fte(dte(_.controlPoints));return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("directVolume")},k),H),G),U),Q),W),g),ot.createValues(_,Y)),{aPosition:O.create(IB.vertices),elements:O.create(IB.indices),boundingSphere:O.create(Z),invariantBoundingSphere:O.create($),uInvariantBoundingSphere:O.create(fr.ofSphere($)),uBboxMin:w,uBboxMax:E,uBboxSize:T,uMaxSteps:O.create(s(I.ref.value,_.stepsPerCell)),uStepScale:O.create(u(v.cellDim.ref.value,_.stepsPerCell)),uJumpLength:O.create(_.jumpLength),uTransform:M,uGridDim:I,tTransferTex:z,uTransferScale:O.create(c(_.stepsPerCell)),dGridTexType:O.create(C.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:x,tGridTex:C,uGridStats:A,uCellDim:v.cellDim,uCartnToUnit:v.cartnToUnit,uUnitToCartn:v.unitToCartn,dPackedGroup:v.packedGroup,dAxisOrder:O.create(v.axisOrder.ref.value.join("")),dIgnoreLight:O.create(_.ignoreLight),dXrayShaded:O.create("inverted"===_.xrayShaded?"inverted":!0===_.xrayShaded?"on":"off")})}e.create=t,e.createEmpty=i,e.Params=R(R({},ot.Params),{ignoreLight:D.Boolean(!1,ot.ShadingCategory),xrayShaded:D.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],ot.ShadingCategory),controlPoints:D.LineGraph([Ne.create(.19,0),Ne.create(.2,.05),Ne.create(.25,.05),Ne.create(.26,0),Ne.create(.79,0),Ne.create(.8,.05),Ne.create(.85,.05),Ne.create(.86,0)],{isEssential:!0}),stepsPerCell:D.Numeric(3,{min:1,max:10,step:1}),jumpLength:D.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:l,createValuesSimple:function d(v,g,y,b,_){var C=ot.createSimple(y,b,_),x=R(R({},D.getDefaultValues(e.Params)),g);return l(v,C.transform,C.locationIterator,C.theme,x)},updateValues:function f(v,g){ot.updateValues(v,g),O.updateIfChanged(v.dIgnoreLight,g.ignoreLight),O.updateIfChanged(v.dXrayShaded,"inverted"===g.xrayShaded?"inverted":!0===g.xrayShaded?"on":"off"),fte(dte(g.controlPoints),v.tTransferTex),O.updateIfChanged(v.uMaxSteps,s(v.uGridDim.ref.value,g.stepsPerCell)),O.updateIfChanged(v.uStepScale,u(v.uCellDim.ref.value,g.stepsPerCell)),O.updateIfChanged(v.uTransferScale,c(g.stepsPerCell)),O.updateIfChanged(v.uJumpLength,g.jumpLength)},updateBoundingSphere:function p(v,g){var y=De.clone(g.boundingSphere),b=lo(y,v.aTransform.ref.value,v.instanceCount.ref.value,0);De.equals(b,v.boundingSphere.ref.value)||O.update(v.boundingSphere,b),De.equals(y,v.invariantBoundingSphere.ref.value)||(O.update(v.invariantBoundingSphere,y),O.update(v.uInvariantBoundingSphere,fr.fromSphere(v.uInvariantBoundingSphere.ref.value,y)))},createRenderableState:function h(v){var g=ot.createRenderableState(v);return g.opaque=!1,g.writeDepth=!1,g},updateRenderableState:function m(v,g){ot.updateRenderableState(v,g),v.opaque=!1,v.writeDepth=!1},createPositionIterator:function o(v,g){var y=v.transform.ref.value,b=v.gridDimension.ref.value,C=b[1],x=b[2],A=b[0]*C*x,T=g.instanceCount.ref.value,w=fm(),E=w.position,I=g.aTransform.ref.value;return Ln(A,T,1,function(F,N){var j=Math.floor(F/x);return E[0]=Math.floor(j/C),E[1]=j%C,E[2]=F%x,S.transformMat4(E,E,y),N>=0&&S.transformMat4Offset(E,E,I,0,0,16*N),w})}}}(mc||(mc={})),function(e){function t(h,m,v,g){return g?function i(h,m,v,g){return g.sphereCount=v,O.update(g.centerBuffer,h),O.update(g.groupBuffer,m),g.shaderData.update(),g}(h,m,v,g):function a(h,m,v){var y,g=De(),b=-1,_=-1,C=O.create(Ti(1,4,Float32Array)),x=O.create(Ne.create(0,0)),A={kind:"spheres",sphereCount:v,centerBuffer:O.create(h),groupBuffer:O.create(m),get boundingSphere(){var T=n(A);if(T!==b){var w=Cp(A.centerBuffer.ref.value,4*A.sphereCount,4);De.copy(g,w),b=T}return g},get groupMapping(){return A.groupBuffer.ref.version!==_&&(y=tb(A.groupBuffer.ref.value,A.sphereCount,4),_=A.groupBuffer.ref.version),y},setBoundingSphere:function(T){De.copy(g,T),b=n(A)},shaderData:{positionGroup:C,texDim:x,update:function(){var T=Ti(A.sphereCount,4,Float32Array,C.ref.value.array);(function o(h,m,v,g){for(var y=h.array,b=0;b<g;++b)y[4*b+0]=m[3*b+0],y[4*b+1]=m[3*b+1],y[4*b+2]=m[3*b+2],y[4*b+3]=v[b]})(T,A.centerBuffer.ref.value,A.groupBuffer.ref.value,A.sphereCount),O.update(C,T),O.update(x,Ne.set(x.ref.value,T.width,T.height))}}};return A}(h,m,v)}function r(h){return t(h?h.centerBuffer.ref.value:new Float32Array(0),h?h.groupBuffer.ref.value:new Float32Array(0),0,h)}function n(h){return vs([h.sphereCount,h.centerBuffer.ref.version,h.groupBuffer.ref.version])}function s(h,m){var v=h.sphereCount,g=m.instanceCount.ref.value,y=fm(),b=y.position,_=h.centerBuffer.ref.value,C=m.aTransform.ref.value;return Ln(v,g,1,function(A,T){return T<0?S.fromArray(b,_,3*A):S.transformMat4Offset(b,_,C,0,3*A,16*T),y})}function u(h,m,v,g,y){var b=v.instanceCount,_=v.groupCount,x=pc(v,s(h,m),g.color),A=Ip(v,g.size),T=y.instanceGranularity?La(b,"instance"):La(b*_,"groupInstance"),w=wp(),E=Ap(),I=Dp(),M=Tp(),F={drawCount:2*h.sphereCount*3,vertexCount:6*h.sphereCount,groupCount:_,instanceCount:b},N=h.boundingSphere.radius?zS(A)*y.sizeFactor:0,j=De.expand(De(),h.boundingSphere,N),k=lo(j,m.aTransform.ref.value,b,0);return h.shaderData.update(),R(R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("spheres"),uTexDim:h.shaderData.texDim,tPositionGroup:h.shaderData.positionGroup,boundingSphere:O.create(k),invariantBoundingSphere:O.create(j),uInvariantBoundingSphere:O.create(fr.ofSphere(j))},x),A),T),w),E),I),M),m),{padding:O.create(N)}),ot.createValues(y,F)),{uSizeFactor:O.create(y.sizeFactor),uDoubleSided:O.create(y.doubleSided),dIgnoreLight:O.create(y.ignoreLight),dXrayShaded:O.create("inverted"===y.xrayShaded?"inverted":!0===y.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(y.transparentBackfaces),dSolidInterior:O.create(y.solidInterior),dClipPrimitive:O.create(y.clipPrimitive),dApproximate:O.create(y.approximate),uAlphaThickness:O.create(y.alphaThickness),uBumpFrequency:O.create(y.bumpFrequency),uBumpAmplitude:O.create(y.bumpAmplitude),centerBuffer:h.centerBuffer,groupBuffer:h.groupBuffer})}function p(h,m){ot.updateRenderableState(h,m),h.opaque=h.opaque&&!m.xrayShaded,h.writeDepth=h.opaque}e.create=t,e.createEmpty=r,e.Params=R(R({},ot.Params),{sizeFactor:D.Numeric(1,{min:0,max:10,step:.1}),doubleSided:D.Boolean(!1,ot.CustomQualityParamInfo),ignoreLight:D.Boolean(!1,ot.ShadingCategory),xrayShaded:D.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],ot.ShadingCategory),transparentBackfaces:D.Select("off",D.arrayToOptions(["off","on","opaque"]),ot.ShadingCategory),solidInterior:D.Boolean(!0,ot.ShadingCategory),clipPrimitive:D.Boolean(!1,R(R({},ot.ShadingCategory),{description:"Clip whole sphere instead of cutting it."})),approximate:D.Boolean(!1,R(R({},ot.ShadingCategory),{description:"Faster rendering, but has artifacts."})),alphaThickness:D.Numeric(0,{min:0,max:20,step:1},R(R({},ot.ShadingCategory),{description:"If not zero, adjusts alpha for radius."})),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory),bumpAmplitude:D.Numeric(1,{min:0,max:5,step:.1},ot.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:function c(h,m,v,g,y){var b=ot.createSimple(v,g,y),_=R(R({},D.getDefaultValues(e.Params)),m);return u(h,b.transform,b.locationIterator,b.theme,_)},updateValues:function l(h,m){ot.updateValues(h,m),O.updateIfChanged(h.uSizeFactor,m.sizeFactor),O.updateIfChanged(h.uDoubleSided,m.doubleSided),O.updateIfChanged(h.dIgnoreLight,m.ignoreLight),O.updateIfChanged(h.dXrayShaded,"inverted"===m.xrayShaded?"inverted":!0===m.xrayShaded?"on":"off"),O.updateIfChanged(h.dTransparentBackfaces,m.transparentBackfaces),O.updateIfChanged(h.dSolidInterior,m.solidInterior),O.updateIfChanged(h.dClipPrimitive,m.clipPrimitive),O.updateIfChanged(h.dApproximate,m.approximate),O.updateIfChanged(h.uAlphaThickness,m.alphaThickness),O.updateIfChanged(h.uBumpFrequency,m.bumpFrequency),O.updateIfChanged(h.uBumpAmplitude,m.bumpAmplitude)},updateBoundingSphere:function d(h,m){var v=m.boundingSphere.radius?zS(h)*h.uSizeFactor.ref.value:0,g=De.expand(De(),m.boundingSphere,v),y=lo(g,h.aTransform.ref.value,h.instanceCount.ref.value,0);De.equals(y,h.boundingSphere.ref.value)||O.update(h.boundingSphere,y),De.equals(g,h.invariantBoundingSphere.ref.value)||(O.update(h.invariantBoundingSphere,g),O.update(h.uInvariantBoundingSphere,fr.fromSphere(h.uInvariantBoundingSphere.ref.value,g))),O.update(h.padding,v)},createRenderableState:function f(h){var m=ot.createRenderableState(h);return p(m,h),m},updateRenderableState:p,createPositionIterator:s}}(ol||(ol={})),function(e){var t=function(){function f(){this.index=0,this.textures=[]}return f.prototype.get=function(){return this.textures[this.index]},f.prototype.set=function(p,h,m){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:p,group:h,normal:m}),this.index=(this.index+1)%2},f.prototype.destroy=function(){for(var p=0,h=this.textures;p<h.length;p++){var m=h[p];m.vertex.destroy(),m.group.destroy(),m.normal.destroy()}},f}();function r(f,p,h,m,v,g,y){var b=h.getWidth(),_=h.getHeight();return y?(y.vertexCount=f,y.groupCount=p,O.update(y.geoTextureDim,Ne.set(y.geoTextureDim.ref.value,b,_)),O.update(y.vertexTexture,h),O.update(y.groupTexture,m),O.update(y.normalTexture,v),y.doubleBuffer.set(h,m,v),De.copy(y.boundingSphere,g),y):{kind:"texture-mesh",vertexCount:f,groupCount:p,geoTextureDim:O.create(Ne.create(b,_)),vertexTexture:O.create(h),groupTexture:O.create(m),normalTexture:O.create(v),varyingGroup:O.create(!1),doubleBuffer:new t,boundingSphere:De.clone(g),meta:{}}}function n(f){return r(0,0,f?f.vertexTexture.ref.value:Go(),f?f.groupTexture.ref.value:Go(),f?f.normalTexture.ref.value:Go(),f?f.boundingSphere:De(),f)}e.DoubleBuffer=t,e.create=r,e.createEmpty=n,e.Params=R(R({},ot.Params),{doubleSided:D.Boolean(!1,ot.CustomQualityParamInfo),flipSided:D.Boolean(!1,ot.ShadingCategory),flatShaded:D.Boolean(!1,ot.ShadingCategory),ignoreLight:D.Boolean(!1,ot.ShadingCategory),xrayShaded:D.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],ot.ShadingCategory),transparentBackfaces:D.Select("off",D.arrayToOptions(["off","on","opaque"]),ot.ShadingCategory),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory),bumpAmplitude:D.Numeric(1,{min:0,max:5,step:.1},ot.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:o,createValuesSimple:function s(f,p,h,m,v){var g=ot.createSimple(h,m,v),y=R(R({},D.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)},updateValues:function u(f,p){ot.updateValues(f,p),O.updateIfChanged(f.uDoubleSided,p.doubleSided),O.updateIfChanged(f.dFlatShaded,p.flatShaded),O.updateIfChanged(f.dFlipSided,p.flipSided),O.updateIfChanged(f.dIgnoreLight,p.ignoreLight),O.updateIfChanged(f.dXrayShaded,"inverted"===p.xrayShaded?"inverted":!0===p.xrayShaded?"on":"off"),O.updateIfChanged(f.dTransparentBackfaces,p.transparentBackfaces),O.updateIfChanged(f.uBumpFrequency,p.bumpFrequency),O.updateIfChanged(f.uBumpAmplitude,p.bumpAmplitude)},updateBoundingSphere:function c(f,p){var h=De.clone(p.boundingSphere),m=lo(h,f.aTransform.ref.value,f.instanceCount.ref.value,0);De.equals(m,f.boundingSphere.ref.value)||O.update(f.boundingSphere,m),De.equals(h,f.invariantBoundingSphere.ref.value)||(O.update(f.invariantBoundingSphere,h),O.update(f.uInvariantBoundingSphere,fr.fromSphere(f.uInvariantBoundingSphere.ref.value,h)))},createRenderableState:function l(f){var p=ot.createRenderableState(f);return d(p,f),p},updateRenderableState:d,createPositionIterator:function i(f,p){var h=f.meta.webgl;if(!h)return Ln(1,1,1,function(){return fc});h.namedFramebuffers[a]||(h.namedFramebuffers[a]=h.resources.framebuffer());var m=h.namedFramebuffers[a],v=f.geoTextureDim.ref.value,g=v[0],y=v[1],b=new Float32Array(g*y*4);m.bind(),f.vertexTexture.ref.value.attachFramebuffer(m,0),h.readPixels(0,0,g,y,b);var _=f.vertexCount,C=p.instanceCount.ref.value,x=fm(),A=x.position,T=b,w=p.aTransform.ref.value;return Ln(_,C,1,function(I,M){return M<0?S.fromArray(A,T,4*I):S.transformMat4Offset(A,T,w,0,4*I,16*M),x})}};var a="texture-mesh";function o(f,p,h,m,v){var g=h.instanceCount,y=h.groupCount,_=pc(h,e.Utils.createPositionIterator(f,p),m.color),C=v.instanceGranularity?La(g,"instance"):La(g*y,"groupInstance"),x=wp(),A=Ap(),T=Dp(),w=Tp(),E={drawCount:f.vertexCount,vertexCount:f.vertexCount,groupCount:y,instanceCount:g},I=De.clone(f.boundingSphere),M=lo(I,p.aTransform.ref.value,g,0);return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("textureMesh"),uGeoTexDim:f.geoTextureDim,tPosition:f.vertexTexture,tGroup:f.groupTexture,tNormal:f.normalTexture,dVaryingGroup:f.varyingGroup,boundingSphere:O.create(M),invariantBoundingSphere:O.create(I),uInvariantBoundingSphere:O.create(fr.ofSphere(I))},_),C),x),A),T),w),p),ot.createValues(v,E)),{uDoubleSided:O.create(v.doubleSided),dFlatShaded:O.create(v.flatShaded),dFlipSided:O.create(v.flipSided),dIgnoreLight:O.create(v.ignoreLight),dXrayShaded:O.create("inverted"===v.xrayShaded?"inverted":!0===v.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(v.transparentBackfaces),uBumpFrequency:O.create(v.bumpFrequency),uBumpAmplitude:O.create(v.bumpAmplitude),meta:O.create(f.meta)})}function d(f,p){ot.updateRenderableState(f,p),f.opaque=f.opaque&&!p.xrayShaded,f.writeDepth=f.opaque}}(xs||(xs={}));var Op={uModel:Te("m4"),uView:Te("m4"),uInvView:Te("m4"),uModelView:Te("m4"),uInvModelView:Te("m4"),uProjection:Te("m4"),uInvProjection:Te("m4"),uModelViewProjection:Te("m4"),uInvModelViewProjection:Te("m4"),uIsOrtho:Te("f"),uPixelRatio:Te("f"),uViewport:Te("v4"),uViewOffset:Te("v2"),uDrawingBufferSize:Te("v2"),uCameraPosition:Te("v3"),uCameraDir:Te("v3"),uNear:Te("f"),uFar:Te("f"),uFog:Te("b"),uFogNear:Te("f"),uFogFar:Te("f"),uFogColor:Te("v3"),uTransparentBackground:Te("b"),uLightDirection:Te("v3[]"),uLightColor:Te("v3[]"),uAmbientColor:Te("v3"),uPickingAlphaThreshold:Te("f"),uInteriorDarkening:Te("f"),uInteriorColorFlag:Te("b"),uInteriorColor:Te("v3"),uHighlightColor:Te("v3"),uSelectColor:Te("v3"),uDimColor:Te("v3"),uHighlightStrength:Te("f"),uSelectStrength:Te("f"),uDimStrength:Te("f"),uMarkerPriority:Te("i"),uMarkerAverage:Te("f"),uXrayEdgeFalloff:Te("f"),uExposure:Te("f"),uRenderMask:Te("i"),uMarkingDepthTest:Te("b"),uMarkingType:Te("i"),uPickType:Te("i")},Fp={tDepth:Xt("texture","depth","ushort","nearest"),tDpoitDepth:Xt("texture","rg","float","nearest"),tDpoitFrontColor:Xt("texture","rgba","float","nearest"),tDpoitBackColor:Xt("texture","rgba","float","nearest")},Np={uObjectId:Te("i")},DGe={uColor:Te("v3","material"),uColorTexDim:Te("v2"),uColorGridDim:Te("v3"),uColorGridTransform:Te("v4"),tColor:Xt("image-uint8","rgb","ubyte","nearest"),tPalette:Xt("image-uint8","rgb","ubyte","nearest"),tColorGrid:Xt("texture","rgb","ubyte","linear"),dColorType:Ut("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:Ut("boolean")},HS={uSize:Te("f","material"),uSizeTexDim:Te("v2"),tSize:Xt("image-uint8","rgb","ubyte","nearest"),dSizeType:Ut("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Te("f","material")},EGe={uMarker:Te("f"),uMarkerTexDim:Te("v2"),tMarker:Xt("image-uint8","alpha","ubyte","nearest"),markerAverage:pa("number"),markerStatus:pa("number"),dMarkerType:Ut("string",["instance","groupInstance"])},IGe={uOverpaintTexDim:Te("v2"),tOverpaint:Xt("image-uint8","rgba","ubyte","nearest"),dOverpaint:Ut("boolean"),uOverpaintGridDim:Te("v3"),uOverpaintGridTransform:Te("v4"),tOverpaintGrid:Xt("texture","rgba","ubyte","linear"),dOverpaintType:Ut("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:Te("f","material")},PGe={uTransparencyTexDim:Te("v2"),tTransparency:Xt("image-uint8","alpha","ubyte","nearest"),dTransparency:Ut("boolean"),transparencyAverage:pa("number"),uTransparencyGridDim:Te("v3"),uTransparencyGridTransform:Te("v4"),tTransparencyGrid:Xt("texture","alpha","ubyte","linear"),dTransparencyType:Ut("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:Te("f","material")},MGe={uSubstanceTexDim:Te("v2"),tSubstance:Xt("image-uint8","rgba","ubyte","nearest"),dSubstance:Ut("boolean"),uSubstanceGridDim:Te("v3"),uSubstanceGridTransform:Te("v4"),tSubstanceGrid:Xt("texture","rgba","ubyte","linear"),dSubstanceType:Ut("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:Te("f","material")},RGe={uClippingTexDim:Te("v2"),tClipping:Xt("image-uint8","alpha","ubyte","nearest"),dClipping:Ut("boolean"),dClippingType:Ut("string",["instance","groupInstance"])},kp=R(R(R(R(R(R(R({dGeometryType:Ut("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"])},DGe),EGe),IGe),PGe),MGe),RGe),{dLightCount:Ut("number"),dColorMarker:Ut("boolean"),dClipObjectCount:Ut("number"),dClipVariant:Ut("string",["instance","pixel"]),uClipObjectType:Te("i[]","material"),uClipObjectInvert:Te("b[]","material"),uClipObjectPosition:Te("v3[]","material"),uClipObjectRotation:Te("v4[]","material"),uClipObjectScale:Te("v3[]","material"),aInstance:Rn("float32",1,1),aTransform:Rn("float32",16,1),uAlpha:Te("f","material"),uMetalness:Te("f","material"),uRoughness:Te("f","material"),uBumpiness:Te("f","material"),uVertexCount:Te("i"),uInstanceCount:Te("i"),uGroupCount:Te("i"),uInvariantBoundingSphere:Te("v4"),drawCount:pa("number"),instanceCount:pa("number"),alpha:pa("number"),matrix:pa("m4"),transform:pa("float32"),extraTransform:pa("float32"),hasReflection:pa("boolean"),instanceGranularity:pa("boolean"),boundingSphere:pa("sphere"),invariantBoundingSphere:pa("sphere")}),No="\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nvoid main(void) {\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n",FGe=ms(),WD=Object.keys({colorBlended:"",colorWboit:"",colorDpoit:"",pick:"",depth:"",marking:""}),YD=WD.filter(function(e){return!["colorWboit","colorDpoit"].includes(e)}),BGe=WD.filter(function(e){return!["colorBlended","colorDpoit"].includes(e)}),LGe=WD.filter(function(e){return!["colorWboit","colorBlended"].includes(e)}),VGe=Object.keys({compute:""});function mte(e,t,r,n,a){return r=R(R({},r),{dRenderVariant:O.create(t)}),void 0===a.dRenderVariant&&Object.defineProperty(a,"dRenderVariant",{value:Ut("string")}),e.resources.program(r,n,a)}function Bp(e,t,r,n,a,i,o){return vte(e,t,r,n,a,i,o)}function qa(e,t,r,n,a,i){return void 0===i&&(i=-1),vte(e,t,r,n,a,i,VGe)}function vte(e,t,r,n,a,i,o){var s=FGe(),u=e.stats,c=e.state,l=e.resources,d=e.extensions,f=d.instancedArrays,p=d.vertexArrayObject;a.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs&&(a.aVertex=O.create(rc(new Float32Array(a.uVertexCount.ref.value))),n.aVertex=Rn("float32",1,0));for(var m=function AGe(e,t){var r={},n={},a={},i={},o={},s={},u={};return Object.keys(e).forEach(function(c){var l=e[c];"attribute"===l.type&&(r[c]=t[c]),"define"===l.type&&(n[c]=t[c]),"texture"===l.type&&void 0!==t[c]&&("material"===l.variant?i[c]=t[c]:a[c]=t[c]),"uniform"===l.type&&void 0!==t[c]&&("material"===l.variant?s[c]=t[c]:"buffered"===l.variant?u[c]=t[c]:o[c]=t[c])}),{attributeValues:r,defineValues:n,textureValues:a,materialTextureValues:i,uniformValues:o,materialUniformValues:s,bufferedUniformValues:u}}(n,a),v=m.attributeValues,g=m.defineValues,y=m.textureValues,b=m.materialTextureValues,C=m.materialUniformValues,x=m.bufferedUniformValues,A=Object.entries(m.uniformValues),T=Object.entries(C),w=Object.entries(x),E=Object.entries(function BVe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=O.create(Gl(e[r].ref.value))}),t}(x)),I=Object.entries(g),M=function TGe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}(a),F=function NGe(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}(e,t),N={},j=0,k=o;j<k.length;j++)N[H=k[j]]=mte(e,H,g,r,n);var W,G=_ee(e,n,y),U=_ee(e,n,b),Q=function jVe(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];"attribute"===i.type&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}(e,n,v),K=a.elements;K&&K.ref.value&&(W=l.elements(K.ref.value));for(var ne={},X=0,L=o;X<L.length;X++){var H;ne[H=L[X]]=p?l.vertexArray(N[H],Q,W):null}var Y=a.drawCount.ref.value,$=a.instanceCount.ref.value;u.drawCount+=Y,u.instanceCount+=$,u.instancedDrawCount+=$*Y;var Z={attributes:!1,defines:!1,elements:!1,textures:!1},q=!1,z=-1;return{id:s,materialId:i,getProgram:function(te){return N[te]},render:function(te,ae){if(0!==Y&&0!==$){var fe=N[te];if(fe.id===z&&c.currentRenderItemId===s)fe.setUniforms(A),fe.bindTextures(G,ae);else{var he=ne[te];(fe.id!==c.currentProgramId||fe.id!==z||-1===i||i!==c.currentMaterialId)&&(fe.id!==c.currentProgramId&&fe.use(),fe.setUniforms(T),fe.bindTextures(U,ae+G.length),c.currentMaterialId=i,z=fe.id),fe.setUniforms(A),fe.setUniforms(E),fe.bindTextures(G,ae),he?(he.bind(),W&&W.bind()):(W&&W.bind(),fe.bindAttributes(Q)),c.currentRenderItemId=s}if(xr)try{ED(e.gl)}catch(pe){throw new Error("Framebuffer error rendering item id ".concat(s,": '").concat(pe,"'"))}if(W?f.drawElementsInstanced(F,Y,W._dataType,0,$):f.drawArraysInstanced(F,0,Y,$),Ct&&(u.calls.drawInstanced+=1,u.calls.counts+=$),xr)try{see(e.gl)}catch(pe){throw new Error("Draw error rendering item id ".concat(s,": '").concat(pe,"'"))}}},update:function(){if(function GGe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}(Z),a.aVertex){var te=a.uVertexCount.ref.value;a.aVertex.ref.value.length<te&&O.update(a.aVertex,rc(new Float32Array(te)))}for(var ae=0,fe=I.length;ae<fe;++ae){var he=I[ae];(re=he[1]).ref.version!==M[pe=he[0]]&&(Z.defines=!0,M[pe]=re.ref.version)}if(Z.defines)for(var ee=0,ue=o;ee<ue.length;ee++)N[pe=ue[ee]].destroy(),N[pe]=mte(e,pe,g,r,n);for(a.drawCount.ref.version!==M.drawCount&&(u.drawCount+=a.drawCount.ref.value-Y,u.instancedDrawCount+=$*a.drawCount.ref.value-$*Y,Y=a.drawCount.ref.value,M.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==M.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-$,u.instancedDrawCount+=a.instanceCount.ref.value*Y-$*Y,$=a.instanceCount.ref.value,M.instanceCount=a.instanceCount.ref.version),ae=0,fe=Q.length;ae<fe;++ae){var ge=Q[ae],Ce=ge[1];if((re=v[pe=ge[0]]).ref.version!==M[pe]){if(Ce.length>=re.ref.value.length)Ce.updateSubData(re.ref.value,0,Ce.length);else{Ce.destroy();var ze=n[pe];Q[ae][1]=l.attribute(re.ref.value,ze.itemSize,ze.divisor),Z.attributes=!0}M[pe]=re.ref.version}}if(W&&a.elements.ref.version!==M.elements&&(W.length>=a.elements.ref.value.length?W.updateSubData(a.elements.ref.value,0,W.length):(W.destroy(),W=l.elements(a.elements.ref.value),Z.elements=!0),M.elements=a.elements.ref.version),Z.attributes||Z.defines||Z.elements)for(var J=0,ye=o;J<ye.length;J++){var we=ne[pe=ye[J]];we&&we.destroy(),ne[pe]=p?l.vertexArray(N[pe],Q,W):null}for(ae=0,fe=G.length;ae<fe;++ae){var Ee=G[ae],Fe=Ee[1];(re=y[pe=Ee[0]]).ref.version!==M[pe]&&("texture"!==n[pe].kind?(Fe.load(re.ref.value),Z.textures=!0):G[ae][1]=re.ref.value,M[pe]=re.ref.version)}for(ae=0,fe=U.length;ae<fe;++ae){var re,ke=U[ae];Fe=ke[1],(re=b[pe=ke[0]]).ref.version!==M[pe]&&("texture"!==n[pe].kind?(Fe.load(re.ref.value),Z.textures=!0):U[ae][1]=re.ref.value,M[pe]=re.ref.version)}for(ae=0,fe=w.length;ae<fe;++ae){var pe,Ue=w[ae],$e=Ue[1];$e.ref.version!==M[pe=Ue[0]]&&(O.update(E[ae][1],Gl($e.ref.value)),M[pe]=$e.ref.version)}},destroy:function(){if(!q){for(var te=0,ae=o;te<ae.length;te++){var fe=ae[te];N[fe].destroy();var he=ne[fe];he&&he.destroy()}G.forEach(function(pe){"texture"!==n[pe[0]].kind&&pe[1].destroy()}),U.forEach(function(pe){"texture"!==n[pe[0]].kind&&pe[1].destroy()}),Q.forEach(function(pe){return pe[1].destroy()}),W&&W.destroy(),u.drawCount-=Y,u.instanceCount-=$,u.instancedDrawCount-=$*Y,q=!0}}}}var gte=ms();function Lp(e,t,r){return{id:gte(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&O.updateIfChanged(t.uAlpha,ao(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function Wa(e,t){return{id:gte(),values:t,render:function(){return e.render("compute",0)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var PB=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Di={drawCount:pa("number"),instanceCount:pa("number"),aPosition:Rn("float32",2,0),uQuadScale:Te("v2")},Ei={drawCount:O.create(6),instanceCount:O.create(1),aPosition:O.create(PB),uQuadScale:O.create(Ne.create(1,1))},HGe=R(R({},Di),{tColor:Xt("texture","rgba","ubyte","nearest"),uTexSize:Te("v2")}),jGe=Un("copy",No,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords);\n}\n");function lb(e,t){var r=R(R({},Ei),{tColor:O.create(t),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight()))}),n=R({},HGe);return Wa(qa(e,"triangles",jGe,n,r),r)}var Up,ou,Xi,yte=new Uint32Array([0,1,2,1,3,2]),WGe=new Float32Array([0,1,0,0,1,1,1,0]),bte={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},YGe=Object.keys(bte);!function(e){function t(f,p,h,m){return m?function a(f,p,h,m){var v=f.width,g=f.height;return O.update(m.imageTexture,f),O.update(m.imageTextureDim,Ne.set(m.imageTextureDim.ref.value,v,g)),O.update(m.cornerBuffer,p),O.update(m.groupTexture,h),m}(f,p,h,m):function n(f,p,h){var m=De(),v=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:O.create(f),imageTextureDim:O.create(Ne.create(g,y)),cornerBuffer:O.create(p),groupTexture:O.create(h),get boundingSphere(){var _=function r(f){return vs([f.cornerBuffer.ref.version])}(b);if(_!==v){var C=function XGe(e){for(var t=S(),r=[],n=0,a=e.length;n<a;n+=3){var i=S.fromArray(S(),e,n);r.push(i),S.add(t,t,i)}S.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var c=S.distance(t,i=u[s]);c>o&&(o=c)}var l=De.create(t,o);return De.setExtrema(l,r),l}(b.cornerBuffer.ref.value);De.copy(m,C),v=_}return m}};return b}(f,p,h)}function i(f){return t(Ti(0,4,Uint8Array),f?f.cornerBuffer.ref.value:new Float32Array(24),Ti(0,4,Uint8Array),f)}function o(f,p,h,m,v){var g=h.instanceCount,y=h.groupCount,_=pc(h,e.Utils.createPositionIterator(f,p),m.color),C=v.instanceGranularity?La(g,"instance"):La(g*y,"groupInstance"),x=wp(),A=Ap(),T=Dp(),w=Tp(),E={drawCount:yte.length,vertexCount:PB.length/3,groupCount:y,instanceCount:g},I=De.clone(f.boundingSphere),M=lo(I,p.aTransform.ref.value,g,0);return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("image")},_),C),x),A),T),w),p),ot.createValues(v,E)),{aPosition:f.cornerBuffer,aUv:O.create(WGe),elements:O.create(yte),aGroup:O.create(rc(new Float32Array(4))),boundingSphere:O.create(M),invariantBoundingSphere:O.create(I),uInvariantBoundingSphere:O.create(fr.ofSphere(I)),dInterpolation:O.create(v.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}e.create=t,e.createEmpty=i,e.Params=R(R({},ot.Params),{interpolation:D.Select("bspline",D.objectToOptions(bte))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:function s(f,p,h,m,v){var g=ot.createSimple(h,m,v),y=R(R({},D.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)},updateValues:function u(f,p){ot.updateValues(f,p),O.updateIfChanged(f.dInterpolation,p.interpolation)},updateBoundingSphere:function c(f,p){var h=De.clone(p.boundingSphere),m=lo(h,f.aTransform.ref.value,f.instanceCount.ref.value,0);De.equals(m,f.boundingSphere.ref.value)||O.update(f.boundingSphere,m),De.equals(h,f.invariantBoundingSphere.ref.value)||(O.update(f.invariantBoundingSphere,h),O.update(f.uInvariantBoundingSphere,fr.fromSphere(f.uInvariantBoundingSphere.ref.value,h)))},createRenderableState:function l(f){var p=ot.createRenderableState(f);return p.opaque=!1,p},updateRenderableState:function d(f,p){ot.updateRenderableState(f,p),f.opaque=!1},createPositionIterator:function(){return Ln(1,1,1,function(){return fc})}}}(Up||(Up={})),function(e){function t(h,m,v,g,y,b,_,C,x){return x?function i(h,m,v,g,y,b,_,C,x){return C>x.cylinderCount&&(O.update(x.mappingBuffer,h),O.update(x.indexBuffer,m)),x.cylinderCount=C,O.update(x.groupBuffer,v),O.update(x.startBuffer,g),O.update(x.endBuffer,y),O.update(x.scaleBuffer,b),O.update(x.capBuffer,_),x}(h,m,v,g,y,b,_,C,x):function a(h,m,v,g,y,b,_,C){var A,x=De(),T=-1,w=-1,E={kind:"cylinders",cylinderCount:C,mappingBuffer:O.create(h),indexBuffer:O.create(m),groupBuffer:O.create(v),startBuffer:O.create(g),endBuffer:O.create(y),scaleBuffer:O.create(b),capBuffer:O.create(_),get boundingSphere(){var I=n(E);if(I!==T){var M=Cp(E.startBuffer.ref.value,6*E.cylinderCount,6),F=Cp(E.endBuffer.ref.value,6*E.cylinderCount,6);De.expandBySphere(x,M,F),T=I}return x},get groupMapping(){return E.groupBuffer.ref.version!==w&&(A=tb(E.groupBuffer.ref.value,E.cylinderCount,6),w=E.groupBuffer.ref.version),A},setBoundingSphere:function(I){De.copy(x,I),T=n(E)}};return E}(h,m,v,g,y,b,_,C)}function r(h){return t(h?h.mappingBuffer.ref.value:new Float32Array(0),h?h.indexBuffer.ref.value:new Uint32Array(0),h?h.groupBuffer.ref.value:new Float32Array(0),h?h.startBuffer.ref.value:new Float32Array(0),h?h.endBuffer.ref.value:new Float32Array(0),h?h.scaleBuffer.ref.value:new Float32Array(0),h?h.capBuffer.ref.value:new Float32Array(0),0,h)}function n(h){return vs([h.cylinderCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version,h.scaleBuffer.ref.version,h.capBuffer.ref.version])}function s(h,m){var v=6*h.cylinderCount,g=m.instanceCount.ref.value,y=fm(),b=y.position,_=h.startBuffer.ref.value,C=h.endBuffer.ref.value,x=m.aTransform.ref.value;return Ln(v,g,2,function(T,w){var E=T%6==0?_:C;return w<0?S.fromArray(b,E,3*T):S.transformMat4Offset(b,E,x,0,3*T,16*w),y})}function u(h,m,v,g,y){var b=v.instanceCount,_=v.groupCount,x=pc(v,s(h,m),g.color),A=Ip(v,g.size),T=y.instanceGranularity?La(b,"instance"):La(b*_,"groupInstance"),w=wp(),E=Ap(),I=Dp(),M=Tp(),F={drawCount:4*h.cylinderCount*3,vertexCount:6*h.cylinderCount,groupCount:_,instanceCount:b},N=zS(A)*y.sizeFactor,j=De.clone(h.boundingSphere),k=lo(j,m.aTransform.ref.value,b,0);return R(R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("cylinders"),aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,aScale:h.scaleBuffer,aCap:h.capBuffer,elements:h.indexBuffer,boundingSphere:O.create(k),invariantBoundingSphere:O.create(j),uInvariantBoundingSphere:O.create(fr.ofSphere(j))},x),A),T),w),E),I),M),m),{padding:O.create(N)}),ot.createValues(y,F)),{uSizeFactor:O.create(y.sizeFactor*y.sizeAspectRatio),uDoubleSided:O.create(y.doubleSided),dIgnoreLight:O.create(y.ignoreLight),dXrayShaded:O.create("inverted"===y.xrayShaded?"inverted":!0===y.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(y.transparentBackfaces),dSolidInterior:O.create(y.solidInterior),uBumpFrequency:O.create(y.bumpFrequency),uBumpAmplitude:O.create(y.bumpAmplitude)})}function p(h,m){ot.updateRenderableState(h,m),h.opaque=h.opaque&&!m.xrayShaded,h.writeDepth=h.opaque}e.create=t,e.createEmpty=r,e.transform=function o(h,m){var v=h.startBuffer.ref.value;ng(m,v,0,6*h.cylinderCount),O.update(h.startBuffer,v);var g=h.endBuffer.ref.value;ng(m,g,0,6*h.cylinderCount),O.update(h.endBuffer,g)},e.Params=R(R({},ot.Params),{sizeFactor:D.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:D.Numeric(1,{min:0,max:3,step:.01}),doubleSided:D.Boolean(!1,ot.CustomQualityParamInfo),ignoreLight:D.Boolean(!1,ot.ShadingCategory),xrayShaded:D.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],ot.ShadingCategory),transparentBackfaces:D.Select("off",D.arrayToOptions(["off","on","opaque"]),ot.ShadingCategory),solidInterior:D.Boolean(!0,ot.ShadingCategory),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory),bumpAmplitude:D.Numeric(1,{min:0,max:5,step:.1},ot.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:function c(h,m,v,g,y){var b=ot.createSimple(v,g,y),_=R(R({},D.getDefaultValues(e.Params)),m);return u(h,b.transform,b.locationIterator,b.theme,_)},updateValues:function l(h,m){ot.updateValues(h,m),O.updateIfChanged(h.uSizeFactor,m.sizeFactor*m.sizeAspectRatio),O.updateIfChanged(h.uDoubleSided,m.doubleSided),O.updateIfChanged(h.dIgnoreLight,m.ignoreLight),O.updateIfChanged(h.dXrayShaded,"inverted"===m.xrayShaded?"inverted":!0===m.xrayShaded?"on":"off"),O.updateIfChanged(h.dTransparentBackfaces,m.transparentBackfaces),O.updateIfChanged(h.dSolidInterior,m.solidInterior),O.updateIfChanged(h.uBumpFrequency,m.bumpFrequency),O.updateIfChanged(h.uBumpAmplitude,m.bumpAmplitude)},updateBoundingSphere:function d(h,m){var v=De.clone(m.boundingSphere),g=lo(v,h.aTransform.ref.value,h.instanceCount.ref.value,0);De.equals(g,h.boundingSphere.ref.value)||O.update(h.boundingSphere,g),De.equals(v,h.invariantBoundingSphere.ref.value)||(O.update(h.invariantBoundingSphere,v),O.update(h.uInvariantBoundingSphere,fr.fromSphere(h.uInvariantBoundingSphere.ref.value,v)))},createRenderableState:function f(h){var m=ot.createRenderableState(h);return p(m,h),m},updateRenderableState:p,createPositionIterator:s}}(ou||(ou={})),function(e){function t(o){switch(o.kind){case"mesh":return 3*o.triangleCount;case"points":return o.pointCount;case"spheres":return 2*o.sphereCount*3;case"cylinders":return 4*o.cylinderCount*3;case"text":return 2*o.charCount*3;case"lines":return 2*o.lineCount*3;case"direct-volume":return 36;case"image":return 6;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t,e.getVertexCount=function r(o){switch(o.kind){case"mesh":case"texture-mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return 6*o.sphereCount;case"cylinders":return 6*o.cylinderCount;case"text":return 4*o.charCount;case"lines":return 4*o.lineCount;case"direct-volume":var s=o.gridDimension.ref.value;return s[0]*s[1]*s[2];case"image":return 4}},e.getGroupCount=function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return 0===t(o)?0:kd(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return kd(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}},e.getUtils=function a(o){switch(o.kind){case"mesh":return Lt.Utils;case"points":return hm.Utils;case"spheres":return ol.Utils;case"cylinders":return ou.Utils;case"text":return hc.Utils;case"lines":return ca.Utils;case"direct-volume":return mc.Utils;case"image":return Up.Utils;case"texture-mesh":return xs.Utils}},e.getGranularity=function i(o,s){return"instance"===s&&o.nonInstanceable?"group":s}}(Xi||(Xi={}));var _te={};function OB(e,t){return{factory:OB,granularity:"groupInstance",size:function(r){return is.isLocation(r)?r.shape.getSize(r.group,r.instance):1},props:t,description:"Assigns sizes as defined by the shape object."}}var $Ge={name:"shape-group",label:"Shape Group",category:"",factory:OB,getParams:function QGe(e){return _te},defaultValues:D.getDefaultValues(_te),isApplicable:function(e){return!!e.shape}},JGe=dt(13421772),Ste={};function FB(e,t){return{factory:FB,granularity:"groupInstance",color:function(r){return is.isLocation(r)?r.shape.getColor(r.group,r.instance):JGe},props:t,description:"Assigns colors as defined by the shape object."}}var Wr,is,rHe={name:"shape-group",label:"Shape Group",category:ea.Misc,factory:FB,getParams:function tHe(e){return Ste},defaultValues:D.getDefaultValues(Ste),isApplicable:function(e){return!!e.shape}},nHe=R(R({},kp),{aPosition:Rn("float32",3,0),elements:cb("uint32"),uBboxMin:Te("v3"),uBboxMax:Te("v3"),uBboxSize:Te("v3"),uMaxSteps:Te("i"),uStepScale:Te("f"),uJumpLength:Te("f"),uTransform:Te("m4"),uGridDim:Te("v3"),tTransferTex:Xt("image-uint8","alpha","ubyte","linear"),uTransferScale:Te("f","material"),dGridTexType:Ut("string",["2d","3d"]),uGridTexDim:Te("v3"),tGridTex:Xt("texture","rgba","ubyte","linear"),uGridStats:Te("v4"),uCellDim:Te("v3"),uCartnToUnit:Te("m4"),uUnitToCartn:Te("m4"),dPackedGroup:Ut("boolean"),dAxisOrder:Ut("string",["012","021","102","120","201","210"]),dIgnoreLight:Ut("boolean"),dXrayShaded:Ut("string",["off","on","inverted"])}),iHe=R(R({},kp),{aGroup:Rn("float32",1,0),aPosition:Rn("float32",3,0),aNormal:Rn("float32",3,0),elements:cb("uint32"),dVaryingGroup:Ut("boolean"),dFlatShaded:Ut("boolean"),uDoubleSided:Te("b","material"),dFlipSided:Ut("boolean"),dIgnoreLight:Ut("boolean"),dXrayShaded:Ut("string",["off","on","inverted"]),dTransparentBackfaces:Ut("string",["off","on","opaque"]),uBumpFrequency:Te("f","material"),uBumpAmplitude:Te("f","material"),meta:pa("unknown")}),sHe=R(R(R({},kp),HS),{aGroup:Rn("float32",1,0),aPosition:Rn("float32",3,0),dPointSizeAttenuation:Ut("boolean"),dPointStyle:Ut("string",["square","circle","fuzzy"])}),cHe=R(R(R({},kp),HS),{aGroup:Rn("float32",1,0),aMapping:Rn("float32",2,0),aStart:Rn("float32",3,0),aEnd:Rn("float32",3,0),elements:cb("uint32"),dLineSizeAttenuation:Ut("boolean"),uDoubleSided:Te("b","material"),dFlipSided:Ut("boolean")}),dHe=R(R(R({},kp),HS),{uTexDim:Te("v2"),tPositionGroup:Xt("image-float32","rgba","float","nearest"),padding:pa("number"),uDoubleSided:Te("b","material"),dIgnoreLight:Ut("boolean"),dXrayShaded:Ut("string",["off","on","inverted"]),dTransparentBackfaces:Ut("string",["off","on","opaque"]),dSolidInterior:Ut("boolean"),dClipPrimitive:Ut("boolean"),dApproximate:Ut("boolean"),uAlphaThickness:Te("f"),uBumpFrequency:Te("f","material"),uBumpAmplitude:Te("f","material"),centerBuffer:pa("float32"),groupBuffer:pa("float32")}),pHe=R(R(R({},kp),HS),{aGroup:Rn("float32",1,0),aPosition:Rn("float32",3,0),aMapping:Rn("float32",2,0),aDepth:Rn("float32",1,0),elements:cb("uint32"),aTexCoord:Rn("float32",2,0),tFont:Xt("image-uint8","alpha","ubyte","linear"),padding:pa("number"),uBorderWidth:Te("f","material"),uBorderColor:Te("v3","material"),uOffsetX:Te("f","material"),uOffsetY:Te("f","material"),uOffsetZ:Te("f","material"),uBackgroundColor:Te("v3","material"),uBackgroundOpacity:Te("f","material")}),mHe=R(R({},kp),{uGeoTexDim:Te("v2","buffered"),tPosition:Xt("texture","rgb","float","nearest"),tGroup:Xt("texture","alpha","float","nearest"),tNormal:Xt("texture","rgb","float","nearest"),dVaryingGroup:Ut("boolean"),dFlatShaded:Ut("boolean"),uDoubleSided:Te("b","material"),dFlipSided:Ut("boolean"),dIgnoreLight:Ut("boolean"),dXrayShaded:Ut("string",["off","on","inverted"]),dTransparentBackfaces:Ut("string",["off","on","opaque"]),uBumpFrequency:Te("f","material"),uBumpAmplitude:Te("f","material"),meta:pa("unknown")}),gHe=R(R({},kp),{aGroup:Rn("float32",1,0),aPosition:Rn("float32",3,0),aUv:Rn("float32",2,0),elements:cb("uint32"),uImageTexDim:Te("v2"),tImageTex:Xt("image-uint8","rgba","ubyte","nearest"),tGroupTex:Xt("image-uint8","rgba","ubyte","nearest"),dInterpolation:Ut("string",YGe)}),bHe=R(R(R({},kp),HS),{aGroup:Rn("float32",1,0),aStart:Rn("float32",3,0),aEnd:Rn("float32",3,0),aMapping:Rn("float32",3,0),aScale:Rn("float32",1,0),aCap:Rn("float32",1,0),elements:cb("uint32"),padding:pa("number"),uDoubleSided:Te("b","material"),dIgnoreLight:Ut("boolean"),dXrayShaded:Ut("string",["off","on","inverted"]),dTransparentBackfaces:Ut("string",["off","on","opaque"]),dSolidInterior:Ut("boolean"),uBumpFrequency:Te("f","material"),uBumpAmplitude:Te("f","material")}),SHe=ms(0,2147483647),Vp=ms(0,2147483647);function fb(e,t,r,n){return{id:SHe(),type:e,values:t,state:r,materialId:n}}function Cte(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o];("uchar"===(c=t.propertyTypes[o])||"uint8"===c||"ushort"===c||"uint16"===c||"uint"===c||"uint32"===c||"int"===c)&&a.push([u,u]),("uchar"===c||"uint8"===c)&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var l=[["",""]];if(r){for(o=0,s=r.propertyNames.length;o<s;++o){var c,d=r.propertyNames[o];("uchar"===(c=r.propertyTypes[o])||"uint8"===c)&&l.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return R(R({},Lt.Params),{coloring:D.MappedStatic(f,{vertex:D.Group({red:D.Select(n.vRed,i,{label:"Red Property"}),green:D.Select(n.vGreen,i,{label:"Green Property"}),blue:D.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:D.Group({red:D.Select(n.mRed,l,{label:"Red Property"}),green:D.Select(n.mGreen,l,{label:"Green Property"}),blue:D.Select(n.mBlue,l,{label:"Blue Property"})},{isFlat:!0}),uniform:D.Group({color:D.Color(gr.grey),saturation:D.Numeric(0,{min:-6,max:6,step:.1}),lightness:D.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:D.MappedStatic(n.group?"vertex":"none",{vertex:D.Group({group:D.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:D.Group({})})})}!function(e){function n(l){var d=l.transforms.length,f=is.Location(l);return Ln(l.groupCount,d,1,function(h,m){return f.group=h,f.instance=m,f})}e.create=function t(l,d,f,p,h,m,v){return{id:Gn.create22(),name:l,sourceData:d,geometry:f,transforms:v||[me.identity()],get groupCount(){return Xi.getGroupCount(f)},getColor:p,getSize:h,getLabel:m}},e.getTheme=function r(l){return{color:FB(0,{}),size:OB(0,{})}},e.groupIterator=n,e.createTransform=function a(l,d){for(var f=d&&d.aTransform.ref.value.length>=16*l.length?d.aTransform.ref.value:new Float32Array(16*l.length),p=0,h=l.length;p<h;++p)me.toArray(l[p],f,16*p);return rB(f,l.length,d)},e.createRenderObject=function i(l,d){var f=e.getTheme(l),p=Xi.getUtils(l.geometry),h=Vp(),m=n(l),v=e.createTransform(l.transforms),g=p.createValues(l.geometry,v,m,f,d),y=p.createRenderableState(d);return fb(l.geometry.kind,g,y,h)},e.Loci=function o(l){return{kind:"shape-loci",shape:l}},e.isLoci=function s(l){return!!l&&"shape-loci"===l.kind},e.areLociEqual=function u(l,d){return l.shape===d.shape},e.isLociEmpty=function c(l){return 0===l.shape.groupCount}}(Wr||(Wr={})),function(e){function s(p){for(var h=0,m=0,v=p.groups;m<v.length;m++)h+=Be.size(v[m].ids);return h}e.Location=function t(p,h,m){return void 0===h&&(h=0),void 0===m&&(m=0),{kind:"group-location",shape:p,group:h,instance:m}},e.isLocation=function r(p){return!!p&&"group-location"===p.kind},e.Loci=function n(p,h){return{kind:"group-loci",shape:p,groups:h}},e.isLoci=function a(p){return!!p&&"group-loci"===p.kind},e.areLociEqual=function i(p,h){if(p.shape!==h.shape||p.groups.length!==h.groups.length)return!1;for(var m=0,v=p.groups.length;m<v;++m){var g=p.groups[m],_=h.groups[m];if(g.instance!==_.instance||!Be.areEqual(g.ids,_.ids))return!1}return!0},e.isLociEmpty=function o(p){return 0===s(p)},e.size=s;var u=new Fv,c=S.zero();function l(p,h,m,v){for(var g=h.indices,y=h.offsets,b=function(w,E){Be.forEach(w,function(I){for(var M=y[I],F=y[I+1];M<F;++M)S.fromArray(c,m,3*g[M]),S.transformMat4(c,c,v[E]),u.includeStep(c)})},_=0,C=p;_<C.length;_++){var x=C[_];b(x.ids,x.instance)}}function d(p,h,m,v){for(var g=h.indices,y=h.offsets,b=function(w,E){Be.forEach(w,function(I){for(var M=y[I],F=y[I+1];M<F;++M)S.fromArray(c,m,3*g[M]),S.transformMat4(c,c,v[E]),u.radiusStep(c)})},_=0,C=p;_<C.length;_++){var x=C[_];b(x.ids,x.instance)}}e.getBoundingSphere=function f(p,h){h||(h=De()),u.reset();var m=0,v=p.shape,g=v.geometry,y=v.transforms;if("mesh"===g.kind||"points"===g.kind)l(p.groups,g.groupMapping,b="mesh"===g.kind?g.vertexBuffer.ref.value:g.centerBuffer.ref.value,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y);else if("lines"===g.kind){var _=g.startBuffer.ref.value,C=g.endBuffer.ref.value;l(p.groups,g.groupMapping,_,y),l(p.groups,g.groupMapping,C,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,_,y),d(p.groups,g.groupMapping,C,y)}else{if("spheres"!==g.kind&&"text"!==g.kind)return De.copy(h,g.boundingSphere);var b;l(p.groups,g.groupMapping,b=g.centerBuffer.ref.value,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y);for(var x=function(F,N){Be.forEach(F,function(j){var k=p.shape.getSize(j,N);m<k&&(m=k)})},A=0,T=p.groups;A<T.length;A++){var w=T[A];x(w.ids,w.instance)}}return S.copy(h.center,u.center),h.radius=Math.sqrt(u.radiusSq),De.expand(h,h,m),h}}(is||(is={}));var xte=Cte();function AHe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:if(i=ft.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");c=t.getProperty("nx"),l=t.getProperty("ny"),d=t.getProperty("nz"),f=!!c&&!!l&&!!d,p=1e5,h=0,m=t.rowCount,g.label=1;case 1:return h<m?(function xHe(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),c=n.getProperty("y"),l=n.getProperty("z");if(!u||!c||!l)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),p=n.getProperty("nz"),h=!!d&&!!f&&!!p,m=e;m<t;++m)qe.add3(i,u.value(m),c.value(m),l.value(m)),h&&qe.add3(o,d.value(m),f.value(m),p.value(m)),qe.add(s,a[m])}(h,Math.min(h+p,m),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:h,max:m})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return h+=p,[3,1];case 4:h=0,m=r.rowCount,g.label=5;case 5:return h<m?(function wHe(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;3===u?qe.add3(a,s[0],s[1],s[2]):4===u&&(qe.add3(a,s[2],s[1],s[0]),qe.add3(a,s[2],s[0],s[3]))}}(h,Math.min(h+p,m),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:h,max:m})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return h+=p,[3,5];case 8:return v=ft.getMesh(i),f||Lt.computeNormals(v),O.updateIfChanged(v.varyingGroup,!0),[2,v]}})})}var zp=ie.Schema.int;function wte(e,t,r){var i,o,s,n=r.coloring,a=e.rowCount;if("vertex"===n.name)i=e.getProperty(n.params.red)||ie.ofConst(127,a,zp),o=e.getProperty(n.params.green)||ie.ofConst(127,a,zp),s=e.getProperty(n.params.blue)||ie.ofConst(127,a,zp);else if("material"===n.name)i=t&&t.getProperty(n.params.red)||ie.ofConst(127,a,zp),o=t&&t.getProperty(n.params.green)||ie.ofConst(127,a,zp),s=t&&t.getProperty(n.params.blue)||ie.ofConst(127,a,zp);else{var u=n.params.color;u=dt.saturate(u,n.params.saturation),u=dt.lighten(u,n.params.lightness);var c=dt.toRgb(u),d=c[1],f=c[2];i=ie.ofConst(c[0],a,zp),o=ie.ofConst(d,a,zp),s=ie.ofConst(f,a,zp)}return{kind:n.name,red:i,green:o,blue:s}}function Ate(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,c=n.map,l=n.label;return Wr.create("ply-mesh",e.source,t,function(p){var h="material"===a?p:c[p];return dt.fromRgb(i.value(h),o.value(h),s.value(h))},function(){return 1},function(p){return"".concat(l," ").concat(u[p])},e.transforms)}function DHe(){var t,r,n,a,i,o,e=this;return function(u,c,l,d){return ce(e,void 0,void 0,function(){var f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:if(!(f=c.source.getElement("vertex")))throw new Error("missing vertex element");if(!(p=c.source.getElement("face")))throw new Error("missing face element");return h=c.source.getElement("material"),m=!1,v=!1,(!t||t!=t)&&(m=!0),(!r||!D.isParamEqual(xte.grouping,r.grouping,l.grouping))&&(m=!0),(!r||!D.isParamEqual(xte.coloring,r.coloring,l.coloring))&&(v=!0),m?(i=wte(f,h,l),o=function THe(e,t){for(var r=t.grouping,n=e.rowCount,a="vertex"===r.name?e.getProperty(r.params.group):void 0,i="vertex"===r.name?kc(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):rc(new Uint32Array(n)),s=a?kd(o):n-1,u=new Uint32Array(s+1),c=0,l=o.length;c<l;++c)u[o[c]]=c;return{ids:o,map:u,label:i}}(f,l),[4,AHe(u,f,p,o.ids,d&&d.geometry)]):[3,2];case 1:return a=g.sent(),n=Ate(c,a,i,o),[3,3];case 2:v&&(i=wte(f,h,l),n=Ate(c,a,i,o)),g.label=3;case 3:return t=c,r=Gl(l),[2,n]}})})}}function EHe(e,t){var r=this;return Ve.create("Shape Provider",function(n){return ce(r,void 0,void 0,function(){return le(this,function(a){return[2,{label:"Mesh",data:{source:e,transforms:t?.transforms},params:Cte(e),getShape:DHe(),geometryUtils:Lt.Utils}]})})})}function Gp(){return Gp.empty()}function PHe(e){var t=this;return Ve.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),a=(n=e.header).DELTA?Su(20.45482949774598*n.DELTA,"ps"):Su(1,"step"),i=Su(n.ISTART>=1?(n.ISTART-1)*a.value:0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)l={elementCount:(c=e.frames[s]).elementCount,time:Su(i.value+a.value*s,a.unit),x:c.x,y:c.y,z:c.z,xyzOrdering:{isIdentity:!0}},c.cell&&(l.cell=(d=c.cell)[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?Gp.create(S.create(d[0],d[2],d[5]),S.create(Zr(90-90*Math.asin(d[1])/m2),Zr(90-90*Math.asin(d[3])/m2),Zr(90-90*Math.asin(d[4])/m2))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?Gp.fromBasis(S.create(d[0],d[1],d[3]),S.create(d[1],d[2],d[4]),S.create(d[3],d[4],d[5])):Gp.create(S.create(d[0],d[2],d[5]),S.create(Zr(ia(d[1],0,gn)?90:d[1]),Zr(ia(d[3],0,gn)?90:d[3]),Zr(ia(d[4],0,gn)?90:d[4])))),o.push(l);return[2,Av.create(o,a,i)]}})})})}function XD(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(32===o||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(32===o||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(a===++i||a+1===i)return Ke.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if(!((78!==o&&110!==o||65!==s&&97!==s)&&(67!==o&&99!==o||76!==s&&108!==s)&&(70!==o&&102!==o||69!==s&&101!==s)&&(83!==o&&115!==o||73!==s&&105!==s)&&(66!==o&&98!==o||82!==s&&114!==s)&&(65!==o&&97!==o||83!==s&&115!==s)))return Ke.add(e,a,a+2)}if(67===o||99===o||72===o||104===o||78===o||110===o||79===o||111===o||80===o||112===o||83===o||115===o)return Ke.add(e,a,a+1);Ke.add(e,a,a)}!function(e){function t(a,i){return{size:a,anglesInRadians:i}}function r(){return t(S(),S())}e.create=t,e.empty=r,e.fromBasis=function n(a,i,o){var s=S.magnitude(a),u=S.magnitude(i),c=S.magnitude(o),l=Math.acos(S.dot(i,o)/(u*c)),d=Math.acos(S.dot(a,o)/(s*c)),f=Math.acos(S.dot(a,i)/(s*u));return s<=0||u<=0||c<=0||l>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(S.create(s,u,c),S.create(l,d,f))}}(Gp||(Gp={}));var MHe=new Set(["NA","CL","FE","SI","BR","AS","LI"]),RHe=new Set(["C","H","N","O","P","S","F","B"]),OHe=/^[\s\d]+|[\s\d]+$/g;function pb(e,t){var r=(e=e.replace(OHe,"").toUpperCase()).length;if(0===r||1===r||MHe.has(e))return e;if(3===r&&t===e){if("SOD"===e)return"NA";if("POT"===e)return"K";if("CES"===e)return"CS";if("CAL"===e)return"CA";if("CLA"===e)return"CL"}return RHe.has(e[0])?e[0]:""}var kB,NB="ABCDEFGHIJKLMNOPQRSTUVWXYZ",jS=MQ(function FHe(e){for(var r=e,n=0,a=NB[r%26];r>=26;)r=Math.floor(r/26),a+=NB[r%26],n+=1;return n>=5&&console.warn("getChainId overflow"),a});function kHe(e){var t=this;return Ve.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(c){switch(c.label){case 0:n=kB.fromGro(e),a=[],i=0,o=e.structures.length,c.label=1;case 1:return i<o?(s=function NHe(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Array(e.count),c=new Xl,l=new Kl(e.residueNumber,e.atomName),d="",f=0,p="",h=0,m=0,v=-1,g=0,y=e.count;g<y;++g){var b=e.residueNumber.value(g);if(b!==v){var _=e.residueName.value(g),C=Hh(l.add(_,g).type,_);(C!==m||b!==v+1&&!(99999===v&&0===b))&&(p=jS(f),f+=1,h=0),d=c.getEntityId(_,C,p),h+=1,v=b,m=C}a[g]=d,i[g]=p,o[g]=h,s[g]=g,u[g]=pb(e.atomName.value(g),e.residueName.value(g))}var x=ie.ofStringArray(i),A=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ie.ofFloatArray(ie.mapToArray(e.x,function(T){return 10*T},Float32Array)),Cartn_y:ie.ofFloatArray(ie.mapToArray(e.y,function(T){return 10*T},Float32Array)),Cartn_z:ie.ofFloatArray(ie.mapToArray(e.z,function(T){return 10*T},Float32Array)),id:ie.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:ie.ofIntArray(o),label_entity_id:ie.ofStringArray(a),occupancy:ie.ofConst(1,e.count,ie.Schema.float),type_symbol:ie.ofStringArray(u),pdbx_PDB_model_num:ie.ofConst(t,e.count,ie.Schema.int)},e.count);return zc({entity:c.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:A})}(e.structures[i].atoms,i+1),[4,Wd(s,n,r)]):[3,4];case 2:1===(u=c.sent()).frameCount&&a.push(u.representative),c.label=3;case 3:return++i,[3,1];case 4:return[2,new mp(a)]}})})})}function BHe(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:ht.ofString(e),length_a:ht.ofString(r(6,9)),length_b:ht.ofString(r(15,9)),length_c:ht.ofString(r(24,9)),angle_alpha:ht.ofString(r(33,7)),angle_beta:ht.ofString(r(40,7)),angle_gamma:ht.ofString(r(47,7)),Z_PDB:ht.ofString(r(66,4)),pdbx_unique_axis:ht.ofString("?")},a={entry_id:ht.ofString(e),"space_group_name_H-M":ht.ofString(r(55,11)),Int_Tables_number:ht.ofString("?"),cell_setting:ht.ofString("?"),space_group_name_Hall:ht.ofString("?")};return[io.ofFields("cell",n),io.ofFields("symmetry",a)]}function Tte(e,t){return{id:e,details:t,groups:[]}}function LHe(e,t,r){for(var a,i,o,n=[],s=1,u=1,c=function(X){return e.data.substring(e.indices[2*X],e.indices[2*X+1])},l=t;l<r;l++){var d=c(l);if("BIOMOLECULE:"===d.substr(11,12)){var f=d.substr(23).trim(),p="Biomolecule ".concat(f);"APPLY THE FOLLOWING TO CHAINS:"!==(d=c(l+1)).substr(11,30)&&(l++,p=d.substr(11).trim()),a=Tte(f,p),n.push(a)}else if("BIOMT"===d.substr(13,5)){var h=d.split(/\s+/);0==(m=parseInt(d[18])-1)&&(o=me.identity(),i.operators.push({id:s++,matrix:o})),me.setValue(o,m,0,parseFloat(h[4])),me.setValue(o,m,1,parseFloat(h[5])),me.setValue(o,m,2,parseFloat(h[6])),me.setValue(o,m,3,parseFloat(h[7]))}else if("APPLY THE FOLLOWING TO CHAINS:"===d.substr(11,30)||"                   AND CHAINS:"===d.substr(11,30)){"APPLY"===d.substr(11,5)&&a.groups.push(i={chains:[],operators:[]});for(var g=0,y=(v=d.substr(41,30).split(",")).length;g<y;++g)(b=v[g].trim())&&i.chains.push(b)}else if("APPLYING THE FOLLOWING TO CHAINS:"===d.substr(11,33)){var v;for(a=Tte("".concat(u),"Biomolecule ".concat(u)),n.push(a),u+=1,a.groups.push(i={chains:[],operators:[]}),g=0,y=(v=(d=c(++l)).substr(11,69).split(",")).length;g<y;++g){var b;(b=v[g].trim())&&i.chains.push(b)}}}if(0===n.length)return[];for(var _={id:ht.ofStrings(n.map(function(X){return X.id})),details:ht.ofStrings(n.map(function(X){return X.details}))},C=[],x=0,A=n;x<A.length;x++)for(var w=0,E=(T=A[x]).groups;w<E.length;w++){var I=E[w];C.push({assembly_id:T.id,oper_expression:I.operators.map(function(X){return X.id}).join(","),asym_id_list:I.chains.join(",")})}for(var M={assembly_id:ht.ofStrings(C.map(function(X){return X.assembly_id})),oper_expression:ht.ofStrings(C.map(function(X){return X.oper_expression})),asym_id_list:ht.ofStrings(C.map(function(X){return X.asym_id_list}))},F=[],N=0,j=n;N<j.length;N++)for(var T,k=0,H=(T=j[N]).groups;k<H.length;k++)for(var U=0,Q=H[k].operators;U<Q.length;U++){var W=Q[U],m={id:""+W.id,type:"?",name:"?",symmetry_operation:"?"};for(l=0;l<3;l++){for(g=0;g<3;g++)m["matrix[".concat(l+1,"][").concat(g+1,"]")]=""+me.getValue(W.matrix,l,g);m["vector[".concat(l+1,"]")]=""+me.getValue(W.matrix,l,3)}F.push(m)}var K={id:ht.ofStrings(F.map(function(X){return X.id})),type:ht.ofStrings(F.map(function(X){return X.type})),name:ht.ofStrings(F.map(function(X){return X.name})),symmetry_operation:ht.ofStrings(F.map(function(X){return X.symmetry_operation}))},ne=function(X){for(var L=function(Z){var q="matrix[".concat(X+1,"][").concat(Z+1,"]");K[q]=ht.ofStrings(F.map(function(z){return z[q]}))},Y=0;Y<3;Y++)L(Y);var $="vector[".concat(X+1,"]");K[$]=ht.ofStrings(F.map(function(Z){return Z[$]}))};for(l=0;l<3;l++)ne(l);return[io.ofFields("pdbx_struct_assembly",_),io.ofFields("pdbx_struct_assembly_gen",M),io.ofFields("pdbx_struct_oper_list",K)]}function UHe(e,t,r){for(var a,n=[],o=t;o<r;o++){var s=e.data.substring(e.indices[2*(y=o)],e.indices[2*y+1]),u=s.split(/\s+/);0==(c=parseInt(s[5])-1)&&(a=me.identity(),n.push(a)),me.setValue(a,c,0,parseFloat(u[2])),me.setValue(a,c,1,parseFloat(u[3])),me.setValue(a,c,2,parseFloat(u[4])),me.setValue(a,c,3,parseFloat(u[5]))}var y;if(0===n.length)return[];for(var l=[],d=1,f=0,p=n;f<p.length;f++){var h=p[f],c={id:"ncsop"+d++,code:".",details:"."};for(o=0;o<3;o++){for(var m=0;m<3;m++)c["matrix[".concat(o+1,"][").concat(m+1,"]")]=""+me.getValue(h,o,m);c["vector[".concat(o+1,"]")]=""+me.getValue(h,o,3)}l.push(c)}var v={id:ht.ofStrings(l.map(function(y){return y.id})),code:ht.ofStrings(l.map(function(y){return y.code})),details:ht.ofStrings(l.map(function(y){return y.details}))},g=function(y){for(var b=function(x){var A="matrix[".concat(y+1,"][").concat(x+1,"]");v[A]=ht.ofStrings(l.map(function(T){return T[A]}))},_=0;_<3;_++)b(_);var C="vector[".concat(y+1,"]");v[C]=ht.ofStrings(l.map(function(x){return x[C]}))};for(o=0;o<3;o++)g(o);return[io.ofFields("struct_ncs_oper",v)]}!function(e){e.is=function t(n){return"gro"===n?.kind},e.fromGro=function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}}(kB||(kB={}));var VHe={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function GHe(e,t,r){for(var n=[],i=t;i<r;i++){var o=e.data.substring(e.indices[2*(f=i)],e.indices[2*f+1]);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var f,s=ht.ofStrings(n.map(function(f){return f.initChainID})),u=ht.ofStrings(n.map(function(f){return f.initResName})),c=ht.ofStrings(n.map(function(f){return f.endChainID})),l=ht.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:ht.ofUndefined(n.length,ie.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:ht.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:ht.ofStrings(n.map(function(f){return function zHe(e){return VHe[e]||"helx_p"}(f.helixClass)})),details:ht.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:c,end_label_comp_id:l,end_label_seq_id:ht.ofUndefined(n.length,ie.Schema.int),end_auth_asym_id:c,end_auth_comp_id:l,end_auth_seq_id:ht.ofStrings(n.map(function(f){return f.endSeqNum})),id:ht.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:ht.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:ht.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:ht.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:ht.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:ht.ofStrings(n.map(function(f){return f.helixID}))};return io.ofFields("struct_conf",d)}function HHe(e,t,r){for(var n=[],i=t;i<r;i++){var o=e.data.substring(e.indices[2*(h=i)],e.indices[2*h+1]);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var h,s=ht.ofStrings(n.map(function(h){return h.initChainID})),u=ht.ofStrings(n.map(function(h){return h.initResName})),c=ht.ofStrings(n.map(function(h){return h.initSeqNum})),l=ht.ofStrings(n.map(function(h){return h.endChainID})),d=ht.ofStrings(n.map(function(h){return h.endResName})),f=ht.ofStrings(n.map(function(h){return h.endSeqNum})),p={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:c,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:c,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:f,end_auth_asym_id:l,end_auth_comp_id:d,end_auth_seq_id:f,id:ht.ofStrings(n.map(function(h){return h.strand})),sheet_id:ht.ofStrings(n.map(function(h){return h.sheetID})),pdbx_beg_PDB_ins_code:ht.ofStrings(n.map(function(h){return h.initICode})),pdbx_end_PDB_ins_code:ht.ofStrings(n.map(function(h){return h.endICode}))};return io.ofFields("struct_sheet_range",p)}var hb,BB,LB,jHe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function qHe(e,t,r){for(var a,i={chains:[],description:""},o=[],s=t;s<r;s++){var c=e.data.substring(e.indices[2*(_=s)],e.indices[2*_+1]).substr(10,70).trim(),l=c.indexOf(":"),d=c.substring(0,l),f=void 0;d in jHe?(a=d,f=c.substring(l+2)):f=c,f=f.replace(/;$/,""),"MOL_ID"===a?o.push(i={chains:[],description:""}):"MOLECULE"===a?(i.description&&(i.description+=" "),i.description+=f):"CHAIN"===a&&Array.prototype.push.apply(i.chains,f.split(/\s*,\s*/))}for(var _,p=[],h=0,m=o;h<m.length;h++)for(var v=m[h],g=0,y=v.chains;g<y.length;g++)p.push({description:v.description,chains:[y[g]]});return p}function WHe(e,t,r){for(var a=new Map,i=t;i<r;i++){var o=e.data.substring(e.indices[2*(c=i)],e.indices[2*c+1]),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,"".concat(a.get(s)," ").concat(u)):a.set(s,u)}var c;return a}function Dte(e,t,r,n,a,i){var o=r.data,s=a-n;Ke.addToken(e.group_PDB,lt.trim(r,n,n+6)),lt.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),Ke.addToken(e.auth_atom_id,lt.trim(r,n+12,n+16)),32===o.charCodeAt(n+16)?Ke.add(e.label_alt_id,0,0):Ke.add(e.label_alt_id,n+16,n+17),Ke.addToken(e.auth_comp_id,lt.trim(r,n+17,n+20)),Ke.add(e.auth_asym_id,n+21,n+22),Ke.addToken(e.auth_seq_id,lt.trim(r,n+22,n+26)),32===o.charCodeAt(n+26)?Ke.add(e.pdbx_PDB_ins_code,0,0):Ke.add(e.pdbx_PDB_ins_code,n+26,n+27),Ke.addToken(e.Cartn_x,lt.trim(r,n+30,n+38)),Ke.addToken(e.Cartn_y,lt.trim(r,n+38,n+46)),Ke.addToken(e.Cartn_z,lt.trim(r,n+46,n+54)),Ke.addToken(e.occupancy,lt.trim(r,n+54,n+60)),s>=66?Ke.addToken(e.B_iso_or_equiv,lt.trim(r,n+60,n+66)):Ke.add(e.B_iso_or_equiv,0,0),i&&Ke.addToken(e.partial_charge,lt.trim(r,n+70,n+76)),s>=78&&!i?(lt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?Ke.addToken(e.type_symbol,r):XD(e.type_symbol,o,n+12,n+16)):XD(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function ZHe(e){var t=ht.ofTokens(e.pdbx_auth_seq_id),r=ht.ofTokens(e.pdbx_auth_comp_id),n=ht.ofTokens(e.pdbx_auth_asym_id),a=ht.ofTokens(e.pdbx_auth_atom_id),i={id:ht.ofStrings(e.id),type_symbol:ht.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:ht.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:ht.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=ht.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=ht.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=ht.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=ht.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=ht.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=ht.ofNumbers(e["U[2][3]"]),i}function QHe(e,t,r,n,a){var i=r.data,o=a-n;lt.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),Ke.addToken(e.pdbx_auth_atom_id,lt.trim(r,n+12,n+16)),32===i.charCodeAt(n+16)?Ke.add(e.pdbx_label_alt_id,0,0):Ke.add(e.pdbx_label_alt_id,n+16,n+17),Ke.addToken(e.pdbx_auth_comp_id,lt.trim(r,n+17,n+20)),Ke.add(e.pdbx_auth_asym_id,n+21,n+22),Ke.addToken(e.pdbx_auth_seq_id,lt.trim(r,n+22,n+26)),32===i.charCodeAt(n+26)?Ke.add(e.pdbx_PDB_ins_code,0,0):Ke.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=xv(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=xv(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=xv(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=xv(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=xv(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=xv(i,n+63,n+70)/1e4,o>=78?(lt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?Ke.addToken(e.type_symbol,r):XD(e.type_symbol,i,n+12,n+16)):XD(e.type_symbol,i,n+12,n+16),e.index++}function JHe(e,t,r,n){var a=e.substring(t,r);n.id_code=a.substring(62,66).trim()||void 0,n.dep_date=a.substring(50,59).trim()||void 0,n.classification=a.substring(10,50).trim()||void 0}function e9e(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j,k,H,G,U,Q,W,K,ne;return le(this,function(X){for(n=(t=e.lines).indices,a=lt(r=t.data),i=!!e.isPdbqt,o=0,s=0,j=0,b=t.count;j<b;j++)switch(_=n[2*j],C=n[2*j+1],r[_]){case"A":Ja(r,_,C,"ATOM  ")?o++:Ja(r,_,C,"ANISOU")&&s++;break;case"H":Ja(r,_,C,"HETATM")&&o++}for(u={},c=function YHe(e,t){var n=function(){return Ke.create(e,2*t)};return{index:0,group_PDB:n(),id:[],auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:[],label_entity_id:[],partial_charge:n()}}(r,o),l=function KHe(e,t){var n=function(){return new Float32Array(t)},a=function(){return Ke.create(e,2*t)};return{index:0,count:t,id:[],type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}(r,s),d=new Xl,f=[],p=[],h=0,m="",v=void 0,g=!1,y=new Set,j=0,b=t.count;j<b;j++)switch(_=n[2*j],C=n[2*j+1],r[_]){case"A":Ja(r,_,C,"ATOM  ")?(h||(h++,m=""+h),Dte(c,m,a,_,C,i)):Ja(r,_,C,"ANISOU")&&QHe(l,0,a,_,C);break;case"C":if(Ja(r,_,C,"CRYST1"))f.push.apply(f,BHe(e.id||"?",r.substring(_,C)));else if(Ja(r,_,C,"CONECT")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"CONECT");)x++;v?xr&&console.log("only single CONECT block allowed, ignoring others"):v=[j,x],j=x-1}else if(Ja(r,_,C,"COMPND")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"COMPND");)x++;d.setCompounds(qHe(t,j,x)),j=x-1}break;case"H":if(Ja(r,_,C,"HEADER"))JHe(r,_,C,u);else if(Ja(r,_,C,"HETATM"))h||(h++,m=""+h),Dte(c,m,a,_,C,i);else if(Ja(r,_,C,"HELIX")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"HELIX");)x++;f.push(GHe(t,j,x)),j=x-1}else if(Ja(r,_,C,"HETNAM")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"HETNAM");)x++;p.push.apply(p,Array.from(WHe(t,j,x).entries())),j=x-1}break;case"M":if(Ja(r,_,C,"MODEL ")&&(h++,m=""+h),Ja(r,_,C,"MTRIX")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"MTRIX");)x++;f.push.apply(f,UHe(t,j,x)),j=x-1}break;case"O":break;case"R":if(Ja(r,_,C,"REMARK 350")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"REMARK 350");)x++;f.push.apply(f,LHe(t,j,x)),j=x-1,g=!0}break;case"S":if(Ja(r,_,C,"SHEET")){for(x=j+1;Ja(r,_=n[2*x],C=n[2*x+1],"SHEET");)x++;f.push(HHe(t,j,x)),j=x-1}break;case"T":Ja(r,_,C,"TER")&&y.add(c.index)}for(u.id_code&&(A={id:ht.ofString(u.id_code)},f.push(io.ofFields("entry",A))),u.classification&&(T={pdbx_keywords:ht.ofString(u.classification)},f.push(io.ofFields("struct_keywords",T))),u.dep_date&&(w={recvd_initial_deposition_date:ht.ofString(u.dep_date)},f.push(io.ofFields("pdbx_database_status",w))),E=ie.ofIntTokens(c.auth_seq_id),I=ie.ofStringTokens(c.auth_atom_id),M=ie.ofStringTokens(c.auth_comp_id),F=ie.ofStringTokens(c.auth_asym_id),(N=new Kl(E,I)).setNames(p),d.setNames(p),j=0,k=M.rowCount;j<k;++j)H=M.value(j),G=Hh(N.add(H,j).type,H),c.label_entity_id[j]=d.getEntityId(H,G,F.value(j));for(U=function XHe(e,t,r){for(var n=ht.ofStrings(e.pdbx_PDB_model_num),a=ht.ofTokens(e.auth_asym_id),i=ht.ofTokens(e.auth_seq_id),o=ht.ofTokens(e.pdbx_PDB_ins_code),s=ht.ofTokens(e.auth_atom_id),u=ht.ofTokens(e.auth_comp_id),c=ht.ofStrings(e.id),l=n.str(0),d=a.str(0),f=i.int(0),p=o.str(0),h=d,m=f,v=new Map,g=new Map,y=[],b=[],_=[],C=!1,x=0,A=c.rowCount;x<A;++x)if(""!==o.str(x)){C=!0;break}for(x=0,A=c.rowCount;x<A;++x){var T=n.str(x),w=a.str(x),E=i.int(x),I=o.str(x),M=s.str(x);if(T!==l?(v.clear(),g.clear(),l=T,d=w,f=E,p=I,h=w,m=E):d!==w?(g.clear(),d=w,f=E,p=I,h=w,m=E):f!==E?(g.clear(),f===m?m=E:m+=1,f=E,p=I):p!==I&&(g.clear(),p=I,m+=1),v.has(w)){if(t.has(x)&&!r.hasAssemblies){var F=v.get(w)+1;v.set(w,F),h="".concat(w,"_").concat(F)}}else v.set(w,0);if(y[x]=h,g.has(M)){var N=g.get(M)+1;g.set(M,N),M="".concat(M,"_").concat(N)}else g.set(M,0);b[x]=M,C&&(_[x]=m)}var j=ie.ofStringArray(y),k=ie.ofStringArray(b),H=C?ht.ofColumn(ie.ofIntArray(_)):ht.ofUndefined(e.index,ie.Schema.int);return{auth_asym_id:a,auth_atom_id:s,auth_comp_id:u,auth_seq_id:i,B_iso_or_equiv:ht.ofTokens(e.B_iso_or_equiv),Cartn_x:ht.ofTokens(e.Cartn_x),Cartn_y:ht.ofTokens(e.Cartn_y),Cartn_z:ht.ofTokens(e.Cartn_z),group_PDB:ht.ofTokens(e.group_PDB),id:c,label_alt_id:ht.ofTokens(e.label_alt_id),label_asym_id:ht.ofColumn(j),label_atom_id:ht.ofColumn(k),label_comp_id:u,label_seq_id:H,label_entity_id:ht.ofStrings(e.label_entity_id),occupancy:ZIe(e.occupancy)?ht.ofUndefined(e.index,ie.Schema.float):ht.ofTokens(e.occupancy),type_symbol:ht.ofTokens(e.type_symbol),pdbx_PDB_ins_code:ht.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:n,partial_charge:ht.ofTokens(e.partial_charge)}}(c,y,{hasAssemblies:g}),i||delete U.partial_charge,v&&f.push(function $He(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;var u=[],c=[],l=[],d=[],f=[],p=[],h=[],m=[],v=[],g=[],y=[],b=[],_=[],C=[],x=[11,16,21,26],A=1;for(i=t;i<r;i++){var T=e.data.substring(e.indices[2*(j=i)],e.indices[2*j+1]),w=a[parseInt(T.substr(6,5))],E={};if(void 0!==w)for(var I=0;I<4;++I){var M=parseInt(T.substr(x[I],5));if(!Number.isNaN(M)){var F=a[M];void 0!==F&&(w>F||void 0===E[F]&&(u.push("covale".concat(A)),c.push("covale"),l.push(n.label_asym_id.str(w)),d.push(n.label_seq_id.int(w)),f.push(n.auth_seq_id.int(w)),p.push(n.label_atom_id.str(w)),h.push(n.label_alt_id.str(w)),m.push(n.pdbx_PDB_ins_code.str(w)),v.push(n.label_asym_id.str(F)),g.push(n.label_seq_id.int(F)),y.push(n.auth_seq_id.int(F)),b.push(n.label_atom_id.str(F)),_.push(n.label_alt_id.str(F)),C.push(n.pdbx_PDB_ins_code.str(F)),A+=1))}}}var j,N={id:ht.ofStrings(u),conn_type_id:ht.ofStrings(c),ptnr1_label_asym_id:ht.ofStrings(l),ptnr1_label_seq_id:ht.ofNumbers(d),ptnr1_auth_seq_id:ht.ofNumbers(f),ptnr1_label_atom_id:ht.ofStrings(p),pdbx_ptnr1_label_alt_id:ht.ofStrings(h),pdbx_ptnr1_PDB_ins_code:ht.ofStrings(m),ptnr2_label_asym_id:ht.ofStrings(v),ptnr2_label_seq_id:ht.ofNumbers(g),ptnr2_auth_seq_id:ht.ofNumbers(y),ptnr2_label_atom_id:ht.ofStrings(b),pdbx_ptnr2_label_alt_id:ht.ofStrings(_),pdbx_ptnr2_PDB_ins_code:ht.ofStrings(C)};return io.ofFields("struct_conn",N)}(t,v[0],v[1],U)),Q={entity:io.ofTable("entity",d.getEntityTable()),chem_comp:io.ofTable("chem_comp",N.getChemCompTable()),atom_site:io.ofFields("atom_site",U),atom_site_anisotrop:io.ofFields("atom_site_anisotrop",ZHe(l))},W=0,K=f;W<K.length;W++)Q[(ne=K[W]).name]=ne;return[2,{header:e.id||"PDB",categoryNames:Object.keys(Q),categories:Q}]})})}function t9e(e){var t=this;return Ve.create("Parse PDB",function(r){return ce(t,void 0,void 0,function(){var n,a,o,s,u,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return m.sent(),[4,e9e(e)];case 2:return n=m.sent(),[4,Wd(zc((a=Pn.fromFrame(n,void 0,BB.create(e))).data.db,!0),a,r)];case 3:return o=m.sent(),(s=null===(h=n.categories.atom_site)||void 0===h?void 0:h.getField("partial_charge"))&&1===o.frameCount&&(l=ie.isIdentity(c=(u=o.representative).atomicHierarchy.atomSourceIndex),d=l?void 0:c.toArray({array:Int32Array}),f=s.toFloatArray(),p=ie.ofFloatArray(d?ie.mapToArray(c,function(v){return f[v]},Float32Array):f),hb.Provider.set(u,{data:p,type:"GASTEIGER"})),[2,o]}})})})}function n9e(e){var t=this;return Ve.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(c){return n=LB.fromPsf(e),a=function r9e(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new Array(e.count),o=new Xl,s=new Kl(e.residueId,e.atomName),u="",c=0,l="",d=0,f=e.segmentName.value(0),p=!1,h=0,m=-1,v=0,g=e.count;v<g;++v){var y=e.residueId.value(v),b=e.segmentName.value(v);if(f!==b?(l=jS(c),c+=1,d=0,p=!0,f=b):p=!1,p||y!==m){var _=e.residueName.value(v),C=Hh(s.add(_,v).type,_);!p&&(C!==h||y!==m+1)&&(l=jS(c),c+=1,d=0),u=o.getEntityId(_,C,l),d+=1,m=y,h=C}t[v]=u,r[v]=l,n[v]=d,a[v]=v,i[v]=pb(e.atomName.value(v),e.residueName.value(v))}var x=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ie.ofIntArray(a),label_asym_id:ie.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ie.ofIntArray(n),label_entity_id:ie.ofStringArray(t),occupancy:ie.ofConst(1,e.count,ie.Schema.float),type_symbol:ie.ofStringArray(i),pdbx_PDB_model_num:ie.ofConst(1,e.count,ie.Schema.int)},e.count);return zc({entity:o.getEntityTable(),chem_comp:s.getChemCompTable(),atom_site:x})}(e.atoms),s=(i=e.bonds).atomIdB,u={indexA:ie.ofLambda({value:function(l){return o.value(l)-1},rowCount:(o=i.atomIdA).rowCount,schema:o.schema}),indexB:ie.ofLambda({value:function(l){return s.value(l)-1},rowCount:s.rowCount,schema:s.schema}),order:ie.ofConst(1,e.bonds.count,ie.Schema.int)},[2,g2.create(e.id,a,u,n)]})})})}function a9e(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function UB(e,t,r){return e&&void 0!==e[t]?e[t]:r}function tt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function KD(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro.".concat(e.info.name),{kind:"macro",symbol:e,translate:t,aliases:sr([e.info.name],r,!0)}}function i9e(e){return"alias"===e.kind||"macro"===e.kind}!function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=jl.create(e.Descriptor)}(hb||(hb={})),function(e){e.is=function t(n){return"pdb"===n?.kind},e.create=function r(n){return{kind:"pdb",name:n.id||"",data:n}}}(BB||(BB={})),function(e){e.is=function t(n){return"psf"===n?.kind},e.fromPsf=function r(n){return{kind:"psf",name:n.id,data:n}}}(LB||(LB={}));var o9e=[["Core symbols",tt(_e.core.type.bool,"bool"),tt(_e.core.type.num,"num"),tt(_e.core.type.str,"str"),tt(_e.core.type.regex,"regex"),tt(_e.core.type.list,"list"),tt(_e.core.type.set,"set"),tt(_e.core.type.compositeKey,"composite-key"),tt(_e.core.logic.not,"not"),tt(_e.core.logic.and,"and"),tt(_e.core.logic.or,"or"),tt(_e.core.ctrl.if,"if"),tt(_e.core.ctrl.fn,"fn"),tt(_e.core.ctrl.eval,"eval"),tt(_e.core.math.add,"add","+"),tt(_e.core.math.sub,"sub","-"),tt(_e.core.math.mult,"mult","*"),tt(_e.core.math.div,"div","/"),tt(_e.core.math.pow,"pow","**"),tt(_e.core.math.mod,"mod"),tt(_e.core.math.min,"min"),tt(_e.core.math.max,"max"),tt(_e.core.math.cantorPairing,"cantor-pairing"),tt(_e.core.math.sortedCantorPairing,"sorted-cantor-pairing"),tt(_e.core.math.invertCantorPairing,"invert-cantor-pairing"),tt(_e.core.math.floor,"floor"),tt(_e.core.math.ceil,"ceil"),tt(_e.core.math.roundInt,"round"),tt(_e.core.math.trunc,"trunc"),tt(_e.core.math.abs,"abs"),tt(_e.core.math.sign,"sign"),tt(_e.core.math.sqrt,"sqrt"),tt(_e.core.math.cbrt,"cbrt"),tt(_e.core.math.sin,"sin"),tt(_e.core.math.cos,"cos"),tt(_e.core.math.tan,"tan"),tt(_e.core.math.asin,"asin"),tt(_e.core.math.acos,"acos"),tt(_e.core.math.atan,"atan"),tt(_e.core.math.sinh,"sinh"),tt(_e.core.math.cosh,"cosh"),tt(_e.core.math.tanh,"tanh"),tt(_e.core.math.exp,"exp"),tt(_e.core.math.log,"log"),tt(_e.core.math.log10,"log10"),tt(_e.core.math.atan2,"atan2"),tt(_e.core.rel.eq,"eq","="),tt(_e.core.rel.neq,"neq","!="),tt(_e.core.rel.lt,"lt","<"),tt(_e.core.rel.lte,"lte","<="),tt(_e.core.rel.gr,"gr",">"),tt(_e.core.rel.gre,"gre",">="),tt(_e.core.rel.inRange,"in-range"),tt(_e.core.str.concat,"concat"),tt(_e.core.str.match,"regex.match"),tt(_e.core.list.getAt,"list.get"),tt(_e.core.set.has,"set.has"),tt(_e.core.set.isSubset,"set.subset")],["Structure",["Types",tt(_e.structureQuery.type.entityType,"ent-type"),tt(_e.structureQuery.type.authResidueId,"auth-resid"),tt(_e.structureQuery.type.labelResidueId,"label-resid"),tt(_e.structureQuery.type.ringFingerprint,"ringfp"),tt(_e.structureQuery.type.bondFlags,"bond-flags")],["Slots",tt(_e.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",tt(_e.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),tt(_e.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),tt(_e.structureQuery.generator.rings,"sel.atom.rings"),tt(_e.structureQuery.generator.empty,"sel.atom.empty"),tt(_e.structureQuery.generator.all,"sel.atom.all"),tt(_e.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),KD(E2("sel.atom.atoms",zt.Dictionary({0:pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Tt.ElementSelection,"A selection of singleton atom sets."),function(e){return de.struct.generator.atomGroups({"atom-test":UB(e,0,!0)})}),KD(E2("sel.atom.res",zt.Dictionary({0:pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Tt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return de.struct.generator.atomGroups({"residue-test":UB(e,0,!0),"group-by":de.ammp("residueKey")})}),KD(E2("sel.atom.chains",zt.Dictionary({0:pt(Ae.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Tt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return de.struct.generator.atomGroups({"chain-test":UB(e,0,!0),"group-by":de.ammp("chainKey")})})],["Modifiers",tt(_e.structureQuery.modifier.queryEach,"sel.atom.query-each"),tt(_e.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),tt(_e.structureQuery.modifier.exceptBy,"sel.atom.except-by"),tt(_e.structureQuery.modifier.unionBy,"sel.atom.union-by"),tt(_e.structureQuery.modifier.union,"sel.atom.union"),tt(_e.structureQuery.modifier.cluster,"sel.atom.cluster"),tt(_e.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),tt(_e.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),tt(_e.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),tt(_e.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",tt(_e.structureQuery.filter.pick,"sel.atom.pick"),tt(_e.structureQuery.filter.first,"sel.atom.first"),tt(_e.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),tt(_e.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),tt(_e.structureQuery.filter.within,"sel.atom.within"),tt(_e.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",tt(_e.structureQuery.combinator.intersect,"sel.atom.intersect"),tt(_e.structureQuery.combinator.merge,"sel.atom.merge"),tt(_e.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",tt(_e.structureQuery.atomSet.atomCount,"atom.set.atom-count"),tt(_e.structureQuery.atomSet.countQuery,"atom.set.count-query"),tt(_e.structureQuery.atomSet.reduce,"atom.set.reduce"),tt(_e.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",tt(_e.structureQuery.atomProperty.core.elementSymbol,"atom.el"),tt(_e.structureQuery.atomProperty.core.vdw,"atom.vdw"),tt(_e.structureQuery.atomProperty.core.mass,"atom.mass"),tt(_e.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),tt(_e.structureQuery.atomProperty.core.x,"atom.x"),tt(_e.structureQuery.atomProperty.core.y,"atom.y"),tt(_e.structureQuery.atomProperty.core.z,"atom.z"),tt(_e.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),tt(_e.structureQuery.atomProperty.core.operatorName,"atom.op-name"),tt(_e.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),tt(_e.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),tt(_e.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),tt(_e.structureQuery.atomProperty.core.atomKey,"atom.key"),tt(_e.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),tt(_e.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),tt(_e.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),tt(_e.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),tt(_e.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),tt(_e.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),tt(_e.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),tt(_e.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),tt(_e.structureQuery.atomProperty.macromolecular.id,"atom.id"),tt(_e.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),tt(_e.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),tt(_e.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),tt(_e.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),tt(_e.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),tt(_e.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),tt(_e.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),tt(_e.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),tt(_e.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),tt(_e.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),tt(_e.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),tt(_e.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),tt(_e.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),tt(_e.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),tt(_e.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),tt(_e.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),tt(_e.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),tt(_e.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),tt(_e.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),tt(_e.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),tt(_e.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),tt(_e.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),tt(_e.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",tt(_e.structureQuery.bondProperty.order,"bond.order"),tt(_e.structureQuery.bondProperty.length,"bond.length"),tt(_e.structureQuery.bondProperty.key,"bond.key"),tt(_e.structureQuery.bondProperty.atomA,"bond.atom-a"),tt(_e.structureQuery.bondProperty.atomB,"bond.atom-b"),KD(E2("bond.is",zt.List(Tt.BondFlag),Ae.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: ".concat(Ae.oneOfValues(Tt.BondFlag).join(", "))),function(e){return de.core.flags.hasAny([de.struct.bondProperty.flags(),de.struct.type.bondFlags(a9e(e))])})]]],Ete=[];!function Ite(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];i9e(n)?Ete.push(n):n instanceof Array&&Ite(n)}}(o9e);var ZD=function(){for(var e=[],t=Object.create(null),r=On.create(),n=On.create(),a=0,i=Ete;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){if(e.push([c=u[s],o]),t[c])throw new Error("Alias '".concat(c,"' already in use."));t[c]=o}var l=o.symbol.args;if("dictionary"===l.kind)for(var d=0,f=Object.keys(l.map);d<f.length;d++){var c=f[d];isNaN(c)&&On.add(r,c,c);var p=l.map[c];"oneof"===p.type.kind&&Ae.oneOfValues(p.type).forEach(function(m){return On.add(n,m,m)})}else"oneof"===l.type.kind&&Ae.oneOfValues(l.type).forEach(function(h){return On.add(n,h,h)})}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),mb=ZD.symbolMap;function qS(e){if(oo.isLiteral(e))return e;if(oo.isSymbol(e)){if(!mb[e.name])return e;var t=mb[e.name];if("alias"===t.kind)return oo.Symbol(mb[e.name].symbol.id);throw t.translate([])}var r=oo.isSymbol(e.head)&&!!mb[e.head.name]&&"macro"===mb[e.head.name].kind,n=r?e.head:qS(e.head),a=n!==e.head;if(!e.args)return r?qS(e.head):a?oo.Apply(n):e;var o,i=!1;if(oo.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++)(c=e.args[s])!==(l=qS(c))&&(i=!0),o[o.length]=l;if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var c,l,p=f[d];(c=e.args[p])!==(l=qS(c))&&(i=!0),o[p]=l}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var h=mb[e.head.name];return"macro"!==h.kind?oo.Apply(n,o):h.translate(o)}return oo.Apply(n,o)}function s9e(e){return qS(e)}var zB,We=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:Pte(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=function l9e(e,t){return"expected ".concat(function u9e(e){return 1===e.length?e[0]:"one of "+e.join(", ")}(t.expected)).concat(function c9e(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line ".concat(r.line," column ").concat(r.column,", got ").concat(a).concat(e.slice(n,n+12)).concat(i)}(e,t))}(t,r);throw new Error(n)},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return VB(1,"string"==typeof t?e.string(t):t,this,"string"==typeof r?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return VB(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;){if(!(i=sl(t._(r,n),i)).status)return sl(ws(n,a),i);if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}})},e.prototype.times=function(t,r){var n=this,a=typeof r>"u"?t:r;return new e(function(i,o){var l,s=[],u=void 0,c=void 0;for(l=0;l<t;l++){if(c=sl(u=n._(i,o),c),!u.status)return c;o=u.index,s.push(u.value)}for(;l<a&&(c=sl(u=n._(i,o),c),u.status);l+=1)o=u.index,s.push(u.value);return sl(ws(o,s),c)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return sr(sr([],r[0],!0),r[1],!0)})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?sl(ws(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return VB(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){return(0,r[0])(r[1])})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?sl(t(i.value)._(n,i.index),i):i})},e}();function VB(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new We(function(a,i){for(var o,s,u=i,c=0;c<n;c++){if(!(o=sl(t[c]._(a,u),o)).status)return o;e===c&&(s=o.value),u=o.index}return sl(ws(u,s),o)})}function ws(e,t){return{status:!0,index:e,value:t}}function Hp(e,t){return{status:!1,furthest:e,expected:[t]}}function sl(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?function d9e(e,t){var r=e.length,n=t.length;if(0===r)return t;if(0===n)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function Pte(e,t){var r=e.slice(0,t).split("\n");return{offset:t,line:r.length,column:r[r.length-1].length+1}}!function(e){function n(){for(var T=[],w=0;w<arguments.length;w++)T[w]=arguments[w];var E=T.length;return new e(function(I,M){for(var F,N=new Array(E),j=M,k=0;k<E;k++){if(!(F=sl(T[k]._(I,j),F)).status)return F;N[k]=F.value,j=F.index}return sl(ws(j,N),F)})}function a(){for(var T=[],w=0;w<arguments.length;w++)T[w]=arguments[w];return 0===T.length?f("zero alternates"):new e(function(I,M){for(var F,N=0;N<T.length;N++)if((F=sl(T[N]._(I,M),F)).status)return F;return F})}function o(T,w){return n(T,w.then(T).many()).map(function(I){return sr([I[0]],I[1],!0)})}function s(T){var w="'".concat(T,"'");if(1===T.length){var E=T.charCodeAt(0);return new e(function(I,M){return I.charCodeAt(M)===E?ws(M+1,T):Hp(M,w)})}return new e(function(I,M){var F=M+T.length;return I.slice(M,F)===T?ws(F,T):Hp(M,w)})}function l(T,w){void 0===w&&(w=0);var E=function c(T){return RegExp("^(?:"+T.source+")",function u(T){var w=""+T;return w.slice(w.lastIndexOf("/")+1)}(T))}(T),I=""+T;return new e(function(M,F){var N=E.exec(M.slice(F));return N?0<=w&&w<=N.length?ws(F+N[0].length,N[w]):Hp(F,"invalid match group (0 to ".concat(N.length,") in ").concat(I)):Hp(F,I)})}function d(T){return new e(function(w,E){return ws(E,T)})}function f(T){return new e(function(w,E){return Hp(E,T)})}function m(T){return new e(function(w,E){var I=w.charAt(E);return E<w.length&&T(I)?ws(E+1,I):Hp(E,"a character "+T)})}function _(T){var w=new e(function(E,I){var M=T()._;return w._=M,M(E,I)});return w}e.seqMap=function t(T,w,E){var I=[].slice.call(arguments);if(0===I.length)throw new Error("seqMap needs at least one argument");var M=I.pop();return function p9e(e){if("function"!=typeof e)throw new Error("not a function: "+e)}(M),n.apply(null,I).map(function(F){return M.apply(null,F)})},e.createLanguage=function r(T){for(var w={},E=0,I=Object.keys(T);E<I.length;E++)!function(F){w[F]=_(function(){return T[F](w)})}(I[E]);return w},e.seq=n,e.alt=a,e.sepBy=function i(T,w){return o(T,w).or(d([]))},e.sepBy1=o,e.string=s,e.regexp=l,e.succeed=d,e.fail=f,e.lookahead=function p(T){if(function f9e(e){return e instanceof We}(T))return new e(function(w,E){var I=T._(w,E);return I.status&&(I.index=E,I.value=null),I});if("string"==typeof T)return p(s(T));if(T instanceof RegExp)return p(l(T));throw new Error("not a string, regexp, or parser: "+T)},e.notFollowedBy=function h(T){return new e(function(w,E){var I=T._(w,E);return I.status?Hp(E,'not "'+w.slice(E,I.index)+'"'):ws(E,null)})},e.test=m,e.oneOf=function v(T){return m(function(w){return T.indexOf(w)>=0})},e.noneOf=function g(T){return m(function(w){return T.indexOf(w)<0})},e.range=function y(T,w){return m(function(E){return T<=E&&E<=w}).desc(T+"-"+w)},e.takeWhile=function b(T){return new e(function(w,E){for(var I=E;I<w.length&&T(w.charAt(I));)I++;return ws(I,w.slice(E,I))})},e.lazy=_,e.empty=function C(){return f("empty")},e.index=new e(function(T,w){return ws(w,Pte(T,w))}),e.anyChar=new e(function(T,w){return w>=T.length?Hp(w,"any character"):ws(w+1,T.charAt(w))}),e.all=new e(function(T,w){return ws(T.length,T.slice(w))}),e.eof=new e(function(T,w){return w<T.length?Hp(w,"EOF"):ws(w,null)}),e.digit=l(/[0-9]/).desc("a digit"),e.digits=l(/[0-9]*/).desc("optional digits"),e.letter=l(/[a-z]/i).desc("a letter"),e.letters=l(/[a-z]*/i).desc("optional letters"),e.optWhitespace=l(/\s*/).desc("optional whitespace"),e.whitespace=l(/\s+/).desc("whitespace"),e.cr=s("\r"),e.lf=s("\n"),e.crlf=s("\r\n"),e.newline=a(e.crlf,e.lf,e.cr).desc("newline"),e.end=a(e.newline,e.eof),e.of=function x(T){return d(T)},e.regex=function A(T){return l(T)}}(We||(We={})),function(e){var t,_;(_=t||(t={})).str=function C(w){return{kind:"string",value:w}},_.symb=function x(w){return{kind:"symbol",value:w}},_.list=function A(w,E){return{kind:"list",bracket:w,nodes:E}},_.comment=function T(w){return{kind:"comment",value:w}};var r=We.regexp(/[\n\r\s]*/),n=We.lazy(function(){return We.alt(a,d,i,o).trim(r)}),a=We.takeWhile(function(_){return"`"!==_}).trim("`").map(t.str),i=We.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=We.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(_){return t.list("(",_)}),c=s.wrap("[","]").map(function(_){return t.list("[",_)}),l=s.wrap("{","}").map(function(_){return t.list("{",_)}),d=We.alt(u,c,l),f=n.many();function h(_){switch(_.kind){case"string":return _.value;case"symbol":var C=_.value;if(C.length>1)switch(C.charAt(0)){case".":return de.atomName(C.substr(1));case"_":return de.struct.type.elementSymbol([C.substr(1)])}return"true"===C||"false"!==C&&(function y(_){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(_)&&!isNaN(+_)}(C)?+C:oo.Symbol(C));case"list":switch(_.bracket){case"[":return de.core.type.list(g(_.nodes).map(h));case"{":return de.core.type.set(g(_.nodes).map(h));case"(":if("comment"===_.nodes[0].kind)throw new Error("Invalid expression");var A=h(_.nodes[0]);return oo.Apply(A,function m(_){if(!(_.length<=1)){if(!function v(_){for(var C=1,x=_.length;C<x;C++){var A=_[C];if("symbol"===A.kind&&A.value.length>1&&":"===A.value.charAt(0))return!0}return!1}(_)){for(var C=[],x=1,A=_.length;x<A;x++)"comment"!==(T=_[x]).kind&&(C[C.length]=h(T));return C}var w={},E=!0,I=0;for(x=1,A=_.length;x<A;x++){var T;if("comment"!==(T=_[x]).kind)if("symbol"===T.kind&&T.value.length>1&&":"===T.value.charAt(0)){var M=T.value.substr(1);for(++x;x<A&&"comment"===_[x].kind;)x++;if(x>=A)throw new Error("There must be a value foolowed a named arg ':".concat(M,"'."));if("comment"===_[x].kind)throw new Error("Invalid expression");w[M]=h(_[x]),isNaN(+M)&&(E=!1)}else w[I++]=h(T)}if(E){var F=Object.keys(w).map(function(k){return+k}).sort(function(k,H){return k-H}),N=!0;for(x=0,A=F.length;x<A;x++)if(F[x]!==x){N=!1;break}if(N){var j=[];for(x=0,A=F.length;x<A;x++)j[x]=w[x];return j}}return w}}(_.nodes));default:xn()}default:xn()}}function g(_){for(var C=!1,x=0,A=_.length;x<A;x++)if("comment"===_[x].kind){C=!0;break}return C?_.filter(function(T){return"comment"!==T.kind}):_}e.parse=function b(_){for(var C=function p(_){return f.tryParse(_)}(_),x=[],A=0,T=C;A<T.length;A++){var w=T[A];"comment"!==w.kind&&(x[x.length]=h(w))}return x}}(zB||(zB={}));var qn=de;function As(e,t,r){var n=We.lazy(function(){return We.seq(e,n).map(function(a){return r.apply(void 0,a)}).or(t)});return n}function QD(e,t,r){return We.seqMap(t,e.many(),function(n,a){return a.reduce(function(i,o){return r(o,i)},n)})}function su(e,t,r){return We.seqMap(t,We.seq(e,t).many(),function(n,a){return a.reduce(function(i,o){return r(o[0],i,o[1])},n)})}function WS(e,t){return e.reduce(function(n,a){var i=a.isUnsupported?mm("operator '".concat(a.name,"' not supported")):a.map;return a.type(a.rule,n,i)},t)}function jp(e,t){return void 0===t&&(t=0),We.optWhitespace.then(We.regexp(e,t).skip(We.optWhitespace))}function vc(e,t){return void 0===t&&(t=0),We.regexp(e,t).skip(We.optWhitespace)}function $D(e,t){return void 0===t&&(t=0),We.optWhitespace.then(We.regexp(e,t))}function GB(e,t){var r=t?"".concat(e,"|").concat(I2(t)):e;return jp(RegExp("(".concat(r,")\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF"),"i"),2).map(parseFloat)}function mm(e){return function(){throw new Error(e)}}function HB(e){return 1===e.length?e[0]:e.length>1?qn.core.logic.and(e):void 0}function jB(e,t){if(!t||void 0===t.op||void 0===t.val)return t&&void 0!==t.flags?qn.core.flags.hasAny([e,t.flags]):t&&void 0!==t.min&&void 0!==t.max?qn.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?qn.core.set.has([qn.core.type.set(t),e]):qn.core.rel.eq([e,t[0]]):qn.core.rel.eq([e,t]);var r=[e,t.val];switch(t.op){case"=":return qn.core.rel.eq(r);case"!=":return qn.core.rel.neq(r);case">":return qn.core.rel.gr(r);case"<":return qn.core.rel.lt(r);case">=":return qn.core.rel.gre(r);case"<=":return qn.core.rel.lte(r);default:throw new Error("operator '".concat(t.op,"' not supported"))}}function gc(e){return qn.struct.generator.queryInSelection({0:e,query:qn.struct.generator.all(),"in-complement":!0})}function sf(e,t){return e.length<t.length?1:-1}function qB(e,t){var r=(t?[e].concat(t):[e]).sort(sf).map(I2).join("|");return RegExp("".concat(r),"i")}function Mte(e){var t=[];return Object.keys(e).sort(sf).forEach(function(r){var n=e[r],a=mm("property '".concat(r,"' not supported")),i=We.regexp(n.regex).map(function(u){return n.isUnsupported&&a(),jB(n.property,n.map(u))}),o=We.regexp(qB(r,n.abbr)).trim(We.optWhitespace),s=function(u){var c;return qn.struct.generator.atomGroups(((c={})[n.level]=u,c))};t.push(n.isNumeric?o.then(We.seq(We.regexp(/>=|<=|=|!=|>|</).trim(We.optWhitespace),We.regexp(n.regex).map(n.map))).map(function(u){return n.isUnsupported&&a(),jB(n.property,{op:u[0],val:u[1]})}).map(s):o.then(i).map(s))}),t}function WB(e){var t=[];return Object.keys(e).sort(sf).forEach(function(r){var n=e[r],a=n.map?n.map:mm("keyword '".concat(r,"' not supported")),i=We.regexp(qB(r,n.abbr)).map(a);t.push(i)}),t}function YB(e,t){var r=[];return Object.keys(e).sort(sf).forEach(function(n){var a=e[n],i=mm("property '".concat(n,"' not supported")),o=We.regexp(qB(n,a.abbr)).lookahead(t).map(function(){return a.isUnsupported&&i(),a.property});r.push(o)}),r}function XB(e,t,r,n){var a=[];for(var i in e)a.push(i),e[i].abbr&&a.push.apply(a,e[i].abbr);for(var o in t)a.push(o),t[o].abbr&&a.push.apply(a,t[o].abbr);return r.forEach(function(s){a.push(s.name),s.abbr&&a.push.apply(a,s.abbr)}),a}function uf(e){return qn.core.type.set(e.map(qn.atomName))}function cf(e){return qn.struct.generator.queryInSelection({0:e,query:qn.struct.generator.all()})}function YS(e,t,r){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return qn.atomName(t);case"structure-query.atom-property.core.element-symbol":return qn.es(t);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return r&&(t=[r[t.toUpperCase()]||"none"]),qn.struct.type.secondaryStructureFlags([t]);default:return t}}var y9e=["entityKey","label_entity_id","entityType"],b9e=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],_9e=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"],C9e=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function rn(e){return qn.struct.generator.atomGroups({"residue-test":qn.core.set.has([qn.core.type.set(e),qn.ammp("label_comp_id")])})}var mi=de,ul=/[-+]?[0-9]*\.?[0-9]+/,XS=/[0-9]+/;function Jt(e){return e}var w9e={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function Ote(e){if(e.head){if(e.head.name&&"core.type.regex"===e.head.name&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=w9e[e.toString().toLowerCase()]||"none",-1!==["dna","rna","carbohydrate"].indexOf(e))throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return mi.struct.type.secondaryStructureFlags([e])}}var Fte={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:Jt,level:"atom-test",property:mi.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:Jt,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:XS,map:function(e){return parseInt(e)},level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:XS,map:function(e){return parseInt(e)},level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:function(e){return mi.atomName(e)},level:"atom-test",property:mi.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:XS,map:function(e){return parseInt(e)},level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:function(e){return mi.atomName(e)},level:"atom-test",property:mi.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:XS,map:function(e){return parseInt(e)},level:"atom-test",property:mi.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:XS,map:function(e){return parseInt(e)},level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:Jt,level:"chain-test",property:mi.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:function(e){return mi.es(e)},level:"atom-test",property:mi.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:function(e){return parseInt(e)},level:"atom-test",property:mi.acp("atomicNumber")},eta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},theta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:Jt,level:"residue-test",property:mi.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:Jt,level:"residue-test",property:mi.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:Jt,level:"atom-test",property:mi.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:ul,map:function(e){return parseFloat(e)},level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:function(e){return parseInt(e)},level:"residue-test",property:mi.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:Jt,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:Jt,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:ul,map:function(e){return parseFloat(e)},level:"atom-test",property:mi.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"}},Nte=de,kte=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:As,rule:We.alt(We.regex(/NOT/i).skip(We.whitespace),We.string("!").skip(We.optWhitespace)),map:function(e,t){return gc(t)}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:su,rule:jp(/AND|&/i),map:function(e,t,r){return Nte.struct.modifier.intersectBy({0:t,by:r})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:su,rule:jp(/OR|\||,/i),map:function(e,t,r){return Nte.struct.combinator.merge([t,r])}}],Me=de,Ca={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},Bte_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],Bte_protein=["C","N","CA"];function KS(){return Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,Ca.nucleic),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.and([Me.core.rel.eq([Me.struct.atomSet.atomCount(),1]),Me.core.rel.eq([Me.ammp("label_atom_id"),Me.atomName("P")])])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.or([Me.core.set.isSubset([uf(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),Me.ammpSet("label_atom_id")]),Me.core.set.isSubset([uf(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),Me.ammpSet("label_atom_id")])])})])}var Lte={all:{"@desc":"all atoms; same as *",abbr:["*"],map:function(){return Me.struct.generator.all()}},bonded:{"@desc":"covalently bonded",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.gr([Me.struct.atomProperty.core.bondCount({flags:Me.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})}},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.gr([Me.struct.atomProperty.core.bondCount({flags:Me.struct.type.bondFlags()}),0])})}},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:function(){return Me.struct.generator.empty()}},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(Me.es)),Me.acp("elementSymbol")])})}},metal:{"@desc":"!nonmetal",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.logic.not([Me.core.set.has([Me.set.apply(Me,["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(Me.es)),Me.acp("elementSymbol")])])})}},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["Li","Na","K","Rb","Cs","Fr"].map(Me.es)),Me.acp("elementSymbol")])})}},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["Be","Mg","Ca","Sr","Ba","Ra"].map(Me.es)),Me.acp("elementSymbol")])})}},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["He","Ne","Ar","Kr","Xe","Rn"].map(Me.es)),Me.acp("elementSymbol")])})}},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["B","Si","Ge","As","Sb","Te"].map(Me.es)),Me.acp("elementSymbol")])})}},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.logic.or([Me.core.rel.inRange([Me.acp("atomicNumber"),21,30]),Me.core.rel.inRange([Me.acp("atomicNumber"),39,48]),Me.core.rel.inRange([Me.acp("atomicNumber"),72,80]),Me.core.rel.inRange([Me.acp("atomicNumber"),104,112]),Me.core.set.has([Me.set(57,89),Me.acp("atomicNumber")])])})}},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.inRange([Me.acp("atomicNumber"),57,71])})}},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.inRange([Me.acp("atomicNumber"),89,103])})}},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.gr([Me.struct.atomProperty.core.bondCount({flags:Me.struct.type.bondFlags(["aromatic"])}),0])})}},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":'any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, \', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.',map:function(){return KS()}},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:function(){return Me.struct.modifier.intersectBy({0:KS(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["A","G","I","DA","DG","DI","+A","+G","+I"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.set.isSubset([uf(["N7","C8","N9"]),Me.ammpSet("label_atom_id")])})])})}},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:function(){return Me.struct.modifier.intersectBy({0:KS(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["C","T","U","DC","DT","DU","+C","+T","+U"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.or([Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2*")]),Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2'")])])})])})}},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:function(){return Me.struct.modifier.intersectBy({0:KS(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.not([Me.core.logic.or([Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2*")]),Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2'")])])])})])})}},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:function(){return Me.struct.modifier.intersectBy({0:KS(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["G","C","A","U","I","+U","+I"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.or([Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2*")]),Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2'")])])})])})}},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:function(){return function A9e(){return Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,Ca.amino),Me.ammp("label_comp_id")])})}()}},acidic:{"@desc":"ASP GLU",map:function(){return rn(Ca.acidic)}},acyclic:{"@desc":"amino and not cyclic",map:function(){return Me.struct.modifier.intersectBy({0:rn(Ca.amino),by:gc(rn(Ca.cyclic))})}},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:function(){return rn(Ca.aliphatic)}},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:function(){return rn(Ca.amino)}},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:function(){return rn(Ca.aromatic)}},basic:{"@desc":"ARG HIS LYS",map:function(){return rn(Ca.basic)}},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:function(){return rn(Ca.buried)}},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:function(){return rn(Ca.acidic.concat(Ca.basic))}},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:function(){return rn(Ca.cyclic)}},helix:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["helix"]),Me.ammp("secondaryStructureFlags")])})}},helixalpha:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["alpha"]),Me.ammp("secondaryStructureFlags")])})}},helix310:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["3-10"]),Me.ammp("secondaryStructureFlags")])})}},helixpi:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["pi"]),Me.ammp("secondaryStructureFlags")])})}},hetero:{"@desc":"PDB atoms designated as HETATM",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.ammp("isHet")})}},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:function(){return rn(Ca.hydrophobic)}},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:function(){return rn(Ca.large)}},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:function(){return rn(Ca.medium)}},negative:{"@desc":"same as acidic -- ASP GLU",map:function(){return rn(Ca.acidic)}},neutral:{"@desc":"amino and not (acidic or basic)",map:function(){return Me.struct.modifier.intersectBy({0:rn(Ca.amino),by:gc(rn(Ca.acidic.concat(Ca.basic)))})}},polar:{"@desc":"amino and not hydrophobic",map:function(){return Me.struct.modifier.intersectBy({0:rn(Ca.amino),by:gc(rn(Ca.hydrophobic))})}},positive:{"@desc":"same as basic -- ARG HIS LYS",map:function(){return rn(Ca.basic)}},sheet:{"@desc":"secondary structure-related",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["sheet"]),Me.ammp("secondaryStructureFlags")])})}},small:{"@desc":"ALA GLY SER",map:function(){return rn(Ca.small)}},surface:{"@desc":"amino and not buried",map:function(){return Me.struct.modifier.intersectBy({0:rn(Ca.amino),by:gc(rn(Ca.buried))})}},turn:{"@desc":"secondary structure-related",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["turn"]),Me.ammp("secondaryStructureFlags")])})}},alpha:{"@desc":"(*.CA)",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.eq([Me.atomName("CA"),Me.ammp("label_atom_id")])})}},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:function(){return function T9e(){return Me.struct.combinator.merge([Me.struct.modifier.intersectBy({0:Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.core.type.set(Ca.amino),Me.ammp("label_comp_id")])}),by:Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.core.type.set(Bte_protein),Me.ammp("label_atom_id")])})}),Me.struct.modifier.intersectBy({0:Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.core.type.set(Ca.nucleic),Me.ammp("label_comp_id")])}),by:Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.core.type.set(Bte_nucleic),Me.ammp("label_atom_id")])})})])}()}},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}},Ar=de,D9e=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:su,rule:We.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:function(e,t,r){var n;if("structure"===t?n=Ar.core.flags.hasAny([Ar.ammp("secondaryStructureFlags"),Ote(r)]):"structure"===r?n=Ar.core.flags.hasAny([Ar.ammp("secondaryStructureFlags"),Ote(t)]):void 0!==t.head?"core.type.regex"===t.head.name&&(n=Ar.core.str.match([t,Ar.core.type.str([r])])):void 0!==r.head?"core.type.regex"===r.head.name&&(n=Ar.core.str.match([r,Ar.core.type.str([t])])):"LIKE"===e.toUpperCase()&&(n=Ar.core.str.match(t.head?[Ar.core.type.regex(["^".concat(r,"$"),"i"]),Ar.core.type.str([t])]:[Ar.core.type.regex(["^".concat(t,"$"),"i"]),Ar.core.type.str([r])])),!n)switch(t.head&&(r=YS(t,r)),r.head&&(t=YS(r,t)),e){case"=":n=Ar.core.rel.eq([t,r]);break;case"!=":n=Ar.core.rel.neq([t,r]);break;case">":n=Ar.core.rel.gr([t,r]);break;case"<":n=Ar.core.rel.lt([t,r]);break;case">=":n=Ar.core.rel.gre([t,r]);break;case"<=":n=Ar.core.rel.lte([t,r]);break;default:throw new Error("value operator '".concat(e,"' not supported"))}return Ar.struct.generator.atomGroups({"atom-test":n})}}];function E9e(e){var t=e[1],r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c={};o&&(c["chain-test"]=Ar.core.rel.eq([Ar.ammp("auth_asym_id"),o]));var l=[];r&&l.push(Ar.core.rel.eq([Ar.ammp("label_comp_id"),r])),n&&l.push(Ar.core.logic.and([Ar.core.rel.gre([Ar.ammp("auth_seq_id"),n[0]]),Ar.core.rel.lte([Ar.ammp("auth_seq_id"),n[1]])])),a&&l.push(Ar.core.rel.eq([Ar.ammp("auth_seq_id"),a])),i&&l.push(Ar.core.rel.eq([Ar.ammp("pdbx_PDB_ins_code"),i])),l.length&&(c["residue-test"]=HB(l));var d=[];return s&&d.push(Ar.core.rel.eq([Ar.ammp("auth_atom_id"),s])),u&&d.push(Ar.core.rel.eq([Ar.ammp("label_alt_id"),u])),d.length&&(c["atom-test"]=HB(d)),Ar.struct.generator.atomGroups(c)}var I9e=We.createLanguage({Integer:function(){return We.regexp(/-?[0-9]+/).map(Number).desc("integer")},Parens:function(e){return We.alt(e.Parens,e.Operator,e.Expression).wrap(We.regexp(/\(\s*/),We.regexp(/\s*\)/))},Expression:function(e){return We.alt(e.Keywords,e.AtomExpression.map(E9e),e.Within.map(function(t){return Ar.struct.modifier.includeSurroundings({0:t[1],radius:t[0]})}),e.ValueQuery,e.Element.map(function(t){return Ar.struct.generator.atomGroups({"atom-test":Ar.core.rel.eq([Ar.acp("elementSymbol"),Ar.struct.type.elementSymbol(t)])})}),e.Resname.map(function(t){return Ar.struct.generator.atomGroups({"residue-test":Ar.core.rel.eq([Ar.ammp("label_comp_id"),t])})}))},Operator:function(e){return WS(kte,We.alt(e.Parens,e.Expression))},AtomExpression:function(e){return We.seq(We.lookahead(e.AtomPrefix),We.seq(e.BracketedResname.or(We.of(null)),e.ResnoRange.or(We.of(null)),e.Resno.or(We.of(null)),e.Inscode.or(We.of(null)),e.Chainname.or(We.of(null)),e.Atomname.or(We.of(null)),e.Altloc.or(We.of(null)),e.Model.or(We.of(null)))).desc("expression")},AtomPrefix:function(){return We.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix")},Chainname:function(){return We.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname")},Model:function(){return We.regexp(/\/([0-9]+)/,1).map(Number).desc("model")},Element:function(){return We.regexp(/_([A-Za-z]{1,3})/,1).desc("element")},Atomname:function(){return We.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(Ar.atomName).desc("atomname")},Resname:function(){return We.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname")},Resno:function(e){return e.Integer.desc("resno")},Altloc:function(){return We.regexp(/%([a-zA-Z0-9])/,1).desc("altloc")},Inscode:function(){return We.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode")},BracketedResname:function(){return We.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname")},ResnoRange:function(e){return We.seq(e.Integer.skip(We.seq(We.optWhitespace,We.string("-"),We.optWhitespace)),e.Integer).desc("resno-range")},Within:function(e){return We.regexp(/within/i).skip(We.regexp(/\s*\(\s*/)).then(We.seq(e.Integer.skip(We.regexp(/\s*,\s*/)),e.Query)).skip(We.regexp(/\)/))},Keywords:function(){var e;return(e=We).alt.apply(e,WB(Lte)).desc("keyword")},Query:function(e){return We.alt(e.Operator,e.Parens,e.Expression).trim(We.optWhitespace)},Number:function(){return We.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){var e=XB(Fte,Lte,kte).sort(sf).map(I2).join("|");return We.alt(We.regexp(new RegExp("(?!(".concat(e,"))[A-Z0-9_]+"),"i")),We.regexp(/'((?:[^"\\]|\\.)*)'/,1),We.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(function(t){return Ar.core.type.regex(["^".concat(t,"$"),"i"])})).desc("string")},Value:function(e){return We.alt(e.Number,e.String)},ValueParens:function(e){return We.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(We.string("("),We.string(")"))},ValuePropertyNames:function(){var e;return(e=We).alt.apply(e,YB(Fte,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return WS(D9e,We.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return We.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return We.alt(e.ValueOperator.map(function(t){if(t.head){if(t.head.name.startsWith("structure-query.generator"))return t}else if("string"==typeof t&&t.length<=4)return Ar.struct.generator.atomGroups({"residue-test":Ar.core.rel.eq([Ar.ammp("label_comp_id"),t])});throw new Error("values must be part of an comparison, value '".concat(t,"'"))}))}}),Ho=de,JD=/[-+]?[0-9]*\.?[0-9]+/;function vb(e){return e.split("+").map(function(t){return t.replace(/^["']|["']$/g,"")})}function KB(e){if(e.includes("-")&&e.includes("+")){var t=e.split("+").map(function(u){return u.replace(/^["']|["']$/g,"")}),r=[];return t.forEach(function(u){if(u.includes("-")&&!u.startsWith("-"))for(var c=u.split("-").map(function(p){return parseInt(p)}),d=c[1],f=l=c[0];f<=d;f++)r.push(f);else if(u.includes("-")&&u.startsWith("-")&&u.match(/[0-9]+-[-0-9]+/)){var l=-parseInt(u.split("-")[1]);for(d=void 0,d=u.includes("--")?-parseInt(u.split("-")[3]):parseInt(u.split("-")[2]),f=l;f<=d;f++)r.push(f)}else u.includes("-")&&u.startsWith("-")&&u.match(/[0-9]+-[-0-9]+/),r.push(parseInt(u))}),r}if(e.includes("-")&&!e.includes("+")){var n=[];if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){var i=-parseInt(e.split("-")[1]),o=void 0;o=e.includes("--")?-parseInt(e.split("-")[3]):parseInt(e.split("-")[2]);for(var s=i;s<=o;s++)n.push(s)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),n.push(parseInt(e));else{var a=e.split("-").map(function(u){return parseInt(u)});for(o=a[1],s=i=a[0];s<=o;s++)n.push(s)}return n}return!e.includes("-")&&e.includes("+")?vb(e).map(function(u){return parseInt(u)}):[parseInt(e)]}var O9e={H:"helix",S:"beta",L:"none"},eE={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:function R9e(e){return e.split("+").map(Ho.struct.type.elementSymbol)},level:"atom-test",property:Ho.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:function M9e(e){return e.split("+").map(Ho.atomName)},level:"atom-test",property:Ho.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:vb,level:"residue-test",property:Ho.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:KB,level:"residue-test",property:Ho.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:vb,level:"atom-test",property:Ho.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:vb,level:"chain-test",property:Ho.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:vb,level:"chain-test",property:Ho.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:function(e){return parseInt(e)},level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:function(e){return parseInt(e)},level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:vb,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:KB,level:"atom-test",property:Ho.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:KB,level:"atom-test",property:Ho.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:function F9e(e){return{flags:Ho.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(function(t){return O9e[t]||"none"}))}},level:"residue-test",property:Ho.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:JD,map:function(e){return parseFloat(e)},level:"atom-test",property:Ho.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:JD,map:function(e){return parseFloat(e)},level:"atom-test",property:Ho.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:JD,map:function(e){return parseFloat(e)},level:"atom-test",property:Ho.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:JD,map:function(e){return parseFloat(e)},level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:function(e){return Ho.es(e)},level:"atom-test",property:Ho.acp("elementSymbol")}},lr=de,Ute=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:As,rule:We.alt(We.regexp(/NOT/i).skip(We.whitespace),We.string("!").skip(We.optWhitespace)),map:function(e,t){return gc(t)}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:su,rule:jp(/AND|&/i),map:function(e,t,r){return lr.struct.modifier.intersectBy({0:t,by:r})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:su,rule:jp(/OR|\|/i),map:function(e,t,r){return lr.struct.combinator.merge([t,r])}},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:su,rule:jp(/IN/i),map:function(e,t,r){return lr.struct.filter.withSameAtomProperties({0:t,source:r,property:lr.core.type.compositeKey([lr.ammp("label_atom_id"),lr.ammp("label_seq_id"),lr.ammp("label_comp_id"),lr.ammp("auth_asym_id"),lr.ammp("label_asym_id")])})}},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:su,rule:jp(/LIKE|l\./i),map:function(e,t,r){return lr.struct.filter.withSameAtomProperties({0:t,source:r,property:lr.core.type.compositeKey([lr.ammp("label_atom_id"),lr.ammp("label_seq_id")])})}},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:QD,rule:$D(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(function(e){return parseFloat(e)}),map:function(e,t){return lr.struct.filter.within({0:lr.struct.generator.all(),target:t,"atom-radius":lr.acp("vdw"),"max-radius":e,invert:!0})}},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:QD,rule:$D(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(function(e){return parseFloat(e)}),map:function(e,t){return lr.struct.modifier.exceptBy({0:lr.struct.filter.within({0:lr.struct.generator.all(),target:t,"max-radius":e}),by:t})}},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:QD,rule:$D(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(function(e){return parseFloat(e)}),map:function(e,t){return lr.struct.modifier.includeSurroundings({0:t,radius:e})}},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:su,rule:GB("WITHIN","w."),map:function(e,t,r){return lr.struct.filter.within({0:t,target:r,"max-radius":e})}},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:su,rule:GB("NEAR_TO","nto."),map:function(e,t,r){return lr.struct.modifier.exceptBy({0:lr.struct.filter.within({0:t,target:r,"max-radius":e}),by:r})}},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:su,rule:GB("BEYOND","be."),map:function(e,t,r){return lr.struct.modifier.exceptBy({0:lr.struct.filter.within({0:t,target:r,"max-radius":e,invert:!0}),by:r})}},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:As,rule:vc(/BYRESIDUE|byresi|byres|br\./i),map:function(e,t){return cf(lr.struct.modifier.expandProperty({0:lr.struct.modifier.union({0:t}),property:lr.ammp("residueKey")}))}},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:As,rule:vc(/BYCALPHA|bca\./i),map:function(e,t){return lr.struct.generator.queryInSelection({0:lr.struct.modifier.expandProperty({0:lr.struct.modifier.union({0:t}),property:lr.ammp("residueKey")}),query:lr.struct.generator.atomGroups({"atom-test":lr.core.rel.eq([lr.atomName("CA"),lr.ammp("label_atom_id")])})})}},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:As,rule:vc(/BYMOLECULE|bymol|bm\./i),map:function(e,t){return cf(lr.struct.modifier.expandProperty({0:lr.struct.modifier.union({0:t}),property:lr.atp("connectedComponentKey")}))}},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:As,rule:vc(/BYFRAGMENT|byfrag|bf\./i),map:function(e,t){return[e,t]}},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:As,rule:vc(/BYSEGMENT|bysegi|byseg|bs\./i),map:function(e,t){return cf(lr.struct.modifier.expandProperty({0:lr.struct.modifier.union({0:t}),property:lr.ammp("chainKey")}))}},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:As,rule:vc(/BYOBJECT|byobj|bo\./i),map:function(e,t){return[e,t]}},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:As,rule:vc(/BYCELL/i),map:function(e,t){return[e,t]}},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:As,rule:vc(/BYRING/i),map:function(e,t){return cf(lr.struct.modifier.intersectBy({0:lr.struct.filter.pick({0:lr.struct.generator.rings(),test:lr.core.logic.and([lr.core.rel.lte([lr.struct.atomSet.atomCount(),7]),lr.core.rel.gr([lr.struct.atomSet.countQuery([t]),1])])}),by:t}))}},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:As,abbr:["nbr."],rule:vc(/NEIGHBOR|nbr\./i),map:function(e,t){return lr.struct.modifier.exceptBy({0:cf(lr.struct.modifier.includeConnected({0:lr.struct.modifier.union({0:t}),"bond-test":!0})),by:t})}},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:As,rule:vc(/BOUND_TO|bto\./i),map:function(e,t){return cf(lr.struct.modifier.includeConnected({0:lr.struct.modifier.union({0:t})}))}},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:QD,rule:$D(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(function(e){return parseInt(e)}),map:function(e,t){return cf(lr.struct.modifier.includeConnected({0:lr.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}}],Pt=de,Ts={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},Vte_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],Vte_protein=["C","N","CA","O"];function zte(){return Pt.struct.combinator.merge([Pt.struct.modifier.intersectBy({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.protein),Pt.ammp("label_comp_id")])}),by:Pt.struct.generator.atomGroups({"atom-test":Pt.core.set.has([Pt.core.type.set(Vte_protein),Pt.ammp("label_atom_id")])})}),Pt.struct.modifier.intersectBy({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.nucleic),Pt.ammp("label_comp_id")])}),by:Pt.struct.generator.atomGroups({"atom-test":Pt.core.set.has([Pt.core.type.set(Vte_nucleic),Pt.ammp("label_atom_id")])})})])}var Gte={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:function(){return Pt.struct.generator.all()}},none:{"@desc":"No atoms (empty selection)",map:function(){return Pt.struct.generator.empty()}},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:function(){return Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.acp("elementSymbol"),Pt.es("H")])})}},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:function(){return Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.ammp("isHet"),!0])})}},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.nucleic.concat(Ts.protein)),Pt.ammp("label_comp_id")])})}},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:function(){return Pt.struct.modifier.exceptBy({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.nucleic.concat(Ts.protein)),Pt.ammp("label_comp_id")])}),by:zte()})}},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:function(){return Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.gr([Pt.struct.atomProperty.core.bondCount({flags:Pt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})}},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:function(){return cf(Pt.struct.modifier.expandProperty({0:Pt.struct.modifier.union([Pt.struct.generator.queryInSelection({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.logic.not([Pt.core.set.has([Pt.core.type.set(Ts.nucleic.concat(Ts.protein)),Pt.ammp("label_comp_id")])])}),query:Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.es("C"),Pt.acp("elementSymbol")])})})]),property:Pt.ammp("residueKey")}))}},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:function(){return cf(Pt.struct.modifier.expandProperty({0:Pt.struct.modifier.union([Pt.struct.filter.pick({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.logic.not([Pt.core.set.has([Pt.core.type.set(Ts.nucleic.concat(Ts.protein).concat(Ts.solvent)),Pt.ammp("label_comp_id")])]),"group-by":Pt.ammp("residueKey")}),test:Pt.core.logic.not([Pt.core.set.has([Pt.struct.atomSet.propertySet([Pt.acp("elementSymbol")]),Pt.es("C")])])})]),property:Pt.ammp("residueKey")}))}},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.solvent),Pt.ammp("label_comp_id")])})}},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:function(){return Pt.struct.combinator.merge([Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.atomName("CA"),Pt.ammp("label_atom_id")]),"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.protein),Pt.ammp("label_comp_id")])}),Pt.struct.generator.atomGroups({"atom-test":Pt.core.set.has([uf(["C4*","C4'"]),Pt.ammp("label_atom_id")]),"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.nucleic),Pt.ammp("label_comp_id")])})])}},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:function(){return zte()}},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.protein),Pt.ammp("label_comp_id")])})}},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(Ts.nucleic),Pt.ammp("label_comp_id")])})}}},N9e=de,vi=function v9e(e){var t={};return Object.keys(e).sort(sf).forEach(function(r){var n=e[r],a=mm("property '".concat(r,"' not supported")),i=We.regexp(n.regex).map(function(o){return n.isUnsupported&&a(),jB(n.property,n.map(o))});n.isNumeric||(t[r]=i)}),t}(eE),Ii=We.string("/");function ha(e){return e.or(We.of(null))}function k9e(e){var t={},r={};for(var n in e){var a=eE[n];if(!a)throw new Error("property '".concat(n,"' not supported, value '").concat(e[n],"'"));null!==e[n]&&(r[a.level]||(r[a.level]=[]),r[a.level].push(e[n]))}for(var i in r)t[i]=HB(r[i]);return N9e.struct.generator.atomGroups(t)}var B9e=We.createLanguage({Parens:function(e){return We.alt(e.Parens,e.Operator,e.Expression).wrap(We.string("("),We.string(")"))},Expression:function(e){return We.alt(e.Keywords,e.AtomSelectionMacro.map(k9e),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return We.alt(Ii.then(We.alt(We.seq(ha(e.ObjectProperty).skip(Ii),ha(vi.segi).skip(Ii),ha(vi.chain).skip(Ii),ha(vi.resi).skip(Ii),ha(vi.name)).map(function(t){return{object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]}}),We.seq(ha(e.ObjectProperty).skip(Ii),ha(vi.segi).skip(Ii),ha(vi.chain).skip(Ii),ha(vi.resi)).map(function(t){return{object:t[0],segi:t[1],chain:t[2],resi:t[3]}}),We.seq(ha(e.ObjectProperty).skip(Ii),ha(vi.segi).skip(Ii),ha(vi.chain)).map(function(t){return{object:t[0],segi:t[1],chain:t[2]}}),We.seq(ha(e.ObjectProperty).skip(Ii),ha(vi.segi)).map(function(t){return{object:t[0],segi:t[1]}}),We.seq(ha(e.ObjectProperty)).map(function(t){return{object:t[0]}}))),We.alt(We.seq(ha(e.ObjectProperty).skip(Ii),ha(vi.segi).skip(Ii),ha(vi.chain).skip(Ii),ha(vi.resi).skip(Ii),ha(vi.name)).map(function(t){return{object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]}}),We.seq(ha(vi.segi).skip(Ii),ha(vi.chain).skip(Ii),ha(vi.resi).skip(Ii),ha(vi.name)).map(function(t){return{segi:t[0],chain:t[1],resi:t[2],name:t[3]}}),We.seq(ha(vi.chain).skip(Ii),ha(vi.resi).skip(Ii),ha(vi.name)).map(function(t){return{chain:t[0],resi:t[1],name:t[2]}}),We.seq(ha(vi.resi).skip(Ii),ha(vi.name)).map(function(t){return{resi:t[0],name:t[1]}})))},NamedAtomProperties:function(){var e;return(e=We).alt.apply(e,Mte(eE))},Keywords:function(){var e;return(e=We).alt.apply(e,WB(Gte))},ObjectProperty:function(){var e=XB(eE,Gte,Ute).sort(sf).map(I2).join("|");return We.regexp(new RegExp("(?!(".concat(e,"))[A-Z0-9_]+"),"i"))},Object:function(e){return e.ObjectProperty.notFollowedBy(Ii).map(function(t){throw new Error("property 'object' not supported, value '".concat(t,"'"))})},Pepseq:function(){return We.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(mm("operator 'pepseq' not supported"))},Rep:function(){return We.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(mm("operator 'rep' not supported"))},Operator:function(e){return WS(Ute,We.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return We.alt(e.Operator,e.Parens,e.Expression).trim(We.optWhitespace)}}),oi=de,Ou=/[-+]?[0-9]*\.?[0-9]+/,tE=/[+]?[0-9]+/,ZS=/[-+]?[0-9]+/;function og(e){return e}var Hte={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function ZB(e){return oi.struct.type.secondaryStructureFlags([Hte[e.toUpperCase()]||"none"])}var sg={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:oi.atomName,level:"atom-test",property:oi.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:og,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:tE,map:function(e){return parseInt(e)-1},level:"atom-test",property:oi.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:tE,map:function(e){return parseInt(e)},level:"atom-test",property:oi.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:tE,map:function(e){return parseInt(e)},level:"atom-test",property:oi.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:function(e){return oi.es(e)},level:"atom-test",property:oi.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:og,level:"atom-test",property:oi.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:og,level:"residue-test",property:oi.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:ZS,map:function(e){return parseInt(e)},level:"residue-test",property:oi.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:ZS,map:function(e){return parseInt(e)},level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:ZS,map:function(e){return parseInt(e)},level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:ZS,map:function(e){return parseInt(e)},level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:og,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:tE,map:function(e){return parseInt(e)},level:"atom-test",property:oi.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:og,level:"residue-test",property:oi.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:ZS,map:function(e){return parseInt(e)},level:"residue-test",property:oi.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:og,level:"residue-test",property:oi.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:og,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:ZB,level:"atom-test",property:oi.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:Ou,map:function(e){return parseFloat(e)},level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:Ou,map:function(e){return parseInt(e)},level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:Ou,map:function(e){return parseInt(e)},level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:Ou,map:function(e){return parseInt(e)},level:"atom-test"}},ug=de,U9e=Object.keys(sg).sort(sf).filter(function(e){return!sg[e].isUnsupported}).join("|"),jte=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:As,rule:We.regexp(/NOT/i).skip(We.whitespace),map:function(e,t){return gc(t)}},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:As,rule:vc(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(function(e){return parseFloat(e)}),map:function(e,t){return ug.struct.modifier.includeSurroundings({0:t,radius:e})}},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:As,rule:vc(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(function(e){return parseFloat(e)}),map:function(e,t){return ug.struct.modifier.exceptBy({0:ug.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})}},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:As,rule:vc(new RegExp("SAME\\s+(".concat(U9e,")\\s+AS"),"i"),1).map(function(e){return sg[e].property}),map:function(e,t){return ug.struct.filter.withSameAtomProperties({0:ug.struct.generator.all(),source:t,property:e})}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:su,rule:We.alt(jp(/AND/i),We.whitespace),map:function(e,t,r){return ug.struct.modifier.intersectBy({0:t,by:r})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:su,rule:jp(/OR/i),map:function(e,t,r){return ug.struct.combinator.merge([t,r])}}],Er=de;function qp(){return Er.struct.filter.pick({0:Er.struct.generator.atomGroups({"group-by":Er.ammp("residueKey")}),test:Er.core.set.isSubset([uf(["C","N","CA","O"]),Er.ammpSet("label_atom_id")])})}function QB(){return Er.struct.filter.pick({0:Er.struct.generator.atomGroups({"group-by":Er.ammp("residueKey")}),test:Er.core.logic.and([Er.core.set.isSubset([uf(["P"]),Er.ammpSet("label_atom_id")]),Er.core.logic.or([Er.core.set.isSubset([uf(["O3'","C3'","C4'","C5'","O5'"]),Er.ammpSet("label_atom_id")]),Er.core.set.isSubset([uf(["O3*","C3*","C4*","C5*","O5*"]),Er.ammpSet("label_atom_id")])])])})}function qte(){return Er.struct.combinator.merge([Er.struct.generator.queryInSelection({0:qp(),query:Er.struct.generator.atomGroups({"atom-test":Er.core.set.has([uf(Wte.protein),Er.ammp("label_atom_id")])})}),Er.struct.generator.queryInSelection({0:QB(),query:Er.struct.generator.atomGroups({"atom-test":Er.core.set.has([uf(Wte.nucleic),Er.ammp("label_atom_id")])})})])}function lf(e){return Er.struct.generator.atomGroups({"residue-test":Er.core.flags.hasAll([Er.ammp("secondaryStructureFlags"),Er.struct.type.secondaryStructureFlags(e)])})}var Xte,cg,QS,gb,Wte={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},Pi={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},Yte={all:{"@desc":"everything",map:function(){return Er.struct.generator.all()}},none:{"@desc":"nothing",map:function(){return Er.struct.generator.empty()}},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:function(){return qp()}},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:function(){return QB()}},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:function(){return qte()}},sidechain:{"@desc":"non-backbone atoms and bonds",map:function(){return gc(qte())}},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:function(){return rn(Pi.water)}},at:{"@desc":"residues named ADA A THY T",map:function(){return rn(Pi.at)}},acidic:{"@desc":"residues named ASP GLU",map:function(){return rn(Pi.acidic)}},acyclic:{"@desc":'"protein and not cyclic"',map:function(){return Er.struct.modifier.intersectBy({0:qp(),by:gc(rn(Pi.cyclic))})}},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:function(){return rn(Pi.aliphatic)}},alpha:{"@desc":"atom's residue is an alpha helix",map:function(){return lf(["alpha"])}},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:function(){return qp()}},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:function(){return rn(Pi.aromatic)}},basic:{"@desc":"residues named ARG HIS LYS",map:function(){return rn(Pi.basic)}},bonded:{"@desc":"atoms for which numbonds > 0",map:function(){return cf(Er.struct.filter.pick({0:Er.struct.modifier.includeConnected({0:Er.struct.generator.all(),"bond-test":Er.core.flags.hasAny([Er.struct.bondProperty.flags(),Er.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:Er.core.rel.gr([Er.struct.atomSet.atomCount(),1])}))}},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:function(){return rn(Pi.buried)}},cg:{"@desc":"residues named CYT C GUA G",map:function(){return rn(Pi.cg)}},charged:{"@desc":'"basic or acidic"',map:function(){return rn(Pi.basic.concat(Pi.acidic))}},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:function(){return rn(Pi.cyclic)}},hetero:{"@desc":'"not (protein or nucleic)"',map:function(){return gc(Er.struct.combinator.merge([qp(),QB()]))}},hydrogen:{"@desc":'name "[0-9]?H.*"',map:function(){return Er.struct.generator.atomGroups({"atom-test":Er.core.str.match([Er.core.type.regex(["^[0-9]?[H].*$","i"]),Er.core.type.str([Er.ammp("label_atom_id")])])})}},large:{"@desc":'"protein and not (small or medium)"',map:function(){return Er.struct.modifier.intersectBy({0:qp(),by:gc(rn(Pi.small.concat(Pi.medium)))})}},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:function(){return rn(Pi.medium)}},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:function(){return rn(Pi.neutral)}},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:function(){return rn(Pi.hydrophobic)}},polar:{"@desc":'"protein and not hydrophobic"',map:function(){return Er.struct.modifier.intersectBy({0:qp(),by:gc(rn(Pi.hydrophobic))})}},purine:{"@desc":"residues named ADE A GUA G",map:function(){return rn(Pi.purine)}},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:function(){return rn(Pi.pyrimidine)}},small:{"@desc":"residues named ALA GLY SER",map:function(){return rn(Pi.small)}},surface:{"@desc":'"protein and not buried"',map:function(){return Er.struct.modifier.intersectBy({0:qp(),by:gc(rn(Pi.buried))})}},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:function(){return lf(["alpha"])}},pi_helix:{"@desc":"atom's residue is in a pi helix",map:function(){return lf(["pi"])}},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:function(){return lf(["3-10"])}},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:function(){return lf(["helix"])}},extended_beta:{"@desc":"atom's residue is a beta sheet",map:function(){return lf(["sheet"])}},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:function(){return lf(["strand"])}},sheet:{"@desc":"atom's residue is a beta sheet",map:function(){return lf(["beta"])}},turn:{"@desc":"atom's residue is in a turn conformation",map:function(){return lf(["turn"])}},coil:{"@desc":"atom's residue is in a coil conformation",map:function(){return Er.struct.modifier.intersectBy({0:qp(),by:lf(["none"])})}}},os=de,V9e={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:function(e){return os.core.math.pow([e,2])}},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:function(e){return os.core.math.sqrt([e])}},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:function(e){return os.core.math.abs([e])}},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:function(e){return os.core.math.floor([e])}},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:function(e){return os.core.math.ceil([e])}},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:function(e){return os.core.math.sin([e])}},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:function(e){return os.core.math.cos([e])}},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:function(e){return os.core.math.tan([e])}},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:function(e){return os.core.math.atan([e])}},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:function(e){return os.core.math.asin([e])}},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:function(e){return os.core.math.acos([e])}},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:function(e){return os.core.math.sinh([e])}},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:function(e){return os.core.math.cosh([e])}},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:function(e){return os.core.math.tanh([e])}},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:function(e){return os.core.math.exp([e])}},log:{"@desc":"natural log of x","@examples":["log(2)"],map:function(e){return os.core.math.log([e])}},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:function(e){return os.core.math.log10([e])}}},Da=de,z9e=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:su,rule:We.regexp(/\s*(\*|\/)\s*/,1),map:function(e,t,r){switch(e){case"*":return Da.core.math.mult([t,r]);case"/":return Da.core.math.div([t,r]);default:throw new Error("value operator '".concat(e,"' not supported"))}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:su,rule:We.regexp(/\s*(-|\+)\s*/,1),map:function(e,t,r){switch(e){case"-":return Da.core.math.sub([t,r]);case"+":return Da.core.math.add([t,r]);default:throw new Error("value operator '".concat(e,"' not supported"))}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:su,rule:We.alt(We.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),We.whitespace.result("=")),map:function(e,t,r){var n;if(void 0!==t.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===t.head.name&&(n=Da.core.flags.hasAny([t,ZB(r)])),"core.type.regex"===t.head.name&&(n=Da.core.str.match([t,Da.core.type.str([r])]))):void 0!==r.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===r.head.name&&(n=Da.core.flags.hasAny([r,ZB(t)])),"core.type.regex"===r.head.name&&(n=Da.core.str.match([r,Da.core.type.str([t])]))):"=~"===e&&(n=Da.core.str.match(t.head?[Da.core.type.regex(["^".concat(r,"$"),"i"]),Da.core.type.str([t])]:[Da.core.type.regex(["^".concat(t,"$"),"i"]),Da.core.type.str([r])])),!n)switch(t.head&&(r=YS(t,r)),r.head&&(t=YS(r,t)),e){case"=":case"==":n=Da.core.rel.eq([t,r]);break;case"!=":n=Da.core.rel.neq([t,r]);break;case">":n=Da.core.rel.gr([t,r]);break;case"<":n=Da.core.rel.lt([t,r]);break;case">=":n=Da.core.rel.gre([t,r]);break;case"<=":n=Da.core.rel.lte([t,r]);break;default:throw new Error("value operator '".concat(e,"' not supported"))}return Da.struct.generator.atomGroups({"atom-test":n})}}],G9e=We.createLanguage({Parens:function(e){return We.alt(e.Parens,e.Operator,e.Expression).wrap(We.string("("),We.string(")"))},Expression:function(e){return We.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){var e;return(e=We).alt.apply(e,Mte(sg))},Keywords:function(){var e;return(e=We).alt.apply(e,WB(Yte))},ValueRange:function(e){return We.seq(e.Value.skip(We.regexp(/\s+TO\s+/i)),e.Value).map(function(t){return{range:t}})},RangeListProperty:function(e){var t;return We.seq((t=We).alt.apply(t,YB(sg,/\s/)).skip(We.whitespace),We.alt(e.ValueRange,e.Value).sepBy1(We.whitespace)).map(function(r){var n,a=r[0],o=[],s=[];r[1].forEach(function(d){d.range?s.push(Da.core.rel.inRange([a,d.range[0],d.range[1]])):o.push(YS(a,d,Hte))});var l,u=function m9e(e){return 1===e.length?e[0]:e.length>1?qn.core.logic.or(e):void 0}(s),c=function x9e(e,t){if(C9e.includes(e.head.name)){var r=t[0].head,n=[];return t.forEach(function(a){return n.push.apply(n,a.args[0])}),qn.core.flags.hasAny([e,{head:r,args:n}])}return 1===t.length?qn.core.rel.eq([e,t[0]]):t.length>1?qn.core.set.has([qn.core.type.set(t),e]):void 0}(a,o);return l=u&&c?Da.core.logic.or([u,c]):u||c,Da.struct.generator.atomGroups(((n={})[function S9e(e){if(e.head.name.startsWith("structure-query.atom-property.macromolecular.")){var t=e.head.name.substr(45);if(y9e.includes(t))return"entity-test";if(b9e.includes(t))return"chain-test";if(_9e.includes(t))return"residue-test"}return"atom-test"}(a)]=l,n))})},Operator:function(e){return WS(jte,We.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return We.alt(e.Operator,e.Parens,e.Expression).trim(We.optWhitespace)},Number:function(){return We.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){var e=XB(sg,Yte,jte).sort(sf).map(I2).join("|");return We.alt(We.regexp(new RegExp("(?!(".concat(e,"))[A-Z0-9_]+"),"i")),We.regexp(/'((?:[^"\\]|\\.)*)'/,1),We.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(function(t){return Da.core.type.regex(["^".concat(t,"$"),"i"])})).desc("string")},Value:function(e){return We.alt(e.Number,e.String)},ValueParens:function(e){return We.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(We.string("("),We.string(")"))},ValuePropertyNames:function(){var e;return(e=We).alt.apply(e,YB(sg,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return WS(z9e,We.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return We.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){var t;return(t=We).alt.apply(t,function g9e(e,t){var r=[],n=We.regexp(/\(\s*/),a=We.regexp(/\s*\)/);return Object.keys(e).sort(sf).forEach(function(i){var o=e[i],s=o.map?o.map:mm("function '".concat(i,"' not supported")),u=We.regexp(new RegExp(i,"i")).skip(n).then(t).skip(a).map(s);r.push(u)}),r}(V9e,e.ValueOperator))},ValueQuery:function(e){return We.alt(e.ValueOperator.map(function(t){if(!t.head.name||!t.head.name.startsWith("structure-query.generator"))throw new Error("values must be part of an comparison, value '".concat(t,"'"));return t}))}}),j9e={pymol:function(e){return B9e.Query.tryParse(e)},vmd:function(e){return G9e.Query.tryParse(e)},jmol:function(e){return I9e.Query.tryParse(e)}},q9e=j9e,Y9e=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '".concat(t.symbol.id,"' already added. Call removeSymbol/removeCustomProps re-adding the symbol.")),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++)this.addSymbol(t.symbols[n[r]])},e.prototype.removeCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++)this.removeSymbol(t.symbols[n[r]])},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),rE=new Y9e,X9e=function(){return function e(t){this.table=t,this.constQueryContext=new Uc(Ye.Empty)}}();!function(e){e.Const=function t(n){return{kind:"const",value:n}},e.Dynamic=function r(n){return{kind:"dynamic",runtime:n}}}(Xte||(Xte={})),function(e){e.Const=function t(n){return{isConst:!0,fn:function(i){return n}}},e.Dynamic=function r(n){return{isConst:!1,fn:n}}}(cg||(cg={})),function(e){e.forEachEval=function t(r,n,a,i){if("number"==typeof r.length)for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else{o=0;for(var u=0,c=Object.keys(r);u<c.length;u++)a(r[c[u]](n),o++,i)}return i}}(QS||(QS={})),function(e){e.Const=function t(n,a){return new Kte(n,a,!0)},e.Dynamic=function r(n,a){return new Kte(n,a,!1)}}(gb||(gb={}));var Kte=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(r)if(oo.isArgumentsArray(r)){n=[],a=!0;for(var i=0,o=r;i<o.length;i++){var u=$B(t,o[i]);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!0;for(var c=0,l=Object.keys(r);c<l.length;c++){var d=l[c];u=$B(t,r[d]),a=a&&u.isConst,n[d]=u.fn}}else n=void 0,a=!0;return this.isConst&&this.isConst&&a?cg.Const(this.fn(t.constQueryContext,n)):cg.Dynamic(function Zte(e,t){return function(n){return e(n,t)}}(this.fn,n))},e}();function $B(e,t){if(oo.isLiteral(t))return cg.Const(t);if(oo.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):cg.Const(t.name)}if(!oo.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '".concat(t.head.name,"' is not implemented."));return n.compile(e,t.args)}function $S(e){return $B(new X9e(rE),e).fn}var nr=gb.Const,jt=gb.Dynamic,K9e=[nr(_e.core.type.bool,function(t,r){return!!r[0](t)}),nr(_e.core.type.num,function(t,r){return+r[0](t)}),nr(_e.core.type.str,function(t,r){return""+r[0](t)}),nr(_e.core.type.list,function(t,r){return QS.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),nr(_e.core.type.set,function(t,r){return QS.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),nr(_e.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),nr(_e.core.type.bitflags,function(t,r){return+r[0](t)}),nr(_e.core.type.compositeKey,function(t,r){return QS.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),nr(_e.core.logic.not,function(e,t){return!t[0](e)}),nr(_e.core.logic.and,function(e,t){if("number"==typeof t.length){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++)if(!t[i[a]](e))return!1;return!0}),nr(_e.core.logic.or,function(e,t){if("number"==typeof t.length){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++)if(t[i[a]](e))return!0;return!1}),nr(_e.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),nr(_e.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),nr(_e.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),nr(_e.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),nr(_e.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),nr(_e.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),nr(_e.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),nr(_e.core.math.add,function(e,t){var r=0;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++)r+=t[o[i]](e);return r}),nr(_e.core.math.sub,function(e,t){var r=0;if("number"==typeof t.length){if(1===t.length)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(1===i.length)return-t[i[0]](e);for(r=t[i[0]](e)||0,n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),nr(_e.core.math.mult,function(e,t){var r=1;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++)r*=t[o[i]](e);return r}),nr(_e.core.math.div,function(e,t){return t[0](e)/t[1](e)}),nr(_e.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),nr(_e.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),nr(_e.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++)r=Math.min(t[o[i]](e),r);return r}),nr(_e.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++)r=Math.max(t[o[i]](e),r);return r}),nr(_e.core.math.cantorPairing,function(e,t){return nc(t[0](e),t[1](e))}),nr(_e.core.math.sortedCantorPairing,function(e,t){return w2(t[0](e),t[1](e))}),nr(_e.core.math.invertCantorPairing,function(e,t){return gX([0,0],t[0](e))}),nr(_e.core.math.floor,function(e,t){return Math.floor(t[0](e))}),nr(_e.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),nr(_e.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),nr(_e.core.math.trunc,function(e,t){return Math.trunc(t[0](e))}),nr(_e.core.math.abs,function(e,t){return Math.abs(t[0](e))}),nr(_e.core.math.sign,function(e,t){return Math.sign(t[0](e))}),nr(_e.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),nr(_e.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),nr(_e.core.math.sin,function(e,t){return Math.sin(t[0](e))}),nr(_e.core.math.cos,function(e,t){return Math.cos(t[0](e))}),nr(_e.core.math.tan,function(e,t){return Math.tan(t[0](e))}),nr(_e.core.math.asin,function(e,t){return Math.asin(t[0](e))}),nr(_e.core.math.acos,function(e,t){return Math.acos(t[0](e))}),nr(_e.core.math.atan,function(e,t){return Math.atan(t[0](e))}),nr(_e.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),nr(_e.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),nr(_e.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),nr(_e.core.math.exp,function(e,t){return Math.exp(t[0](e))}),nr(_e.core.math.log,function(e,t){return Math.log(t[0](e))}),nr(_e.core.math.log10,function(e,t){return Math.log10(t[0](e))}),nr(_e.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),nr(_e.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),nr(_e.core.str.concat,function(e,t){var r=[];if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++)r.push(t[o[i]](e).toString());return r.join("")}),nr(_e.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),nr(_e.core.list.equal,function(e,t){return iX(t[0](e),t[1](e))}),nr(_e.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),nr(_e.core.set.isSubset,function(t,r){return fa.isSuperset(r[1](t),r[0](t))}),nr(_e.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?0!=(n&r):!!n}),nr(_e.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),nr(_e.structureQuery.type.elementSymbol,function(e,t){return Ov(t[0](e))}),nr(_e.structureQuery.type.atomName,function(e,t){return function fPe(e){return e?"string"==typeof e?e.toUpperCase():"".concat(e).toUpperCase():""}(t[0](e))}),nr(_e.structureQuery.type.bondFlags,function(e,t){var r=0;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=Qte(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++)r=Qte(r,t[o[i]](e));return r}),nr(_e.structureQuery.type.ringFingerprint,function(e,t){return Lc.elementFingerprint(function Z9e(e,t){var r=[];if(!t)return r;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else{var i=Object.keys(t);for(n=1,a=i.length;n<a;n++)r.push(t[i[n]](e))}return r}(e,t))}),nr(_e.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=$te(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++)r=$te(r,t[o[i]](e));return r}),jt(_e.structureQuery.filter.pick,function(e,t){return _n.filters.pick(t[0],t.test)(e)}),jt(_e.structureQuery.filter.first,function(e,t){return _n.filters.first(t[0])(e)}),jt(_e.structureQuery.filter.withSameAtomProperties,function(e,t){return _n.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),jt(_e.structureQuery.filter.intersectedBy,function(e,t){return _n.filters.areIntersectedBy(t[0],t.by)(e)}),jt(_e.structureQuery.filter.within,function(e,t){var r,n,a;return _n.filters.within({query:t[0],target:t.target,minRadius:null===(r=t["min-radius"])||void 0===r?void 0:r.call(t,e),maxRadius:null===(n=t["max-radius"])||void 0===n?void 0:n.call(t,e),elementRadius:t["atom-radius"],invert:null===(a=t.invert)||void 0===a?void 0:a.call(t,e)})(e)}),jt(_e.structureQuery.filter.isConnectedTo,function(e,t){var r,n;return _n.filters.isConnectedTo({query:t[0],target:t.target,disjunct:null===(r=t.disjunct)||void 0===r?void 0:r.call(t,e),invert:null===(n=t.invert)||void 0===n?void 0:n.call(t,e),bondTest:t["bond-test"]})(e)}),jt(_e.structureQuery.generator.atomGroups,function(t,r){return _n.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),jt(_e.structureQuery.generator.all,function(t){return _n.generators.all(t)}),jt(_e.structureQuery.generator.empty,function(t){return _n.generators.none(t)}),jt(_e.structureQuery.generator.bondedAtomicPairs,function(t,r){return _n.generators.bondedAtomicPairs(r&&r[0])(t)}),jt(_e.structureQuery.generator.rings,function(t,r){var n,a;return _n.generators.rings(null===(n=r?.fingerprint)||void 0===n?void 0:n.call(r,t),null===(a=r?.["only-aromatic"])||void 0===a?void 0:a.call(r,t))(t)}),jt(_e.structureQuery.generator.queryInSelection,function(t,r){var n;return _n.generators.querySelection(r[0],r.query,null===(n=r["in-complement"])||void 0===n?void 0:n.call(r,t))(t)}),jt(_e.structureQuery.modifier.includeSurroundings,function(t,r){return _n.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!(!r["as-whole-residues"]||!r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),jt(_e.structureQuery.modifier.surroundingLigands,function(t,r){return _n.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!(!r["include-water"]||!r["include-water"](t))})(t)}),jt(_e.structureQuery.modifier.wholeResidues,function(t,r){return _n.modifiers.wholeResidues(r[0])(t)}),jt(_e.structureQuery.modifier.union,function(t,r){return _n.modifiers.union(r[0])(t)}),jt(_e.structureQuery.modifier.expandProperty,function(t,r){return _n.modifiers.expandProperty(r[0],r.property)(t)}),jt(_e.structureQuery.modifier.exceptBy,function(t,r){return _n.modifiers.exceptBy(r[0],r.by)(t)}),jt(_e.structureQuery.modifier.includeConnected,function(t,r){var n,a;return _n.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!(!r["as-whole-residues"]||!r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:null!==(a=null===(n=r["fixed-point"])||void 0===n?void 0:n.call(r,t))&&void 0!==a&&a})(t)}),jt(_e.structureQuery.modifier.intersectBy,function(t,r){return _n.modifiers.intersectBy(r[0],r.by)(t)}),jt(_e.structureQuery.combinator.merge,function(e,t){return _n.combinators.merge(t)(e)}),jt(_e.structureQuery.atomProperty.core.elementSymbol,Vn(it.atom.type_symbol)),jt(_e.structureQuery.atomProperty.core.vdw,function(e,t){return G2(it.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),jt(_e.structureQuery.atomProperty.core.mass,function(e,t){return function mFe(e){var t=RT[e];return void 0===t?10.81:dFe[t]}(it.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),jt(_e.structureQuery.atomProperty.core.atomicNumber,function(e,t){return H2(it.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),jt(_e.structureQuery.atomProperty.core.x,Vn(it.atom.x)),jt(_e.structureQuery.atomProperty.core.y,Vn(it.atom.y)),jt(_e.structureQuery.atomProperty.core.z,Vn(it.atom.z)),jt(_e.structureQuery.atomProperty.core.sourceIndex,Vn(it.atom.sourceIndex)),jt(_e.structureQuery.atomProperty.core.operatorName,Vn(it.unit.operator_name)),jt(_e.structureQuery.atomProperty.core.operatorKey,Vn(it.unit.operator_key)),jt(_e.structureQuery.atomProperty.core.modelIndex,Vn(it.unit.model_index)),jt(_e.structureQuery.atomProperty.core.modelLabel,Vn(it.unit.model_label)),jt(_e.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return nc(r.unit.id,r.element)}),jt(_e.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return function gke(e){return Oe.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}(t&&t[0]&&t[0](e)||e.element)}),jt(_e.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return function yke(e){return Oe.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}(t&&t[0]&&t[0](e)||e.element)}),jt(_e.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return function bke(e){return it.entity.key(e)}(t&&t[0]&&t[0](e)||e.element)}),jt(_e.structureQuery.atomProperty.macromolecular.id,Vn(it.atom.id)),jt(_e.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return"ATOM"!==it.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)}),jt(_e.structureQuery.atomProperty.macromolecular.label_atom_id,Vn(it.atom.label_atom_id)),jt(_e.structureQuery.atomProperty.macromolecular.label_alt_id,Vn(it.atom.label_alt_id)),jt(_e.structureQuery.atomProperty.macromolecular.label_comp_id,Vn(it.atom.label_comp_id)),jt(_e.structureQuery.atomProperty.macromolecular.label_seq_id,Vn(it.residue.label_seq_id)),jt(_e.structureQuery.atomProperty.macromolecular.label_asym_id,Vn(it.chain.label_asym_id)),jt(_e.structureQuery.atomProperty.macromolecular.label_entity_id,Vn(it.entity.id)),jt(_e.structureQuery.atomProperty.macromolecular.auth_atom_id,Vn(it.atom.auth_atom_id)),jt(_e.structureQuery.atomProperty.macromolecular.auth_comp_id,Vn(it.atom.auth_comp_id)),jt(_e.structureQuery.atomProperty.macromolecular.auth_seq_id,Vn(it.residue.auth_seq_id)),jt(_e.structureQuery.atomProperty.macromolecular.auth_asym_id,Vn(it.chain.auth_asym_id)),jt(_e.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,Vn(it.residue.pdbx_PDB_ins_code)),jt(_e.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,Vn(it.atom.pdbx_formal_charge)),jt(_e.structureQuery.atomProperty.macromolecular.occupancy,Vn(it.atom.occupancy)),jt(_e.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,Vn(it.atom.B_iso_or_equiv)),jt(_e.structureQuery.atomProperty.macromolecular.entityType,Vn(it.entity.type)),jt(_e.structureQuery.atomProperty.macromolecular.entitySubtype,Vn(it.entity.subtype)),jt(_e.structureQuery.atomProperty.macromolecular.entityPrdId,Vn(it.entity.prd_id)),jt(_e.structureQuery.atomProperty.macromolecular.entityDescription,Vn(it.entity.pdbx_description)),jt(_e.structureQuery.atomProperty.macromolecular.objectPrimitive,Vn(it.unit.object_primitive)),jt(_e.structureQuery.atomProperty.macromolecular.isNonStandard,Vn(it.residue.isNonStandard)),jt(_e.structureQuery.atomProperty.macromolecular.secondaryStructureKey,Vn(it.residue.secondary_structure_key)),jt(_e.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,Vn(it.residue.secondary_structure_type)),jt(_e.structureQuery.atomProperty.macromolecular.chemCompType,Vn(it.residue.chem_comp_type)),jt(_e.structureQuery.atomSet.atomCount,function(t,r){return _n.atomset.atomCount(t)}),jt(_e.structureQuery.atomSet.countQuery,function(t,r){return _n.atomset.countQuery(r[0])(t)}),jt(_e.structureQuery.atomSet.propertySet,function(t,r){return _n.atomset.propertySet(r[0])(t)}),jt(_e.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),jt(_e.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),jt(_e.structureQuery.bondProperty.key,function(e,t){return e.atomicBond.key}),jt(_e.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),jt(_e.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),jt(_e.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),jt(_e.internal.generator.bundleElement,function(t,r){return aZ(r.groupedUnits(t),r.ranges(t),r.set(t))}),jt(_e.internal.generator.bundle,function(t,r){return iZ(r.elements(t))(t)}),jt(_e.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function Vn(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function Qte(e,t){return e|(Gr.isName(t)?Gr.fromName(t):0)}function $te(e,t){switch(t.toLowerCase()){case"helix":return 2|e;case"alpha":return 4098|e;case"pi":return 32770|e;case"310":return 2050|e;case"beta":return 4|e;case"strand":return 4194308|e;case"sheet":return 8388612|e;case"turn":return 16|e;case"bend":return 8|e;case"coil":return 536870912|e;default:return e}}function Mi(e,t){return{expression:e,language:t}}!function(){for(var e=0,t=K9e;e<t.length;e++)rE.addSymbol(t[e])}(),function(e){function n(s){switch(s.language){case"mol-script":var u=function h9e(e){return zB.parse(e)}(s.expression);if(0===u.length)throw new Error("No query");return s9e(u[0]);case"pymol":case"jmol":case"vmd":return function W9e(e,t){try{return q9e[e](t)}catch(n){throw console.error(n.message),n}}(s.language,s.expression);default:xn()}}function a(s){return $S(n(s))}e.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"},e.is=function t(s){return!!s&&"string"==typeof s.expression&&!!s.language},e.areEqual=function r(s,u){return s.language===u.language&&s.expression===u.expression},e.toExpression=n,e.toQuery=a,e.toLoci=function i(s,u){var l=a(s)(new Uc(u));return mt.toLociWithSourceUnits(l)},e.getStructureSelection=function o(s,u,c){return $S("function"==typeof s?s(de):s)(new Uc(u,c))}}(Mi||(Mi={}));var lg,Ds,yb={dynamicBonds:D.Optional(D.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))};!function(e){function n(u,c,l,d,f){return ce(this,void 0,void 0,function(){var p,h,m,v,g,y;return le(this,function(b){switch(b.label){case 0:return p=void 0,h=ei.Provider.get(l),!d&&h&&0!==h.assemblies.length&&(d=h.assemblies[0].id),h&&0!==h.assemblies.length?(p=B2.findAssembly(l,d||""))||u.log.warn("Model '".concat(l.entryId,"' has no assembly called '").concat(d,"', returning model structure.")):u.log.warn("Model '".concat(l.entryId,"' has no assembly, returning model structure.")),m=Ye.ofModel(l,f),p?[4,Hd.buildAssembly(m,d=p.id).runInContext(c)]:(v={label:"Model",description:Ye.elementDescription(m)},[2,new ve.Molecule.Structure(m,v)]);case 1:return g=b.sent(),y={label:"Assembly ".concat(d),description:Ye.elementDescription(g)},[2,new ve.Molecule.Structure(g,y)]}})})}function a(u,c,l,d,f){return ce(this,void 0,void 0,function(){var p,h,m;return le(this,function(v){switch(v.label){case 0:return p=Ye.ofModel(c,f),[4,Hd.buildSymmetryRange(p,l,d).runInContext(u)];case 1:return h=v.sent(),m={label:"Symmetry [".concat(l,"] to [").concat(d,"]"),description:Ye.elementDescription(h)},[2,new ve.Molecule.Structure(h,m)]}})})}function i(u,c,l,d){return ce(this,void 0,void 0,function(){var f,p,h;return le(this,function(m){switch(m.label){case 0:return f=Ye.ofModel(c,d),[4,Hd.builderSymmetryMates(f,l).runInContext(u)];case 1:return p=m.sent(),h={label:"Symmetry Mates",description:Ye.elementDescription(p)},[2,new ve.Molecule.Structure(p,h)]}})})}function o(u,c,l,d,f){return ce(this,void 0,void 0,function(){var p,h,m;return le(this,function(v){switch(v.label){case 0:return p=Ye.ofModel(c,f),[4,Hd.buildSymmetryAssembly(p,l,d).runInContext(u)];case 1:return h=v.sent(),m={label:"Symmetry Assembly",description:Ye.elementDescription(h)},[2,new ve.Molecule.Structure(h,m)]}})})}e.getParams=function t(u,c){var l=u&&ei.Provider.get(u),d=l?l.assemblies.map(function(_){return[_.id,"".concat(_.id,": ").concat(kc(_.details))]}):[],f=!l||!gs.isZero(l.spacegroup.cell),p=[];if(l)for(var h=l.spacegroup.operators,m=0,v=h.length;m<v;m++)p.push([m,"".concat(m+1,": ").concat(xu.getOperatorXyz(h[m]))]);var g=[];u&&u.properties.structAsymMap.forEach(function(_){var C=_.id===_.auth_id?_.id:"".concat(_.id," [auth ").concat(_.auth_id,"]");g.push([_.id,C])});var y={auto:D.Group(yb),model:D.Group(yb),assembly:D.Group(R({id:D.Optional(u?D.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):D.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},yb),{isFlat:!0}),"symmetry-mates":D.Group(R({radius:D.Numeric(5,{min:0,max:50,step:1})},yb),{isFlat:!0}),symmetry:D.Group(R({ijkMin:D.Vec3(S.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:D.Vec3(S.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},yb),{isFlat:!0}),"symmetry-assembly":D.Group(R({generators:D.ObjectList({operators:D.ObjectList({index:D.Select(0,p),shift:D.Vec3(S(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(_){return"".concat(_.index+1,"_").concat(_.shift.map(function(C){return C+5}).join(""))},{defaultValue:[]}),asymIds:D.MultiSelect([],g)},function(_){return"".concat(_.asymIds.length," asym ids, ").concat(_.operators.length," operators")},{defaultValue:[]})},yb),{isFlat:!0})},b=[];return"auto"===c&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:D.MappedStatic(c||"model",y,{options:b})}},e.canAutoUpdate=function r(u,c){return!("symmetry-assembly"===c.name||"symmetry"===c.name&&"symmetry"===u.name)},e.create=function s(u,c,l,d){return ce(this,void 0,void 0,function(){var f,p,h;return le(this,function(m){return f=d?.params,(p=ei.Provider.get(l))&&d&&"model"!==d.name?"auto"===d.name?0===p.assemblies.length?(h=Ye.ofModel(l,f),[2,new ve.Molecule.Structure(h,{label:"Model",description:Ye.elementDescription(h)})]):[2,n(u,c,l,void 0,f)]:"assembly"===d.name?[2,n(u,c,l,d.params.id,f)]:"symmetry"===d.name?[2,a(c,l,d.params.ijkMin,d.params.ijkMax,f)]:"symmetry-mates"===d.name?[2,i(c,l,d.params.radius,f)]:"symmetry-assembly"===d.name?[2,o(c,l,d.params.generators,p,f)]:(xn(),[2]):(h=Ye.ofModel(l,f),[2,new ve.Molecule.Structure(h,{label:"Model",description:Ye.elementDescription(h)})])})})}}(lg||(lg={})),function(e){function r(s,u){var c=Mi.is(u)?u:void 0,l=Mi.is(u)?Mi.toExpression(u):u;return{script:c,expression:l,compiled:$S(l),originalStructure:s,currentStructure:s}}function n(s,u){return s.compiled(new Uc(u))}e.isUnchanged=function t(s,u,c){return s.currentStructure===c&&(Mi.is(u)?!!s.script&&Mi.areEqual(s.script,u):s.expression===u)},e.create=r,e.run=n,e.createAndRun=function a(s,u){var c=r(s,u);return{entry:c,selection:n(c,s)}},e.updateStructure=function i(s,u){return s.currentStructure=u,s.compiled(new Uc(u))},e.updateStructureObject=function o(s,u,c){var l=mt.unionStructure(u);s.label="".concat(c||"Selection"),s.description=Ye.elementDescription(l),s.data=l}}(Ds||(Ds={}));var Q9e=new Set(["LI","NA","K","RB","CS","FR"]),J9e=new Set(["BE","MG","CA","SR","BA","RA"]),s7e=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]),l7e=new Set(["F","CL","BR","I","AT"]);function d7e(e){return l7e.has(e)}function Jte(e){var t=H2(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function h7e(e){return function $9e(e){return Q9e.has(e)}(e)||function e7e(e){return J9e.has(e)}(e)||function f7e(e){var t=H2(e);return t>=57&&t<=71}(e)||function p7e(e){var t=H2(e);return t>=89&&t<=103}(e)||Jte(e)||function u7e(e){return s7e.has(e)}(e)}var hn=function(e){return e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal",e}(hn||{});function dn(e,t,r){var n,a;return void 0===r&&(r={}),{label:e,expression:t,description:r.description||"",category:null!==(n=r.category)&&void 0!==n?n:hn.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=$S(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return ce(this,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=i.managers.structure.selection.getStructure(s),c=u?mt.Sequence(s,[u]):mt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:l.sent(),l.label=2;case 2:return a||(a=$S(t)),[2,a(new Uc(s,{currentSelection:c}))]}})})}}}var m7e=dn("All",de.struct.generator.all(),{category:"",priority:1e3}),v7e=dn("Current Selection",de.internal.generator.current(),{category:"",referencesCurrent:!0}),g7e=dn("Polymer",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.logic.and([de.core.rel.eq([de.ammp("entityType"),"polymer"]),de.core.str.match([de.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),de.ammp("entitySubtype")])])})]),{category:hn.Type}),y7e=dn("Trace",de.struct.modifier.union([de.struct.combinator.merge([de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entityType"),"polymer"]),"chain-test":de.core.set.has([de.set("sphere","gaussian"),de.ammp("objectPrimitive")])})]),de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entityType"),"polymer"]),"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"atom-test":de.core.set.has([de.set("CA","P"),de.ammp("label_atom_id")])})])])]),{category:hn.Structure}),bb=de.core.logic.and([de.core.rel.eq([de.ammp("entityType"),"polymer"]),de.core.str.match([de.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),de.ammp("entitySubtype")])]),nE=de.core.logic.and([de.core.rel.eq([de.ammp("entityType"),"polymer"]),de.core.str.match([de.re("(nucleotide|peptide nucleic acid)","i"),de.ammp("entitySubtype")])]),dg=de.core.str.match([de.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),de.ammp("chemCompType")]),b7e=dn("Backbone",de.struct.modifier.union([de.struct.combinator.merge([de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":bb,"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([dg]),"atom-test":de.core.set.has([de.set.apply(de,fa.toArray(ip)),de.ammp("label_atom_id")])})]),de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":nE,"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([dg]),"atom-test":de.core.set.has([de.set.apply(de,fa.toArray(lT)),de.ammp("label_atom_id")])})])])]),{category:hn.Structure}),_7e=dn("Sidechain",de.struct.modifier.union([de.struct.combinator.merge([de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":bb,"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([dg]),"atom-test":de.core.logic.or([de.core.logic.not([de.core.set.has([de.set.apply(de,fa.toArray(ip)),de.ammp("label_atom_id")])])])})]),de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":nE,"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([dg]),"atom-test":de.core.logic.or([de.core.logic.not([de.core.set.has([de.set.apply(de,fa.toArray(lT)),de.ammp("label_atom_id")])])])})])])]),{category:hn.Structure}),S7e=dn("Sidechain with Trace",de.struct.modifier.union([de.struct.combinator.merge([de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":bb,"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([dg]),"atom-test":de.core.logic.or([de.core.logic.not([de.core.set.has([de.set.apply(de,fa.toArray(ip)),de.ammp("label_atom_id")])]),de.core.rel.eq([de.ammp("label_atom_id"),"CA"]),de.core.logic.and([de.core.rel.eq([de.ammp("auth_comp_id"),"PRO"]),de.core.rel.eq([de.ammp("label_atom_id"),"N"])])])})]),de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":nE,"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([dg]),"atom-test":de.core.logic.or([de.core.logic.not([de.core.set.has([de.set.apply(de,fa.toArray(lT)),de.ammp("label_atom_id")])]),de.core.rel.eq([de.ammp("label_atom_id"),"P"])])})])])]),{category:hn.Structure}),C7e=dn("Protein",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":bb})]),{category:hn.Type}),x7e=dn("Nucleic",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":nE})]),{category:hn.Type}),w7e=dn("Helix",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":bb,"residue-test":de.core.flags.hasAny([de.ammp("secondaryStructureFlags"),de.core.type.bitflags([2])])})]),{category:hn.Structure,ensureCustomProperties:function(e,t){return Hc.attach(e,t)}}),A7e=dn("Beta Strand/Sheet",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":bb,"residue-test":de.core.flags.hasAny([de.ammp("secondaryStructureFlags"),de.core.type.bitflags([4])])})]),{category:hn.Structure,ensureCustomProperties:function(e,t){return Hc.attach(e,t)}}),T7e=dn("Water",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entityType"),"water"])})]),{category:hn.Type}),D7e=dn("Ion",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entitySubtype"),"ion"])})]),{category:hn.Type}),E7e=dn("Lipid",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entitySubtype"),"lipid"])})]),{category:hn.Type}),aE=dn("Carbohydrate",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.logic.or([de.core.rel.eq([de.ammp("entityType"),"branched"]),de.core.logic.and([de.core.rel.eq([de.ammp("entityType"),"non-polymer"]),de.core.str.match([de.re("oligosaccharide","i"),de.ammp("entitySubtype")])])])})]),{category:hn.Type}),ere=dn("Carbohydrate with Connected",de.struct.modifier.union([de.struct.modifier.includeConnected({0:aE.expression,"layer-count":1,"as-whole-residues":!0})]),{category:hn.Internal,isHidden:!0}),tre=dn("Connected to Carbohydrate",de.struct.modifier.union([de.struct.modifier.exceptBy({0:ere.expression,by:aE.expression})]),{category:hn.Internal,isHidden:!0}),JB=dn("Ligand",de.struct.modifier.union([de.struct.modifier.exceptBy({0:de.struct.modifier.union([de.struct.combinator.merge([de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.logic.and([de.core.logic.or([de.core.rel.eq([de.ammp("entityType"),"non-polymer"]),de.core.rel.neq([de.ammp("entityPrdId"),""])]),de.core.logic.not([de.core.str.match([de.re("(oligosaccharide|lipid|ion)","i"),de.ammp("entitySubtype")])])]),"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.logic.not([de.core.str.match([de.re("saccharide","i"),de.ammp("chemCompType")])])})]),de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entityType"),"polymer"]),"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":dg})])])]),by:de.struct.combinator.merge([de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entityType"),"polymer"]),"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.set.has([de.set.apply(de,fa.toArray(My)),de.ammp("label_comp_id")])})]),de.struct.generator.atomGroups({"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.core.set.has([de.set.apply(de,fa.toArray(kPe)),de.ammp("label_comp_id")])})])})]),{category:hn.Type}),rre=dn("Ligand with Connected",de.struct.modifier.union([de.struct.modifier.exceptBy({0:de.struct.modifier.union([de.struct.modifier.includeConnected({0:JB.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":de.core.flags.hasAny([de.struct.bondProperty.flags(),de.core.type.bitflags([3])])})]),by:aE.expression})]),{category:hn.Internal,isHidden:!0}),nre=dn("Connected to Ligand",de.struct.modifier.union([de.struct.modifier.exceptBy({0:rre.expression,by:JB.expression})]),{category:hn.Internal,isHidden:!0}),I7e=dn("Connected to Ligand or Carbohydrate",de.struct.modifier.union([de.struct.combinator.merge([tre.expression,nre.expression])]),{category:hn.Internal,isHidden:!0}),P7e=dn("Disulfide Bridges",de.struct.modifier.union([de.struct.combinator.merge([de.struct.modifier.union([de.struct.modifier.wholeResidues([de.struct.filter.isConnectedTo({0:de.struct.generator.atomGroups({"residue-test":de.core.set.has([de.set("CYS"),de.ammp("auth_comp_id")]),"atom-test":de.core.set.has([de.set("SG"),de.ammp("label_atom_id")])}),target:de.struct.generator.atomGroups({"residue-test":de.core.set.has([de.set("CYS"),de.ammp("auth_comp_id")]),"atom-test":de.core.set.has([de.set("SG"),de.ammp("label_atom_id")])}),"bond-test":!0})])]),de.struct.modifier.union([de.struct.modifier.wholeResidues([de.struct.modifier.union([de.struct.generator.bondedAtomicPairs({0:de.core.flags.hasAny([de.struct.bondProperty.flags(),de.core.type.bitflags([8])])})])])])])]),{category:hn.Bond}),M7e=dn("NOS Bridges",de.struct.modifier.union([de.struct.modifier.wholeResidues([de.struct.filter.isConnectedTo({0:de.struct.generator.atomGroups({"residue-test":de.core.set.has([de.set("CSO","LYS"),de.ammp("auth_comp_id")]),"atom-test":de.core.set.has([de.set("OD","NZ"),de.ammp("label_atom_id")])}),target:de.struct.generator.atomGroups({"residue-test":de.core.set.has([de.set("CSO","LYS"),de.ammp("auth_comp_id")]),"atom-test":de.core.set.has([de.set("OD","NZ"),de.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:hn.Bond}),R7e=dn("Non-standard Residues in Polymers",de.struct.modifier.union([de.struct.generator.atomGroups({"entity-test":de.core.rel.eq([de.ammp("entityType"),"polymer"]),"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":de.ammp("isNonStandard")})]),{category:hn.Residue}),O7e=dn("Coarse Elements",de.struct.modifier.union([de.struct.generator.atomGroups({"chain-test":de.core.set.has([de.set("sphere","gaussian"),de.ammp("objectPrimitive")])})]),{category:hn.Type}),F7e=dn("Rings in Residues",de.struct.modifier.union([de.struct.generator.rings()]),{category:hn.Residue}),N7e=dn("Aromatic Rings in Residues",de.struct.modifier.union([de.struct.generator.rings({"only-aromatic":!0})]),{category:hn.Residue}),k7e=dn("Surrounding Residues (5 \u212b) of Selection",de.struct.modifier.union([de.struct.modifier.exceptBy({0:de.struct.modifier.includeSurroundings({0:de.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:de.internal.generator.current()})]),{description:"Select residues within 5 \u212b of the current selection.",category:hn.Manipulate,referencesCurrent:!0}),B7e=dn("Surrounding Ligands (5 \u212b) of Selection",de.struct.modifier.union([de.struct.modifier.surroundingLigands({0:de.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212b of the current selection.",category:hn.Manipulate,referencesCurrent:!0}),L7e=dn("Surrounding Atoms (5 \u212b) of Selection",de.struct.modifier.union([de.struct.modifier.exceptBy({0:de.struct.modifier.includeSurroundings({0:de.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:de.internal.generator.current()})]),{description:"Select atoms within 5 \u212b of the current selection.",category:hn.Manipulate,referencesCurrent:!0}),U7e=dn("Inverse / Complement of Selection",de.struct.modifier.union([de.struct.modifier.exceptBy({0:de.struct.generator.all(),by:de.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:hn.Manipulate,referencesCurrent:!0}),V7e=dn("Residues Covalently Bonded to Selection",de.struct.modifier.union([de.struct.modifier.includeConnected({0:de.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:hn.Manipulate,referencesCurrent:!0}),z7e=dn("Covalently Bonded Component",de.struct.modifier.union([de.struct.modifier.includeConnected({0:de.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:hn.Manipulate,referencesCurrent:!0}),G7e=dn("Residues with Cov. or Metallic Bond to Selection",de.struct.modifier.union([de.struct.modifier.includeConnected({0:de.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":de.core.flags.hasAny([de.struct.bondProperty.flags(),de.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:hn.Manipulate,referencesCurrent:!0}),H7e=dn("Whole Residues of Selection",de.struct.modifier.union([de.struct.modifier.wholeResidues({0:de.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:hn.Manipulate,referencesCurrent:!0}),j7e=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),q7e=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function eL(e,t,r){var n=e[0],a=e[1];void 0===r&&(r=0);var i=1!==n.length||are.has(n[0])?"".concat(a," (").concat(n.join(", "),")"):"[".concat(n[0],"] ").concat(a);return dn(i,de.struct.modifier.union([de.struct.generator.atomGroups({"residue-test":de.core.set.has([de.set.apply(de,n),de.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}var tL,JS,rL,are=fa.unionMany(DN,M2,R2,dT),Ri={all:m7e,current:v7e,polymer:g7e,trace:y7e,backbone:b7e,sidechain:_7e,sidechainWithTrace:S7e,protein:C7e,nucleic:x7e,helix:w7e,beta:A7e,water:T7e,ion:D7e,lipid:E7e,branched:aE,branchedPlusConnected:ere,branchedConnectedOnly:tre,ligand:JB,ligandPlusConnected:rre,ligandConnectedOnly:nre,connectedOnly:I7e,disulfideBridges:P7e,nosBridges:M7e,nonStandardPolymer:R7e,coarse:O7e,ring:F7e,aromaticRing:N7e,surroundings:k7e,surroundingLigands:B7e,surroundingAtoms:L7e,complement:U7e,covalentlyBonded:V7e,covalentlyOrMetallicBonded:G7e,covalentlyBondedComponent:z7e,wholeResidues:H7e},X7e=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,sr(sr(sr([],Object.values(Ri),!1),j7e.map(function(n){return eL(n,hn.AminoAcid)}),!1),q7e.map(function(n){return eL(n,hn.NucleicBase)}),!1)),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);-1!==r&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}();function $7e(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:case 4:return 0;case 3:return 1;case 2:return 2;case 1:return 3;default:return console.error("Value ".concat(e," is outside the 0-7 range, defaulting to 0.")),0}}function ire(e,t){for(var r=Ke.create(e.data,2*t),n=Ke.create(e.data,2*t),a=Ke.create(e.data,2*t),i=Ke.create(e.data,2*t),o=Ke.create(e.data,2*t),s=0;s<t;++s){lt.markLine(e);var u=e.tokenStart,c=e.position;lt.trim(e,u,u+10),Ke.addUnchecked(r,e.tokenStart,e.tokenEnd),lt.trim(e,u+10,u+20),Ke.addUnchecked(n,e.tokenStart,e.tokenEnd),lt.trim(e,u+20,u+30),Ke.addUnchecked(a,e.tokenStart,e.tokenEnd),lt.trim(e,u+31,u+34),Ke.addUnchecked(i,e.tokenStart,e.tokenEnd),lt.trim(e,u+36,u+39),Ke.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=c}return{count:t,x:er(r)(ie.Schema.float),y:er(n)(ie.Schema.float),z:er(a)(ie.Schema.float),type_symbol:er(i)(ie.Schema.str),formal_charge:er(o)(ie.Schema.int)}}function ore(e,t){for(var r=Ke.create(e.data,2*t),n=Ke.create(e.data,2*t),a=Ke.create(e.data,2*t),i=0;i<t;++i){lt.markLine(e);var o=e.tokenStart,s=e.position;lt.trim(e,o,o+3),Ke.addUnchecked(r,e.tokenStart,e.tokenEnd),lt.trim(e,o+3,o+6),Ke.addUnchecked(n,e.tokenStart,e.tokenEnd),lt.trim(e,o+6,o+9),Ke.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:er(r)(ie.Schema.int),atomIdxB:er(n)(ie.Schema.int),order:er(a)(ie.Schema.int)}}function J7e(e,t,r){lt.trim(e,t+6,t+9);for(var n=parseInt(lt.getTokenString(e)),a=0;a<n;++a){var i=9+8*a;lt.trim(e,t+i,t+i+4);var o=lt.getTokenString(e);r.atomIdx.push(+o),lt.trim(e,t+i+4,t+i+8);var s=lt.getTokenString(e);r.charge.push(+s)}lt.eatLine(e)}function sre(e){for(var n={atomIdx:[],charge:[]};e.position<e.length;){var a=e.position;lt.trim(e,a+3,a+6);var i=lt.getTokenString(e);if("END"===i)break;"CHG"===(lt.eatLine(e),i)&&J7e(e,a,n)}return{atomIdx:ie.ofIntArray(n.atomIdx),charge:ie.ofIntArray(n.charge)}}function eje(e){var t=lt(e),r=lt.readLine(t).trim(),n=lt.readLine(t).trim(),a=lt.readLine(t).trim(),i=lt.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=ire(t,o),c=ore(t,s),l=sre(t);return Nn.success({title:r,program:n,comment:a,atoms:u,bonds:c,formalCharges:l})}function tje(e){var t=this;return Ve.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return le(this,function(r){return[2,eje(e)]})})})}function ure(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,v,g,y,b,_;return le(this,function(C){switch(C.label){case 0:if(n=e.atoms,a=e.bonds,i=e.formalCharges,o=ie.ofConst("MOL",e.atoms.count,ie.Schema.str),s=ie.ofConst("A",e.atoms.count,ie.Schema.str),u=ie.asArrayColumn(n.type_symbol),c=ie.ofConst(1,n.count,ie.Schema.int),l=new Int32Array(e.atoms.count),i.atomIdx.rowCount>0)for(d=0;d<i.atomIdx.rowCount;d++)l[i.atomIdx.value(d)-1]=i.charge.value(d);else for(d=0;d<e.atoms.count;d++)l[d]=$7e(n.formal_charge.value(d));return f=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:s,auth_atom_id:u,auth_comp_id:o,auth_seq_id:c,Cartn_x:ie.asArrayColumn(n.x,Float32Array),Cartn_y:ie.asArrayColumn(n.y,Float32Array),Cartn_z:ie.asArrayColumn(n.z,Float32Array),id:ie.range(0,n.count-1),label_asym_id:s,label_atom_id:u,label_comp_id:o,label_seq_id:c,label_entity_id:ie.ofConst("1",n.count,ie.Schema.str),occupancy:ie.ofConst(1,n.count,ie.Schema.float),type_symbol:u,pdbx_PDB_model_num:ie.ofConst(1,n.count,ie.Schema.int),pdbx_formal_charge:ie.ofIntArray(l)},n.count),(p=new Xl).setNames([["MOL","Unknown Entity"]]),p.getEntityId("MOL",0,"A"),(h=new Kl(c,u)).setNames([["MOL","Unknown Molecule"]]),h.add("MOL",0),[4,Wd(zc({entity:p.getEntityTable(),chem_comp:h.getChemCompTable(),atom_site:f}),t??tL.create(e),r)];case 1:return(v=C.sent()).frameCount>0&&(g=ie.ofIntArray(ie.mapToArray(a.atomIdxA,function(x){return x-1},Int32Array)),y=ie.ofIntArray(ie.mapToArray(a.atomIdxB,function(x){return x-1},Int32Array)),b=ie.asArrayColumn(a.order,Int32Array),_=Lo.fromData({pairs:{indexA:g,indexB:y,order:b},count:n.count},{maxDistance:1/0}),Lo.Provider.set(v.representative,_)),[2,v]}})})}function rje(e){return Ve.create("Parse MOL",function(t){return ure(e,void 0,t)})}function uje(e){var t=JS.fromFrame(e);return Ve.create("Parse CIF Core",function(r){return function ije(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,k,H,G,U,Q,W,K,ne,X,L,Y,$,Z,q,z,te,ae,fe,he,pe,re,ee,ue,ge;return le(this,function(Ce){switch(Ce.label){case 0:for(i=ie.ofConst("MOL",a=e.atom_site._rowCount,ie.Schema.str),o=ie.ofConst("A",a,ie.Schema.str),s=ie.ofConst(1,a,ie.Schema.int),u=function aje(e){var t=e.cell,n=function nje(e){var t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?t:r}(e.space_group),a=gs.create(n,S.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),S.scale(S(),S.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:xu.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}(e),c=u.spacegroup.cell.fromFractional,d=(l=e.atom_site).fract_x,f=l.fract_y,p=l.fract_z,h=new Float32Array(a),m=new Float32Array(a),v=new Float32Array(a),g=S(),pe=0;pe<a;++pe)S.set(g,d.value(pe),f.value(pe),p.value(pe)),S.transformMat4(g,g,c),h[pe]=g[0],m[pe]=g[1],v[pe]=g[2];if(_=(y=e.atom_site).label,(b=y.type_symbol).isDefined){for(E=new Array(a),A=new Int8Array(a),pe=0;pe<a;++pe)"+"===(T=b.value(pe))[(w=T.length)-1]?(E[pe]=T.substring(0,w-2),A[pe]=parseInt(T[w-2])):"+"===T[w-2]?(E[pe]=T.substring(0,w-2),A[pe]=parseInt(T[w-1])):"-"===T[w-1]?(E[pe]=T.substring(0,w-2),A[pe]=-parseInt(T[w-2])):"-"===T[w-2]?(E[pe]=T.substring(0,w-2),A[pe]=-parseInt(T[w-1])):(E[pe]=T,A[pe]=0);C=ie.ofStringArray(E),x=ie.ofIntArray(A)}else{for(E=new Array(a),pe=0;pe<a;++pe)E[pe]=pb(_.value(pe),"");C=ie.ofStringArray(E),x=ie.Undefined(a,ie.Schema.int)}return I=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:o,auth_atom_id:_,auth_comp_id:i,auth_seq_id:s,Cartn_x:ie.ofFloatArray(h),Cartn_y:ie.ofFloatArray(m),Cartn_z:ie.ofFloatArray(v),id:ie.range(0,a-1),label_asym_id:o,label_atom_id:_,label_comp_id:i,label_seq_id:s,label_entity_id:ie.ofConst("1",a,ie.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ie.ofConst(1,a,ie.Schema.float),type_symbol:C,pdbx_formal_charge:x,pdbx_PDB_model_num:ie.ofConst(1,a,ie.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},a),M=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),(F=new Xl).setNames([["MOL",M||"Unknown Entity"]]),F.getEntityId("MOL",0,"A"),(N=new Kl(s,e.atom_site.type_symbol)).setNames([["MOL",M||"Unknown Molecule"]]),N.add("MOL",0),[4,Wd(zc({entity:F.getEntityTable(),chem_comp:N.getChemCompTable(),atom_site:I}),t,r)];case 1:if((k=Ce.sent()).frameCount>0&&(ei.Provider.set(H=k.representative,u),(G=e.geom_bond._rowCount)>0)){for(U={},pe=0,W=(Q=e.atom_site.label).rowCount;pe<W;++pe)U[Q.value(pe)]=pe;for(K=null===(n=t.data.frame.categories.ccdc_geom_bond_type)||void 0===n?void 0:n.getField(""),ne=[],X=[],L=[],Y=[],$=[],Z=new Set,q=0,te=(z=e.geom_bond).atom_site_label_1,ae=z.atom_site_label_2,fe=z.valence,he=z.distance,pe=0;pe<G;++pe)re=U[te.value(pe)],ee=U[ae.value(pe)],ue=re<ee?nc(re,ee):nc(ee,re),!Z.has(ue)&&(Z.add(ue),ne[q]=re,X[q]=ee,Y[q]=he.value(pe)||-1,K?"D"===(ge=K.str(pe))?(L[q]=2,$[q]=1):"A"===ge?(L[q]=1,$[q]=17):(L[q]=1,$[q]=1):($[q]=1,L[q]=fe.isDefined?fe.value(pe):1),q+=1);Lo.Provider.set(H,Lo.fromData({pairs:{indexA:ie.ofIntArray(ne),indexB:ie.ofIntArray(X),order:ie.ofIntArray(L),distance:ie.ofFloatArray(Y),flag:ie.ofIntArray($)},count:a}))}return[2,k]}})})}(t.data.db,t,r)})}function lje(e){return Ve.create("Parse Cube",function(t){return function cje(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c;return le(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ie.ofConst("MOL",e.atoms.count,ie.Schema.str),a=ie.ofConst("A",e.atoms.count,ie.Schema.str),i=ie.ofArray({array:ie.mapToArray(r.number,function(f){return function TPe(e){return lK.has(e)?lK.get(e):Ov("H")}(f)}),schema:ie.Schema.Aliased(ie.Schema.str)}),o=ie.ofConst(1,r.count,ie.Schema.int),s=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:ie.asArrayColumn(r.x,Float32Array),Cartn_y:ie.asArrayColumn(r.y,Float32Array),Cartn_z:ie.asArrayColumn(r.z,Float32Array),id:ie.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:ie.ofConst("1",r.count,ie.Schema.str),occupancy:ie.ofConst(1,r.count,ie.Schema.float),type_symbol:i,pdbx_PDB_model_num:ie.ofConst(1,r.count,ie.Schema.int)},r.count),(u=new Xl).setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),(c=new Kl(o,i)).setNames([["MOL","Unknown Molecule"]]),c.add("MOL",0),[4,Wd(zc({entity:u.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:s}),rL.create(e),t)];case 1:return[2,d.sent()]}})})}(e,t)})}!function(e){e.is=function t(n){return"mol"===n?.kind},e.create=function r(n){return{kind:"mol",name:n.title,data:n}}}(tL||(tL={})),Gd.Provider.formatRegistry.add("cifCore",function oje(e){if(JS.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso;return{data:Qr.ofPartialColumns(Gd.Schema,{U:n.u},n._rowCount),elementToAnsiotrop:Gd.getElementToAnsiotropFromLabel(r.label,n.label)}}},function sje(e){return!!JS.is(e.sourceData)&&e.sourceData.data.db.atom_site_aniso.u.isDefined}),function(e){e.is=function t(n){return"cifCore"===n?.kind},e.fromFrame=function r(n,a){return a||(a=Yl.schema.cifCore(n)),{kind:"cifCore",name:a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.icsd.value(0)||a.database_code.mdf.value(0)||a.database_code.nbs.value(0)||a.database_code.csd.value(0)||a.database_code.cod.value(0)||a._name,data:{db:a,frame:n}}}}(JS||(JS={})),function(e){e.is=function t(n){return"cube"===n?.kind},e.create=function r(n){return{kind:"cube",name:n.header.comment1,data:n}}}(rL||(rL={}));var aL,nL=lt.skipWhitespace,cre=lt.eatValue,cl=lt.markLine,ll=lt.getTokenString,lre=lt.readLine,dre=/\s+/g;function hje(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x;return le(this,function(T){switch(T.label){case 0:for(t=e.tokenizer,r=e.molecule;"@<TRIPOS>ATOM"!==ll(t)&&t.position<t.data.length;)cl(t);return n=t.position,a=t.lineNumber,i=lre(t),o=i.trim().split(/\s+/g),s=o.length,u=Ke.create(t.data,2*r.num_atoms),c=Ke.create(t.data,2*r.num_atoms),l=Ke.create(t.data,2*r.num_atoms),d=Ke.create(t.data,2*r.num_atoms),f=Ke.create(t.data,2*r.num_atoms),p=Ke.create(t.data,2*r.num_atoms),h=Ke.create(t.data,2*r.num_atoms),m=Ke.create(t.data,2*r.num_atoms),v=Ke.create(t.data,2*r.num_atoms),g=Ke.create(t.data,2*r.num_atoms),y=ie.Undefined(r.num_atoms,ie.Schema.float),b=ie.Undefined(r.num_atoms,ie.Schema.int),_=ie.Undefined(r.num_atoms,ie.Schema.str),t.position=n,t.lineNumber=a,C=t.length,x=0,[4,$f(e.runtimeCtx,1e5,void 0,function(w){for(var E=Math.min(r.num_atoms-x,w),I=0;I<E;I++)for(var M=0;M<s;M++)switch(nL(t),t.tokenStart=t.position,cre(t),M){case 0:Ke.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:Ke.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:Ke.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 3:Ke.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:Ke.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:Ke.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:Ke.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 7:Ke.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 8:Ke.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 9:Ke.addUnchecked(g,t.tokenStart,t.tokenEnd)}return x+=E,E},function(w){return w.update({message:"Parsing...",current:t.position,max:C})})];case 1:return T.sent(),[2,{count:r.num_atoms,atom_id:er(u)(ie.Schema.int),atom_name:er(c)(ie.Schema.str),x:er(l)(ie.Schema.float),y:er(d)(ie.Schema.float),z:er(f)(ie.Schema.float),atom_type:s>5?er(p)(ie.Schema.str):_,subst_id:s>6?er(h)(ie.Schema.int):b,subst_name:s>7?er(m)(ie.Schema.str):_,charge:s>8?er(v)(ie.Schema.float):y,status_bit:s>9?er(g)(ie.Schema.str):_}]}})})}function mje(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,h;return le(this,function(v){switch(v.label){case 0:for(t=e.tokenizer,r=e.molecule;"@<TRIPOS>BOND"!==ll(t)&&t.position<t.data.length;)cl(t);return n=t.position,a=t.lineNumber,i=lre(t),o=i.trim().split(/\s+/g),s=o.length,u=Ke.create(t.data,2*r.num_bonds),c=Ke.create(t.data,2*r.num_bonds),l=Ke.create(t.data,2*r.num_bonds),d=Ke.create(t.data,2*r.num_bonds),f=Ke.create(t.data,2*r.num_bonds),t.position=n,t.lineNumber=a,p=t.length,h=0,[4,$f(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-h,g),b=0;b<y;b++)for(var _=0;_<s;_++)switch(nL(t),t.tokenStart=t.position,cre(t),_){case 0:Ke.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:Ke.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:Ke.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 3:Ke.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:Ke.addUnchecked(f,t.tokenStart,t.tokenEnd)}return h+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:p})})];case 1:return v.sent(),[2,{count:r.num_bonds,bond_id:er(u)(ie.Schema.int),origin_atom_id:er(c)(ie.Schema.int),target_atom_id:er(l)(ie.Schema.int),bond_type:er(d)(ie.Schema.str),status_bits:s>4?er(f)(ie.Schema.str):ie.Undefined(r.num_bonds,ie.Schema.str)}]}})})}function gje(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(l){switch(l.label){case 0:n=lt(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],l.label=1;case 1:return n.position<t.length?(i=function fje(e,t){return{tokenizer:e,molecule:{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""},runtimeCtx:t}}(n,e),function pje(e){for(var t=e.tokenizer,r=e.molecule;"@<TRIPOS>MOLECULE"!==ll(t)&&t.position<t.data.length;)cl(t);cl(t),r.mol_name=ll(t),cl(t);var n=ll(t).trim().split(dre);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),cl(t);var a=ll(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,cl(t);var i=ll(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,cl(t);var o=ll(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,cl(t);var s=ll(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}(i),[4,hje(i)]):[3,4];case 2:return o=l.sent(),[4,mje(i)];case 3:for(s=l.sent(),u=function vje(e){for(var t=e.tokenizer;t.position<t.data.length;){var r=ll(t);if("@<TRIPOS>MOLECULE"===r)return;if("@<TRIPOS>CRYSIN"===r)break;cl(t)}if(!(t.position>=t.data.length)){cl(t);var n=ll(t).trim().split(dre);return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}}(i),a.push({molecule:i.molecule,atoms:o,bonds:s,crysin:u}),nL(n);"@<TRIPOS>MOLECULE"!==ll(n)&&n.position<n.data.length;)cl(n);return[3,1];case 4:return[2,Nn.success({name:r,structures:a})]}})})}function yje(e,t){var r=this;return Ve.create("Parse MOL2",function(n){return ce(r,void 0,void 0,function(){return le(this,function(a){switch(a.label){case 0:return[4,gje(n,e,t)];case 1:return[2,a.sent()]}})})})}function Sje(e){return Ve.create("Parse MOL2",function(t){return function bje(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,C,x,A,T,w,E,I,M,F;return le(this,function(N){switch(N.label){case 0:r=[],n=0,a=e.structures.length,N.label=1;case 1:if(!(n<a))return[3,4];for(o=(i=e.structures[n]).molecule,u=i.bonds,c=i.crysin,l=ie.ofConst("A",(s=i.atoms).count,ie.Schema.str),d=new Array(s.count),f=!1,p=0;p<s.count;++p)if(s.atom_type.value(p).includes(".")){f=!0;break}for(h=0;h<s.count;++h)d[h]=f?s.atom_type.value(h).split(".")[0].toUpperCase():pb(s.atom_name.value(h),s.subst_name.value(h));for(m=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:l,auth_atom_id:ie.asArrayColumn(s.atom_name),auth_comp_id:s.subst_name,auth_seq_id:s.subst_id,Cartn_x:ie.asArrayColumn(s.x,Float32Array),Cartn_y:ie.asArrayColumn(s.y,Float32Array),Cartn_z:ie.asArrayColumn(s.z,Float32Array),id:ie.asArrayColumn(s.atom_id),label_asym_id:l,label_atom_id:ie.asArrayColumn(s.atom_name),label_comp_id:s.subst_name,label_seq_id:s.subst_id,label_entity_id:ie.ofConst("1",s.count,ie.Schema.str),occupancy:ie.ofConst(1,s.count,ie.Schema.float),type_symbol:ie.ofStringArray(d),pdbx_PDB_model_num:ie.ofConst(n,s.count,ie.Schema.int)},s.count),(v=new Xl).setNames([["MOL",o.mol_name||"Unknown Entity"]]),v.getEntityId("MOL",0,"A"),g=new Kl(s.subst_id,s.atom_name),y=0,b=s.subst_name.rowCount;y<b;++y)g.add(s.subst_name.value(y),y);return[4,Wd(zc({entity:v.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:m}),aL.create(e),t)];case 2:(C=N.sent()).frameCount>0&&(x=ie.ofIntArray(ie.mapToArray(u.origin_atom_id,function(j){return j-1},Int32Array)),A=ie.ofIntArray(ie.mapToArray(u.target_atom_id,function(j){return j-1},Int32Array)),T=u.bond_id,w=ie.ofIntArray(ie.mapToArray(u.bond_type,function(j){switch(j){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(j)}},Int8Array)),E=ie.ofIntArray(ie.mapToArray(u.bond_type,function(j){switch(j){case"ar":case"am":return 17;case"du":case"nc":return 0;default:return 1}},Int8Array)),I=Lo.fromData({pairs:{key:T,indexA:x,indexB:A,order:w,flag:E},count:s.count},{maxDistance:c?-1:1/0}),Lo.Provider.set(M=C.representative,I),hb.Provider.set(M,{data:s.charge,type:o.charge_type}),c&&(F=function _je(e){if(1===e.setting){var t=gs.create(e.spaceGroup,S.create(e.a,e.b,e.c),S.scale(S(),S.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:xu.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}}(c),F&&ei.Provider.set(M,F)),r.push(M)),N.label=3;case 3:return++n,[3,1];case 4:return[2,new mp(r)]}})})}(e,t)})}!function(e){e.is=function t(n){return"mol2"===n?.kind},e.create=function r(n){return{kind:"mol2",name:n.name,data:n}}}(aL||(aL={}));var Fu,oL,_b=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),iL=9;function Cje(){throw new Error("(xdrfile error) Undefined error.")}function xje(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j,k,H,G;return le(this,function(U){switch(U.label){case 0:r=new DataView(t.buffer,t.byteOffset),a=(n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0}).frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],c=[0,0,0],l=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,h=Fu.buf,U.label=1;case 1:for(m=void 0,v=r.getInt32(p+4),o.push(r.getFloat32(p+=12)),p+=4,g=new Float32Array(9),F=0;F<9;++F)g[F]=10*r.getFloat32(p),p+=4;if(i.push(g),v<=9)for(m={count:v/3,x:new Float32Array(v/3),y:new Float32Array(v/3),z:new Float32Array(v/3)},F=0;F<v/3;++F)m.x[F]=r.getFloat32(p),m.y[F]=r.getFloat32(p),m.z[F]=r.getFloat32(p),p+=4;else{for(h[0]=h[1]=h[2]=0,u[0]=u[1]=u[2]=0,l[0]=l[1]=l[2]=0,c[0]=c[1]=c[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,m={count:v,x:new Float32Array(v),y:new Float32Array(v),z:new Float32Array(v)},y=0,b=r.getInt32(p),_=r.getFloat32(p+=4),s[0]=r.getInt32(p+=4),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,p+=24,C=void 0,(u[0]|u[1]|u[2])>16777215?(c[0]=Fu.sizeOfInt(u[0]),c[1]=Fu.sizeOfInt(u[1]),c[2]=Fu.sizeOfInt(u[2]),C=0):C=Fu.sizeOfInts(3,u),x=r.getInt32(p),p+=4,T=_b[A=iL>(A=x-1)?iL:A]/2|0,w=_b[x]/2|0,l[0]=l[1]=l[2]=_b[x],E=4*Math.ceil(r.getInt32(p)/4),p+=4,I=1/_,M=0,F=0,d[0]=d[1]=d[2]=0;F<b;){if(0===C?(d[0]=Fu.decodeBits(t,p,c[0]),d[1]=Fu.decodeBits(t,p,c[1]),d[2]=Fu.decodeBits(t,p,c[2])):Fu.decodeInts(t,p,C,u,d),F++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],N=Fu.decodeBits(t,p,1),j=0,1===N&&(M=Fu.decodeBits(t,p,5),M-=j=M%3,j--),M>0)for(d[0]=d[1]=d[2]=0,k=0;k<M;k+=3)Fu.decodeInts(t,p,x,l,d),F++,d[0]+=f[0]-w,d[1]+=f[1]-w,d[2]+=f[2]-w,0===k?(H=d[0],d[0]=f[0],f[0]=H,H=d[1],d[1]=f[1],f[1]=H,H=d[2],d[2]=f[2],f[2]=H,m.x[y]=f[0]*I,m.y[y]=f[1]*I,m.z[y]=f[2]*I,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),m.x[y]=d[0]*I,m.y[y]=d[1]*I,m.z[y]=d[2]*I,y++;else m.x[y]=d[0]*I,m.y[y]=d[1]*I,m.z[y]=d[2]*I,y++;x+=j,j<0?(w=T,T=x>iL?_b[x-1]/2|0:0):j>0&&(T=w,w=_b[x]/2|0),l[0]=l[1]=l[2]=_b[x],(0===l[0]||0===l[1]||0===l[2])&&Cje()}p+=E}for(G=0;G<v;G++)m.x[G]*=10,m.y[G]*=10,m.z[G]*=10;return a.push(m),e.shouldUpdate?[4,e.update({current:p,max:t.length})]:[3,3];case 2:U.sent(),U.label=3;case 3:return p>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function wje(e){var t=this;return Ve.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,xje(r,e)];case 1:return n=i.sent(),[2,Nn.success(n)];case 2:return a=i.sent(),[2,Nn.error(""+a)];case 3:return[2]}})})})}function Aje(e){var t=this;return Ve.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=Su(e.deltaTime,"step"),a=Su(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],c=S.fromArray(S(),u,0),l=S.fromArray(S(),u,3),d=S.fromArray(S(),u,6),i.push({elementCount:e.frames[o].count,cell:Gp.fromBasis(c,l,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:Su(a.value+n.value*o,n.unit)});return[2,Av.create(i,n,a)]}})})})}function Tje(e){var t=e.position>=e.data.length-1?0:+lt.readLine(e);isNaN(t)&&(t=0);for(var r=lt.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var c=lt.readLineTrim(e).split(/\s+/g);o[s]=c[0],n[s]=+c[1],a[s]=+c[2],i[s]=+c[3]}return{count:t,comment:r,x:ie.ofFloatArray(n),y:ie.ofFloatArray(a),z:ie.ofFloatArray(i),type_symbol:ie.ofStringArray(o)}}function Dje(e){for(var t=lt(e),r=[];;){var n=Tje(t);if(0===n.count)break;r.push(n)}return Nn.success({molecules:r})}function Eje(e){var t=this;return Ve.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return le(this,function(r){return[2,Dje(e)]})})})}function Pje(e){return Ve.create("Parse XYZ",function(t){return function Ije(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++)n+=(o=i[a]).count;for(var s=new Array(n),u=new Int32Array(n),c=new Float32Array(n),l=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),p=0,h=0;h<r.length;h++)for(var o=r[h],m=0;m<o.count;m++)s[p]=o.type_symbol.value(m),c[p]=o.x.value(m),l[p]=o.y.value(m),d[p]=o.z.value(m),u[p]=m,f[p]=h,p++;var v=ie.ofConst("MOL",n,ie.Schema.str),g=ie.ofConst("A",n,ie.Schema.str),y=ie.ofConst(1,n,ie.Schema.int),b=ie.ofStringArray(s),_=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:v,auth_seq_id:y,Cartn_x:ie.ofFloatArray(c),Cartn_y:ie.ofFloatArray(l),Cartn_z:ie.ofFloatArray(d),id:ie.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:v,label_seq_id:y,label_entity_id:ie.ofConst("1",n,ie.Schema.str),occupancy:ie.ofConst(1,n,ie.Schema.float),type_symbol:b,pdbx_PDB_model_num:ie.ofIntArray(f)},n),C=new Xl;C.setNames([["MOL","Unknown Entity"]]),C.getEntityId("MOL",0,"A");var x=new Kl(y,b);return x.setNames([["MOL","Unknown Molecule"]]),x.add("MOL",0),Wd(zc({entity:C.getEntityTable(),chem_comp:x.getChemCompTable(),atom_site:_}),oL.create(e),t)}(e,t)})}function Wp(e){lt.skipWhitespace(e),lt.eatValue(e)}function Yp(e,t){var r=e.position;lt.skipWhitespace(e),lt.eatValue(e),lt.trim(e,r,e.position),Ke.addUnchecked(t,e.tokenStart,e.tokenEnd)}!function(e){e.sizeOfInt=function t(l){for(var d=1,f=0;l>=d&&f<32;)f++,d<<=1;return f};var r=new Uint8Array(32);e.sizeOfInts=function n(l,d){var f=1,p=0;r[0]=1;for(var h=0;h<l;h++){var m=void 0,v=0;for(m=0;m<f;m++)r[m]=255&(v+=r[m]*d[h]),v>>=8;for(;0!==v;)r[m++]=255&v,v>>=8;f=m}var g=1;for(f--;r[f]>=g;)p++,g*=2;return p+8*f};var a=new ArrayBuffer(24);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(l,d,f){for(var p=f,h=(1<<p)-1,m=i[1],v=i[2],g=e.buf[0],y=0;p>=8;)y|=(v=v<<8|l[d+g++])>>m<<p-8,p-=8;return p>0&&(m<p&&(m+=8,v=v<<8|l[d+g++]),y|=v>>(m-=p)&(1<<p)-1),y&=h,e.buf[0]=g,e.buf[1]=m,e.buf[2]=v,y}function s(l,d){var f=i[2],p=e.buf[0];return f=f<<8|l[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>i[1]&255}e.decodeBits=o;var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];e.decodeInts=function c(l,d,f,p,h){var m=f,v=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;m>8;)u[v++]=s(l,d),m-=8;m>0&&(u[v++]=o(l,d,m));for(var g=2;g>0;g--){for(var y=0,b=p[g],_=v-1;_>=0;_--){var C=(y=y<<8|u[_])/b|0;u[_]=C,y-=C*b}h[g]=y}h[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}}(Fu||(Fu={})),function(e){e.is=function t(n){return"xyz"===n?.kind},e.create=function r(n){return{kind:"xyz",name:"xyz",data:n}}}(oL||(oL={}));var uL,sL="$$$$";function Bje(e){var t=lt.readLine(e).trim(),r=lt.readLine(e).trim(),n=lt.readLine(e).trim(),a=lt.readLine(e),i=function Mje(e){return e.trim().endsWith("V3000")}(a),o=i?function Rje(e){var t=Ke.create(e.data,1),r=Ke.create(e.data,1);return lt.eatLine(e),Wp(e),Wp(e),Wp(e),Yp(e,t),Yp(e,r),lt.eatLine(e),{atomCount:er(t)(ie.Schema.int).value(0),bondCount:er(r)(ie.Schema.int).value(0)}}(e):function kje(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}(a),s=o.atomCount,u=o.bondCount;if(!Number.isNaN(s)&&!Number.isNaN(u)){var l={atomIdx:ie.ofConst(0,s,ie.Schema.int),charge:ie.ofConst(0,s,ie.Schema.int)},d=i?function Oje(e,t){for(var r=Ke.create(e.data,2*t),n=Ke.create(e.data,2*t),a=Ke.create(e.data,2*t),i=Ke.create(e.data,2*t),o=0;o<t;++o){lt.markLine(e),Wp(e),Wp(e),Wp(e);var s=e.position;Yp(e,i),Yp(e,r),Yp(e,n),Yp(e,a),e.position=s}return lt.eatLine(e),lt.eatLine(e),{count:t,x:er(r)(ie.Schema.float),y:er(n)(ie.Schema.float),z:er(a)(ie.Schema.float),type_symbol:er(i)(ie.Schema.str),formal_charge:ie.ofConst(0,t,ie.Schema.int)}}(e,s):ire(e,s),f=i?function Fje(e,t){for(var r=Ke.create(e.data,2*t),n=Ke.create(e.data,2*t),a=Ke.create(e.data,2*t),i=0;i<t;++i){lt.markLine(e),Wp(e),Wp(e),Wp(e);var o=e.position;Yp(e,a),Yp(e,r),Yp(e,n),e.position=o}return lt.eatLine(e),lt.eatLine(e),{count:t,atomIdxA:er(r)(ie.Schema.float),atomIdxB:er(n)(ie.Schema.float),order:er(a)(ie.Schema.float)}}(e,u):ore(e,u),p=i?l:sre(e),h=function Nje(e){for(var t=Ke.create(e.data,32),r=Ke.create(e.data,32);e.position<e.length;){var n=lt.readLine(e);if(n.startsWith(sL))break;if(n&&n.startsWith("> ")){Ke.add(t,e.tokenStart+2,e.tokenEnd),lt.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=lt.readLine(e);if(!s||s.startsWith(sL)||s.startsWith("> ")){Ke.add(r,a,i),o=!0;break}i=e.tokenEnd}o||Ke.add(r,a,i)}}return{dataHeader:er(t)(ie.Schema.str),data:er(r)(ie.Schema.str)}}(e);return{molFile:{title:t,program:r,comment:n,atoms:d,bonds:f,formalCharges:p},dataItems:h}}for(;e.position<e.length&&!lt.readLine(e).startsWith(sL););}function Lje(e){for(var t=lt(e),r=[];t.position<t.length;){var n=Bje(t);n&&r.push(n)}return Nn.success({compounds:r})}function Uje(e){var t=this;return Ve.create("Parse Sdf",function(){return ce(t,void 0,void 0,function(){return le(this,function(r){return[2,Lje(e)]})})})}function Vje(e){return Ve.create("Parse SDF",function(t){return ure(e.molFile,uL.create(e),t)})}function zje(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T;return le(this,function(w){for(t=new DataView(e.buffer),n=(r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0}).frames,a=r.boxes,i=r.times,o=0;;){if(s=t.getInt32(o+=8),o+=4,u=t.getInt32((o+=s)+8),c=t.getInt32(o+12),l=t.getInt32(o+16),d=t.getInt32(o+28),f=t.getInt32(o+32),p=t.getInt32(o+36),h=t.getInt32(o+40),o+=52,v=3*h,i.push(8==(m=u/9)?t.getFloat64(o):t.getFloat32(o)),o+=2*m,u){if(g=new Float32Array(9),8===m)for(T=0;T<9;++T)g[T]=10*t.getFloat64(o),o+=8;else for(T=0;T<9;++T)g[T]=10*t.getFloat32(o),o+=4;a.push(g)}if(o+=c,o+=l,d){if(y=new Float32Array(h),b=new Float32Array(h),_=new Float32Array(h),8===m)for(T=0;T<h;++T)y[T]=10*t.getFloat64(o),b[T]=10*t.getFloat64(o+8),_[T]=10*t.getFloat64(o+16),o+=24;else{for(C=new Uint32Array(e.buffer,o,v),T=0;T<v;++T)C[T]=(255&(x=C[T]))<<24|(65280&x)<<8|x>>8&65280|x>>24&255;for(A=new Float32Array(e.buffer,o,v),T=0;T<h;++T)y[T]=10*A[3*T],b[T]=10*A[3*T+1],_[T]=10*A[3*T+2],o+=12}n.push({count:h,x:y,y:b,z:_})}if(o+=f,(o+=p)>=e.byteLength)break}return i.length>=1&&(r.timeOffset=i[0]),i.length>=2&&(r.deltaTime=i[1]-i[0]),[2,r]})})}function Gje(e){var t=this;return Ve.create("Parse TRR",function(r){return ce(t,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,zje(e)];case 1:return n=i.sent(),[2,Nn.success(n)];case 2:return a=i.sent(),[2,Nn.error(""+a)];case 3:return[2]}})})})}function Hje(e){var t=this;return Ve.create("Parse TRR",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=Su(e.deltaTime,"step"),a=Su(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],c=S.fromArray(S(),u,0),l=S.fromArray(S(),u,3),d=S.fromArray(S(),u,6),i.push({elementCount:e.frames[o].count,cell:Gp.fromBasis(c,l,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:Su(a.value+n.value*o,n.unit)});return[2,Av.create(i,n,a)]}})})})}!function(e){e.is=function t(n){return"sdf"===n?.kind},e.create=function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}}(uL||(uL={}));var cL=[],qje=function(){function e(t,r){void 0===r&&(r={}),this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;var n=!1;void 0===t&&(t=8192),"number"==typeof t?t=new ArrayBuffer(t):n=!0;var a=r.offset?r.offset>>>0:0,i=t.byteLength-a,o=a;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+a),t=t.buffer),this._lastWrittenByte=n?i:0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=o,this._data=new DataView(this.buffer,o,i)}return e.prototype.available=function(t){return void 0===t&&(t=1),this.offset+t<=this.length},e.prototype.isLittleEndian=function(){return this.littleEndian},e.prototype.setLittleEndian=function(){return this.littleEndian=!0,this},e.prototype.isBigEndian=function(){return!this.littleEndian},e.prototype.setBigEndian=function(){return this.littleEndian=!1,this},e.prototype.skip=function(t){return void 0===t&&(t=1),this.offset+=t,this},e.prototype.seek=function(t){return this.offset=t,this},e.prototype.mark=function(){return this._mark=this.offset,this},e.prototype.reset=function(){return this.offset=this._mark,this},e.prototype.pushMark=function(){return this._marks.push(this.offset),this},e.prototype.popMark=function(){var t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this},e.prototype.rewind=function(){return this.offset=0,this},e.prototype.ensureAvailable=function(t){if(void 0===t&&(t=1),!this.available(t)){var n=2*(this.offset+t),a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this},e.prototype.readBoolean=function(){return 0!==this.readUint8()},e.prototype.readInt8=function(){return this._data.getInt8(this.offset++)},e.prototype.readUint8=function(){return this._data.getUint8(this.offset++)},e.prototype.readByte=function(){return this.readUint8()},e.prototype.readBytes=function(t){void 0===t&&(t=1);for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=this.readByte();return r},e.prototype.readInt16=function(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},e.prototype.readUint16=function(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},e.prototype.readInt32=function(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.readUint32=function(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.readFloat32=function(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.readFloat64=function(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},e.prototype.readChar=function(){return String.fromCharCode(this.readInt8())},e.prototype.readChars=function(t){void 0===t&&(t=1),cL.length=t;for(var r=0;r<t;r++)cL[r]=this.readChar();return cL.join("")},e.prototype.writeBoolean=function(t){return void 0===t&&(t=!1),this.writeUint8(t?255:0),this},e.prototype.writeInt8=function(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this},e.prototype.writeUint8=function(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this},e.prototype.writeByte=function(t){return this.writeUint8(t)},e.prototype.writeBytes=function(t){this.ensureAvailable(t.length);for(var r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this},e.prototype.writeInt16=function(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},e.prototype.writeUint16=function(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},e.prototype.writeInt32=function(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},e.prototype.writeUint32=function(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},e.prototype.writeFloat32=function(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},e.prototype.writeFloat64=function(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this},e.prototype.writeChar=function(t){return this.writeUint8(t.charCodeAt(0))},e.prototype.writeChars=function(t){for(var r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this},e.prototype.toArray=function(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)},e.prototype._updateLastWrittenByte=function(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)},e}();function dl(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function fre(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function lL(e){var t=e.readUint32(),r=e.readChars(t);return fre(e),r}var si={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function pre(e){switch(Number(e)){case si.BYTE:return"byte";case si.CHAR:return"char";case si.SHORT:return"short";case si.INT:return"int";case si.FLOAT:return"float";case si.DOUBLE:return"double";default:return"undefined"}}function hre(e){switch(Number(e)){case si.BYTE:case si.CHAR:return 1;case si.SHORT:return 2;case si.INT:case si.FLOAT:return 4;case si.DOUBLE:return 8;default:return-1}}function mre(e){switch(String(e)){case"byte":return si.BYTE;case"char":return si.CHAR;case"short":return si.SHORT;case"int":return si.INT;case"float":return si.FLOAT;case"double":return si.DOUBLE;default:return-1}}function iE(e,t){if(1!==e){for(var r=new Array(e),n=0;n<e;n++)r[n]=t();return r}return t()}function dL(e,t,r){switch(t){case si.BYTE:return e.readBytes(r);case si.CHAR:return function Wje(e){return 0===e.charCodeAt(e.length-1)?e.substring(0,e.length-1):e}(e.readChars(r));case si.SHORT:return iE(r,e.readInt16.bind(e));case si.INT:return iE(r,e.readInt32.bind(e));case si.FLOAT:return iE(r,e.readFloat32.bind(e));case si.DOUBLE:return iE(r,e.readFloat64.bind(e));default:return void dl(!0,"non valid type "+t)}}var Sb=0,Qje=12;function vre(e){var t,r=e.readUint32();if(r===Sb)return dl(e.readUint32()!==Sb,"wrong empty tag for list of attributes"),[];dl(r!==Qje,"wrong tag for list of attributes");var n=e.readUint32();t=new Array(n);for(var a=0;a<n;a++){var i=lL(e),o=e.readUint32();dl(o<1||o>6,"non valid type "+o);var s=e.readUint32(),u=dL(e,o,s);fre(e),t[a]={name:i,type:pre(o),value:u}}return t}var fL,pL,tqe=function(){function e(t){var r=new qje(t);r.setBigEndian(),dl("CDF"!==r.readChars(3),"should start with CDF");var n=r.readByte();dl(n>2,"unknown version"),this.header=function $je(e,t){var r={recordDimension:{length:e.readUint32()}};r.version=t;var n=function Jje(e){var t,r,n,a=e.readUint32();if(a===Sb)return dl(e.readUint32()!==Sb,"wrong empty tag for list of dimensions"),[];dl(10!==a,"wrong tag for list of dimensions");var i=e.readUint32();t=new Array(i);for(var o=0;o<i;o++){var s=lL(e),u=e.readUint32();0===u&&(r=o,n=s),t[o]={name:s,size:u}}return{dimensions:t,recordId:r,recordName:n}}(e);r.recordDimension.id=n.recordId,r.recordDimension.name=n.recordName,r.dimensions=n.dimensions,r.globalAttributes=vre(e);var a=function eqe(e,t,r){var i,n=e.readUint32(),a=0;if(n===Sb)return dl(e.readUint32()!==Sb,"wrong empty tag for list of variables"),[];dl(11!==n,"wrong tag for list of variables");var o=e.readUint32();i=new Array(o);for(var s=0;s<o;s++){for(var u=lL(e),c=e.readUint32(),l=new Array(c),d=0;d<c;d++)l[d]=e.readUint32();var f=vre(e),p=e.readUint32();dl(p<1&&p>6,"non valid type "+p);var h=e.readUint32(),m=e.readUint32();2===r&&(dl(m>0,"offsets larger than 4GB not supported"),m=e.readUint32()),l[0]===t&&(a+=h),i[s]={name:u,dimensions:l,attributes:f,type:pre(p),size:h,offset:m,record:l[0]===t}}return{variables:i,recordStep:a}}(e,n.recordId,t);return r.variables=a.variables,r.recordDimension.recordStep=a.recordStep,r}(r,n),this.buffer=r}return Object.defineProperty(e.prototype,"version",{get:function(){return 1===this.header.version?"classic format":"64-bit offset format"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"recordDimension",{get:function(){return this.header.recordDimension},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dimensions",{get:function(){return this.header.dimensions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalAttributes",{get:function(){return this.header.globalAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"variables",{get:function(){return this.header.variables},enumerable:!1,configurable:!0}),e.prototype.hasDataVariable=function(t){return this.header.variables&&-1!==this.header.variables.findIndex(function(r){return r.name===t})},e.prototype.getDataVariable=function(t){var r,n;if(void 0===(n="string"==typeof t?null===(r=this.header.variables)||void 0===r?void 0:r.find(function(a){return a.name===t}):t))throw new Error("variable not found");return this.buffer.seek(n.offset),n.record?function Xje(e,t,r){for(var n=mre(t.type),a=t.size?t.size/hre(n):1,i=r.length,o=new Array(i),s=r.recordStep,u=0;u<i;u++){var c=e.offset;o[u]=dL(e,n,a),e.seek(c+s)}return o}(this.buffer,n,this.header.recordDimension):function Yje(e,t){for(var r=mre(t.type),n=t.size/hre(r),a=new Array(n),i=0;i<n;i++)a[i]=dL(e,r,1);return a}(this.buffer,n)},e}();function rqe(e){return ce(this,void 0,void 0,function(){var t,r,n,a,o,s,u,l,d,f,h,m,v,y,b,_,x,A,T;return le(this,function(E){for(t=new tqe(e),r={coordinates:[],time:[],timeOffset:0,deltaTime:1},n=0,a=t.getDataVariable("coordinates");n<a.length;n++)r.coordinates.push(a[n]);if(t.hasDataVariable("velocities")){for(o=[],s=0,u=t.getDataVariable("velocities");s<u.length;s++)o.push(u[s]);r.velocities=o}if(t.hasDataVariable("forces")){for(l=[],d=0,f=t.getDataVariable("forces");d<f.length;d++)l.push(f[d]);r.forces=l}if(t.hasDataVariable("cell_lengths")){for(h=[],m=0,v=t.getDataVariable("cell_lengths");m<v.length;m++)h.push(v[m]);r.cell_lengths=h}if(t.hasDataVariable("cell_angles")){for(y=[],b=0,_=t.getDataVariable("cell_angles");b<_.length;b++)y.push(_[b]);r.cell_angles=y}if(t.hasDataVariable("time")){for(x=[],A=0,T=t.getDataVariable("time");A<T.length;A++)x.push(T[A]);r.time=x}return r.time&&(r.time.length>=1&&(r.timeOffset=r.time[0]),r.time.length>=2&&(r.deltaTime=r.time[1]-r.time[0])),[2,r]})})}function nqe(e){var t=this;return Ve.create("Parse NCTRAJ",function(r){return ce(t,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,rqe(e)];case 1:return n=i.sent(),[2,Nn.success(n)];case 2:return a=i.sent(),[2,Nn.error(""+a)];case 3:return[2]}})})})}function aqe(e){var t=this;return Ve.create("Parse NCTRAJ",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b;return le(this,function(_){switch(_.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(_.sent(),n=Su(e.deltaTime,"step"),a=Su(e.timeOffset,n.unit),i=[],o=0,s=e.coordinates.length;o<s;++o){for(c=(u=e.coordinates[o]).length/3,l=new Float32Array(c),d=new Float32Array(c),f=new Float32Array(c),p=0,h=u.length;p<h;p+=3)l[p/3]=u[p],d[p/3]=u[p+1],f[p/3]=u[p+2];m={elementCount:c,x:l,y:d,z:f,xyzOrdering:{isIdentity:!0},time:Su(a.value+n.value*o,n.unit)},e.cell_lengths&&(v=e.cell_lengths[o],g=S.scale(S(),S.unitX,v[0]),y=S.scale(S(),S.unitY,v[1]),b=S.scale(S(),S.unitZ,v[2]),m.cell=Gp.fromBasis(g,y,b)),i.push(m)}return[2,Av.create(i,n,a)]}})})})}function oqe(e){var t=this;return Ve.create("Parse PRMTOP",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return le(this,function(f){return n=fL.fromPrmtop(e),a=function iqe(e){for(var t=e.pointers,r=e.residuePointer,n=e.residueLabel,a=e.atomName,i=t.NATOM,o=t.NRES,s=new Uint32Array(i),u=[],c=function(G,U,Q){for(var W=n.value(G),K=U,ne=Q;K<ne;++K)s[K]=G+1,u[K]=W},l=0,d=o-1;l<d;++l)c(l,r.value(l)-1,r.value(l+1)-1);c(o-1,r.value(o-1)-1,i);var f=ie.ofIntArray(s),p=ie.ofStringArray(u),h=new Array(i),m=new Array(i),v=new Uint32Array(i),g=new Uint32Array(i),y=new Xl,b=new Kl(f,a),_="",C=0,x="",A=0,T=0,w=-1;for(l=0,d=i;l<d;++l){var E=f.value(l);if(E!==w){var I=p.value(l),M=Hh(b.add(I,l).type,I);M!==T&&(x=jS(C),C+=1,A=0),_=y.getEntityId(I,M,x),A+=1,w=E,T=M}h[l]=_,m[l]=x,v[l]=A,g[l]=l}var F=ie.ofIntArray(g),N=ie.ofStringArray(m),j=new Array(i);for(l=0;l<i;++l)j[l]=pb(a.value(l),p.value(l));var k=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:N,auth_atom_id:ie.asArrayColumn(a),auth_comp_id:p,auth_seq_id:f,id:ie.asArrayColumn(F),label_asym_id:N,label_atom_id:ie.asArrayColumn(a),label_comp_id:p,label_seq_id:ie.ofIntArray(v),label_entity_id:ie.ofStringArray(h),occupancy:ie.ofConst(1,i,ie.Schema.float),type_symbol:ie.ofStringArray(j),pdbx_PDB_model_num:ie.ofConst(1,i,ie.Schema.int)},i);return zc({entity:y.getEntityTable(),chem_comp:b.getChemCompTable(),atom_site:k})}(e),u=e.bondsIncHydrogen,c=e.bondsWithoutHydrogen,d={indexA:ie.ofLambda({value:function(p){return p<o?u.value(3*p)/3:c.value(3*(p-o))/3},rowCount:l=(o=(i=e.pointers).NBONH)+i.NBONA,schema:ie.Schema.int}),indexB:ie.ofLambda({value:function(p){return p<o?u.value(3*p+1)/3:c.value(3*(p-o)+1)/3},rowCount:l,schema:ie.Schema.int}),order:ie.ofConst(1,l,ie.Schema.int)},[2,g2.create(e.title.join(" ")||"PRMTOP",a,d,n)]})})})}function cqe(e){var t=this;return Ve.create("Parse TOP",function(r){return ce(t,void 0,void 0,function(){var n,a,i;return le(this,function(o){return n=pL.fromTop(e),a=function sqe(e){for(var t=e.molecules,r=e.compounds,n={},a=0,i=0,o=t._rowCount;i<o;++i){var s=t.compound.value(i),u=t.molCount.value(i);ie.asArrayColumn((c=r[s].atoms).atom),ie.asArrayColumn(c.resnr),ie.asArrayColumn(c.residu),a+=u*c._rowCount;var l=c.resnr.value(0);n[s]=!0;for(var d=1,f=c._rowCount;d<f;++d){var p=c.resnr.value(d);if(p!==l){n[s]=!1;break}l=p}}var h=new Array(a),m=new Uint32Array(a),v=new Array(a),g=0;for(i=0,o=t._rowCount;i<o;++i){s=t.compound.value(i),u=t.molCount.value(i);var c=r[s].atoms,y=n[s];for(d=0;d<u;++d)for(var b=0,_=c._rowCount;b<_;++b)h[g]=c.atom.value(b),m[g]=c.resnr.value(b),v[g]=c.residu.value(b),y&&(m[g]+=d),g+=1}var C=ie.ofStringArray(h),x=ie.ofIntArray(m),A=ie.ofStringArray(v),T=new Array(a),w=new Array(a),E=new Uint32Array(a),I=new Uint32Array(a),M=new Xl,F=new Kl(x,C),N="",j=0,k="",H=0,G=0,U=-1;for(i=0,o=a;i<o;++i){var Q=x.value(i);if(Q!==U){var W=A.value(i),K=Hh(F.add(W,i).type,W);K!==G&&(k=jS(j),j+=1,H=0),N=M.getEntityId(W,K,k),H+=1,U=Q,G=K}T[i]=N,w[i]=k,E[i]=H,I[i]=i}var ne=ie.ofIntArray(I),X=ie.ofStringArray(w),L=new Array(a);for(i=0;i<a;++i)L[i]=pb(C.value(i),A.value(i));var Y=Qr.ofPartialColumns(Vo.atom_site,{auth_asym_id:X,auth_atom_id:ie.asArrayColumn(C),auth_comp_id:A,auth_seq_id:x,id:ie.asArrayColumn(ne),label_asym_id:X,label_atom_id:ie.asArrayColumn(C),label_comp_id:A,label_seq_id:ie.ofIntArray(E),label_entity_id:ie.ofStringArray(T),occupancy:ie.ofConst(1,a,ie.Schema.float),type_symbol:ie.ofStringArray(L),pdbx_PDB_model_num:ie.ofConst(1,a,ie.Schema.int)},a);return zc({entity:M.getEntityTable(),chem_comp:F.getChemCompTable(),atom_site:Y})}(e),i=function uqe(e){for(var t=e.molecules,r=e.compounds,n=[],a=[],i=0,o=0,s=t._rowCount;o<s;++o){var u=t.compound.value(o),c=t.molCount.value(o),l=r[u],d=l.atoms,f=l.bonds;if(f)for(var p=0;p<c;++p){for(var h=0,m=f._rowCount;h<m;++h)n.push(f.ai.value(h)-1+i),a.push(f.aj.value(h)-1+i);i+=d._rowCount}else if("TIP3"===u)for(p=0;p<c;++p)n.push(0+i),a.push(1+i),n.push(0+i),a.push(2+i),i+=d._rowCount;else i+=c*d._rowCount}return{indexA:ie.ofIntArray(n),indexB:ie.ofIntArray(a),order:ie.ofConst(1,n.length,ie.Schema.int)}}(e),[2,g2.create(e.system||"TOP",a,i,n)]})})})}!function(e){e.is=function t(n){return"prmtop"===n?.kind},e.fromPrmtop=function r(n){return{kind:"prmtop",name:n.title.join(" ")||"PRMTOP",data:n}}}(fL||(fL={})),function(e){e.is=function t(n){return"top"===n?.kind},e.fromTop=function r(n){return{kind:"top",name:n.system||"TOP",data:n}}}(pL||(pL={}));var lqe=kt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DCD",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,F6e(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,PHe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),dqe=kt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse XTC",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,wje(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,Aje(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),fqe=kt.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse TRR",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,Gje(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,Hje(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),pqe=kt.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse NCTRAJ",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,nqe(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,aqe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),hqe=kt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[ve.Format.Psf],to:ve.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Ve.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,n9e(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ve.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}}),mqe=kt.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[ve.Format.Prmtop],to:ve.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Ve.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,oqe(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ve.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}}),vqe=kt.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[ve.Format.Top],to:ve.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Ve.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,cqe(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ve.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function gqe(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(i){switch(i.label){case 0:return t.type!==ve.Molecule.Topology.type?[3,2]:[4,ir.trajectoryFromTopologyAndCoordinates(t.data,r).runInContext(e)];case 1:return[2,i.sent()];case 2:if(t.type===ve.Molecule.Model.type)return[2,ir.trajectoryFromModelAndCoordinates(t.data,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var hL=kt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ve.Root,to:ve.Molecule.Trajectory,params:{modelRef:D.Text("",{isHidden:!0}),coordinatesRef:D.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return Ve.create("Create trajectory from model/topology and coordinates",function(a){return ce(t,void 0,void 0,function(){var o,s;return le(this,function(u){switch(u.label){case 0:return[4,gqe(a,n[r.modelRef],n[r.coordinatesRef].data)];case 1:return o=u.sent(),s={label:"Trajectory",description:"".concat(o.frameCount," model").concat(1===o.frameCount?"":"s")},[2,new ve.Molecule.Trajectory(o,s)]}})})})}}),yqe=kt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ve.Format.Blob,to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse Format Blob",function(n){return ce(t,void 0,void 0,function(){var a,i,o,s,c,l,d,f;return le(this,function(p){switch(p.label){case 0:a=[],i=0,o=r.data,p.label=1;case 1:return i<o.length?"cif"!==(s=o[i]).kind?[3,6]:[4,s4(s.data.blocks[0]).runInContext(n)]:[3,7];case 2:if(0===(c=p.sent()).frameCount)throw new Error("No models found.");d=0,p.label=3;case 3:return d<c.frameCount?[4,Ve.resolveInContext(c.getFrameAtIndex(d),n)]:[3,6];case 4:l=p.sent(),a.push(l),p.label=5;case 5:return d++,[3,3];case 6:return i++,[3,1];case 7:for(d=0;d<a.length;d++)ir.TrajectoryInfo.set(a[d],{index:d,size:a.length});return f={label:"Trajectory",description:"".concat(a.length," model").concat(1===a.length?"":"s")},[2,new ve.Molecule.Trajectory(new mp(a),f)]}})})})}});function Xp(e){return{label:"".concat(e.representative.entry),description:"".concat(e.frameCount," model").concat(1===e.frameCount?"":"s")}}var bqe=kt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ve.Format.Cif,to:ve.Molecule.Trajectory,params:function(e){if(!e)return{loadAllBlocks:D.Optional(D.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:D.Optional(D.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:function(n){return!0===n.loadAllBlocks}})),blockIndex:D.Optional(D.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:function(n){return!0===n.loadAllBlocks||n.blockHeader}}))};var t=e.data.blocks,r=t.map(function(n){return[n.header,n.header]});return r.push(["","[Use Block Index]"]),{loadAllBlocks:D.Optional(D.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:D.Optional(D.Select(t[0]&&t[0].header,r,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:function(n){return!0===n.loadAllBlocks}})),blockIndex:D.Optional(D.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:function(n){return!0===n.loadAllBlocks||n.blockHeader}}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse mmCIF",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,v,g,y;return le(this,function(b){switch(b.label){case 0:if(!n.loadAllBlocks)return[3,10];o=[],s=0,u=r.data.blocks,b.label=1;case 1:return s<u.length?(h=u[s],a.shouldUpdate?[4,a.update("Parsing ".concat(h.header,"..."))]:[3,3]):[3,9];case 2:b.sent(),b.label=3;case 3:return[4,s4(h).runInContext(a)];case 4:c=b.sent(),l=0,b.label=5;case 5:return l<c.frameCount?(f=(d=o).push,[4,Ve.resolveInContext(c.getFrameAtIndex(l),a)]):[3,8];case 6:f.apply(d,[b.sent()]),b.label=7;case 7:return l++,[3,5];case 8:return s++,[3,1];case 9:return i=new mp(o),[3,15];case 10:if(p=n.blockHeader||r.data.blocks[null!==(y=n.blockIndex)&&void 0!==y?y:0].header,!(h=r.data.blocks.find(function(_){return _.header===p})))throw new Error("Data block '".concat([p],"' not found."));return!h.categoryNames.includes("chem_comp_atom")||h.categoryNames.includes("atom_site")||h.categoryNames.includes("ihm_sphere_obj_site")||h.categoryNames.includes("ihm_gaussian_obj_site")?[3,12]:[4,NFe(h).runInContext(a)];case 11:return v=b.sent(),[3,14];case 12:return[4,s4(h,r.data).runInContext(a)];case 13:v=b.sent(),b.label=14;case 14:i=v,b.label=15;case 15:if(0===i.frameCount)throw new Error("No models found.");return g=Xp(i),[2,new ve.Molecule.Trajectory(i,g)]}})})})}}),_qe=kt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory,params:{isPdbqt:D.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse PDB",function(a){return ce(t,void 0,void 0,function(){var i,o,s;return le(this,function(u){switch(u.label){case 0:return[4,q6e(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if((i=u.sent()).isError)throw new Error(i.message);return[4,t9e(i.result).runInContext(a)];case 2:return o=u.sent(),s=Xp(o),[2,new ve.Molecule.Trajectory(o,s)]}})})})}}),Sqe=kt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse GRO",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return[4,j6e(r.data).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,kHe(a.result).runInContext(n)];case 2:return i=s.sent(),o=Xp(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),Cqe=kt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse XYZ",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return[4,Eje(r.data).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,Pje(a.result).runInContext(n)];case 2:return i=s.sent(),o=Xp(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),xqe=kt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return[4,tje(r.data).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,rje(a.result).runInContext(n)];case 2:return i=s.sent(),o=Xp(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),wqe=kt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse SDF",function(n){return ce(t,void 0,void 0,function(){var a,i,o,s,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return[4,Uje(r.data).runInContext(n)];case 1:if((a=m.sent()).isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,m.label=2;case 2:return o<s.length?[4,Vje(s[o]).runInContext(n)]:[3,8];case 3:c=m.sent(),l=0,m.label=4;case 4:return l<c.frameCount?(f=(d=i).push,[4,Ve.resolveInContext(c.getFrameAtIndex(l),n)]):[3,7];case 5:f.apply(d,[m.sent()]),m.label=6;case 6:return l++,[3,4];case 7:return o++,[3,2];case 8:return p=new mp(i),h=Xp(p),[2,new ve.Molecule.Trajectory(p,h)]}})})})}}),Aqe=kt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse MOL2",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return[4,yje(r.data,r.label).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,Sje(a.result).runInContext(n)];case 2:return i=s.sent(),o=Xp(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),Tqe=kt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ve.Format.Cube,to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,lje(r.data).runInContext(n)];case 1:return a=o.sent(),i=Xp(a),[2,new ve.Molecule.Trajectory(a,i)]}})})})}}),Dqe=kt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ve.Format.Cif,to:ve.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:D.Optional(D.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:D.Optional(D.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse CIF Core",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u;return le(this,function(c){switch(c.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,!(o=r.data.blocks.find(function(l){return l.header===i})))throw new Error("Data block '".concat([i],"' not found."));return[4,uje(o).runInContext(a)];case 1:if(0===(s=c.sent()).frameCount)throw new Error("No models found.");return u=Xp(s),[2,new ve.Molecule.Trajectory(s,u)]}})})})}}),Eqe=function(e){return e+1},Iqe=function(e){return e-1},gre=kt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ve.Molecule.Trajectory,to:ve.Molecule.Model,params:function(e){return e?{modelIndex:D.Converted(Eqe,Iqe,D.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:D.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Model from Trajectory",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u;return le(this,function(c){switch(c.label){case 0:return(i=n.modelIndex%r.data.frameCount)<0&&(i+=r.data.frameCount),[4,Ve.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=c.sent(),s="Model ".concat(i+1),u=1===r.data.frameCount?void 0:"of ".concat(r.data.frameCount),[2,new ve.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){return{modelIndex:r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r)}},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Pqe=kt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ve.Molecule.Trajectory,to:ve.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return Ve.create("Build Structure",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,Ye.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:Ye.elementDescription(a)},[2,new ve.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Mqe=kt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ve.Molecule.Model,to:ve.Molecule.Structure,params:function(e){return lg.getParams(e&&e.data)}})({canAutoUpdate:function(e){return lg.canAutoUpdate(e.oldParams.type,e.newParams.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Build Structure",function(i){return ce(r,void 0,void 0,function(){return le(this,function(o){return[2,lg.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b;return Nd(e.oldParams,e.newParams)?r.data.model===t.data?rt.UpdateResult.Unchanged:ir.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),rt.UpdateResult.Updated):rt.UpdateResult.Recreate:rt.UpdateResult.Recreate},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),yre=S(),bre=me(),_re=me(),Rqe=kt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:{transform:D.MappedStatic("components",{components:D.Group({axis:D.Vec3(S.create(1,0,0)),angle:D.Numeric(0,{min:-180,max:180,step:.1}),translation:D.Vec3(S.create(0,0,0))},{isFlat:!0}),matrix:D.Group({data:D.Mat4(me.identity()),transpose:D.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){return"matrix"!==e.newParams.transform.name},apply:function(e){var t=e.a,r=e.params,n=me();if("components"===r.transform.name){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;me.fromTranslation(bre,S.negate(yre,u)),me.fromTranslation(_re,S.add(yre,u,s));var c=me.fromRotation(me(),Math.PI/180*o,S.normalize(S(),i));me.mul3(n,_re,c,bre)}else"matrix"===r.transform.name&&(me.copy(n,r.transform.params.data),r.transform.params.transpose&&me.transpose(n,n));var l=Ye.transform(t.data,n);return new ve.Molecule.Structure(l,{label:t.label,description:"".concat(t.description," [Transformed]")})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Oqe=kt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{expression:D.Value(de.struct.generator.all,{isHidden:!0}),label:D.Optional(D.Text("",{isHidden:!0}))}}})({apply:function(e){var r=e.params,n=e.cache,a=Ds.createAndRun(e.a.data,r.expression),i=a.selection;if(n.entry=a.entry,mt.isEmpty(i))return ua.Null;var s=mt.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:Ye.elementDescription(s)};return new ve.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,a=e.newParams;if(e.oldParams.expression!==a.expression)return rt.UpdateResult.Recreate;var o=e.cache.entry;if(o.currentStructure===t.data)return rt.UpdateResult.Unchanged;var s=Ds.updateStructure(o,t.data);return mt.isEmpty(s)?rt.UpdateResult.Null:(Ds.updateStructureObject(r,s,a.label),rt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Fqe=kt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ve.Root,to:ve.Molecule.Structure.Selections,params:function(){return{selections:D.ObjectList({key:D.Text(void 0,{description:"A unique key."}),ref:D.Text(),groupId:D.Optional(D.Text()),expression:D.Value(de.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:D.Optional(D.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:D.Optional(D.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var c=u[s],l=Ds.createAndRun(n[c.ref].data,c.expression),d=l.selection;a.set(c.key,l.entry);var p=mt.toLociWithSourceUnits(d);i.push({key:c.key,loci:p,groupId:c.groupId}),o+=Re.size(p)}r.entries=a;var h={label:"".concat(t.label||"Multi-selection"),description:"".concat(t.selections.length," source(s), ").concat(o," element(s) total")};return new ve.Molecule.Structure.Selections(i,h)},update:function(e){var t=e.b,n=e.newParams,a=e.cache,i=e.dependencies;if(!!e.oldParams.isTransitive!=!!n.isTransitive)return rt.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,c=0,l=t.data;c<l.length;c++){var d=l[c];u.set(d.key,d)}for(var f=!1,p=0,h=[],m=0,v=n.selections;m<v.length;m++){var g=v[m],y=i[g.ref].data,b=!1;if(o.has(g.key)){var _=o.get(g.key);if(Ds.isUnchanged(_,g.expression,y)&&u.has(g.key)){(C=u.get(g.key)).groupId!==g.groupId&&(C.groupId=g.groupId,f=!0),s.set(g.key,_),h.push(C),p+=Re.size(C.loci);continue}if(_.expression!==g.expression)b=!0;else{var x=!1;if(n.isTransitive)if(Ye.areUnitIdsAndIndicesEqual(_.originalStructure,y)){var A=Ds.run(_,_.originalStructure);_.currentStructure=y,s.set(g.key,_);var C=Re.remap(mt.toLociWithSourceUnits(A),y);h.push({key:g.key,loci:C,groupId:g.groupId}),p+=Re.size(C),f=!0}else x=!0;else x=!0;x&&(f=!0,A=Ds.updateStructure(_,y),s.set(g.key,_),C=mt.toLociWithSourceUnits(A),h.push({key:g.key,loci:C,groupId:g.groupId}),p+=Re.size(C))}}else b=!0;if(b){f=!0;var T=Ds.createAndRun(y,g.expression);A=T.selection,s.set(g.key,_=T.entry),C=mt.toLociWithSourceUnits(A),h.push({key:g.key,loci:C}),p+=Re.size(C)}}return f?(a.entries=s,t.data=h,t.label="".concat(n.label||"Multi-selection"),t.description="".concat(h.length," source(s), ").concat(p," element(s) total"),rt.UpdateResult.Updated):rt.UpdateResult.Unchanged}}),Nqe=kt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{script:D.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:D.Optional(D.Text(""))}}})({apply:function(e){var r=e.params,n=e.cache,a=Ds.createAndRun(e.a.data,r.script),i=a.selection;n.entry=a.entry;var s=mt.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:Ye.elementDescription(s)};return new ve.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,a=e.newParams,i=e.cache;if(!Mi.areEqual(e.oldParams.script,a.script))return rt.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return rt.UpdateResult.Unchanged;var s=Ds.updateStructure(o,t.data);return Ds.updateStructureObject(r,s,a.label),rt.UpdateResult.Updated},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),kqe=kt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{bundle:D.Value(en.Empty,{isHidden:!0}),label:D.Optional(D.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params;if(r.bundle.hash!==t.data.hashCode)return ua.Null;e.cache.source=t.data;var a=en.toStructure(r.bundle,t.data);if(0===a.elementCount)return ua.Null;var i={label:"".concat(r.label||"Selection"),description:Ye.elementDescription(a)};return new ve.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,a=e.newParams,i=e.cache;if(!en.areEqual(e.oldParams.bundle,a.bundle))return rt.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return rt.UpdateResult.Null;if(i.source===t.data)return rt.UpdateResult.Unchanged;i.source=t.data;var o=en.toStructure(a.bundle,t.data);return 0===o.elementCount?rt.UpdateResult.Null:(r.label="".concat(a.label||"Selection"),r.description=Ye.elementDescription(o),r.data=o,rt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Sre={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},Bqe=D.objectToOptions(Sre),Lqe=kt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:{type:D.Select("atomic-sequence",Bqe,{isHidden:!0})}})({apply:function(e){var n,a,t=e.a;switch(e.params.type){case"polymer":n=Ri.polymer.query,a="Polymer";break;case"protein":n=Ri.protein.query,a="Protein";break;case"nucleic":n=Ri.nucleic.query,a="Nucleic";break;case"water":n=_n.internal.water(),a="Water";break;case"branched":n=Ri.branchedPlusConnected.query,a="Branched";break;case"ligand":n=Ri.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=Ri.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=Ri.coarse.query,a="Coarse";break;case"atomic-sequence":n=_n.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=_n.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=_n.internal.spheres(),a="Coarse Spheres";break;default:xn()}var i=n(new Uc(t.data)),o=mt.unionStructure(i);return 0===o.elementCount?ua.Null:new ve.Molecule.Structure(o,{label:a,description:Ye.elementDescription(o)})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Uqe=kt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{type:D.MappedStatic("static",{static:D.Text("polymer"),expression:D.Value(de.struct.generator.all),bundle:D.Value(en.Empty),script:D.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:D.Optional(D.Boolean(!0,{isHidden:!0})),label:D.Text("",{isHidden:!0})}}})({apply:function(e){return function Z7e(e,t,r){r.source=e;var n=Ye.Empty,a=void 0;switch(t.type.name){case"static":var i=void 0;switch(t.type.params){case"all":i=Ri.all.query,a="All";break;case"polymer":i=Ri.polymer.query,a="Polymer";break;case"protein":i=Ri.protein.query,a="Protein";break;case"nucleic":i=Ri.nucleic.query,a="Nucleic";break;case"water":i=_n.internal.water(),a="Water";break;case"ion":i=Ri.ion.query,a="Ion";break;case"lipid":i=Ri.lipid.query,a="Lipid";break;case"branched":i=Ri.branchedPlusConnected.query,a="Branched";break;case"ligand":i=Ri.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=Ri.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=Ri.coarse.query,a="Coarse";break;default:xn()}var o=i(new Uc(e));n=mt.unionStructure(o);break;case"script":case"expression":var s=Ds.createAndRun(e,t.type.params),u=s.selection;r.entry=s.entry,n=mt.unionStructure(u);break;case"bundle":if(t.type.params.hash!==e.hashCode)break;n=en.toStructure(t.type.params,e)}if(t.nullIfEmpty&&0===n.elementCount)return ua.Null;var l={label:"".concat(t.label||a||"Component"),description:Ye.elementDescription(n)};return new ve.Molecule.Structure(n,l)}(e.a.data,e.params,e.cache)},update:function(e){return function Q7e(e,t,r,n,a){if(r.type.name!==n.type.name)return rt.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params===n.type.params&&Ye.areEquivalent(e,a.source)?t.data.model===e.model?rt.UpdateResult.Unchanged:ir.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),rt.UpdateResult.Updated):rt.UpdateResult.Recreate:rt.UpdateResult.Recreate;case"script":if(!Mi.areEqual(r.type.params,n.type.params))return rt.UpdateResult.Recreate;case"expression":if(r.type.params!==n.type.params)return rt.UpdateResult.Recreate;if(e===a.source)break;var s=Ds.updateStructure(a.entry,e);a.source=e,t.data=mt.unionStructure(s),Ds.updateStructureObject(t,s,n.label),i=!0;break;case"bundle":if(e===a.source&&en.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=0!==t.data.elementCount,t.data=0===t.data.elementCount?t.data:Ye.Empty):(i=!0,t.data=en.toStructure(n.type.params,e))}if(i){if(n.nullIfEmpty&&0===t.data.elementCount)return rt.UpdateResult.Null;t.description=Ye.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label="".concat(n.label||t.label)),i?rt.UpdateResult.Updated:rt.UpdateResult.Unchanged}(e.a.data,e.b,e.oldParams,e.newParams,e.cache)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Cre=kt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ve.Molecule.Model,to:ve.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e?.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Custom Props",function(i){return ce(r,void 0,void 0,function(){return le(this,function(o){switch(o.label){case 0:return[4,xre(n.data,t,i,a)];case 1:return o.sent(),[2,new ve.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Ve.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,c,d;return le(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,c=i.autoAttach;u<c.length;u++)(d=t.customModelProperties.get(c[u]))&&n.data.customProperties.reference(d.descriptor,!1);return[4,xre(n.data,t,s,o)];case 1:return f.sent(),[2,rt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}});function xre(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=t.customModelProperties.get(c=u[s]),d=o[c],!i.includes(c)&&!l.isHidden)return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,l.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching model prop '".concat(c,"': ").concat(f)),[3,5];case 5:return[3,7];case 6:l.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var wre=kt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e?.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Custom Props",function(i){return ce(r,void 0,void 0,function(){return le(this,function(o){switch(o.label){case 0:return[4,Are(n.data.root,t,i,a)];case 1:return o.sent(),[2,new ve.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?rt.UpdateResult.Recreate:Ve.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,c,d;return le(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,c=i.autoAttach;u<c.length;u++)(d=t.customStructureProperties.get(c[u]))&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,Are(n.data.root,t,s,o)];case 1:return f.sent(),[2,rt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}});function Are(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=t.customStructureProperties.get(c=u[s]),d=o[c],!i.includes(c)&&!l.isHidden)return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,l.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching structure prop '".concat(c,"': ").concat(f)),[3,5];case 5:return[3,7];case 6:l.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var mL,vL,gL,yL,Vqe=kt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ve.Format.Ply,to:ve.Shape.Provider,params:function(e){return{transforms:D.Optional(D.Value([],{isHidden:!0})),label:D.Optional(D.Text("",{isHidden:!0}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create shape from PLY",function(a){return ce(t,void 0,void 0,function(){var i;return le(this,function(s){switch(s.label){case 0:return[4,EHe(r.data,n).runInContext(a)];case 1:return i=s.sent(),[2,new ve.Shape.Provider(i,{label:n.label||"Shape"})]}})})})}});function Hqe(e,t){var r=this;return Ve.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,c,l,d,f,p,h,m,v,g,y,b,_;return le(this,function(C){return i=e.values,o=S.create((a=e.header).xLength,a.yLength,a.zLength),t&&t.voxelSize&&S.mul(o,o,t.voxelSize),s=S.create(Zr(a.alpha),Zr(a.beta),Zr(a.gamma)),c=gs.create((a.ISPG>65536?0:a.ISPG)||"P 1",o,s),l=S.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),d=Cr.convertToCanonicalAxisIndicesFastToSlow(l),f=[a.NX,a.NY,a.NZ],p=d([a.NC,a.NR,a.NS]),h=function zqe(e){return 0===e.originX&&0===e.originY&&0===e.originZ?S.create(e.NCSTART,e.NRSTART,e.NSSTART):S.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}(a),t?.offset&&S.add(h,h,t.offset),m=d(h),v=S.create(m[0]/f[0],m[1]/f[1],m[2]/f[2]),g=S.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),y=Cr.Space(p,Cr.invertAxisOrder(l),function Gqe(e){var t=_J(e);switch(t){case co.Float32:return Float32Array;case co.Int8:return Int8Array;case co.Int16:return Int16Array;case co.Uint16:return Uint16Array}throw Error("".concat(t," is not a supported value format."))}(a)),b=Cr.create(y,Cr.Data1(i)),_=0===a.AMIN&&0===a.AMAX&&0===a.AMEAN&&0===a.ARMS,[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:c,fractionalBox:Nt.create(v,S.add(S.zero(),v,g))},cells:b,stats:{min:isNaN(a.AMIN)||_?QA(i):a.AMIN,max:isNaN(a.AMAX)||_?kd(i):a.AMAX,mean:isNaN(a.AMEAN)||_?$A(i):a.AMEAN,sigma:isNaN(a.ARMS)||0===a.ARMS?JA(i):a.ARMS}},sourceData:mL.create(e),customProperties:new zl,_propertyData:Object.create(null)}]})})})}function jqe(e,t){var r=this;return Ve.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,h,m;return le(this,function(v){return i=e.values,o=S.create((a=e.header).xlen,a.ylen,a.zlen),t&&t.voxelSize&&S.mul(o,o,t.voxelSize),s=S.create(Zr(a.alpha),Zr(a.beta),Zr(a.gamma)),u=gs.create("P 1",o,s),l=[a.xExtent,a.yExtent,a.zExtent],f=S.create((d=[a.xStart,a.yStart,a.zStart])[0]/(c=[a.xRate,a.yRate,a.zRate])[0],d[1]/c[1],d[2]/c[2]),p=S.create(l[0]/c[0],l[1]/c[1],l[2]/c[2]),h=Cr.Space(l,[0,1,2],Float32Array),m=Cr.create(h,Cr.Data1(i)),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Nt.create(f,S.add(S.zero(),f,p))},cells:m,stats:{min:QA(i),max:kd(i),mean:$A(i),sigma:void 0!==a.sigma?a.sigma:JA(i)}},sourceData:vL.create(e),customProperties:new zl,_propertyData:Object.create(null)}]})})})}function qqe(e,t){var r=this;return Ve.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(c){return a=e.values,i=Cr.Space((n=e.header).dim,[0,1,2],Float64Array),o=Cr.create(i,Cr.Data1(a)),s=me.fromTranslation(me(),n.min),u=me.fromScaling(me(),n.h),me.mul(s,s,u),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:QA(a),max:kd(a),mean:$A(a),sigma:JA(a)}},sourceData:gL.create(e),customProperties:new zl,_propertyData:Object.create(null)}]})})})}function Wqe(e,t){var r=this;return Ve.create("Create Segmentation Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,F,N,j,k,H,G,U,Q,W,K;return le(this,function(ne){for(i=e.segmentation_data_3d,o=gs.create((a=e.volume_data_3d_info).spacegroup_number.value(0),S.ofArray(a.spacegroup_cell_size.value(0)),S.scale(S(),S.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Cr.convertToCanonicalAxisIndicesFastToSlow(s),c=u(a.sample_count.value(0)),l=Cr.Space(c,Cr.invertAxisOrder(s),Float32Array),d=Cr.create(l,Cr.Data1(i.values.toArray({array:Float32Array}))),f=S.ofArray(u(a.origin.value(0))),p=S.ofArray(u(a.dimensions.value(0))),h={label:t?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Nt.create(f,S.add(S(),f,p))},cells:d,stats:{min:0,max:1,mean:0,sigma:1}},sourceData:yL.create(e),customProperties:new zl,_propertyData:{ownerId:t?.ownerId}},nt.PickingGranularity.set(h,"object"),m=new Map,v=new Map,b=(g=e.segmentation_data_table).set_id,H=0,G=(y=g.segment_id).rowCount;H<G;++H)_=y.value(H),0!==(C=b.value(H))&&0!==_&&(v.has(C)||v.set(C,new Set),v.get(C).add(_));for(v.forEach(function(X,L){X.forEach(function(Y){m.has(Y)||m.set(Y,new Set),m.get(Y).add(L)})}),x=[0,0,0],A=d.space.getCoords,T=d.data,F=(w=h.grid.cells.space.dimensions)[0]-1,N=w[1]-1,j=w[2]-1,k={},v.forEach(function(X,L){k[L]=[F,N,j,-1,-1,-1]}),H=0,G=T.length;H<G;++H)0!==(U=T[H])&&(A(H,x),x[0]<(Q=k[U])[0]&&(Q[0]=x[0]),x[1]<Q[1]&&(Q[1]=x[1]),x[2]<Q[2]&&(Q[2]=x[2]),x[0]>Q[3]&&(Q[3]=x[0]),x[1]>Q[4]&&(Q[4]=x[1]),x[2]>Q[5]&&(Q[5]=x[2]));return W={},m.forEach(function(X,L){W[L]=Nt.create(S.create(F,N,j),S.create(-1,-1,-1))}),Ks(k,function(X,L){v.get(parseInt(L)).forEach(function(Y){var $=W[Y];X[0]<$.min[0]&&($.min[0]=X[0]),X[1]<$.min[1]&&($.min[1]=X[1]),X[2]<$.min[2]&&($.min[2]=X[2]),X[3]>$.max[0]&&($.max[0]=X[3]),X[4]>$.max[1]&&($.max[1]=X[4]),X[5]>$.max[2]&&($.max[2]=X[5])})}),nt.Segmentation.set(h,{segments:m,sets:v,bounds:W,labels:null!==(K=t?.segmentLabels)&&void 0!==K?K:{}}),[2,h]})})})}!function(e){e.is=function t(n){return"ccp4"===n?.kind},e.create=function r(n){return{kind:"ccp4",name:n.name,data:n}}}(mL||(mL={})),function(e){e.is=function t(n){return"dsn6"===n?.kind},e.create=function r(n){return{kind:"dsn6",name:n.name,data:n}}}(vL||(vL={})),function(e){e.is=function t(n){return"dx"===n?.kind},e.create=function r(n){return{kind:"dx",name:n.name,data:n}}}(gL||(gL={})),function(e){e.is=function t(n){return"segcif"===n?.kind},e.create=function r(n){return{kind:"segcif",name:n._name,data:n}}}(yL||(yL={}));var Yqe=kt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ve.Format.Ccp4,to:ve.Volume.Data,params:function(e){return{voxelSize:D.Vec3(S.create(1,1,1)),offset:D.Vec3(S.create(0,0,0)),entryId:D.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create volume from CCP4/MRC/MAP",function(a){return ce(t,void 0,void 0,function(){var i,o;return le(this,function(s){switch(s.label){case 0:return[4,Hqe(r.data,R(R({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.NX,"\xd7").concat(r.data.header.NX,"\xd7").concat(r.data.header.NX)},[2,new ve.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Xqe=kt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ve.Format.Dsn6,to:ve.Volume.Data,params:function(e){return{voxelSize:D.Vec3(S.create(1,1,1)),entryId:D.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create volume from DSN6/BRIX",function(a){return ce(t,void 0,void 0,function(){var i,o;return le(this,function(s){switch(s.label){case 0:return[4,jqe(r.data,R(R({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.xExtent,"\xd7").concat(r.data.header.yExtent,"\xd7").concat(r.data.header.zExtent)},[2,new ve.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Kqe=kt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ve.Format.Cube,to:ve.Volume.Data,params:function(e){return{dataIndex:e?D.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,"".concat(r)]})):D.Numeric(0),entryId:D.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create volume from Cube",function(a){return ce(t,void 0,void 0,function(){var i,o;return le(this,function(s){switch(s.label){case 0:return[4,xGe(r.data,R(R({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xd7").concat(r.data.header.dim[1],"\xd7").concat(r.data.header.dim[2])},[2,new ve.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Zqe=kt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ve.Format.Dx,to:ve.Volume.Data})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return[4,qqe(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xd7").concat(r.data.header.dim[1],"\xd7").concat(r.data.header.dim[2])},[2,new ve.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Qqe=kt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ve.Format.Cif,to:ve.Volume.Data,params:function(e){if(!e)return{blockHeader:D.Optional(D.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:D.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:D.Optional(D.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:D.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse density-server CIF",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,!(o=r.data.blocks.find(function(v){return v.header===i})))throw new Error("Data block '".concat([i],"' not found."));return[4,hte(s=Yl.schema.densityServer(o),{entryId:n.entryId}).runInContext(a)];case 1:return u=m.sent(),l=(c=u.grid.cells.space.dimensions)[0],d=c[1],f=c[2],p={label:null!==(h=n.entryId)&&void 0!==h?h:s.volume_data_3d_info.name.value(0),description:"Volume ".concat(l,"\xd7").concat(d,"\xd7").concat(f)},[2,new ve.Volume.Data(u,p)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),$qe=kt.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:ve.Format.Cif,to:ve.Volume.Data,params:function(e){var t=e?.data.blocks.slice(1);return{blockHeader:D.Optional(t?D.Select(t[0]&&t[0].header,t.map(function(n){return[n.header,n.header]}),{description:"Header of the block to parse"}):D.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:D.ObjectList({id:D.Numeric(-1),label:D.Text("")},function(n){return"".concat(n.id," = ").concat(n.label)},{description:"Mapping of segment IDs to segment labels"}),ownerId:D.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse segmentation CIF",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,m,v,g;return le(this,function(y){switch(y.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,!(o=r.data.blocks.find(function(b){return b.header===i})))throw new Error("Data block '".concat([i],"' not found."));for(s=Yl.schema.segmentation(o),u={},c=0,l=n.segmentLabels;c<l.length;c++)u[(d=l[c]).id]=d.label;return[4,Wqe(s,{segmentLabels:u,ownerId:n.ownerId}).runInContext(a)];case 1:return f=y.sent(),h=(p=f.grid.cells.space.dimensions)[0],m=p[1],v=p[2],g={label:s.volume_data_3d_info.name.value(0),description:"Segmentation ".concat(h,"\xd7").concat(m,"\xd7").concat(v)},[2,new ve.Volume.Data(f,g)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Jqe=kt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ve.Volume.Data,to:ve.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:D.Text()};var r=t.state.data.select(wr.Generators.root.subtree().ofType(ve.Volume.Data).filter(function(n){var a;return!(!n.obj||null!==(a=n.obj)&&void 0!==a&&a.data.colorVolume||n.obj===e)}));return 0===r.length?{ref:D.Text("",{isHidden:!0})}:{ref:D.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return Ve.create("Assign Color Volume",function(i){return ce(t,void 0,void 0,function(){var o,s;return le(this,function(c){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=R(R({},r.data),{colorVolume:o}),[2,new ve.Volume.Data(s,{label:r.label,description:"Volume + Colors"})]})})})}}),oE=dt(13421772),Tre={},rWe={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:ea.Residue,factory:function Dre(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!Oe.isAtomic(s))return oE;var c=i(s,u);return c.length>0?a[c[0]].component.color:oE};r=function(s,u){return u?15854817:at.is(s)?o(s.unit,s.element):Ht.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):oE}}else r=function(){return oE};return{factory:Dre,granularity:"group",color:r,props:t,description:"Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",legend:Gh(SPe)}},getParams:function tWe(e){return Tre},defaultValues:D.getDefaultValues(Tre),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return ir.hasCarbohydrate(t)})}},Ere={hue:D.Interval([1,360],{min:0,max:360,step:1}),chroma:D.Interval([40,70],{min:0,max:100,step:1}),luminance:D.Interval([15,85],{min:0,max:100,step:1}),sort:D.Select("contrast",D.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:D.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:D.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:D.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},Cb=2,fg=[0,0,0],pg=[0,0,0];function nWe(e,t){return qi.toHcl(fg,e),qi.fromColor(pg,qi.toColor(e)),fg[0]>=t.hue[0]&&fg[0]<=t.hue[1]&&fg[1]>=t.chroma[0]&&fg[1]<=t.chroma[1]&&fg[2]>=t.luminance[0]&&fg[2]<=t.luminance[1]&&pg[0]>=e[0]-Cb&&pg[0]<=e[0]+Cb&&pg[1]>=e[1]-Cb&&pg[1]<=e[1]+Cb&&pg[2]>=e[2]-Cb&&pg[2]<=e[2]+Cb}function Ire(e,t){for(var r=1/0,n=0,a=0;a<e.length;a++){var i=qi.distance(t,e[a]);i<r&&(r=i,n=a)}return n}var Pre={type:"generate",colorList:"red-yellow-blue"};function Es(e){void 0===e&&(e={});var t=R(R({},Pre),e);return{palette:D.MappedStatic(t.type,{colors:D.Group({list:D.ColorList(t.colorList)},{isFlat:!0}),generate:D.Group(R(R({},Ere),{maxCount:D.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}D.getDefaultValues(Es());var Mre={valueLabel:function(e){return"".concat(e+1)},minLabel:"Start",maxLabel:"End"};function uu(e,t,r){var n,a,i;if(void 0===r&&(r={}),"colors"===t.palette.name&&"interpolate"===t.palette.params.list.kind){var o=t.palette.params.list,s=[0,e-1],u=R(R({},Mre),r),c=u.minLabel,l=u.maxLabel,d=o.colors;0===d.length&&(d=rp(Pre.colorList).list);var f=Bc.create({listOrName:d,domain:s,minLabel:c,maxLabel:l});i=f.legend,a=f.color}else{var p;"colors"===t.palette.name?0===(p=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b})).length&&(p=rp("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b})):(e=Math.min(e,t.palette.params.maxCount),p=function oWe(e,t){void 0===t&&(t={});var r=R(R({},D.getDefaultValues(Ere)),t);if(e<=0)return[];var n=function iWe(e,t){for(var r=new Map,n=Math.ceil(Math.cbrt(e)),a=Wl(),i=Math.max((t.hue[1]-t.hue[0])/n,1),o=Math.max((t.chroma[1]-t.chroma[0])/n,1),s=Math.max((t.luminance[1]-t.luminance[0])/n,1),u=t.hue[0]+i/2;u<=t.hue[1];u+=i)for(var c=t.chroma[0]+o/2;c<=t.chroma[1];c+=o)for(var l=t.luminance[0]+s/2;l<=t.luminance[1];l+=s){var d=qi.fromHcl(qi(),Wl.set(a,u,c,l));nWe(d,t)&&r.set(qi.toColor(d),d)}return Array.from(r.values())}(Math.max(r.minSampleCount,e*r.sampleCountFactor),r);if(n.length<e)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(e).fill(gr.lightgrey);for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){var c=Gl(i),l=Gl(n);for(s=0;s<a.length;++s){var d=Ire(l,a[s]);c[s].push(n[d]),l.splice(d,1)}for(s=0;s<l.length;++s)c[Ire(a,n[s])].push(n[s]);var p=Gl(a);for(s=0;s<c.length;++s){var h=c[s],m=h.length;if(0!==m){for(var v=0,g=0,y=0,b=0,_=h;b<_.length;b++){var C=_[b];v+=C[0],g+=C[1],y+=C[2]}a[s]=[v/m,g/m,y/m]}}if(Nd(p,a))break}var w="contrast"===r.sort?function aWe(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.NEGATIVE_INFINITY,o=0;o<t.length;++o){var s=qi.distance(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}(a):a;return w.map(function(E){return qi.toColor(E)})}(e,t.palette.params));for(var h=null!==(n=r.valueLabel)&&void 0!==n?n:Mre.valueLabel,m=p.length,v=[],g=0;g<e;++g){var y=g%m;void 0===v[y]?v[y]=[h(g),p[y]]:v[y][0]+=", ".concat(h(g))}i=Gh(v),a=function(b){return p[b%m]}}return{color:a,legend:i}}var Rre=dt(16448250),uWe="Gives every chain a color based on its `asym_id` value.",eC=R({asymId:D.Select("auth",D.arrayToOptions(["auth","label"]))},Es({type:"colors",colorList:"many-distinct"}));function Ore(e,t){var r=function lWe(e,t){switch(e.kind){case 0:return"auth"===t?it.chain.auth_asym_id:it.chain.label_asym_id;case 1:case 2:return it.coarse.asym_id}}(e.unit,t)(e);return e.structure.root.models.length>1?Fre(e.unit.model,r):r}function Fre(e,t){return"".concat(t,"|").concat((ir.Index.get(e).value||0)+1)}function tC(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=function dWe(e,t){for(var r=new Map,n=function(s){var u=ir.AsymIdOffset.get(s).value,c=("auth"===t?u?.auth:u?.label)||0,l=0;s.properties.structAsymMap.forEach(function(d,f){var h="auth"===t?d.auth_id:f,m=e.models.length>1?Fre(s,h):h;r.has(m)||(r.set(m,l+c),++l)})},a=0,i=e.models;a<i.length;a++)n(i[a]);return r}(e.structure.root,t.asymId),o=Array.from(i.keys()),u=uu(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var d=Ore(c,t.asymId);l=i.get(d)}else Ht.isLocation(c)&&(a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],d=Ore(a,t.asymId),l=i.get(d));return void 0===l?Rre:u.color(l)}}else r=function(){return Rre};return{factory:tC,granularity:"group",color:r,props:t,description:uWe,legend:n}}var Nre={name:"chain-id",label:"Chain Id",category:ea.Chain,factory:tC,getParams:function cWe(e){var t,r=D.clone(eC);return!(null===(t=e.structure)||void 0===t)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r},defaultValues:D.getDefaultValues(eC),isApplicable:function(e){return!!e.structure}},kre=dt(13421772),Bre=R({},Es({type:"colors",colorList:"red-yellow-blue"})),hWe={name:"element-index",label:"Element Index",category:ea.Atom,factory:function Lre(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,c=0;c<i;++c)o.set(c,u),u+=a[c].elements.length,s.set(a[c].id,c);var l=uu(u,t);n=l.legend,r=function(d){if(at.is(d)){var f=s.get(d.unit.id),p=Be.findPredecessorIndex(a[f].elements,d.element);return l.color(o.get(f)+p)}return Ht.isLocation(d)?(f=s.get(d.aUnit.id),p=Be.findPredecessorIndex(a[f].elements,d.aUnit.elements[d.aIndex]),l.color(o.get(f)+p)):kre}}else r=function(){return kre};return{factory:Lre,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:"Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",legend:n}},getParams:function pWe(e){return Bre},defaultValues:D.getDefaultValues(Bre),isApplicable:function(e){return!!e.structure}};function sE(e){var t={};return Ks(e,function(r,n){t[n]=D.Color(e[n])}),t}var Ure=dt(13421772),vWe="Assigns a color based on the operator name of a transformed chain.",bL=R({},Es({type:"colors",colorList:"many-distinct"}));function _L(e,t){var r,n;if(e.structure){var a=function yWe(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}(e.structure.root),i=Array.from(a.keys()),s=uu(a.size,t,{valueLabel:function(u){return i[u]}});n=s.legend,r=function(u){var c=void 0;return at.is(u)?c=a.get(u.unit.conformation.operator.name):Ht.isLocation(u)&&(c=a.get(u.aUnit.conformation.operator.name)),void 0===c?Ure:s.color(c)}}else r=function(){return Ure};return{factory:_L,granularity:"instance",color:r,props:t,description:vWe,legend:n}}var SL={name:"operator-name",label:"Operator Name",category:ea.Symmetry,factory:_L,getParams:function gWe(e){return D.clone(bL)},defaultValues:D.getDefaultValues(bL),isApplicable:function(e){return!!e.structure}},Vre=dt(16448250),_We="Gives every chain a color based on its `label_entity_id` value.",rC=R({},Es({type:"colors",colorList:"many-distinct"}));function nC(e,t){return"".concat(e,"|").concat(t)}function zre(e){switch(e.unit.kind){case 0:return it.chain.label_entity_id(e);case 1:case 2:return it.coarse.entity_id(e)}}function aC(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=function CWe(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r){for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=nC(a.value(i),r);t.has(s)||t.set(s,t.size)}var u=e.models[r].coarseHierarchy;if(u.isDefined){var c=u.spheres.entity_id;for(i=0,o=c.rowCount;i<o;++i)s=nC(c.value(i),r),t.has(s)||t.set(s,t.size);var l=u.gaussians.entity_id;for(i=0,o=l.rowCount;i<o;++i)s=nC(l.value(i),r),t.has(s)||t.set(s,t.size)}}return t}(e.structure.root),o=Array.from(i.keys()),u=uu(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var p=nC(zre(c),c.structure.models.indexOf(c.unit.model));l=i.get(p)}else Ht.isLocation(c)&&(a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],p=nC(zre(a),a.structure.models.indexOf(a.unit.model)),l=i.get(p));return void 0===l?Vre:u.color(l)}}else r=function(){return Vre};return{factory:aC,granularity:"group",color:r,props:t,description:_We,legend:n}}var xWe={name:"entity-id",label:"Entity Id",category:ea.Chain,factory:aC,getParams:function SWe(e){return D.clone(rC)},defaultValues:D.getDefaultValues(rC),isApplicable:function(e){return!!e.structure}},CL="dark-2",uE=dt(16448250),wWe="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",iC=R({},Es({type:"colors",colorList:CL}));function Gre(e,t){return"".concat(e,"|").concat(t)}function TWe(e,t,r,n,a,i){return"".concat(e,"|").concat(t,"|").concat(r,"|").concat(i||a||n)}function xL(e,t,r,n,a,i,o,s){for(var u=a.entity_id,c=a.pdbx_src_id,l=a.pdbx_beg_seq_num,d=a.pdbx_end_seq_num,f=0,p=a._rowCount;f<p;++f){var h=u.value(f),m=Gre(r,h),v=void 0;if(e.has(m))v=e.get(m);else{var g=n.entities.getEntityIndex(h);v=new Int16Array(n.sequence.sequences[g].sequence.length),e.set(m,v)}var b=o?o.value(f):"",_=s?s.value(f)[0]:"",C=TWe(r,h,i.value(f),c.value(f),b,_),x=0===l.valueKind(f)?l.value(f):1,A=0===d.valueKind(f)?d.value(f):v.length,T=void 0;t.has(C)?T=t.get(C):t.set(C,T=t.size+1);for(var w=x,E=A;w<=E;++w)v[w-1]=T}}function Hre(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(Pn.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,c=o.pdbx_entity_src_syn;xL(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),xL(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),xL(t,r,n,i,c,c.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function oC(e,t){var r,n;if(e.structure){var a=at.create(e.structure),i=e.structure.root.models,o=Hre(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,c=function DWe(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=function TMe(e){e=e.trim();var t=parseInt(e,10);return!isNaN(t)&&t.toString()===e}(n[3])?"Unnamed ".concat(++t):n[3];return"".concat(i).concat(a?" (".concat(a,")"):"")})}(u),d=uu(u.size,t,{valueLabel:function(p){return c[p]}});n=d.legend;var f=function(p){var v=Gre(i.indexOf(p.unit.model),it.entity.id(p)),g=s.get(v);if(g){var y=g[it.residue.label_seq_id(p)-1]-1;return-1===y?uE:d.color(y)}return uE};r=function(p){return at.is(p)?f(p):Ht.isLocation(p)?(a.unit=p.aUnit,a.element=p.aUnit.elements[p.aIndex],f(a)):uE}}else r=function(){return uE};return{factory:oC,granularity:"group",color:r,props:t,description:wWe,legend:n}}var EWe={name:"entity-source",label:"Entity Source",category:ea.Chain,factory:oC,getParams:function AWe(e){var t=D.clone(iC);return e.structure&&Hre(e.structure.root.models).srcKeySerialMap.size>wu[CL].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:rp(CL).list}})),t},defaultValues:D.getDefaultValues(iC),isApplicable:function(e){return!!e.structure}},jre=dt(13421772),IWe="Gives every model a unique color based on its index.",sC=R({},Es({type:"colors",colorList:"many-distinct"}));function uC(e,t){var r,n,a;if(e.structure){var o=uu((null!==(r=ir.MaxIndex.get(e.structure.models[0]).value)&&void 0!==r?r:-1)+1,t);a=o.legend,n=function(s){return at.is(s)?o.color(ir.Index.get(s.unit.model).value||0):Ht.isLocation(s)?o.color(ir.Index.get(s.aUnit.model).value||0):jre}}else n=function(){return jre};return{factory:uC,granularity:"instance",color:n,props:t,description:IWe,legend:a}}var MWe={name:"model-index",label:"Model Index",category:ea.Chain,factory:uC,getParams:function PWe(e){return D.clone(sC)},defaultValues:D.getDefaultValues(sC),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0}},qre=dt(13421772),RWe="Gives every structure a unique color based on its index.",cC=R({},Es({type:"colors",colorList:"many-distinct"}));function lC(e,t){var r,n,a;if(e.structure){var o=uu((null!==(r=Ye.MaxIndex.get(e.structure).value)&&void 0!==r?r:-1)+1,t);a=o.legend,n=function(s){return at.is(s)?o.color(Ye.Index.get(s.structure).value||0):Ht.isLocation(s)?o.color(Ye.Index.get(s.aStructure).value||0):qre}}else n=function(){return qre};return{factory:lC,granularity:"instance",color:n,props:t,description:RWe,legend:a}}var FWe={name:"structure-index",label:"Structure Index",category:ea.Chain,factory:lC,getParams:function OWe(e){return D.clone(cC)},defaultValues:D.getDefaultValues(cC),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0}},wL="dark-2",Wre=dt(13421772),NWe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",AL=R({},Es({type:"colors",colorList:wL}));function TL(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=uu(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(c){return at.is(c)?o.get(c.unit.id):Ht.isLocation(c)?o.get(c.aUnit.id):Wre}}else r=function(){return Wre};return{factory:TL,granularity:"instance",color:r,props:t,description:NWe,legend:n}}var BWe={name:"unit-index",label:"Chain Instance",category:ea.Chain,factory:TL,getParams:function kWe(e){var t=D.clone(AL);return e.structure&&e.structure.root.units.length>wu[wL].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:rp(wL).list}})),t},defaultValues:D.getDefaultValues(AL),isApplicable:function(e){return!!e.structure}},Yre={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},Xre=dt(16777215),DL={carbonColor:D.MappedStatic("chain-id",{"chain-id":D.Group(eC),"unit-index":D.Group(AL,{label:"Chain Instance"}),"entity-id":D.Group(rC),"entity-source":D.Group(iC),"operator-name":D.Group(bL),"model-index":D.Group(sC),"structure-index":D.Group(cC),uniform:D.Group(rb),"element-symbol":D.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:D.Numeric(0,{min:-6,max:6,step:.1}),lightness:D.Numeric(.2,{min:-6,max:6,step:.1}),colors:D.MappedStatic("default",{default:D.EmptyGroup(),custom:D.Group(sE(Yre))})};function EL(e,t){var r,n=cT("default"===t.colors.name?Yre:t.colors.params,t.saturation,t.lightness),a=null===(r=function zWe(e,t){switch(t.name){case"chain-id":return tC(e,t.params);case"unit-index":return TL(e,t.params);case"entity-id":return aC(e,t.params);case"entity-source":return oC(e,t.params);case"operator-name":return _L(e,t.params);case"model-index":return uC(e,t.params);case"structure-index":return lC(e,t.params);case"uniform":return ig(0,t.params);case"element-symbol":return;default:xn()}}(e,t.carbonColor))||void 0===r?void 0:r.color;function i(u,c){return a&&"C"===u?a(c,!1):function VWe(e,t){var r=e[t];return void 0===r?Xre:r}(n,u)}return{factory:EL,granularity:"operator-name"===t.carbonColor.name||"unit-index"===t.carbonColor.name?"groupInstance":"group",preferSmoothing:!0,color:function o(u){if(at.is(u)){if(Oe.isAtomic(u.unit))return i(u.unit.model.atomicHierarchy.atoms.type_symbol.value(u.element),u)}else if(Ht.isLocation(u)&&Oe.isAtomic(u.aUnit))return i(u.aUnit.model.atomicHierarchy.atoms.type_symbol.value(u.aUnit.elements[u.aIndex]),u);return Xre},props:t,description:"Assigns a color to every atom according to its chemical element.",legend:Gh(Object.keys(n).map(function(u){return[u,n[u]]}))}}var GWe={name:"element-symbol",label:"Element Symbol",category:ea.Atom,factory:EL,getParams:function UWe(e){return D.clone(DL)},defaultValues:D.getDefaultValues(DL),isApplicable:function(e){return!!e.structure}},Kre={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},IL=dt(16777113),cE={saturation:D.Numeric(0,{min:-6,max:6,step:.1}),lightness:D.Numeric(0,{min:-6,max:6,step:.1}),colors:D.MappedStatic("default",{default:D.EmptyGroup(),custom:D.Group(sE(Kre))})};function Zre(e,t,r){switch(GN(t,r)){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return IL}function lE(e,t){var r=cT("default"===t.colors.name?Kre:t.colors.params,t.saturation,t.lightness);return{factory:lE,granularity:"group",color:function n(a){return at.is(a)?Zre(r,a.unit,a.element):Ht.isLocation(a)?Zre(r,a.aUnit,a.aUnit.elements[a.aIndex]):IL},props:t,description:"Assigns a color based on the molecule type of a residue.",legend:Gh(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Other/unknown",IL]]))}}var qWe={name:"molecule-type",label:"Molecule Type",category:ea.Residue,factory:lE,getParams:function jWe(e){return cE},defaultValues:D.getDefaultValues(cE),isApplicable:function(e){return!!e.structure}},PL="dark-2",Qre=dt(16448250),$re=R({},Es({type:"colors",colorList:PL}));function Jre(e){switch(e.kind){case 0:return it.chain.label_asym_id;case 1:case 2:return it.coarse.asym_id}}function ene(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(Oe.isAtomic(a))for(var o=i.atomicHierarchy,u=o.chains,c=tr.transientSegments(o.chainAtomSegments,a.elements);c.hasNext;){var l=c.move().index,d=u.label_entity_id.value(l),f=i.entities.getEntityIndex(d);if("polymer"===i.entities.data.type.value(f)){var p=u.label_asym_id.value(l);t.has(p)||t.set(p,t.size)}}else if(Oe.isCoarse(a)){var h=Oe.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,m=h.chainElementSegments,v=h.asym_id,g=h.entity_id;for(c=tr.transientSegments(m,a.elements);c.hasNext;){l=c.move().index;var y=m.offsets[l];d=g.value(y),f=i.entities.getEntityIndex(d),"polymer"===i.entities.data.type.value(f)&&(p=v.value(y),t.has(p)||t.set(p,t.size))}}}return t}var XWe={name:"polymer-id",label:"Polymer Chain Id",category:ea.Chain,factory:function tne(e,t){var r,n;if(e.structure){var a=at.create(e.structure),i=ene(e.structure.root),o=Array.from(i.keys()),u=uu(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var d=Jre(c.unit);l=i.get(d(c))}else Ht.isLocation(c)&&(d=Jre(c.aUnit),a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],l=i.get(d(a)));return void 0===l?Qre:u.color(l)}}else r=function(){return Qre};return{factory:tne,granularity:"group",color:r,props:t,description:"Gives every polymer chain a color based on its `asym_id` value.",legend:n}},getParams:function YWe(e){var t=D.clone($re);return e.structure&&ene(e.structure.root).size>wu[PL].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:rp(PL).list}})),t},defaultValues:D.getDefaultValues($re),isApplicable:function(e){return!!e.structure}},ML="dark-2",rne=dt(13421772),nne=R({},Es({type:"colors",colorList:ML}));function ane(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}var QWe={name:"polymer-index",label:"Polymer Chain Instance",category:ea.Chain,factory:function ine(e,t){var r,n;if(e.structure){var a=uu(ane(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,c=i.length;s<c;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(l){var d;return at.is(l)?d=o.get(l.unit.id):Ht.isLocation(l)&&(d=o.get(l.aUnit.id)),void 0!==d?d:rne}}else r=function(){return rne};return{factory:ine,granularity:"instance",color:r,props:t,description:"Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",legend:n}},getParams:function ZWe(e){var t=D.clone(nne);return e.structure&&ane(e.structure.root)>wu[ML].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:rp(ML).list}})),t},defaultValues:D.getDefaultValues(nne),isApplicable:function(e){return!!e.structure}},one={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},RL=dt(16711935),OL={saturation:D.Numeric(0,{min:-6,max:6,step:.1}),lightness:D.Numeric(1,{min:-6,max:6,step:.1}),colors:D.MappedStatic("default",{default:D.EmptyGroup(),custom:D.Group(sE(one))})};function sne(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function une(e,t){var r=e.coarseElements.seq_id_begin.value(t);if(r===e.coarseElements.seq_id_end.value(t))return e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence.compId.value(r-1)}function dE(e,t){var r=e[t];return void 0===r?RL:r}function FL(e,t){var r=cT("default"===t.colors.name?one:t.colors.params,t.saturation,t.lightness);return{factory:FL,granularity:"group",preferSmoothing:!0,color:function n(a){if(at.is(a)){if(Oe.isAtomic(a.unit)){var i=sne(a.unit,a.element);return dE(r,i)}if(i=une(a.unit,a.element))return dE(r,i)}else if(Ht.isLocation(a)){if(Oe.isAtomic(a.aUnit))return i=sne(a.aUnit,a.aUnit.elements[a.aIndex]),dE(r,i);if(i=une(a.aUnit,a.aUnit.elements[a.aIndex]))return dE(r,i)}return RL},props:t,description:"Assigns a color to every residue according to its name.",legend:Gh(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Unknown",RL]]))}}var eYe={name:"residue-name",label:"Residue Name",category:ea.Residue,factory:FL,getParams:function JWe(e){return OL},defaultValues:D.getDefaultValues(OL),isApplicable:function(e){return!!e.structure}},cne={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},NL=dt(8421504),kL={saturation:D.Numeric(-1,{min:-6,max:6,step:.1}),lightness:D.Numeric(0,{min:-6,max:6,step:.1}),colors:D.MappedStatic("default",{default:D.EmptyGroup(),custom:D.Group(sE(cne))})};function lne(e,t,r,n){var a=cn.create(0);if(n&&Oe.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(cn.is(a,2))return cn.is(a,2048)?e.threeTenHelix:cn.is(a,32768)?e.piHelix:e.alphaHelix;if(cn.is(a,4))return e.betaStrand;if(cn.is(a,8))return e.bend;if(cn.is(a,16))return e.turn;var o=GN(t,r);return 7===o?e.dna:6===o?e.rna:9===o?e.carbohydrate:5===o?e.coil:NL}function BL(e,t){var r=e.structure&&Hc.get(e.structure),n=r?Dv(r.id,r.version):-1,a=cT("default"===t.colors.name?cne:t.colors.params,t.saturation,t.lightness);return{factory:BL,granularity:"group",preferSmoothing:!0,color:function i(o){return at.is(o)?lne(a,o.unit,o.element,r?.value):Ht.isLocation(o)?lne(a,o.aUnit,o.aUnit.elements[o.aIndex],r?.value):NL},props:t,contextHash:n,description:"Assigns a color based on the type of secondary structure and basic molecule type.",legend:Gh(Object.keys(a).map(function(o){return[o,a[o]]}).concat([["Other",NL]]))}}var nYe={name:"secondary-structure",label:"Secondary Structure",category:ea.Residue,factory:BL,getParams:function rYe(e){return kL},defaultValues:D.getDefaultValues(kL),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Hc.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Hc.ref(e.structure,!1)}}},aYe=dt(13421772),dne={list:D.ColorList("turbo",{presetKind:"scale"})};function fne(e,t){var r=e.model;switch(e.kind){case 0:return r.atomicHierarchy.residues.label_seq_id.value(r.atomicHierarchy.residueAtomSegments.index[t]);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function pne(e,t){var r=e.model,n="";switch(e.kind){case 0:n=r.atomicHierarchy.chains.label_entity_id.value(r.atomicHierarchy.chainAtomSegments.index[t]);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t)}if(""===n)return 0;var i=r.entities.getEntityIndex(n);if(-1===i)return 0;var o=r.sequence.byEntityKey[i];return void 0===o?0:o.sequence.length}var sYe={name:"sequence-id",label:"Sequence Id",category:ea.Residue,factory:function hne(e,t){var r=Bc.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:hne,granularity:"group",preferSmoothing:!0,color:function(a){if(at.is(a)){var i=a.unit,o=a.element;if((s=fne(i,o))>0&&(u=pne(i,o)))return r.setDomain(0,u-1),r.color(s)}else if(Ht.isLocation(a)){var s,u,c=a.aUnit,l=a.aIndex;if((s=fne(c,c.elements[l]))>0&&(u=pne(c,c.elements[l])))return r.setDomain(0,u-1),r.color(s)}return aYe},props:t,description:"Gives every polymer residue a color based on its `seq_id` value.",legend:r?r.legend:void 0}},getParams:function oYe(e){return dne},defaultValues:D.getDefaultValues(dne),isApplicable:function(e){return!!e.structure}},uYe=dt(16777113),mne={domain:D.Interval([0,100]),list:D.ColorList("red-white-blue",{presetKind:"scale"})};function vne(e,t){return Oe.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Oe.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}var dYe={name:"uncertainty",label:"Uncertainty/Disorder",category:ea.Atom,factory:function gne(e,t){var r=Bc.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});return{factory:gne,granularity:"group",preferSmoothing:!0,color:function n(a){return at.is(a)?r.color(vne(a.unit,a.element)):Ht.isLocation(a)?r.color(vne(a.aUnit,a.aUnit.elements[a.aIndex])):uYe},props:t,description:"Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",legend:r?r.legend:void 0}},getParams:function lYe(e){return mne},defaultValues:D.getDefaultValues(mne),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},fYe=dt(15658734),yne={style:D.MappedStatic("entity-id",{uniform:D.Group(rb),"chain-id":D.Group(eC),"entity-id":D.Group(rC),"entity-source":D.Group(iC),"molecule-type":D.Group(cE),"model-index":D.Group(sC),"structure-index":D.Group(cC)}),carbonLightness:D.Numeric(.8,{min:-6,max:6,step:.1})},vYe={name:"illustrative",label:"Illustrative",category:ea.Misc,factory:function bne(e,t){var r=function mYe(e,t){switch(t.name){case"uniform":return ig(0,t.params);case"chain-id":return tC(e,t.params);case"entity-id":return aC(e,t.params);case"entity-source":return oC(e,t.params);case"molecule-type":return lE(0,t.params);case"model-index":return uC(e,t.params);case"structure-index":return lC(e,t.params);default:xn()}}(e,t.style),n=r.color;function i(s,u){var c=n(s,!1);return"C"===u?dt.lighten(c,t.carbonLightness):c}return{factory:bne,granularity:"group",preferSmoothing:!0,color:function o(s){if(at.is(s)&&Oe.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}return Ht.isLocation(s)&&Oe.isAtomic(s.aUnit)?(u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(s.aUnit.elements[s.aIndex]),i(s,u)):fYe},props:t,description:"Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",legend:r.legend}},getParams:function hYe(e){return D.clone(yne)},defaultValues:D.getDefaultValues(yne),isApplicable:function(e){return!!e.structure}},_ne={list:D.ColorList("red-yellow-green",{presetKind:"scale"}),scale:D.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])},bYe={DGwif:0,DGwoct:1,"Oct-IF":2};function Sne(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Cne(e,t){var r=e.coarseElements.seq_id_begin.value(t);if(r===e.coarseElements.seq_id_end.value(t))return e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence.compId.value(r-1)}var SYe={name:"hydrophobicity",label:"Hydrophobicity",category:ea.Residue,factory:function xne(e,t){var r=bYe[t.scale],n=1/0,a=-1/0;for(var i in IN){var o=IN[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=Bc.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});return{factory:xne,granularity:"group",preferSmoothing:!0,color:function u(c){var l;return at.is(c)?l=Oe.isAtomic(c.unit)?Sne(c.unit,c.element):Cne(c.unit,c.element):Ht.isLocation(c)&&(l=Oe.isAtomic(c.aUnit)?Sne(c.aUnit,c.aUnit.elements[c.aIndex]):Cne(c.aUnit,c.aUnit.elements[c.aIndex])),s.color(l?function _Ye(e,t){var r=IN[e];return void 0===r?0:r[t]}(l,r):0)},props:t,description:'Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',legend:s?s.legend:void 0}},getParams:function yYe(e){return _ne},defaultValues:D.getDefaultValues(_ne),isApplicable:function(e){return!!e.structure}},wne=dt(13421772),Ane=R({},Es({type:"colors",colorList:"purples"})),wYe={name:"trajectory-index",label:"Trajectory Index",category:ea.Chain,factory:function Tne(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,c=o;u<c.length;u++)s=Math.max(s,(null===(r=ir.TrajectoryInfo.get(c[u]))||void 0===r?void 0:r.size)||0);var d=uu(s,t);i=d.legend;for(var f=new Map,p=0,h=o.length;p<h;++p){var m=(null===(n=ir.TrajectoryInfo.get(o[p]))||void 0===n?void 0:n.index)||0;f.set(m,d.color(m))}a=function(v){return at.is(v)?f.get(ir.TrajectoryInfo.get(v.unit.model).index):Ht.isLocation(v)?f.get(ir.TrajectoryInfo.get(v.aUnit.model).index):wne}}else a=function(){return wne};return{factory:Tne,granularity:"instance",color:a,props:t,description:"Gives every model (frame) a unique color based on the index in its trajectory.",legend:i}},getParams:function xYe(e){return D.clone(Ane)},defaultValues:D.getDefaultValues(Ane),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&ir.TrajectoryInfo.get(e.structure.models[0]).size>1}},AYe=dt(13421772),Dne={domain:D.Interval([0,1]),list:D.ColorList("purples",{presetKind:"scale"})};function Ene(e,t){return Oe.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}var EYe={name:"occupancy",label:"Occupancy",category:ea.Atom,factory:function Ine(e,t){var r=Bc.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});return{factory:Ine,granularity:"group",preferSmoothing:!0,color:function n(a){return at.is(a)?r.color(Ene(a.unit,a.element)):Ht.isLocation(a)?r.color(Ene(a.aUnit,a.aUnit.elements[a.aIndex])):AYe},props:t,description:"Assigns a color based on the occupancy of an atom.",legend:r?r.legend:void 0}},getParams:function DYe(e){return Dne},defaultValues:D.getDefaultValues(Dne),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},LL="dark-2",Pne=dt(13421772),Mne=R({},Es({type:"colors",colorList:LL})),dC=1e4;function UL(e){return e.map(function(t){return"".concat(t+dC).padStart(5,"0")}).join("")}function VL(e){var t=function wMe(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}(dC,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return S.create(r-dC,n-dC,a-dC)}function zL(e){return e.map(function(t){return t+5}).join("")}function Rne(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=UL(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();return o.forEach(function(c){return t.set(c,t.size)}),{min:VL(o[0]),max:VL(o[o.length-1]),map:t}}var MYe={name:"operator-hkl",label:"Operator HKL",category:ea.Symmetry,factory:function One(e,t){var r,n;if(e.structure){var a=Rne(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(d,f){var p=d%s.size,h=zL(VL(f));void 0===u[p]?u[p]=h:u[p]+=", ".concat(h)});var c={minLabel:zL(i),maxLabel:zL(o),valueLabel:function(d){return u[d]}},l=uu(s.size,t,c);n=l.legend,r=function(d){var f=void 0;if(at.is(d)){var p=UL(d.unit.conformation.operator.hkl);f=s.get(p)}else Ht.isLocation(d)&&(p=UL(d.aUnit.conformation.operator.hkl),f=s.get(p));return void 0===f?Pne:l.color(f)}}else r=function(){return Pne};return{factory:One,granularity:"instance",color:r,props:t,description:"Assigns a color based on the operator HKL value of a transformed chain.",legend:n}},getParams:function PYe(e){var t=D.clone(Mne);return e.structure&&Rne(e.structure.root).map.size>wu[LL].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:rp(LL).list}})),t},defaultValues:D.getDefaultValues(Mne),isApplicable:function(e){return!!e.structure}},GL=dt(16777113),Fne={domain:D.Interval([-1,1]),list:D.ColorList("red-white-blue",{presetKind:"scale"})};function Nne(e,t){var r;return null===(r=hb.Provider.get(e.model))||void 0===r?void 0:r.data.value(t)}var Nu,FYe={name:"partial-charge",label:"Partial Charge",category:ea.Atom,factory:function kne(e,t){var r=Bc.create({domain:t.domain,listOrName:t.list.colors});return{factory:kne,granularity:"group",preferSmoothing:!0,color:function n(a){var i;return at.is(a)?void 0!==(i=Nne(a.unit,a.element))?r.color(i):GL:Ht.isLocation(a)&&void 0!==(i=Nne(a.aUnit,a.aUnit.elements[a.aIndex]))?r.color(i):GL},props:t,description:"Assigns a color based on the partial charge of an atom.",legend:r?r.legend:void 0}},getParams:function OYe(e){return Fne},defaultValues:D.getDefaultValues(Fne),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return void 0!==hb.Provider.get(t)})}},Bne=dt(16448250),Lne=R({},Es({type:"colors",colorList:"many-distinct"})),UYe={name:"atom-id",label:"Atom Id",category:ea.Atom,factory:function Une(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=function LYe(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var i=n[r].atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}(e.structure.root),o=Array.from(i.keys()),u=uu(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var d=it.atom.label_atom_id(c);l=i.get(d)}else Ht.isLocation(c)&&(a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],d=it.atom.label_atom_id(a),l=i.get(d));return void 0===l?Bne:u.color(l)}}else r=function(){return Bne};return{factory:Une,granularity:"group",preferSmoothing:!0,color:r,props:t,description:"Gives every atom a color based on its `label_atom_id` value.",legend:n}},getParams:function BYe(e){return D.clone(Lne)},defaultValues:D.getDefaultValues(Lne),isApplicable:function(e){return!!e.structure}},Vne={colorList:D.ColorList({kind:"interpolate",colors:[[gr.white,0],[gr.red,.25],[gr.white,.5],[gr.blue,.75],[gr.white,1]]},{offsets:!0,isEssential:!0})},GYe={name:"volume-value",label:"Volume Value",category:ea.Misc,factory:function zne(e,t){for(var r=Bc.create({domain:[0,1],listOrName:t.colorList.colors}),n=[],a=0;a<256;++a)n[a]=r.color(a/255);return{factory:zne,granularity:"direct",props:t,description:"Assign color based on the given value of a volume cell.",legend:r.legend,palette:{colors:n,filter:"linear"}}},getParams:function zYe(e){return Vne},defaultValues:D.getDefaultValues(Vne),isApplicable:function(e){return!!e.volume&&!nt.Segmentation.get(e.volume)}},Gne=dt(13421772),Hne=R({},Es({type:"colors",colorList:"many-distinct"})),qYe={name:"volume-segment",label:"Volume Segment",category:ea.Misc,factory:function jne(e,t){var r,n,a=e.volume&&nt.Segmentation.get(e.volume);if(a){var i=a.segments.size,o=Array.from(a.segments.keys()),s=uu(i,t);n=s.legend,r=function(u){return nt.Segment.isLocation(u)?s.color(o.indexOf(u.segment)):Gne}}else r=function(){return Gne};return{factory:jne,granularity:"instance",color:r,props:t,description:"Gives every volume segment a unique color.",legend:n}},getParams:function jYe(e){return D.clone(Hne)},defaultValues:D.getDefaultValues(Hne),isApplicable:function(e){return!!e.volume&&!!nt.Segmentation.get(e.volume)}},qne={volume:D.ValueRef(function(e){return e.state.data.selectQ(function(r){return r.root.subtree().filter(function(n){var a;return nt.is(null===(a=n.obj)||void 0===a?void 0:a.data)})}).map(function(r){var n,a;return[r.transform.ref,null!==(a=null===(n=r.obj)||void 0===n?void 0:n.label)&&void 0!==a?a:"<unknown>"]})},function(e,t){return t(e)}),coloring:D.MappedStatic("absolute-value",{"absolute-value":D.Group({domain:D.MappedStatic("auto",{custom:D.Interval([-1,1]),auto:D.Group({symmetric:D.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:D.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":D.Group({domain:D.MappedStatic("auto",{custom:D.Interval([-1,1]),auto:D.Group({symmetric:D.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:D.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:D.Color(dt(13421772))},YYe={name:"external-volume",label:"External Volume",category:ea.Misc,factory:function Wne(e,t){var r,n;try{r=t.volume.getValue()}catch{}if(r){var a=t.coloring.params,i=r.grid.stats,o="custom"===a.domain.name?a.domain.params:[i.min,i.max],s="relative-value"===t.coloring.name;if("auto"===a.domain.name&&s&&(o[0]=(o[0]-i.mean)/i.sigma,o[1]=(o[1]-i.mean)/i.sigma),"auto"===t.coloring.params.domain.name&&t.coloring.params.domain.params.symmetric){var u=Math.max(Math.abs(o[0]),Math.abs(o[1]));o[0]=-u,o[1]=u}var c=Bc.create({domain:o,listOrName:a.list.colors}),l=Yi.getGridToCartesianTransform(r.grid);me.invert(l,l);var d=S(),f=r.grid.cells.space,p=f.dimensions,h=f.get,m=r.grid.cells.data,v=p[0],g=p[1],y=p[2];n=function(b){if(!function J6e(e){return!!e&&"position-location"===e.kind}(b))return t.defaultColor;S.copy(d,b.position),S.transformMat4(d,d,l);var _=Math.floor(d[0]),C=Math.floor(d[1]),x=Math.floor(d[2]);if(_<0||_>=v||C<0||C>=g||x<0||x>=y)return t.defaultColor;var A=d[0]-_,T=d[1]-C,w=d[2]-x,E=Math.min(_+1,v-1),I=Math.min(C+1,g-1),M=Math.min(x+1,y-1),F=h(m,_,C,x),N=h(m,E,C,x),j=h(m,_,I,x),k=h(m,E,I,x),H=oa(oa(F,N,A),oa(j,k,A),T);F=h(m,_,C,M),N=h(m,E,C,M),j=h(m,_,I,M),k=h(m,E,I,M);var G=oa(oa(F,N,A),oa(j,k,A),T),U=oa(H,G,w);return s&&(U=(U-i.mean)/i.sigma),c.color(U)}}else n=function(){return t.defaultColor};return{factory:Wne,granularity:"vertex",preferSmoothing:!0,color:n,props:t,description:"Assigns a color based volume value at a given vertex."}},getParams:function(){return qne},defaultValues:D.getDefaultValues(qne),isApplicable:function(e){return!0}},Yne={mainchain:D.MappedStatic("molecule-type",{uniform:D.Group(rb),"chain-id":D.Group(eC),"entity-id":D.Group(rC),"entity-source":D.Group(iC),"molecule-type":D.Group(cE),"model-index":D.Group(sC),"structure-index":D.Group(cC),"secondary-structure":D.Group(kL)}),sidechain:D.MappedStatic("residue-name",{uniform:D.Group(rb),"residue-name":D.Group(OL),"element-symbol":D.Group(DL)})},$Ye={name:"cartoon",label:"Cartoon",category:ea.Misc,factory:function Xne(e,t){var r,n,a=function ZYe(e,t){switch(t.name){case"uniform":return ig(0,t.params);case"chain-id":return tC(e,t.params);case"entity-id":return aC(e,t.params);case"entity-source":return oC(e,t.params);case"molecule-type":return lE(0,t.params);case"model-index":return uC(e,t.params);case"structure-index":return lC(e,t.params);case"secondary-structure":return BL(e,t.params);default:xn()}}(e,t.mainchain),i=function QYe(e,t){switch(t.name){case"uniform":return ig(0,t.params);case"residue-name":return FL(0,t.params);case"element-symbol":return EL(e,t.params);default:xn()}}(e,t.sidechain),s=a.legend;return"table-legend"===(null===(r=a.legend)||void 0===r?void 0:r.kind)&&"table-legend"===(null===(n=i.legend)||void 0===n?void 0:n.kind)&&(s={kind:"table-legend",table:sr(sr([],a.legend.table,!0),i.legend.table,!0)}),{factory:Xne,granularity:"group",preferSmoothing:!1,color:function o(u,c){return c?a.color(u,!1):i.color(u,!1)},props:t,description:"Uses separate themes for coloring mainchain and sidechain visuals.",legend:s}},getParams:function KYe(e){return D.clone(Yne)},defaultValues:D.getDefaultValues(Yne),isApplicable:function(e){return!!e.structure}};!function(e){e.Category=ea,e.PaletteScale=16777215,e.EmptyFactory=function(){return e.Empty};var t=dt(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}},e.areEqual=function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&Nd(a.props,i.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}},e.createRegistry=function n(){return new tae(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={"atom-id":UYe,"carbohydrate-symbol":rWe,cartoon:$Ye,"chain-id":Nre,"element-index":hWe,"element-symbol":GWe,"entity-id":xWe,"entity-source":EWe,hydrophobicity:SYe,illustrative:vYe,"model-index":MWe,"molecule-type":qWe,occupancy:EYe,"operator-hkl":MYe,"operator-name":SL,"partial-charge":FYe,"polymer-id":XWe,"polymer-index":QWe,"residue-name":eYe,"secondary-structure":nYe,"sequence-id":sYe,"shape-group":rHe,"structure-index":FWe,"trajectory-index":wYe,uncertainty:dYe,"unit-index":BWe,uniform:Cze,"volume-segment":qYe,"volume-value":GYe,"external-volume":YYe}}(Nu||(Nu={}));var Kne={scale:D.Numeric(1,{min:.1,max:5,step:.1})};function HL(e,t){return Oe.isAtomic(e)?G2(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Oe.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}var rXe={name:"physical",label:"Physical",category:"",factory:function Zne(e,t){var r=void 0===t.scale?1:t.scale;return{factory:Zne,granularity:"group",size:function n(a){return at.is(a)?r*HL(a.unit,a.element):Ht.isLocation(a)?r*Math.min(HL(a.aUnit,a.aUnit.elements[a.aIndex]),HL(a.bUnit,a.bUnit.elements[a.bIndex])):1*r},props:t,description:"Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres."}},getParams:function tXe(e){return Kne},defaultValues:D.getDefaultValues(Kne),isApplicable:function(e){return!!e.structure}},Qne={bfactorFactor:D.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:D.Numeric(.05,{min:0,max:1,step:.01}),baseSize:D.Numeric(.2,{min:0,max:2,step:.1})};function $ne(e,t,r){return Oe.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:Oe.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}var Ki,Oi,iXe={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:function Jne(e,t){return{factory:Jne,granularity:"group",size:function r(n){var a=t.baseSize;return at.is(n)?a+=$ne(n.unit,n.element,t):Ht.isLocation(n)&&(a+=$ne(n.aUnit,n.aUnit.elements[n.aIndex],t)),a},props:t,description:"Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique."}},getParams:function aXe(e){return Qne},defaultValues:D.getDefaultValues(Qne),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}};function eae(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}!function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}},e.areEqual=function t(n,a){return n.contextHash===a.contextHash&&n.factory===a.factory&&Nd(n.props,a.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}},e.createRegistry=function r(){return new tae(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={physical:rXe,"shape-group":$Ge,uncertainty:iXe,uniform:Aze}}(Ki||(Ki={})),function(e){function r(){return{color:Nu.Empty,size:Ki.Empty}}e.create=function t(i,o,s,u){u=u||r();var c=s.colorTheme,l=s.sizeTheme;return u.color=i.colorThemeRegistry.create(c.name,o,c.params),u.size=i.sizeThemeRegistry.create(l.name,o,l.params),u},e.createEmpty=r,e.ensureDependencies=function n(i,o,s,u){var c,l;return ce(this,void 0,void 0,function(){return le(this,function(d){switch(d.label){case 0:return[4,null===(c=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)||void 0===c?void 0:c.attach(i,s)];case 1:return d.sent(),[4,null===(l=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)||void 0===l?void 0:l.attach(i,s)];case 2:return d.sent(),[2]}})})},e.releaseDependencies=function a(i,o,s){var u,c;null===(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)||void 0===u||u.detach(o),null===(c=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)||void 0===c||c.detach(o)}}(Oi||(Oi={}));var Is,tae=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,Ks(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. ".concat(a.name," ").concat(i));n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return eae(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered theme provider."));return this._name.get(t)},e.prototype.create=function(t,r,n){void 0===n&&(n={});var a=this.get(t);return a.factory(r,R(R({},D.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return eae(this.getApplicableList(t))},e.prototype.clear=function(){this._list.length=0,this._map.clear(),this._name.clear()},e}(),Vt=function(e){return e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear",e}(Vt||{});function jL(e,t,r){switch(r){case Vt.Highlight:e[t]|=1;break;case Vt.RemoveHighlight:e[t]&=-2;break;case Vt.Select:e[t]|=2;break;case Vt.Deselect:e[t]&=-3;break;case Vt.Toggle:e[t]^=2;break;case Vt.Clear:e[t]=0}}function qL(e,t,r){if(r===Vt.None)return!1;if(xe.is(t)){var n=xe.start(t),a=xe.end(t),i=n+3>>2,o=i+(a-4*i>>2);if(o<=i){for(var s=n;s<a;++s)jL(e,s,r);return!0}var u=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),c=n,l=Math.min(4*i,a),d=Math.max(n,4*o),f=a;switch(r){case Vt.Highlight:for(s=i;s<o;++s)u[s]|=16843009;break;case Vt.RemoveHighlight:for(s=i;s<o;++s)u[s]&=-16843010;break;case Vt.Select:for(s=i;s<o;++s)u[s]|=33686018;break;case Vt.Deselect:for(s=i;s<o;++s)u[s]&=-33686019;break;case Vt.Toggle:for(s=i;s<o;++s)u[s]^=33686018;break;case Vt.Clear:for(s=i;s<o;++s)u[s]=0;break;default:xn()}for(s=c;s<l;++s)jL(e,s,r);for(s=d;s<f;++s)jL(e,s,r)}else switch(r){case Vt.Highlight:s=0;for(var p=t.length;s<p;++s)e[t[s]]|=1;break;case Vt.RemoveHighlight:for(s=0,p=t.length;s<p;++s)e[t[s]]&=-2;break;case Vt.Select:for(s=0,p=t.length;s<p;++s)e[t[s]]|=2;break;case Vt.Deselect:for(s=0,p=t.length;s<p;++s)e[t[s]]&=-3;break;case Vt.Toggle:for(s=0,p=t.length;s<p;++s)e[t[s]]^=2;break;case Vt.Clear:for(s=0,p=t.length;s<p;++s)e[t[s]]=0;break;default:xn()}return!0}!function(e){e.is=rs.has,e.All=Vt.Highlight|Vt.RemoveHighlight|Vt.Select|Vt.Deselect|Vt.Toggle|Vt.Clear,e.Highlighting=Vt.Highlight|Vt.RemoveHighlight|Vt.Clear,e.Selecting=Vt.Select|Vt.Deselect|Vt.Toggle|Vt.Clear,e.isReverse=function t(r,n){return r===Vt.Highlight&&n===Vt.RemoveHighlight||r===Vt.RemoveHighlight&&n===Vt.Highlight||r===Vt.Select&&n===Vt.Deselect||r===Vt.Deselect&&n===Vt.Select||r===Vt.Toggle&&n===Vt.Toggle}}(Is||(Is={}));var fE={kind:"every-loci"};function ku(e){return!!e&&"every-loci"===e.kind}var pr,df,Yr={kind:"empty-loci"};function Ps(e){return!!e&&"empty-loci"===e.kind}function fC(e){return!!e&&"data-loci"===e.kind}function pE(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}function Fi(e,t){return{kind:e,layers:t}}function jo(e,t){return{kind:e,layers:t}}!function(e){var t=new oc("98");function s(m,v){var g;if("every-loci"!==m.kind&&"empty-loci"!==m.kind){if(v||(v=De()),"structure-loci"===m.kind)return De.copy(v,m.structure.boundary.sphere);if("element-loci"===m.kind)return De.copy(v,Re.getBoundary(m).sphere);if("bond-loci"===m.kind)return Ht.getBoundingSphere(m,v);if("shape-loci"===m.kind)return De.copy(v,m.shape.geometry.boundingSphere);if("group-loci"===m.kind)return is.getBoundingSphere(m,v);if("data-loci"===m.kind)return null===(g=m.getBoundingSphere)||void 0===g?void 0:g.call(m,v);if("volume-loci"===m.kind)return nt.getBoundingSphere(m.volume,v);if("isosurface-loci"===m.kind)return nt.Isosurface.getBoundingSphere(m.volume,m.isoValue,v);if("cell-loci"===m.kind)return nt.Cell.getBoundingSphere(m.volume,m.indices,v);if("segment-loci"===m.kind)return nt.Segment.getBoundingSphere(m.volume,m.segments,v)}}e.getBundleBoundingSphere=function r(m){var v=m.loci.map(function(x){return s(x)}).filter(function(x){return!!x});t.reset();for(var g=0,y=v;g<y.length;g++)t.includePositionRadius((b=y[g]).center,b.radius);t.finishedIncludeStep();for(var _=0,C=v;_<C.length;_++){var b;t.radiusPositionRadius((b=C[_]).center,b.radius)}return t.getSphere()},e.areEqual=function n(m,v){return!!(ku(m)&&ku(v)||Ps(m)&&Ps(v))||(fC(m)&&fC(v)?function cXe(e,t){if(!p2(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!p2(e.elements[r],t.elements[r]))return!1;return!0}(m,v):Ye.isLoci(m)&&Ye.isLoci(v)?Ye.areLociEqual(m,v):Re.is(m)&&Re.is(v)?Re.areEqual(m,v):Ht.isLoci(m)&&Ht.isLoci(v)?Ht.areLociEqual(m,v):Wr.isLoci(m)&&Wr.isLoci(v)?Wr.areLociEqual(m,v):is.isLoci(m)&&is.isLoci(v)?is.areLociEqual(m,v):nt.isLoci(m)&&nt.isLoci(v)?nt.areLociEqual(m,v):nt.Isosurface.isLoci(m)&&nt.Isosurface.isLoci(v)?nt.Isosurface.areLociEqual(m,v):nt.Cell.isLoci(m)&&nt.Cell.isLoci(v)?nt.Cell.areLociEqual(m,v):!(!nt.Segment.isLoci(m)||!nt.Segment.isLoci(v))&&nt.Segment.areLociEqual(m,v))},e.isEvery=function a(m){return!!m&&"every-loci"===m.kind},e.isEmpty=function i(m){return!ku(m)&&(!!Ps(m)||(fC(m)?function lXe(e){return 0===e.elements.length}(m):Ye.isLoci(m)?Ye.isLociEmpty(m):Re.is(m)?Re.isEmpty(m):Ht.isLoci(m)?Ht.isLociEmpty(m):Wr.isLoci(m)?Wr.isLociEmpty(m):is.isLoci(m)?is.isLociEmpty(m):nt.isLoci(m)?nt.isLociEmpty(m):nt.Isosurface.isLoci(m)?nt.Isosurface.isLociEmpty(m):nt.Cell.isLoci(m)?nt.Cell.isLociEmpty(m):!!nt.Segment.isLoci(m)&&nt.Segment.isLociEmpty(m)))},e.remap=function o(m,v){return v instanceof Ye&&(Re.is(m)?m=Re.remap(m,v):Ye.isLoci(m)?m=Ye.remapLoci(m,v):Ht.isLoci(m)&&(m=Ht.remapLoci(m,v))),m},e.getBoundingSphere=s;var u=De.zero();e.getCenter=function c(m,v){var g=s(m,u);return g?S.copy(v||S(),g.center):void 0},e.getPrincipalAxes=function l(m){if("every-loci"!==m.kind&&"empty-loci"!==m.kind){if("structure-loci"===m.kind)return Re.getPrincipalAxes(Ye.toStructureElementLoci(m.structure));if("element-loci"===m.kind)return Re.getPrincipalAxes(m);if("bond-loci"===m.kind)return;if("shape-loci"===m.kind)return;if("group-loci"===m.kind)return;if("data-loci"===m.kind)return;if("volume-loci"===m.kind)return;if("isosurface-loci"===m.kind)return;if("cell-loci"===m.kind)return;if("segment-loci"===m.kind)return}};var d={element:function(m){return m},residue:function(m){return Re.is(m)?Re.extendToWholeResidues(m,!0):m},chain:function(m){return Re.is(m)?Re.extendToWholeChains(m):m},entity:function(m){return Re.is(m)?Re.extendToWholeEntities(m):m},model:function(m){return Re.is(m)?Re.extendToWholeModels(m):m},operator:function(m){return Re.is(m)?Re.extendToWholeOperators(m):m},structure:function(m){return Re.is(m)?Ye.toStructureElementLoci(m.structure):is.isLoci(m)?Wr.Loci(m.shape):nt.Cell.isLoci(m)?nt.Loci(m.volume):m},elementInstances:function(m){return Re.is(m)?Re.extendToAllInstances(m):m},residueInstances:function(m){return Re.is(m)?Re.extendToAllInstances(Re.extendToWholeResidues(m,!0)):m},chainInstances:function(m){return Re.is(m)?Re.extendToAllInstances(Re.extendToWholeChains(m)):m}};function p(m,v){return d[v](m)}e.GranularityOptions=D.objectToOptions(d,function(m){switch(m){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return m.indexOf("Instances")?[kc(m),"With Symmetry"]:kc(m)}}),e.simpleGranularity=function f(m){return m.replace("Instances","")},e.applyGranularity=p,e.normalize=function h(m,v,g){return void 0===g&&(g=!1),("element"!==v||g)&&Ht.isLoci(m)&&(m=Ht.toStructureElementLoci(m)),Ye.isLoci(m)&&(m=Ye.toStructureElementLoci(m.structure)),Re.is(m)&&(m=Re.remap(m,m.structure.root)),v&&(m=p(m,v)),m}}(pr||(pr={})),function(e){function r(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,l){if(0===c.layers.length&&0===l.layers.length)return!0;if(c.layers.length!==l.layers.length)return!1;for(var d=0,f=c.layers.length;d<f;++d)if(c.layers[d].clear!==l.layers[d].clear||c.layers[d].color!==l.layers[d].color||!pr.areEqual(c.layers[d].loci,l.layers[d].loci))return!1;return!0},e.isEmpty=r,e.remap=function n(c,l){if("element-loci"===c.kind){for(var d=[],f=0,p=c.layers;f<p.length;f++){var h=p[f],m=h.loci,v=h.color,g=h.clear;m=Re.remap(m,l),Re.isEmpty(m)||d.push({loci:m,color:v,clear:g})}return{kind:"element-loci",layers:d}}return c},e.merge=function a(c){if(r(c))return c;if("element-loci"===c.kind){for(var l=c.layers[0].loci.structure,d=new Map,f=Re.none(l),p=0,h=c.layers.length;p<h;++p){var m=c.layers[h-p-1],v=m.loci,g=m.color,y=m.clear;if(v=Re.subtract(v,f),f=Re.union(v,f),!Re.isEmpty(v)){var b=y?-1:g;d.has(b)&&(v=Re.union(v,d.get(b))),d.set(b,v)}}var _=[];return d.forEach(function(C,x){var A=-1===x,T=A?dt(0):x;_.push({loci:C,color:T,clear:A})}),{kind:"element-loci",layers:_}}return c},e.filter=function i(c,l){if(r(c))return c;if("element-loci"===c.kind){for(var d=c.layers[0].loci.structure,f=[],p=0,h=c.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.color,y=m.clear,b=Re.remap(v,l);v=Re.remap(b,d),Re.isEmpty(v)||f.push({loci:v,color:g,clear:y})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function o(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var h=c[f],v=h.color,g=h.clear,y=Mi.toLoci(h.script,l);Re.isEmpty(y)||d.push({loci:y,color:v,clear:g})}return{kind:"element-loci",layers:d}},e.ofBundle=function s(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var h=c[f],v=h.color,g=h.clear,y=en.toLoci(h.bundle,l.root);d.push({loci:y,color:v,clear:g})}return{kind:"element-loci",layers:d}},e.toBundle=function u(c){for(var l=[],d=0,f=c.layers.length;d<f;++d){var p=c.layers[d],m=p.color,v=p.clear,g=en.fromLoci(p.loci);l.push({bundle:g,color:m,clear:v})}return{kind:"element-loci",layers:l}}}(Fi||(Fi={})),function(e){function r(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,l){if(0===c.layers.length&&0===l.layers.length)return!0;if(c.layers.length!==l.layers.length)return!1;for(var d=0,f=c.layers.length;d<f;++d)if(c.layers[d].value!==l.layers[d].value||!pr.areEqual(c.layers[d].loci,l.layers[d].loci))return!1;return!0},e.isEmpty=r,e.remap=function n(c,l){if("element-loci"===c.kind){for(var d=[],f=0,p=c.layers;f<p.length;f++){var h=p[f],m=Re.remap(h.loci,l);Re.isEmpty(m)||d.push({loci:m,value:h.value})}return{kind:"element-loci",layers:d}}return c},e.merge=function a(c){if(r(c))return c;if("element-loci"===c.kind){for(var l=c.layers[0].loci.structure,d=new Map,f=Re.none(l),p=0,h=c.layers.length;p<h;++p){var m=c.layers[h-p-1],v=m.loci,g=m.value;v=Re.subtract(v,f),f=Re.union(v,f),Re.isEmpty(v)||(d.has(g)&&(v=Re.union(v,d.get(g))),d.set(g,v))}var y=[];return d.forEach(function(b,_){y.push({loci:b,value:_})}),{kind:"element-loci",layers:y}}return c},e.filter=function i(c,l){if(r(c))return c;if("element-loci"===c.kind){for(var d=c.layers[0].loci.structure,f=[],p=0,h=c.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.value,y=Re.remap(v,l);v=Re.remap(y,d),Re.isEmpty(v)||f.push({loci:v,value:g})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function o(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var h=c[f],v=h.value,g=Mi.toLoci(h.script,l);Re.isEmpty(g)||d.push({loci:g,value:v})}return{kind:"element-loci",layers:d}},e.ofBundle=function s(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var h=c[f],v=h.value,g=en.toLoci(h.bundle,l.root);d.push({loci:g,value:v})}return{kind:"element-loci",layers:d}},e.toBundle=function u(c){for(var l=[],d=0,f=c.layers.length;d<f;++d){var p=c.layers[d],m=p.value,v=en.fromLoci(p.loci);l.push({bundle:v,value:m})}return{kind:"element-loci",layers:l}}}(jo||(jo={})),function(e){e.create=function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}},e.reset=function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}}(df||(df={}));var dXe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function rae(e,t){void 0===t&&(t={});var r=R(R({},dXe),t),n=e.elementCount*r.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function WL(e,t){var r=Po(e.quality,"auto"),n=Po(e.detail,1),a=Po(e.radialSegments,12),i=Po(e.linearSegments,8),o=Po(e.resolution,2),s=Po(e.probePositions,12),u=Po(e.doubleSided,!0),c=0;if("auto"===r)if(t instanceof Ye)r=rae(t.root),c=function fXe(e){if(1===e.root.models.length){var t=ei.Provider.get(e.root.model);if(t&&"P 1"===t.spacegroup.name&&!gs.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Nt.volume(e.root.boundary.box)}(t);else if(nt.is(t)){var l=t.grid.cells.space.dimensions;r=(c=l[0]*l[1]*l[2])<1e7?"medium":"low"}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1}return o=Math.max(o,c/5e8),o=Math.min(o,20),"off"===e.transparentBackfaces&&(void 0!==e.alpha&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var hE=S.set,nae=S.normalize,aae=S.sub,iae=S.addScalar,mE=S.scale,oae=S.toArray;function vE(e,t,r,n){var a=!1;if(nt.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;n(xe.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(nt.Isosurface.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;if(r?.isoValue){if(!nt.IsoValue.areSame(e.isoValue,r.isoValue,t.grid.stats))return!1;n(xe.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,c=nt.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,l=0,d=s.length;l<d;++l)ia(c,s[l],u)&&n(xe.ofSingleton(l))&&(a=!0)}else if(nt.Cell.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;xe.is(e.indices)?n(e.indices)&&(a=!0):Be.forEach(e.indices,function(v){n(xe.ofSingleton(v))&&(a=!0)})}else if(nt.Segment.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;if(r?.segments){if(!Xe.areIntersecting(e.segments,r.segments))return!1;n(xe.ofLength(t.grid.cells.data.length))&&(a=!0)}else{var f=nt.Segmentation.get(t);if(f){var p=new Set;for(l=0,d=e.segments.length;l<d;++l)fa.add(p,f.segments.get(e.segments[l]));var h=Array.from(p.values()),m=t.grid.cells.data;for(l=0,d=m.length;l<d;++l)h.includes(m[l])&&n(xe.ofSingleton(l))&&(a=!0)}}}return a}function vm(e,t){void 0===t&&(t=0);var n=Math.sqrt(e[0]*e[1]*e[2]),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(i*=u=Math.floor(a/i),o*=s=Math.ceil(e[2]/u)):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:2*a}}function sae(e,t,r){void 0===r&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,c=s.min,l=i.dimensions,d=i.dataOffset,f=vm(l,r),p=f.width,h=f.height,m="data"===t?1:4,v=new Uint8Array(p*h*m),g={array:v,width:p,height:h},y=u-c,b=l[0],_=l[1],C=l[2],x=b+r,A=_+r,T=S(),w=S(),E=b-1,I=_-1,M=C-1,F=0;F<C;++F)for(var N=0;N<_;++N)for(var j=0;j<b;++j){var k=Math.floor(F*x%p/x),U=m*(Math.floor(F*x/p)*A*p+N*p+(k*x+j)),Q=d(j,N,F);"data"===t?v[U]=Math.round((o[Q]-c)/y*255):("groups"===t?VS(Q,v,U):(hE(T,o[d(Math.max(0,j-1),N,F)],o[d(j,Math.max(0,N-1),F)],o[d(j,N,Math.max(0,F-1))]),hE(w,o[d(Math.min(E,j+1),N,F)],o[d(j,Math.min(I,N+1),F)],o[d(j,N,Math.min(M,F+1))]),nae(T,aae(T,T,w)),iae(T,mE(T,T,.5),.5),oae(mE(T,T,255),v,U)),v[U+3]=Math.round((o[Q]-c)/y*255))}return g}function gE(e,t,r,n,a){var o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,c=e.transformBuffer,l=e.groupBuffer,d=e.itemSize,f=e.colorType.endsWith("Instance"),p=Nt.fromSphere3D(Nt(),f?e.boundingSphere:e.invariantBoundingSphere),h=1+t,m=Nt.expand(Nt(),p,S.create(h,h,h)),v=1/t,g=Nt.scale(Nt(),m,v),y=Nt.size(S(),g);S.ceil(y,y),S.add(y,y,S.create(2,2,2));for(var Je,vt,ut,_t,b=m.min,_=y[0],C=y[1],x=vm(y),A=x.width,T=x.height,w=new Float32Array(A*T*d),E=new Float32Array(A*T),I=new Uint8Array(A*T*d),M={array:I,width:A,height:T,filter:"linear"},F=f?e.instanceCount:1,N=e.colorData.array,H=y[0],G=y[1],U=y[2],Q=S(),W=0;W<F;++W)for(var K=0;K<o;K+=r){S.fromArray(Q,u,3*K),f&&S.transformMat4Offset(Q,Q,c,0,0,16*W),S.sub(Q,Q,b),S.scale(Q,Q,v);for(var ne=Q[0],X=Q[1],L=Q[2],Y=Math.floor(ne),$=Math.floor(X),Z=Math.floor(L),q=(W*s+l[K])*d,z=Math.max(0,Y-2),te=Math.max(0,$-2),ae=Math.max(0,Z-2),fe=Math.min(H,Y+2+2),he=Math.min(G,$+2+2),pe=Math.min(U,Z+2+2),re=z;re<fe;++re)for(var ee=re-ne,ue=te;ue<he;++ue)for(var ge=ue-X,Ce=ae;Ce<pe;++Ce){var ze=Ce-L,je=Math.sqrt(ee*ee+ge*ge+ze*ze);if(!(je>2)){for(var V=2-je,J=(Je=re,vt=ue,ut=Ce,void 0,void 0,_t=Math.floor(ut*_%A/_),d*(Math.floor(ut*_/A)*C*A+vt*A+(_t*_+Je))),ye=0;ye<d;++ye)w[J+ye]+=N[q+ye]*V;E[J/d]+=V}}}W=0;for(var we=E.length;W<we;++W){var Ee=W*d,Fe=E[W];for(ye=0;ye<d;++ye)I[Ee+ye]=Math.round(w[Ee+ye]/Fe)}var ke=Ne.create(A,T),Ue=fr.create(b[0],b[1],b[2],v),$e=f?"volumeInstance":"volume";if(n)return a||(a=n.resources.texture("image-uint8",4===d?"rgba":3===d?"rgb":"alpha","ubyte","linear")),a.load(M),{kind:"volume",texture:a,gridTexDim:ke,gridDim:y,gridTransform:Ue,type:$e};var He=function mXe(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,c=e.colorStride,l=e.itemOffset||0,d=e.outputStride;if(d+l>c)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");var f=e.colorType.endsWith("Instance"),p=f?e.instanceCount:1,h=Ti(Math.max(1,p*t),d,Uint8Array),m=h.array,v=i[0],g=i[1],y=o[0],b=S.fromArray(S(),s,0),_=s[3];function C(ye,we,Ee){var Fe=Math.floor(Ee*v%y/v),ke=Math.floor(Ee*v/y);return c*(ke*g*y+we*y+(Fe*v+ye))}for(var x=S(),A=S(),T=S(),w=S(),E=0;E<p;++E)for(var I=0;I<t;++I){S.fromArray(x,r,I*u),f&&S.transformMat4Offset(x,x,n,0,0,16*E),S.sub(x,x,b),S.scale(x,x,_),S.floor(A,x),S.ceil(T,x),S.sub(w,x,A),S.sub(x,T,A),S.div(w,w,x);for(var M=A[0],F=A[1],N=A[2],j=T[0],k=T[1],H=T[2],G=w[0],U=w[1],Q=w[2],W=C(M,F,N)+l,K=C(j,F,N)+l,ne=C(M,F,H)+l,X=C(j,F,H)+l,L=C(M,k,N)+l,Y=C(j,k,N)+l,$=C(M,k,H)+l,Z=C(j,k,H)+l,q=(E*t+I)*d,z=0;z<d;++z){var fe=a[ne+z],he=a[X+z],pe=a[L+z],re=a[Y+z],ee=a[$+z],ue=a[Z+z],ge=oa(a[W+z],a[K+z],G),Ce=oa(fe,he,G),ze=oa(pe,re,G),je=oa(ee,ue,G),V=oa(ge,ze,U),J=oa(Ce,je,U);m[q+z]=oa(V,J,Q)}}return h}({vertexCount:o,instanceCount:F,transformBuffer:c,positionBuffer:u,colorType:$e,grid:I,gridDim:y,gridTexDim:ke,gridTransform:Ue,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:He,texDim:Ne.create(He.width,He.height),type:f?"vertexInstance":"vertex"}}function yE(e,t,r,n,a){if(function vXe(e){return"group"===e||"groupInstance"===e}(e.dColorType.ref.value)){var i=gE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dColorType,i.type),O.update(e.tColorGrid,i.texture),O.update(e.uColorTexDim,i.gridTexDim),O.update(e.uColorGridDim,i.gridDim),O.update(e.uColorGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dColorType,i.type),O.update(e.tColor,i.texture),O.update(e.uColorTexDim,i.texDim))}}var xXe="\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tCount;\nuniform vec2 uTexSize;\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n    float count = texture2D(tCount, coords).r;\n\n    gl_FragColor = color / count;\n}\n",wXe="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uResolution;\n\nconst float p = 2.0;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition);\n    if (dist > p) discard;\n\n    float f = p - dist;\n    gl_FragColor = vColor * f;\n    gl_FragData[1] = vec4(f);\n}\n",AXe="\nprecision highp float;\n\n#include common\n#include read_from_texture\n\nuniform int uGroupCount;\n\nattribute float aSample;\n#define SampleID int(aSample)\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform vec2 uGeoTexDim;\nuniform sampler2D tPosition;\nuniform sampler2D tGroup;\n\nuniform vec2 uColorTexDim;\nuniform sampler2D tColor;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;\n    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);\n\n    position = (aTransform * vec4(position, 1.0)).xyz;\n    gl_PointSize = 7.0;\n    vPosition = (position - uBboxMin) / uResolution;\n    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n\n    #if defined(dColorType_group)\n        vColor = readFromTexture(tColor, group, uColorTexDim);\n    #elif defined(dColorType_groupInstance)\n        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);\n    #endif\n}\n",TXe={drawCount:pa("number"),instanceCount:pa("number"),stride:pa("number"),uGroupCount:Te("i","material"),aTransform:Rn("float32",16,1),aInstance:Rn("float32",1,1),aSample:Rn("float32",1,0),uGeoTexDim:Te("v2","material"),tPosition:Xt("texture","rgba","float","nearest","material"),tGroup:Xt("texture","rgba","float","nearest","material"),uColorTexDim:Te("v2","material"),tColor:Xt("texture","rgba","ubyte","nearest","material"),dColorType:Ut("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Te("f"),uCurrentX:Te("f"),uCurrentY:Te("f"),uBboxMin:Te("v3","material"),uBboxSize:Te("v3","material"),uResolution:Te("f","material")},yc="color-accumulate",pC="color-count";function uae(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}var PXe=R(R({},Di),{tColor:Xt("texture","rgba","float","nearest"),tCount:Xt("texture","alpha","float","nearest"),uTexSize:Te("v2")}),hC="color-normalize";function bE(e,t,r,n,a){var i=n.extensions.drawBuffers;if(!i)throw new Error("need WebGL draw buffers");Ct&&n.timer.mark("calcTextureMeshColorSmoothing");var o=n.gl,s=n.resources,u=n.state,c=n.extensions,l=c.colorBufferHalfFloat,d=c.textureHalfFloat,f=e.colorType.endsWith("Instance"),p=Nt.fromSphere3D(Nt(),f?e.boundingSphere:e.invariantBoundingSphere),h=1+t,m=Nt.expand(Nt(),p,S.create(h,h,h)),v=1/t,g=Nt.scale(Nt(),m,v),y=Nt.size(S(),g);S.ceil(y,y),S.add(y,y,S.create(2,2,2));var b=m.min,_=y[0],C=y[1],x=y[2],A=function FXe(e){var r=Math.sqrt(e[0]*e[1]*e[2]),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:2*n}}(y),T=A.texDimX,w=A.texDimY,E=A.texCols;n.namedFramebuffers[yc]||(n.namedFramebuffers[yc]=n.resources.framebuffer());var I=n.namedFramebuffers[yc];$t(o)?(n.namedTextures[yc]||(n.namedTextures[yc]=l&&d?s.texture("image-float16","rgba","fp16","nearest"):s.texture("image-float32","rgba","float","nearest")),n.namedTextures[pC]||(n.namedTextures[pC]=s.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[yc]||(n.namedTextures[yc]=s.texture("image-float32","rgba","float","nearest")),n.namedTextures[pC]||(n.namedTextures[pC]=s.texture("image-float32","rgba","float","nearest")));var M=n.namedTextures[yc],F=n.namedTextures[pC];M.define(T,w),F.define(T,w),M.attachFramebuffer(I,0),F.attachFramebuffer(I,1);var N=function DXe(e,t,r,n,a){if(e.namedComputeRenderables[yc]){var i=S.sub(S(),r.max,r.min),o=e.namedComputeRenderables[yc].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&O.update(o.aSample,uae(s,a)),O.updateIfChanged(o.drawCount,s),O.updateIfChanged(o.instanceCount,t.instanceCount),O.updateIfChanged(o.stride,a),O.updateIfChanged(o.uGroupCount,t.groupCount),O.update(o.aTransform,t.transformBuffer),O.update(o.aInstance,t.instanceBuffer),O.update(o.uGeoTexDim,Ne.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),O.update(o.tPosition,t.positionTexture),O.update(o.tGroup,t.groupTexture),O.update(o.uColorTexDim,Ne.set(o.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),O.update(o.tColor,t.colorData),O.updateIfChanged(o.dColorType,t.colorType),O.updateIfChanged(o.uCurrentSlice,0),O.updateIfChanged(o.uCurrentX,0),O.updateIfChanged(o.uCurrentY,0),O.update(o.uBboxMin,r.min),O.update(o.uBboxSize,i),O.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[yc].update()}else e.namedComputeRenderables[yc]=function EXe(e,t,r,n,a){var i=S.sub(S(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:O.create(o),instanceCount:O.create(t.instanceCount),stride:O.create(a),uGroupCount:O.create(t.groupCount),aTransform:O.create(t.transformBuffer),aInstance:O.create(t.instanceBuffer),aSample:O.create(uae(o,a)),uGeoTexDim:O.create(Ne.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:O.create(t.positionTexture),tGroup:O.create(t.groupTexture),uColorTexDim:O.create(Ne.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:O.create(t.colorData),dColorType:O.create(t.colorType),uCurrentSlice:O.create(0),uCurrentX:O.create(0),uCurrentY:O.create(0),uBboxMin:O.create(r.min),uBboxSize:O.create(i),uResolution:O.create(n)},u=R({},TXe);return Wa(qa(e,"points",Un("accumulate",AXe,wXe,{drawBuffers:"required"}),u,s),s)}(e,t,r,n,a);return e.namedComputeRenderables[yc]}(n,e,m,t,r);u.currentRenderItemId=-1,I.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);var j=N.values,k=j.uCurrentSlice,H=j.uCurrentX,G=j.uCurrentY;Ct&&n.timer.mark("ColorAccumulate.render"),function IXe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}(n),u.viewport(0,0,T,w),u.scissor(0,0,T,w),o.clear(o.COLOR_BUFFER_BIT),O.update(G,0);for(var U=0,Q=0,W=0,K=0;K<x;++K)U>=E&&(U-=E,W=0,O.update(G,Q+=C)),O.update(H,W),O.update(k,K),u.viewport(W,Q,_,C),u.scissor(W,Q,_,C),N.render(),++U,W+=_;M.detachFramebuffer(I,0),F.detachFramebuffer(I,1),i.drawBuffers([o.COLOR_ATTACHMENT0,o.NONE]),Ct&&n.timer.markEnd("ColorAccumulate.render"),Ct&&n.timer.mark("ColorNormalize.render"),(!a||function uze(e){return e.format===Cee}(a))&&(a=s.texture("image-uint8","rgba","ubyte","linear")),a.define(T,w);var ne=function MXe(e,t,r){if(e.namedComputeRenderables[hC]){var n=e.namedComputeRenderables[hC].values;O.update(n.tColor,t),O.update(n.tCount,r),O.update(n.uTexSize,Ne.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[hC].update()}else e.namedComputeRenderables[hC]=function RXe(e,t,r){var n=R(R({},Ei),{tColor:O.create(t),tCount:O.create(r),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight()))}),a=R({},PXe);return Wa(qa(e,"triangles",Un("normalize",No,xXe),a,n),n)}(e,t,r);return e.namedComputeRenderables[hC]}(n,M,F);u.currentRenderItemId=-1,function OXe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}(n),a.attachFramebuffer(I,0),u.viewport(0,0,T,w),u.scissor(0,0,T,w),o.clear(o.COLOR_BUFFER_BIT),ne.render(),Ct&&n.timer.markEnd("ColorNormalize.render");var X=fr.create(b[0],b[1],b[2],v),L=f?"volumeInstance":"volume";return Ct&&n.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:a,gridDim:y,gridTexDim:Ne.create(T,w),gridTransform:X,type:L}}var _r,lae,YL="color-smoothing-rgb",xb="color-smoothing-rgba",XL="color-smoothing-alpha";function cae(e,t,r,n,a){if(function NXe(e){return"group"===e||"groupInstance"===e}(e.dColorType.ref.value)){r*=3,n.namedTextures[YL]||(n.namedTextures[YL]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));var i=n.namedTextures[YL];i.load(e.tColor.ref.value);var o=bE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dColorType,o.type),O.update(e.tColorGrid,o.texture),O.update(e.uColorTexDim,o.gridTexDim),O.update(e.uColorGridDim,o.gridDim),O.update(e.uColorGridTransform,o.gridTransform)}}function Wn(e,t){return{kind:e,layers:t}}function qo(e,t){return{kind:e,layers:t}}!function(e){e.setVisibility=function t(f,p){f&&(f.state.visible=p)},e.setAlphaFactor=function r(f,p){f&&(f.state.alphaFactor=p)},e.setPickable=function n(f,p){f&&(f.state.pickable=p)},e.setColorOnly=function a(f,p){f&&(f.state.colorOnly=p)},e.mark=function i(f,p,h,m,v){if(!f||Ps(p))return!1;var g=f.values,y=g.tMarker,b=g.uMarker,_=g.markerAverage,C=g.markerStatus,A=g.instanceCount,w=g.instanceGranularity.ref.value?A.ref.value:g.uGroupCount.ref.value*A.ref.value,E=y.ref.value.array,I=C.ref.value;if(!ku(p)){var M=0;if(m(p,function(H){return M+=xe.size(H),!0},!0),0===M)return!1;M===w&&(p=fE)}var F=!1,N=-1,j=-1;if(ku(p)){var k=function sXe(e,t){var r=-1,n=-1;switch(e){case Vt.Highlight:0===t||1===t?(r=1,n=1):2===t||3===t?(r=1,n=3):r=1;break;case Vt.RemoveHighlight:0===t||1===t?(r=0,n=0):(2===t||3===t)&&(r=1,n=2);break;case Vt.Select:1===t||3===t?(r=1,n=3):0===t||2===t?(r=1,n=2):r=1;break;case Vt.Deselect:1===t||3===t?(r=1,n=1):(0===t||2===t)&&(r=0,n=0);break;case Vt.Toggle:1===t?(r=1,n=3):2===t?(r=0,n=0):3===t?(r=1,n=1):0===t&&(r=1,n=2);break;case Vt.Clear:r=0,n=0}return{average:r,status:n}}(h,I);-1!==k.status?(F=I!==k.status)&&function oXe(e,t,r){e.fill(t,0,r)}(E,k.status,w):F=qL(E,xe.ofLength(w),h),N=k.average,j=k.status}else(F=m(p,function(H){return qL(E,H,h)},!0))&&(N=function uXe(e,t){switch(e){case Vt.Highlight:return.5;case Vt.RemoveHighlight:return 0===t?0:2===t||3===t?.5:-1;case Vt.Select:return.5;case Vt.Deselect:return 1===t||3===t?.5:0===t?0:-1;case Vt.Toggle:return-1===t?-1:.5;case Vt.Clear:return-1===t?-1:0===t?0:.5;case Vt.None:return-1;default:xn()}}(h,I),v&&-1!==v.status&&-1===N&&Is.isReverse(v.action,h)&&pr.areEqual(p,v.loci)&&(N=0===(j=v.status)?0:.5));return F&&(-1===N&&0===(N=LJ(E,w))&&(j=0),v&&(v.action=h,v.loci=p,v.status=I),O.updateIfChanged(b,j),-1===j&&O.update(y,y.ref.value),O.updateIfChanged(_,N),O.updateIfChanged(C,j)),F},e.setOverpaint=function o(f,p,h,m,v){if(f){var g=f.values,y=g.tOverpaint,b=g.dOverpaintType,_=g.dOverpaint,x=g.instanceCount,A=g.instanceGranularity,T=A.ref.value?x.ref.value:g.uGroupCount.ref.value*x.ref.value,w=A.ref.value?"instance":"groupInstance";!function Ize(e,t,r){var n=Ti(Math.max(1,e),4,Uint8Array,r&&r.tOverpaint.ref.value.array);r?(O.update(r.tOverpaint,n),O.update(r.uOverpaintTexDim,Ne.create(n.width,n.height)),O.updateIfChanged(r.dOverpaint,e>0),O.updateIfChanged(r.dOverpaintType,t)):(O.create(n),O.create(Ne.create(n.width,n.height)),O.create(e>0),O.create(Go()),O.create(S.create(1,1,1)),O.create(fr.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?T:0,w,f.values);var E=y.ref.value.array;m&&Pee(E,0,T);for(var I=function(K,ne){var X=p.layers[K],Y=X.color,$=X.clear;h(X.loci,function(q){var z=xe.start(q),te=xe.end(q);return $?Pee(E,z,te):function Eze(e,t,r,n){for(var a=t;a<r;++a)dt.toArray(n,e,4*a),e[4*a+3]=255;return!0}(E,z,te,Y)},!1)},M=0,F=p.layers.length;M<F;++M)I(M);if(O.update(y,y.ref.value),O.updateIfChanged(b,w),O.updateIfChanged(_,p.layers.length>0),0!==p.layers.length&&"instance"!==w&&v&&xp(v.props)){var N=v.geometry,j=v.props,k=v.webgl;if("mesh"===N.kind){var H=N.meta,U=H.overpaintTexture;(Q=rl(j.smoothColors,!0,H.resolution))&&(function yXe(e,t,r,n,a){if(function gXe(e){return"groupInstance"===e}(e.dOverpaintType.ref.value)){var i=gE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dOverpaintType,i.type),O.update(e.tOverpaintGrid,i.texture),O.update(e.uOverpaintTexDim,i.gridTexDim),O.update(e.uOverpaintGridDim,i.gridDim),O.update(e.uOverpaintGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dOverpaintType,i.type),O.update(e.tOverpaint,i.texture),O.update(e.uOverpaintTexDim,i.texDim))}}(f.values,Q.resolution,Q.stride,k,U),N.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}else if(k&&"texture-mesh"===N.kind){var Q,W=N.meta;U=W.overpaintTexture,(Q=rl(j.smoothColors,!0,W.resolution))&&(function BXe(e,t,r,n,a){if(function kXe(e){return"groupInstance"===e}(e.dOverpaintType.ref.value)){r*=3,n.namedTextures[xb]||(n.namedTextures[xb]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[xb];i.load(e.tOverpaint.ref.value);var o=bE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dOverpaintType,o.type),O.update(e.tOverpaintGrid,o.texture),O.update(e.uOverpaintTexDim,o.gridTexDim),O.update(e.uOverpaintGridDim,o.gridDim),O.update(e.uOverpaintGridTransform,o.gridTransform)}}(f.values,Q.resolution,Q.stride,k,U),N.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}}}},e.setTransparency=function s(f,p,h,m,v){if(f){var g=f.values,y=g.tTransparency,b=g.dTransparencyType,_=g.transparencyAverage,C=g.dTransparency,A=g.instanceCount,T=g.instanceGranularity,w=T.ref.value?A.ref.value:g.uGroupCount.ref.value*A.ref.value,E=T.ref.value?"instance":"groupInstance";!function Rze(e,t,r){var n=Ti(Math.max(1,e),1,Uint8Array,r&&r.tTransparency.ref.value.array);r?(O.update(r.tTransparency,n),O.update(r.uTransparencyTexDim,Ne.create(n.width,n.height)),O.updateIfChanged(r.dTransparency,e>0),O.updateIfChanged(r.transparencyAverage,Ree(n.array,e)),O.updateIfChanged(r.dTransparencyType,t)):(O.create(n),O.create(Ne.create(n.width,n.height)),O.create(e>0),O.create(0),O.create(Go()),O.create(S.create(1,1,1)),O.create(fr.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?w:0,E,f.values);var I=y.ref.value.array;m&&function Mze(e,t,r){e.fill(0,t,r)}(I,0,w);for(var M=function(ne,X){var L=p.layers[ne],$=L.value;h(L.loci,function(q){var z=xe.start(q),te=xe.end(q);return function Pze(e,t,r,n){for(var a=t;a<r;++a)e[a]=255*n;return!0}(I,z,te,$)},!1)},F=0,N=p.layers.length;F<N;++F)M(F);if(O.update(y,y.ref.value),O.updateIfChanged(_,Ree(I,w)),O.updateIfChanged(b,E),O.updateIfChanged(C,p.layers.length>0),0!==p.layers.length&&"instance"!==E&&v&&xp(v.props)){var j=v.geometry,k=v.props,H=v.webgl;if("mesh"===j.kind){var G=j.meta,Q=G.transparencyTexture;(W=rl(k.smoothColors,!0,G.resolution))&&(function _Xe(e,t,r,n,a){if(function bXe(e){return"groupInstance"===e}(e.dTransparencyType.ref.value)){var i=gE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dTransparencyType,i.type),O.update(e.tTransparencyGrid,i.texture),O.update(e.uTransparencyTexDim,i.gridTexDim),O.update(e.uTransparencyGridDim,i.gridDim),O.update(e.uTransparencyGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dTransparencyType,i.type),O.update(e.tTransparency,i.texture),O.update(e.uTransparencyTexDim,i.texDim))}}(f.values,W.resolution,W.stride,H,Q),j.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}else if(H&&"texture-mesh"===j.kind){var W,K=j.meta;Q=K.transparencyTexture,(W=rl(k.smoothColors,!0,K.resolution))&&(function UXe(e,t,r,n,a){if(function LXe(e){return"groupInstance"===e}(e.dTransparencyType.ref.value)){r*=3,n.namedTextures[XL]||(n.namedTextures[XL]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));var i=n.namedTextures[XL];i.load(e.tTransparency.ref.value);var o=bE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dTransparencyType,o.type),O.update(e.tTransparencyGrid,o.texture),O.update(e.uTransparencyTexDim,o.gridTexDim),O.update(e.uTransparencyGridDim,o.gridDim),O.update(e.uTransparencyGridTransform,o.gridTransform)}}(f.values,W.resolution,W.stride,H,Q),j.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}}}},e.setSubstance=function u(f,p,h,m,v){if(f){var g=f.values,y=g.tSubstance,b=g.dSubstanceType,_=g.dSubstance,x=g.instanceCount,A=g.instanceGranularity,T=A.ref.value?x.ref.value:g.uGroupCount.ref.value*x.ref.value,w=A.ref.value?"instance":"groupInstance";!function Bze(e,t,r){var n=Ti(Math.max(1,e),4,Uint8Array,r&&r.tSubstance.ref.value.array);r?(O.update(r.tSubstance,n),O.update(r.uSubstanceTexDim,Ne.create(n.width,n.height)),O.updateIfChanged(r.dSubstance,e>0),O.updateIfChanged(r.dSubstanceType,t)):(O.create(n),O.create(Ne.create(n.width,n.height)),O.create(e>0),O.create(Go()),O.create(S.create(1,1,1)),O.create(fr.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?T:0,w,f.values);var E=y.ref.value.array;m&&Nee(E,0,T);for(var I=function(K,ne){var X=p.layers[K],Y=X.material,$=X.clear;h(X.loci,function(q){var z=xe.start(q),te=xe.end(q);return $?Nee(E,z,te):function kze(e,t,r,n){for(var a=t;a<r;++a)_s.toArray(n,e,4*a),e[4*a+3]=255;return!0}(E,z,te,Y)},!1)},M=0,F=p.layers.length;M<F;++M)I(M);if(O.update(y,y.ref.value),O.updateIfChanged(b,w),O.updateIfChanged(_,p.layers.length>0),0!==p.layers.length&&"instance"!==w&&v&&xp(v.props)){var N=v.geometry,j=v.props,k=v.webgl;if("mesh"===N.kind){var H=N.meta,U=H.substanceTexture;(Q=rl(j.smoothColors,!0,H.resolution))&&(function CXe(e,t,r,n,a){if(function SXe(e){return"groupInstance"===e}(e.dSubstanceType.ref.value)){var i=gE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dSubstanceType,i.type),O.update(e.tSubstanceGrid,i.texture),O.update(e.uSubstanceTexDim,i.gridTexDim),O.update(e.uSubstanceGridDim,i.gridDim),O.update(e.uSubstanceGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dSubstanceType,i.type),O.update(e.tSubstance,i.texture),O.update(e.uSubstanceTexDim,i.texDim))}}(f.values,Q.resolution,Q.stride,k,U),N.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}else if(k&&"texture-mesh"===N.kind){var Q,W=N.meta;U=W.substanceTexture,(Q=rl(j.smoothColors,!0,W.resolution))&&(function zXe(e,t,r,n,a){if(function VXe(e){return"groupInstance"===e}(e.dSubstanceType.ref.value)){r*=3,n.namedTextures[xb]||(n.namedTextures[xb]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[xb];i.load(e.tSubstance.ref.value);var o=bE({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dSubstanceType,o.type),O.update(e.tSubstanceGrid,o.texture),O.update(e.uSubstanceTexDim,o.gridTexDim),O.update(e.uSubstanceGridDim,o.gridDim),O.update(e.uSubstanceGridTransform,o.gridTransform)}}(f.values,Q.resolution,Q.stride,k,U),N.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}}}},e.setClipping=function c(f,p,h,m){if(f){var v=f.values,g=v.tClipping,y=v.dClippingType,b=v.dClipping,C=v.instanceCount,x=v.instanceGranularity,A=x.ref.value?C.ref.value:v.uGroupCount.ref.value*C.ref.value,w=x.ref.value?"instance":"groupInstance";!function Nze(e,t,r){var n=Ti(Math.max(1,e),1,Uint8Array,r&&r.tClipping.ref.value.array);r?(O.update(r.tClipping,n),O.update(r.uClippingTexDim,Ne.create(n.width,n.height)),O.updateIfChanged(r.dClipping,e>0),O.updateIfChanged(r.dClippingType,t)):(O.create(n),O.create(Ne.create(n.width,n.height)),O.create(e>0),O.create(t))}(p.layers.length?A:0,w,f.values);var E=g.ref.value.array;m&&function Fze(e,t,r){e.fill(0,t,r)}(E,0,A);for(var I=function(N,j){var k=p.layers[N],G=k.groups;h(k.loci,function(Q){var W=xe.start(Q),K=xe.end(Q);return function Oze(e,t,r,n){return e.fill(n,t,r),!0}(E,W,K,G)},!1)},M=0,F=p.layers.length;M<F;++M)I(M);O.update(g,g.ref.value),O.updateIfChanged(y,w),O.updateIfChanged(b,p.layers.length>0)}},e.setThemeStrength=function l(f,p){f&&(O.updateIfChanged(f.values.uOverpaintStrength,p.overpaint),O.updateIfChanged(f.values.uTransparencyStrength,p.transparency),O.updateIfChanged(f.values.uSubstanceStrength,p.substance))},e.setTransform=function d(f,p,h){if(f&&(p||h)){var m=f.values;p&&(me.copy(m.matrix.ref.value,p),O.update(m.matrix,m.matrix.ref.value)),h?(m.extraTransform.ref.value.set(h),O.update(m.extraTransform,m.extraTransform.ref.value)):null===h&&(FD(m.extraTransform.ref.value,m.instanceCount.ref.value),O.update(m.extraTransform,m.extraTransform.ref.value)),Tee(m);var v=lo(m.invariantBoundingSphere.ref.value,m.aTransform.ref.value,m.instanceCount.ref.value,0);O.update(m.boundingSphere,v)}}}(_r||(_r={})),function(e){function n(l){return 0===l.layers.length}e.Empty={kind:"empty-loci",layers:[]},function(l){var d,g;function h(g){switch(g){case"one":return d.One;case"two":return d.Two;case"three":return d.Three;case"four":return d.Four;case"five":return d.Five;case"six":return d.Six}}l.is=rs.has,(g=d=l.Flag||(l.Flag={}))[g.None=0]="None",g[g.One=1]="One",g[g.Two=2]="Two",g[g.Three=4]="Three",g[g.Four=8]="Four",g[g.Five=16]="Five",g[g.Six=32]="Six",l.create=function f(g){return rs.create(g)},l.Names={one:d.One,two:d.Two,three:d.Three,four:d.Four,five:d.Five,six:d.Six},l.isName=function p(g){return g in l.Names},l.fromName=h,l.fromNames=function m(g){for(var y=d.None,b=0,_=g.length;b<_;++b)y|=h(g[b]);return y},l.toNames=function v(g){var y=[];return l.is(g,d.One)&&y.push("one"),l.is(g,d.Two)&&y.push("two"),l.is(g,d.Three)&&y.push("three"),l.is(g,d.Four)&&y.push("four"),l.is(g,d.Five)&&y.push("five"),l.is(g,d.Six)&&y.push("six"),y}}(e.Groups||(e.Groups={})),e.areEqual=function r(l,d){if(l.layers.length!==d.layers.length)return!1;for(var f=0,p=l.layers.length;f<p;++f)if(l.layers[f].groups!==d.layers[f].groups||!pr.areEqual(l.layers[f].loci,d.layers[f].loci))return!1;return!0},e.isEmpty=n,e.remap=function a(l,d){if("element-loci"===l.kind){for(var f=[],p=0,h=l.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.groups;v=Re.remap(v,d),Re.isEmpty(v)||f.push({loci:v,groups:g})}return{kind:"element-loci",layers:f}}return l},e.merge=function i(l){if(n(l))return l;if("element-loci"===l.kind){for(var d=l.layers[0].loci.structure,f=new Map,p=Re.none(d),h=0,m=l.layers.length;h<m;++h){var v=l.layers[m-h-1],g=v.loci,y=v.groups;g=Re.subtract(g,p),p=Re.union(g,p),Re.isEmpty(g)||(f.has(y)&&(g=Re.union(g,f.get(y))),f.set(y,g))}var b=[];return f.forEach(function(_,C){b.push({loci:_,groups:C})}),{kind:"element-loci",layers:b}}return l},e.filter=function o(l,d){if(n(l))return l;if("element-loci"===l.kind){for(var f=l.layers[0].loci.structure,p=[],h=0,m=l.layers;h<m.length;h++){var v=m[h],g=v.loci,y=v.groups,b=Re.remap(g,d);g=Re.remap(b,f),Re.isEmpty(g)||p.push({loci:g,groups:y})}return{kind:"element-loci",layers:p}}return l},e.ofScript=function s(l,d){for(var f=[],p=0,h=l.length;p<h;++p){var m=l[p],g=m.groups,y=Mi.toLoci(m.script,d);Re.isEmpty(y)||f.push({loci:y,groups:g})}return{kind:"element-loci",layers:f}},e.ofBundle=function u(l,d){for(var f=[],p=0,h=l.length;p<h;++p){var m=l[p],g=m.groups,y=en.toLoci(m.bundle,d.root);f.push({loci:y,groups:g})}return{kind:"element-loci",layers:f}},e.toBundle=function c(l){for(var d=[],f=0,p=l.layers.length;f<p;++f){var h=l.layers[f],v=h.groups,g=en.fromLoci(h.loci);d.push({bundle:g,groups:v})}return{kind:"element-loci",layers:d}}}(Wn||(Wn={})),function(e){function r(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,l){if(0===c.layers.length&&0===l.layers.length)return!0;if(c.layers.length!==l.layers.length)return!1;for(var d=0,f=c.layers.length;d<f;++d)if(c.layers[d].clear!==l.layers[d].clear||!tN(c.layers[d].material,l.layers[d].material)||!pr.areEqual(c.layers[d].loci,l.layers[d].loci))return!1;return!0},e.isEmpty=r,e.remap=function n(c,l){if("element-loci"===c.kind){for(var d=[],f=0,p=c.layers;f<p.length;f++){var h=p[f],m=h.loci,v=h.material,g=h.clear;m=Re.remap(m,l),Re.isEmpty(m)||d.push({loci:m,material:v,clear:g})}return{kind:"element-loci",layers:d}}return c},e.merge=function a(c){if(r(c))return c;if("element-loci"===c.kind){for(var l=c.layers[0].loci.structure,d=void 0,f=new Map,p=Re.none(l),h=0,m=c.layers.length;h<m;++h){var v=c.layers[m-h-1],g=v.loci,y=v.material,b=v.clear;g=Re.subtract(g,p),p=Re.union(g,p),Re.isEmpty(g)||(b?d=d?Re.union(g,d):g:(f.has(y)&&(g=Re.union(g,f.get(y))),f.set(y,g)))}var _=[];return d&&_.push({loci:d,material:_s(),clear:!0}),f.forEach(function(C,x){_.push({loci:C,material:x,clear:!1})}),{kind:"element-loci",layers:_}}return c},e.filter=function i(c,l){if(r(c))return c;if("element-loci"===c.kind){for(var d=c.layers[0].loci.structure,f=[],p=0,h=c.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.material,y=m.clear,b=Re.remap(v,l);v=Re.remap(b,d),Re.isEmpty(v)||f.push({loci:v,material:g,clear:y})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function o(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var h=c[f],v=h.material,g=h.clear,y=Mi.toLoci(h.script,l);Re.isEmpty(y)||d.push({loci:y,material:v,clear:g})}return{kind:"element-loci",layers:d}},e.ofBundle=function s(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var h=c[f],v=h.material,g=h.clear,y=en.toLoci(h.bundle,l.root);d.push({loci:y,material:v,clear:g})}return{kind:"element-loci",layers:d}},e.toBundle=function u(c){for(var l=[],d=0,f=c.layers.length;d<f;++d){var p=c.layers[d],m=p.material,v=p.clear,g=en.fromLoci(p.loci);l.push({bundle:g,material:m,clear:v})}return{kind:"element-loci",layers:l}}}(qo||(qo={})),function(e){e.getDetaultParams=function t(r,n,a){return D.getDefaultValues(r.getParams(n,a))}}(lae||(lae={}));var GXe={name:"",label:"",description:"",factory:function(){return dr.Empty},getParams:function(){return{}},defaultValues:{},defaultColorTheme:Nu.EmptyProvider,defaultSizeTheme:Ki.EmptyProvider,isApplicable:function(){return!0}};function dae(e){return e.map(function(t){return[t.name,t.provider.label]})}var dr,fae=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return dae(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered represenatation provider."));return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||GXe},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return dae(this.getApplicableList(t))},e.prototype.clear=function(){this._list.length=0,this._map.clear(),this._name.clear()},e}();function Zi(e,t,r){void 0===r&&(r={});var u,c,h,m,n=0,a=new Cn,i=dr.createState(),o=Vp(),s=[],l=-1,d=Oi.createEmpty(),f=D.getDefaultValues(t.Params);r.modifyState&&dr.updateState(i,r.modifyState(i));var v=df.create();function _(C,x){return ku(C)||Wr.isLoci(C)&&C.shape===c?x(xe.ofBounds(0,f.instanceGranularity?c.transforms.length:c.groupCount*c.transforms.length)):f.instanceGranularity?function b(C,x,A){var T=!1;if(!is.isLoci(C)||is.isLociEmpty(C)||C.shape!==x)return!1;for(var w=0,E=C.groups;w<E.length;w++)A(xe.ofSingleton(E[w].instance))&&(T=!0);return T}(C,c,x):function HXe(e,t,r){if(!is.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,o=0,s=e.groups;o<s.length;o++){var u=s[o],c=u.ids,l=u.instance;if(xe.is(c)){var d=l*a+xe.start(c),f=l*a+xe.end(c);r(xe.ofBounds(d,f))&&(n=!0)}else for(var p=0,h=c.length;p<h;p++)r(xe.ofSingleton(l*a+c[p]))&&(n=!0)}return n}(C,c,x)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return f},get params(){},get state(){return i},get theme(){return d},renderObjects:s,get geometryVersion(){return l},updated:a,createOrUpdate:function y(C,x){var A=this;return void 0===C&&(C={}),r.modifyProps&&(C=r.modifyProps(C)),Ve.create("ShapeRepresentation.create",function(T){return ce(A,void 0,void 0,function(){var w,E,I,M,F,N,j,k;return le(this,function(H){switch(H.label){case 0:return w=Object.assign(f,C),x?[4,e(T,x,w,c)]:[3,2];case 1:return I=H.sent(),[3,3];case 2:I=void 0,H.label=3;case 3:if(function g(C,x){void 0===C&&(C={}),df.reset(v),(x||c)&&(x&&!c?v.createNew=!0:x&&c&&x.id===c.id||(x&&c&&x.id!==c.id?(v.updateTransform=!0,v.createGeometry=!0):x&&console.warn("unexpected state")),C.instanceGranularity!==f.instanceGranularity&&(v.updateTransform=!0),v.updateTransform&&(v.updateColor=!0,v.updateSize=!0),v.createGeometry&&(v.updateColor=!0,v.updateSize=!0))}(C,E=I),E&&(c=E,Object.assign(d,Wr.getTheme(c))),v.createNew)s.length=0,h=Wr.groupIterator(c),M=Wr.createTransform(c.transforms),F=t.createValues(c.geometry,M,h,d,w),N=t.createRenderableState(w),r.modifyState&&Object.assign(N,r.modifyState(N)),dr.updateState(i,N),(u=fb(c.geometry.kind,F,N,o))&&s.push(u),m=t.createPositionIterator(c.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");v.updateTransform&&(Wr.createTransform(c.transforms,u.values),h=Wr.groupIterator(c),j=h.instanceCount,k=h.groupCount,C.instanceGranularity?La(j,"instance",u.values):La(j*k,"groupInstance",u.values)),v.createGeometry&&(O.updateIfChanged(u.values.drawCount,Xi.getDrawCount(c.geometry)),O.updateIfChanged(u.values.uVertexCount,Xi.getVertexCount(c.geometry)),O.updateIfChanged(u.values.uGroupCount,Xi.getGroupCount(c.geometry))),(v.updateTransform||v.createGeometry)&&(t.updateBoundingSphere(u.values,c.geometry),m=t.createPositionIterator(c.geometry,u.values)),v.updateColor&&pc(h,m,d.color,u.values),v.updateSize&&"uSize"in u.values&&Ip(h,d.size,u.values),t.updateValues(u.values,w),t.updateRenderableState(u.state,w)}return f=w,(v.createGeometry||v.createNew)&&(l+=1),a.next(n++),[2]}})})})},getLoci:function(C){var T=C.instanceId;return u&&u.id===C.objectId?is.Loci(c,[{ids:Be.ofSingleton(C.groupId),instance:T}]):Yr},getAllLoci:function(){return[Wr.Loci(c)]},eachLocation:function(C){for(h.reset();h.hasNext;){var x=h.move();C(x.location,x.isSecondary)}},mark:function(C,x){if(!Is.is(i.markerActions,x))return!1;if(is.isLoci(C)||Wr.isLoci(C)){if(C.shape!==c)return!1}else if(!ku(C))return!1;return _r.mark(u,C,x,_)},setState:function(C){r.modifyState&&(C=r.modifyState(C)),u&&(void 0!==C.visible&&_r.setVisibility(u,C.visible),void 0!==C.alphaFactor&&_r.setAlphaFactor(u,C.alphaFactor),void 0!==C.pickable&&_r.setPickable(u,C.pickable),void 0!==C.colorOnly&&_r.setColorOnly(u,C.colorOnly),void 0!==C.overpaint&&_r.setOverpaint(u,C.overpaint,_,!0),void 0!==C.transparency&&_r.setTransparency(u,C.transparency,_,!0),void 0!==C.substance&&_r.setSubstance(u,C.substance,_,!0),void 0!==C.transform&&_r.setTransform(u,C.transform)),dr.updateState(i,C)},setTheme:function(C){xr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}!function(e){var s;function r(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:me.identity(),overpaint:Fi.Empty,transparency:jo.Empty,substance:qo.Empty,clipping:Wn.Empty,themeStrength:{overpaint:1,transparency:1,substance:1},markerActions:Is.All}}function n(s,u){void 0!==u.visible&&(s.visible=u.visible),void 0!==u.alphaFactor&&(s.alphaFactor=u.alphaFactor),void 0!==u.pickable&&(s.pickable=u.pickable),void 0!==u.colorOnly&&(s.colorOnly=u.colorOnly),void 0!==u.overpaint&&(s.overpaint=u.overpaint),void 0!==u.transparency&&(s.transparency=u.transparency),void 0!==u.substance&&(s.substance=u.substance),void 0!==u.clipping&&(s.clipping=u.clipping),void 0!==u.themeStrength&&(s.themeStrength=u.themeStrength),void 0!==u.syncManually&&(s.syncManually=u.syncManually),void 0!==u.transform&&me.copy(s.transform,u.transform),void 0!==u.markerActions&&(s.markerActions=u.markerActions)}(s=e.Loci||(e.Loci={})).areEqual=function u(l,d){return l.repr===d.repr&&pr.areEqual(l.loci,d.loci)},s.isEmpty=function c(l){return pr.isEmpty(l.loci)},s.Empty={loci:Yr},e.createState=r,e.updateState=n,e.StateBuilder={create:r,update:n},e.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new Cn,state:r(),theme:Oi.createEmpty(),createOrUpdate:function(){return Ve.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return Yr},getAllLoci:function(){return[]},eachLocation:function(){},mark:function(){return!1},destroy:function(){}};var a=function(){function s(){this.curr=new Set,this.next=new Set,this._version=-1}return Object.defineProperty(s.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),s.prototype.add=function(u,c){this.next.add(nc(u,c))},s.prototype.snapshot=function(){var u;fa.areEqual(this.curr,this.next)||(this._version+=1),this.curr=(u=[this.next,this.curr])[0],this.next=u[1],this.next.clear()},s}();e.GeometryState=a,e.createMulti=function i(s,u,c,l,d){var y,b,_,f=this,p=0,h=new Cn,m=new a,v=l.create(),g=Oi.createEmpty(),C={},x=Object.keys(d).map(function(A,T){C[T]=A;var w=d[A](u,c);return w.setState(v),w});return{label:s,updated:h,get groupCount(){var A=0;if(b)for(var T=b.visuals,w=0,E=x.length;w<E;++w)(!T||T.includes(C[w]))&&(A+=x[w].groupCount);return A},get renderObjects(){var A=[];if(b)for(var T=b.visuals,w=0,E=x.length;w<E;++w)(!T||T.includes(C[w]))&&A.push.apply(A,x[w].renderObjects);return A},get geometryVersion(){return m.version},get props(){return b},get params(){return y},createOrUpdate:function(A,T){void 0===A&&(A={}),T&&T!==_&&(y=c(u,T),_=T,b||(b=D.getDefaultValues(y)));var w=WL(Object.assign({},b,A),_);Object.assign(b,A,w);var E=b.visuals;return Ve.create("Creating or updating '".concat(s,"' representation"),function(I){return ce(f,void 0,void 0,function(){var M,F;return le(this,function(N){switch(N.label){case 0:M=0,F=x.length,N.label=1;case 1:return M<F?!E||E.includes(C[M])?[4,x[M].createOrUpdate(b,_).runInContext(I)]:[3,3]:[3,5];case 2:N.sent(),N.label=3;case 3:m.add(M,x[M].geometryVersion),N.label=4;case 4:return++M,[3,1];case 5:return m.snapshot(),h.next(p++),[2]}})})})},get state(){return v},get theme(){return g},getLoci:function(A){for(var T=b.visuals,w=0,E=x.length;w<E;++w)if(!T||T.includes(C[w])){var I=x[w].getLoci(A);if(!Ps(I))return I}return Yr},getAllLoci:function(){for(var A=[],T=b.visuals,w=0,E=x.length;w<E;++w)(!T||T.includes(C[w]))&&A.push.apply(A,x[w].getAllLoci());return A},eachLocation:function(A){for(var T=b.visuals,w=0,E=x.length;w<E;++w)(!T||T.includes(C[w]))&&x[w].eachLocation(A)},mark:function(A,T){for(var w=!1,E=0,I=x.length;E<I;++E)w=x[E].mark(A,T)||w;return w},setState:function(A){l.update(v,A);for(var T=0,w=x.length;T<w;++T)x[T].setState(A)},setTheme:function(A){g=A;for(var T=0,w=x.length;T<w;++T)x[T].setTheme(A)},destroy:function(){for(var A=0,T=x.length;A<T;++A)x[A].destroy()}}},e.fromRenderObject=function o(s,u){var c=this,l=0,d=new Cn,f=new a,p=e.createState(),h=Oi.createEmpty(),m=D.clone(ot.Params),v=D.getDefaultValues(ot.Params);return{label:s,updated:d,get groupCount(){return u.values.uGroupCount.ref.value},get renderObjects(){return[u]},get geometryVersion(){return f.version},get props(){return v},get params(){return m},createOrUpdate:function(g){void 0===g&&(g={});var y=WL(Object.assign({},v,g));return Object.assign(v,g,y),Ve.create("Updating '".concat(s,"' representation"),function(b){return ce(c,void 0,void 0,function(){return le(this,function(_){return f.add(0,u.id),f.snapshot(),d.next(l++),[2]})})})},get state(){return p},get theme(){return h},getLoci:function(){return Yr},getAllLoci:function(){return[]},eachLocation:function(){},mark:function(g,y){return!1},setState:function(g){void 0!==g.visible&&_r.setVisibility(u,g.visible),void 0!==g.alphaFactor&&_r.setAlphaFactor(u,g.alphaFactor),void 0!==g.pickable&&_r.setPickable(u,g.pickable),void 0!==g.colorOnly&&_r.setColorOnly(u,g.colorOnly),void 0!==g.themeStrength&&_r.setThemeStrength(u,g.themeStrength),void 0!==g.transform&&_r.setTransform(u,g.transform),e.updateState(p,g)},setTheme:function(){},destroy:function(){}}}}(dr||(dr={}));var pae=me(),wb=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Oc.Mutable(),this.groupIndexMap=Oc.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(16*t.units.length),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+16*i.units.length);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+16*s);r+=16*i.units.length}}return e.prototype.reset=function(){this.version=0,FD(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(void 0===this._isIdentity){this._isIdentity=!0;for(var t=0,r=16*this.size;t<r;t+=16)if(me.fromArray(pae,this.unitTransforms,t),!me.isIdentity(pae)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,me.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return me.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),hae=me();function mae(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];sa.lerpFromIdentity(hae,i.conformation.operator,r),t.setTransform(hae,i)}}var vae=S(),Ab=S(),_E=me();function gae(e,t,r,n){for(var a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];S.transformMat4(vae,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),S.sub(Ab,vae,n.center),S.setMagnitude(Ab,Ab,a),me.fromTranslation(_E,Ab),t.setTransform(_E,s)}}var jXe={axis:D.MappedStatic("custom",{structure:D.Group({principalAxis:D.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:D.Group({vector:D.Vec3(S.create(0,0,1))})}),origin:D.MappedStatic("structure",{structure:D.Group({}),custom:D.Group({vector:D.Vec3(S.create(0,0,0))})})};function yae(e,t){return{axis:"custom"===t.axis.name?t.axis.params.vector:Ye.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],origin:"custom"===t.origin.name?t.origin.params.vector:Ye.getPrincipalAxes(e).momentsAxes.origin}}var bae=me(),_ae=me(),SE=me();function Sae(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];S.negate(Ab,a),me.fromTranslation(_E,Ab),me.fromRotation(bae,Math.PI*r*2,n),me.fromTranslation(_ae,a),me.mul(SE,bae,_E),me.mul(SE,_ae,SE),t.setTransform(SE,s)}}var qXe=me.fromTranslation(me(),S.create(.5,.5,.5)),WXe=zee(Vee(lte()),qXe),td=S(),Cae=me(),KXe=R(R({},Lt.Params),{cellColor:D.Color(gr.orange),cellScale:D.Numeric(2,{min:.1,max:5,step:.1}),ref:D.Select("model",D.objectToOptions({origin:"Origin",model:"Model"}),{isEssential:!0}),attachment:D.Select("corner",D.objectToOptions({corner:"Corner",center:"Center"}),{isEssential:!0})}),ZXe={mesh:function(e,t){return Zi($Xe,Lt.Utils)}},xae=R({},KXe);function $Xe(e,t,r,n){var a=function QXe(e,t,r){var n=ft.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;S.copy(td,e.ref),"center"===t.attachment?(S.trunc(td,td),S.subScalar(td,td,.5)):S.floor(td,td),me.fromTranslation(Cae,td);var i=zee(Vee(WXe),Cae),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,ft.addCage(n,a,i,o,2,20);var s=De.fromDimensionsAndTransform(De(),S.unit,a);S.transformMat4(td,td,a),De.translate(s,s,td),De.expand(s,s,o);var u=ft.getMesh(n);return u.setBoundingSphere(s),u}(t,r,n&&n.geometry),i=B2.getUnitcellLabel(t.symmetry);return Wr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function wae(e,t,r){var n=S();return"model"===r.ref&&S.transformMat4(n,ir.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}var ff,fl=new Uint16Array([0,1,2,1,3,2]),hg=qe.add3,Wo=qe.add2,Aae=qe.add;!function(e){e.create=function t(r,n,a,i){void 0===r&&(r={}),void 0===n&&(n=2048),void 0===a&&(a=1024),n*=2,a*=2;var o=qe.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=qe.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=qe.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),c=qe.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),l=qe.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),d=qe.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),f=R(R({},D.getDefaultValues(hc.Params)),r),p=f.attachment,h=f.background,m=f.backgroundMargin,v=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=function vGe(e){var t=JSON.stringify(e);return void 0===xB[t]&&(xB[t]=new gGe(e)),xB[t]}(f),_=.4*m,C=b.buffer/b.lineHeight,x=function(A,T,w,E,I){hg(o,A,T,w),Aae(u,E),Aae(l,I)};return{add:function(A,T,w,E,I,M,F){for(var N=0,j=A.length,k=0;k<j;++k)N+=(H=b.get(A[k])).nw-2*C;var U,Q;if(U=p.startsWith("top")?.8:p.startsWith("middle")?.4:0,Q=p.endsWith("right")?N:p.endsWith("center")?N/2:0,v)switch(p){case"bottom-left":Q-=g/2+_+.1,U-=g/2+_;break;case"bottom-center":U-=g+_;break;case"bottom-right":Q+=g/2+_+.1,U-=g/2+_;break;case"middle-left":Q-=g+_+.1;break;case"middle-center":break;case"middle-right":Q+=g+_+.1;break;case"top-left":Q-=g/2+_+.1,U+=g/2+_;break;case"top-center":U+=g+_;break;case"top-right":Q+=g/2+_+.1,U+=g/2+_}var W=(-Q-_-.1)*M,K=(N-Q+_+.1)*M,ne=(.8-U+_)*M,X=(-U-_)*M;if(h){Wo(s,W,ne),Wo(s,W,X),Wo(s,K,ne),Wo(s,K,X);for(var L=o.elementCount,Y=0;Y<4;++Y)Wo(d,10,10),x(T,w,E,I,F);hg(c,L+fl[0],L+fl[1],L+fl[2]),hg(c,L+fl[3],L+fl[4],L+fl[5])}if(v){var $=void 0,Z=void 0,q=void 0,z=void 0,te=void 0,ae=void 0,fe=void 0,he=void 0,pe=g*M,re=y*M;switch(p){case"bottom-left":$=W-pe/2,q=W+re/2,te=W,fe=W,Z=X-pe/2,z=X,ae=X+re/2,he=X;break;case"bottom-center":$=0,q=re/2,te=-re/2,fe=0,Z=X-pe,z=X,ae=X,he=X;break;case"bottom-right":$=K+pe/2,q=K,te=K-re/2,fe=K,Z=X-pe/2,z=X+re/2,ae=X,he=X;break;case"middle-left":$=W-pe,q=W,te=W,fe=W,Z=0,z=-re/2,ae=re/2,he=0;break;case"middle-center":$=0,q=0,te=0,fe=0,Z=0,z=0,ae=0,he=0;break;case"middle-right":$=K+pe,q=K,te=K,fe=K,Z=0,z=re/2,ae=-re/2,he=0;break;case"top-left":$=W-pe/2,q=W+re/2,te=W,fe=W,Z=ne+pe/2,z=ne,ae=ne-re/2,he=ne;break;case"top-center":$=0,q=re/2,te=-re/2,fe=0,Z=ne+pe,z=ne,ae=ne,he=ne;break;case"top-right":$=K+pe/2,q=K,te=K-re/2,fe=K,Z=ne+pe/2,z=ne-re/2,ae=ne,he=ne;break;default:xn()}for(Wo(s,$,Z),Wo(s,q,z),Wo(s,te,ae),Wo(s,fe,he),L=o.elementCount,Y=0;Y<4;++Y)Wo(d,10,10),x(T,w,E,I,F);hg(c,L,L+1,L+3),hg(c,L,L+3,L+2)}Q+=C,U+=C;var ee=0;for(k=0;k<j;++k){var H,ue=(ee-Q)*M,ge=(ee+(H=b.get(A[k])).nw-Q)*M,Ce=(H.nh-U)*M,ze=-U*M;Wo(s,ue,Ce),Wo(s,ue,ze),Wo(s,ge,Ce),Wo(s,ge,ze);var je=b.texture.width,V=b.texture.height;for(Wo(d,H.x/je,H.y/V),Wo(d,H.x/je,(H.y+H.h)/V),Wo(d,(H.x+H.w)/je,H.y/V),Wo(d,(H.x+H.w)/je,(H.y+H.h)/V),ee+=H.nw-2*C,L=o.elementCount,Y=0;Y<4;++Y)x(T,w,E,I,F);hg(c,L+fl[0],L+fl[1],L+fl[2]),hg(c,L+fl[3],L+fl[4],L+fl[5])}},getText:function(){var A=b.texture,T=qe.compact(o,!0),w=qe.compact(s,!0),E=qe.compact(u,!0),I=qe.compact(c,!0),M=qe.compact(l,!0),F=qe.compact(d,!0);return hc.create(A,T,w,E,I,M,F,c.elementCount/2,i)}}}}(ff||(ff={}));var Tb={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function CE(e,t){var r;switch(void 0===t&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(f){return f.entry}).filter(function(f){return!!f}).join(", ");case"element-loci":return xE(jd.ofLoci(e),t);case"bond-loci":var n=e.bonds[0];return n?KL(n,t):"";case"shape-loci":return e.shape.name;case"group-loci":var a=e.groups[0];return a?e.shape.getLabel(Be.start(a.ids),a.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return["".concat(e.volume.label||"Volume"),"Isosurface at ".concat(nt.IsoValue.toString(e.isoValue))].join(" | ");case"cell-loci":var i=Be.size(e.indices),o=Be.start(e.indices),s=nt.IsoValue.absolute(e.volume.grid.cells.data[o]),u=nt.IsoValue.toRelative(s,e.volume.grid.stats),c=["".concat(e.volume.label||"Volume"),"".concat(1===i?"Cell #".concat(o):"".concat(i," Cells"))];return 1===i&&c.push("".concat(nt.IsoValue.toString(s)," (").concat(nt.IsoValue.toString(u),")")),c.join(" | ");case"segment-loci":var l=null===(r=nt.Segmentation.get(e.volume))||void 0===r?void 0:r.labels;if(l&&1===e.segments.length){var d=l[e.segments[0]];if(d)return d}return["".concat(e.volume.label||"Volume"),"".concat(1===e.segments.length?"Segment ".concat(e.segments[0]):"".concat(e.segments.length," Segments"))].join(" | ")}}function Db(e,t){return 1===e?"1 ".concat(t):"".concat(e," ").concat(t,"s")}function mC(e,t,r,n,a,i){return"".concat(Kp(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})," <small>[+ ").concat(Db(e-1,"other ".concat(Rv(r))),"]</small>")}function xE(e,t){void 0===t&&(t={});var r=R(R({},Tb),t),n=function tKe(e,t,r,n,a){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===a&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,c=e.elementCount;if(!t&&1===c&&0===s&&0===o)return Kp(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&0===c&&1===s&&0===o)return Kp(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(t||0!==c||0!==s||1!==o){if(t){var f=[];return i>0&&f.push(Db(i,"Structure")),o>0&&f.push(Db(o,"Chain")),s>0&&f.push(Db(s,"Residue")),u>0&&f.push(Db(u,"Conformation")),c>0&&f.push(Db(c,"Element")),f.join("<small> + </small>")}return f=[],i>0&&f.push(1===i?Kp(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):mC(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(f.push(1===o?Kp(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):mC(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(f.push(1===s?Kp(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):mC(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(f.push(1===u?Kp(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):mC(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),c>0&&f.push(1===c?Kp(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):mC(c,e.firstElementLoc,"element",r,a,n)),f.join("<small> + </small>")}var l=e.firstChainLoc.unit,d=Oe.isAtomic(l)&&1===function eKe(e){var t=e.elements,n=e.model.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments;return i.index[a.offsets[a.index[t[t.length-1]]+1]-1]-i.index[a.offsets[a.index[t[0]]]]+1}(l)||Oe.Traits.is(l.traits,Oe.Trait.MultiChain)?"residue":"chain";return Kp(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:a})}(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:AN(n)}function wE(e,t){void 0===t&&(t={});for(var r=jd.create(),n=0,a=e;n<a.length;n++)jd.add(r,r,jd.ofLoci(a[n]));return xE(r,t)}function KL(e,t){return void 0===t&&(t={}),AE({loci:[Re(e.aStructure,[{unit:e.aUnit,indices:Be.ofSingleton(e.aIndex)}]),Re(e.bStructure,[{unit:e.bUnit,indices:Be.ofSingleton(e.bIndex)}])]},t)}function AE(e,t){void 0===t&&(t={});var r=R(R({},Tb),t),n=function rKe(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var c=u[s];if(!Re.is(c)||1!==Re.size(c)){o=!1;break}}if(o){var d=e.loci.map(function(b){var _=b.elements[0],C=_.unit;return at.create(b.structure,C,C.elements[Be.start(_.indices)])}).map(function(b){return Tae(b,r,n,a||i)});if(i)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" \u2014 ");for(var f=0,p=0,h=Math.min.apply(Math,d.map(function(b){return b.length}))-1;p<h;++p){for(var m=!0,v=1,g=d.length;v<g;++v)if(d[0][p]!==d[v][p]){m=!1;break}if(!m)break;f+=1}if(f>0){var y=[d[0].join(" | ")];for(v=1,g=d.length;v<g;++v)y.push(d[v].slice(f).filter(function(C){return!!C}).join(" | "));return y.join(" \u2014 ")}return d.map(function(b){return b.filter(function(_){return!!_}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}return(d=e.loci.map(function(_){return CE(_,t)})).filter(function(_){return!!_}).join(i?" \u2014 ":"</br>")}(e,r);return r.htmlStyling?n:AN(n)}function Kp(e,t){var r,n;void 0===t&&(t={});var a=R(R({},Tb),t),i=Tae(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?null!==(n=null===(r=i[0])||void 0===r?void 0:r.replace(/\[.*\]/g,"").trim())&&void 0!==n?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:AN(o)}function Tae(e,t,r,n){void 0===t&&(t="element"),void 0===r&&(r=!1),void 0===n&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),a.push("<small>".concat(i,"</small>")),"structure"!==t&&(a.push("<small>Model ".concat(e.unit.model.modelNum,"</small>")),a.push("<small>Instance ".concat(e.unit.conformation.operator.name,"</small>")))}return Oe.isAtomic(e.unit)?a.push.apply(a,function nKe(e,t,r){void 0===r&&(r=!1);var n=at.residueIndex(e),a=it.chain.label_asym_id(e),i=it.chain.auth_asym_id(e),o=0===e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n),s=it.residue.label_seq_id(e),u=it.residue.auth_seq_id(e),c=it.residue.pdbx_PDB_ins_code(e),l=it.atom.label_comp_id(e),d=it.atom.label_atom_id(e),f=it.atom.label_alt_id(e),p=it.atom.occupancy(e),h=it.residue.microheterogeneityCompIds(e),m="residue"===t&&h.length>1?"(".concat(h.join("|"),")"):l,v=[];switch(t){case"element":v.push("<b>".concat(d,"</b>").concat(f?"%".concat(f):""));case"conformation":"conformation"===t&&f&&v.push("<small>Conformation</small> <b>".concat(f,"</b>"));case"residue":var g=s!==u&&o?s:u;v.push("<b>".concat(m," ").concat(g,"</b>").concat(g!==u?" <small>[auth</small> <b>".concat(u,"</b><small>]</small>"):"","<b>").concat(c||"","</b>"));case"chain":a===i?v.push("<b>".concat(a,"</b>")):"chain"===t&&Oe.Traits.is(e.unit.traits,Oe.Trait.MultiChain)?v.push("<small>[auth</small> <b>".concat(i,"</b><small>]</small>")):v.push("<b>".concat(a,"</b> <small>[auth</small> <b>").concat(i,"</b><small>]</small>"))}return v.length>0&&1!==p&&!r&&(v[0]="".concat(v[0]," <small>[occupancy</small> <b>").concat(Math.round(100*p)/100,"</b><small>]</small>")),v.reverse()}(e,t,n)):Oe.isCoarse(e.unit)?a.push.apply(a,function aKe(e,t){var r=it.coarse.asym_id(e),n=it.coarse.seq_id_begin(e),a=it.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=it.coarse.entityKey(e),u=e.unit.model.sequence.byEntityKey[o].sequence.compId.value(n-1);i.push("<b>".concat(u," ").concat(n,"</b>"))}else i.push("<b>".concat(n,"-").concat(a,"</b>"));case"chain":i.push("<b>".concat(r,"</b>"))}return i.reverse()}(e,t)):a.push("Unknown"),n?a.reverse():a}function ZL(e,t){void 0===t&&(t={});var r=R(R(R({},Tb),{measureOnly:!1,unitLabel:"\u212b"}),t),n=e.loci.map(function(u){return pr.getCenter(u)}),o="".concat(S.distance(n[0],n[1]).toFixed(2)," ").concat(r.unitLabel);if(r.measureOnly)return o;var s=AE(e,r);return r.condensed?"".concat(o," | ").concat(s):"Distance ".concat(o,"</br>").concat(s)}function QL(e,t){void 0===t&&(t={});var r=R(R(R({},Tb),{measureOnly:!1}),t),n=e.loci.map(function(d){return pr.getCenter(d)}),a=n[0],i=n[1],o=n[2],s=S.sub(S(),a,i),u=S.sub(S(),o,i),c="".concat(Ju(S.angle(s,u)).toFixed(2),"\xb0");if(r.measureOnly)return c;var l=AE(e,r);return r.condensed?"".concat(c," | ").concat(l):"Angle ".concat(c,"</br>").concat(l)}function $L(e,t){void 0===t&&(t={});var r=R(R(R({},Tb),{measureOnly:!1}),t),n=e.loci.map(function(l){return pr.getCenter(l)}),u="".concat(Ju(S.dihedralAngle(n[0],n[1],n[2],n[3])).toFixed(2),"\xb0");if(r.measureOnly)return u;var c=AE(e,r);return r.condensed?"".concat(u," | ").concat(c):"Dihedral ".concat(u,"</br>").concat(c)}var Dae={customText:D.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:D.Color(gr.black,{isEssential:!0}),textSize:D.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},TE=R(R(R({},hc.Params),Dae),{borderWidth:D.Numeric(.2,{min:0,max:.5,step:.01})}),Eae={unitLabel:D.Text("\u212b",{isEssential:!0})},iKe=R(R(R({},ca.Params),Eae),{lineSizeAttenuation:D.Boolean(!0),linesColor:D.Color(gr.lightgreen,{isEssential:!0}),linesSize:D.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:D.Numeric(.2,{min:.01,max:.2,step:.01})}),oKe=R(R({},TE),Eae),Iae={lines:function(e,t){return Zi(cKe,ca.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Is.Highlighting})}})},text:function(e,t){return Zi(dKe,hc.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Vt.None})}})}},Pae=R(R(R({},iKe),oKe),{visuals:D.MultiSelect(["lines","text"],D.objectToOptions(Iae))});function Mae(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,s=i[1];return pr.getBoundingSphere(i[0],r),pr.getBoundingSphere(s,n),S.add(a,r.center,n.center),S.scale(a,a,.5),t.distance=S.distance(r.center,n.center),t}var gm=function sKe(){return{sphereA:De(),sphereB:De(),center:S(),distance:0}}();function Rae(e,t){return 1===e.pairs.length?"Distance ".concat(ZL(e.pairs[0],{unitLabel:t,measureOnly:!0})):"".concat(e.pairs.length," Distances")}function cKe(e,t,r,n){var a=function uKe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)Mae(e.pairs[a],gm),n.addFixedLengthDashes(gm.sphereA.center,gm.sphereB.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=Rae(t,r.unitLabel);return Wr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},function(s){return ZL(t.pairs[s],r)})}function dKe(e,t,r,n){var a=function lKe(e,t,r){for(var n=ff.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){Mae(e.pairs[a],gm);var o=gm.center,u=gm.sphereA,c=gm.sphereB,l=t.customText||"".concat(gm.distance.toFixed(2)," ").concat(t.unitLabel),d=Math.max(2,u.radius,c.radius);n.add(l,o[0],o[1],o[2],1,d/2,a)}return n.getText()}(t,r,n&&n.geometry),i=Rae(t,r.unitLabel);return Wr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},function(s){return ZL(t.pairs[s],r)})}function Oae(e){return{pairs:[{loci:[e[0].loci,e[1].loci]}]}}function Fae(e){return{triples:[{loci:[e[0].loci,e[1].loci,e[2].loci]}]}}function Nae(e){return{quads:[{loci:[e[0].loci,e[1].loci,e[2].loci,e[3].loci]}]}}function kae(e){return{infos:[{loci:e[0].loci}]}}function Bae(e){return{locis:e.map(function(t){return t.loci})}}function Lae(e){return{locis:e.map(function(t){return t.loci})}}var pKe=R({},TE),Uae={text:function(e,t){return Zi(gKe,hc.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})}},Vae=R(R({},pKe),{scaleByRadius:D.Boolean(!0),visuals:D.MultiSelect(["text"],D.objectToOptions(Uae))}),hKe=De();function JL(e,t){return void 0===t&&(t=!1),e.label||CE(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function gKe(e,t,r,n){var a=function vKe(e,t,r){for(var n=ff.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=pr.getBoundingSphere(s.loci,hKe);if(u){var c=u.center,l=u.radius,d=a||JL(s,!0);n.add(d,c[0],c[1],c[2],t.scaleByRadius?l/.9:0,t.scaleByRadius?Math.max(1,l):1,i)}}return n.getText()}(t,r,n&&n.geometry),i=function mKe(e){return 1===e.infos.length?JL(e.infos[0]):"".concat(e.infos.length," Labels")}(t),o=r.customText.trim();return Wr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o?function(u){return o}:function(u){return JL(t.infos[u])})}var mg=S(),bKe=me.identity(),vg=new Float32Array(18),_Ke=new Uint8Array([0,1,2,3,4,5]);S.zero(),S.zero();var ym=S(),CKe=S(),xKe=S(),wKe=S(),AKe=me.identity(),zae=new Float32Array(24),TKe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]),EKe=me.identity(),Gae=S();function e5(e,t,r,n,a,i){ft.addPrimitive(e,function IKe(e,t,r,n,a){return S.add(Gae,t,r),me.targetTo(e,t,Gae,n),me.setTranslation(e,t),me.scale(e,e,a)}(EKe,t,r,n,a),qee(i))}var t5={color:D.Color(gr.orange),scaleFactor:D.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:D.Numeric(2,{min:.1,max:10,step:.1})},PKe=R(R({},Lt.Params),t5),MKe=R(R({},Lt.Params),t5),RKe=R(R({},Lt.Params),t5),Hae={axes:function(e,t){return Zi(NKe,Lt.Utils)},box:function(e,t){return Zi(LKe,Lt.Utils)},ellipsoid:function(e,t){return Zi(zKe,Lt.Utils)}},jae=R(R(R(R({},PKe),MKe),RKe),{visuals:D.MultiSelect(["box"],D.objectToOptions(Hae))});function NKe(e,t,r,n){var a=function FKe(e,t,r){var n=ft.createState(256,128,r),a=Re.getPrincipalAxesMany(e.locis);return Uo.scale(a.momentsAxes,a.momentsAxes,t.scaleFactor),n.currentGroup=0,function SKe(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;S.add(mg,i,o),S.toArray(S.add(mg,i,o),vg,0),S.toArray(S.sub(mg,i,o),vg,3),S.toArray(S.add(mg,i,s),vg,6),S.toArray(S.sub(mg,i,s),vg,9),S.toArray(S.add(mg,i,u),vg,12),S.toArray(S.sub(mg,i,u),vg,15);var c=kS(vg,_Ke),l=Uo.volume(t),d=Math.cbrt(l)/300*r;ft.addCage(e,bKe,c,d,n,a)}(n,a.momentsAxes,t.radiusScale,2,20),ft.getMesh(n)}(t,r,n&&n.geometry),i=function OKe(e){var t=wE(e,{countsOnly:!0});return"Principal Axes of ".concat(t)}(t.locis);return Wr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function LKe(e,t,r,n){var a=function BKe(e,t,r){var n=ft.createState(256,128,r),a=Re.getPrincipalAxesMany(e.locis);return Uo.scale(a.boxAxes,a.boxAxes,t.scaleFactor),n.currentGroup=0,function DKe(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,c=S.negate(CKe,o),l=S.negate(xKe,s),d=S.negate(wKe,u),f=0,p=function(g,y,b){S.copy(ym,i),S.add(ym,ym,g),S.add(ym,ym,y),S.add(ym,ym,b),S.toArray(ym,zae,f),f+=3};p(o,s,u),p(o,s,d),p(o,l,d),p(o,l,u),p(c,l,d),p(c,l,u),p(c,s,u),p(c,s,d);var h=kS(zae,TKe),m=Uo.volume(t),v=Math.cbrt(m)/300*r;ft.addCage(e,AKe,h,v,n,a)}(n,a.boxAxes,t.radiusScale,2,20),ft.getMesh(n)}(t,r,n&&n.geometry),i=function kKe(e){var t=wE(e,{countsOnly:!0});return"Oriented Box of ".concat(t)}(t.locis);return Wr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function zKe(e,t,r,n){var a=function VKe(e,t,r){var n=ft.createState(256,128,r),i=Re.getPrincipalAxesMany(e.locis).boxAxes,o=i.origin,s=i.dirA,u=i.dirB,c=Uo.size(S(),i);S.scale(c,c,.5*t.scaleFactor);var l=S.create(c[2],c[1],c[0]);return n.currentGroup=0,e5(n,o,s,u,l,2),ft.getMesh(n)}(t,r,n&&n.geometry),i=function UKe(e){var t=wE(e,{countsOnly:!0});return"Oriented Ellipsoid of ".concat(t)}(t.locis);return Wr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}var HKe={radius:1,segments:36,thetaStart:0,thetaLength:2*Math.PI};function qae(e){var h,t=R(R({},HKe),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===2*Math.PI,s=o?n+1:n+2,u=new Float32Array(3*s),c=new Float32Array(3*s),l=new Uint32Array(3*n);u[0]=0,u[1]=0,u[2]=0,c[0]=0,c[1]=1,c[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var p=a+d/n*i;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),c[f]=0,c[f+1]=1,c[f+2]=0}for(d=1,f=0;d<n;++d,f+=3)l[f]=d,l[f+1]=d+1,l[f+2]=0;o?(l[h=3*(n-1)]=n,l[h+1]=1,l[h+2]=0):(p=a+i,u[f=3*(n+1)]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),c[f]=0,c[f+1]=1,c[f+2]=0,l[h=3*(n-1)]=n,l[h+1]=n+1,l[h+2]=0);return{vertices:u,normals:c,indices:l}}var Wae={color:D.Color(gr.lightgreen),arcScale:D.Numeric(.7,{min:.01,max:1,step:.01})},Yae=R(R(R({},ca.Params),Wae),{lineSizeAttenuation:D.Boolean(!0),linesSize:D.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:D.Numeric(.04,{min:.01,max:.2,step:.01})}),jKe=R({},Yae),qKe=R({},Yae),WKe=R(R(R({},Lt.Params),Wae),{ignoreLight:D.Boolean(!0),sectorOpacity:D.Numeric(.75,{min:0,max:1,step:.01})}),Xae={vectors:function(e,t){return Zi(KKe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},arc:function(e,t){return Zi(QKe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},sector:function(e,t){return Zi(JKe,Lt.Utils,{modifyProps:function(r){return R(R({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return R(R({},r),{markerActions:Is.Highlighting})}})},text:function(e,t){return Zi(tZe,hc.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Vt.None})}})}},Kae=R(R(R(R(R({},jKe),qKe),WKe),TE),{visuals:D.MultiSelect(["vectors","sector","text"],D.objectToOptions(Xae))}),bm=S(),vC=me();function DE(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,c=e.loci,d=c[1],f=c[2];pr.getBoundingSphere(c[0],n),pr.getBoundingSphere(d,a),pr.getBoundingSphere(f,i),S.sub(o,n.center,a.center),S.sub(s,i.center,a.center),S.cross(u,o,s);var p=Math.min(S.magnitude(o),S.magnitude(s));return t.radius=p*r,t.angle=S.angle(o,s),t}function Zae(e,t){var r=e.radius,n=e.angle,a=t?QY(n,r)/t:32;return me.targetTo(vC,e.sphereB.center,e.sphereA.center,e.arcNormal),me.setTranslation(vC,e.sphereB.center),me.mul(vC,vC,me.rotY180),sB(qae({radius:r,thetaLength:n,segments:a}),vC)}var Yo=function YKe(){return{sphereA:De(),sphereB:De(),sphereC:De(),arcDirA:S(),arcDirC:S(),arcNormal:S(),radius:0,angle:0}}();function EE(e){return 1===e.triples.length?"Angle ".concat(QL(e.triples[0],{measureOnly:!0})):"".concat(e.triples.length," Angles")}function KKe(e,t,r,n){var a=function XKe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.triples.length;a<i;++a)DE(e.triples[a],Yo,t.arcScale),n.addFixedLengthDashes(Yo.sphereB.center,Yo.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Yo.sphereB.center,Yo.sphereC.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=EE(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function QKe(e,t,r,n){var a=function ZKe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.triples.length;a<i;++a){DE(e.triples[a],Yo,t.arcScale);for(var o=Zae(Yo,t.dashLength),s=o.indices,u=o.vertices,c=0,l=s.length;c<l;c+=3)if(c%2!=1){var d=3*s[c],f=3*s[c+1];n.add(u[d],u[d+1],u[d+2],u[f],u[f+1],u[f+2],a)}}return n.getLines()}(t,r,n&&n.geometry),i=EE(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function JKe(e,t,r,n){var a=function $Ke(e,t,r){for(var n=ft.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){DE(e.triples[a],Yo,t.arcScale);var o=Zae(Yo);n.currentGroup=a,ft.addPrimitive(n,me.id,o),ft.addPrimitiveFlipped(n,me.id,o)}return ft.getMesh(n)}(t,r,n&&n.geometry),i=EE(t);return Wr.create(i,t,a,function(){return r.color},function(){return 1},function(s){return QL(t.triples[s])})}function tZe(e,t,r,n){var a=function eZe(e,t,r){for(var n=ff.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){DE(e.triples[a],Yo,t.arcScale),S.add(bm,Yo.arcDirA,Yo.arcDirC),S.setMagnitude(bm,bm,Yo.radius),S.add(bm,Yo.sphereB.center,bm);var o=Ju(Yo.angle).toFixed(2),s=t.customText||"".concat(o,"\xb0"),u=Math.max(2,Yo.sphereA.radius,Yo.sphereB.radius,Yo.sphereC.radius);n.add(s,bm[0],bm[1],bm[2],.1,u/2,a)}return n.getText()}(t,r,n&&n.geometry),i=EE(t);return Wr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},function(s){return QL(t.triples[s])})}var Qae={color:D.Color(gr.lightgreen),arcScale:D.Numeric(.7,{min:.01,max:1,step:.01})},IE=R(R(R({},ca.Params),Qae),{lineSizeAttenuation:D.Boolean(!0),linesSize:D.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:D.Numeric(.04,{min:.01,max:.2,step:.01})}),nZe=R({},IE),aZe=R({},IE),iZe=R({},IE),oZe=R({},IE),sZe=R(R(R({},Lt.Params),Qae),{ignoreLight:D.Boolean(!0),sectorOpacity:D.Numeric(.75,{min:0,max:1,step:.01})}),$ae={vectors:function(e,t){return Zi(lZe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},extenders:function(e,t){return Zi(vZe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},connector:function(e,t){return Zi(fZe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},arms:function(e,t){return Zi(hZe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},arc:function(e,t){return Zi(yZe,ca.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},sector:function(e,t){return Zi(_Ze,Lt.Utils,{modifyProps:function(r){return R(R({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return R(R({},r),{markerActions:Is.Highlighting})}})},text:function(e,t){return Zi(CZe,hc.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Vt.None})}})}},Jae=R(R(R(R(R(R(R({},nZe),aZe),iZe),oZe),sZe),TE),{visuals:D.MultiSelect(["extenders","arms","sector","text"],D.objectToOptions($ae))}),Ms=S(),gC=me();function gg(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,c=t.projA,l=t.projD,d=t.arcPointA,f=t.arcPointD,p=t.arcDirA,h=t.arcDirD,m=t.arcCenter,v=t.arcNormal,g=e.loci,b=g[1],_=g[2],C=g[3];pr.getBoundingSphere(g[0],n),pr.getBoundingSphere(b,a),pr.getBoundingSphere(_,i),pr.getBoundingSphere(C,o),S.add(m,a.center,i.center),S.scale(m,m,.5),S.sub(s,n.center,a.center),S.sub(u,o.center,i.center),S.add(d,m,s),S.add(f,m,u),S.sub(v,i.center,a.center),S.orthogonalize(p,v,s),S.orthogonalize(h,v,u),S.projectPointOnVector(c,d,p,m),S.projectPointOnVector(l,f,h,m);var A=Math.min(S.distance(c,m),S.distance(l,m))*r;S.setMagnitude(p,p,A),S.setMagnitude(h,h,A),S.add(d,m,p),S.add(f,m,h),t.radius=A,t.angle=S.dihedralAngle(n.center,a.center,i.center,o.center),S.matchDirection(Ms,v,S.sub(Ms,d,n.center));var T=S.angle(s,Ms),w=A/Math.cos(T-m2);S.add(c,a.center,S.setMagnitude(Ms,s,w)),S.matchDirection(Ms,v,S.sub(Ms,f,o.center));var E=S.angle(u,Ms),I=A/Math.cos(E-m2);return S.add(l,i.center,S.setMagnitude(Ms,u,I)),t}function eie(e,t){var r=e.radius,n=e.angle,a=t?QY(n,r)/t:32;return me.targetTo(gC,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),me.setTranslation(gC,e.arcCenter),me.mul(gC,gC,me.rotY180),sB(qae({radius:r,thetaLength:Math.abs(n),segments:a}),gC)}var Yn=function uZe(){return{sphereA:De(),sphereB:De(),sphereC:De(),sphereD:De(),dirBA:S(),dirCD:S(),projA:S(),projD:S(),arcPointA:S(),arcPointD:S(),arcDirA:S(),arcDirD:S(),arcCenter:S(),arcNormal:S(),radius:0,angle:0}}();function yg(e){return 1===e.quads.length?"Dihedral ".concat($L(e.quads[0],{measureOnly:!0})):"".concat(e.quads.length," Dihedrals")}function lZe(e,t,r,n){var a=function cZe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gg(e.quads[a],Yn,t.arcScale),n.addFixedLengthDashes(Yn.arcCenter,Yn.arcPointA,t.dashLength,a),n.addFixedLengthDashes(Yn.arcCenter,Yn.arcPointD,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function fZe(e,t,r,n){var a=function dZe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gg(e.quads[a],Yn,t.arcScale),n.addFixedLengthDashes(Yn.sphereB.center,Yn.sphereC.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function hZe(e,t,r,n){var a=function pZe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gg(e.quads[a],Yn,t.arcScale),n.addFixedLengthDashes(Yn.sphereB.center,Yn.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Yn.sphereC.center,Yn.sphereD.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function vZe(e,t,r,n){var a=function mZe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.quads.length;a<i;++a)gg(e.quads[a],Yn,t.arcScale),n.addFixedLengthDashes(Yn.arcPointA,Yn.projA,t.dashLength,a),n.addFixedLengthDashes(Yn.arcPointD,Yn.projD,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function yZe(e,t,r,n){var a=function gZe(e,t,r){for(var n=Ru.create(128,64,r),a=0,i=e.quads.length;a<i;++a){gg(e.quads[a],Yn,t.arcScale);for(var o=eie(Yn,t.dashLength),s=o.indices,u=o.vertices,c=0,l=s.length;c<l;c+=3)if(c%2!=1){var d=3*s[c],f=3*s[c+1];n.add(u[d],u[d+1],u[d+2],u[f],u[f+1],u[f+2],a)}}return n.getLines()}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function _Ze(e,t,r,n){var a=function bZe(e,t,r){for(var n=ft.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){gg(e.quads[a],Yn,t.arcScale);var o=eie(Yn);n.currentGroup=a,ft.addPrimitive(n,me.id,o),ft.addPrimitiveFlipped(n,me.id,o)}return ft.getMesh(n)}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.color},function(){return 1},function(s){return $L(t.quads[s])})}function CZe(e,t,r,n){var a=function SZe(e,t,r){for(var n=ff.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){gg(e.quads[a],Yn,t.arcScale),S.add(Ms,Yn.arcDirA,Yn.arcDirD),S.setMagnitude(Ms,Ms,Yn.radius),S.add(Ms,Yn.arcCenter,Ms);var o=Ju(Yn.angle).toFixed(2);"-0.00"===o&&(o="0.00");var s=t.customText||"".concat(o,"\xb0"),u=Math.max(2,Yn.sphereA.radius,Yn.sphereB.radius,Yn.sphereC.radius,Yn.sphereD.radius);n.add(s,Ms[0],Ms[1],Ms[2],.1,u/2,a)}return n.getText()}(t,r,n&&n.geometry),i=yg(t);return Wr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},function(s){return $L(t.quads[s])})}var wZe=kt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ve.Root,to:ve.Shape.Provider,params:{bottomLeft:D.Vec3(S()),topRight:D.Vec3(S.create(1,1,1)),radius:D.Numeric(.15,{min:.01,max:4,step:.01}),color:D.Color(gr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return Ve.create("Shape Representation",function(n){return ce(t,void 0,void 0,function(){return le(this,function(a){return[2,new ve.Shape.Provider({label:"Box",data:r,params:Lt.Params,getShape:function(i,o){var s=r5(Nt.create(r.bottomLeft,r.topRight),r.radius);return Wr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Lt.Utils},{label:"Box"})]})})})}});function r5(e,t,r){var n=S.sub(S(),e.max,e.min),a=me.fromTranslation(me(),S.create(.5,.5,.5)),i=me.fromScaling(me(),n),o=me.fromTranslation(me(),e.min),s=me.mul3(me(),o,i,a),u=ft.createState(256,128,r);u.currentGroup=1,ft.addCage(u,s,lte(),t,2,20);var c=ft.getMesh(u),l=S.scaleAndAdd(S(),e.min,n,.5),d=S.distance(e.min,l);return c.setBoundingSphere(De.create(l,d)),c}var tie={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};new Uint32Array([0,1,2,3,3,1,2,0]);var DZe=R(R({},Lt.Params),{color:D.Color(gr.orange),scaleFactor:D.Numeric(1,{min:.1,max:10,step:.1})}),rie={plane:function(e,t){return Zi(PZe,Lt.Utils)}},nie=R(R({},DZe),{visuals:D.MultiSelect(["plane"],D.objectToOptions(rie))}),_m=me(),n5=S();function PZe(e,t,r,n){var a=function IZe(e,t,r){var n=ft.createState(256,128,r),i=Re.getPrincipalAxesMany(e.locis).boxAxes,o=function TZe(){return tie}();return S.add(n5,i.origin,i.dirC),me.targetTo(_m,n5,i.origin,i.dirB),me.scale(_m,_m,Uo.size(n5,i)),me.scaleUniformly(_m,_m,t.scaleFactor),me.setTranslation(_m,i.origin),n.currentGroup=0,ft.addPrimitive(n,_m,o),ft.addPrimitiveFlipped(n,_m,o),ft.getMesh(n)}(t,r,n&&n.geometry),i=function EZe(e){var t=wE(e,{countsOnly:!0});return"Best Fit Plane of ".concat(t)}(t.locis);return Wr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}var pf,PE=kt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ve.Molecule.Structure,to:ve.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(c){var d=c.params,p=a.colorThemeRegistry.get(c.name).factory({},d);return{description:p.description,legend:p.legend}}};return{type:D.Mapped(n.default.name,n.types,function(c){return D.Group(n.get(c).getParams(a,Ye.Empty))}),colorTheme:D.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(c){return D.Group(a.colorThemeRegistry.get(c).getParams({structure:Ye.Empty}))},o),sizeTheme:D.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(c){return D.Group(a.sizeThemeRegistry.get(c).getParams({structure:Ye.Empty}))})}}var s={structure:e.data},u={help:function(c){var d=c.params,p=a.colorThemeRegistry.get(c.name).factory(s,d);return{description:p.description,legend:p.legend}}};return{type:D.Mapped(n.default.name,n.getApplicableTypes(e.data),function(c){return D.Group(n.get(c).getParams(a,e.data))}),colorTheme:D.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(c){return D.Group(a.colorThemeRegistry.get(c).getParams(s))},u),sizeTheme:D.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(s),function(c){return D.Group(a.sizeThemeRegistry.get(c).getParams(s))})}}})({canAutoUpdate:function(e){var n=e.newParams;return e.a.data.elementCount<1e4||e.oldParams.type.name===n.type.name&&"custom"!==n.type.params.quality},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Representation",function(o){return ce(r,void 0,void 0,function(){var s,u,c,l,f,p;return le(this,function(h){switch(h.label){case 0:return s={runtime:o,assetManager:t.managers.asset},u=t.representation.structure.registry.get(a.type.name),c=(null===(f=u.getData)||void 0===f?void 0:f.call(u,n.data,a.type.params))||n.data,u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(s,c)]:[3,2];case 1:h.sent(),h.label=2;case 2:return l=u.factory(R({webgl:null===(p=t.canvas3d)||void 0===p?void 0:p.webgl},t.representation.structure.themes),u.getParams),[4,Oi.ensureDependencies(s,t.representation.structure.themes,{structure:c},a)];case 3:return h.sent(),l.setTheme(Oi.create(t.representation.structure.themes,{structure:c},a)),[4,l.createOrUpdate(a.type.params||{},c).runInContext(o)];case 4:return h.sent(),[2,new ve.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:u.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Ve.create("Structure Representation",function(u){return ce(r,void 0,void 0,function(){var c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return o.type.name!==i.type.name?[2,rt.UpdateResult.Recreate]:(c=t.representation.structure.registry.get(o.type.name),null!==(p=c.mustRecreate)&&void 0!==p&&p.call(c,i.type.params,o.type.params)?[2,rt.UpdateResult.Recreate]:(l=(null===(h=c.getData)||void 0===h?void 0:h.call(c,n.data,o.type.params))||n.data,d={runtime:u,assetManager:t.managers.asset},c.ensureCustomProperties?[4,c.ensureCustomProperties.attach(d,l)]:[3,2]));case 1:m.sent(),m.label=2;case 2:return Oi.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,Oi.ensureDependencies(d,t.representation.structure.themes,{structure:l},o)];case 3:return m.sent(),a.data.repr.setTheme(Oi.create(t.representation.structure.themes,{structure:l},o)),f=R(R({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(f,l).runInContext(u)];case 4:return m.sent(),a.data.sourceData=n.data,[2,rt.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(r&&n){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),Oi.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if("uniform"!==e.colorTheme.name||"uniform"!==t.colorTheme.name)return r<=.5?e:t;var i=dt.interpolate(e.colorTheme.params.value,t.colorTheme.params.value,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),RZe=kt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:{t:D.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new wb(n);return mae(n,a,r.t),new ve.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new wb(n)},info:n,repr:t.data.repr},{label:"Unwind T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info;return t.data.sourceData!==i||t.data.repr!==r.data.repr?rt.UpdateResult.Recreate:e.oldParams.t===n.t?rt.UpdateResult.Unchanged:(mae(i,r.data.state.unitTransforms,n.t),r.label="Unwind T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,rt.UpdateResult.Updated)}}),OZe=kt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:{t:D.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new wb(n);return gae(n,a,r.t,n.root.boundary.sphere),new ve.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new wb(n)},info:n,repr:t.data.repr},{label:"Explode T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=t.data.sourceData;return r.data.info!==i||t.data.repr!==r.data.repr?rt.UpdateResult.Recreate:e.oldParams.t===n.t?rt.UpdateResult.Unchanged:(gae(i,r.data.state.unitTransforms,n.t,i.root.boundary.sphere),r.label="Explode T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,rt.UpdateResult.Updated)}}),FZe=kt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:R({t:D.Numeric(0,{min:0,max:1,step:.01})},jXe)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new wb(n),i=yae(n.root,r);return Sae(n,a,r.t,i.axis,i.origin),new ve.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new wb(n)},info:n,repr:t.data.repr},{label:"Spin T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return rt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=yae(i.root,n);return Sae(i,o,n.t,s.axis,s.origin),r.label="Spin T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,rt.UpdateResult.Updated}}),NZe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({script:D.Script(Mi("(sel.atom.all)","mol-script")),color:D.Color(gr.blueviolet),clear:D.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":dt.toRgbString(e.color))},{defaultValue:[{script:Mi("(sel.atom.all)","mol-script"),color:gr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Fi.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Fi.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&xp(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.overpaint,c=Fi.ofScript(n.layers,o);return Fi.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.overpaint=c,r.data.repr=t.data.repr,r.label="Overpaint (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),kZe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({bundle:D.Value(en.Empty),color:D.Color(gr.blueviolet),clear:D.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":dt.toRgbString(e.color))},{defaultValue:[{bundle:en.Empty,color:gr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Fi.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Fi.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&xp(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.overpaint,c=Fi.ofBundle(n.layers,o);return Fi.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.overpaint=c,r.data.repr=t.data.repr,r.label="Overpaint (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),BZe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({script:D.Script(Mi("(sel.atom.all)","mol-script")),value:D.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{script:Mi("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=jo.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:jo.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&xp(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.transparency,c=jo.ofScript(n.layers,o);return jo.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.transparency=c,r.data.repr=t.data.repr,r.label="Transparency (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),LZe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({bundle:D.Value(en.Empty),value:D.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{bundle:en.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=jo.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:jo.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&xp(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.transparency,c=jo.ofBundle(n.layers,o);return jo.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.transparency=c,r.data.repr=t.data.repr,r.label="Transparency (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),UZe=kt.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({script:D.Script(Mi("(sel.atom.all)","mol-script")),material:_s.getParam(),clear:D.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":_s.toString(e.material))},{defaultValue:[{script:Mi("(sel.atom.all)","mol-script"),material:_s({roughness:1}),clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=qo.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:qo.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&xp(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.substance,c=qo.ofScript(n.layers,o);return qo.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.substance=c,r.data.repr=t.data.repr,r.label="Substance (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),VZe=kt.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({bundle:D.Value(en.Empty),material:_s.getParam(),clear:D.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":_s.toString(e.material))},{defaultValue:[{bundle:en.Empty,material:_s({roughness:1}),clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=qo.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:qo.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&xp(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.substance,c=qo.ofBundle(n.layers,o);return qo.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.substance=c,r.data.repr=t.data.repr,r.label="Substance (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),zZe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({script:D.Script(Mi("(sel.atom.all)","mol-script")),groups:D.Converted(function(e){return Wn.Groups.toNames(e)},function(e){return Wn.Groups.fromNames(e)},D.MultiSelect(qA(Wn.Groups.Names),D.objectToOptions(Wn.Groups.Names)))},function(e){return"".concat(Wn.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{script:Mi("(sel.atom.all)","mol-script"),groups:Wn.Groups.Flag.None}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=Wn.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:Wn.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var o=r.data.state.clipping,s=Wn.ofScript(e.newParams.layers,i);return Wn.areEqual(o,s)?rt.UpdateResult.Unchanged:(r.data.state.clipping=s,r.data.repr=t.data.repr,r.label="Clipping (".concat(s.layers.length," Layers)"),rt.UpdateResult.Updated)}}),GZe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:D.ObjectList({bundle:D.Value(en.Empty),groups:D.Converted(function(e){return Wn.Groups.toNames(e)},function(e){return Wn.Groups.fromNames(e)},D.MultiSelect(qA(Wn.Groups.Names),D.objectToOptions(Wn.Groups.Names)))},function(e){return"".concat(Wn.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{bundle:en.Empty,groups:Wn.Groups.Flag.None}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=Wn.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:Wn.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var o=r.data.state.clipping,s=Wn.ofBundle(e.newParams.layers,i);return Wn.areEqual(o,s)?rt.UpdateResult.Unchanged:(r.data.state.clipping=s,r.data.repr=t.data.repr,r.label="Clipping (".concat(s.layers.length," Layers)"),rt.UpdateResult.Updated)}}),HZe=kt.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{overpaintStrength:D.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:D.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:D.Numeric(1,{min:0,max:1,step:.01})}}})({canAutoUpdate:function(){return!0},apply:function(e){var r=e.params;return new ve.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:r.overpaintStrength,transparency:r.transparencyStrength,substance:r.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,substance:1}},info:{},repr:e.a.data.repr},{label:"Theme Strength",description:"".concat(r.overpaintStrength.toFixed(2),", ").concat(r.transparencyStrength.toFixed(2),", ").concat(r.substanceStrength.toFixed(2))})},update:function(e){var t,r,n,a=e.a,i=e.b,o=e.newParams;return o.overpaintStrength===(null===(t=i.data.state.themeStrength)||void 0===t?void 0:t.overpaint)&&o.transparencyStrength===(null===(r=i.data.state.themeStrength)||void 0===r?void 0:r.transparency)&&o.substanceStrength===(null===(n=i.data.state.themeStrength)||void 0===n?void 0:n.substance)?rt.UpdateResult.Unchanged:(i.data.state.themeStrength={overpaint:o.overpaintStrength,transparency:o.transparencyStrength,substance:o.substanceStrength},i.data.repr=a.data.repr,i.label="Theme Strength",i.description="".concat(o.overpaintStrength.toFixed(2),", ").concat(o.transparencyStrength.toFixed(2),", ").concat(o.substanceStrength.toFixed(2)),rt.UpdateResult.Updated)},interpolate:function(e,t,r){return{overpaintStrength:oa(e.overpaintStrength,t.overpaintStrength,r),transparencyStrength:oa(e.transparencyStrength,t.transparencyStrength,r),substanceStrength:oa(e.substanceStrength,t.substanceStrength,r)}}});!function(e){e.getDefaultParams=function t(a,i,o,s,u,c,l,d){var f=a.representation.volume.registry.get(i),p=a.representation.volume.themes.colorThemeRegistry.get(u||f.defaultColorTheme.name),h=a.representation.volume.themes.sizeThemeRegistry.get(l||f.defaultSizeTheme.name),m=D.getDefaultValues(f.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?R(R({},m),s):m},colorTheme:{name:p.name,params:c?R(R({},p.defaultValues),c):p.defaultValues},sizeTheme:{name:h.name,params:d?R(R({},h.defaultValues),d):h.defaultValues}}},e.getDefaultParamsStatic=function r(a,i,o,s,u,c,l){var d=a.representation.volume.registry.get(i),f=a.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),p=a.representation.volume.themes.sizeThemeRegistry.get(c||d.defaultSizeTheme.name);return{type:{name:i,params:o?R(R({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?R(R({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:l?R(R({},p.defaultValues),l):p.defaultValues}}},e.getDescription=function n(a){var i,o,s,u;return a.isoValue?nt.IsoValue.toString(a.isoValue):null!==(o=null===(i=a.renderMode)||void 0===i?void 0:i.params)&&void 0!==o&&o.isoValue?nt.IsoValue.toString(null===(u=null===(s=a.renderMode)||void 0===s?void 0:s.params)||void 0===u?void 0:u.isoValue):void 0}}(pf||(pf={}));var jZe=kt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ve.Volume.Data,to:ve.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:D.Mapped(n.default.name,n.types,function(s){return D.Group(n.get(s).getParams(a,nt.One))}),colorTheme:D.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return D.Group(a.colorThemeRegistry.get(s).getParams({volume:nt.One}))}),sizeTheme:D.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return D.Group(a.sizeThemeRegistry.get(s).getParams({volume:nt.One}))})};var o={volume:e.data};return{type:D.Mapped(n.default.name,n.types,function(s){return D.Group(n.get(s).getParams(a,e.data))}),colorTheme:D.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return D.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:D.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(o),function(s){return D.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){return e.oldParams.type.name===e.newParams.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Volume Representation",function(i){return ce(r,void 0,void 0,function(){var o,s,u,c,l;return le(this,function(d){switch(d.label){case 0:return o={runtime:i,assetManager:t.managers.asset},(s=t.representation.volume.registry.get(a.type.name)).ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return(u=s.factory(R({webgl:null===(l=t.canvas3d)||void 0===l?void 0:l.webgl},t.representation.volume.themes),s.getParams)).setTheme(Oi.create(t.representation.volume.themes,{volume:n.data},a)),[4,u.createOrUpdate(c=a.type.params||{},n.data).runInContext(i)];case 3:return d.sent(),[2,new ve.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:pf.getDescription(c)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Ve.create("Volume Representation",function(s){return ce(r,void 0,void 0,function(){var u,c,l;return le(this,function(d){switch(d.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),null===(l=u.ensureCustomProperties)||void 0===l||l.detach(n.data),[2,rt.UpdateResult.Recreate]):(c=R(R({},a.data.repr.props),o.type.params),a.data.repr.setTheme(Oi.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(c,n.data).runInContext(s)]);case 1:return d.sent(),a.data.sourceData=n.data,a.description=pf.getDescription(c),[2,rt.UpdateResult.Updated]}})})})}}),qZe=kt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ve.Shape.Provider,to:ve.Shape.Representation3D,params:function(e,t){return e?e.data.params:ot.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Shape Representation",function(i){return ce(r,void 0,void 0,function(){var o,s;return le(this,function(u){switch(u.label){case 0:return o=R(R({},D.getDefaultValues(n.data.params)),a),[4,(s=Zi(n.data.getShape,n.data.geometryUtils)).createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Shape Representation",function(s){return ce(r,void 0,void 0,function(){var u;return le(this,function(c){switch(c.label){case 0:return u=R(R({},a.data.repr.props),o),[4,a.data.repr.createOrUpdate(u,n.data.data).runInContext(s)];case 1:return c.sent(),a.data.sourceData=n.data,[2,rt.UpdateResult.Updated]}})})})}}),WZe=kt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ve.Molecule.Model,to:ve.Shape.Representation3D,params:function(){return R({},xae)}})({isApplicable:function(e){return!!ei.Provider.get(e.data)},canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Model Unit Cell",function(i){return ce(r,void 0,void 0,function(){var o,s,u,c;return le(this,function(l){switch(l.label){case 0:return(o=ei.Provider.get(n.data))?(s=wae(n.data,o,a),u=function JXe(e,t){return dr.createMulti("Unit Cell",e,t,dr.StateBuilder,ZXe)}(R({webgl:null===(c=t.canvas3d)||void 0===c?void 0:c.webgl},t.representation.structure.themes),function(){return xae}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,ua.Null];case 1:return l.sent(),[2,new ve.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return Ve.create("Model Unit Cell",function(i){return ce(t,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return(o=ei.Provider.get(r.data))?(s=R(R({},n.data.repr.props),a),u=wae(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,rt.UpdateResult.Null];case 1:return c.sent(),n.data.sourceData=u,[2,rt.UpdateResult.Updated]}})})})}}),YZe=kt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ve.Molecule.Structure,to:ve.Shape.Representation3D,params:R({radius:D.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:D.Color(gr.red,{isEssential:!0})},Lt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Bounding Box",function(i){return ce(r,void 0,void 0,function(){var o;return le(this,function(s){switch(s.label){case 0:return[4,(o=Zi(function(u,c,l,d){var f=r5(c.box,c.radius,d?.geometry);return Wr.create("Bouding Box",c,f,function(){return c.color},function(){return 1},function(){return"Bounding Box"})},Lt.Utils)).createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new ve.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Bounding Box",function(s){return ce(r,void 0,void 0,function(){return le(this,function(u){switch(u.label){case 0:return[4,a.data.repr.createOrUpdate(o,{box:n.data.boundary.box,radius:o.radius,color:o.color}).runInContext(s)];case 1:return u.sent(),a.data.sourceData=n.data,[2,rt.UpdateResult.Updated]}})})})}}),XZe=kt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},Pae)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Distance",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return o=Oae(n.data),s=function fKe(e,t){return dr.createMulti("Distance",e,t,dr.StateBuilder,Iae)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return Pae}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Distance",function(s){return ce(r,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=Oae(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),KZe=kt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},Kae)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Angle",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return o=Fae(n.data),s=function rZe(e,t){return dr.createMulti("Angle",e,t,dr.StateBuilder,Xae)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return Kae}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Angle",function(s){return ce(r,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=Fae(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),ZZe=kt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},Jae)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Dihedral",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return o=Nae(n.data),s=function xZe(e,t){return dr.createMulti("Dihedral",e,t,dr.StateBuilder,$ae)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return Jae}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Dihedral",function(s){return ce(r,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=Nae(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),QZe=kt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},Vae)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Label",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return o=kae(n.data),s=function yKe(e,t){return dr.createMulti("Label",e,t,dr.StateBuilder,Uae)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return Vae}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Label",function(s){return ce(r,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=kae(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),$Ze=kt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},jae)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Orientation",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return o=Bae(n.data),s=function GKe(e,t){var r=dr.createMulti("Orientation",e,t,dr.StateBuilder,Hae);return r.setState({markerActions:Is.Highlighting}),r}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return jae}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Orientation",function(s){return ce(r,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=Bae(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),JZe=kt.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},nie)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Plane",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return o=Lae(n.data),s=function MZe(e,t){var r=dr.createMulti("Plane",e,t,dr.StateBuilder,rie);return r.setState({markerActions:Is.Highlighting}),r}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return nie}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Plane"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Plane",function(s){return ce(r,void 0,void 0,function(){var u,c;return le(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=Lae(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),et={Data:X3,Misc:K3,Model:Z3,Volume:Q3,Representation:J3,Shape:$3};function ta(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=Gn.create22(),e}var eQe=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||this.subs.set(t.id,a=[]),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){n.disposing?i("disposed"):n.subs.get(t.id)?n.resolve({cmd:t,params:r,resolve:a,reject:i}):a()})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ce(this,void 0,void 0,function(){var r,n,a,o;return le(this,function(s){switch(s.label){case 0:if(!(r=this.subs.get(t.cmd.id)))return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?[4,(0,a[n])(t.params)]:[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),Sr={State:{SetCurrentObject:ta(),ApplyAction:ta(),Update:ta(),RemoveObject:ta(),ToggleExpanded:ta(),ToggleVisibility:ta(),Snapshots:{Add:ta(),Replace:ta(),Move:ta(),Remove:ta(),Apply:ta(),Clear:ta(),Upload:ta(),Fetch:ta(),DownloadToFile:ta(),OpenFile:ta(),OpenUrl:ta()}},Interactivity:{Object:{Highlight:ta()},Structure:{Highlight:ta(),Select:ta()},ClearHighlights:ta()},Layout:{Update:ta()},Toast:{Show:ta(),Hide:ta()},Camera:{Reset:ta(),SetSnapshot:ta(),Focus:ta(),OrientAxes:ta(),ResetAxes:ta()},Canvas3D:{SetSettings:ta(),ResetSettings:ta()}},tQe=vp.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],n=0,a=e.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Structure));n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:D.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:D.Boolean(!1),target:D.Select(t[0][0],t)}},canApply:function(e){return{canApply:e.state.data.select(wr.Generators.ofType(ve.Molecule.Structure.Representation3D,ln.RootRef)).length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,i=n.select(wr.Generators.ofType(ve.Molecule.Structure.Representation3D,e.target&&"all"!==e.target?e.target:ln.RootRef)),o=n.build(),s=!1,u=0,c=i;u<c.length;u++){var l=c[u];n.select(wr.Generators.ofTransformer(et.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref)).length>0||(s=!0,o.to(l).apply(et.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(wr.Generators.ofType(ve.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(0!==a.length){for(var i=n.build(),o=0,s=a;o<s.length;o++)i.delete(s[o].transform.ref);return i.commit()}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,o,u,c,l,d;return le(this,function(p){switch(p.label){case 0:if(0===(i=(n=r.plugin.state.data).select(wr.Generators.ofTransformer(et.Representation.UnwindStructureAssemblyRepresentation3D,r.params.target&&"all"!==r.params.target?r.params.target:ln.RootRef))).length)return[2,{kind:"finished"}];for(o=n.build(),u=e.t+(t.current-t.lastApplied)/r.params.durationInMs,c=!1,r.params.playOnce&&u>=1?(c=!0,u=1):u%=1,l=0,d=i;l<d.length;l++)o.to(d[l]).update({t:u});return[4,Sr.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return p.sent(),c?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),ME=S(),aie=S(),iie=yn(),rQe=vp.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:D.Numeric(4e3,{min:100,max:2e4,step:100}),speed:D.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:D.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:null===(r=t.canvas3d)||void 0===r?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;null===(n=r.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s,u;return le(this,function(c){return 0===t.current?[2,{kind:"next",state:e}]:(i=e.snapshot).radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?(null===(n=t.animation)||void 0===n?void 0:n.currentFrame)/(t.animation.frameCount+1):ao(t.current/r.params.durationInMs,0,1),s=2*Math.PI*o*r.params.speed*("ccw"===r.params.direction?-1:1),S.sub(ME,i.position,i.target),S.normalize(aie,i.up),yn.setAxisAngle(iie,aie,s),S.transformQuat(ME,ME,iie),u=S.add(S(),i.target,ME),null===(a=r.plugin.canvas3d)||void 0===a||a.requestCameraReset({snapshot:R(R({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}])})})}}),nQe=vp.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:D.MappedStatic("loop",{palindrome:D.Group({}),loop:D.Group({direction:D.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:D.Group({direction:D.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:D.MappedStatic("fixed",{fixed:D.Group({durationInS:D.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:D.Group({targetFps:D.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:D.Group({maxFps:D.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,n=0,a=t.select(wr.Generators.ofTransformer(et.Model.ModelFromTrajectory));n<a.length;n++){var o=wr.findAncestorOfType(t.tree,t.cells,a[n].transform.ref,ve.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if("fixed"===(null===(r=e.duration)||void 0===r?void 0:r.name))return{kind:"fixed",durationMs:1e3*e.duration.params.durationInS};if("computed"===e.duration.name){for(var n=t.state.data,i=0,o=0,s=n.select(wr.Generators.ofTransformer(et.Model.ModelFromTrajectory));o<s.length;o++){var c=wr.findAncestorOfType(n.tree,n.cells,s[o].transform.ref,ve.Molecule.Trajectory);c&&c.obj&&(i=Math.max(Math.ceil(1e3*c.obj.data.frameCount/e.duration.params.targetFps),i))}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f;return le(this,function(h){switch(h.label){case 0:if("sequential"===r.params.duration.name&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(0===(a=(n=r.plugin.state.data).select(wr.Generators.ofTransformer(et.Model.ModelFromTrajectory))).length)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,c=!0,l=function(m){var v=wr.findAncestorOfType(n.tree,n.cells,m.transform.ref,ve.Molecule.Trajectory);if(!v||!v.obj)return"continue";var g=v.obj;if(g.data.frameCount<=1)return"continue";i.to(m).update(function(y){var b=g.data.frameCount;if(1===b)return y;if(c=!1,"sequential"===o.duration.name){var _=1;if("once"===o.mode.name){if(-1==(_="backward"===o.mode.params.direction?-1:1)&&0===y.modelIndex||1===_&&y.modelIndex===b-1)return u=!0,y}else"palindrome"===o.mode.name&&(_=0===y.modelIndex?1:y.modelIndex===b-1?-1:s[m.transform.ref]||1);return s[m.transform.ref]=_,(C=(y.modelIndex+_)%b)<0&&(C+=b),u=u||-1===_&&0===C||1===_&&C===b-1,{modelIndex:C}}var x="fixed"===o.duration.name?1e3*o.duration.params.durationInS:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps);if("once"===o.mode.name&&t.current>=x)return u=!0,{modelIndex:g.data.frameCount-1};var C,A=t.current%x/x;return"loop"===o.mode.name&&"backward"===o.mode.params.direction&&(A=1-A),"palindrome"===o.mode.name&&(A*=2)>1&&(A=2-A),{modelIndex:C=Math.min(Math.floor(g.data.frameCount*A),g.data.frameCount-1)}})},d=0,f=a;d<f.length;d++)l(f[d]);return c?[3,2]:[4,Sr.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:h.sent(),h.label=2;case 2:return c||"once"===o.mode.name&&u?[2,{kind:"finished"}]:"palindrome"===o.mode.name?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function oie(e,t,r){var n;return void 0===r&&(r=!1),ce(this,void 0,void 0,function(){return le(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&(null===(n=e.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||"instant"===t.snapshot.camera.transitionStyle?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var nn,aQe=vp.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!r?.snapshot.startAnimation})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);oie(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+(null!==(a=n.snapshot.durationInMs)&&void 0!==a?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+(null!==(i=a.snapshot.durationInMs)&&void 0!==i?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s;return le(this,function(c){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(a+=null!==(n=s[o].snapshot.durationInMs)&&void 0!==n?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(oie(r.plugin,e.snapshots[i]),[2,{kind:"next",state:R(R({},e),{currentIndex:i})}])})})}});!function(e){var t=function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return qt(d,l),d}(ve.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return qt(d,l),d}(ve.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return qt(d,l),d}(ve.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=kt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:D.Text("",{isHidden:!0})}})({apply:function(l){return new r({},{label:l.params.label})}});var a=new Map;e.getCategoryId=function i(l){return a.get(l.id)},e.create=function o(l){var d=kt.CreateBuiltIn({name:l.name,display:l.display,from:[t],to:[n],params:l.params,apply:function(f,p){var h=f.params,m=l.label?l.label(h):{label:l.display.name,description:l.display.description};return new n(new l.ctor(p,h),m)},update:function(f){var p=this,h=f.b,m=f.newParams;return Ve.create("Update Behavior",function(){return ce(p,void 0,void 0,function(){return le(this,function(g){switch(g.label){case 0:return h.data.update?[4,h.data.update(m)]:[2,rt.UpdateResult.Unchanged];case 1:return[2,g.sent()?rt.UpdateResult.Updated:rt.UpdateResult.Unchanged]}})})})},canAutoUpdate:l.canAutoUpdate});return a.set(d.id,l.category),d},e.simpleCommandHandler=function s(l,d){return function(){function f(p){this.ctx=p,this.sub=void 0}return f.prototype.register=function(){var p=this;this.sub=l.subscribe(this.ctx,function(h){return d(h,p.ctx)})},f.prototype.dispose=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()};var u=function(){function l(d,f){this.ctx=d,this.params=f,this.subs=[]}return l.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},l.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},l.prototype.track=function(d){this.subs.push(d)},l.prototype.dispose=function(){for(var d=0,f=this.subs;d<f.length;d++)f[d].unsubscribe();this.subs=[]},l.prototype.update=function(d){return!GA(d,this.params)&&(this.params=d,!0)},l}();e.Handler=u;var c=function(){function l(d,f){this.plugin=d,this.params=f,this.subs=[]}return l.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},l.prototype.subscribeObservable=function(d,f){var p=this,h=d.subscribe(f);return this.subs.push(h),{unsubscribe:function(){var m=p.subs.indexOf(h);m>=0&&(p.subs.splice(m,1),h.unsubscribe())}}},l.prototype.dispose=function(){for(var d=0,f=this.subs;d<f.length;d++)f[d].unsubscribe();this.subs=[]},l}();e.WithSubscribers=c}(nn||(nn={}));var yC=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&Tv(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=bp.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++)r[t].unsubscribe();this.subs=void 0}},e}(),Zp=function(e){function t(r){var n=e.call(this)||this;return n._state=r,n}return qt(t,e),t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=function nX(e,t){for(var r=e,n=0;n<t.length;n++)if(t[n]&&(r=JDe(e,t[n]))!==e){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}(a,r);return i!==a&&(this._state=i,!0)},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(yC),iQe=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1704560431276);function i5(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):function uQe(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),c=0,l=0;l<o;++l)u[l]=a.charCodeAt(c++)|a.charCodeAt(c++)<<8|a.charCodeAt(c++)<<16|a.charCodeAt(c++)<<24;for(var d=3&i;d--;)s[c]=a.charCodeAt(c++);t(new Blob([s],{type:r||"image/png"}))}(e,o,t,r)})]})})}var Eb=function(e){function t(r){var n=e.call(this,{current:void 0,entries:yp(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.defaultSnapshotId=void 0,n.events={changed:n.ev(),opened:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ce(n,void 0,void 0,function(){var a,i,o;return le(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,(a=this.getNextId(this.state.current,1))&&a!==this.state.current?(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]):(this.stop(),[2]);case 1:return s.sent(),o=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return qt(t,e),t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);n&&(n?.image&&this.plugin.managers.asset.delete(n.image),this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next(void 0))},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next(void 0)},t.prototype.replace=function(r,n,a){var i,o,s,u=this.getEntry(r);if(u){this.defaultSnapshotId=void 0,u?.image&&this.plugin.managers.asset.delete(u.image);var c=this.getIndex(u),l=t.Entry(n,{key:null!==(i=a?.key)&&void 0!==i?i:u.key,name:null!==(o=a?.name)&&void 0!==o?o:u.name,description:null!==(s=a?.description)&&void 0!==s?s:u.description,image:a?.image});this.entryMap.set(n.id,l),this.updateState({current:l.snapshot.id,entries:this.state.entries.set(c,l)}),this.events.changed.next(void 0)}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),c=this.state.entries.asMutable();c.set(s,i),c.set(o,u),this.updateState({current:i.snapshot.id,entries:c.asImmutable()}),this.events.changed.next(void 0)}}},t.prototype.update=function(r,n){var a,i,o,s=this.getIndex(r);if(!(s<0)){var u=this.state.entries.set(s,R(R({},r),{key:(null===(a=n.key)||void 0===a?void 0:a.trim())||void 0,name:(null===(i=n.name)||void 0===i?void 0:i.trim())||void 0,description:(null===(o=n.description)||void 0===o?void 0:o.trim())||void 0}));this.updateState({entries:u}),this.entryMap.set(r.snapshot.id,this.state.entries.get(s)),this.events.changed.next(void 0)}},t.prototype.clear=function(){var r=this;0!==this.state.entries.size&&(this.entryMap.forEach(function(n){n?.image&&r.plugin.managers.asset.delete(n.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:yp()}),this.events.changed.next(void 0))},t.prototype.applyKey=function(r){var n=this.state.entries.find(function(a){return a.key===r});n&&(this.updateState({current:n.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(n.snapshot))},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next(void 0)),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(0===a)return;return this.state.entries.get(-1===n?a-1:0).snapshot.id}var o=this.getEntry(r);if(o){var s=this.getIndex(o);if(!(s<0))return(s=(s+n)%a)<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return le(this,function(l){switch(l.label){case 0:for(this.clear(),n=yp().asMutable(),a=0,i=r.entries;a<i.length;a++)this.entryMap.set((o=i[a]).snapshot.id,o),n.push(o);return this.updateState({current:s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),s?(u=this.getEntry(s),(c=u&&u.snapshot)?[4,this.plugin.state.setSnapshot(c)]:[2]):[2];case 1:return l.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,c]}})})},t.prototype.syncCurrent=function(r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s,u,c,l;return le(this,function(d){switch(d.label){case 0:return o=1===this.state.entries.size&&this.state.current&&this.state.current===this.defaultSnapshotId,(i=0===this.state.entries.size)||o?(s=this.plugin.state.getSnapshot(r?.params),(null!==(a=null===(n=r?.params)||void 0===n?void 0:n.image)&&void 0!==a?a:this.plugin.state.snapshotParams.value.image)?[4,t.getCanvasImageAsset(this.plugin,"".concat(s.id,"-image.png"))]:[3,2]):[2];case 1:return c=d.sent(),[3,3];case 2:c=void 0,d.label=3;case 3:return u=c,i?this.add(t.Entry(s,{name:r?.name,description:r?.description,image:u})):o&&(l=this.getEntry(this.state.current),l?.image&&this.plugin.managers.asset.delete(l.image),this.replace(this.state.current,s,{image:u})),this.defaultSnapshotId=s.id,[2]}})})},t.prototype.getStateSnapshot=function(r){return ce(this,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,this.syncCurrent(r)];case 1:return n.sent(),[2,{timestamp:+new Date,version:"3.44.0",name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!(!r||!r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}]}})})},t.prototype.serialize=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b;return le(this,function(_){switch(_.label){case 0:return i=(a=JSON).stringify,[4,this.getStateSnapshot({params:r?.params})];case 1:return n=i.apply(a,[_.sent(),null,2]),r?.type&&"json"!==r.type&&"molj"!==r.type?[3,2]:[2,new Blob([n],{type:"application/json;charset=utf-8"})];case 2:Oy(o=new Uint8Array(yT(n)),0,n),s={"state.json":o},u=[],c=0,l=this.plugin.managers.asset.assets,_.label=3;case 3:return c<l.length?(p=(d=l[c]).file,u.push([(f=d.asset).id,f]),h=s,m="assets/".concat(f.id),v=Uint8Array.bind,[4,p.arrayBuffer()]):[3,6];case 4:h[m]=new(v.apply(Uint8Array,[void 0,_.sent()])),_.label=5;case 5:return c++,[3,3];case 6:return u.length>0&&(g=JSON.stringify(u,null,2),Oy(y=new Uint8Array(yT(g)),0,g),s["assets.json"]=y),[4,this.plugin.runTask(sNe(s))];case 7:return b=_.sent(),[2,new Blob([b],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,v,g,y;return le(this,function(b){switch(b.label){case 0:return b.trys.push([0,15,,16]),(n=r.name.toLowerCase()).endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(fp(r,"string"))]:[3,8];case 1:return a=b.sent(),g=JSON.parse(a),t.isStateSnapshot(g)?[4,this.setStateSnapshot(g)]:[3,3];case 2:return b.sent(),[3,7];case 3:return t.isStateSnapshot(g.data)?[4,this.setStateSnapshot(g.data)]:[3,5];case 4:return b.sent(),[3,7];case 5:return[4,this.plugin.state.setSnapshot(g)];case 6:b.sent(),b.label=7;case 7:return[3,14];case 8:return[4,this.plugin.runTask(fp(r,"zip"))];case 9:return a=b.sent(),i=Object.create(null),Ks(a,function(_,C){if("state.json"!==C&&"assets.json"!==C){var x=C.substring(C.indexOf("/")+1);i[x]=_}}),o=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(fp(o,"string"))];case 10:return s=b.sent(),a["assets.json"]?(u=new File([a["assets.json"]],"assets.json"),d=(l=JSON).parse,[4,this.plugin.runTask(fp(u,"string"))]):[3,12];case 11:for(c=d.apply(l,[b.sent()]),f=0,p=c;f<p.length;f++)this.plugin.managers.asset.set(v=(h=p[f])[1],new File([i[h[0]]],v.name));b.label=12;case 12:return g=JSON.parse(s),[4,this.setStateSnapshot(g)];case 13:b.sent(),b.label=14;case 14:return this.events.opened.next(void 0),[3,16];case 15:return y=b.sent(),console.error(y),this.plugin.log.error("Error reading state"),[3,16];case 16:return[2]}})})},t.prototype.play=function(r){if(void 0===r&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n)return void this.next();this.events.changed.next(void 0);var a=n.snapshot;this.timeoutHandle=setTimeout(this.next,typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.entryMap.clear()},t.DefaultNextSnapshotDelayInMs=1500,t}(Zp);function sie(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function uie(e,t){if(void 0===t&&(t="download"),e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener","string"==typeof e?(r.href=e,sie(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return sie(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(c){!function lQe(e){window.open(e,"_blank")||(window.location.href=e)}(i?c:c.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL("string"==typeof e?new Blob([e]):e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function o5(e,t){return"".concat(e).concat("/"===e[e.length-1]||"/"===t[0]?"":"/").concat(t)}!function(e){e.Entry=function t(a,i){return R({timestamp:+new Date,snapshot:a},i)},e.isStateSnapshot=function r(a){return!!a&&!!a.timestamp&&!!a.entries},e.getCanvasImageAsset=function n(a,i){return ce(this,void 0,void 0,function(){var o,s,u,c;return le(this,function(l){switch(l.label){case 0:return a.helpers.viewportScreenshot&&(o=a.helpers.viewportScreenshot.getPreview(512))?[4,i5(o.canvas,"png")]:[2];case 1:return s=l.sent(),u=new File([s],i),c={kind:"file",id:Gn.create22(),name:i},a.managers.asset.set(c,u),[2,c]}})})}}(Eb||(Eb={}));var dQe={get preferWebGl1(){if(typeof navigator>"u"||typeof window>"u")return!1;if(["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(function(a){return navigator.userAgent.indexOf(a)>0}))return!0;var t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=navigator.userAgent.includes("Macintosh"),n=navigator.maxTouchPoints>=4;return!window.MSStream&&(t||r&&n)}},fQe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function Xn(e,t){return new fQe(e,t)}var ma={item:Xn,General:{IsBusyTimeoutMs:Xn("plugin-config.is-busy-timeout",750),DisableAntialiasing:Xn("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:Xn("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:Xn("plugin-config.pixel-scale",1),PickScale:Xn("plugin-config.pick-scale",.25),PickPadding:Xn("plugin-config.pick-padding",3),EnableWboit:Xn("plugin-config.enable-wboit",!0),EnableDpoit:Xn("plugin-config.enable-dpoit",!1),PreferWebGl1:Xn("plugin-config.prefer-webgl1",dQe.preferWebGl1),AllowMajorPerformanceCaveat:Xn("plugin-config.allow-major-performance-caveat",!1),PowerPreference:Xn("plugin-config.power-preference","high-performance")},State:{DefaultServer:Xn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:Xn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:Xn("history-capacity.server",5)},VolumeStreaming:{Enabled:Xn("volume-streaming.enabled",!0),DefaultServer:Xn("volume-streaming.server","https://ds.litemol.org"),CanStream:Xn("volume-streaming.can-stream",function(e,t){return 1===e.models.length&&ir.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:Xn("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:Xn("viewer.show-expand-button",!0),ShowControls:Xn("viewer.show-controls-button",!0),ShowSettings:Xn("viewer.show-settings-button",!0),ShowSelectionMode:Xn("viewer.show-selection-model-button",!0),ShowAnimation:Xn("viewer.show-animation-button",!0),ShowTrajectoryControls:Xn("viewer.show-trajectory-controls",!0)},Download:{DefaultPdbProvider:Xn("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:Xn("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:Xn("structure.size-thresholds",Ye.DefaultSizeThresholds),DefaultRepresentationPreset:Xn("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:Xn("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:Xn("structure.saccharide-comp-id-map-type","default")},Background:{Styles:Xn("background.styles",[])}},pQe=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){return r._config.set(n[0],n[1])})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function hQe(e){cie(e),lie(e),die(e),fie(e),pie(e),hie(e),mie(e),vie(e),gie(e),yie(e)}function cie(e){e.state.events.object.created.subscribe(function(t){ve.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){var r,n,a,i;ve.isBehavior(t.obj)&&(null===(n=(r=t.obj.data).unregister)||void 0===n||n.call(r),null===(i=(a=t.obj.data).dispose)||void 0===i||i.call(a))}),e.state.events.object.updated.subscribe(function(t){var r,n,a,i;"recreate"===t.action&&(t.oldObj&&ve.isBehavior(t.oldObj)&&(null===(n=(r=t.oldObj.data).unregister)||void 0===n||n.call(r),null===(i=(a=t.oldObj.data).dispose)||void 0===i||i.call(a)),t.obj&&ve.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function lie(e){Sr.State.SetCurrentObject.subscribe(e,function(t){return t.state.setCurrent(t.ref)})}function die(e){Sr.State.Update.subscribe(e,function(t){return e.runTask(t.state.updateTree(t.tree,t.options))})}function fie(e){Sr.State.ApplyAction.subscribe(e,function(t){var n=t.action;return e.runTask(t.state.applyAction(n.action,n.params,t.ref))})}function pie(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}Sr.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref;if(!r.removeParentGhosts)return t(n,a);var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var c=o.transforms.get(s.parent);if(!c.state.isGhost)return t(n,s.ref);s=c}})}function hie(e){Sr.State.ToggleExpanded.subscribe(e,function(t){return t.state.updateCellState(t.ref,function(a){return{isCollapsed:!a.isCollapsed}})})}function mie(e){Sr.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return Ib(r,n,!r.cells.get(n).state.isHidden)})}function Ib(e,t,r){hi.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},mQe)}function mQe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function vie(e){Sr.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(e.canvas3d&&!e.isBusy){e.managers.interactivity.lociHighlights.clearHighlights();for(var i=0,o="string"==typeof n?[n]:n;i<o.length;i++){var u=r.cells.get(o[i]);if(u)if(ve.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:Ye.Loci(u.obj.data)},!1);else if(u&&ve.isRepresentation3D(u.obj))for(var c=u.obj.data.repr,l=0,d=c.getAllLoci();l<d.length;l++)e.managers.interactivity.lociHighlights.highlight({loci:d[l],repr:c},!1);else if(ve.Molecule.Structure.Selections.is(u.obj))for(var p=0,h=u.obj.data;p<h.length;p++)e.managers.interactivity.lociHighlights.highlight({loci:h[p].loci},!1)}}})}function gie(e){Sr.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function yie(e){var t=this;e.config.set(ma.State.CurrentServer,e.config.get(ma.State.DefaultServer)),Sr.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),Sr.State.Snapshots.Remove.subscribe(e,function(r){e.managers.snapshot.remove(r.id)}),Sr.State.Snapshots.Add.subscribe(e,function(r){var n=r.key,a=r.name,i=r.description,o=r.params;return ce(t,void 0,void 0,function(){var s,c,l,d;return le(this,function(f){switch(f.label){case 0:return s=e.state.getSnapshot(o),(null!==(d=o?.image)&&void 0!==d?d:e.state.snapshotParams.value.image)?[4,Eb.getCanvasImageAsset(e,"".concat(s.id,"-image.png"))]:[3,2];case 1:return c=f.sent(),[3,3];case 2:c=void 0,f.label=3;case 3:return l=Eb.Entry(s,{key:n,name:a,description:i,image:c}),e.managers.snapshot.add(l),[2]}})})}),Sr.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;return ce(t,void 0,void 0,function(){var i,o,s,u;return le(this,function(c){switch(c.label){case 0:return i=e.state.getSnapshot(a),(null!==(u=a?.image)&&void 0!==u?u:e.state.snapshotParams.value.image)?[4,Eb.getCanvasImageAsset(e,"".concat(i.id,"-image.png"))]:[3,2];case 1:return s=c.sent(),[3,3];case 2:s=void 0,c.label=3;case 3:return o=s,e.managers.snapshot.replace(n,e.state.getSnapshot(a),{image:o}),[2]}})})}),Sr.State.Snapshots.Move.subscribe(e,function(r){e.managers.snapshot.move(r.id,r.dir)}),Sr.State.Snapshots.Apply.subscribe(e,function(r){var a=e.managers.snapshot.setCurrent(r.id);if(a)return e.state.setSnapshot(a)}),Sr.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return ce(t,void 0,void 0,function(){var u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:return u=fetch,c=[o5(o,"set?name=".concat(encodeURIComponent(n||""),"&description=").concat(encodeURIComponent(a||"")))],f={method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"}},d=(l=JSON).stringify,[4,e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i})];case 1:return[2,u.apply(void 0,c.concat([(f.body=d.apply(l,[p.sent()]),f)]))]}})})}),Sr.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ce(t,void 0,void 0,function(){var a;return le(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),Sr.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return ce(t,void 0,void 0,function(){var o;return le(this,function(u){switch(u.label){case 0:return o="mol-star_state_".concat(n||function cQe(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()}(),".").concat("json"===a?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return uie(u.sent(),"".concat(o)),[2]}})})}),Sr.State.Snapshots.OpenFile.subscribe(e,function(r){return e.managers.snapshot.open(r.file)}),Sr.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return ce(t,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state.".concat(a)))]}})})})}function vQe(e){bie(e),_ie(e),Sie(e)}function bie(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;ve.isRepresentation3D(r.obj)&&(s5(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),null===(n=e.canvas3d)||void 0===n||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&ve.isRepresentation3D(r.oldObj)&&(null===(n=e.canvas3d)||void 0===n||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ve.isRepresentation3D(r.obj)&&(s5(r.state.cells.get(r.ref),r.obj.data.repr),"recreate"===r.action&&r.obj.data.repr.setState({syncManually:!0}),null===(a=e.canvas3d)||void 0===a||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;ve.isRepresentation3D(r.obj)&&(null===(n=e.canvas3d)||void 0===n||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function _ie(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(ve.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),null===(n=e.canvas3d)||void 0===n||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(ve.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),null===(n=e.canvas3d)||void 0===n||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(ve.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),null===(n=e.canvas3d)||void 0===n||n.update(a.repr)}})}function Sie(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);ve.isRepresentation3D(n.obj)&&s5(n,n.obj.data.repr)&&(null===(r=e.canvas3d)||void 0===r||r.syncVisibility())})}function s5(e,t){return t.state.visible===!!e.state.isHidden&&(t.setState({visible:!e.state.isHidden}),!0)}function gQe(e){Cie(e),wie(e),xie(e),Aie(e),Tie(e)}function Cie(e){Sr.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function xie(e){Sr.Camera.SetSnapshot.subscribe(e,function(t){e.managers.camera.setSnapshot(t.snapshot,t.durationMs)})}function wie(e){Sr.Camera.Focus.subscribe(e,function(t){e.managers.camera.focusSphere({center:t.center,radius:t.radius},{durationMs:t.durationMs}),e.events.canvas3d.settingsUpdated.next(void 0)})}function Aie(e){Sr.Camera.OrientAxes.subscribe(e,function(t){e.managers.camera.orientAxes(t.structures,t.durationMs)})}function Tie(e){Sr.Camera.ResetAxes.subscribe(e,function(t){e.managers.camera.resetAxes(t.durationMs)})}function fo(){return fo.zero()}!function(e){e.zero=function t(){return{x:0,y:0,width:0,height:0}},e.create=function r(u,c,l,d){return{x:u,y:c,width:l,height:d}},e.clone=function n(u){return R({},u)},e.copy=function a(u,c){return Object.assign(u,c)},e.set=function i(u,c,l,d,f){return u.x=c,u.y=l,u.width=d,u.height=f,u},e.toVec4=function o(u,c){return u[0]=c.x,u[1]=c.y,u[2]=c.width,u[3]=c.height,u},e.equals=function s(u,c){return u.x===c.x&&u.y===c.y&&u.width===c.width&&u.height===c.height}}(fo||(fo={}));var hf=fr();function RE(e,t,r,n){var s=r.height,c=t[1]-r.y,l=t[2];return e[0]=2*(t[0]-r.x)/r.width-1,e[1]=2*c/s-1,e[2]=2*l-1,S.transformMat4(e,e,n)}function u5(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(2===t)return 4;if(3===t)return 2;if(t>0)return 1<<t-1}}return 0}function Die(e){if("object"==typeof e&&"button"in e){var t=e.button;if(1===t)return 4;if(2===t)return 2;if(t>=0)return 1<<t}return 0}var bc,Ya,Eie={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:function(e,t){return!0},pixelScale:1};!function(e){function t(i,o){return i.shift===o.shift&&i.alt===o.alt&&i.control===o.control&&i.meta===o.meta}function a(i){return void 0===i&&(i={}),{shift:!!i.shift,alt:!!i.alt,control:!!i.control,meta:!!i.meta}}e.None=a(),e.areEqual=t,e.areNone=function r(i){return t(i,e.None)},e.size=function n(i){if(!i)return 0;var o=0;return i.shift&&o++,i.alt&&o++,i.control&&o++,i.meta&&o++,o},e.create=a}(bc||(bc={})),function(e){var r;e.has=rs.has,e.create=rs.create,(r=e.Flag||(e.Flag={}))[r.None=0]="None",r[r.Primary=1]="Primary",r[r.Secondary=2]="Secondary",r[r.Auxilary=4]="Auxilary",r[r.Forth=8]="Forth",r[r.Five=16]="Five"}(Ya||(Ya={}));var Iie={key:"",code:"",modifiers:bc.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:Cy},bg=function(e){return e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Moving=2]="Moving",e}(bg||{});function Pie(){return{drag:new Cn,interactionEnd:new Cn,click:new Cn,move:new Cn,wheel:new Cn,pinch:new Cn,gesture:new Cn,resize:new Cn,leave:new Cn,enter:new Cn,modifiers:new Cn,key:new Cn,keyUp:new Cn,keyDown:new Cn,lock:new Cn}}var c5,bQe=["Backspace","Delete"];!function(e){e.create=function t(n){void 0===n&&(n={});var a=R(R({},Eie),n);return R(R({noScroll:a.noScroll,noContextMenu:a.noContextMenu,pointerLock:!1,width:0,height:0,pixelRatio:1},Pie()),{requestPointerLock:Cy,exitPointerLock:Cy,dispose:Cy})},e.fromElement=function r(n,a){void 0===a&&(a={});var i=R(R({},Eie),a),o=i.noScroll,u=i.noContextMenu,c=i.noPinchZoom,l=i.noTextSelect,d=i.mask,f=i.pixelScale,p=i.preventGestures,h=n.clientWidth*I(),m=n.clientHeight*I(),v=!1,g=fo(),y=0,b=0,_=Ne(),C=Ne(),x=Ne(),A=Ne(),T=Ne(),w={shift:!1,alt:!1,control:!1,meta:!1},E={x:-1,y:-1,pageX:-1,pageY:-1};function I(){return window.devicePixelRatio*f}function M(){return R({},w)}function F(Ge){return Ge.target===document.body||Ge.target===n}var Q,N=bg.Stopped,j=!1,k=Ya.create(Ya.Flag.None),H=Ya.Flag.None,G=!1,U=!1;typeof window.ResizeObserver<"u"&&(Q=new window.ResizeObserver(Ir));var W=Pie(),K=W.drag,ne=W.interactionEnd,X=W.wheel,L=W.pinch,Y=W.gesture,$=W.click,Z=W.move,q=W.leave,z=W.enter,te=W.resize,ae=W.modifiers,fe=W.key,he=W.keyUp,pe=W.keyDown,re=W.lock;function ge(){Ym(v=n.ownerDocument.pointerLockElement===n),re.next(v)}function Ce(){console.error("Unable to use Pointer Lock API"),Ym(v=!1),re.next(v)}function ze(Ge){d(Ge.clientX,Ge.clientY)&&u&&Ge.preventDefault()}function je(Ge){w.alt=Ge.altKey,w.shift=Ge.shiftKey,w.control=Ge.ctrlKey,w.meta=Ge.metaKey}function V(){(k||w.shift||w.alt||w.meta||w.control)&&(k=0,w.shift=w.alt=w.control=w.meta=!1)}function J(Ge){var Ze=!1;!w.alt&&Ge.altKey&&(Ze=!0,w.alt=!0),!w.shift&&Ge.shiftKey&&(Ze=!0,w.shift=!0),!w.control&&Ge.ctrlKey&&(Ze=!0,w.control=!0),!w.meta&&Ge.metaKey&&(Ze=!0,w.meta=!0),Ze&&G&&ae.next(M()),F(Ge)&&G&&pe.next(R(R({key:Ge.key,code:Ge.code,modifiers:M()},E),{preventDefault:function(){return Ge.preventDefault()}}))}function ye(Ge){var Ze=!1;w.alt&&!Ge.altKey&&(Ze=!0,w.alt=!1),w.shift&&!Ge.shiftKey&&(Ze=!0,w.shift=!1),w.control&&!Ge.ctrlKey&&(Ze=!0,w.control=!1),w.meta&&!Ge.metaKey&&(Ze=!0,w.meta=!1),Ze&&G&&ae.next(M()),bQe.includes(Ge.key)&&we(Ge),F(Ge)&&G&&he.next(R(R({key:Ge.key,code:Ge.code,modifiers:M()},E),{preventDefault:function(){return Ge.preventDefault()}}))}function we(Ge){!F(Ge)||!G||fe.next(R(R({key:Ge.key,code:Ge.code,modifiers:M()},E),{preventDefault:function(){return Ge.preventDefault()}}))}function Ee(Ge){var Ze=Ge.touches[0],yt=Ge.touches[1];return{clientX:(Ze.clientX+yt.clientX)/2,clientY:(Ze.clientY+yt.clientY)/2,pageX:(Ze.pageX+yt.pageX)/2,pageY:(Ze.pageY+yt.pageY)/2,target:Ge.target}}function Fe(Ge){var Ze=Ge.touches[0].pageX-Ge.touches[1].pageX,yt=Ge.touches[0].pageY-Ge.touches[1].pageY;return Math.sqrt(Ze*Ze+yt*yt)}!function ee(){n.addEventListener("contextmenu",ze,!1),n.addEventListener("wheel",Rt,!1),n.addEventListener("mousedown",_t,!1),window.addEventListener("mousemove",wt,!1),window.addEventListener("mouseup",Le,!1),n.addEventListener("touchstart",Je,!1),n.addEventListener("touchmove",ut,!1),n.addEventListener("touchend",vt,!1),n.addEventListener("gesturechange",At,!1),n.addEventListener("gesturestart",Qe,!1),n.addEventListener("gestureend",Zt,!1),window.addEventListener("blur",V),window.addEventListener("keyup",ye,!1),window.addEventListener("keydown",J,!1),window.addEventListener("keypress",we,!1),document.addEventListener("pointerlockchange",ge,!1),document.addEventListener("pointerlockerror",Ce,!1),null!=Q?Q.observe(n.parentElement):window.addEventListener("resize",Ir,!1)}();var ke=-1,Ue=void 0,$e=Ne(),Pe=Ne();function Je(Ge){if(Ge.preventDefault(),Ue=void 0,ke=-1,1===Ge.touches.length)ke=0,Ne.set($e,Ge.touches[0].pageX,Ge.touches[0].pageY),Ue=Ge.touches[0],k=H=Ya.Flag.Primary,St(Ge.touches[0]);else if(2===Ge.touches.length){k=Ya.Flag.Secondary&Ya.Flag.Auxilary,H=Ya.Flag.Secondary,St(Ee(Ge));var Ze=Fe(Ge);y=Ze,L.next({distance:Ze,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:k,button:H,modifiers:M()})}else 3===Ge.touches.length&&(k=H=Ya.Flag.Forth,St(Ee(Ge)))}function vt(Ge){if(st(),Ue&&ke<=4){var Ze=Ue;if(!d(Ze.clientX,Ze.clientY))return;na(Pe,Ze);var yt=_o(Ze);$.next({x:Pe[0],y:Pe[1],pageX:yt.pageX,pageY:yt.pageY,buttons:k,button:H,modifiers:M()})}Ue=void 0}function ut(Ge){if(H=Ya.Flag.None,c&&(Ge.preventDefault(),Ge.stopPropagation(),Ge.originalEvent&&(Ge.originalEvent.preventDefault(),Ge.originalEvent.stopPropagation())),Ue=void 0,1===Ge.touches.length)k=Ya.Flag.Primary,Ue=Ge.touches[0],function He(Ge){ke<0||(Ne.set(Pe,Ge.touches[0].pageX,Ge.touches[0].pageY),ke+=Ne.distance($e,Pe),Ne.copy($e,Pe))}(Ge),Mt(Ge.touches[0]);else if(2===Ge.touches.length){var Ze=Fe(Ge),yt=y-Ze;if(Math.abs(yt)<4)k=Ya.Flag.Secondary,Mt(Ee(Ge));else{k=Ya.Flag.Auxilary,je(Ge);var Yt=y/Ze;L.next({delta:yt,fraction:Yt,fractionDelta:b-Yt,distance:Ze,isStart:!1,buttons:k,button:H,modifiers:M()}),b=Yt}y=Ze}else 3===Ge.touches.length&&(k=Ya.Flag.Forth,Mt(Ee(Ge)))}function _t(Ge){je(Ge),k=u5(Ge),H=Die(Ge),St(Ge)}function wt(Ge){je(Ge),k=u5(Ge),H=Ya.Flag.None,Mt(Ge)}function Le(Ge){je(Ge),k=u5(Ge),H=Die(Ge),function bt(Ge){if(N=bg.Stopped,d(Ge.clientX,Ge.clientY)){if(na(x,Ge),!U&&Ne.distance(x,_)<4){var Ze=_o(Ge);$.next({x:x[0],y:x[1],pageX:Ze.pageX,pageY:Ze.pageY,buttons:k,button:H,modifiers:M()})}U=!1}}(Ge),st()}function st(){ne.next(void 0)}function St(Ge){d(Ge.clientX,Ge.clientY)&&(na(C,Ge),Ne.copy(_,C),rr(C)&&(N=bg.Started))}function Mt(Ge){var Ze;na(x,Ge);var yt=_o(Ge),Yt=yt.pageX,Dr=yt.pageY,ga=x[0],Ia=x[1],ss=Ge.movementX,Tl=Ge.movementY,us=rr(x)&&d(Ge.clientX,Ge.clientY);if(G&&!us?q.next(void 0):!G&&us&&z.next(void 0),G=us,E.x=ga,E.y=Ia,E.pageX=Yt,E.pageY=Dr,Z.next({x:ga,y:Ia,pageX:Yt,pageY:Dr,movementX:ss,movementY:Tl,buttons:k,button:H,modifiers:M(),inside:us,onElement:Ge.target===n}),N!==bg.Stopped&&(l&&(null===(Ze=Ge.preventDefault)||void 0===Ze||Ze.call(Ge)),Ne.div(A,Ne.sub(A,x,C),function mn(Ge){return Ge[0]=n.clientWidth,Ge[1]=n.clientHeight,Ge}(T)),!(Ne.magnitude(A)<gn))){var hh=N===bg.Started;hh&&!d(Ge.clientX,Ge.clientY)||(Ne.distance(x,_)>=4&&(U=!0),K.next({x:ga,y:Ia,dx:A[0],dy:A[1],pageX:Yt,pageY:Dr,buttons:k,button:H,modifiers:M(),isStart:hh}),Ne.copy(C,x),N=bg.Moving)}}function Rt(Ge){if(d(Ge.clientX,Ge.clientY)){na(x,Ge);var Ze=_o(Ge),yt=Ze.pageX,Yt=Ze.pageY,Dr=x[0],ga=x[1];o&&Ge.preventDefault();var Ia=function _Qe(e){var a=0,i=0,o=0,s=0,u=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(a=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(a=i,i=0),o=10*a,s=10*i,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(o=e.deltaX),"deltaZ"in e&&(u=e.deltaZ),(o||s||u)&&e.deltaMode&&(1===e.deltaMode?(o*=40,s*=40,u*=40):(o*=800,s*=800,u*=800)),o&&!a&&(a=o<1?-1:1),s&&!i&&(i=s<1?-1:1),{spinX:a,spinY:i,dx:o,dy:s,dz:u}}(Ge);k=H=Ya.Flag.Auxilary,(Ia.dx||Ia.dy||Ia.dz)&&X.next(R(R({x:Dr,y:ga,pageX:yt,pageY:Yt},Ia),{buttons:k,button:H,modifiers:M()}))}}function oe(Ge){var Ze,yt;p&&(Ge.preventDefault(),null===(Ze=Ge.stopImmediatePropagation)||void 0===Ze||Ze.call(Ge),null===(yt=Ge.stopPropagation)||void 0===yt||yt.call(Ge))}var be=0,Se=0;function Qe(Ge){oe(Ge),be=Ge.scale,Se=Ge.rotation,Y.next({scale:Ge.scale,rotation:Ge.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function Et(Ge,Ze){Y.next({scale:Ge.scale,rotation:Ge.rotation,deltaRotation:Se-Ge.rotation,deltaScale:be-Ge.scale,isEnd:Ze}),Se=Ge.rotation,be=Ge.scale}function At(Ge){oe(Ge),Et(Ge)}function Zt(Ge){oe(Ge),Et(Ge,!0)}function Ir(){te.next({})}function rr(Ge){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Ze=n.getBoundingClientRect();return Ge[0]>=0&&Ge[1]>=0&&Ge[0]<Ze.width&&Ge[1]<Ze.height}function na(Ge,Ze){if(h=n.clientWidth*I(),m=n.clientHeight*I(),v){var yt=I();Ge[0]=(g.x+g.width/2)/yt,Ge[1]=(m-(g.y+g.height/2))/yt}else{var Yt=n.getBoundingClientRect();Ge[0]=(Ze.clientX||0)-Yt.left,Ge[1]=(Ze.clientY||0)-Yt.top}return Ge}function _o(Ge){return v?{pageX:Math.round(window.innerWidth/2)+g.x,pageY:Math.round(window.innerHeight/2)+g.y}:{pageX:Ge.pageX,pageY:Ge.pageY}}var Za=30,Ji=function Rf(){var Ge,Ze=document.createElement("div"),Dr="#000 ".concat("30%",", #0000 0 calc(100% - ").concat("30%","), #000 0"),ga="linear-gradient(0deg, ".concat(Dr,") 50%/").concat("10%"," 100% no-repeat"),Ia="linear-gradient(90deg, ".concat(Dr,") 50%/100% ").concat("10%"," no-repeat");return Object.assign(Ze.style,{width:"".concat(Za,"px"),aspectRatio:1,background:"".concat(ga,", ").concat(Ia,", ").concat("radial-gradient(circle at 50%, #000 5%, #0000 5%)"),display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),null===(Ge=n.parentElement)||void 0===Ge||Ge.appendChild(Ze),Ze}();function Ym(Ge){if(Ji.style.display=Ge?"block":"none",Ge){var Ze=I(),yt=(g.x+g.width/2)/Ze,Yt=(g.y+g.height/2)/Ze;Ji.style.width="".concat(Za,"px"),Ji.style.left="calc(".concat(yt,"px - ").concat(Za/2,"px)"),Ji.style.bottom="calc(".concat(Yt,"px - ").concat(Za/2,"px)")}}return R(R({get noScroll(){return o},set noScroll(Ge){o=Ge},get noContextMenu(){return u},set noContextMenu(Ge){u=Ge},get width(){return h},get height(){return m},get pixelRatio(){return I()},get pointerLock(){return v}},W),{requestPointerLock:function(Ge){g=Ge,v||n.requestPointerLock()},exitPointerLock:function(){v&&n.ownerDocument.exitPointerLock()},dispose:function ue(){j||(j=!0,n.removeEventListener("contextmenu",ze,!1),n.removeEventListener("wheel",Rt,!1),n.removeEventListener("mousedown",_t,!1),window.removeEventListener("mousemove",wt,!1),window.removeEventListener("mouseup",Le,!1),n.removeEventListener("touchstart",Je,!1),n.removeEventListener("touchmove",ut,!1),n.removeEventListener("touchend",vt,!1),n.removeEventListener("gesturechange",At,!1),n.removeEventListener("gesturestart",Qe,!1),n.removeEventListener("gestureend",Zt,!1),window.removeEventListener("blur",V),window.removeEventListener("keyup",ye,!1),window.removeEventListener("keydown",J,!1),window.removeEventListener("keypress",we,!1),document.removeEventListener("pointerlockchange",ge,!1),document.removeEventListener("pointerlockerror",Ce,!1),Ji.remove(),null!=Q?(Q.unobserve(n.parentElement),Q.disconnect()):window.removeEventListener("resize",Ir,!1))}})}}(c5||(c5={}));var f5,_g=function(e){return e[e.None=0]="None",e[e.Object=1]="Object",e[e.Instance=2]="Instance",e[e.Group=3]="Group",e}(_g||{}),OE=function(e){return e[e.None=0]="None",e[e.Depth=1]="Depth",e[e.Mask=2]="Mask",e}(OE||{}),l5={backgroundColor:D.Color(dt(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:D.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:D.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:D.Boolean(!0,{label:"Use Interior Color"}),interiorColor:D.Color(dt.fromNormalizedRgb(.3,.3,.3)),colorMarker:D.Boolean(!0,{description:"Enable color marker"}),highlightColor:D.Color(dt.fromNormalizedRgb(1,.4,.6)),selectColor:D.Color(dt.fromNormalizedRgb(.2,1,.1)),dimColor:D.Color(dt.fromNormalizedRgb(1,1,1)),highlightStrength:D.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:D.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:D.Numeric(0,{min:0,max:1,step:.1}),markerPriority:D.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:D.Numeric(1,{min:0,max:3,step:.1}),exposure:D.Numeric(1,{min:0,max:3,step:.01}),light:D.ObjectList({inclination:D.Numeric(150,{min:0,max:180,step:1}),azimuth:D.Numeric(320,{min:0,max:360,step:1}),color:D.Color(dt.fromNormalizedRgb(1,1,1)),intensity:D.Numeric(.6,{min:0,max:5,step:.01})},function(e){return dt.toHexString(e.color)},{defaultValue:[{inclination:150,azimuth:320,color:dt.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:D.Color(dt.fromNormalizedRgb(1,1,1)),ambientIntensity:D.Numeric(.4,{min:0,max:2,step:.01})},Mie=S(),d5=S();function Rie(e,t){for(var r=e.length,n=t||{direction:new Array(3*r).fill(0),color:new Array(3*r).fill(0)},a=n.direction,i=n.color,o=0;o<r;++o){var s=e[o];S.directionFromSpherical(Mie,Zr(s.inclination),Zr(s.azimuth),1),S.toArray(Mie,a,3*o),S.scale(d5,dt.toVec3Normalized(d5,s.color),s.intensity),S.toArray(d5,i,3*o)}return{count:r,direction:a,color:i}}function Dt(e,t,r){return void 0===t&&(t=""),void 0===r&&(r=""),Dt.create(e,t,r)}!function(e){e.create=function t(r,n){void 0===n&&(n={});var a=r.gl,i=r.state,o=r.stats,s=D.merge(l5,D.getDefaultValues(l5),n),u=Rie(s.light),c=fo(),l=Ne.create(a.drawingBufferWidth,a.drawingBufferHeight),d=dt.toVec3Normalized(S(),s.backgroundColor),f=!1,p=r.resources.texture("image-uint8","rgba","ubyte","nearest");p.define(1,1),p.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});var h=[["tDepth",p]],m=me(),v=me(),g=me(),y=me(),b=me(),_=me(),C=me(),x=S(),A=Ne(),T=S();S.scale(T,dt.toArrayNormalized(s.ambientColor,T,0),s.ambientIntensity);var w={uModel:O.create(me.identity()),uView:O.create(m),uInvView:O.create(v),uModelView:O.create(g),uInvModelView:O.create(y),uInvProjection:O.create(b),uProjection:O.create(me()),uModelViewProjection:O.create(_),uInvModelViewProjection:O.create(C),uIsOrtho:O.create(1),uViewOffset:O.create(A),uPixelRatio:O.create(r.pixelRatio),uViewport:O.create(fo.toVec4(fr(),c)),uDrawingBufferSize:O.create(l),uCameraPosition:O.create(S()),uCameraDir:O.create(x),uNear:O.create(1),uFar:O.create(1e4),uFog:O.create(!0),uFogNear:O.create(1),uFogFar:O.create(1e4),uFogColor:O.create(d),uRenderMask:O.create(0),uMarkingDepthTest:O.create(!1),uPickType:O.create(_g.None),uMarkingType:O.create(OE.None),uTransparentBackground:O.create(!1),uLightDirection:O.create(u.direction),uLightColor:O.create(u.color),uAmbientColor:O.create(T),uPickingAlphaThreshold:O.create(s.pickingAlphaThreshold),uInteriorDarkening:O.create(s.interiorDarkening),uInteriorColorFlag:O.create(s.interiorColorFlag),uInteriorColor:O.create(dt.toVec3Normalized(S(),s.interiorColor)),uHighlightColor:O.create(dt.toVec3Normalized(S(),s.highlightColor)),uSelectColor:O.create(dt.toVec3Normalized(S(),s.selectColor)),uDimColor:O.create(dt.toVec3Normalized(S(),s.dimColor)),uHighlightStrength:O.create(s.highlightStrength),uSelectStrength:O.create(s.selectStrength),uDimStrength:O.create(s.dimStrength),uMarkerPriority:O.create(s.markerPriority),uMarkerAverage:O.create(0),uXrayEdgeFalloff:O.create(s.xrayEdgeFalloff),uExposure:O.create(s.exposure)},E=Object.entries(w),I=!0,M=function(z,te,ae){var fe,he,pe;if(!z.state.disposed&&z.state.visible&&(z.state.pickable||"pick"!==te)){var re=!1;z.values.dLightCount.ref.value!==u.count&&(O.update(z.values.dLightCount,u.count),re=!0),z.values.dColorMarker.ref.value!==s.colorMarker&&(O.update(z.values.dColorMarker,s.colorMarker),re=!0),re&&z.update();var ee=z.getProgram(te);if(i.currentProgramId!==ee.id&&(I=!0,ee.use()),I&&(ee.setUniforms(E),ee.bindTextures(h,0),I=!1),"directVolume"===z.values.dGeometryType.ref.value){if("colorDpoit"!==te&&"colorWboit"!==te&&"colorBlended"!==te)return;i.disable(a.CULL_FACE),i.frontFace(a.CCW),"colorBlended"===te&&(i.disable(a.DEPTH_TEST),i.depthMask(!1))}else 1===ae?(i.enable(a.CULL_FACE),null!==(fe=z.values.dFlipSided)&&void 0!==fe&&fe.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK))):2===ae?(i.enable(a.CULL_FACE),null!==(he=z.values.dFlipSided)&&void 0!==he&&he.ref.value?(i.frontFace(a.CW),i.cullFace(a.BACK)):(i.frontFace(a.CCW),i.cullFace(a.FRONT))):(z.values.uDoubleSided?z.values.uDoubleSided.ref.value||z.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),null!==(pe=z.values.dFlipSided)&&void 0!==pe&&pe.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK)));z.render(te,h.length)}},N=function(z,te,ae,fe,he){tT(h,"tDepth",ae||p),O.update(w.uModel,z.view),O.update(w.uModelView,me.mul(g,te.view,z.view)),O.update(w.uInvModelView,me.invert(y,g)),O.update(w.uModelViewProjection,me.mul(_,g,te.projection)),O.update(w.uInvModelViewProjection,me.invert(C,_)),O.updateIfChanged(w.uRenderMask,fe),O.updateIfChanged(w.uMarkingDepthTest,he),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var pe=c.x,re=c.y,ee=c.width,ue=c.height;i.viewport(pe,re,ee,ue),i.scissor(pe,re,ee,ue),I=!0,i.currentRenderItemId=-1},K=function(z,te,ae){var fe,he;Ct&&r.timer.mark("Renderer.renderBlendedOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,1,!1);for(var pe=z.renderables,re=0,ee=pe.length;re<ee;++re){var ue=pe[re];ue.state.opaque?M(ue,"colorBlended",0):null!==(fe=ue.values.uDoubleSided)&&void 0!==fe&&fe.ref.value&&"opaque"===(null===(he=ue.values.dTransparentBackfaces)||void 0===he?void 0:he.ref.value)&&M(ue,"colorBlended",2)}Ct&&r.timer.markEnd("Renderer.renderBlendedOpaque")},ne=function(z,te,ae){var fe,he;Ct&&r.timer.mark("Renderer.renderBlendedTransparent"),i.enable(a.DEPTH_TEST),N(z,te,ae,2,!1);var pe=z.renderables;f?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var re=0,ee=pe.length;re<ee;++re)!(ue=pe[re]).state.opaque&&ue.state.writeDepth&&M(ue,"colorBlended",0);for(i.depthMask(!1),re=0,ee=pe.length;re<ee;++re){var ue;(!(ue=pe[re]).state.opaque&&!ue.state.writeDepth||ue.values.transparencyAverage.ref.value>0)&&(null!==(fe=ue.values.uDoubleSided)&&void 0!==fe&&fe.ref.value?("opaque"!==(null===(he=ue.values.dTransparentBackfaces)||void 0===he?void 0:he.ref.value)&&M(ue,"colorBlended",2),M(ue,"colorBlended",1)):M(ue,"colorBlended",0))}Ct&&r.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:function(z,te){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),f&&!te?i.clearColor(0,0,0,0):z?i.clearColor(d[0],d[1],d[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(z){void 0===z&&(z=!1),i.enable(a.SCISSOR_TEST),z?(i.colorMask(!0,!0,!0,!0),i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):(i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT))},update:function(z,te){O.update(w.uView,z.view),O.update(w.uInvView,me.invert(v,z.view)),O.update(w.uProjection,z.projection),O.update(w.uInvProjection,me.invert(b,z.projection)),O.updateIfChanged(w.uIsOrtho,"orthographic"===z.state.mode?1:0),O.update(w.uViewOffset,z.viewOffset.enabled?Ne.set(A,16*z.viewOffset.offsetX,16*z.viewOffset.offsetY):Ne.set(A,0,0)),O.update(w.uCameraPosition,z.state.position),O.update(w.uCameraDir,S.normalize(x,S.sub(x,z.state.target,z.state.position))),O.updateIfChanged(w.uFar,z.far),O.updateIfChanged(w.uNear,z.near),O.updateIfChanged(w.uFogFar,z.fogFar),O.updateIfChanged(w.uFogNear,z.fogNear),O.updateIfChanged(w.uTransparentBackground,f),O.updateIfChanged(w.uMarkerAverage,te.markerAverage)},renderPick:function(z,te,ae,fe,he){Ct&&r.timer.mark("Renderer.renderPick"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,fe,0,!1),O.updateIfChanged(w.uPickType,he);for(var pe=z.renderables,re=0,ee=pe.length;re<ee;++re)pe[re].state.colorOnly||M(pe[re],ae,0);Ct&&r.timer.markEnd("Renderer.renderPick")},renderDepth:function(z,te,ae){Ct&&r.timer.mark("Renderer.renderDepth"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,0,!1);for(var fe=z.renderables,he=0,pe=fe.length;he<pe;++he)M(fe[he],"depth",0);Ct&&r.timer.markEnd("Renderer.renderDepth")},renderDepthOpaque:function(z,te,ae){var fe,he;Ct&&r.timer.mark("Renderer.renderDepthOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,1,!1);for(var pe=z.renderables,re=0,ee=pe.length;re<ee;++re){var ue=pe[re],ge="on"===(null===(fe=ue.values.dXrayShaded)||void 0===fe?void 0:fe.ref.value)||"inverted"===(null===(he=ue.values.dXrayShaded)||void 0===he?void 0:he.ref.value);ue.state.opaque&&1!==ue.values.transparencyAverage.ref.value&&!ge&&M(ue,"depth",0)}Ct&&r.timer.markEnd("Renderer.renderDepthOpaque")},renderDepthTransparent:function(z,te,ae){var fe,he;Ct&&r.timer.mark("Renderer.renderDepthTransparent"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,2,!1);for(var pe=z.renderables,re=0,ee=pe.length;re<ee;++re){var ue=pe[re],ge="on"===(null===(fe=ue.values.dXrayShaded)||void 0===fe?void 0:fe.ref.value)||"inverted"===(null===(he=ue.values.dXrayShaded)||void 0===he?void 0:he.ref.value);(!ue.state.opaque||ue.values.transparencyAverage.ref.value>0||ge)&&M(ue,"depth",0)}Ct&&r.timer.markEnd("Renderer.renderDepthTransparent")},renderMarkingDepth:function(z,te,ae){Ct&&r.timer.mark("Renderer.renderMarkingDepth"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,0,!1),O.updateIfChanged(w.uMarkingType,OE.Depth);for(var fe=z.renderables,he=0,pe=fe.length;he<pe;++he){var re=fe[he];0!==ao(re.values.alpha.ref.value*re.state.alphaFactor,0,1)&&1!==re.values.markerAverage.ref.value&&M(fe[he],"marking",0)}Ct&&r.timer.markEnd("Renderer.renderMarkingDepth")},renderMarkingMask:function(z,te,ae){Ct&&r.timer.mark("Renderer.renderMarkingMask"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,0,!!ae),O.updateIfChanged(w.uMarkingType,OE.Mask);for(var fe=z.renderables,he=0,pe=fe.length;he<pe;++he)fe[he].values.markerAverage.ref.value>0&&M(fe[he],"marking",0);Ct&&r.timer.markEnd("Renderer.renderMarkingMask")},renderBlended:function(z,te){z.hasOpaque&&K(z,te,null),z.opacityAverage<1&&ne(z,te,null)},renderBlendedOpaque:K,renderBlendedTransparent:ne,renderBlendedVolume:function(z,te,ae){Ct&&r.timer.mark("Renderer.renderBlendedVolume"),i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),N(z,te,ae,2,!1);for(var fe=z.renderables,he=0,pe=fe.length;he<pe;++he){var re=fe[he];"directVolume"===re.values.dGeometryType.ref.value&&M(re,"colorBlended",0)}Ct&&r.timer.markEnd("Renderer.renderBlendedVolume")},renderWboitOpaque:function(z,te,ae){var fe,he,pe,re;Ct&&r.timer.mark("Renderer.renderWboitOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,1,!1);for(var ee=z.renderables,ue=0,ge=ee.length;ue<ge;++ue){var Ce=ee[ue],ze=ao(Ce.values.alpha.ref.value*Ce.state.alphaFactor,0,1),je="on"===(null===(fe=Ce.values.dXrayShaded)||void 0===fe?void 0:fe.ref.value)||"inverted"===(null===(he=Ce.values.dXrayShaded)||void 0===he?void 0:he.ref.value);(1===ze&&1!==Ce.values.transparencyAverage.ref.value&&"directVolume"!==Ce.values.dGeometryType.ref.value&&"fuzzy"!==(null===(pe=Ce.values.dPointStyle)||void 0===pe?void 0:pe.ref.value)&&!je||"opaque"===(null===(re=Ce.values.dTransparentBackfaces)||void 0===re?void 0:re.ref.value))&&M(Ce,"colorWboit",0)}Ct&&r.timer.markEnd("Renderer.renderWboitOpaque")},renderWboitTransparent:function(z,te,ae){var fe,he,pe;Ct&&r.timer.mark("Renderer.renderWboitTransparent"),N(z,te,ae,2,!1);for(var re=z.renderables,ee=0,ue=re.length;ee<ue;++ee){var ge=re[ee],Ce=ao(ge.values.alpha.ref.value*ge.state.alphaFactor,0,1),ze="on"===(null===(fe=ge.values.dXrayShaded)||void 0===fe?void 0:fe.ref.value)||"inverted"===(null===(he=ge.values.dXrayShaded)||void 0===he?void 0:he.ref.value);(Ce<1&&0!==Ce||ge.values.transparencyAverage.ref.value>0||"directVolume"===ge.values.dGeometryType.ref.value||"fuzzy"===(null===(pe=ge.values.dPointStyle)||void 0===pe?void 0:pe.ref.value)||"text"===ge.values.dGeometryType.ref.value||ze)&&M(ge,"colorWboit",0)}Ct&&r.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitOpaque:function(z,te,ae){var fe,he,pe,re;Ct&&r.timer.mark("Renderer.renderDpoitOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(z,te,ae,1,!1);for(var ee=z.renderables,ue=0,ge=ee.length;ue<ge;++ue){var Ce=ee[ue],ze=ao(Ce.values.alpha.ref.value*Ce.state.alphaFactor,0,1),je="on"===(null===(fe=Ce.values.dXrayShaded)||void 0===fe?void 0:fe.ref.value)||"inverted"===(null===(he=Ce.values.dXrayShaded)||void 0===he?void 0:he.ref.value);(1===ze&&1!==Ce.values.transparencyAverage.ref.value&&"fuzzy"!==(null===(pe=Ce.values.dPointStyle)||void 0===pe?void 0:pe.ref.value)&&!je||"opaque"===(null===(re=Ce.values.dTransparentBackfaces)||void 0===re?void 0:re.ref.value))&&M(Ce,"colorDpoit",0)}Ct&&r.timer.markEnd("Renderer.renderDpoitOpaque")},renderDpoitTransparent:function(z,te,ae,fe){var he,pe,re;Ct&&r.timer.mark("Renderer.renderDpoitTransparent"),i.enable(a.BLEND),tT(h,"tDpoitDepth",fe.depth),tT(h,"tDpoitFrontColor",fe.frontColor),tT(h,"tDpoitBackColor",fe.backColor),N(z,te,ae,2,!1);for(var ee=z.renderables,ue=0,ge=ee.length;ue<ge;++ue){var Ce=ee[ue],ze=ao(Ce.values.alpha.ref.value*Ce.state.alphaFactor,0,1),je="on"===(null===(he=Ce.values.dXrayShaded)||void 0===he?void 0:he.ref.value)||"inverted"===(null===(pe=Ce.values.dXrayShaded)||void 0===pe?void 0:pe.ref.value);(ze<1&&0!==ze||Ce.values.transparencyAverage.ref.value>0||"fuzzy"===(null===(re=Ce.values.dPointStyle)||void 0===re?void 0:re.ref.value)||"text"===Ce.values.dGeometryType.ref.value||je)&&M(Ce,"colorDpoit",0)}Ct&&r.timer.markEnd("Renderer.renderDpoitTransparent")},renderDpoitVolume:function(z,te,ae){Ct&&r.timer.mark("Renderer.renderDpoitVolume"),i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),N(z,te,ae,2,!1);for(var fe=z.renderables,he=0,pe=fe.length;he<pe;++he){var re=fe[he];"directVolume"===re.values.dGeometryType.ref.value&&M(re,"colorDpoit",0)}Ct&&r.timer.markEnd("Renderer.renderDpoitVolume")},setProps:function(z){void 0!==z.backgroundColor&&z.backgroundColor!==s.backgroundColor&&(s.backgroundColor=z.backgroundColor,dt.toVec3Normalized(d,s.backgroundColor),O.update(w.uFogColor,S.copy(w.uFogColor.ref.value,d))),void 0!==z.pickingAlphaThreshold&&z.pickingAlphaThreshold!==s.pickingAlphaThreshold&&(s.pickingAlphaThreshold=z.pickingAlphaThreshold,O.update(w.uPickingAlphaThreshold,s.pickingAlphaThreshold)),void 0!==z.interiorDarkening&&z.interiorDarkening!==s.interiorDarkening&&(s.interiorDarkening=z.interiorDarkening,O.update(w.uInteriorDarkening,s.interiorDarkening)),void 0!==z.interiorColorFlag&&z.interiorColorFlag!==s.interiorColorFlag&&(s.interiorColorFlag=z.interiorColorFlag,O.update(w.uInteriorColorFlag,s.interiorColorFlag)),void 0!==z.interiorColor&&z.interiorColor!==s.interiorColor&&(s.interiorColor=z.interiorColor,O.update(w.uInteriorColor,dt.toVec3Normalized(w.uInteriorColor.ref.value,s.interiorColor))),void 0!==z.colorMarker&&z.colorMarker!==s.colorMarker&&(s.colorMarker=z.colorMarker),void 0!==z.highlightColor&&z.highlightColor!==s.highlightColor&&(s.highlightColor=z.highlightColor,O.update(w.uHighlightColor,dt.toVec3Normalized(w.uHighlightColor.ref.value,s.highlightColor))),void 0!==z.selectColor&&z.selectColor!==s.selectColor&&(s.selectColor=z.selectColor,O.update(w.uSelectColor,dt.toVec3Normalized(w.uSelectColor.ref.value,s.selectColor))),void 0!==z.dimColor&&z.dimColor!==s.dimColor&&(s.dimColor=z.dimColor,O.update(w.uDimColor,dt.toVec3Normalized(w.uDimColor.ref.value,s.dimColor))),void 0!==z.highlightStrength&&z.highlightStrength!==s.highlightStrength&&(s.highlightStrength=z.highlightStrength,O.update(w.uHighlightStrength,s.highlightStrength)),void 0!==z.selectStrength&&z.selectStrength!==s.selectStrength&&(s.selectStrength=z.selectStrength,O.update(w.uSelectStrength,s.selectStrength)),void 0!==z.dimStrength&&z.dimStrength!==s.dimStrength&&(s.dimStrength=z.dimStrength,O.update(w.uDimStrength,s.dimStrength)),void 0!==z.markerPriority&&z.markerPriority!==s.markerPriority&&(s.markerPriority=z.markerPriority,O.update(w.uMarkerPriority,s.markerPriority)),void 0!==z.xrayEdgeFalloff&&z.xrayEdgeFalloff!==s.xrayEdgeFalloff&&(s.xrayEdgeFalloff=z.xrayEdgeFalloff,O.update(w.uXrayEdgeFalloff,s.xrayEdgeFalloff)),void 0!==z.exposure&&z.exposure!==s.exposure&&(s.exposure=z.exposure,O.update(w.uExposure,s.exposure)),void 0!==z.light&&!Nd(z.light,s.light)&&(s.light=z.light,Object.assign(u,Rie(z.light,u)),O.update(w.uLightDirection,u.direction),O.update(w.uLightColor,u.color)),void 0!==z.ambientColor&&z.ambientColor!==s.ambientColor&&(s.ambientColor=z.ambientColor,S.scale(T,dt.toArrayNormalized(s.ambientColor,T,0),s.ambientIntensity),O.update(w.uAmbientColor,T)),void 0!==z.ambientIntensity&&z.ambientIntensity!==s.ambientIntensity&&(s.ambientIntensity=z.ambientIntensity,S.scale(T,dt.toArrayNormalized(s.ambientColor,T,0),s.ambientIntensity),O.update(w.uAmbientColor,T))},setViewport:function(z,te,ae,fe){i.viewport(z,te,ae,fe),i.scissor(z,te,ae,fe),(z!==c.x||te!==c.y||ae!==c.width||fe!==c.height)&&(fo.set(c,z,te,ae,fe),O.update(w.uViewport,fr.set(w.uViewport.ref.value,z,te,ae,fe)))},setTransparentBackground:function(z){f=z},setDrawingBufferSize:function(z,te){(z!==l[0]||te!==l[1])&&O.update(w.uDrawingBufferSize,Ne.set(l,z,te))},setPixelRatio:function(z){O.update(w.uPixelRatio,z)},props:s,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},get light(){return u},dispose:function(){}}}}(f5||(f5={})),function(e){function o(l){return l.triggers.map(u.format).join(" or ")}function u(l,d){return u.create(l,d)}var l;e.create=function t(l,d,f){return void 0===d&&(d=""),void 0===f&&(f=""),{triggers:l,action:d,description:f}},e.isBinding=function r(l){return!!l&&Array.isArray(l.triggers)&&"string"==typeof l.action},e.Empty={triggers:[],action:"",description:""},e.isEmpty=function n(l){return 0===l.triggers.length||l.triggers.every(function(d){return void 0===d.buttons&&void 0===d.modifiers&&!d.code})},e.match=function a(l,d,f){return l.triggers.some(function(p){return u.match(p,d,f)})},e.matchKey=function i(l,d,f,p){return l.triggers.some(function(h){return u.matchKey(h,d,f,p)})},e.formatTriggers=o,e.format=function s(l,d){return void 0===d&&(d=""),function pPe(e,t){var r=Object.keys(t),n=Object.values(t);return(new(Function.bind.apply(Function,sr(sr([void 0],r,!1),["return `".concat(e,"`;")],!1)))).apply(void 0,n)}(l.description||kc(d),{triggers:"<i>"+o(l)+"</i>"})},e.Trigger=u,e.TriggerKey=function c(l,d){return u.create(void 0,d,l)},(l=u=e.Trigger||(e.Trigger={})).create=function d(m,v,g){return{buttons:m,modifiers:v,code:g}},l.Empty={},l.match=function f(m,v,g){var y=m.buttons,b=m.modifiers;return void 0!==y&&(y===v||Ya.has(y,v))&&(!b||bc.areEqual(b,g))},l.matchKey=function p(m,v,g,y){var b=m.modifiers,_=m.code;return void 0!==_&&(_===v||1===_.length&&4===v.length&&v.startsWith("Key")&&!!y&&1===y.length&&y.toUpperCase()===_.toUpperCase())&&(!b||bc.areEqual(b,g))},l.format=function h(m){var v=[],g=function SQe(e,t){var r=[];return void 0!==e||t?0===e?r.push("mouse hover"):void 0!==e&&(Sm.has(e,Sm.Flag.Primary)&&r.push("left mouse button"),Sm.has(e,Sm.Flag.Secondary)&&r.push("right mouse button"),Sm.has(e,Sm.Flag.Auxilary)&&r.push("wheel/middle mouse button"),Sm.has(e,Sm.Flag.Forth)&&r.push("three fingers")):r.push("any mouse button"),r.join(" + ")}(m.buttons,m.code);g&&v.push(g);var y=function xQe(e){return e?.startsWith("Key")&&(e=e.substring(3)),e&&function lPe(e){return Rv(eK(e))}(e).toLowerCase()}(m.code);y&&v.push(y);var b=function CQe(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&0===r.length&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}(m.modifiers);return b&&v.push(b),v.join(" + ")}}(Dt||(Dt={}));var p5,FE,Sm=Ya,Cm=Ya,_c=bc,xm=Dt.Trigger,Bu=Dt.TriggerKey,Oie={dragRotate:Dt([xm(Cm.Flag.Primary,_c.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:Dt([xm(Cm.Flag.Primary,_c.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:Dt([xm(Cm.Flag.Secondary,_c.create()),xm(Cm.Flag.Primary,_c.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:Dt.Empty,dragFocus:Dt([xm(Cm.Flag.Forth,_c.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:Dt([xm(Cm.Flag.Auxilary,_c.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:Dt([xm(Cm.Flag.Auxilary,_c.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:Dt([xm(Cm.Flag.Auxilary,_c.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:Dt.Empty,keyMoveForward:Dt([Bu("KeyW")],"Move forward","Press ${triggers}"),keyMoveBack:Dt([Bu("KeyS")],"Move back","Press ${triggers}"),keyMoveLeft:Dt([Bu("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:Dt([Bu("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:Dt([Bu("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:Dt([Bu("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:Dt([Bu("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:Dt([Bu("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:Dt([Bu("ArrowUp",_c.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:Dt([Bu("ArrowDown",_c.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:Dt([Bu("ArrowLeft",_c.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:Dt([Bu("ArrowRight",_c.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:Dt([Bu("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:Dt([Bu("Space",_c.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},Fie={noScroll:D.Boolean(!0,{isHidden:!0}),rotateSpeed:D.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:D.Numeric(7,{min:1,max:15,step:1}),panSpeed:D.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:D.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:D.Numeric(5,{min:.1,max:10,step:.1}),flyMode:D.Boolean(!1),animate:D.MappedStatic("off",{off:D.EmptyGroup(),spin:D.Group({speed:D.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:D.Group({speed:D.Numeric(.3,{min:-5,max:5,step:.1}),angle:D.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:D.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:D.Numeric(.2,{},{isHidden:!0}),minDistance:D.Numeric(.01,{},{isHidden:!0}),maxDistance:D.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:D.Numeric(1,{},{isHidden:!0}),maxWheelDelta:D.Numeric(.02,{},{isHidden:!0}),bindings:D.Value(Oie,{isHidden:!0}),autoAdjustMinMaxDistance:D.MappedStatic("on",{off:D.EmptyGroup(),on:D.Group({minDistanceFactor:D.Numeric(0),minDistancePadding:D.Numeric(5),maxDistanceFactor:D.Numeric(10),maxDistanceMin:D.Numeric(20)})},{isHidden:!0})};!function(e){e.create=function t(r,n,a,i){void 0===i&&(i={});var o=R(R(R({},D.getDefaultValues(Fie)),i),{bindings:R(R({},Oie),i.bindings)}),s=o.bindings,u=fo.clone(n.viewport),c=!1,l=r.drag.subscribe(function St(Ze){var yt=Ze.x,Yt=Ze.y,Dr=Ze.pageX,ga=Ze.pageY,Ia=Ze.buttons,ss=Ze.modifiers,Tl=Ze.isStart,us=_t(yt,Yt);if((!Tl||!us)&&(Tl||_)){_=!0,Ym();var hh=Dt.match(s.dragRotate,Ia,ss),Xm=Dt.match(s.dragRotateZ,Ia,ss),Km=Dt.match(s.dragPan,Ia,ss),M1=Dt.match(s.dragZoom,Ia,ss),So=Dt.match(s.dragFocus,Ia,ss),Of=Dt.match(s.dragFocusZoom,Ia,ss);Z(Dr,ga),function Y(Ze,yt){Ne.set(L,(Ze-u.x)/u.width,(yt-u.y)/u.height)}(Dr,ga);var Ls=r.pixelRatio,z3=(yt*Ls-u.width/2-u.x)/u.width,G3=-(r.height-Yt*Ls-u.height/2-u.y)/u.height;if(Tl&&(hh&&(Ne.copy(T,$),Ne.copy(A,T)),Xm&&(Ne.set(M,z3,G3),Ne.copy(I,M)),(M1||Of)&&(Ne.copy(k,L),Ne.copy(H,k)),So&&(Ne.copy(G,L),Ne.copy(U,G)),Km&&(Ne.copy(Q,L),Ne.copy(W,Q))),hh&&Ne.copy(T,$),Xm&&Ne.set(M,z3,G3),(M1||Of)&&Ne.copy(H,L),So&&Ne.copy(U,L),Of){var n0=S.distance(n.state.position,n.state.target);n.setState({radius:n0/5})}Km&&Ne.copy(W,L)}}),d=r.interactionEnd.subscribe(function bt(){_=!1}),f=r.wheel.subscribe(function Mt(Ze){var Dr=Ze.spinX,ga=Ze.spinY,Ia=Ze.dz,ss=Ze.buttons,Tl=Ze.modifiers;if(!_t(Ze.x,Ze.y)){var us=function IDe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}(.075*Dr,.075*ga,1e-4*Ia);us<-o.maxWheelDelta?us=-o.maxWheelDelta:us>o.maxWheelDelta&&(us=o.maxWheelDelta),Dt.match(s.scrollZoom,ss,Tl)&&(H[1]+=us),Dt.match(s.scrollFocus,ss,Tl)&&(U[1]+=us)}}),p=r.pinch.subscribe(function Rt(Ze){var yt=Ze.fractionDelta;Dt.match(s.scrollZoom,Ze.buttons,Ze.modifiers)&&(_=!0,H[1]+=o.gestureScaleFactor*yt)}),h=r.gesture.subscribe(function oe(Ze){_=!0,H[1]+=o.gestureScaleFactor*Ze.deltaScale}),m=r.keyDown.subscribe(function Se(Ze){var yt=Ze.modifiers,Yt=Ze.code,Dr=Ze.key;_t(Ze.x,Ze.y)||(Dt.matchKey(s.keyMoveForward,Yt,yt,Dr)?Pe.moveForward=1:Dt.matchKey(s.keyMoveBack,Yt,yt,Dr)?Pe.moveBack=1:Dt.matchKey(s.keyMoveLeft,Yt,yt,Dr)?Pe.moveLeft=1:Dt.matchKey(s.keyMoveRight,Yt,yt,Dr)?Pe.moveRight=1:Dt.matchKey(s.keyMoveUp,Yt,yt,Dr)?Pe.moveUp=1:Dt.matchKey(s.keyMoveDown,Yt,yt,Dr)?Pe.moveDown=1:Dt.matchKey(s.keyRollLeft,Yt,yt,Dr)?Pe.rollLeft=1:Dt.matchKey(s.keyRollRight,Yt,yt,Dr)?Pe.rollRight=1:Dt.matchKey(s.keyPitchUp,Yt,yt,Dr)?Pe.pitchUp=1:Dt.matchKey(s.keyPitchDown,Yt,yt,Dr)?Pe.pitchDown=1:Dt.matchKey(s.keyYawLeft,Yt,yt,Dr)?Pe.yawLeft=1:Dt.matchKey(s.keyYawRight,Yt,yt,Dr)&&(Pe.yawRight=1),Dt.matchKey(s.boostMove,Yt,yt,Dr)&&(Pe.boostMove=1),Dt.matchKey(s.enablePointerLock,Yt,yt,Dr)&&r.requestPointerLock(u))}),v=r.keyUp.subscribe(function Qe(Ze){var yt,Yt,Dr,ga,Ia,ss,Tl,us,hh,Xm,Km,M1,So=Ze.modifiers,Of=Ze.code,Ls=Ze.key;if(!_t(Ze.x,Ze.y)){var n0=!1;Of.startsWith("Alt")?(n0=!0,So.alt=!0):Of.startsWith("Shift")?(n0=!0,So.shift=!0):Of.startsWith("Control")?(n0=!0,So.control=!0):Of.startsWith("Meta")&&(n0=!0,So.meta=!0);var ju=[];n0?(Pe.moveForward&&ju.push((null===(yt=s.keyMoveForward.triggers[0])||void 0===yt?void 0:yt.code)||""),Pe.moveBack&&ju.push((null===(Yt=s.keyMoveBack.triggers[0])||void 0===Yt?void 0:Yt.code)||""),Pe.moveLeft&&ju.push((null===(Dr=s.keyMoveLeft.triggers[0])||void 0===Dr?void 0:Dr.code)||""),Pe.moveRight&&ju.push((null===(ga=s.keyMoveRight.triggers[0])||void 0===ga?void 0:ga.code)||""),Pe.moveUp&&ju.push((null===(Ia=s.keyMoveUp.triggers[0])||void 0===Ia?void 0:Ia.code)||""),Pe.moveDown&&ju.push((null===(ss=s.keyMoveDown.triggers[0])||void 0===ss?void 0:ss.code)||""),Pe.rollLeft&&ju.push((null===(Tl=s.keyRollLeft.triggers[0])||void 0===Tl?void 0:Tl.code)||""),Pe.rollRight&&ju.push((null===(us=s.keyRollRight.triggers[0])||void 0===us?void 0:us.code)||""),Pe.pitchUp&&ju.push((null===(hh=s.keyPitchUp.triggers[0])||void 0===hh?void 0:hh.code)||""),Pe.pitchDown&&ju.push((null===(Xm=s.keyPitchDown.triggers[0])||void 0===Xm?void 0:Xm.code)||""),Pe.yawLeft&&ju.push((null===(Km=s.keyYawLeft.triggers[0])||void 0===Km?void 0:Km.code)||""),Pe.yawRight&&ju.push((null===(M1=s.keyYawRight.triggers[0])||void 0===M1?void 0:M1.code)||"")):ju.push(Of);for(var qV=0,ape=ju;qV<ape.length;qV++){var Dl=ape[qV];Dt.matchKey(s.keyMoveForward,Dl,So,Ls)?Pe.moveForward=0:Dt.matchKey(s.keyMoveBack,Dl,So,Ls)?Pe.moveBack=0:Dt.matchKey(s.keyMoveLeft,Dl,So,Ls)?Pe.moveLeft=0:Dt.matchKey(s.keyMoveRight,Dl,So,Ls)?Pe.moveRight=0:Dt.matchKey(s.keyMoveUp,Dl,So,Ls)?Pe.moveUp=0:Dt.matchKey(s.keyMoveDown,Dl,So,Ls)?Pe.moveDown=0:Dt.matchKey(s.keyRollLeft,Dl,So,Ls)?Pe.rollLeft=0:Dt.matchKey(s.keyRollRight,Dl,So,Ls)?Pe.rollRight=0:Dt.matchKey(s.keyPitchUp,Dl,So,Ls)?Pe.pitchUp=0:Dt.matchKey(s.keyPitchDown,Dl,So,Ls)?Pe.pitchDown=0:Dt.matchKey(s.keyYawLeft,Dl,So,Ls)?Pe.yawLeft=0:Dt.matchKey(s.keyYawRight,Dl,So,Ls)&&(Pe.yawRight=0)}Dt.matchKey(s.boostMove,Of,So,Ls)&&(Pe.boostMove=0)}}),g=r.move.subscribe(function be(Ze){var yt=Ze.movementX,Yt=Ze.movementY;if(r.pointerLock&&void 0!==yt&&void 0!==Yt){var Dr=.5*u.width-u.x,ga=.5*u.height-u.y;Ne.copy(A,Z(Dr,ga)),Ne.copy(T,Z(yt+Dr,Yt+ga))}}),y=r.lock.subscribe(function Zt(Ze){Ze?Et():At()}),b=r.leave.subscribe(function rr(){!function Ir(){Pe.moveForward=0,Pe.moveBack=0,Pe.moveLeft=0,Pe.moveRight=0,Pe.moveUp=0,Pe.moveDown=0,Pe.rollLeft=0,Pe.rollRight=0,Pe.pitchUp=0,Pe.pitchDown=0,Pe.yawLeft=0,Pe.yawRight=0,Pe.boostMove=0}()}),_=!1,C=S(),x=S(),A=Ne(),T=Ne(),w=S(),E=0,I=Ne(),M=Ne(),F=0,N=0,j=0,k=Ne(),H=Ne(),G=Ne(),U=Ne(),Q=Ne(),W=Ne(),K=S.clone(n.target),ne=S.clone(n.position),X=S.clone(n.up),L=Ne(),$=Ne();function Z(Ze,yt){return Ne.set($,(Ze-.5*u.width-u.x)/(.5*u.width),(u.height+2*(u.y-yt))/u.width)}function q(){return o.rotateSpeed*r.pixelRatio*(r.width/r.height)}var z=S(),te=yn(),ae=S(),fe=S(),he=S(),pe=S(),ee=yn(),ue=S(),Ce=yn(),ze=S(),V=yn(),J=S(),Fe=Ne(),ke=S(),Ue=S(),Pe={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},He=S(),Je=S();function ut(){var Ze=Math.min(Math.max(1e3*n.state.radiusMax,.01),o.maxDistance);S.squaredMagnitude(x)>Ze*Ze&&(S.setMagnitude(x,x,Ze),S.add(n.position,n.target,x),Ne.copy(k,H),Ne.copy(G,U)),S.squaredMagnitude(x)<o.minDistance*o.minDistance&&(S.setMagnitude(x,x,o.minDistance),S.add(n.position,n.target,x),Ne.copy(k,H),Ne.copy(G,U))}function _t(Ze,yt){return yt*=r.pixelRatio,(Ze*=r.pixelRatio)>u.x+u.width||r.height-yt>u.y+u.height||Ze<u.x||r.height-yt<u.y}var wt=-1;function Le(Ze){if(wt!==Ze){var yt=Ze-wt;wt>0&&("spin"===o.animate.name?function _o(Ze){if("spin"===o.animate.name&&0!==o.animate.params.speed&&!_){var yt=o.animate.params.speed/1e3;na[0]=60*Math.min(Math.abs(Ze),125)/1e3*yt,Ne.add(T,A,na)}}(yt):"rock"===o.animate.name&&function Rf(Ze){if("rock"===o.animate.name&&0!==o.animate.params.speed&&!_){var yt=Ze/1e3*o.animate.params.speed,Yt=Zr(o.animate.params.angle)/q(),Dr=Math.sin(Za*Math.PI*2)*Yt,ga=Math.sin((Za+yt)*Math.PI*2)*Yt;Ji[0]=ga-Dr,Ne.add(T,A,Ji),(Za+=yt)>=1&&(Za=0)}}(yt)),S.sub(x,n.position,n.target),function re(){var Ze=T[0]-A[0],yt=T[1]-A[1];S.set(pe,Ze,yt,0);var Yt=S.magnitude(pe)*q();Yt?(S.sub(x,n.position,n.target),S.normalize(ae,x),S.normalize(fe,n.up),S.normalize(he,S.cross(he,fe,ae)),S.setMagnitude(fe,fe,yt),S.setMagnitude(he,he,Ze),S.add(pe,fe,he),S.normalize(z,S.cross(z,pe,x)),yn.setAxisAngle(te,z,Yt),S.transformQuat(x,x,te),S.transformQuat(n.up,n.up,te),S.copy(w,z),E=Yt):!o.staticMoving&&E&&(E*=Math.sqrt(1-o.dynamicDampingFactor),S.sub(x,n.position,n.target),yn.setAxisAngle(te,w,E),S.transformQuat(x,x,te),S.transformQuat(n.up,n.up,te)),Ne.copy(A,T)}(),function ge(){var Ze=(Pe.rollRight-Pe.rollLeft)/45,yt=(M[0]-I[0])*-Math.sign(M[1]),Yt=(M[1]-I[1])*-Math.sign(M[0]),Dr=-o.rotateSpeed*(-yt+Yt)+Ze;Dr?(S.normalize(ue,x),yn.setAxisAngle(ee,ue,Dr),S.transformQuat(n.up,n.up,ee),F=Dr):!o.staticMoving&&F&&(F*=Math.sqrt(1-o.dynamicDampingFactor),S.normalize(ue,x),yn.setAxisAngle(ee,ue,F),S.transformQuat(n.up,n.up,ee)),Ne.copy(I,M)}(),function je(){var yt=(Pe.pitchUp-Pe.pitchDown)/(o.flyMode?360:90)*-o.rotateSpeed;yt?(S.cross(ze,x,n.up),S.normalize(ze,ze),yn.setAxisAngle(Ce,ze,yt),S.transformQuat(x,x,Ce),S.transformQuat(n.up,n.up,Ce),N=yt):!o.staticMoving&&N&&(N*=Math.sqrt(1-o.dynamicDampingFactor),S.cross(ze,x,n.up),S.normalize(ze,ze),yn.setAxisAngle(Ce,ze,N),S.transformQuat(x,x,Ce),S.transformQuat(n.up,n.up,Ce))}(),function ye(){var yt=(Pe.yawRight-Pe.yawLeft)/(o.flyMode?360:90)*-o.rotateSpeed;yt?(S.normalize(J,n.up),yn.setAxisAngle(V,J,yt),S.transformQuat(x,x,V),S.transformQuat(n.up,n.up,V),j=yt):!o.staticMoving&&j&&(j*=Math.sqrt(1-o.dynamicDampingFactor),S.normalize(J,n.up),yn.setAxisAngle(V,J,j),S.transformQuat(x,x,V),S.transformQuat(n.up,n.up,V))}(),function we(){var Ze=1+(H[1]-k[1])*o.zoomSpeed;1!==Ze&&Ze>0&&S.scale(x,x,Ze),o.staticMoving?Ne.copy(k,H):k[1]+=(H[1]-k[1])*o.dynamicDampingFactor}(),function Ee(){var Ze=(U[1]-G[1])*o.zoomSpeed;if(0!==Ze){var yt=Math.max(1,n.state.radius+n.state.radius*Ze);n.setState({radius:yt})}o.staticMoving?Ne.copy(G,U):G[1]+=(U[1]-G[1])*o.dynamicDampingFactor}(),function $e(){if(Ne.sub(Fe,Ne.copy(Fe,W),Q),Ne.squaredMagnitude(Fe)){var Ze=r.pixelRatio*o.panSpeed;Fe[0]*=1/n.zoom*n.viewport.width*Ze,Fe[1]*=1/n.zoom*n.viewport.height*Ze,S.cross(Ue,S.copy(Ue,x),n.up),S.setMagnitude(Ue,Ue,Fe[0]),S.setMagnitude(ke,n.up,Fe[1]),S.add(Ue,Ue,ke),S.add(n.position,n.position,Ue),S.add(n.target,n.target,Ue),o.staticMoving?Ne.copy(Q,W):(Ne.sub(Fe,W,Q),Ne.scale(Fe,Fe,o.dynamicDampingFactor),Ne.add(Q,Q,Fe))}}(),S.add(n.position,n.target,x),ut(),wt>0&&function vt(Ze){S.sub(Je,n.position,n.target);var yt=Math.max(n.state.minNear,o.minDistance);S.setMagnitude(Je,Je,yt);var Yt=.06*Ze*o.moveSpeed*(1===Pe.boostMove?o.boostMoveFactor:1);if(1===Pe.moveForward&&(S.normalize(He,Je),S.scaleAndSub(n.position,n.position,He,Yt),(o.flyMode||r.pointerLock)&&S.sub(n.target,n.position,Je)),1===Pe.moveBack&&(S.normalize(He,Je),S.scaleAndAdd(n.position,n.position,He,Yt),(o.flyMode||r.pointerLock)&&S.sub(n.target,n.position,Je)),1===Pe.moveLeft&&(S.cross(He,Je,n.up),S.normalize(He,He),o.flyMode||r.pointerLock?(S.scaleAndAdd(n.position,n.position,He,Yt),S.sub(n.target,n.position,Je)):(S.scaleAndSub(n.position,n.position,He,Yt),S.sub(n.target,n.position,x))),1===Pe.moveRight&&(S.cross(He,Je,n.up),S.normalize(He,He),o.flyMode||r.pointerLock?(S.scaleAndSub(n.position,n.position,He,Yt),S.sub(n.target,n.position,Je)):(S.scaleAndAdd(n.position,n.position,He,Yt),S.sub(n.target,n.position,x))),1===Pe.moveUp&&(S.normalize(He,n.up),o.flyMode||r.pointerLock?(S.scaleAndAdd(n.position,n.position,He,Yt),S.sub(n.target,n.position,Je)):(S.scaleAndSub(n.position,n.position,He,Yt),S.sub(n.target,n.position,x))),1===Pe.moveDown&&(S.normalize(He,n.up),o.flyMode||r.pointerLock?(S.scaleAndSub(n.position,n.position,He,Yt),S.sub(n.target,n.position,Je)):(S.scaleAndAdd(n.position,n.position,He,Yt),S.sub(n.target,n.position,x))),o.flyMode||r.pointerLock){var Dr=S.distance(n.position,a.boundingSphereVisible.center);n.setState({minFar:Dr+a.boundingSphereVisible.radius})}}(Math.min(yt,250)),S.sub(x,n.position,n.target),ut(),S.squaredDistance(C,n.position)>gn&&S.copy(C,n.position),wt=Ze}}function Et(){S.sub(Je,n.position,n.target);var Ze=Math.max(n.state.minNear,o.minDistance);S.setMagnitude(Je,Je,Ze),S.sub(n.target,n.position,Je);var yt=S.distance(n.position,a.boundingSphereVisible.center);n.setState({minFar:yt+a.boundingSphereVisible.radius})}function At(){var Ze=a.boundingSphereVisible,yt=Ze.center,Yt=Ze.radius;if(S.distance(n.position,yt)>Yt){var ga=n.getFocus(yt,Yt);n.setState(R(R({},ga),{minFar:0}))}else n.setState({minFar:0,radius:a.boundingSphereVisible.radius})}var na=Ne.create(.005,0),Za=0,Ji=Ne.create(.005,0);function Ym(){Za=0}return{viewport:u,get isAnimating(){return"off"!==o.animate.name},get isMoving(){return 1===Pe.moveForward||1===Pe.moveBack||1===Pe.moveLeft||1===Pe.moveRight||1===Pe.moveUp||1===Pe.moveDown||1===Pe.rollLeft||1===Pe.rollRight||1===Pe.pitchUp||1===Pe.pitchDown||1===Pe.yawLeft||1===Pe.yawRight},get props(){return o},setProps:function(Ze){var yt;"rock"===(null===(yt=Ze.animate)||void 0===yt?void 0:yt.name)&&"rock"!==o.animate.name&&Ym(),void 0!==Ze.flyMode&&Ze.flyMode!==o.flyMode&&(Ze.flyMode?Et():At()),Object.assign(o,Ze),Object.assign(s,Ze.bindings)},start:function Ge(Ze){wt=-1,Le(Ze)},update:Le,reset:function st(){S.copy(n.target,K),S.copy(n.position,ne),S.copy(n.up,X),S.sub(x,n.position,n.target),S.copy(C,n.position)},dispose:function mn(){c||(c=!0,l.unsubscribe(),f.unsubscribe(),p.unsubscribe(),h.unsubscribe(),d.unsubscribe(),m.unsubscribe(),v.unsubscribe(),g.unsubscribe(),y.unsubscribe(),b.unsubscribe())}}}}(p5||(p5={})),function(e){e.create=function t(){return{view:me.identity(),position:S.create(0,0,0),direction:S.create(0,0,-1),up:S.create(0,1,0)}};var r=S.zero();e.update=function n(a){S.add(r,a.position,a.direction),me.lookAt(a.view,a.position,r,a.up)}}(FE||(FE={}));var Pb,wQe=function(){function e(){this.removeList=xN(),this.removeMap=new Map,this.addList=xN(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.removeList.count&&0===this.addList.count},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.removeMap.size+this.addMap.size},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),bC=new oc("98");function Nie(e,t,r){bC.reset();for(var n=0,a=e.length;n<a;++n)if(!r||e[n].state.visible){var i=e[n].values.boundingSphere.ref.value;i.radius&&bC.includeSphere(i)}for(bC.finishedIncludeStep(),n=0,a=e.length;n<a;++n)if(!r||e[n].state.visible){var o=e[n].values.boundingSphere.ref.value;o.radius&&bC.radiusSphere(o)}return bC.getSphere(t)}function AQe(e,t){var r=(e.getProgram("colorBlended")||e.getProgram("colorWboit")||e.getProgram("colorDpoit")).id,n=(t.getProgram("colorBlended")||t.getProgram("colorWboit")||t.getProgram("colorDpoit")).id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}!function(e){e.create=function t(r,n){void 0===n&&(n=WD);var a=new Map,i=[],o=De(),s=De(),u=[],c=[],l=!0,d=!0,f=!0,p=!0,h=!0,m=0,v=0,g=!1,y=FE.create(),b=y.view,_=y.position,C=y.direction,x=y.up;function A(G){if(a.has(G))console.warn("RenderObject with id '".concat(G.id,"' already present"));else{var U=function CHe(e,t,r){switch(t.type){case"mesh":return function oHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),iHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",YJ,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"points":return function uHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),sHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"points",sVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"spheres":return function fHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),dHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",uVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"cylinders":return function _He(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),bHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",cVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"text":return function hHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),pHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",lVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"lines":return function lHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),cHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",dVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"direct-volume":return function aHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),nHe);e.isWebGL2||(o.uMaxSteps=Ut("number"));var s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",fVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"image":return function yHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),gHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",pVe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"texture-mesh":return function vHe(e,t,r,n,a,i){var o=R(R(R(R({},Op),Fp),Np),mHe),s={uObjectId:O.create(t)};return Lp(Bp(e,"triangles",YJ,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r)}throw new Error("unsupported type")}(r,G,n);i.push(U),"direct-volume"===G.type?c.push(U):u.push(U),a.set(G,U),l=!0,d=!0}}function T(G){var U=a.get(G);U&&(U.dispose(),Tv(i,U),Tv(u,U),Tv(c,U),a.delete(G),l=!0,d=!0)}var I=new wQe,M=-1;function N(){var G=function F(){for(var G=23,U=0,Q=i.length;U<Q;++U)i[U].state.visible&&(G=31*G+i[U].id|0);return-1===(G=vX(G))&&(G=0),G}();return G!==M&&(d=!0,f=!0,p=!0,h=!0,M=G,!0)}return{view:b,position:_,direction:C,up:x,renderables:i,primitives:{view:b,position:_,direction:C,up:x,renderables:u},volumes:{view:b,position:_,direction:C,up:x,renderables:c},syncVisibility:N,update:function(G,U){var Q;if(FE.update(y),G)for(var W=0,K=G.length;W<K;++W)null===(Q=a.get(G[W]))||void 0===Q||Q.update();else for(W=0,K=i.length;W<K;++W)i[W].update();U?N():(l=!0,d=!0),f=!0,p=!0,h=!0},add:function(G){return I.add(G)},remove:function(G){return I.remove(G)},commit:function(G){return void 0===G&&(G=Number.MAX_VALUE),function E(G){for(var U=da(),Q=0;W=I.tryGetRemove();)if(T(W),++Q%100==0&&da()-U>G)return!1;for(;;){var W;if(!(W=I.tryGetAdd()))break;if(A(W),++Q%100==0&&da()-U>G)return!1}return i.sort(AQe),f=!0,p=!0,h=!0,!0}(G)},get commitQueueSize(){return I.size},get needsCommit(){return!I.isEmpty},has:function(G){return a.has(G)},clear:function(){for(var G=0,U=i.length;G<U;++G)i[G].dispose();i.length=0,u.length=0,c.length=0,a.clear(),l=!0,d=!0},forEach:function(G){a.forEach(G)},get count(){return i.length},get boundingSphere(){return l&&(Nie(i,o,!1),l=!1),o},get boundingSphereVisible(){return d&&(Nie(i,s,!0),d=!1),s},get markerAverage(){return f&&(m=function j(){if(0===u.length)return 0;for(var G=0,U=0,Q=0,W=u.length;Q<W;++Q)u[Q].state.visible&&(U+=u[Q].values.markerAverage.ref.value,G+=1);return G>0?U/G:0}(),f=!1),m},get opacityAverage(){return p&&(v=function k(){var G,U;if(0===u.length)return 0;for(var Q=0,W=0,K=0,ne=u.length;K<ne;++K){var X=u[K];if(X.state.visible){var L=ao(X.values.alpha.ref.value*X.state.alphaFactor,0,1),Y=null!==(G=X.values.dXrayShaded)&&void 0!==G&&G.ref.value?.5:1,$="fuzzy"===(null===(U=X.values.dPointStyle)||void 0===U?void 0:U.ref.value)?.5:1;W+=(1-X.values.transparencyAverage.ref.value)*L*Y*$*("text"===X.values.dGeometryType.ref.value?.5:1),Q+=1}}return Q>0?W/Q:0}(),p=!1),v},get hasOpaque(){return h&&(g=function H(){var G;if(0===u.length)return!1;for(var U=0,Q=u.length;U<Q;++U){var W=u[U];if(W.state.visible&&(W.state.opaque||1===W.state.alphaFactor&&1===W.values.alpha.ref.value&&1!==W.values.transparencyAverage.ref.value||"opaque"===(null===(G=W.values.dTransparentBackfaces)||void 0===G?void 0:G.ref.value)))return!0}return!1}(),h=!1),g}}}}(Pb||(Pb={}));var h5=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=Xa.createDefaultSnapshot(),this._target=Xa.createDefaultSnapshot(),this._current=Xa.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){void 0===r&&(r=0),(!this.inTransition||r>0)&&Xa.copySnapshot(this._source,this.camera.state),this.inTransition||Xa.copySnapshot(this._target,this.camera.state),Xa.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode?this.finish(this._target):(this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r))},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){Xa.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(1===t)return void this.finish(this._target);this.func(this._current,t,this._source,this._target),Xa.copySnapshot(this.camera.state,this._current)}},e}();!function(e){var t=yn.identity();e.defaultTransition=function r(n,a,i,o){Xa.copySnapshot(n,o),yn.slerp(t,yn.Identity,yn.rotationTo(t,i.up,o.up),a),S.transformQuat(n.up,i.up,t),S.lerp(n.target,i.target,o.target,a),S.lerp(n.position,i.position,o.position,a),n.radius=oa(i.radius,o.radius,a),n.radiusMax=oa(i.radiusMax,o.radiusMax,a),n.fov=oa(i.fov,o.fov,a),n.fog=oa(i.fog,o.fog,a)}}(h5||(h5={}));var kie=S(),Bie=S(),NE=fr(),Xa=function(){function e(t,r,n){void 0===r&&(r=fo.create(0,0,128,128)),void 0===n&&(n={}),this.view=me.identity(),this.projection=me.identity(),this.projectionView=me.identity(),this.inverseProjectionView=me.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new h5(this),this.stateChanged=new Li(this.state),this.prevProjection=me.identity(),this.prevView=me.identity(),this.deltaDirection=S(),this.newPosition=S(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return(typeof window<"u"?window.devicePixelRatio:1)*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){S.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){S.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){S.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(0===t.radiusMax)return!1;var r=2*Math.tan(t.fov/2)*S.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,function EQe(e){var t=e.state,r=t.radius,n=t.radiusMax,i=t.fog,s=t.minNear;r<.01&&(r=.01);var c=Math.max(t.clipFar?r:n,t.minFar),l=S.distance(e.position,e.target),d=l-r,f=l+c;(d=Math.max(Math.min(n,s),d))===(f=Math.max(s,f))&&(f=d+.01);var h=l-c*(-(50-i)/50),m=f;e.near=d,e.far=f,e.fogNear=h,e.fogFar=m}(this),this.state.mode){case"orthographic":!function TQe(e){var t=e.viewport,r=e.zoom,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,c=-t.height/2,l=(s-o)/(2*r),d=(u-c)/(2*r),f=(s+o)/2,p=(u+c)/2,h=f-l,m=f+l,v=p+d,g=p-d;if(i.enabled){var y=r/(i.width/i.fullWidth),b=r/(i.height/i.fullHeight),_=(s-o)/i.width,C=(u-c)/i.height;m=(h+=_*(i.offsetX/y))+_*(i.width/y),g=(v-=C*(i.offsetY/b))-C*(i.height/b)}me.ortho(e.projection,h,m,v,g,e.near,e.far),me.lookAt(e.view,e.position,e.target,e.up)}(this);break;case"perspective":!function DQe(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),me.perspective(e.projection,u,u+s,i,i-o,r,n),me.lookAt(e.view,e.position,e.target,e.up)}(this);break;default:xn()}var n=!me.areEqual(this.projection,this.prevProjection,gn)||!me.areEqual(this.view,this.prevView,gn);if(n){if(me.mul(this.projectionView,this.projection,this.view),!me.tryInvert(this.inverseProjectionView,this.projectionView))return me.copy(this.view,this.prevView),me.copy(this.projection,this.prevProjection),me.mul(this.projectionView,this.projection,this.view),!1;me.copy(this.prevView,this.view),me.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a,i){var o,s,u=Math.max(r,.01),c=this.getTargetDistance(u);S.sub(this.deltaDirection,null!==(o=i?.target)&&void 0!==o?o:this.target,null!==(s=i?.position)&&void 0!==s?s:this.position),a&&S.matchDirection(this.deltaDirection,a,this.deltaDirection),S.setMagnitude(this.deltaDirection,this.deltaDirection,c),S.sub(this.newPosition,t,this.deltaDirection);var l=e.copySnapshot(e.createDefaultSnapshot(),this.state);return l.target=S.clone(t),l.radius=u,l.position=S.clone(this.newPosition),n&&S.matchDirection(l.up,n,l.up),l},e.prototype.getCenter=function(t,r){S.sub(this.deltaDirection,this.target,this.position),S.sub(this.newPosition,t,this.deltaDirection);var n=e.copySnapshot(e.createDefaultSnapshot(),this.state);return n.target=S.clone(t),n.position=S.clone(this.newPosition),r&&(n.radius=Math.max(r,.01)),n},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);S.copy(this.deltaDirection,a),S.setMagnitude(this.deltaDirection,this.deltaDirection,o),S.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=S.clone(t),s.radius=i,s.position=S.clone(this.newPosition),S.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.center=function(t,r){this.setState(this.getCenter(t),r)},e.prototype.project=function(t,r){return function yQe(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;fr.set(hf,t[0],t[1],t[2],1),fr.transformMat4(hf,hf,n);var u=hf[3];return 0!==u&&(hf[0]/=u,hf[1]/=u,hf[2]/=u),e[0]=(hf[0]+1)*o*.5+a,e[1]=(hf[1]+1)*s*.5+i,e[2]=.5*(hf[2]+1),e[3]=0===u?0:1/u,e}(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return RE(t,r,this.viewport,this.inverseProjectionView)},e.prototype.getPixelSize=function(t){return this.project(NE,t),this.unproject(kie,NE),NE[0]+=1,this.unproject(Bie,NE),S.distance(kie,Bie)},e}();!function(e){e.ViewOffset=function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}},e.setViewOffset=function r(u,c,l,d,f,p,h){u.fullWidth=c,u.fullHeight=l,u.offsetX=d,u.offsetY=f,u.width=p,u.height=h},e.copyViewOffset=function n(u,c){u.enabled=c.enabled,u.fullWidth=c.fullWidth,u.fullHeight=c.fullHeight,u.offsetX=c.offsetX,u.offsetY=c.offsetY,u.width=c.width,u.height=c.height},e.targetDistance=function a(u,c,l,d,f){var p=Math.max(u,.01),m=f<d?1:d/f;return Math.abs("orthographic"===c?p/m/Math.tan(l/2):p/m/Math.sin(l/2))},e.createDefaultSnapshot=function i(){return{mode:"perspective",fov:Math.PI/4,position:S.create(0,0,100),up:S.create(0,1,0),target:S.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}},e.copySnapshot=function o(u,c){return c&&(typeof c.mode<"u"&&(u.mode=c.mode),typeof c.fov<"u"&&(u.fov=c.fov),typeof c.position<"u"&&S.copy(u.position,c.position),typeof c.up<"u"&&S.copy(u.up,c.up),typeof c.target<"u"&&S.copy(u.target,c.target),typeof c.radius<"u"&&(u.radius=c.radius),typeof c.radiusMax<"u"&&(u.radiusMax=c.radiusMax),typeof c.fog<"u"&&(u.fog=c.fog),typeof c.clipFar<"u"&&(u.clipFar=c.clipFar),typeof c.minNear<"u"&&(u.minNear=c.minNear),typeof c.minFar<"u"&&(u.minFar=c.minFar)),u},e.areSnapshotsEqual=function s(u,c){return u.mode===c.mode&&u.fov===c.fov&&u.radius===c.radius&&u.radiusMax===c.radiusMax&&u.fog===c.fog&&u.clipFar===c.clipFar&&u.minNear===c.minNear&&u.minFar===c.minFar&&S.exactEquals(u.position,c.position)&&S.exactEquals(u.up,c.up)&&S.exactEquals(u.target,c.target)}}(Xa||(Xa={}));var m5={sceneBoundingSpheres:D.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:D.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:D.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:D.Boolean(!1,{description:"Show bounding spheres of visible instances."})},IQe=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=Pb.create(t,YD),this.parent=r,this._props=R(R({},D.getDefaultValues(m5)),n)}return e.prototype.update=function(){var t=this,r=kE(this.scene,this.parent.boundingSphere,this.sceneData,gr.lightgrey,MQe);r&&(this.sceneData=r);var n=kE(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,gr.black,RQe);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=kE(t.scene,a.values.boundingSphere.ref.value,o,gr.tomato,OQe);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),c=kE(t.scene,a.values.invariantBoundingSphere.ref.value,u,gr.skyblue,FQe,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});c&&t.instancesData.set(i,c)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function kE(e,t,r,n,a,i){if(!r||!De.equals(r.boundingSphere,t)){var o=function PQe(e,t){var n=ib(2),a=ft.createState(n,n/2,t);if(e.radius&&($r(a,e.center,e.radius,2),De.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++)$r(a,o[i],1,0);return ft.getMesh(a)}(t,r&&r.mesh),s=r?r.renderObject:function NQe(e,t,r,n){return fb("mesh",Lt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n),{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}(o,n,a,i);return r?O.updateIfChanged(s.values.drawCount,Xi.getDrawCount(o)):e.add(s),{boundingSphere:De.clone(t),renderObject:s,mesh:o}}}var MQe=Vp(),RQe=Vp(),OQe=Vp(),FQe=Vp(),Sg=function(e){return e[e.Move=0]="Move",e[e.Click=1]="Click",e[e.Drag=2]="Drag",e}(Sg||{}),v5=S(),g5=S(),Lie=S(),Uie={maxFps:D.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:D.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})},kQe=function(){function e(t,r,n,a,i,o){void 0===o&&(o={});var s=this;this.canvasIdentify=t,this.lociGetter=r,this.input=n,this.camera=a,this.controls=i,this.ev=bp.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=dr.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=Ya.create(0),this.button=Ya.create(0),this.modifiers=bc.None,this.props=R(R({},D.getDefaultValues(Uie)),o),n.drag.subscribe(function(u){var c=u.x,l=u.y,d=u.buttons,f=u.button,p=u.modifiers;s.isInteracting=!0,s.drag(c,l,d,f,p)}),n.move.subscribe(function(u){var c=u.x,l=u.y,f=u.buttons,p=u.button,h=u.modifiers;if(u.inside&&!s.isInteracting){if(!u.onElement)return void s.leave();s.move(c,l,f,p,h)}}),n.leave.subscribe(function(){s.leave()}),n.click.subscribe(function(u){var c=u.x,l=u.y,d=u.buttons,f=u.button,p=u.modifiers;s.outsideViewport(c,l)||s.click(c,l,d,f,p)}),n.interactionEnd.subscribe(function(){s.isInteracting=!1}),n.modifiers.subscribe(function(u){s.modify(u)})}return e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving;if(t!==Sg.Drag){if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a?.id,this.position=a?.position,this.startX=this.endX,this.startY=this.endY}if(t===Sg.Click){var i=this.getLoci(this.id,this.position);return this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ne.create(this.endX,this.endY),position:this.position}),void(this.prevLoci=i)}if(this.inside&&this.currentIdentifyT===r&&n&&!this.outsideViewport(this.endX,this.endY)){var o=this.getLoci(this.id,this.position);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ne.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}}else n&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ne.create(this.startX,this.startY),pageEnd:Ne.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY)},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?Sg.Drag:Sg.Move,t))},e.prototype.leave=function(){this.inside=!1,dr.Loci.isEmpty(this.prevLoci)||(this.prevLoci=dr.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(Sg.Click,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(Sg.Drag,0)},e.prototype.modify=function(t){bc.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ne.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var a=this.input,i=this.camera.viewport;return r*=a.pixelRatio,(t*=a.pixelRatio)>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.getLoci=function(t,r){var n,a=this.lociGetter(t),i=a.repr,o=a.loci;if(r&&i&&Ht.isLoci(o)&&2===o.bonds.length){var s=o.bonds[0],u=s.aUnit;u.conformation.position(u.elements[s.aIndex],v5),S.sub(Lie,this.camera.state.position,this.camera.state.target),S.projectPointOnPlane(g5,r,Lie,v5);var l=this.camera.getPixelSize(g5),d=i.theme.size.size(o.bonds[0])*(null!==(n=i.props.sizeFactor)&&void 0!==n?n:1);if(!1===i.props.lineSizeAttenuation&&(d*=l/2),d+=this.props.preferAtomPixelPadding*l,S.distance(g5,v5)<d)return{repr:i,loci:Ht.toFirstStructureElementLoci(o)}}return{repr:i,loci:o}},e.prototype.dispose=function(){this.ev.dispose()},e}(),GQe={edgeThresholdMin:D.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:D.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:D.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:D.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},HQe=function(){function e(t,r){this.webgl=t,this.renderable=function WQe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},Ei),{tColor:O.create(t),uTexSizeInv:O.create(Ne.create(1/r,1/n)),dEdgeThresholdMin:O.create(.0312),dEdgeThresholdMax:O.create(.125),dIterations:O.create(12),dSubpixelQuality:O.create(.3)}),i=R({},jQe);return Wa(qa(e,"triangles",qQe,i,a),a)}(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){O.update(this.renderable.values.uTexSizeInv,Ne.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(O.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),O.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),O.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),O.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),O.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){Ct&&this.webgl.timer.mark("FxaaPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),Ct&&this.webgl.timer.markEnd("FxaaPass.render")},e}(),jQe=R(R({},Di),{tColor:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Te("v2"),dEdgeThresholdMin:Ut("number"),dEdgeThresholdMax:Ut("number"),dIterations:Ut("number"),dSubpixelQuality:Ut("number")}),qQe=Un("fxaa",No,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\n// adapted from https://github.com/kosua20/Rendu\n// MIT License Copyright (c) 2017 Simon Rodriguez\n\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n\nfloat rgb2luma(vec3 rgb){\n    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));\n}\n\nfloat sampleLuma(vec2 uv) {\n    return rgb2luma(texture2D(tColor, uv).rgb);\n}\n\nfloat sampleLuma(vec2 uv, float uOffset, float vOffset) {\n    uv += uTexSizeInv * vec2(uOffset, vOffset);\n    return sampleLuma(uv);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec2 inverseScreenSize = uTexSizeInv;\n\n    vec4 colorCenter = texture2D(tColor, coords);\n\n    // Luma at the current fragment\n    float lumaCenter = rgb2luma(colorCenter.rgb);\n\n    // Luma at the four direct neighbours of the current fragment.\n    float lumaDown = sampleLuma(coords, 0.0, -1.0);\n    float lumaUp = sampleLuma(coords, 0.0, 1.0);\n    float lumaLeft = sampleLuma(coords, -1.0, 0.0);\n    float lumaRight = sampleLuma(coords, 1.0, 0.0);\n\n    // Find the maximum and minimum luma around the current fragment.\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\n\n    // Compute the delta.\n    float lumaRange = lumaMax - lumaMin;\n\n    // If the luma variation is lower that a threshold (or if we are in a really dark area),\n    // we are not on an edge, don't perform any AA.\n    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {\n        gl_FragColor = colorCenter;\n        return;\n    }\n\n    // Query the 4 remaining corners lumas.\n    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);\n    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);\n    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);\n    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);\n\n    // Combine the four edges lumas (using intermediary variables for future computations\n    // with the same values).\n    float lumaDownUp = lumaDown + lumaUp;\n    float lumaLeftRight = lumaLeft + lumaRight;\n\n    // Same for corners\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\n\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\n\n    // Is the local edge horizontal or vertical ?\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\n\n    // Choose the step size (one pixel) accordingly.\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\n\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\n    // Compute gradients in this direction.\n    float gradient1 = luma1 - lumaCenter;\n    float gradient2 = luma2 - lumaCenter;\n\n    // Which direction is the steepest ?\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\n\n    // Gradient in the corresponding direction, normalized.\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\n\n    // Average luma in the correct direction.\n    float lumaLocalAverage = 0.0;\n    if(is1Steepest){\n        // Switch the direction\n        stepLength = -stepLength;\n        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\n    } else {\n        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\n    }\n\n    // Shift UV in the correct direction by half a pixel.\n    vec2 currentUv = coords;\n    if(isHorizontal){\n        currentUv.y += stepLength * 0.5;\n    } else {\n        currentUv.x += stepLength * 0.5;\n    }\n\n    // Compute offset (for each iteration step) in the right direction.\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\n    // Compute UVs to explore on each side of the edge, orthogonally.\n    // The QUALITY allows us to step faster.\n    vec2 uv1 = currentUv - offset * QUALITY(0);\n    vec2 uv2 = currentUv + offset * QUALITY(0);\n\n    // Read the lumas at both current extremities of the exploration segment,\n    // and compute the delta wrt to the local average luma.\n    float lumaEnd1 = sampleLuma(uv1);\n    float lumaEnd2 = sampleLuma(uv2);\n    lumaEnd1 -= lumaLocalAverage;\n    lumaEnd2 -= lumaLocalAverage;\n\n    // If the luma deltas at the current extremities is larger than the local gradient,\n    // we have reached the side of the edge.\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\n    bool reachedBoth = reached1 && reached2;\n\n    // If the side is not reached, we continue to explore in this direction.\n    if(!reached1){\n        uv1 -= offset * QUALITY(1);\n    }\n    if(!reached2){\n        uv2 += offset * QUALITY(1);\n    }\n\n    // If both sides have not been reached, continue to explore.\n    if(!reachedBoth){\n        for(int i = 2; i < dIterations; i++){\n            // If needed, read luma in 1st direction, compute delta.\n            if(!reached1){\n                lumaEnd1 = sampleLuma(uv1);\n                lumaEnd1 = lumaEnd1 - lumaLocalAverage;\n            }\n            // If needed, read luma in opposite direction, compute delta.\n            if(!reached2){\n                lumaEnd2 = sampleLuma(uv2);\n                lumaEnd2 = lumaEnd2 - lumaLocalAverage;\n            }\n            // If the luma deltas at the current extremities is larger than the local gradient,\n            // we have reached the side of the edge.\n            reached1 = abs(lumaEnd1) >= gradientScaled;\n            reached2 = abs(lumaEnd2) >= gradientScaled;\n            reachedBoth = reached1 && reached2;\n\n            // If the side is not reached, we continue to explore in this direction,\n            // with a variable quality.\n            if(!reached1){\n                uv1 -= offset * QUALITY(i);\n            }\n            if(!reached2){\n                uv2 += offset * QUALITY(i);\n            }\n\n            // If both sides have been reached, stop the exploration.\n            if(reachedBoth){\n                break;\n            }\n        }\n    }\n\n    // Compute the distances to each side edge of the edge (!).\n    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);\n    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);\n\n    // In which direction is the side of the edge closer ?\n    bool isDirection1 = distance1 < distance2;\n    float distanceFinal = min(distance1, distance2);\n\n    // Thickness of the edge.\n    float edgeThickness = (distance1 + distance2);\n\n    // Is the luma at center smaller than the local average ?\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\n\n    // If the luma at center is smaller than at its neighbour,\n    // the delta luma at each end should be positive (same variation).\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\n\n    // Only keep the result in the direction of the closer side of the edge.\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\n\n    // UV offset: read in the direction of the closest side of the edge.\n    float pixelOffset = - distanceFinal / edgeThickness + 0.5;\n\n    // If the luma variation is incorrect, do not offset.\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\n\n    // Sub-pixel shifting\n    // Full weighted average of the luma over the 3x3 neighborhood.\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\n    // Ratio of the delta between the global average and the center luma,\n    // over the luma range in the 3x3 neighborhood.\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\n    // Compute a sub-pixel offset based on this delta.\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);\n\n    // Pick the biggest of the two offsets.\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\n\n    // Compute the final UV coordinates.\n    vec2 finalUv = coords;\n    if(isHorizontal){\n        finalUv.y += finalOffset * stepLength;\n    } else {\n        finalUv.x += finalOffset * stepLength;\n    }\n\n    // Read the color at the new UV coordinates, and use it.\n    gl_FragColor = texture2D(tColor, finalUv);\n}\n"),JQe={edgeThreshold:D.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:D.Numeric(16,{min:0,max:32,step:1})},e$e=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u")xr&&console.log('Missing "HTMLImageElement" required for "SMAA"');else{var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=function n$e(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},Ei),{tColor:O.create(t),uTexSizeInv:O.create(Ne.create(1/r,1/n)),uViewport:O.create(fr()),dEdgeThreshold:O.create(.1)}),i=R({},t$e);return Wa(qa(e,"triangles",r$e,i,a),a)}(t,r),this.weightsRenderable=function o$e(e,t){var r=t.getWidth(),n=t.getHeight(),a=e.resources.texture("image-uint8","rgb","ubyte","linear"),i=e.resources.texture("image-uint8","rgba","ubyte","nearest"),o=R(R({},Ei),{tEdges:O.create(t),tArea:O.create(a),tSearch:O.create(i),uTexSizeInv:O.create(Ne.create(1/r,1/n)),uViewport:O.create(fr()),dMaxSearchSteps:O.create(16)});See("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=",o.tArea,a),See("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=",o.tSearch,i);var s=R({},a$e);return Wa(qa(e,"triangles",i$e,s,o),o)}(t,this.edgesTarget.texture),this.blendRenderable=function c$e(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=R(R({},Ei),{tColor:O.create(t),tWeights:O.create(r),uTexSizeInv:O.create(Ne.create(1/n,1/a)),uViewport:O.create(fr())}),o=R({},s$e);return Wa(qa(e,"triangles",u$e,o,i),i)}(t,r,this.weightsTarget.texture),this._supported=!0}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),O.update(this.edgesRenderable.values.uViewport,fo.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),O.update(this.weightsRenderable.values.uViewport,fo.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),O.update(this.blendRenderable.values.uViewport,fo.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),O.update(this.edgesRenderable.values.uTexSizeInv,Ne.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),O.update(this.weightsRenderable.values.uTexSizeInv,Ne.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),O.update(this.blendRenderable.values.uTexSizeInv,Ne.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(O.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(O.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(O.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(O.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){Ct&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render(),Ct&&this.webgl.timer.markEnd("SmaaPass.render")},e}(),t$e=R(R({},Di),{tColor:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Te("v2"),uViewport:Te("v4"),dEdgeThreshold:Ut("number")}),r$e=Un("smaa-edges","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvoid SMAAEdgeDetectionVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAAEdgeDetectionVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {\n    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);\n\n    // Calculate color deltas:\n    vec4 delta;\n    vec3 C = texture2D(colorTex, texcoord).rgb;\n\n    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;\n    vec3 t = abs(C - Cleft);\n    delta.x = max(max(t.r, t.g), t.b);\n\n    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;\n    t = abs(C - Ctop);\n    delta.y = max(max(t.r, t.g), t.b);\n\n    // We do the usual threshold:\n    vec2 edges = step(threshold, delta.xy);\n\n    // Then discard if there is no edge:\n    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)\n        discard;\n\n    // Calculate right and bottom deltas:\n    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;\n    t = abs( C - Cright );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;\n    t = abs(C - Cbottom);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the maximum delta in the direct neighborhood:\n    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );\n\n    // Calculate left-left and top-top deltas:\n    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;\n    t = abs( C - Cleftleft );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;\n    t = abs(C - Ctoptop);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the final maximum delta:\n    maxDelta = max(max(maxDelta, delta.z), delta.w);\n\n    // Local contrast adaptation in action:\n    edges.xy *= step(0.5 * maxDelta, delta.xy);\n\n    return vec4(edges, 0.0, 0.0);\n}\n\nvoid main() {\n    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);\n}\n"),a$e=R(R({},Di),{tEdges:Xt("texture","rgba","ubyte","linear"),tArea:Xt("texture","rgb","ubyte","linear"),tSearch:Xt("texture","rgba","ubyte","nearest"),uTexSizeInv:Te("v2"),uViewport:Te("v4"),dMaxSearchSteps:Ut("number")}),i$e=Un("smaa-weights","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\nvoid SMAABlendingWeightCalculationVS(vec2 texCoord) {\n    vPixCoord = texCoord / uTexSizeInv;\n\n    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components\n\n    // And these for the searches, they indicate the ends of the loops:\n    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAABlendingWeightCalculationVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)\n\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))\n#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)\n\nuniform sampler2D tEdges;\nuniform sampler2D tArea;\nuniform sampler2D tSearch;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\n#if __VERSION__ == 100\n    vec2 round(vec2 x) {\n        return sign(x) * floor(abs(x) + 0.5);\n    }\n#endif\n\nfloat SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {\n    // Not required if searchTex accesses are set to point:\n    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n    e.r = bias + e.r * scale;\n    return 255.0 * texture2D(searchTex, e, 0.0).r;\n}\n\nfloat SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    /**\n     * @PSEUDO_GATHER4\n     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to\n     * sample between edge, thus fetching four edges in a row.\n     * Sampling with different offsets in each direction allows to disambiguate\n     * which edges are active from the four fetched ones.\n     */\n    vec2 e = vec2(0.0, 1.0);\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D( edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    // We correct the previous (-0.25, -0.125) offset we applied:\n    texCoord.x += 0.25 * uTexSizeInv.x;\n\n    // The searches are bias by 1, so adjust the coords accordingly:\n    texCoord.x += uTexSizeInv.x;\n\n    // Disambiguate the length added by the last step:\n    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step\n    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n    return texCoord.x;\n}\n\nfloat SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 0.0, 1.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    texCoord.x -= 0.25 * uTexSizeInv.x;\n    texCoord.x -= uTexSizeInv.x;\n    texCoord.x -= 2.0 * uTexSizeInv.x;\n    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n    return texCoord.x;\n}\n\nfloat SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nfloat SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nvec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {\n    // Rounding prevents precision errors of bilinear filtering:\n    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;\n\n    // We do a scale and bias for mapping to texel space:\n    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);\n\n    // Move to proper place, according to the subpixel offset:\n    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n    return texture2D(areaTex, texCoord, 0.0).rg;\n}\n\nvec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {\n    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 e = texture2D(edgesTex, texCoord).rg;\n\n    if (e.g > 0.0) { // Edge at north\n        vec2 d;\n\n        // Find the distance to the left:\n        vec2 coords;\n        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );\n        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)\n        d.x = coords.x;\n\n        // Now fetch the left crossing edges, two at a time using bilinear\n        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n        // discern what value each edge has:\n        float e1 = texture2D(edgesTex, coords, 0.0).r;\n\n        // Find the distance to the right:\n        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);\n        d.y = coords.x;\n\n        // We want the distances to be in pixel units (doing this here allow to\n        // better interleave arithmetic and memory accesses):\n        d = d / uTexSizeInv.x - pixCoord.x;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the right crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;\n\n        // Ok, we know how this pattern looks like, now it is time for getting\n        // the actual area:\n        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));\n    }\n\n    if (e.r > 0.0) { // Edge at west\n        vec2 d;\n\n        // Find the distance to the top:\n        vec2 coords;\n\n        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );\n        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;\n        d.x = coords.y;\n\n        // Fetch the top crossing edges:\n        float e1 = texture2D(edgesTex, coords, 0.0).g;\n\n        // Find the distance to the bottom:\n        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);\n        d.y = coords.y;\n\n        // We want the distances to be in pixel units:\n        d = d / uTexSizeInv.y - pixCoord.y;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the bottom crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;\n\n        // Get the area for this direction:\n        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));\n    }\n\n    return weights;\n}\n\nvoid main() {\n    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));\n}\n"),s$e=R(R({},Di),{tColor:Xt("texture","rgba","ubyte","linear"),tWeights:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Te("v2"),uViewport:Te("v4")}),u$e=Un("smaa-blend","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvoid SMAANeighborhoodBlendingVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAANeighborhoodBlendingVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tWeights;\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {\n    // Fetch the blending weights for current pixel:\n    vec4 a;\n    a.xz = texture2D(blendTex, texCoord).xz;\n    a.y = texture2D(blendTex, offset[1].zw).g;\n    a.w = texture2D(blendTex, offset[1].xy).a;\n\n    // Is there any blending weight with a value greater than 0.0?\n    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {\n        return texture2D(colorTex, texCoord, 0.0);\n    } else {\n        // Up to 4 lines can be crossing a pixel (one through each edge). We\n        // favor blending by choosing the line with the maximum weight for each\n        // direction:\n        vec2 offset;\n        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n        // Then we go in the direction that has the maximum weight:\n        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical\n            offset.y = 0.0;\n        } else {\n            offset.x = 0.0;\n        }\n\n        // Fetch the opposite color and lerp by hand:\n        vec4 C = texture2D(colorTex, texCoord, 0.0);\n        texCoord += sign(offset) * uTexSizeInv;\n        vec4 Cop = texture2D(colorTex, texCoord, 0.0);\n        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);\n\n        // WebGL port note: Added gamma correction\n        C.xyz = pow(C.xyz, vec3(2.2));\n        Cop.xyz = pow(Cop.xyz, vec3(2.2));\n        vec4 mixed = mix(C, Cop, s);\n        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n        return mixed;\n    }\n}\n\nvoid main() {\n    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);\n}\n"),Vie={opacity:D.Numeric(1,{min:0,max:1,step:.01}),saturation:D.Numeric(0,{min:-1,max:1,step:.01}),lightness:D.Numeric(0,{min:-1,max:1,step:.01})},h$e=R({faces:D.MappedStatic("urls",{urls:D.Group({nx:D.Text("",{label:"Negative X / Left"}),ny:D.Text("",{label:"Negative Y / Bottom"}),nz:D.Text("",{label:"Negative Z / Back"}),px:D.Text("",{label:"Positive X / Right"}),py:D.Text("",{label:"Positive Y / Top"}),pz:D.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:D.Group({nx:D.File({label:"Negative X / Left",accept:"image/*"}),ny:D.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:D.File({label:"Negative Z / Back",accept:"image/*"}),px:D.File({label:"Positive X / Right",accept:"image/*"}),py:D.File({label:"Positive Y / Top",accept:"image/*"}),pz:D.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:D.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'})},Vie),m$e=R(R({source:D.MappedStatic("url",{url:D.Text(""),file:D.File({accept:"image/*"})}),blur:D.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'})},Vie),{coverage:D.Select("viewport",D.arrayToOptions(["viewport","canvas"]))}),v$e={topColor:D.Color(dt(14540253)),bottomColor:D.Color(dt(15658734)),ratio:D.Numeric(.5,{min:0,max:1,step:.01}),coverage:D.Select("viewport",D.arrayToOptions(["viewport","canvas"]))},g$e={centerColor:D.Color(dt(14540253)),edgeColor:D.Color(dt(15658734)),ratio:D.Numeric(.5,{min:0,max:1,step:.01}),coverage:D.Select("viewport",D.arrayToOptions(["viewport","canvas"]))},y$e={variant:D.MappedStatic("off",{off:D.EmptyGroup(),skybox:D.Group(h$e,{isExpanded:!0}),image:D.Group(m$e,{isExpanded:!0}),horizontalGradient:D.Group(v$e,{isExpanded:!0}),radialGradient:D.Group(g$e,{isExpanded:!0})},{label:"Environment"})},b$e=function(){function e(t,r,n,a){this.webgl=t,this.assetManager=r,this.camera=new Xa,this.target=S(),this.position=S(),this.dir=S(),this.renderable=function E$e(e,t,r){var n={drawCount:O.create(6),instanceCount:O.create(1),aPosition:O.create(PB),tSkybox:O.create(Go()),tImage:O.create(Go()),uImageScale:O.create(Ne()),uImageOffset:O.create(Ne()),uTexSize:O.create(Ne.create(t,r)),uViewport:O.create(fr()),uViewportAdjusted:O.create(!0),uViewDirectionProjectionInverse:O.create(me()),uGradientColorA:O.create(S()),uGradientColorB:O.create(S()),uGradientRatio:O.create(.5),uBlur:O.create(0),uOpacity:O.create(1),uSaturation:O.create(0),uLightness:O.create(0),dVariant:O.create("skybox")},a=R({},T$e);return Wa(qa(e,"triangles",D$e,a,n),n)}(t,n,a)}return e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value;(t!==n[0]||r!==n[1])&&O.update(this.renderable.values.uTexSize,Ne.set(this.renderable.values.uTexSize.ref.value,t,r))},e.prototype.clearSkybox=function(){var t=this;void 0!==this.skybox&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(function(r){return t.assetManager.release(r)}),this.skybox=void 0)},e.prototype.updateSkybox=function(t,r,n){var i,a=this,o=null===(i=this.skybox)||void 0===i?void 0:i.props.faces,s=r.faces.params;if(!(s.nx&&s.ny&&s.nz&&s.px&&s.py&&s.pz))return this.clearSkybox(),void n?.(!1);if(this.skybox&&o&&function C$e(e,t){return Gie(e)===Gie(t)}(r.faces,this.skybox.props.faces))n?.(!1);else{this.clearSkybox();var u=function x$e(e,t,r,n){var a=function _$e(e,t){return"urls"===t.name?{nx:pn.getUrlAsset(e,t.params.nx),ny:pn.getUrlAsset(e,t.params.ny),nz:pn.getUrlAsset(e,t.params.nz),px:pn.getUrlAsset(e,t.params.px),py:pn.getUrlAsset(e,t.params.py),pz:pn.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}(t,r),i=function S$e(e,t){var r=function(n){return e.resolve(n,"binary").run().then(function(a){return new Blob([a.data])})};return{nx:r(t.nx),ny:r(t.ny),nz:r(t.nz),px:r(t.px),py:r(t.py),pz:r(t.pz)}}(t,a),o=[a.nx,a.ny,a.nz,a.px,a.py,a.pz];return typeof HTMLImageElement>"u"?(console.error('Missing "HTMLImageElement" required for background skybox'),n?.(!0),{texture:Go(),assets:o}):{texture:e.resources.cubeTexture(i,!0,n),assets:o}}(this.webgl,this.assetManager,r.faces,function(p){a.skybox&&(a.skybox.loaded=!p),n?.(!0)}),c=u.texture,l=u.assets;this.skybox={texture:c,props:R({},r),assets:l,loaded:!1},O.update(this.renderable.values.tSkybox,c),this.renderable.update()}if(this.skybox){var d=t;"orthographic"===t.state.mode&&(this.camera.setState(R(R({},t.state),{mode:"perspective"})),this.camera.update(),d=this.camera);var f=this.renderable.values.uViewDirectionProjectionInverse.ref.value;S.sub(this.dir,d.state.position,d.state.target),S.setMagnitude(this.dir,this.dir,.1),S.copy(this.position,this.dir),me.lookAt(f,this.position,this.target,d.state.up),me.mul(f,d.projection,f),me.invert(f,f),O.update(this.renderable.values.uViewDirectionProjectionInverse,f),O.updateIfChanged(this.renderable.values.uBlur,r.blur),O.updateIfChanged(this.renderable.values.uOpacity,r.opacity),O.updateIfChanged(this.renderable.values.uSaturation,r.saturation),O.updateIfChanged(this.renderable.values.uLightness,r.lightness),O.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}},e.prototype.clearImage=function(){void 0!==this.image&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)},e.prototype.updateImage=function(t,r){var n=this;if(!t.source.params)return this.clearImage(),void r?.(!1);if(this.image&&this.image.props.source.params&&function w$e(e,t){return jie(e)===jie(t)}(t.source,this.image.props.source))r?.(!1);else{this.clearImage();var a=function A$e(e,t,r,n){var a="url"===r.name?pn.getUrlAsset(t,r.params):r.params;if(typeof HTMLImageElement>"u")return console.error('Missing "HTMLImageElement" required for background image'),n?.(!0),{texture:Go(),asset:a};var i=e.resources.texture("image-uint8","rgba","ubyte","linear"),o=new Image;return o.onload=function(){i.load(o),(e.isWebGL2||v2(o.width)&&v2(o.height))&&i.mipmap(),n?.()},o.onerror=function(){n?.(!0)},t.resolve(a,"binary").run().then(function(s){var u=new Blob([s.data]);o.src=URL.createObjectURL(u)}),{texture:i,asset:a}}(this.webgl,this.assetManager,t.source,function(s){n.image&&(n.image.loaded=!s),r?.(!0)}),i=a.texture,o=a.asset;this.image={texture:i,props:R({},t),asset:o,loaded:!1},O.update(this.renderable.values.tImage,i),this.renderable.update()}this.image&&(O.updateIfChanged(this.renderable.values.uBlur,t.blur),O.updateIfChanged(this.renderable.values.uOpacity,t.opacity),O.updateIfChanged(this.renderable.values.uSaturation,t.saturation),O.updateIfChanged(this.renderable.values.uLightness,t.lightness),O.updateIfChanged(this.renderable.values.uViewportAdjusted,"viewport"===t.coverage),O.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())},e.prototype.updateImageScaling=function(){var t,r,n=this.renderable.values,a=n.uTexSize.ref.value,i=a[0],o=a[1],s=(null===(t=this.image)||void 0===t?void 0:t.texture.getWidth())||0,u=(null===(r=this.image)||void 0===r?void 0:r.texture.getHeight())||0,c=i/o;O.update(n.uImageScale,c<s/u?Ne.set(n.uImageScale.ref.value,s*o/u,o):Ne.set(n.uImageScale.ref.value,i,u*i/s));var d=n.uImageScale.ref.value,h=d[0]/d[1];O.update(n.uImageOffset,h>c?Ne.set(n.uImageOffset.ref.value,(1-c/h)/2,0):Ne.set(n.uImageOffset.ref.value,0,(1-h/c)/2))},e.prototype.updateGradient=function(t,r,n,a,i){O.update(this.renderable.values.uGradientColorA,dt.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,t)),O.update(this.renderable.values.uGradientColorB,dt.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,r)),O.updateIfChanged(this.renderable.values.uGradientRatio,n),O.updateIfChanged(this.renderable.values.uViewportAdjusted,i),O.updateIfChanged(this.renderable.values.dVariant,a),this.renderable.update()},e.prototype.update=function(t,r,n){if("off"===r.variant.name)return this.clearSkybox(),this.clearImage(),void n?.(!1);"skybox"===r.variant.name?(this.clearImage(),this.updateSkybox(t,r.variant.params,n)):"image"===r.variant.name?(this.clearSkybox(),this.updateImage(r.variant.params,n)):"horizontalGradient"===r.variant.name?(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.topColor,r.variant.params.bottomColor,r.variant.params.ratio,r.variant.name,"viewport"===r.variant.params.coverage),n?.(!1)):"radialGradient"===r.variant.name&&(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.centerColor,r.variant.params.edgeColor,r.variant.params.ratio,r.variant.name,"viewport"===r.variant.params.coverage),n?.(!1));var a=t.viewport;O.update(this.renderable.values.uViewport,fr.set(this.renderable.values.uViewport.ref.value,a.x,a.y,a.width,a.height))},e.prototype.isEnabled=function(t){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===t.variant.name||"radialGradient"===t.variant.name)},e.prototype.isReady=function(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===this.renderable.values.dVariant.ref.value||"radialGradient"===this.renderable.values.dVariant.ref.value)},e.prototype.render=function(){this.isReady()&&("image"===this.renderable.values.dVariant.ref.value&&this.updateImageScaling(),Ct&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),Ct&&this.webgl.timer.markEnd("BackgroundPass.render"))},e.prototype.dispose=function(){this.clearSkybox(),this.clearImage()},e}(),zie="background-skybox";function Gie(e){var t,r,n,a,i,o;return"urls"===e.name?"".concat(zie,"_").concat(e.params.nx,"|").concat(e.params.ny,"|").concat(e.params.nz,"|").concat(e.params.px,"|").concat(e.params.py,"|").concat(e.params.pz):"".concat(zie,"_").concat(null===(t=e.params.nx)||void 0===t?void 0:t.id,"|").concat(null===(r=e.params.ny)||void 0===r?void 0:r.id,"|").concat(null===(n=e.params.nz)||void 0===n?void 0:n.id,"|").concat(null===(a=e.params.px)||void 0===a?void 0:a.id,"|").concat(null===(i=e.params.py)||void 0===i?void 0:i.id,"|").concat(null===(o=e.params.pz)||void 0===o?void 0:o.id)}var Hie="background-image";function jie(e){var t;return"url"===e.name?"".concat(Hie,"_").concat(e.params):"".concat(Hie,"_").concat(null===(t=e.params)||void 0===t?void 0:t.id)}var T$e={drawCount:pa("number"),instanceCount:pa("number"),aPosition:Rn("float32",2,0),tSkybox:Xt("texture","rgba","ubyte","linear"),tImage:Xt("texture","rgba","ubyte","linear"),uImageScale:Te("v2"),uImageOffset:Te("v2"),uTexSize:Te("v2"),uViewport:Te("v4"),uViewportAdjusted:Te("b"),uViewDirectionProjectionInverse:Te("m4"),uGradientColorA:Te("v3"),uGradientColorB:Te("v3"),uGradientRatio:Te("f"),uBlur:Te("f"),uOpacity:Te("f"),uSaturation:Te("f"),uLightness:Te("f"),dVariant:Ut("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},D$e=Un("background","\nprecision mediump float;\n\nattribute vec2 aPosition;\n\nvarying vec4 vPosition;\n\nvoid main() {\n    vPosition = vec4(aPosition, 1.0, 1.0);\n    gl_Position = vec4(aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\nprecision mediump samplerCube;\nprecision mediump sampler2D;\n\n#if defined(dVariant_skybox)\n    uniform samplerCube tSkybox;\n    uniform mat4 uViewDirectionProjectionInverse;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_image)\n    uniform sampler2D tImage;\n    uniform vec2 uImageScale;\n    uniform vec2 uImageOffset;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)\n    uniform vec3 uGradientColorA;\n    uniform vec3 uGradientColorB;\n    uniform float uGradientRatio;\n#endif\n\nuniform vec2 uTexSize;\nuniform vec4 uViewport;\nuniform bool uViewportAdjusted;\nvarying vec4 vPosition;\n\n// TODO: add as general pp option to remove banding?\n// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\nvec3 ScreenSpaceDither(vec2 vScreenPos) {\n    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));\n    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));\n    return vDither.rgb / 255.0;\n}\n\nvec3 saturateColor(vec3 c, float amount) {\n    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(c, W));\n    return mix(intensity, c, 1.0 + amount);\n}\n\nvec3 lightenColor(vec3 c, float amount) {\n    return c + amount;\n}\n\nvoid main() {\n    #if defined(dVariant_skybox)\n        vec4 t = uViewDirectionProjectionInverse * vPosition;\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = textureCubeLodEXT(tSkybox, normalize(t.xyz / t.w), uBlur * 8.0);\n        #else\n            gl_FragColor = textureCube(tSkybox, normalize(t.xyz / t.w));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_image)\n        vec2 coords;\n        if (uViewportAdjusted) {\n            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;\n        } else {\n            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;\n        }\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);\n        #else\n            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_horizontalGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        } else {\n            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #elif defined(dVariant_radialGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;\n        } else {\n            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #endif\n}\n",{shaderTextureLod:"optional"}),M$e={sharpness:D.Numeric(.5,{min:0,max:1,step:.05}),denoise:D.Boolean(!0)},R$e=function(){function e(t,r){this.webgl=t,this.renderable=function N$e(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},Ei),{tColor:O.create(t),uTexSizeInv:O.create(Ne.create(1/r,1/n)),uSharpness:O.create(.5),dDenoise:O.create(!0)}),i=R({},O$e);return Wa(qa(e,"triangles",F$e,i,a),a)}(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){O.update(this.renderable.values.uTexSizeInv,Ne.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.sharpness,i=r.denoise,o=!1;n.tColor.ref.value!==t&&(O.update(this.renderable.values.tColor,t),o=!0),O.updateIfChanged(n.uSharpness,2-2*Math.pow(a,.25)),n.dDenoise.ref.value!==i&&(o=!0),O.updateIfChanged(n.dDenoise,i),o&&this.renderable.update()},e.prototype.render=function(t,r){Ct&&this.webgl.timer.mark("CasPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),Ct&&this.webgl.timer.markEnd("CasPass.render")},e}(),O$e=R(R({},Di),{tColor:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Te("v2"),uSharpness:Te("f"),dDenoise:Ut("boolean")}),F$e=Un("cas",No,"\nprecision mediump float;\nprecision mediump sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nuniform float uSharpness;\n\n// adapted from https://www.shadertoy.com/view/stXSWB\n\n/*\n* FidelityFX Super Resolution scales up a low resolution\n* image, while adding fine detail.\n*\n* MIT Open License\n*\n* https://gpuopen.com/fsr\n*\n* Left: FSR processed\n* Right: Original texture, bilinear interpolation\n*\n* Mouse at top: Sharpness 0 stops (maximum)\n* Mouse at bottom: Sharpness 2 stops (minimum)\n*\n* It works in two passes-\n*   EASU upsamples the image with a clamped Lanczos kernel.\n*   RCAS sharpens the image at the target resolution.\n*\n* I needed to make a few changes to improve readability and\n* WebGL compatibility in an algorithm I don't fully understand.\n* Expect bugs.\n*\n* Shader not currently running for WebGL1 targets (eg. mobile Safari)\n*\n* There is kind of no point to using FSR in Shadertoy, as it renders buffers\n* at full target resolution. But this might be useful for WebGL based demos\n* running smaller-than-target render buffers.\n*\n* For sharpening with a full resolution render buffer,\n* FidelityFX CAS is a better option.\n* https://www.shadertoy.com/view/ftsXzM\n*\n* For readability and compatibility, these optimisations have been removed:\n*   * Fast approximate inverse and inversesqrt\n*   * textureGather fetches (not WebGL compatible)\n*   * Multiplying by reciprocal instead of division\n*\n* Apologies to AMD for the numerous slowdowns and errors I have introduced.\n*\n*/\n\n/***** RCAS *****/\n#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))\n\n// Input callback prototypes that need to be implemented by calling shader\nvec4 FsrRcasLoadF(vec2 p);\n//------------------------------------------------------------------------------------------------------------------------------\nvoid FsrRcasCon(\n    out float con,\n    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.\n    float sharpness\n) {\n    // Transform from stops to linear value.\n    con = exp2(-sharpness);\n}\n\nvec3 FsrRcasF(\n    vec2 ip, // Integer pixel position in output.\n    float con\n) {\n    // Constant generated by RcasSetup().\n    // Algorithm uses minimal 3x3 pixel neighborhood.\n    //    b\n    //  d e f\n    //    h\n    vec2 sp = vec2(ip);\n    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;\n    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;\n    vec3 e = FsrRcasLoadF(sp).rgb;\n    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;\n    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;\n\n    // Luma times 2.\n    float bL = b.g + .5 * (b.b + b.r);\n    float dL = d.g + .5 * (d.b + d.r);\n    float eL = e.g + .5 * (e.b + e.r);\n    float fL = f.g + .5 * (f.b + f.r);\n    float hL = h.g + .5 * (h.b + h.r);\n\n    // Noise detection.\n    #ifdef dDenoise\n        float nz = .25 * (bL + dL + fL + hL) - eL;\n        nz=clamp(\n            abs(nz)\n            /(\n                max(max(bL,dL),max(eL,max(fL,hL)))\n                -min(min(bL,dL),min(eL,min(fL,hL)))\n            ),\n            0., 1.\n        );\n        nz=1.-.5*nz;\n    #endif\n\n    // Min and max of ring.\n    vec3 mn4 = min(b, min(f, h));\n    vec3 mx4 = max(b, max(f, h));\n\n    // Immediate constants for peak range.\n    vec2 peakC = vec2(1., -4.);\n\n    // Limiters, these need to be high precision RCPs.\n    vec3 hitMin = mn4 / (4. * mx4);\n    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);\n    vec3 lobeRGB = max(-hitMin, hitMax);\n    float lobe = max(\n        -FSR_RCAS_LIMIT,\n        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)\n    )*con;\n\n    // Apply noise removal.\n    #ifdef dDenoise\n        lobe *= nz;\n    #endif\n\n    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.\n    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);\n}\n\n\nvec4 FsrRcasLoadF(vec2 p) {\n    return texture2D(tColor, p * uTexSizeInv);\n}\n\nvoid main() {\n    // Set up constants\n    float con;\n    FsrRcasCon(con, uSharpness);\n\n    // Perform RCAS pass\n    vec3 col = FsrRcasF(gl_FragCoord.xy, con);\n\n    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);\n}\n"),k$e=R(R({},Di),{tDepthOpaque:Xt("texture","rgba","ubyte","nearest"),tDepthTransparent:Xt("texture","rgba","ubyte","nearest"),uTexSize:Te("v2"),dOrthographic:Ut("number"),uNear:Te("f"),uFar:Te("f"),uInvProjection:Te("m4"),uOutlineThreshold:Te("f"),dTransparentOutline:Ut("boolean")}),L$e=R(R({},Di),{tDepth:Xt("texture","rgba","ubyte","nearest"),uTexSize:Te("v2"),uProjection:Te("m4"),uInvProjection:Te("m4"),uBounds:Te("v4"),dOrthographic:Ut("number"),uNear:Te("f"),uFar:Te("f"),dSteps:Ut("number"),uMaxDistance:Te("f"),uTolerance:Te("f"),uBias:Te("f"),uLightDirection:Te("v3[]"),uLightColor:Te("v3[]"),dLightCount:Ut("number")}),V$e=R(R({},Di),{tDepth:Xt("texture","rgba","ubyte","nearest"),tDepthHalf:Xt("texture","rgba","ubyte","nearest"),tDepthQuarter:Xt("texture","rgba","ubyte","nearest"),uSamples:Te("v3[]"),dNSamples:Ut("number"),uProjection:Te("m4"),uInvProjection:Te("m4"),uBounds:Te("v4"),uTexSize:Te("v2"),uRadius:Te("f"),uBias:Te("f"),dMultiScale:Ut("boolean"),dLevels:Ut("number"),uLevelRadius:Te("f[]"),uLevelBias:Te("f[]"),uNearThreshold:Te("f"),uFarThreshold:Te("f")}),G$e=R(R({},Di),{tSsaoDepth:Xt("texture","rgba","ubyte","nearest"),uTexSize:Te("v2"),uKernel:Te("f[]"),dOcclusionKernelSize:Ut("number"),uBlurDirectionX:Te("f"),uBlurDirectionY:Te("f"),uInvProjection:Te("m4"),uNear:Te("f"),uFar:Te("f"),uBounds:Te("v4"),dOrthographic:Ut("number")});function qie(e,t,r){var n=R(R({},Ei),{tSsaoDepth:O.create(t),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight())),uKernel:O.create(Wie(15)),dOcclusionKernelSize:O.create(15),uBlurDirectionX:O.create("horizontal"===r?1:0),uBlurDirectionY:O.create("vertical"===r?1:0),uInvProjection:O.create(me.identity()),uNear:O.create(0),uFar:O.create(1e4),uBounds:O.create(fr()),dOrthographic:O.create(0)}),a=R({},G$e);return Wa(qa(e,"triangles",Un("ssao_blur",No,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uKernel[dOcclusionKernelSize];\n\nuniform float uBlurDirectionX;\nuniform float uBlurDirectionY;\n\nuniform mat4 uInvProjection;\nuniform float uNear;\nuniform float uFar;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;\n\n    if (outsideBounds(coords)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfDepth = unpackRGToUnitInterval(packedDepth);\n    // if background and if second pass\n    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfViewZ = getViewZ(selfDepth);\n    float pixelSize = getPixelSize(coords, selfDepth);\n    float maxDiffViewZ = pixelSize * 10.0;\n\n    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;\n\n    float sum = 0.0;\n    float kernelSum = 0.0;\n    // only if kernelSize is odd\n    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {\n        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;\n\n        vec2 sampleCoords = coords + float(i) * offset;\n        if (outsideBounds(sampleCoords)) {\n            continue;\n        }\n\n        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);\n\n        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);\n        if (isBackground(sampleDepth)) {\n            continue;\n        }\n\n        if (abs(float(i)) > 1.0) {\n            float sampleViewZ = getViewZ(sampleDepth);\n            if (abs(selfViewZ - sampleViewZ) > maxDiffViewZ) {\n                continue;\n            }\n        }\n\n        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1\n        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);\n\n        sum += kernel * sampleValue;\n        kernelSum += kernel;\n    }\n\n    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);\n}\n"),a,n),n)}function Wie(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}for(var BE=[],Yie=0;Yie<256;Yie++){var wm=S();wm[0]=2*Math.random()-1,wm[1]=2*Math.random()-1,wm[2]=Math.random(),S.normalize(wm,wm),S.scale(wm,wm,Math.random()),BE.push(wm)}function Xie(e){for(var t=[],r=0;r<e;r++){var n=(r*r+2*r+1)/(e*e);t.push(BE[r][0]*(n=.1+.9*n)),t.push(BE[r][1]*n),t.push(BE[r][2]*n)}return t}var H$e=R(R({},Di),{tSsaoDepth:Xt("texture","rgba","ubyte","nearest"),tColor:Xt("texture","rgba","ubyte","nearest"),tDepthOpaque:Xt("texture","rgba","ubyte","nearest"),tDepthTransparent:Xt("texture","rgba","ubyte","nearest"),tShadows:Xt("texture","rgba","ubyte","nearest"),tOutlines:Xt("texture","rgba","ubyte","nearest"),uTexSize:Te("v2"),dOrthographic:Ut("number"),uNear:Te("f"),uFar:Te("f"),uFogNear:Te("f"),uFogFar:Te("f"),uFogColor:Te("v3"),uOutlineColor:Te("v3"),uOcclusionColor:Te("v3"),uTransparentBackground:Te("b"),dOcclusionEnable:Ut("boolean"),uOcclusionOffset:Te("v2"),dShadowEnable:Ut("boolean"),dOutlineEnable:Ut("boolean"),dOutlineScale:Ut("number"),dTransparentOutline:Ut("boolean")}),Kie={occlusion:D.MappedStatic("on",{on:D.Group({samples:D.Numeric(32,{min:1,max:256,step:1}),multiScale:D.MappedStatic("off",{on:D.Group({levels:D.ObjectList({radius:D.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:D.Numeric(1,{min:0,max:3,step:.1})},function(e){return"".concat(e.radius,", ").concat(e.bias)},{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:D.Numeric(10,{min:0,max:50,step:1}),farThreshold:D.Numeric(1500,{min:0,max:1e4,step:100})}),off:D.Group({})},{cycle:!0}),radius:D.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:function(e){return"on"===e?.multiScale.name}}),bias:D.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:D.Numeric(15,{min:1,max:25,step:2}),resolutionScale:D.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:D.Color(dt(0))}),off:D.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),shadow:D.MappedStatic("off",{on:D.Group({steps:D.Numeric(1,{min:1,max:64,step:1}),bias:D.Numeric(.6,{min:0,max:1,step:.01}),maxDistance:D.Numeric(3,{min:0,max:256,step:1}),tolerance:D.Numeric(1,{min:0,max:10,step:.1})}),off:D.Group({})},{cycle:!0,description:"Simplistic shadows"}),outline:D.MappedStatic("off",{on:D.Group({scale:D.Numeric(1,{min:1,max:5,step:1}),threshold:D.Numeric(.33,{min:.01,max:1,step:.01}),color:D.Color(dt(0)),includeTransparent:D.Boolean(!0,{description:"Whether to show outline for transparent objects"})}),off:D.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:D.MappedStatic("smaa",{fxaa:D.Group(GQe),smaa:D.Group(JQe),off:D.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"}),sharpening:D.MappedStatic("off",{on:D.Group(M$e),off:D.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening"}),background:D.Group(y$e,{isFlat:!0})},lu=function(){function e(t,r,n){this.webgl=t,this.drawPass=n,this.bgColor=S(),this.occlusionOffset=[0,0],this.transparentBackground=!1;var a=n.colorTarget,i=n.depthTextureTransparent,o=n.depthTextureOpaque,s=a.getWidth(),u=a.getHeight();this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.levels=[],this.target=t.createRenderTarget(s,u,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(s,u,!1),this.outlinesRenderable=function B$e(e,t,r,n){var a=t.getWidth(),i=t.getHeight(),o=R(R({},Ei),{tDepthOpaque:O.create(t),tDepthTransparent:O.create(r),uTexSize:O.create(Ne.create(a,i)),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),uInvProjection:O.create(me.identity()),uOutlineThreshold:O.create(.33),dTransparentOutline:O.create(n)}),s=R({},k$e);return Wa(qa(e,"triangles",Un("outlines",No,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform mat4 uInvProjection;\n\nuniform float uOutlineThreshold;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    float backgroundViewZ = 2.0 * uFar;\n\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float selfDepthOpaque = getDepthOpaque(coords);\n    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);\n    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;\n\n    float selfDepthTransparent = getDepthTransparent(coords);\n    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);\n    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;\n\n    float outline = 1.0;\n    float bestDepth = 1.0;\n    float transparentFlag = 0.0;\n\n    for (int y = -1; y <= 1; y++) {\n        for (int x = -1; x <= 1; x++) {\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            float sampleDepthOpaque = getDepthOpaque(sampleCoords);\n            float sampleDepthTransparent = getDepthTransparent(sampleCoords);\n\n            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);\n            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestDepth) {\n                outline = 0.0;\n                bestDepth = sampleDepthOpaque;\n            }\n\n            if (sampleDepthTransparent < sampleDepthOpaque) {\n                float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);\n                if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestDepth) {\n                    outline = 0.0;\n                    bestDepth = sampleDepthTransparent;\n                    transparentFlag = 1.0;\n                }\n            }\n        }\n    }\n\n    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), transparentFlag);\n}\n"),s,o),o)}(t,o,i,!0),this.shadowsTarget=t.createRenderTarget(s,u,!1),this.shadowsRenderable=function U$e(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},Ei),{tDepth:O.create(t),uTexSize:O.create(Ne.create(r,n)),uProjection:O.create(me.identity()),uInvProjection:O.create(me.identity()),uBounds:O.create(fr()),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),dSteps:O.create(1),uMaxDistance:O.create(3),uTolerance:O.create(1),uBias:O.create(.6),uLightDirection:O.create([]),uLightColor:O.create([]),dLightCount:O.create(0)}),i=R({},L$e);return Wa(qa(e,"triangles",Un("shadows",No,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uNear;\nuniform float uFar;\n\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\nuniform float uMaxDistance;\nuniform float uTolerance;\nuniform float uBias;\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat screenFade(const in vec2 coords) {\n    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);\n    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));\n    return saturate(1.0 - dot(fade, fade));\n}\n\n// based on https://panoskarabelas.com/posts/screen_space_shadows/\nfloat screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in float stepLength) {\n    // Ray position and direction (in view-space)\n    vec3 rayPos = position;\n    vec3 rayDir = -lightDirection;\n\n    // Compute ray step\n    vec3 rayStep = rayDir * stepLength;\n\n    // Ray march towards the light\n    float occlusion = 0.0;\n    vec4 rayCoords = vec4(0.0);\n    for (int i = 0; i < dSteps; ++i) {\n        // Step the ray\n        rayPos += rayStep;\n\n        rayCoords = uProjection * vec4(rayPos, 1.0);\n        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;\n\n        if (outsideBounds(rayCoords.xy))\n            return 1.0;\n\n        // Compute the difference between the ray's and the camera's depth\n        float depth = getDepth(rayCoords.xy);\n        float viewZ = getViewZ(depth);\n        float zDelta = rayPos.z - viewZ;\n\n        if (zDelta < uTolerance) {\n            occlusion = 1.0;\n\n            // Fade out as we approach the edges of the screen\n            occlusion *= screenFade(rayCoords.xy);\n\n            break;\n        }\n    }\n\n    return 1.0 - (uBias * occlusion);\n}\n\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n    float stepLength = uMaxDistance / float(dSteps);\n\n    float o = 1.0;\n    #if dLightCount != 0\n        float sh[dLightCount];\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            sh[i] = screenSpaceShadow(selfViewPos, uLightDirection[i], stepLength);\n            o = min(o, sh[i]);\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    gl_FragColor = vec4(o);\n}\n"),i,a),a)}(t,o),this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var c=Math.floor(s*this.ssaoScale),l=Math.floor(u*this.ssaoScale),d=Math.max(1,Math.floor(.5*c)),f=Math.max(1,Math.floor(.5*l)),p=Math.max(1,Math.floor(.25*c)),h=Math.max(1,Math.floor(.25*l));this.downsampledDepthTarget=n.packedDepth?t.createRenderTarget(c,l,!1,"uint8","linear","rgba"):t.createRenderTarget(c,l,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderable=lb(t,o);var m=1===this.ssaoScale?o:this.downsampledDepthTarget.texture;this.depthHalfTarget=n.packedDepth?t.createRenderTarget(d,f,!1,"uint8","linear","rgba"):t.createRenderTarget(d,f,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.depthHalfRenderable=lb(t,m),this.depthQuarterTarget=n.packedDepth?t.createRenderTarget(p,h,!1,"uint8","linear","rgba"):t.createRenderTarget(p,h,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderable=lb(t,this.depthHalfTarget.texture),this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTexture.define(c,l),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthBlurProxyTexture.define(c,l),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=function z$e(e,t,r,n){var a=R(R({},Ei),{tDepth:O.create(t),tDepthHalf:O.create(r),tDepthQuarter:O.create(n),uSamples:O.create(Xie(32)),dNSamples:O.create(32),uProjection:O.create(me.identity()),uInvProjection:O.create(me.identity()),uBounds:O.create(fr()),uTexSize:O.create(Ne.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:O.create(Math.pow(2,5)),uBias:O.create(.8),dMultiScale:O.create(!1),dLevels:O.create(3),uLevelRadius:O.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:O.create([.8,.8,.8]),uNearThreshold:O.create(10),uFarThreshold:O.create(1500)}),i=R({},V$e);return Wa(qa(e,"triangles",Un("ssao",No,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform sampler2D tDepthHalf;\nuniform sampler2D tDepthQuarter;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform vec3 uSamples[dNSamples];\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\n#ifdef dMultiScale\n    uniform float uLevelRadius[dLevels];\n    uniform float uLevelBias[dLevels];\n    uniform float uNearThreshold;\n    uniform float uFarThreshold;\n#else\n    uniform float uRadius;\n#endif\nuniform float uBias;\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\nfloat noise(const in vec2 coords) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(coords, vec2(a,b));\n    float sn = mod(dt, PI);\n    return abs(fract(sin(sn) * c)); // is abs necessary?\n}\n\nvec2 getNoiseVec2(const in vec2 coords) {\n    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, c).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, c));\n    #endif\n}\n\n#define dQuarterThreshold 0.1\n#define dHalfThreshold 0.05\n\nfloat getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    float d = distance(coords, selfCoords);\n    #ifdef depthTextureSupport\n        if (d > dQuarterThreshold) {\n            return texture2D(tDepthQuarter, c).r;\n        } else if (d > dHalfThreshold) {\n            return texture2D(tDepthHalf, c).r;\n        } else {\n            return texture2D(tDepth, c).r;\n        }\n    #else\n        if (d > dQuarterThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));\n        } else if (d > dHalfThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthHalf, c));\n        } else {\n            return unpackRGBAToDepth(texture2D(tDepth, c));\n        }\n    #endif\n}\n\nvec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {\n    vec3 p1 = vec3(offset1, depth1 - depth);\n    vec3 p2 = vec3(offset2, depth2 - depth);\n\n    vec3 normal = cross(p1, p2);\n    normal.z = -normal.z;\n\n    return normalize(normal);\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\n// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);\n        return;\n    }\n\n    vec2 offset1 = vec2(0.0, invTexSize.y);\n    vec2 offset2 = vec2(invTexSize.x, 0.0);\n\n    float selfDepth1 = getDepth(selfCoords + offset1);\n    float selfDepth2 = getDepth(selfCoords + offset2);\n\n    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n\n    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));\n    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));\n    vec3 bitangent = cross(selfViewNormal, tangent);\n    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);\n\n    float occlusion = 0.0;\n    #ifdef dMultiScale\n        float pixelSize = getPixelSize(selfCoords, selfDepth);\n\n        for(int l = 0; l < dLevels; l++) {\n            // TODO: smooth transition\n            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;\n            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;\n\n            float levelOcclusion = 0.0;\n            for(int i = 0; i < dNSamples; i++) {\n                vec3 sampleViewPos = TBN * uSamples[i];\n                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];\n\n                vec4 offset = vec4(sampleViewPos, 1.0);\n                offset = uProjection * offset;\n                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n                float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n                float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n                levelOcclusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];\n            }\n            occlusion = max(occlusion, levelOcclusion);\n        }\n    #else\n        for(int i = 0; i < dNSamples; i++) {\n            vec3 sampleViewPos = TBN * uSamples[i];\n            sampleViewPos = selfViewPos + sampleViewPos * uRadius;\n\n            vec4 offset = vec4(sampleViewPos, 1.0);\n            offset = uProjection * offset;\n            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n            float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n            float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n            occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));\n        }\n    #endif\n    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));\n\n    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));\n\n    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);\n}\n"),i,a),a)}(t,m,this.depthHalfTarget.texture,this.depthQuarterTarget.texture),this.ssaoBlurFirstPassRenderable=qie(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=qie(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=function j$e(e,t,r,n,a,i,o,s){var u=R(R({},Ei),{tSsaoDepth:O.create(o),tColor:O.create(t),tDepthOpaque:O.create(r),tDepthTransparent:O.create(n),tShadows:O.create(a),tOutlines:O.create(i),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight())),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),uFogNear:O.create(1e4),uFogFar:O.create(1e4),uFogColor:O.create(S.create(1,1,1)),uOutlineColor:O.create(S.create(0,0,0)),uOcclusionColor:O.create(S.create(0,0,0)),uTransparentBackground:O.create(!1),dOcclusionEnable:O.create(!0),uOcclusionOffset:O.create(Ne.create(0,0)),dShadowEnable:O.create(!1),dOutlineEnable:O.create(!1),dOutlineScale:O.create(1),dTransparentOutline:O.create(s)}),c=R({},H$e);return Wa(qa(e,"triangles",Un("postprocessing",No,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform sampler2D tColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform sampler2D tShadows;\nuniform sampler2D tOutlines;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\nuniform vec3 uOutlineColor;\nuniform vec3 uOcclusionColor;\nuniform bool uTransparentBackground;\nuniform vec2 uOcclusionOffset;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getOutline(const in vec2 coords, const in float opaqueDepth, out float closestTexel) {\n    float backgroundViewZ = 2.0 * uFar;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float transparentDepth = getDepthTransparent(coords);\n    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);\n    float transparentSelfViewZ = isBackground(transparentDepth) ? backgroundViewZ : getViewZ(transparentDepth);\n    float selfDepth = min(opaqueDepth, transparentDepth);\n\n    float outline = 1.0;\n    closestTexel = 1.0;\n    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {\n        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {\n            if (x * x + y * y > dOutlineScale * dOutlineScale) {\n                continue;\n            }\n\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);\n            float sampleOutline = sampleOutlineCombined.r;\n            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);\n            float sampleOutlineViewZ = isBackground(sampleOutlineDepth) ? backgroundViewZ : getViewZ(sampleOutlineDepth);\n\n            float selfViewZ = sampleOutlineCombined.a == 0.0 ? opaqueSelfViewZ : transparentSelfViewZ;\n            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {\n                outline = 0.0;\n                closestTexel = sampleOutlineDepth;\n            }\n        }\n    }\n    return closestTexel < opaqueDepth ? outline : 1.0;\n}\n\nfloat getSsao(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n\n    float viewDist;\n    float fogFactor;\n    float opaqueDepth = getDepthOpaque(coords);\n\n    #ifdef dOcclusionEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            float occlusionFactor = getSsao(coords + uOcclusionOffset);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);\n            } else {\n                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);\n            }\n        }\n    #endif\n\n    #ifdef dShadowEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            vec4 shadow = texture2D(tShadows, coords);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);\n            } else {\n                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);\n            }\n        }\n    #endif\n\n    // outline needs to be handled after occlusion and shadow to keep them clean\n    #ifdef dOutlineEnable\n        float closestTexel;\n        float outline = getOutline(coords, opaqueDepth, closestTexel);\n        if (outline == 0.0) {\n            viewDist = abs(getViewZ(closestTexel));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            if (!uTransparentBackground) {\n                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);\n            } else {\n                color.a = 1.0 - fogFactor;\n                color.rgb = mix(uOutlineColor, color.rgb, fogFactor);\n            }\n        }\n    #endif\n\n    gl_FragColor = color;\n}\n"),c,u),u)}(t,a.texture,o,i,this.shadowsTarget.texture,this.outlinesTarget.texture,this.ssaoDepthTexture,!0),this.background=new b$e(t,r,s,u)}return e.isEnabled=function(t){return"on"===t.occlusion.name||"on"===t.shadow.name||"on"===t.outline.name||"off"!==t.background.variant.name},e.isTransparentOutlineEnabled=function(t){return"on"===t.outline.name&&t.outline.params.includeTransparent},e.prototype.calcSsaoScale=function(t){return Math.min(1,1/this.webgl.pixelRatio)*t},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale(1);if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o,this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.shadowsTarget.setSize(t,r);var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.downsampledDepthTarget.setSize(s,u),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u);var c=Math.max(1,Math.floor(.5*s)),l=Math.max(1,Math.floor(.5*u));this.depthHalfTarget.setSize(c,l);var d=Math.max(1,Math.floor(.25*s)),f=Math.max(1,Math.floor(.25*u));this.depthQuarterTarget.setSize(d,f),O.update(this.renderable.values.uTexSize,Ne.set(this.renderable.values.uTexSize.ref.value,t,r)),O.update(this.outlinesRenderable.values.uTexSize,Ne.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),O.update(this.shadowsRenderable.values.uTexSize,Ne.set(this.shadowsRenderable.values.uTexSize.ref.value,t,r)),O.update(this.downsampleDepthRenderable.values.uTexSize,Ne.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,s,u)),O.update(this.depthHalfRenderable.values.uTexSize,Ne.set(this.depthHalfRenderable.values.uTexSize.ref.value,c,l)),O.update(this.depthQuarterRenderable.values.uTexSize,Ne.set(this.depthQuarterRenderable.values.uTexSize.ref.value,d,f)),O.update(this.ssaoRenderable.values.uTexSize,Ne.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),O.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ne.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),O.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ne.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u));var p=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;O.update(this.depthHalfRenderable.values.tColor,p),O.update(this.ssaoRenderable.values.tDepth,p),this.depthHalfRenderable.update(),this.ssaoRenderable.update(),this.background.setSize(t,r)}},e.prototype.updateState=function(t,r,n,a,i){var o,s=!1,u=!1,c=!1,l=!1,d=!1,f=!1,p="orthographic"===t.state.mode?1:0,h="on"===a.outline.name,m="on"===a.shadow.name,v="on"===a.occlusion.name,g=me.identity();me.invert(g,t.projection);var y=this.renderable.values.uTexSize.ref.value,b=y[0],_=y[1],C=t.viewport;if("on"===a.occlusion.name){O.update(this.ssaoRenderable.values.uProjection,t.projection),O.update(this.ssaoRenderable.values.uInvProjection,g);var x=this.ssaoRenderable.values.uBounds,A=this.ssaoScale;fr.set(x.ref.value,Math.floor(C.x*A)/(b*A),Math.floor(C.y*A)/(_*A),Math.ceil((C.x+C.width)*A)/(b*A),Math.ceil((C.y+C.height)*A)/(_*A)),O.update(x,x.ref.value),O.update(this.ssaoBlurFirstPassRenderable.values.uBounds,x.ref.value),O.update(this.ssaoBlurSecondPassRenderable.values.uBounds,x.ref.value),O.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),O.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),O.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),O.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),O.update(this.ssaoBlurFirstPassRenderable.values.uInvProjection,g),O.update(this.ssaoBlurSecondPassRenderable.values.uInvProjection,g),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==p&&(l=!0,O.update(this.ssaoBlurFirstPassRenderable.values.dOrthographic,p),O.update(this.ssaoBlurSecondPassRenderable.values.dOrthographic,p)),this.nSamples!==a.occlusion.params.samples&&(c=!0,this.nSamples=a.occlusion.params.samples,O.update(this.ssaoRenderable.values.uSamples,Xie(this.nSamples)),O.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples));var T="on"===a.occlusion.params.multiScale.name;if(this.ssaoRenderable.values.dMultiScale.ref.value!==T&&(c=!0,O.update(this.ssaoRenderable.values.dMultiScale,T)),"on"===a.occlusion.params.multiScale.name){var w=a.occlusion.params.multiScale.params;if(!Nd(this.levels,w.levels)){c=!0,this.levels=w.levels;var E=function q$e(e,t){var r=e.length,n=t||{radius:new Array(3*r).fill(0),bias:new Array(3*r).fill(0)},a=n.radius,i=n.bias;e=e.slice().sort(function(u,c){return u.radius-c.radius});for(var o=0;o<r;++o){var s=e[o];a[o]=Math.pow(2,s.radius),i[o]=s.bias}return{count:r,radius:a,bias:i}}(w.levels);O.updateIfChanged(this.ssaoRenderable.values.dLevels,E.count),O.update(this.ssaoRenderable.values.uLevelRadius,E.radius),O.update(this.ssaoRenderable.values.uLevelBias,E.bias)}O.updateIfChanged(this.ssaoRenderable.values.uNearThreshold,w.nearThreshold),O.updateIfChanged(this.ssaoRenderable.values.uFarThreshold,w.farThreshold)}else O.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius));if(O.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){l=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var I=Wie(this.blurKernelSize);O.update(this.ssaoBlurFirstPassRenderable.values.uKernel,I),O.update(this.ssaoBlurSecondPassRenderable.values.uKernel,I),O.update(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),O.update(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}var M=this.calcSsaoScale(a.occlusion.params.resolutionScale);if(this.ssaoScale!==M){c=!0,d=!0,this.ssaoScale=M;var F=Math.floor(b*this.ssaoScale),N=Math.floor(_*this.ssaoScale);this.downsampledDepthTarget.setSize(F,N),this.ssaoDepthTexture.define(F,N),this.ssaoDepthBlurProxyTexture.define(F,N);var j=Math.floor(.5*F),k=Math.floor(.5*N);this.depthHalfTarget.setSize(j,k);var H=Math.floor(.25*F),G=Math.floor(.25*N);this.depthQuarterTarget.setSize(H,G);var U=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;O.update(this.depthHalfRenderable.values.tColor,U),O.update(this.ssaoRenderable.values.tDepth,U),O.update(this.ssaoRenderable.values.tDepthHalf,this.depthHalfTarget.texture),O.update(this.ssaoRenderable.values.tDepthQuarter,this.depthQuarterTarget.texture),O.update(this.downsampleDepthRenderable.values.uTexSize,Ne.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,F,N)),O.update(this.depthHalfRenderable.values.uTexSize,Ne.set(this.depthHalfRenderable.values.uTexSize.ref.value,j,k)),O.update(this.depthQuarterRenderable.values.uTexSize,Ne.set(this.depthQuarterRenderable.values.uTexSize.ref.value,H,G)),O.update(this.ssaoRenderable.values.uTexSize,Ne.set(this.ssaoRenderable.values.uTexSize.ref.value,F,N)),O.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ne.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,F,N)),O.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ne.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,F,N))}O.update(this.renderable.values.uOcclusionColor,dt.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,a.occlusion.params.color))}if("on"===a.shadow.name&&(O.update(this.shadowsRenderable.values.uProjection,t.projection),O.update(this.shadowsRenderable.values.uInvProjection,g),fr.set(this.shadowsRenderable.values.uBounds.ref.value,C.x/b,C.y/_,(C.x+C.width)/b,(C.y+C.height)/_),O.update(this.shadowsRenderable.values.uBounds,this.shadowsRenderable.values.uBounds.ref.value),O.updateIfChanged(this.shadowsRenderable.values.uNear,t.near),O.updateIfChanged(this.shadowsRenderable.values.uFar,t.far),this.shadowsRenderable.values.dOrthographic.ref.value!==p&&(O.update(this.shadowsRenderable.values.dOrthographic,p),s=!0),O.updateIfChanged(this.shadowsRenderable.values.uMaxDistance,a.shadow.params.maxDistance),O.updateIfChanged(this.shadowsRenderable.values.uTolerance,a.shadow.params.tolerance),O.updateIfChanged(this.shadowsRenderable.values.uBias,a.shadow.params.bias),this.shadowsRenderable.values.dSteps.ref.value!==a.shadow.params.steps&&(O.update(this.shadowsRenderable.values.dSteps,a.shadow.params.steps),s=!0),O.update(this.shadowsRenderable.values.uLightDirection,i.direction),O.update(this.shadowsRenderable.values.uLightColor,i.color),this.shadowsRenderable.values.dLightCount.ref.value!==i.count&&(O.update(this.shadowsRenderable.values.dLightCount,i.count),s=!0)),"on"===a.outline.name){var Q=null===(o=a.outline.params.includeTransparent)||void 0===o||o,W=Math.max(1,Math.round(a.outline.params.scale*this.webgl.pixelRatio))-1,K=50*a.outline.params.threshold*this.webgl.pixelRatio;O.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),O.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),O.update(this.outlinesRenderable.values.uInvProjection,g),this.outlinesRenderable.values.dTransparentOutline.ref.value!==Q&&(f=!0,O.update(this.outlinesRenderable.values.dTransparentOutline,Q)),this.outlinesRenderable.values.dOrthographic.ref.value!==p&&(f=!0,O.update(this.outlinesRenderable.values.dOrthographic,p)),O.updateIfChanged(this.outlinesRenderable.values.uOutlineThreshold,K),O.update(this.renderable.values.uOutlineColor,dt.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,a.outline.params.color)),this.renderable.values.dOutlineScale.ref.value!==W&&(u=!0,O.update(this.renderable.values.dOutlineScale,W)),this.renderable.values.dTransparentOutline.ref.value!==Q&&(u=!0,O.update(this.renderable.values.dTransparentOutline,Q))}O.updateIfChanged(this.renderable.values.uFar,t.far),O.updateIfChanged(this.renderable.values.uNear,t.near),O.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),O.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),O.update(this.renderable.values.uFogColor,dt.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),O.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==p&&(u=!0,O.update(this.renderable.values.dOrthographic,p)),this.renderable.values.dOutlineEnable.ref.value!==h&&(u=!0,O.update(this.renderable.values.dOutlineEnable,h)),this.renderable.values.dShadowEnable.ref.value!==m&&(u=!0,O.update(this.renderable.values.dShadowEnable,m)),this.renderable.values.dOcclusionEnable.ref.value!==v&&(u=!0,O.update(this.renderable.values.dOcclusionEnable,v)),f&&this.outlinesRenderable.update(),s&&this.shadowsRenderable.update(),c&&this.ssaoRenderable.update(),l&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),d&&this.depthHalfRenderable.update(),u&&this.renderable.update();var ne=this.webgl,X=ne.gl,L=ne.state;L.enable(X.SCISSOR_TEST),L.disable(X.BLEND),L.disable(X.DEPTH_TEST),L.depthMask(!1)},e.prototype.setOcclusionOffset=function(t,r){this.occlusionOffset[0]=t,this.occlusionOffset[1]=r,O.update(this.renderable.values.uOcclusionOffset,Ne.set(this.renderable.values.uOcclusionOffset.ref.value,t,r))},e.prototype.setTransparentBackground=function(t){this.transparentBackground=t},e.prototype.render=function(t,r,n,a,i,o){Ct&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(t,n,a,i,o);var s=this.webgl,u=s.gl,c=s.state,l=t.viewport,d=l.x,f=l.y,p=l.width,h=l.height;if("on"===i.occlusion.name&&0===this.occlusionOffset[0]&&0===this.occlusionOffset[1]){Ct&&this.webgl.timer.mark("SSAO.render");var m=Math.floor(d*this.ssaoScale),v=Math.floor(f*this.ssaoScale),g=Math.ceil(p*this.ssaoScale),y=Math.ceil(h*this.ssaoScale);c.viewport(m,v,g,y),c.scissor(m,v,g,y),this.ssaoScale<1&&(Ct&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTarget.bind(),this.downsampleDepthRenderable.render(),Ct&&this.webgl.timer.markEnd("SSAO.downsample")),Ct&&this.webgl.timer.mark("SSAO.half"),this.depthHalfTarget.bind(),this.depthHalfRenderable.render(),Ct&&this.webgl.timer.markEnd("SSAO.half"),Ct&&this.webgl.timer.mark("SSAO.quarter"),this.depthQuarterTarget.bind(),this.depthQuarterRenderable.render(),Ct&&this.webgl.timer.markEnd("SSAO.quarter"),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),Ct&&this.webgl.timer.markEnd("SSAO.render")}c.viewport(d,f,p,h),c.scissor(d,f,p,h),"on"===i.outline.name&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),"on"===i.shadow.name&&(this.shadowsTarget.bind(),this.shadowsRenderable.render()),r?this.webgl.unbindFramebuffer():this.target.bind(),this.background.update(t,i.background),this.background.isEnabled(i.background)?(this.transparentBackground?c.clearColor(0,0,0,0):(dt.toVec3Normalized(this.bgColor,a),c.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),u.clear(u.COLOR_BUFFER_BIT),c.enable(u.BLEND),c.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),this.background.render()):(c.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT)),this.renderable.render(),Ct&&this.webgl.timer.markEnd("PostprocessingPass.render")},e}(),y5=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.internalTarget=t.createRenderTarget(a,i,!1),this.fxaa=new HQe(t,this.target.texture),this.smaa=new e$e(t,this.target.texture),this.cas=new R$e(t,this.target.texture)}return e.isEnabled=function(t){return"off"!==t.antialiasing.name},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.internalTarget.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r),this.cas.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if("fxaa"===n.antialiasing.name){var a=lu.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r)}},e.prototype._renderSmaa=function(t,r,n){if("smaa"===n.antialiasing.name){var a=lu.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r)}},e.prototype._renderAntialiasing=function(t,r,n){"fxaa"===n.antialiasing.name?this._renderFxaa(t,r,n):"smaa"===n.antialiasing.name&&this._renderSmaa(t,r,n)},e.prototype._renderCas=function(t,r,n){if("on"===n.sharpening.name){var a="off"!==n.antialiasing.name?this.internalTarget.texture:lu.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.cas.update(a,n.sharpening.params),this.cas.render(t.viewport,r)}},e.prototype.render=function(t,r,n){if("off"!==n.antialiasing.name||"off"!==n.sharpening.name){if("smaa"===n.antialiasing.name&&!this.smaa.supported)return void console.error('SMAA not supported, missing "HTMLImageElement"');var a=r?void 0:this.target;"off"===n.sharpening.name?this._renderAntialiasing(t,a,n):("off"===n.antialiasing.name||this._renderAntialiasing(t,this.internalTarget,n),this._renderCas(t,a,n))}},e}(),Y$e=R(R({},Di),{tColor:Xt("texture","rgba","ubyte","nearest"),uTexSize:Te("v2"),uWeight:Te("f")}),X$e=Un("compose",No,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\nuniform float uWeight;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords) * uWeight;\n}\n"),Zie={mode:D.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:D.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:D.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'})},LE=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),c=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,c,!1),this.composeTarget=t.createRenderTarget(u,c,!1,o&&s?"fp16":a&&i?"float32":"uint8"),this.holdTarget=t.createRenderTarget(u,c,!1),this.compose=function K$e(e,t){var r=R(R({},Ei),{tColor:O.create(t),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight())),uWeight:O.create(1)}),n=R({},Y$e);return Wa(qa(e,"triangles",X$e,n,r),r)}(t,r.colorTarget.texture)}return e.isEnabled=function(t){return"off"!==t.mode},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value;(t!==n[0]||r!==n[1])&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),O.update(this.compose.values.uTexSize,Ne.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i){return"temporal"!==n.multiSample.mode||i?(this.renderMultiSample(r,a,n),-2):this.renderTemporalMultiSample(t,r,n,a)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n){var a=t.camera,i=this,o=i.compose,s=i.composeTarget,u=i.drawPass,c=i.webgl,l=c.gl,d=c.state;Ct&&c.timer.mark("MultiSamplePass.renderMultiSample");var f=b5[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],p=a.viewport,h=p.x,m=p.y,v=p.width,g=p.height,y=1/f.length;a.viewOffset.enabled=!0,O.update(o.values.tColor,u.getColorTarget(n.postprocessing).texture),o.update();for(var _=0;_<f.length;++_){var C=f[_];Xa.setViewOffset(a.viewOffset,v,g,C[0],C[1],v,g),a.update(),O.update(o.values.uWeight,y+.03125*((_+.5)/f.length-.5)),0===_?u.postprocessing.setOcclusionOffset(0,0):u.postprocessing.setOcclusionOffset(C[0]/v,C[1]/g),u.render(t,n,!1),s.bind(),d.enable(l.BLEND),d.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),d.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE),d.disable(l.DEPTH_TEST),d.depthMask(!1),d.viewport(h,m,v,g),d.scissor(h,m,v,g),0===_&&(d.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT)),o.render()}u.postprocessing.setOcclusionOffset(0,0),O.update(o.values.uWeight,1),O.update(o.values.tColor,s.texture),o.update(),this.bindOutputTarget(r),d.viewport(h,m,v,g),d.scissor(h,m,v,g),d.disable(l.BLEND),o.render(),a.viewOffset.enabled=!1,a.update(),Ct&&c.timer.markEnd("MultiSamplePass.renderMultiSample")},e.prototype.renderTemporalMultiSample=function(t,r,n,a){var i=r.camera,o=this,s=o.compose,u=o.composeTarget,c=o.holdTarget,l=o.drawPass,d=o.webgl,f=d.gl,p=d.state;Ct&&d.timer.mark("MultiSamplePass.renderTemporalMultiSample");var h=b5[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(-2===t||t>=h.length)return-2;var m=i.viewport,v=m.x,g=m.y,y=m.width,b=m.height,_=1/h.length;if(-1===t)l.render(r,n,!1),O.update(s.values.uWeight,1),O.update(s.values.tColor,l.getColorTarget(n.postprocessing).texture),s.update(),c.bind(),p.disable(f.BLEND),p.disable(f.DEPTH_TEST),p.depthMask(!1),p.viewport(v,g,y,b),p.scissor(v,g,y,b),s.render(),t+=1;else{i.viewOffset.enabled=!0,O.update(s.values.tColor,l.getColorTarget(n.postprocessing).texture),O.update(s.values.uWeight,_),s.update();for(var C=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2)),x=0;x<C;++x){var A=h[t];if(Xa.setViewOffset(i.viewOffset,y,b,A[0],A[1],y,b),i.update(),0===t?l.postprocessing.setOcclusionOffset(0,0):l.postprocessing.setOcclusionOffset(A[0]/y,A[1]/b),l.render(r,n,!1),u.bind(),p.enable(f.BLEND),p.blendEquationSeparate(f.FUNC_ADD,f.FUNC_ADD),p.blendFuncSeparate(f.ONE,f.ONE,f.ONE,f.ONE),p.disable(f.DEPTH_TEST),p.depthMask(!1),p.viewport(v,g,y,b),p.scissor(v,g,y,b),0===t&&(p.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),s.render(),(t+=1)>=h.length)break}}l.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(a),p.viewport(v,g,y,b),p.scissor(v,g,y,b);var T=t*_;return T>0&&(O.update(s.values.uWeight,1),O.update(s.values.tColor,u.texture),s.update(),p.disable(f.BLEND),s.render()),T<1&&(O.update(s.values.uWeight,1-T),O.update(s.values.tColor,c.texture),s.update(),0===T?p.disable(f.BLEND):p.enable(f.BLEND),s.render()),i.viewOffset.enabled=!1,i.update(),Ct&&d.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),t>=h.length?-2:t},e}(),b5=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];b5.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var Qie=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),"temporal"===r.mode&&-2!==this.sampleIndex},e.prototype.render=function(t,r,n,a){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!a),this.sampleIndex<0},e}(),$ie={eyeSeparation:D.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:D.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},Z$e=D.getDefaultValues($ie),Mb=function(){function e(t,r){void 0===r&&(r={}),this.parent=t,this.left=new Jie,this.right=new Jie,this.props=R(R({},Z$e),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),function Q$e(e,t,r,n){fo.copy(r.viewport,e.viewport),me.copy(r.view,e.view),me.copy(r.projection,e.projection),Xa.copySnapshot(r.state,e.state),Xa.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,fo.copy(n.viewport,e.viewport),me.copy(n.view,e.view),me.copy(n.projection,e.projection),Xa.copySnapshot(n.state,e.state),Xa.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var c,l,o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(.5*e.state.fov);eoe[12]=-o,toe[12]=o,r.projection[0]=2*e.near/((l=u*i+s)-(c=-u*i+s)),r.projection[8]=(l+c)/(l-c),me.mul(r.view,r.view,eoe),me.mul(r.projectionView,r.projection,r.view),me.invert(r.inverseProjectionView,r.projectionView),n.projection[0]=2*e.near/((l=u*i-s)-(c=-u*i-s)),n.projection[8]=(l+c)/(l-c),me.mul(n.view,n.view,toe),me.mul(n.projectionView,n.projection,n.view),me.invert(n.inverseProjectionView,n.projectionView)}(this.parent,this.props,this.left,this.right)},e}();!function(e){e.is=function t(r){return"left"in r&&"right"in r}}(Mb||(Mb={}));var Jie=function(){return function e(){this.viewport=fo.create(0,0,0,0),this.view=me(),this.projection=me(),this.projectionView=me(),this.inverseProjectionView=me(),this.state=Xa.createDefaultSnapshot(),this.viewOffset=Xa.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}}(),eoe=me.identity(),toe=me.identity(),_5=Math.pow(2,24)-2,$$e=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a);var i=t.resources,o=t.extensions.drawBuffers,s=t.gl;o?(this.objectPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=i.framebuffer(),this.objectPickFramebuffer=i.framebuffer(),this.instancePickFramebuffer=i.framebuffer(),this.groupPickFramebuffer=i.framebuffer(),this.depthPickFramebuffer=i.framebuffer(),this.framebuffer.bind(),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1,o.COLOR_ATTACHMENT2,o.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=$t(s)?i.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):i.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight))}return e.prototype.bindObject=function(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()},e.prototype.bindInstance=function(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()},e.prototype.bindGroup=function(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()},e.prototype.bindDepth=function(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()},Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))},e.prototype.renderVariant=function(t,r,n,a,i,o){t.clear(!1),t.update(r,n),t.renderPick(n.primitives,r,i,null,o),a.handle.isEnabled&&t.renderPick(a.handle.scene,r,i,null,o),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera,a.camera.scene),t.renderPick(a.camera.scene,a.camera.camera,i,null,o))},e.prototype.render=function(t,r,n,a){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(t,r,n,a,"pick",_g.None)):(this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",_g.Object),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pick",_g.Instance),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",_g.Group),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth",_g.None))},e}(),J$e=function(){function e(t,r,n,a,i,o,s){void 0===s&&(s=1),this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.pickPadding=s,this.dirty=!0,this.viewport=fo(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){fo.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=function PDe(e){for(var t,r=0,n=0,a=[0,-1],i=2*e+1,o=i/2,s=[],u=Math.pow(i,2);u>0;--u)-o<r&&r<=o&&-o<n&&n<=o&&s.push([r,n]),(r===n||r<0&&r===-n||r>0&&r===1-n)&&(a[0]=(t=[-a[1],a[0]])[0],a[1]=t[1]),r+=a[0],n+=a[1];return s}(Math.round(this.pickScale*this.pickPadding))},e.prototype.syncBuffers=function(){Ct&&this.webgl.timer.mark("PickHelper.syncBuffers");var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.bindObject(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.bindInstance(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.bindGroup(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.bindDepth(),this.webgl.readPixels(r,n,a,i,this.depthBuffer),Ct&&this.webgl.timer.markEnd("PickHelper.syncBuffers")},e.prototype.getBufferIdx=function(t,r){return 4*(r*this.pickWidth+t)},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return function uGe(e,t,r,n){return fr.set(nte,e/255,t/255,r/255,n/255),fr.dot(nte,sGe)}(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return _B(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){Ct&&this.webgl.timer.mark("PickHelper.render",!0);var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,c=u.renderer,l=u.scene,d=u.helper;c.setTransparentBackground(!1),c.setDrawingBufferSize(i,o),c.setPixelRatio(this.pickScale),Mb.is(t)?(c.setViewport(n,a,s,o),this.pickPass.render(c,t.left,l,d),c.setViewport(n+s,a,i-s,o),this.pickPass.render(c,t.right,l,d)):(c.setViewport(n,a,i,o),this.pickPass.render(c,t,l,d)),this.dirty=!1,Ct&&this.webgl.timer.markEnd("PickHelper.render")},e.prototype.identifyInternal=function(t,r,n){var i=this.webgl,o=this.pickScale;if(!i.isContextLost){r=this.pickPass.drawingBufferHeight-(r*=i.pixelRatio);var s=this.viewport;if(!((t*=i.pixelRatio)<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(Ct&&this.webgl.timer.mark("PickHelper.identify"),this.render(n),this.syncBuffers(),Ct&&this.webgl.timer.markEnd("PickHelper.identify"));var u=t-s.x,c=r-s.y,l=Math.floor(u*o),d=Math.floor(c*o),f=this.getId(l,d,this.objectBuffer);if(-1!==f&&f!==_5){var p=this.getId(l,d,this.instanceBuffer);if(-1!==p&&p!==_5){var h=this.getId(l,d,this.groupBuffer);if(-1!==h&&h!==_5){var m=this.getDepth(l,d),v=S.create(t,r,m);if(Mb.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(v[0]=s.x+2*(u-g),RE(v,v,s,n.right.inverseProjectionView)):(v[0]=s.x+2*u,RE(v,v,s,n.left.inverseProjectionView))}else RE(v,v,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:p,groupId:h},position:v}}}}}}},e.prototype.identify=function(t,r,n){for(var a=0,i=this.spiral;a<i.length;a++){var o=i[a],s=this.identifyInternal(t+o[0],r+o[1],n);if(s)return s}},e}(),tJe=R(R({},Di),{tWboitA:Xt("texture","rgba","float","nearest"),tWboitB:Xt("texture","rgba","float","nearest"),uTexSize:Te("v2")}),rJe=Un("evaluate-wboit",No,"\nprecision highp float;\n\nuniform sampler2D tWboitA;\nuniform sampler2D tWboitB;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec4 accum = texture2D(tWboitA, coords);\n    float r = 1.0 - accum.a;\n\n    accum.a = texture2D(tWboitB, coords).r;\n    // divisor needs to allow very small values for nice fading\n    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);\n}\n"),aJe=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,e.isSupported(t)){var a=t.resources,i=t.gl;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.depthRenderbuffer=$t(i)?a.renderbuffer("depth32f","depth",r,n):a.renderbuffer("depth16","depth",r,n),this.renderable=function nJe(e,t,r){var n=R(R({},Ei),{tWboitA:O.create(t),tWboitB:O.create(r),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight()))}),a=R({},tJe);return Wa(qa(e,"triangles",rJe,a,n),n)}(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){Ct&&this.webgl.timer.mark("WboitPass.render");var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render(),Ct&&this.webgl.timer.markEnd("WboitPass.render")},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value;(t!==n[0]||r!==n[1])&&(this.textureA.define(t,r),this.textureB.define(t,r),this.depthRenderbuffer.setSize(t,r),O.update(this.renderable.values.uTexSize,Ne.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(a&&i&&o&&n)return!0;if(xr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'.concat(s.join('", "'),'" extensions required for "wboit"'))}return!1},e}(),sJe=R(R({},Di),{tDpoitBackColor:Xt("texture","rgba","float","nearest"),uTexSize:Te("v2")}),uJe=Un("blend-back-dpoit",No,"\n    precision highp float;\n\n    uniform sampler2D tDpoitBackColor;\n    uniform vec2 uTexSize;\n\n    void main() {\n        vec2 coords = gl_FragCoord.xy / uTexSize;\n        gl_FragColor = texture2D(tDpoitBackColor, coords);\n        if (gl_FragColor.a == 0.0) {\n            discard;\n        }\n    }\n"),lJe=R(R({},Di),{tDpoitFrontColor:Xt("texture","rgba","float","nearest"),uTexSize:Te("v2")}),dJe=Un("evaluate-dpoit",No,"\nprecision highp float;\n\nuniform sampler2D tDpoitFrontColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tDpoitFrontColor, coords);\n}\n"),pJe=function(){function e(t,r,n){if(this.webgl=t,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,e.isSupported(t)){var a=t.resources,i=t.extensions,o=i.colorBufferHalfFloat,s=i.textureHalfFloat;$t(t.gl)?(this.depthTextures=[a.texture("image-float32","rg","float","nearest"),a.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=o&&s?[a.texture("image-float16","rgba","fp16","nearest"),a.texture("image-float16","rgba","fp16","nearest")]:[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=o&&s?[a.texture("image-float16","rgba","fp16","nearest"),a.texture("image-float16","rgba","fp16","nearest")]:[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(r,n),this.depthTextures[1].define(r,n),this.colorFrontTextures[0].define(r,n),this.colorFrontTextures[1].define(r,n),this.colorBackTextures[0].define(r,n),this.colorBackTextures[1].define(r,n),this.depthFramebuffers=[a.framebuffer(),a.framebuffer()],this.colorFramebuffers=[a.framebuffer(),a.framebuffer()],this.blendBackRenderable=function cJe(e,t){var r=R(R({},Ei),{tDpoitBackColor:O.create(t),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight()))}),n=R({},sJe);return Wa(qa(e,"triangles",uJe,n,r),r)}(t,this.colorBackTextures[0]),this.renderable=function fJe(e,t){var r=R(R({},Ei),{tDpoitFrontColor:O.create(t),uTexSize:O.create(Ne.create(t.getWidth(),t.getHeight()))}),n=R({},lJe);return Wa(qa(e,"triangles",dJe,n,r),r)}(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl,a=t.extensions.blendMinMax;return this.passCount=0,this.depthFramebuffers[0].bind(),r.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),r.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),r.blendEquation(a.MAX),r.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}},e.prototype.bindDualDepthPeeling=function(){var t=this.webgl,r=t.state,n=t.gl,a=t.extensions.blendMinMax;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),r.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),r.blendEquation(a.MAX),r.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}},e.prototype.renderBlendBack=function(){Ct&&this.webgl.timer.mark("DpoitPass.renderBlendBack");var t=this.webgl,r=t.state,n=t.gl;r.blendEquation(n.FUNC_ADD),r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),O.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),Ct&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")},e.prototype.render=function(){Ct&&this.webgl.timer.mark("DpoitPass.render");var t=this.webgl,n=t.gl;t.state.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),O.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),Ct&&this.webgl.timer.markEnd("DpoitPass.render")},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value;if(t!==n[0]||r!==n[1]){for(var o=0;o<2;o++)this.depthTextures[o].define(t,r),this.colorFrontTextures[o].define(t,r),this.colorBackTextures[o].define(t,r);O.update(this.renderable.values.uTexSize,Ne.set(this.renderable.values.uTexSize.ref.value,t,r)),O.update(this.blendBackRenderable.values.uTexSize,Ne.set(this.blendBackRenderable.values.uTexSize.ref.value,t,r))}},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){for(var t=this.webgl.extensions.drawBuffers,r=0;r<2;r++)this.depthFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.colorFrontTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color1"),this.depthTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color2"),this.colorFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.colorFrontTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.blendMinMax;if(a&&i&&n&&o)return!0;if(xr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),n||s.push("drawBuffers"),o||s.push("blendMinMax"),console.log('Missing "'.concat(s.join('", "'),'" extensions required for "dpoit"'))}return!1},e}(),roe={enabled:D.Boolean(!0),highlightEdgeColor:D.Color(dt.darken(dt.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:D.Color(dt.darken(dt.fromNormalizedRgb(.2,1,.1),1)),edgeScale:D.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:D.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:D.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:D.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:D.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},noe=function(){function e(t,r,n){this.webgl=t,this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=function yJe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},Ei),{tMaskTexture:O.create(t),uTexSizeInv:O.create(Ne.create(1/r,1/n)),dEdgeScale:O.create(1)}),i=R({},vJe);return Wa(qa(e,"triangles",gJe,i,a),a)}(t,this.maskTarget.texture),this.overlay=function SJe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},Ei),{tEdgeTexture:O.create(t),uTexSizeInv:O.create(Ne.create(1/r,1/n)),uHighlightEdgeColor:O.create(S()),uSelectEdgeColor:O.create(S()),uHighlightEdgeStrength:O.create(1),uSelectEdgeStrength:O.create(1),uGhostEdgeStrength:O.create(0),uInnerEdgeFactor:O.create(0)}),i=R({},bJe);return Wa(qa(e,"triangles",_Je,i,a),a)}(t,this.edgesTarget.texture)}return e.isEnabled=function(t){return t.enabled},e.prototype.setEdgeState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.ONE,n.ONE),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setOverlayState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u)},e.prototype.setSize=function(t,r){var n=this.depthTarget.getWidth(),a=this.depthTarget.getHeight();(t!==n||r!==a)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),O.update(this.edge.values.uTexSizeInv,Ne.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),O.update(this.overlay.values.uTexSizeInv,Ne.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t){var r=t.highlightEdgeColor,n=t.selectEdgeColor,i=t.innerEdgeFactor,o=t.ghostEdgeStrength,s=t.highlightEdgeStrength,u=t.selectEdgeStrength,c=this.edge.values,l=Math.max(1,Math.round(t.edgeScale*this.webgl.pixelRatio));c.dEdgeScale.ref.value!==l&&(O.update(c.dEdgeScale,l),this.edge.update());var d=this.overlay.values;O.update(d.uHighlightEdgeColor,dt.toVec3Normalized(d.uHighlightEdgeColor.ref.value,r)),O.update(d.uSelectEdgeColor,dt.toVec3Normalized(d.uSelectEdgeColor.ref.value,n)),O.updateIfChanged(d.uInnerEdgeFactor,i),O.updateIfChanged(d.uGhostEdgeStrength,o),O.updateIfChanged(d.uHighlightEdgeStrength,s),O.updateIfChanged(d.uSelectEdgeStrength,u)},e.prototype.render=function(t,r){Ct&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(t),this.overlay.render(),Ct&&this.webgl.timer.markEnd("MarkingPass.render")},e}(),vJe=R(R({},Di),{tMaskTexture:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Te("v2"),dEdgeScale:Ut("number")}),gJe=Un("edge",No,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tMaskTexture;\nuniform vec2 uTexSizeInv;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);\n    vec4 c0 = texture2D(tMaskTexture, coords);\n    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);\n    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);\n    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);\n    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);\n    float diff1 = (c1.r - c2.r) * 0.5;\n    float diff2 = (c3.r - c4.r) * 0.5;\n    float d = length(vec2(diff1, diff2));\n    if (d <= 0.0)\n        discard;\n    float a1 = min(c1.g, c2.g);\n    float a2 = min(c3.g, c4.g);\n    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;\n    float mask = c0.r;\n    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));\n    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));\n    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);\n}\n"),bJe=R(R({},Di),{tEdgeTexture:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Te("v2"),uHighlightEdgeColor:Te("v3"),uSelectEdgeColor:Te("v3"),uHighlightEdgeStrength:Te("f"),uSelectEdgeStrength:Te("f"),uGhostEdgeStrength:Te("f"),uInnerEdgeFactor:Te("f")}),_Je=Un("overlay",No,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\nuniform sampler2D tEdgeTexture;\nuniform vec3 uHighlightEdgeColor;\nuniform vec3 uSelectEdgeColor;\nuniform float uHighlightEdgeStrength;\nuniform float uSelectEdgeStrength;\nuniform float uGhostEdgeStrength;\nuniform float uInnerEdgeFactor;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 edgeValue = texture2D(tEdgeTexture, coords);\n    if (edgeValue.a > 0.0) {\n        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;\n        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;\n        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;\n        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;\n        gl_FragColor.a *= edgeStrength;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}\n"),aoe=function(){function e(t,r,n,a,i,o){this.webgl=t;var s=t.extensions,u=t.resources,c=t.isWebGL2;this.drawTarget=function f8e(e){return{id:nee(),texture:Go(e),framebuffer:{id:zJ(),bind:function(){},reset:function(){},destroy:function(){}},depthRenderbuffer:null,getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}(t.gl),this.colorTarget=t.createRenderTarget(n,a,!0,"uint8","linear"),this.packedDepth=!s.depthTexture,this.depthTargetTransparent=t.createRenderTarget(n,a),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?t.createRenderTarget(n,a):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:u.texture("image-depth","depth",c?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(n,a),this.wboit=i?new aJe(t,n,a):void 0,this.dpoit=o?new pJe(t,n,a):void 0,this.marking=new noe(t,n,a),this.postprocessing=new lu(t,r,this),this.antialiasing=new y5(t,this),this.copyFboTarget=lb(t,this.colorTarget.texture),this.copyFboPostprocessing=lb(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!(null===(t=this.wboit)||void 0===t||!t.supported)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dpoitEnabled",{get:function(){var t;return!(null===(t=this.dpoit)||void 0===t||!t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t,r;null===(t=this.wboit)||void 0===t||t.reset(),null===(r=this.dpoit)||void 0===r||r.reset()},e.prototype.setSize=function(t,r){var n,a,i=this.colorTarget.getWidth(),o=this.colorTarget.getHeight();(t!==i||r!==o)&&(this.colorTarget.setSize(t,r),this.depthTargetTransparent.setSize(t,r),this.depthTargetOpaque?this.depthTargetOpaque.setSize(t,r):this.depthTextureOpaque.define(t,r),O.update(this.copyFboTarget.values.uTexSize,Ne.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),O.update(this.copyFboPostprocessing.values.uTexSize,Ne.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r))),!(null===(n=this.wboit)||void 0===n)&&n.supported&&this.wboit.setSize(t,r),!(null===(a=this.dpoit)||void 0===a)&&a.supported&&this.dpoit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r)},e.prototype._renderDpoit=function(t,r,n,a,i,o){var s;if(null===(s=this.dpoit)||void 0===s||!s.supported)throw new Error("expected dpoit to be supported");if(this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderDpoitOpaque(n.primitives,r,null),lu.isEnabled(o)&&(lu.isTransparentOutlineEnabled(o)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,i,t.props.backgroundColor,o,t.light)),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),n.opacityAverage<1){var u=lu.isEnabled(o)?this.postprocessing.target:this.colorTarget,c=this.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,c);for(var l=0;l<a;l++){Ct&&this.webgl.timer.mark("DpoitPass.layer");var d=this.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,d),u.bind(),this.dpoit.renderBlendBack(),Ct&&this.webgl.timer.markEnd("DpoitPass.layer")}u.bind(),this.dpoit.render()}n.volumes.renderables.length>0&&t.renderDpoitVolume(n.volumes,r,this.depthTextureOpaque)},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(null===(o=this.wboit)||void 0===o||!o.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderWboitOpaque(n.primitives,r,null),lu.isEnabled(i)&&(lu.isTransparentOutlineEnabled(i)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,a,t.props.backgroundColor,i,t.light)),(n.opacityAverage<1||n.volumes.renderables.length>0)&&(this.wboit.bind(),n.opacityAverage<1&&t.renderWboitTransparent(n.primitives,r,this.depthTextureOpaque),n.volumes.renderables.length>0&&t.renderWboitTransparent(n.volumes,r,this.depthTextureOpaque),lu.isEnabled(i)?this.postprocessing.target.bind():this.colorTarget.bind(),this.wboit.render())},e.prototype._renderBlended=function(t,r,n,a,i,o){var s,u,c,l;if(a?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderBlendedOpaque(n.primitives,r,null),!a&&(this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),t.clearDepth(!0),t.renderDepthOpaque(n.primitives,r,null),this.colorTarget.bind()),lu.isEnabled(o)&&(this.packedDepth?null===(s=this.colorTarget.depthRenderbuffer)||void 0===s||s.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),lu.isTransparentOutlineEnabled(o)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,i,t.props.backgroundColor,o,t.light),this.packedDepth?null===(u=this.colorTarget.depthRenderbuffer)||void 0===u||u.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),n.volumes.renderables.length>0)){var d=lu.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth?null===(c=this.colorTarget.depthRenderbuffer)||void 0===c||c.detachFramebuffer(d.framebuffer):this.depthTextureOpaque.detachFramebuffer(d.framebuffer,"depth"),d.bind(),t.renderBlendedVolume(n.volumes,r,this.depthTextureOpaque),this.packedDepth?null===(l=this.colorTarget.depthRenderbuffer)||void 0===l||l.attachFramebuffer(d.framebuffer):this.depthTextureOpaque.attachFramebuffer(d.framebuffer,"depth"),d.bind()}n.opacityAverage<1&&t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o,s){var u=n.volumes.renderables.length>0,c=lu.isEnabled(s.postprocessing),l=y5.isEnabled(s.postprocessing),d=noe.isEnabled(s.marking),f=r.viewport;t.setViewport(f.x,f.y,f.width,f.height),t.update(r,n),o&&!l&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s.postprocessing):this.dpoitEnabled?this._renderDpoit(t,r,n,s.dpoitIterations,o,s.postprocessing):this._renderBlended(t,r,n,!u&&!c&&!l&&i,o,s.postprocessing);var g=c?this.postprocessing.target:!i||u||this.wboitEnabled||this.dpoitEnabled?this.colorTarget:this.drawTarget;if(d&&n.markerAverage>0){var y=s.marking.ghostEdgeStrength<1;y&&1!==n.markerAverage&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r,null)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,y?this.marking.depthTarget.texture:null),this.marking.update(s.marking),this.marking.render(r.viewport,g)}else g.bind();a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera,a.camera.scene),t.renderBlended(a.camera.scene,a.camera.camera)),l?this.antialiasing.render(r,i,s.postprocessing):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),c?this.copyFboPostprocessing.render():(u||this.wboitEnabled||this.dpoitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n){Ct&&this.webgl.timer.mark("DrawPass.render");var a=t.renderer,i=t.camera,o=t.scene,s=t.helper;this.postprocessing.setTransparentBackground(r.transparentBackground);var u=r.transparentBackground||this.postprocessing.background.isEnabled(r.postprocessing.background);a.setTransparentBackground(u),a.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),a.setPixelRatio(this.webgl.pixelRatio),Mb.is(i)?(Ct&&this.webgl.timer.mark("StereoCamera.left"),this._render(a,i.left,o,s,n,u,r),Ct&&this.webgl.timer.markEnd("StereoCamera.left"),Ct&&this.webgl.timer.mark("StereoCamera.right"),this._render(a,i.right,o,s,n,u,r),Ct&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(a,i,o,s,n,u,r),Ct&&this.webgl.timer.markEnd("DrawPass.render")},e.prototype.getColorTarget=function(t){return y5.isEnabled(t)?this.antialiasing.target:lu.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),CJe={alpha:D.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:D.Color(gr.red,{isEssential:!0}),colorY:D.Color(gr.green,{isEssential:!0}),colorZ:D.Color(gr.blue,{isEssential:!0}),scale:D.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:D.Select("bottom-left",D.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:D.Numeric(0),locationOffsetY:D.Numeric(0),originColor:D.Color(gr.grey),radiusScale:D.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:D.Boolean(!0),planeColorXY:D.Color(gr.grey,{label:"Plane Color XY"}),planeColorXZ:D.Color(gr.grey,{label:"Plane Color XZ"}),planeColorYZ:D.Color(gr.grey,{label:"Plane Color YZ"}),showLabels:D.Boolean(!1),labelX:D.Text("X"),labelY:D.Text("Y"),labelZ:D.Text("Z"),labelColorX:D.Color(gr.grey),labelColorY:D.Color(gr.grey),labelColorZ:D.Color(gr.grey),labelOpacity:D.Numeric(1,{min:0,max:1,step:.01}),labelScale:D.Numeric(.25,{min:.1,max:1,step:.01})},UE={axes:D.MappedStatic("on",{on:D.Group(CJe),off:D.Group({})},{cycle:!0,description:"Show camera orientation axes"})},ioe=function(){function e(t,r){void 0===r&&(r={});var n=this;this.webgl=t,this.props={axes:{name:"off",params:{}}},this.pixelRatio=1,this.eachGroup=function(a,i){if(!S5(a))return!1;var o=!1;if(n.meshRenderObject)for(var s=n.meshRenderObject.values.uGroupCount.ref.value,u=0,c=a.elements;u<c.length;u++){var l=c[u];i(xe.ofSingleton(l.instanceId*s+l.groupId))&&(o=!0)}if(n.textRenderObject){s=n.textRenderObject.values.uGroupCount.ref.value;for(var h=0,m=a.elements;h<m.length;h++){var v=m[h];i(xe.ofSingleton(v.instanceId*s+v.groupId))&&(o=!0)}}return o},this.scene=Pb.create(t,YD),this.camera=new Xa,S.set(this.camera.up,0,1,0),S.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=Gk(this.props,function(n){if(void 0!==t.axes&&(n.axes.name=t.axes.name,"on"===t.axes.name)){r.scene.clear(),r.pixelRatio=r.webgl.pixelRatio;var a=R(R({},t.axes.params),{scale:t.axes.params.scale*r.pixelRatio,labelScale:t.axes.params.labelScale*r.pixelRatio});r.meshRenderObject=function EJe(e){var t=function DJe(e,t){var r=100*e.scale,n=function TJe(e,t){var r=ft.createState(512,256,t),n=100*e.scale,a=e.radiusScale*n,i=e.showLabels?100*e.labelScale/3:0,o=S.scale(S(),S.unitX,n-i),s=S.scale(S(),S.unitY,n-i),u=S.scale(S(),S.unitZ,n-i),c={radiusTop:a,radiusBottom:a,radialSegments:32};if(r.currentGroup=Sn.Origin,$r(r,S.origin,a,2),r.currentGroup=Sn.X,$r(r,o,a,2),Hr(r,S.origin,o,1,c),r.currentGroup=Sn.Y,$r(r,s,a,2),Hr(r,S.origin,s,1,c),r.currentGroup=Sn.Z,$r(r,u,a,2),Hr(r,S.origin,u,1,c),e.showPlanes){S.scale(o,o,.5),S.scale(s,s,.5),S.scale(u,u,.5),r.currentGroup=Sn.XY,ft.addTriangle(r,S.origin,o,s),ft.addTriangle(r,S.origin,s,o);var l=S.add(S(),o,s);ft.addTriangle(r,l,o,s),ft.addTriangle(r,l,s,o),r.currentGroup=Sn.XZ,ft.addTriangle(r,S.origin,o,u),ft.addTriangle(r,S.origin,u,o);var d=S.add(S(),o,u);ft.addTriangle(r,d,o,u),ft.addTriangle(r,d,u,o),r.currentGroup=Sn.YZ,ft.addTriangle(r,S.origin,s,u),ft.addTriangle(r,S.origin,u,s);var f=S.add(S(),s,u);ft.addTriangle(r,f,s,u),ft.addTriangle(r,f,u,s)}return ft.getMesh(r)}(e,t?.geometry);n.setBoundingSphere(De.create(S.create(r/2,r/2,r/2),r+r/4));return Wr.create("axes-mesh",{},n,function(i){switch(i){case Sn.X:return e.colorX;case Sn.Y:return e.colorY;case Sn.Z:return e.colorZ;case Sn.XY:return e.planeColorXY;case Sn.XZ:return e.planeColorXZ;case Sn.YZ:return e.planeColorYZ;case Sn.Origin:return e.originColor;default:return gr.grey}},function(){return 1},function(){return""})}(e);return Wr.createRenderObject(t,R(R(R({},D.getDefaultValues(Lt.Params)),e),{ignoreLight:!0}))}(a),r.scene.add(r.meshRenderObject),t.axes.params.showLabels?(r.textRenderObject=function MJe(e){var t=function PJe(e,t){var r=100*e.scale,n=function IJe(e,t){var r=ff.create(e,8,8,t),n=100*e.scale,a=S.scale(S(),S.unitX,n),i=S.scale(S(),S.unitY,n),o=S.scale(S(),S.unitZ,n),s=100*e.labelScale;return r.add(e.labelX,a[0],a[1],a[2],0,s,Sn.X),r.add(e.labelY,i[0],i[1],i[2],0,s,Sn.Y),r.add(e.labelZ,o[0],o[1],o[2],0,s,Sn.Z),r.getText()}(e,t?.geometry);n.setBoundingSphere(De.create(S.create(r/2,r/2,r/2),r));return Wr.create("axes-text",{},n,function(i){switch(i){case Sn.X:return e.labelColorX;case Sn.Y:return e.labelColorY;case Sn.Z:return e.labelColorZ;default:return gr.grey}},function(){return 1},function(){return""})}(e);return Wr.createRenderObject(t,R(R(R({},D.getDefaultValues(hc.Params)),e),{alpha:e.labelOpacity}))}(a),r.scene.add(r.textRenderObject)):r.textRenderObject=void 0,r.scene.commit(),S.set(r.camera.position,0,0,200*a.scale),me.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=R({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return"on"===this.props.axes.name},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId;return(this.meshRenderObject&&r===this.meshRenderObject.id||this.textRenderObject&&r===this.textRenderObject.id)&&n!==Sn.None?function wJe(e,t,r){return pE("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return function xJe(e,t){var r=t.props.axes,n="on"===r.name?r.params.labelX:"X",a="on"===r.name?r.params.labelY:"Y",i="on"===r.name?r.params.labelZ:"Z";switch(e){case Sn.X:return"".concat(n," Axis");case Sn.Y:return"".concat(a," Axis");case Sn.Z:return"".concat(i," Axis");case Sn.XY:return"".concat(n).concat(a," Plane");case Sn.XZ:return"".concat(n).concat(i," Plane");case Sn.YZ:return"".concat(a).concat(i," Plane");case Sn.Origin:return"Origin";default:return"Axes"}}(t,e)})}(this,n,t.instanceId):Yr},e.prototype.mark=function(t,r){return!(!Is.is(Is.Highlighting,r)||!(ku(t)||S5(t)&&t.data===this))&&(_r.mark(this.meshRenderObject,t,r,this.eachGroup)||_r.mark(this.textRenderObject,t,r,this.eachGroup))},e.prototype.update=function(t){if(this.meshRenderObject&&"off"!==this.props.axes.name){this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),function AJe(e,t,r){var i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,c=(o-i)/2,l=(s-u)/2,d=(o+i)/2,f=(s+u)/2,p=d-c,h=d+c,m=f+l,v=f-l;if(r.enabled){var g=(o-i)/r.width,y=(s-u)/r.height;h=(p+=g*r.offsetX)+g*r.width,v=(m-=y*r.offsetY)-y*r.height}me.ortho(e.projection,p,h,m,v,e.near,e.far)}(this.camera,t.viewport,t.viewOffset),me.extractRotation(this.scene.view,t.view);var r=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,a=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio;"bottom-left"===n?me.setTranslation(this.scene.view,S.create(-t.viewport.width/2+r+a,-t.viewport.height/2+r+i,0)):"bottom-right"===n?me.setTranslation(this.scene.view,S.create(t.viewport.width/2-r-a,-t.viewport.height/2+r+i,0)):"top-left"===n?me.setTranslation(this.scene.view,S.create(-t.viewport.width/2+r+a,t.viewport.height/2-r-i,0)):"top-right"===n?me.setTranslation(this.scene.view,S.create(t.viewport.width/2-r-a,t.viewport.height/2-r-i,0)):xn()}},e}(),Sn=function(e){return e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z",e[e.XY=4]="XY",e[e.XZ=5]="XZ",e[e.YZ=6]="YZ",e[e.Origin=7]="Origin",e}(Sn||{});function S5(e){return"data-loci"===e.kind&&"camera-axes"===e.tag}var RJe={transparentBackground:D.Boolean(!1),dpoitIterations:D.Numeric(2,{min:1,max:10,step:1}),multiSample:D.Group(Zie),postprocessing:D.Group(Kie),marking:D.Group(roe),cameraHelper:D.Group(UE)},OJe=function(){function e(t,r,n,a,i,o,s,u,c){this.webgl=t,this.renderer=n,this.scene=a,this.camera=i,this._width=0,this._height=0,this._camera=new Xa,this.props=R(R({},D.getDefaultValues(RJe)),c),this.drawPass=new aoe(t,r,128,128,s,u),this.multiSamplePass=new LE(t,this.drawPass),this.multiSampleHelper=new Qie(this.multiSamplePass),this.helper={camera:new ioe(t,this.props.cameraHelper),debug:o.debug,handle:o.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.updateBackground=function(){var t=this;return new Promise(function(r){t.drawPass.postprocessing.background.update(t.camera,t.props.postprocessing.background,function(){r()})})},e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){void 0===t&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){Xa.copySnapshot(this._camera.state,this.camera.state),fo.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();var t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};LE.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=null!==(a=n?.width)&&void 0!==a?a:t,s=null!==(i=n?.height)&&void 0!==i?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var c=ag.create(u,o,s);return ag.flipY(c),ag.divideByAlpha(c),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),FJe=R(R({},Lt.Params),{alpha:R(R({},Lt.Params.alpha),{defaultValue:1}),ignoreLight:R(R({},Lt.Params.ignoreLight),{defaultValue:!0}),colorX:D.Color(gr.red,{isEssential:!0}),colorY:D.Color(gr.green,{isEssential:!0}),colorZ:D.Color(gr.blue,{isEssential:!0}),scale:D.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),ooe={handle:D.MappedStatic("off",{on:D.Group(FJe),off:D.Group({})},{cycle:!0,description:"Show handle tool"})},NJe=function(){function e(t,r){void 0===r&&(r={});var n=this;this.webgl=t,this.props={handle:{name:"off",params:{}}},this.pixelRatio=1,this._transform=me(),this.eachGroup=function(a,i){if(!n.renderObject||!soe(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,c=0,l=a.elements;c<l.length;c++){var d=l[c];i(xe.ofSingleton(d.instanceId*s+d.groupId))&&(o=!0)}return o},this.scene=Pb.create(t,YD),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(De.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),me.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,16*r),De.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=Gk(this.props,function(n){if(void 0!==t.handle&&(n.handle.name=t.handle.name,"on"===t.handle.name)){r.scene.clear(),r.pixelRatio=r.webgl.pixelRatio;var a=R(R({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=function UJe(e){var t=function LJe(e,t){var r=10*e.scale,n=function kJe(e,t){var r=ft.createState(512,256,t),n=.05*e,a=S.scale(S(),S.unitX,e),i=S.scale(S(),S.unitY,e),o=S.scale(S(),S.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=Cg.TranslateScreenXY,$r(r,S.origin,3*n,2),r.currentGroup=Cg.TranslateObjectX,$r(r,a,n,2),Hr(r,S.origin,a,1,s),r.currentGroup=Cg.TranslateObjectY,$r(r,i,n,2),Hr(r,S.origin,i,1,s),r.currentGroup=Cg.TranslateObjectZ,$r(r,o,n,2),Hr(r,S.origin,o,1,s),ft.getMesh(r)}(r,t?.geometry);n.setBoundingSphere(De.create(S.create(r/2,r/2,r/2),r+r/4));return Wr.create("handle",{},n,function(i){switch(i){case Cg.TranslateObjectX:return e.colorX;case Cg.TranslateObjectY:return e.colorY;case Cg.TranslateObjectZ:return e.colorZ;default:return gr.grey}},function(){return 1},function(){return""})}(e);return Wr.createRenderObject(t,e)}(a),r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=R({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return"on"===this.props.handle.name},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),me.setTranslation(this.renderObject.values.aTransform.ref.value,r),me.fromMat3(this.renderObject.values.aTransform.ref.value,n),O.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){return this.renderObject&&t.objectId===this.renderObject.id?function BJe(e,t,r){return pE("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id ".concat(t," | Instance Id ").concat(r)})}(this,t.groupId,t.instanceId):Yr},e.prototype.mark=function(t,r){return!(!Is.is(Is.Highlighting,r)||!(ku(t)||soe(t)&&t.data===this))&&_r.mark(this.renderObject,t,r,this.eachGroup)},e}(),Cg={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function soe(e){return"data-loci"===e.kind&&"handle"===e.tag}var x5,VJe={debug:D.Group(m5),camera:D.Group({helper:D.Group(UE)}),handle:D.Group(ooe)},zJe=D.getDefaultValues(VJe),GJe=function(){return function e(t,r,n){void 0===n&&(n={});var a=R(R({},zJe),n);this.debug=new IQe(t,r,a.debug),this.camera=new ioe(t,a.camera.helper),this.handle=new NJe(t,a.handle)}}(),HJe=function(){function e(t,r,n){void 0===n&&(n={}),this.webgl=t;var a=t.gl;this.draw=new aoe(t,r,a.drawingBufferWidth,a.drawingBufferHeight,n.enableWboit||!1,n.enableDpoit||!1),this.pick=new $$e(t,this.draw,n.pickScale||.25),this.multiSample=new LE(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl,r=Math.max(t.drawingBufferWidth,2),n=Math.max(t.drawingBufferHeight,2);this.draw.setSize(r,n),this.pick.syncSize(),this.multiSample.syncSize()},e}(),uoe={camera:D.Group({mode:D.Select("perspective",D.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:D.Group(UE,{isFlat:!0}),stereo:D.MappedStatic("off",{on:D.Group($ie),off:D.Group({})},{cycle:!0,hideIf:function(e){return"perspective"!==e?.mode}}),fov:D.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:D.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:D.MappedStatic("on",{on:D.Group({intensity:D.Numeric(15,{min:1,max:100,step:1})}),off:D.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:D.Group({radius:D.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:D.Boolean(!0,{description:"Hide scene in the distance"}),minNear:D.Numeric(5,{min:.1,max:100,step:.1},{description:"Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:D.MappedStatic("canvas",{canvas:D.Group({}),"static-frame":D.Group({x:D.Numeric(0),y:D.Numeric(0),width:D.Numeric(128),height:D.Numeric(128)}),"relative-frame":D.Group({x:D.Numeric(.33,{min:0,max:1,step:.01}),y:D.Numeric(.33,{min:0,max:1,step:.01}),width:D.Numeric(.5,{min:.01,max:1,step:.01}),height:D.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:D.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:D.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:D.Boolean(!1),dpoitIterations:D.Numeric(2,{min:1,max:10,step:1}),multiSample:D.Group(Zie),postprocessing:D.Group(Kie),marking:D.Group(roe),renderer:D.Group(l5),trackball:D.Group(Fie),interaction:D.Group(Uie),debug:D.Group(m5),handle:D.Group(ooe)},C5=D.getDefaultValues(uoe);!function(e){e.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,pickPadding:1,enableWboit:!0,enableDpoit:!1,preferWebGl1:!1},e.fromCanvas=function t(r,n,a){void 0===a&&(a={});var i=R(R({},e.DefaultAttribs),a);if(i.enableWboit&&i.enableDpoit)throw new Error("Multiple transparency methods not allowed.");var l=i.pixelScale,f=function y8e(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=(t?.preferWebGl1?null:r("webgl2"))||r("webgl")||r("experimental-webgl");return xr&&console.log("isWebgl2: ".concat($t(n))),n}(r,{powerPreference:i.powerPreference,failIfMajorPerformanceCaveat:i.failIfMajorPerformanceCaveat,antialias:i.antialias,preserveDrawingBuffer:i.preserveDrawingBuffer,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:i.preferWebGl1});if(null===f)throw new Error("Could not create a WebGL rendering context");var p=c5.fromElement(r,{pixelScale:l,preventGestures:!0}),h=function x8e(e,t){var r=this;void 0===t&&(t={});var n=HJ(e),a=function nUe(e,t){var r={},n=e.getParameter(e.FRONT_FACE),a=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),o=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),u=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),l=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),m=e.getParameter(e.BLEND_EQUATION_RGB),v=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),y=e.getParameter(e.STENCIL_VALUE_MASK),b=e.getParameter(e.STENCIL_REF),_=e.getParameter(e.STENCIL_BACK_FUNC),C=e.getParameter(e.STENCIL_BACK_VALUE_MASK),x=e.getParameter(e.STENCIL_BACK_REF),A=e.getParameter(e.STENCIL_WRITEMASK),T=e.getParameter(e.STENCIL_BACK_WRITEMASK),w=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),M=e.getParameter(e.STENCIL_BACK_FAIL),F=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),N=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),j=e.getParameter(e.MAX_VERTEX_ATTRIBS),k=[],H=e.getParameter(e.VIEWPORT),G=e.getParameter(e.SCISSOR_BOX),U=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,Q=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1,W=function(){for(var K=0;K<j;++K)k[K]=0};return W(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(K){!0!==r[K]&&(e.enable(K),r[K]=!0)},disable:function(K){!1!==r[K]&&(e.disable(K),r[K]=!1)},frontFace:function(K){K!==n&&(e.frontFace(K),n=K)},cullFace:function(K){K!==a&&(e.cullFace(K),a=K)},depthMask:function(K){K!==i&&(e.depthMask(K),i=K)},clearDepth:function(K){K!==o&&(e.clearDepth(K),o=K)},depthFunc:function(K){K!==s&&(e.depthFunc(K),s=K)},colorMask:function(K,ne,X,L){(K!==u[0]||ne!==u[1]||X!==u[2]||L!==u[3])&&(e.colorMask(K,ne,X,L),u[0]=K,u[1]=ne,u[2]=X,u[3]=L)},clearColor:function(K,ne,X,L){(K!==c[0]||ne!==c[1]||X!==c[2]||L!==c[3])&&(e.clearColor(K,ne,X,L),c[0]=K,c[1]=ne,c[2]=X,c[3]=L)},blendFunc:function(K,ne){(K!==l||ne!==d||K!==f||ne!==p)&&(e.blendFunc(K,ne),l=K,d=ne,f=K,p=ne)},blendFuncSeparate:function(K,ne,X,L){(K!==l||ne!==d||X!==f||L!==p)&&(e.blendFuncSeparate(K,ne,X,L),l=K,d=ne,f=X,p=L)},blendEquation:function(K){(K!==m||K!==v)&&(e.blendEquation(K),m=K,v=K)},blendEquationSeparate:function(K,ne){(K!==m||ne!==v)&&(e.blendEquationSeparate(K,ne),m=K,v=ne)},blendColor:function(K,ne,X,L){(K!==h[0]||ne!==h[1]||X!==h[2]||L!==h[3])&&(e.blendColor(K,ne,X,L),h[0]=K,h[1]=ne,h[2]=X,h[3]=L)},stencilFunc:function(K,ne,X){(K!==g||ne!==b||X!==y||K!==_||ne!==x||X!==C)&&(e.stencilFunc(K,ne,X),g=K,b=ne,y=X,_=K,x=ne,C=X)},stencilFuncSeparate:function(K,ne,X,L){K===e.FRONT?(ne!==g||X!==b||L!==y)&&(e.stencilFuncSeparate(K,ne,X,L),g=ne,b=X,y=L):K===e.BACK?(ne!==_||X!==x||L!==C)&&(e.stencilFuncSeparate(K,ne,X,L),_=ne,x=X,C=L):K===e.FRONT_AND_BACK&&(ne!==g||X!==b||L!==y||ne!==_||X!==x||L!==C)&&(e.stencilFuncSeparate(K,ne,X,L),g=ne,b=X,y=L,_=ne,x=X,C=L)},stencilMask:function(K){(K!==A||K!==T)&&(e.stencilMask(K),A=K,T=K)},stencilMaskSeparate:function(K,ne){K===e.FRONT?ne!==A&&(e.stencilMaskSeparate(K,ne),A=ne):K===e.BACK?ne!==T&&(e.stencilMaskSeparate(K,ne),T=ne):K===e.FRONT_AND_BACK&&(ne!==A||ne!==T)&&(e.stencilMaskSeparate(K,ne),A=ne,T=ne)},stencilOp:function(K,ne,X){(K!==w||ne!==I||X!==E||K!==M||ne!==N||X!==F)&&(e.stencilOp(K,ne,X),w=K,I=ne,E=X,M=K,N=ne,F=X)},stencilOpSeparate:function(K,ne,X,L){K===e.FRONT?(ne!==w||X!==I||L!==E)&&(e.stencilOpSeparate(K,ne,X,L),w=ne,I=X,E=L):K===e.BACK?(ne!==M||X!==N||L!==F)&&(e.stencilOpSeparate(K,ne,X,L),M=ne,N=X,F=L):K===e.FRONT_AND_BACK&&(ne!==w||X!==I||L!==E||ne!==M||X!==N||L!==F)&&(e.stencilOpSeparate(K,ne,X,L),w=ne,I=X,E=L,M=ne,N=X,F=L)},enableVertexAttrib:function(K){e.enableVertexAttribArray(K),k[K]=1},clearVertexAttribsState:W,disableUnusedVertexAttribs:function(){for(var K=0;K<j;++K)0===k[K]&&e.disableVertexAttribArray(K)},viewport:function(K,ne,X,L){(K!==H[0]||ne!==H[1]||X!==H[2]||L!==H[3])&&(e.viewport(K,ne,X,L),H[0]=K,H[1]=ne,H[2]=X,H[3]=L)},scissor:function(K,ne,X,L){(K!==G[0]||ne!==G[1]||X!==G[2]||L!==G[3])&&(e.scissor(K,ne,X,L),G[0]=K,G[1]=ne,G[2]=X,G[3]=L)},clipControl:t.clipControl?function(K,ne){(K!==U||ne!==Q)&&(t.clipControl.clipControl(K,ne),U=K,Q=ne)}:void 0,reset:function(){r={},n=e.getParameter(e.FRONT_FACE),a=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),o=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),u=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),l=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),m=e.getParameter(e.BLEND_EQUATION_RGB),v=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),y=e.getParameter(e.STENCIL_VALUE_MASK),b=e.getParameter(e.STENCIL_REF),_=e.getParameter(e.STENCIL_BACK_FUNC),C=e.getParameter(e.STENCIL_BACK_VALUE_MASK),x=e.getParameter(e.STENCIL_BACK_REF),A=e.getParameter(e.STENCIL_WRITEMASK),T=e.getParameter(e.STENCIL_BACK_WRITEMASK),w=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),M=e.getParameter(e.STENCIL_BACK_FAIL),F=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),N=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),j=e.getParameter(e.MAX_VERTEX_ATTRIBS),k.length=0;for(var K=0;K<j;++K)k[K]=0;H=e.getParameter(e.VIEWPORT),G=e.getParameter(e.SCISSOR_BOX),U=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,Q=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}(e,n),i={resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,counts:0}},o=l8e(e,a,i,n),s=function v8e(e,t,r,n){var a,i=t.disjointTimerQuery,o=null!==(a=n?.avgCount)&&void 0!==a?a:30,s=new Map,u=new Map,c=[],l=new aee(o),d=new aee(o),f=[],p=null,h=!1,m=function(){i&&(s.forEach(function(g,y){i.deleteQuery(y)}),u.clear(),f=[],p=null)},v=function(){if(i){var g=function m8e(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}(t);g&&(i.beginQuery(i.TIME_ELAPSED,g),u.forEach(function(y,b){y.queries.push(g)}),s.set(g,{refCount:u.size}),p=g)}};return{resolve:function(){var g=[];if(!i||!f.length)return g;s.forEach(function(A,T){if(void 0===A.timeElapsed){var w=i.getQueryParameter(T,i.QUERY_RESULT_AVAILABLE),E=e.getParameter(i.GPU_DISJOINT);if(w&&!E){var I=i.getQueryParameter(T,i.QUERY_RESULT);A.timeElapsed=I}(w||E)&&i.deleteQuery(T)}});for(var y=[],b=function(A){if(A.queries.every(function(k){var H;return void 0!==(null===(H=s.get(k))||void 0===H?void 0:H.timeElapsed)})){for(var T=0,w=0,E=A.queries;w<E.length;w++){var M=s.get(E[w]);T+=M.timeElapsed,M.refCount-=1}if(A.timeElapsed=T,A.root){var F=[],N=function(k,H){for(var G=0,U=k;G<U.length;G++){var Q=U[G],W=Q.timeElapsed,K=Q.cpu.end-Q.cpu.start,ne={label:Q.label,gpuElapsed:W,gpuAvg:l.add(Q.label,W),cpuElapsed:K,cpuAvg:d.add(Q.label,K),children:[],calls:Q.calls};H.push(ne),N(Q.children,ne.children)}};N(A.children,F);var j=A.cpu.end-A.cpu.start;g.push({label:A.label,gpuElapsed:T,gpuAvg:l.add(A.label,T),cpuElapsed:j,cpuAvg:d.add(A.label,j),children:F,calls:A.calls})}}else y.push(A)},_=0,C=f;_<C.length;_++)b(C[_]);return f=y,s.forEach(function(A,T){0===A.refCount&&s.delete(T)}),g},mark:function(g,y){if(void 0===y&&(y=!1),i){if(u.has(g))throw new Error("Timer mark for '".concat(g,"' already exists"));null!==p&&i.endQuery(i.TIME_ELAPSED);var b={label:g,queries:[],children:[],root:null===p,cpu:{start:da(),end:-1},captureCalls:y};if(u.set(g,b),c.length&&c[c.length-1].children.push(b),c.push(b),y){if(h)throw new Error("Already capturing calls");(function h8e(e){e.calls.drawInstanced=0,e.calls.counts=0})(r),h=!0}v()}},markEnd:function(g){var y;if(i){var b=u.get(g);if(!b)throw new Error("Timer mark for '".concat(g,"' does not exist"));if((null===(y=c.pop())||void 0===y?void 0:y.label)!==g)throw new Error("Timer mark for '".concat(g,"' has pending nested mark"));i.endQuery(i.TIME_ELAPSED),u.delete(g),b.cpu.end=da(),b.captureCalls&&(b.calls={drawInstanced:r.calls.drawInstanced,counts:r.calls.counts},h=!1),f.push(b),u.size>0?v():p=null}},stats:function(){return{gpu:l.stats(),cpu:d.stats()}},formatedStats:function(){for(var g={},y=l.stats(),b=d.stats(),_=0,C=Object.keys(y);_<C.length;_++){var x=C[_],A="".concat((y[x]/1e3/1e3).toFixed(2)),T="".concat(b[x].toFixed(2));g[x]="".concat(A," ms | CPU: ").concat(T," ms")}return g},clear:m,destroy:function(){m()}}}(e,n,i),u={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:$t(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(u.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var c=n.provokingVertex;c?.provokingVertex(c.FIRST_VERTEX_CONVENTION);var f,l=!1,d=new Li(0);if($t(e)){var p=e.createBuffer(),h=void 0,m=void 0,v=!1,g=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,p),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,h),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,m(),m=void 0,h=void 0};f=function(b,_,C,x,A){return new Promise(function(T,w){v?w("Can not call multiple readPixelsAsync at the same time"):(v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,p),e.bufferData(e.PIXEL_PACK_BUFFER,C*x*4,e.STREAM_READ),e.readPixels(b,_,C,x,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),m=T,h=A,lee(e,g))})}}else f=function(b,_,C,x,A){return ce(r,void 0,void 0,function(){return le(this,function(T){return eB(e,b,_,C,x,A),[2]})})};var y=new Set;return{gl:e,isWebGL2:$t(e),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,timer:s,get maxTextureSize(){return u.maxTextureSize},get max3dTextureSize(){return u.max3dTextureSize},get maxRenderbufferSize(){return u.maxRenderbufferSize},get maxDrawBuffers(){return u.maxDrawBuffers},get maxTextureImageUnits(){return u.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return l||e.isContextLost()},contextRestored:d,setContextLost:function(){l=!0},handleContextRestored:function(b){Object.assign(n,HJ(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),y.forEach(function(_){return _.reset()}),b?.(),l=!1,d.next(da())},createRenderTarget:function(b,_,C,x,A,T){var w=function d8e(e,t,r,n,a,i,o,s){if(void 0===a&&(a=!0),void 0===i&&(i="uint8"),void 0===o&&(o="nearest"),void 0===s&&(s="rgba"),"alpha"===s&&!$t(e))throw new Error("cannot render to alpha format in webgl1");var u=t.framebuffer(),c="fp16"===i?t.texture("image-float16",s,"fp16",o):"float32"===i?t.texture("image-float32",s,"float",o):t.texture("image-uint8",s,"ubyte",o),l=a?$t(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function d(){c.define(r,n),c.attachFramebuffer(u,"color0"),l&&l.attachFramebuffer(u)}d();var f=!1;return{id:nee(),texture:c,framebuffer:u,depthRenderbuffer:l,getWidth:function(){return r},getHeight:function(){return n},bind:function(){u.bind()},setSize:function(p,h){r===p&&n===h||(c.define(r=p,n=h),l&&l.setSize(r,n))},reset:function(){d()},destroy:function(){f||(c.destroy(),u.destroy(),l&&l.destroy(),f=!0)}}}(e,o,b,_,C,x,A,T);return y.add(w),R(R({},w),{destroy:function(){w.destroy(),y.delete(w)}})},unbindFramebuffer:function(){return RD(e)},readPixels:function(b,_,C,x,A){eB(e,b,_,C,x,A)},readPixelsAsync:f,waitForGpuCommandsComplete:function(){return function _8e(e){return new Promise(function(t){$t(e)?lee(e,t):(dee||(console.info("Sync object not supported in WebGL"),dee=!0),fee(e),t())})}(e)},waitForGpuCommandsCompleteSync:function(){return fee(e)},getDrawingBufferPixelData:function(){return function S8e(e,t){var r=e.drawingBufferWidth,n=e.drawingBufferHeight,a=new Uint8Array(r*n*4);return RD(e),t.viewport(0,0,r,n),eB(e,0,0,r,n,a),ag.flipY(ag.create(a,r,n))}(e,a)},clear:function(b,_,C,x){RD(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(b,_,C,x),a.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),a.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(b){var _,C;o.destroy(),function b8e(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),$t(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);var a=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),RD(e)}(e),b?.doNotForceWebGLContextLoss||(null===(_=e.getExtension("WEBGL_lose_context"))||void 0===_||_.loseContext(),null===(C=e.getExtension("STACKGL_destroy_context"))||void 0===C||C.destroy())}}}(f,{pixelScale:l}),m=new HJe(h,n,i);if(xr){var v=f.getExtension("WEBGL_lose_context");v&&r.addEventListener("mousedown",function(_){h.isContextLost||!_.shiftKey||!_.ctrlKey||!_.altKey||(xr&&console.log("lose context"),v.loseContext(),setTimeout(function(){h.isContextLost&&(xr&&console.log("restore context"),v.restoreContext())},1e3))},!1)}var g=new Li(0),y=function(_){h.setContextLost(),_.preventDefault(),xr&&console.log("context lost"),g.next(da())},b=function(){h.isContextLost&&(h.handleContextRestored(function(){m.draw.reset()}),xr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",y,!1),r.addEventListener("webglcontextrestored",b,!1),{canvas:r,webgl:h,input:p,passes:m,attribs:i,contextLost:g,contextRestored:h.contextRestored,assetManager:n,dispose:function(_){p.dispose(),r.removeEventListener("webglcontextlost",y,!1),r.removeEventListener("webglcontextrestored",b,!1),h.destroy(_)}}}}(x5||(x5={}));var w5,jJe=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},coe=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)};function qJe(e){loe(e)}function loe(e){Sr.Canvas3D.ResetSettings.subscribe(e,function(){var t;null===(t=e.canvas3d)||void 0===t||t.setProps(C5),e.events.canvas3d.settingsUpdated.next(void 0)}),Sr.Canvas3D.SetSettings.subscribe(e,function(t){var r;e.canvas3d&&(null===(r=e.canvas3d)||void 0===r||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}!function(e){e.create=function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs,u=r.assetManager;void 0===n&&(n={});var c=R(R({},Gl(C5)),Gl(n)),l=new Map,d=new Map,f=new Li(0),p=da(),h=new Li(0),m=new Li(0),v=new Li(0),g=a.gl,y=a.contextRestored,b=0,_=0,C=128,x=128,A=!1,T=0;_t();var w=Pb.create(a,o.draw.dpoitEnabled?LGe:o.draw.wboitEnabled?BGe:YD);function E(){return w.boundingSphere.radius*c.sceneRadiusFactor}var I=new Xa({position:S.create(0,0,100),mode:c.camera.mode,fog:"on"===c.cameraFog.name?c.cameraFog.params.intensity:0,clipFar:c.cameraClipping.far,minNear:c.cameraClipping.minNear,fov:Zr(c.camera.fov)},{x:b,y:_,width:C,height:x},{pixelScale:s.pixelScale}),M=new Mb(I,c.camera.stereo.params),F=p5.create(i,I,w,c.trackball),N=f5.create(a,c.renderer),j=new GJe(a,w,c),k=new J$e(a,N,w,j,o.pick,{x:b,y:_,width:C,height:x},s.pickPadding),H=new kQe(Ce,X,i,I,F,c.interaction),G=new Qie(o.multiSample);o.draw.postprocessing.background.update(I,c.postprocessing.background,function(Le){Le&&fe()});var U=!1,Q=void 0,W=void 0,K=!1,ne=!0;function X(Le){var st=Yr,St=dr.Empty;if(Le){var bt=j.camera.getLoci(Le);if(bt!==Yr)return{loci:bt,repr:St};st=j.handle.getLoci(Le),l.forEach(function(Mt,Rt){var oe=Rt.getLoci(Le);Ps(oe)||(Ps(st)||console.warn("found another loci, this should not happen"),st=oe,St=Rt)})}return{loci:st,repr:St}}var L=[];function Z(Le,st){var St=Le.repr,bt=Le.loci,Mt=!1;return St?Mt=St.mark(bt,st)||Mt:l.forEach(function(Rt,oe){Mt=oe.mark(bt,st)||Mt}),Mt=j.handle.mark(bt,st)||Mt,Mt=j.camera.mark(bt,st)||Mt}var z=!1,te=!1;function ae(Le){te||function q(Le){if(a.isContextLost)return!1;var st=!1;if(K&&(ut(!1),K=!1,st=!0),b>g.drawingBufferWidth||b+C<0||_>g.drawingBufferHeight||_+x<0)return!1;var St=function $(){for(var Le=!1,st=0,St=L;st<St.length;st++){var bt=St[st];Le=Z(bt[0],bt[1])||Le}return L=[],Le&&(w.update(void 0,!0),j.handle.scene.update(void 0,!0),j.camera.scene.update(void 0,!0)),Le}()&&(N.props.colorMarker||c.marking.enabled),bt=!1;F.update(T);var Mt=I.update(),Rt=Le||Mt||st||A;A=!1;var oe=G.update(St||Rt,c.multiSample);if(Rt||oe||St){var be=I;"on"===c.camera.stereo.name&&(M.update(),be=M),Ct&&a.timer.mark("Canvas3D.render",!0);var Se={renderer:N,camera:be,scene:w,helper:j};LE.isEnabled(c.multiSample)?G.render(Se,c,!0,c.multiSample.reduceFlicker&&!Mt&&St&&!F.isAnimating):o.draw.render(Se,c,!0),Ct&&a.timer.markEnd("Canvas3D.render"),k.dirty=k.dirty||Rt,bt=!0}return bt}(!!Le?.force)&&ne&&h.next(da()-p)}function fe(){A=!0}var he=0;function pe(Le,st){T=Le,ze(st?.isSynchronous),I.transition.tick(T),!st?.manualDraw&&(ae(),!I.transition.inTransition&&!a.isContextLost&&H.tick(T))}function re(){pe(da()),he=jJe(re)}function Ce(Le,st){return a.isContextLost?void 0:k.identify(Le,st,"on"===c.camera.stereo.name?M:I)}function ze(Le){void 0===Le&&(Le=!1);var st=function Ee(Le){return!w.needsCommit||(De.copy(V,w.boundingSphereVisible),w.commit(Le?void 0:we)?(v.next(0),j.debug.isEnabled&&j.debug.update(),!c.camera.manualReset&&(0===f.value||function ye(){if(0===I.state.radiusMax)return!0;if(I.transition.inTransition||W)return!1;var Le=!0,st=!0;De.set(J,I.state.target,I.state.radius);for(var St=0,bt=w.renderables;St<bt.length;St++){var Mt=bt[St];if(Mt.state.visible){var Rt=Mt.values.boundingSphere.ref.value;if(Rt.radius){st=!1;var oe=S.distance(J.center,Rt.center);if((oe>J.radius||oe>Rt.radius||Rt.radius>I.state.radiusMax)&&!De.includes(V,Rt))return!0;De.overlaps(J,Rt)&&(Le=!1)}}}return Le||!st&&J.radius<=.1}())&&(U=!0),0===V.radius&&(Q=0),c.camera.manualReset||I.setState({radiusMax:E()},0),f.next(l.size),xr&&Fe(),!0):(v.next(w.commitQueueSize),!1))}(Le);st&&(function je(){if(U){var Le=w.boundingSphereVisible,st=Le.center,St=Le.radius,bt=F.props.autoAdjustMinMaxDistance;if("on"===bt.name){var Mt=bt.params.minDistanceFactor*St+bt.params.minDistancePadding,Rt=Math.max(bt.params.maxDistanceFactor*St,bt.params.maxDistanceMin);F.setProps({minDistance:Mt,maxDistance:Rt})}if(St>0){var oe=void 0===Q?c.cameraResetDurationMs:Q,be=I.getFocus(st,St),Se="function"==typeof W?W(w,I):W,Qe=Se?R(R({},be),Se):be;I.setState(R(R({},Qe),{radiusMax:E()}),oe)}Q=void 0,W=void 0,U=!1}}(),z&&(j.debug.isEnabled&&j.debug.update(),ae({force:!0}),z=!1),m.next(da()))}var V=De(),J=De(),we=250;function Fe(){var Le=w.renderables.map(function(Rt){return{drawCount:Rt.values.drawCount.ref.value,instanceCount:Rt.values.instanceCount.ref.value,materialId:Rt.materialId,renderItemId:Rt.id}});console.groupCollapsed("".concat(Le.length," RenderItems")),Le.length<50?console.table(Le):console.log(Le),console.log(JSON.stringify(a.stats,void 0,4));var st=a.resources.getByteCounts(),bt=st.attribute,Mt=st.elements;console.log(JSON.stringify({texture:"".concat((st.texture/1024/1024).toFixed(3)," MiB"),attribute:"".concat((bt/1024/1024).toFixed(3)," MiB"),elements:"".concat((Mt/1024/1024).toFixed(3)," MiB")},void 0,4)),console.log(JSON.stringify(a.timer.formatedStats(),void 0,4)),console.groupEnd()}function He(){var Le=w.boundingSphere.radius>0?100-Math.round(I.transition.target.radius/E()*100):0;return{camera:{mode:I.state.mode,helper:R({},j.camera.props),stereo:R({},c.camera.stereo),fov:Math.round(Ju(I.state.fov)),manualReset:!!c.camera.manualReset},cameraFog:I.state.fog>0?{name:"on",params:{intensity:I.state.fog}}:{name:"off",params:{}},cameraClipping:{far:I.state.clipFar,radius:Le,minNear:I.state.minNear},cameraResetDurationMs:c.cameraResetDurationMs,sceneRadiusFactor:c.sceneRadiusFactor,transparentBackground:c.transparentBackground,dpoitIterations:c.dpoitIterations,viewport:c.viewport,postprocessing:R({},c.postprocessing),marking:R({},c.marking),multiSample:R({},c.multiSample),renderer:R({},N.props),trackball:R({},F.props),interaction:R({},H.props),debug:R({},j.debug.props),handle:R({},j.handle.props)}}var Je=y.subscribe(function(){k.dirty=!0,ae({force:!0}),ae({force:!0})}),vt=new Li(0);function ut(Le){void 0===Le&&(Le=!0),o.updateSize(),_t(),wt(),Le&&fe(),vt.next(+new Date)}return function uEe(e){C2.includes(e)||C2.push(e)}(Fe),{webgl:a,add:function ke(Le){!function $e(Le){d.has(Le)||d.set(Le,Le.updated.subscribe(function(st){Le.state.syncManually||ke(Le)}))}(Le);var st=l.get(Le),St=new Set;Le.renderObjects.forEach(function(bt){return St.add(bt)}),st?fa.areEqual(St,st)||(St.forEach(function(bt){st.has(bt)||w.add(bt)}),st.forEach(function(bt){St.has(bt)||w.remove(bt)})):Le.renderObjects.forEach(function(bt){return w.add(bt)}),l.set(Le,St),w.update(Le.renderObjects,!1),z=!0,xr&&Fe()},remove:function Ue(Le){!function Pe(Le){var st=d.get(Le);st&&(st.unsubscribe(),d.delete(Le))}(Le);var st=l.get(Le);st&&(st.forEach(function(St){return w.remove(St)}),l.delete(Le),z=!0,xr&&Fe())},commit:ze,update:function(Le,st){if(Le){if(!l.has(Le))return;w.update(Le.renderObjects,!!st)}else w.update(void 0,!!st);z=!0},clear:function(){d.forEach(function(Le){return Le.unsubscribe()}),d.clear(),l.clear(),w.clear(),j.debug.clear(),fe(),f.next(l.size)},syncVisibility:function(){0===I.state.radiusMax&&(U=!0,Q=0),w.syncVisibility()&&j.debug.isEnabled&&j.debug.update(),fe()},requestDraw:fe,tick:pe,animate:function ue(){te=!1,F.start(da()),0===he&&re()},resetTime:function ee(Le){p=Le,F.start(Le)},pause:function ge(Le){void 0===Le&&(Le=!1),te=Le,coe(he),he=0},resume:function(){te=!1},identify:Ce,mark:function Y(Le,st){L.push([Le,st])},getLoci:X,handleResize:ut,requestResize:function(){K=!0},requestCameraReset:function(Le){Q=Le?.durationMs,W=Le?.snapshot,U=!0},camera:I,boundingSphere:w.boundingSphere,boundingSphereVisible:w.boundingSphereVisible,get notifyDidDraw(){return ne},set notifyDidDraw(Le){ne=Le},didDraw:h,commited:m,commitQueueSize:v,reprCount:f,resized:vt,setProps:function(Le,st){var St,bt,Mt,Rt;void 0===st&&(st=!1);var oe="function"==typeof Le?OS(He(),Le):Le;void 0!==oe.sceneRadiusFactor&&(c.sceneRadiusFactor=oe.sceneRadiusFactor,I.setState({radiusMax:E()},0));var be=Object.create(null);oe.camera&&void 0!==oe.camera.mode&&oe.camera.mode!==I.state.mode&&(be.mode=oe.camera.mode);var Se=Math.round(Ju(I.state.fov));if(oe.camera&&void 0!==oe.camera.fov&&oe.camera.fov!==Se&&(be.fov=Zr(oe.camera.fov)),void 0!==oe.cameraFog&&oe.cameraFog.params){var Qe="on"===oe.cameraFog.name?oe.cameraFog.params.intensity:0;Qe!==I.state.fog&&(be.fog=Qe)}if(void 0!==oe.cameraClipping&&(void 0!==oe.cameraClipping.far&&oe.cameraClipping.far!==I.state.clipFar&&(be.clipFar=oe.cameraClipping.far),void 0!==oe.cameraClipping.minNear&&oe.cameraClipping.minNear!==I.state.minNear&&(be.minNear=oe.cameraClipping.minNear),void 0!==oe.cameraClipping.radius)){var Et=E()/100*(100-oe.cameraClipping.radius);Et>0&&Et!==be.radius&&(be.radius=Math.max(Et,.01))}Object.keys(be).length>0&&I.setState(be),!(null===(St=oe.camera)||void 0===St)&&St.helper&&j.camera.setProps(oe.camera.helper),void 0!==(null===(bt=oe.camera)||void 0===bt?void 0:bt.manualReset)&&(c.camera.manualReset=oe.camera.manualReset),void 0!==(null===(Mt=oe.camera)||void 0===Mt?void 0:Mt.stereo)&&(Object.assign(c.camera.stereo,oe.camera.stereo),M.setProps(c.camera.stereo.params)),void 0!==oe.cameraResetDurationMs&&(c.cameraResetDurationMs=oe.cameraResetDurationMs),void 0!==oe.transparentBackground&&(c.transparentBackground=oe.transparentBackground),void 0!==oe.dpoitIterations&&(c.dpoitIterations=oe.dpoitIterations),void 0!==oe.viewport&&(c.viewport===oe.viewport||c.viewport.name===oe.viewport.name&&p2(c.viewport.params,oe.viewport.params)||(c.viewport=oe.viewport,_t(),wt())),!(null===(Rt=oe.postprocessing)||void 0===Rt)&&Rt.background&&(Object.assign(c.postprocessing.background,oe.postprocessing.background),o.draw.postprocessing.background.update(I,c.postprocessing.background,function(Zt){Zt&&!st&&fe()})),oe.postprocessing&&Object.assign(c.postprocessing,oe.postprocessing),oe.marking&&Object.assign(c.marking,oe.marking),oe.multiSample&&Object.assign(c.multiSample,oe.multiSample),oe.renderer&&N.setProps(oe.renderer),oe.trackball&&F.setProps(oe.trackball),oe.interaction&&H.setProps(oe.interaction),oe.debug&&j.debug.setProps(oe.debug),oe.handle&&j.handle.setProps(oe.handle),"orthographic"===be.mode&&(c.camera.stereo.name="off"),st||fe()},getImagePass:function(Le){return void 0===Le&&(Le={}),new OJe(a,u,N,w,I,j,o.draw.wboitEnabled,o.draw.dpoitEnabled,Le)},getRenderObjects:function(){var Le=[];return w.forEach(function(st,St){return Le.push(St)}),Le},get props(){return He()},get input(){return i},get stats(){return N.stats},get interaction(){return H.events},dispose:function(){Je.unsubscribe(),coe(he),L=[],w.clear(),j.debug.clear(),F.dispose(),N.dispose(),H.dispose(),function cEe(e){var t=C2.indexOf(e);-1!==t&&C2.splice(t,1)}(Fe)}};function _t(){var Le=b,st=_,St=C,bt=x;"canvas"===c.viewport.name?(b=0,_=0,C=g.drawingBufferWidth,x=g.drawingBufferHeight):"static-frame"===c.viewport.name?(b=c.viewport.params.x*a.pixelRatio,_=g.drawingBufferHeight-(x=c.viewport.params.height*a.pixelRatio)-c.viewport.params.y*a.pixelRatio,C=c.viewport.params.width*a.pixelRatio):"relative-frame"===c.viewport.name&&(b=Math.round(c.viewport.params.x*g.drawingBufferWidth),x=Math.round(c.viewport.params.height*g.drawingBufferHeight),_=Math.round(g.drawingBufferHeight-x-c.viewport.params.y*g.drawingBufferHeight),C=Math.round(c.viewport.params.width*g.drawingBufferWidth)),(Le!==b||st!==_||St!==C||bt!==x)&&(A=!0)}function wt(){k.setViewport(b,_,C,x),N.setViewport(b,_,C,x),fo.set(I.viewport,b,_,C,x),fo.set(F.viewport,b,_,C,x)}}}(w5||(w5={}));var xg=Ya,Am=bc,wg=Dt.Trigger,WJe={hoverHighlightOnly:Dt([wg(xg.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:Dt([wg(xg.Flag.None,Am.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},YJe={bindings:D.Value(WJe,{isHidden:!0}),ignore:D.Value([],{isHidden:!0}),preferAtoms:D.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:D.Boolean(!0)},XJe=nn.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a)},r}return qt(t,e),t.prototype.getLoci=function(r){return this.params.preferAtoms&&Ht.isLoci(r)&&2===r.bonds.length?Ht.toFirstStructureElementLoci(r):r},t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a=n.current,i=n.buttons,o=n.modifiers;if(r.ctx.canvas3d&&!r.ctx.isBusy){var s=r.getLoci(a.loci);if(r.params.ignore.includes(s.kind))return void r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Yr});var u=!1;Dt.match(r.params.bindings.hoverHighlightOnly,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:s}),u=!0),Dt.match(r.params.bindings.hoverHighlightOnlyExtend,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:s}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Yr})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(nn.Handler),params:function(){return YJe},display:{name:"Highlight Loci on Canvas"}}),doe={clickSelect:Dt.Empty,clickToggleExtend:Dt([wg(xg.Flag.Primary,Am.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickSelectOnly:Dt.Empty,clickToggle:Dt([wg(xg.Flag.Primary,Am.create())],"Toggle selection","Click on element using ${triggers}"),clickDeselect:Dt.Empty,clickDeselectAllOnEmpty:Dt([wg(xg.Flag.Primary,Am.create())],"Deselect all","Click on nothing using ${triggers}")},KJe={bindings:D.Value(doe,{isHidden:!0}),ignore:D.Value([],{isHidden:!0}),preferAtoms:D.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:D.Boolean(!0)},ZJe=nn.create({name:"representation-select-loci",category:"interaction",ctor:function(e){function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o)},a.spine=new mD.Impl(r.state.data.cells),a}return qt(t,e),t.prototype.getLoci=function(r){return this.params.preferAtoms&&Ht.isLoci(r)&&2===r.bonds.length?Ht.toFirstStructureElementLoci(r):r},t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&ve.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(ve.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:Ye.Loci(i.data)},Vt.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},Vt.Select)}}},t.prototype.register=function(){var r=this,a=function(o){return!pr.isEmpty(o)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},function(o){return pr.isEmpty(o)}]];i.sort(function(o,s){var u=r.params.bindings[o[0]],c=r.params.bindings[s[0]],l=0===u.triggers.length?0:kd(u.triggers.map(function(f){return Am.size(f.modifiers)}));return(0===c.triggers.length?0:kd(c.triggers.map(function(f){return Am.size(f.modifiers)})))-l}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s=o.current,u=o.button,c=o.modifiers;if(r.ctx.canvas3d&&!r.ctx.isBusy&&r.ctx.selectionMode){var l=r.getLoci(s.loci);if(!r.params.ignore.includes(l.kind))for(var d=0,f=i;d<f.length;d++){var p=f[d],m=p[1],v=p[2];if(Dt.match(r.params.bindings[p[0]],u,c)&&(!v||v(l))){m({repr:s.repr,loci:l});break}}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){return r.applySelectMark(o.ref)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,c=o.oldObj,l=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ve.Molecule.Structure.is(f.obj)){var p=u.data,h="recreate"===d?c?.data:"in-place"===d?l:void 0;if(h&&Ye.areEquivalent(p,h)&&Ye.areHierarchiesEqual(p,h))return;for(var v=0,g=r.ctx.state.data.select(wr.children(s).ofType(ve.Molecule.Structure.Representation3D));v<g.length;v++)r.applySelectMark(g[v].transform.ref,!0)}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(nn.Handler),params:function(){return KJe},display:{name:"Select Loci on Canvas"}}),QJe=nn.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Re.is(r)){for(var a=new Set,i=0,o=r.elements;i<o.length;i++){var s=o[i].unit,u=at.create(r.structure,s,s.elements[0]),c=it.entity.pdbx_description(u).join(", ");a.add(c)}1===a.size&&a.forEach(function(l){return n.push(l)})}return n.push(CE(r)),n.filter(function(l){return!!l}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),foe={clickFocus:Dt([wg(xg.Flag.Primary,Am.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:Dt([wg(xg.Flag.Primary,Am.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:Dt([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:Dt([],"Representation Focus Add","Click element using ${triggers}")},$Je={bindings:D.Value(foe,{isHidden:!0})},JJe=nn.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocusAdd,f=u.clickFocusAddSelectMode,p=r.ctx.managers.interactivity.props.granularity;if("residue"===p||"element"===p){var m=Dt.match(r.ctx.selectionMode?u.clickFocusSelectMode:u.clickFocus,o,s),g=Dt.match(r.ctx.selectionMode?f:l,o,s);if(m||g){var y=pr.normalize(i.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&pr.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(m)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var _=null===(a=r.ctx.managers.structure.focus.current)||void 0===a?void 0:a.loci;_&&r.ctx.managers.camera.focusLoci(_)}}}})},t}(nn.Handler),params:function(){return $Je},display:{name:"Representation Focus Loci on Canvas"}}),mf=Ya,rd=bc,vf=Dt.Trigger,VE=Dt.TriggerKey,A5=Dt([vf(mf.Flag.Primary,rd.create()),vf(mf.Flag.Secondary,rd.create()),vf(mf.Flag.Primary,rd.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),T5=Dt([vf(mf.Flag.Secondary,rd.create()),vf(mf.Flag.Primary,rd.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),poe={clickCenterFocus:Dt([vf(mf.Flag.Primary,rd.create()),vf(mf.Flag.Secondary,rd.create()),vf(mf.Flag.Primary,rd.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:Dt([vf(mf.Flag.Secondary,rd.create()),vf(mf.Flag.Primary,rd.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickResetCameraOnEmpty:A5,clickResetCameraOnEmptySelectMode:T5},eet={minRadius:D.Numeric(8,{min:1,max:50,step:1}),extraRadius:D.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:D.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:D.Value(poe,{isHidden:!0})},tet=nn.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i,o=n.current,s=n.button,u=n.modifiers;if(r.ctx.canvas3d){var c=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus,l=r.ctx.selectionMode?null!==(a=r.params.bindings.clickResetCameraOnEmptySelectMode)&&void 0!==a?a:T5:null!==(i=r.params.bindings.clickResetCameraOnEmpty)&&void 0!==i?i:A5;if(pr.isEmpty(o.loci)&&Dt.match(l,s,u))return void Sr.Camera.Reset(r.ctx,{});if(Dt.match(c,s,u)){var d=pr.normalize(o.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(d,r.params)}}})},t}(nn.Handler),params:function(){return eet},display:{name:"Camera Focus Loci on Canvas"}}),ret=nn.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t.prototype.register=function(){var r=this,n=Sn.None,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(r.ctx.canvas3d&&S5(o.loci)){var s=o.loci.elements[0].groupId;if(s===Sn.None)return n=Sn.None,void(a=0);var c,l,u=r.ctx.canvas3d.camera;if(s>=Sn.X&&s<=Sn.Z){n=Sn.None,a=0;var d=S.sub(S(),u.target,u.position),f=S.cross(S(),d,u.up);(l=S())[s-1]=1,c=S.cross(S(),l,f),0===S.magnitude(c)&&(c=d)}else n===s?a=(a+1)%2:(n=s,a=0),s===Sn.XY?(l=a?S.unitX:S.unitY,c=S.negUnitZ):s===Sn.XZ?(l=a?S.unitX:S.unitZ,c=S.negUnitY):(l=a?S.unitY:S.unitZ,c=S.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(p,h){return h.getInvariantFocus(p.boundingSphereVisible.center,p.boundingSphereVisible.radius,l,c)}})}})},t}(nn.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}}),hoe={keySpinAnimation:Dt([VE("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:Dt([VE("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:Dt([VE("Space",rd.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:Dt([VE("T")],"Reset View","Press ${triggers}")},net={bindings:D.Value(hoe,{isHidden:!0})},aet=nn.create({name:"camera-controls",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.key,function(n){var a,i=n.code,o=n.key,s=n.modifiers;if(r.ctx.canvas3d){var u=R(R({},hoe),r.params.bindings),c=r.ctx.canvas3d.props.trackball;if(Dt.matchKey(u.keySpinAnimation,i,s,o)){var l="spin"!==c.animate.name?"spin":"off";r.ctx.canvas3d.setProps("off"===l?{trackball:{animate:{name:l,params:{}}}}:{trackball:{animate:{name:l,params:{speed:1}}}})}if(Dt.matchKey(u.keyRockAnimation,i,s,o)){var d="rock"!==c.animate.name?"rock":"off";r.ctx.canvas3d.setProps("off"===d?{trackball:{animate:{name:d,params:{}}}}:{trackball:{animate:{name:d,params:{speed:.3,angle:10}}}})}if(Dt.matchKey(u.keyToggleFlyMode,i,s,o)){var f=!c.flyMode;r.ctx.canvas3d.setProps({trackball:{flyMode:f}}),null!==(a=r.ctx.canvas3dContext)&&void 0!==a&&a.canvas&&(r.ctx.canvas3dContext.canvas.style.cursor=f?"crosshair":"unset")}Dt.matchKey(u.keyResetView,i,s,o)&&Sr.Camera.Reset(r.ctx,{})}})},t}(nn.Handler),params:function(){return net},display:{name:"Camera Controls on Canvas"}}),iet=nn.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,o=0,s=this.ctx.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Model));o<s.length;o++){var u=s[o],c=(null===(r=u.obj)||void 0===r?void 0:r.data)&&ir.Index.get(null===(n=u.obj)||void 0===n?void 0:n.data).value;void 0!==c&&c>a&&(a=c)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,o=0,s=this.ctx.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Structure));o<s.length;o++){var u=s[o],c=(null===(r=u.obj)||void 0===r?void 0:r.data)&&Ye.Index.get(null===(n=u.obj)||void 0===n?void 0:n.data).value;void 0!==c&&c>a&&(a=c)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,o=0,s=this.ctx.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Model));o<s.length;o++){var c=null===(r=s[o].obj)||void 0===r?void 0:r.data;if(c){var l=ir.AsymIdCount.get(c),d=ir.AsymIdOffset.get(c).value;void 0!==l&&void 0!==d&&(n=Math.max(n,d.auth+l.auth),a=Math.max(a,d.label+l.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.setModelMaxIndex=function(){for(var r,n=this.maxModelIndex,i=0,o=this.ctx.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Model));i<o.length;i++){var u=null===(r=o[i].obj)||void 0===r?void 0:r.data;u&&ir.MaxIndex.get(u).value!==n&&ir.MaxIndex.set(u,{value:n},n)}},t.prototype.setStructureMaxIndex=function(){for(var r,n=this.maxModelIndex,i=0,o=this.ctx.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Structure));i<o.length;i++){var u=null===(r=o[i].obj)||void 0===r?void 0:r.data;u&&Ye.MaxIndex.get(u).value!==n&&Ye.MaxIndex.set(u,{value:n},n)}},t.prototype.handleModel=function(r,n){if(void 0===ir.Index.get(r).value){var a=n&&ir.Index.get(n).value;ir.Index.set(r,{value:i=a??this.maxModelIndex+1},i)}if(void 0===ir.AsymIdOffset.get(r).value){var i=(n&&ir.AsymIdOffset.get(n).value)??R({},this.asymIdOffset);ir.AsymIdOffset.set(r,{value:i},i)}},t.prototype.handleStructure=function(r,n){if(void 0===r.parent&&void 0===Ye.Index.get(r).value){var i=(n&&Ye.Index.get(n).value)??this.maxStructureIndex+1;Ye.Index.set(r,{value:i},i)}},t.prototype.handle=function(r,n,a){ve.Molecule.Structure.is(n)?!this.ctx.state.data.tree.transforms.get(r).transformer.definition.isDecorator&&void 0===n.data.parent&&this.handleStructure(n.data,a?.data):ve.Molecule.Model.is(n)&&(this.ctx.state.data.tree.transforms.get(r).transformer.definition.isDecorator||this.handleModel(n.data,a?.data))},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(ir.AsymIdOffset,!0),this.ctx.customModelProperties.register(ir.Index,!0),this.ctx.customModelProperties.register(ir.MaxIndex,!0),this.ctx.customStructureProperties.register(Ye.Index,!0),this.ctx.customStructureProperties.register(Ye.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj),r.setModelMaxIndex(),r.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(ir.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(ir.Index.descriptor.name),this.ctx.customModelProperties.unregister(ir.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(Ye.Index.descriptor.name),this.ctx.customStructureProperties.unregister(Ye.MaxIndex.descriptor.name)},t}(nn.Handler)}),Tm=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],moe={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165};function uet(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return"NZ"===e?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return"CD"===e?1:2}}}return D5(t)}function cet(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return D5(t)}function D5(e){var t=G2(e),r=Tm.indexOf(t);return-1===r&&(Tm[r=Tm.length]=t),r}function det(e,t){return ce(this,void 0,void 0,function(){var r,n;return le(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:(function fet(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,c=e.maxLookupRadius,l=e.probeSize,d=n.lookup3d,f=n.serialMapping,p=n.unitIndexMap,h=n.units,m=f.cumulativeUnitElementCount,v=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=Tm[a[y]];if(b!==Tm[0]){for(var _=h[g[y]],C=v[y],x=_.conformation.x(C),A=_.conformation.y(C),T=_.conformation.z(C),w=d.find(x,A,T,c),E=w.count,I=w.units,M=w.indices,F=w.squaredDistances,N=l+b,j=l+N,k=[],H=0;H<E;++H){var G=I[H],U=m[p.get(G.id)]+M[H],W=Tm[a[U]];if((_!==G||C!==v[U])&&W!==Tm[0]){var K=l+W;if(F[H]<(j+W)*(j+W)){var ne=v[U];k[k.length]=[F[H],(F[H]+N*N-K*K)/(2*N),G.conformation.x(ne)-x,G.conformation.y(ne)-A,G.conformation.z(ne)-T]}}}k.sort(function(ee,ue){return ee[0]-ue[0]});var X=0;e:for(var L=0;L<s.length;++L){for(var Y=s[L],$=Y[0],Z=Y[1],q=Y[2],z=0;z<k.length;++z){var te=k[z];if($*te[2]+Z*te[3]+q*te[4]>te[1])continue e}++X}o[i[y]]+=u*X*N*N}}})(t,n,Math.min(n+5e3,r.length)),a.label=4;case 4:return n+=5e3,[3,1];case 5:return[2]}})})}var Rb,goe={numberOfSpherePoints:D.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:D.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:D.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:D.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};!function(e){function r(c,l,d){return ce(this,void 0,void 0,function(){var f;return le(this,function(m){switch(m.label){case 0:return f=function n(c,l){var d=c.elementCount,f=c.atomicResidueCount,v=l.numberOfSpherePoints;return{structure:c,probeSize:l.probeSize,nonPolymer:l.nonPolymer,traceOnly:l.traceOnly,spherePoints:a(v),scalingConstant:4*Math.PI/v,maxLookupRadius:2*l.probeSize+2*Tm[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}(l,d),function set(e){var t=it.residue.key,r=it.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,c=at.create(o),l=0,d=0,f=-1;c.structure=o;for(var p=0,h=0,m=o.units.length;p<m;++p){var v=o.units[p],g=v.elements;c.unit=v,l=-1;for(var y=0,b=g.length;y<b;++y){var _=g[y],C=h+y;c.element=_,l!==(d=t(c))&&++f,l=d;var x=n(c);if(op(Ud(x)))s[C]=0,u[C]=-1;else{var T=a(c),w=GN(v,_);if(2!==w&&(e.nonPolymer||pT(w))){var E=i(c);!e.traceOnly||("CA"===T||"BB"===T)&&moe[E]?(s[C]=Zs(w)?cet(0,x):5===w?uet(T,x,E):D5(x),u[C]=f):(s[C]=0,u[C]=f)}else s[C]=0,u[C]=-1}}h+=g.length}}(f),[4,det(c,f)];case 1:return m.sent(),[2,{area:f.area,serialResidueIndex:f.serialResidueIndex}]}})})}function a(c){for(var l=[],d=Math.PI*(3-Math.sqrt(5)),f=2/c,p=0;p<c;++p){var h=p*f-1+f/2,m=Math.sqrt(1-h*h),v=p*d;l[l.length]=S.create(Math.cos(v)*m,h,Math.sin(v)*m)}return l}function i(c,l){return l/(moe[c]||121)}function o(c,l){var d=l.area,p=l.serialResidueIndex[Xe.indexOf(Xe.ofSortedArray(c.structure.root.serialMapping.elementIndices),c.element)];return-1===p?-1:d[p]}function s(c,l){var d=o(c,l);return-1===d?-1:i(it.atom.label_comp_id(c),d)}e.compute=function t(c,l){var d=this;void 0===l&&(l={});var f=R(R({},D.getDefaultValues(goe)),l);return Ve.create("Compute Accessible Surface Area",function(p){return ce(d,void 0,void 0,function(){return le(this,function(h){switch(h.label){case 0:return[4,r(p,c,f)];case 1:return[2,h.sent()]}})})})},e.Flag={NA:0,Buried:1,Accessible:2},e.normalize=i,e.getValue=o,e.getNormalizedValue=s,e.getFlag=function u(c,l){var d=s(c,l);return-1===d?0:d<.16?1:2}}(Rb||(Rb={}));var E5=R({},goe),I5={isBuried:gb.Dynamic(XX("computed","accessible-surface-area.is-buried",Ae.Bool),function(e){if(!Oe.isAtomic(e.element.unit))return!1;var t=pl.get(e.element.structure).value;return!!t&&1===Rb.getFlag(e.element,t)}),isAccessible:gb.Dynamic(XX("computed","accessible-surface-area.is-accessible",Ae.Bool),function(e){if(!Oe.isAtomic(e.element.unit))return!1;var t=pl.get(e.element.structure).value;return!!t&&2===Rb.getFlag(e.element,t)})},pl=pp.createProvider({label:"Accessible Surface Area",descriptor:ec({name:"molstar_accessible_surface_area",symbols:I5}),type:"root",defaultParams:E5,getParams:function(e){return E5},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=R(R({},D.getDefaultValues(E5)),r),a={},[4,Rb.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),P5=dt(16448250),yoe={list:D.ColorList("rainbow",{presetKind:"scale"})},_oe={name:"accessible-surface-area",label:"Accessible Surface Area",category:Nu.Category.Residue,factory:function boe(e,t){var r,n=Bc.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&pl.get(e.structure),i=a?Dv(a.id,a.version):-1;if(a?.value&&e.structure){var o=at.create(e.structure),s=a.value,u=function(c){var l=Rb.getNormalizedValue(c,s);return-1===l?P5:n.color(l)};r=function(c){return at.is(c)&&Oe.isAtomic(c.unit)?u(c):Ht.isLocation(c)?(o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex],u(o)):P5}}else r=function(){return P5};return{factory:boe,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:"Assigns a color based on the relative accessible surface area of a residue.",legend:n?n.legend:void 0}},getParams:function het(e){return yoe},defaultValues:D.getDefaultValues(yoe),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?pl.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&pl.ref(e.structure,!1)}}},met=nn.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=pl,r.labelProvider={label:function(n){if(r.params.showTooltip)return function vet(e){if("element-loci"===e.kind){if(0===e.elements.length)return;if(!(t=pl.get(e.structure).value)||e.structure.customPropertyDescriptors.hasReference(pl.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(h,m){var v=m.elements;Be.forEach(h,function(g){var y=a[r(m,v[g])];-1!==y&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,c=e.elements;u<c.length;u++){var l=c[u];s(l.indices,l.unit)}if(0===i.size)return;var p="<small>(".concat(i.size," ").concat(i.size>1?"Residues sum":"Residue",")</small>");return"Accessible Surface Area ".concat(p,": ").concat(o.toFixed(2)," \u212b<sup>2</sup>")}var t;if("structure-loci"===e.kind)return!(t=pl.get(e.structure).value)||e.structure.customPropertyDescriptors.hasReference(pl.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: ".concat(aX(t.area).toFixed(2)," \u212b<sup>2</sup>")}(n)}},r}return qt(t,e),t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){rE.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(_oe),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(Soe),this.ctx.query.structure.registry.add(Coe)},t.prototype.unregister=function(){rE.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(_oe),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(Soe),this.ctx.query.structure.registry.remove(Coe)},t}(nn.Handler),params:function(){return{autoAttach:D.Boolean(!1),showTooltip:D.Boolean(!0)}}}),Soe=dn("Buried Protein Residues",de.struct.modifier.union([de.struct.modifier.wholeResidues([de.struct.modifier.union([de.struct.generator.atomGroups({"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":I5.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:hn.Residue,ensureCustomProperties:function(e,t){return pl.attach(e,t)}}),Coe=dn("Accessible Protein Residues",de.struct.modifier.union([de.struct.modifier.wholeResidues([de.struct.modifier.union([de.struct.generator.atomGroups({"chain-test":de.core.rel.eq([de.ammp("objectPrimitive"),"atomistic"]),"residue-test":I5.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:hn.Residue,ensureCustomProperties:function(e,t){return pl.attach(e,t)}});function un(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function xoe(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function _C(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function zE(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function M5(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function gf(e,t,r){return function get(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i)Gr.isCovalent(e.interUnitBonds.edges[a[i]].props.flag)&&(n+=1);return n}(e,t,r)+function yet(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)Gr.isCovalent(i[o])&&(r+=1);return r}(t,r)}function du(e,t,r,n){var a=0;return fu(e,t,r,function(i,o){un(i,o)===n&&(a+=1)}),a}function R5(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)Gr.isCovalent(o[s])&&r(e,i[s])}function fu(e,t,r,n){(function xet(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);Gr.isCovalent(s.props.flag)&&n(u,s.indexB)}})(e,t,r,n),R5(t,r,n)}var xa=function(e){return e[e.Spherical=0]="Spherical",e[e.Terminal=1]="Terminal",e[e.Linear=2]="Linear",e[e.Trigonal=3]="Trigonal",e[e.Tetrahedral=4]="Tetrahedral",e[e.TrigonalBiPyramidal=5]="TrigonalBiPyramidal",e[e.Octahedral=6]="Octahedral",e[e.SquarePlanar=7]="SquarePlanar",e[e.Unknown=8]="Unknown",e}(xa||{});function wet(e){switch(e){case xa.Spherical:return"Spherical";case xa.Terminal:return"Terminal";case xa.Linear:return"Linear";case xa.Trigonal:return"Trigonal";case xa.Tetrahedral:return"Tetrahedral";case xa.TrigonalBiPyramidal:return"Trigonal Bi-Pyramidal";case xa.Octahedral:return"Octahedral";case xa.SquarePlanar:return"Square Planar";case xa.Unknown:return"Unknown"}}function Ob(e){switch(e){case 0:return xa.Spherical;case 1:return xa.Terminal;case 2:return xa.Linear;case 3:return xa.Trigonal;case 4:return xa.Tetrahedral;default:return xa.Unknown}}var woe=new Map([[xa.Linear,Zr(180)],[xa.Trigonal,Zr(120)],[xa.Tetrahedral,Zr(109.4721)],[xa.Octahedral,Zr(90)]]),GE=S(),HE=S(),Ag=S(),jE=S(),Fb=S();function qE(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],Ag),n.conformation.position(n.elements[a],jE),S.sub(GE,jE,Ag),fu(e,t,r,function(o,s){"H"!==un(o,s)&&(o.conformation.position(o.elements[s],Fb),S.sub(HE,Fb,Ag),i.push(S.angle(GE,HE)))}),i}function Aoe(e,t,r,n,a){t.conformation.position(t.elements[r],Ag),n.conformation.position(n.elements[a],jE),S.sub(GE,jE,Ag);var s,u,i=[S(),S()],o=0;if(fu(e,t,r,function(c,l){o>1||"H"!==un(c,l)&&(s=c,u=l,c.conformation.position(c.elements[l],Fb),S.sub(i[o++],Fb,Ag))}),1===o&&s&&u&&fu(e,s,u,function(c,l){o>1||c===t&&l===r||"H"!==un(c,l)&&(c.conformation.position(c.elements[l],Fb),S.sub(i[o++],Fb,Ag))}),2===o)return S.cross(HE,i[0],i[1]),Math.abs(Math.PI/2-S.angle(HE,GE))}var O5=new Ht.ElementBondIterator,F5=new Ht.ElementBondIterator,Nb=new Ht.ElementBondIterator,N5=new Ht.ElementBondIterator;function Det(e,t,r,n){var a=du(e,t,r,"H"),i=un(t,r),o=xoe(t,r),s="always"===n.assignCharge||"auto"===n.assignCharge&&0===o,u="always"===n.assignH||"auto"===n.assignH&&0===a,c=gf(e,t,r),l=function Tet(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,c=i[r],l=i[r+1];c<l;++c)Gr.isCovalent(s[c])&&(n+=u[c]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];Gr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}(e,t,r),d=function Aet(e,t,r){var n=un(t,r),a="O"===n||"N"===n;if(a&&4===gf(e,t,r))return!1;for(O5.setElement(e,t,r);O5.hasNext;){var i=O5.move();if(i.order>1)return!0;if(a){var o=un(i.otherUnit,i.otherIndex);for(F5.setElement(e,i.otherUnit,i.otherIndex);F5.hasNext;){var s=F5.move();if(s.order>1){if(("P"===o||"S"===o)&&"O"===un(s.otherUnit,s.otherIndex))continue;return!0}}}}return!1}(e,t,r),f=l-c>0,p=0,h=xa.Unknown;switch(i){case"H":s&&(0===c?(o=1,h=xa.Spherical):1===c&&(o=0,h=xa.Terminal));break;case"C":s&&(o=0),u&&(p=Math.max(0,4-l-Math.abs(o))),h=Ob(c+p+Math.max(0,-o));break;case"N":if(s)if(u)if(d&&l<4)o=c-a==1&&l-a==2?1:0;else for(Nb.setElement(e,t,r);Nb.hasNext;){var m=Nb.move(),v=un(m.otherUnit,m.otherIndex);if("S"===v||h7e(v)){o=0;break}o=1}else o=l-3;u&&(p=Math.max(0,3-l+o)),h=Ob(d&&!f?c+p-o:c+p+1-o);break;case"O":if(s&&(u||(o=l-2),1===l)){Nb.setElement(e,t,r);e:for(;Nb.hasNext;){var g=Nb.move();for(N5.setElement(e,g.otherUnit,g.otherIndex);N5.hasNext;){var y=N5.move();if((y.otherUnit!==t||y.otherIndex!==r)&&"O"===un(y.otherUnit,y.otherIndex)&&2===y.order){o=-1;break e}}}}u&&(p=Math.max(0,2-l+o)),h=Ob(d&&!f?c+p-o+1:c+p-o+2);break;case"S":s&&(u||(o=l<=3&&0===du(e,t,r,"O")?l-2:0)),u&&l<2&&(p=Math.max(0,2-l+o)),l<=3&&(h=Ob(c+p-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=l-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-l);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-l);break;default:xr&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,p,p+a,h]}function Eet(e,t,r){var c,n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent;if(u){var l=e.root.unitMap.get(t.id);if((c=Xe.indicesOf(l.elements,t.elements)).length!==t.elements.length)throw new Error("expected to find an index for every element");t=l,e=e.root}for(var d=0;d<n;++d){var p=Det(e,t,u?c[d]:d,r),m=p[1],v=p[2],g=p[3];a[d]=p[0],i[d]=m,o[d]=v,s[d]=g}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var Toe={assignCharge:D.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:D.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function Iet(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(c){for(n=R(R({},D.getDefaultValues(Toe)),r),a=new Map,i=0,o=t.units.length;i<o;++i)Oe.isAtomic(s=t.units[i])&&(u=Eet(t,s,n),a.set(s.id,u));return[2,a]})})}var wa,B5,L5,k5=R({},Toe),SC=pp.createProvider({label:"Valence Model",descriptor:ec({name:"molstar_computed_valence_model"}),type:"local",defaultParams:k5,getParams:function(e){return k5},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=R(R({},D.getDefaultValues(k5)),r),a={},[4,Iet(0,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}});!function(e){function r(d,f){for(var p=new Int32Array(f+1),h=new Int32Array(f),m=new Int32Array(f),v=d.members,g=d.count,y=d.offsets,b=0,_=y[g];b<_;++b)++m[v[b]];var C=0;for(b=0;b<f;b++)p[b]=C,C+=m[b];p[f]=C;var x=new Int32Array(C);for(b=0;b<g;++b)for(var A=y[b],T=y[b+1];A<T;++A){var w=v[A];x[p[w]+h[w]]=b,++h[w]}return{indices:x,offsets:p}}function a(d,f){for(var p,h=d.count,m=d.types,v=[],g=0;g<h;++g)f.has(m[g])&&v.push(g);var y=Xe.ofSortedArray(v);return{indices:y,get lookup3d(){if(!p){var b={x:d.x,y:d.y,z:d.z,indices:y};p=tp(b,up(b))}return p}}}e.setPosition=function t(d,f,p,h){return S.set(d,h.x[p],h.y[p],h.z[p]),S.transformMat4(d,d,f.conformation.operator.matrix),d},e.createElementsIndex=r,e.create=function n(d,f){var p,h;return R(R({},f),{get lookup3d(){if(!p){var m={x:f.x,y:f.y,z:f.z,indices:Be.ofBounds(0,f.count)};p=tp(m,up(m))}return p},get elementsIndex(){return h||(h=r(f,d))},subset:function(m){return a(f,m)}})},e.createSubset=a,e.Info=function i(d,f,p){var h=SC.get(d).value;if(!h||!h.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:h.get(f.id).idealGeometry}},e.position=function o(d,f){return S.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),S.transformMat4(d,d,f.unit.conformation.operator.matrix),d};var s=S(),u=S();e.distance=function c(d,f){var h=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[d.members[d.offsets[d.feature]]],s),f.unit.conformation.position(f.unit.elements[h],u),S.distance(s,u)},e.Provider=function l(d,f){return{types:new Set(d),add:f}}}(wa||(wa={})),function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,1,n,a?a.x:r),o=qe.create(Float32Array,1,n,a?a.y:r),s=qe.create(Float32Array,1,n,a?a.z:r),u=qe.create(Uint8Array,1,n,a?a.types:r),c=qe.create(Uint8Array,1,n,a?a.groups:r),l=qe.create(Uint32Array,1,n,a?a.offsets:r),d=qe.create(Uint32Array,1,n,a?a.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(p,h,m,v){qe.add(d,v),f.x+=p,f.y+=h,f.z+=m,f.count+=1},finishState:function(p,h){var m=f.count;0!==m&&(qe.add(u,p),qe.add(c,h),qe.add(i,f.x/m),qe.add(o,f.y/m),qe.add(s,f.z/m),qe.add(l,f.offset))},add:function(p,h,m,v,g,y){qe.add(u,p),qe.add(c,h),qe.add(i,m),qe.add(o,v),qe.add(s,g),qe.add(l,d.elementCount),qe.add(d,y)},getFeatures:function(p){qe.add(l,d.elementCount);var h=qe.compact(i,!0),m=qe.compact(o,!0),v=qe.compact(s,!0);return wa.create(p,{x:h,y:m,z:v,count:i.elementCount,types:qe.compact(u,!0),groups:qe.compact(c,!0),offsets:qe.compact(l,!0),members:qe.compact(d,!0)})}}}}(B5||(B5={})),function(e){e.createElementsIndex=function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,c=n.offsets,l=0,d=2*r.edgeCount;l<d;++l)if(!((f=r.a[l])>(p=r.b[l]))){for(var h=c[f],m=c[f+1];h<m;++h)++s[u[h]];for(h=c[p],m=c[p+1];h<m;++h)++s[u[h]]}var v=0;for(l=0;l<a;l++)i[l]=v,v+=s[l];i[a]=v;var g=new Int32Array(v);for(l=0,d=2*r.edgeCount;l<d;++l){var f,p;if(!((f=r.a[l])>(p=r.b[l]))){for(h=c[f],m=c[f+1];h<m;++h)g[i[y=u[h]]+o[y]]=l,++o[y];for(h=c[p],m=c[p+1];h<m;++h){var y;g[i[y=u[h]]+o[y]]=l,++o[y]}}}return{indices:g,offsets:i}}}(L5||(L5={}));var Pet=function(e){function t(r,n){var a=e.call(this,r)||this;a.elementKeyIndex=new Map;for(var i=0,o=a.edges.length;i<o;++i)for(var s=a.edges[i],u=s.unitA,c=s.indexA,l=n.get(u),d=l.offsets,f=l.members,p=d[c],h=d[c+1];p<h;++p){var m=a.getElementKey(f[p],u),v=a.elementKeyIndex.get(m);void 0===v?a.elementKeyIndex.set(m,[i]):v.push(i)}return a}return qt(t,e),t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return"".concat(r,"|").concat(n)},t}(Nv),yf=function(e){return e[e.None=0]="None",e[e.Filtered=1]="Filtered",e}(yf||{}),Or=function(e){return e[e.Unknown=0]="Unknown",e[e.Ionic=1]="Ionic",e[e.CationPi=2]="CationPi",e[e.PiStacking=3]="PiStacking",e[e.HydrogenBond=4]="HydrogenBond",e[e.HalogenBond=5]="HalogenBond",e[e.Hydrophobic=6]="Hydrophobic",e[e.MetalCoordination=7]="MetalCoordination",e[e.WeakHydrogenBond=8]="WeakHydrogenBond",e}(Or||{});function Doe(e){switch(e){case Or.HydrogenBond:return"Hydrogen Bond";case Or.Hydrophobic:return"Hydrophobic Contact";case Or.HalogenBond:return"Halogen Bond";case Or.Ionic:return"Ionic Interaction";case Or.MetalCoordination:return"Metal Coordination";case Or.CationPi:return"Cation-Pi Interaction";case Or.PiStacking:return"Pi Stacking";case Or.WeakHydrogenBond:return"Weak Hydrogen Bond";case Or.Unknown:return"Unknown Interaction"}}function Ret(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}var U5,V5,An=function(e){return e[e.None=0]="None",e[e.QuaternaryAmine=1]="QuaternaryAmine",e[e.TertiaryAmine=2]="TertiaryAmine",e[e.Sulfonium=3]="Sulfonium",e[e.SulfonicAcid=4]="SulfonicAcid",e[e.Sulfate=5]="Sulfate",e[e.Phosphate=6]="Phosphate",e[e.Halocarbon=7]="Halocarbon",e[e.Guanidine=8]="Guanidine",e[e.Acetamidine=9]="Acetamidine",e[e.Carboxylate=10]="Carboxylate",e}(An||{});function Oet(e){switch(e){case An.None:return"None";case An.QuaternaryAmine:return"Quaternary Amine";case An.TertiaryAmine:return"Tertiary Amine";case An.Sulfonium:return"Sulfonium";case An.SulfonicAcid:return"Sulfonic Acid";case An.Sulfate:return"Sulfate";case An.Phosphate:return"Phosphate";case An.Halocarbon:return"Halocarbon";case An.Guanidine:return"Guanidine";case An.Acetamidine:return"Acetamidine";case An.Carboxylate:return"Carboxylate"}}!function(e){e.create=function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,c){a[a.length]=s,i[i.length]=u,o[o.length]=c},getContacts:function(){for(var s=new Cu.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),c=new Int8Array(s.slotCount),l=0,d=s.edgeCount;l<d;l++)s.addNextEdge(),s.assignProperty(u,o[l]);var p,f=s.createGraph({type:u,flag:c});return Object.defineProperty(f,"elementsIndex",{get:function(){return p||(p=L5.createElementsIndex(f,r,n))}})}}}}(U5||(U5={})),function(e){e.create=function t(){var r=new Nv.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:yf.None})},getContacts:function(n){return new Pet(r.getMap(),n)}}}}(V5||(V5={}));var Fet={lineOfSightDistFactor:D.Numeric(1,{min:0,max:3,step:.1})},Net=3;function Eoe(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=zE(t.unit,n),o=zE(r.unit,a);return!(i&&o&&i!==o||t.unit===r.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]||function Cet(e,t,r,n,a){return t===n?function bet(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&Gr.isCovalent(o[s]))return!0;return!1}(t,r,a):function _et(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&Gr.isCovalent(i.props.flag)}(e,t,r,n,a)}(e,t.unit,n,r.unit,a))}function Ioe(e,t,r,n){var a=zE(e,t),i=zE(r,n);return a&&i&&a!==i}function Poe(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var Dm=S(),z5=S(),G5=S(),ket=rZ();function Moe(e,t,r,n){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];wa.position(z5,t),wa.position(G5,r),S.scale(Dm,S.add(Dm,z5,G5),.5);var c=e.lookup3d.find(Dm[0],Dm[1],Dm[2],n*Net,ket),l=c.count,d=c.indices,f=c.units,p=c.squaredDistances;if(0===l)return!0;for(var h=0;h<l;++h){var m=d[h],v=f[h];if(Oe.isAtomic(v)){var g=un(v,m);if("H"!==g){var y=G2(g);if(!(y*y*n*n<=p[h]||Ioe(v,m,t.unit,o)||Ioe(v,m,r.unit,s)||t.unit===v&&Poe(m,t)||r.unit===v&&Poe(m,r)||(v.conformation.position(v.elements[m],Dm),S.squaredDistance(Dm,z5)<1||S.squaredDistance(Dm,G5)<1)))return!1}}}return!0}function Let(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,c=r.subset(a.requiredFeatures),l=c.lookup3d,d=c.indices,f=wa.Info(e,t,r),p=R({},f),h=i.lineOfSightDistFactor,m=0,v=Be.size(d);m<v;++m){var g=Be.getAt(d,m),y=l.find(o[g],s[g],u[g],a.maxDistance),b=y.count,_=y.indices,C=y.squaredDistances;if(0!==b){f.feature=g;for(var x=0;x<b;++x){var A=Be.getAt(d,_[x]);if(!(A<=g)&&(p.feature=A,Eoe(e,f,p))){var T=a.getType(e,f,p,C[x]);T&&Moe(e,f,p,h)&&n.add(g,A,T)}}}}}var Uet=me(),zet={distanceMax:D.Numeric(4,{min:1,max:5,step:.1}),angleMax:D.Numeric(30,{min:0,max:60,step:1})},Get=["CL","BR","I","AT"],jet=["N","O","S"],qet=["C","N","P","S"],Xet=Zr(180),Ket=Zr(120),$et=wa.Provider([6],function Het(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=un(t,u);Get.includes(l)&&r.add(6,An.None,i[n[u]],o[n[u]],s[n[u]],u)}}),Jet=wa.Provider([7],function Wet(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=un(t,d);if(jet.includes(p)){var h=!1;fu(e,t,d,function(m,v){qet.includes(un(m,v))&&(h=!0)}),h&&r.add(7,An.None,i[n[d]],o[n[d]],s[n[d]],d)}},c=0,l=n.length;c<l;++c)u(c)}),ett={name:"halogen-bonds",params:zet,createTester:function(e){var t=function Zet(e){return{angleMax:Zr(e.angleMax)}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return function Qet(e,t,r,n){var a=t.types[t.feature];if(function Yet(e,t){return 7===e&&6===t||6===e&&7===t}(a,r.types[r.feature])){var o=6===a?[t,r]:[r,t],s=o[0],u=o[1],c=s.members[s.offsets[s.feature]],l=u.members[u.offsets[u.feature]],d=qE(e,s.unit,c,u.unit,l);if(1===d.length&&!(Xet-d[0]>n.angleMax)){var f=qE(e,u.unit,l,s.unit,c);if(0!==f.length&&!f.some(function(p){return Ket-p>n.angleMax}))return Or.HalogenBond}}}(r,n,a,t)}}}},Roe={distanceMax:D.Numeric(3.5,{min:1,max:5,step:.1}),backbone:D.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:D.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:D.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:D.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:D.Numeric(45,{min:0,max:180,step:1})},ttt=R(R({},Roe),{water:D.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:D.Numeric(4.1,{min:1,max:5,step:.1})}),rtt=R({},Roe);function H5(e,t){var r=SC.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function itt(e,t){var r=e.rings,a=r.all,i=r.elementAromaticRingIndices.get(t);if(void 0===i)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],c=0,l=u.length;c<l;++c){var d=un(e,u[c]);if("N"===d||"O"===d)return!0}return!1}function Ooe(e,t){return 2===e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]}function Foe(e,t){return ip.has(_C(e,t))}function Noe(e,t){return"HIS"===M5(e,t)&&"N"===un(e,t)&&function stt(e,t){return e.rings.elementRingIndices.has(t)}(e,t)}function koe(e){return{includeBackbone:e.backbone,maxAccAngleDev:Zr(e.accAngleDevMax),maxDonAngleDev:Zr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Zr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Zr(e.donOutOfPlaneAngleMax)}}var Boe=Zr(120);function Loe(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(n.includeBackbone||!function utt(e,t,r,n){return Foe(e,t)&&Foe(r,n)}(t.unit,a,r.unit,i)){var o=qE(e,t.unit,a,r.unit,i),s=woe.get(t.idealGeometry[a])||Boe;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[a]===xa.Trigonal&&void 0!==(u=Aoe(e,t.unit,a,r.unit,i))&&u>n.maxDonOutOfPlaneAngle)return;var c=qE(e,r.unit,i,t.unit,a),l=woe.get(r.idealGeometry[i])||Boe;if(!c.some(function(d){return l-d>n.maxAccAngleDev})){var u;if(r.idealGeometry[i]===xa.Trigonal&&void 0!==(u=Aoe(e,r.unit,i,t.unit,a))&&u>n.maxAccOutOfPlaneAngle)return;return!0}}}}var mtt=wa.Provider([4],function ntt(e,t,r){for(var n=H5(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=0,l=a.length;c<l;++c){var d=un(t,c);(Noe(t,c)||n[c]>0&&("N"===d||"O"===d||"S"===d))&&r.add(4,An.None,o[a[c]],s[a[c]],u[a[c]],c)}}),vtt=wa.Provider([9],function att(e,t,r){for(var n=H5(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=0,l=a.length;c<l;++c)"C"===un(t,c)&&n[c]>0&&(du(e,t,c,"N")>0||du(e,t,c,"O")>0||itt(t,c))&&r.add(9,An.None,o[a[c]],s[a[c]],u[a[c]],c)}),gtt=wa.Provider([5],function ott(e,t,r){for(var n=H5(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,c=u.x,l=u.y,d=u.z,f=function(b){r.add(5,An.None,c[s[b]],l[s[b]],d[s[b]],b)},p=0,h=s.length;p<h;++p){var m=un(t,p);if("O"===m)f(p);else if("N"===m){if(Noe(t,p))f(p);else if(a[p]<1){var v=gf(e,t,p)+i[p],g=o[p];(g===xa.Tetrahedral&&v<4||g===xa.Trigonal&&v<3||g===xa.Linear&&v<2)&&f(p)}}else if("S"===m){var y=M5(t,p);("CYS"===y||"MET"===y||-1===xoe(t,p))&&f(p)}}}),ytt={name:"hydrogen-bonds",params:ttt,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=function ftt(e){return R(R({},koe(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return function ptt(e,t,r,n,a){var o=r.types[r.feature];if(function ltt(e,t){return 5===e&&4===t||4===e&&5===t}(t.types[t.feature],o)){var s=5===o?[t,r]:[r,t],u=s[0],c=s[1],l=u.members[u.offsets[u.feature]],d=c.members[c.offsets[c.feature]];if(!(n>("S"===un(u.unit,l)||"S"===un(c.unit,d)?a.maxSulfurDistSq:a.maxDistSq))&&(a.includeWater||!function ctt(e,t,r,n){return Ooe(e,t)&&Ooe(r,n)}(u.unit,l,c.unit,d))&&Loe(e,u,c,a))return Or.HydrogenBond}}(n,a,i,o,r)}}}},btt={name:"weak-hydrogen-bonds",params:rtt,createTester:function(e){var t=koe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return function htt(e,t,r,n,a){var o=r.types[r.feature];if(function dtt(e,t){return 9===e&&5===t||5===e&&9===t}(t.types[t.feature],o)){var s=5===o?[t,r]:[r,t];if(Loe(e,s[0],s[1],a))return Or.WeakHydrogenBond}}(r,n,a,0,t)}}}};function Stt(e,t,r){return"S"===un(t,r)&&3===du(e,t,r,"O")}function Ctt(e,t,r){return"S"===un(t,r)&&4===du(e,t,r,"O")}function Voe(e,t,r){return"P"===un(t,r)&&du(e,t,r,"O")===gf(e,t,r)}function wtt(e,t,r){var n=0;return"C"===un(t,r)&&2===du(e,t,r,"O")&&1===du(e,t,r,"C")&&fu(e,t,r,function(a,i){"O"===un(a,i)&&gf(e,a,i)-du(e,a,i,"H")==1&&(n+=1)}),2===n}function Att(e,t,r){var n=0;return"C"===un(t,r)&&3===gf(e,t,r)&&3===du(e,t,r,"N")&&fu(e,t,r,function(a,i){gf(e,a,i)-du(e,a,i,"H")==1&&(n+=1)}),2===n}function Ttt(e,t,r){var n=0;return"C"===un(t,r)&&3===gf(e,t,r)&&2===du(e,t,r,"N")&&1===du(e,t,r,"C")&&fu(e,t,r,function(a,i){gf(e,a,i)-du(e,a,i,"H")==1&&(n+=1)}),2===n}var Dtt=new Set(["N","O","S","F","CL","BR","I"]);var Ptt={distanceMax:D.Numeric(5,{min:0,max:8,step:.1})},Mtt={distanceMax:D.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:D.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:D.Numeric(30,{min:0,max:180,step:1})},Rtt={distanceMax:D.Numeric(6,{min:1,max:8,step:.1}),offsetMax:D.Numeric(2,{min:0,max:4,step:.1})},Ott=["ARG","HIS","LYS"],Ftt=["GLU","ASP"];function zoe(e,t){var r=SC.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}var Goe=S(),Hoe=S(),WE=S(),kb=S(),YE=S(),XE=S();function j5(e,t){var i=t.members,o=t.unit.elements,s=t.offsets[t.feature];return t.unit.conformation.position(o[i[s]],WE),t.unit.conformation.position(o[i[s+1]],kb),t.unit.conformation.position(o[i[s+2]],YE),S.triangleNormal(e,WE,kb,YE)}var q5=function(e,t,r){return wa.position(WE,e),wa.position(kb,t),S.sub(YE,WE,kb),S.projectOnPlane(XE,YE,r),S.add(XE,XE,kb),S.distance(XE,kb)},qtt=Zr(180),joe=Zr(90),CC=S(),W5=S();var Ktt=wa.Provider([2],function ktt(e,t,r){for(var n=zoe(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=new Set,l=t.model.atomicHierarchy.atoms.label_comp_id,d=tr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),h=f.start,m=f.end,v=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[f.index]);if(Ftt.includes(v)){r.startState();for(var g=h;g<m;++g)"O"===un(t,g)&&!ip.has(_C(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(2,An.None)}else if(fT.has(v))for(g=h;g<m;++g)Voe(e,t,g)&&(r.startState(),fu(e,t,g,function(_,C){"O"===un(t,C)&&r.pushMember(o[a[C]],s[a[C]],u[a[C]],C)}),r.finishState(2,An.Phosphate));else if(!My.has(v)){for(g=h;g<m;++g){r.startState(),"N"===un(t,g)&&!ip.has(_C(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g),r.finishState(2,An.None);var y=An.None;Stt(e,t,g)?y=An.SulfonicAcid:Voe(e,t,g)?y=An.Phosphate:Ctt(e,t,g)?y=An.Sulfate:wtt(e,t,g)&&(y=An.Carboxylate),y&&(r.startState(),fu(e,t,g,function(_,C){"O"===un(t,C)&&(c.add(C),r.pushMember(o[a[C]],s[a[C]],u[a[C]],C))}),r.finishState(2,y))}for(g=h;g<m;++g)n[g]<0&&!c.has(g)&&r.add(2,An.None,o[a[g]],s[a[g]],u[a[g]],g)}}}),Ztt=wa.Provider([1],function Ntt(e,t,r){for(var n=zoe(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=new Set,l=t.model.atomicHierarchy.atoms.label_comp_id,d=tr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),h=f.start,m=f.end,v=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[f.index]);if(Ott.includes(v)){r.startState();for(var g=h;g<m;++g)"N"===un(t,g)&&!ip.has(_C(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(1,An.None)}else if(!My.has(v)){for(c.clear(),g=h;g<m;++g){var y=An.None;Att(e,t,g)?y=An.Guanidine:Ttt(e,t,g)&&(y=An.Acetamidine),y&&(r.startState(),fu(e,t,g,function(_,C){"N"===un(t,C)&&(c.add(C),r.pushMember(o[a[C]],s[a[C]],u[a[C]],C))}),r.finishState(1,y))}for(g=h;g<m;++g)n[g]>0&&!c.has(g)&&r.add(1,An.None,o[a[g]],s[a[g]],u[a[g]],g)}}}),Qtt=wa.Provider([3],function Btt(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=t.rings.aromaticRings;u<c.length;u++){var d=t.rings.all[c[u]];r.startState();for(var f=0,p=d.length;f<p;++f){var h=d[f];r.pushMember(i[n[h]],o[n[h]],s[n[h]],h)}r.finishState(3,An.None)}}),$tt={name:"ionic",params:Ptt,createTester:function(e){var t=function Gtt(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return function Wtt(e,t,r,n,a){if(function Ltt(e,t){return 2===e&&1===t||1===e&&2===t}(t.types[t.feature],r.types[r.feature])&&function ztt(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,c=a[n],l=a[n+1];c<l;++c){e.unit.conformation.position(e.unit.elements[i[c]],Goe);for(var f=s[o],p=s[o+1];f<p;++f)if(t.unit.conformation.position(t.unit.elements[u[f]],Hoe),S.squaredDistance(Goe,Hoe)<r)return!0}return!1}(t,r,a.distanceMaxSq))return Or.Ionic}(0,n,a,0,t)}}}},Jtt={name:"pi-stacking",params:Mtt,createTester:function(e){var t=function Htt(e){return{offsetMax:e.offsetMax,angleDevMax:Zr(e.angleDevMax)}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return function Ytt(e,t,r,n,a){if(function Utt(e,t){return 3===e&&3===t}(t.types[t.feature],r.types[r.feature])){j5(CC,t),j5(W5,r);var s=S.angle(CC,W5);if(Math.min(q5(t,r,W5),q5(r,t,CC))<=a.offsetMax){if(s<=a.angleDevMax||s>=qtt-a.angleDevMax)return Or.PiStacking;if(s<=a.angleDevMax+joe&&s>=joe-a.angleDevMax)return Or.PiStacking}}}(0,n,a,0,t)}}}},ert={name:"cation-pi",params:Rtt,createTester:function(e){var t=function jtt(e){return{offsetMax:e.offsetMax}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return function Xtt(e,t,r,n,a){var i=t.types[t.feature];if(function Vtt(e,t){return 3===e&&1===t||1===e&&3===t}(i,r.types[r.feature])){var s=3===i?[t,r]:[r,t],u=s[0],c=s[1];if(j5(CC,u),q5(c,u,CC)<=a.offsetMax)return Or.CationPi}}(0,n,a,0,t)}}}},trt={distanceMax:D.Numeric(4,{min:1,max:5,step:.1})},irt=wa.Provider([8],function rrt(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=un(t,d),h=!1;"C"===p?(h=!0,fu(e,t,d,function(m,v){var g=un(m,v);"C"!==g&&"H"!==g&&(h=!1)})):"F"===p&&(h=!0),h&&r.add(8,An.None,i[n[d]],o[n[d]],s[n[d]],d)},c=0,l=n.length;c<l;++c)u(c)}),ort={name:"hydrophobic",params:trt,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return function art(e,t,r,n){if(function nrt(e,t){return 8===e&&8===t}(t.types[t.feature],r.types[r.feature])){var s=r.members[r.offsets[r.feature]];if("F"!==un(t.unit,t.members[t.offsets[t.feature]])||"F"!==un(r.unit,s))return Or.Hydrophobic}}(0,r,n)}}}},srt={distanceMax:D.Numeric(3,{min:1,max:5,step:.1})},urt=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function qoe(e){return!ip.has(e)}function lrt(e){return ip.has(e)}function drt(e){return lT.has(e)}function Woe(e,t){return 12===e?11===t||12===t:13===e?10===t:void 0}var Qp,hrt=wa.Provider([13,12],function crt(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=un(t,u),d=0;urt.includes(l)?d=13:(Jte(l)||"ZN"===l||"CD"===l)&&(d=12),d&&r.add(d,An.None,i[n[u]],o[n[u]],s[n[u]],u)}}),mrt=wa.Provider([10,11],function frt(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=un(t,u),d=M5(t,u),f=_C(t,u),p=!1,h=!1,m=P2.has(d),v=fT.has(d);m||v?m?"O"===l?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&qoe(f)||lrt(f))&&(p=!0,h=!0):"S"!==l||"CYS"!==d&&"MET"!==d?"N"===l&&"HIS"===d&&qoe(f)&&(p=!0):(p=!0,h=!0):v&&("O"===l&&drt(f)?(p=!0,h=!0):["N3","N4","N7"].includes(f)?p=!0:["O2","O4","O6"].includes(f)&&(p=!0,h=!0)):d7e(l)||"O"===l||"S"===l?(p=!0,h=!0):"N"===l&&(p=!0),p&&r.add(11,An.None,i[n[u]],o[n[u]],s[n[u]],u),h&&r.add(10,An.None,i[n[u]],o[n[u]],s[n[u]],u)}}),vrt={name:"metal-coordination",params:srt,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return function prt(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(Woe(a,i)||Woe(i,a))return Or.MetalCoordination}(0,r,n)}}}};function yrt(e,t){var r=t.contacts,n=function(c,l,d,f,p){var h=f.get(d)||[1/0,-1],v=h[1];c<h[0]?(-1!==v&&p(v),f.set(d,[c,l])):p(l)};function a(c,l,d,f,p){var h=l.members[l.offsets[l.feature]],m=d.members[d.offsets[d.feature]],v=l.unit.getResidueIndex(h),g=d.unit.getResidueIndex(m),y="".concat(h,"|").concat(l.unit.id,"|").concat(g,"|").concat(d.unit.id,"|A"),b="".concat(m,"|").concat(d.unit.id,"|").concat(v,"|").concat(l.unit.id,"|B"),_=wa.distance(l,d);n(_,c,y,f,p),n(_,c,b,f,p)}var s,u,i=new Map,o=function(c){return r.edges[c].props.flag=yf.Filtered};return{isApplicable:function(c){return c===Or.Hydrophobic},handleInterContact:function(c,l,d){a(c,l,d,i,o)},startUnit:function(c,l,d){s=new Map,u=function(f){return l.edgeProps.flag[f]=yf.Filtered}},handleIntraContact:function(c,l,d){a(c,l,d,s,u)}}}function brt(e,t){var r=t.contacts,n=function(a,i){for(var o=9===a.types[a.feature]?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),c=u.edgeProps.type,l=u.elementsIndex,d=l.offsets,f=l.indices,p=d[s],h=d[s+1];p<h;++p)if(c[f[p]]===Or.HydrogenBond)return!0;var m=r.getEdgeIndices(o.feature,o.unit.id);for(p=0,h=m.length;p<h;++p)if(r.edges[m[p]].props.type===Or.HydrogenBond)return!0;return!1};return{isApplicable:function(a){return a===Or.WeakHydrogenBond},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=yf.Filtered)},startUnit:function(){},handleIntraContact:function(a,i,o){n(i,o)&&(t.unitsContacts.get(i.unit.id).edgeProps.flag[a]=yf.Filtered)}}}function Y5(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,c=i[o],l=i[o+1];c<l;++c)for(var f=a.getContactIndicesForElement(r.members[c],r.unit),p=0,h=f.length;p<h;++p){var m=f[p];if(e.includes(a.edges[m].props.type))for(var v=s[u],g=s[u+1];v<g;++v)if(a.getContactIndicesForElement(n.members[v],n.unit).includes(m))return void(a.edges[t].props.flag=yf.Filtered)}}function X5(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,c=u.offsets,l=u.indices,d=r.offsets,f=r.feature,p=n.offsets,h=n.feature,m=d[f],v=d[f+1];m<v;++m)for(var g=r.members[m],y=c[g],b=c[g+1];y<b;++y){var _=l[y];if(e.includes(o[_]))for(var C=p[h],x=p[h+1];C<x;++C)for(var A=n.members[C],T=c[A],w=c[A+1];T<w;++T)if(_===l[T])return void(s[t]=yf.Filtered)}}function _rt(e,t){var r=t.contacts;return{isApplicable:function(n){return n===Or.Ionic},handleInterContact:function(n,a,i){Y5([Or.HydrogenBond,Or.WeakHydrogenBond],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){X5([Or.HydrogenBond,Or.WeakHydrogenBond],n,a,i,t.unitsContacts.get(a.unit.id))}}}function Srt(e,t){var r=t.contacts;return{isApplicable:function(n){return n===Or.Hydrophobic||n===Or.CationPi},handleInterContact:function(n,a,i){Y5([Or.PiStacking],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){X5([Or.PiStacking],n,a,i,t.unitsContacts.get(a.unit.id))}}}function Crt(e,t){var r=t.contacts;return{isApplicable:function(n){return n===Or.Ionic},handleInterContact:function(n,a,i){Y5([Or.MetalCoordination],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){X5([Or.MetalCoordination],n,a,i,t.unitsContacts.get(a.unit.id))}}}!function(e){function a(l,d){var f=d.unitA,p=d.indexA,h=d.unitB,m=d.indexB,v=l.contacts;if(f===h){var y=l.unitsContacts.get(f.id),b=y.getDirectedEdgeIndex(p,m);return Doe(y.edgeProps.type[b])}return b=v.getEdgeIndex(p,f.id,m,h.id),Doe(v.edges[b].props.type)}function u(l,d,f){var p=l.unitsFeatures;return Fv.fromPairProvider(d.length,function(h,m,v){var g=d[h];wa.setPosition(m,g.unitA,g.indexA,p.get(g.unitA.id)),wa.setPosition(v,g.unitB,g.indexB,p.get(g.unitB.id))},f)}function c(l,d,f){var p=f[0];if(void 0===p)return"";var h=p.unitA,m=p.indexA,v=p.unitB,g=p.indexB,y=d.unitsFeatures,b=y.get(h.id),_=b.members,C=b.offsets,x=y.get(v.id),A=x.members,T=x.offsets,w={granularity:"element"};return(C[m+1]-C[m]>1||T[g+1]-T[g]>1)&&(w.granularity="residue"),[a(d,p),KL(Ht.Location(l,h,_[C[m]],l,v,A[T[g]]),w)].join("</br>")}e.Location=function t(l,d,f,p,h,m){return VJ("interactions",{structure:d,interactions:l},{unitA:f,indexA:p,unitB:h,indexB:m})},e.isLocation=function r(l){return!!l&&"data-location"===l.kind&&"interactions"===l.tag},e.areLocationsEqual=function n(l,d){return l.data.structure===d.data.structure&&l.data.interactions===d.data.interactions&&l.element.indexA===d.element.indexA&&l.element.indexB===d.element.indexB&&l.element.unitA===d.element.unitA&&l.element.unitB===d.element.unitB},e.locationLabel=function i(l){return a(l.data.interactions,l.element)},e.Loci=function o(l,d,f){return pE("interactions",{structure:l,interactions:d},f,function(p){return u(d,f,p)},function(){return c(l,d,f)})},e.isLoci=function s(l){return!!l&&"data-loci"===l.kind&&"interactions"===l.tag},e.getBoundingSphere=u,e.getLabel=c}(Qp||(Qp={}));var xrt=[mtt,vtt,gtt,Ktt,Ztt,Qtt,$et,Jet,irt,hrt,mrt],KE={ionic:$tt,"pi-stacking":Jtt,"cation-pi":ert,"halogen-bonds":ett,"hydrogen-bonds":ytt,"weak-hydrogen-bonds":btt,hydrophobic:ort,"metal-coordination":vrt},Art=function wrt(e){void 0===e&&(e=[]);var t=Object.create(null);return Object.keys(KE).forEach(function(r){t[r]=D.MappedStatic(e.includes(r)?"on":"off",{on:D.Group(KE[r].params),off:D.Group({})},{cycle:!0})}),t}(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),Yoe={providers:D.Group(Art,{isFlat:!0}),contacts:D.Group(Fet,{label:"Advanced Options"})};function Trt(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y;return le(this,function(b){switch(b.label){case 0:return n=R(R({},D.getDefaultValues(Yoe)),r),[4,SC.attach(e,t)];case 1:b.sent(),a=[],qA(KE).forEach(function(_){var C=n.providers[_];"on"===C.name&&a.push(KE[_].createTester(C.params))}),i=new Set,a.forEach(function(_){return fa.add(i,_.requiredFeatures)}),o=xrt.filter(function(_){return fa.areIntersecting(i,_.types)}),s=Oc.Mutable(),u=Oc.Mutable(),c=0,l=t.unitSymmetryGroups.length,b.label=2;case 2:return c<l?(d=t.unitSymmetryGroups[c],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:c,max:l})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=function Drt(e,t,r){var n=t.elements.length,a=B5.create(n,n/2);if(Oe.isAtomic(t))for(var i=0,o=r;i<o.length;i++)o[i].add(e,t,a);return a.getFeatures(n)}(t,d.units[0],o),p=function Ert(e,t,r,n,a){var i=U5.create(r,t.elements.length);return Oe.isAtomic(t)&&function Bet(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++)Let(e,t,r,n,s[o],i)}(e,t,r,i,n,a),i.getContacts()}(t,d.units[0],f,a,n.contacts),h=0,m=d.units.length;h<m;++h)s.set((v=d.units[h]).id,f),u.set(v.id,p);b.label=5;case 5:return++c,[3,2];case 6:return g=function Irt(e,t,r,n){var a=V5.create();return Ye.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);!function Vet(e,t,r,n,a,i,o,s){var u=r.count,c=r.x,l=r.y,d=r.z,f=a.lookup3d,p=me.mul(Uet,n.conformation.operator.inverse,t.conformation.operator.matrix),h=!me.isIdentity(p),m=S(),v=Math.max.apply(Math,o.map(function(Q){return Q.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,_=(b+v)*(b+v),C=s.lineOfSightDistFactor,x=wa.Info(e,t,r),A=wa.Info(e,n,a);i.startUnitPair(t,n);for(var T=0;T<u;++T)if(S.set(m,c[T],l[T],d[T]),h&&S.transformMat4(m,m,p),!(S.squaredDistance(m,y)>_)){var w=f.find(m[0],m[1],m[2],v),E=w.indices,I=w.count,M=w.squaredDistances;if(0!==I){x.feature=T;for(var F=0;F<I;++F){var N=E[F];if(A.feature=N,Eoe(e,x,A))for(var j=M[F],k=0,H=o;k<H.length;k++){var G=H[k];if(j<G.maxDistance*G.maxDistance){var U=G.getType(e,x,A,j);if(U&&Moe(e,x,A,C)){i.add(T,N,U);break}}}}}}i.finishUnitPair()}(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return Oe.isAtomic(i)},validUnitPair:function(i,o){return Ye.validUnitPair(e,i,o)}}),a.getContacts(t)}(t,s,a,n.contacts),function grt(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[yrt(0,t),brt(0,t),_rt(0,t),Srt(0,t),Crt(0,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],c=e.unitMap.get(u.unitA),l=e.unitMap.get(u.unitB);(d=wa.Info(e,c,a.get(u.unitA))).feature=u.indexA,(f=wa.Info(e,l,a.get(u.unitB))).feature=u.indexB;for(var p=0,h=i;p<h.length;p++)(m=h[p]).isApplicable(u.props.type)&&m.handleInterContact(o,d,f)}for(var v=n.keys();;){var g=v.next(),b=g.value;if(g.done)break;var _=n.get(b),C=a.get(b),x=e.unitMap.get(b);if(Oe.isAtomic(x)){for(var d=wa.Info(e,x,C),f=wa.Info(e,x,C),A=0,T=i;A<T.length;A++)(m=T[A]).startUnit(x,_,C);for(o=0,s=2*_.edgeCount;o<s;++o){d.feature=_.a[o],f.feature=_.b[o];for(var w=0,E=i;w<E.length;w++){var m;(m=E[w]).isApplicable(_.edgeProps.type[o])&&m.handleIntraContact(o,d,f)}}}}}(t,y={unitsFeatures:s,unitsContacts:u,contacts:g}),[2,y]}})})}var K5=R({},Yoe),Ka=pp.createProvider({label:"Interactions",descriptor:ec({name:"molstar_computed_interactions"}),type:"local",defaultParams:K5,getParams:function(e){return K5},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=R(R({},D.getDefaultValues(K5)),r),a={},[4,Trt(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),Z5=dt(13421772),Rs_HydrogenBond=2851770,Rs_Hydrophobic=8421504,Rs_HalogenBond=4259775,Rs_Ionic=15779860,Rs_MetalCoordination=9191577,Rs_CationPi=16744448,Rs_PiStacking=9220966,Rs_WeakHydrogenBond=12967404,Mrt=[["Hydrogen Bond",Rs_HydrogenBond],["Hydrophobic",Rs_Hydrophobic],["Halogen Bond",Rs_HalogenBond],["Ionic",Rs_Ionic],["Metal Coordination",Rs_MetalCoordination],["Cation Pi",Rs_CationPi],["Pi Stacking",Rs_PiStacking],["Weak HydrogenBond",Rs_WeakHydrogenBond]];function Xoe(e){switch(e){case Or.HydrogenBond:return Rs_HydrogenBond;case Or.Hydrophobic:return Rs_Hydrophobic;case Or.HalogenBond:return Rs_HalogenBond;case Or.Ionic:return Rs_Ionic;case Or.MetalCoordination:return Rs_MetalCoordination;case Or.CationPi:return Rs_CationPi;case Or.PiStacking:return Rs_PiStacking;case Or.WeakHydrogenBond:return Rs_WeakHydrogenBond;case Or.Unknown:return Z5}}var Koe={},Q5={name:"interaction-type",label:"Interaction Type",category:Nu.Category.Misc,factory:function Zoe(e,t){var n=e.structure?Ka.get(e.structure):void 0,a=n?Dv(n.id,n.version):-1;return{factory:Zoe,granularity:"group",color:n&&n.value?function(i){if(Qp.isLocation(i)){var o=i.data.interactions,u=o.contacts,c=i.element,l=c.unitA,d=c.unitB,f=c.indexA,p=c.indexB;if(l===d){var h=o.unitsContacts.get(l.id),m=h.getDirectedEdgeIndex(f,p);return Xoe(h.edgeProps.type[m])}return m=u.getEdgeIndex(f,l.id,p,d.id),Xoe(u.edges[m].props.type)}return Z5}:function(){return Z5},props:t,contextHash:a,description:"Assigns colors according the interaction type of a link.",legend:Gh(Mrt)}},getParams:function Rrt(e){return Koe},defaultValues:D.getDefaultValues(Koe),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Ka.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ka.ref(e.structure,!1)}}};function Sc(e,t,r,n){var d,f,p,h,a=0,i=t.webgl,o=new Cn,s=new dr.GeometryState,u=Vp(),c=[],l=ho.create(),m=Oi.createEmpty();function C(T){if(ho.update(l,T),void 0!==T.visible&&d&&d.setVisibility(T.visible&&(null===l.unitTransforms||l.unitTransforms.isIdentity)),void 0!==T.alphaFactor&&d&&d.setAlphaFactor(T.alphaFactor),void 0!==T.pickable&&d&&d.setPickable(T.pickable),void 0!==T.overpaint&&d){var w=Fi.remap(T.overpaint,f);d.setOverpaint(w,i)}if(void 0!==T.transparency&&d){var E=jo.remap(T.transparency,f);d.setTransparency(E,i)}if(void 0!==T.substance&&d){var I=qo.remap(T.substance,f);d.setSubstance(I,i)}if(void 0!==T.clipping&&d){var M=Wn.remap(T.clipping,f);d.setClipping(M)}void 0!==T.themeStrength&&d&&d.setThemeStrength(T.themeStrength),void 0!==T.transform&&d&&d.setTransform(T.transform),void 0!==T.unitTransforms&&d&&d.setVisibility(l.visible&&(null===T.unitTransforms||T.unitTransforms.isIdentity))}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return h},get params(){return p},get state(){return l},get theme(){return m},get geometryVersion(){return s.version},renderObjects:c,updated:o,createOrUpdate:function v(T,w){var E=this;return void 0===T&&(T={}),w&&w!==f&&(p=r(t,w),f=w,h||(h=D.getDefaultValues(p))),h=Object.assign({},h,T),Ve.create("Creating or updating ComplexRepresentation",function(I){return ce(E,void 0,void 0,function(){var M,F,N;return le(this,function(j){switch(j.label){case 0:return M=!1,d?!(null===(N=d.mustRecreate)||void 0===N)&&N.call(d,f,h,i)&&(d.destroy(),d=n(u,f,h,i),M=!0):(d=n(u,f,h,i),M=!0),(F=d.createOrUpdate({webgl:i,runtime:I},m,h,w))?[4,F]:[3,2];case 1:j.sent(),j.label=2;case 2:return M&&C(l),c.length=0,d&&d.renderObject&&(c.push(d.renderObject),s.add(d.renderObject.id,d.geometryVersion)),s.snapshot(),o.next(a+=1),[2]}})})})},setState:C,setTheme:function x(T){m=T},getLoci:function g(T){return d?d.getLoci(T):Yr},getAllLoci:function y(){var T;return[Ye.Loci(null!==(T=f.child)&&void 0!==T?T:f)]},eachLocation:function b(T){d?.eachLocation(T)},mark:function _(T,w){if(!f||!Is.is(l.markerActions,w))return!1;if(Ye.isLoci(T)||Re.is(T)||Ht.isLoci(T)){if(!Ye.areRootsEquivalent(T.structure,f))return!1;T=pr.remap(T,f),(Ye.isLoci(T)||Re.is(T)&&Re.isWholeStructure(T))&&(T=fE)}else if(!ku(T)&&!fC(T))return!1;return!pr.isEmpty(T)&&!!d&&d.mark(T,w)},destroy:function A(){d&&d.destroy()}}}function Qoe(e,t,r){var n=t.elements,a=t.model;if(-1!==Be.indexOf(n,r)){for(var i=a.atomicHierarchy.residueAtomSegments,s=i.offsets,u=i.index[r],c=[],l=s[u],d=s[u+1];l<d;++l){var f=Be.indexOf(n,l);-1!==f&&c.push(f)}return Re(e,[{unit:t,indices:Be.ofSortedArray(Xe.ofSortedArray(c))}])}return Yr}function xC(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],c=s[r],l=s[r+1];c<l;++c){var d=Be.indexOf(a,c);if(-1!==d){var f=o.value(c);(n===f||""===f)&&u.push(d)}}return Re(e,[{unit:t,indices:Be.ofSortedArray(Xe.ofSortedArray(u))}])}function $oe(e,t,r){for(var n=e.structure.child,a=t&&n?e.group.units.filter(function(c){return n.unitMap.has(c.id)}):e.group.units,i=a.length,o=16*i,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<i;u++)me.toArray(a[u].conformation.operator.matrix,s,16*u);return rB(s,i,r)}var Nrt=D.objectToOptions({atomic:{},spheres:{},gaussians:{}}),Joe=5e8;function ese(e,t,r){void 0===r&&(r=Joe);var n=Nt.size(S(),e);S.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1];return{area:i,areaCells:Math.ceil(i/(t*t)),maxAreaCells:a}}function Em(e,t,r){void 0===r&&(r=Joe);var n=ese(e,t.resolution,r),o=n.maxAreaCells,s=n.areaCells>o?Math.sqrt(n.area/o):t.resolution;return R(R({},t),{resolution:s})}var ZE={ignoreHydrogens:D.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),traceOnly:D.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:D.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},Lrt=(D.getDefaultValues(ZE),S());function tse(e,t,r,n){return S.squaredDistance(S.set(Lrt,e,t,r),n)}function QE(e,t,r,n){var _,C,a=n.ignoreHydrogens,i=n.ignoreHydrogensVariant,o=n.traceOnly,s=n.includeParent,u=s?e.root.unitMap.get(t.id):t,c=s&&u!==t,l=function Brt(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}(u),d=l.x,f=l.y,p=l.z,h=u.elements,m=t.boundary.sphere,v=m.center,g=m.radius,b=(g+11)*(g+11);if(a||o||c){for(var x=[],A=[],T=0,w=h.length;T<w;++T){var E=h[T];a&&nd(e,u,E,i)||o&&!$5(u,E)||c&&tse(d[E],f[E],p[E],v)>b||(x.push(E),A.push(T))}_=Xe.ofSortedArray(x),C=A}else _=h,C=rc(new Int32Array(_.length));s&&u!==t&&function Urt(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=Xe.indexOfInRange(t,r[i],n,a);-1===s?e[i]=-2:(e[i]=s,n=s)}}(C,t.elements,_);var I={indices:_,x:d,y:f,z:p,id:C},M=c?up(I):t.boundary,F=at.create(e,u);return{position:I,boundary:M,radius:function(j){return F.element=j,r.size(F)}}}function $E(e,t,r){var h,m,v,g,y,b,n=r.ignoreHydrogens,a=r.ignoreHydrogensVariant,i=r.traceOnly,s=r.includeParent&&!!e.parent,u=at.create(e.root),c=e.boundary.sphere,l=c.center,d=c.radius,p=(d+11)*(d+11);if(n||i||s){for(var _=e.serialMapping.getSerialIndex,C=s?e.root.units:e.units,x=[],A=[],T=[],w=[],E=[],I=0,M=C.length;I<M;++I){var N=(F=C[I]).elements,j=F.conformation,k=j.x,H=j.y,G=j.z,U=e.unitMap.get(F.id);u.unit=F;for(var Q=0,W=N.length;Q<W;++Q){var K=N[Q];if((!n||!nd(e,F,K,a))&&(!i||$5(F,K))){var ne=k(K),X=H(K),L=G(K);if(!(s&&tse(ne,X,L,l)>p))if(x.push(ne),A.push(X),T.push(L),u.element=K,w.push(t.size(u)),s){var Y=U?Xe.indexOf(U.elements,K):-1;E.push(-1===Y?-2:_(U,K))}else E.push(_(F,K))}}}h=x,m=A,v=T,g=w,b=Be.ofRange(0,(y=E).length)}else{var $=e.elementCount,Z=(x=new Float32Array($),A=new Float32Array($),T=new Float32Array($),w=new Float32Array($),I=0,0);for(M=e.units.length;I<M;++I){N=(F=e.units[I]).elements;var F,q=F.conformation;for(k=q.x,H=q.y,G=q.z,u.unit=F,Q=0,W=N.length;Q<W;++Q){var z=Z+Q;x[z]=k(K=N[Q]),A[z]=H(K),T[z]=G(K),u.element=K,w[z]=t.size(u)}Z+=N.length}h=x,m=A,v=T,g=w,y=rc(new Uint32Array($)),b=Be.ofRange(0,y.length)}var te={indices:b,x:h,y:m,z:v,id:y};return{position:te,boundary:s?up(te):e.boundary,radius:function(he){return g[he]}}}var rse=RT.H;function nd(e,t,r,n){if(Oe.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[r]!==rse)return!1;if("all"===n)return!0;var a=function Itt(e,t,r){var n=!1;return fu(e,t,r,function(a,i){(function Ett(e){return Dtt.has(e)})(un(a,i))&&(n=!0)}),n}(e,t,Xe.indexOf(t.elements,r));return!!(a&&"polar"===n||!a&&"non-polar"===n)}function Vrt(e,t){return e[t]===rse}function $5(e,t){if(Oe.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return"CA"===r||"BB"===r||"P"===r}function wC(e){return D.MultiSelect(e,Nrt,{description:"For which kinds of units/chains to show the representation visuals."})}var pu={unitKinds:wC(["atomic","spheres"]),includeParent:D.Boolean(!1,{isHidden:!0})},nse=R({},Lt.Params),ase=R({},ol.Params),ise=R({},ou.Params),zrt=R({},hm.Params),ose=R({},ca.Params),sse=R({},hc.Params),use=R({},mc.Params),cse=R({},xs.Params);function Tg(e,t){var y,b,_,C,T,w,I,M,r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.processValues,l=e.dispose,d=e.geometryUtils,f=d.updateValues,p=d.updateBoundingSphere,h=d.updateRenderableState,m=d.createPositionIterator,v=df.create(),g={loci:Yr,action:Vt.None,status:-1},x=Object.assign({},r),A=Oi.createEmpty(),E=-1;function N(U){if(v.createNew){if(I=a(C),!U)throw new Error("expected geometry to be given");y=function Grt(e,t,r,n,a,i){var o=Xi.getUtils(t),u=o.createRenderableState,l=(0,o.createValues)(t,aB(),r,n,a),d=u(a);return fb(t.kind,l,d,i)}(0,U,I,_,b,t),M=m(U,y.values)}else{if(!y)throw new Error("expected renderObject to be available");if(v.updateTransform){var Q=(I=a(C)).instanceCount,W=I.groupCount;b.instanceGranularity?La(Q,"instance",y.values):La(Q*W,"groupInstance",y.values)}if(v.createGeometry){if(!U)throw new Error("expected geometry to be given");O.updateIfChanged(y.values.drawCount,Xi.getDrawCount(U)),O.updateIfChanged(y.values.uVertexCount,Xi.getVertexCount(U)),O.updateIfChanged(y.values.uGroupCount,Xi.getGroupCount(U))}(v.updateTransform||v.createGeometry)&&(p(y.values,U||w),M=m(w,y.values)),v.updateSize&&"uSize"in y.values&&Ip(I,_.size,y.values),v.updateColor&&pc(I,M,_.color,y.values),f(y.values,b),h(y.state,b)}x=b,A=_,T=C,U&&(w=U,E+=1)}function H(U,Q,W){return function j(U){return!!(ku(U)||Ye.isLoci(U)&&Ye.areRootsEquivalent(U.structure,T)||Re.is(U)&&Ye.areRootsEquivalent(U.structure,T)&&Re.isWholeStructure(U))}(U)?Q(xe.ofBounds(0,x.instanceGranularity?I.instanceCount:I.groupCount*I.instanceCount)):x.instanceGranularity?function k(U,Q,W){var K=!1;return!(!Re.is(U)&&!Ht.isLoci(U)||!Ye.areEquivalent(U.structure,Q))&&(W(xe.ofSingleton(0))&&(K=!0),K)}(U,T,Q):o(U,T,Q,W)}function G(U){y&&c?.(y.values,w,x,A,U.webgl)}return{get groupCount(){return I?I.count:0},get renderObject(){return I&&I.count?y:void 0},get geometryVersion(){return E},createOrUpdate:function(U,Q,W,K){if(void 0===W&&(W={}),function F(U,Q,W){if(!W&&!T)throw new Error("missing structure");if(b=Object.assign({},x,Q),_=U,C=W,df.reset(v),!y||!T)return v.createNew=!0,void(v.createGeometry=!0);s(v,b,x,_,A,C,T),Ye.areEquivalent(C,T)||(v.createGeometry=!0),Ye.areHierarchiesEqual(C,T)||(v.updateTransform=!0,v.createGeometry=!0),Nu.areEqual(U.color,A.color)||(v.updateColor=!0),Nd(b.unitKinds,x.unitKinds)||(v.createGeometry=!0),T.child!==C.child&&(v.createGeometry=!0),b.instanceGranularity!==x.instanceGranularity&&(v.updateTransform=!0),v.updateSize&&!("uSize"in y.values)&&(v.createGeometry=!0),v.createGeometry&&(v.updateColor=!0,v.updateSize=!0)}(Q,W,K||T),v.createGeometry){var ne=n(U,C,_,b,w);if(WA(ne))return ne.then(function(X){N(X),G(U)});N(ne)}else N();G(U)},getLoci:function(U){return y?i(U,T,y.id):Yr},eachLocation:function(U){for(I.reset();I.hasNext;){var Q=I.move();U(Q.location,Q.isSecondary)}},mark:function(U,Q){return _r.mark(y,U,Q,H,g)},setVisibility:function(U){_r.setVisibility(y,U)},setAlphaFactor:function(U){_r.setAlphaFactor(y,U)},setPickable:function(U){_r.setPickable(y,U)},setColorOnly:function(U){_r.setColorOnly(y,U)},setTransform:function(U,Q){_r.setTransform(y,U,Q)},setOverpaint:function(U,Q){_r.setOverpaint(y,U,H,!0,{geometry:w,props:x,webgl:Q})},setTransparency:function(U,Q){_r.setTransparency(y,U,H,!0,{geometry:w,props:x,webgl:Q})},setSubstance:function(U,Q){_r.setSubstance(y,U,H,!0,{geometry:w,props:x,webgl:Q})},setClipping:function(U){_r.setClipping(y,U,H,!0)},setThemeStrength:function(U){_r.setThemeStrength(y,U)},destroy:function(){l?.(w),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var Bb=R(R({},nse),pu);function $p(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Lt.Utils}),t)}var Hrt=R(R({},ase),pu),qrt=R(R({},ise),pu),Yrt=R(R({},ose),pu),Krt=R(R({},sse),pu),Qrt=R(R({},use),pu),Jrt=R(R({},cse),pu);function va(e,t,r,n){var f,p,h,m,a=0,i=t.webgl,o=new Cn,s=Vp(),u=[],c=new dr.GeometryState,l=ho.create(),d=new Map,v=Oi.createEmpty();function x(E,I,M){var F=M.visible,N=M.alphaFactor,j=M.pickable,k=M.overpaint,H=M.transparency,G=M.substance,U=M.clipping,Q=M.themeStrength,W=M.transform,K=M.unitTransforms;void 0!==F&&E.setVisibility(F),void 0!==N&&E.setAlphaFactor(N),void 0!==j&&E.setPickable(j),void 0!==k&&E.setOverpaint(k,i),void 0!==H&&E.setTransparency(H,i),void 0!==G&&E.setSubstance(G,i),void 0!==U&&E.setClipping(U),void 0!==Q&&E.setThemeStrength(Q),void 0!==W&&(W!==l.transform||!me.areEqual(W,l.transform,gn))&&E.setTransform(W),void 0!==K&&(K?E.setTransform(void 0,K.getSymmetryGroupTransforms(I)):K!==l.unitTransforms&&E.setTransform(void 0,null))}return{label:e,get groupCount(){var E=0;return d.forEach(function(I){var M=I.visual;M.renderObject&&(E+=M.groupCount)}),E},get geometryVersion(){return c.version},get props(){return m},get params(){return h},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:function g(E,I){var M=this;return void 0===E&&(E={}),I&&I!==f&&(h=r(t,I),m||(m=D.getDefaultValues(h))),m=Object.assign({},m,E),Ve.create("Creating or updating UnitsRepresentation",function(F){return ce(M,void 0,void 0,function(){var N,j,k,H,G,U,Q,W,K,ne,X,L,Y;return le(this,function($){switch($.label){case 0:if(f||I)return[3,1];throw new Error("missing structure");case 1:if(!I||f)return[3,8];p=I.unitSymmetryGroups,G=0,$.label=2;case 2:return G<p.length?(K=p[G],W=n(s,I,m,i),(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:I}))?[4,ne]:[3,4]):[3,7];case 3:$.sent(),$.label=4;case 4:return x(W,K,l),d.set(K.hashCode,{visual:W,group:K}),F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:G,max:p.length})]:[3,6];case 5:$.sent(),$.label=6;case 6:return G++,[3,2];case 7:return[3,43];case 8:if(!I||Ye.areUnitIdsAndIndicesEqual(I,f)&&I.child===f.child)return[3,22];p=I.unitSymmetryGroups,N=d,d=new Map,G=0,$.label=9;case 9:return G<p.length?(k=N.get((K=p[G]).hashCode))?null!==(X=(W=k.visual).mustRecreate)&&void 0!==X&&X.call(W,{group:K,structure:I},m,i)?(W.destroy(),W=n(s,I,m,i),(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:I}))?[4,ne]:[3,11]):[3,12]:[3,15]:[3,21];case 10:$.sent(),$.label=11;case 11:return x(W,K,l),[3,14];case 12:return(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:I}))?[4,ne]:[3,14];case 13:$.sent(),$.label=14;case 14:return d.set(K.hashCode,{visual:W,group:K}),N.delete(K.hashCode),W.renderObject&&qL(j=W.renderObject.values.tMarker.ref.value.array,xe.ofBounds(0,j.length),Vt.RemoveHighlight),[3,18];case 15:return W=n(s,I,m,i),(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:I}))?[4,ne]:[3,17];case 16:$.sent(),$.label=17;case 17:x(W,K,l),d.set(K.hashCode,{visual:W,group:K}),$.label=18;case 18:return F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:G,max:p.length})]:[3,20];case 19:$.sent(),$.label=20;case 20:return G++,[3,9];case 21:return N.forEach(function(Z){Z.visual.destroy()}),[3,43];case 22:if(!I||I===f||!Ye.areUnitIdsAndIndicesEqual(I,f))return[3,34];p=I.unitSymmetryGroups,G=0,$.label=23;case 23:return G<p.length?(k=d.get((K=p[G]).hashCode))?null!==(L=(W=k.visual).mustRecreate)&&void 0!==L&&L.call(W,{group:K,structure:I},m,t.webgl)?(W.destroy(),W=n(s,I,m,t.webgl),k.visual=W,(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:I}))?[4,ne]:[3,25]):[3,26]:[3,29]:[3,33];case 24:$.sent(),$.label=25;case 25:return x(W,K,l),[3,28];case 26:return(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:I}))?[4,ne]:[3,28];case 27:$.sent(),$.label=28;case 28:return k.group=K,[3,30];case 29:throw new Error("expected to find visual for hashCode ".concat(K.hashCode));case 30:return F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:G,max:p.length})]:[3,32];case 31:$.sent(),$.label=32;case 32:return G++,[3,23];case 33:return[3,43];case 34:H=[],d.forEach(function(Z){return H.push(Z)}),G=0,U=H.length,$.label=35;case 35:return G<U?(K=(Q=H[G]).group,null!==(Y=(W=Q.visual).mustRecreate)&&void 0!==Y&&Y.call(W,{group:K,structure:f},m,t.webgl)?(W.destroy(),W=n(s,f,m,i),H[G].visual=W,(ne=W.createOrUpdate({webgl:i,runtime:F},v,m,{group:K,structure:f}))?[4,ne]:[3,37]):[3,38]):[3,43];case 36:$.sent(),$.label=37;case 37:return x(W,K,l),[3,40];case 38:return(ne=W.createOrUpdate({webgl:i,runtime:F},v,m))?[4,ne]:[3,40];case 39:$.sent(),$.label=40;case 40:return F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:G,max:U})]:[3,42];case 41:$.sent(),$.label=42;case 42:return++G,[3,35];case 43:return u.length=0,d.forEach(function(Z){var q=Z.visual;q.renderObject&&(u.push(q.renderObject),c.add(q.renderObject.id,q.geometryVersion))}),c.snapshot(),I&&(f=I),o.next(a++),[2]}})})})},setState:function A(E){var I=E.visible,M=E.alphaFactor,F=E.pickable,N=E.overpaint,j=E.transparency,k=E.substance,H=E.clipping,G=E.themeStrength,U=E.transform,Q=E.unitTransforms,W=E.syncManually,K=E.markerActions,ne={};void 0!==I&&(ne.visible=I),void 0!==M&&(ne.alphaFactor=M),void 0!==F&&(ne.pickable=F),void 0!==N&&f&&(ne.overpaint=Fi.remap(N,f)),void 0!==j&&f&&(ne.transparency=jo.remap(j,f)),void 0!==k&&f&&(ne.substance=qo.remap(k,f)),void 0!==H&&f&&(ne.clipping=Wn.remap(H,f)),void 0!==G&&(ne.themeStrength=G),void 0!==U&&!me.areEqual(U,l.transform,gn)&&(ne.transform=U),(Q!==l.unitTransforms||Q?.version!==l.unitTransformsVersion)&&(ne.unitTransforms=Q,l.unitTransformsVersion=Q?Q?.version:-1),void 0!==W&&(ne.syncManually=W),void 0!==K&&(ne.markerActions=K),d.forEach(function(X){return x(X.visual,X.group,ne)}),ho.update(l,ne)},setTheme:function T(E){v=E},getLoci:function y(E){var I=Yr;return d.forEach(function(M){var N=M.visual.getLoci(E);Ps(N)||(I=N)}),I},getAllLoci:function _(){var E;return[Ye.Loci(null!==(E=f.child)&&void 0!==E?E:f)]},eachLocation:function b(E){d.forEach(function(I){I.visual.eachLocation(E)})},mark:function C(E,I){if(!f||!Is.is(l.markerActions,I))return!1;if(Ye.isLoci(E)||Re.is(E)||Ht.isLoci(E)){if(!Ye.areRootsEquivalent(E.structure,f))return!1;E=pr.remap(E,f),(Ye.isLoci(E)||Re.is(E)&&Re.isWholeStructure(E))&&(E=fE)}else if(!ku(E)&&!fC(E))return!1;if(pr.isEmpty(E))return!1;var M=!1;return d.forEach(function(F){M=F.visual.mark(E,I)||M}),M},destroy:function w(){d.forEach(function(E){return E.visual.destroy()}),d.clear()}}}function Im(e,t){var b,x,A,T,w,E,M,F,r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.processValues,l=e.dispose,d=e.geometryUtils,f=d.createEmpty,p=d.updateValues,h=d.updateBoundingSphere,m=d.updateRenderableState,v=d.createPositionIterator,g=df.create(),y={loci:Yr,action:Vt.None,status:-1},_=Object.assign({},r),C=Oi.createEmpty(),I=-1;function j(W){if(g.createNew){if(M=a(x),!W)throw new Error("expected geometry to be given");b=function tnt(e,t,r,n,a,i){var o=Xi.getUtils(t),u=o.createRenderableState,l=(0,o.createValues)(t,$oe(e,a.includeParent),r,n,a),d=u(a);return fb(t.kind,l,d,i)}(x,W,M,C,_,t),F=v(W,b.values)}else{if(!b)throw new Error("expected renderObject to be available");if(g.updateTransform){var K=(M=a(x)).instanceCount,ne=M.groupCount;_.instanceGranularity?La(K,"instance",b.values):La(K*ne,"groupInstance",b.values)}if(g.updateMatrix&&$oe(x,_.includeParent,b.values),g.createGeometry){if(!W)throw new Error("expected geometry to be given");O.updateIfChanged(b.values.drawCount,Xi.getDrawCount(W)),O.updateIfChanged(b.values.uVertexCount,Xi.getVertexCount(W)),O.updateIfChanged(b.values.uGroupCount,Xi.getGroupCount(W))}(g.updateTransform||g.createGeometry)&&(h(b.values,W||E),F=v(W||E,b.values)),g.updateSize&&"uSize"in b.values&&Ip(M,C.size,b.values),g.updateColor&&pc(M,F,C.color,b.values),p(b.values,_),m(b.state,_)}A=_,T=C,w=x,W&&(E=W,I+=1)}function U(W,K,ne){return function H(W){return!!(ku(W)||Ye.isLoci(W)&&Ye.areRootsEquivalent(W.structure,w.structure)||Re.is(W)&&Ye.areRootsEquivalent(W.structure,w.structure)&&Re.isWholeStructure(W))}(W)?K(xe.ofBounds(0,A.instanceGranularity?M.instanceCount:M.groupCount*M.instanceCount)):A.instanceGranularity?function G(W,K,ne){var X=!1;if(Ht.isLoci(W)){var Y=K.group;if(!Ye.areEquivalent(W.structure,K.structure))return!1;for(var $=0,Z=W.bonds;$<Z.length;$++){var q=Z[$];q.aUnit===q.bUnit&&void 0!==(z=Y.unitIndexMap.get(q.aUnit.id))&&ne(xe.ofSingleton(z))&&(X=!0)}}else if(Re.is(W)){if(Y=K.group,!Ye.areEquivalent(W.structure,K.structure))return!1;for(var te=0,ae=W.elements;te<ae.length;te++){var z;void 0!==(z=Y.unitIndexMap.get(ae[te].unit.id))&&ne(xe.ofSingleton(z))&&(X=!0)}}return X}(W,w,K):o(W,w,K,ne)}function Q(W){b&&c?.(b.values,E,A,T,W.webgl)}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?b:void 0},get geometryVersion(){return I},createOrUpdate:function(W,K,ne,X){if(function N(W,K,ne){if(!ne&&!w)throw new Error("missing structureGroup");if(_=K,C=W,x=ne,df.reset(g),!b||!w)return g.createNew=!0,void(g.createGeometry=!0);s(g,_,A,C,T,x,w),Ye.areHierarchiesEqual(w.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),Nu.areEqual(C.color,T.color)||(g.updateColor=!0),w.structure.child!==x.structure.child&&(g.createGeometry=!0),_.instanceGranularity!==A.instanceGranularity&&(g.updateTransform=!0),Nd(_.unitKinds,A.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==w.group.transformHash&&(x.group.units.length!==w.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var X=x.group.units[0],L=w.group.units[0];Oe.areOperatorsEqual(X,L)||(g.updateTransform=!0),Oe.areConformationsEqual(X,L)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in b.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(w.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(C.color.granularity.startsWith("vertex")||b.values.dColorType.ref.value.startsWith("vertex")||C.color.granularity.startsWith("volume")||b.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}(K,ne,X||w),g.createGeometry){var L=function k(W,K,ne,X,L,Y){return function krt(e,t){for(var r=0,n=e.length;r<n;++r)if(Oe.isAtomic(t)&&"atomic"===e[r]||Oe.isSpheres(t)&&"spheres"===e[r]||Oe.isGaussians(t)&&"gaussians"===e[r])return!0;return!1}(L.unitKinds,K)?n(W,K,ne,X,L,Y):f(Y)}(W,x.group.units[0],x.structure,C,_,E);if(WA(L))return L.then(function(Y){j(Y),Q(W)});j(L)}else j();Q(W)},getLoci:function(W){return b?i(W,w,b.id):Yr},eachLocation:function(W){for(M.reset();M.hasNext;){var K=M.move();W(K.location,K.isSecondary)}},mark:function(W,K){var ne=!0;if(Re.is(W)){ne=!1;for(var X=w.group.units[0].invariantId,L=0,Y=W.elements;L<Y.length;L++)if(Y[L].unit.invariantId===X){ne=!0;break}}return!!ne&&_r.mark(b,W,K,U,y)},setVisibility:function(W){_r.setVisibility(b,W)},setAlphaFactor:function(W){_r.setAlphaFactor(b,W)},setPickable:function(W){_r.setPickable(b,W)},setColorOnly:function(W){_r.setColorOnly(b,W)},setTransform:function(W,K){_r.setTransform(b,W,K)},setOverpaint:function(W,K){_r.setOverpaint(b,W,U,!0,{geometry:E,props:A,webgl:K})},setTransparency:function(W,K){_r.setTransparency(b,W,U,!0,{geometry:E,props:A,webgl:K})},setSubstance:function(W,K){_r.setSubstance(b,W,U,!0,{geometry:E,props:A,webgl:K})},setClipping:function(W){_r.setClipping(b,W,U,!0)},setThemeStrength:function(W){_r.setThemeStrength(b,W)},destroy:function(){l?.(E),b&&(b.state.disposed=!0,b=void 0)},mustRecreate:u}}var po=R(R({},nse),pu);function Xo(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Lt.Utils}),t)}var J5=R(R({},ase),pu);function e6(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ol.Utils}),t)}var t6=R(R({},ise),pu);function r6(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ou.Utils}),t)}var rnt=R(R({},zrt),pu),JE=R(R({},ose),pu);function eI(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ca.Utils}),t)}R(R({},sse),pu);var DC,ant=R(R({},use),pu),ont=R(R({},cse),pu),ho={create:function(){return R(R({},dr.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){dr.updateState(e,t),void 0!==t.unitTransforms&&(e.unitTransforms=t.unitTransforms)}},Jp=S(),AC=S(),TC=S(),n6=qe.add,lse=qe.add3;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=qe.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),c=qe.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),l=function(f,p,h,m,v,g,y,b,_,C){for(var x=0;x<6;++x)lse(o,f,p,h),lse(s,m,v,g),n6(i,C),n6(u,y),n6(c,(b?1:0)+(_?2:0))},d=function(f,p,h,m,v,g,y,b){var _=S.distance(f,p),C=h%2!=0,x=Math.floor((h+1)/2),A=_/(h+.5);S.setMagnitude(TC,S.sub(TC,p,f),A),S.copy(Jp,f);for(var T=0;T<x;++T)S.add(Jp,Jp,TC),C&&T===x-1?(S.copy(AC,p),y||(g=!1)):S.add(AC,Jp,TC),l(Jp[0],Jp[1],Jp[2],AC[0],AC[1],AC[2],m,v,g,b),S.add(Jp,Jp,TC)};return{add:l,addFixedCountDashes:d,addFixedLengthDashes:function(f,p,h,m,v,g,y){var b=S.distance(f,p);d(f,p,b/h,m,v,g,!0,y)},getCylinders:function(){var f=i.elementCount/6,p=qe.compact(i,!0),h=qe.compact(o,!0),m=qe.compact(s,!0),v=qe.compact(u,!0),g=qe.compact(c,!0),y=a&&f<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(18*f),b=a&&f<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(12*f);return(!a||f>a.cylinderCount)&&function unt(e,t,r){for(var n=0;n<e;++n){var a=18*n;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(n=0;n<e;++n){var i=6*n,o=12*n;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}(f,y,b),ou.create(y,b,p,h,m,v,g,f,a)}}}}(DC||(DC={}));var Dg={linkScale:D.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:D.Numeric(1,{min:0,max:2,step:.01}),linkCap:D.Boolean(!1),aromaticScale:D.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:D.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:D.Numeric(2,{min:1,max:6,step:1}),dashCount:D.Numeric(4,{min:0,max:10,step:1}),dashScale:D.Numeric(.8,{min:0,max:2,step:.1}),dashCap:D.Boolean(!0),stubCap:D.Boolean(!0),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo)},dse=(D.getDefaultValues(Dg),{linkScale:D.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:D.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:D.Numeric(2,{min:1,max:6,step:1}),dashCount:D.Numeric(4,{min:0,max:10,step:1})}),kn=(D.getDefaultValues(dse),S()),Pm=S(),hl=S(),cnt=S.create(0,1,0);function a6(e,t,r,n){S.normalize(Pm,S.sub(Pm,t,r)),null!==n?S.sub(hl,t,n):S.copy(hl,t),S.normalize(hl,hl);var a=S.dot(Pm,hl);return 1-Math.abs(a)<1e-5&&(S.set(hl,1,0,0),a=S.dot(Pm,hl),1-Math.abs(a)<1e-5&&(S.set(hl,0,1,0),a=S.dot(Pm,hl))),S.setMagnitude(Pm,Pm,a),S.sub(hl,hl,Pm),S.normalize(e,hl)}var ad=S.scale,Ea=S.add,gi=S.sub,Ko=S.setMagnitude,lnt=S.dot;function Eg(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,c=t.ignore,l=t.stub;if(!a)return{mesh:Lt.createEmpty(n)};for(var d=r.linkScale,f=r.linkSpacing,p=r.radialSegments,h=r.linkCap,m=r.aromaticScale,v=r.aromaticSpacing,g=r.aromaticDashCount,y=r.dashCount,b=r.dashScale,_=r.dashCap,C=r.stubCap,x=2*p*a*2,A=ft.createState(x,x/4,n),T=S(),w=S(),E=S(),I=S(),M=0,F={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:h,bottomCap:h},N=0,j=a;N<j;++N)if(!c||!c(N)){o(T,w,N),Ea(I,I,T),Ea(I,I,w),M+=2,gi(kn,w,T);var k=lnt(kn,cnt)>0,H=u(N),G=s?s(N):0,U=C&&!!l&&l(N),Q=k?[U,h]:[h,U],W=Q[0],K=Q[1];if(A.currentGroup=N,0===G)F.radiusTop=F.radiusBottom=H,F.topCap=W,F.bottomCap=K,Hr(A,T,w,.5,F);else if(1===G)F.radiusTop=F.radiusBottom=H*b,F.topCap=F.bottomCap=_,US(A,T,w,.5,y,U,F);else if(2===G||3===G||4===G||5===G||7===G||8===G){var ne=2===G||3===G?2:4===G||5===G?3:1.5,X=H*(d/(.5*ne)),L=(H-X)*f;if(a6(E,T,w,i?i(N):null),F.topCap=W,F.bottomCap=K,7===G||8===G){F.radiusTop=F.radiusBottom=H,Hr(A,T,w,.5,F);var Y=H+m*H+m*H*v;Ko(kn,gi(kn,w,T),.5*H),Ea(T,T,kn),gi(w,w,kn),F.radiusTop=F.radiusBottom=H*m,F.topCap=F.bottomCap=_,Ko(E,E,Y),gi(T,T,E),gi(w,w,E),US(A,T,w,.5,g,U,F),8===G&&(Ko(E,E,2*Y),Ea(T,T,E),Ea(w,w,E),US(A,T,w,.5,g,U,F))}else if(3===G||5===G){var $=H+X+d*H*f;Ko(E,E,$),F.radiusTop=F.radiusBottom=H,Hr(A,T,w,.5,F),ad(kn,kn,f*d*.2),Ea(T,T,kn),gi(w,w,kn),F.radiusTop=F.radiusBottom=X,F.topCap=k?U:_,F.bottomCap=k?_:U,Ko(E,E,$),gi(T,T,E),gi(w,w,E),Hr(A,T,w,.5,F),3===ne&&(Ko(E,E,2*$),Ea(T,T,E),Ea(w,w,E),Hr(A,T,w,.5,F))}else Ko(E,E,L),F.radiusTop=F.radiusBottom=X,3===ne&&Hr(A,T,w,.5,F),iGe(A,T,w,.5,E,F)}else 6===G&&(ad(kn,kn,.475),Ea(T,T,kn),gi(w,w,kn),F.radiusTop=F.radiusBottom=H,F.topCap=W,F.bottomCap=K,Hr(A,T,w,.5,F))}var Z=n?De.clone(n.boundingSphere):void 0,q=ft.getMesh(A);return 0===M?{mesh:q}:(S.scale(I,I,1/M),Z&&S.distance(I,Z.center)/Z.radius<.1?{mesh:q,boundingSphere:Z}:{mesh:q})}function fse(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,c=t.ignore,l=t.stub;if(!a)return{cylinders:ou.createEmpty(n)};for(var d=r.linkScale,f=r.linkSpacing,p=r.linkCap,h=r.aromaticScale,m=r.aromaticSpacing,v=r.aromaticDashCount,g=r.dashCount,y=r.dashScale,b=r.dashCap,_=r.stubCap,C=2*a,x=DC.create(C,C/4,n),A=S(),T=S(),w=S(),E=S(),I=S(),M=0,F=0,N=a;F<N;++F)if(!c||!c(F)){o(A,T,F),Ea(I,I,A),Ea(I,I,T),M+=2;var j=u(F),k=s?s(F):0,H=_&&!!l&&l(F);if(0===k)ad(w,Ea(w,A,T),.5),x.add(A[0],A[1],A[2],w[0],w[1],w[2],1,p,H,F);else if(1===k)ad(w,Ea(w,A,T),.5),x.addFixedCountDashes(A,w,g,y,b,b,H,F);else if(2===k||3===k||4===k||5===k||7===k||8===k){var G=2===k||3===k?2:4===k||5===k?3:1.5,U=d/(.5*G),Q=(j-U*j)*f;if(ad(w,Ea(w,A,T),.5),a6(E,A,T,i?i(F):null),7===k||8===k){x.add(A[0],A[1],A[2],w[0],w[1],w[2],1,p,H,F);var W=j+h*j+h*j*m;Ko(kn,gi(kn,T,A),.5*j),Ea(A,A,kn),Ko(E,E,W),gi(A,A,E),gi(w,w,E),x.addFixedCountDashes(A,w,v,h,b,b,H,F),8===k&&(Ko(E,E,2*W),Ea(A,A,E),Ea(w,w,E),x.addFixedCountDashes(A,w,v,h,b,b,H,F))}else 3===k||5===k?(Ko(E,E,j+U*j+d*j*f),x.add(A[0],A[1],A[2],w[0],w[1],w[2],1,p,H,F),Ko(kn,gi(kn,A,w),j/1.5),gi(A,A,kn),3===G&&x.add(A[0]+E[0],A[1]+E[1],A[2]+E[2],w[0]+E[0],w[1]+E[1],w[2]+E[2],U,p,H,F),x.add(A[0]-E[0],A[1]-E[1],A[2]-E[2],w[0]-E[0],w[1]-E[1],w[2]-E[2],U,b,H,F)):(Ko(E,E,Q),3===G&&x.add(A[0],A[1],A[2],w[0],w[1],w[2],U,p,H,F),x.add(A[0]+E[0],A[1]+E[1],A[2]+E[2],w[0]+E[0],w[1]+E[1],w[2]+E[2],U,p,H,F),x.add(A[0]-E[0],A[1]-E[1],A[2]-E[2],w[0]-E[0],w[1]-E[1],w[2]-E[2],U,p,H,F))}else 6===k&&(ad(kn,gi(kn,w,A),.475),Ea(A,A,kn),gi(w,w,kn),x.add(A[0],A[1],A[2],w[0],w[1],w[2],1,p,H,F))}var ne=n?De.clone(n.boundingSphere):void 0,X=x.getCylinders();return 0===M?{cylinders:X}:(S.scale(I,I,1/M),ne&&S.distance(I,ne.center)/ne.radius<.1?{cylinders:X,boundingSphere:ne}:{cylinders:X})}function pse(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return{lines:ca.createEmpty(n)};for(var c=r.linkScale,l=r.linkSpacing,d=r.aromaticDashCount,f=r.dashCount,p=2*a,h=Ru.create(p,p/4,n),m=S(),v=S(),g=S(),y=S(),b=S(),_=0,A=0,T=a;A<T;++A)if(!u||!u(A)){o(m,v,A),Ea(b,b,m),Ea(b,b,v),_+=2;var w=s?s(A):0;if(0===w)ad(g,Ea(g,m,v),.5),h.add(m[0],m[1],m[2],g[0],g[1],g[2],A);else if(1===w)ad(g,Ea(g,m,v),.5),h.addFixedCountDashes(m,g,f,A);else if(2===w||3===w||4===w||5===w||7===w||8===w){var E=2===w||3===w?2:4===w||5===w?3:1.5,M=(1-c/(.5*E)*1)*l;if(ad(g,Ea(g,m,v),.5),a6(y,m,v,i?i(A):null),7===w||8===w){h.add(m[0],m[1],m[2],g[0],g[1],g[2],A);var F=4.5*M;Ko(kn,gi(kn,v,m),.5*F),Ea(m,m,kn),Ko(y,y,F),gi(m,m,y),gi(g,g,y),h.addFixedCountDashes(m,g,d,A),8===w&&(Ko(y,y,2*F),Ea(m,m,y),Ea(g,g,y),h.addFixedCountDashes(m,g,d,A))}else 3===w||5===w?(Ko(y,y,3*M),h.add(m[0],m[1],m[2],g[0],g[1],g[2],A),ad(kn,gi(kn,m,g),l*c),gi(m,m,kn),3===E&&h.add(m[0]+y[0],m[1]+y[1],m[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],A),h.add(m[0]-y[0],m[1]-y[1],m[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],A)):(Ko(y,y,1.5*M),3===E&&h.add(m[0],m[1],m[2],g[0],g[1],g[2],A),h.add(m[0]+y[0],m[1]+y[1],m[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],A),h.add(m[0]-y[0],m[1]-y[1],m[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],A))}else 6===w&&(ad(kn,gi(kn,g,m),.475),Ea(m,m,kn),gi(g,g,kn),h.add(m[0],m[1],m[2],g[0],g[1],g[2],A))}var N=n?De.clone(n.boundingSphere):void 0,j=h.getLines();return 0===_?{lines:j}:(S.scale(b,b,1/_),N&&S.distance(b,N.center)/N.radius<.1?{lines:j,boundingSphere:N}:{lines:j})}var hse={sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),dashCount:D.Numeric(6,{min:1,max:10,step:1}),dashScale:D.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),includeParent:D.Boolean(!1),parentDisplay:D.Select("stub",D.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};function dnt(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j,H,G,U,Q;return le(this,function(W){return Oe.isAtomic(t)?(o=r.child,s=o?.unitMap.get(t.id),o&&!s?[2,Lt.createEmpty(i)]:(u=at.create(r,t),c=Ka.get(r).value,l=c.unitsFeatures.get(t.id),d=c.unitsContacts.get(t.id),f=l.x,p=l.y,h=l.z,m=l.members,v=l.offsets,y=d.a,b=d.b,C=(_=d.edgeProps).flag,x=_.type,A=a.sizeFactor,T=a.ignoreHydrogens,w=a.ignoreHydrogensVariant,E=a.parentDisplay,(g=d.edgeCount)?(I=t.conformation.invariantPosition,M=t.elements,F=S(),N=S(),j=S(),H=Eg(0,{linkCount:2*g,position:function(K,ne,X){var L=x[X];if(T&&"all"===w||L!==Or.HydrogenBond&&L!==Or.WeakHydrogenBond)S.set(K,f[y[X]],p[y[X]],h[y[X]]),S.set(ne,f[b[X]],p[b[X]],h[b[X]]);else{var Y=m[v[y[X]]],$=m[v[b[X]]];I(M[Y],N),I(M[$],j);var Z=S.distance(N,j),q=Z;S.copy(K,N),S.copy(ne,j),R5(t,Y,function(z,te){if(nd(r,t,M[te],"polar")){I(M[te],F);var ae=S.distance(F,j);ae<Z&&(Z=ae,S.copy(K,F))}}),R5(t,$,function(z,te){if(nd(r,t,M[te],"polar")){I(M[te],F);var ae=S.distance(F,N);ae<q&&(q=ae,S.copy(ne,F))}})}},style:function(K){return 1},radius:function(K){u.element=M[m[v[y[K]]]];var ne=n.size.size(u);u.element=M[m[v[b[K]]]];var X=n.size.size(u);return Math.min(ne,X)*A},ignore:function(K){if(C[K]===yf.Filtered)return!0;if(s)if("stub"===E){for(var ne=y[K],X=v[ne],L=v[ne+1];X<L;++X)if(!Xe.has(s.elements,M[m[v[X]]]))return!0}else{if("full"===E||"between"===E){var $=!1,Z=!1,q=y[K];for(X=v[q],L=v[q+1];X<L;++X)Xe.has(s.elements,M[m[v[X]]])||($=!0);var te=b[K];for(X=v[te],L=v[te+1];X<L;++X)Xe.has(s.elements,M[m[v[X]]])||(Z=!0);return"full"===E?$&&Z:$===Z}xn()}return!1}},a,i),G=H.mesh,(U=H.boundingSphere)?G.setBoundingSphere(U):G.triangleCount>0&&(Q=De.expand(De(),(s??t).boundary.sphere,1*A),G.setBoundingSphere(Q)),[2,G]):[2,Lt.createEmpty(i)])):[2,Lt.createEmpty(i)]})})}var mse=R(R(R({},po),Dg),hse);function fnt(e){return Xo({defaultProps:D.getDefaultValues(mse),createGeometry:dnt,createLocationIterator:mnt,getLoci:pnt,eachLocation:hnt,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;var u=Ka.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function pnt(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=o.unitMap.get(t.group.units[e.instanceId].id),c=Ka.get(o).value,l=c.unitsContacts.get(u.id),d=l.a,f=l.b;return Qp.Loci(o,c,[{unitA:u,indexA:d[i],unitB:u,indexB:f[i]},{unitA:u,indexA:f[i],unitB:u,indexB:d[i]}])}return Yr}var i6=new Set;function hnt(e,t,r,n){var a=!1;if(Qp.isLoci(e)){var o=t.group;if(!Ye.areEquivalent(e.data.structure,i=t.structure))return!1;var s=Ka.get(i).value;if(e.data.interactions!==s)return!1;for(var c=s.unitsContacts.get((u=o.units[0]).id),l=2*c.edgeCount,d=0,f=e.elements;d<f.length;d++)if((p=f[d]).unitA===p.unitB){var h=o.unitIndexMap.get(p.unitA.id);if(void 0!==h){var m=c.getDirectedEdgeIndex(p.indexA,p.indexB);-1!==m&&r(xe.ofSingleton(h*l+m))&&(a=!0)}}}else if(Re.is(e)){var i;if(o=t.group,!Ye.areEquivalent(e.structure,i=t.structure))return!1;if(!(s=Ka.get(i).value))return!1;for(var u,v=s.unitsContacts.get((u=o.units[0]).id),g=s.unitsFeatures.get(u.id),y=2*v.edgeCount,b=v.offset,_=g.elementsIndex,C=_.offsets,x=_.indices,A=g.members,T=g.offsets,w=function(k){var H=o.unitIndexMap.get(k.unit.id);if(void 0===H)return"continue";Be.forEach(k.indices,function(G){for(var U=C[G],Q=C[G+1];U<Q;++U)for(var W=x[U],K=b[W],ne=b[W+1];K<ne;++K)i6.add(K)}),i6.forEach(function(G){if(n){for(var U=v.a[G],Q=T[U],W=T[U+1];Q<W;++Q)if(!Be.has(k.indices,A[Q]))return;var K=v.b[G];for(Q=T[K],W=T[K+1];Q<W;++Q)if(!Be.has(k.indices,A[Q]))return}r(xe.ofSingleton(H*y+G))&&(a=!0)}),i6.clear()},E=0,I=e.elements;E<I.length;E++){var p;w(p=I[E])}}return a}function mnt(e){var t=e.structure,r=e.group,n=r.units[0],a=Ka.get(t).value,i=a.unitsContacts.get(n.id),o=2*i.edgeCount,s=r.units.length,u=Qp.Location(a,t),c=u.element;return Ln(o,s,1,function(d,f){var p=r.units[f];return c.unitA=p,c.indexA=i.a[d],c.unitB=p,c.indexB=i.b[d],u})}function vnt(e,t,r,n,a){if(!t.hasAtomic)return Lt.createEmpty(a);var i=at.create(t),o=Ka.get(t).value,s=o.contacts,u=o.unitsFeatures,c=s.edgeCount,l=s.edges,d=n.sizeFactor,f=n.ignoreHydrogens,p=n.ignoreHydrogensVariant,h=n.parentDisplay;if(!c)return Lt.createEmpty(a);var m=t.child,v=S(),g=S(),y=S(),_=Eg(0,{linkCount:c,position:function(w,E,I){var M=l[I],F=M.unitA,N=M.indexA,j=M.unitB,k=M.indexB,H=M.props.type,G=u.get(F),U=u.get(j),Q=t.unitMap.get(F),W=t.unitMap.get(j);if(f&&"all"===p||H!==Or.HydrogenBond&&H!==Or.WeakHydrogenBond)S.set(w,G.x[N],G.y[N],G.z[N]),S.transformMat4(w,w,Q.conformation.operator.matrix),S.set(E,U.x[k],U.y[k],U.z[k]),S.transformMat4(E,E,W.conformation.operator.matrix);else{var K=G.members[G.offsets[N]],ne=U.members[U.offsets[k]];Q.conformation.position(Q.elements[K],g),W.conformation.position(W.elements[ne],y);var X=S.distance(g,y),L=X;S.copy(w,g),S.copy(E,y),fu(t,Q,K,function(Y,$){var Z=Y.elements[$];if(nd(t,Y,Z,"polar")){Y.conformation.position(Z,v);var q=S.distance(v,y);q<X&&(X=q,S.copy(w,v))}}),fu(t,W,ne,function(Y,$){var Z=Y.elements[$];if(nd(t,Y,Z,"polar")){Y.conformation.position(Z,v);var q=S.distance(v,g);q<L&&(L=q,S.copy(E,v))}})}},style:function(w){return 1},radius:function(w){var E=l[w],I=u.get(E.unitA);i.unit=t.unitMap.get(E.unitA),i.element=i.unit.elements[I.members[I.offsets[E.indexA]]];var M=r.size.size(i),F=u.get(E.unitB);i.unit=t.unitMap.get(E.unitB),i.element=i.unit.elements[F.members[F.offsets[E.indexB]]];var N=r.size.size(i);return Math.min(M,N)*d},ignore:function(w){if(l[w].props.flag===yf.Filtered)return!0;if(m){var E=l[w];if("stub"===h){if(!(I=m.unitMap.get(E.unitA)))return!0;for(var M=t.unitMap.get(E.unitA),F=u.get(E.unitA),j=F.members,k=(N=F.offsets)[E.indexA],H=N[E.indexA+1];k<H;++k)if(!Xe.has(I.elements,M.elements[j[k]]))return!0}else{if("full"===h||"between"===h){var I,U=!1,Q=!1;if(I=m.unitMap.get(E.unitA)){M=t.unitMap.get(E.unitA);var W=u.get(E.unitA);for(j=W.members,k=(N=W.offsets)[E.indexA],H=N[E.indexA+1];k<H;++k)Xe.has(I.elements,M.elements[j[k]])||(U=!0)}else U=!0;var K=m.unitMap.get(E.unitB);if(K){var N,ne=t.unitMap.get(E.unitB),X=u.get(E.unitB);for(j=X.members,k=(N=X.offsets)[E.indexB],H=N[E.indexB+1];k<H;++k)Xe.has(K.elements,ne.elements[j[k]])||(Q=!0)}else Q=!0;return"full"===h?U&&Q:U===Q}xn()}}return!1}},n,a),C=_.mesh,x=_.boundingSphere;if(x)C.setBoundingSphere(x);else if(C.triangleCount>0){var A=t.child,T=De.expand(De(),(A??t).boundary.sphere,1*d);C.setBoundingSphere(T)}return C}var vse=R(R(R({},Bb),Dg),hse);function gnt(e){return $p({defaultProps:D.getDefaultValues(vse),createGeometry:vnt,createLocationIterator:_nt,getLoci:ynt,eachLocation:bnt,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;var u=Ka.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function ynt(e,t,r){var a=e.groupId;if(r===e.objectId){var i=Ka.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Qp.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return Yr}var tI=new Map,o6=new Set;function bnt(e,t,r,n){var a=!1;if(Qp.isLoci(e)){if(!Ye.areEquivalent(e.data.structure,t))return!1;var i=Ka.get(t).value;if(e.data.interactions!==i)return!1;for(var o=i.contacts,s=0,u=e.elements;s<u.length;s++){var c=u[s],l=o.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);-1!==l&&r(xe.ofSingleton(l))&&(a=!0)}}else if(Re.is(e)){if(!Ye.areEquivalent(e.structure,t)||n&&1===e.elements.length)return!1;if(!(i=Ka.get(t).value))return!1;for(var d=i.contacts,f=i.unitsFeatures,p=0,h=e.elements;p<h.length;p++)tI.set((m=h[p]).unit.id,m.indices);for(var v=function(_){var C=_.unit;if(!Oe.isAtomic(C))return"continue";Be.forEach(_.indices,function(x){for(var A=0,T=d.getContactIndicesForElement(x,C);A<T.length;A++)o6.add(T[A])})},g=0,y=e.elements;g<y.length;g++){var m;v(m=y[g])}o6.forEach(function(_){if(n){var C=d.edges[_],x=C.indexA,A=C.unitA,T=C.indexB,w=C.unitB,E=tI.get(A),I=tI.get(w);if(!E||!I)return;for(var M=f.get(A),F=M.offsets,N=M.members,j=F[x],k=F[x+1];j<k;++j)if(!Be.has(E,N[j]))return;var H=f.get(w),G=H.offsets,U=H.members;for(j=G[T],k=G[T+1];j<k;++j)if(!Be.has(I,U[j]))return}r(xe.ofSingleton(_))&&(a=!0)}),tI.clear(),o6.clear()}return a}function _nt(e){var t=Ka.get(e).value,r=t.contacts,n=r.edgeCount,i=Qp.Location(t,e),o=i.element;return Ln(n,1,1,function(u){var c=r.edges[u];return o.unitA=e.unitMap.get(c.unitA),o.indexA=c.indexA,o.unitB=e.unitMap.get(c.unitB),o.indexB=c.indexB,i},!0)}var eh,gse={"intra-unit":function(e,t){return va("Intra-unit interactions cylinder",e,t,fnt)},"inter-unit":function(e,t){return Sc("Inter-unit interactions cylinder",e,t,gnt)}},yse=R(R(R({},mse),vse),{unitKinds:wC(["atomic"]),sizeFactor:D.Numeric(.2,{min:.01,max:1,step:.01}),visuals:D.MultiSelect(["intra-unit","inter-unit"],D.objectToOptions(gse))}),rI={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:function Cnt(e,t){return dr.createMulti("Interactions",e,t,ho,gse)},getParams:function Snt(e,t){return D.clone(yse)},defaultValues:D.getDefaultValues(yse),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Ka.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Ka.attach(e,t,void 0,!0)},detach:function(e){return Ka.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},xnt=nn.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=Ka,r.labelProvider={label:function(n){if(r.params.showTooltip&&"element-loci"===n.kind){if(0===n.elements.length)return;for(var a=[],o=0,s=r.getStructures(n.structure);o<s.length;o++){var u=s[o],c=r.provider.get(u).value;if(c){var l=Re.remap(n,u);if(1===l.elements.length){var d=l.elements[0];if(1===Be.size(d.indices)){var f=c.unitsFeatures.get(d.unit.id);if(f){for(var p=[],h=[],m=[],v=Be.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,_=b.indices,C=b.offsets,x=C[v],A=C[v+1];x<A;++x){var T=_[x],w=g[T],E=y[T];w&&p.push(Ret(w)),E&&h.push(Oet(E))}p.length&&m.push("<small>Types</small> ".concat(p.join(", "))),h.length&&m.push("<small>Groups</small> ".concat(h.join(", "))),m.length&&a.push("Interaction Feature: ".concat(m.join(" | ")))}}}}}return a.length?a.join("<br/>"):void 0}}},r}return qt(t,e),t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var s=0,u=this.ctx.state.data.select(wr.Generators.ofType(ve.Molecule.Structure,a.transform.ref));s<u.length;s++){var c=u[s];c.obj&&$a(n,c.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Q5),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(rI)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Q5),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(rI)},t}(nn.Handler),params:function(){return{autoAttach:D.Boolean(!1),showTooltip:D.Boolean(!0)}}}),wnt=nn.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=Hc,r}return qt(t,e),t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(nn.Handler),params:function(){return{autoAttach:D.Boolean(!1)}}}),Ant=nn.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=SC,r.labelProvider={label:function(n){if(r.params.showTooltip&&"element-loci"===n.kind){if(0===n.elements.length)return;for(var a=[],o=0,s=r.getStructures(n.structure);o<s.length;o++){var u=s[o],c=r.provider.get(u).value;if(c){var l=Re.remap(n,u);if(1===l.elements.length){var d=l.elements[0];if(1===Be.size(d.indices)){var f=c.get(d.unit.id);if(f){var p=Be.start(d.indices),m=f.idealGeometry[p],v=f.implicitH[p],g=f.totalH[p];a.push("Valence Model: <small>Charge</small> ".concat(f.charge[p]," | <small>Ideal Geometry</small> ").concat(wet(m)," | <small>Implicit H</small> ").concat(v," | <small>Total H</small> ").concat(g))}}}}}return a.length?a.join("<br/>"):void 0}}},r}return qt(t,e),t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var s=0,u=this.ctx.state.data.select(wr.Generators.ofType(ve.Molecule.Structure,a.transform.ref));s<u.length;s++){var c=u[s];c.obj&&$a(n,c.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(nn.Handler),params:function(){return{autoAttach:D.Boolean(!1),showTooltip:D.Boolean(!0)}}}),s6=dt(16448250),EC=new Map,bse=R({},Es({type:"colors",colorList:"set-1"})),Sse={name:"sifts-mapping",label:"SIFTS Mapping",category:Nu.Category.Residue,factory:function _se(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var o=qd.Provider.get(a[n]).value;if(o)for(var s=0,u=o.accession;s<u.length;s++){var c=u[s];!c||EC.has(c)||EC.set(c,EC.size)}}var l=at.create(e.structure),d=uu(EC.size+1,t,{valueLabel:function(h){return"".concat(h)}}),f=new Map,p=function(h){var m=qd.getKey(h);if(!m)return s6;if(f.has(m))return f.get(m);var v=d.color(EC.get(m));return f.set(m,v),v};r=function(h){return at.is(h)&&Oe.isAtomic(h.unit)?p(h):Ht.isLocation(h)?(l.unit=h.aUnit,l.element=h.aUnit.elements[h.aIndex],p(l)):s6}}else r=function(){return s6};return{factory:_se,granularity:"group",preferSmoothing:!0,color:r,props:t,description:"Assigns a color based on SIFTS mapping."}},getParams:function Dnt(e){return bse},defaultValues:D.getDefaultValues(bse),isApplicable:function(e){var t;return!(null===(t=e.structure)||void 0===t||!t.models.some(function(r){return qd.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return le(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?[4,qd.Provider.attach(e,n[r],void 0,!0)]:[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(e.structure)for(var t=0,r=e.structure.models;t<r.length;t++)qd.Provider.ref(r[t],!1)}}},Ent=nn.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=qd.Provider,r.labelProvider={label:function(n){if(r.params.showTooltip)return function Int(e){if("element-loci"===e.kind){if(0===e.elements.length)return;var t=e.elements[0],r=t.unit,n=at.create(e.structure,r,r.elements[Be.getAt(t.indices,0)]);return qd.getLabel(n)}}(n)}},r}return qt(t,e),t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Sse),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Sse),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(nn.Handler),params:function(){return{autoAttach:D.Boolean(!0),showTooltip:D.Boolean(!0)}}});!function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=jl.create(e.Descriptor),e.fromTable=function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(h,m,v){var g=h.get(m);g?g.push(v):h.set(m,[v])}function s(h,m){var v=m.entity_id.value(h),g=m.asym_id.value(h),y=m.seq_id.value(h);if("by-atom"===r.model_granularity.value(h)){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:m.atom_id.value(h),label_entity_id:v});b>=0&&o(c,b,h)}else if(n.coarseHierarchy.isDefined){var _=n.coarseHierarchy.spheres.findSequenceKey(v,g,y);if(_>=0)o(l,_,h);else{var C=n.coarseHierarchy.gaussians.findSequenceKey(v,g,y);C>=0&&o(d,C,h)}}}for(var c=new Map,l=new Map,d=new Map,f=[],p=0;p<r._rowCount;++p)s(p,a),s(p,i);return{getIndicesByElement:function(h,m){var v=function u(h){switch(h){case 0:return c;case 1:return l;case 2:return d}}(m),g=v.get(h);return void 0!==g?g:f},data:r}}}(eh||(eh={}));var Pnt=[];function Cse(e,t,r,n){return"".concat(e,"|").concat(t.id,"|").concat(r,"|").concat(n.id)}var id,xse=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=Cse(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=Cse(t,r,n,a);return this.pairKeyIndices.get(i)||Pnt},e.prototype.getPairs=function(t,r,n,a){var i=this;return this.getPairIndices(t,r,n,a).map(function(s){return i.pairs[s]})},e}(),th=pp.createProvider({label:"Cross Link Restraint",descriptor:ec({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!eh.Provider.get(t)})},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){return le(this,function(n){return[2,{value:Ont(t)}]})})}});function wse(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){r.getIndicesByElement(n[u],i).forEach(function(l){return e.set(l,u)})},s=0;s<a;s++)o(s)}function Mnt(e,t,r){if(t.model===r.model&&"mmCIF"===t.model.sourceData.kind){var n=eh.Provider.get(t.model);if(n){var a=new Map,i=new Map;wse(a,t,n),wse(i,r,n),a.forEach(function(o,s){var u=i.get(s);void 0!==u&&e.push(nI(t,o,r,u,n,s),nI(r,u,t,o,n,s))})}}}function Rnt(e,t){if("mmCIF"===t.model.sourceData.kind){var r=eh.Provider.get(t.model);if(r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(c){r.getIndicesByElement(n[c],i).forEach(function(d){var f=o.get(d);f?f.push(c):o.set(d,[c])})},u=0;u<a;u++)s(u);o.forEach(function(c,l){if(!(c.length<2)){var d=c[0],f=c[1];e.push(nI(t,d,t,f,r,l),nI(t,f,t,d,r,l))}})}}}function nI(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function Ont(e){var t=[];if(!e.models.some(function(s){return eh.Provider.get(s)}))return new xse(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];Rnt(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&Mnt(t,a,o)}}return new xse(t)}function Fnt(e,t,r,n,a){var i=th.get(t).value;if(!i.count)return Lt.createEmpty(a);var o=n.sizeFactor,s=at.create(t),c=Eg(0,{linkCount:i.count,position:function(p,h,m){var v=i.pairs[m],g=v.unitA,y=v.unitB;g.conformation.position(g.elements[v.indexA],p),y.conformation.position(y.elements[v.indexB],h)},radius:function(p){var h=i.pairs[p];return s.unit=h.unitA,s.element=h.unitA.elements[h.indexA],r.size.size(s)*o}},n,a),l=c.mesh,d=c.boundingSphere;if(d)l.setBoundingSphere(d);else if(l.triangleCount>0){var f=De.expand(De(),t.boundary.sphere,1*o);l.setBoundingSphere(f)}return l}!function(e){(e.Tag||(e.Tag={})).CrossLinkRestraint="cross-link-restraint",e.isApplicable=function r(m){return m.models.some(function(v){return!!eh.Provider.get(v)})};var n=S(),a=S();function i(m){return m.unitA.conformation.position(m.unitA.elements[m.indexA],n),m.unitB.conformation.position(m.unitB.elements[m.indexB],a),S.distance(n,a)}function c(m,v){var g=m.pairs[v];return"Cross Link Restraint | Type: ".concat(g.restraintType," | Threshold: ").concat(g.distanceThreshold," \u212b | Psi: ").concat(g.psi," | Sigma 1: ").concat(g.sigma1," | Sigma 2: ").concat(g.sigma2," | Distance: ").concat(i(g).toFixed(2)," \u212b")}function p(m,v,g){return Fv.fromPairProvider(v.length,function(y,b,_){var C=m.pairs[v[y]];C.unitA.conformation.position(C.unitA.elements[C.indexA],b),C.unitB.conformation.position(C.unitB.elements[C.indexB],_)},g)}function h(m,v,g){var y=g[0];if(void 0===y)return"";var b=v.pairs[y];return[c(v,y),KL(Ht.Location(m,b.unitA,b.indexA,m,b.unitB,b.indexB))].join("</br>")}e.distance=i,e.Location=function o(m,v,g){return VJ("cross-link-restraints",{structure:v,crossLinkRestraints:m},g)},e.isLocation=function s(m){return!!m&&"data-location"===m.kind&&"cross-link-restraints"===m.tag},e.areLocationsEqual=function u(m,v){return m.data.structure===v.data.structure&&m.data.crossLinkRestraints===v.data.crossLinkRestraints&&m.element===v.element},e.locationLabel=function l(m){return c(m.data.crossLinkRestraints,m.element)},e.Loci=function d(m,v,g){return pE("cross-link-restraints",{structure:m,crossLinkRestraints:v},g,function(y){return p(v,g,y)},function(){return h(m,v,g)})},e.isLoci=function f(m){return!!m&&"data-loci"===m.kind&&"interactions"===m.tag},e.getBoundingSphere=p,e.getLabel=h}(id||(id={}));var Ase=R(R(R({},Bb),Dg),{sizeFactor:D.Numeric(.5,{min:0,max:10,step:.1})});function Nnt(e){return $p({defaultProps:D.getDefaultValues(Ase),createGeometry:Fnt,createLocationIterator:knt,getLoci:Bnt,eachLocation:Lnt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function knt(e){var t=th.get(e).value,n=t.pairs.length,i=id.Location(t,e);return Ln(n,1,1,function(s){return i.element=s,i},!0)}function Bnt(e,t,r){var a=e.groupId;if(r===e.objectId){var i=th.get(t).value;if(i.pairs[a])return id.Loci(t,i,[a])}return Yr}function Lnt(e,t,r){var n=!1;if(id.isLoci(e)){if(!Ye.areEquivalent(e.data.structure,t))return!1;var a=th.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++)r(xe.ofSingleton(o[i]))&&(n=!0)}return n}var Unt={"cross-link-restraint":function(e,t){return Sc("Cross-link restraint",e,t,Nnt)}},Tse=R({},Ase),Dse={name:id.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:function znt(e,t){return dr.createMulti("CrossLinkRestraint",e,t,ho,Unt)},getParams:function Vnt(e,t){return D.clone(Tse)},defaultValues:D.getDefaultValues(Tse),defaultColorTheme:{name:id.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return id.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return th.attach(e,t,void 0,!0)},detach:function(e){return th.ref(e,!1)}}},Ese=dt(13421772),Ise={domain:D.Interval([.5,1.5],{step:.01}),list:D.ColorList("red-grey",{presetKind:"scale"})},Mse={name:"cross-link",label:"Cross Link",category:Nu.Category.Misc,factory:function Pse(e,t){var r,n=void 0,a=e.structure&&th.get(e.structure).value;if(a){var i=(n=Bc.create({domain:t.domain,listOrName:t.list.colors})).color;r=function(o){if(id.isLocation(o)){var s=a.pairs[o.element];if(s)return i(id.distance(s)/s.distanceThreshold)}return Ese}}else r=function(){return Ese};return{factory:Pse,granularity:"group",color:r,props:t,description:"Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",legend:n?n.legend:void 0}},getParams:function Hnt(e){return Ise},defaultValues:D.getDefaultValues(Ise),isApplicable:function(e){return!!e.structure&&id.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?th.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&th.ref(e.structure,!1)}}},jnt=nn.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=eh.Provider,r}return qt(t,e),t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",qnt),this.ctx.representation.structure.themes.colorThemeRegistry.add(Mse),this.ctx.representation.structure.registry.add(Dse)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Mse),this.ctx.representation.structure.registry.remove(Dse)},t}(nn.Handler)});function qnt(e){if(Pn.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(0!==t._rowCount)return eh.fromTable(t,e)}}var aI={State:eP,Representation:tP,Camera:rP,Misc:nP},Lu={Representation:aP,Camera:iP,CustomProps:oP};function iI(e,t,r){return void 0===r&&(r={}),"string"==typeof r.type||"string"==typeof r.color||"string"==typeof r.size?function Wnt(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return Ose(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}(e,t||Ye.Empty,r):Ose(e,t||Ye.Empty,r)}function u6(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),c=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),l=D.getDefaultValues(c.getParams({structure:t||Ye.Empty}));return c.name===u.defaultColorTheme.name&&Object.assign(l,u.defaultColorTheme.props),{name:c.name,params:Object.assign(l,a)}}function Rse(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),c=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),l=D.getDefaultValues(c.getParams({structure:t||Ye.Empty}));return c.name===u.defaultSizeTheme.name&&Object.assign(l,u.defaultSizeTheme.props),{name:c.name,params:Object.assign(l,a)}}function Ose(e,t,r){void 0===r&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=D.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=D.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);var l=Object.assign(c,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=D.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:l},sizeTheme:{name:d.name,params:p}}}var Fse=["target","surroundings","interactions"],ra=function(e){return e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr",e}(ra||{}),Xnt=new Set([ra.TargetSel,ra.TargetRepr,ra.SurrSel,ra.SurrRepr,ra.SurrNciRepr]),Knt=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return qt(t,e),Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings (".concat(this.params.expandRadius," \xc5)")},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return R(R({},r),{type:{name:r.type.name,params:R(R({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=wr.findUniqueTagsInSubtree(i,r.transform.ref,Xnt);s[ra.TargetSel]||(s[ra.TargetSel]=o.to(r).apply(et.Model.StructureSelectionFromBundle,{bundle:en.Empty,label:"[Focus] Target"},{tags:ra.TargetSel}).ref),s[ra.SurrSel]||(s[ra.SurrSel]=o.to(r).apply(et.Model.StructureSelectionFromExpression,{expression:de.struct.generator.empty(),label:this.surrLabel},{tags:ra.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[ra.TargetRepr]&&(s[ra.TargetRepr]=o.to(s[ra.TargetSel]).apply(et.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:ra.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[ra.SurrRepr]&&(s[ra.SurrRepr]=o.to(s[ra.SurrSel]).apply(et.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:ra.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[ra.SurrNciRepr]&&r.obj&&rI.isApplicable(null===(n=r.obj)||void 0===n?void 0:n.data)&&(s[ra.SurrNciRepr]=o.to(s[ra.SurrSel]).apply(et.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:ra.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(wr.Generators.byRef(r).subtree().withTag(ra.TargetSel)),i=n.select(wr.Generators.byRef(r).subtree().withTag(ra.SurrSel));if(0!==a.length||0!==i.length){for(var o=n.build(),s=en.Empty,u=0,c=a;u<c.length;u++)o.to(c[u]).update(et.Model.StructureSelectionFromBundle,function(m){return R(R({},m),{bundle:s})});for(var d=de.struct.generator.empty(),f=0,p=i;f<p.length;f++)o.to(p[f]).update(et.Model.StructureSelectionFromExpression,function(m){return R(R({},m),{expression:d})});return Sr.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p=this;return le(this,function(h){switch(h.label){case 0:return(n=this.plugin.helpers.substructureParent.get(r.structure))&&n.obj?(this.currentSource=r,a=Re.remap(r,n.obj.data),i=Re.extendToWholeResidues(a),o=en.fromLoci(i),s=en.toExpression(o),u=de.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=de.struct.modifier.exceptBy({0:u,by:s})),c=this.ensureShape(n),l=c.state,(d=c.builder).to((f=c.refs)[ra.TargetSel]).update(et.Model.StructureSelectionFromBundle,function(m){return R(R({},m),{bundle:o})}),d.to(f[ra.SurrSel]).update(et.Model.StructureSelectionFromExpression,function(m){return R(R({},m),{expression:u,label:p.surrLabel})}),[4,Sr.State.Update(this.plugin,{state:l,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]):[2];case 1:return h.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(ln.RootRef)})},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m;return le(this,function(v){switch(v.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(i=(a=this.plugin.state.data).build(),o=wr.Generators.root.subtree(),u=(s=this.params.components).indexOf("target")>=0,c=0,l=a.select(o.withTag(ra.TargetRepr));c<l.length;c++)m=l[c],u?i.to(m).update(this.getReprParams(this.params.targetParams)):i.delete(m.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=a.select(o.withTag(ra.SurrRepr));d<f.length;d++)m=f[d],u?i.to(m).update(this.getReprParams(this.params.surroundingsParams)):i.delete(m.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,h=a.select(o.withTag(ra.SurrNciRepr));p<h.length;p++)m=h[p],u?i.to(m).update(this.getReprParams(this.params.nciParams)):i.delete(m.transform.ref);return[4,Sr.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return v.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(nn.WithSubscribers),oI=nn.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:Knt,params:function(e,t){return function(e){var t=et.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:D.Numeric(5,{min:1,max:10,step:1}),targetParams:D.Group(t,{label:"Target",customDefault:iI(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:D.Group(t,{label:"Surroundings",customDefault:iI(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:D.Group(t,{label:"Non-covalent Int.",customDefault:iI(e,void 0,{type:rI,color:Q5,size:Ki.BuiltIn.uniform})}),components:D.MultiSelect(Fse,D.arrayToOptions(Fse)),excludeTargetFromSurroundings:D.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),ignoreLight:D.Boolean(!1),material:_s.getParam(),clip:D.Group(pm.Params)}}(t)}});function Os(e){return e}!function(e){function t(i){return"chain-id"===i?{name:i,params:Nre.defaultValues}:"operator-name"===i?{name:i,params:SL.defaultValues}:{name:i,params:{}}}e.CommonParams={ignoreHydrogens:D.Optional(D.Boolean(!1)),ignoreHydrogensVariant:D.Optional(D.Select("all",D.arrayToOptions(["all","non-polar"]))),ignoreLight:D.Optional(D.Boolean(!1)),quality:D.Optional(D.Select("auto",oB)),theme:D.Optional(D.Group({globalName:D.Optional(D.Text("")),globalColorParams:D.Optional(D.Value({},{isHidden:!0})),carbonColor:D.Optional(D.Select("chain-id",D.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:D.Optional(D.Text("")),symmetryColorParams:D.Optional(D.Value({},{isHidden:!0})),focus:D.Optional(D.Group({name:D.Optional(D.Text("")),params:D.Optional(D.Value({}))}))}))},e.reprBuilder=function n(i,o,s){var u,c,l,d,f,p,h,m,v,g,y,b,_,C,x=i.state.data.build(),A=i.builders.structure.representation,T=i.managers.structure.component.state.options.hydrogens,w={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:"all"!==T,ignoreHydrogensVariant:"only-polar"===T?"non-polar":"all",ignoreLight:i.managers.structure.component.state.options.ignoreLight};o.quality&&"auto"!==o.quality&&(w.quality=o.quality),void 0!==o.ignoreHydrogens&&(w.ignoreHydrogens=!!o.ignoreHydrogens),void 0!==o.ignoreHydrogensVariant&&(w.ignoreHydrogensVariant=o.ignoreHydrogensVariant),void 0!==o.ignoreLight&&(w.ignoreLight=!!o.ignoreLight);var E=null!==(u=o.theme)&&void 0!==u&&u.globalName?null===(c=o.theme)||void 0===c?void 0:c.globalName:void 0,I=void 0!==(null===(l=o.theme)||void 0===l?void 0:l.carbonColor)?R({carbonColor:t(null===(d=o.theme)||void 0===d?void 0:d.carbonColor)},null===(f=o.theme)||void 0===f?void 0:f.globalColorParams):R({},null===(p=o.theme)||void 0===p?void 0:p.globalColorParams),M=s&&null!==(h=o.theme)&&void 0!==h&&h.symmetryColor&&function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}(s)?null===(m=o.theme)||void 0===m?void 0:m.symmetryColor:E;return{update:x,builder:A,color:E,symmetryColor:M,symmetryColorParams:null!==(v=o.theme)&&void 0!==v&&v.symmetryColorParams?R(R({},null===(g=o.theme)||void 0===g?void 0:g.globalColorParams),null===(y=o.theme)||void 0===y?void 0:y.symmetryColorParams):R({},null===(b=o.theme)||void 0===b?void 0:b.globalColorParams),globalColorParams:null!==(_=o.theme)&&void 0!==_&&_.globalColorParams?R({},null===(C=o.theme)||void 0===C?void 0:C.globalColorParams):void 0,typeParams:w,ballAndStickColor:I}},e.updateFocusRepr=function a(i,o,s,u){if(i.state.hasBehavior(oI))return i.state.updateBehavior(oI,function(c){var l=u6(i,o,"ball-and-stick",s||"element-symbol",u);c.surroundingsParams.colorTheme=l,c.targetParams.colorTheme=l})}}(Os||(Os={}));var Ig=Os.CommonParams,Lb=Os.reprBuilder,Ub=Os.updateFocusRepr,Znt=Os({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return Ig},apply:function(e,t,r){var n,a,i=null===(a=null===(n=Mo.resolveAndCheck(r.state.data,e))||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(!i)return{};var o=r.config.get(ma.Structure.SizeThresholds)||Ye.DefaultSizeThresholds,s=Ye.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case Ye.Size.Gigantic:case Ye.Size.Huge:return kse.apply(e,t,r);case Ye.Size.Large:return Bse.apply(e,t,r);case Ye.Size.Medium:if(u>3)return Nse.apply(e,t,r);case Ye.Size.Small:return Lse.apply(e,R(R({},t),{showCarbohydrateSymbol:!0}),r);default:xn()}}}),Qnt=Os({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(n){return[2,{}]})})}}),IC="Basic",Nse=Os({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:IC,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return Ig},apply:function(e,t,r){var n,a,i,o,s,u,c,l,d,f;return ce(this,void 0,void 0,function(){var p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F;return le(this,function(N){switch(N.label){case 0:return(p=Mo.resolveAndCheck(r.state.data,e))?(F={},[4,Uu(r,p,"polymer")]):[2,{}];case 1:return F.polymer=N.sent(),[4,Uu(r,p,"ligand")];case 2:return F.ligand=N.sent(),[4,Uu(r,p,"non-standard")];case 3:return F.nonStandard=N.sent(),[4,Uu(r,p,"branched",{label:"Carbohydrate"})];case 4:return F.branched=N.sent(),[4,Uu(r,p,"water")];case 5:return F.water=N.sent(),[4,Uu(r,p,"ion")];case 6:return F.ion=N.sent(),[4,Uu(r,p,"lipid")];case 7:return F.lipid=N.sent(),[4,Uu(r,p,"coarse")];case 8:return F.coarse=N.sent(),v={sizeFactor:(m=p.obj.data).isCoarseGrained?.8:.2},g=((null===(i=null===(a=null===(n=(h=F).water)||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data)||void 0===i?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=((null===(u=null===(s=null===(o=h.lipid)||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data)||void 0===u?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Lb(r,t,m),A=b.color,T=b.symmetryColor,w=b.symmetryColorParams,E=b.globalColorParams,I=b.ballAndStickColor,M={polymer:(C=b.builder).buildRepresentation(_=b.update,h.polymer,{type:"cartoon",typeParams:R(R({},x=b.typeParams),v),color:T,colorParams:w},{tag:"polymer"}),ligand:C.buildRepresentation(_,h.ligand,{type:"ball-and-stick",typeParams:x,color:A,colorParams:I},{tag:"ligand"}),nonStandard:C.buildRepresentation(_,h.nonStandard,{type:"ball-and-stick",typeParams:x,color:A,colorParams:I},{tag:"non-standard"}),branchedBallAndStick:C.buildRepresentation(_,h.branched,{type:"ball-and-stick",typeParams:R(R({},x),{alpha:.3}),color:A,colorParams:I},{tag:"branched-ball-and-stick"}),branchedSnfg3d:C.buildRepresentation(_,h.branched,{type:"carbohydrate",typeParams:x,color:A,colorParams:E},{tag:"branched-snfg-3d"}),water:C.buildRepresentation(_,h.water,{type:g,typeParams:R(R({},x),{alpha:.6,visuals:"line"===g?["intra-bond","element-point"]:void 0}),color:A,colorParams:R({carbonColor:{name:"element-symbol",params:{}}},E)},{tag:"water"}),ion:C.buildRepresentation(_,h.ion,{type:"ball-and-stick",typeParams:x,color:A,colorParams:R({carbonColor:{name:"element-symbol",params:{}}},E)},{tag:"ion"}),lipid:C.buildRepresentation(_,h.lipid,{type:y,typeParams:R(R({},x),{alpha:.6,visuals:"line"===y?["intra-bond"]:void 0}),color:A,colorParams:R({carbonColor:{name:"element-symbol",params:{}}},E)},{tag:"lipid"}),coarse:C.buildRepresentation(_,h.coarse,{type:"spacefill",typeParams:x,color:A||"chain-id",colorParams:E},{tag:"coarse"})},[4,_.commit({revertOnError:!1})];case 9:return N.sent(),[4,Ub(r,m,null===(l=null===(c=t.theme)||void 0===c?void 0:c.focus)||void 0===l?void 0:l.name,null===(f=null===(d=t.theme)||void 0===d?void 0:d.focus)||void 0===f?void 0:f.params)];case 10:return N.sent(),[2,{components:h,representations:M}]}})})}}),$nt=Os({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:IC,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return Ig},apply:function(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u,c,l,d,f,p,h,m,v,g,y,b;return le(this,function(_){switch(_.label){case 0:return(s=Mo.resolveAndCheck(r.state.data,e))?(b={},[4,Use(r,s,"protein")]):[2,{}];case 1:return b.protein=_.sent(),[4,Use(r,s,"nucleic")];case 2:return b.nucleic=_.sent(),u=b,l={sizeFactor:(c=s.obj.data).isCoarseGrained?.8:.2},d={radiusOffset:c.isCoarseGrained?2:0,smoothness:c.isCoarseGrained?1:1.5},f=Lb(r,t,c),v=f.symmetryColor,g=f.symmetryColorParams,y={protein:(h=f.builder).buildRepresentation(p=f.update,u.protein,{type:"cartoon",typeParams:R(R({},m=f.typeParams),l),color:v,colorParams:g},{tag:"protein"}),nucleic:h.buildRepresentation(p,u.nucleic,{type:"gaussian-surface",typeParams:R(R({},m),d),color:v,colorParams:g},{tag:"nucleic"})},[4,p.commit({revertOnError:!0})];case 3:return _.sent(),[4,Ub(r,c,null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name,null===(o=null===(i=t.theme)||void 0===i?void 0:i.focus)||void 0===o?void 0:o.params)];case 4:return _.sent(),[2,{components:u,representations:y}]}})})}}),kse=Os({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:IC,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return Ig},apply:function(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u,c,l,d,f,p,h,m,v,g,y,b,_;return le(this,function(C){switch(C.label){case 0:return(s=Mo.resolveAndCheck(r.state.data,e))?(_={},[4,Uu(r,s,"polymer")]):[2,{}];case 1:return _.polymer=C.sent(),[4,Uu(r,s,"lipid")];case 2:return _.lipid=C.sent(),u=_,c=s.obj.data,l=r.config.get(ma.Structure.SizeThresholds)||Ye.DefaultSizeThresholds,d=Ye.getSize(c,l),f=Object.create(null),d===Ye.Size.Gigantic?Object.assign(f,{traceOnly:!c.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):d===Ye.Size.Huge?Object.assign(f,{radiusOffset:c.isCoarseGrained?2:0,smoothness:1}):c.isCoarseGrained&&Object.assign(f,{radiusOffset:2,smoothness:1}),p=Lb(r,t,c),g=p.symmetryColor,y=p.symmetryColorParams,b={polymer:(m=p.builder).buildRepresentation(h=p.update,u.polymer,{type:"gaussian-surface",typeParams:R(R({},v=p.typeParams),f),color:g,colorParams:y},{tag:"polymer"}),lipid:m.buildRepresentation(h,u.lipid,{type:"gaussian-surface",typeParams:R(R({},v),f),color:g,colorParams:y},{tag:"lipid"})},[4,h.commit({revertOnError:!0})];case 3:return C.sent(),[4,Ub(r,c,null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name,null===(o=null===(i=t.theme)||void 0===i?void 0:i.focus)||void 0===o?void 0:o.params)];case 4:return C.sent(),[2,{components:u,representations:b}]}})})}}),Bse=Os({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:IC,description:"Shows polymers as Cartoon."},params:function(){return Ig},apply:function(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u,c,l,d,f,m,v,g,y;return le(this,function(b){switch(b.label){case 0:return(s=Mo.resolveAndCheck(r.state.data,e))?(y={},[4,Uu(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),u=y,l={sizeFactor:(c=s.obj.data).isCoarseGrained?.8:.2},d=Lb(r,t,c),m=d.symmetryColor,v=d.symmetryColorParams,g={polymer:d.builder.buildRepresentation(f=d.update,u.polymer,{type:"cartoon",typeParams:R(R({},d.typeParams),l),color:m,colorParams:v},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return b.sent(),[4,Ub(r,c,null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name,null===(o=null===(i=t.theme)||void 0===i?void 0:i.focus)||void 0===o?void 0:o.params)];case 3:return b.sent(),[2,{components:u,representations:g}]}})})}}),Lse=Os({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:IC,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return R(R({},Ig),{showCarbohydrateSymbol:D.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s,u;return ce(this,void 0,void 0,function(){var c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j;return le(this,function(k){switch(k.label){case 0:return(c=Mo.resolveAndCheck(r.state.data,e))?(N={},[4,Uu(r,c,"all")]):[2,{}];case 1:return N.all=k.sent(),N.branched=void 0,l=N,f=(d=c.obj.data).elementCount>1e5,p=d.atomicResidueCount&&d.elementCount>1e3&&d.atomicResidueCount/d.elementCount<3,m=!!Lo.Provider.get(h=d.models[0])||ic.isExhaustive(h),v="ball-and-stick",d.isCoarseGrained?v=d.elementCount>1e6?"point":"spacefill":p&&!m?v="spacefill":f&&(v="line"),(g=t.showCarbohydrateSymbol&&!f&&!p)?(b=(y=Object).assign,_=[l],j={},[4,Uu(r,c,"branched",{label:"Carbohydrate"})]):[3,3];case 2:b.apply(y,_.concat([(j.branched=k.sent(),j)])),k.label=3;case 3:return C=Lb(r,t,d),x=C.update,A=C.builder,T=C.typeParams,w=C.color,E=C.ballAndStickColor,I=C.globalColorParams,M=p&&!m?R({carbonColor:{name:"element-symbol",params:{}}},I):E,F={all:A.buildRepresentation(x,l.all,{type:v,typeParams:T,color:w,colorParams:M},{tag:"all"})},g&&Object.assign(F,{snfg3d:A.buildRepresentation(x,l.branched,{type:"carbohydrate",typeParams:R(R({},T),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:w,colorParams:I},{tag:"snfg-3d"})}),[4,x.commit({revertOnError:!0})];case 4:return k.sent(),[4,Ub(r,d,null!==(i=null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name)&&void 0!==i?i:w,null!==(u=null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params)&&void 0!==u?u:M)];case 5:return k.sent(),[2,{components:l,representations:F}]}})})}}),Jnt=Os({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:function(){return R(R({},Ig),{showCarbohydrateSymbol:D.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s;return ce(this,void 0,void 0,function(){var u,c,l,d,f,m,v,g;return le(this,function(y){switch(y.label){case 0:return(u=Mo.resolveAndCheck(r.state.data,e))?(g={},[4,Uu(r,u,"all")]):[2,{}];case 1:return g.all=y.sent(),g.branched=void 0,c=g,d=Lb(r,t,l=u.obj.data),m=d.color,v={all:d.builder.buildRepresentation(f=d.update,c.all,{type:"spacefill",typeParams:R(R({},d.typeParams),{ignoreLight:!0}),color:"illustrative"},{tag:"all"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,Ub(r,l,null!==(i=null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name)&&void 0!==i?i:m,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params)];case 3:return y.sent(),[2,{components:c,representations:v}]}})})}});function Uu(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function Use(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,Ri[r],"selection-".concat(r),n)}var bf={empty:Qnt,auto:Znt,"atomic-detail":Lse,"polymer-cartoon":Bse,"polymer-and-ligand":Nse,"protein-and-nucleic":$nt,"coarse-surface":kse,illustrative:Jnt};function sI(e,t){if("bcif"===e.ext)try{var r=vZ(t).encoder;if(r.startsWith("VolumeServer"))return"dscif";if(r.startsWith("volseg-volume-server"))return"segcif"}catch(a){console.error(a)}else if("cif"===e.ext){var n=t;if(n.startsWith("data_SERVER\n#\n_density_server_result"))return"dscif";if(n.startsWith("data_SERVER\n#\ndata_SEGMENTATION_DATA"))return"segcif";if(n.includes("atom_site_fract_x")||n.includes("atom_site.fract_x"))return"coreCif"}return-1}var od="Trajectory";function rh(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var eat={label:"mmCIF",description:"mmCIF",category:od,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return"mmcif"===e.ext||"mcif"===e.ext||("cif"===e.ext||"bcif"===e.ext)&&-1===sI(e,t)},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var a,i,o,s;return le(this,function(u){switch(u.label){case 0:return[4,(a=e.state.data.build().to(t).apply(et.Data.ParseCif,void 0,{state:{isGhost:!0}})).apply(et.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),((null===(s=null===(o=a.selector.cell)||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:rh},tat={label:"cifCore",description:"CIF Core",category:od,stringExtensions:["cif"],isApplicable:function(e,t){return"cif"===e.ext&&"coreCif"===sI(e,t)},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var a,i,o,s;return le(this,function(u){switch(u.label){case 0:return[4,(a=e.state.data.build().to(t).apply(et.Data.ParseCif,void 0,{state:{isGhost:!0}})).apply(et.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),((null===(s=null===(o=a.selector.cell)||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:rh};function Pg(e,t){var r=this;return function(n,a,i){return ce(r,void 0,void 0,function(){return le(this,function(u){switch(u.label){case 0:return[4,n.state.data.build().to(a).apply(e,t,{tags:i?.trajectoryTags}).commit({revertOnError:!0})];case 1:return[2,{trajectory:u.sent()}]}})})}}var rat={label:"PDB",description:"PDB",category:od,stringExtensions:["pdb","ent"],parse:Pg(et.Model.TrajectoryFromPDB),visuals:rh},nat={label:"PDBQT",description:"PDBQT",category:od,stringExtensions:["pdbqt"],parse:Pg(et.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:rh},aat={label:"XYZ",description:"XYZ",category:od,stringExtensions:["xyz"],parse:Pg(et.Model.TrajectoryFromXYZ),visuals:rh},Vse=[["mmcif",eat],["cifCore",tat],["pdb",rat],["pdbqt",nat],["gro",{label:"GRO",description:"GRO",category:od,stringExtensions:["gro"],binaryExtensions:[],parse:Pg(et.Model.TrajectoryFromGRO),visuals:rh}],["xyz",aat],["mol",{label:"MOL",description:"MOL",category:od,stringExtensions:["mol"],parse:Pg(et.Model.TrajectoryFromMOL),visuals:rh}],["sdf",{label:"SDF",description:"SDF",category:od,stringExtensions:["sdf","sd"],parse:Pg(et.Model.TrajectoryFromSDF),visuals:rh}],["mol2",{label:"MOL2",description:"MOL2",category:od,stringExtensions:["mol2"],parse:Pg(et.Model.TrajectoryFromMOL2),visuals:rh}]],cat=["gz","zip"];function Vb(e){var t=e,r="",n=t.lastIndexOf("?"),a=-1!==n?t.substring(n):"",i=(t=t.substring(0,-1===n?t.length:n)).replace(/^.*[\\/]/,""),o=i.substring(0,i.lastIndexOf(".")),s=i.split("."),u=s.length>1?(s.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(r=c[1].toLowerCase(),t=c[2]||"");var l=t.substring(0,t.lastIndexOf("/")+1);return cat.includes(u)&&(u=(t.substr(0,t.length-u.length-1).split(".").pop()||"").toLowerCase(),o=o.substr(0,o.length-u.length-1)),{path:t,name:i,ext:u,base:o,dir:l,protocol:r,query:a}}var PC="Topology",lat={label:"PSF",description:"PSF",category:PC,stringExtensions:["psf"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return le(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(et.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},dat={label:"PRMTOP",description:"PRMTOP",category:PC,stringExtensions:["prmtop","parm7"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return le(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParsePrmtop,{},{state:{isGhost:!0}}),n=r.apply(et.Model.TopologyFromPrmtop),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},fat={label:"TOP",description:"TOP",category:PC,stringExtensions:["top"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return le(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParseTop,{},{state:{isGhost:!0}}),n=r.apply(et.Model.TopologyFromTop),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},pat=[["psf",lat],["prmtop",dat],["top",fat]],zb="Coordinates",hat={label:"DCD",description:"DCD",category:zb,binaryExtensions:["dcd"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromDcd).commit()}},mat={label:"XTC",description:"XTC",category:zb,binaryExtensions:["xtc"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromXtc).commit()}},vat={label:"TRR",description:"TRR",category:zb,binaryExtensions:["trr"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromTrr).commit()}},gat={label:"NCTRAJ",description:"NCTRAJ",category:zb,binaryExtensions:["nc","nctraj"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromNctraj).commit()}},yat=[["dcd",hat],["xtc",mat],["trr",vat],["nctraj",gat]],zse={rcsb:D.Group({encoding:D.Select("bcif",D.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:D.Group({variant:D.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:D.EmptyGroup({label:"PDBj"})},_at=au.build({from:ve.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=function(e){var t=e.config.get(ma.Structure.DefaultRepresentationPreset)||bf.auto.id;return D.Group({type:lg.getParams(void 0,"auto").type,representation:D.Select(t,e.builders.structure.representation.getPresets().map(function(r){return[r.id,r.display.name,r.display.group]}),{description:"Which representation preset to use."}),representationParams:D.Group(Os.CommonParams,{isHidden:!0}),asTrajectory:D.Optional(D.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})}(t),n=t.config.get(ma.Download.DefaultPdbProvider)||"pdbe";return{source:D.MappedStatic("pdb",{pdb:D.Group({provider:D.Group({id:D.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:D.MappedStatic(n,zse)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":D.Group({provider:D.Group({id:D.Text("PDBDEV_00000001",{label:"PDB-Dev Id(s)",description:"One or more comma/space separated ids."}),encoding:D.Select("bcif",D.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB-Dev"}),swissmodel:D.Group({id:D.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:D.Group({id:D.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:D.Group({id:D.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:D.Group({id:D.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:D.Group({url:D.Url(""),format:D.Select("mmcif",D.arrayToOptions(Vse.map(function(a){return a[0]}),function(a){return a})),isBinary:D.Boolean(!1),label:D.Optional(D.Text("")),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Download Structure",function(a){return ce(void 0,void 0,void 0,function(){var i,o,s,u,l,d,f;return le(this,function(p){switch(p.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),s=!1,u="mmcif",(i=r.source).name){case"url":return[3,1];case"pdb":return[3,2];case"pdb-dev":return[3,4];case"swissmodel":return[3,6];case"alphafolddb":return[3,8];case"modelarchive":return[3,10];case"pubchem":return[3,12]}return[3,14];case 1:return o=[{url:i.params.url,isBinary:i.params.isBinary,label:i.params.label||void 0}],u=i.params.format,[3,15];case 2:return[4,"pdbe"===i.params.provider.server.name?Sat(i):"pdbj"===i.params.provider.server.name?Cat(i):"rcsb"===i.params.provider.server.name?xat(i):xn()];case 3:return o=p.sent(),s=!!i.params.options.asTrajectory,[3,15];case 4:return[4,sd(i.params.provider.id,function(h){var m=h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_".concat(h.padStart(8,"0"));return"bcif"===i.params.provider.encoding?"https://pdb-dev.wwpdb.org/bcif/".concat(m.toUpperCase(),".bcif"):"https://pdb-dev.wwpdb.org/cif/".concat(m.toUpperCase(),".cif")},function(h){return h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_".concat(h.padStart(8,"0"))},"bcif"===i.params.provider.encoding)];case 5:return o=p.sent(),s=!!i.params.options.asTrajectory,[3,15];case 6:return[4,sd(i.params.id,function(h){return"https://swissmodel.expasy.org/repository/uniprot/".concat(h.toUpperCase(),".pdb")},function(h){return"SWISS-MODEL: ".concat(h)},!1)];case 7:return o=p.sent(),s=!!i.params.options.asTrajectory,u="pdb",[3,15];case 8:return[4,sd(i.params.id,function(h){return ce(void 0,void 0,void 0,function(){var m,v;return le(this,function(g){switch(g.label){case 0:return m="https://www.alphafold.ebi.ac.uk/api/prediction/".concat(h.toUpperCase()),[4,t.runTask(t.fetch({url:m,type:"json"}))];case 1:if(v=g.sent(),Array.isArray(v)&&v.length>0)return[2,v[0].cifUrl];throw new Error("No AlphaFold DB entry for '".concat(h,"'"))}})})},function(h){return"AlphaFold DB: ".concat(h)},!1)];case 9:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 10:return[4,sd(i.params.id,function(h){return"https://www.modelarchive.org/doi/10.5452/".concat(h.toLowerCase(),".cif")},function(h){return"Model Archive: ".concat(h)},!1)];case 11:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 12:return[4,sd(i.params.id,function(h){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/".concat(h.trim(),"/record/SDF/?record_type=3d")},function(h){return"PubChem: ".concat(h)},!1)];case 13:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mol",[3,15];case 14:xn(),p.label=15;case 15:return l=r.source.params.options.representation||t.config.get(ma.Structure.DefaultRepresentationPreset)||bf.auto.id,d=l!==bf.empty.id,f="auto"===i.params.options.type.name?void 0:i.params.options.type,[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var h,m,v,g,y,b,_,C;return le(this,function(x){switch(x.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(A,T){return{id:""+T,url:A.url,isBinary:A.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return h=x.sent(),[4,t.builders.structure.parseTrajectory(h,{formats:o.map(function(A,T){return{id:""+T,format:"cif"}})})];case 2:return _=x.sent(),[4,t.builders.structure.hierarchy.applyPreset(_,"default",{structure:f,showUnitcell:d,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return x.sent(),[3,10];case 4:m=0,v=o,x.label=5;case 5:return m<v.length?[4,t.builders.data.download(g=v[m],{state:{isGhost:!0}})]:[3,10];case 6:if(y=x.sent(),!(b="auto"===u?t.dataFormats.auto(Vb(pn.getUrl(g.url)),null===(C=y.cell)||void 0===C?void 0:C.obj):t.dataFormats.get(u)))throw new Error("unknown file format");return[4,t.builders.structure.parseTrajectory(y,b)];case 7:return _=x.sent(),[4,t.builders.structure.hierarchy.applyPreset(_,"default",{structure:f,showUnitcell:d,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:x.sent(),x.label=9;case 9:return m++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 16:return p.sent(),[2]}})})})});function sd(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p;return le(this,function(h){switch(h.label){case 0:a=e.split(/[,\s]/).map(function(m){return m.trim()}).filter(function(m){return!!m&&(m.length>=4||/^[1-9][0-9]*$/.test(m))}),i=[],o=0,s=a,h.label=1;case 1:return o<s.length?(l=(c=i).push,p={},f=(d=pn).Url,[4,t(u=s[o])]):[3,4];case 2:l.apply(c,[(p.url=f.apply(d,[h.sent()]),p.isBinary=n,p.label=r(u),p)]),h.label=3;case 3:return o++,[3,1];case 4:return[2,i]}})})}function Sat(e){return ce(this,void 0,void 0,function(){return le(this,function(t){if("pdb"!==e.name||"pdbe"!==e.params.provider.server.name)throw new Error("expected pdbe");return[2,"updated"===e.params.provider.server.params.variant?sd(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),"_updated.cif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!1):"updated-bcif"===e.params.provider.server.params.variant?sd(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/entry-files/download/".concat(r.toLowerCase(),".bcif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!0):sd(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),".cif")},function(r){return"PDBe: ".concat(r," (cif)")},!1)]})})}function Cat(e){return ce(this,void 0,void 0,function(){return le(this,function(t){if("pdb"!==e.name||"pdbj"!==e.params.provider.server.name)throw new Error("expected pdbj");return[2,sd(e.params.provider.id,function(r){return"https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/".concat(r.toLowerCase().substring(1,3),"/").concat(r.toLowerCase(),".cif")},function(r){return"PDBj: ".concat(r," (cif)")},!1)]})})}function xat(e){return ce(this,void 0,void 0,function(){return le(this,function(t){if("pdb"!==e.name||"rcsb"!==e.params.provider.server.name)throw new Error("expected rcsb");return[2,"cif"===e.params.provider.server.params.encoding?sd(e.params.provider.id,function(r){return"https://files.rcsb.org/download/".concat(r.toUpperCase(),".cif")},function(r){return"RCSB PDB: ".concat(r," (cif)")},!1):sd(e.params.provider.id,function(r){return"https://models.rcsb.org/".concat(r.toUpperCase(),".bcif")},function(r){return"RCSB PDB: ".concat(r," (bcif)")},!0)]})})}var wat=au.build({display:{name:"Update Trajectory"},params:{action:D.Select("advance",D.arrayToOptions(["advance","reset"])),by:D.Optional(D.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(et.Model.ModelFromTrajectory)}),a=r.build();if("reset"===t.action)for(var i=0,o=n;i<o.length;i++)a.to(o[i]).update({modelIndex:0});else for(var u=function(d){var f=wr.findAncestorOfType(r.tree,r.cells,d.transform.ref,ve.Molecule.Trajectory);if(!f||!f.obj)return"continue";var p=f.obj;a.to(d).update(function(h){var m=(h.modelIndex+t.by)%p.data.frameCount;return m<0&&(m+=p.data.frameCount),{modelIndex:m}})},c=0,l=n;c<l.length;c++)u(l[c]);return r.updateTree(a)}),Aat=au.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ve.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable:function(e,t,r){return t.transformer!==Cre}})(function(e,t){return t.builders.structure.insertModelProperties(e.ref,e.params)}),Tat=au.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ve.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable:function(e,t,r){return t.transformer!==wre}})(function(e,t){return t.builders.structure.insertStructureProperties(e.ref,e.params)}),Dat=au.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ve.Root,params:function(e,t){var r=t.state.data,a=sr(sr([],r.selectQ(function(s){return s.rootsOfType(ve.Molecule.Model)}),!0),r.selectQ(function(s){return s.rootsOfType(ve.Molecule.Topology)}),!0).map(function(s){return[s.transform.ref,s.obj.label]}),o=r.selectQ(function(s){return s.rootsOfType(ve.Molecule.Coordinates)}).map(function(s){return[s.transform.ref,s.obj.label]});return{model:D.Select(a.length?a[0][0]:"",a),coordinates:D.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Add Trajectory",function(a){return n.transaction(function(){return ce(void 0,void 0,void 0,function(){var i,o,s;return le(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(hL,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(et.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})}),Eat=au.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:ve.Root,params:function(e,t){for(var r=t.dataFormats.options,n=r.filter(function(l){return l[2]===od||l[2]===PC}),a=r.filter(function(l){return l[2]===zb}),i=[],o=[],s=0,u=t.dataFormats.list;s<u.length;s++){var c=u[s].provider;c.category===od||c.category===PC?(c.binaryExtensions&&i.push.apply(i,c.binaryExtensions),c.stringExtensions&&i.push.apply(i,c.stringExtensions)):c.category===zb&&(c.binaryExtensions&&o.push.apply(o,c.binaryExtensions),c.stringExtensions&&o.push.apply(o,c.stringExtensions))}return{source:D.MappedStatic("file",{url:D.Group({model:D.Group({url:D.Url(""),format:D.Select(n[0][0],n),isBinary:D.Boolean(!1)},{isExpanded:!0}),coordinates:D.Group({url:D.Url(""),format:D.Select(a[0][0],a)},{isExpanded:!0})},{isFlat:!0}),file:D.Group({model:D.File({accept:i.map(function(l){return".".concat(l)}).join(","),label:"Model"}),coordinates:D.File({accept:o.map(function(l){return".".concat(l)}).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Load Trajectory",function(a){return n.transaction(function(){return ce(void 0,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:if("file"===(i=r.source).name&&(null===i.params.model||null===i.params.coordinates))return t.log.error("No file(s) selected"),[2];if(!("url"!==i.name||i.params.model&&i.params.coordinates))return t.log.error("No URL(s) given"),[2];o=function(y,b,_){return ce(void 0,void 0,void 0,function(){var C,x;return le(this,function(A){switch(A.label){case 0:return[4,t.builders.data.download({url:y,isBinary:_})];case 1:return C=A.sent(),(x=t.dataFormats.get(b))?[2,x.parse(t,C)]:(t.log.warn("LoadTrajectory: could not find data provider for '".concat(b,"'")),[2])}})})},s=function(y){return ce(void 0,void 0,void 0,function(){var b,_,C,x,A,T,w;return le(this,function(E){switch(E.label){case 0:if(!y)throw new Error("No file selected");return b=Vb(null!==(T=null===(A=y.file)||void 0===A?void 0:A.name)&&void 0!==T?T:""),_=t.dataFormats.binaryExtensions.has(b.ext),[4,t.builders.data.readFile({file:y,isBinary:_})];case 1:return C=E.sent().data,(x=t.dataFormats.auto(b,null===(w=C.cell)||void 0===w?void 0:w.obj))?[3,3]:(t.log.warn("LoadTrajectory: could not find data provider for '".concat(b.ext,"'")),[4,t.state.data.build().delete(C).commit()]);case 2:return E.sent(),[2];case 3:return[2,x.parse(t,C)]}})})},g.label=1;case 1:return g.trys.push([1,16,,17]),"url"!==i.name?[3,3]:[4,o(i.params.model.url,i.params.model.format,i.params.model.isBinary)];case 2:return c=g.sent(),[3,5];case 3:return[4,s(i.params.model)];case 4:c=g.sent(),g.label=5;case 5:return l=void 0,"trajectory"in(u=c)?[4,n.build().to(u.trajectory).apply(gre,{modelIndex:0}).commit()]:[3,7];case 6:return l=g.sent(),[3,8];case 7:l=u.topology,g.label=8;case 8:return"url"!==i.name?[3,10]:[4,o(i.params.coordinates.url,i.params.coordinates.format,!0)];case 9:return f=g.sent(),[3,12];case 10:return[4,s(i.params.coordinates)];case 11:f=g.sent(),g.label=12;case 12:return p=[l.ref,(d=f).ref],h=n.build().toRoot().apply(hL,{modelRef:l.ref,coordinatesRef:d.ref},{dependsOn:p}).apply(et.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(h).runInContext(a)];case 13:return g.sent(),[4,t.builders.structure.createStructure(h.selector)];case 14:return m=g.sent(),[4,t.builders.structure.representation.applyPreset(m,"auto")];case 15:return g.sent(),[3,17];case 16:return v=g.sent(),console.error(v),t.log.error("Error loading trajectory"),[3,17];case 17:return[2]}})})}).runInContext(a)})}),Iat=au.build({from:ve.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:D.MappedStatic("pdb-xray",{"pdb-xray":D.Group({provider:D.Group({id:D.Text("1tqn",{label:"Id"}),server:D.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:D.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":D.Group({provider:D.Group({id:D.Text("1tqn",{label:"Id"}),server:D.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:D.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":D.Group({provider:D.Group({id:D.Text("emd-8004",{label:"Id"}),server:D.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:D.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:D.Group({url:D.Url(""),isBinary:D.Boolean(!1),format:D.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return Ve.create("Download Density",function(n){return ce(void 0,void 0,void 0,function(){var a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:switch((a=r.source).name){case"url":i=a.params;break;case"pdb-xray":i="pdbe"===a.params.provider.server?{url:pn.Url("https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.params.provider.id.toLowerCase(),"2fofc"===a.params.type?".ccp4":"_diff.ccp4")),isBinary:!0,label:"PDBe X-ray map: ".concat(a.params.provider.id)}:{url:pn.Url("https://edmaps.rcsb.org/maps/".concat(a.params.provider.id.toLowerCase(),"2fofc"===a.params.type?"_2fofc.dsn6":"_fofc.dsn6")),isBinary:!0,label:"RCSB X-ray map: ".concat(a.params.provider.id)};break;case"pdb-emd-ds":i="pdbe"===a.params.provider.server?{url:pn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe EMD Density Server: ".concat(a.params.provider.id)}:{url:pn.Url("https://maps.rcsb.org/em/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB EMD Density Server: ".concat(a.params.provider.id)};break;case"pdb-xray-ds":i="pdbe"===a.params.provider.server?{url:pn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe X-ray Density Server: ".concat(a.params.provider.id)}:{url:pn.Url("https://maps.rcsb.org/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB X-ray Density Server: ".concat(a.params.provider.id)};break;default:xn()}return[4,t.builders.data.download(i)];case 1:switch(s=f.sent(),u=void 0,a.name){case"url":i=a.params,o="auto"===a.params.format?t.dataFormats.auto(Vb(pn.getUrl(i.url)),null===(l=s.cell)||void 0===l?void 0:l.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=t.dataFormats.get("pdbe"===a.params.provider.server?"ccp4":"dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:xn()}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return c=f.sent(),[4,null===(d=o.visuals)||void 0===d?void 0:d.call(o,t,c)];case 3:return f.sent(),[2]}})})})}),Gse=au.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ve.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(wr.Generators.root.subtree().ofType(ve.Volume.Data).filter(function(n){var a;return!(!n.obj||null!==(a=n.obj)&&void 0!==a&&a.data.colorVolume||n.obj===e)}));return 0===r.length?{ref:D.Text("",{isHidden:!0,label:"Volume"})}:{ref:D.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return t.build().to(r).apply(et.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()});function uI(e,t,r,n){var a,i,o,s;return ce(this,void 0,void 0,function(){var u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:return u=Vb(null!==(i=null===(a=e.file)||void 0===a?void 0:a.name)&&void 0!==i?i:""),c=t.dataFormats.binaryExtensions.has(u.ext),[4,t.builders.data.readFile({file:e,isBinary:c})];case 1:return l=p.sent().data,(d="auto"===r?t.dataFormats.auto(u,null===(o=l.cell)||void 0===o?void 0:o.obj):t.dataFormats.get(r))?[3,3]:(t.log.warn("OpenFiles: could not find data provider for '".concat(u.ext,"'")),[4,t.state.data.build().delete(l).commit()]);case 2:return p.sent(),[2];case 3:return[4,d.parse(t,l)];case 4:return f=p.sent(),n?[4,null===(s=d.visuals)||void 0===s?void 0:s.call(d,t,f)]:[3,6];case 5:p.sent(),p.label=6;case 6:return[2]}})})}var jse,MC,Hse=au.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ve.Root,params:function(e,t){var r=t.dataFormats,a=r.options;return{files:D.FileList({accept:Array.from(r.extensions.values()).map(function(i){return".".concat(i)}).join(",")+",.gz,.zip",multiple:!0}),format:D.MappedStatic("auto",{auto:D.EmptyGroup(),specific:D.Select(a[0][0],a)}),visuals:D.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Open Files",function(a){return ce(void 0,void 0,void 0,function(){return le(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h,m,v,b;return le(this,function(_){switch(_.label){case 0:if(null===r.files)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,_.label=1;case 1:if(!(o<s.length))return[3,14];u=s[o],_.label=2;case 2:return _.trys.push([2,12,,13]),u.file&&u.name.toLowerCase().endsWith(".zip")?(l=Z2,d=[a],[4,u.file.arrayBuffer()]):[3,9];case 3:return[4,l.apply(void 0,d.concat([_.sent()]))];case 4:c=_.sent(),f=0,p=Object.entries(c),_.label=5;case 5:return f<p.length?(m=(h=p[f])[0],(v=h[1])instanceof Uint8Array&&0!==v.length?[4,uI(pn.File(new File([v],m)),t,"auto",r.visuals)]:[3,7]):[3,8];case 6:_.sent(),_.label=7;case 7:return f++,[3,5];case 8:return[3,11];case 9:return[4,uI(u,t,"auto"===r.format.name?"auto":r.format.params,r.visuals)];case 10:_.sent(),_.label=11;case 11:return[3,13];case 12:return b=_.sent(),console.error(b),t.log.error("Error opening file '".concat(u.name,"'")),[3,13];case 13:return o++,[3,1];case 14:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),Pat=au.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ve.Root,params:function(e,t){var r=sr(sr([],t.dataFormats.options,!0),[["zip","Zip"],["gzip","Gzip"]],!1);return{url:D.Url(""),format:D.Select(r[0][0],r),isBinary:D.Boolean(!1),visuals:D.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Open Files",function(a){return ce(void 0,void 0,void 0,function(){return le(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,c,l,d,p,h,m,v,g,y,b,_,C;return le(this,function(x){switch(x.label){case 0:return x.trys.push([0,15,,16]),"zip"===r.format||"gzip"===r.format?[4,t.builders.data.download({url:r.url,isBinary:!0})]:[3,10];case 1:return v=x.sent(),"zip"!==r.format?[3,7]:[4,Z2(a,(null===(b=v.obj)||void 0===b?void 0:b.data).buffer)];case 2:o=x.sent(),s=0,u=Object.entries(o),x.label=3;case 3:return s<u.length?(l=(c=u[s])[0],(d=c[1])instanceof Uint8Array&&0!==d.length?[4,uI(pn.File(new File([d],l)),t,"auto",r.visuals)]:[3,5]):[3,6];case 4:x.sent(),x.label=5;case 5:return s++,[3,3];case 6:return[3,9];case 7:return p=pn.getUrl(r.url),h=Vb(p).name,[4,uI(pn.File(new File([null===(_=v.obj)||void 0===_?void 0:_.data],h)),t,"auto",r.visuals)];case 8:x.sent(),x.label=9;case 9:return[3,14];case 10:return(m=t.dataFormats.get(r.format))?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '".concat(r.format,"'")),[2]);case 11:return v=x.sent(),[4,m.parse(t,v)];case 12:return g=x.sent(),r.visuals?[4,null===(C=m.visuals)||void 0===C?void 0:C.call(m,t,g)]:[3,14];case 13:x.sent(),x.label=14;case 14:return[3,16];case 15:return y=x.sent(),console.error(y),t.log.error("Error downloading '".concat("string"==typeof r.url?r.url:r.url.url,"'")),[3,16];case 16:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),Mg={Structure:sP,Volume:uP,DataFormat:cP},c6=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t}(ve.Create({name:"Volume Streaming",typeClass:"Object"}));function qse(e,t,r,n){return ce(this,void 0,void 0,function(){return le(this,function(a){switch(e){case"emdb":return[2,Wse(t,r,n)];case"pdbe":return[2,Nat(t,r,n)]}return[2]})})}function Wse(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return le(this,function(l){switch(l.label){case 0:return n=e.config.get(ma.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:"".concat(n,"/").concat(r.toUpperCase(),"/header/").concat(r.toLowerCase(),".xml"),type:"xml"}).runInContext(t)];case 1:for(a=l.sent(),i=a.getElementsByTagName("map")[0],o=i.getElementsByTagName("contour"),s=o[0],u=1;u<o.length;u++)if("true"===o[u].getAttribute("primary")){s=o[u];break}return[2,parseFloat(s.getElementsByTagName("level")[0].textContent)]}})})}function Nat(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u;return le(this,function(c){switch(c.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return s=c.sent(),(u=null===(a=null===(n=s?.map)||void 0===n?void 0:n.contour_list)||void 0===a?void 0:a.contour)&&0!==u.length?[2,null!==(o=null===(i=u.find(function(l){return l.primary}))||void 0===i?void 0:i.level)&&void 0!==o?o:u[0].level]:[2,kat(e,t,r)]}})})}function kat(e,t,r){var n,a,i;return ce(this,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return o=c.sent(),s=o?.[r],u=void 0,void 0!==(null===(i=null===(a=null===(n=s?.[0])||void 0===n?void 0:n.map)||void 0===a?void 0:a.contour_level)||void 0===i?void 0:i.value)&&(u=+s[0].map.contour_level.value),[2,u]}})})}function Bat(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s;return le(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/".concat(r),type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a?.[r],o=[],null===(n=i?.[0])||void 0===n||!n.related_structures)throw new Error("No related EMDB entry found for '".concat(r,"'."));if(!(s=i[0].related_structures.filter(function(c){return"EMDB"===c.resource&&"associated EM volume"===c.relationship})).length)throw new Error("No related EMDB entry found for '".concat(r,"'."));return o.push.apply(o,s.map(function(c){return c.accession})),[2,o]}})})}!function(e){var r;(r=e.ValueType||(e.ValueType={})).Float32="float32",r.Int8="int8"}(jse||(jse={})),function(e){e.create=function r(o){return{entries:xN(),capacity:Math.max(1,o)}},e.get=function n(o,s){for(var u=o.entries.first;u;u=u.next)if(u.value.key===s)return o.entries.remove(u),o.entries.addLast(u.value),u.value.data},e.set=function a(o,s,u){var c=void 0;if(o.entries.count>=o.capacity){var l=o.entries.first;c=l.value.data,o.entries.remove(l)}return o.entries.addLast(function t(o,s){return{key:o,data:s}}(s,u)),c},e.remove=function i(o,s){for(var u=o.entries.first;u;u=u.next)if(u.value.key===s){o.entries.remove(u);break}}}(MC||(MC={}));class Lat extends Us{constructor(t,r){super()}schedule(t,r=0){return this}}const cI={setInterval(e,t,...r){const{delegate:n}=cI;return n?.setInterval?n.setInterval(e,t,...r):setInterval(e,t,...r)},clearInterval(e){const{delegate:t}=cI;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class RC{constructor(t,r=RC.now){this.schedulerActionCtor=t,this.now=r}schedule(t,r=0,n){return new this.schedulerActionCtor(this,t).schedule(n,r)}}RC.now=jF.now;const l6=new class Vat extends RC{constructor(t,r=RC.now){super(t,r),this.actions=[],this._active=!1}flush(t){const{actions:r}=this;if(this._active)return void r.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=r.shift());if(this._active=!1,n){for(;t=r.shift();)t.unsubscribe();throw n}}}(class Uat extends Lat{constructor(t,r){super(t,r),this.scheduler=t,this.work=r,this.pending=!1}schedule(t,r=0){var n;if(this.closed)return this;this.state=t;const a=this.id,i=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(i,a,r)),this.pending=!0,this.delay=r,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,r),this}requestAsyncId(t,r,n=0){return cI.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,r,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return r;null!=r&&cI.clearInterval(r)}execute(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,r);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,r){let a,n=!1;try{this.work(t)}catch(i){n=!0,a=i||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),a}unsubscribe(){if(!this.closed){const{id:t,scheduler:r}=this,{actions:n}=r;this.work=this.state=this.scheduler=null,this.pending=!1,px(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,super.unsubscribe()}}}),zat=l6;function Yse(e,t=l6,r){const n=function jat(e=0,t,r=zat){let n=-1;return null!=t&&(UW(t)?r=t:n=t),new ko(a=>{let i=function Hat(e){return e instanceof Date&&!isNaN(e)}(e)?+e-r.now():e;i<0&&(i=0);let o=0;return r.schedule(function(){a.closed||(a.next(o++),0<=n?this.schedule(void 0,n):a.complete())},i)})}(e,t);return function Gat(e,t){return _i((r,n)=>{const{leading:a=!0,trailing:i=!1}=t??{};let o=!1,s=null,u=null,c=!1;const l=()=>{u?.unsubscribe(),u=null,i&&(p(),c&&n.complete())},d=()=>{u=null,c&&n.complete()},f=h=>u=$u(e(h)).subscribe(Si(n,l,d)),p=()=>{if(o){o=!1;const h=s;s=null,n.next(h),!c&&f(h)}};r.subscribe(Si(n,h=>{o=!0,s=h,(!u||u.closed)&&(a?p():f(h))},()=>{c=!0,(!(i&&o&&u)||u.closed)&&n.complete()}))})}(()=>n,r)}function Xse(e,t=mh){return e=e??qat,_i((r,n)=>{let a,i=!0;r.subscribe(Si(n,o=>{const s=t(o);(i||!e(a,s))&&(i=!1,a=s,n.next(o))}))})}function qat(e,t){return e===t}var Wat=function(){function e(t){void 0===t&&(t=!1),this.isRunning=!1,this.queue=[],this.counter=0,this.log=t}return e.prototype.enqueue=function(t){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:t},this.counter++,this.run()},e.prototype.run=function(){return ce(this,void 0,void 0,function(){var t;return le(this,function(r){switch(r.label){case 0:if(this.isRunning)return[2];if(!(t=this.queue.pop()))return[2];this.isRunning=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),this.log&&console.log("SingleAsyncQueue run",t.id),[4,t.func()];case 2:return r.sent(),this.log&&console.log("SingleAsyncQueue complete",t.id),[3,4];case 3:return this.isRunning=!1,this.run(),[7];case 4:return[2]}})})},e}(),Cc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qt(t,e),t}(ve.CreateBehavior({name:"Volume Streaming"}));function Mm(e,t,r){return{i:e,j:t,k:r}}function ml(e,t){return{a:e,b:t}}!function(e){function t(u,c,l,d,f){var p,h,m,v;return void 0===f&&(f={}),D.Group({isoValue:nt.createIsoValueParam(null!==(p=f.isoValue)&&void 0!==p?p:l,d),color:D.Color(null!==(h=f.color)&&void 0!==h?h:c),wireframe:D.Boolean(null!==(m=f.wireframe)&&void 0!==m&&m),opacity:D.Numeric(null!==(v=f.opacity)&&void 0!==v?v:.3,{min:0,max:1,step:.01})},{label:u,isExpanded:!0})}e.RootTag="volume-streaming-info";var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function a(u){var l=u.defaultView,d=u.structure,f=u.channelParams,p=void 0===f?{}:f,h=u.entryData||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:nt.IsoValue.relative(0)},m=d&&d.boundary.box||Nt();return{view:D.MappedStatic(l||("em"===h.kind?"auto":"selection-box"),{off:D.Group({}),box:D.Group({bottomLeft:D.Vec3(m.min),topRight:D.Vec3(m.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":D.Group({radius:D.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),bottomLeft:D.Vec3(S.create(0,0,0),{},{isHidden:!0}),topRight:D.Vec3(S.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":D.Group({radius:D.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:i(h.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:D.Vec3(S.create(0,0,0),{},{isHidden:!0}),topRight:D.Vec3(S.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:D.Group({}),auto:D.Group({radius:D.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),selectionDetailLevel:i(h.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:D.Boolean(!1,{isHidden:!0}),bottomLeft:D.Vec3(m.min,{},{isHidden:!0}),topRight:D.Vec3(m.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:i(h.header.availablePrecisions,3),channels:D.Group("em"===h.kind?{em:t("EM",dt(6524815),h.emDefaultContourLevel||nt.IsoValue.relative(1),h.header.sampling[0].valuesInfo[0],p.em)}:{"2fo-fc":t("2Fo-Fc",dt(3367602),nt.IsoValue.relative(1.5),h.header.sampling[0].valuesInfo[0],p["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",dt(3390259),nt.IsoValue.relative(3),h.header.sampling[0].valuesInfo[1],p["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",dt(12268339),nt.IsoValue.relative(-3),h.header.sampling[0].valuesInfo[1],p["fo-fc(-ve)"])},{isFlat:!0})}}function i(u,c,l){return D.Select(Math.min(c,u.length-1),u.map(function(d,f){return[f,"".concat(f+1," [ ").concat(0|Math.pow(d.maxVoxels,1/3),"^3 cells ]")]}),R({description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels)."},l))}function o(u){return{entry:{name:u.entry.name,params:{detailLevel:u.entry.params.detailLevel,channels:u.entry.params.channels,view:{name:u.entry.params.view.name,params:R({},u.entry.params.view.params)}}}}}e.createParams=function n(u){void 0===u&&(u={});var c=u.data,l=u.defaultView,d=u.channelParams,f=new Map;c&&c.entries.forEach(function(m){return f.set(m.dataId,m)});var p=c?c.entries.map(function(m){return[m.dataId,m.dataId]}):[];return{entry:D.Mapped(c?c.entries[0].dataId:"",p,function(m){return D.Group(a({entryData:f.get(m),defaultView:l,structure:c&&c.structure,channelParams:d}))})}},e.createEntryParams=a,e.copyParams=o,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var s=function(u){function c(l,d){var f=u.call(this,l,{})||this;return f.plugin=l,f.data=d,f.cache=MC.create(25),f.params={},f.lastLoci=Yr,f.ref="",f.cameraTargetObservable=f.plugin.canvas3d.didDraw.pipe(Yse(500,void 0,{leading:!0,trailing:!0}),yr(function(){var p;return null===(p=f.plugin.canvas3d)||void 0===p?void 0:p.camera.getSnapshot()}),Xse(function(p,h){return f.isCameraTargetSame(p,h)}),Yf(function(p){return void 0!==p})),f.cameraTargetSubscription=void 0,f.channels={},f._invTransform=me(),f.infoMap=new Map,f.data.entries.forEach(function(p){return f.infoMap.set(p.dataId,p)}),f.updateQueue=new Wat,f}return qt(c,u),Object.defineProperty(c.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),c.prototype.queryData=function(l){return ce(this,void 0,void 0,function(){var d,p,h,m,v,g,y,b;return le(this,function(_){switch(_.label){case 0:return d=o5(this.data.serverUrl,"".concat(this.info.kind,"/").concat(this.info.dataId.toLowerCase())),l?(p=l.max,d+="/box"+"/".concat(l.min.map(function(C){return Math.round(1e3*C)/1e3}).join(","))+"/".concat(p.map(function(C){return Math.round(1e3*C)/1e3}).join(","))):d+="/cell",h=this.params.entry.params.detailLevel,"auto"===this.params.entry.params.view.name&&this.params.entry.params.view.params.isSelection&&(h=this.params.entry.params.view.params.selectionDetailLevel),"camera-target"===this.params.entry.params.view.name&&l&&(h=this.decideDetail(l,this.params.entry.params.view.params.dynamicDetailLevel)),d+="?detail=".concat(h),(m=MC.get(this.cache,d))?[2,m.data]:(v=pn.getUrlAsset(this.plugin.managers.asset,d),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return g=_.sent(),[4,this.parseCif(g.data)];case 2:return(y=_.sent())?((b=MC.set(this.cache,d,{data:y,asset:g}))&&b.asset.dispose(),[2,y]):[2]}})})},c.prototype.parseCif=function(l){return ce(this,void 0,void 0,function(){var d,f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:return[4,this.plugin.runTask(Yl.parseBinary(l))];case 1:if((d=g.sent()).isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+d.toString()),[2];if(d.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];f={},p=1,g.label=2;case 2:return p<d.result.blocks.length?(m=Yl.schema.densityServer(h=d.result.blocks[p]),[4,this.plugin.runTask(hte(m))]):[3,5];case 3:v=g.sent(),f[h.header]=v,g.label=4;case 4:return p++,[3,2];case 5:return[2,f]}})})},c.prototype.updateParams=function(l,d){return void 0===d&&(d=!1),ce(this,void 0,void 0,function(){var f,p,h,m;return le(this,function(v){switch(v.label){case 0:return f=o(this.params),"off"!==(p=f.entry.params.view.name)&&"cell"!==p&&(f.entry.params.view.params.bottomLeft=l?.min||S.zero(),f.entry.params.view.params.topRight=l?.max||S.zero()),"auto"===p&&(f.entry.params.view.params.isSelection=d),m=(h=this.plugin.state.data).build().to(this.ref).update(f),[4,Sr.State.Update(this.plugin,{state:h,tree:m,options:{doNotUpdateCurrent:!0}})];case 1:return v.sent(),[2]}})})},c.prototype.getStructureRoot=function(){return this.plugin.state.data.select(wr.Generators.byRef(this.ref).rootOfType(ve.Molecule.Structure))[0]},c.prototype.register=function(l){var d=this;this.ref=l,this.subscribeObservable(this.plugin.state.events.object.removed,function(f){!ve.Molecule.Structure.is(f.obj)||!Re.is(d.lastLoci)||d.lastLoci.structure===f.obj.data&&(d.lastLoci=Yr)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(f){!ve.Molecule.Structure.is(f.oldObj)||!Re.is(d.lastLoci)||d.lastLoci.structure===f.oldObj.data&&(d.lastLoci=Yr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(f){if(d.plugin.state.data.tree.children.has(d.ref)){var p=f?f.loci:Yr;switch(d.params.entry.params.view.name){case"auto":d.updateAuto(p);break;case"selection-box":d.updateSelectionBox(p);break;default:d.lastLoci=p}}})},c.prototype.unregister=function(){for(var l=this.cache.entries.first;l;)l.value.data.asset.dispose(),l=l.next},c.prototype.isCameraTargetSame=function(l,d){if(!l||!d)return!1;var f=S.equals(l.target,d.target),p=S.squaredDistance(l.target,l.position),h=S.squaredDistance(d.target,d.position),m=Math.abs(p-h)/p<.001;return f&&m},c.prototype.cameraTargetDistance=function(l){return S.distance(l.target,l.position)},c.prototype.getBoxFromLoci=function(l){var d,f,p;if(pr.isEmpty(l)||Ps(l))return Nt();var h=this.plugin.helpers.substructureParent.get(l.structure,!0);if(!h)return Nt();var m=this.getStructureRoot();if(!m||(null===(d=m.obj)||void 0===d?void 0:d.data)!==(null===(f=h.obj)||void 0===f?void 0:f.data))return Nt();var v=Gv.get(null===(p=m.obj)||void 0===p?void 0:p.data.models[0]);v&&me.invert(this._invTransform,v);var g=Re.extendToWholeResidues(l),y=Re.getBoundary(g,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return 1===Re.size(g)&&Nt.expand(y,y,S.create(1,1,1)),y},c.prototype.updateAuto=function(l){var d=this;this.updateQueue.enqueue(function(){return ce(d,void 0,void 0,function(){return le(this,function(f){switch(f.label){case 0:return this.lastLoci=l,Ps(l)?[4,this.updateParams("x-ray"===this.info.kind?this.data.structure.boundary.box:void 0,!1)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this.updateParams(this.getBoxFromLoci(l),!0)];case 3:f.sent(),f.label=4;case 4:return[2]}})})})},c.prototype.updateSelectionBox=function(l){var d=this;this.updateQueue.enqueue(function(){return ce(d,void 0,void 0,function(){var f;return le(this,function(p){switch(p.label){case 0:return this.lastLoci=pr.areEqual(this.lastLoci,l)?Yr:l,f=this.getBoxFromLoci(this.lastLoci),[4,this.updateParams(f)];case 1:return p.sent(),[2]}})})})},c.prototype.updateCameraTarget=function(l){var d=this;this.updateQueue.enqueue(function(){return ce(d,void 0,void 0,function(){var f,p,h,m,v;return le(this,function(g){switch(g.label){case 0:f=null===(h=this.plugin.canvas3d)||void 0===h?void 0:h.props.camera.manualReset,g.label=1;case 1:return g.trys.push([1,,3,4]),f||null===(m=this.plugin.canvas3d)||void 0===m||m.setProps({camera:{manualReset:!0}}),p=this.boxFromCameraTarget(l,!0),[4,this.updateParams(p)];case 2:return g.sent(),[3,4];case 3:return f||null===(v=this.plugin.canvas3d)||void 0===v||v.setProps({camera:{manualReset:f}}),[7];case 4:return[2]}})})})},c.prototype.boxFromCameraTarget=function(l,d){var f,b,_,C,p=l.target,h=this.cameraTargetDistance(l),v=Math.tan(.5*l.fov)*h,g=null===(f=this.plugin.canvas3d)||void 0===f?void 0:f.camera.viewport;if(g&&g.width>g.height&&(v*=g.width/g.height),v*="camera-target"===this.params.entry.params.view.name?this.params.entry.params.view.params.radius:.5,d){var x=S.zero();Nt.size(x,this.data.structure.boundary.box),b=Math.min(v,.5*x[0]),_=Math.min(v,.5*x[1]),C=Math.min(v,.5*x[2])}else b=_=C=v;return Nt.create(S.create(p[0]-b,p[1]-_,p[2]-C),S.create(p[0]+b,p[1]+_,p[2]+C))},c.prototype.decideDetail=function(l,d){for(var f="x-ray"===this.info.kind?Nt.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce(function(g,y){return g*y},1),h=Nt.volume(l)/f,m=this.info.header.availablePrecisions.length-1,v=d;h<=.5&&v<m;)h*=2,v+=1;return v},c.prototype.update=function(l){return ce(this,void 0,void 0,function(){var d,f,p,h,m,v,g,y=this;return le(this,function(b){switch(b.label){case 0:switch(d="selection-box"===l.entry.params.view.name&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&"selection-box"!==this.params.entry.params.view.name,this.params=l,f=void 0,p=!1,"camera-target"!==l.entry.params.view.name&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),l.entry.params.view.name){case"off":p=!0;break;case"box":f=Nt.create(l.entry.params.view.params.bottomLeft,l.entry.params.view.params.topRight),p=Nt.volume(f)<1e-4;break;case"selection-box":f=d?this.getBoxFromLoci(this.lastLoci)||Nt():Nt.create(S.clone(l.entry.params.view.params.bottomLeft),S.clone(l.entry.params.view.params.topRight)),h=l.entry.params.view.params.radius,p=Nt.volume(f)<1e-4,Nt.expand(f,f,S.create(h,h,h));break;case"camera-target":this.cameraTargetSubscription||(this.cameraTargetSubscription=this.subscribeObservable(this.cameraTargetObservable,function(_){return y.updateCameraTarget(_)})),f=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":f="x-ray"===this.info.kind?this.data.structure.boundary.box:void 0;break;case"auto":(f=l.entry.params.view.params.isSelection||"x-ray"===this.info.kind?Nt.create(S.clone(l.entry.params.view.params.bottomLeft),S.clone(l.entry.params.view.params.topRight)):void 0)&&(p=Nt.volume(f)<1e-4,l.entry.params.view.params.isSelection&&Nt.expand(f,f,S.create(h=l.entry.params.view.params.radius,h,h)))}return p?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(f)];case 2:v=b.sent(),b.label=3;case 3:return(m=v)?(g=l.entry.params.channels,"x-ray"===this.info.kind?(this.channels["2fo-fc"]=this.createChannel(m["2FO-FC"]||nt.One,g["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(m["FO-FC"]||nt.One,g["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(m["FO-FC"]||nt.One,g["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(m.EM||nt.One,g.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},c.prototype.createChannel=function(l,d,f){return{data:l,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:"relative"===d.isoValue.kind?d.isoValue:nt.IsoValue.toRelative(d.isoValue,f)}},c.prototype.getDescription=function(){return"selection-box"===this.params.entry.params.view.name?"Selection":"camera-target"===this.params.entry.params.view.name?"Camera":"box"===this.params.entry.params.view.name?"Static Box":"cell"===this.params.entry.params.view.name?"Cell":""},c}(nn.WithSubscribers);e.Behavior=s}(Cc||(Cc={}));var ui=[Mm(0,0,0),Mm(1,0,0),Mm(1,1,0),Mm(0,1,0),Mm(0,0,1),Mm(1,0,1),Mm(1,1,1),Mm(0,1,1)],Yat=[ml(ui[0],ui[1]),ml(ui[1],ui[2]),ml(ui[2],ui[3]),ml(ui[3],ui[0]),ml(ui[4],ui[5]),ml(ui[5],ui[6]),ml(ui[6],ui[7]),ml(ui[7],ui[4]),ml(ui[0],ui[4]),ml(ui[1],ui[5]),ml(ui[2],ui[6]),ml(ui[3],ui[7])],Xat=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],Kat=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Gb=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],d6=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function Kse(e){return R(R({},e),{bottomLeft:Po(e.bottomLeft,[0,0,0]),topRight:Po(e.topRight,e.scalarField.space.dimensions)})}function Zse(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function Hb(e,t){var r=this;return Ve.create("Marching Cubes Mesh",function(n){return ce(r,void 0,void 0,function(){var a,i,c,l;return le(this,function(d){switch(d.label){case 0:return a=Kse(e),i=Zse(a),c=Math.min(262144,Math.max(i.dX*i.dY*i.dZ/32,1024)),l=function Zat(e,t){var r=Math.min(65536,4*e),n=qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(c,l,d){return++s,qe.add3(n,c,l,d)},addNormal:function(c,l,d){qe.add3(a,c,l,d)},addGroup:function(c){qe.add(i,c)},addTriangle:function(c,l,d,f){var p=c[l],h=c[d],m=c[f];p>=0&&h>=0&&m>=0&&(++u,qe.add3(o,p,h,m))},get:function(){var c=qe.compact(n,!0),l=qe.compact(a,!0),d=qe.compact(o,!0),f=qe.compact(i,!0);return Lt.create(c,d,l,f,s,u,t)}}}(c,t),[4,new Qse(n,l,a).run()];case 1:return d.sent(),[2,l.get()]}})})})}function f6(e,t){var r=this;return Ve.create("Marching Cubes Lines",function(n){return ce(r,void 0,void 0,function(){var a,i,c,l;return le(this,function(d){switch(d.label){case 0:return a=Kse(e),i=Zse(a),c=Math.min(262144,Math.max(i.dX*i.dY*i.dZ/32,1024)),l=function Qat(e,t){var r=qe.create(Float32Array,3,e),n=qe.create(Float32Array,1,e),a=qe.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return qe.add3(r,o,s,u)},addNormal:function(){return Cy},addGroup:function(o){qe.add(n,o)},addTriangle:function(o,s,u,c,l){o[s]>=0&&o[u]>=0&&o[c]>=0&&(d6[s][u]&l&&(++i,qe.add2(a,o[s],o[u])),d6[u][c]&l&&(++i,qe.add2(a,o[u],o[c])),d6[s][c]&l&&(++i,qe.add2(a,o[s],o[c])))},get:function(){for(var o=qe.compact(r,!0),s=qe.compact(a,!0),u=qe.compact(n,!0),c=Ru.create(i,i/10,t),l=0;l<i;++l){var d=s[2*l],f=s[2*l+1];c.add(o[3*d],o[3*d+1],o[3*d+2],o[3*f],o[3*f+1],o[3*f+2],u[d])}return c.getLines()}}}(c,t),[4,new Qse(n,l,a).run()];case 1:return d.sent(),[2,l.get()]}})})})}var Qse=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new $at(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ce(this,void 0,void 0,function(){var t,r;return le(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ce(this,void 0,void 0,function(){return le(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),$at=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){this.verticesOnEdges.fill(0,t%2==0?0:3*this.nX*this.nY,t%2==0?3*this.nX*this.nY:this.verticesOnEdges.length)},e.prototype.interpolate=function(t){var r=Xat[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=Yat[t],u=s.a,c=s.b,l=u.i+this.i,d=u.j+this.j,f=u.k+this.k,p=c.i+this.i,h=c.j+this.j,m=c.k+this.k,v=o(i,l,d,f),g=o(i,p,h,m),y=(this.isoLevel-v)/(v-g);if(this.idField){var b=this.idFieldGet(this.idField,l,d,f),_=this.idFieldGet(this.idField,p,h,m),C=y<.5?b:_;if(-1===C&&(C=y<.5?_:b),-2===C)return-1;this.builder.addGroup(C)}else this.builder.addGroup(0);var x=this.builder.addVertex(l+y*(l-p),d+y*(d-h),f+y*(f-m));this.verticesOnEdges[n]=x+1;var A=o(i,Math.max(0,l-1),d,f)-o(i,Math.min(this.nX-1,l+1),d,f),T=o(i,l,Math.max(0,d-1),f)-o(i,l,Math.min(this.nY-1,d+1),f),w=o(i,l,d,Math.max(0,f-1))-o(i,l,d,Math.min(this.nZ,f+1)),F=A+y*(A-(o(i,Math.max(0,p-1),h,m)-o(i,Math.min(this.nX-1,p+1),h,m))),N=T+y*(T-(o(i,p,Math.max(0,h-1),m)-o(i,p,Math.min(this.nY-1,h+1),m))),j=w+y*(w-(o(i,p,h,Math.max(0,m-1))-o(i,p,h,Math.min(this.nZ-1,m+1))));return this.isoLevel>=0?this.builder.addNormal(F,N,j):this.builder.addNormal(-F,-N,-j),x},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),0!==i&&255!==i){this.i=t,this.j=r,this.k=n;var o=Kat[i];(1&o)>0&&(this.vertList[0]=this.interpolate(0)),(2&o)>0&&(this.vertList[1]=this.interpolate(1)),(4&o)>0&&(this.vertList[2]=this.interpolate(2)),(8&o)>0&&(this.vertList[3]=this.interpolate(3)),(16&o)>0&&(this.vertList[4]=this.interpolate(4)),(32&o)>0&&(this.vertList[5]=this.interpolate(5)),(64&o)>0&&(this.vertList[6]=this.interpolate(6)),(128&o)>0&&(this.vertList[7]=this.interpolate(7)),(256&o)>0&&(this.vertList[8]=this.interpolate(8)),(512&o)>0&&(this.vertList[9]=this.interpolate(9)),(1024&o)>0&&(this.vertList[10]=this.interpolate(10)),(2048&o)>0&&(this.vertList[11]=this.interpolate(11));for(var s=Gb[i],u=0;u<s.length;u+=3){var c=s[u],l=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,c,l,d,a):this.builder.addTriangle(this.vertList,d,l,c,a)}}},e}();function Rg(e,t){var v,g,y,b,_,A,T,w,I,M,r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.dispose,l=e.geometryUtils,d=l.updateValues,f=l.updateBoundingSphere,p=l.updateRenderableState,h=l.createPositionIterator,m=df.create(),C=Object.assign({},r),x=Oi.createEmpty(),E=-1;function N(H){if(m.createNew){if(I=a(b,_),!H)throw new Error("expected geometry to be given");v=function Jat(e,t,r,n,a,i){var o=Xi.getUtils(t),u=o.createRenderableState,l=(0,o.createValues)(t,aB(),r,n,a),d=u(a);return fb(t.kind,l,d,i)}(0,H,I,y,g,t),M=h(H,v.values)}else{if(!v)throw new Error("expected renderObject to be available");if(m.updateTransform){var G=(I=a(b,_)).instanceCount,U=I.groupCount;g.instanceGranularity?La(G,"instance",v.values):La(G*U,"groupInstance",v.values)}else I.reset();if(m.createGeometry){if(!H)throw new Error("expected geometry to be given");O.updateIfChanged(v.values.drawCount,Xi.getDrawCount(H)),O.updateIfChanged(v.values.uVertexCount,Xi.getVertexCount(H)),O.updateIfChanged(v.values.uGroupCount,Xi.getGroupCount(H))}(m.updateTransform||m.createGeometry)&&(f(v.values,H||w),M=h(H||w,v.values)),m.updateSize&&"uSize"in v.values&&Ip(I,y.size,v.values),m.updateColor&&pc(I,M,y.color,v.values),d(v.values,g),p(v.state,g)}C=g,x=y,A=b,T=_,H&&(w=H,E+=1)}function k(H,G){return ku(H)?G(xe.ofBounds(0,C.instanceGranularity?I.instanceCount:I.groupCount*I.instanceCount)):C.instanceGranularity?function j(H,G,U,Q){var W=!1;if(nt.Cell.isLoci(H)){if(nt.Cell.isLociEmpty(H)||!nt.areEquivalent(H.volume,G))return!1;Q(xe.ofSingleton(0))&&(W=!0)}else if(nt.Segment.isLoci(H)){if(nt.Segment.isLociEmpty(H)||!nt.areEquivalent(H.volume,G)||!Xe.has(H.segments,U))return!1;Q(xe.ofSingleton(0))&&(W=!0)}return W}(H,A,T,G):o(H,A,T,C,G)}return{get groupCount(){return I?I.count:0},get renderObject(){return v},get geometryVersion(){return E},createOrUpdate:function(H,G,U,Q){return void 0===U&&(U={}),ce(this,void 0,void 0,function(){var W;return le(this,function(K){return function F(H,G,U,Q){if(!U&&!A)throw new Error("missing volume");g=Object.assign({},C,G),y=H,b=U,_=Q,df.reset(m),v?(!nt.areEquivalent(b,A)||_!==T)&&(m.createNew=!0):m.createNew=!0,m.createNew?m.createGeometry=!0:(s(m,U,g,C,y,x),Nu.areEqual(H.color,x.color)||(m.updateColor=!0),m.createGeometry&&(m.updateColor=!0),g.instanceGranularity!==C.instanceGranularity&&(m.updateTransform=!0))}(G,U,Q?.volume||A,Q?.key||T),m.createGeometry?[2,WA(W=n(H,b,_,y,g,w))?W.then(N):N(W)]:(N(),[2])})})},getLoci:function(H){return v?i(H,A,T,C,v.id):Yr},eachLocation:function(H){for(I.reset();I.hasNext;){var G=I.move();H(G.location,G.isSecondary)}},mark:function(H,G){return _r.mark(v,H,G,k)},setVisibility:function(H){_r.setVisibility(v,H)},setAlphaFactor:function(H){_r.setAlphaFactor(v,H)},setPickable:function(H){_r.setPickable(v,H)},setColorOnly:function(H){_r.setColorOnly(v,H)},setTransform:function(H,G){_r.setTransform(v,H,G)},setOverpaint:function(H){return _r.setOverpaint(v,H,k,!0)},setTransparency:function(H){return _r.setTransparency(v,H,k,!0)},setSubstance:function(H){return _r.setSubstance(v,H,k,!0)},setClipping:function(H){return _r.setClipping(v,H,k,!0)},setThemeStrength:function(H){_r.setThemeStrength(v,H)},destroy:function(){c?.(w),v&&(v.state.disposed=!0,v=void 0)},mustRecreate:u}}function OC(e,t,r,n,a,i){void 0===i&&(i=function(){return[-1]});var h,m,v,g,o=0,s=t.webgl,u=new Cn,c=new dr.GeometryState,l=Vp(),d=[],f=dr.createState(),p=new Map,y=Oi.createEmpty();return{label:e,get groupCount(){var E=0;return p.forEach(function(I){I.renderObject&&(E+=I.groupCount)}),E},get props(){return g},get params(){return v},get state(){return f},get theme(){return y},get geometryVersion(){return c.version},renderObjects:d,updated:u,createOrUpdate:function _(E,I){var M=this;void 0===E&&(E={}),I&&I!==h&&(v=r(t,I),h=I,g||(g=D.getDefaultValues(v)));var F=WL(Object.assign({},g,E),h);return Object.assign(g,E,F),m=i(g),Ve.create("Creating or updating VolumeRepresentation",function(N){return ce(M,void 0,void 0,function(){var j,k,H,G,U;return le(this,function(Q){switch(Q.label){case 0:j=new Set(p.keys()),k=0,H=m.length,Q.label=1;case 1:return k<H?(j.delete(G=m[k]),U=function b(E,I){var M;return ce(this,void 0,void 0,function(){var F;return le(this,function(N){return(F=p.get(I))?!(null===(M=F.mustRecreate)||void 0===M)&&M.call(F,{volume:h,key:I},g,s)&&(F.destroy(),F=n(l,h,I,g,s),p.set(I,F)):(F=n(l,h,I,g,s),p.set(I,F)),[2,F.createOrUpdate({webgl:s,runtime:E},y,g,{volume:h,key:I})]})})}(N,G),U?[4,U]:[3,3]):[3,4];case 2:Q.sent(),Q.label=3;case 3:return++k,[3,1];case 4:return j.forEach(function(W){var K;null===(K=p.get(W))||void 0===K||K.destroy(),p.delete(W)}),d.length=0,p.forEach(function(W){W.renderObject&&(d.push(W.renderObject),c.add(W.renderObject.id,W.geometryVersion))}),c.snapshot(),u.next(o++),[2]}})})})},setState:function A(E){var I=E.visible,M=E.alphaFactor,F=E.pickable,N=E.overpaint,j=E.transparency,k=E.substance,H=E.clipping,G=E.transform,U=E.themeStrength,Q=E.syncManually,W=E.markerActions,K={};void 0!==I&&(K.visible=I),void 0!==M&&(K.alphaFactor=M),void 0!==F&&(K.pickable=F),void 0!==N&&(K.overpaint=N),void 0!==j&&(K.transparency=j),void 0!==k&&(K.substance=k),void 0!==H&&(K.clipping=H),void 0!==U&&(K.themeStrength=U),void 0!==G&&!me.areEqual(G,f.transform,gn)&&(K.transform=G),void 0!==Q&&(K.syncManually=Q),void 0!==W&&(K.markerActions=W),p.forEach(function(ne){return function x(E,I){void 0!==I.visible&&E&&E.setVisibility(I.visible),void 0!==I.alphaFactor&&E&&E.setAlphaFactor(I.alphaFactor),void 0!==I.pickable&&E&&E.setPickable(I.pickable),void 0!==I.overpaint&&E&&E.setOverpaint(I.overpaint),void 0!==I.transparency&&E&&E.setTransparency(I.transparency),void 0!==I.substance&&E&&E.setSubstance(I.substance),void 0!==I.clipping&&E&&E.setClipping(I.clipping),void 0!==I.transform&&E&&E.setTransform(I.transform),void 0!==I.themeStrength&&E&&E.setThemeStrength(I.themeStrength)}(ne,K)}),dr.updateState(f,E)},setTheme:function T(E){y=E},getLoci:function(E){var I=Yr;return p.forEach(function(M){var F=M.getLoci(E);Ps(F)||(I=F)}),I},getAllLoci:function(){return[a(h,g)]},eachLocation:function(E){p.forEach(function(I){I.eachLocation(E)})},mark:function C(E,I){var M=!1;return p.forEach(function(F){M=F.mark(E,I)||M}),M},destroy:function w(){p.forEach(function(E){return E.destroy()}),p.clear()}}}R({},ot.Params);var eit="\nprecision highp float;\nprecision highp int;\n\n#if __VERSION__ == 100\n    precision highp sampler2D;\n    uniform sampler2D tTexture;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tTexture;\n#endif\n\nvoid main(void) {\n    #if __VERSION__ == 100\n        gl_FragColor = texture2D(tTexture, vec2(0.5));\n    #else\n        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);\n    #endif\n}\n",tit=R(R({},Di),{tTexture:Xt("texture","rgba","float","nearest")}),vl="histopyramid-sum";var FC,NC,lI=new Uint8Array(4),$se=new Int32Array(4),oit="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInputLevel;\n\n// previous level used to evaluate the new level\n#if __VERSION__ == 100\n    uniform sampler2D tPreviousLevel;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tPreviousLevel;\n#endif\n\n// inverted size of the previous level texture.\nuniform float uSize;\nuniform float uTexSize;\nuniform bool uFirst;\n\n#include common\n\nvoid main(void) {\n    float k = 0.5 * uSize;\n    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;\n\n    #if __VERSION__ == 100\n        float a, b, c, d;\n\n        if (uFirst) {\n            a = texture2D(tInputLevel, position).r * 255.0;\n            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;\n            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;\n            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;\n        } else {\n            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);\n            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);\n            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);\n            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);\n        }\n        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);\n    #else\n        int a, b, c, d;\n\n        if (uFirst) {\n            a = int(texture2D(tInputLevel, position).r * 255.0);\n            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);\n            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);\n            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);\n        } else {\n            a = texture2D(tPreviousLevel, position).r;\n            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;\n            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;\n            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;\n        }\n        gl_FragColor = ivec4(a + b + c + d);\n    #endif\n}\n",sit=R(R({},Di),{tInputLevel:Xt("texture","rgba","float","nearest"),tPreviousLevel:Xt("texture","rgba","float","nearest"),uSize:Te("f"),uTexSize:Te("f"),uFirst:Te("b")}),Rm="histogram-pyramid";function lit(e,t){var r=Math.pow(2,t),n="level".concat(t),a=e.isWebGL2?dI(n,e,"image-int32","alpha","int","nearest"):dI(n,e,"image-uint8","rgba","ubyte","nearest");a.define(r,r);var i=function fit(e,t){var r="".concat(Rm,"-").concat(e);return t.namedFramebuffers[r]}(n,e);return i||(i=Jse(n,e),a.attachFramebuffer(i,0)),{texture:a,framebuffer:i}}function Jse(e,t){var r="".concat(Rm,"-").concat(e);return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function dI(e,t,r,n,a,i){var o="".concat(Rm,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function pit(e,t,r,n){Ct&&e.timer.mark("createHistogramPyramid");var a=e.gl,i=e.state,o=t.getWidth();if(o!==t.getHeight()||!v2(o))throw new Error("inputTexture must be of square power-of-two size");var u=Math.ceil(Math.log(o)/Math.log(2)),c=Math.pow(2,u),l=Math.pow(2,u),d=Math.pow(2,u-1),f=e.isWebGL2?dI("pyramid",e,"image-int32","alpha","int","nearest"):dI("pyramid",e,"image-uint8","rgba","ubyte","nearest");f.define(l,d);var p=Jse("pyramid",e);f.attachFramebuffer(p,0),i.viewport(0,0,l,d),$t(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var h=[],m=0;m<u;++m)h.push(lit(e,m));var v=function uit(e,t,r){if(e.namedComputeRenderables[Rm]){var n=e.namedComputeRenderables[Rm].values;O.update(n.tInputLevel,t),O.update(n.tPreviousLevel,r),e.namedComputeRenderables[Rm].update()}else e.namedComputeRenderables[Rm]=function cit(e,t,r){var n=R(R({},Ei),{tInputLevel:O.create(t),tPreviousLevel:O.create(r),uSize:O.create(0),uTexSize:O.create(0),uFirst:O.create(!0)}),a=R({},sit);return Wa(qa(e,"triangles",Un("reduction",No,oit,{},{0:"ivec4"}),a,n),n)}(e,t,r);return e.namedComputeRenderables[Rm]}(e,t,h[0].texture);i.currentRenderItemId=-1,function dit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e);var g=0;for(m=0;m<u;m++){var y=u-1-m;h[y].framebuffer.bind();var _=Math.pow(2,y);O.update(v.values.uSize,Math.pow(2,m+1)/c),O.update(v.values.uTexSize,_),O.updateIfChanged(v.values.uFirst,0===m),m>0&&(O.update(v.values.tPreviousLevel,h[u-m].texture),v.update()),i.currentRenderItemId=-1,i.viewport(0,0,_,_),i.scissor(0,0,_,_),$t(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),v.render(),f.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,g,0,0,0,_,_),f.unbind(0),g+=_}a.finish(),Ct&&e.timer.markEnd("createHistogramPyramid");var C=Math.max(1,function iit(e,t){Ct&&e.timer.mark("getHistopyramidSum");var r=e.gl,n=e.state,a=e.resources,i=function rit(e,t){return e.namedComputeRenderables[vl]?(O.update(e.namedComputeRenderables[vl].values.tTexture,t),e.namedComputeRenderables[vl].update()):e.namedComputeRenderables[vl]=function nit(e,t){var r=R(R({},Ei),{tTexture:O.create(t)}),n=R({},tit);return Wa(qa(e,"triangles",Un("sum",No,eit,{},{0:"ivec4"}),n,r),r)}(e,t),e.namedComputeRenderables[vl]}(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[vl]||(e.namedFramebuffers[vl]=a.framebuffer());var o=e.namedFramebuffers[vl];return e.namedTextures[vl]||(e.namedTextures[vl]=$t(r)?a.texture("image-int32","rgba","int","nearest"):a.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[vl].define(1,1)),e.namedTextures[vl].attachFramebuffer(o,0),function ait(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e),n.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,$t(r)?$se:lI),e.unbindFramebuffer(),Ct&&e.timer.markEnd("getHistopyramidSum"),$t(r)?$se[0]:_B(lI[0],lI[1],lI[2])}(e,h[0].texture));return{pyramidTex:f,count:C,height:Math.ceil(C/Math.pow(2,u)),levels:u,scale:r}}function hit(){if(void 0!==FC)return FC;for(var e=(FC=Ti(256,1,Uint8Array)).array,t=0,r=Gb.length;t<r;++t)e[t]=Gb[t].length/3;return FC}function mit(){if(void 0!==NC)return NC;for(var e=(NC=Ti(4096,1,Uint8Array)).array,t=0,r=Gb.length;t<r;++t)for(var n=0;n<16;++n)e[16*t+n]=n<Gb[t].length?Gb[t][n]:255;return NC}var vit="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#if __VERSION__ == 100\n    uniform sampler2D tActiveVoxelsPyramid;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tActiveVoxelsPyramid;\n#endif\n\nuniform sampler2D tActiveVoxelsBase;\nuniform sampler2D tVolumeData;\nuniform sampler2D tTriIndices;\n\nuniform float uIsoValue;\nuniform float uLevels;\nuniform float uSize;\nuniform float uCount;\nuniform bool uInvert;\n\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform mat4 uGridTransform;\n\n// scale to volume data coord\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord + 0.5 / (texDim / uScale));\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvec4 voxelPadded(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nint idot2(const in ivec2 a, const in ivec2 b) {\n    return a.x * b.x + a.y * b.y;\n}\n\nint idot4(const in ivec4 a, const in ivec4 b) {\n    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n}\n\n#if __VERSION__ == 100\n    int pyramidVoxel(vec2 pos) {\n        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));\n    }\n#else\n    int pyramidVoxel(vec2 pos) {\n        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;\n    }\n#endif\n\nvec4 baseVoxel(vec2 pos) {\n    return texture2D(tActiveVoxelsBase, pos / uSize);\n}\n\nvec4 getGroup(const in vec3 p) {\n    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding\n    // note that we swap x and z because the texture is flipped around y\n    #if defined(dAxisOrder_012)\n        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210\n    #elif defined(dAxisOrder_021)\n        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120\n    #elif defined(dAxisOrder_102)\n        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201\n    #elif defined(dAxisOrder_120)\n        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021\n    #elif defined(dAxisOrder_201)\n        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102\n    #elif defined(dAxisOrder_210)\n        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012\n    #endif\n    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);\n}\n\nvoid main(void) {\n    // get 1D index\n    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);\n\n    // ignore 1D indices outside of the grid\n    if(vI >= int(uCount)) discard;\n\n    ivec2 offset = ivec2(int(uSize) - 2, 0);\n\n    int start = 0;\n    ivec4 starts = ivec4(0);\n    ivec4 ends = ivec4(0);\n    int diff = 2;\n    ivec4 m = ivec4(0);\n    ivec2 position = ivec2(0);\n    ivec4 vI4 = ivec4(vI);\n\n    ivec2 relativePosition = ivec2(0);\n    int end = 0;\n    ivec2 pos1 = ivec2(0);\n    ivec2 pos2 = ivec2(0);\n    ivec2 pos3 = ivec2(0);\n    ivec2 pos4 = ivec2(0);\n    ivec3 vI3 = ivec3(vI);\n    ivec3 mask = ivec3(0);\n\n    // traverse the different levels of the pyramid\n    for(int i = 1; i < 14; i++) {\n        if(float(i) >= uLevels) break;\n\n        offset.x -= diff;\n        diff *= 2;\n        relativePosition = position + offset;\n\n        end = start + pyramidVoxel(vec2(relativePosition));\n        pos1 = ivec2(relativePosition);\n        starts.x = start;\n        ends.x = end;\n        pos2 = ivec2(relativePosition + ivec2(1, 0));\n        starts.y = ends.x;\n        ends.y = ends.x + pyramidVoxel(vec2(pos2));\n        pos3 = relativePosition + ivec2(0, 1);\n        starts.z = ends.y;\n        ends.z = ends.y + pyramidVoxel(vec2(pos3));\n        pos4 = relativePosition + ivec2(1, 1);\n        starts.w = ends.z;\n        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n        m = ivec4(mask, 1 - int(any(bvec3(mask))));\n\n        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n        start = idot4(m, starts);\n        position = 2 * (relativePosition - offset);\n    }\n\n    end = start + int(baseVoxel(vec2(position)).r * 255.0);\n    pos1 = position;\n    starts.x = start;\n    ends.x = end;\n    pos2 = position + ivec2(1, 0);\n    starts.y = ends.x;\n    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);\n    pos3 = position + ivec2(0, 1);\n    starts.z = ends.y;\n    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);\n    pos4 = position + ivec2(1, 1);\n    starts.w = ends.z;\n    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n    m = ivec4(mask, 1 - int(any(bvec3(mask))));\n    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n\n    vec2 coord2d = (vec2(position) / uSize) / uScale;\n    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);\n\n    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);\n\n    // current vertex for the up to 15 MC cases\n    int currentVertex = vI - idot4(m, starts);\n\n    // ensure winding-order is the same for negative and positive iso-levels\n    if (uInvert) {\n        int v = imod(currentVertex + 1, 3);\n        if (v == 1) currentVertex += 2;\n        else if (v == 0) currentVertex -= 2;\n    }\n\n    // get index into triIndices table\n    int mcIndex = 16 * int(edgeIndex) + currentVertex;\n    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);\n\n    // bit mask to avoid conditionals (see comment below) for getting MC case corner\n    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));\n\n    // get edge value masks\n    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));\n    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));\n    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));\n\n    // apply bit masks\n    vec3 b0 = coord3d +\n                m1.y * c1 +\n                m1.z * c2 +\n                m1.w * c3 +\n                m2.x * c4 +\n                m2.y * c5 +\n                m2.z * c6 +\n                m2.w * c7 +\n                m3.y * c1 +\n                m3.z * c2 +\n                m3.w * c3;\n    vec3 b1 = coord3d +\n                m1.x * c1 +\n                m1.y * c2 +\n                m1.z * c3 +\n                m2.x * c5 +\n                m2.y * c6 +\n                m2.z * c7 +\n                m2.w * c4 +\n                m3.x * c4 +\n                m3.y * c5 +\n                m3.z * c6 +\n                m3.w * c7;\n\n    // the conditionals that are avoided by above bitmasks\n    // vec3 b0 = coord3d;\n    // vec3 b1 = coord3d;\n    // if (mcIndex == 0.0) {\n    //     b1 += c1;\n    // } else if (mcIndex == 1.0) {\n    //     b0 += c1; b1 += c2;\n    // } else if (mcIndex == 2.0) {\n    //     b0 += c2; b1 += c3;\n    // } else if (mcIndex == 3.0) {\n    //     b0 += c3;\n    // } else if (mcIndex == 4.0) {\n    //     b0 += c4; b1 += c5;\n    // } else if (mcIndex == 5.0) {\n    //     b0 += c5; b1 += c6;\n    // } else if (mcIndex == 6.0) {\n    //     b0 += c6; b1 += c7;\n    // } else if (mcIndex == 7.0) {\n    //     b0 += c7; b1 += c4;\n    // } else if (mcIndex == 8.0) {\n    //     b1 += c4;\n    // } else if (mcIndex == 9.0) {\n    //     b0 += c1; b1 += c5;\n    // } else if (mcIndex == 10.0) {\n    //     b0 += c2; b1 += c6;\n    // } else if (mcIndex == 11.0) {\n    //     b0 += c3; b1 += c7;\n    // }\n    // b0 = floor(b0 + 0.5);\n    // b1 = floor(b1 + 0.5);\n\n    vec4 d0 = voxel(b0);\n    vec4 d1 = voxel(b1);\n\n    float v0 = d0.a;\n    float v1 = d1.a;\n\n    float t = (uIsoValue - v0) / (v0 - v1);\n    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;\n\n    // group id\n    #if __VERSION__ == 100 || defined(dConstantGroup)\n        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)\n        // ensure a constant group id per triangle as needed\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(coord3d);\n        #endif\n    #else\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);\n        #endif\n    #endif\n\n    // normals from gradients\n    vec3 n0 = -normalize(vec3(\n        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,\n        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,\n        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a\n    ));\n    vec3 n1 = -normalize(vec3(\n        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,\n        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,\n        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a\n    ));\n    gl_FragData[2].xyz = -vec3(\n        n0.x + t * (n0.x - n1.x),\n        n0.y + t * (n0.y - n1.y),\n        n0.z + t * (n0.z - n1.z)\n    );\n\n    // ensure normal-direction is the same for negative and positive iso-levels\n    if (uInvert) {\n        gl_FragData[2].xyz *= -1.0;\n    }\n\n    // apply normal matrix\n    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));\n}\n",git="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tTriCount;\nuniform sampler2D tVolumeData;\n\nuniform float uIsoValue;\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord);\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvoid main(void) {\n    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;\n    vec3 posXYZ = index3dFrom2d(uv);\n\n    // get MC case as the sum of corners that are below the given iso level\n    float c = step(voxel(posXYZ).a, uIsoValue)\n        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)\n        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)\n        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)\n        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)\n        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)\n        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)\n        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);\n    c *= step(c, 254.);\n\n    // handle out of bounds positions\n    posXYZ += 1.0;\n    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)\n    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)\n        c = 0.0;\n\n    // get total triangles to generate for calculated MC case from triCount texture\n    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;\n    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);\n}\n",yit=R(R({},Di),{tTriCount:Xt("image-uint8","alpha","ubyte","nearest"),tVolumeData:Xt("texture","rgba","ubyte","nearest"),uIsoValue:Te("f"),uGridDim:Te("v3"),uGridTexDim:Te("v3"),uScale:Te("v2")}),ud="active-voxels";var xit=R(R({},Di),{tTriIndices:Xt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:Xt("texture","rgba","float","nearest"),tActiveVoxelsBase:Xt("texture","rgba","float","nearest"),tVolumeData:Xt("texture","rgba","ubyte","nearest"),uIsoValue:Te("f"),uSize:Te("f"),uLevels:Te("f"),uCount:Te("f"),uInvert:Te("b"),uGridDim:Te("v3"),uGridTexDim:Te("v3"),uGridTransform:Te("m4"),uScale:Te("v2"),dPackedGroup:Ut("boolean"),dAxisOrder:Ut("string",["012","021","102","120","201","210"]),dConstantGroup:Ut("boolean")}),Om="isosurface";function fI(e,t,r,n,a,i,o,s,u,c,l,d,f,p){Ct&&e.timer.mark("extractIsosurface");var h=function Cit(e,t,r,n,a,i){Ct&&e.timer.mark("calcActiveVoxels");var o=e.gl,s=e.state,u=e.resources,c=t.getWidth(),l=t.getHeight();e.namedFramebuffers[ud]||(e.namedFramebuffers[ud]=u.framebuffer());var d=e.namedFramebuffers[ud];d.bind(),e.namedTextures[ud]||(e.namedTextures[ud]=u.texture("image-uint8","rgba","ubyte","nearest"));var f=e.namedTextures[ud];f.define(c,l);var p=function bit(e,t,r,n,a,i){if(e.namedComputeRenderables[ud]){var o=e.namedComputeRenderables[ud].values;O.update(o.uQuadScale,i),O.update(o.tVolumeData,t),O.updateIfChanged(o.uIsoValue,a),O.update(o.uGridDim,r),O.update(o.uGridTexDim,n),O.update(o.uScale,i),e.namedComputeRenderables[ud].update()}else e.namedComputeRenderables[ud]=function _it(e,t,r,n,a,i){var o=R(R({},Ei),{tTriCount:O.create(hit()),uQuadScale:O.create(i),tVolumeData:O.create(t),uIsoValue:O.create(a),uGridDim:O.create(r),uGridTexDim:O.create(n),uScale:O.create(i)}),s=R({},yit);return Wa(qa(e,"triangles",Un("active-voxels",No,git),s,o),o)}(e,t,r,n,a,i);return e.namedComputeRenderables[ud]}(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,f.attachFramebuffer(d,0),function Sit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e),s.viewport(0,0,c,l),s.scissor(0,0,c,l),o.clear(o.COLOR_BUFFER_BIT),s.scissor(0,0,n[0],n[1]),p.render(),o.finish(),Ct&&e.timer.markEnd("calcActiveVoxels"),f}(e,t,r,n,o,a),v=function Dit(e,t,r,n,a,i,o,s,u,c,l,d,f,p,h){var m=e.extensions.drawBuffers;if(!m)throw new Error("need WebGL draw buffers");Ct&&e.timer.mark("createIsosurfaceBuffers");var v=e.gl,g=e.state,y=e.resources,b=e.extensions,_=n.pyramidTex,C=n.height,x=n.levels,A=n.scale,T=n.count,w=_.getWidth();e.namedFramebuffers[Om]||(e.namedFramebuffers[Om]=y.framebuffer());var E=e.namedFramebuffers[Om];$t(v)?(f||(f=y.texture("image-float32","rgba","float","nearest")),p||(p=y.texture("image-uint8","rgba","ubyte","nearest")),h||(h=b.colorBufferHalfFloat&&b.textureHalfFloat?y.texture("image-float16","rgba","fp16","nearest"):y.texture("image-float32","rgba","float","nearest"))):(f||(f=y.texture("image-float32","rgba","float","nearest")),p||(p=y.texture("image-float32","rgba","float","nearest")),h||(h=y.texture("image-float32","rgba","float","nearest"))),f.define(w,C),p.define(w,C),h.define(w,C),f.attachFramebuffer(E,0),p.attachFramebuffer(E,1),h.attachFramebuffer(E,2);var I=function wit(e,t,r,n,a,i,o,s,u,c,l,d,f,p,h){if(e.namedComputeRenderables[Om]){var m=e.namedComputeRenderables[Om].values;O.update(m.tActiveVoxelsPyramid,t),O.update(m.tActiveVoxelsBase,r),O.update(m.tVolumeData,n),O.updateIfChanged(m.uIsoValue,s),O.updateIfChanged(m.uSize,Math.pow(2,u)),O.updateIfChanged(m.uLevels,u),O.updateIfChanged(m.uCount,l),O.updateIfChanged(m.uInvert,d),O.update(m.uGridDim,a),O.update(m.uGridTexDim,i),O.update(m.uGridTransform,o),O.update(m.uScale,c),O.updateIfChanged(m.dPackedGroup,f),O.updateIfChanged(m.dAxisOrder,p.join("")),O.updateIfChanged(m.dConstantGroup,h),e.namedComputeRenderables[Om].update()}else e.namedComputeRenderables[Om]=function Ait(e,t,r,n,a,i,o,s,u,c,l,d,f,p,h){var m=R(R({},Ei),{tTriIndices:O.create(mit()),tActiveVoxelsPyramid:O.create(t),tActiveVoxelsBase:O.create(r),tVolumeData:O.create(n),uIsoValue:O.create(s),uSize:O.create(Math.pow(2,u)),uLevels:O.create(u),uCount:O.create(l),uInvert:O.create(d),uGridDim:O.create(a),uGridTexDim:O.create(i),uGridTransform:O.create(o),uScale:O.create(c),dPackedGroup:O.create(f),dAxisOrder:O.create(p.join("")),dConstantGroup:O.create(h)}),v=R({},xit);return Wa(qa(e,"triangles",Un("isosurface",No,vit,{drawBuffers:"required"}),v,m),m)}(e,t,r,n,a,i,o,s,u,c,l,d,f,p,h);return e.namedComputeRenderables[Om]}(e,_,t,r,a,i,o,s,x,A,T,u,c,l,d);return e.state.currentRenderItemId=-1,E.bind(),m.drawBuffers([m.COLOR_ATTACHMENT0,m.COLOR_ATTACHMENT1,m.COLOR_ATTACHMENT2]),function Tit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e),g.viewport(0,0,w,C),v.clear(v.COLOR_BUFFER_BIT),I.render(),v.finish(),Ct&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:f,groupTexture:p,normalTexture:h,vertexCount:T}}(e,h,t,pit(e,h,a,n),r,n,i,o,s,u,c,l,d,f,p);return Ct&&e.timer.markEnd("extractIsosurface"),v}var eue={isoValue:nt.IsoValueParam},kC=1;function p6(e,t){return!(e.grid.cells.data.length<Math.pow(10,3))&&vm(e.grid.cells.space.dimensions,kC).powerOfTwoSize<=t.maxTextureSize/2}function Iit(e,t,r,n,a){return n.tryUseGpu&&a&&function Eit(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(a)&&p6(t,a)?function Oit(e){return Rg({defaultProps:D.getDefaultValues(v6),createGeometry:Rit,createLocationIterator:function(t){return Ln(t.grid.cells.data.length,1,1,function(){return fc})},getLoci:h6,eachLocation:m6,setUpdateState:function(t,r,n,a){nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:xs.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!p6(t.volume,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}(e):function Mit(e){return Rg({defaultProps:D.getDefaultValues(v6),createGeometry:Pit,createLocationIterator:function(t){return Ln(t.grid.cells.data.length,1,1,function(){return fc})},getLoci:h6,eachLocation:m6,setUpdateState:function(t,r,n,a){nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Lt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&p6(t.volume,n)}},e)}(e)}function tue(e,t){return nt.Isosurface.Loci(e,t.isoValue)}function h6(e,t,r,n,a){var o=e.groupId;if(a===e.objectId){var s=nt.PickingGranularity.get(t);return"volume"===s?nt.Loci(t):"object"===s?nt.Isosurface.Loci(t,n.isoValue):nt.Cell.Loci(t,xe.ofSingleton(o))}return Yr}function m6(e,t,r,n,a){return vE(e,t,{isoValue:n.isoValue},a)}function Pit(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return e.runtime.update({message:"Marching cubes..."}),o=rc(new Int32Array(t.grid.cells.data.length)),[4,Hb({isoLevel:nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Cr.create(t.grid.cells.space,Cr.Data1(o))},i).runAsChild(e.runtime)];case 1:return s=c.sent(),u=Yi.getGridToCartesianTransform(t.grid),Lt.transform(s,u),e.webgl&&!e.webgl.isWebGL2?(Lt.uniformTriangleGroup(s,!1),O.updateIfChanged(s.varyingGroup,!1)):O.updateIfChanged(s.varyingGroup,!0),s.setBoundingSphere(nt.Isosurface.getBoundingSphere(t,a.isoValue)),[2,s]}})})}var g6,v6=R(R(R(R({},Lt.Params),xs.Params),eue),{quality:R(R({},Lt.Params.quality),{isEssential:!1}),tryUseGpu:D.Boolean(!0)});function Rit(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A;return le(this,function(T){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return t.grid.cells.data.length<=1?[2,xs.createEmpty(i)]:(c=(o=t.grid.stats).max-(u=o.min),l=nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,d=(l-u)/c,f=g6.get(t,e.webgl),p=f.texture,h=f.gridDimension,m=f.gridTexDim,v=f.gridTexScale,g=f.transform,y=t.grid.cells.space.axisOrderSlowToFast,b=i?.doubleBuffer.get(),_=fI(e.webgl,p,h,m,v,g,d,l<0,!1,y,!0,b?.vertex,b?.group,b?.normal),C=t.grid.cells.data.length,x=nt.getBoundingSphere(t),(A=xs.create(_.vertexCount,C,_.vertexTexture,_.groupTexture,_.normalTexture,x,i)).meta.webgl=e.webgl,[2,A])})})}function Fit(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:return e.runtime.update({message:"Marching cubes..."}),o=rc(new Int32Array(t.grid.cells.data.length)),[4,f6({isoLevel:nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Cr.create(t.grid.cells.space,Cr.Data1(o))},i).runAsChild(e.runtime)];case 1:return s=c.sent(),u=Yi.getGridToCartesianTransform(t.grid),ca.transform(s,u),s.setBoundingSphere(nt.Isosurface.getBoundingSphere(t,a.isoValue)),[2,s]}})})}!function(e){var t="volume-isosurface-texture";e.descriptor=ec({name:t}),e.get=function r(n,a){var i=a.resources,o=Yi.getGridToCartesianTransform(n.grid),s=S.clone(n.grid.cells.space.dimensions),u=vm(s,kC),c=u.width,l=u.height,d=u.powerOfTwoSize,f=S.create(c,l,0),p=Ne.create(c/d,l/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var h=n._propertyData[t];h.define(d,d),h.load(sae(n,"data",kC),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return h.destroy()}}])}return s[0]+=kC,s[1]+=kC,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}}(g6||(g6={}));var rue=R(R(R({},ca.Params),eue),{quality:R(R({},ca.Params.quality),{isEssential:!1}),sizeFactor:D.Numeric(3,{min:0,max:10,step:.1})});function Nit(e){return Rg({defaultProps:D.getDefaultValues(rue),createGeometry:Fit,createLocationIterator:function(t){return Ln(t.grid.cells.data.length,1,1,function(){return fc})},getLoci:h6,eachLocation:m6,setUpdateState:function(t,r,n,a){nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:ca.Utils},e)}var nue={solid:function(e,t){return OC("Isosurface mesh",e,t,Iit,tue)},wireframe:function(e,t){return OC("Isosurface wireframe",e,t,Nit,tue)}},aue=R(R(R({},v6),rue),{visuals:D.MultiSelect(["solid"],D.objectToOptions(nue)),bumpFrequency:D.Numeric(1,{min:0,max:10,step:.1},ot.ShadingCategory)}),Lit={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:function Bit(e,t){return dr.createMulti("Isosurface",e,t,dr.StateBuilder,nue)},getParams:function kit(e,t){var r=D.clone(aue);return r.isoValue=nt.createIsoValueParam(nt.IsoValue.relative(2),t.grid.stats),r},defaultValues:D.getDefaultValues(aue),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!nt.Segmentation.get(e)}};function Uit(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j,k,H,G,U,Q,W,K,ne,X,L,Y;return le(this,function(Z){for((o=a.dimension.name,c=(u=t.grid.cells).space,l=u.data,f=(d=t.grid.stats).min,p=d.max,h=nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,m="color"in n.color?n.color.color(fc,!1):dt(16777215),v=dt.toRgbNormalized(m),g=v[0],y=v[1],b=v[2],_=y6(t.grid,a),C=_.width,x=_.height,A=_.x,T=_.y,w=_.z,E=_.x0,I=_.y0,M=_.z0,F=_.nx,N=_.ny,j=_.nz,k=new Float32Array("x"===o?[A,0,0,A,T,0,A,0,w,A,T,w]:"y"===o?[0,T,0,A,T,0,0,T,w,A,T,w]:[0,0,w,0,T,w,A,0,w,A,T,w]),H=new Uint8Array(C*x*4),G=function Vit(e,t){for(var r=e.cells.space,n=y6(e,t),o=n.x0,s=n.y0,u=n.z0,c=n.nx,l=n.ny,d=n.nz,f=new Uint8Array(n.width*n.height*4),p=0,h=s;h<l;++h)for(var m=o;m<c;++m)for(var v=u;v<d;++v)VS(r.dataOffset(m,h,v),f,p),p+=4;return f}(t.grid,a),U=0,Q=I);Q<N;++Q)for(W=E;W<F;++W)for(K=M;K<j;++K)ne=c.get(l,W,Q,K),H[U]=g*(X=(ne-f)/(p-f))*2*255,H[U+1]=y*X*2*255,H[U+2]=b*X*2*255,H[U+3]=ne>=h?255:0,U+=4;return L={width:C,height:x,array:H,flipY:!0},Y={width:C,height:x,array:G,flipY:!0},ng(Yi.getGridToCartesianTransform(t.grid),k,0,4),[2,Up.create(L,k,Y,i)]})})}function y6(e,t){var o,s,u,c,l,r=t.dimension,n=r.name,a=r.params,d=0,f=0,p=0,h=e.cells.space.dimensions,m=h[0],v=h[1],g=h[2];return"x"===n?(c=v-1,l=g-1,o=g,s=v,m=(d=u=a)+1):"y"===n?(u=m-1,l=g-1,o=g,s=m,v=(f=c=a)+1):(u=m-1,c=v-1,o=m,s=v,g=(p=l=a)+1),{width:o,height:s,x:u,y:c,z:l,x0:d,y0:f,z0:p,nx:m,ny:v,nz:g}}function iue(e,t){var r=function zit(e,t){for(var r=e.cells.space,n=y6(e,t),o=n.x0,s=n.y0,u=n.z0,c=n.nx,l=n.ny,d=n.nz,f=new Uint32Array(n.width*n.height),p=0,h=s;h<l;++h)for(var m=o;m<c;++m)for(var v=u;v<d;++v)f[p]=r.dataOffset(m,h,v),p+=1;return f}(e.grid,t);return nt.Cell.Loci(e,Xe.ofUnsortedArray(r))}function Git(e,t,r,n,a){var o=e.groupId;if(a===e.objectId){var s=nt.PickingGranularity.get(t);return"volume"===s?nt.Loci(t):"object"===s?iue(t,n):nt.Cell.Loci(t,xe.ofSingleton(o))}return Yr}function Hit(e,t,r,n,a){return vE(e,t,void 0,a)}var b6=R(R({},Up.Params),{quality:R(R({},Up.Params.quality),{isEssential:!1}),dimension:D.MappedStatic("x",{x:D.Numeric(0,{min:0,max:0,step:1}),y:D.Numeric(0,{min:0,max:0,step:1}),z:D.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:nt.IsoValueParam});function qit(e){return Rg({defaultProps:D.getDefaultValues(b6),createGeometry:Uit,createLocationIterator:function(t){return Ln(t.grid.cells.data.length,1,1,function(){return fc})},getLoci:Git,eachLocation:Hit,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!Nu.areEqual(i.color,o.color)},geometryUtils:R(R({},Up.Utils),{createRenderableState:function(t){var r=Up.Utils.createRenderableState(t);return oue(r,t),r},updateRenderableState:oue})},e)}function oue(e,t){Up.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}var Yit={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:function Wit(e,t){return OC("Slice",e,t,qit,iue)},getParams:function jit(e,t){var r=D.clone(b6),n=t.grid.cells.space.dimensions;return r.dimension=D.MappedStatic("x",{x:D.Numeric(0,{min:0,max:n[0]-1,step:1}),y:D.Numeric(0,{min:0,max:n[1]-1,step:1}),z:D.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=nt.createIsoValueParam(nt.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r},defaultValues:D.getDefaultValues(b6),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!nt.Segmentation.get(e)}};function sue(e,t){var r=Nt();return Nt.add(r,e),Nt.transform(r,r,t),r}function Xit(e,t,r,n){var a=r.grid.cells.space.dimensions,i=vm(a);if(Math.max(i.width,i.height)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=sae(r,"normals"),c=Yi.getGridToCartesianTransform(r.grid),l=sue(a,c),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=uue(r.grid);return mc.create(l,a,c,f.unitToCartn,f.cellDim,d,r.grid.stats,!1,r.grid.cells.space.axisOrderSlowToFast,n)}function uue(e){if("matrix"===e.transform.kind)return{unitToCartn:me.mul(me(),e.transform.matrix,me.fromScaling(me(),e.cells.space.dimensions)),cellDim:me.getScaling(S(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Nt.size(S(),t);return{unitToCartn:me.mul3(me(),e.transform.cell.fromFractional,me.fromTranslation(me(),t.min),me.fromScaling(me(),r)),cellDim:S.div(S(),e.transform.cell.size,e.cells.space.dimensions)}}function Kit(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=function pXe(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,c=u[0],l=u[1],d=u[2],f=n.dataOffset,p=new Uint8Array(c*l*d*4),h={array:p,width:c,height:l,depth:d},m=o-s,v=S(),g=S(),y=c-1,b=l-1,_=d-1,C=0,x=0;x<d;++x)for(var A=0;A<l;++A)for(var T=0;T<c;++T){var w=f(T,A,x);hE(v,a[f(Math.max(0,T-1),A,x)],a[f(T,Math.max(0,A-1),x)],a[f(T,A,Math.max(0,x-1))]),hE(g,a[f(Math.min(y,T+1),A,x)],a[f(T,Math.min(b,A+1),x)],a[f(T,A,Math.min(_,x+1))]),nae(v,aae(v,v,g)),iae(v,mE(v,v,.5),.5),oae(mE(v,v,255),p,C),p[C+3]=Math.round((a[w]-s)/m*255),C+=4}return h}(r),o=Yi.getGridToCartesianTransform(r.grid),s=sue(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var c=uue(r.grid);return mc.create(s,a,o,c.unitToCartn,c.cellDim,u,r.grid.stats,!1,r.grid.cells.space.axisOrderSlowToFast,n)}function Zit(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var s;return le(this,function(u){if(void 0===(s=e.webgl))throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,s.isWebGL2?Kit(0,s,t,i):Xit(0,s,t,i)]})})}function Qit(e,t){return nt.Loci(e)}function $it(e,t,r,n,a){return a===e.objectId?nt.Cell.Loci(t,xe.ofSingleton(e.groupId)):Yr}function Jit(e,t,r,n,a){return vE(e,t,void 0,a)}var _6=R(R({},mc.Params),{quality:R(R({},mc.Params.quality),{isEssential:!1})});function tot(e){return Rg({defaultProps:D.getDefaultValues(_6),createGeometry:Zit,createLocationIterator:function(t){return Ln(t.grid.cells.data.length,1,1,function(){return fc})},getLoci:$it,eachLocation:Jit,setUpdateState:function(t,r,n,a){},geometryUtils:mc.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var not={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:function rot(e,t){return OC("Direct Volume",e,t,tot,Qit)},getParams:function eot(e,t){var r=D.clone(_6);return r.controlPoints.getVolume=function(){return t},r},defaultValues:D.getDefaultValues(_6),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!nt.Segmentation.get(e)}},aot={segments:D.Converted(function(e){return e.map(function(t){return"".concat(t)})},function(e){return e.map(function(t){return parseInt(t)})},D.MultiSelect(["0"],D.arrayToOptions(["0"]),{isEssential:!0}))},BC=1;function S6(e,t){return!(e.grid.cells.data.length<Math.pow(10,3))&&vm(e.grid.cells.space.dimensions,BC).powerOfTwoSize<=t.maxTextureSize/2}var oot=me();function cue(e,t){var r=Yi.getGridToCartesianTransform(e),n=me.fromTranslation(oot,t.min);return me.mul(me(),r,n)}function sot(e,t,r,n,a){return n.tryUseGpu&&a&&function iot(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(a)&&S6(t,a)?function hot(e){return Rg({defaultProps:D.getDefaultValues(C6),createGeometry:pot,createLocationIterator:function(t,r){var n=nt.Segment.Location(t,r);return Ln(t.grid.cells.data.length,1,1,function(){return n})},getLoci:lue,eachLocation:due,setUpdateState:function(t,r,n,a){},geometryUtils:xs.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!S6(t.volume,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}(e):function dot(e){return Rg({defaultProps:D.getDefaultValues(C6),createGeometry:lot,createLocationIterator:function(t,r){var n=nt.Segment.Location(t,r);return Ln(t.grid.cells.data.length,1,1,function(){return n})},getLoci:lue,eachLocation:due,setUpdateState:function(t,r,n,a){},geometryUtils:Lt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&S6(t.volume,n)}},e)}(e)}function uot(e,t){return nt.Segment.Loci(e,t.segments)}function lue(e,t,r,n,a){var o=e.groupId;if(a===e.objectId){var s=nt.PickingGranularity.get(t);return"volume"===s?nt.Loci(t):"object"===s?nt.Segment.Loci(t,[r]):nt.Cell.Loci(t,xe.ofSingleton(o))}return Yr}function due(e,t,r,n,a){return vE(e,t,{segments:Xe.ofSingleton(r)},a)}function lot(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l,d,f;return le(this,function(p){switch(p.label){case 0:if(!(o=nt.Segmentation.get(t)))throw new Error("missing volume segmentation");return e.runtime.update({message:"Marching cubes..."}),s=Nt.clone(o.bounds[r]),Nt.expand(s,s,S.create(2,2,2)),u=Array.from(o.segments.get(r).values()),c=function cot(e,t,r){for(var n=r.data,a=r.space.dataOffset,i=Nt.size(S(),t),o=i[0],s=i[1],u=i[2],c=o-1,l=s-1,d=u-1,f=t.min,p=f[0],h=f[1],m=f[2],v=t.max,g=v[0],y=v[1],b=v[2],_=sr([],r.space.axisOrderSlowToFast,!0),C=Cr.Space(i,_,Uint8Array),x=Cr.create(C,C.create()),A=x.data,T=C.set,w=0;w<u;++w)for(var E=0;E<s;++E)for(var I=0;I<o;++I){var M=e.includes(n[a(I+p,E+h,w+m)])?255:0,F=e.includes(n[a(Math.min(c+g,I+1+p),E+h,w+m)])?255:0,N=e.includes(n[a(Math.max(0,I-1+p),E+h,w+m)])?255:0,j=e.includes(n[a(I+p,Math.min(l+y,E+1+h),w+m)])?255:0,k=e.includes(n[a(I+p,Math.max(0,E-1+h),w+m)])?255:0,H=e.includes(n[a(I+p,E+h,Math.min(d+b,w+1+m))])?255:0,G=e.includes(n[a(I+p,E+h,Math.max(0,w-1+m))])?255:0;T(A,I,E,w,Math.round((M+M+F+N+j+k+H+G)/8))}return x}(u,s,t.grid.cells),l=rc(new Int32Array(c.data.length)),[4,Hb({isoLevel:128,scalarField:c,idField:Cr.create(c.space,Cr.Data1(l))},i).runAsChild(e.runtime)];case 1:return d=p.sent(),f=cue(t.grid,s),Lt.transform(d,f),e.webgl&&!e.webgl.isWebGL2?(Lt.uniformTriangleGroup(d,!1),O.updateIfChanged(d.varyingGroup,!1)):O.updateIfChanged(d.varyingGroup,!0),d.setBoundingSphere(nt.Segment.getBoundingSphere(t,[r])),[2,d]}})})}var C6=R(R(R(R({},Lt.Params),xs.Params),aot),{quality:R(R({},Lt.Params.quality),{isEssential:!1}),tryUseGpu:D.Boolean(!0)}),x6="segment-texture";function pot(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h;return le(this,function(g){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh");return t.grid.cells.data.length<=1?[2,xs.createEmpty(i)]:(o=function fot(e,t,r){var n=nt.Segmentation.get(e);if(!n)throw new Error("missing volume segmentation");var a=r.resources,i=Nt.clone(n.bounds[t]);Nt.expand(i,i,S.create(2,2,2));var o=cue(e.grid,i),s=Nt.size(S(),i),u=vm(s,BC),c=u.width,l=u.height,d=u.powerOfTwoSize,f=S.create(c,l,0),p=Ne.create(c/d,l/d);if(d>r.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");r.namedTextures[x6]||(r.namedTextures[x6]=a.texture("image-uint8","alpha","ubyte","linear"));var h=r.namedTextures[x6];h.define(d,d);var m=Array.from(n.segments.get(t).values());return h.load(function hXe(e,t,r,n){void 0===n&&(n=0);for(var a=e.grid.cells.data,i=Nt.size(S(),r),o=e.grid.cells.space.dataOffset,s=vm(i,n),u=s.width,c=s.height,d=new Uint8Array(u*c*1),f={array:d,width:u,height:c},p=i[0],h=i[1],m=i[2],v=p-1,g=h-1,y=m-1,b=p+n,_=h+n,C=r.min,x=C[0],A=C[1],T=C[2],w=r.max,E=w[0],I=w[1],M=w[2],F=0;F<m;++F)for(var N=0;N<h;++N)for(var j=0;j<p;++j){var k=Math.floor(F*b%u/b),U=1*(Math.floor(F*b/u)*_*u+N*u+(k*b+j)),Q=t.includes(a[o(j+x,N+A,F+T)])?255:0,W=t.includes(a[o(Math.min(v+E,j+1+x),N+A,F+T)])?255:0,K=t.includes(a[o(Math.max(0,j-1+x),N+A,F+T)])?255:0,ne=t.includes(a[o(j+x,Math.min(g+I,N+1+A),F+T)])?255:0,X=t.includes(a[o(j+x,Math.max(0,N-1+A),F+T)])?255:0,L=t.includes(a[o(j+x,N+A,Math.min(y+M,F+1+T))])?255:0,Y=t.includes(a[o(j+x,N+A,Math.max(0,F-1+T))])?255:0;d[U]=Math.round((Q+Q+W+K+ne+X+L+Y)/8)}return f}(e,m,i,BC),!0),s[0]+=BC,s[1]+=BC,{texture:h,transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}(t,r,e.webgl),s=o.texture,u=o.gridDimension,c=o.gridTexDim,l=o.gridTexScale,d=o.transform,f=t.grid.cells.space.axisOrderSlowToFast,p=i?.doubleBuffer.get(),h=fI(e.webgl,s,u,c,l,d,.5,!1,!1,f,!0,p?.vertex,p?.group,p?.normal),[2,xs.create(h.vertexCount,t.grid.cells.data.length,h.vertexTexture,h.groupTexture,h.normalTexture,nt.Segment.getBoundingSphere(t,[r]),i)])})})}function mot(e){return Xe.ofUnsortedArray(e.segments)}var fue={segment:function(e,t){return OC("Segment mesh",e,t,sot,uot,mot)}},pue=R(R({},C6),{visuals:D.MultiSelect(["segment"],D.objectToOptions(fue)),bumpFrequency:D.Numeric(1,{min:0,max:10,step:.1},ot.ShadingCategory)}),yot={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:function got(e,t){return dr.createMulti("Segment",e,t,dr.StateBuilder,fue)},getParams:function vot(e,t){var r=D.clone(pue),n=nt.Segmentation.get(t);if(n){var a=Array.from(n.segments.keys());r.segments=D.Converted(function(i){return i.map(function(o){return"".concat(o)})},function(i){return i.map(function(o){return parseInt(o)})},D.MultiSelect(a.map(function(i){return"".concat(i)}),D.arrayToOptions(a.map(function(i){return"".concat(i)})),{isEssential:!0}))}return r},defaultValues:D.getDefaultValues(pue),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!!nt.Segmentation.get(e)}},pI=function(e){function t(){var r=e.call(this)||this;return Ks(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return qt(t,e),t}(fae);function hue(e,t,r,n){e.push({source:"em"===t?{name:"em",params:{isoValue:nt.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}!function(e){e.BuiltIn={isosurface:Lit,slice:Yit,"direct-volume":not,segment:yot}}(pI||(pI={}));var bot=au.build({display:{name:"Volume Streaming"},from:ve.Molecule.Structure,params:function(e,t){var r=function Mat(e,t){if(void 0===t&&(t="x-ray"),!e)return t;var r=e.models[0];return Pn.is(r.sourceData)?ir.hasEmMap(r)?"em":ir.hasXrayMap(r)?"x-ray":ir.isFromEm(r)?"em":ir.isFromXray(r)?"x-ray":t:t}(e&&e.data),n=function Fat(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return function Rat(e){var t=[];if(!Pn.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)"EMDB"===a.value(o).toUpperCase()&&"associated EM volume"===i.value(o)&&t.push(n.value(o));return t}(r);case"x-ray":return function Oat(e){return[e.entryId]}(r)}}(r,e&&e.data);return{method:D.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:D.ObjectList({id:D.Text(n[0]||"")},function(a){return a.id},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:D.Select("em"===r?"auto":"selection-box",Cc.ViewTypeOptions),options:D.Group({serverUrl:D.Text(t.config.get(ma.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:D.Text("",{isHidden:!0}),emContourProvider:D.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:D.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(ma.VolumeStreaming.CanStream);return n?n(e.data,r):1===e.data.models.length&&ir.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return Ve.create("Volume Streaming",function(i){return ce(void 0,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x;return le(this,function(A){switch(A.label){case 0:o=[],s=0,u=a.entries.length,A.label=1;case 1:return s<u?(c=a.entries[s].id.toLowerCase(),l=void 0,"em"!==a.method?[3,14]:c.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return A.sent(),[4,Bat(t,i,c)];case 3:d=A.sent(),f=0,p=d.length,A.label=4;case 4:if(!(f<p))return[3,10];h=d[f],m=void 0,A.label=5;case 5:return A.trys.push([5,7,,8]),[4,qse(a.options.emContourProvider,t,i,h)];case 6:return m=A.sent(),[3,8];case 7:return v=A.sent(),console.info("Could not get map info for ".concat(h,": ").concat(v)),[3,9];case 8:hue(o,a.method,h,m||0),A.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return A.trys.push([11,13,,14]),[4,qse(a.options.emContourProvider,t,i,c)];case 12:return l=A.sent(),[3,14];case 13:return g=A.sent(),console.info("Could not get map info for ".concat(c,": ").concat(g)),[3,15];case 14:hue(o,a.method,c,l||0),A.label=15;case 15:return++s,[3,1];case 16:return[4,(y=n.build().to(r).applyOrUpdateTagged(Cc.RootTag,Cot,{serverUrl:a.options.serverUrl,entries:o})).commit()];case 17:return A.sent(),(b=y.selector).isOk?(_=n.tree.children.get(b.ref),_?.size>0?[4,t.managers.structure.hierarchy.remove(_?.toArray())]:[3,19]):[2];case 18:A.sent(),A.label=19;case 19:return C=b.cell.obj,x=n.build().to(y.ref).apply(mue,D.getDefaultValues(Cc.createParams({data:C.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),"em"===a.method?x.apply(hI,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(x.apply(hI,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),x.apply(hI,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),x.apply(hI,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(x).runInContext(i)];case 20:return A.sent(),[2]}})})})}),_ot=au.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:Cc,isApplicable:function(e){return"selection-box"===e.data.params.entry.params.view.name}})(function(e,t){var n=e.ref,a=e.state,i=e.a.data.params;if("selection-box"===i.entry.params.view.name){var o=Nt.create(S.clone(i.entry.params.view.params.bottomLeft),S.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Nt.expand(o,o,S.create(s,s,s));var u=R(R({},i),{entry:{name:i.entry.name,params:R(R({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),Sot={dataId:D.Text(""),source:D.MappedStatic("x-ray",{em:D.Group({isoValue:nt.createIsoValueParam(nt.IsoValue.relative(1))}),"x-ray":D.Group({})})},Cot=kt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ve.Molecule.Structure,to:c6,params:function(e){return{serverUrl:D.Text("https://ds.litemol.org"),entries:D.ObjectList(Sot,function(t){return t.dataId},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return Ve.create("",function(a){return ce(void 0,void 0,void 0,function(){var i,o,s,u,c,l,d;return le(this,function(p){switch(p.label){case 0:i=[],o=0,s=n.entries.length,p.label=1;case 1:return o<s?(c=(u=n.entries[o]).dataId,l="em"===u.source.name?u.source.params.isoValue:nt.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return p.sent(),[4,t.fetch({url:o5(n.serverUrl,"".concat(u.source.name,"/").concat(c.toLocaleLowerCase())),type:"json"}).runInContext(a)];case 3:d=p.sent(),i.push({dataId:c,kind:u.source.name,header:d,emDefaultContourLevel:l}),p.label=4;case 4:return++o,[3,1];case 5:return[2,new c6({serverUrl:n.serverUrl,entries:i,structure:r.data},{label:"Volume Server",description:"".concat(i.map(function(h){return h.dataId}).join(", "))})]}})})})}}),mue=kt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:c6,to:Cc,params:function(e){return Cc.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var r=e.newParams;return e.oldParams.entry.params.view===r.entry.params.view||"selection-box"===r.entry.params.view.name||"camera-target"===r.entry.params.view.name||"off"===r.entry.params.view.name},apply:function(e,t){var r=e.a,n=e.params;return Ve.create("Volume streaming",function(a){return ce(void 0,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return[4,(i=new Cc.Behavior(t,r.data)).update(n)];case 1:return o.sent(),[2,new Cc(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this,n=e.b,a=e.oldParams,i=e.newParams;return Ve.create("Update Volume Streaming",function(o){return ce(t,void 0,void 0,function(){var s,u;return le(this,function(c){switch(c.label){case 0:return a.entry.name!==i.entry.name&&"em"in i.entry.params.channels&&(s=n.data.infoMap.get(i.entry.name).emDefaultContourLevel)&&(i.entry.params.channels.em.isoValue=s),[4,n.data.update(i)];case 1:return u=c.sent()?rt.UpdateResult.Updated:rt.UpdateResult.Unchanged,n.description=n.data.getDescription(),[2,u]}})})})}}),hI=kt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:Cc,to:ve.Volume.Representation3D,params:{channel:D.Select("em",Cc.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return Ve.create("Volume Representation",function(i){return ce(void 0,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return(o=r.data.channels[n.channel])?(s=vue(r.data,n.channel),c=s.type.params||{},(l=(u=pI.BuiltIn.isosurface).factory(R({webgl:null===(p=t.canvas3d)||void 0===p?void 0:p.webgl},t.representation.volume.themes),u.getParams)).setTheme(Oi.create(t.representation.volume.themes,{volume:o.data},s)),d=null===(h=a.getAncestorOfType(ve.Molecule.Structure))||void 0===h?void 0:h.data,f=0===d?.models.length?void 0:Gv.get(d?.models[0]),[4,l.createOrUpdate(c,o.data).runInContext(i)]):[2,ua.Null];case 1:return m.sent(),f&&l.setState({transform:f}),[2,new ve.Volume.Representation3D({repr:l,sourceData:o.data},{label:"".concat(Math.round(100*o.isoValue.relativeValue)/100," \u03c3 [").concat(n.channel,"]")})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return Ve.create("Volume Representation",function(o){return ce(void 0,void 0,void 0,function(){var s,u,c,l;return le(this,function(d){switch(d.label){case 0:return(s=r.data.channels[a.channel])?(u=n.data.repr.state.visible,c=vue(r.data,a.channel),l=R(R({},n.data.repr.props),c.type.params),n.data.repr.setTheme(Oi.create(t.representation.volume.themes,{volume:s.data},c)),[4,n.data.repr.createOrUpdate(l,s.data).runInContext(o)]):[2,rt.UpdateResult.Unchanged];case 1:return d.sent(),n.data.repr.setState({visible:u}),n.data.sourceData=s.data,[2,rt.UpdateResult.Updated]}})})})}});function vue(e,t){var r=e.channels[t];return pf.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var or,vI,xot=vp.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:D.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x;return le(this,function(A){switch(A.label){case 0:if((n=r.plugin.managers.snapshot.state.entries).size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,(o=Math.ceil(t.current/r.params.transtionDurationInMs))===i&&o++,o%=n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(c=s.data.tree.transforms,l=u.data.tree.transforms,f=(d=r.plugin.state.data).build(),p=0,h=c;p<h.length;p++)for(m=h[p],v=0,g=l;v<g.length;v++)(y=g[v]).ref===m.ref&&y.version!==m.version&&(b=ln.fromJSON(m),_=ln.fromJSON(y),(C=d.cells.get(m.ref))&&(void 0,x=b.transformer.definition.interpolate?b.transformer.definition.interpolate(b.params,_.params,a,r.plugin):a<=.5?b.params:_.params,p2(C,x)||f.to(m.ref).update(x)));return[4,Sr.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return A.sent(),[2,{kind:"next",state:{}}]}})})}}),wot=vp.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:D.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return le(this,function(d){for(a=(n=r.state.data).select(wr.Generators.ofType(ve.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)!(n.select(wr.Generators.ofTransformer(et.Representation.SpinStructureRepresentation3D,(c=u[s]).transform.ref)).length>0)&&(o=!0,i.to(c.transform.ref).apply(et.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(wr.Generators.ofType(ve.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(0!==a.length){for(var i=n.build(),o=0,s=a;o<s.length;o++)i.delete(s[o].transform.ref);return i.commit()}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,u,c,l,d;return le(this,function(f){switch(f.label){case 0:if(0===(i=(a=r.plugin.state.data).select(wr.Generators.ofTransformer(et.Representation.SpinStructureRepresentation3D))).length)return[2,{kind:"finished"}];for(o=a.build(),u=(e.t+(t.current-t.lastApplied)/r.params.durationInMs)%1,c=0,l=i;c<l.length;c++)o.to(d=l[c]).update(R(R({},null===(n=d.params)||void 0===n?void 0:n.values),{t:u}));return[4,Sr.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),mI=S(),gue=S(),yue=yn(),Aot=vp.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:D.Numeric(4e3,{min:100,max:2e4,step:100}),speed:D.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:D.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}},initialState:function(e,t){return{snapshot:t.canvas3d.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;null===(n=r.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s,u;return le(this,function(c){return 0===t.current?[2,{kind:"next",state:e}]:(i=e.snapshot).radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?(null===(n=t.animation)||void 0===n?void 0:n.currentFrame)/(t.animation.frameCount+1):ao(t.current/r.params.durationInMs,0,1),s=Math.sin(o*r.params.speed*Math.PI*2)*Zr(r.params.angle),S.sub(mI,i.position,i.target),S.normalize(gue,i.up),yn.setAxisAngle(yue,gue,s),S.transformQuat(mI,mI,yue),u=S.add(S(),i.target,mI),null===(a=r.plugin.canvas3d)||void 0===a||a.requestCameraReset({snapshot:R(R({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}])})})}});function nh(...e){const t=Z_(e),r=function Vwe(e,t){return"number"==typeof lF(e)?e.pop():t}(e,1/0),n=e;return n.length?1===n.length?$u(n[0]):wA(r)(no(n,t)):Pd}function bue(e,t=l6){return _i((r,n)=>{let a=null,i=null,o=null;const s=()=>{if(a){a.unsubscribe(),a=null;const c=i;i=null,n.next(c)}};function u(){const c=o+e,l=t.now();if(l<c)return a=this.schedule(void 0,c-l),void n.add(a);s()}r.subscribe(Si(n,c=>{i=c,o=t.now(),a||(a=t.schedule(u,e),n.add(a))},()=>{s(),n.complete()},void 0,()=>{i=a=null}))})}!function(e){e.Action=function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}},e.Behavior=function r(n,a){return void 0===a&&(a={}),{transformer:n,defaultParams:a}}}(or||(or={})),function(e){var t=function(){function r(){this.providers=Jc().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var c=u.value;c.isApplicable(n)&&(c.isHidden||(i.push([c.descriptor.name,c.label]),this.defaultAutoAttachValues.get(c.descriptor.name)&&o.push(c.descriptor.name)),a[c.descriptor.name]=D.Group(R({},c.getParams(n)),{label:c.label,isHidden:c.isHidden}))}return{autoAttach:D.MultiSelect(o,i),properties:D.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){if(!this.providers.get(n))throw new Error("Custom property '".concat(n,"' is not registered."));return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t}(vI||(vI={}));var Dot=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){return this.dataState.build().toRoot().apply(MJ,t,r).commit({revertOnError:!0})},e.prototype.download=function(t,r){return this.dataState.build().toRoot().apply(IJ,t,r).commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){return this.dataState.build().toRoot().apply(PJ,t,r).commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n,a,i;return ce(this,void 0,void 0,function(){var o,s;return le(this,function(u){switch(u.label){case 0:return[4,this.dataState.build().toRoot().apply(RJ,t,r).commit({revertOnError:!0})];case 1:return o=u.sent(),s=Vb(null!==(i=null===(a=null===(n=t.file)||void 0===n?void 0:n.file)||void 0===a?void 0:a.name)&&void 0!==i?i:""),[2,{data:o,fileInfo:s}]}})})},e}(),Eot=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=bf.auto,Ks(bf,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return"string"==typeof t?null!==(r=bf[t])&&void 0!==r?r:sN(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return D.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?D.Group(o.params(t,this.plugin)):D.EmptyGroup())}return 0===r.length?D.MappedStatic("",{"":D.EmptyGroup()}):D.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),y2(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i,a=this,o=this.resolveProvider(r);if(o){var u=Mo.resolveAndCheck(this.plugin.state.data,t);if(!u)return void(S2||console.warn("Applying structure repr. provider to bad cell."));var c=(null===(i=o.params)||void 0===i?void 0:i.call(o,u.obj,this.plugin))||{},l=n||(o.params?D.getDefaultValues(c):{}),d=this.plugin.config.get(ma.Structure.DefaultRepresentationPresetParams);l=D.merge(c,d,l);var f=Ve.create("".concat(o.display.name),function(){return o.apply(u,l,a.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return ce(this,void 0,void 0,function(){var a,i;return le(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),(i=this.buildRepresentation(a,t,r,n))?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(r){var s=null===(o=null===(i=Mo.resolveAndCheck(this.dataState,r))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data;if(s){var u=iI(this.plugin,s,n);return a?.tag?t.to(r).applyOrUpdateTagged(a.tag,PE,u,{state:a?.initialState}).selector:t.to(r).apply(PE,u,{state:a?.initialState}).selector}}},e}();function Fm(e){return e}!function(e){e.CommonParams=function(t,r){return{modelProperties:D.Optional(D.Group(rt.getParamDefinition(et.Model.CustomModelProperties,void 0,r))),structureProperties:D.Optional(D.Group(rt.getParamDefinition(et.Model.CustomStructureProperties,void 0,r))),representationPreset:D.Optional(D.Text("auto"))}}}(Fm||(Fm={}));var gI=Fm.CommonParams,_ue=Fm({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:function(e,t){return R({model:D.Optional(D.Group(rt.getParamDefinition(et.Model.ModelFromTrajectory,e,t))),showUnitcell:D.Optional(D.Boolean(!1)),structure:D.Optional(lg.getParams(void 0,"assembly").type),representationPresetParams:D.Optional(D.Group(Os.CommonParams))},gI(e,t))},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return[4,(n=r.builders.structure).createModel(e,t.model)];case 1:return a=f.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=f.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=f.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=f.sent(),void 0===t.showUnitcell||t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return c=f.sent(),[3,7];case 6:c=void 0,f.label=7;case 7:return u=c,l=t.representationPreset||r.config.get(ma.Structure.DefaultRepresentationPreset)||bf.auto.id,[4,r.builders.structure.representation.applyPreset(s,l,t.representationPresetParams)];case 8:return d=f.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:d}]}})})}}),Mot=Fm({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:function(e){return e.data.frameCount>1},params:function(e,t){return R({useDefaultIfSingleModel:D.Optional(D.Boolean(!1)),representationPresetParams:D.Optional(D.Group(Os.CommonParams))},gI(e,t))},apply:function(e,t,r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,m;return le(this,function(v){switch(v.label){case 0:if(!(i=null===(a=null===(n=Mo.resolveAndCheck(r.state.data,e))||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data))return[2,{}];if(1===i.frameCount&&t.useDefaultIfSingleModel)return[2,_ue.apply(e,t,r)];o=r.builders.structure,s=[],u=[],c=0,v.label=1;case 1:return c<i.frameCount?[4,o.createModel(e,{modelIndex:c})]:[3,8];case 2:return l=v.sent(),[4,o.insertModelProperties(l,t.modelProperties,{isCollapsed:!0})];case 3:return d=v.sent(),[4,o.createStructure(d||l,{name:"model",params:{}})];case 4:return f=v.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return p=v.sent(),s.push(l),u.push(f),h=f.obj?rae(f.obj.data,{elementCountFactor:i.frameCount}):"medium",m=t.representationPreset||r.config.get(ma.Structure.DefaultRepresentationPreset)||bf.auto.id,[4,o.representation.applyPreset(p,m,{theme:{globalName:"trajectory-index"},quality:h})];case 6:v.sent(),v.label=7;case 7:return c++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),Sue=function(e,t){return R({model:D.Optional(D.Group(rt.getParamDefinition(et.Model.ModelFromTrajectory,e,t)))},gI(e,t))};function Cue(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return[4,(a=n.builders.structure).createModel(t,r.model)];case 1:return i=f.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=f.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=f.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=f.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return c=f.sent(),l=r.representationPreset||n.config.get(ma.Structure.DefaultRepresentationPreset)||bf.auto.id,[4,n.builders.structure.representation.applyPreset(u,l,{theme:{globalName:e.theme}})];case 6:return d=f.sent(),[2,{model:i,modelProperties:o,unitcell:c,structure:s,structureProperties:u,representation:d}]}})})}var A6,yI,Rot=Fm({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return ir.hasCrystalSymmetry(e.data.representative)},params:Sue,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,Cue({ijkMin:S.create(0,0,0),ijkMax:S.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),Oot=Fm({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return ir.hasCrystalSymmetry(e.data.representative)},params:Sue,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return[4,Cue({ijkMin:S.create(-1,-1,-1),ijkMax:S.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),Not=Fm({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212b, i.e., symmetry mates."},isApplicable:function(e){return ir.hasCrystalSymmetry(e.data.representative)},params:function(e,t){return R({model:D.Optional(D.Group(rt.getParamDefinition(et.Model.ModelFromTrajectory,e,t)))},gI(e,t))},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return le(this,function(d){switch(d.label){case 0:return[4,(n=r.builders.structure).createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=d.sent(),c=t.representationPreset||r.config.get(ma.Structure.DefaultRepresentationPreset)||bf.auto.id,[4,r.builders.structure.representation.applyPreset(s,c,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:SL.defaultValues}}}}})];case 6:return l=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),w6={default:_ue,"all-models":Mot,unitcell:Rot,supercell:Oot,crystalContacts:Not},kot=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=w6.default,Ks(w6,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return"string"==typeof t?null!==(r=w6[t])&&void 0!==r?r:sN(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return D.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?D.Group(o.params(t,this.plugin)):D.EmptyGroup())}return 0===r.length?D.MappedStatic("",{"":D.EmptyGroup()}):D.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),y2(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(i){var s=Mo.resolveAndCheck(this.plugin.state.data,t);if(!s)return void(S2||console.warn("Applying hierarchy preset provider to bad cell."));var u=n||(i.params?D.getDefaultValues(i.params(s.obj,this.plugin)):{}),c=Ve.create("".concat(i.display.name),function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(c)}},e}(),Bot=function(){function e(t){this.plugin=t,this.hierarchy=new kot(this.plugin),this.representation=new Eot(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ce(this,void 0,void 0,function(){var n;return le(this,function(i){switch(i.label){case 0:if(!(n="string"==typeof r?this.plugin.dataFormats.get(r):r))throw new Error("'".concat(r,"' is not a supported data format."));return[4,n.parse(this.plugin,t)];case 1:return[2,i.sent().trajectory]}})})},e.prototype.parseTrajectoryBlob=function(t,r){return this.dataState.build().to(t).apply(et.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(et.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=Mo.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ve.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){return this.dataState.build().to(t).apply(et.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n}).commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){return this.dataState.build().to(t).apply(et.Model.CustomModelProperties,r,{state:n}).commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=null===(i=null===(a=Mo.resolveAndCheck(s,t))||void 0===a?void 0:a.obj)||void 0===i?void 0:i.data;if(u){var c=null===(o=ei.Provider.get(u))||void 0===o?void 0:o.spacegroup.cell;if(!gs.isZero(c))return s.build().to(t).apply(et.Representation.ModelUnitcell3D,r,{state:n}).commit({revertOnError:!0})}},e.prototype.createStructure=function(t,r,n,a){var i,o=this.dataState;if(!r){var s=Mo.resolveAndCheck(o,t);if(s){var u=ei.Provider.get(null===(i=s.obj)||void 0===i?void 0:i.data);(!u||0===u?.assemblies.length)&&(r={name:"model",params:{}})}}return o.build().to(t).apply(et.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n,tags:a}).commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){return this.dataState.build().to(t).apply(et.Model.CustomStructureProperties,r).commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===et.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return ce(this,void 0,void 0,function(){var s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return u=(s=this.dataState).build().to(t),c="structure-component-".concat(n),[4,(l=u.applyOrUpdateTagged(c,et.Model.StructureComponent,r,{tags:a?sr(sr([],a,!0),[c],!1):[c]})).commit()];case 1:return f.sent(),(d=l.selector).isOk&&0!==(null===(o=null===(i=d.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.elementCount)?[3,3]:[4,s.build().delete(d.ref).commit()];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:(a?.label||"").trim()},n,a?.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:(n?.label||"").trim()},"static-".concat(r),n?.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(Ve.create("Query Component",function(o){return ce(i,void 0,void 0,function(){var s,u,c,l,d,f,p,h,m,v,g,y;return le(this,function(b){switch(b.label){case 0:return c=(s=a||{}).tags,u=((u=s.label)||"").trim(),(l=null===(y=null===(g=Mo.resolveAndCheck(this.dataState,t))||void 0===g?void 0:g.obj)||void 0===y?void 0:y.data)?r.referencesCurrent?(m={},v={name:"bundle"},h=(p=en).fromSelection,[4,r.getSelection(this.plugin,o,l)]):[3,2]:[2];case 1:return m.type=(v.params=h.apply(p,[b.sent()]),v),m.nullIfEmpty=!0,m.label=u||r.label,f=m,[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},l)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,c)]}})})}))},e}();function LC(e,t,r){return void 0===r&&(r={}),"string"==typeof r.type||"string"==typeof r.color||"string"==typeof r.size?function Lot(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return xue(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}(e,t||nt.One,r):xue(e,t||nt.One,r)}function xue(e,t,r){void 0===r&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=D.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=D.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);var l=Object.assign(c,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=D.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:l},sizeTheme:{name:d.name,params:p}}}!function(e){e.create=function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}}(A6||(A6={})),function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=A6.create(e.Descriptor)}(yI||(yI={}));var jb="Volume";function UC(e,t){return ce(this,void 0,void 0,function(){var r,n=this;return le(this,function(a){return t&&(r=t.entryId)&&r.toLowerCase().startsWith("emd")?[2,e.runTask(Ve.create("Try Set Recommended IsoValue",function(i){return ce(n,void 0,void 0,function(){var o,s;return le(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Wse(e,i,r)];case 1:return o=u.sent(),yI.Provider.set(t,nt.IsoValue.absolute(o)),[3,3];case 2:return s=u.sent(),console.warn(s),[3,3];case 3:return[2]}})})}))]:[2]})})}function wue(e){var t=yI.Provider.get(e);if(t)return"relative"===t.kind?t:nt.adjustedIsoValue(e,t.absoluteValue,"absolute")}function T6(e,t){return ce(this,void 0,void 0,function(){var r,n;return le(this,function(i){switch(i.label){case 0:return r={},(n=t.volume.data&&wue(t.volume.data))&&(r.isoValue=n),[4,e.build().to(t.volume).apply(et.Representation.VolumeRepresentation3D,LC(e,t.volume.data,{type:"isosurface",typeParams:r})).commit()];case 1:return[2,[i.sent()]]}})})}var Uot={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:jb,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(et.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(et.Volume.VolumeFromCcp4,{entryId:r?.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,UC(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:T6},Vot={label:"DSN6/BRIX",description:"DSN6/BRIX",category:jb,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(et.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(et.Volume.VolumeFromDsn6,{entryId:r?.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,UC(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:T6},zot={label:"DX",description:"DX",category:jb,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(et.Data.ParseDx,{},{state:{isGhost:!0}}),[4,(a=n.apply(et.Volume.VolumeFromDx,{entryId:r?.entryId})).commit({revertOnError:!0})];case 1:return i.sent(),[4,UC(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:T6},Got={label:"Cube",description:"Cube",category:jb,stringExtensions:["cub","cube"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i;return le(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(et.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(et.Volume.VolumeFromCube,{entryId:r?.entryId}),i=n.apply(et.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(et.Model.ModelFromTrajectory).apply(et.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,UC(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d;return le(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],(a=null===(d=null===(l=t.volume.cell)||void 0===l?void 0:l.obj)||void 0===d?void 0:d.data)&&nt.isOrbitals(a)?(i=r.to(t.volume).apply(et.Representation.VolumeRepresentation3D,LC(e,a,{type:"isosurface",typeParams:{isoValue:nt.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:gr.blue}})),o=r.to(t.volume).apply(et.Representation.VolumeRepresentation3D,LC(e,a,{type:"isosurface",typeParams:{isoValue:nt.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:gr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(et.Representation.VolumeRepresentation3D,LC(e,a,{type:"isosurface",typeParams:{isoValue:nt.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:gr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),c=[],Ks(u?.representations,function(p){p&&c.push(p)}),[2,sr(sr([],n,!0),c,!0)]}})})}},Hot={label:"DensityServer CIF",description:"DensityServer CIF",category:jb,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return"dscif"===sI(e,t)},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m;return le(this,function(v){switch(v.label){case 0:return[4,e.build().to(t).apply(et.Data.ParseCif).commit()];case 1:if(n=v.sent(),a=e.build().to(n),0===(i=n.obj.data.blocks).length)throw new Error("no data blocks");for(o=[],s=0,u=0,c=i;u<c.length;u++)"SERVER"!==(l=c[u]).header.toUpperCase()&&(d=Array.isArray(r?.entryId)?r?.entryId[s]:r?.entryId,(null===(m=l.categories.volume_data_3d_info)||void 0===m?void 0:m.rowCount)>0&&(o.push(a.apply(et.Volume.VolumeFromDensityServerCif,{blockHeader:l.header,entryId:d}).selector),s++));return[4,a.commit()];case 2:v.sent(),f=0,p=o,v.label=3;case 3:return f<p.length?[4,UC(e,p[f].data)]:[3,6];case 4:v.sent(),v.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return le(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&wue(r[0].data)||nt.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(et.Representation.VolumeRepresentation3D,pf.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:gr.teal})).selector),r.length>1&&(o=pf.getDefaultParamsStatic(e,"isosurface",{isoValue:nt.IsoValue.relative(3),alpha:.3},"uniform",{value:gr.green}),s=pf.getDefaultParamsStatic(e,"isosurface",{isoValue:nt.IsoValue.relative(-3),alpha:.3},"uniform",{value:gr.red}),a[a.length]=n.to(r[1]).apply(et.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(et.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}},jot={label:"Segmentation CIF",description:"Segmentation CIF",category:jb,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return"segcif"===sI(e,t)},parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,c;return le(this,function(l){switch(l.label){case 0:return[4,e.build().to(t).apply(et.Data.ParseCif).commit()];case 1:if(r=l.sent(),n=e.build().to(r),0===(a=r.obj.data.blocks).length)throw new Error("no data blocks");for(i=[],o=0,s=a;o<s.length;o++)"SERVER"!==(u=s[o]).header.toUpperCase()&&(null===(c=u.categories.volume_data_3d_info)||void 0===c?void 0:c.rowCount)>0&&i.push(n.apply(et.Volume.VolumeFromSegmentationCif,{blockHeader:u.header}).selector);return[4,n.commit()];case 2:return l.sent(),[2,{volumes:i}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a;return le(this,function(o){switch(o.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&nt.Segmentation.get(r[0].data)&&(a[a.length]=n.to(r[0]).apply(et.Representation.VolumeRepresentation3D,pf.getDefaultParams(e,"segment",r[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),[4,n.commit()];case 1:return o.sent(),[2,a]}})})}},qot=[["ccp4",Uot],["dsn6",Vot],["cube",Got],["dx",zot],["dscif",Hot],["segcif",jot]],Yot={label:"PLY",description:"PLY",category:"Shape",stringExtensions:["ply"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return le(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(et.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){return e.state.data.build().to(t.shape).apply(et.Representation.ShapeRepresentation3D).commit()}},Xot=[["ply",Yot]],Kot=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=qot;t<r.length;t++){var n=r[t];this.add(n[0],n[1])}for(var o=0,s=pat;o<s.length;o++){var u=s[o];this.add(u[0],u[1])}for(var c=0,l=yat;c<l.length;c++){var d=l[c];this.add(d[0],d[1])}for(var f=0,p=Xot;f<p.length;f++){var h=p[f];this.add(h[0],h[1])}for(var m=0,v=Vse;m<v.length;m++){var g=v[m];this.add(g[0],g[1])}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;null===(n=i.stringExtensions)||void 0===n||n.forEach(function(o){return t.add(o)}),null===(a=i.binaryExtensions)||void 0===a||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n;return null===(n=r.provider.binaryExtensions)||void 0===n?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var a=r.provider;return t.push([r.name,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n,a,i=0,o=this.list.length;i<o;++i){var s=this._list[i].provider,u=!1;if((!(null===(n=s.binaryExtensions)||void 0===n)&&n.includes(t.ext)||!(null===(a=s.stringExtensions)||void 0===a)&&a.includes(t.ext))&&(u=!0),u&&(!s.isApplicable||s.isApplicable(t,r.data)))return s}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '".concat(t,"'"))},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),Zot=function(e){function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return qt(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._animations.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next(void 0)},t.prototype.triggerApply=function(){this.events.applied.next(void 0)},t.prototype.getParams=function(){return this._params||(this._params={current:D.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:R(R({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:D.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=R(R({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){this.map.has(r.name)?this.context.log.error("Animation '".concat(r.name,"' is already registered.")):(this._params=void 0,this.map.set(r.name,r),this._animations.push(r),1===this._animations.length?this.updateParams({current:r.name}):this.triggerUpdate())},t.prototype.play=function(r,n){return ce(this,void 0,void 0,function(){return le(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n,a){return ce(this,void 0,void 0,function(){return le(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n||a?[4,this.applyFrame(a)]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ce(this,void 0,void 0,function(){var r,n,a;return le(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:(a=i.sent())&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ce(this,void 0,void 0,function(){var r;return le(this,function(n){switch(n.label){case 0:return this.isStopped=!0,"stopped"===this.state.animationState?[3,3]:(r=this._current.anim).teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return"playing"===this.state.animationState},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ce(this,void 0,void 0,function(){return le(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(r){return ce(this,void 0,void 0,function(){var n,a;return le(this,function(i){switch(i.label){case 0:return n=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=n),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:n-this._current.startedTime,animation:r},{params:this._current.paramValues,plugin:this.context})];case 1:return"finished"===(a=i.sent()).kind?this.stop():"next"===a.kind&&(this._current.state=a.state,this._current.lastTime=n-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),"playing"===this.state.animationState&&this.resume()))},t.prototype.resume=function(){return ce(this,void 0,void 0,function(){var r;return le(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(Zp);function Aue(e,t,r){var n=r[0],a=r[1],i=r[2];return(n*e[0]+a*e[1]+i*e[2]+(-n*t[0]-a*t[1]-i*t[2]))/Math.sqrt(n*n+a*a+i*i)}var _f={identity:Qt.create(1,0,0,0,1,0,0,0,1),rotX90:Qt.create(1,0,0,0,0,1,0,-1,0),rotY90:Qt.create(0,0,-1,0,1,0,1,0,0),rotZ90:Qt.create(0,1,0,-1,0,0,0,0,1),rotX270:Qt.create(1,0,0,0,0,-1,0,1,0),rotY270:Qt.create(0,0,1,0,1,0,-1,0,0),rotZ270:Qt.create(0,-1,0,1,0,0,0,0,1),rotX180:Qt.create(1,0,0,0,-1,0,0,0,-1),rotY180:Qt.create(-1,0,0,0,1,0,0,0,-1),rotZ180:Qt.create(-1,0,0,0,-1,0,0,0,1)};function D6(e,t){for(var r=t.onlyTrace,n=t.skipHydrogens,a=t.skipWater,i=it.atom,o=i.x,s=i.y,u=i.z,c=i.type_symbol,l=i.label_comp_id,d=[],f=0,p=e;f<p.length;f++)for(var h=p[f],m=at.create(h),v=0,g=h.units;v<g.length;v++){var y=g[v];m.unit=y;for(var b=r?y.polymerElements:y.elements,_=0;_<b.length;_++)m.element=b[_],(!n||"H"!==c(m))&&(a&&"HOH"===l(m)||d.push(o(m),s(m),u(m)))}return d}function sst(e,t){var r=Math.floor(t/2);return e<r?t%2?r-e:r-e-1:e-r}function Tue(e,t){var r=Qt.invert(Qt(),t),n=S.distance(e.position,e.target),a=S.transformMat3(S(),S.create(0,0,n),r),i=S.transformMat3(S(),S.create(0,1,0),r),o=S.add(S(),e.target,a);return R(R({},e),{position:o,up:i})}var lst={minRadius:5,extraRadius:4,durationMs:250},dst=function(){function e(t){this.plugin=t,this.boundaryHelper=new oc("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Re.is(t)){var a=null===(n=null===(r=this.plugin.helpers.substructureParent.get(t.structure))||void 0===r?void 0:r.obj)||void 0===n?void 0:n.data;a&&(t=Re.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(t){for(var n=[],a=0,i=t;a<i.length;a++){var s=i[a].values.boundingSphere.ref.value;0!==s.radius&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++)(u=pr.getBoundingSphere(this.transformedLoci(o[i])))&&a.push(u);if(0===a.length)return;this.boundaryHelper.reset();for(var c=0,l=a;c<l.length;c++)this.boundaryHelper.includeSphere(u=l[c]);this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u;this.boundaryHelper.radiusSphere(u=f[d])}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(0===t.length)return;n=pr.getBoundingSphere(this.transformedLoci(t[0]))}else n=pr.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++)(u=r(o[i]))&&a.push(u);if(0!==a.length){if(1===a.length)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var c=0,l=a;c<l.length;c++)this.boundaryHelper.includeSphere(u=l[c]);this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u;this.boundaryHelper.radiusSphere(u=f[d])}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a=this.plugin.canvas3d;if(a){var i=R(R({},lst),r),u=i.durationMs,c=Math.max(t.radius+i.extraRadius,i.minRadius);if(r?.principalAxes){var l=function est(e,t,r){if(e.canvas3d){var n=r.principalAxes.boxAxes,a=n.origin,o=n.dirB,s=n.dirC,u=S.clone(n.dirA),c=S.clone(s);if(r.positionToFlip){var l=function $ot(e,t,r,n){var a=Aue(e,t,n);return{aroundX:Aue(e,t,r)<0,aroundY:a<0}}(r.positionToFlip,a,u,o),f=l.aroundY;l.aroundX&&(S.negate(c,c),S.negate(u,u)),f&&S.negate(c,c)}var p=S.scale(S(),a,-100);return S.dot(p,u)<=0&&S.negate(c,c),S.dot(S.unitY,c)<=0&&S.negate(u,u),e.canvas3d.camera.getFocus(a,t,u,c,Xa.createDefaultSnapshot())}}(this.plugin,c,r);null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({durationMs:u,snapshot:l})}else l=a.camera.getFocus(t.center,c),a.requestCameraReset({durationMs:u,snapshot:l})}},e.prototype.orientAxes=function(t,r){if(this.plugin.canvas3d){t||(t=this.plugin.state.data.selectQ(function(s){return s.ofType(ve.Molecule.Structure)}).filter(function(s){return s.obj&&!s.transform.transformer.definition.isDecorator&&!s.obj.data.parent}).map(function(s){var u;return null===(u=s.obj)||void 0===u?void 0:u.data}).filter(function(s){return!!s}));var i=function rst(e,t){var r=function ast(e,t){var r;return(r=D6(e,{onlyTrace:!0})).length>=3*t||(r=D6(e,{skipHydrogens:!0,skipWater:!0})).length>=3*t||(r=D6(e,{})),r}(e,3);return function nst(e,t){if(0===e.length)return console.warn("Skipping PCA, no atoms"),{rotation:_f.identity,origin:S.zero()};var r=ql.calculateMomentsAxes(e),n=ql.calculateNormalizedAxes(r),a=function ust(e,t,r){var n=Qt();return Qt.setValue(n,0,0,e[0]),Qt.setValue(n,0,1,e[1]),Qt.setValue(n,0,2,e[2]),Qt.setValue(n,1,0,t[0]),Qt.setValue(n,1,1,t[1]),Qt.setValue(n,1,2,t[2]),Qt.setValue(n,2,0,r[0]),Qt.setValue(n,2,1,r[1]),Qt.setValue(n,2,2,r[2]),n}(n.dirA,n.dirB,n.dirC);!function cst(e){Qt.determinant(e)<0&&(Qt.setValue(e,2,0,-Qt.getValue(e,2,0)),Qt.setValue(e,2,1,-Qt.getValue(e,2,1)),Qt.setValue(e,2,2,-Qt.getValue(e,2,2)))}(a);var i=t?function ist(e,t){for(var r=_f.identity,n=0,a=Qt(),i=0,o=[_f.identity,_f.rotX180,_f.rotY180,_f.rotZ180];i<o.length;i++){var s=o[i],u=Qt.innerProduct(Qt.mul(a,s,e),t);u>n&&(r=s,n=u)}return r}(a,t):function ost(e,t,r){for(var n=S.create(Qt.getValue(t,0,0),Qt.getValue(t,0,1),Qt.getValue(t,0,2)),a=S.create(Qt.getValue(t,1,0),Qt.getValue(t,1,1),Qt.getValue(t,1,2)),i=S.create(Qt.getValue(t,2,0),Qt.getValue(t,2,1),Qt.getValue(t,2,2)),o=Math.floor(e.length/3),s=S(),u=0,c=0,l=0,d=0;d<o;d++)S.fromArray(s,e,3*d),S.sub(s,s,r),u+=d*S.dot(s,n),c+=d*S.dot(s,a),l+=sst(d,o)*S.dot(s,i);var f=l<0,p=f?u+c<0:u-c<0;return p&&f?_f.rotY180:f?_f.rotX180:p?_f.rotZ180:_f.identity}(e,a,r.origin);return Qt.mul(a,i,a),{rotation:a,origin:n.origin}}(r,t)}(t).rotation,o=Tue(this.plugin.canvas3d.camera.getSnapshot(),i);this.setSnapshot(o,r)}},e.prototype.resetAxes=function(t){if(this.plugin.canvas3d){var r=Tue(this.plugin.canvas3d.camera.getSnapshot(),Qt.Identity);this.setSnapshot(r,t)}},e.prototype.setSnapshot=function(t,r){var n;null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),E6=function(e){function t(r,n){void 0===n&&(n={});var a=e.call(this,{props:R(R({},D.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=D.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return qt(t,e),Object.defineProperty(t.prototype,"props",{get:function(){return R({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=R(R({},this.state.props),r);tN(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next(void 0))},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.lociSelects.dispose(),this.lociHighlights.dispose()},t}(Zp);!function(e){e.Params={granularity:D.Select("residue",pr.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){void 0===o&&(o={}),this.ctx=i,this.providers=[],this.props=D.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o,s){void 0===s&&(s=!1);var c=i.repr;return{loci:pr.normalize(i.loci,o?this.props.granularity:void 0,s),repr:c}},a.prototype.mark=function(i,o,s){if(void 0===s&&(s=!1),!pr.isEmpty(i.loci))for(var u=0,c=this.providers;u<c.length;u++)(0,c[u])(i,o,s)},a.prototype.dispose=function(){this.providers.length=0,this.sel.dispose()},a}();e.LociMarkManager=t;var r=function(a){function i(){var o=null!==a&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(s){void 0===s&&(s=!1);for(var u=0,c=o.prev;u<c.length;u++)o.mark(c[u],Vt.RemoveHighlight,s);o.prev.length=0},o}return qt(i,a),i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++)if(dr.Loci.areEqual(u[s],o))return!0;return!1},i.prototype.addHighlight=function(o){this.mark(o,Vt.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(pr.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))},i.prototype.highlightOnlyExtend=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var c={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(c)||(pr.isEmpty(c.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(c)))}},i.prototype.dispose=function(){a.prototype.dispose.call(this),this.prev.length=0},i}(t);e.LociHighlightManager=r;var n=function(a){function i(){return null!==a&&a.apply(this,arguments)||this}return qt(i,a),i.prototype.toggle=function(o,s){if(void 0===s&&(s=!0),!pr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,Vt.Toggle)}},i.prototype.toggleExtend=function(o,s){if(void 0===s&&(s=!0),!pr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);if(Re.is(u.loci)){var c=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:c,repr:u.repr})}}},i.prototype.select=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,Vt.Select)},i.prototype.selectJoin=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,Vt.Select)},i.prototype.selectOnly=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&(this.mark({loci:Ye.Loci(u.loci.structure),repr:u.repr},Vt.Deselect),this.sel.modify("set",u.loci)),this.mark(u,Vt.Select)},i.prototype.deselect=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,Vt.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:fE},Vt.Deselect)},i.prototype.deselectAllOnEmpty=function(o){Ps(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;if(!pr.isEmpty(u))if(Re.is(u)){var c=this.sel.getLoci(u.structure);a.prototype.mark.call(this,{loci:Ye.Loci(u.structure)},Vt.Deselect,!pr.isEmpty(c)),a.prototype.mark.call(this,{loci:c},Vt.Select)}else a.prototype.mark.call(this,o,s)},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,Vt.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,Vt.Select))},i}(t);e.LociSelectManager=n}(E6||(E6={}));var fst=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a,i){0!==r.providers.length&&(r.mark(n,a),i||r.showLabels())})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return dr.Loci.areEqual(t,a)});-1===n&&r===Vt.Highlight?(this.locis.push(t),this.isDirty=!0):-1!==n&&r===Vt.RemoveHighlight&&(b2(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!pr.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var c=a.group?a.group(u):u.toString(),l=this.groupedLabels.get(c);l?l.push(u):this.groupedLabels.set(c,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var p=d.length,h=p>1&&d[0]!==d[1]?f:d[0];t.labels.push(1===p?h:"".concat(h," <small>|| \xd7 ").concat(p,"</small>"))}),this.isDirty=!1}return this.labels},e}(),Due="overpaint-controls";function Eue(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return le(this,function(o){switch(o.label){case 0:return[4,Iue(e,t,function(s,u,c){return ce(i,void 0,void 0,function(){var l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=m.sent(),pr.isEmpty(d)||Ps(d)||(f={bundle:en.fromLoci(d),color:-1===r?dt(0):r,clear:-1===r},c?(p=sr(sr([],c.params.values.layers,!0),[f],!1),h=Pue(p,l),s.to(c).update(Fi.toBundle(h))):(h=Pue([f],l),s.to(u.transform.ref).apply(et.Representation.OverpaintStructureRepresentation3DFromBundle,Fi.toBundle(h),{tags:Due}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function Iue(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return le(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(wr.Generators.ofTransformer(et.Representation.OverpaintStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(Due)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function Pue(e,t){var r=Fi.ofBundle(e,t.root),n=Fi.merge(r);return Fi.filter(n,t)}var Mue="clipping-controls";function pst(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return le(this,function(o){switch(o.label){case 0:return[4,hst(e,t,function(s,u,c){return ce(i,void 0,void 0,function(){var l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=m.sent(),pr.isEmpty(d)||Ps(d)||(f={bundle:en.fromLoci(d),groups:r},c?(p=sr(sr([],c.params.values.layers,!0),[f],!1),h=Rue(p,l),s.to(c).update(Wn.toBundle(h))):(h=Rue([f],l),s.to(u.transform.ref).apply(et.Representation.ClippingStructureRepresentation3DFromBundle,Wn.toBundle(h),{tags:Mue}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function hst(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return le(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(wr.Generators.ofTransformer(et.Representation.ClippingStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(Mue)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function Rue(e,t){var r=Wn.ofBundle(e,t.root),n=Wn.merge(r);return Wn.filter(n,t)}var Oue="transparency-controls";function mst(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return le(this,function(o){switch(o.label){case 0:return[4,Fue(e,t,function(s,u,c){return ce(i,void 0,void 0,function(){var l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=m.sent(),pr.isEmpty(d)||Ps(d)||(f={bundle:en.fromLoci(d),value:r},c?(p=sr(sr([],c.params.values.layers,!0),[f],!1),h=Nue(p,l),s.to(c).update(jo.toBundle(h))):(h=Nue([f],l),s.to(u.transform.ref).apply(et.Representation.TransparencyStructureRepresentation3DFromBundle,jo.toBundle(h),{tags:Oue}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function Fue(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return le(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(wr.Generators.ofTransformer(et.Representation.TransparencyStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(Oue)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function Nue(e,t){var r=jo.ofBundle(e,t.root),n=jo.merge(r);return jo.filter(n,t)}var kue="substance-controls";function Bue(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return le(this,function(o){switch(o.label){case 0:return[4,Lue(e,t,function(s,u,c){return ce(i,void 0,void 0,function(){var l,d,f,p,h;return le(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=m.sent(),pr.isEmpty(d)||Ps(d)||(f={bundle:en.fromLoci(d),material:r??_s(),clear:!r},c?(p=sr(sr([],c.params.values.layers,!0),[f],!1),h=Uue(p,l),s.to(c).update(qo.toBundle(h))):(h=Uue([f],l),s.to(u.transform.ref).apply(et.Representation.SubstanceStructureRepresentation3DFromBundle,qo.toBundle(h),{tags:kue}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function Lue(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return le(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(wr.Generators.ofTransformer(et.Representation.SubstanceStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(kue)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function Uue(e,t){var r=qo.ofBundle(e,t.root),n=qo.merge(r);return qo.filter(n,t)}var I6=function(e){function t(r){var n=e.call(this,{options:D.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return qt(t,e),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype._setSnapshotState=function(r){this.updateState({options:r}),this.events.optionsUpdated.next(void 0)},t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,u,c,d=this;return le(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(void 0),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(u=0,c=o[i].components;u<c.length;u++)this.updateReprParams(a,c[u]);return[2,this.plugin.dataTransaction(function(){return ce(d,void 0,void 0,function(){return le(this,function(p){switch(p.label){case 0:return[4,a.commit()];case 1:return p.sent(),[4,this.plugin.state.updateBehavior(oI,function(h){h.ignoreHydrogens="all"!==r.hydrogens,h.ignoreHydrogensVariant="only-polar"===r.hydrogens?"non-polar":"all",h.ignoreLight=r.ignoreLight,h.material=r.materialStyle,h.clip=r.clipObjects})];case 2:return p.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:p.sent(),p.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.hydrogens,o=a.visualQuality,s=a.ignoreLight,u=a.materialStyle,c=a.clipObjects,l="all"!==i,d="only-polar"===i?"non-polar":"all",f=0,p=n.representations;f<p.length;f++){var h=p[f];if(h.cell.transform.transformer===PE){var m=h.cell.transform.params;(!!m.type.params.ignoreHydrogens!==l||m.type.params.ignoreHydrogensVariant!==d||m.type.params.quality!==o||m.type.params.ignoreLight!==s||!p2(m.type.params.material,u)||!D.areEqual(pm.Params,m.type.params.clip,c))&&r.to(h.cell).update(function(v){v.type.params.ignoreHydrogens=l,v.type.params.ignoreHydrogensVariant=d,v.type.params.quality=o,v.type.params.ignoreLight=s,v.type.params.material=u,v.type.params.clip=c})}}},t.prototype.updateInterationProps=function(){var r,n,a;return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f=this;return le(this,function(p){switch(p.label){case 0:i=0,o=this.currentStructures,p.label=1;case 1:return i<o.length?(u=Ka.getParams(null===(r=(s=o[i]).cell.obj)||void 0===r?void 0:r.data),s.properties?(c=null===(n=s.properties.cell.transform.params)||void 0===n?void 0:n.properties[Ka.descriptor.name],D.areEqual(u,c,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(h){h.properties[Ka.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return p.sent(),[3,5];case 3:return l=this.plugin.customStructureProperties.getParams(null===(a=s.cell.obj)||void 0===a?void 0:a.data),d=D.getDefaultValues(l),D.areEqual(u,d.properties[Ka.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Ka.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:p.sent(),p.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u,c;return le(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?[4,this.plugin.builders.structure.representation.applyPreset((u=s[o]).cell,n,a)]:[3,5];case 2:return c=l.sent(),[4,this.syncPreset(u,c)];case 3:l.sent(),l.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(Ks(n.components,function(y){y&&a.add(y.ref)}),n.representations&&Ks(n.representations,function(y){y&&a.add(y.ref)}),0===a.size)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,c=r.components;u<c.length;u++){var l=c[u];s(l);for(var d=0,f=l.representations;d<f.length;d++)s(f[d]);if(l.genericRepresentations)for(var h=0,m=l.genericRepresentations;h<m.length;h++)s(m[h])}if(r.genericRepresentations)for(var v=0,g=r.genericRepresentations;v<g.length;v++)s(g[v]);return i?o.commit():void 0},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=Ye.toSubStructureElementLoci(s.structure.cell.obj.data,null===(n=s.cell.obj)||void 0===n?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(Ve.create("Modify Component",function(i){return ce(a,void 0,void 0,function(){var o,s,u,c,l;return le(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)this.canBeModified(c=u[s])&&(l=this.plugin.managers.structure.selection.getStructure(c.structure.cell.obj.data))&&0!==l.elementCount&&this.modifyComponent(o,c,l,n);return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(0!==r.length)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,c=0,l=r;c<l.length;c++){var d=l[c].representations[u];d&&Ib(this.dataState,d.cell.transform.ref,a)}else{a=!r[0].cell.state.isHidden;for(var i=0,o=r;i<o.length;i++)Ib(this.dataState,o[i].cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(0!==r.length){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++)(u=s[o]).representations[i]&&a.push(u.representations[i])}else for(var c=0,l=r;c<l.length;c++)for(var u,d=0,f=(u=l[c]).representations;d<f.length;d++)a.push(f[d]);return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(0===r.length)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s].representations[i];l&&l.cell.transform.transformer===n.cell.transform.transformer&&o.to(l.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(0!==r.length){for(var u=this.dataState.build(),c=0,l=r;c<l.length;c++)for(var d=l[c],f=function(g){var y=g.cell.transform.params,b="function"==typeof n?n(d,g):n,_="default"===b.color?u6(p.plugin,null===(a=d.structure.cell.obj)||void 0===a?void 0:a.data,y?.type.name):b.color?u6(p.plugin,null===(i=d.structure.cell.obj)||void 0===i?void 0:i.data,y?.type.name,b.color,b.colorParams):void 0,C="default"===b.size?Rse(p.plugin,null===(o=d.structure.cell.obj)||void 0===o?void 0:o.data,y?.type.name):b.color?Rse(p.plugin,null===(s=d.structure.cell.obj)||void 0===s?void 0:s.data,y?.type.name,b.size,b.sizeParams):void 0;(_||C)&&u.to(g.cell).update(function(x){_&&(x.colorTheme=_),C&&(x.sizeTheme=C)})},p=this,h=0,m=d.representations;h<m.length;h++)f(m[h]);return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(0!==r.length){var i=this.state.options,o=i.hydrogens,p={ignoreHydrogens:"all"!==o,ignoreHydrogensVariant:"only-polar"===o?"non-polar":"all",quality:i.visualQuality,ignoreLight:i.ignoreLight,material:i.materialStyle,clip:i.clipObjects};return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var h,m;return le(this,function(g){switch(g.label){case 0:h=0,m=r,g.label=1;case 1:return h<m.length?[4,this.plugin.builders.structure.representation.addRepresentation(m[h].cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:p})]:[3,4];case 2:g.sent(),g.label=3;case 3:return h++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(0!==r.components.length)return this.plugin.runTask(Ve.create("Find Component",function(i){return ce(a,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h,m;return le(this,function(v){switch(v.label){case 0:return(o=null===(h=r.cell.obj)||void 0===h?void 0:h.data)?(c=(u=mt).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=c.apply(u,[v.sent()]),l=0,d=r.components;l<d.length;l++)if((p=null===(m=(f=d[l]).cell.obj)||void 0===m?void 0:m.data)&&f.cell.parent&&nOe(s,p))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ce(this,void 0,void 0,function(){var a=this;return le(this,function(i){return[2,this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u,m,v,g,y,b,_;return le(this,function(C){switch(C.label){case 0:if(0===(o=n||this.currentStructures).length)return[2];m={ignoreHydrogens:"all"!==(u=(s=this.state.options).hydrogens),ignoreHydrogensVariant:"only-polar"===u?"non-polar":"all",quality:s.visualQuality,ignoreLight:s.ignoreLight,material:s.materialStyle,clip:s.clipObjects},v=Gn.create22(),g=0,y=o,C.label=1;case 1:return g<y.length?(b=y[g],_=void 0,r.options.checkExisting?[4,this.tryFindComponent(b,r.selection)]:[3,3]):[3,8];case 2:_=C.sent(),C.label=3;case 3:return _?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(b.cell,r.selection,v,{label:r.options.label||(r.selection===Ri.current?"Custom Selection":"")})];case 4:_=C.sent(),C.label=5;case 5:return"none"!==r.representation&&_?[4,this.plugin.builders.structure.representation.addRepresentation(_,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:m})]:[3,7];case 6:C.sent(),C.label=7;case 7:return g++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ce(this,void 0,void 0,function(){var a=this;return le(this,function(i){return[2,this.plugin.dataTransaction(function(o){return ce(a,void 0,void 0,function(){var s,u,c,l,d,p=this;return le(this,function(h){switch(h.label){case 0:if(0===(s=n||this.currentStructures).length)return[2];u=function(m){return ce(p,void 0,void 0,function(){var v,g;return le(this,function(y){switch(y.label){case 0:return g=(v=mt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,m)];case 1:return[2,g.apply(v,[y.sent()])]}})})},c=0,l=s,h.label=1;case 1:return c<l.length?(d=l[c],"color"!==r.action.name?[3,3]:[4,Eue(this.plugin,d.components,r.action.params.color,u,r.representations)]):[3,14];case 2:return h.sent(),[3,13];case 3:return"resetColor"!==r.action.name?[3,5]:[4,Eue(this.plugin,d.components,-1,u,r.representations)];case 4:return h.sent(),[3,13];case 5:return"transparency"!==r.action.name?[3,7]:[4,mst(this.plugin,d.components,r.action.params.value,u,r.representations)];case 6:return h.sent(),[3,13];case 7:return"material"!==r.action.name?[3,9]:[4,Bue(this.plugin,d.components,r.action.params.material,u,r.representations)];case 8:return h.sent(),[3,13];case 9:return"resetMaterial"!==r.action.name?[3,11]:[4,Bue(this.plugin,d.components,void 0,u,r.representations)];case 10:return h.sent(),[3,13];case 11:return"clipping"!==r.action.name?[3,13]:[4,pst(this.plugin,d.components,Wn.Groups.fromNames(r.action.params.excludeGroups),u,r.representations)];case 12:h.sent(),h.label=13;case 13:return c++,[3,1];case 14:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,c=null===(o=n.cell.obj)||void 0===o?void 0:o.data;if(c&&("subtract"!==i&&"intersect"!==i||wT(c,a))){var l=null===(s=n.structure.cell.obj)||void 0===s?void 0:s.data,d="union"===i?L2(l,[c,a]):"intersect"===i?nZ(c,a):WN(c,a);if(0===d.elementCount)r.delete(n.cell.transform.ref);else{var p={type:{name:"bundle",params:en.fromSubStructure(l,d)},nullIfEmpty:!0,label:null===(u=n.cell.obj)||void 0===u?void 0:u.label};r.to(n.cell).update(p)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:null===(a=r.cell.params)||void 0===a?void 0:a.values.type,nullIfEmpty:null===(i=r.cell.params)||void 0===i?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var s=0,u=i[a].components;s<u.length;s++)n.delete(u[s].cell.transform.ref);return n.commit({canUndo:"Clear Selections"})},t}(Zp);!function(e){function n(i,o){var s,u;return null!==(s=o?.cell.obj)&&void 0!==s&&s.data?i.representation.structure.registry.getApplicableTypes(null===(u=o.cell.obj)||void 0===u?void 0:u.data):i.representation.structure.registry.types}function a(i,o,s,u){var c=sr(sr([],s,!0),n(i,o),!0);return D.Select(c[0][0],c,{label:u})}e.OptionsParams={hydrogens:D.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:D.Select("auto",oB,{description:"Control the visual/rendering quality of representations"}),ignoreLight:D.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:_s.getParam(),clipObjects:D.Group(pm.Params),interactions:D.Group(Ka.defaultParams,{label:"Non-covalent Interactions"})},e.getAddParams=function t(i,o){var s=i.query.structure.registry.options;return o=R({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:D.Select(s[1][0],s,{isHidden:o?.hideSelection}),representation:a(i,o?.pivot,o?.allowNone?[["none","< Create Later >"]]:[]),options:D.Group({label:D.Text(""),checkExisting:D.Boolean(!!o?.checkExisting,{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}},e.getThemeParams=function r(i,o){var s=i.query.structure.registry.options;return{selection:D.Select(s[1][0],s,{isHidden:!1}),action:D.MappedStatic("color",{color:D.Group({color:D.Color(gr.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:D.EmptyGroup({label:"Reset Color"}),transparency:D.Group({value:D.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:D.Group({material:_s.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:D.EmptyGroup({label:"Reset Material"}),clipping:D.Group({excludeGroups:D.MultiSelect([],D.objectToOptions(Wn.Groups.Names))},{isFlat:!0})}),representations:D.MultiSelect([],n(i,o),{emptyValue:"All"})}},e.getRepresentationTypes=n}(I6||(I6={}));var gst=function(e){function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(ve.Molecule.Structure.is(u)){(null===(s=n.current)||void 0===s?void 0:s.loci.structure)===u.data&&n.clear();for(var c=[],l=0,d=n.history;l<d.length;l++){var f=d[l];f.loci.structure===u.data&&c.push(f)}c.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,c),n.events.historyUpdated.next(void 0))}});var a=De();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,c=i.action;if(ve.Molecule.Structure.is(u)&&s!==u.data&&"in-place"===c){var l=n.state.current;if(l&&l.loci.structure===s){var f=Re.remap(l.loci,u.data);n.state.current=R(R({},l),{loci:f}),n.behaviors.current.next(n.state.current),pr.getBoundingSphere(f,a);var p=null===(o=n.plugin.canvas3d)||void 0===o?void 0:o.camera,h=p.getTargetDistance(a.radius+4);(S.distance(p.target,a.center)>a.radius||h>p.viewport.height/p.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return qt(t,e),Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Re.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(Re.areEqual(s.loci,r.loci)){a=s;break}n++}if(a)return b2(this.state.history,n),this.state.history.unshift(r),void this.events.historyUpdated.next(void 0);this.state.history.unshift(r),this.state.history.length>8&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Re.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=pr.normalize(r);Re.is(n)&&!Re.isEmpty(n)?this.set({loci:n,label:CE(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}):this.clear()},t.prototype.addFromLoci=function(r){var n=this.state.current&&Re.is(r)&&r.structure===this.state.current.loci.structure?Re.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r?.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:en.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(r.current){var i=r.current,o=i.label,u=i.bundle,c=i.category,l=null===(a=null===(n=this.plugin.state.data.select(wr.Generators.byRef(i.ref))[0])||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(l){var d=en.toLoci(u,l);this.set({label:o,loci:d,category:c})}}else this.clear()},t}(Zp);function P6(){return{trajectories:[],models:[],structures:[],refs:new Map}}function bst(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function Vue(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function _st(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function Sst(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function zue(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function Cst(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function xst(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function wst(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function Ast(e){return e.transform.tags?sr([],e.transform.tags,!0).sort().join():e.transform.ref}function Tst(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:Ast(e),representations:[]}}function Dst(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function Est(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function qb(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Og(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function Gue(e){return function(t){return e.is(t.obj)}}function Hue(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function bI(e){return function(t){return t.transform.transformer===e}}function Fg(){}var Pst=[[Gue(ve.Molecule.Trajectory),function(e,t){e.currentTrajectory=qb(e,t,e.hierarchy.trajectories,bst,t)},function(e){return e.currentTrajectory=void 0}],[Hue(ve.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentModel=e.currentTrajectory?qb(e,t,e.currentTrajectory.models,Vue,t,e.currentTrajectory):Og(e,t,Vue,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[bI(et.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=Og(e,t,_st,t,e.currentModel)},Fg],[bI(et.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=Og(e,t,Sst,t,e.currentModel)},Fg],[Hue(ve.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentStructure=e.currentModel?qb(e,t,e.currentModel.structures,zue,t,e.currentModel):Og(e,t,zue,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[bI(et.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=Og(e,t,Cst,t,e.currentStructure)},Fg],[bI(et.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=Og(e,t,xst,t,e.currentStructure)},Fg],[Gue(Cc),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=Og(e,t,wst,t,e.currentStructure)),!1},Fg],[function(e,t){return!(t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator)&&ve.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=qb(e,t,e.currentStructure.components,Tst,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ve.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&qb(e,t,e.currentComponent.representations,Dst,t,e.currentComponent),!1},Fg],[function(e){return!e.state.isGhost&&ve.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),qb(e,t,r.genericRepresentations,Est,t,r))},Fg]];function jue(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===ua.Null||"ok"!==e.status&&"error"!==e.status)}function Mst(e){jue(e.cell)||(this.changed=!0)}function Rst(e){que(this,this.tree.transforms.get(e))}function que(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(jue(n)){for(var a=void 0,i=!1,o=0,s=Pst;o<s.length;o++){var u=s[o],l=u[1],d=u[2];if((0,u[0])(n,r)){if(!1===l(r,n)){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(Rst,e),a&&a(r)}}}var M6=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:P6(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return qt(t,e),Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups||(this._currentComponentGroups=t.getComponentGroups(this.selection.structures)),this._currentComponentGroups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++)this._currentSelectionSet.add(n[r].cell.transform.ref);for(var i=0,o=this.selection.models;i<o.length;i++)this._currentSelectionSet.add(o[i].cell.transform.ref);for(var s=0,u=this.selection.structures;s<u.length;s++)this._currentSelectionSet.add(u[s].cell.transform.ref);return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var n=[],a=0,i=this.plugin.managers.structure.hierarchy.current.structures;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.findStructure=function(r){if(r){var n=this.plugin.helpers.substructureParent.get(r);if(n){var a=this.plugin.state.data.selectQ(function(i){return i.byValue(n).rootOfType(ve.Molecule.Structure)})[0];if(a)return this.behaviors.selection.value.structures.find(function(i){return i.cell===a})}}},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],c=u.cell.transform.ref;(a.has(c)||n.has(c))&&i.push(u)}return 0===i.length?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(r||!this.dataState.inUpdate){if(this.state.syncedTree===this.dataState.tree)return void(r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(R({hierarchy:this.state.hierarchy},this.state.selection))));this.state.syncedTree=this.dataState.tree;var n=function yst(e,t){var r=function Ist(e,t){return{state:e,oldHierarchy:t,hierarchy:P6(),changed:!1,added:new Set}}(e,t||P6());return function Ost(e,t){que({tree:e,state:t},e.root)}(e.tree,r),t&&t.refs.forEach(Mst,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}(this.plugin.state.data,this.current);if(n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i="add"===n?fa.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):fa.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],c=0,l=a.trajectories;c<l.length;c++){var d=l[c];i.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,p=a.models;f<p.length;f++){var h=p[f];i.has(h.cell.transform.ref)&&s.push(h)}for(var m=0,v=a.structures;m<v.length;m++){var g=v[m];i.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(0!==r.length){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete("string"==typeof s?s:s.cell.transform.ref)}return a.commit({canUndo:!!n&&"Remove"})}},t.prototype.toggleVisibility=function(r,n){if(0!==r.length)for(var a=void 0!==n?"show"!==n:!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++)Ib(this.dataState,o[i].cell.transform.ref,a)},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u;return le(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o]).models.length>0?[4,this.clearTrajectory(u)]:[3,3]:[3,6];case 2:c.sent(),c.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:c.sent(),c.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ce(this,void 0,void 0,function(){var a=this;return le(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s;return le(this,function(u){switch(u.label){case 0:return o=hi.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),Sr.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++)n.delete(i[a].cell);return n.commit()},t}(yC);!function(e){e.getComponentGroups=function t(n){if(!n.length)return[];if(1===n.length)return n[0].components.map(function(h){return[h]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var c=0,l=s[o].components;c<l.length;c++){var d=l[c],f=d.key;if(f){var p=i.get(f);p||(i.set(f,p=[]),a.push(p)),p.push(d)}}return a},e.getSelectedStructuresDescription=function r(n){var a,i,o,s,u,c,l,d,f,p=n.managers.structure.hierarchy.selection.structures;if(0===p.length)return"";if(1===p.length){var m=null===(a=(h=p[0]).cell.obj)||void 0===a?void 0:a.data;if(!m)return(null===(i=h.cell.obj)||void 0===i?void 0:i.label)||"Structure";var v=m.models[0]||m.representativeModel||m.masterModel;if(!v)return(null===(o=h.cell.obj)||void 0===o?void 0:o.label)||"Structure";var g=v.entryId;return null!==(u=null===(s=h.model)||void 0===s?void 0:s.trajectory)&&void 0!==u&&u.models&&1===h.model.trajectory.models.length?g:h.model?"".concat(null===(c=h.model.cell.obj)||void 0===c?void 0:c.label," | ").concat(g):g}for(var y=p[0],b=null===(l=y?.model)||void 0===l?void 0:l.trajectory,_=!0,C=0,x=p;C<x.length;C++){var h=x[C];if((null===(d=h?.model)||void 0===d?void 0:d.trajectory)!==b){_=!1;break}}return _&&b?"".concat(null===(f=b.cell.obj)||void 0===f?void 0:f.label," | ").concat(p.length," structures"):"".concat(p.length," structures")}}(M6||(M6={}));var R6="measurement-group",_I="measurement-order-label",Fst={distanceUnitLabel:D.Text("\u212b",{isEssential:!0}),textColor:Dae.textColor},Nst=D.getDefaultValues(Fst),kst=function(e){function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:Nst})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return qt(t,e),t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var n=wr.findTagInSubtree(this.plugin.state.data.tree,ln.RootRef,R6),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(et.Misc.CreateGroup,{label:"Measurements"},{tags:R6})},t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return le(this,function(p){switch(p.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)n.to(i[a]).update(function(h){h.unitLabel=r.distanceUnitLabel,h.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)n.to(s[o]).update(function(h){h.textColor=r.textColor});for(u=0,c=this.state.angles;u<c.length;u++)n.to(c[u]).update(function(h){h.textColor=r.textColor});for(l=0,d=this.state.dihedrals;l<d.length;l++)n.to(d[l]).update(function(h){h.textColor=r.textColor});return 0===n.editInfo.count?[2]:[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return p.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u;return le(this,function(l){switch(l.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),i&&o?($a(s=[i.transform.ref],o.transform.ref),(u=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:Re.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Re.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a?.selectionTags}).apply(et.Representation.StructureSelectionsDistance3D,R(R(R({customText:a?.customText||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a?.lineParams),a?.labelParams),a?.visualParams),{tags:a?.reprTags}),[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:u,options:{doNotLogTiming:!0}})]):[2];case 1:return l.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l;return le(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),o&&s&&u?($a(c=[o.transform.ref],s.transform.ref),$a(c,u.transform.ref),(l=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Re.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:c,tags:i?.selectionTags}).apply(et.Representation.StructureSelectionsAngle3D,R(R(R({customText:i?.customText||"",textColor:this.state.options.textColor},i?.lineParams),i?.labelParams),i?.visualParams),{tags:i?.reprTags}),[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:l,options:{doNotLogTiming:!0}})]):[2];case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return ce(this,void 0,void 0,function(){var s,u,c,l,d,f;return le(this,function(h){switch(h.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),c=this.plugin.helpers.substructureParent.get(a.structure),l=this.plugin.helpers.substructureParent.get(i.structure),s&&u&&c&&l?($a(d=[s.transform.ref],u.transform.ref),$a(d,c.transform.ref),$a(d,l.transform.ref),(f=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:c.transform.ref,expression:Re.toExpression(a)},{key:"d",ref:l.transform.ref,expression:Re.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o?.selectionTags}).apply(et.Representation.StructureSelectionsDihedral3D,R(R(R({customText:o?.customText||"",textColor:this.state.options.textColor},o?.lineParams),o?.labelParams),o?.visualParams),{tags:o?.reprTags}),[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:f,options:{doNotLogTiming:!0}})]):[2];case 1:return h.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ce(this,void 0,void 0,function(){var a,i,o;return le(this,function(u){switch(u.label){case 0:return(a=this.plugin.helpers.substructureParent.get(r.structure))?(i=[a.transform.ref],(o=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n?.selectionTags}).apply(et.Representation.StructureSelectionsLabel3D,R(R({textColor:this.state.options.textColor},n?.labelParams),n?.visualParams),{tags:n?.reprTags}),[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return le(this,function(d){switch(d.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)(u=this.plugin.helpers.substructureParent.get((s=r[i]).structure))&&($a(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:Re.toExpression(s)}));return 0===n.length?[2]:((c=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(et.Representation.StructureSelectionsOrientation3D),[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:c,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addPlane=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return le(this,function(d){switch(d.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)(u=this.plugin.helpers.substructureParent.get((s=r[i]).structure))&&($a(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:Re.toExpression(s)}));return 0===n.length?[2]:((c=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Plane"},{dependsOn:a}).apply(et.Representation.StructureSelectionsPlane3D),[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:c,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addOrderLabels=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d,f,p;return le(this,function(m){switch(m.label){case 0:for(n=this.getGroup(),a=this.plugin.state.data.select(wr.Generators.ofType(ve.Molecule.Structure.Selections).withTag(_I)),i=0,o=a;i<o.length;i++)n.delete(o[i]);for(u=1,c=0,l=r;c<l.length;c++)(f=this.plugin.helpers.substructureParent.get((d=l[c]).structure))&&(p=[f.transform.ref],n.apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:f.transform.ref,expression:Re.toExpression(d)}],isTransitive:!0,label:"Order"},{dependsOn:p,tags:_I}).apply(et.Representation.StructureSelectionsLabel3D,{textColor:dt.fromRgb(255,255,255),borderColor:dt.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:"".concat(u++)},{tags:_I}));return[4,Sr.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return m.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=wr.findTagInSubtree(n.tree,ln.RootRef,R6),i=a?n.select(wr.Generators.ofTransformer(r,a)):this._empty;return 0===i.length?this._empty:i},t.prototype.sync=function(){for(var r=[],n=0,a=this.getTransforms(et.Representation.StructureSelectionsLabel3D);n<a.length;n++){var i=a[n],o=i.obj.tags;(!o||!o.includes(_I))&&r.push(i)}this.updateState({labels:r,distances:this.getTransforms(et.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(et.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(et.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(et.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(et.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()},t}(Zp),VC=new oc("98"),Lst=function(e){function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:{structureCount:0,elementCount:0,label:"Nothing Selected"}})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return qt(t,e),Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats||(this.state.stats=this.calcStats()),this.state.stats},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new O6(Re(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=jd.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,c=s.length;u<c;++u)n+=Be.size(s[u].indices);jd.add(a,a,jd.ofLoci(o.selection))}});var i=xE(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Re.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Re.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.intersect(n.selection,r),this.referenceLoci=r,!Re.areEqual(a,n.selection)},t.prototype.set=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Re.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){void 0===i&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":b2(o,s);break;case"up":u=s-1;break;case"down":u=s+1}if(void 0!==u)for(var c=a?Math.min(o.length,a):o.length;;){if((u%=c)<0&&(u+=c),!i||o[s].loci.structure===o[u].loci.structure){var l=o[s];o[s]=o[u],o[u]=l;break}u+="up"===n?-1:1}this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.tryAddHistory=function(r){if(!pr.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(pr.areEqual(s.loci,r)){a=s;break}n++}if(a)return b2(this.additionsHistory,n),this.additionsHistory.unshift(a),void this.events.additionsHistoryUpdated.next(void 0);var c=xE(jd.ofLoci(r),{reverse:!0});this.additionsHistory.unshift({id:Gn.create22(),loci:r,label:c}),this.additionsHistory.length>24&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.clearHistory=function(){0!==this.state.additionsHistory.length&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++)(o=i[a]).loci.structure.root===r.root&&n.push(o);for(var s=0,u=n;s<u.length;s++){var o;this.modifyHistory(o=u[s],"remove")}0!==n.length&&this.events.additionsHistoryUpdated.next(void 0)},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),n?.data&&this.clearHistoryForStructure(n.data),(null===(a=this.referenceLoci)||void 0===a?void 0:a.structure)===n?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(n!==a&&n?.data!==a.data){var c=this.plugin.helpers.substructureParent.get(a.data,!0);if(c&&r===c.transform.ref&&this.entries.has(r)){var l=null===(o=null===(i=this.plugin.helpers.substructureParent.get(a.data))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data;if(l)if(!n?.data||Ye.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,function Vst(e,t){return new O6(Re.remap(e.selection,t))}(this.entries.get(r),l)),(null===(s=this.referenceLoci)||void 0===s?void 0:s.structure.root)===l.root&&(this.referenceLoci=Re.remap(this.referenceLoci,l));for(var d=!1,f=0,p=this.state.additionsHistory;f<p.length;f++){var h=p[f];h.loci.structure.root===l.root&&(h.loci=Re.remap(h.loci,l),d=!0)}d&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(r,new O6(Re(l,[]))),(null===(u=this.referenceLoci)||void 0===u?void 0:u.structure.root)===l.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(l),this.state.stats=void 0,this.events.changed.next(void 0)}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);Re.isEmpty(i.selection)||n.push(i.selection),i.selection=Re(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:Yr},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=null===(a=null===(n=r.cell)||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!Re.isEmpty(o.selection)},t.prototype.has=function(r){if(Re.is(r)){var n=this.getEntry(r.structure);if(n)return Re.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(Re.is(r)&&1===r.elements.length&&this.getEntry(r.structure)){var a=r.elements[0];if(a){var i=this.referenceLoci;if(i&&Re.is(i)&&i.structure===r.structure){for(var o,s=0,u=i.elements;s<u.length;s++){var c=u[s];if(a.unit===c.unit){o=c;break}}if(o&&a.unit===o.unit)return function zst(e,t,r){var n=Math.min(Be.min(t.indices),Be.min(r.indices)),a=Math.max(Be.max(t.indices),Be.max(r.indices));return Re(e,[{unit:t.unit,indices:Be.ofRange(n,a)}])}(r.structure,o,a)}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Re.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=S.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=S.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);VC.reset();var a=[];this.entries.forEach(function(l){var d=l.selection;Re.isEmpty(d)||a.push(Re.getBoundary(d))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,c=s.sphere;S.min(r,r,u.min),S.max(n,n,u.max),VC.includePositionRadius(c.center,c.radius)}for(VC.finishedIncludeStep(),i=0,o=a.length;i<o;++i)VC.radiusPositionRadius((c=a[i].sphere).center,c.radius);return{box:{min:r,max:n},sphere:VC.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=nT(this.entries.values());return Re.getPrincipalAxesMany(r.map(function(n){return n.selection}))},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n)}a&&(this.state.stats=void 0,this.events.changed.next(void 0))},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(void 0===a&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a)}},t.prototype.fromLoci=function(r,n,a){void 0===a&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){void 0===a&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var u=n(new Uc(o[i]));this.triggerInteraction(r,mt.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;void 0===a&&(a=!0),this.plugin.runTask(Ve.create("Structure Selection",function(o){return ce(i,void 0,void 0,function(){var s,u,l;return le(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?[4,n.getSelection(this.plugin,o,u[s])]:[3,4];case 2:l=d.sent(),this.triggerInteraction(r,mt.toLociWithSourceUnits(l),a),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=Mo.resolveAndCheck(this.plugin.state.data,r);if(a&&a.obj){if(!ve.Molecule.Structure.Selections.is(a.obj))return void console.warn("fromSelections applied to wrong object type.",a.obj);this.clear();for(var i=0,o=null===(n=a.obj)||void 0===n?void 0:n.data;i<o.length;i++)this.fromLoci("set",o[i].loci)}},t.prototype.getSnapshot=function(){var r=[];return this.entries.forEach(function(n,a){r.push({ref:a,bundle:en.fromLoci(n.selection)})}),{entries:r}},t.prototype.setSnapshot=function(r){var n,a;this.entries.clear();for(var i=0,o=r.entries;i<o.length;i++){var s=o[i],c=s.bundle,l=null===(a=null===(n=this.plugin.state.data.select(wr.Generators.byRef(s.ref))[0])||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(l){var d=en.toLoci(c,l);this.fromLoci("set",d,!1)}}},t}(Zp),O6=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure||(this._structure=pr.isEmpty(this._selection)?void 0:Re.toStructure(this._selection)),this._structure},enumerable:!1,configurable:!0}),e}();function F6(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Hst(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function jst(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function qst(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function N6(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Wue(){}var Xst=[[function Yst(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}(ve.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=N6(e,t,e.hierarchy.volumes,Hst,t)},function(e){return e.currentVolume=void 0}],[function(e){return ve.Volume.Lazy.is(e.obj)},function(e,t){N6(e,t,e.hierarchy.lazyVolumes,jst,t)},Wue],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ve.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&N6(e,t,e.currentVolume.representations,qst,t,e.currentVolume),!1},Wue]];function Yue(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===ua.Null||"ok"!==e.status&&"error"!==e.status)}function Kst(e){Yue(e.cell)||(this.changed=!0)}function Zst(e){Xue(this,this.tree.transforms.get(e))}function Xue(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(Yue(n)){for(var a=void 0,i=!1,o=0,s=Xst;o<s.length;o++){var u=s[o],l=u[1],d=u[2];if((0,u[0])(n,r)){if(!1===l(r,n)){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(Zst,e),a&&a(r)}}}var k6=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:F6(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return qt(t,e),Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(r||!this.dataState.inUpdate){if(this.state.syncedTree===this.dataState.tree)return void(r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection})));this.state.syncedTree=this.dataState.tree;var n=function Gst(e,t){var r=function Wst(e,t){return{state:e,oldHierarchy:t,hierarchy:F6(),changed:!1,added:new Set}}(e,t||F6());return function Qst(e,t){Xue({tree:e,state:t},e.root)}(e.tree,r),t&&t.refs.forEach(Kst,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}(this.plugin.state.data,this.current);if(n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection=this.state.selection&&a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(0!==r.length){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete("string"==typeof s?s:s.cell.transform.ref)}return a.commit({canUndo:!!n&&"Remove"})}},t.prototype.toggleVisibility=function(r,n){if(0!==r.length)for(var a=void 0!==n?"show"!==n:!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++)Ib(this.dataState,o[i].cell.transform.ref,a)},t.prototype.addRepresentation=function(r,n){var a;return this.dataState.build().to(r.cell).apply(et.Representation.VolumeRepresentation3D,LC(this.plugin,null===(a=r.cell.obj)||void 0===a?void 0:a.data,{type:n})).commit({canUndo:"Add Representation"})},t}(yC);!function(e){e.getRepresentationTypes=function t(r,n){var a,i;return null!==(a=n?.cell.obj)&&void 0!==a&&a.data?r.representation.volume.registry.getApplicableTypes(null===(i=n.cell.obj)||void 0===i?void 0:i.data):r.representation.volume.registry.types}}(k6||(k6={}));var Nm,B6=[["full","Full"],["hidden","Hidden"]],Jst={isExpanded:D.Boolean(!1),showControls:D.Boolean(!0),regionState:D.Group({left:D.Select("full",[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]]),top:D.Select("full",B6),right:D.Select("full",B6),bottom:D.Select("full",B6)}),controlsDisplay:D.Value("outside",{isHidden:!0})},eut=function(e){function t(r){var n=e.call(this,R(R({},D.getDefaultValues(Jst)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,Sr.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return qt(t,e),t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&"boolean"==typeof r.isExpanded&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next(void 0)},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:"viewport"===(a[s].name||"").toLowerCase()&&i.push(a[s]);for(var u=0,c=i;u<c.length;u++)n.removeChild(c[u]);o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement();this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:f.scrollTop,scrollLeft:f.scrollLeft,position:d.position,overflow:d.overflow,viewports:i,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var m=this.rootState,v=0,g=m.viewports;v<g.length;v++)n.appendChild(g[v]);(d=r.style).top=m.top,d.bottom=m.bottom,d.left=m.left,d.right=m.right,d.width=m.width,d.height=m.height,d.maxWidth=m.maxWidth,d.maxHeight=m.maxHeight,d.margin=m.margin,d.marginLeft=m.marginLeft,d.marginRight=m.marginRight,d.marginTop=m.marginTop,d.marginBottom=m.marginBottom,d.position=m.position,d.overflow=m.overflow||"",(f=this.getScrollElement()).scrollTop=m.scrollTop,f.scrollLeft=m.scrollLeft,this.rootState=void 0,this.root.style.zIndex=m.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(Zp),L6={includeTypes:D.MultiSelect(qA(Gr.Names),D.objectToOptions(Gr.Names)),excludeTypes:D.MultiSelect([],D.objectToOptions(Gr.Names)),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),aromaticBonds:D.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:D.Select("symmetric",D.arrayToOptions(["off","symmetric","offset"]))},U6=(D.getDefaultValues(L6),R(R(R({},Dg),L6),{adjustCylinderLength:D.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})})),V6=(D.getDefaultValues(U6),R(R({},dse),L6));function SI(e,t,r){return!Gr.is(e,r)||Gr.is(t,r)}function Kue(e,t,r){var n=t.elements,a=t.bonds,i=a.a,o=a.b,u=a.edgeProps.flags,c=r.ignoreHydrogens,l=r.ignoreHydrogensVariant,f=r.excludeTypes,p=Gr.fromNames(r.includeTypes),h=Gr.fromNames(f),m=Gr.isAll(p)&&0===h,v=e.child,g=v?.unitMap.get(t.id);if(v&&!g)throw new Error("expected childUnit to exist if child exists");if(!m||c||v)return function(y){var b=i[y],_=o[y];return!!(g&&!Xe.has(g.elements,n[b])||!m&&SI(p,h,u[y]))||!!c&&!(!nd(e,t,n[b],l)&&!nd(e,t,n[_],l))}}function Zue(e,t){var n=e.interUnitBonds.edges,a=t.ignoreHydrogens,i=t.ignoreHydrogensVariant,s=t.excludeTypes,u=Gr.fromNames(t.includeTypes),c=Gr.fromNames(s),l=Gr.isAll(u)&&0===c,d=e.child;if(!l||a||d)return function(f){if(d){var h=d.unitMap.get((p=n[f]).unitA);if(!h)return!0;var m=e.unitMap.get(p.unitA);if(!Xe.has(h.elements,m.elements[p.indexA]))return!0}if(a){var p,g=e.unitMap.get((p=n[f]).unitA),y=e.unitMap.get(p.unitB);if(nd(e,g,g.elements[p.indexA],i)||nd(e,y,y.elements[p.indexB],i))return!0}return!(l||!SI(u,c,n[f].props.flag))}}function z6(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId];if(Oe.isAtomic(u)){var c=o.target,l=u.bonds.a[i],d=u.bonds.b[i];return Ht.Loci(c,[Ht.Location(c,u,l,c,u,d),Ht.Location(c,u,d,c,u,l)])}}return Yr}function G6(e,t,r,n){var a=!1;if(Ht.isLoci(e)){var o=t.group;if(!Ye.areEquivalent(e.structure,t.structure))return!1;if(!Oe.isAtomic(s=o.units[0]))return!1;for(var u=2*s.bonds.edgeCount,c=0,l=e.bonds;c<l.length;c++){var d=l[c];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(void 0!==f){var p=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);-1!==p&&r(xe.ofSingleton(f*u+p))&&(a=!0)}}}}else if(Re.is(e)){var s;if(o=t.group,!Ye.areEquivalent(e.structure,t.structure))return!1;if(!Oe.isAtomic(s=o.units[0]))return!1;for(var h=2*s.bonds.edgeCount,m=function(x){var A=o.unitIndexMap.get(x.unit.id);if(void 0!==A){var T=s.bonds,w=T.offset,E=T.b;Be.forEach(x.indices,function(I){for(var M=w[I],F=w[I+1];M<F;M++)(!n||Be.has(x.indices,E[M]))&&r(xe.ofSingleton(A*h+M))&&(a=!0)})}},v=0,g=e.elements;v<g.length;v++)m(g[v])}return a}function H6(e,t,r){if(r===e.objectId){var i=t.target,o=t.interUnitBonds.edges[e.groupId],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Ht.Loci(i,[Ht.Location(i,s,o.indexA,i,u,o.indexB),Ht.Location(i,u,o.indexB,i,s,o.indexA)])}return Yr}D.getDefaultValues(V6),function(e){e.fromGroup=function t(n){var a=n.group,i=n.structure,o=a.units[0],s=Oe.isAtomic(o)?2*o.bonds.edgeCount:0,u=a.units.length,c=Ht.Location(i,void 0,void 0,i,void 0,void 0);return Ln(s,u,1,function(d,f){var p=a.units[f];return c.aUnit=p,c.bUnit=p,c.aIndex=p.bonds.a[d],c.bIndex=p.bonds.b[d],c})},e.fromStructure=function r(n){var a=n.interUnitBonds.edgeCount,o=Ht.Location(n,void 0,void 0,n,void 0,void 0);return Ln(a,1,1,function(u){var c=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(c.unitA),o.aIndex=c.indexA,o.bUnit=n.unitMap.get(c.unitB),o.bIndex=c.indexB,o},!0)}}(Nm||(Nm={}));var j6=new Map;function q6(e,t,r,n){var a=!1;if(Ht.isLoci(e)){if(!Ye.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var u=t.interUnitBonds.getBondIndexFromLocation(o[i]);-1!==u&&r(xe.ofSingleton(u))&&(a=!0)}}else if(Re.is(e)){if(!Ye.areEquivalent(e.structure,t)||n&&1===e.elements.length)return!1;for(var c=0,l=e.elements;c<l.length;c++)j6.set((d=l[c]).unit.id,d.indices);for(var f=function(m){var v=m.unit;if(!Oe.isAtomic(v))return"continue";t.interUnitBonds.getConnectedUnits(v.id).forEach(function(g){var y=j6.get(g.unitB);(!n||y)&&Be.forEach(m.indices,function(b){g.connectedIndices.includes(b)&&g.getEdges(b).forEach(function(_){if(!n||y&&Be.has(y,_.indexB)){var C=t.interUnitBonds.getEdgeIndex(b,v.id,_.indexB,g.unitB);r(xe.ofSingleton(C))&&(a=!0)}})})})},p=0,h=e.elements;p<h.length;p++){var d;f(d=h[p])}j6.clear()}return a}var W6=Gr.is;function Que(e,t,r,n){var M,a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,c=i.edgeProps,l=i.offset,d=c.order,f=c.flags,p=n.sizeFactor,h=n.sizeAspectRatio,m=n.adjustCylinderLength,v=n.aromaticBonds,y=n.excludeTypes,b=n.multipleBonds,_="off"===b,C="symmetric"===b,T=SI(Gr.fromNames(n.includeTypes),Gr.fromNames(y),32),w=S(),E=S(),I=e.conformation.invariantPosition,F=at.create(t,e),N=Ht.Location(t,e,void 0,t,e,void 0),j=t.child;if(n.includeParent&&j){var k=j.unitMap.get(e.id);if(!k)throw new Error("expected childUnit to exist");M=function(X){var Y=a[u[X]];return Xe.has(k.elements,a[s[X]])&&!Xe.has(k.elements,Y)}}var Q=e.rings,W=Q.elementRingIndices,K=Q.elementAromaticRingIndices,ne=v?e.resonance.delocalizedTriplets:void 0;return{linkCount:2*o,referencePosition:function(X){var L,Y,$=s[X],Z=u[X],q=ne?.getThirdElement($,Z);if(void 0!==q)return I(a[q],w);$>Z&&($=(L=[Z,$])[0],Z=L[1]),l[$+1]-l[$]==1&&($=(Y=[Z,$])[0],Z=Y[1]);for(var z=K.get($)||W.get($),te=0,ae=l[$],fe=l[$+1];ae<fe;++ae){var he=u[ae];if(he!==Z&&he!==$){if(!z)return I(a[he],w);var pe=K.get(he)||W.get(he);if(!pe)continue;var re=eT(z,pe);re>te&&(te=re,I(a[he],w))}}return te>0?w:null},position:function(X,L,Y){if(I(a[s[Y]],X),I(a[u[Y]],L),m){var $=function(X){return F.element=a[s[X]],r.size.size(F)*p}(Y),Z=function(X){return F.element=a[u[X]],r.size.size(F)*p}(Y),q=Math.min($,Z)*h,z=Math.sqrt(Math.max(0,$*$-q*q))-.05,te=Math.sqrt(Math.max(0,Z*Z-q*q))-.05;if(z<=.01&&te<=.01)return;S.normalize(E,S.sub(E,L,X)),S.scaleAndAdd(X,X,E,z),S.scaleAndAdd(L,L,E,-te)}},style:function(X){var L=d[X],Y=f[X];if(W6(Y,2)||W6(Y,4))return 1;if(3===L)return _?0:C?4:5;if(v){var Z=u[X],q=K.get(s[X]),z=K.get(Z),te=q&&z?eT(q,z):0;if(W6(Y,16)||te&&!T)return 2===te?8:7}return 2!==L||_?0:C?2:3},radius:function(X){return function(X){return N.aIndex=s[X],N.bIndex=u[X],r.size.size(N)*p}(X)*h},ignore:Kue(t,e,n),stub:M}}function tut(e,t,r,n,a,i){if(!Oe.isAtomic(t)||!t.bonds.edgeCount)return ou.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return ou.createEmpty(i);var c=fse(0,Que(t,r,n,a),a,i),l=c.cylinders,d=c.boundingSphere;if(d)l.setBoundingSphere(d);else if(l.cylinderCount>0){var f=De.expand(De(),(s??t).boundary.sphere,1*a.sizeFactor);l.setBoundingSphere(f)}return l}function rut(e,t,r,n,a,i){if(!Oe.isAtomic(t)||!t.bonds.edgeCount)return Lt.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(i);var c=Eg(0,Que(t,r,n,a),a,i),l=c.mesh,d=c.boundingSphere;if(d)l.setBoundingSphere(d);else if(l.triangleCount>0){var f=De.expand(De(),(s??t).boundary.sphere,1*a.sizeFactor);l.setBoundingSphere(f)}return l}var CI=R(R(R(R({},po),t6),U6),{sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:D.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:D.Boolean(!0),includeParent:D.Boolean(!1)});function $ue(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function nut(e){return r6({defaultProps:D.getDefaultValues(CI),createGeometry:tut,createLocationIterator:Nm.fromGroup,getLoci:z6,eachLocation:G6,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xs(r.includeTypes,n.includeTypes)||!Xs(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Oe.isAtomic(u)&&Oe.isAtomic(c)&&(Cu.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function aut(e){return Xo({defaultProps:D.getDefaultValues(CI),createGeometry:rut,createLocationIterator:Nm.fromGroup,getLoci:z6,eachLocation:G6,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xs(r.includeTypes,n.includeTypes)||!Xs(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Oe.isAtomic(u)&&Oe.isAtomic(c)&&(Cu.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var Y6=new Ht.ElementBondIterator;function Jue(e,t,r,n){for(Y6.setElement(t,r,n);Y6.hasNext;){var a=Y6.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var ece=S();function tce(e,t,r){var v,n=at.create(e),a=Ht.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,c=r.sizeAspectRatio,l=r.adjustCylinderLength,d=r.aromaticBonds,f=r.multipleBonds,p="off"===f,h="symmetric"===f,m=S(),g=e.child;return r.includeParent&&g&&(v=function(C){var x=s[C],A=g.unitMap.get(x.unitA),T=g.unitMap.get(x.unitB),E=e.unitMap.get(x.unitA).elements[x.indexA],M=e.unitMap.get(x.unitB).elements[x.indexB];return A&&Xe.has(A.elements,E)&&(!T||!Xe.has(T.elements,M))}),{linkCount:o,referencePosition:function(C){var A,T,w,E,x=s[C];if(x.unitA<x.unitB)A=e.unitMap.get(x.unitA),T=e.unitMap.get(x.unitB),w=x.indexA,E=x.indexB;else{if(!(x.unitA>x.unitB))throw new Error("same units in createInterUnitBondCylinderMesh");A=e.unitMap.get(x.unitB),T=e.unitMap.get(x.unitA),w=x.indexB,E=x.indexA}return Jue(ece,e,A,w)||Jue(ece,e,T,E)},position:function(C,x,A){var T=s[A],w=e.unitMap.get(T.unitA),E=e.unitMap.get(T.unitB);if(w.conformation.position(w.elements[T.indexA],C),E.conformation.position(E.elements[T.indexB],x),l){var I=function(C){var x=s[C];return n.unit=e.unitMap.get(x.unitA),n.element=n.unit.elements[x.indexA],t.size.size(n)*u}(A),M=function(C){var x=s[C];return n.unit=e.unitMap.get(x.unitB),n.element=n.unit.elements[x.indexB],t.size.size(n)*u}(A),F=Math.min(I,M)*c,N=Math.sqrt(Math.max(0,I*I-F*F))-.05,j=Math.sqrt(Math.max(0,M*M-F*F))-.05;if(N<=.01&&j<=.01)return;S.normalize(m,S.sub(m,x,C)),S.scaleAndAdd(C,C,m,N),S.scaleAndAdd(x,x,m,-j)}},style:function(C){var x=s[C].props.order,A=rs.create(s[C].props.flag);return Gr.is(A,2)||Gr.is(A,4)?1:3===x?p?0:h?4:5:d&&Gr.is(A,16)?7:2!==x||p?0:h?2:3},radius:function(C){return function(C){var x=s[C];return a.aUnit=e.unitMap.get(x.unitA),a.aIndex=x.indexA,a.bUnit=e.unitMap.get(x.unitB),a.bIndex=x.indexB,t.size.size(a)*u}(C)*c},ignore:Zue(e,r),stub:v}}function iut(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return ou.createEmpty(a);var o=fse(0,tce(t,r,n),n,a),s=o.cylinders,u=o.boundingSphere;if(u)s.setBoundingSphere(u);else if(s.cylinderCount>0){var c=t.child,l=De.expand(De(),(c??t).boundary.sphere,1*n.sizeFactor);s.setBoundingSphere(l)}return s}function out(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Lt.createEmpty(a);var o=Eg(0,tce(t,r,n),n,a),s=o.mesh,u=o.boundingSphere;if(u)s.setBoundingSphere(u);else if(s.triangleCount>0){var c=t.child,l=De.expand(De(),(c??t).boundary.sphere,1*n.sizeFactor);s.setBoundingSphere(l)}return s}var xI=R(R(R(R({},Bb),qrt),U6),{sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:D.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:D.Boolean(!0),includeParent:D.Boolean(!1)});function rce(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function sut(e){return function Wrt(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ou.Utils}),t)}({defaultProps:D.getDefaultValues(xI),createGeometry:iut,createLocationIterator:Nm.fromStructure,getLoci:H6,eachLocation:q6,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xs(r.includeTypes,n.includeTypes)||!Xs(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function uut(e){return $p({defaultProps:D.getDefaultValues(xI),createGeometry:out,createLocationIterator:Nm.fromStructure,getLoci:H6,eachLocation:q6,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xs(r.includeTypes,n.includeTypes)||!Xs(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var Wb,cut=qe.add3,lut=qe.add;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,c,l){cut(i,s,u,c),lut(o,l)},getSpheres:function(){var s=qe.compact(i,!0),u=qe.compact(o,!0);return ol.create(s,u,i.elementCount,a)}}}}(Wb||(Wb={}));var mo,Yb=S.add;function Ng(e,t,r){var n=r.ignoreHydrogens,a=r.ignoreHydrogensVariant,i=r.traceOnly,o=Oe.isCoarse(t),s=e.child,u=s?.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(s||n||i)return function(c){return!!u&&!Xe.has(u.elements,c)||!o&&n&&nd(e,t,c,a)||i&&!$5(t,c)}}function dut(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(i);for(var u=a.detail,c=a.sizeFactor,l=a.stride,d=t.elements,f=d.length,p=f*ib(u),h=ft.createState(p,p/2,i),m=S(),v=t.conformation.invariantPosition,g=Ng(r,t,a),y=at.create(r,t),b=n.size.size,_=S(),C=0,x=0,A=0;A<f;A++)if(!(l&&A%l!=0||g&&g(d[A]))){v(d[A],m),Yb(_,_,m),x+=1,y.element=d[A];var T=b(y);T>C&&(C=T),h.currentGroup=A,$r(h,m,T*c,u)}var I,w=i?De.clone(i.boundingSphere):void 0,E=ft.getMesh(h);return 0===x||(S.scale(_,_,1/x),I=w&&S.distance(_,w.center)/w.radius<.1?w:De.expand(De(),(s??t).boundary.sphere,C*c+.05),E.setBoundingSphere(I)),E}function fut(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return ol.createEmpty(i);var u=a.sizeFactor,c=a.stride,l=t.elements,d=l.length,f=Wb.create(d,d/2,i),p=S(),h=t.conformation.invariantPosition,m=Ng(r,t,a),v=at.create(r,t),g=n.size.size,y=S(),b=0,_=0;if(c&&c>1||m||"uniform"!==n.size.granularity){for(var C=0;C<d;C++)if(!(c&&C%c!=0||m&&m(l[C]))){h(l[C],p),f.add(p[0],p[1],p[2],C),Yb(y,y,p),_+=1,v.element=l[C];var x=g(v);x>b&&(b=x)}}else{for(C=0;C<d;C++)h(l[C],p),f.add(p[0],p[1],p[2],C),Yb(y,y,p);_=d,b=g(v)}var w,A=i?De.clone(i.boundingSphere):void 0,T=f.getSpheres();return 0===_||(S.scale(y,y,1/_),w=A&&S.distance(y,A.center)/A.radius<.1?A:De.expand(De(),(s??t).boundary.sphere,b*u+.05),T.setBoundingSphere(w)),T}function cd(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ye.areEquivalent(e.structure,t.structure))return!1;for(var o=i.elements.length,s=i.unitIndexMap,u=0,c=e.elements;u<c.length;u++){var l=c[u],d=s.get(l.unit.id);if(void 0!==d){var f=d*o;if(xe.is(l.indices)){var p=f+xe.start(l.indices),h=f+xe.end(l.indices);r(xe.ofBounds(p,h))&&(n=!0)}else for(var m=0,v=l.indices.length;m<v;m++){p=l.indices[m];for(var g=m+1;g<v&&l.indices[g]===p;)g++;n=r(xe.ofRange(f+p,f+(h=l.indices[m=g-1])))||n}}}return n}function ld(e,t,r){if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId],c=Be.ofSingleton(e.groupId);return Re(o.target,[{unit:u,indices:c}])}return Yr}function put(e,t,r,n,a){for(var i=t.child,o=n.detail,s=n.sizeFactor,u=n.stride,c=t.serialMapping.getSerialIndex,d=t.elementCount*ib(o),f=ft.createState(d,d/2,a),p=r.size.size,h=S(),m=0,v=0,g=0,y=t.units;g<y.length;g++){var b=y[g],_=i?.unitMap.get(b.id);if(!i||_)for(var C=b.elements,x=C.length,A=S(),T=b.conformation.position,w=Ng(t,b,n),E=at.create(t,b),I=0;I<x;I++){var M=C[I];if(!(u&&I%u!=0||w&&w(M))){T(M,A),Yb(h,h,A),v+=1,E.element=M;var F=p(E);F>m&&(m=F),f.currentGroup=c(b,M),$r(f,A,F*s,o)}}}var k,N=a?De.clone(a.boundingSphere):void 0,j=ft.getMesh(f);return 0===v||(S.scale(h,h,1/v),k=N&&S.distance(h,N.center)/N.radius<1?N:De.expand(De(),(i??t).boundary.sphere,m*s+.05),j.setBoundingSphere(k)),j}function hut(e,t,r,n,a){for(var i=t.child,o=n.sizeFactor,s=n.stride,u=t.serialMapping.getSerialIndex,c=t.elementCount,l=Wb.create(c,c/2,a),d=r.size.size,f=S(),p=0,h=0,m=0,v=t.units;m<v.length;m++){var g=v[m],y=i?.unitMap.get(g.id);if(i&&!y)return ol.createEmpty(a);var b=g.elements,_=b.length,C=S(),x=g.conformation.position,A=Ng(t,g,n),T=at.create(t,g);if(s&&s>1||A||"uniform"!==r.size.granularity)for(var w=0;w<_;w++){var E=b[w];if(!(s&&w%s!=0||A&&A(E))){x(E,C),l.add(C[0],C[1],C[2],u(g,E)),Yb(f,f,C),h+=1,T.element=E;var I=d(T);I>p&&(p=I)}}else{for(w=0;w<_;w++)x(E=b[w],C),l.add(C[0],C[1],C[2],u(g,E)),Yb(f,f,C);h+=_,p=d(T)}}var N,M=a?De.clone(a.boundingSphere):void 0,F=l.getSpheres();return 0===h||(S.scale(f,f,1/h),N=M&&S.distance(f,M.center)/M.radius<1?M:De.expand(De(),(i??t).boundary.sphere,p*o+.05),F.setBoundingSphere(N)),F}function kg(e,t,r){var n=!1;if(!Re.is(e)||!Ye.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(void 0!==u)if(xe.is(s.indices)){var c=a[u]+xe.start(s.indices),l=a[u]+xe.end(s.indices);r(xe.ofBounds(c,l))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++)r(xe.ofSingleton(a[u]+s.indices[d]))&&(n=!0)}return n}function Bg(e,t,r){var a=e.groupId;if(r===e.objectId){var i=t.serialMapping,u=i.unitIndices[a];return Re(t,[{unit:t.units[u],indices:Be.ofSingleton(a-i.cumulativeUnitElementCount[u])}])}return Yr}!function(e){e.fromGroup=function t(n){var a=n.group,o=a.elements.length,s=a.units.length,u=at.create(n.structure);return Ln(o,s,1,function(l,d){var f=a.units[d];return u.unit=f,u.element=f.elements[l],u})},e.fromStructure=function r(n){var a=n.units,o=n.elementCount,u=n.serialMapping,c=u.unitIndices,l=u.elementIndices,d=at.create(n);return Ln(o,1,1,function(p){return d.unit=a[c[p]],d.element=l[p],d},!0)}}(mo||(mo={}));var nce={sizeFactor:D.Numeric(1,{min:0,max:10,step:.1}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),traceOnly:D.Boolean(!1),tryUseImpostor:D.Boolean(!0),stride:D.Numeric(1,{min:1,max:100,step:1})},wI=R(R(R({},po),J5),nce);function ace(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?function mut(e){return e6({defaultProps:D.getDefaultValues(wI),createGeometry:fut,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function vut(e){return Xo({defaultProps:D.getDefaultValues(wI),createGeometry:dut,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var ice=R(R(R({},Bb),Hrt),nce);function gut(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?function yut(e){return function jrt(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ol.Utils}),t)}({defaultProps:D.getDefaultValues(ice),createGeometry:hut,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function but(e){return $p({defaultProps:D.getDefaultValues(ice),createGeometry:put,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var oce={"element-sphere":function(e,t){return va("Element sphere",e,t,ace)},"intra-bond":function(e,t){return va("Intra-unit bond cylinder",e,t,$ue)},"inter-bond":function(e,t){return Sc("Inter-unit bond cylinder",e,t,rce)}},X6=R(R(R(R(R({},wI),{traceOnly:D.Boolean(!1,{isHidden:!0})}),CI),xI),{includeParent:D.Boolean(!1),unitKinds:wC(["atomic"]),sizeFactor:D.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:D.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:D.MultiSelect(["element-sphere","intra-bond","inter-bond"],D.objectToOptions(oce)),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory)}),Cut={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:function Sut(e,t){return dr.createMulti("Ball & Stick",e,t,ho,oce)},getParams:function _ut(e,t){if(Ye.getSize(t)>=Ye.Size.Huge){var n=D.clone(X6);return n.visuals.defaultValue=["element-sphere","intra-bond"],n}return X6},defaultValues:D.getDefaultValues(X6),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function xut(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,c=at.create(t),d=Eg(0,{linkCount:o.length,position:function(m,v,g){var y=o[g];S.copy(m,s[y.carbohydrateIndexA].geometry.center),S.copy(v,s[y.carbohydrateIndexB].geometry.center)},radius:function(m){var g=s[o[m].carbohydrateIndexA],y=g.unit.rings.all[g.ringIndex];return c.unit=g.unit,c.element=g.unit.elements[y[0]],r.size.size(c)*u}},n,a),f=d.mesh,p=d.boundingSphere;if(p)f.setBoundingSphere(p);else if(f.triangleCount>0){var h=De.expand(De(),t.boundary.sphere,1*u);f.setBoundingSphere(h)}return f}var sce=R(R(R({},po),Dg),{linkSizeFactor:D.Numeric(.3,{min:0,max:3,step:.01})});function wut(e){return $p({defaultProps:D.getDefaultValues(sce),createGeometry:xut,createLocationIterator:Aut,getLoci:Tut,eachLocation:Dut,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Aut(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,o=at.create(e);return Ln(a,1,1,function(u){var l=r[n[u].carbohydrateIndexA],d=l.unit.rings.all[l.ringIndex];return o.unit=l.unit,o.element=l.unit.elements[d[0]],o},!0)}function Tut(e,t,r){if(r===e.objectId){var i=t.carbohydrates,s=i.elements,u=i.links[e.groupId],c=s[u.carbohydrateIndexA],l=s[u.carbohydrateIndexB];return Re.union(xC(t,c.unit,c.residueIndex,c.altId),xC(t,l.unit,l.residueIndex,l.altId))}return Yr}var K6=new Set;function Dut(e,t,r){var n=!1;if(!Re.is(e)||!Ye.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(d,f){if(!Oe.isAtomic(d))return"continue";K6.clear(),Be.forEach(f,function(p){for(var h=a(d,d.elements[p]),m=0,v=h.length;m<v;++m)K6.has(h[m])||(K6.add(h[m]),r(xe.ofSingleton(h[m]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o];i(u.unit,u.indices)}return n}var Q6,$6,Eut=S.create(0,0,-.5),AI=S.create(0,0,.5),km=S(),Bm=S(),TI=S(),uce=S();var iU,oU,Rut={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},eU=S.zero(),tU=S.zero(),rU=S.zero(),zC=S.zero(),nU=S.zero(),aU=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],Fut=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],Nut=[0,2,4,0,4,3,1,2,5,1,5,3];kS(aU,[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5]);var Wt=me.identity(),ah=S(),lce=S(),Vut=1.612,dce=TB(),fce=function SGe(){return DB||(DB=cte(!0)),DB}(),zut=function Iut(){return Q6||(Q6=function cce(e){for(var t=e.length/3,n=(3===t?1:4===t?2:t)+t,i=nb(n,4===t?3*t+4:3*n),o=0;o<t;++o){var s=(o+1)%t;S.set(km,e[3*o],e[3*o+1],-.5),S.set(Bm,e[3*s],e[3*s+1],-.5),i.add(km,Bm,AI)}if(3===t)S.set(km,e[0],e[1],-.5),S.set(Bm,e[3],e[4],-.5),S.set(TI,e[6],e[7],-.5),i.add(TI,Bm,km);else if(4===t)S.set(km,e[0],e[1],-.5),S.set(Bm,e[3],e[4],-.5),S.set(TI,e[6],e[7],-.5),S.set(uce,e[9],e[10],-.5),i.addQuad(uce,TI,Bm,km);else for(o=0;o<t;++o)s=(o+1)%t,S.set(km,e[3*o],e[3*o+1],-.5),S.set(Bm,e[3*s],e[3*s+1],-.5),i.add(Eut,Bm,km);return i.getPrimitive()}(ef(8,!0))),Q6}(),pce=function Put(){if(!$6){for(var e=ef(8,!0),t=new Float32Array(30),r=0;r<8;++r)t[3*r]=e[3*r],t[3*r+1]=e[3*r+1],t[3*r+2]=-.5;t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5,$6=ND(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return $6}(),Gut=function Out(e){for(var t=R(R({},Rut),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,s=nb(2*i*2),u=new Float32Array(2*i),c=new Float32Array(2*i),l=0;l<i;++l){var d=2*l,f=2*l+1,p=(d+1)/i*Math.PI,h=(f+1)/i*Math.PI;c[d]=Math.cos(p)*r,c[f]=Math.sin(p)*r,u[d]=Math.cos(h)*n,u[f]=Math.sin(h)*n}for(S.set(eU,0,0,a/2),S.set(tU,0,0,-a/2),l=0;l<i;++l){var m=(l+1)%i;S.set(rU,c[2*l],c[2*l+1],0),S.set(zC,u[2*l],u[2*l+1],0),S.set(nU,c[2*m],c[2*m+1],0),s.add(eU,rU,zC),s.add(zC,rU,tU),s.add(eU,zC,nU),s.add(nU,zC,tU)}return s.getPrimitive()}({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Hut=function But(){return iU||(iU=ND(aU,Fut)),iU}(),hce=function Lut(){return oU||(oU=ND(aU,Nut)),oU}(),mce=function Jze(){return lB||(lB=sb(ef(4,!1))),lB}(),jut=function eGe(){return dB||(dB=sb(ef(5,!1))),dB}(),qut=function tGe(){return fB||(fB=sb(ef(6,!1))),fB}(),Wut=function rGe(){return pB||(pB=sb(ef(6,!0))),pB}(),Yut=function nGe(){return hB||(hB=sb(ef(7,!1))),hB}();function Xut(e,t,r,n,a){for(var i=ft.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,c=u.elements.length,l=at.create(t),d=0;d<c;++d){var f=u.elements[d],p=f.unit.rings.all[f.ringIndex],h=bPe(f.component.type,p.length);l.unit=f.unit,l.element=f.unit.elements[p[0]];var m=r.size.size(l),v=m*s,g=m*s*Vut,y=f.geometry,b=y.center,_=y.normal;switch(S.add(lce,b,y.direction),me.targetTo(Wt,b,lce,_),me.setTranslation(Wt,b),i.currentGroup=2*d,h){case Fn.FilledSphere:$r(i,b,v,o);break;case Fn.FilledCube:me.scaleUniformly(Wt,Wt,g),ft.addPrimitive(i,Wt,dce);break;case Fn.CrossedCube:me.scaleUniformly(Wt,Wt,g),ft.addPrimitive(i,Wt,fce),me.mul(Wt,Wt,me.rotZ90X180),i.currentGroup+=1,ft.addPrimitive(i,Wt,fce);break;case Fn.FilledCone:me.scaleUniformly(Wt,Wt,1.2*g),ft.addPrimitive(i,Wt,zut);break;case Fn.DevidedCone:me.scaleUniformly(Wt,Wt,1.2*g),ft.addPrimitive(i,Wt,pce),me.mul(Wt,Wt,me.rotZ90),i.currentGroup+=1,ft.addPrimitive(i,Wt,pce);break;case Fn.FlatBox:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,g,g,g/2)),ft.addPrimitive(i,Wt,dce);break;case Fn.FilledStar:me.scaleUniformly(Wt,Wt,g),me.mul(Wt,Wt,me.rotZY90),ft.addPrimitive(i,Wt,Gut);break;case Fn.FilledDiamond:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,1.4*g,1.4*g,1.4*g)),ft.addPrimitive(i,Wt,Hut);break;case Fn.DividedDiamond:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,1.4*g,1.4*g,1.4*g)),ft.addPrimitive(i,Wt,hce),me.mul(Wt,Wt,me.rotY90),i.currentGroup+=1,ft.addPrimitive(i,Wt,hce);break;case Fn.FlatDiamond:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,g,g/2,g/2)),ft.addPrimitive(i,Wt,mce);break;case Fn.DiamondPrism:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,g,g,g/2)),ft.addPrimitive(i,Wt,mce);break;case Fn.PentagonalPrism:case Fn.Pentagon:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,g,g,g/2)),ft.addPrimitive(i,Wt,jut);break;case Fn.HexagonalPrism:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,g,g,g/2)),ft.addPrimitive(i,Wt,qut);break;case Fn.HeptagonalPrism:me.mul(Wt,Wt,me.rotZY90),me.scale(Wt,Wt,S.set(ah,g,g,g/2)),ft.addPrimitive(i,Wt,Yut);break;default:me.mul(Wt,Wt,me.rotZYZ90),me.scale(Wt,Wt,S.set(ah,g/1.5,g,g/2)),ft.addPrimitive(i,Wt,Wut)}}return ft.getMesh(i)}var vce=R(R({},Bb),{detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),sizeFactor:D.Numeric(1.75,{min:0,max:10,step:.01})});function Kut(e){return $p({defaultProps:D.getDefaultValues(vce),createGeometry:Xut,createLocationIterator:Zut,getLoci:Qut,eachLocation:$ut,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Zut(e){var t=e.carbohydrates.elements,r=2*t.length,a=at.create(e);return Ln(r,1,1,function i(s,u){var c=t[Math.floor(s/2)],l=c.unit.rings.all[c.ringIndex];return a.unit=c.unit,a.element=c.unit.elements[l[0]],a},!0,function o(s,u){return s%2==1})}function Qut(e,t,r){if(r===e.objectId){var i=t.carbohydrates.elements[Math.floor(e.groupId/2)];return xC(t,i.unit,i.residueIndex,i.altId)}return Yr}var sU=new Set;function $ut(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!Re.is(e)||!Ye.areEquivalent(e.structure,t))return!1;for(var i=function(d,f){if(!Oe.isAtomic(d))return"continue";sU.clear(),Be.forEach(f,function(p){for(var h=n(d,d.elements[p]),m=0,v=h.length;m<v;++m)sU.has(h[m])||(sU.add(h[m]),r(xe.ofSingleton(2*h[m]))&&(a=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o];i(u.unit,u.indices)}return a}function Jut(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,c=at.create(t),d=Eg(0,{linkCount:o.length,position:function(m,v,g){var y=o[g];y.fromCarbohydrate?(S.copy(m,s[y.carbohydrateIndex].geometry.center),y.elementUnit.conformation.position(y.elementUnit.elements[y.elementIndex],v)):(y.elementUnit.conformation.position(y.elementUnit.elements[y.elementIndex],m),S.copy(v,s[y.carbohydrateIndex].geometry.center))},radius:function(m){var v=o[m];if(v.fromCarbohydrate){var g=s[v.carbohydrateIndex],y=g.unit.rings.all[g.ringIndex];c.unit=g.unit,c.element=g.unit.elements[y[0]]}else c.unit=v.elementUnit,c.element=v.elementUnit.elements[v.elementIndex];return r.size.size(c)*u},style:function(m){var v=o[m],y=Ud(v.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(v.elementUnit.elements[v.elementIndex]));return F2.has(y)?1:0}},n,a),f=d.mesh,p=d.boundingSphere;if(p)f.setBoundingSphere(p);else if(f.triangleCount>0){var h=De.expand(De(),t.boundary.sphere,1*u);f.setBoundingSphere(h)}return f}var gce=R(R(R({},po),Dg),{terminalLinkSizeFactor:D.Numeric(.2,{min:0,max:3,step:.01})});function ect(e){return $p({defaultProps:D.getDefaultValues(gce),createGeometry:Jut,createLocationIterator:tct,getLoci:rct,eachLocation:nct,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function tct(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,o=at.create(e);return Ln(a,1,1,function(u){var c=n[u];if(c.fromCarbohydrate){var l=r[c.carbohydrateIndex],d=l.unit.rings.all[l.ringIndex];o.unit=l.unit,o.element=l.unit.elements[d[0]]}else o.unit=c.elementUnit,o.element=c.elementUnit.elements[c.elementIndex];return o},!0)}function rct(e,t,r){if(r===e.objectId){var i=t.carbohydrates,u=i.terminalLinks[e.groupId],c=i.elements[u.carbohydrateIndex];return Re.union(xC(t,c.unit,c.residueIndex,c.altId),function Ort(e,t,r){var n=t.elements,a=t.model,o=a.atomicHierarchy.atoms.label_alt_id.value(r);return-1!==Be.indexOf(n,r)?xC(e,t,a.atomicHierarchy.residueAtomSegments.index[r],o):Re(e,[])}(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return Yr}var uU=new Set;function nct(e,t,r){var n=!1;if(!Re.is(e)||!Ye.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(d,f){if(!Oe.isAtomic(d))return"continue";uU.clear(),Be.forEach(f,function(p){for(var h=a(d,d.elements[p]),m=0,v=h.length;m<v;++m)uU.has(h[m])||(uU.add(h[m]),r(xe.ofSingleton(h[m]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o];i(u.unit,u.indices)}return n}var yce={"carbohydrate-symbol":function(e,t){return Sc("Carbohydrate symbol mesh",e,t,Kut)},"carbohydrate-link":function(e,t){return Sc("Carbohydrate link cylinder",e,t,wut)},"carbohydrate-terminal-link":function(e,t){return Sc("Carbohydrate terminal link cylinder",e,t,ect)}},bce=R(R(R(R({},vce),sce),gce),{visuals:D.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],D.objectToOptions(yce)),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory)}),oct={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:function ict(e,t){return dr.createMulti("Carbohydrate",e,t,ho,yce)},getParams:function act(e,t){return bce},defaultValues:D.getDefaultValues(bce),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return ir.hasCarbohydrate(t)})}};function _ce(e,t){switch(e.kind){case 0:return function sct(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=wn.transientSegments(HC(e),e.elements),a=tr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,c=!0,l=-1,d=0;n.hasNext;){for(c=!0,l=d,a.setSegment(n.move());a.hasNext;){if(c){var f=a.move().index;if(++d,!a.hasNext)continue;c=!1,u=f}var p=a.move().index;t(i[s=u],i[u=p],d-1,d,o[s]),++d}r.has(u)&&(u=r.get(s=u),t(i[s],i[u],d-1,l,o[s]))}}(e,t);case 1:case 2:return function uct(e,t){for(var r=wn.transientSegments(HC(e),e.elements),n=e.elements,a=!0,i=0;r.hasNext;){a=!0;for(var o=r.move(),c=o.start,l=o.end;c<l;++c){if(a){if(++i,++c>l)continue;a=!1}t(n[c-1],n[c],i-1,i,0),++i}}}(e,t)}}function Sce(e,t){switch(e.kind){case 0:return function cct(e,t){for(var r=wn.transientSegments(HC(e),e.elements),n=tr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;)t(a[n.move().index],i),++i}(e,t);case 1:case 2:return function lct(e,t){for(var r=wn.transientSegments(HC(e),e.elements),n=e.elements,a=0;r.hasNext;)for(var i=r.move(),u=i.start,c=i.end;u<c;++u)t(n[u],a),++a}(e,t)}}function Cce(e,t){return{centerA:at.create(e,t),centerB:at.create(e,t)}}var fct=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=wn.transientSegments(Mce(r),r.elements),this.value=Cce(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),pct=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=wn.transientSegments(Mce(r),r.elements),this.value=Cce(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function hct(e){for(var t=e.atomicConformation,r=t.x,n=t.y,a=t.z,i=e.atomicHierarchy.derived.residue,s=i.traceElementIndex,u=i.polymerType.length,c=Be.ofBounds(0,e.atomicConformation.atomId.rowCount),l=wn.transientSegments(e.atomicRanges.polymerRanges,c),d=tr.transientSegments(e.atomicHierarchy.residueAtomSegments,c),f=new Float32Array(3*u),p=new Float32Array(3*u),h=0,m=-1,v=-1,g=S(),y=S(),b=S(),_=S(),C=S(),x=S(),A=S(),T=S(),w=S(),E=S(),I=S(),M=S(),F=S(),N=S();l.hasNext;){var j=l.move();for(d.setSegment(j),h=-1,v=-1;d.hasNext;){h+=1;var k=d.move().index;0===h&&(v=k);var H=3*(m=k-2);S.copy(g,y),S.copy(y,b),S.copy(b,_);var G=s[k];if(S.set(_,r[G],n[G],a[G]),!(h<3)){S.sub(C,y,g),S.sub(x,b,y),S.sub(A,_,b),S.sub(I,C,x),S.sub(M,x,A),S.cross(F,I,M),S.normalize(F,F),S.toArray(F,p,H);var U=Math.cos(S.angle(I,M)),Q=S.magnitude(I),W=S.magnitude(M),K=Math.sqrt(W*Q)/Math.max(2,2*(1-U));S.scale(T,I,K/Q),S.sub(T,y,T),S.toArray(T,f,H),S.scale(w,M,K/W),S.sub(w,b,w),S.toArray(w,f,H+3),S.copy(N,F)}}var ne=3*v;S.fromArray(T,f,ne+3),S.fromArray(w,f,ne+6),S.normalize(F,S.sub(F,T,w));var X=s[v];S.set(g,r[X],n[X],a[X]),S.copy(E,g),S.projectPointOnVector(E,E,F,T),S.toArray(E,f,ne);var L=m+2,Y=3*L;S.fromArray(T,f,Y-3),S.fromArray(w,f,Y-6),S.normalize(F,S.sub(F,T,w));var $=s[L];S.set(g,r[$],n[$],a[$]),S.copy(E,g),S.projectPointOnVector(E,E,F,T),S.toArray(E,f,Y)}return{centers:f}}var cU=Xv.createProvider({label:"Helix Orientation",descriptor:ec({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ce(void 0,void 0,void 0,function(){return le(this,function(r){return[2,{value:hct(t)}]})})}});function dd(e){return cn.is(e,2)}function lU(e,t,r){switch(void 0===r&&(r={}),e.kind){case 0:return new vct(e,t,r);case 1:case 2:return new gct(e,t)}}var DI=cn.create(536870912);function xce(e,t){return{center:at.create(e,t),centerPrev:at.create(e,t),centerNext:at.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:DI,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:S(),p1:S(),p2:S(),p3:S(),p4:S(),d12:S(),d23:S()}}var ar=S(),EI=S(),II=S(),vct=function(){function e(t,r,n){var a;if(void 0===n&&(n={}),this.unit=t,this.state=0,this.p0=S(),this.p1=S(),this.p2=S(),this.p3=S(),this.p4=S(),this.p5=S(),this.p6=S(),this.d01=S(),this.d12=S(),this.d23=S(),this.d34=S(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=wn.transientSegments(this.polymerRanges,t.elements),this.residueIt=tr.transientSegments(this.residueAtomSegments,t.elements),this.value=xce(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=null===(a=Hc.get(r).value)||void 0===a?void 0:a.get(t.invariantId)),n.useHelixOrientation){var i=cU.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}return e.prototype.atomicPos=function(t,r){-1!==r&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var a=this.traceElementIndex[r];this.helixOrientationCenters&&dd(n)?S.fromArray(t,this.helixOrientationCenters,3*r):this.atomicPos(t,a)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[2*t.index]],this.residueSegmentMax=r[this.polymerRanges[2*t.index+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin)t=void 0!==(r=this.cyclicPolymerMap.get(this.residueSegmentMin))?r-(this.residueSegmentMin-t-1):this.residueSegmentMin;else if(t>this.residueSegmentMax){var r;t=void 0!==(r=this.cyclicPolymerMap.get(this.residueSegmentMax))?r+(t-this.residueSegmentMax-1):this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,i=r.type[(0,r.getIndex)(t)];return dd(i)?2:i}return DI},e.prototype.setControlPoint=function(t,r,n,a,i){(function mct(e){return cn.is(e,4)})(i)||this.helixOrientationCenters&&dd(i)?S.scale(t,S.add(t,r,S.add(t,a,S.add(t,n,n))),1/4):S.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&dd(n)?S.set(t,1,0,0):(this.atomicPos(EI,this.directionFromElementIndex[r]),this.atomicPos(II,this.directionToElementIndex[r]),S.sub(t,II,EI))},e.prototype.setDirection=function(t,r,n,a){S.matchDirection(EI,r,n),S.matchDirection(II,a,n),S.scale(t,S.add(t,EI,S.add(t,II,S.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(0===this.state)for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?DI:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=-1===this.directionFromElementIndex[o]||-1===this.directionToElementIndex[o],this.nextCoarseBackbone=-1===this.directionFromElementIndex[i]||-1===this.directionToElementIndex[i];break}if(1===this.state){var s=r.move().index,u=this.getResidueIndex(s-3),c=this.getResidueIndex(s-2),l=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),p=this.getResidueIndex(s+3);this.prevSecStrucType=this.getSecStruc(l),this.currSecStrucType=this.getSecStruc(s),this.nextSecStrucType=s===d?DI:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=-1===this.directionFromElementIndex[d]||-1===this.directionToElementIndex[d],a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.initial=s===l,a.final=s===d,a.centerPrev.element=this.traceElementIndex[l],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[d];var h=this.getSecStruc(u),m=this.getSecStruc(c),v=this.getSecStruc(l),g=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),_=this.getSecStruc(p);this.pos(this.p0,u,h),this.pos(this.p1,c,m),this.pos(this.p2,l,v),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,p,_);var C=dd(h),x=dd(m),A=dd(v),T=dd(g),w=dd(y),E=dd(b),I=dd(_);this.helixOrientationCenters&&(T!==A?T?(S.copy(this.p0,this.p3),S.copy(this.p1,this.p3),S.copy(this.p2,this.p3)):A&&(S.scale(ar,S.sub(ar,this.p2,this.p3),2),S.add(this.p2,this.p3,ar),S.add(this.p1,this.p2,ar),S.add(this.p0,this.p1,ar)):T!==x?T?(S.copy(this.p0,this.p2),S.copy(this.p1,this.p2)):x&&(S.scale(ar,S.sub(ar,this.p1,this.p2),2),S.add(this.p1,this.p2,ar),S.add(this.p0,this.p1,ar)):T!==C&&(T?S.copy(this.p0,this.p1):C&&(S.scale(ar,S.sub(ar,this.p0,this.p1),2),S.add(this.p0,this.p1,ar))),T!==w?T?(S.copy(this.p4,this.p3),S.copy(this.p5,this.p3),S.copy(this.p6,this.p3)):w&&(S.scale(ar,S.sub(ar,this.p4,this.p3),2),S.add(this.p4,this.p3,ar),S.add(this.p5,this.p4,ar),S.add(this.p6,this.p5,ar)):T!==E?T?(S.copy(this.p5,this.p4),S.copy(this.p6,this.p4)):E&&(S.scale(ar,S.sub(ar,this.p5,this.p4),2),S.add(this.p5,this.p4,ar),S.add(this.p6,this.p5,ar)):T!==I&&(T?S.copy(this.p6,this.p5):I&&(S.scale(ar,S.sub(ar,this.p6,this.p5),2),S.add(this.p6,this.p5,ar)))),this.setFromToVector(this.d01,l,v),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var M=T&&this.helixOrientationCenters,F=1.5;s===l||g!==v&&M?(S.setMagnitude(ar,S.sub(ar,this.p3,this.p4),F),S.add(this.p2,this.p3,ar),S.add(this.p1,this.p2,ar),S.add(this.p0,this.p1,ar)):l===c||g!==m&&M?(S.setMagnitude(ar,S.sub(ar,this.p2,this.p3),F),S.add(this.p1,this.p2,ar),S.add(this.p0,this.p1,ar)):(c===u||g!==h&&M)&&(S.setMagnitude(ar,S.sub(ar,this.p1,this.p2),F),S.add(this.p0,this.p1,ar)),s===d||g!==y&&M?(S.setMagnitude(ar,S.sub(ar,this.p3,this.p2),F),S.add(this.p4,this.p3,ar),S.add(this.p5,this.p4,ar),S.add(this.p6,this.p5,ar)):d===f||g!==b&&M?(S.setMagnitude(ar,S.sub(ar,this.p4,this.p3),F),S.add(this.p5,this.p4,ar),S.add(this.p6,this.p5,ar)):(f===p||g!==_&&M)&&(S.setMagnitude(ar,S.sub(ar,this.p5,this.p4),F),S.add(this.p6,this.p5,ar)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,m),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,v),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,b),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),gct=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=wn.transientSegments(HC(t),t.elements),this.value=xce(r,t),S.set(this.value.d12,1,0,0),S.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(0===this.state)for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}if(1===this.state){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(S.scale(ar,S.sub(ar,this.value.p2,this.value.p3),i),S.add(this.value.p1,this.value.p2,ar),S.add(this.value.p0,this.value.p1,ar)):r===t&&(S.scale(ar,S.sub(ar,this.value.p1,this.value.p2),i),S.add(this.value.p0,this.value.p1,ar)),this.elementIndex===n?(S.scale(ar,S.sub(ar,this.value.p2,this.value.p1),i),S.add(this.value.p3,this.value.p2,ar),S.add(this.value.p4,this.value.p3,ar)):n===a&&(S.scale(ar,S.sub(ar,this.value.p3,this.value.p2),i),S.add(this.value.p4,this.value.p3,ar)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),Lg=S.fromArray,Xb=S.toArray,dU=S.normalize,yct=S.sub,Kb=S.spline,bct=S.slerp,wce=S.copy,Ace=S.cross,fU=S.orthogonalize,_ct=S.matchDirection,Sct=S.scale,Tce=S.add;function pU(e){var t=e+1,r=3*t;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function hU(e,t,r,n){(function Cct(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,c=t.p2,l=t.p3,d=t.p4,h=1-n,m=t.secStrucFirst?.5:r,v=t.secStrucLast?.5:r,g=0;g<=o;++g){var y=1*g/o;if(y<h){var b=oa(m,r,y);Kb(gU,s,u,c,l,y+n,b),Kb(mU,s,u,c,l,y+n+.01,m),Kb(vU,s,u,c,l,y+n-.01,m)}else b=oa(r,v,y),Kb(gU,u,c,l,d,y-h,b),Kb(mU,u,c,l,d,y-h+.01,b),Kb(vU,u,c,l,d,y-h-.01,b);Xb(gU,a,3*g),dU(Lm,yct(Lm,mU,vU)),Xb(Lm,i,3*g)}})(e,t,r,n),function wct(e,t){var n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=e.curvePoints.length/3;Lg(Ece,n,0),Lg(Ice,n,3*(u-1)),fU(yU,Ece,o),fU(PI,Ice,s),_ct(PI,PI,yU),wce(GC,yU);for(var c=u-1,l=0;l<u;++l){var d=KY(0,c,l)*c,f=0===l?0:1/(u-d);Lg(Lm,n,3*l),fU(fd,Lm,bct(xct,GC,PI,f)),Xb(fd,a,3*l),wce(GC,fd),dU(Zb,Ace(Zb,Lm,fd)),Xb(Zb,i,3*l)}for(l=1;l<c;++l)Lg(GC,a,3*(l-1)),Lg(fd,a,3*l),Lg(Dce,a,3*(l+1)),Sct(fd,Tce(fd,GC,Tce(fd,Dce,fd)),1/3),Xb(fd,a,3*l),Lg(Lm,n,3*l),dU(Zb,Ace(Zb,Lm,fd)),Xb(Zb,i,3*l)}(e,t)}var mU=S(),vU=S(),gU=S(),xct=S(),Lm=S(),fd=S(),Zb=S(),GC=S(),Dce=S(),Ece=S(),Ice=S(),yU=S(),PI=S();function bU(e,t,r,n,a,i,o,s){for(var u=e.widthValues,c=e.heightValues,l=e.linearSegments,d=1-s,f=0;f<=l;++f){var p=1*f/l;p<d?(u[f]=oa(t,r,p+s),c[f]=oa(a,i,p+s)):(u[f]=oa(r,n,p-d),c[f]=oa(i,o,p-d))}}var ih,_U,oh,Pce=.5,Act=.9,MI=.5,RI=.3,OI=2;function HC(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function Mce(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}function Ug(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId];if(Oe.isAtomic(u))return Qoe(o,u,u.polymerElements[i]);var d=Be.indexOf(u.elements,u.polymerElements[i]);if(-1!==d)return Re(o,[{unit:u,indices:Be.ofSingleton(d)}])}return Yr}function Rce(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++)if(!((c=r[u])<0)&&(o=Be.indexOf(t,c))>=0){s=u;break}if(o<0)return!1;var l=o;for(u=i;u>s;u--){var c;if(!((c=r[u])<0)){var d=Be.indexOf(t,c);if(d>=0){l=d;break}}}return n(xe.ofRange(e+o,e+l))}function Oce(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,c=r(a.unit);if(xe.is(a.indices))i=0===xe.start(a.indices)&&xe.end(a.indices)===a.unit.elements.length?n(xe.ofBounds(e,e+t))||i:Rce(e,c,s,n,l=u[o[xe.min(a.indices)]],d=u[o[xe.max(a.indices)]])||i;else for(var f=a.indices,p=0,h=f.length;p<h;p++){for(var l,d=l=u[o[f[p]]],m=p+1;m<h;){var v=u[o[f[m]]];if(v-d>1)break;d=v,m++}p=m-1,i=Rce(e,c,s,n,l,d)||i}return i}function Tct(e){return e.polymerElements}function Vg(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ye.areEquivalent(e.structure,t.structure))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var c=u[s];if(i.unitIndexMap.has(c.unit.id)){var l=i.unitIndexMap.get(c.unit.id)*o;if(Oe.isAtomic(c.unit))n=Oce(l,o,Tct,r,c)||n;else if(xe.is(c.indices)){var d=l+xe.start(c.indices),f=l+xe.end(c.indices);n=r(xe.ofBounds(d,f))||n}else for(var p=0,h=c.indices.length;p<h;p++){d=c.indices[p];for(var m=p+1;m<h&&c.indices[m]===d;)m++;n=r(xe.ofRange(l+d,l+(f=c.indices[p=m-1])))||n}}}return n}function Dct(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId],c=Be.indexOf(u.elements,u.gapElements[i]),l=Be.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(-1!==c&&-1!==l)return Ht.Loci(o,[Ht.Location(o,u,c,o,u,l),Ht.Location(o,u,l,o,u,c)])}return Yr}function Ect(e,t,r){var n=!1;if(Ht.isLoci(e)){var i=t.group;if(!Ye.areRootsEquivalent(e.structure,a=t.structure))return!1;e=Ht.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var c=u[s],l=i.unitIndexMap.get(c.aUnit.id);if(void 0!==l){var d=Be.indexOf(c.aUnit.gapElements,c.aUnit.elements[c.aIndex]),f=Be.indexOf(c.bUnit.gapElements,c.bUnit.elements[c.bIndex]);-1!==d&&-1!==f&&r(xe.ofSingleton(l*o+d))&&(n=!0)}}}else if(Re.is(e)){var a;if(i=t.group,!Ye.areRootsEquivalent(e.structure,a=t.structure))return!1;e=Re.remap(e,a);for(var p=i.units[0].gapElements.length,h=function(_){var C=i.unitIndexMap.get(_.unit.id);void 0!==C&&Be.forEach(_.indices,function(x){var A=Be.indexOf(_.unit.gapElements,_.unit.elements[x]);-1!==A&&r(xe.ofSingleton(C*p+A))&&(n=!0)})},m=0,v=e.elements;m<v.length;m++)h(v[m])}return n}function zg(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId];if(Oe.isAtomic(u))return Qoe(o,u,u.nucleotideElements[i])}return Yr}function Ict(e){return e.nucleotideElements}function Gg(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ye.areEquivalent(e.structure,t.structure))return!1;var o=i.units[0];if(!Oe.isAtomic(o))return!1;for(var u=o.nucleotideElements.length,c=0,l=e.elements;c<l.length;c++){var d=l[c];if(Oe.isAtomic(d.unit)&&i.unitIndexMap.has(d.unit.id)){var f=i.unitIndexMap.get(d.unit.id)*u;Oe.isAtomic(d.unit)&&(n=Oce(f,u,Ict,r,d)||n)}}return n}!function(e){e.fromGroup=function t(r,n){void 0===n&&(n=!1);var a=r.group,o=a.units[0].polymerElements,s=o.length,u=a.units.length,c=at.create(r.structure);return Ln(s,u,1,function(f,p){return c.unit=a.units[p],c.element=o[f],c},!1,function d(f,p){return n})}}(ih||(ih={})),function(e){e.fromGroup=function t(r){var n=r.group,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=at.create(r.structure);return Ln(o,s,1,function(l,d){return u.unit=n.units[d],u.element=i[l],u})}}(_U||(_U={})),function(e){e.fromGroup=function t(r){var n=r.group,a=r.structure,i=n.units[0],o=Oe.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,c=at.create(a);return Ln(s,u,1,function(d,f){return c.unit=n.units[f],c.element=o[d],c})}}(oh||(oh={}));var Pct=S(),Mct=S();function Hg(e,t){var n=e.model.atomicHierarchy,o=n.index,u=e.conformation.invariantPosition,c=n.atoms.label_comp_id.value(n.residueAtomSegments.offsets[t]),l=UPe(c),d=VPe(c);if(!l&&!d){var f=o.findAtomOnResidue(t,"C4"),p=o.findAtomOnResidue(t,"N9");-1!==f&&-1!==p&&S.distance(u(f,Pct),u(p,Mct))<1.6?l=!0:d=!0}return{isPurine:l,isPyrimidine:d}}function qg(e,t,r){var n=t.model.atomicHierarchy.index;return e.trace=t.model.atomicHierarchy.derived.residue.traceElementIndex[r],e.N1=n.findAtomOnResidue(r,"N1"),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),-1===e.C5&&(e.C5=n.findAtomOnResidue(r,"N5")),e.C6=n.findAtomOnResidue(r,"C6"),e.N7=n.findAtomOnResidue(r,"N7"),-1===e.N7&&(e.N7=n.findAtomOnResidue(r,"C7")),e.C8=n.findAtomOnResidue(r,"C8"),e.N9=n.findAtomOnResidue(r,"N9"),e}function Qb(e){return-1!==e.trace&&-1!==e.N1&&-1!==e.C2&&-1!==e.N3&&-1!==e.C4&&-1!==e.C5&&-1!==e.C6&&-1!==e.N7&&-1!==e.C8&&-1!==e.N9}function Wg(e,t,r){var n=t.model.atomicHierarchy.index;return e.trace=t.model.atomicHierarchy.derived.residue.traceElementIndex[r],e.N1=n.findAtomOnResidue(r,"N1"),-1===e.N1&&(e.N1=n.findAtomOnResidue(r,"C1")),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C6=n.findAtomOnResidue(r,"C6"),e}function $b(e){return-1!==e.trace&&-1!==e.N1&&-1!==e.C2&&-1!==e.N3&&-1!==e.C4&&-1!==e.C5&&-1!==e.C6}function jC(e,t,r){var n=t.model.atomicHierarchy.index;return e.trace=t.model.atomicHierarchy.derived.residue.traceElementIndex[r],e.C1_1=n.findAtomOnResidue(r,"C1'"),e.C2_1=n.findAtomOnResidue(r,"C2'"),e.C3_1=n.findAtomOnResidue(r,"C3'"),e.C4_1=n.findAtomOnResidue(r,"C4'"),e.O4_1=n.findAtomOnResidue(r,"O4'"),e}function qC(e){return-1!==e.trace&&-1!==e.C1_1&&-1!==e.C2_1&&-1!==e.C3_1&&-1!==e.C4_1&&-1!==e.O4_1}var FI=S(),SU=S(),Fce=S(),Nce=S(),kce=S(),Bce=S(),NI=S(),CU=S(),xU=S(),Lce=S(),WC=me.identity(),Rct=S(),Uce=TB(),Vce={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:D.Numeric(1,{min:0,max:2,step:.01}),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo)};function Oct(e,t,r,n,a,i){if(!Oe.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.thicknessFactor,c=a.radialSegments,l=o*(Uce.vertices.length/3+2*c),d=ft.createState(l,l/4,i),f=t.elements,p=t.model,h=p.atomicHierarchy,v=h.residueAtomSegments,g=p.atomicHierarchy.derived.residue.moleculeType,y=t.conformation.invariantPosition,b=tr.transientSegments(h.chainAtomSegments,f),_=tr.transientSegments(v,f),C=1*s,A=u*s*2,T={radiusTop:C,radiusBottom:C,radialSegments:c,bottomCap:!0},w=0;b.hasNext;)for(_.setSegment(b.move());_.hasNext;){var E=_.move().index;if(Zs(g[E])){var I={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1},M=-1,F=-1,N=-1,j=-1,k=-1,H=4.5,G=Hg(t,E),Q=G.isPyrimidine;G.isPurine?(H=4.5,qg(I,t,E),M=I.N1,F=I.C4,N=I.C6,j=I.C2,k=I.N9):Q&&(H=3,Wg(I,t,E),M=I.N3,F=I.C6,N=I.C4,j=I.C2,k=I.N1),-1!==k&&-1!==I.trace&&(y(k,kce),y(I.trace,Bce),d.currentGroup=w,Hr(d,kce,Bce,1,T),-1!==M&&-1!==F&&-1!==N&&-1!==j&&(y(M,FI),y(F,SU),y(N,Fce),y(j,Nce),S.normalize(NI,S.sub(NI,SU,FI)),S.normalize(CU,S.sub(CU,Nce,Fce)),S.normalize(xU,S.cross(xU,NI,CU)),me.targetTo(WC,FI,SU,xU),S.scaleAndAdd(Lce,FI,NI,H/2-.2),me.scale(WC,WC,S.set(Rct,4.5,A,H)),me.setTranslation(WC,Lce),ft.addPrimitive(d,WC,Uce))),++w}}var W=ft.getMesh(d),K=De.expand(De(),t.boundary.sphere,C);return W.setBoundingSphere(K),W}D.getDefaultValues(Vce);var zce=R(R({},po),Vce);function Fct(e){return Xo({defaultProps:D.getDefaultValues(zce),createGeometry:Oct,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var kI=S(),Um=S(),BI=S(),LI=S(),Jb=S(),e1=S(),UI=S(),Gce=S(),Hce=S(),VI=S(),Vm=S(),jce={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:D.Numeric(1,{min:0,max:2,step:.01}),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo)},zI=(D.getDefaultValues(jce),new Float32Array(54)),Nct=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),kct=new Uint32Array([8,12,14,16,6,4,2,0,10]),Bct=new Uint32Array([9,11,1,3,5,7,17,15,13]),GI=new Float32Array(36),Lct=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Uct=new Uint32Array([0,10,8,6,4,2]),Vct=new Uint32Array([1,3,5,7,9,11]),qce=S();function Wce(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];S.toArray(S.add(qce,o,t),e,2*a*3),S.toArray(S.sub(qce,o,t),e,3*(2*a+1))}}function zct(e,t,r,n,a,i){if(!Oe.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.thicknessFactor,c=a.radialSegments,l=a.detail,d=o*(26+2*c),f=ft.createState(d,d/4,i),p=t.elements,h=t.model,m=h.atomicHierarchy,g=m.residueAtomSegments,y=h.atomicHierarchy.derived.residue.moleculeType,b=t.conformation.invariantPosition,_=tr.transientSegments(m.chainAtomSegments,p),C=tr.transientSegments(g,p),x=1*s,A=u*s,T={radiusTop:x,radiusBottom:x,radialSegments:c},w=0;_.hasNext;)for(C.setSegment(_.move());C.hasNext;){var E=C.move().index;if(Zs(y[E])){var I={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};f.currentGroup=w;var M=Hg(t,E),N=M.isPyrimidine;M.isPurine?(qg(I,t,E),-1!==I.N9&&-1!==I.trace&&(b(I.N9,VI),b(I.trace,kI),f.currentGroup=w,Hr(f,VI,kI,1,T),$r(f,VI,x,l)),Qb(I)&&(b(I.N1,Um),b(I.C2,BI),b(I.N3,LI),b(I.C4,Jb),b(I.C5,e1),b(I.C6,UI),b(I.N7,Gce),b(I.C8,Hce),S.triangleNormal(Vm,Um,Jb,e1),S.scale(Vm,Vm,A),Wce(zI,Vm,Um,BI,LI,Jb,e1,UI,Gce,Hce,VI),ft.addTriangleStrip(f,zI,Nct),ft.addTriangleFan(f,zI,kct),ft.addTriangleFan(f,zI,Bct))):N&&(Wg(I,t,E),-1!==I.N1&&-1!==I.trace&&(b(I.N1,Um),b(I.trace,kI),f.currentGroup=w,Hr(f,Um,kI,1,T),$r(f,Um,x,l)),$b(I)&&(b(I.C2,BI),b(I.N3,LI),b(I.C4,Jb),b(I.C5,e1),b(I.C6,UI),S.triangleNormal(Vm,Um,Jb,e1),S.scale(Vm,Vm,A),Wce(GI,Vm,Um,BI,LI,Jb,e1,UI),ft.addTriangleStrip(f,GI,Lct),ft.addTriangleFan(f,GI,Uct),ft.addTriangleFan(f,GI,Vct))),++w}}var j=ft.getMesh(f),k=De.expand(De(),t.boundary.sphere,x);return j.setBoundingSphere(k),j}var Yce=R(R({},po),jce);function Gct(e){return Xo({defaultProps:D.getDefaultValues(Yce),createGeometry:zct,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var t1=S(),HI=S(),jI=S(),r1=S(),n1=S(),qI=S(),Xce=S(),Kce=S(),Zce=S(),WI=S(),wU=S(),YI=S(),XI=S(),AU=S(),a1=S(),Zo=S(),i1=S(),Qce={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:D.Numeric(1,{min:0,max:2,step:.01})},KI=(D.getDefaultValues(Qce),new Float32Array(54)),Hct=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),jct=new Uint32Array([8,12,14,16,6,4,2,0,10]),qct=new Uint32Array([9,11,1,3,5,7,17,15,13]),ZI=new Float32Array(36),Wct=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),Yct=new Uint32Array([0,10,8,6,4,2,10]),Xct=new Uint32Array([1,3,5,7,9,11,3]),QI=new Float32Array(36),Kct=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Zct=new Uint32Array([0,10,8,6,4,2]),Qct=new Uint32Array([1,3,5,7,9,11]),$ce=S();function TU(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];S.toArray(S.add($ce,o,t),e,2*a*3),S.toArray(S.sub($ce,o,t),e,3*(2*a+1))}}function $ct(e,t,r,n,a,i){if(!Oe.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.thicknessFactor,c=25*o,l=ft.createState(c,c/4,i),d=t.elements,f=t.model,p=f.atomicHierarchy,m=p.residueAtomSegments,v=f.atomicHierarchy.derived.residue.moleculeType,g=t.conformation.invariantPosition,y=tr.transientSegments(p.chainAtomSegments,d),b=tr.transientSegments(m,d),_=s*u,C=0;y.hasNext;)for(b.setSegment(y.move());b.hasNext;){var x=b.move().index;if(Zs(v[x])){var A={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};l.currentGroup=C,jC(A,t,x),qC(A)&&(g(A.C1_1,WI),g(A.C2_1,wU),g(A.C3_1,YI),g(A.C4_1,XI),g(A.O4_1,AU),S.triangleNormal(Zo,YI,XI,WI),S.scale(a1,S.add(a1,AU,S.add(a1,XI,S.add(a1,YI,S.add(a1,WI,wU)))),.2),S.scale(i1,Zo,_),TU(ZI,i1,a1,YI,XI,AU,WI,wU),ft.addTriangleStrip(l,ZI,Wct),ft.addTriangleFanWithNormal(l,ZI,Yct,Zo),S.negate(Zo,Zo),ft.addTriangleFanWithNormal(l,ZI,Xct,Zo));var T=Hg(t,x),E=T.isPyrimidine;T.isPurine?(qg(A,t,x),Qb(A)&&(g(A.N1,t1),g(A.C2,HI),g(A.N3,jI),g(A.C4,r1),g(A.C5,n1),g(A.C6,qI),g(A.N7,Xce),g(A.C8,Kce),g(A.N9,Zce),S.triangleNormal(Zo,t1,r1,n1),S.scale(i1,Zo,_),TU(KI,i1,t1,HI,jI,r1,n1,qI,Xce,Kce,Zce),ft.addTriangleStrip(l,KI,Hct),ft.addTriangleFanWithNormal(l,KI,jct,Zo),S.negate(Zo,Zo),ft.addTriangleFanWithNormal(l,KI,qct,Zo))):E&&(Wg(A,t,x),$b(A)&&(g(A.N1,t1),g(A.C2,HI),g(A.N3,jI),g(A.C4,r1),g(A.C5,n1),g(A.C6,qI),S.triangleNormal(Zo,t1,r1,n1),S.scale(i1,Zo,_),TU(QI,i1,t1,HI,jI,r1,n1,qI),ft.addTriangleStrip(l,QI,Kct),ft.addTriangleFanWithNormal(l,QI,Zct,Zo),S.negate(Zo,Zo),ft.addTriangleFanWithNormal(l,QI,Qct,Zo))),++C}}var I=ft.getMesh(l),M=De.expand(De(),t.boundary.sphere,_);return I.setBoundingSphere(M),I}var Jce=R(R({},po),Qce);function Jct(e){return Xo({defaultProps:D.getDefaultValues(Jce),createGeometry:$ct,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor}},e)}var Qo=S(),Kn=S(),vo=S(),go=S(),ci=S(),li=S(),yo=S(),Sf=S(),Cf=S(),ki=S(),Bi=S(),xf=S(),Vu=S(),wf=S(),Af=S(),DU=R(R(R({},po),t6),{sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo),tryUseImpostor:D.Boolean(!0)});function elt(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function rlt(e){return r6({defaultProps:D.getDefaultValues(DU),createGeometry:tlt,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function alt(e){return Xo({defaultProps:D.getDefaultValues(DU),createGeometry:nlt,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}function tlt(e,t,r,n,a,i){if(!Oe.isAtomic(t))return ou.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return ou.createEmpty(i);for(var s=15*o,u=DC.create(s,s/4,i),c=t.elements,l=t.model,d=l.atomicHierarchy,p=d.residueAtomSegments,h=l.atomicHierarchy.derived.residue.moleculeType,m=t.conformation.invariantPosition,v=tr.transientSegments(d.chainAtomSegments,c),g=tr.transientSegments(p,c),y=0;v.hasNext;)for(g.setSegment(v.move());g.hasNext;){var b=g.move().index;if(Zs(h[b])){var _={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};jC(_,t,b),qC(_)&&(m(_.C1_1,Bi),m(_.C2_1,xf),m(_.C3_1,Vu),m(_.C4_1,wf),m(_.O4_1,Af),m(_.trace,Qo),u.add(Vu[0],Vu[1],Vu[2],Qo[0],Qo[1],Qo[2],1,!0,!0,y),u.add(Vu[0],Vu[1],Vu[2],wf[0],wf[1],wf[2],1,!0,!0,y),u.add(wf[0],wf[1],wf[2],Af[0],Af[1],Af[2],1,!0,!0,y),u.add(Af[0],Af[1],Af[2],Bi[0],Bi[1],Bi[2],1,!0,!0,y),u.add(Bi[0],Bi[1],Bi[2],xf[0],xf[1],xf[2],1,!0,!0,y),u.add(xf[0],xf[1],xf[2],Vu[0],Vu[1],Vu[2],1,!0,!0,y));var C=Hg(t,b),A=C.isPyrimidine;C.isPurine?(qg(_,t,b),-1!==_.C1_1&&-1!==_.N9?(m(_.C1_1,Bi),m(_.N9,ki),u.add(ki[0],ki[1],ki[2],Bi[0],Bi[1],Bi[2],1,!0,!0,y)):-1!==_.N9&&-1!==_.trace&&(m(_.N9,ki),m(_.trace,Qo),u.add(ki[0],ki[1],ki[2],Qo[0],Qo[1],Qo[2],1,!0,!0,y)),Qb(_)&&(m(_.N1,Kn),m(_.C2,vo),m(_.N3,go),m(_.C4,ci),m(_.C5,li),m(_.C6,yo),m(_.N7,Sf),m(_.C8,Cf),m(_.N9,ki),u.add(ki[0],ki[1],ki[2],Cf[0],Cf[1],Cf[2],1,!0,!0,y),u.add(Cf[0],Cf[1],Cf[2],Sf[0],Sf[1],Sf[2],1,!0,!0,y),u.add(Sf[0],Sf[1],Sf[2],li[0],li[1],li[2],1,!0,!0,y),u.add(li[0],li[1],li[2],yo[0],yo[1],yo[2],1,!0,!0,y),u.add(yo[0],yo[1],yo[2],Kn[0],Kn[1],Kn[2],1,!0,!0,y),u.add(Kn[0],Kn[1],Kn[2],vo[0],vo[1],vo[2],1,!0,!0,y),u.add(vo[0],vo[1],vo[2],go[0],go[1],go[2],1,!0,!0,y),u.add(go[0],go[1],go[2],ci[0],ci[1],ci[2],1,!0,!0,y),u.add(ci[0],ci[1],ci[2],li[0],li[1],li[2],1,!0,!0,y),u.add(ci[0],ci[1],ci[2],ki[0],ki[1],ki[2],1,!0,!0,y))):A&&(Wg(_,t,b),-1!==_.C1_1&&-1!==_.N1?(m(_.N1,Kn),m(_.C1_1,Bi),u.add(Kn[0],Kn[1],Kn[2],Bi[0],Bi[1],Bi[2],1,!0,!0,y)):-1!==_.N1&&-1!==_.trace&&(m(_.N1,Kn),m(_.trace,Qo),u.add(Kn[0],Kn[1],Kn[2],Qo[0],Qo[1],Qo[2],1,!0,!0,y)),$b(_)&&(m(_.N1,Kn),m(_.C2,vo),m(_.N3,go),m(_.C4,ci),m(_.C5,li),m(_.C6,yo),u.add(Kn[0],Kn[1],Kn[2],yo[0],yo[1],yo[2],1,!0,!0,y),u.add(yo[0],yo[1],yo[2],li[0],li[1],li[2],1,!0,!0,y),u.add(li[0],li[1],li[2],ci[0],ci[1],ci[2],1,!0,!0,y),u.add(ci[0],ci[1],ci[2],go[0],go[1],go[2],1,!0,!0,y),u.add(go[0],go[1],go[2],vo[0],vo[1],vo[2],1,!0,!0,y),u.add(vo[0],vo[1],vo[2],Kn[0],Kn[1],Kn[2],1,!0,!0,y))),++y}}var T=u.getCylinders(),w=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return T.setBoundingSphere(w),T}function nlt(e,t,r,n,a,i){if(!Oe.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=o*(15*u),l=ft.createState(c,c/4,i),d=t.elements,f=t.model,p=f.atomicHierarchy,m=p.residueAtomSegments,v=f.atomicHierarchy.derived.residue.moleculeType,g=t.conformation.invariantPosition,y=tr.transientSegments(p.chainAtomSegments,d),b=tr.transientSegments(m,d),_={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},C=0;y.hasNext;)for(b.setSegment(y.move());b.hasNext;){var x=b.move().index;if(Zs(v[x])){var A={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};l.currentGroup=C,jC(A,t,x),qC(A)&&(g(A.C1_1,Bi),g(A.C2_1,xf),g(A.C3_1,Vu),g(A.C4_1,wf),g(A.O4_1,Af),g(A.trace,Qo),Hr(l,Vu,Qo,1,_),Hr(l,Vu,wf,1,_),Hr(l,wf,Af,1,_),Hr(l,Af,Bi,1,_),Hr(l,Bi,xf,1,_),Hr(l,xf,Vu,1,_));var T=Hg(t,x),E=T.isPyrimidine;T.isPurine?(qg(A,t,x),-1!==A.C1_1&&-1!==A.N9?(g(A.C1_1,Bi),g(A.N9,ki),Hr(l,ki,Bi,1,_)):-1!==A.N9&&-1!==A.trace&&(g(A.N9,ki),g(A.trace,Qo),Hr(l,ki,Qo,1,_)),Qb(A)&&(g(A.N1,Kn),g(A.C2,vo),g(A.N3,go),g(A.C4,ci),g(A.C5,li),g(A.C6,yo),g(A.N7,Sf),g(A.C8,Cf),g(A.N9,ki),Hr(l,ki,Cf,1,_),Hr(l,Cf,Sf,1,_),Hr(l,Sf,li,1,_),Hr(l,li,yo,1,_),Hr(l,yo,Kn,1,_),Hr(l,Kn,vo,1,_),Hr(l,vo,go,1,_),Hr(l,go,ci,1,_),Hr(l,ci,li,1,_),Hr(l,ci,ki,1,_))):E&&(Wg(A,t,x),-1!==A.C1_1&&-1!==A.N1?(g(A.N1,Kn),g(A.C1_1,Bi),Hr(l,Kn,Bi,1,_)):-1!==A.N1&&-1!==A.trace&&(g(A.N1,Kn),g(A.trace,Qo),Hr(l,Kn,Qo,1,_)),$b(A)&&(g(A.N1,Kn),g(A.C2,vo),g(A.N3,go),g(A.C4,ci),g(A.C5,li),g(A.C6,yo),Hr(l,Kn,yo,1,_),Hr(l,yo,li,1,_),Hr(l,li,ci,1,_),Hr(l,ci,go,1,_),Hr(l,go,vo,1,_),Hr(l,vo,Kn,1,_))),++C}}var I=ft.getMesh(l),M=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return I.setBoundingSphere(M),I}var o1=S(),gl=S(),yl=S(),bl=S(),_l=S(),xc=S(),Sl=S(),s1=S(),u1=S(),c1=S(),l1=S(),d1=S(),f1=S(),p1=S(),h1=S(),EU=R(R(R({},po),J5),{sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),tryUseImpostor:D.Boolean(!0)});function ilt(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function slt(e){return e6({defaultProps:D.getDefaultValues(EU),createGeometry:olt,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function clt(e){return Xo({defaultProps:D.getDefaultValues(EU),createGeometry:ult,createLocationIterator:oh.fromGroup,getLoci:zg,eachLocation:Gg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}function olt(e,t,r,n,a,i){if(!Oe.isAtomic(t))return ol.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return ol.createEmpty(i);for(var s=15*o,u=Wb.create(s,s/4,i),c=t.elements,l=t.model,d=l.atomicHierarchy,p=d.residueAtomSegments,h=l.atomicHierarchy.derived.residue.moleculeType,m=t.conformation.invariantPosition,v=tr.transientSegments(d.chainAtomSegments,c),g=tr.transientSegments(p,c),y=0;v.hasNext;)for(g.setSegment(v.move());g.hasNext;){var b=g.move().index;if(Zs(h[b])){var _={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};jC(_,t,b),qC(_)&&(m(_.C1_1,l1),m(_.C2_1,d1),m(_.C3_1,f1),m(_.C4_1,p1),m(_.O4_1,h1),m(_.trace,o1),u.add(o1[0],o1[1],o1[2],y),u.add(f1[0],f1[1],f1[2],y),u.add(p1[0],p1[1],p1[2],y),u.add(h1[0],h1[1],h1[2],y),u.add(l1[0],l1[1],l1[2],y),u.add(d1[0],d1[1],d1[2],y));var C=Hg(t,b),A=C.isPyrimidine;C.isPurine?(qg(_,t,b),Qb(_)&&(m(_.N1,gl),m(_.C2,yl),m(_.N3,bl),m(_.C4,_l),m(_.C5,xc),m(_.C6,Sl),m(_.N7,s1),m(_.C8,u1),m(_.N9,c1),u.add(c1[0],c1[1],c1[2],y),u.add(u1[0],u1[1],u1[2],y),u.add(s1[0],s1[1],s1[2],y),u.add(xc[0],xc[1],xc[2],y),u.add(Sl[0],Sl[1],Sl[2],y),u.add(gl[0],gl[1],gl[2],y),u.add(yl[0],yl[1],yl[2],y),u.add(bl[0],bl[1],bl[2],y),u.add(_l[0],_l[1],_l[2],y))):A&&(Wg(_,t,b),$b(_)&&(m(_.N1,gl),m(_.C2,yl),m(_.N3,bl),m(_.C4,_l),m(_.C5,xc),m(_.C6,Sl),u.add(gl[0],gl[1],gl[2],y),u.add(Sl[0],Sl[1],Sl[2],y),u.add(xc[0],xc[1],xc[2],y),u.add(_l[0],_l[1],_l[2],y),u.add(bl[0],bl[1],bl[2],y),u.add(yl[0],yl[1],yl[2],y))),++y}}var T=u.getSpheres(),w=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return T.setBoundingSphere(w),T}function ult(e,t,r,n,a,i){if(!Oe.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=o*ib(u),l=ft.createState(c,c/2,i),d=t.elements,f=t.model,p=f.atomicHierarchy,m=p.residueAtomSegments,v=f.atomicHierarchy.derived.residue.moleculeType,g=t.conformation.invariantPosition,y=tr.transientSegments(p.chainAtomSegments,d),b=tr.transientSegments(m,d),_=1*s,C=0;y.hasNext;)for(b.setSegment(y.move());b.hasNext;){var x=b.move().index;if(Zs(v[x])){var A={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};l.currentGroup=C,jC(A,t,x),qC(A)&&(g(A.C1_1,l1),g(A.C2_1,d1),g(A.C3_1,f1),g(A.C4_1,p1),g(A.O4_1,h1),g(A.trace,o1),$r(l,o1,_,u),$r(l,p1,_,u),$r(l,h1,_,u),$r(l,l1,_,u),$r(l,d1,_,u),$r(l,f1,_,u));var T=Hg(t,x),E=T.isPyrimidine;T.isPurine?(qg(A,t,x),Qb(A)&&(g(A.N1,gl),g(A.C2,yl),g(A.N3,bl),g(A.C4,_l),g(A.C5,xc),g(A.C6,Sl),g(A.N7,s1),g(A.C8,u1),g(A.N9,c1),$r(l,u1,_,u),$r(l,s1,_,u),$r(l,xc,_,u),$r(l,Sl,_,u),$r(l,gl,_,u),$r(l,yl,_,u),$r(l,bl,_,u),$r(l,_l,_,u),$r(l,xc,_,u),$r(l,c1,_,u))):E&&(Wg(A,t,x),$b(A)&&(g(A.N1,gl),g(A.C2,yl),g(A.N3,bl),g(A.C4,_l),g(A.C5,xc),g(A.C6,Sl),$r(l,Sl,_,u),$r(l,xc,_,u),$r(l,_l,_,u),$r(l,bl,_,u),$r(l,yl,_,u),$r(l,gl,_,u))),++C}}var I=ft.getMesh(l),M=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return I.setBoundingSphere(M),I}var IU,Yg=S.zero(),m1=S.zero(),Xg=S.zero(),ele=S.zero(),Qi=ef(3,!1),Kg=me.identity(),flt=S.zero(),tle=S.zero(),rle=S.zero(),MU=S.zero(),plt=4,hlt=4,mlt=6,vlt=function dlt(){return IU||(IU=function llt(){for(var e=nb(8),t=0;t<3;++t){var r=(t+1)%3;S.set(Yg,Qi[3*t],Qi[3*t+1],-.5),S.set(m1,Qi[3*r],Qi[3*r+1],-.5),S.set(Xg,Qi[3*r],Qi[3*r+1],.5),S.set(ele,Qi[3*t],Qi[3*t+1],.5),e.add(Yg,m1,Xg),e.add(Xg,ele,Yg)}return S.set(Yg,Qi[0],Qi[1],-.5),S.set(m1,Qi[3],Qi[4],-.5),S.set(Xg,Qi[6],Qi[7],-.5),e.add(Xg,m1,Yg),S.set(Yg,Qi[0],Qi[1],.5),S.set(m1,Qi[3],Qi[4],.5),S.set(Xg,Qi[6],Qi[7],.5),e.add(Yg,m1,Xg),e.getPrimitive()}()),IU}(),nle={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01})};function glt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=24*o,c=ft.createState(u,u/10,i),d=pU(1),f=d.normalVectors,p=d.binormalVectors,h=0,m=lU(t,r);m.hasNext;){var v=m.move();c.currentGroup=h;var g=Zs(v.moleculeType),y=cn.is(v.secStrucType,4);if(hU(d,v,g||y?.5:.9,g?.3:.5),y&&!v.secStrucLast||!y){var C=n.size.size(v.center)*s,x=plt*C,A=hlt*C,T=mlt*C,w=g?p:f;S.fromArray(tle,w,0),S.fromArray(rle,w,3),S.normalize(MU,S.add(MU,tle,rle)),me.targetTo(Kg,v.p3,v.p1,MU),me.mul(Kg,Kg,me.rotY90Z180),me.scale(Kg,Kg,S.set(flt,T,A,x)),me.setTranslation(Kg,v.p2),ft.addPrimitive(c,Kg,vlt)}++h}var E=ft.getMesh(c),I=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return E.setBoundingSphere(I),E}D.getDefaultValues(nle);var ale=R(R({},po),nle);function ylt(e){return Xo({defaultProps:D.getDefaultValues(ale),createGeometry:glt,createLocationIterator:ih.fromGroup,getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var RU=10,ile={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo)};function blt(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=RU*u*2*o*2,l=ft.createState(c,c/10,i),d=t.conformation.invariantPosition,f=S.zero(),p=S.zero(),h={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},m=0,v=function dct(e,t){switch(t.kind){case 0:return new fct(e,t);case 1:case 2:return new pct(e,t)}}(r,t);v.hasNext;){var g=v.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,p),h.radiusTop=h.radiusBottom=n.size.size(y)*s,l.currentGroup=m,US(l,f,p,.5,RU,!1,h),h.radiusTop=h.radiusBottom=n.size.size(b)*s,l.currentGroup=m+1,US(l,p,f,.5,RU,!1,h)),m+=2}var _=ft.getMesh(l),C=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return _.setBoundingSphere(C),_}D.getDefaultValues(ile);var $I=R(R({},po),ile);function OU(e){return Xo({defaultProps:D.getDefaultValues($I),createGeometry:blt,createLocationIterator:_U.fromGroup,getLoci:Dct,eachLocation:Ect,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var an=S(),Tn=S(),_lt=S(),wc=S(),Tf=S(),JI=S(),e3=S(),YC=S(),pd=S(),Df=S(),FU=S(),zm=S(),Gm=S(),Hm=S(),jm=S(),Cl=S.fromArray,v1=S.scale,xl=S.add,sh=S.sub,Slt=S.magnitude,ole=S.negate,NU=S.copy,sle=S.cross,Clt=S.set,Bn=qe.add3,xlt=qe.add;function t3(e,t,r,n,a,i,o,s,u){var c=t.vertices,l=t.normals,d=t.indices,f=c.elementCount;if(Cl(an,n,e),v1(e3,an,o),v1(JI,an,s),Cl(Tn,a,e),v1(wc,Tn,i),sle(Df,Tn,an),Cl(pd,r,e),xl(zm,xl(zm,pd,wc),JI),sh(Gm,xl(Gm,pd,wc),e3),sh(Hm,sh(Hm,pd,wc),e3),xl(jm,sh(jm,pd,wc),JI),o<s?(Bn(c,jm[0],jm[1],jm[2]),Bn(c,Hm[0],Hm[1],Hm[2]),Bn(c,Gm[0],Gm[1],Gm[2]),Bn(c,zm[0],zm[1],zm[2]),NU(Tf,JI)):(Bn(c,zm[0],zm[1],zm[2]),Bn(c,Gm[0],Gm[1],Gm[2]),Bn(c,Hm[0],Hm[1],Hm[2]),Bn(c,jm[0],jm[1],jm[2]),NU(Tf,e3)),u){for(var p=0;p<4;++p)Bn(l,-Df[0],-Df[1],-Df[2]);Bn(d,f,f+1,f+2),Bn(d,f+2,f+3,f)}else{for(p=0;p<4;++p)Bn(l,Df[0],Df[1],Df[2]);Bn(d,f+2,f+1,f),Bn(d,f,f+3,f+2)}}function r3(e,t,r,n,a,i,o,s,u,c){var l=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,h=e.groups,m=d.elementCount,v=0;s>0?(Cl(an,t,0),Cl(Tn,t,3*a),v=s/Slt(sh(_lt,Tn,an))):Clt(YC,0,0,0);for(var g=0;g<=a;++g){var y=i[g],b=o[g],_=0===s?b:s*(1-g/a),C=3*g;Cl(Tf,r,C),v1(Tf,Tf,_),Cl(wc,n,C),v1(wc,wc,y),s>0&&(Cl(an,r,C),Cl(Tn,n,C),v1(YC,sle(YC,an,Tn),v)),Cl(pd,t,C),Cl(Df,r,C),Cl(FU,n,C),xl(an,xl(an,pd,wc),Tf),xl(Tn,Df,YC),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),xl(an,sh(an,pd,wc),Tf),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),ole(Tn,FU),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),sh(an,sh(an,pd,wc),Tf),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),xl(Tn,ole(Tn,Df),YC),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),sh(an,xl(an,pd,wc),Tf),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),NU(Tn,FU),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2]),xl(an,xl(an,pd,wc),Tf),Bn(d,an[0],an[1],an[2]),Bn(f,Tn[0],Tn[1],Tn[2])}for(g=0;g<a;++g){for(var x=0;x<2;x++)Bn(p,m+8*g+2*x,m+8*(g+1)+2*x+1,m+8*g+2*x+1),Bn(p,m+8*g+2*x,m+8*(g+1)+2*x,m+8*(g+1)+2*x+1);for(x=2;x<4;x++)Bn(p,m+8*g+2*x,m+8*(g+1)+2*x,m+8*g+2*x+1),Bn(p,m+8*(g+1)+2*x,m+8*(g+1)+2*x+1,m+8*g+2*x+1)}if(u){b=o[0];var A=0===s?b:s;t3(0,e,t,r,n,y=i[0],A,A,!1)}else s>0&&(t3(0,e,t,r,n,y=i[0],s,-(b=o[0]),!1),t3(0,e,t,r,n,y,-s,b,!1));c&&0===s&&t3(3*a,e,t,r,n,y=i[a],b=o[a],b,!0),g=0;for(var w=8*(a+1)+(u?4:s>0?8:0)+(c&&0===s?4:0);g<w;++g)xlt(h,l)}var yi=S(),$i=S(),hu=S(),$o=S(),Fs=S();function n3(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function g1(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var uh=S.fromArray,wlt=S.normalize,kU=S.scaleAndAdd,ule=S.cross,Alt=S.dot,Tlt=S.unitX,Ns=qe.add3,BU=new Map;function LU(e,t,r,n,a,i,o,s,u,c,l){for(var d=e.currentGroup,f=e.vertices,p=e.normals,h=e.indices,m=e.groups,v=f.elementCount,g=function Dlt(e,t){var r=t?1:0,n=nc(e,r);if(!BU.has(n)){for(var a=[],i=[],o=0;o<e;++o){var s=(2*o+r)/e*Math.PI;a[o]=Math.cos(s),i[o]=Math.sin(s)}BU.set(n,{cos:a,sin:i})}return BU.get(n)}(i,"rounded"===l),y=g.cos,b=g.sin,_=Math.round(i/4),C=3*_,x=0;x<=a;++x){var A=3*x;uh($o,r,A),uh(Fs,n,A),uh(hu,t,A);for(var T=o[x],w=s[x],E="rounded"===l&&w>T,I=0;I<i;++I){if(E){g1($i,$o,Fs,hu,T*y[I],T*b[I]);var M=Alt(Fs,Tlt)<0?I<_||I>=C?w-T:-w+T:I>=_&&I<C?-w+T:w-T;kU($i,$i,$o,M),I===_||I===_-1?n3(yi,$o,Fs,0,1):I===C||I===C-1?n3(yi,$o,Fs,0,-1):n3(yi,$o,Fs,y[I],b[I])}else g1($i,$o,Fs,hu,w*y[I],T*b[I]),n3(yi,$o,Fs,T*y[I],w*b[I]);wlt(yi,yi),Ns(f,$i[0],$i[1],$i[2]),Ns(p,yi[0],yi[1],yi[2])}}var N,F=Math.round(i/2);for(x=0;x<a;++x){for(I=0;I<F;++I)Ns(h,v+x*i+(I+1)%i,v+(x+1)*i+(I+1)%i,v+x*i+I),Ns(h,v+(x+1)*i+(I+1)%i,v+(x+1)*i+I,v+x*i+I);for(I=F;I<i;++I)Ns(h,v+x*i+(I+1)%i,v+(x+1)*i+I,v+x*i+I),Ns(h,v+(x+1)*i+(I+1)%i,v+(x+1)*i+I,v+x*i+(I+1)%i)}if(u){var j=f.elementCount;for(uh($o,r,N=0),uh(Fs,n,N),uh(hu,t,N),ule(yi,Fs,$o),Ns(f,hu[0],hu[1],hu[2]),Ns(p,yi[0],yi[1],yi[2]),T=o[0],w=s[0],(E="rounded"===l&&w>T)&&(w-=T),v=f.elementCount,x=0;x<i;++x)E?(g1($i,$o,Fs,hu,T*y[x],T*b[x]),kU($i,$i,$o,x<_||x>=C?w:-w)):g1($i,$o,Fs,hu,w*y[x],T*b[x]),Ns(f,$i[0],$i[1],$i[2]),Ns(p,yi[0],yi[1],yi[2]),Ns(h,v+(x+1)%i,v+x,j)}if(c)for(j=f.elementCount,uh($o,r,N=3*a),uh(Fs,n,N),uh(hu,t,N),ule(yi,$o,Fs),Ns(f,hu[0],hu[1],hu[2]),Ns(p,yi[0],yi[1],yi[2]),T=o[a],w=s[a],(E="rounded"===l&&w>T)&&(w-=T),v=f.elementCount,x=0;x<i;++x)E?(g1($i,$o,Fs,hu,T*y[x],T*b[x]),kU($i,$i,$o,x<_||x>=C?w:-w)):g1($i,$o,Fs,hu,w*y[x],T*b[x]),Ns(f,$i[0],$i[1],$i[2]),Ns(p,yi[0],yi[1],yi[2]),Ns(h,v+x,v+(x+1)%i,j);qe.addRepeat(m,(a+1)*i+(u?i+1:0)+(c?i+1:0),d)}var ch=S.fromArray,Elt=S.magnitude,UU=S.sub,cle=S.add,VU=S.scale,Ilt=S.negate,Plt=S.copy,Mlt=S.cross,wl=qe.add3,Rlt=qe.add,bo=S(),Jo=S(),Olt=S(),zU=S(),Zg=S(),lle=S(),XC=S(),Flt=S(),GU=S();function a3(e,t,r,n,a,i,o,s){var u=e.currentGroup,c=e.vertices,l=e.normals,d=e.indices,f=e.groups,p=c.elementCount,h=0;s>0&&(ch(bo,t,0),ch(Jo,t,3*a),h=s/Elt(UU(Olt,Jo,bo)));for(var m=0;m<=a;++m){var v=i[m],y=0===s?o[m]:s*(1-m/a),b=3*m;ch(Zg,r,b),VU(Zg,Zg,y),ch(zU,n,b),VU(zU,zU,v),s>0&&(ch(bo,r,b),ch(Jo,n,b),VU(lle,Mlt(lle,bo,Jo),h)),ch(XC,t,b),ch(Flt,r,b),ch(GU,n,b),cle(bo,XC,Zg),Ilt(Jo,GU),wl(c,bo[0],bo[1],bo[2]),wl(l,Jo[0],Jo[1],Jo[2]),UU(bo,XC,Zg),wl(c,bo[0],bo[1],bo[2]),wl(l,Jo[0],Jo[1],Jo[2]),cle(bo,XC,Zg),Plt(Jo,GU),wl(c,bo[0],bo[1],bo[2]),wl(l,Jo[0],Jo[1],Jo[2]),UU(bo,XC,Zg),wl(c,bo[0],bo[1],bo[2]),wl(l,Jo[0],Jo[1],Jo[2])}for(m=0;m<a;++m)wl(d,p+4*m,p+4*(m+1)+1,p+4*m+1),wl(d,p+4*m,p+4*(m+1),p+4*(m+1)+1),wl(d,p+4*m+2+1,p+4*(m+1)+2+1,p+4*m+2),wl(d,p+4*m+2,p+4*(m+1)+2+1,p+4*(m+1)+2);m=0;for(var C=4*(a+1);m<C;++m)Rlt(f,u)}var dle={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:D.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:D.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:D.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:D.Select("elliptical",D.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:D.Select("square",D.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),linearSegments:D.Numeric(8,{min:1,max:48,step:1},ot.CustomQualityParamInfo),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo)},zu=(D.getDefaultValues(dle),S());function Nlt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=a.linearSegments,l=a.radialSegments,d=a.aspectRatio,f=a.arrowFactor,p=a.tubularHelices,h=a.helixProfile,m=a.nucleicProfile,v=c*l*o+(l+1)*o*2,g=ft.createState(v,v/10,i),y=Oe.isCoarse(t),b=pU(c),_=b.curvePoints,C=b.normalVectors,x=b.binormalVectors,A=b.widthValues,T=b.heightValues,w=0,E=lU(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:p});E.hasNext;){var I=E.move();g.currentGroup=w;var M=Zs(I.moleculeType),F=cn.is(I.secStrucType,4),N=cn.is(I.secStrucType,2),k=M?RI:MI;hU(b,I,N&&!p?Act:Pce,k);var H=n.size.size(I.centerPrev)*s,G=n.size.size(I.center)*s,U=n.size.size(I.centerNext)*s;y&&(H*=d/2,G*=d/2,U*=d/2);var Q=I.secStrucFirst||I.coarseBackboneFirst||I.first,W=I.secStrucLast||I.coarseBackboneLast||I.last,K=c;if(I.initial){var ne=c-(K=Math.max(Math.round(c*k),1));_.copyWithin(0,3*ne),x.copyWithin(0,3*ne),C.copyWithin(0,3*ne),S.fromArray(zu,_,3),S.normalize(zu,S.sub(zu,I.p2,zu)),S.scaleAndAdd(zu,I.p2,zu,G*OI),S.toArray(zu,_,0)}else I.final&&(K=Math.max(Math.round(c*(1-k)),1),S.fromArray(zu,_,3*K-3),S.normalize(zu,S.sub(zu,I.p2,zu)),S.scaleAndAdd(zu,I.p2,zu,G*OI),S.toArray(zu,_,3*K));if(!0===I.initial&&!0===I.final)$r(g,I.p2,2*G,u);else if(F){var L=G*d,$=I.secStrucLast?L*f:0;bU(b,H,G,U,X=H*d,L,Y=U*d,k),2===l?a3(g,_,C,x,K,A,T,$):r3(g,_,C,x,K,A,T,$,Q,W)}else{var X=void 0,Y=void(L=void 0);N&&!I.isCoarseBackbone?p?(X=H*=1.5*d,L=G*=1.5*d,Y=U*=1.5*d):(X=H*d,L=G*d,Y=U*d):M&&!I.isCoarseBackbone?(X=H*d,L=G*d,Y=U*d):(X=H,L=G,Y=U),bU(b,H,G,U,X,L,Y,k);var Z=M&&!I.isCoarseBackbone?[x,C]:[C,x],q=Z[0],z=Z[1];if(M&&!I.isCoarseBackbone)for(var te=0,ae=q.length;te<ae;te++)q[te]*=-1;var fe=M?m:h;2===l?M&&!I.isCoarseBackbone?a3(g,_,q,z,K,T,A,0):a3(g,_,q,z,K,A,T,0):4===l?r3(g,_,q,z,K,A,T,0,Q,W):L===G?LU(g,_,q,z,K,l,A,T,Q,W,"elliptical"):"square"===fe?r3(g,_,q,z,K,A,T,0,Q,W):LU(g,_,q,z,K,l,A,T,Q,W,fe)}++w}var he=ft.getMesh(g),pe=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return he.setBoundingSphere(pe),he}var fle=R(R({},po),dle);function klt(e){return Xo({defaultProps:D.getDefaultValues(fle),createGeometry:Nlt,createLocationIterator:function(t){return ih.fromGroup(t,!0)},getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile||r.nucleicProfile!==n.nucleicProfile;var u=Hc.get(o.structure).version;t.info.secondaryStructureHash!==u&&(void 0!==t.info.secondaryStructureHash&&(t.createGeometry=!0),t.info.secondaryStructureHash=u)}},e)}var ple={"polymer-trace":function(e,t){return va("Polymer trace mesh",e,t,klt)},"polymer-gap":function(e,t){return va("Polymer gap cylinder",e,t,OU)},"nucleotide-block":function(e,t){return va("Nucleotide block mesh",e,t,Fct)},"nucleotide-ring":function(e,t){return va("Nucleotide ring mesh",e,t,Gct)},"nucleotide-atomic-ring-fill":function(e,t){return va("Nucleotide atomic ring fill",e,t,Jct)},"nucleotide-atomic-bond":function(e,t){return va("Nucleotide atomic bond",e,t,elt)},"nucleotide-atomic-element":function(e,t){return va("Nucleotide atomic element",e,t,ilt)},"direction-wedge":function(e,t){return va("Polymer direction wedge",e,t,ylt)}},hle=R(R(R(R(R(R(R(R(R({},fle),$I),zce),Yce),DU),EU),Jce),ale),{sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),visuals:D.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],D.objectToOptions(ple)),bumpFrequency:D.Numeric(2,{min:0,max:10,step:.1},ot.ShadingCategory)}),Ult={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:function Llt(e,t){return dr.createMulti("Cartoon",e,t,ho,ple)},getParams:function Blt(e,t){var r=D.clone(hle),n=!1,a=!1;return t.units.forEach(function(i){!n&&Oe.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-ring"),a&&r.visuals.defaultValue.push("polymer-gap"),r},defaultValues:D.getDefaultValues(hle),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return le(this,function(i){switch(i.label){case 0:return[4,Hc.attach(e,t,void 0,!0)];case 1:i.sent(),r=0,n=t.models,i.label=2;case 2:return r<n.length?[4,cU.attach(e,n[r],void 0,!0)]:[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){Hc.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++)cU.ref(r[t],!1)}}},mle=R(R({},po),{sizeFactor:D.Numeric(1,{min:0,max:10,step:.1}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),ignoreHydrogens:D.Boolean(!1)});function Vlt(e){return Xo({defaultProps:D.getDefaultValues(mle),createGeometry:zlt,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function zlt(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(i);var u=a.detail,c=a.sizeFactor,l=a.ignoreHydrogens,d=t.elements,f=t.model,p=t.model.atomicHierarchy.derived.atom.atomicNumber,h=d.length,m=h*ib(u),v=ft.createState(m,m/2,i),g=Gd.Provider.get(f);if(!g)return Lt.createEmpty(i);var y=S(),b=Qt(),_=S(),C=S(),x=S(),A=g.elementToAnsiotrop,T=g.data,w=T.U,E=T._schema.U.space,I=t.conformation.invariantPosition,M=at.create(r);M.unit=t;for(var F=0;F<h;F++){var N=d[F],j=A[N];if(-1!==j&&!(s&&!Xe.has(s.elements,N)||l&&Vrt(p,N))){M.element=N,I(N,y),v.currentGroup=F,Cr.toMat3(b,E,w.value(j)),Qt.symmtricFromLower(b,b),Qt.symmetricEigenvalues(_,b),Qt.eigenvector(C,b,_[1]),Qt.eigenvector(x,b,_[2]);for(var k=0;k<3;++k)_[k]=1.5958*c*Math.sqrt(Math.abs(_[k]));ia(_[0],_[1],gn)&&ia(_[1],_[2],gn)?$r(v,y,_[0],u):e5(v,y,x,C,_,u)}}var H=ft.getMesh(v),G=De.expand(De(),(s||t).boundary.sphere,1*c);return H.setBoundingSphere(G),H}var vle={"ellipsoid-mesh":function(e,t){return va("Ellipsoid Mesh",e,t,Vlt)},"intra-bond":function(e,t){return va("Intra-unit bond cylinder",e,t,$ue)},"inter-bond":function(e,t){return Sc("Inter-unit bond cylinder",e,t,rce)}},gle=R(R(R(R({},mle),CI),xI),{includeParent:D.Boolean(!1),adjustCylinderLength:D.Boolean(!1,{isHidden:!0}),unitKinds:wC(["atomic"]),sizeFactor:D.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:D.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:D.Boolean(!0),visuals:D.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],D.objectToOptions(vle)),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory)}),jlt={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:function Hlt(e,t){return dr.createMulti("Ellipsoid",e,t,ho,vle)},getParams:function Glt(e,t){return gle},defaultValues:D.getDefaultValues(gle),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return Gd.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},qlt="\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute float aRadius;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n\n#if defined(dCalcType_groupId)\n    attribute float aGroup;\n    varying float vGroup;\n#endif\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vRadiusSqInv = 1.0 / (aRadius * aRadius);\n    #if defined(dCalcType_groupId)\n        vGroup = aGroup;\n    #endif\n    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);\n    vPosition = (aPosition - uBboxMin) / uResolution;\n    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n}\n",Wlt="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        precision highp sampler2D;\n        uniform sampler2D tMinDistanceTex;\n        uniform vec3 uGridTexDim;\n    #elif defined(dGridTexType_3d)\n        precision highp sampler3D;\n        uniform sampler3D tMinDistanceTex;\n    #endif\n    varying float vGroup;\n#endif\n\n#include common\n\nuniform vec3 uGridDim;\nuniform vec2 uGridTexScale;\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uAlpha;\nuniform float uResolution;\nuniform float uRadiusFactorInv;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition) * uResolution;\n\n    #if defined(dCalcType_density)\n        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));\n        gl_FragColor.a = density * uRadiusFactorInv;\n    #elif defined(dCalcType_minDistance)\n        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;\n    #elif defined(dCalcType_groupId)\n        #if defined(dGridTexType_2d)\n            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;\n        #elif defined(dGridTexType_3d)\n            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;\n        #endif\n        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)\n            discard;\n        gl_FragColor.rgb = packIntToRGB(vGroup);\n    #endif\n}\n",Ylt={drawCount:pa("number"),instanceCount:pa("number"),aRadius:Rn("float32",1,0),aPosition:Rn("float32",3,0),aGroup:Rn("float32",1,0),uCurrentSlice:Te("f"),uCurrentX:Te("f"),uCurrentY:Te("f"),uBboxMin:Te("v3","material"),uBboxSize:Te("v3","material"),uGridDim:Te("v3","material"),uGridTexDim:Te("v3","material"),uGridTexScale:Te("v2","material"),uAlpha:Te("f","material"),uResolution:Te("f","material"),uRadiusFactorInv:Te("f","material"),tMinDistanceTex:Xt("texture","rgba","float","nearest","material"),dGridTexType:Ut("string",["2d","3d"]),dCalcType:Ut("string",["density","minDistance","groupId"])},Ef="gaussian-density";function HU(e){return e.namedFramebuffers[Ef]||(e.namedFramebuffers[Ef]=e.resources.framebuffer()),e.namedFramebuffers[Ef]}function jU(e,t,r,n,a,i){var o="".concat(Ef,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function yle(e,t,r,n,a,i){return e.isWebGL2?function Xlt(e,t,r,n,a,i){Ct&&e.timer.mark("GaussianDensityTexture3d");var o=function Klt(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,c=e.extensions,l=c.colorBufferFloat,d=c.textureFloat,f=c.colorBufferHalfFloat,p=c.textureHalfFloat,h=a.smoothness,m=a.resolution,v=Cle(t,r,n,a),g=v.drawCount,y=v.positions,b=v.radii,_=v.groups,C=v.scale,x=v.expandedBox,A=v.dim,T=v.maxRadius,w=A[0],E=A[1],I=A[2],M=jU("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");M.define(w,E,I);var F=Ne.create(1,1),N=2*T,j=xle(e,g,y,b,_,M,x,A,A,F,h,m,N),k=j.values.uCurrentSlice,H=HU(e);function G(U,Q){u.currentRenderItemId=-1;for(var W=0;W<I;++W)O.update(k,W),U.attachFramebuffer(H,0,W),Q&&o.clear(o.COLOR_BUFFER_BIT),j.render();o.flush()}return H.bind(),wle(e),u.viewport(0,0,w,E),u.scissor(0,0,w,E),i||(i=f&&p?s.texture("volume-float16","rgba","fp16","linear"):l&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(w,E,I),Tle(e,j),G(i,!0),Ale(e,j),G(M,!0),Dle(e,j),G(i,!1),{texture:i,scale:C,bbox:x,gridDim:A,gridTexDim:A,gridTexScale:F,radiusFactor:N,resolution:m,maxRadius:T}}(e,t,r,n,a,i);return Ct&&e.timer.markEnd("GaussianDensityTexture3d"),ble(o)}(e,t,r,n,a,i):qU(e,t,r,n,!1,a,i)}function qU(e,t,r,n,a,i,o){Ct&&e.timer.mark("GaussianDensityTexture2d");var s=function Sle(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,c=e.state,l=e.extensions,d=l.colorBufferFloat,f=l.textureFloat,p=l.colorBufferHalfFloat,h=l.textureHalfFloat,m=l.blendMinMax,v=i.smoothness,g=i.resolution,y=Cle(t,r,n,i),b=y.drawCount,_=y.positions,C=y.radii,x=y.groups,A=y.scale,T=y.expandedBox,w=y.dim,E=y.maxRadius,I=w[0],M=w[1],F=w[2],N=function Qlt(e){var r=Math.sqrt(e[0]*e[1]*e[2]),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:2*n}}(w),j=N.texDimX,k=N.texDimY,H=N.texCols,G=N.powerOfTwoSize,U=S.create(j,k,0),Q=Ne.create(j/G,k/G),W=2*E,K=a?G:j,ne=a?G:k,X=jU("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");X.define(K,ne);var L=xle(e,b,_,C,x,X,T,w,U,Q,v,g,W),Y=L.values,$=Y.uCurrentSlice,Z=Y.uCurrentX,q=Y.uCurrentY,z=HU(e);function te(ae,fe){c.currentRenderItemId=-1,ae.attachFramebuffer(z,0),fe&&(c.viewport(0,0,K,ne),c.scissor(0,0,K,ne),s.clear(s.COLOR_BUFFER_BIT)),O.update(q,0);for(var he=0,pe=0,re=0,ee=0;ee<F;++ee)he>=H&&(he-=H,re=0,O.update(q,pe+=M)),O.update(Z,re),O.update($,ee),c.viewport(re,pe,I,M),c.scissor(re,pe,I,M),L.render(),++he,re+=I;s.flush()}return z.bind(),wle(e),o||(o=p&&h?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(K,ne),Tle(e,L),te(o,!0),m&&(Ale(e,L),te(X,!0),Dle(e,L),te(o,!1)),{texture:o,scale:A,bbox:T,gridDim:w,gridTexDim:U,gridTexScale:Q,radiusFactor:W,resolution:g,maxRadius:E}}(e,t,r,n,a,i,o);return Ct&&e.timer.markEnd("GaussianDensityTexture2d"),ble(s)}function ble(e){var t=e.texture,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution,c=e.maxRadius;return{transform:_le(e.scale,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u,maxRadius:c}}function _le(e,t){var r=me.identity();return me.fromScaling(r,e),me.setTranslation(r,t.min),r}function Cle(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,c=e.y,l=e.z,d=e.id,f=Be.size(s),p=new Float32Array(3*f),h=new Float32Array(f),m=new Float32Array(f),v=0,g=0;g<f;++g){var y=Be.getAt(s,g);p[3*g]=u[y],p[3*g+1]=c[y],p[3*g+2]=l[y];var b=r(y)+i;v<b&&(v=b),h[g]=b,m[g]=d?d[g]:g}var _=2*v+4*a,C=Nt.expand(Nt(),t,S.create(_,_,_)),x=Nt.scale(Nt(),C,o),A=Nt.size(S(),x);return S.ceil(A,A),{drawCount:f,positions:p,radii:h,groups:m,scale:S.create(a,a,a),expandedBox:C,dim:A,maxRadius:v}}function xle(e,t,r,n,a,i,o,s,u,c,l,d,f){if(e.namedComputeRenderables[Ef]){var p=S.sub(S(),o.max,o.min),h=e.namedComputeRenderables[Ef].values;O.updateIfChanged(h.drawCount,t),O.updateIfChanged(h.instanceCount,1),O.update(h.aRadius,n),O.update(h.aPosition,r),O.update(h.aGroup,a),O.updateIfChanged(h.uCurrentSlice,0),O.updateIfChanged(h.uCurrentX,0),O.updateIfChanged(h.uCurrentY,0),O.update(h.uBboxMin,o.min),O.update(h.uBboxSize,p),O.update(h.uGridDim,s),O.update(h.uGridTexDim,u),O.update(h.uGridTexScale,c),O.updateIfChanged(h.uAlpha,l),O.updateIfChanged(h.uResolution,d),O.updateIfChanged(h.uRadiusFactorInv,1/f),O.update(h.tMinDistanceTex,i),O.updateIfChanged(h.dGridTexType,i.getDepth()>0?"3d":"2d"),O.updateIfChanged(h.dCalcType,"density"),e.namedComputeRenderables[Ef].update()}else e.namedComputeRenderables[Ef]=function Zlt(e,t,r,n,a,i,o,s,u,c,l,d,f){var p=S.sub(S(),o.max,o.min),h={drawCount:O.create(t),instanceCount:O.create(1),aRadius:O.create(n),aPosition:O.create(r),aGroup:O.create(a),uCurrentSlice:O.create(0),uCurrentX:O.create(0),uCurrentY:O.create(0),uBboxMin:O.create(o.min),uBboxSize:O.create(p),uGridDim:O.create(s),uGridTexDim:O.create(u),uGridTexScale:O.create(c),uAlpha:O.create(l),uResolution:O.create(d),uRadiusFactorInv:O.create(1/f),tMinDistanceTex:O.create(i),dGridTexType:O.create(i.getDepth()>0?"3d":"2d"),dCalcType:O.create("density")},m=R({},Ylt);return Wa(qa(e,"points",Un(Ef,qlt,Wlt),m,h),h)}(e,t,r,n,a,i,o,s,u,c,l,d,f);return e.namedComputeRenderables[Ef]}function wle(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function Ale(e,t){var r=e.gl,n=e.state;if(O.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function Tle(e,t){var r=e.gl,n=e.state;O.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function Dle(e,t){var r=e.gl,n=e.state;O.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}var Ele=new ArrayBuffer(4);new Int32Array(Ele),new Float32Array(Ele);var Ile=new ArrayBuffer(4),rdt=new Int32Array(Ile),ndt=new Float32Array(Ile);function y1(e){return function adt(e){return rdt[0]=(1<<23)*((e<-126?-126:e)+126.94269504),ndt[0]}(1.44269504*e)}var Ple=new ArrayBuffer(8);new Int32Array(Ple),new Float32Array(Ple);var Rle=new ArrayBuffer(4);new Int32Array(Rle),new Float32Array(Rle),Math,Math,Math,Math,Math,Math,Math,Math,Math;var kle=new ArrayBuffer(16);new Int32Array(kle),new Float32Array(kle);var Ble=new ArrayBuffer(8);new Int32Array(Ble),new Float32Array(Ble);var Ule=new ArrayBuffer(4);function zle(e,t,r,n,a){return ce(this,void 0,void 0,function(){function o(){return ce(this,void 0,void 0,function(){var Z;return le(this,function(q){switch(q.label){case 0:Z=0,q.label=1;case 1:return Z<v?(function i(Z,q){for(var z=Z;z<q;++z)for(var te=Be.getAt(d,z),ae=f[te],fe=p[te],he=h[te],pe=g[z],ee=1/(pe*pe),ue=2*pe,ge=ue*ue,Ce=Math.ceil(ue*l),ze=Math.floor(l*(ae-A[0])),je=Math.floor(l*(fe-A[1])),V=Math.floor(l*(he-A[2])),J=Math.max(0,ze-Ce),ye=Math.max(0,je-Ce),we=Math.max(0,V-Ce),Ee=Math.min(j,ze+Ce+2),Fe=Math.min(k,je+Ce+2),ke=Math.min(H,V+Ce+2),Ue=J;Ue<Ee;++Ue)for(var $e=W[Ue]-ae,Pe=Ue*Q,He=ye;He<Fe;++He)for(var Je=K[He]-fe,vt=$e*$e+Je*Je,ut=He*G+Pe,_t=we;_t<ke;++_t){var wt=ne[_t]-he,Le=vt+wt*wt;if(Le<=ge){var st=y1(Le*ee*-L),St=_t+ut;I[St]+=st,st>X[St]&&(X[St]=st,F[St]=m?m[z]:z)}}}(Z,Math.min(Z+Y,v)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:Z,max:v})]:[3,3]):[3,4];case 2:q.sent(),q.label=3;case 3:return Z+=Y,[3,1];case 4:return[2]}})})}var s,u,c,l,d,f,p,h,m,v,g,y,b,_,C,x,A,T,w,E,I,M,F,N,j,k,H,G,Q,W,K,ne,X,L,Y,$;return le(this,function(Z){switch(Z.label){case 0:for(u=a.radiusOffset,c=a.smoothness,l=1/(s=a.resolution),f=t.x,p=t.y,h=t.z,m=t.id,v=Be.size(d=t.indices),g=new Float32Array(v),y=0,b=0;b<v;++b)_=n(Be.getAt(d,b))+u,y<_&&(y=_),g[b]=_;return C=2*y+s,x=Nt.expand(Nt(),r,S.create(C,C,C)),A=x.min,T=Nt.scale(Nt(),x,l),w=Nt.size(S(),T),S.ceil(w,w),E=Cr.Space(w,[0,1,2],Float32Array),I=E.create(),M=Cr.create(E,I),(F=E.create()).fill(-1),N=Cr.create(E,F),j=w[0],Q=(G=H=w[2])*(k=w[1]),W=Dy(w[0],A[0],s),K=Dy(w[1],A[1],s),ne=Dy(w[2],A[2],s),X=E.create(),L=c,Y=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*l)),[4,o()];case 1:return Z.sent(),$=me.identity(),me.fromScaling($,S.create(s,s,s)),me.setTranslation($,x.min),[2,{field:M,idField:N,transform:$,radiusFactor:1,resolution:s,maxRadius:y}]}})})}new Int32Array(Ule),new Float32Array(Ule),Math;var QC=R({resolution:D.Numeric(1,{min:.1,max:20,step:.1},R({description:"Grid resolution/cell spacing."},ot.CustomQualityParamInfo)),radiusOffset:D.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:D.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},ZE);function Gle(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function Hle(e,t,r,n){var a=this,i=QE(e,t,r,n),o=i.position,s=i.boundary,u=i.radius,c=Em(s.box,n);return Ve.create("Gaussian Density",function(l){return ce(a,void 0,void 0,function(){return le(this,function(d){switch(d.label){case 0:return[4,zle(l,o,s.box,u,c)];case 1:return[2,d.sent()]}})})})}function bdt(e,t,r,n,a,i){var o=this,s=QE(e,t,r,n),u=s.position,c=s.boundary,l=s.radius,d=Em(c.box,n,Gle(a,e));return Ve.create("Gaussian Density",function(f){return ce(o,void 0,void 0,function(){return le(this,function(p){return[2,yle(a,u,c.box,l,d,i)]})})})}function _dt(e,t,r,n,a,i,o){var s=this,u=QE(e,t,r,a),c=u.position,l=u.boundary,d=u.radius,f=Em(l.box,a,Gle(i,e));return Ve.create("Gaussian Density",function(p){return ce(s,void 0,void 0,function(){return le(this,function(h){return[2,qU(i,c,l.box,d,n,f,o)]})})})}function Sdt(e,t,r){var n=this,a=$E(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=Em(o.box,r);return Ve.create("Gaussian Density",function(c){return ce(n,void 0,void 0,function(){return le(this,function(l){switch(l.label){case 0:return[4,zle(c,i,o.box,s,u)];case 1:return[2,l.sent()]}})})})}function Cdt(e,t,r,n,a){var i=this,o=$E(e,t,r),s=o.position,u=o.boundary,c=o.radius,l=Em(u.box,r);return Ve.create("Gaussian Density",function(d){return ce(i,void 0,void 0,function(){return le(this,function(f){return[2,yle(n,s,u.box,c,l,a)]})})})}function xdt(e,t,r,n,a,i){var o=this,s=e.lookup3d.boundary.box,u=$E(e,t,n),c=u.position,d=u.radius,f=Em(u.boundary.box,n);return Ve.create("Gaussian Density",function(p){return ce(o,void 0,void 0,function(){return le(this,function(h){return[2,qU(a,c,s,d,r,f,i)]})})})}D.getDefaultValues(QC);var jle=R(R(R({},QC),Iee),{ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),tryUseGpu:D.Boolean(!0),includeParent:D.Boolean(!1,{isHidden:!0})}),ZU=R(R(R({},po),ont),jle),qle=R(R(R({},Bb),Jrt),jle);function Wle(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function _1(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=ese(e.boundary.box,t.resolution,n*n);return a.areaCells<a.maxAreaCells}function wdt(e,t,r,n){return r.tryUseGpu&&n&&Wle(n)&&_1(t,r,n)?function Mdt(e){return function snt(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:xs.Utils}),t)}({defaultProps:D.getDefaultValues(ZU),createGeometry:Pdt,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!_1(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=rl(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&i&&(cae(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e):function Ddt(e){return Xo({defaultProps:D.getDefaultValues(ZU),createGeometry:Tdt,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&_1(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=rl(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(yE(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e)}function Adt(e,t,r,n){return r.tryUseGpu&&n&&Wle(n)&&_1(t,r,n)?function Odt(e){return function ent(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:xs.Utils}),t)}({defaultProps:D.getDefaultValues(qle),createGeometry:Rdt,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!_1(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=rl(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&i&&(cae(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e):function Idt(e){return $p({defaultProps:D.getDefaultValues(qle),createGeometry:Edt,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&_1(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=rl(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(yE(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e)}function Tdt(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m,v;return le(this,function(g){switch(g.label){case 0:return o=a.smoothness,[4,Hle(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=g.sent(),u=s.transform,c=s.field,l=s.idField,d=s.radiusFactor,f=s.resolution,p=s.maxRadius,[4,Hb({isoLevel:Math.exp(-o)/d,scalarField:c,idField:l},i).runAsChild(e.runtime)];case 2:return(m=g.sent()).meta.resolution=f,Lt.transform(m,u),e.webgl&&!e.webgl.isWebGL2?(Lt.uniformTriangleGroup(m),O.updateIfChanged(m.varyingGroup,!1)):O.updateIfChanged(m.varyingGroup,!0),v=De.expand(De(),t.boundary.sphere,p),m.setBoundingSphere(v),[2,m]}})})}function Edt(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,h,m;return le(this,function(v){switch(v.label){case 0:return i=n.smoothness,[4,Sdt(t,r.size,n).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,c=o.idField,l=o.radiusFactor,d=o.resolution,f=o.maxRadius,[4,Hb({isoLevel:Math.exp(-i)/l,scalarField:u,idField:c},a).runAsChild(e.runtime)];case 2:return(h=v.sent()).meta.resolution=d,Lt.transform(h,s),e.webgl&&!e.webgl.isWebGL2?(Lt.uniformTriangleGroup(h),O.updateIfChanged(h.varyingGroup,!1)):O.updateIfChanged(h.varyingGroup,!0),m=De.expand(De(),t.boundary.sphere,f),h.setBoundingSphere(m),[2,h]}})})}var S1="gaussian-surface";function Pdt(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h,m,v,g,y,b,_,C;return le(this,function(x){switch(x.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return Ct&&e.webgl.timer.mark("createGaussianSurfaceTextureMesh"),u=(o=e.webgl).resources,l=(c=o.extensions).colorBufferFloat,d=c.textureFloat,f=c.colorBufferHalfFloat,p=c.textureHalfFloat,(s=o.namedTextures)[S1]||(s[S1]=f&&p?u.texture("image-float16","rgba","fp16","linear"):l&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,_dt(r,t,n.size,!0,a,e.webgl,s[S1]).runInContext(e.runtime)];case 1:return h=x.sent(),m=Math.exp(-a.smoothness)/h.radiusFactor,v=S.create(0,1,2),g=i?.doubleBuffer.get(),y=fI(e.webgl,h.texture,h.gridDim,h.gridTexDim,h.gridTexScale,h.transform,m,!1,!0,v,!0,g?.vertex,g?.group,g?.normal),Ct&&e.webgl.timer.markEnd("createGaussianSurfaceTextureMesh"),b=t.elements.length,_=De.expand(De(),t.boundary.sphere,h.maxRadius),(C=xs.create(y.vertexCount,b,y.vertexTexture,y.groupTexture,y.normalTexture,_,i)).meta.resolution=h.resolution,C.meta.webgl=e.webgl,[2,C]}})})}function Rdt(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,h,m,v,g,y,b,_;return le(this,function(C){switch(C.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return Ct&&e.webgl.timer.mark("createStructureGaussianSurfaceTextureMesh"),s=(i=e.webgl).resources,c=(u=i.extensions).colorBufferFloat,l=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,(o=i.namedTextures)[S1]||(o[S1]=d&&f?s.texture("image-float16","rgba","fp16","linear"):c&&l?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,xdt(t,r.size,!0,n,e.webgl,o[S1]).runInContext(e.runtime)];case 1:return p=C.sent(),h=Math.exp(-n.smoothness)/p.radiusFactor,m=S.create(0,1,2),v=a?.doubleBuffer.get(),g=fI(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,h,!1,!0,m,!0,v?.vertex,v?.group,v?.normal),Ct&&e.webgl.timer.markEnd("createStructureGaussianSurfaceTextureMesh"),y=t.elementCount,b=De.expand(De(),t.boundary.sphere,p.maxRadius),(_=xs.create(g.vertexCount,y,g.vertexTexture,g.groupTexture,g.normalTexture,b,a)).meta.resolution=p.resolution,_.meta.webgl=e.webgl,[2,_]}})})}function Fdt(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,c,l,d,p,h;return le(this,function(m){switch(m.label){case 0:return o=a.smoothness,[4,Hle(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=m.sent(),u=s.transform,c=s.field,l=s.idField,d=s.maxRadius,[4,f6({isoLevel:Math.exp(-o),scalarField:c,idField:l},i).runAsChild(e.runtime)];case 2:return p=m.sent(),ca.transform(p,u),h=De.expand(De(),t.boundary.sphere,d),p.setBoundingSphere(h),[2,p]}})})}var Yle=R(R(R({},JE),QC),{sizeFactor:D.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:D.Boolean(!1),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),includeParent:D.Boolean(!1,{isHidden:!0})});function Ndt(e){return eI({defaultProps:D.getDefaultValues(Yle),createGeometry:Fdt,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Xle={"gaussian-surface-mesh":function(e,t){return va("Gaussian surface mesh",e,t,wdt)},"structure-gaussian-surface-mesh":function(e,t){return Sc("Structure-Gaussian surface mesh",e,t,Adt)},"gaussian-surface-wireframe":function(e,t){return va("Gaussian surface wireframe",e,t,Ndt)}},Kle=R(R(R({},ZU),Yle),{visuals:D.MultiSelect(["gaussian-surface-mesh"],D.objectToOptions(Xle)),bumpFrequency:D.Numeric(1,{min:0,max:10,step:.1},ot.ShadingCategory)}),Ldt={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:function Bdt(e,t){return dr.createMulti("Gaussian Surface",e,t,ho,Xle)},getParams:function kdt(e,t){return Kle},defaultValues:D.getDefaultValues(Kle),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},Zle=R(R({},Krt),{background:D.Boolean(!1),backgroundMargin:D.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:D.Color(gr.black),backgroundOpacity:D.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:D.Numeric(.25,{min:0,max:.5,step:.01}),level:D.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),chainScale:D.Numeric(10,{min:0,max:20,step:.1}),residueScale:D.Numeric(1,{min:0,max:20,step:.1}),elementScale:D.Numeric(.5,{min:0,max:20,step:.1})});function Udt(e){return function Zrt(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:hc.Utils}),t)}({defaultProps:D.getDefaultValues(Zle),createGeometry:Vdt,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||"chain"===r.level&&r.chainScale!==n.chainScale||"residue"===r.level&&r.residueScale!==n.residueScale||"element"===r.level&&r.elementScale!==n.elementScale||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function Vdt(e,t,r,n,a){switch(n.level){case"chain":return function zdt(e,t,r,n,a){for(var i=at.create(t),o=t.units,u=it.chain,c=u.auth_asym_id,l=u.label_asym_id,d=t.serialMapping.cumulativeUnitElementCount,f=o.length,p=n.chainScale,h=ff.create(n,f,f/2,a),m=0,v=o.length;m<v;++m){var g=o[m];i.unit=g,i.element=g.elements[0];var y=g.lookup3d.boundary.sphere,_=y.radius;S.transformMat4(Al,y.center,g.conformation.operator.matrix);var C=c(i),x=l(i),A=C===x?x:"".concat(x," [").concat(C,"]");h.add(A,Al[0],Al[1],Al[2],_,p,d[m])}return h.getText()}(0,t,0,n,a);case"residue":return function Gdt(e,t,r,n,a){for(var i=at.create(t),o=t.units,u=it.atom.label_comp_id,c=it.residue.auth_seq_id,l=t.serialMapping.cumulativeUnitElementCount,d=2*t.polymerResidueCount,f=n.residueScale,p=ff.create(n,d,d/2,a),h=0,m=o.length;h<m;++h){var v=o[h],g=v.conformation.position,y=v.elements;i.unit=v,i.element=v.elements[0];for(var b=v.model.atomicHierarchy.residueAtomSegments.index,_=l[h],C=0,x=y.length;C<x;){var A=C,T=b[y[C]];for(C++;C<x&&b[y[C]]===T;)C++;$C.reset();for(var w=A;w<C;w++)g(y[w],Al),$C.includePosition(Al);for($C.finishedIncludeStep(),w=A;w<C;w++)g(y[w],Al),$C.radiusPosition(Al);i.element=y[A];var E=$C.getSphere(),I=E.center,M=E.radius,F=c(i),N=u(i),j="".concat(N," ").concat(F);p.add(j,I[0],I[1],I[2],M,f,_+A)}}return p.getText()}(0,t,0,n,a);case"element":return function Hdt(e,t,r,n,a){for(var i=at.create(t),o=t.units,u=it.atom,c=u.label_atom_id,l=u.label_alt_id,d=t.serialMapping.cumulativeUnitElementCount,f=r.size,p=t.elementCount,h=n.elementScale,m=ff.create(n,p,p/2,a),v=0,g=o.length;v<g;++v){var y=o[v],b=y.conformation.position,_=y.elements;i.unit=y;for(var C=d[v],x=Ng(t,y,R(R({},n),{traceOnly:!1})),A=0,T=_.length;A<T;A++)if(!x||!x(_[A])){i.element=_[A],b(i.element,Al);var w=c(i),E=l(i),I=E?"".concat(w,"%").concat(E):w;m.add(I,Al[0],Al[1],Al[2],f.size(i),h,C+A)}}return m.getText()}(0,t,r,n,a)}}var Al=S(),$C=new oc("98"),Qle={"label-text":function(e,t){return Sc("Label text",e,t,Udt)}},$le=R(R({},Zle),{visuals:D.MultiSelect(["label-text"],D.objectToOptions(Qle))}),Wdt={name:"label",label:"Label",description:"Displays labels.",factory:function qdt(e,t){var r=dr.createMulti("Label",e,t,ho,Qle);return r.setState({pickable:!1,markerActions:Vt.None}),r},getParams:function jdt(e,t){return $le},defaultValues:D.getDefaultValues($le),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},QU={probeRadius:D.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:D.Numeric(.5,{min:.01,max:20,step:.01},R({description:"Grid resolution/cell spacing."},ot.CustomQualityParamInfo)),probePositions:D.Numeric(36,{min:12,max:90,step:1},R({description:"Number of positions tested for probe target intersection."},ot.CustomQualityParamInfo))};function Kdt(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){function o(J,ye,we,Ee,Fe){if(-1!==p){if((ke=p)!==Ee&&ke!==Fe&&s(ke,J,ye,we))return ke;p=-1}for(var Ue=0,$e=w.count;Ue<$e;++Ue){var ke;if((ke=Be.getAt(E,w.indices[Ue]))!==Ee&&ke!==Fe&&s(ke,J,ye,we))return p=ke,ke}return-1}function s(J,ye,we,Ee){var Fe=j[J],ke=I[J]-ye,Ue=M[J]-we,$e=F[J]-Ee;return ke*ke+Ue*Ue+$e*$e<Fe*Fe}function c(){return ce(this,void 0,void 0,function(){var J;return le(this,function(ye){switch(ye.label){case 0:J=0,ye.label=1;case 1:return J<k?(function u(J,ye){for(var we=J;we<ye;++we){var Ee=Be.getAt(E,we),Fe=I[Ee],ke=M[Ee],Ue=F[Ee],$e=j[Ee],Pe=$e*$e;T.find(Fe,ke,Ue,$e);for(var He=Math.ceil($e*C),Je=Math.floor(C*(Fe-Q)),vt=Math.floor(C*(ke-W)),ut=Math.floor(C*(Ue-K)),_t=Math.max(0,Je-He),wt=Math.max(0,vt-He),Le=Math.max(0,ut-He),st=Math.min(L,Je+He+2),St=Math.min(Y,vt+He+2),bt=Math.min($,ut+He+2),Mt=_t;Mt<st;++Mt)for(var Rt=ee[Mt]-Fe,oe=Mt*z,be=wt;be<St;++be)for(var Se=ue[be]-ke,Qe=Rt*Rt+Se*Se,Et=be*Z+oe,At=Le;At<bt;++At){var Zt=ge[At]-Ue,Ir=Qe+Zt*Zt;if(Ir<Pe){var rr=At+Et;pe[rr]<0&&(pe[rr]*=-1);var mn=Math.sqrt(Ir),na=$e/mn;if(-1===o(Rt*na+Fe,Se*na+ke,Zt*na+Ue,Ee,-1)){var Rf=$e-mn;Rf<pe[rr]&&(pe[rr]=Rf,re[rr]=N[we])}}}}}(J,Math.min(J+Ce,k)),e.shouldUpdate?[4,e.update({message:"projecting points",current:J,max:k})]:[3,3]):[3,4];case 2:ye.sent(),ye.label=3;case 3:return J+=Ce,[3,1];case 4:return[2]}})})}function l(J,ye){var we=j[J],Ee=j[ye],Fe=h[0]=I[ye]-I[J],ke=h[1]=M[ye]-M[J],Ue=h[2]=F[ye]-F[J],Pe=Math.sqrt(Fe*Fe+ke*ke+Ue*Ue),Je=we*((we*we+Pe*Pe-Ee*Ee)/(2*we*Pe));S.normalize(h,h),function Ydt(e,t){e[0]=e[1]=e[2]=1,0!==t[0]?e[0]=(t[1]+t[2])/-t[0]:0!==t[1]?e[1]=(t[0]+t[2])/-t[1]:0!==t[2]&&(e[2]=(t[0]+t[1])/-t[2])}(v,h),S.normalize(v,v),S.cross(g,h,v),S.normalize(g,g);var vt=Math.sqrt(we*we-Je*Je);S.scale(v,v,vt),S.scale(g,g,vt),S.scale(h,h,Je),m[0]=h[0]+I[J],m[1]=h[1]+M[J],m[2]=h[2]+F[J],p=-1;for(var ut=0;ut<_;++ut){var _t=ae[ut],wt=fe[ut],Le=m[0]+_t*v[0]+wt*g[0],st=m[1]+_t*v[1]+wt*g[1],St=m[2]+_t*v[2]+wt*g[2];if(-1===o(Le,st,St,J,ye))for(var bt=Math.floor(C*(Le-Q)),Mt=Math.floor(C*(st-W)),Rt=Math.floor(C*(St-K)),oe=Math.max(0,bt-x),be=Math.max(0,Mt-x),Se=Math.max(0,Rt-x),Qe=Math.min(L,bt+x+2),Et=Math.min(Y,Mt+x+2),At=Math.min($,Rt+x+2),Zt=oe;Zt<Qe;++Zt)for(var Ir=Le-ee[Zt],rr=Zt*z,mn=be;mn<Et;++mn)for(var na=st-ue[mn],_o=Ir*Ir+na*na,Za=mn*Z+rr,Ji=Se;Ji<At;++Ji){var Rf=St-ge[Ji],Ym=_o+Rf*Rf,Ge=Ji+Za,Ze=pe[Ge];Ze>0&&Ym<Ze*Ze&&(pe[Ge]=Math.sqrt(Ym),re[Ge]=N[Be.indexOf(E,Ir*h[0]+na*h[1]+Rf*h[2]<0?ye:J)])}}}function f(){return ce(this,void 0,void 0,function(){var J;return le(this,function(ye){switch(ye.label){case 0:J=0,ye.label=1;case 1:return J<k?(function d(J,ye){for(var we=J;we<ye;++we){var Ee=Be.getAt(E,we);T.find(I[Ee],M[Ee],F[Ee],j[Ee]);for(var Fe=0,ke=w.count;Fe<ke;++Fe){var Ue=Be.getAt(E,w.indices[Fe]);Ee<Ue&&l(Ee,Ue)}}}(J,Math.min(J+Ce,k)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:J,max:k})]:[3,3]):[3,4];case 2:ye.sent(),ye.label=3;case 3:return J+=Ce,[3,1];case 4:return[2]}})})}var p,h,m,v,g,y,_,C,x,A,T,w,E,I,M,F,N,j,k,H,G,U,Q,W,K,ne,X,L,Y,$,Z,z,te,ae,fe,he,pe,re,ee,ue,ge,Ce,ze,je,V;return le(this,function(J){switch(J.label){case 0:return p=-1,h=S(),m=S(),v=S(),g=S(),_=i.probePositions,C=1/(y=i.resolution),x=Math.max(5,2+Math.floor(i.probeRadius*C)),A=S.create(n,n,n),S.scale(A,A,2),T=tp(t,r,A),w=T.result,null===a&&(a=T.boundary.box),I=t.x,M=t.y,F=t.z,N=t.id,j=t.radius,k=Be.size(E=t.indices),H=n+y,G=Nt.expand(Nt(),a,S.create(H,H,H)),Q=(U=G.min)[0],W=U[1],K=U[2],ne=Nt.scale(Nt(),G,C),X=Nt.size(S(),ne),S.ceil(X,X),L=X[0],z=(Z=$=X[2])*(Y=X[1]),te=function Xdt(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}(_),ae=te.cosTable,fe=te.sinTable,he=Cr.Space(X,[0,1,2],Float32Array),pe=he.create(),re=he.create(),pe.fill(-1001),re.fill(-1),ee=Dy(L,Q,y),ue=Dy(Y,W,y),ge=Dy($,K,y),Ce=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*C)),[4,c()];case 1:return J.sent(),[4,f()];case 2:return J.sent(),ze=Cr.create(he,pe),je=Cr.create(he,re),V=me.identity(),me.fromScaling(V,S.create(y,y,y)),me.setTranslation(V,G.min),[2,{field:ze,idField:je,transform:V,resolution:y,maxRadius:n}]}})})}function Jle(e,t,r,n){var a=this,i=function Zdt(e,t,r,n){for(var a=n.probeRadius,i=QE(e,t,r,n),o=i.position,s=i.boundary,u=i.radius,c=o.indices,l=Be.size(c),d=new Float32Array(Be.end(c)),f=0,p=0;p<l;++p){var h=Be.getAt(c,p),m=u(h);f<m&&(f=m),d[h]=m+a}return{position:R(R({},o),{radius:d}),boundary:s,maxRadius:f}}(e,t,r,n),o=i.position,s=i.boundary,u=i.maxRadius,c=Em(s.box,n);return Ve.create("Molecular Surface",function(l){return ce(a,void 0,void 0,function(){return le(this,function(d){switch(d.label){case 0:return[4,ede(l,o,s,u,s.box,c)];case 1:return[2,d.sent()]}})})})}function $dt(e,t,r){var n=this,a=function Qdt(e,t,r){for(var n=r.probeRadius,a=$E(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=i.indices,c=Be.size(u),l=new Float32Array(Be.end(u)),d=0,f=0;f<c;++f){var p=Be.getAt(u,f),h=s(p);d<h&&(d=h),l[p]=h+n}return{position:R(R({},i),{radius:l}),boundary:o,maxRadius:d}}(e,t,r),i=a.position,o=a.boundary,s=a.maxRadius,u=Em(o.box,r);return Ve.create("Molecular Surface",function(c){return ce(n,void 0,void 0,function(){return le(this,function(l){switch(l.label){case 0:return[4,ede(c,i,o,s,o.box,u)];case 1:return[2,l.sent()]}})})})}function ede(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){return le(this,function(o){return[2,Kdt(e,t,r,n,a,i)]})})}D.getDefaultValues(QU);var $U=R(R(R(R({},po),QU),ZE),Iee);function Jdt(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,l,d,p,h,m;return le(this,function(v){switch(v.label){case 0:return[4,Jle(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,l=o.resolution,d=o.maxRadius,[4,Hb({isoLevel:a.probeRadius,scalarField:o.field,idField:o.idField},i).runAsChild(e.runtime)];case 2:return p=v.sent(),a.includeParent&&(h=Math.ceil(2/a.resolution),Lt.smoothEdges(p,{iterations:h,maxNewEdgeLength:Math.sqrt(2)})),Lt.transform(p,s),e.webgl&&!e.webgl.isWebGL2?(Lt.uniformTriangleGroup(p),O.updateIfChanged(p.varyingGroup,!1)):O.updateIfChanged(p.varyingGroup,!0),m=De.expand(De(),t.boundary.sphere,d),p.setBoundingSphere(m),p.meta.resolution=l,[2,p]}})})}function eft(e){return Xo({defaultProps:D.getDefaultValues($U),createGeometry:Jdt,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=rl(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(yE(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}function tft(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,c,l,f,p,h;return le(this,function(m){switch(m.label){case 0:return[4,$dt(t,r.size,n).runInContext(e.runtime)];case 1:return i=m.sent(),o=i.transform,c=i.resolution,l=i.maxRadius,[4,Hb({isoLevel:n.probeRadius,scalarField:i.field,idField:i.idField},a).runAsChild(e.runtime)];case 2:return f=m.sent(),n.includeParent&&(p=Math.ceil(2/n.resolution),Lt.smoothEdges(f,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})),Lt.transform(f,o),e.webgl&&!e.webgl.isWebGL2?(Lt.uniformTriangleGroup(f),O.updateIfChanged(f.varyingGroup,!1)):O.updateIfChanged(f.varyingGroup,!0),h=De.expand(De(),t.boundary.sphere,l),f.setBoundingSphere(h),f.meta.resolution=c,[2,f]}})})}function rft(e){return $p({defaultProps:D.getDefaultValues($U),createGeometry:tft,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=rl(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(yE(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}var tde=R(R(R(R({},JE),QU),ZE),{sizeFactor:D.Numeric(1.5,{min:0,max:10,step:.1})});function nft(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,l,f,p;return le(this,function(h){switch(h.label){case 0:return[4,Jle(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,l=o.maxRadius,[4,f6({isoLevel:a.probeRadius,scalarField:o.field,idField:o.idField},i).runAsChild(e.runtime)];case 2:return f=h.sent(),ca.transform(f,s),p=De.expand(De(),t.boundary.sphere,l),f.setBoundingSphere(p),[2,f]}})})}function aft(e){return eI({defaultProps:D.getDefaultValues(tde),createGeometry:nft,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var rde={"molecular-surface-mesh":function(e,t){return va("Molecular surface mesh",e,t,eft)},"structure-molecular-surface-mesh":function(e,t){return Sc("Structure Molecular surface mesh",e,t,rft)},"molecular-surface-wireframe":function(e,t){return va("Molecular surface wireframe",e,t,aft)}},nde=R(R(R({},$U),tde),{visuals:D.MultiSelect(["molecular-surface-mesh"],D.objectToOptions(rde)),bumpFrequency:D.Numeric(1,{min:0,max:10,step:.1},ot.ShadingCategory)}),sft={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:function oft(e,t){return dr.createMulti("Molecular Surface",e,t,ho,rde)},getParams:function ift(e,t){return nde},defaultValues:D.getDefaultValues(nde),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},ade=R(R({},po),{sizeFactor:D.Numeric(1,{min:0,max:2,step:.1}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo)});function uft(e){return Xo({defaultProps:D.getDefaultValues(ade),createGeometry:lft,createLocationIterator:dft,getLoci:fft,eachLocation:pft,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function lft(e,t,r,n,a,i){if(!function cft(e){if(Oe.Traits.is(e.traits,Oe.Trait.MultiChain)||Oe.Traits.is(e.traits,Oe.Trait.Partitioned))return!1;if(Oe.isCoarse(e))return!0;if(0===e.elements.length)return!1;var r=e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[0]]];return!(3===r||2===r)}(t))return Lt.createEmpty(i);var o=a.detail,s=a.sizeFactor,c=ft.createState(256,128,i),l=t.principalAxes.boxAxes,d=l.origin,f=l.dirA,p=l.dirB,h=Uo.size(S(),l);S.scale(h,h,s/2);var m=S.create(h[2],h[1],h[0]);c.currentGroup=0,e5(c,d,f,p,m,o+1);var v=ft.getMesh(c),g=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(g),v}function dft(e){var t=e.group,a=t.units.length,i=at.create(e.structure);return Ln(1,a,1,function(s,u){var c=t.units[u];return i.unit=c,i.element=c.elements[s],i})}function fft(e,t,r){if(r===e.objectId){var s=t.group.units[e.instanceId];return Re(t.structure,[{unit:s,indices:Be.ofBounds(0,s.elements.length)}])}return Yr}function pft(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ye.areEquivalent(e.structure,t.structure))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var c=u[s],l=i.unitIndexMap.get(c.unit.id);void 0!==l&&Be.size(c.indices)===o&&r(xe.ofSingleton(l))&&(n=!0)}return n}var JU,ide={"orientation-ellipsoid-mesh":function(e,t){return va("Orientation ellipsoid mesh",e,t,uft)}},ode=R(R({},ade),{visuals:D.MultiSelect(["orientation-ellipsoid-mesh"],D.objectToOptions(ide)),bumpFrequency:D.Numeric(1,{min:0,max:10,step:.1},ot.ShadingCategory)}),vft={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:function mft(e,t){return dr.createMulti("Orientation",e,t,ho,ide)},getParams:function hft(e,t){return ode},defaultValues:D.getDefaultValues(ode),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},gft=qe.add3,yft=qe.add;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,c,l){gft(i,s,u,c),yft(o,l)},getPoints:function(){var s=qe.compact(i,!0),u=qe.compact(o,!0);return hm.create(s,u,i.elementCount,a)}}}}(JU||(JU={}));var sde=S.add,eV=R(R({},rnt),{pointSizeAttenuation:D.Boolean(!1),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),traceOnly:D.Boolean(!1),stride:D.Numeric(1,{min:1,max:100,step:1})});function bft(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return hm.createEmpty(i);var s=t.elements,u=s.length,c=JU.create(u,u/10,i),l=S(),d=t.conformation.invariantPosition,f=Ng(r,t,a),p=S(),h=0;if(f)for(var m=0;m<u;++m)f(s[m])||(d(s[m],l),sde(p,p,l),h+=1,c.add(l[0],l[1],l[2],m));else for(m=0;m<u;++m)d(s[m],l),sde(p,p,l),h+=1,c.add(l[0],l[1],l[2],m);var y,v=i?De.clone(i.boundingSphere):void 0,g=c.getPoints();return 0===h||(S.scale(p,p,1/h),y=v&&S.distance(p,v.center)/v.radius<.1?v:De.expand(De(),t.boundary.sphere,1*a.sizeFactor),g.setBoundingSphere(y)),g}function ude(e){return function nnt(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:hm.Utils}),t)}({defaultProps:D.getDefaultValues(eV),createGeometry:bft,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}var _ft={"element-point":function(e,t){return va("Points",e,t,ude)}},cde=R({},eV),xft={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:function Cft(e,t){return dr.createMulti("Point",e,t,ho,_ft)},getParams:function Sft(e,t){return cde},defaultValues:D.getDefaultValues(cde),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},lde={sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),linearSegments:D.Numeric(8,{min:1,max:48,step:1},ot.CustomQualityParamInfo),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo)},Gu=(D.getDefaultValues(lde),S());function wft(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=a.linearSegments,l=a.radialSegments,d=c*l*o+(l+1)*o*2,f=ft.createState(d,d/10,i),p=pU(c),h=p.curvePoints,m=p.normalVectors,v=p.binormalVectors,g=p.widthValues,y=p.heightValues,b=0,_=lU(t,r,{ignoreSecondaryStructure:!0});_.hasNext;){var C=_.move();f.currentGroup=b;var A=Zs(C.moleculeType)?RI:MI;hU(p,C,Pce,A);var T=C.coarseBackboneFirst||C.first,w=C.coarseBackboneLast||C.last,E=n.size.size(C.centerPrev)*s,I=n.size.size(C.center)*s,M=n.size.size(C.centerNext)*s;bU(p,E,I,M,E,I,M,A);var F=c;if(C.initial){var N=c-(F=Math.max(Math.round(c*A),1));h.copyWithin(0,3*N),v.copyWithin(0,3*N),m.copyWithin(0,3*N),g.copyWithin(0,3*N),y.copyWithin(0,3*N),S.fromArray(Gu,h,3),S.normalize(Gu,S.sub(Gu,C.p2,Gu)),S.scaleAndAdd(Gu,C.p2,Gu,I*OI),S.toArray(Gu,h,0)}else C.final&&(F=Math.max(Math.round(c*(1-A)),1),S.fromArray(Gu,h,3*F-3),S.normalize(Gu,S.sub(Gu,C.p2,Gu)),S.scaleAndAdd(Gu,C.p2,Gu,I*OI),S.toArray(Gu,h,3*F));!0===C.initial&&!0===C.final?$r(f,C.p2,2*I,u):2===l?a3(f,h,m,v,F,g,y,0):4===l?r3(f,h,m,v,F,g,y,0,T,w):LU(f,h,m,v,F,l,g,y,T,w,"elliptical"),++b}var j=ft.getMesh(f),k=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return j.setBoundingSphere(k),j}var dde=R(R({},po),lde);function Aft(e){return Xo({defaultProps:D.getDefaultValues(dde),createGeometry:wft,createLocationIterator:function(t){return ih.fromGroup(t,!0)},getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var u3,fde={"polymer-tube":function(e,t){return va("Polymer tube mesh",e,t,Aft)},"polymer-gap":function(e,t){return va("Polymer gap cylinder",e,t,OU)}},pde=R(R(R({},dde),$I),{sizeFactor:D.Numeric(.2,{min:0,max:10,step:.01}),visuals:D.MultiSelect(["polymer-tube","polymer-gap"],D.objectToOptions(fde)),bumpFrequency:D.Numeric(2,{min:0,max:10,step:.1},ot.ShadingCategory)}),Eft={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:function Dft(e,t){return dr.createMulti("Putty",e,t,ho,fde)},getParams:function Tft(e,t){var r=D.clone(pde),n=!1,a=!1;return t.units.forEach(function(i){!n&&Oe.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r},defaultValues:D.getDefaultValues(pde),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},hde={"element-sphere":function(e,t){return va("Sphere mesh/impostor",e,t,ace)},"structure-element-sphere":function(e,t){return Sc("Structure sphere mesh/impostor",e,t,gut)}},tV=R(R({},wI),{bumpFrequency:D.Numeric(1,{min:0,max:10,step:.1},ot.ShadingCategory),visuals:D.MultiSelect(["element-sphere"],D.objectToOptions(hde))}),Mft={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:function Pft(e,t){return dr.createMulti("Spacefill",e,t,ho,hde)},getParams:function Ift(e,t){return t.isCoarseGrained?(u3||((u3=D.clone(tV)).sizeFactor.defaultValue=2),u3):tV},defaultValues:D.getDefaultValues(tV),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},rV=Gr.is;function Rft(e,t,r,n,a,i){if(!Oe.isAtomic(t))return ca.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return ca.createEmpty(i);var u=at.create(r,t),c=t.elements,l=t.bonds,d=l.edgeCount,f=l.a,p=l.b,h=l.edgeProps,m=l.offset;if(!d)return ca.createEmpty(i);var v=h.order,g=h.flags,y=a.sizeFactor,b=a.aromaticBonds,C=a.excludeTypes,x=a.multipleBonds,A="off"===x,T="symmetric"===x,I=SI(Gr.fromNames(a.includeTypes),Gr.fromNames(C),32),M=S(),F=t.conformation.invariantPosition,N=t.rings,j=N.elementRingIndices,k=N.elementAromaticRingIndices,H=b?t.resonance.delocalizedTriplets:void 0,U=pse(0,{linkCount:2*d,referencePosition:function(ne){var X,L,Y=f[ne],$=p[ne],Z=H?.getThirdElement(Y,$);if(void 0!==Z)return F(c[Z],M);Y>$&&(Y=(X=[$,Y])[0],$=X[1]),m[Y+1]-m[Y]==1&&(Y=(L=[$,Y])[0],$=L[1]);for(var q=k.get(Y)||j.get(Y),z=0,te=m[Y],ae=m[Y+1];te<ae;++te){var fe=p[te];if(fe!==$&&fe!==Y){if(!q)return F(c[fe],M);var he=k.get(fe)||j.get(fe);if(!he)continue;var pe=eT(q,he);pe>z&&(z=pe,F(c[fe],M))}}return z>0?M:null},position:function(ne,X,L){F(c[f[L]],ne),F(c[p[L]],X)},style:function(ne){var X=v[ne],L=g[ne];if(rV(L,2)||rV(L,4))return 1;if(3===X)return A?0:T?4:5;if(b){var $=p[ne],Z=k.get(f[ne]),q=k.get($),z=Z&&q?eT(Z,q):0;if(rV(L,16)||z&&!I)return 2===z?8:7}return 2!==X||A?0:T?2:3},radius:function(ne){u.element=c[f[ne]];var X=n.size.size(u);u.element=c[p[ne]];var L=n.size.size(u);return Math.min(X,L)*y},ignore:Kue(r,t,a)},a,i),Q=U.lines,W=U.boundingSphere;if(W)Q.setBoundingSphere(W);else if(Q.lineCount>0){var K=De.expand(De(),(s??t).boundary.sphere,1*y);Q.setBoundingSphere(K)}return Q}var mde=R(R(R({},JE),V6),{includeParent:D.Boolean(!1)});function Oft(e){return eI({defaultProps:D.getDefaultValues(mde),createGeometry:Rft,createLocationIterator:Nm.fromGroup,getLoci:z6,eachLocation:G6,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Xs(r.includeTypes,n.includeTypes)||!Xs(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Oe.isAtomic(u)&&Oe.isAtomic(c)&&(Cu.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var nV=new Ht.ElementBondIterator;function vde(e,t,r,n){for(nV.setElement(t,r,n);nV.hasNext;){var a=nV.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function Fft(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges;if(!o)return ca.createEmpty(a);var u=n.sizeFactor,c=n.aromaticBonds,l=n.multipleBonds,d="off"===l,f="symmetric"===l,p=S(),h=at.create(),v=pse(0,{linkCount:o,referencePosition:function(C){var A,T,w,E,x=s[C];if(x.unitA<x.unitB)A=t.unitMap.get(x.unitA),T=t.unitMap.get(x.unitB),w=x.indexA,E=x.indexB;else{if(!(x.unitA>x.unitB))throw new Error("same units in createInterUnitBondLines");A=t.unitMap.get(x.unitB),T=t.unitMap.get(x.unitA),w=x.indexB,E=x.indexA}return vde(p,t,A,w)||vde(p,t,T,E)},position:function(C,x,A){var T=s[A],w=t.unitMap.get(T.unitA),E=t.unitMap.get(T.unitB);w.conformation.position(w.elements[T.indexA],C),E.conformation.position(E.elements[T.indexB],x)},style:function(C){var x=s[C].props.order,A=rs.create(s[C].props.flag);return Gr.is(A,2)||Gr.is(A,4)?1:3===x?d?0:f?4:5:c&&Gr.is(A,16)?7:2!==x||d?0:f?2:3},radius:function(C){var x=s[C];h.structure=t,h.unit=t.unitMap.get(x.unitA),h.element=h.unit.elements[x.indexA];var A=r.size.size(h);h.unit=t.unitMap.get(x.unitB),h.element=h.unit.elements[x.indexB];var T=r.size.size(h);return Math.min(A,T)*u},ignore:Zue(t,n)},n,a),g=v.lines,y=v.boundingSphere;if(y)g.setBoundingSphere(y);else if(g.lineCount>0){var b=t.child,_=De.expand(De(),(b??t).boundary.sphere,1*u);g.setBoundingSphere(_)}return g}var gde=R(R(R({},Yrt),V6),{includeParent:D.Boolean(!1)});function Nft(e){return function Xrt(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ca.Utils}),t)}({defaultProps:D.getDefaultValues(gde),createGeometry:Fft,createLocationIterator:Nm.fromStructure,getLoci:H6,eachLocation:q6,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Xs(r.includeTypes,n.includeTypes)||!Xs(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var C1=S.scaleAndAdd,yde=S.unitX,bde=S.unitY,_de=S.unitZ,Sde=R(R({},JE),{lineSizeAttenuation:D.Boolean(!1),ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),traceOnly:D.Boolean(!1),crosses:D.Select("lone",D.arrayToOptions(["lone","all"])),crossSize:D.Numeric(.35,{min:0,max:2,step:.01})});function kft(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return ca.createEmpty(i);for(var s=t.elements,u=s.length,c=Ru.create(u,u/10,i),l=S(),d=S(),f=S(),p=t.conformation.invariantPosition,h=Ng(r,t,a),m=a.crossSize/2,v="lone"===a.crosses,g=0;g<u;++g)h&&h(s[g])||v&&Oe.isAtomic(t)&&0!==gf(r,t,g)||(p(s[g],l),C1(d,l,yde,m),C1(f,l,yde,-m),c.add(d[0],d[1],d[2],f[0],f[1],f[2],g),C1(d,l,bde,m),C1(f,l,bde,-m),c.add(d[0],d[1],d[2],f[0],f[1],f[2],g),C1(d,l,_de,m),C1(f,l,_de,-m),c.add(d[0],d[1],d[2],f[0],f[1],f[2],g));var y=c.getLines(),b=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function Bft(e){return eI({defaultProps:D.getDefaultValues(Sde),createGeometry:kft,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var Cde={"intra-bond":function(e,t){return va("Intra-unit bond line",e,t,Oft)},"inter-bond":function(e,t){return Sc("Inter-unit bond line",e,t,Nft)},"element-point":function(e,t){return va("Points",e,t,ude)},"element-cross":function(e,t){return va("Crosses",e,t,Bft)}},aV=R(R(R(R(R({},mde),gde),eV),Sde),{pointStyle:D.Select("circle",D.objectToOptions(hm.StyleTypes)),multipleBonds:D.Select("offset",D.arrayToOptions(["off","symmetric","offset"])),includeParent:D.Boolean(!1),sizeFactor:D.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:wC(["atomic"]),visuals:D.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],D.objectToOptions(Cde))}),Vft={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:function Uft(e,t){return dr.createMulti("Line",e,t,ho,Cde)},getParams:function Lft(e,t){if(Ye.getSize(t)>=Ye.Size.Huge){var n=D.clone(aV);return n.visuals.defaultValue=["intra-bond","element-point","element-cross"],n}return aV},defaultValues:D.getDefaultValues(aV),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function zft(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,u,c,l,d,f,p,h,m,v,g,y;return le(this,function(b){switch(b.label){case 0:if(i=e.runtime,!(o=e.webgl)||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return[4,Cdt(t,r.size,n,o,a?a.gridTexture.ref.value:void 0).runInContext(i)];case 1:return u=b.sent(),c=u.transform,l=u.texture,d=u.bbox,f=u.gridDim,p={min:0,max:1,mean:.04,sigma:.01},h=me.mul(me(),c,me.fromScaling(me(),f)),m=me.getScaling(S(),c),v=S.create(0,1,2),g=mc.create(d,f,c,h,m,l,p,!0,v,a),y=De.expand(De(),t.boundary.sphere,u.maxRadius),g.setBoundingSphere(y),[2,g]}})})}var xde=R(R(R({},Qrt),QC),{ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),includeParent:D.Boolean(!1,{isHidden:!0})});function Gft(e){return function $rt(e,t){return Tg(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:mc.Utils}),t)}({defaultProps:D.getDefaultValues(xde),createGeometry:zft,createLocationIterator:mo.fromStructure,getLoci:Bg,eachLocation:kg,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function Hft(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,c,l,d,f,p,h,m,v,g,y,b;return le(this,function(_){switch(_.label){case 0:if(o=e.runtime,!(s=e.webgl))throw new Error("GaussianDensityVolume requires `webgl`");return[4,bdt(r,t,n.size,a,s,i?i.gridTexture.ref.value:void 0).runInContext(o)];case 1:return c=_.sent(),l=c.transform,d=c.texture,f=c.bbox,p=c.gridDim,h={min:0,max:1,mean:.04,sigma:.01},m=me.mul(me(),l,me.fromScaling(me(),p)),v=me.getScaling(S(),l),g=S.create(0,1,2),y=mc.create(f,p,l,m,v,d,h,!0,g,i),b=De.expand(De(),t.boundary.sphere,c.maxRadius),y.setBoundingSphere(b),[2,y]}})})}var jft=R(R(R({},ant),QC),{ignoreHydrogens:D.Boolean(!1),ignoreHydrogensVariant:D.Select("all",D.arrayToOptions(["all","non-polar"])),includeParent:D.Boolean(!1,{isHidden:!0})});function qft(e){return function int(e,t){return Im(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),Ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:mc.Utils}),t)}({defaultProps:D.getDefaultValues(jft),createGeometry:Hft,createLocationIterator:mo.fromGroup,getLoci:ld,eachLocation:cd,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var wde={"gaussian-volume":function(e,t){return Sc("Gaussian volume",e,t,Gft)},"units-gaussian-volume":function(e,t){return va("Units-Gaussian volume",e,t,qft)}},Ade=R(R({},xde),{jumpLength:D.Numeric(4,{min:0,max:20,step:.1}),visuals:D.MultiSelect(["gaussian-volume"],D.objectToOptions(wde))}),Xft={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:function Yft(e,t){return dr.createMulti("Gaussian Volume",e,t,ho,wde)},getParams:function Wft(e,t){return Ade},defaultValues:D.getDefaultValues(Ade),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},Kft=S.scale,Zft=S.add,Qft=S.sub,iV=R(R(R({},po),t6),{sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:D.Numeric(16,{min:2,max:56,step:2},ot.CustomQualityParamInfo),tryUseImpostor:D.Boolean(!0)});function $ft(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function ept(e){return r6({defaultProps:D.getDefaultValues(iV),createGeometry:Jft,createLocationIterator:ih.fromGroup,getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function rpt(e){return Xo({defaultProps:D.getDefaultValues(iV),createGeometry:tpt,createLocationIterator:ih.fromGroup,getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}function Jft(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return ou.createEmpty(i);var s=2*o,u=DC.create(s,s/4,i),c=t.conformation.invariantPosition,l=S(),d=S(),f=S();_ce(t,function(v,g,y,b,_){c(v,l),c(g,d);var x=Zs(_)?RI:MI;Zft(f,l,Kft(f,Qft(f,d,l),x)),u.add(l[0],l[1],l[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)});var h=u.getCylinders(),m=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(m),h}function tpt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);var s=a.radialSegments,u=a.sizeFactor,c=2*s*o*2,l=ft.createState(c,c/10,i),d=t.conformation.invariantPosition,f=S(),p=S(),h={radiusTop:1,radiusBottom:1,radialSegments:s},m=at.create(r,t),v=at.create(r,t);_ce(t,function(_,C,x,A,T){m.element=_,v.element=C,d(m.element,f),d(v.element,p);var E=Zs(T)?RI:MI;h.radiusTop=h.radiusBottom=n.size.size(m)*u,l.currentGroup=x,Hr(l,f,p,E,h),h.radiusTop=h.radiusBottom=n.size.size(v)*u,l.currentGroup=A,Hr(l,p,f,1-E,h)});var y=ft.getMesh(l),b=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}var oV=R(R(R({},po),J5),{sizeFactor:D.Numeric(.3,{min:0,max:10,step:.01}),detail:D.Numeric(0,{min:0,max:3,step:1},ot.CustomQualityParamInfo),tryUseImpostor:D.Boolean(!0)});function npt(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?function ipt(e){return e6({defaultProps:D.getDefaultValues(oV),createGeometry:apt,createLocationIterator:ih.fromGroup,getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function spt(e){return Xo({defaultProps:D.getDefaultValues(oV),createGeometry:opt,createLocationIterator:ih.fromGroup,getLoci:Ug,eachLocation:Vg,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}function apt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return ol.createEmpty(i);var s=Wb.create(o,o/2,i),u=t.conformation.invariantPosition,c=S();Sce(t,function(p,h){u(p,c),s.add(c[0],c[1],c[2],h)});var d=s.getSpheres(),f=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return d.setBoundingSphere(f),d}function opt(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);var s=a.detail,u=a.sizeFactor,c=o*ib(s),l=ft.createState(c,c/2,i),d=t.conformation.invariantPosition,f=S(),p=at.create(r,t);Sce(t,function(g,y){p.element=g,d(p.element,f),l.currentGroup=y,$r(l,f,n.size.size(p)*u,s)});var m=ft.getMesh(l),v=De.expand(De(),t.boundary.sphere,1*a.sizeFactor);return m.setBoundingSphere(v),m}var Tde={"polymer-backbone-cylinder":function(e,t){return va("Polymer backbone cylinder",e,t,$ft)},"polymer-backbone-sphere":function(e,t){return va("Polymer backbone sphere",e,t,npt)},"polymer-gap":function(e,t){return va("Polymer gap cylinder",e,t,OU)}},Dde=R(R(R(R({},oV),iV),$I),{sizeAspectRatio:D.Numeric(1,{min:.1,max:3,step:.1}),visuals:D.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],D.objectToOptions(Tde)),bumpFrequency:D.Numeric(0,{min:0,max:10,step:.1},ot.ShadingCategory)}),lpt={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:function cpt(e,t){return dr.createMulti("Backbone",e,t,ho,Tde)},getParams:function upt(e,t){var r=D.clone(Dde),n=!1;return t.units.forEach(function(a){!n&&a.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r},defaultValues:D.getDefaultValues(Dde),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},sV=function(e){function t(){var r=e.call(this)||this;return Ks(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return qt(t,e),t}(fae);!function(e){e.BuiltIn={cartoon:Ult,backbone:lpt,"ball-and-stick":Cut,carbohydrate:oct,ellipsoid:jlt,"gaussian-surface":Ldt,"gaussian-volume":Xft,label:Wdt,line:Vft,"molecular-surface":sft,orientation:vft,point:xft,putty:Eft,spacefill:Mft}}(sV||(sV={}));var dpt=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(da()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s;return le(this,function(c){switch(c.label){case 0:return[4,this.plugin.managers.animation.tick(t,r?.isSynchronous,r?.animation)];case 1:if(c.sent(),null===(n=this.plugin.canvas3d)||void 0===n||n.tick(t,r),Ct&&(i=null===(a=this.plugin.canvas3d)||void 0===a?void 0:a.webgl.timer.resolve()))for(o=0,s=i;o<s.length;o++)iee([s[o]]);return[2]}})})},e.prototype.resetTime=function(t){var r;void 0===t&&(t=da()),null===(r=this.plugin.canvas3d)||void 0===r||r.resetTime(t)},e.prototype.start=function(t){var r;null===(r=this.plugin.canvas3d)||void 0===r||r.resume(),this._isAnimating=!0,this.resetTime(),t?.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,void 0!==this.currentFrame&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t?.noDraw&&(null===(r=this.plugin.canvas3d)||void 0===r||r.pause(t?.noDraw))},e}(),uV=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=vD.create(new ve.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(ma.State.HistoryCapacity)}),n.behaviors=vD.create(new nn.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:nh(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:nh(n.data.events.cell.created,n.behaviors.events.cell.created),removed:nh(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:nh(n.data.events.object.created,n.behaviors.events.object.created),removed:nh(n.data.events.object.removed,n.behaviors.events.object.removed),updated:nh(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(R(R({},t.DefaultSnapshotParams),a))},n}return qt(t,e),Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=R(R({},this.snapshotParams.value),r);return{id:Gn.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:"animate"===(null===(n=i?.cameraTransition)||void 0===n?void 0:n.name)?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:null===(a=this.plugin.canvas3d)||void 0===a?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:i.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:i.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:i?.durationInMs}},t.prototype.setSnapshot=function(r){var n,a,i;return ce(this,void 0,void 0,function(){var o;return le(this,function(s){switch(s.label){case 0:return[4,this.animation.stop()];case 1:return s.sent(),!(null===(n=r.structureComponentManager)||void 0===n)&&n.options&&this.plugin.managers.structure.component._setSnapshotState(null===(a=r.structureComponentManager)||void 0===a?void 0:a.options),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:s.sent(),s.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:s.sent(),s.label=5;case 5:return null!==(i=r.canvas3d)&&void 0!==i&&i.props?(o=D.normalizeParams(uoe,r.canvas3d.props,"children"),[4,Sr.Canvas3D.SetSettings(this.plugin,{settings:o})]):[3,7];case 6:s.sent(),s.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(r.structureSelection),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&Sr.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:"animate"===r.camera.transitionStyle?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return Sr.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.hasBehavior=function(r){return this.behaviors.tree.transforms.has(r.id)},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to(nn.getCategoryId(r)).apply(r,OS(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){var n,a,i,o;nn.Behavior.is(r.obj)&&(null===(a=(n=r.obj.data).unregister)||void 0===a||a.call(n),null===(o=(i=r.obj.data).dispose)||void 0===o||o.call(i))}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(yC);!function(e){e.SnapshotParams={durationInMs:D.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:D.Boolean(!0),behavior:D.Boolean(!1),structureSelection:D.Boolean(!1),componentManager:D.Boolean(!0),animation:D.Boolean(!0),startAnimation:D.Boolean(!1),canvas3d:D.Boolean(!0),interactivity:D.Boolean(!0),camera:D.Boolean(!0),cameraTransition:D.MappedStatic("animate",{animate:D.Group({durationInMs:D.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:D.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:D.Boolean(!1)},e.DefaultSnapshotParams=D.getDefaultValues(e.SnapshotParams)}(uV||(uV={}));var fpt=function(){function e(t){var r=this;this.plugin=t,this.ev=bp.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(1!==n.size)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){void 0===r&&(r=!1);var n=this.root.get(t);if(n)return this.plugin.state.data.cells.get(r?n.ref:this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ve.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data))this.root.get(n.data).count++;else{var i=t.select(wr.Generators.byRef(r).rootOfType([ve.Molecule.Structure]))[0];this.root.set(n.data,i?{ref:i.transform.ref,count:1}:{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return!!ve.Molecule.Structure.is(a)&&(this.removeMapping(r),this.addMapping(t,r,a),!0)},e.prototype.dispose=function(){this.ev.dispose()},e}(),cV=function(){function e(){this.ev=bp.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var i=this.tryGetAbortTaskId(n[r]);if(void 0!==i)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);void 0!==o&&a.requestAbort(n.abortRequests.get(o))}var s=da()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:null===(i=n.options.get(r))||void 0===i?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return ce(this,void 0,void 0,function(){var n,a;return le(this,function(o){switch(o.label){case 0:n=this.id++,r?.createNewContext||0===this.currentContext.length?a={ctx:fEe(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1]).refCount++,o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!r?.useOverlay}),this.runningTasks.add(t.id),[4,oX(a.ctx,t)];case 2:return[2,o.sent()];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,0===a.refCount&&y2(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){this.abortRequests.set("number"==typeof t?t:t.root.progress.taskId,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();!function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}e.testTask=function r(n){var a=this;return Ve.create("Test",function(i){return ce(a,void 0,void 0,function(){var o;return le(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+200*Math.random())]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}}(cV||(cV={}));var ppt=function(e){function t(r){var n=e.call(this,{entries:Jc()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,Sr.Toast.Show.subscribe(r,function(a){return n.show(a)}),Sr.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return qt(t,e),t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var s,n=this,a=this.state.entries,i=void 0,o=++this.serialId;r.key&&(i=this.findByKey(r.key))?(void 0!==i.timeout&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next(void 0)},t.prototype.timeout=function(r,n){var a=this;if(void 0!==n)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){r&&(void 0!==r.timeout&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next(void 0))},t}(Zp),hpt=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=document.createElement("canvas"),n.previewCanvas=document.createElement("canvas"),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:dt(0),transparent:!1},n}return qt(t,e),t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:D.MappedStatic("viewport",{viewport:D.Group({}),hd:D.Group({}),"full-hd":D.Group({}),"ultra-hd":D.Group({}),custom:D.Group({width:D.Numeric(1920,{min:128,max:r,step:1}),height:D.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:D.Boolean(!1),axes:UE.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:(null===(r=this.plugin.canvas3d)||void 0===r?void 0:r.webgl.gl.drawingBufferWidth)||0,height:(null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=n.props.postprocessing.occlusion;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:R(R({},n.props.multiSample),{mode:r?"on":"off",sampleLevel:i&&o?4:2}),postprocessing:R(R({},n.props.postprocessing),{occlusion:"on"===s.name?{name:"on",params:R(R({},s.params),{samples:128,resolutionScale:n.webgl.pixelRatio})}:s}),marking:R({},n.props.marking)})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d,n=r.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:R(R({},r.props.postprocessing),{occlusion:"on"===n.name?{name:"on",params:R(R({},n.params),{samples:128,resolutionScale:r.webgl.pixelRatio})}:n}),marking:R({},r.props.marking)}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){void 0===r&&(r=".png");var n=this.plugin.state.data.select(wr.Generators.rootsOfType(ve.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=fa.toArray(a).join("-");return"".concat(i||"molstar-image").concat(r)},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(R(R({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(R(R({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return ia(r.x,0,1e-5)&&ia(r.y,0,1e-5)&&ia(r.width,1,1e-5)&&ia(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){void 0===r&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,c=i,l=0,d=o,f=0,p=0;p<o;p++)for(var h=p*i,m=0;m<i;m++){var v=4*(h+m);if(s){if(0===a[v+3])continue}else if((a[v]<<16|a[v+1]<<8|a[v+2]|a[v+3]<<24)===u)continue;m<c&&(c=m),m>l&&(l=m),p<d&&(d=p),p>f&&(f=p)}if(c>l){var y=c;c=l,l=y}d>f&&(y=d,d=f,f=y);var b=l-c+1,_=f-d+1;c-=r*b,l+=r*b,d-=r*_,f+=r*_;var C={x:Math.max(0,c/i),y:Math.max(0,d/o),width:Math.min(1,(l-c+1)/i),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(C)},t.prototype.getPreview=function(r){void 0===r&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var c=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:c.postprocessing,marking:c.marking});var l=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=l.width,d.height=l.height,this.previewData.image=l,this.previewData.background=c.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(l,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return le(this,function(d){switch(d.label){case 0:return n=this.getSizeAndViewport(),i=n.height,o=n.viewport,(a=n.width)<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return d.sent(),[4,(s=this.imagePass).updateBackground()];case 2:return d.sent(),u=s.getImageData(a,i,o),[4,r.update("Encoding image...")];case 3:if(d.sent(),(c=this.canvas).width=u.width,c.height=u.height,!(l=c.getContext("2d")))throw new Error("Could not create canvas 2d context");return l.putImageData(u,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(n?.write)return Ve.create("Copy Image",function(a){return ce(r,void 0,void 0,function(){var i,o;return le(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,i5(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})});this.plugin.log.error("clipboard.write not supported!")},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(Ve.create("Generate Image",function(n){return ce(r,void 0,void 0,function(){return le(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return Ve.create("Download Image",function(a){return ce(n,void 0,void 0,function(){return le(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,i5(this.canvas,"png")];case 3:return uie(o.sent(),r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(yC),mpt=function(){function e(t){this.plugin=t,this.handlers=[]}return e.prototype.addHandler=function(t,r){var n=this.handlers.findIndex(function(a){return a[0]===t});n<0?this.handlers.push([t,r]):this.handlers[n][1]=r},e.prototype.removeHandler=function(t){var r=this.handlers.findIndex(function(n){return n[0]===t});r>=0&&this.handlers.splice(r,1)},e.prototype.handle=function(t){return ce(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:r=this.handlers.length-1,i.label=1;case 1:return r>=0?[4,(0,this.handlers[r][1])(t,this.plugin)]:[3,4];case 2:if(i.sent())return[2];i.label=3;case 3:return r--,[3,1];case 4:return function vpt(e,t){var r=t.filter(function(n){var a=n.name.toLowerCase();return a.endsWith(".molx")||a.endsWith(".molj")});r.length>0?Sr.State.Snapshots.OpenFile(e,{file:r[0]}):e.runTask(e.state.data.applyAction(Hse,{files:t.map(function(n){return pn.File(n)}),format:{name:"auto",params:{}},visuals:!0}))}(this.plugin,t),[2]}})})},e.prototype.dispose=function(){this.handlers.length=0},e}(),gpt=function(){function e(t){var n,r=this;this.spec=t,this.runTask=function(a,i){return r.managers.task.run(a,i)},this.resolveTask=function(a){if(a)return Ve.is(a)?r.runTask(a):a},this.subs=[],this.initCanvas3dPromiseCallbacks=[function(){},function(){}],this._isInitialized=!1,this.initializedPromiseCallbacks=[function(){},function(){}],this.disposed=!1,this.canvasContainer=void 0,this.ev=bp.create(),this.config=new pQe(this.spec.config),this.state=new uV(this),this.commands=new eQe,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:dr.Loci.Empty,modifiers:bc.None,buttons:0,button:0}),click:this.ev.behavior({current:dr.Loci.Empty,modifiers:bc.None,buttons:0,button:0}),drag:this.ev.behavior({current:dr.Loci.Empty,modifiers:bc.None,buttons:0,button:0,pageStart:Ne(),pageEnd:Ne()}),key:this.ev.behavior(Iie),keyReleased:this.ev.behavior(Iie),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(Yf(function(a){return!!a}),yv(1))}},this.canvas3dInitialized=new Promise(function(a,i){r.initCanvas3dPromiseCallbacks=[a,i]}),this.initialized=new Promise(function(a,i){r.initializedPromiseCallbacks=[a,i]}),this.layout=new eut(this),this.animationLoop=new dpt(this),this.representation={structure:{registry:new sV,themes:{colorThemeRegistry:Nu.createRegistry(),sizeThemeRegistry:Ki.createRegistry()}},volume:{registry:new pI,themes:{colorThemeRegistry:Nu.createRegistry(),sizeThemeRegistry:Ki.createRegistry()}}},this.query={structure:{registry:new X7e}},this.dataFormats=new Kot,this.builders={data:new Dot(this),structure:void 0},this.helpers={substructureParent:new fpt(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new M6(this),component:new I6(this),measurement:new kst(this),selection:new Lst(this),focus:new gst(this)},volume:{hierarchy:new k6(this)},interactivity:void 0,camera:new dst(this),animation:new Zot(this),snapshot:new Eb(this),lociLabels:void 0,toast:new ppt(this),asset:new bNe,task:new cV,dragAndDrop:new mpt(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new vI.Registry,this.customStructureProperties=new vI.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:yp(),entry:function(a){return r.events.log.next(a)},error:function(a){return r.events.log.next(Qd.error(a))},message:function(a){return r.events.log.next(Qd.message(a))},info:function(a){return r.events.log.next(Qd.info(a))},warn:function(a){return r.events.log.next(Qd.warning(a))}},this.fetch=v4,VLe(!1),function wPe(e){np="default"===e?sK:xPe}(null!==(n=this.config.get(ma.Structure.SaccharideCompIdMapType))&&void 0!==n?n:"default")}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype.build=function(){return this.state.data.build()},e.prototype.initContainer=function(t){var r;if(this.canvasContainer)return!0;var n=document.createElement("div");Object.assign(n.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});var a=null===(r=t?.canvas3dContext)||void 0===r?void 0:r.canvas;return a||(a=document.createElement("canvas"),t?.checkeredCanvasBackground&&Object.assign(a.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}),n.appendChild(a)),!!this.initViewer(a,n,t?.canvas3dContext)&&(this.canvasContainer=n,!0)},e.prototype.mount=function(t,r){var n;if(this.disposed)throw new Error("Cannot mount a disposed context");return!!this.initContainer(r)&&(this.canvasContainer.parentElement!==t&&(null===(n=this.canvasContainer.parentElement)||void 0===n||n.removeChild(this.canvasContainer)),t.appendChild(this.canvasContainer),this.handleResize(),!0)},e.prototype.unmount=function(){var t,r;null===(r=null===(t=this.canvasContainer)||void 0===t?void 0:t.parentElement)||void 0===r||r.removeChild(this.canvasContainer)},e.prototype.initViewer=function(t,r,n){var i,o,s,u,c,l,d,a=this;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var f=!(null!==(i=this.config.get(ma.General.DisableAntialiasing))&&void 0!==i&&i),p=!(null!==(o=this.config.get(ma.General.DisablePreserveDrawingBuffer))&&void 0!==o&&o),h=this.config.get(ma.General.PixelScale)||1,m=this.config.get(ma.General.PickScale)||.25,v=null!==(s=this.config.get(ma.General.PickPadding))&&void 0!==s?s:1,g=this.config.get(ma.General.EnableWboit)||!1,y=this.config.get(ma.General.EnableDpoit)||!1,b=this.config.get(ma.General.PreferWebGl1)||!1,_=!(null!==(u=this.config.get(ma.General.AllowMajorPerformanceCaveat))&&void 0!==u&&u),C=this.config.get(ma.General.PowerPreference)||"high-performance";this.canvas3dContext=x5.fromCanvas(t,this.managers.asset,{antialias:f,preserveDrawingBuffer:p,pixelScale:h,pickScale:m,pickPadding:v,enableWboit:g,enableDpoit:y,preferWebGl1:b,failIfMajorPerformanceCaveat:_,powerPreference:C})}this.canvas3d=w5.create(this.canvas3dContext),this.canvas3dInit.next(!0);var x=this.spec.canvas3d,A=dt(16579577);return x?(void 0===(null===(l=x.renderer)||void 0===l?void 0:l.backgroundColor)&&(x=Gk(x,function(T){T.renderer?T.renderer.backgroundColor=A:T.renderer={backgroundColor:A}})),null===(d=this.canvas3d)||void 0===d||d.setProps(x)):null===(c=this.canvas3d)||void 0===c||c.setProps({renderer:{backgroundColor:A}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new hpt(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(T){return a.behaviors.interaction.click.next(T)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(T){return a.behaviors.interaction.drag.next(T)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(T){return a.behaviors.interaction.hover.next(T)})),this.subs.push(this.canvas3d.input.resize.pipe(bue(50),Yse(100,void 0,{leading:!1,trailing:!0})).subscribe(function(){return a.handleResize()})),this.subs.push(this.canvas3d.input.keyDown.subscribe(function(T){return a.behaviors.interaction.key.next(T)})),this.subs.push(this.canvas3d.input.keyUp.subscribe(function(T){return a.behaviors.interaction.keyReleased.next(T)})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),_2.setImmediate(function(){return a.initCanvas3dPromiseCallbacks[0]()}),!0}catch(T){return this.log.error(""+T),console.error(T),_2.setImmediate(function(){return a.initCanvas3dPromiseCallbacks[1](T)}),!1}},e.prototype.handleResize=function(){var t,r,n=null===(t=this.canvas3dContext)||void 0===t?void 0:t.canvas,a=this.layout.root;a&&n&&(function sQe(e,t,r){void 0===r&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),function oQe(e,t,r,n){void 0===n&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:"".concat(t,"px"),height:"".concat(r,"px")})}(e,n,a,r)}(n,a,this.config.get(ma.General.PixelScale)||1),null===(r=this.canvas3d)||void 0===r||r.requestResize())},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return void 0===t&&(t=!1),t&&(null===(r=this.canvas3d)||void 0===r||r.setProps(C5)),Sr.State.RemoveObject(this,{state:this.state.data,ref:ln.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++)i[a].unsubscribe();this.subs=[],this.animationLoop.stop(),this.commands.dispose(),null===(r=this.canvas3d)||void 0===r||r.dispose(),null===(n=this.canvas3dContext)||void 0===n||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),Ks(this.managers,function(s){var u;return null===(u=s?.dispose)||void 0===u?void 0:u.call(s)}),Ks(this.managers.structure,function(s){var u;return null===(u=s?.dispose)||void 0===u?void 0:u.call(s)}),Ks(this.managers.volume,function(s){var u;return null===(u=s?.dispose)||void 0===u?void 0:u.call(s)}),this.unmount(),this.canvasContainer=void 0,this.customState={},this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(nh(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(ma.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){void 0!==a&&clearTimeout(a),a=void 0};this.subs.push(nh(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){t.behaviors.state.isUpdating.value||t.behaviors.state.isAnimating.value?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||null===(u=t.managers.interactivity)||void 0===u||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;aI.State.registerDefault(this),aI.Representation.registerDefault(this),aI.Camera.registerDefault(this),aI.Misc.registerDefault(this),this.subs.push(nh(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c;return le(this,function(l){switch(l.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(nn.Categories);r<n.length;r++)c=n[r],t.toRoot().apply(nn.CreateCategory,{label:nn.Categories[c]},{ref:c,state:{isLocked:!0}});for(a=0,i=this.spec.behaviors;a<i.length;a++)"custom-props"===(c=nn.getCategoryId((u=i[a]).transformer))&&t.to(nn.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(l.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)"custom-props"!==(c=nn.getCategoryId((u=s[o]).transformer))&&t.to(nn.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return l.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++)this.managers.animation.register(r[t])},e.prototype.initDataActions=function(){if(this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++)this.state.data.actions.add(r[t].action)},e.prototype.init=function(){return ce(this,void 0,void 0,function(){var t,r=this;return le(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.subs.push(this.events.log.subscribe(function(a){return r.log.entries=r.log.entries.push(a)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new E6(this),this.managers.lociLabels=new fst(this),this.builders.structure=new Bot(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return n.sent(),this.log.message("Mol* Plugin ".concat("3.44.0"," [").concat(iQe.toLocaleString(),"]")),S2||this.log.message("Development mode enabled"),xr&&this.log.message("Debug mode enabled"),this._isInitialized=!0,this.initializedPromiseCallbacks[0](),[3,3];case 2:throw t=n.sent(),this.initializedPromiseCallbacks[1](t),t;case 3:return[2]}})})},e}();const ypt=["outer"],bpt=["inner"];function Spt(e,t){return function _pt(e,t){const r=Mi.getStructureSelection(e,t);return mt.toLociWithSourceUnits(r)}(de.struct.generator.atomGroups({"residue-test":de.core.set.has([de.set(...e),de.core.str.concat([de.ammp("auth_asym_id"),de.ammp("auth_seq_id"),de.ammp("pdbx_PDB_ins_code")])])}),t)}let xpt=(()=>{class e{get outer(){return this._outer.nativeElement}get inner(){return this._inner.nativeElement}set source(r){this.source$.next(r)}set loci(r){this.loci$.next(r)}constructor(){this.outer$=new Kf(1),this.source$=new Kf(1),this.loci$=new Kf(1),this.selected=new ts,this.highlighted=new ts,this.plugin$=this.initPlugin(),this.structure$=this.initStructure(),this.update$=this.updateRepresentation(),this._update=this.update$.subscribe()}initPlugin(){var r=this;const n={actions:[or.Action(Mg.Structure.DownloadStructure),or.Action(Mg.Volume.DownloadDensity),or.Action(Mg.DataFormat.DownloadFile),or.Action(Mg.DataFormat.OpenFiles),or.Action(Mg.Structure.LoadTrajectory),or.Action(Mg.Structure.EnableModelCustomProps),or.Action(Mg.Structure.EnableStructureCustomProps),or.Action(bot),or.Action(_ot),or.Action(mue),or.Action(et.Data.Download),or.Action(et.Data.ParseCif),or.Action(et.Data.ParseCcp4),or.Action(et.Data.ParseDsn6),or.Action(et.Model.TrajectoryFromMmCif),or.Action(et.Model.TrajectoryFromCifCore),or.Action(et.Model.TrajectoryFromPDB),or.Action(et.Model.TransformStructureConformation),or.Action(et.Model.StructureFromModel),or.Action(et.Model.StructureFromTrajectory),or.Action(et.Model.ModelFromTrajectory),or.Action(et.Model.StructureSelectionFromScript),or.Action(et.Representation.StructureRepresentation3D),or.Action(et.Representation.StructureSelectionsDistance3D),or.Action(et.Representation.StructureSelectionsAngle3D),or.Action(et.Representation.StructureSelectionsDihedral3D),or.Action(et.Representation.StructureSelectionsLabel3D),or.Action(et.Representation.StructureSelectionsOrientation3D),or.Action(et.Representation.ModelUnitcell3D),or.Action(et.Representation.StructureBoundingBox3D),or.Action(et.Representation.ExplodeStructureRepresentation3D),or.Action(et.Representation.SpinStructureRepresentation3D),or.Action(et.Representation.UnwindStructureAssemblyRepresentation3D),or.Action(et.Representation.OverpaintStructureRepresentation3DFromScript),or.Action(et.Representation.TransparencyStructureRepresentation3DFromScript),or.Action(et.Representation.ClippingStructureRepresentation3DFromScript),or.Action(et.Representation.SubstanceStructureRepresentation3DFromScript),or.Action(et.Representation.ThemeStrengthRepresentation3D),or.Action(Gse),or.Action(et.Volume.VolumeFromCcp4),or.Action(et.Volume.VolumeFromDsn6),or.Action(et.Volume.VolumeFromCube),or.Action(et.Volume.VolumeFromDx),or.Action(et.Representation.VolumeRepresentation3D)],behaviors:[or.Behavior(Lu.Representation.HighlightLoci),or.Behavior(Lu.Representation.SelectLoci),or.Behavior(Lu.Representation.DefaultLociLabelProvider),or.Behavior(Lu.Representation.FocusLoci),or.Behavior(Lu.Camera.FocusLoci),or.Behavior(Lu.Camera.CameraAxisHelper),or.Behavior(Lu.Camera.CameraControls),or.Behavior(oI),or.Behavior(Lu.CustomProps.StructureInfo),or.Behavior(Lu.CustomProps.AccessibleSurfaceArea),or.Behavior(Lu.CustomProps.BestDatabaseSequenceMapping),or.Behavior(Lu.CustomProps.Interactions),or.Behavior(Lu.CustomProps.SecondaryStructure),or.Behavior(Lu.CustomProps.ValenceModel),or.Behavior(Lu.CustomProps.CrossLinkRestraint)],animations:[nQe,rQe,Aot,aQe,tQe,wot,xot]};return this.outer$.pipe(Io(()=>no(lx(function*(){const a=new gpt(n);yield a.init();const{outer:i,inner:o}=r;if(!a.initViewer(o,i))throw new Error("Could not render the Mol* plugin");return r.plugin=a})())),Cv(1))}initStructure(){return this.plugin$.pipe(WF(this.source$),yr(([r,n])=>({plugin:r,source:n})),Io(({plugin:r,source:n})=>no(lx(function*(){const i=n.label,o=n.binary;if("local"===n.type){if("string"==typeof n.data)return r.builders.data.rawData({data:n.data,label:i});{let s;return s=n.data instanceof Blob?pn.File(new File([n.data],`${i}.${"mmcif"===n.format?"cif":"ent"}`)):pn.File(n.data),r.builders.data.readFile({file:s,label:i,isBinary:o})}}if("remote"===n.type){const s=pn.Url(n.link);return r.builders.data.download({url:s,label:n.label,isBinary:n.binary})}throw new Error("Given source data is not valid")})()).pipe(yr(i=>({data:i})),WF(Kr({plugin:r,source:n})),yr(([{data:i},{plugin:o,source:s}])=>({plugin:o,source:s,data:i})))),Io(({plugin:r,source:n,data:a})=>{const{label:i,format:o}=n;return no(lx(function*(){const s=yield r.builders.structure.parseTrajectory(a,o),u=yield r.builders.structure.createModel(s),c=yield r.builders.structure.createStructure(u,{name:"model",params:{}}),l=yield r.builders.structure.tryCreateComponentStatic(c,"polymer",{label:i});return yield r.builders.structure.representation.addRepresentation(l,{type:"cartoon",color:"uniform",colorParams:{value:dt(16777215)}}),c.cell?.obj?.data})())}),En(r=>{let n=0;const a=this.r2i=new Map,i=this.i2r=new Map;Ye.eachAtomicHierarchyElement(r,{residue:o=>{const s=it.residue.auth_seq_id(o),u=it.residue.pdbx_PDB_ins_code(o),l=(it.chain.auth_asym_id(o)+s+u).trim();a.set(l,n),i.set(n,l),n++}}),console.log("Residue to index",a),console.log("Index to residue",i)}),Cv(1))}updateRepresentation(){return this.structure$.pipe(WF(this.loci$),yr(([r,n])=>({structure:r,loci:n,plugin:this.plugin})),yr(({structure:r,loci:n,plugin:a})=>{const i=[...this.i2r.values()];return{structure:r,loci:n.map(s=>{const u=this.r2i.get(s.chain+s.start),c=this.r2i.get(s.chain+s.end);return{...s,ids:i.slice(u,c+1)}}),plugin:a}}),Io(({structure:r,loci:n,plugin:a})=>{const i=[];for(const{ids:u,color:c}of n){const l=Spt(u,r),d=en.fromLoci(l),f=dt.fromHexStyle(c||"#000000");i.push({bundle:d,color:f,clear:!1})}const o=a.state.data.build(),s=function Cpt(e,t){const r=Fi.ofBundle(e,t.root),n=Fi.merge(r);return Fi.filter(n,t)}(i,r);for(const u of a.managers.structure.hierarchy.current.structures)for(const c of u.components)for(const l of c.representations)o.to(l.cell.transform.ref).apply(et.Representation.OverpaintStructureRepresentation3DFromBundle,Fi.toBundle(s));return no(o.commit({doNotUpdateCurrent:!0}))}),yr(()=>{}))}ngAfterViewInit(){this.outer$.next(this.outer)}ngOnDestroy(){this._update.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=yh({type:e,selectors:[["ngx-structure-viewer"]],viewQuery:function(n,a){if(1&n&&(Ww(ypt,5),Ww(bpt,5)),2&n){let i;N_(i=k_())&&(a._outer=i.first),N_(i=k_())&&(a._inner=i.first)}},inputs:{source:"source",loci:"loci"},outputs:{selected:"selected",highlighted:"highlighted"},standalone:!0,features:[hv],decls:4,vars:0,consts:[[2,"position","relative","width","100%","height","100%"],["outer",""],[2,"position","absolute","left","0","top","0","width","100%","height","100%"],["inner",""]],template:function(n,a){1&n&&(fi(0,"div",0,1),Zu(2,"canvas",2,3),Ci())}})}return e})(),wpt=(()=>{class e{constructor(){this.source={type:"remote",binary:!1,label:"1CU4",link:"https://files.rcsb.org/view/1CU4.cif",format:"mmcif"},this.loci=[{start:"1",end:"10",chain:"L",color:"#ff0000"},{start:"11",end:"20",chain:"L",color:"#00ff00"},{start:"21",end:"30",chain:"L",color:"#0000ff"}]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=yh({type:e,selectors:[["app-page-structure-viewer"]],standalone:!0,features:[hv],decls:16,vars:8,consts:[[2,"display","block","height","600px","width","600px"],[3,"source","loci"]],template:function(n,a){1&n&&(fi(0,"div")(1,"h1"),Ra(2,"Structure viewer"),Ci(),fi(3,"p"),Ra(4," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam ut elit ac sapien sagittis semper a egestas sem. Nulla sodales, nibh sit amet congue pharetra, mi ipsum placerat erat, vel suscipit mi urna id massa. Praesent venenatis nisl sed leo commodo scelerisque. Cras tempus posuere justo et imperdiet. Nulla facilisis nulla malesuada, ultrices libero vitae, lacinia lorem. Nam gravida tempus ultricies. Integer hendrerit neque mauris, in dapibus sapien egestas et. Nunc ut vehicula nunc. Ut malesuada nulla erat, id ornare turpis faucibus sit amet. Vestibulum congue volutpat ultricies. "),Ci()(),fi(5,"div")(6,"h2"),Ra(7,"Try it out"),Ci(),fi(8,"code"),Ra(9),L_(10,"json"),Zu(11,"br"),Ra(12),L_(13,"json"),Ci(),fi(14,"div",0),Zu(15,"ngx-structure-viewer",1),Ci()()),2&n&&(Ph(9),Oh(" const source = ",U_(10,4,a.source),""),Ph(3),Oh(" const loci = ",U_(13,6,a.loci)," "),Ph(3),Bw("source",a.source)("loci",a.loci))},dependencies:[QO,XO,xpt]})}return e})();function Apt(e){return e}function Tpt(e){return"translate("+e+",0)"}function Dpt(e){return"translate(0,"+e+")"}function Ept(e){return t=>+e(t)}function Ipt(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),r=>+e(r)+t}function Ppt(){return!this.__axis}function d3(e,t){var r=[],n=null,a=null,i=6,o=6,s=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=1===e||4===e?-1:1,l=4===e||2===e?"x":"y",d=1===e||3===e?Tpt:Dpt;function f(p){var h=n??(t.ticks?t.ticks.apply(t,r):t.domain()),m=a??(t.tickFormat?t.tickFormat.apply(t,r):Apt),v=Math.max(i,0)+s,g=t.range(),y=+g[0]+u,b=+g[g.length-1]+u,_=(t.bandwidth?Ipt:Ept)(t.copy(),u),C=p.selection?p.selection():p,x=C.selectAll(".domain").data([null]),A=C.selectAll(".tick").data(h,t).order(),T=A.exit(),w=A.enter().append("g").attr("class","tick"),E=A.select("line"),I=A.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),A=A.merge(w),E=E.merge(w.append("line").attr("stroke","currentColor").attr(l+"2",c*i)),I=I.merge(w.append("text").attr("fill","currentColor").attr(l,c*v).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),p!==C&&(x=x.transition(p),A=A.transition(p),E=E.transition(p),I=I.transition(p),T=T.transition(p).attr("opacity",1e-6).attr("transform",function(M){return isFinite(M=_(M))?d(M+u):this.getAttribute("transform")}),w.attr("opacity",1e-6).attr("transform",function(M){var F=this.parentNode.__axis;return d((F&&isFinite(F=F(M))?F:_(M))+u)})),T.remove(),x.attr("d",4===e||2===e?o?"M"+c*o+","+y+"H"+u+"V"+b+"H"+c*o:"M"+u+","+y+"V"+b:o?"M"+y+","+c*o+"V"+u+"H"+b+"V"+c*o:"M"+y+","+u+"H"+b),A.attr("opacity",1).attr("transform",function(M){return d(_(M)+u)}),E.attr(l+"2",c*i),I.attr(l,c*v).text(m),C.filter(Ppt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),C.each(function(){this.__axis=_})}return f.scale=function(p){return arguments.length?(t=p,f):t},f.ticks=function(){return r=Array.from(arguments),f},f.tickArguments=function(p){return arguments.length?(r=null==p?[]:Array.from(p),f):r.slice()},f.tickValues=function(p){return arguments.length?(n=null==p?null:Array.from(p),f):n&&n.slice()},f.tickFormat=function(p){return arguments.length?(a=p,f):a},f.tickSize=function(p){return arguments.length?(i=o=+p,f):i},f.tickSizeInner=function(p){return arguments.length?(i=+p,f):i},f.tickSizeOuter=function(p){return arguments.length?(o=+p,f):o},f.tickPadding=function(p){return arguments.length?(s=+p,f):s},f.offset=function(p){return arguments.length?(u=+p,f):u},f}function Rpt(){}function dV(e){return null==e?Rpt:function(){return this.querySelector(e)}}function Npt(){return[]}function Ide(e){return null==e?Npt:function(){return this.querySelectorAll(e)}}function Pde(e){return function(){return this.matches(e)}}function Mde(e){return function(t){return t.matches(e)}}var Lpt=Array.prototype.find;function Vpt(){return this.firstElementChild}var Gpt=Array.prototype.filter;function Hpt(){return Array.from(this.children)}function Rde(e){return new Array(e.length)}function f3(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Kpt(e,t,r,n,a,i){for(var s,o=0,u=t.length,c=i.length;o<c;++o)(s=t[o])?(s.__data__=i[o],n[o]=s):r[o]=new f3(e,i[o]);for(;o<u;++o)(s=t[o])&&(a[o]=s)}function Zpt(e,t,r,n,a,i,o){var s,u,p,c=new Map,l=t.length,d=i.length,f=new Array(l);for(s=0;s<l;++s)(u=t[s])&&(f[s]=p=o.call(u,u.__data__,s,t)+"",c.has(p)?a[s]=u:c.set(p,u));for(s=0;s<d;++s)p=o.call(e,i[s],s,i)+"",(u=c.get(p))?(n[s]=u,u.__data__=i[s],c.delete(p)):r[s]=new f3(e,i[s]);for(s=0;s<l;++s)(u=t[s])&&c.get(f[s])===u&&(a[s]=u)}function Qpt(e){return e.__data__}function Jpt(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function iht(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}f3.prototype={constructor:f3,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var fV="http://www.w3.org/1999/xhtml";const Ode={svg:"http://www.w3.org/2000/svg",xhtml:fV,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function p3(e){var t=e+="",r=t.indexOf(":");return r>=0&&"xmlns"!==(t=e.slice(0,r))&&(e=e.slice(r+1)),Ode.hasOwnProperty(t)?{space:Ode[t],local:e}:e}function fht(e){return function(){this.removeAttribute(e)}}function pht(e){return function(){this.removeAttributeNS(e.space,e.local)}}function hht(e,t){return function(){this.setAttribute(e,t)}}function mht(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function vht(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttribute(e):this.setAttribute(e,r)}}function ght(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Fde(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function bht(e){return function(){this.style.removeProperty(e)}}function _ht(e,t,r){return function(){this.style.setProperty(e,t,r)}}function Sht(e,t,r){return function(){var n=t.apply(this,arguments);null==n?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function x1(e,t){return e.style.getPropertyValue(t)||Fde(e).getComputedStyle(e,null).getPropertyValue(t)}function xht(e){return function(){delete this[e]}}function wht(e,t){return function(){this[e]=t}}function Aht(e,t){return function(){var r=t.apply(this,arguments);null==r?delete this[e]:this[e]=r}}function Nde(e){return e.trim().split(/^|\s+/)}function pV(e){return e.classList||new kde(e)}function kde(e){this._node=e,this._names=Nde(e.getAttribute("class")||"")}function Bde(e,t){for(var r=pV(e),n=-1,a=t.length;++n<a;)r.add(t[n])}function Lde(e,t){for(var r=pV(e),n=-1,a=t.length;++n<a;)r.remove(t[n])}function Dht(e){return function(){Bde(this,e)}}function Eht(e){return function(){Lde(this,e)}}function Iht(e,t){return function(){(t.apply(this,arguments)?Bde:Lde)(this,e)}}function Mht(){this.textContent=""}function Rht(e){return function(){this.textContent=e}}function Oht(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Nht(){this.innerHTML=""}function kht(e){return function(){this.innerHTML=e}}function Bht(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Uht(){this.nextSibling&&this.parentNode.appendChild(this)}function zht(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Hht(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===fV&&t.documentElement.namespaceURI===fV?t.createElement(e):t.createElementNS(r,e)}}function jht(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function hV(e){var t=p3(e);return(t.local?jht:Hht)(t)}function Wht(){return null}function Xht(){var e=this.parentNode;e&&e.removeChild(this)}function Zht(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Qht(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function rmt(e){return function(){var t=this.__on;if(t){for(var i,r=0,n=-1,a=t.length;r<a;++r)i=t[r],e.type&&i.type!==e.type||i.name!==e.name?t[++n]=i:this.removeEventListener(i.type,i.listener,i.options);++n?t.length=n:delete this.__on}}}function nmt(e,t,r){return function(){var a,n=this.__on,i=function emt(e){return function(t){e.call(this,t,this.__data__)}}(t);if(n)for(var o=0,s=n.length;o<s;++o)if((a=n[o]).type===e.type&&a.name===e.name)return this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=i,a.options=r),void(a.value=t);this.addEventListener(e.type,i,r),a={type:e.type,name:e.name,value:t,listener:i,options:r},n?n.push(a):this.__on=[a]}}function Ude(e,t,r){var n=Fde(e),a=n.CustomEvent;"function"==typeof a?a=new a(t,r):(a=n.document.createEvent("Event"),r?(a.initEvent(t,r.bubbles,r.cancelable),a.detail=r.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function imt(e,t){return function(){return Ude(this,e,t)}}function omt(e,t){return function(){return Ude(this,e,t.apply(this,arguments))}}kde.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Vde=[null];function Ac(e,t){this._groups=e,this._parents=t}function zde(){return new Ac([[document.documentElement]],Vde)}Ac.prototype=zde.prototype={constructor:Ac,select:function Opt(e){"function"!=typeof e&&(e=dV(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var u,c,i=t[a],o=i.length,s=n[a]=new Array(o),l=0;l<o;++l)(u=i[l])&&(c=e.call(u,u.__data__,l,i))&&("__data__"in u&&(c.__data__=u.__data__),s[l]=c);return new Ac(n,this._parents)},selectAll:function Bpt(e){e="function"==typeof e?function kpt(e){return function(){return function Fpt(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):Ide(e);for(var t=this._groups,r=t.length,n=[],a=[],i=0;i<r;++i)for(var u,o=t[i],s=o.length,c=0;c<s;++c)(u=o[c])&&(n.push(e.call(u,u.__data__,c,o)),a.push(u));return new Ac(n,a)},selectChild:function zpt(e){return this.select(null==e?Vpt:function Upt(e){return function(){return Lpt.call(this.children,e)}}("function"==typeof e?e:Mde(e)))},selectChildren:function qpt(e){return this.selectAll(null==e?Hpt:function jpt(e){return function(){return Gpt.call(this.children,e)}}("function"==typeof e?e:Mde(e)))},filter:function Wpt(e){"function"!=typeof e&&(e=Pde(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var u,i=t[a],o=i.length,s=n[a]=[],c=0;c<o;++c)(u=i[c])&&e.call(u,u.__data__,c,i)&&s.push(u);return new Ac(n,this._parents)},data:function $pt(e,t){if(!arguments.length)return Array.from(this,Qpt);var r=t?Zpt:Kpt,n=this._parents,a=this._groups;"function"!=typeof e&&(e=function Xpt(e){return function(){return e}}(e));for(var i=a.length,o=new Array(i),s=new Array(i),u=new Array(i),c=0;c<i;++c){var l=n[c],d=a[c],f=d.length,p=Jpt(e.call(l,l&&l.__data__,c,n)),h=p.length,m=s[c]=new Array(h),v=o[c]=new Array(h);r(l,d,m,v,u[c]=new Array(f),p,t);for(var _,C,y=0,b=0;y<h;++y)if(_=m[y]){for(y>=b&&(b=y+1);!(C=v[b])&&++b<h;);_._next=C||null}}return(o=new Ac(o,n))._enter=s,o._exit=u,o},enter:function Ypt(){return new Ac(this._enter||this._groups.map(Rde),this._parents)},exit:function eht(){return new Ac(this._exit||this._groups.map(Rde),this._parents)},join:function tht(e,t,r){var n=this.enter(),a=this,i=this.exit();return"function"==typeof e?(n=e(n))&&(n=n.selection()):n=n.append(e+""),null!=t&&(a=t(a))&&(a=a.selection()),null==r?i.remove():r(i),n&&a?n.merge(a).order():a},merge:function rht(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,a=r.length,o=Math.min(a,n.length),s=new Array(a),u=0;u<o;++u)for(var p,c=r[u],l=n[u],d=c.length,f=s[u]=new Array(d),h=0;h<d;++h)(p=c[h]||l[h])&&(f[h]=p);for(;u<a;++u)s[u]=r[u];return new Ac(s,this._parents)},selection:function cmt(){return this},order:function nht(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var o,n=e[t],a=n.length-1,i=n[a];--a>=0;)(o=n[a])&&(i&&4^o.compareDocumentPosition(i)&&i.parentNode.insertBefore(o,i),i=o);return this},sort:function aht(e){function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}e||(e=iht);for(var r=this._groups,n=r.length,a=new Array(n),i=0;i<n;++i){for(var c,o=r[i],s=o.length,u=a[i]=new Array(s),l=0;l<s;++l)(c=o[l])&&(u[l]=c);u.sort(t)}return new Ac(a,this._parents).order()},call:function oht(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function sht(){return Array.from(this)},node:function uht(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],a=0,i=n.length;a<i;++a){var o=n[a];if(o)return o}return null},size:function cht(){let e=0;for(const t of this)++e;return e},empty:function lht(){return!this.node()},each:function dht(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var s,a=t[r],i=0,o=a.length;i<o;++i)(s=a[i])&&e.call(s,s.__data__,i,a);return this},attr:function yht(e,t){var r=p3(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((null==t?r.local?pht:fht:"function"==typeof t?r.local?ght:vht:r.local?mht:hht)(r,t))},style:function Cht(e,t,r){return arguments.length>1?this.each((null==t?bht:"function"==typeof t?Sht:_ht)(e,t,r??"")):x1(this.node(),e)},property:function Tht(e,t){return arguments.length>1?this.each((null==t?xht:"function"==typeof t?Aht:wht)(e,t)):this.node()[e]},classed:function Pht(e,t){var r=Nde(e+"");if(arguments.length<2){for(var n=pV(this.node()),a=-1,i=r.length;++a<i;)if(!n.contains(r[a]))return!1;return!0}return this.each(("function"==typeof t?Iht:t?Dht:Eht)(r,t))},text:function Fht(e){return arguments.length?this.each(null==e?Mht:("function"==typeof e?Oht:Rht)(e)):this.node().textContent},html:function Lht(e){return arguments.length?this.each(null==e?Nht:("function"==typeof e?Bht:kht)(e)):this.node().innerHTML},raise:function Vht(){return this.each(Uht)},lower:function Ght(){return this.each(zht)},append:function qht(e){var t="function"==typeof e?e:hV(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function Yht(e,t){var r="function"==typeof e?e:hV(e),n=null==t?Wht:"function"==typeof t?t:dV(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function Kht(){return this.each(Xht)},clone:function $ht(e){return this.select(e?Qht:Zht)},datum:function Jht(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function amt(e,t,r){var a,o,n=function tmt(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}(e+""),i=n.length;if(!(arguments.length<2)){for(s=t?nmt:rmt,a=0;a<i;++a)this.each(s(n[a],t,r));return this}var s=this.node().__on;if(s)for(var l,u=0,c=s.length;u<c;++u)for(a=0,l=s[u];a<i;++a)if((o=n[a]).type===l.type&&o.name===l.name)return l.value},dispatch:function smt(e,t){return this.each(("function"==typeof t?omt:imt)(e,t))},[Symbol.iterator]:function*umt(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var o,n=e[t],a=0,i=n.length;a<i;++a)(o=n[a])&&(yield o)}};const ex=zde;var lmt={value:()=>{}};function Gde(){for(var n,e=0,t=arguments.length,r={};e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new h3(r)}function h3(e){this._=e}function fmt(e,t){for(var a,r=0,n=e.length;r<n;++r)if((a=e[r]).name===t)return a.value}function Hde(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n].name===t){e[n]=lmt,e=e.slice(0,n).concat(e.slice(n+1));break}return null!=r&&e.push({name:t,value:r}),e}h3.prototype=Gde.prototype={constructor:h3,on:function(e,t){var a,r=this._,n=function dmt(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",a=r.indexOf(".");if(a>=0&&(n=r.slice(a+1),r=r.slice(0,a)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}(e+"",r),i=-1,o=n.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++i<o;)if(a=(e=n[i]).type)r[a]=Hde(r[a],e.name,t);else if(null==t)for(a in r)r[a]=Hde(r[a],e.name,null);return this}for(;++i<o;)if((a=(e=n[i]).type)&&(a=fmt(r[a],e.name)))return a},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new h3(e)},call:function(e,t){if((a=arguments.length-2)>0)for(var a,i,r=new Array(a),n=0;n<a;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(n=0,a=(i=this._[e]).length;n<a;++n)i[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],a=0,i=n.length;a<i;++a)n[a].value.apply(t,r)}};const jde=Gde;var m3,nx,w1=0,tx=0,rx=0,qde=1e3,v3=0,Qg=0,g3=0,ax="object"==typeof performance&&performance.now?performance:Date,Wde="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function mV(){return Qg||(Wde(pmt),Qg=ax.now()+g3)}function pmt(){Qg=0}function y3(){this._call=this._time=this._next=null}function Yde(e,t,r){var n=new y3;return n.restart(e,t,r),n}function Xde(){Qg=(v3=ax.now())+g3,w1=tx=0;try{!function hmt(){mV(),++w1;for(var t,e=m3;e;)(t=Qg-e._time)>=0&&e._call.call(void 0,t),e=e._next;--w1}()}finally{w1=0,function vmt(){for(var e,r,t=m3,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:m3=r);nx=e,vV(n)}(),Qg=0}}function mmt(){var e=ax.now(),t=e-v3;t>qde&&(g3-=t,v3=e)}function vV(e){w1||(tx&&(tx=clearTimeout(tx)),e-Qg>24?(e<1/0&&(tx=setTimeout(Xde,e-ax.now()-g3)),rx&&(rx=clearInterval(rx))):(rx||(v3=ax.now(),rx=setInterval(mmt,qde)),w1=1,Wde(Xde)))}function Kde(e,t,r){var n=new y3;return n.restart(a=>{n.stop(),e(a+t)},t=null==t?0:+t,r),n}y3.prototype=Yde.prototype={constructor:y3,restart:function(e,t,r){if("function"!=typeof e)throw new TypeError("callback is not a function");r=(null==r?mV():+r)+(null==t?0:+t),!this._next&&nx!==this&&(nx?nx._next=this:m3=this,nx=this),this._call=e,this._time=r,vV()},stop:function(){this._call&&(this._call=null,this._time=1/0,vV())}};var gmt=jde("start","end","cancel","interrupt"),ymt=[],Zde=0,gV=2,b3=3,yV=5,_3=6;function S3(e,t,r,n,a,i){var o=e.__transition;if(o){if(r in o)return}else e.__transition={};!function bmt(e,t,r){var a,n=e.__transition;function o(c){var l,d,f,p;if(1!==r.state)return u();for(l in n)if((p=n[l]).name===r.name){if(p.state===b3)return Kde(o);4===p.state?(p.state=_3,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete n[l]):+l<t&&(p.state=_3,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete n[l])}if(Kde(function(){r.state===b3&&(r.state=4,r.timer.restart(s,r.delay,r.time),s(c))}),r.state=gV,r.on.call("start",e,e.__data__,r.index,r.group),r.state===gV){for(r.state=b3,a=new Array(f=r.tween.length),l=0,d=-1;l<f;++l)(p=r.tween[l].value.call(e,e.__data__,r.index,r.group))&&(a[++d]=p);a.length=d+1}}function s(c){for(var l=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(u),r.state=yV,1),d=-1,f=a.length;++d<f;)a[d].call(e,l);r.state===yV&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){for(var c in r.state=_3,r.timer.stop(),delete n[t],n)return;delete e.__transition}n[t]=r,r.timer=Yde(function i(c){r.state=1,r.timer.restart(o,r.delay,r.time),r.delay<=c&&o(c-r.delay)},0,r.time)}(e,r,{name:t,index:n,group:a,on:gmt,tween:ymt,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Zde})}function bV(e,t){var r=hd(e,t);if(r.state>Zde)throw new Error("too late; already scheduled");return r}function If(e,t){var r=hd(e,t);if(r.state>b3)throw new Error("too late; already running");return r}function hd(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function C3(e,t){var n,a,o,r=e.__transition,i=!0;if(r){for(o in t=null==t?null:t+"",r)(n=r[o]).name===t?(a=n.state>gV&&n.state<yV,n.state=_3,n.timer.stop(),n.on.call(a?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]):i=!1;i&&delete e.__transition}}function md(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var x3,Jde=180/Math.PI,_V={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function efe(e,t,r,n,a,i){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(s=Math.sqrt(r*r+n*n))&&(r/=s,n/=s,u/=s),e*n<t*r&&(e=-e,t=-t,u=-u,o=-o),{translateX:a,translateY:i,rotate:Math.atan2(t,e)*Jde,skewX:Math.atan(u)*Jde,scaleX:o,scaleY:s}}function tfe(e,t,r,n){function a(c){return c.length?c.pop()+" ":""}return function(c,l){var d=[],f=[];return c=e(c),l=e(l),function i(c,l,d,f,p,h){if(c!==d||l!==f){var m=p.push("translate(",null,t,null,r);h.push({i:m-4,x:md(c,d)},{i:m-2,x:md(l,f)})}else(d||f)&&p.push("translate("+d+t+f+r)}(c.translateX,c.translateY,l.translateX,l.translateY,d,f),function o(c,l,d,f){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),f.push({i:d.push(a(d)+"rotate(",null,n)-2,x:md(c,l)})):l&&d.push(a(d)+"rotate("+l+n)}(c.rotate,l.rotate,d,f),function s(c,l,d,f){c!==l?f.push({i:d.push(a(d)+"skewX(",null,n)-2,x:md(c,l)}):l&&d.push(a(d)+"skewX("+l+n)}(c.skewX,l.skewX,d,f),function u(c,l,d,f,p,h){if(c!==d||l!==f){var m=p.push(a(p)+"scale(",null,",",null,")");h.push({i:m-4,x:md(c,d)},{i:m-2,x:md(l,f)})}else(1!==d||1!==f)&&p.push(a(p)+"scale("+d+","+f+")")}(c.scaleX,c.scaleY,l.scaleX,l.scaleY,d,f),c=l=null,function(p){for(var v,h=-1,m=f.length;++h<m;)d[(v=f[h]).i]=v.x(p);return d.join("")}}}var xmt=tfe(function Smt(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?_V:efe(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),wmt=tfe(function Cmt(e){return null!=e&&(x3||(x3=document.createElementNS("http://www.w3.org/2000/svg","g")),x3.setAttribute("transform",e),e=x3.transform.baseVal.consolidate())?efe((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):_V},", ",")",")");function Amt(e,t){var r,n;return function(){var a=If(this,e),i=a.tween;if(i!==r)for(var o=0,s=(n=r=i).length;o<s;++o)if(n[o].name===t){(n=n.slice()).splice(o,1);break}a.tween=n}}function Tmt(e,t,r){var n,a;if("function"!=typeof r)throw new Error;return function(){var i=If(this,e),o=i.tween;if(o!==n){a=(n=o).slice();for(var s={name:t,value:r},u=0,c=a.length;u<c;++u)if(a[u].name===t){a[u]=s;break}u===c&&a.push(s)}i.tween=a}}function SV(e,t,r){var n=e._id;return e.each(function(){var a=If(this,n);(a.value||(a.value={}))[t]=r.apply(this,arguments)}),function(a){return hd(a,n).value[t]}}function CV(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function rfe(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function ix(){}var w3=1/.7,A1="\\s*([+-]?\\d+)\\s*",sx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Emt=/^#([0-9a-f]{3,8})$/,Imt=new RegExp(`^rgb\\(${A1},${A1},${A1}\\)$`),Pmt=new RegExp(`^rgb\\(${Pf},${Pf},${Pf}\\)$`),Mmt=new RegExp(`^rgba\\(${A1},${A1},${A1},${sx}\\)$`),Rmt=new RegExp(`^rgba\\(${Pf},${Pf},${Pf},${sx}\\)$`),Omt=new RegExp(`^hsl\\(${sx},${Pf},${Pf}\\)$`),Fmt=new RegExp(`^hsla\\(${sx},${Pf},${Pf},${sx}\\)$`),nfe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function afe(){return this.rgb().formatHex()}function ife(){return this.rgb().formatRgb()}function $g(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Emt.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?ofe(t):3===r?new Hu(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?A3(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?A3(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Imt.exec(e))?new Hu(t[1],t[2],t[3],1):(t=Pmt.exec(e))?new Hu(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Mmt.exec(e))?A3(t[1],t[2],t[3],t[4]):(t=Rmt.exec(e))?A3(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Omt.exec(e))?cfe(t[1],t[2]/100,t[3]/100,1):(t=Fmt.exec(e))?cfe(t[1],t[2]/100,t[3]/100,t[4]):nfe.hasOwnProperty(e)?ofe(nfe[e]):"transparent"===e?new Hu(NaN,NaN,NaN,0):null}function ofe(e){return new Hu(e>>16&255,e>>8&255,255&e,1)}function A3(e,t,r,n){return n<=0&&(e=t=r=NaN),new Hu(e,t,r,n)}function T3(e,t,r,n){return 1===arguments.length?function Bmt(e){return e instanceof ix||(e=$g(e)),e?new Hu((e=e.rgb()).r,e.g,e.b,e.opacity):new Hu}(e):new Hu(e,t,r,n??1)}function Hu(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function sfe(){return`#${e0(this.r)}${e0(this.g)}${e0(this.b)}`}function ufe(){const e=D3(this.opacity);return`${1===e?"rgb(":"rgba("}${Jg(this.r)}, ${Jg(this.g)}, ${Jg(this.b)}${1===e?")":`, ${e})`}`}function D3(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Jg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function e0(e){return((e=Jg(e))<16?"0":"")+e.toString(16)}function cfe(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new vd(e,t,r,n)}function lfe(e){if(e instanceof vd)return new vd(e.h,e.s,e.l,e.opacity);if(e instanceof ix||(e=$g(e)),!e)return new vd;if(e instanceof vd)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),i=Math.max(t,r,n),o=NaN,s=i-a,u=(i+a)/2;return s?(o=t===i?(r-n)/s+6*(r<n):r===i?(n-t)/s+2:(t-r)/s+4,s/=u<.5?i+a:2-i-a,o*=60):s=u>0&&u<1?0:o,new vd(o,s,u,e.opacity)}function vd(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function dfe(e){return(e=(e||0)%360)<0?e+360:e}function E3(e){return Math.max(0,Math.min(1,e||0))}function xV(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}function ffe(e,t,r,n,a){var i=e*e,o=i*e;return((1-3*e+3*i-o)*t+(4-6*i+3*o)*r+(1+3*e+3*i-3*o)*n+o*a)/6}CV(ix,$g,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:afe,formatHex:afe,formatHex8:function Nmt(){return this.rgb().formatHex8()},formatHsl:function kmt(){return lfe(this).formatHsl()},formatRgb:ife,toString:ife}),CV(Hu,T3,rfe(ix,{brighter(e){return e=null==e?w3:Math.pow(w3,e),new Hu(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new Hu(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Hu(Jg(this.r),Jg(this.g),Jg(this.b),D3(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:sfe,formatHex:sfe,formatHex8:function Lmt(){return`#${e0(this.r)}${e0(this.g)}${e0(this.b)}${e0(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ufe,toString:ufe})),CV(vd,function Umt(e,t,r,n){return 1===arguments.length?lfe(e):new vd(e,t,r,n??1)},rfe(ix,{brighter(e){return e=null==e?w3:Math.pow(w3,e),new vd(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new vd(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Hu(xV(e>=240?e-240:e+120,a,n),xV(e,a,n),xV(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new vd(dfe(this.h),E3(this.s),E3(this.l),D3(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=D3(this.opacity);return`${1===e?"hsl(":"hsla("}${dfe(this.h)}, ${100*E3(this.s)}%, ${100*E3(this.l)}%${1===e?")":`, ${e})`}`}}));const wV=e=>()=>e;function hfe(e,t){var r=t-e;return r?function pfe(e,t){return function(r){return e+r*t}}(e,r):wV(isNaN(e)?t:e)}const I3=function e(t){var r=function Hmt(e){return 1==(e=+e)?hfe:function(t,r){return r-t?function Gmt(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}(t,r,e):wV(isNaN(t)?r:t)}}(t);function n(a,i){var o=r((a=T3(a)).r,(i=T3(i)).r),s=r(a.g,i.g),u=r(a.b,i.b),c=hfe(a.opacity,i.opacity);return function(l){return a.r=o(l),a.g=s(l),a.b=u(l),a.opacity=c(l),a+""}}return n.gamma=e,n}(1);function mfe(e){return function(t){var o,s,r=t.length,n=new Array(r),a=new Array(r),i=new Array(r);for(o=0;o<r;++o)s=T3(t[o]),n[o]=s.r||0,a[o]=s.g||0,i[o]=s.b||0;return n=e(n),a=e(a),i=e(i),s.opacity=1,function(u){return s.r=n(u),s.g=a(u),s.b=i(u),s+""}}}mfe(function Vmt(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),a=e[n],i=e[n+1];return ffe((r-n/t)*t,n>0?e[n-1]:2*a-i,a,i,n<t-1?e[n+2]:2*i-a)}}),mfe(function zmt(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t);return ffe((r-n/t)*t,e[(n+t-1)%t],e[n%t],e[(n+1)%t],e[(n+2)%t])}});var AV=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,TV=new RegExp(AV.source,"g");function vfe(e,t){var n,a,i,r=AV.lastIndex=TV.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=AV.exec(e))&&(a=TV.exec(t));)(i=a.index)>r&&(i=t.slice(r,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(a=a[0])?s[o]?s[o]+=a:s[++o]=a:(s[++o]=null,u.push({i:o,x:md(n,a)})),r=TV.lastIndex;return r<t.length&&(i=t.slice(r),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function qmt(e){return function(t){return e(t)+""}}(u[0].x):function jmt(e){return function(){return e}}(t):(t=u.length,function(c){for(var d,l=0;l<t;++l)s[(d=u[l]).i]=d.x(c);return s.join("")})}function gfe(e,t){var r;return("number"==typeof t?md:t instanceof $g?I3:(r=$g(t))?(t=r,I3):vfe)(e,t)}function Wmt(e){return function(){this.removeAttribute(e)}}function Ymt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Xmt(e,t,r){var n,i,a=r+"";return function(){var o=this.getAttribute(e);return o===a?null:o===n?i:i=t(n=o,r)}}function Kmt(e,t,r){var n,i,a=r+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===n?i:i=t(n=o,r)}}function Zmt(e,t,r){var n,a,i;return function(){var o,u,s=r(this);return null==s?void this.removeAttribute(e):(o=this.getAttribute(e))===(u=s+"")?null:o===n&&u===a?i:(a=u,i=t(n=o,s))}}function Qmt(e,t,r){var n,a,i;return function(){var o,u,s=r(this);return null==s?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local))===(u=s+"")?null:o===n&&u===a?i:(a=u,i=t(n=o,s))}}function tvt(e,t){var r,n;function a(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&function evt(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}(e,i)),r}return a._value=t,a}function rvt(e,t){var r,n;function a(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&function Jmt(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}(e,i)),r}return a._value=t,a}function avt(e,t){return function(){bV(this,e).delay=+t.apply(this,arguments)}}function ivt(e,t){return t=+t,function(){bV(this,e).delay=t}}function svt(e,t){return function(){If(this,e).duration=+t.apply(this,arguments)}}function uvt(e,t){return t=+t,function(){If(this,e).duration=t}}var xvt=ex.prototype.constructor;function yfe(e){return function(){this.style.removeProperty(e)}}var zvt=0;function lh(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function bfe(){return++zvt}var dh=ex.prototype;lh.prototype=function Gvt(e){return ex().transition(e)}.prototype={constructor:lh,select:function Svt(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=dV(e));for(var n=this._groups,a=n.length,i=new Array(a),o=0;o<a;++o)for(var l,d,s=n[o],u=s.length,c=i[o]=new Array(u),f=0;f<u;++f)(l=s[f])&&(d=e.call(l,l.__data__,f,s))&&("__data__"in l&&(d.__data__=l.__data__),c[f]=d,S3(c[f],t,r,f,c,hd(l,r)));return new lh(i,this._parents,t,r)},selectAll:function Cvt(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=Ide(e));for(var n=this._groups,a=n.length,i=[],o=[],s=0;s<a;++s)for(var l,u=n[s],c=u.length,d=0;d<c;++d)if(l=u[d]){for(var p,f=e.call(l,l.__data__,d,u),h=hd(l,r),m=0,v=f.length;m<v;++m)(p=f[m])&&S3(p,t,r,m,f,h);i.push(f),o.push(l)}return new lh(i,o,t,r)},selectChild:dh.selectChild,selectChildren:dh.selectChildren,filter:function hvt(e){"function"!=typeof e&&(e=Pde(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var u,i=t[a],o=i.length,s=n[a]=[],c=0;c<o;++c)(u=i[c])&&e.call(u,u.__data__,c,i)&&s.push(u);return new lh(n,this._parents,this._name,this._id)},merge:function mvt(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=Math.min(n,r.length),o=new Array(n),s=0;s<i;++s)for(var f,u=t[s],c=r[s],l=u.length,d=o[s]=new Array(l),p=0;p<l;++p)(f=u[p]||c[p])&&(d[p]=f);for(;s<n;++s)o[s]=t[s];return new lh(o,this._parents,this._name,this._id)},selection:function wvt(){return new xvt(this._groups,this._parents)},transition:function Uvt(){for(var e=this._name,t=this._id,r=bfe(),n=this._groups,a=n.length,i=0;i<a;++i)for(var u,o=n[i],s=o.length,c=0;c<s;++c)if(u=o[c]){var l=hd(u,t);S3(u,e,r,c,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new lh(n,this._parents,e,r)},call:dh.call,nodes:dh.nodes,node:dh.node,size:dh.size,empty:dh.empty,each:dh.each,on:function yvt(e,t){var r=this._id;return arguments.length<2?hd(this.node(),r).on.on(e):this.each(function gvt(e,t,r){var n,a,i=function vvt(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||"start"===t})}(t)?bV:If;return function(){var o=i(this,e),s=o.on;s!==n&&(a=(n=s).copy()).on(t,r),o.on=a}}(r,e,t))},attr:function $mt(e,t){var r=p3(e),n="transform"===r?wmt:gfe;return this.attrTween(e,"function"==typeof t?(r.local?Qmt:Zmt)(r,n,SV(this,"attr."+e,t)):null==t?(r.local?Ymt:Wmt)(r):(r.local?Kmt:Xmt)(r,n,t))},attrTween:function nvt(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;var n=p3(e);return this.tween(r,(n.local?tvt:rvt)(n,t))},style:function Ivt(e,t,r){var n="transform"==(e+="")?xmt:gfe;return null==t?this.styleTween(e,function Avt(e,t){var r,n,a;return function(){var i=x1(this,e),o=(this.style.removeProperty(e),x1(this,e));return i===o?null:i===r&&o===n?a:a=t(r=i,n=o)}}(e,n)).on("end.style."+e,yfe(e)):"function"==typeof t?this.styleTween(e,function Dvt(e,t,r){var n,a,i;return function(){var o=x1(this,e),s=r(this),u=s+"";return null==s&&(this.style.removeProperty(e),u=s=x1(this,e)),o===u?null:o===n&&u===a?i:(a=u,i=t(n=o,s))}}(e,n,SV(this,"style."+e,t))).each(function Evt(e,t){var r,n,a,s,i="style."+t,o="end."+i;return function(){var u=If(this,e),c=u.on,l=null==u.value[i]?s||(s=yfe(t)):void 0;(c!==r||a!==l)&&(n=(r=c).copy()).on(o,a=l),u.on=n}}(this._id,e)):this.styleTween(e,function Tvt(e,t,r){var n,i,a=r+"";return function(){var o=x1(this,e);return o===a?null:o===n?i:i=t(n=o,r)}}(e,n,t),r).on("end.style."+e,null)},styleTween:function Rvt(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;return this.tween(n,function Mvt(e,t,r){var n,a;function i(){var o=t.apply(this,arguments);return o!==a&&(n=(a=o)&&function Pvt(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}(e,o,r)),n}return i._value=t,i}(e,t,r??""))},text:function Nvt(e){return this.tween("text","function"==typeof e?function Fvt(e){return function(){var t=e(this);this.textContent=t??""}}(SV(this,"text",e)):function Ovt(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function Lvt(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function Bvt(e){var t,r;function n(){var a=e.apply(this,arguments);return a!==r&&(t=(r=a)&&function kvt(e){return function(t){this.textContent=e.call(this,t)}}(a)),t}return n._value=e,n}(e))},remove:function _vt(){return this.on("end.remove",function bvt(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function Dmt(e,t){var r=this._id;if(e+="",arguments.length<2){for(var o,n=hd(this.node(),r).tween,a=0,i=n.length;a<i;++a)if((o=n[a]).name===e)return o.value;return null}return this.each((null==t?Amt:Tmt)(r,e,t))},delay:function ovt(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?avt:ivt)(t,e)):hd(this.node(),t).delay},duration:function cvt(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?svt:uvt)(t,e)):hd(this.node(),t).duration},ease:function dvt(e){var t=this._id;return arguments.length?this.each(function lvt(e,t){if("function"!=typeof t)throw new Error;return function(){If(this,e).ease=t}}(t,e)):hd(this.node(),t).ease},easeVarying:function pvt(e){if("function"!=typeof e)throw new Error;return this.each(function fvt(e,t){return function(){var r=t.apply(this,arguments);if("function"!=typeof r)throw new Error;If(this,e).ease=r}}(this._id,e))},end:function Vvt(){var e,t,r=this,n=r._id,a=r.size();return new Promise(function(i,o){var s={value:o},u={value:function(){0==--a&&i()}};r.each(function(){var c=If(this,n),l=c.on;l!==e&&((t=(e=l).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),c.on=t}),0===a&&i()})},[Symbol.iterator]:dh[Symbol.iterator]};var jvt={time:null,delay:0,duration:250,ease:function Hvt(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function qvt(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}ex.prototype.interrupt=function _mt(e){return this.each(function(){C3(this,e)})},ex.prototype.transition=function Wvt(e){var t,r;e instanceof lh?(t=e._id,e=e._name):(t=bfe(),(r=jvt).time=mV(),e=null==e?null:e+"");for(var n=this._groups,a=n.length,i=0;i<a;++i)for(var u,o=n[i],s=o.length,c=0;c<s;++c)(u=o[c])&&S3(u,e,t,c,o,r||qvt(u,t));return new lh(n,this._parents,e,t)};Math;function ux(e){return{type:e}}["w","e"].map(ux),["n","s"].map(ux),["n","w","e","s","nw","ne","sw","se"].map(ux);const egt=Math.sqrt(50),tgt=Math.sqrt(10),rgt=Math.sqrt(2);function R3(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),i=n/Math.pow(10,a),o=i>=egt?10:i>=tgt?5:i>=rgt?2:1;let s,u,c;return a<0?(c=Math.pow(10,-a)/o,s=Math.round(e*c),u=Math.round(t*c),s/c<e&&++s,u/c>t&&--u,c=-c):(c=Math.pow(10,a)*o,s=Math.round(e/c),u=Math.round(t/c),s*c<e&&++s,u*c>t&&--u),u<s&&.5<=r&&r<2?R3(e,t,2*r):[s,u,c]}function MV(e,t,r){return R3(e=+e,t=+t,r=+r)[2]}function O3(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function igt(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Afe(e){let t,r,n;function a(s,u,c=0,l=s.length){if(c<l){if(0!==t(u,u))return l;do{const d=c+l>>>1;r(s[d],u)<0?c=d+1:l=d}while(c<l)}return c}return 2!==e.length?(t=O3,r=(s,u)=>O3(e(s),u),n=(s,u)=>e(s)-u):(t=e===O3||e===igt?e:ogt,r=e,n=e),{left:a,center:function o(s,u,c=0,l=s.length){const d=a(s,u,c,l-1);return d>c&&n(s[d-1],u)>-n(s[d],u)?d-1:d},right:function i(s,u,c=0,l=s.length){if(c<l){if(0!==t(u,u))return l;do{const d=c+l>>>1;r(s[d],u)<=0?c=d+1:l=d}while(c<l)}return c}}}function ogt(){return 0}const ugt=Afe(O3).right,cgt=(Afe(function sgt(e){return null===e?NaN:+e}),ugt);function Dfe(e,t){var o,r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),i=new Array(r);for(o=0;o<n;++o)a[o]=RV(e[o],t[o]);for(;o<r;++o)i[o]=t[o];return function(s){for(o=0;o<n;++o)i[o]=a[o](s);return i}}function lgt(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function dgt(e,t){var a,r={},n={};for(a in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)a in e?r[a]=RV(e[a],t[a]):n[a]=t[a];return function(i){for(a in r)n[a]=r[a](i);return n}}function fgt(e,t){t||(t=[]);var a,r=e?Math.min(t.length,e.length):0,n=t.slice();return function(i){for(a=0;a<r;++a)n[a]=e[a]*(1-i)+t[a]*i;return n}}function RV(e,t){var n,r=typeof t;return null==t||"boolean"===r?wV(t):("number"===r?md:"string"===r?(n=$g(t))?(t=n,I3):vfe:t instanceof $g?I3:t instanceof Date?lgt:function pgt(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?fgt:Array.isArray(t)?Dfe:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?dgt:md)(e,t)}function hgt(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function vgt(e){return+e}var Efe=[0,1];function E1(e){return e}function OV(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:function mgt(e){return function(){return e}}(isNaN(t)?NaN:.5)}function ygt(e,t,r){var n=e[0],a=e[1],i=t[0],o=t[1];return a<n?(n=OV(a,n),i=r(o,i)):(n=OV(n,a),i=r(i,o)),function(s){return i(n(s))}}function bgt(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),i=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)a[o]=OV(e[o],e[o+1]),i[o]=r(t[o],t[o+1]);return function(s){var u=cgt(e,s,1,n)-1;return i[u](a[u](s))}}function Ife(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var Pfe,xgt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function F3(e){if(!(t=xgt.exec(e)))throw new Error("invalid format: "+e);var t;return new FV({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function FV(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function N3(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function I1(e){return(e=N3(Math.abs(e)))?e[1]:NaN}function Mfe(e,t){var r=N3(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}F3.prototype=FV.prototype,FV.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Rfe={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function wgt(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Mfe(100*e,t),r:Mfe,s:function Igt(e,t){var r=N3(e,t);if(!r)return e+"";var n=r[0],a=r[1],i=a-(Pfe=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,o=n.length;return i===o?n:i>o?n+new Array(i-o+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+N3(e,Math.max(0,t+i-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Ofe(e){return e}var k3,kfe,Bfe,Ffe=Array.prototype.map,Nfe=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Ngt(e){var t=e.domain;return e.ticks=function(r){var n=t();return function ngt(e,t,r){if(!((r=+r)>0))return[];if((e=+e)==(t=+t))return[e];const n=t<e,[a,i,o]=n?R3(t,e,r):R3(e,t,r);if(!(i>=a))return[];const s=i-a+1,u=new Array(s);if(n)if(o<0)for(let c=0;c<s;++c)u[c]=(i-c)/-o;else for(let c=0;c<s;++c)u[c]=(i-c)*o;else if(o<0)for(let c=0;c<s;++c)u[c]=(a+c)/-o;else for(let c=0;c<s;++c)u[c]=(a+c)*o;return u}(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return function Fgt(e,t,r,n){var i,a=function agt(e,t,r){r=+r;const n=(t=+t)<(e=+e),a=n?MV(t,e,r):MV(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}(e,t,r);switch((n=F3(n??",f")).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null==n.precision&&!isNaN(i=function Agt(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(I1(t)/3)))-I1(Math.abs(e)))}(a,o))&&(n.precision=i),Bfe(n,o);case"":case"e":case"g":case"p":case"r":null==n.precision&&!isNaN(i=function Rgt(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,I1(t)-I1(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=i-("e"===n.type));break;case"f":case"%":null==n.precision&&!isNaN(i=function Ogt(e){return Math.max(0,-I1(Math.abs(e)))}(a))&&(n.precision=i-2*("%"===n.type))}return kfe(n)}(a[0],a[a.length-1],r??10,n)},e.nice=function(r){null==r&&(r=10);var u,c,n=t(),a=0,i=n.length-1,o=n[a],s=n[i],l=10;for(s<o&&(c=o,o=s,s=c,c=a,a=i,i=c);l-- >0;){if((c=MV(o,s,r))===u)return n[a]=o,n[i]=s,t(n);if(c>0)o=Math.floor(o/c)*c,s=Math.ceil(s/c)*c;else{if(!(c<0))break;o=Math.ceil(o*c)/c,s=Math.floor(s*c)/c}u=c}return e},e}function Lfe(){var e=function Cgt(){return function Sgt(){var n,a,i,s,u,c,e=Efe,t=Efe,r=RV,o=E1;function l(){var f=Math.min(e.length,t.length);return o!==E1&&(o=function ggt(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}(e[0],e[f-1])),s=f>2?bgt:ygt,u=c=null,d}function d(f){return null==f||isNaN(f=+f)?i:(u||(u=s(e.map(n),t,r)))(n(o(f)))}return d.invert=function(f){return o(a((c||(c=s(t,e.map(n),md)))(f)))},d.domain=function(f){return arguments.length?(e=Array.from(f,vgt),l()):e.slice()},d.range=function(f){return arguments.length?(t=Array.from(f),l()):t.slice()},d.rangeRound=function(f){return t=Array.from(f),r=hgt,l()},d.clamp=function(f){return arguments.length?(o=!!f||E1,l()):o!==E1},d.interpolate=function(f){return arguments.length?(r=f,l()):r},d.unknown=function(f){return arguments.length?(i=f,d):i},function(f,p){return n=f,a=p,l()}}()(E1,E1)}();return e.copy=function(){return function _gt(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}(e,Lfe())},Ife.apply(e,arguments),Ngt(e)}!function Mgt(e){k3=function Pgt(e){var t=void 0===e.grouping||void 0===e.thousands?Ofe:function Tgt(e,t){return function(r,n){for(var a=r.length,i=[],o=0,s=e[0],u=0;a>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),i.push(r.substring(a-=s,a+s)),!((u+=s+1)>n));)s=e[o=(o+1)%e.length];return i.reverse().join(t)}}(Ffe.call(e.grouping,Number),e.thousands+""),r=void 0===e.currency?"":e.currency[0]+"",n=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",i=void 0===e.numerals?Ofe:function Dgt(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}(Ffe.call(e.numerals,String)),o=void 0===e.percent?"%":e.percent+"",s=void 0===e.minus?"\u2212":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function c(d){var f=(d=F3(d)).fill,p=d.align,h=d.sign,m=d.symbol,v=d.zero,g=d.width,y=d.comma,b=d.precision,_=d.trim,C=d.type;"n"===C?(y=!0,C="g"):Rfe[C]||(void 0===b&&(b=12),_=!0,C="g"),(v||"0"===f&&"="===p)&&(v=!0,f="0",p="=");var x="$"===m?r:"#"===m&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",A="$"===m?n:/[%p]/.test(C)?o:"",T=Rfe[C],w=/[defgprs%]/.test(C);function E(I){var N,j,k,M=x,F=A;if("c"===C)F=T(I)+F,I="";else{var H=(I=+I)<0||1/I<0;if(I=isNaN(I)?u:T(Math.abs(I),b),_&&(I=function Egt(e){e:for(var a,t=e.length,r=1,n=-1;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":0===n&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(a+1):e}(I)),H&&0==+I&&"+"!==h&&(H=!1),M=(H?"("===h?h:s:"-"===h||"("===h?"":h)+M,F=("s"===C?Nfe[8+Pfe/3]:"")+F+(H&&"("===h?")":""),w)for(N=-1,j=I.length;++N<j;)if(48>(k=I.charCodeAt(N))||k>57){F=(46===k?a+I.slice(N+1):I.slice(N))+F,I=I.slice(0,N);break}}y&&!v&&(I=t(I,1/0));var G=M.length+I.length+F.length,U=G<g?new Array(g-G+1).join(f):"";switch(y&&v&&(I=t(U+I,U.length?g-F.length:1/0),U=""),p){case"<":I=M+I+F+U;break;case"=":I=M+U+I+F;break;case"^":I=U.slice(0,G=U.length>>1)+M+I+F+U.slice(G);break;default:I=U+M+I+F}return i(I)}return b=void 0===b?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b)),E.toString=function(){return d+""},E}return{format:c,formatPrefix:function l(d,f){var p=c(((d=F3(d)).type="f",d)),h=3*Math.max(-8,Math.min(8,Math.floor(I1(f)/3))),m=Math.pow(10,-h),v=Nfe[8+h/3];return function(g){return p(m*g)+v}}}}(e),kfe=k3.format,Bfe=k3.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});class Ufe extends Map{constructor(t,r=Gfe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),null!=t)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(NV(this,t))}has(t){return super.has(NV(this,t))}set(t,r){return super.set(function Vfe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}(this,t),r)}delete(t){return super.delete(function zfe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}(this,t))}}function NV({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function Gfe(e){return null!==e&&"object"==typeof e?e.valueOf():e}const Hfe=Symbol("implicit");function jfe(){var e=new Ufe,t=[],r=[],n=Hfe;function a(i){let o=e.get(i);if(void 0===o){if(n!==Hfe)return n;e.set(i,o=t.push(i)-1)}return r[o%r.length]}return a.domain=function(i){if(!arguments.length)return t.slice();t=[],e=new Ufe;for(const o of i)e.has(o)||e.set(o,t.push(o)-1);return a},a.range=function(i){return arguments.length?(r=Array.from(i),a):r.slice()},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return jfe(t,r).unknown(n)},Ife.apply(a,arguments),a}function Mf(e){return"string"==typeof e?new Ac([[document.querySelector(e)]],[document.documentElement]):new Ac([[e]],Vde)}function P1(e){return function(){return e}}function qfe(e){this._context=e}function Lgt(e){return new qfe(e)}qfe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};const kV=Math.PI,BV=2*kV,t0=1e-6,Ugt=BV-t0;function Wfe(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class B3{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?Wfe:function Vgt(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Wfe;const r=10**t;return function(n){this._+=n[0];for(let a=1,i=n.length;a<i;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,i,o){this._append`C${+t},${+r},${+n},${+a},${this._x1=+i},${this._y1=+o}`}arcTo(t,r,n,a,i){if(t=+t,r=+r,n=+n,a=+a,(i=+i)<0)throw new Error(`negative radius: ${i}`);let o=this._x1,s=this._y1,u=n-t,c=a-r,l=o-t,d=s-r,f=l*l+d*d;if(null===this._x1)this._append`M${this._x1=t},${this._y1=r}`;else if(f>t0)if(Math.abs(d*u-c*l)>t0&&i){let p=n-o,h=a-s,m=u*u+c*c,v=p*p+h*h,g=Math.sqrt(m),y=Math.sqrt(f),b=i*Math.tan((kV-Math.acos((m+f-v)/(2*g*y)))/2),_=b/y,C=b/g;Math.abs(_-1)>t0&&this._append`L${t+_*l},${r+_*d}`,this._append`A${i},${i},0,0,${+(d*p>l*h)},${this._x1=t+C*u},${this._y1=r+C*c}`}else this._append`L${this._x1=t},${this._y1=r}`}arc(t,r,n,a,i,o){if(t=+t,r=+r,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(a),u=n*Math.sin(a),c=t+s,l=r+u,d=1^o,f=o?a-i:i-a;null===this._x1?this._append`M${c},${l}`:(Math.abs(this._x1-c)>t0||Math.abs(this._y1-l)>t0)&&this._append`L${c},${l}`,n&&(f<0&&(f=f%BV+BV),f>Ugt?this._append`A${n},${n},0,1,${d},${t-s},${r-u}A${n},${n},0,1,${d},${this._x1=c},${this._y1=l}`:f>t0&&this._append`A${n},${n},0,${+(f>=kV)},${d},${this._x1=t+n*Math.cos(i)},${this._y1=r+n*Math.sin(i)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function Hgt(e){return e[0]}function jgt(e){return e[1]}function Yfe(e){return e<0?-1:1}function Xfe(e,t,r){var n=e._x1-e._x0,a=t-e._x1,i=(e._y1-e._y0)/(n||a<0&&-0),o=(r-e._y1)/(a||n<0&&-0),s=(i*a+o*n)/(n+a);return(Yfe(i)+Yfe(o))*Math.min(Math.abs(i),Math.abs(o),.5*Math.abs(s))||0}function Kfe(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function LV(e,t,r){var n=e._x0,i=e._x1,o=e._y1,s=(i-n)/3;e._context.bezierCurveTo(n+s,e._y0+s*t,i-s,o-s*r,i,o)}function L3(e){this._context=e}function Qfe(e){this._context=e}function Wgt(e){return new L3(e)}L3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:LV(this,this._t0,Kfe(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,LV(this,Kfe(this,r=Xfe(this,e,t)),r);break;default:LV(this,this._t0,r=Xfe(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}},(function Zfe(e){this._context=new Qfe(e)}.prototype=Object.create(L3.prototype)).point=function(e,t){L3.prototype.point.call(this,t,e)},Qfe.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,i){this._context.bezierCurveTo(t,e,n,r,i,a)}};const UV={capture:!0,passive:!1};function VV(e){e.preventDefault(),e.stopImmediatePropagation()}function $fe(e){return((e=Math.exp(e))+1/e)/2}const $gt=function e(t,r,n){function a(i,o){var v,g,s=i[0],u=i[1],c=i[2],f=o[2],p=o[0]-s,h=o[1]-u,m=p*p+h*h;if(m<1e-12)g=Math.log(f/c)/t,v=function(A){return[s+A*p,u+A*h,c*Math.exp(t*A*g)]};else{var y=Math.sqrt(m),b=(f*f-c*c+n*m)/(2*c*r*y),_=(f*f-c*c-n*m)/(2*f*r*y),C=Math.log(Math.sqrt(b*b+1)-b),x=Math.log(Math.sqrt(_*_+1)-_);g=(x-C)/t,v=function(A){var T=A*g,w=$fe(C),E=c/(r*y)*(w*function Qgt(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*T+C)-function Zgt(e){return((e=Math.exp(e))-1/e)/2}(C));return[s+E*p,u+E*h,c*w/$fe(t*T+C)]}}return v.duration=1e3*g*t/Math.SQRT2,v}return a.rho=function(i){var o=Math.max(.001,+i),s=o*o;return e(o,s,s*s)},a}(Math.SQRT2,2,4);function r0(e,t){if(e=function Jgt(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}}return[e.pageX,e.pageY]}const U3=e=>()=>e;function e0t(e,{sourceEvent:t,target:r,transform:n,dispatch:a}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:a}})}function ph(e,t,r){this.k=e,this.x=t,this.y=r}ph.prototype={constructor:ph,scale:function(e){return 1===e?this:new ph(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new ph(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zV=new ph(1,0,0);function GV(e){e.stopImmediatePropagation()}function cx(e){e.preventDefault(),e.stopImmediatePropagation()}function r0t(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function n0t(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Jfe(){return this.__zoom||zV}function a0t(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function i0t(){return navigator.maxTouchPoints||"ontouchstart"in this}function o0t(e,t,r){var n=e.invertX(t[0][0])-r[0][0],a=e.invertX(t[1][0])-r[1][0],i=e.invertY(t[0][1])-r[0][1],o=e.invertY(t[1][1])-r[1][1];return e.translate(a>n?(n+a)/2:Math.min(0,n)||Math.max(0,a),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}let V3=(()=>{class e{get div(){return this.root.nativeElement}get width(){return this.div.offsetWidth}constructor(){this.initialize$=new Kf(1),this.initialized$=this.initialize$.pipe(En(r=>this.root=r),yr(()=>{const r=function kgt(e){return Mf(hV(e).call(document.documentElement))}("svg"),n=r.node();if(!n)throw new Error("Could not create SVG node");return this.div.append(n),r}),En(r=>this.svg=r),En(r=>{const n=r.append("defs");this.clip=n.append("SVG:clipPath").attr("id","clip").append("SVG:rect"),this.draw=r.append("g").attr("class","features").attr("clip-path","url(#clip)"),this.zoom=function s0t(){var l,d,f,e=r0t,t=n0t,r=o0t,n=a0t,a=i0t,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=$gt,c=jde("start","zoom","end"),p=500,h=150,m=0,v=10;function g(N){N.property("__zoom",Jfe).on("wheel.zoom",T,{passive:!1}).on("mousedown.zoom",w).on("dblclick.zoom",E).filter(a).on("touchstart.zoom",I).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(N,j){return(j=Math.max(i[0],Math.min(i[1],j)))===N.k?N:new ph(j,N.x,N.y)}function b(N,j,k){var H=j[0]-k[0]*N.k,G=j[1]-k[1]*N.k;return H===N.x&&G===N.y?N:new ph(N.k,H,G)}function _(N){return[(+N[0][0]+ +N[1][0])/2,(+N[0][1]+ +N[1][1])/2]}function C(N,j,k,H){N.on("start.zoom",function(){x(this,arguments).event(H).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(H).end()}).tween("zoom",function(){var G=this,U=arguments,Q=x(G,U).event(H),W=t.apply(G,U),K=null==k?_(W):"function"==typeof k?k.apply(G,U):k,ne=Math.max(W[1][0]-W[0][0],W[1][1]-W[0][1]),X=G.__zoom,L="function"==typeof j?j.apply(G,U):j,Y=u(X.invert(K).concat(ne/X.k),L.invert(K).concat(ne/L.k));return function($){if(1===$)$=L;else{var Z=Y($),q=ne/Z[2];$=new ph(q,K[0]-Z[0]*q,K[1]-Z[1]*q)}Q.zoom(null,$)}})}function x(N,j,k){return!k&&N.__zooming||new A(N,j)}function A(N,j){this.that=N,this.args=j,this.active=0,this.sourceEvent=null,this.extent=t.apply(N,j),this.taps=0}function T(N,...j){if(e.apply(this,arguments)){var k=x(this,j).event(N),H=this.__zoom,G=Math.max(i[0],Math.min(i[1],H.k*Math.pow(2,n.apply(this,arguments)))),U=r0(N);if(k.wheel)(k.mouse[0][0]!==U[0]||k.mouse[0][1]!==U[1])&&(k.mouse[1]=H.invert(k.mouse[0]=U)),clearTimeout(k.wheel);else{if(H.k===G)return;k.mouse=[U,H.invert(U)],C3(this),k.start()}cx(N),k.wheel=setTimeout(function Q(){k.wheel=null,k.end()},h),k.zoom("mouse",r(b(y(H,G),k.mouse[0],k.mouse[1]),k.extent,o))}}function w(N,...j){if(!f&&e.apply(this,arguments)){var k=N.currentTarget,H=x(this,j,!0).event(N),G=Mf(N.view).on("mousemove.zoom",function K(X){if(cx(X),!H.moved){var L=X.clientX-Q,Y=X.clientY-W;H.moved=L*L+Y*Y>m}H.event(X).zoom("mouse",r(b(H.that.__zoom,H.mouse[0]=r0(X,k),H.mouse[1]),H.extent,o))},!0).on("mouseup.zoom",function ne(X){G.on("mousemove.zoom mouseup.zoom",null),function Xgt(e,t){var r=e.document.documentElement,n=Mf(e).on("dragstart.drag",null);t&&(n.on("click.drag",VV,UV),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}(X.view,H.moved),cx(X),H.event(X).end()},!0),U=r0(N,k),Q=N.clientX,W=N.clientY;(function Ygt(e){var t=e.document.documentElement,r=Mf(e).on("dragstart.drag",VV,UV);"onselectstart"in t?r.on("selectstart.drag",VV,UV):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")})(N.view),GV(N),H.mouse=[U,this.__zoom.invert(U)],C3(this),H.start()}}function E(N,...j){if(e.apply(this,arguments)){var k=this.__zoom,H=r0(N.changedTouches?N.changedTouches[0]:N,this),G=k.invert(H),Q=r(b(y(k,k.k*(N.shiftKey?.5:2)),H,G),t.apply(this,j),o);cx(N),s>0?Mf(this).transition().duration(s).call(C,Q,H,N):Mf(this).call(g.transform,Q,H,N)}}function I(N,...j){if(e.apply(this,arguments)){var U,Q,W,K,k=N.touches,H=k.length,G=x(this,j,N.changedTouches.length===H).event(N);for(GV(N),Q=0;Q<H;++Q)K=[K=r0(W=k[Q],this),this.__zoom.invert(K),W.identifier],G.touch0?!G.touch1&&G.touch0[2]!==K[2]&&(G.touch1=K,G.taps=0):(G.touch0=K,U=!0,G.taps=1+!!l);l&&(l=clearTimeout(l)),U&&(G.taps<2&&(d=K[0],l=setTimeout(function(){l=null},p)),C3(this),G.start())}}function M(N,...j){if(this.__zooming){var U,Q,W,K,k=x(this,j).event(N),H=N.changedTouches,G=H.length;for(cx(N),U=0;U<G;++U)W=r0(Q=H[U],this),k.touch0&&k.touch0[2]===Q.identifier?k.touch0[0]=W:k.touch1&&k.touch1[2]===Q.identifier&&(k.touch1[0]=W);if(Q=k.that.__zoom,k.touch1){var ne=k.touch0[0],X=k.touch0[1],L=k.touch1[0],Y=k.touch1[1],$=($=L[0]-ne[0])*$+($=L[1]-ne[1])*$,Z=(Z=Y[0]-X[0])*Z+(Z=Y[1]-X[1])*Z;Q=y(Q,Math.sqrt($/Z)),W=[(ne[0]+L[0])/2,(ne[1]+L[1])/2],K=[(X[0]+Y[0])/2,(X[1]+Y[1])/2]}else{if(!k.touch0)return;W=k.touch0[0],K=k.touch0[1]}k.zoom("touch",r(b(Q,W,K),k.extent,o))}}function F(N,...j){if(this.__zooming){var U,Q,k=x(this,j).event(N),H=N.changedTouches,G=H.length;for(GV(N),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),U=0;U<G;++U)Q=H[U],k.touch0&&k.touch0[2]===Q.identifier?delete k.touch0:k.touch1&&k.touch1[2]===Q.identifier&&delete k.touch1;if(k.touch1&&!k.touch0&&(k.touch0=k.touch1,delete k.touch1),k.touch0)k.touch0[1]=this.__zoom.invert(k.touch0[0]);else if(k.end(),2===k.taps&&(Q=r0(Q,this),Math.hypot(d[0]-Q[0],d[1]-Q[1])<v)){var W=Mf(this).on("dblclick.zoom");W&&W.apply(this,arguments)}}}return g.transform=function(N,j,k,H){var G=N.selection?N.selection():N;G.property("__zoom",Jfe),N!==G?C(N,j,k,H):G.interrupt().each(function(){x(this,arguments).event(H).start().zoom(null,"function"==typeof j?j.apply(this,arguments):j).end()})},g.scaleBy=function(N,j,k,H){g.scaleTo(N,function(){return this.__zoom.k*("function"==typeof j?j.apply(this,arguments):j)},k,H)},g.scaleTo=function(N,j,k,H){g.transform(N,function(){var G=t.apply(this,arguments),U=this.__zoom,Q=null==k?_(G):"function"==typeof k?k.apply(this,arguments):k,W=U.invert(Q),K="function"==typeof j?j.apply(this,arguments):j;return r(b(y(U,K),Q,W),G,o)},k,H)},g.translateBy=function(N,j,k,H){g.transform(N,function(){return r(this.__zoom.translate("function"==typeof j?j.apply(this,arguments):j,"function"==typeof k?k.apply(this,arguments):k),t.apply(this,arguments),o)},null,H)},g.translateTo=function(N,j,k,H,G){g.transform(N,function(){var U=t.apply(this,arguments),Q=this.__zoom,W=null==H?_(U):"function"==typeof H?H.apply(this,arguments):H;return r(zV.translate(W[0],W[1]).scale(Q.k).translate("function"==typeof j?-j.apply(this,arguments):-j,"function"==typeof k?-k.apply(this,arguments):-k),U,o)},H,G)},A.prototype={event:function(N){return N&&(this.sourceEvent=N),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(N,j){return this.mouse&&"mouse"!==N&&(this.mouse[1]=j.invert(this.mouse[0])),this.touch0&&"touch"!==N&&(this.touch0[1]=j.invert(this.touch0[0])),this.touch1&&"touch"!==N&&(this.touch1[1]=j.invert(this.touch1[0])),this.that.__zoom=j,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(N){var j=Mf(this.that).datum();c.call(N,this.that,new e0t(N,{sourceEvent:this.sourceEvent,target:g,type:N,transform:this.that.__zoom,dispatch:c}),j)}},g.wheelDelta=function(N){return arguments.length?(n="function"==typeof N?N:U3(+N),g):n},g.filter=function(N){return arguments.length?(e="function"==typeof N?N:U3(!!N),g):e},g.touchable=function(N){return arguments.length?(a="function"==typeof N?N:U3(!!N),g):a},g.extent=function(N){return arguments.length?(t="function"==typeof N?N:U3([[+N[0][0],+N[0][1]],[+N[1][0],+N[1][1]]]),g):t},g.scaleExtent=function(N){return arguments.length?(i[0]=+N[0],i[1]=+N[1],g):[i[0],i[1]]},g.translateExtent=function(N){return arguments.length?(o[0][0]=+N[0][0],o[1][0]=+N[1][0],o[0][1]=+N[0][1],o[1][1]=+N[1][1],g):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},g.constrain=function(N){return arguments.length?(r=N,g):r},g.duration=function(N){return arguments.length?(s=+N,g):s},g.interpolate=function(N){return arguments.length?(u=N,g):u},g.on=function(){var N=c.on.apply(c,arguments);return N===c?g:N},g.clickDistance=function(N){return arguments.length?(m=(N=+N)*N,g):Math.sqrt(m)},g.tapDistance=function(N){return arguments.length?(v=+N,g):v},g}(),this.events=r.append("rect").style("fill","none").style("pointer-events","all").call(this.zoom)}),En(r=>{const n=r.append("g").attr("class","x axis"),a=r.append("g").attr("class","y axis");this.axes={x:n,y:a}}),En(r=>{const a=r.append("g").attr("class","y axis-grid");this.grid={x:void 0,y:a}}),En(()=>this.scale={x:Lfe(),y:jfe()}),Cv(1))}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function epe(e,t,r){e.attr("height",t.height).attr("width",t.width).attr("y",r.top).attr("x",r.left)}let tpe=(()=>{class e{get svg(){return this.initService.svg}get div(){return this.initService.div}get height(){return this.div.offsetHeight}get width(){return this.div.offsetWidth}get margin(){return this.initService.margin}get scale(){return this.initService.scale}get axes(){return this.initService.axes}constructor(r){this.initService=r,this.resize$=new Kf(1);const n=this.resize$.pipe(yr(()=>({width:this.width,height:this.height})),bue(100),Xse((a,i)=>a.width===i.width),yr(()=>{}),pF(void 0));this.resized$=n.pipe(yr(()=>this.updateRoot()),yr(()=>this.updateDraw()),yr(()=>this.updateAxes()),yr(()=>this.updateRangeX()),yr(()=>this.updateRangeY()),En(()=>console.log("Resized!")))}updateRoot(){const{y:r}=this.scale,a=r.range().at(-1)+this.margin.bottom,i=this.width;this.svg.attr("height",a).attr("width",i)}updateDraw(){const r={width:0,height:0};r.height=this.height-this.margin.top-this.margin.bottom,r.width=this.width-this.margin.left-this.margin.right,epe(this.initService.clip,r,this.margin),epe(this.initService.events,r,this.margin)}updateAxes(){const{x:r,y:n}=this.axes;r.attr("transform",`translate(0, ${this.height-this.margin.top})`),n.attr("transform",`translate(${this.margin.left}, 0)`)}updateRangeX(){const r=this.scale.x,n=this.width,{left:a,right:i}=this.margin;r.range([a,n-i])}updateRangeY(){const r=this.scale.y,n=r.domain(),a=this.initService.height,i=n.reduce((s,u,c)=>{let l=0;return 0===c&&"sequence"===u?(l+=this.margin.top,l+=a.get(u)/2):(l+=s[c-1],l+=a.get(n[c-1])/2,l+=a.get(n[c])/2),[...s,l]},[]);let o=0;o+=i.at(-1),o+=a.get(n.at(-1))/2,r.range([...i,o])}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(V3))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),u0t=(()=>{class e{constructor(r){this.initService=r,this.zoom$=new Kf(1);const a=this.initService.initialized$.pipe(yr(()=>this._scale={x:this.initService.scale.x.copy(),y:this.initService.scale.y.copy()}),Cv(1)).pipe(Io(()=>this.zoom$),yr(i=>{const{x:o}=this.initService.scale,s=i.transform.rescaleX(this._scale.x);return o.domain(s.domain()),this.initService.scale}),pF(this.initService.scale));this.zoomed$=a.pipe(yr(()=>{this.initService.axes.x.call(function Mpt(e){return d3(3,e)}(this.initService.scale.x))}),En(()=>console.log("Zoomed!")))}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(V3))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const rpe={H:"blue",K:"blue",R:"blue",D:"red",E:"red",S:"green",T:"green",N:"green",Q:"green",A:"white",V:"white",L:"white",I:"white",M:"white",F:"magenta",W:"magenta",Y:"magenta",P:"brown",G:"brown",C:"yellow",B:"grey",Z:"grey",X:"grey","-":"grey"},npe=parseFloat(getComputedStyle(document.documentElement).fontSize),HV=e=>e.id,Wm=(e,t)=>t;function jV(e,t){const r=e.selectAll(`foreignObject.${t.type}`).data(t.values,Wm).join("foreignObject").attr("class",`${t.type} ${t.id}`),n=t.color||"black",a=t.color||"transparent";return r.selectAll("div.background").data(i=>[i],Wm).join("xhtml:div").attr("class","background").style("background-color",a),r.selectAll("div.foreground").data(i=>[i],Wm).join("xhtml:div").attr("class","foreground").style("border-color",n),r}let d0t=(()=>{class e{get draw(){return this.initService.draw}get scale(){return this.initService.scale}get height(){return this.initService.height}get width(){return this.initService.width}get margin(){return this.initService.margin}constructor(r,n){this.initService=r,this.resizeService=n,this.features$=new Kf(1),this.sequence$=new Kf(1),this.draw$=this.sequence$.pipe(En(a=>{const{x:i}=this.scale;i.domain([0,a.length+.5])}),yr(a=>{const o=this.draw.selectAll("g.sequence").data([a]).join("g").attr("class","sequence");this.residues=o.selectAll("g.residue").data(a).join("g").attr("id",(s,u)=>`residue-${u+1}`).attr("class","residue"),this.residues.append("rect").attr("class","color").attr("fill",s=>(s=>rpe[s]||rpe.X)(s)).attr("fill-opacity",.1),this.residues.append("foreignObject").attr("class","name").append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("height","100%").style("width","100%").style("box-sizing","border-box").style("color","black")}),Cv(1),Io(()=>this.features$),En(a=>{this.children=new Map,a.forEach(i=>{if(this.children.set(i,this.children.get(i)||[]),void 0!==i.parent){const o=a[i.parent],s=this.children.get(o)||[];s.push(i),this.children.set(o,s)}}),console.log("Children",this.children)}),En(a=>{for(this.depth=new Map;this.depth.size<a.length;)a.forEach(i=>{let o=this.depth.get(i);void 0===o&&(void 0===i.parent?this.depth.set(i,0):(o=this.depth.get(a[i.parent]),void 0!==o&&this.depth.set(i,o+1)))})}),Cv(1),yr(a=>a.filter(i=>void 0===i.parent||!0===a[i.parent].active)),En(a=>this.updateDomainY(a)),En(a=>this.updateRangeY(a)),En(a=>{const i=this.initService.svg.selectAll("g.labels").data([a],Wm).join("g").attr("class","labels");this.labels=i.selectAll("g.label").data([{id:"sequence",active:!1,parent:void 0},...a],HV).join("g").attr("id",s=>"label-"+s.id).attr("class",s=>"label "+(s.active?"active":"")),this.labels.selectAll("foreignObject.parent").data(s=>[s],Wm).join("foreignObject").attr("class","parent").selectAll("div").data(s=>[s],Wm).join("xhtml:div").attr("class",s=>`depth-${this.depth.get(s)||0} children-${(this.children.get(s)||[]).length}`).html(s=>`<span>${""+s.id=="sequence"?""+s.id:"feature "+s.id} </span><i class="bi bi-caret-down-fill"></i>`),this.labels.selectAll("g.children").data(s=>[s],Wm).join("g").attr("class","children"),this.labels.each(function(s){const u=Mf(this);if(void 0!==s.parent){const c=i.selectAll(`g.label#label-${s.parent}`),l=c.selectAll("g.children").node(),d=u.node();l.appendChild(d),console.log("Parent",c),console.log("Child",d)}})}),yr(a=>{const i=this.values=new Map;this.features=this.draw.selectAll("g.feature").data(a,HV).join("g").attr("id",o=>`feature-${o.id}`).attr("class","feature"),this.features.each(function(o){const s=Mf(this);if("continuous"===o.type){const u=s.selectAll("path.continuous").data([o],HV).join("path").attr("class","continuous").attr("fill","steelblue").attr("fill-opacity",.3).attr("stroke","steelblue").attr("stroke-opacity",1).attr("stroke-width",1.5);i.set(o,u)}else if("loci"===o.type){const u=jV(s,o);i.set(o,u)}else if("pins"===o.type)i.set(o,function c0t(e,t){const r=t.values.map(a=>({...a,end:a.start})),n=jV(e,{...t,values:r});return n.select("div.background").remove(),n.select("div.foreground").html(a=>a?'<i class="bi bi-pin"></i>':""),n}(s,o));else if("dssp"===o.type){const u=function l0t(e,t){const r=jV(e,{...t});return r.select("div.background").remove(),r.select("div.foreground").html(n=>{const i=n.color||t.color||"black";return"G"===n.code||"H"===n.code||"I"===n.code?`<i class="dssp dssp-helix" style="background-color: ${i}"></i>`:"E"===n.code||"B"===n.code?`<i class="dssp dssp-strand" style="background-color: ${i}"></i>`:"C"===n.code||"S"===n.code||"T"===n.code?`<i class="dssp dssp-loop" style="background-color: ${i}"></i>`:""}),r}(s,o);i.set(o,u)}})}),Cv(1)),this.drawn$=this.draw$.pipe(yr(()=>{const a=this.initService.margin,{x:i,y:o}=this.initService.scale,s=i(1)-i(0);this.residues.select("rect.color").attr("x",(u,c)=>i(c+.5)).attr("y",a.top).attr("width",()=>s).attr("height","100%"),this.residues.select("foreignObject.name").attr("x",(u,c)=>i(c+.5)).attr("y",o("sequence")-12).attr("width",()=>s).attr("height",24).select("div").style("display","flex").style("justify-content","center").style("align-content","center").style("width","100%").style("height","100%").text(u=>s>.75*npe?u:" ")}),yr(()=>{const a=this.scale.y;this.initService.grid.y.selectAll("line").data(a.domain(),Wm).join("line").attr("x1",this.margin.left).attr("x2",this.width-this.margin.right).attr("y1",i=>a(i)).attr("y2",i=>a(i))}),yr(()=>{const{y:a}=this.scale,i=this.margin,o=2*(a("sequence")-i.top);this.labels.select("foreignObject.parent").attr("y",s=>a(s.id+""=="sequence"?""+s.id:"feature-"+s.id)-o/2).attr("x",0).attr("height",o).attr("width",i.left)}),yr(()=>{const a=this.values,i=this.initService.height,{x:o,y:s}=this.scale;this.features.each(function(u){const c=a.get(u);if(!c)throw new Error(`Values are not defined for feature ${u.id}`);if("continuous"===u.type){const l=i.get(`feature-${u.id}`)/2,d=c,f=u.values.length,p=void 0!==u.min?u.min:Math.min(...u.values),h=void 0!==u.max?u.max:Math.max(...u.values);let m;m=[[.5,0]],m=[...m,...u.values.map((g,y)=>[y+1,(g-p)/(h-p)])],m=[...m,[f+.5,0]];const v=function qgt(e,t){var r=P1(!0),n=null,a=Lgt,i=null,o=function Ggt(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(null==r)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new B3(t)}(s);function s(u){var c,d,p,l=(u=function Bgt(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(u)).length,f=!1;for(null==n&&(i=a(p=o())),c=0;c<=l;++c)!(c<l&&r(d=u[c],c,u))===f&&((f=!f)?i.lineStart():i.lineEnd()),f&&i.point(+e(d,c,u),+t(d,c,u));if(p)return i=null,p+""||null}return e="function"==typeof e?e:void 0===e?Hgt:P1(e),t="function"==typeof t?t:void 0===t?jgt:P1(t),s.x=function(u){return arguments.length?(e="function"==typeof u?u:P1(+u),s):e},s.y=function(u){return arguments.length?(t="function"==typeof u?u:P1(+u),s):t},s.defined=function(u){return arguments.length?(r="function"==typeof u?u:P1(!!u),s):r},s.curve=function(u){return arguments.length?(a=u,null!=n&&(i=a(n)),s):a},s.context=function(u){return arguments.length?(null==u?n=i=null:i=a(n=u),s):n},s}().curve(Wgt).x(g=>o(g[0])).y(g=>s("feature-"+u.id)-g[1]*l);d.attr("d",v(m))}else if("loci"===u.type||"dssp"===u.type||"pins"===u.type){const d=s("feature-"+u.id)-12,f=c.attr("x",p=>o(p.start-.5)).attr("y",d).attr("width",p=>o(p.end+1)-o(p.start)).attr("height",24);"loci"===u.type?f.select("div.foreground").text(p=>o(p.end+1)-o(p.start)>2.5*npe?`[${p.start}, ${p.end}]`:""):"pins"===u.type&&f.attr("y",d-12)}})}),En(()=>console.log("Re-drawn!")))}updateDomainY(r){const{y:n}=this.scale,a=r.map(({id:i})=>"feature-"+i);n.domain(["sequence",...a])}updateRangeY(r){this.resizeService.updateRangeY()}static#e=this.\u0275fac=function(n){return new(n||e)(Xr(V3),Xr(tpe))};static#t=this.\u0275prov=hr({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const f0t=["root"];let p0t=(()=>{class e{set margin(r){this.initService.margin=r}get margin(){return this.resizeService.margin}get width(){return this.resizeService.width}get axes(){return this.initService.axes}get grid(){return this.initService.grid}get zoom(){return this.initService.zoom}get labels(){return this.drawService.labels}constructor(r,n,a,i){this.initService=r,this.resizeService=n,this.zoomService=a,this.drawService=i,this.sequence$=this.drawService.sequence$,this.features$=this.drawService.features$,this.margin={top:24,right:24,bottom:24,left:128},this.update$=this.initService.initialized$.pipe(En(()=>{this.zoom.scaleExtent([1,100]).on("zoom",o=>{this.onFeaturesZoom(o)})}),Io(()=>this.drawService.draw$),En(()=>{this.labels.on("click",(o,s)=>{this.onLabelClick(s)})}),En(()=>{this.zoom.scaleExtent([1,(this.sequence.length+1)/5])}),Io(()=>this.resizeService.resized$),Io(()=>this.zoomService.zoomed$),Io(()=>this.drawService.drawn$)),this._update=this.update$.subscribe()}ngOnChanges(r){if(r&&r.sequence&&this.sequence$.next(this.sequence),r&&(r.features||r.height)){const n=this.initService.height=new Map;n.set("sequence",this.height||56),this.features.forEach(a=>{a.active=void 0===a.active||a.active,n.set("feature-"+a.id,a.height||this.height||56)}),this.features$.next(this.features)}}ngAfterViewInit(){this.initService.initialize$.next(this._root)}ngOnDestroy(){this._update.unsubscribe()}onResize(r){this.resizeService.resize$.next(r)}onLabelClick(r){const n=this.features[r.id];n.active=!n.active,this.features$.next([...this.features])}onFeaturesZoom(r){this.zoomService.zoom$.next(r)}static#e=this.\u0275fac=function(n){return new(n||e)(Tr(V3),Tr(tpe),Tr(u0t),Tr(d0t))};static#t=this.\u0275cmp=yh({type:e,selectors:[["ngx-features-viewer"]],viewQuery:function(n,a){if(1&n&&Ww(f0t,5),2&n){let i;N_(i=k_())&&(a._root=i.first)}},hostBindings:function(n,a){1&n&&jw("resize",function(o){return a.onResize(o)},0,Wz)},inputs:{height:"height",sequence:"sequence",features:"features"},standalone:!0,features:[Sh,hv],decls:2,vars:0,consts:[[2,"position","relative","display","block","width","100%","height","100%"],["root",""]],template:function(n,a){1&n&&Zu(0,"div",0,1)},styles:['.labels #label-sequence .parent div{cursor:default}.labels #label-sequence .parent div i{display:none}.labels .label .children-0>i{visibility:hidden}.labels .label i:before{transition:transform .4s}.labels .label.active i:before{transform:roate(0deg)}.labels .label:not(.active) i:before{transform:rotate(-90deg)}.labels .label div{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;align-items:center;box-sizing:border-box;height:100%;width:100%;cursor:pointer}.labels .label div span{text-wrap:wrap;line-break:anywhere;flex-shrink:1;flex-grow:1}.labels .label div i{flex-shrink:0;flex-grow:0}.labels div.depth-0{width:100%;padding:0 .25rem 0 .75rem}.labels div.depth-1{width:100%;padding:0 .25rem 0 1.5rem}.labels div.depth-2{width:100%;padding:0 .25rem 0 2.25rem}.labels div.depth-3{width:100%;padding:0 .25rem 0 3rem}.labels div.depth-4{width:100%;padding:0 .25rem 0 3.75rem}.labels div.depth-5{width:100%;padding:0 .25rem 0 4.5rem}foreignObject.loci{box-sizing:border-box;border-radius:.375rem;position:relative;display:block}foreignObject.loci div.foreground{position:relative;display:flex;height:100%;width:100%;justify-content:center;align-items:center;box-sizing:inherit;border-radius:inherit;border-width:1px;border-style:solid;opacity:1}foreignObject.loci div.background{position:absolute;left:0;top:0;display:block;height:100%;width:100%;opacity:.3}foreignObject.pins div.foreground{position:relative;display:flex;height:100%;width:100%;justify-content:center;align-items:flex-end;box-sizing:border-box}foreignObject.dssp div.foreground{position:relative;display:flex;height:100%;width:100%;justify-content:center;align-items:flex-end;box-sizing:border-box}foreignObject.dssp i[class^=dssp]{position:relative;visibility:hidden;display:flex;height:100%;width:100%}foreignObject.dssp i.dssp-helix{visibility:visible;background-color:inherit;-webkit-mask-image:url(dssp-helix.74d0a47e4d7ed27e.svg);mask-image:url(dssp-helix.74d0a47e4d7ed27e.svg);-webkit-mask-position:0 center;mask-position:0 center;-webkit-mask-size:auto 100%;mask-size:auto 100%}foreignObject.dssp i.dssp-strand{display:flex;visibility:hidden}foreignObject.dssp i.dssp-strand:before{visibility:visible;background-color:inherit;-webkit-mask-image:url(dssp-strand-tail.783864b28823e2c7.svg);mask-image:url(dssp-strand-tail.783864b28823e2c7.svg);-webkit-mask-position:0 center;mask-position:0 center;-webkit-mask-size:auto 100%;mask-size:auto 100%;flex-shrink:1;flex-grow:1;content:""}foreignObject.dssp i.dssp-strand:after{visibility:visible;background-color:inherit;-webkit-mask-image:url(dssp-strand-head.85a295955fb4c220.svg);mask-image:url(dssp-strand-head.85a295955fb4c220.svg);-webkit-mask-position:0 center;mask-position:0 center;-webkit-mask-size:auto 100%;mask-size:auto 100%;flex-shrink:0;flex-grow:0;content:"";width:31px}.axis-grid line{stroke-opacity:.3;stroke:gray}.axis-grid line:nth-child(1){stroke-dasharray:2}.y.axis .tick text{display:none}\n'],encapsulation:2})}return e})();function h0t(e,t){if(1&e&&Ra(0),2&e){const r=rO().$implicit;Oh(" ","{ id: "+r.id+", type: "+r.type+", color: "+r.color+", values: [...] }"," ")}}function m0t(e,t){1&e&&(Ra(0),L_(1,"json")),2&e&&Oh(" ",U_(1,1,rO().$implicit)," ")}function v0t(e,t){if(1&e&&(Ra(0," \xa0\xa0 "),z0(1,h0t,1,1)(2,m0t,2,3),Ra(3," , "),Zu(4,"br")),2&e){const r=t.$implicit;let n;Ph(),function r7(e,t,r){sv("NgControlFlow");const n=ct(),a=xd(),i=ZR(n,Ur+e);if(eo(n,a,t)){const s=bi(null);try{if(MR(i,0),-1!==t){const u=QR(n[Ft],Ur+t),c=U0(i,u.tView.ssrId);w_(i,x_(n,u,r,{dehydratedView:c}),0,V0(u,c))}}finally{bi(s)}}else{const s=$H(i,0);void 0!==s&&(s[Pa]=r)}}(1,"continuous"===(n=r.type)?1:2)}}const y0t={providers:[function pDe(e,...t){return jx([{provide:UA,multi:!0,useValue:e},[],{provide:yy,useFactory:VY,deps:[Xf]},{provide:TO,multi:!0,useFactory:zY},t.map(r=>r.\u0275providers)])}([{path:"structure",component:wpt},{path:"features",component:(()=>{class e{constructor(){this.height=64,this.sequence="MLPGLALLLLAAWTARALEVPTDGNAGLLAEPQIAMFCGRLNMHMNVQNGKWDSDPSGTKTCIDTKEGILQYCQEVYPELQITNVVEANQPVTIQNWCKRGRKQCKTHPHFVIPYRCLVGEFVSDALLVPDKCKFLHQERMDVCETHLHWHTVAKETCSEKSTNLHDYGMLLPCGIDKFRGVEFVCCPLAEESDNVDSADAEEDDSDVWWGGADTDYADGSEDKVVEVAEEEEVAEVEEEEADDDEDDEDGDEVEEEAEEPYEEATERTTSIATTTTTTTESVEEVVREVCSEQAETGPCRAMISRWYFDVTEGKCAPFFYGGCGGNRNNFDTEEYCMAVCGSAMSQSLLKTTQEPLARDPVKLPTTAASTPDAVDKYLETPGDENEHAHFQKAKERLEAKHRERMSQVMREWEEAERQAKNLPKADKKAVIQHFQEKVESLEQEAANERQQLVETHMARVEAMLNDRRRLALENYITALQAVPPRPRHVFNMLKKYVRAEQKDRQHTLKHFEHVRMVDPKKAAQIRSQVMTHLRVIYERMNQSLSLLYNVPAVAEEIQDEVDELLQKEQNYSDDVLANMISEPRISYGNDALMPSLTETKTTVELLPVNGEFSLDDLQPWHSFGADSVPANTENEVEPVDARPAADRGLTTRPGSGLTNIKTEEISEVKMDAEFRHDSGYEVHHQKLVFFAEDVGSNKGAIIGLMVGGVVIATVIVITLVMLKKKQYTSIHHGVVEVDAAVTPEERHLSKMQQNGYENPTYKFFEQMQN".split(""),this.features=[{id:0,type:"continuous",color:"blue",values:this.sequence.map(()=>Math.random()),height:128},{id:1,type:"loci",color:"red",values:[{start:1,end:3},{start:5,end:6}],height:96},{id:2,type:"pins",color:"green",values:[{start:5},{start:100,color:"blue"},{start:400,color:"red"}],parent:1},{id:3,type:"loci",color:"orange",values:[{start:10,end:20},{start:30,end:70}],parent:1},{id:4,type:"loci",color:"purple",values:[{start:100,end:300}]},{id:5,type:"dssp",color:"black",values:[{start:30,end:90,code:"H",color:"orange"},{start:120,end:300,code:"E",color:"purple"}]}]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=yh({type:e,selectors:[["app-page-features-viewer"]],standalone:!0,features:[hv],decls:40,vars:6,consts:[["href","https://www.uniprot.org/uniprotkb/P05067/entry"],[2,"display","block","height","auto","width","100%"],[3,"sequence","features","height"]],template:function(n,a){1&n&&(fi(0,"div")(1,"h1"),Ra(2,"Features viewer"),Ci(),fi(3,"p"),Ra(4," Features viewer allows to represents features on a protein sequence. It takes as input the target `Sequence` and a list of `Feature` objects. The `Sequence` represents an amino-acid sequence, hence it must be a list of valid amino-acid one-letter codes. "),Ci()(),fi(5,"div")(6,"h2"),Ra(7,"Features"),Ci(),fi(8,"p"),Ra(9," Each `Feature` object characterizes either a single or a range of amino-acids. "),Ci(),fi(10,"div")(11,"h3"),Ra(12,"Positional features"),Ci(),fi(13,"p"),Ra(14," A `Feature` characterizing single amino-acids must contain an array of values which length is the same as the length of the input sequence. Each value is associated to the input sequence by means of its index. "),Ci()(),fi(15,"div")(16,"h3"),Ra(17,"Range features"),Ci(),fi(18,"p"),Ra(19," A feature characterizing a range of amino-acid is defined hereby as a `Loci`. A `Loci` is an object which contains the `start` and `end` properties, indexing two valid positions in the sequence. A position is considered to be valid if it is a valid index over the input sequence. Moreover, the `start` and `end` properties are considered to be valid only if the former has not a bigger value than the latter. `start`, `end` positions used in `Loci` features are inclusive, hence amino-acids indexed by those preoperties are included in the range, as well as those comprised between them. "),Ci()()(),fi(20,"div")(21,"h2"),Ra(22,"Try it out"),Ci(),fi(23,"code"),Ra(24),L_(25,"json"),Zu(26,"br"),Ra(27," const sequence = "),fi(28,"a",0),Ra(29,"P05067"),Ci(),Zu(30,"br"),Ra(31," const features = "),fi(32,"span"),Ra(33,"["),Zu(34,"br"),function a7(e,t,r,n,a,i,o,s,u,c,l,d,f){sv("NgControlFlow");const p=void 0!==u,h=ct(),m=s?o.bind(h[di][Pa]):o,v=new Bbe(p,m);h[Ur+e]=v,z0(e+1,t,r,n,a,i),p&&z0(e+2,u,c,l,d,f)}(35,v0t,5,1,"br",null,n7),Ra(37," ]"),Ci()(),fi(38,"div",1),Zu(39,"ngx-features-viewer",2),Ci()()),2&n&&(Ph(24),Oh(" const height = ",U_(25,4,a.height),""),Ph(11),function i7(e){const t=bi(null),r=ps();try{const n=ct(),a=n[Ft],i=n[r];if(void 0===i.liveCollection){const s=r+1,u=ZR(n,s),c=QR(a,s);i.liveCollection=new Lbe(u,n,c)}else i.liveCollection.reset();const o=i.liveCollection;if(function Fbe(e,t,r){let n,a,i=0,o=e.length-1;if(Array.isArray(t)){let s=t.length-1;for(;i<=o&&i<=s;){const u=e.at(i),c=t[i],l=XR(i,u,i,c,r);if(0!==l){l<0&&e.updateValue(i,c),i++;continue}const d=e.at(o),f=t[s],p=XR(o,d,s,f,r);if(0!==p){p<0&&e.updateValue(o,f),o--,s--;continue}const h=r(i,u),m=r(o,d),v=r(i,c);if(Object.is(v,m)){const g=r(s,f);Object.is(g,h)?(e.swap(i,o),e.updateValue(o,f),s--,o--):e.move(o,i),e.updateValue(i,c),i++}else if(n??=new t7,a??=e7(e,i,o,r),KR(e,n,i,v))e.updateValue(i,c),i++,o++;else if(a.has(v))n.set(h,e.detach(i)),o--;else{const g=e.create(i,t[i]);e.attach(i,g),i++,o++}}for(;i<=s;)J9(e,n,r,i,t[i]),i++}else if(null!=t){const s=t[Symbol.iterator]();let u=s.next();for(;!u.done&&i<=o;){const c=e.at(i),l=u.value,d=XR(i,c,i,l,r);if(0!==d)d<0&&e.updateValue(i,l),i++,u=s.next();else{n??=new t7,a??=e7(e,i,o,r);const f=r(i,l);if(KR(e,n,i,f))e.updateValue(i,l),i++,o++,u=s.next();else if(a.has(f)){const p=r(i,c);n.set(p,e.detach(i)),o--}else e.attach(i,e.create(i,l)),i++,o++,u=s.next()}}for(;!u.done;)J9(e,n,r,e.length,u.value),u=s.next()}for(;i<=o;)e.destroy(e.detach(o--));n?.forEach(s=>{e.destroy(s)})}(o,e,i.trackByFn),o.updateIndexes(),i.hasEmptyBlock){const s=xd(),u=0===o.length;if(eo(n,s,u)){const c=r+2,l=ZR(n,c);if(u){const d=QR(a,c),f=U0(l,d.tView.ssrId);w_(l,x_(n,d,void 0,{dehydratedView:f}),0,V0(d,f))}else MR(l,0)}}}finally{bi(t)}}(a.features),Ph(4),Bw("sequence",a.sequence)("features",a.features)("height",a.height))},dependencies:[QO,XO,p0t]})}return e})()},{path:"**",component:(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=yh({type:e,selectors:[["app-page-home"]],decls:2,vars:0,template:function(n,a){1&n&&(fi(0,"p"),Ra(1,"page-home works!"),Ci())}})}return e})()}])]};(function Qxe(e,t){return ASe({rootComponent:e,...bW(t)})})((()=>{class e{constructor(){this.title="ngx-bio-tools",this.sequence="MLPGLALLLLAAWTARALEVPTDGNAGLLAEPQIAMFCGRLNMHMNVQNGKWDSDPSGTKTCIDTKEGILQYCQEVYPELQITNVVEANQPVTIQNWCKRGRKQCKTHPHFVIPYRCLVGEFVSDALLVPDKCKFLHQERMDVCETHLHWHTVAKETCSEKSTNLHDYGMLLPCGIDKFRGVEFVCCPLAEESDNVDSADAEEDDSDVWWGGADTDYADGSEDKVVEVAEEEEVAEVEEEEADDDEDDEDGDEVEEEAEEPYEEATERTTSIATTTTTTTESVEEVVREVCSEQAETGPCRAMISRWYFDVTEGKCAPFFYGGCGGNRNNFDTEEYCMAVCGSAMSQSLLKTTQEPLARDPVKLPTTAASTPDAVDKYLETPGDENEHAHFQKAKERLEAKHRERMSQVMREWEEAERQAKNLPKADKKAVIQHFQEKVESLEQEAANERQQLVETHMARVEAMLNDRRRLALENYITALQAVPPRPRHVFNMLKKYVRAEQKDRQHTLKHFEHVRMVDPKKAAQIRSQVMTHLRVIYERMNQSLSLLYNVPAVAEEIQDEVDELLQKEQNYSDDVLANMISEPRISYGNDALMPSLTETKTTVELLPVNGEFSLDDLQPWHSFGADSVPANTENEVEPVDARPAADRGLTTRPGSGLTNIKTEEISEVKMDAEFRHDSGYEVHHQKLVFFAEDVGSNKGAIIGLMVGGVVIATVIVITLVMLKKKQYTSIHHGVVEVDAAVTPEERHLSKMQQNGYENPTYKFFEQMQN".split(""),this.features=[{id:0,type:"continuous",color:"blue",values:this.sequence.map(()=>Math.random()),parent:void 0,height:128},{id:1,type:"loci",color:"red",values:[{start:1,end:3},{start:5,end:6}],parent:void 0,height:96},{id:2,type:"pins",color:"green",values:[{start:5},{start:100,color:"blue"},{start:400,color:"red"}],parent:1},{id:3,type:"loci",color:"orange",values:[{start:10,end:20},{start:30,end:70}],parent:1},{id:4,type:"loci",color:"purple",values:[{start:100,end:300}],parent:void 0},{id:5,type:"dssp",color:"black",values:[{start:30,end:90,code:"H",color:"orange"},{start:120,end:300,code:"E",color:"purple"}],parent:void 0}]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=yh({type:e,selectors:[["app-root"]],standalone:!0,features:[hv],decls:1,vars:0,template:function(n,a){1&n&&Zu(0,"router-outlet")},dependencies:[QO,OF]})}return e})(),y0t).catch(e=>console.error(e))},744:R1=>{R1.exports=XMLHttpRequest}},R1=>{R1(R1.s=872)}]);