(self.webpackChunkdemo_showcase=self.webpackChunkdemo_showcase||[]).push([[509],{5621:(tn,Ue,n)=>{"use strict";n.d(Ue,{z:()=>zg});var e={};n.r(e),n.d(e,{AssignColorVolume:()=>L,DownloadDensity:()=>T});var t,oe,o=n(958),r=n(467);(oe=t||(t={})).create=function x(z){return z},oe.getDuration=function F(z,me){var Pe,Ge;if(me.customDurationMs)return me.customDurationMs;const Xe=null===(Ge=(Pe=me.definition).getDuration)||void 0===Ge?void 0:Ge.call(Pe,me.params,z);return"fixed"===Xe?.kind?Xe.durationMs:void 0};var A=n(381),y=n(1073),c=n(1832),i=n(6763),v=n(8277);const O=t.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:oe=>{const x=[["all","All"]],F=oe.state.data.select(c.QX.Generators.rootsOfType(A.O.Molecule.Structure));for(const z of F)x.push([z.transform.ref,z.obj.data.models[0].label]);return{durationInMs:v.t.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:v.t.Boolean(!1),target:v.t.Select(x[0][0],x)}},canApply:oe=>({canApply:oe.state.data.select(c.QX.Generators.ofType(A.O.Molecule.Structure.Representation3D,c.Cn.RootRef)).length>0}),getDuration:oe=>({kind:"fixed",durationMs:oe.durationInMs}),initialState:()=>({t:0}),setup(oe,x,F){const z=F.state.data,Pe=z.select(c.QX.Generators.ofType(A.O.Molecule.Structure.Representation3D,oe.target&&"all"!==oe.target?oe.target:c.Cn.RootRef)),Ge=z.build();let Xe=!1;for(const Qe of Pe)z.select(c.QX.Generators.ofTransformer(y.f.Representation.UnwindStructureAssemblyRepresentation3D,Qe.transform.ref)).length>0||(Xe=!0,Ge.to(Qe).apply(y.f.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}));if(Xe)return Ge.commit({doNotUpdateCurrent:!0})},teardown(oe,x,F){const z=F.state.data,me=z.select(c.QX.Generators.ofType(A.O.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(0===me.length)return;const Pe=z.build();for(const Ge of me)Pe.delete(Ge.transform.ref);return Pe.commit()},apply:(oe,x,F)=>(0,r.A)(function*(){const z=F.plugin.state.data,Pe=z.select(c.QX.Generators.ofTransformer(y.f.Representation.UnwindStructureAssemblyRepresentation3D,F.params.target&&"all"!==F.params.target?F.params.target:c.Cn.RootRef));if(0===Pe.length)return{kind:"finished"};const Ge=z.build();let Qe=oe.t+(x.current-x.lastApplied)/F.params.durationInMs,lt=!1;F.params.playOnce&&Qe>=1?(lt=!0,Qe=1):Qe%=1;for(const ft of Pe)Ge.to(ft).update({t:Qe});return yield i.a.State.Update(F.plugin,{state:z,tree:Ge,options:{doNotLogTiming:!0}}),lt?{kind:"finished"}:{kind:"next",state:{t:Qe}}})()});var b=n(127),_=n(5126),M=n(2086);const I=(0,M.e)(),l=(0,M.e)(),m=(0,_.k)(),u=t.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:v.t.Numeric(4e3,{min:100,max:2e4,step:100}),speed:v.t.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:v.t.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}),initialState:(oe,x)=>{var F;return{snapshot:null===(F=x.canvas3d)||void 0===F?void 0:F.camera.getSnapshot()}},getDuration:oe=>({kind:"fixed",durationMs:oe.durationInMs}),teardown:(oe,x,F)=>{var z;null===(z=F.canvas3d)||void 0===z||z.requestCameraReset({snapshot:x.snapshot,durationMs:0})},apply:(oe,x,F)=>(0,r.A)(function*(){var z,me;if(0===x.current)return{kind:"next",state:oe};const Pe=oe.snapshot;if(Pe.radiusMax<1e-4)return{kind:"finished"};const Ge=x.animation?(null===(z=x.animation)||void 0===z?void 0:z.currentFrame)/(x.animation.frameCount+1):(0,b.qE)(x.current/F.params.durationInMs,0,1),Xe=2*Math.PI*Ge*F.params.speed*("ccw"===F.params.direction?-1:1);M.e.sub(I,Pe.position,Pe.target),M.e.normalize(l,Pe.up),_.k.setAxisAngle(m,l,Xe),M.e.transformQuat(I,I,m);const Qe=M.e.add((0,M.e)(),Pe.target,I);return null===(me=F.plugin.canvas3d)||void 0===me||me.requestCameraReset({snapshot:{...Pe,position:Qe},durationMs:0}),Ge>=.99999?{kind:"finished"}:{kind:"next",state:oe}})()}),d=t.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:()=>({mode:v.t.MappedStatic("loop",{palindrome:v.t.Group({}),loop:v.t.Group({direction:v.t.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:v.t.Group({direction:v.t.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:v.t.MappedStatic("fixed",{fixed:v.t.Group({durationInS:v.t.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:v.t.Group({targetFps:v.t.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:v.t.Group({maxFps:v.t.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(oe){const x=oe.state.data,F=x.select(c.QX.Generators.ofTransformer(y.f.Model.ModelFromTrajectory));for(const z of F){const me=c.QX.findAncestorOfType(x.tree,x.cells,z.transform.ref,A.O.Molecule.Trajectory);if(me&&me.obj&&me.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:(oe,x)=>{var F;if("fixed"===(null===(F=oe.duration)||void 0===F?void 0:F.name))return{kind:"fixed",durationMs:1e3*oe.duration.params.durationInS};if("computed"===oe.duration.name){const z=x.state.data,me=z.select(c.QX.Generators.ofTransformer(y.f.Model.ModelFromTrajectory));let Pe=0;for(const Ge of me){const Xe=c.QX.findAncestorOfType(z.tree,z.cells,Ge.transform.ref,A.O.Molecule.Trajectory);Xe&&Xe.obj&&(Pe=Math.max(Math.ceil(1e3*Xe.obj.data.frameCount/oe.duration.params.targetFps),Pe))}return{kind:"fixed",durationMs:Pe}}return{kind:"unknown"}},initialState:()=>({}),apply:(oe,x,F)=>(0,r.A)(function*(){if("sequential"===F.params.duration.name&&x.current>0&&x.current-x.lastApplied<1e3/F.params.duration.params.maxFps)return{kind:"skip"};const z=F.plugin.state.data,me=z.select(c.QX.Generators.ofTransformer(y.f.Model.ModelFromTrajectory));if(0===me.length)return{kind:"finished"};const Pe=z.build(),Ge=F.params,Xe=oe.palindromeDirections||{};let Qe=!1,lt=!0;for(const ft of me){const wt=c.QX.findAncestorOfType(z.tree,z.cells,ft.transform.ref,A.O.Molecule.Trajectory);if(!wt||!wt.obj)continue;const Ut=wt.obj;Ut.data.frameCount<=1||Pe.to(ft).update(Jt=>{const gn=Ut.data.frameCount;if(1===gn)return Jt;if(lt=!1,"sequential"===Ge.duration.name){let Pn=1;if("once"===Ge.mode.name){if(Pn="backward"===Ge.mode.params.direction?-1:1,-1===Pn&&0===Jt.modelIndex||1===Pn&&Jt.modelIndex===gn-1)return Qe=!0,Jt}else"palindrome"===Ge.mode.name&&(Pn=0===Jt.modelIndex?1:Jt.modelIndex===gn-1?-1:Xe[ft.transform.ref]||1);Xe[ft.transform.ref]=Pn;let wn=(Jt.modelIndex+Pn)%gn;return wn<0&&(wn+=gn),Qe=Qe||-1===Pn&&0===wn||1===Pn&&wn===gn-1,{modelIndex:wn}}{const Pn="fixed"===Ge.duration.name?1e3*Ge.duration.params.durationInS:Math.ceil(1e3*Ut.data.frameCount/Ge.duration.params.targetFps);if("once"===Ge.mode.name&&x.current>=Pn)return Qe=!0,{modelIndex:Ut.data.frameCount-1};let wn=x.current%Pn/Pn;return"loop"===Ge.mode.name&&"backward"===Ge.mode.params.direction&&(wn=1-wn),"palindrome"===Ge.mode.name&&(wn*=2,wn>1&&(wn=2-wn)),{modelIndex:Math.min(Math.floor(Ut.data.frameCount*wn),Ut.data.frameCount-1)}}})}return lt||(yield i.a.State.Update(F.plugin,{state:z,tree:Pe,options:{doNotLogTiming:!0}})),lt||"once"===Ge.mode.name&&Qe?{kind:"finished"}:"palindrome"===Ge.mode.name?{kind:"next",state:{palindromeDirections:Xe}}:{kind:"next",state:{}}})()});function s(oe,x){return C.apply(this,arguments)}function C(){return C=(0,r.A)(function*(oe,x,F=!1){var z,me,Pe,Ge;x.snapshot.data&&(yield oe.runTask(oe.state.data.setSnapshot(x.snapshot.data)),null===(z=oe.canvas3d)||void 0===z||z.setProps({trackball:null===(Pe=null===(me=x.snapshot.canvas3d)||void 0===me?void 0:me.props)||void 0===Pe?void 0:Pe.trackball})),x.snapshot.camera&&(null===(Ge=oe.canvas3d)||void 0===Ge||Ge.requestCameraReset({snapshot:x.snapshot.camera.current,durationMs:F||"instant"===x.snapshot.camera.transitionStyle?0:x.snapshot.camera.transitionDurationInMs}))}),C.apply(this,arguments)}const h=t.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:()=>({}),canApply(oe){const x=oe.managers.snapshot.state.entries;return x.size<2?{canApply:!1,reason:"At least 2 states required."}:x.some(F=>!!F?.snapshot.startAnimation)?{canApply:!1,reason:"Nested animations not supported."}:{canApply:oe.managers.snapshot.state.entries.size>1}},setup(oe,x,F){const z=F.managers.snapshot.state.entries.get(0);s(F,z,!0)},getDuration:(oe,x)=>({kind:"fixed",durationMs:x.managers.snapshot.state.entries.toArray().reduce((F,z)=>{var me;return F+(null!==(me=z.snapshot.durationInMs)&&void 0!==me?me:0)},0)}),initialState:(oe,x)=>{const F=x.managers.snapshot.state.entries.toArray();return{totalDuration:F.reduce((z,me)=>{var Pe;return z+(null!==(Pe=me.snapshot.durationInMs)&&void 0!==Pe?Pe:0)},0),snapshots:F,currentIndex:0}},apply:(oe,x,F)=>(0,r.A)(function*(){var z;if(x.current>=oe.totalDuration)return{kind:"finished"};let me=0,Pe=0;for(const Ge of oe.snapshots){if(me+=null!==(z=Ge.snapshot.durationInMs)&&void 0!==z?z:0,x.current<me)break;Pe++}return Pe>=oe.snapshots.length?{kind:"finished"}:Pe===oe.currentIndex?{kind:"skip"}:(yield s(F.plugin,oe.snapshots[Pe]),{kind:"next",state:{...oe,currentIndex:Pe}})})()});var a=n(4987),S=n(445),D=n(1732),R=n(4824),f=n(675),p=n(1861),E=n(1372);const T=c.KW.build({from:A.O.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:(oe,x)=>{const{options:F}=x.dataFormats;return{source:v.t.MappedStatic("pdb-xray",{"pdb-xray":v.t.Group({provider:v.t.Group({id:v.t.Text("1tqn",{label:"Id"}),server:v.t.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:v.t.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":v.t.Group({provider:v.t.Group({id:v.t.Text("1tqn",{label:"Id"}),server:v.t.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:v.t.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":v.t.Group({provider:v.t.Group({id:v.t.Text("emd-8004",{label:"Id"}),server:v.t.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:v.t.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:v.t.Group({url:v.t.Url(""),isBinary:v.t.Boolean(!1),format:v.t.Select("auto",F)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(({params:oe},x)=>R.YZ.create("Download Density",function(){var F=(0,r.A)(function*(z){var me,Pe;const Ge=oe.source;let Xe,Qe;switch(Ge.name){case"url":Xe=Ge.params;break;case"pdb-xray":Xe="pdbe"===Ge.params.provider.server?{url:p.V.Url("2fofc"===Ge.params.type?`https://www.ebi.ac.uk/pdbe/coordinates/files/${Ge.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${Ge.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${Ge.params.provider.id}`}:{url:p.V.Url("2fofc"===Ge.params.type?`https://edmaps.rcsb.org/maps/${Ge.params.provider.id.toLowerCase()}_2fofc.dsn6`:`https://edmaps.rcsb.org/maps/${Ge.params.provider.id.toLowerCase()}_fofc.dsn6`),isBinary:!0,label:`RCSB X-ray map: ${Ge.params.provider.id}`};break;case"pdb-emd-ds":Xe="pdbe"===Ge.params.provider.server?{url:p.V.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${Ge.params.provider.id.toLowerCase()}/cell?detail=${Ge.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${Ge.params.provider.id}`}:{url:p.V.Url(`https://maps.rcsb.org/em/${Ge.params.provider.id.toLowerCase()}/cell?detail=${Ge.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${Ge.params.provider.id}`};break;case"pdb-xray-ds":Xe="pdbe"===Ge.params.provider.server?{url:p.V.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${Ge.params.provider.id.toLowerCase()}/cell?detail=${Ge.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${Ge.params.provider.id}`}:{url:p.V.Url(`https://maps.rcsb.org/x-ray/${Ge.params.provider.id.toLowerCase()}/cell?detail=${Ge.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${Ge.params.provider.id}`};break;default:(0,E.dr)(Ge)}const lt=yield x.builders.data.download(Xe);let ft;switch(Ge.name){case"url":Xe=Ge.params,Qe="auto"===Ge.params.format?x.dataFormats.auto((0,f.o)(p.V.getUrl(Xe.url)),null===(me=lt.cell)||void 0===me?void 0:me.obj):x.dataFormats.get(Ge.params.format);break;case"pdb-xray":ft=Ge.params.provider.id,Qe=x.dataFormats.get("pdbe"===Ge.params.provider.server?"ccp4":"dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":ft=Ge.params.provider.id,Qe=x.dataFormats.get("dscif");break;default:(0,E.dr)(Ge)}if(!Qe)return void x.log.warn("DownloadDensity: Format provider not found.");const wt=yield Qe.parse(x,lt,{entryId:ft});yield null===(Pe=Qe.visuals)||void 0===Pe?void 0:Pe.call(Qe,x,wt)});return function(z){return F.apply(this,arguments)}}())),L=c.KW.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:A.O.Volume.Data,isApplicable:oe=>!oe.data.colorVolume,params(oe,x){const F=x.state.data.select(c.QX.Generators.root.subtree().ofType(A.O.Volume.Data).filter(z=>{var me;return!(!z.obj||null!==(me=z.obj)&&void 0!==me&&me.data.colorVolume||z.obj===oe)}));return 0===F.length?{ref:v.t.Text("",{isHidden:!0,label:"Volume"})}:{ref:v.t.Select(F[0].transform.ref,F.map(z=>[z.transform.ref,z.obj.label]),{label:"Volume"})}}})(({ref:oe,params:x},z)=>z.build().to(oe).apply(y.f.Volume.AssignColorVolume,{ref:x.ref},{dependsOn:[x.ref]}).commit());var w=n(6511);const Q={Structure:D,Volume:e,DataFormat:w};var G=n(9909);const V=t.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:()=>({transtionDurationInMs:v.t.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply:oe=>({canApply:oe.managers.snapshot.state.entries.size>1}),initialState:()=>({}),apply:(oe,x,F)=>(0,r.A)(function*(){const z=F.plugin.managers.snapshot.state.entries;if(z.size<2)return{kind:"finished"};const me=x.current%F.params.transtionDurationInMs/F.params.transtionDurationInMs,Pe=Math.floor(x.current/F.params.transtionDurationInMs)%z.size;let Ge=Math.ceil(x.current/F.params.transtionDurationInMs);Ge===Pe&&Ge++,Ge%=z.size;const Xe=z.get(Pe).snapshot,Qe=z.get(Ge).snapshot;if(!Xe.data||!Qe.data)return{kind:"skip"};const lt=Xe.data.tree.transforms,ft=Qe.data.tree.transforms,wt=F.plugin.state.data,Ut=wt.build();for(const Jt of lt)for(const gn of ft){if(gn.ref!==Jt.ref||gn.version===Jt.version)continue;const Pn=c.Cn.fromJSON(Jt),wn=c.Cn.fromJSON(gn),Bn=wt.cells.get(Jt.ref);if(!Bn)continue;let Mn;Mn=Pn.transformer.definition.interpolate?Pn.transformer.definition.interpolate(Pn.params,wn.params,me,F.plugin):me<=.5?Pn.params:wn.params,(0,G.bN)(Bn,Mn)||Ut.to(Jt.ref).update(Mn)}return yield i.a.State.Update(F.plugin,{state:wt,tree:Ut,options:{doNotLogTiming:!0}}),{kind:"next",state:{}}})()}),U=t.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:()=>({durationInMs:v.t.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:oe=>({kind:"fixed",durationMs:oe.durationInMs}),setup:(oe,x,F)=>(0,r.A)(function*(){const z=F.state.data,me=z.select(c.QX.Generators.ofType(A.O.Molecule.Structure.Representation3D)),Pe=z.build();let Ge=!1;for(const Xe of me)z.select(c.QX.Generators.ofTransformer(y.f.Representation.SpinStructureRepresentation3D,Xe.transform.ref)).length>0||(Ge=!0,Pe.to(Xe.transform.ref).apply(y.f.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));if(Ge)return Pe.commit({doNotUpdateCurrent:!0})})(),teardown(oe,x,F){const z=F.state.data,me=z.select(c.QX.Generators.ofType(A.O.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(0===me.length)return;const Pe=z.build();for(const Ge of me)Pe.delete(Ge.transform.ref);return Pe.commit()},apply:(oe,x,F)=>(0,r.A)(function*(){var z;const me=F.plugin.state.data,Pe=me.select(c.QX.Generators.ofTransformer(y.f.Representation.SpinStructureRepresentation3D));if(0===Pe.length)return{kind:"finished"};const Ge=me.build(),Qe=(oe.t+(x.current-x.lastApplied)/F.params.durationInMs)%1;for(const lt of Pe)Ge.to(lt).update({...null===(z=lt.params)||void 0===z?void 0:z.values,t:Qe});return yield i.a.State.Update(F.plugin,{state:me,tree:Ge,options:{doNotLogTiming:!0}}),{kind:"next",state:{t:Qe}}})()});var N=n(4490);const k=(0,M.e)(),H=(0,M.e)(),$=(0,_.k)(),J=t.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:v.t.Numeric(4e3,{min:100,max:2e4,step:100}),speed:v.t.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:v.t.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}),initialState:(oe,x)=>({snapshot:x.canvas3d.camera.getSnapshot()}),getDuration:oe=>({kind:"fixed",durationMs:oe.durationInMs}),teardown:(oe,x,F)=>{var z;null===(z=F.canvas3d)||void 0===z||z.requestCameraReset({snapshot:x.snapshot,durationMs:0})},apply:(oe,x,F)=>(0,r.A)(function*(){var z,me;if(0===x.current)return{kind:"next",state:oe};const Pe=oe.snapshot;if(Pe.radiusMax<1e-4)return{kind:"finished"};const Ge=x.animation?(null===(z=x.animation)||void 0===z?void 0:z.currentFrame)/(x.animation.frameCount+1):(0,b.qE)(x.current/F.params.durationInMs,0,1),Xe=Math.sin(Ge*F.params.speed*Math.PI*2)*(0,N.pu)(F.params.angle);M.e.sub(k,Pe.position,Pe.target),M.e.normalize(H,Pe.up),_.k.setAxisAngle($,H,Xe),M.e.transformQuat(k,k,$);const Qe=M.e.add((0,M.e)(),Pe.target,k);return null===(me=F.plugin.canvas3d)||void 0===me||me.requestCameraReset({snapshot:{...Pe,position:Qe},durationMs:0}),Ge>=.99999?{kind:"finished"}:{kind:"next",state:oe}})()});var W;!function(oe){oe.Action=function x(z,me){return{action:z,customControl:me&&me.customControl,autoUpdate:me&&me.autoUpdate}},oe.Behavior=function F(z,me={}){return{transformer:z,defaultParams:me}}}(W||(W={}));var de=n(9619),ye=n(1133),j=n(6230),Z=n(3584),q=n(7561),Y=n(7788),ee=n(6853),g=n(4369),_e=n(2745),xe=n(229),le=n(1827),Ae=n(9611);const Be={color:v.t.Color(_e.s.black,{description:"Display color of the volume."}),wireframe:v.t.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:v.t.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},Ce=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]);class Re extends ye.dL{constructor(){super(...arguments),this.ref=c.QX.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name),this.getVisible=()=>{const F=this.ref;return!!F&&!this.plugin.state.data.cells.get(F).state.isHidden},this.toggleVisible=()=>{const x=this.plugin.state.data,F=this.ref;F&&(0,le.setSubtreeVisibility)(x,F,!x.cells.get(F).state.isHidden)}}componentDidUpdate(){this.ref=c.QX.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,x=>{this.ref===x.ref&&this.forceUpdate()})}render(){const x=this.props,{isRelative:F,stats:z}=x,me=x.channels[x.name],{min:Pe,max:Ge,mean:Xe,sigma:Qe}=z,lt=Math.round(100*("relative"===me.isoValue.kind?me.isoValue.relativeValue:me.isoValue.absoluteValue))/100;let ft=(Pe-Xe)/Qe,wt=(Ge-Xe)/Qe;if(!this.props.isUnbounded){const Bn=Ce.get(this.props.name);"em"===this.props.name?(ft=Math.max(Bn[0],ft),wt=Math.min(Bn[1],wt)):(ft=Bn[0],wt=Bn[1])}const Ut=Xe+Qe*ft,Jt=Xe+Qe*wt,gn=(0,xe.QX)(F?Math.round((Jt-Ut)/Qe)/100:Qe/100,2);return(0,de.jsx)(Z.U2,{label:x.label+(x.isRelative?" \u03c3":""),colorStripe:me.color,pivot:(0,de.jsxs)("div",{className:"msp-volume-channel-inline-controls",children:[(0,de.jsx)(Y.Ap,{value:lt,min:F?ft:Ut,max:F?wt:Jt,step:gn,onChange:Bn=>x.changeIso(x.name,Bn,F),onChangeImmediate:Bn=>x.changeIso(x.name,Bn,F),disabled:x.params.isDisabled,onEnter:x.params.events.onEnter}),(0,de.jsx)(Z.K0,{svg:this.getVisible()?Ae.zs:Ae.qF,onClick:this.toggleVisible,toggleState:!1,disabled:x.params.isDisabled})]}),controls:(0,de.jsx)(q.y1,{onChange:({name:Bn,value:Mn})=>x.changeParams(x.name,Bn,Mn),params:Be,values:me,onEnter:x.params.events.onEnter,isDisabled:x.params.isDisabled})})}}class ke extends ye.dL{constructor(){super(...arguments),this.changeIso=(x,F,z)=>{const me=this.props.params;this.newParams({...me,entry:{name:me.entry.name,params:{...me.entry.params,channels:{...me.entry.params.channels,[x]:{...me.entry.params.channels[x],isoValue:z?ee.f.IsoValue.relative(F):ee.f.IsoValue.absolute(F)}}}}})},this.changeParams=(x,F,z)=>{const me=this.props.params;this.newParams({...me,entry:{name:me.entry.name,params:{...me.entry.params,channels:{...me.entry.params.channels,[x]:{...me.entry.params.channels[x],[F]:z}}}}})},this.changeOption=({name:x,value:F})=>{const z=this.props.params;if("entry"===x)this.newParams({...z,entry:{name:F,params:z.entry.params}});else{const me=this.props.b.data,Pe="em"===me.info.kind,Ge=F.params.isRelative,Xe=me.info.header.sampling[0],Qe=z.entry.params.channels,ft={...z.entry.params.view.name===F.name?z.entry.params.view.params:this.props.info.params.entry.map(z.entry.name).params.view.map(F.name).defaultValue};"selection-box"===F.name?ft.radius=F.params.radius:"camera-target"===F.name?(ft.radius=F.params.radius,ft.dynamicDetailLevel=F.params.dynamicDetailLevel):"box"===F.name?(ft.bottomLeft=F.params.bottomLeft,ft.topRight=F.params.topRight):"auto"===F.name&&(ft.radius=F.params.radius,ft.selectionDetailLevel=F.params.selectionDetailLevel),ft.isUnbounded=!!F.params.isUnbounded,this.newParams({...z,entry:{name:z.entry.name,params:{...z.entry.params,view:{name:F.name,params:ft},detailLevel:F.params.detailLevel,channels:Pe?{em:this.convert(Qe.em,Xe.valuesInfo[0],Ge)}:{"2fo-fc":this.convert(Qe["2fo-fc"],Xe.valuesInfo[0],Ge),"fo-fc(+ve)":this.convert(Qe["fo-fc(+ve)"],Xe.valuesInfo[1],Ge),"fo-fc(-ve)":this.convert(Qe["fo-fc(-ve)"],Xe.valuesInfo[1],Ge)}}}})}}}areInitial(x){return v.t.areEqual(this.props.info.params,x,this.props.info.initialValues)}newParams(x){this.props.events.onChange(x,this.areInitial(x))}convert(x,F,z){return{...x,isoValue:z?ee.f.IsoValue.toRelative(x.isoValue,F):ee.f.IsoValue.toAbsolute(x.isoValue,F)}}render(){if(!this.props.b)return null;const x=this.props.b.data,F="em"===x.info.kind,z=F?"em":"2fo-fc",me=this.props.params,Pe=this.props.info.params.entry.map(me.entry.name),Ge=Pe.params.detailLevel,Xe={...Ge,label:"Dynamic Detail",defaultValue:Pe.params.view.map("camera-target").params.dynamicDetailLevel.defaultValue},Qe={...Ge,label:"Selection Detail",defaultValue:Pe.params.view.map("auto").params.selectionDetailLevel.defaultValue},lt=x.info.header.sampling[0],ft="relative"===me.entry.params.channels[z].isoValue.kind,wt=v.t.Boolean(ft,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),Ut=!!me.entry.params.view.params.isUnbounded,Jt=v.t.Boolean(Ut,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),gn="off"===me.entry.params.view.name,Pn={entry:v.t.Select(me.entry.name,x.data.entries.map(Bn=>[Bn.dataId,Bn.dataId]),{isHidden:gn,description:"Which entry with volume data to display."}),view:v.t.MappedStatic(me.entry.params.view.name,{off:v.t.Group({isRelative:v.t.Boolean(ft,{isHidden:!0}),isUnbounded:v.t.Boolean(Ut,{isHidden:!0})},{description:"Display off."}),box:v.t.Group({bottomLeft:v.t.Vec3(g.eB.zero()),topRight:v.t.Vec3(g.eB.zero()),detailLevel:Ge,isRelative:wt,isUnbounded:Jt},{description:"Static box defined by cartesian coords."}),"selection-box":v.t.Group({radius:v.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),detailLevel:Ge,isRelative:wt,isUnbounded:Jt},{description:"Box around focused element."}),"camera-target":v.t.Group({radius:v.t.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),detailLevel:{...Ge,isHidden:!0},dynamicDetailLevel:Xe,isRelative:wt,isUnbounded:Jt},{description:"Box around camera target."}),cell:v.t.Group({detailLevel:Ge,isRelative:wt,isUnbounded:Jt},{description:"Box around the structure's bounding box."}),auto:v.t.Group({radius:v.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),detailLevel:Ge,selectionDetailLevel:Qe,isRelative:wt,isUnbounded:Jt},{description:"Box around focused element."})},{options:j.h.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.'})},wn={entry:me.entry.name,view:{name:me.entry.params.view.name,params:{detailLevel:me.entry.params.detailLevel,radius:me.entry.params.view.params.radius,bottomLeft:me.entry.params.view.params.bottomLeft,topRight:me.entry.params.view.params.topRight,selectionDetailLevel:me.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:me.entry.params.view.params.dynamicDetailLevel,isRelative:ft,isUnbounded:Ut}}};return gn?(0,de.jsx)(q.y1,{onChange:this.changeOption,params:Pn,values:wn,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,de.jsxs)(de.Fragment,{children:[!F&&(0,de.jsx)(Re,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:me.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:ft,params:this.props,stats:lt.valuesInfo[0],isUnbounded:Ut}),!F&&(0,de.jsx)(Re,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:me.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:ft,params:this.props,stats:lt.valuesInfo[1],isUnbounded:Ut}),!F&&(0,de.jsx)(Re,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:me.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:ft,params:this.props,stats:lt.valuesInfo[1],isUnbounded:Ut}),F&&(0,de.jsx)(Re,{label:"EM",name:"em",bCell:this.props.bCell,channels:me.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:ft,params:this.props,stats:lt.valuesInfo[0],isUnbounded:Ut}),(0,de.jsx)(q.y1,{onChange:this.changeOption,params:Pn,values:wn,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}}var ue,Oe=n(1025),Se=n(39),Ve=n(7786),Ne=n(152),K=n(3386),ne=n(5964),be=n(6697),Te=n(3177),ie=n(6345);!function(oe){oe.Registry=class x{constructor(){this.providers=(0,Se.uY)().asMutable(),this.defaultAutoAttachValues=new Map}getParams(z){const me={},Pe=[],Ge=[];if(z){const Xe=this.providers.values();for(;;){const Qe=Xe.next();if(Qe.done)break;const lt=Qe.value;lt.isApplicable(z)&&(lt.isHidden||(Pe.push([lt.descriptor.name,lt.label]),this.defaultAutoAttachValues.get(lt.descriptor.name)&&Ge.push(lt.descriptor.name)),me[lt.descriptor.name]=v.t.Group({...lt.getParams(z)},{label:lt.label,isHidden:lt.isHidden}))}}return{autoAttach:v.t.MultiSelect(Ge,Pe),properties:v.t.Group(me,{isFlat:!0})}}setDefaultAutoAttach(z,me){this.defaultAutoAttachValues.set(z,me)}get(z){if(!this.providers.get(z))throw new Error(`Custom property '${z}' is not registered.`);return this.providers.get(z)}register(z,me){this.providers.set(z.descriptor.name,z),this.defaultAutoAttachValues.set(z.descriptor.name,me)}unregister(z){this.providers.delete(z),this.defaultAutoAttachValues.delete(z)}}}(ue||(ue={}));var re=n(6990);class ve{get dataState(){return this.plugin.state.data}rawData(x,F){return this.dataState.build().toRoot().apply(re.RawData,x,F).commit({revertOnError:!0})}download(x,F){return this.dataState.build().toRoot().apply(re.Download,x,F).commit({revertOnError:!0})}downloadBlob(x,F){return this.dataState.build().toRoot().apply(re.DownloadBlob,x,F).commit({revertOnError:!0})}readFile(x,F){var z=this;return(0,r.A)(function*(){var me,Pe,Ge;return{data:yield z.dataState.build().toRoot().apply(re.ReadFile,x,F).commit({revertOnError:!0}),fileInfo:(0,f.o)(null!==(Ge=null===(Pe=null===(me=x.file)||void 0===me?void 0:me.file)||void 0===Pe?void 0:Pe.name)&&void 0!==Ge?Ge:"")}})()}constructor(x){this.plugin=x}}var ce=n(8382),se=n(2629),ae=n(9359),ge=n(1893),Ie=n(8010),Le=n(9880),nt=n(6115),je=n(237);class Lt{get dataState(){return this.plugin.state.data}resolveProvider(x){var F;return"string"==typeof x?null!==(F=Le.Bj[x])&&void 0!==F?F:(0,ce.L9)(this._providers,z=>z.id===x):x}hasPreset(x){for(const F of this._providers)if(!F.isApplicable||F.isApplicable(x,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(x){if(!x)return this.providers;const F=[];for(const z of this._providers)z.isApplicable&&!z.isApplicable(x,this.plugin)||F.push(z);return F}getPresetSelect(x){const F=[];for(const z of this._providers)x&&z.isApplicable&&!z.isApplicable(x,this.plugin)||F.push([z.id,z.display.name,z.display.group]);return v.t.Select("auto",F)}getPresetsWithOptions(x){const F=[],z=Object.create(null);for(const me of this._providers)me.isApplicable&&!me.isApplicable(x,this.plugin)||(F.push([me.id,me.display.name]),z[me.id]=me.params?v.t.Group(me.params(x,this.plugin)):v.t.EmptyGroup());return 0===F.length?v.t.MappedStatic("",{"":v.t.EmptyGroup()}):v.t.MappedStatic(F[0][0],z,{options:F})}registerPreset(x){if(this.providerMap.has(x.id))throw new Error(`Representation provider with id '${x.id}' already registered.`);this._providers.push(x),this.providerMap.set(x.id,x)}unregisterPreset(x){this.providerMap.delete(x.id),(0,nt.mO)(this._providers,x)}applyPreset(x,F,z){var me;const Pe=this.resolveProvider(F);if(!Pe)return;const Xe=c.so.resolveAndCheck(this.plugin.state.data,x);if(!Xe)return void(se.Zq||console.warn("Applying structure repr. provider to bad cell."));const Qe=(null===(me=Pe.params)||void 0===me?void 0:me.call(Pe,Xe.obj,this.plugin))||{};let lt=z||(Pe.params?v.t.getDefaultValues(Qe):{});const ft=this.plugin.config.get(je.AB.Structure.DefaultRepresentationPresetParams);lt=v.t.merge(Qe,ft,lt);const wt=R.YZ.create(`${Pe.display.name}`,()=>Pe.apply(Xe,lt,this.plugin));return this.plugin.runTask(wt)}addRepresentation(x,F,z){var me=this;return(0,r.A)(function*(){const Pe=me.dataState.build(),Ge=me.buildRepresentation(Pe,x,F,z);if(Ge)return yield Pe.commit(),Ge})()}buildRepresentation(x,F,z,me){var Pe,Ge;if(!F)return;const Xe=null===(Ge=null===(Pe=c.so.resolveAndCheck(this.dataState,F))||void 0===Pe?void 0:Pe.obj)||void 0===Ge?void 0:Ge.data;if(!Xe)return;const Qe=(0,ge.pQ)(this.plugin,Xe,z);return me?.tag?x.to(F).applyOrUpdateTagged(me.tag,Ie.StructureRepresentation3D,Qe,{state:me?.initialState}).selector:x.to(F).apply(Ie.StructureRepresentation3D,Qe,{state:me?.initialState}).selector}constructor(x){this.plugin=x,this._providers=[],this.providerMap=new Map,this.defaultProvider=Le.Bj.auto,(0,ae.IF)(Le.Bj,F=>this.registerPreset(F))}}var Je=n(9136),en=n(9651),Bt=n(5384),pn=n(1295),$e=n(5589),mt=n(8103);function _t(oe){return oe}!function(oe){oe.CommonParams=(x,F)=>({modelProperties:v.t.Optional(v.t.Group(c.xE.getParamDefinition(y.f.Model.CustomModelProperties,void 0,F))),structureProperties:v.t.Optional(v.t.Group(c.xE.getParamDefinition(y.f.Model.CustomStructureProperties,void 0,F))),representationPreset:v.t.Optional(v.t.Text("auto"))})}(_t||(_t={}));const Me=_t.CommonParams,ut=_t({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:oe=>!0,params:(oe,x)=>({model:v.t.Optional(v.t.Group(c.xE.getParamDefinition(y.f.Model.ModelFromTrajectory,oe,x))),showUnitcell:v.t.Optional(v.t.Boolean(!1)),structure:v.t.Optional(pn.z.getParams(void 0,"assembly").type),representationPresetParams:v.t.Optional(v.t.Group(Le.n9.CommonParams)),...Me(oe,x)}),apply:(oe,x,F)=>(0,r.A)(function*(){const z=F.builders.structure,me=yield z.createModel(oe,x.model),Pe=yield z.insertModelProperties(me,x.modelProperties),Ge=yield z.createStructure(Pe||me,x.structure),Xe=yield z.insertStructureProperties(Ge,x.structureProperties),Qe=void 0===x.showUnitcell||x.showUnitcell?yield z.tryCreateUnitcell(Pe,void 0,{isHidden:!0}):void 0,lt=x.representationPreset||F.config.get(je.AB.Structure.DefaultRepresentationPreset)||Le.Bj.auto.id;return{model:me,modelProperties:Pe,unitcell:Qe,structure:Ge,structureProperties:Xe,representation:yield F.builders.structure.representation.applyPreset(Xe,lt,x.representationPresetParams)}})()}),sn=_t({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:oe=>oe.data.frameCount>1,params:(oe,x)=>({useDefaultIfSingleModel:v.t.Optional(v.t.Boolean(!1)),representationPresetParams:v.t.Optional(v.t.Group(Le.n9.CommonParams)),...Me(oe,x)}),apply:(oe,x,F)=>(0,r.A)(function*(){var z,me;const Pe=null===(me=null===(z=c.so.resolveAndCheck(F.state.data,oe))||void 0===z?void 0:z.obj)||void 0===me?void 0:me.data;if(!Pe)return{};if(1===Pe.frameCount&&x.useDefaultIfSingleModel)return ut.apply(oe,x,F);const Ge=F.builders.structure,Xe=[],Qe=[];for(let lt=0;lt<Pe.frameCount;lt++){const ft=yield Ge.createModel(oe,{modelIndex:lt}),wt=yield Ge.insertModelProperties(ft,x.modelProperties,{isCollapsed:!0}),Ut=yield Ge.createStructure(wt||ft,{name:"model",params:{}}),Jt=yield Ge.insertStructureProperties(Ut,x.structureProperties);Xe.push(ft),Qe.push(Ut);const gn=Ut.obj?(0,$e.V8)(Ut.obj.data,{elementCountFactor:Pe.frameCount}):"medium",Pn=x.representationPreset||F.config.get(je.AB.Structure.DefaultRepresentationPreset)||Le.Bj.auto.id;yield Ge.representation.applyPreset(Jt,Pn,{theme:{globalName:"trajectory-index"},quality:gn})}return{models:Xe,structures:Qe}})()}),gt=(oe,x)=>({model:v.t.Optional(v.t.Group(c.xE.getParamDefinition(y.f.Model.ModelFromTrajectory,oe,x))),...Me(oe,x)});function yt(oe,x,F,z){return At.apply(this,arguments)}function At(){return At=(0,r.A)(function*(oe,x,F,z){const me=z.builders.structure,Pe=yield me.createModel(x,F.model),Ge=yield me.insertModelProperties(Pe,F.modelProperties),Xe=yield me.createStructure(Ge||Pe,{name:"symmetry",params:oe}),Qe=yield me.insertStructureProperties(Xe,F.structureProperties),lt=yield me.tryCreateUnitcell(Ge,void 0,{isHidden:!1}),ft=F.representationPreset||z.config.get(je.AB.Structure.DefaultRepresentationPreset)||Le.Bj.auto.id;return{model:Pe,modelProperties:Ge,unitcell:lt,structure:Xe,structureProperties:Qe,representation:yield z.builders.structure.representation.applyPreset(Qe,ft,{theme:{globalName:oe.theme}})}}),At.apply(this,arguments)}const Gt=_t({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:oe=>Je.Kx.hasCrystalSymmetry(oe.data.representative),params:gt,apply:(oe,x,F)=>(0,r.A)(function*(){return yield yt({ijkMin:g.eB.create(0,0,0),ijkMax:g.eB.create(0,0,0)},oe,x,F)})()}),rn=_t({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:oe=>Je.Kx.hasCrystalSymmetry(oe.data.representative),params:gt,apply:(oe,x,F)=>(0,r.A)(function*(){return yield yt({ijkMin:g.eB.create(-1,-1,-1),ijkMax:g.eB.create(1,1,1),theme:"operator-hkl"},oe,x,F)})()}),Mt=_t({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212b, i.e., symmetry mates."},isApplicable:oe=>Je.Kx.hasCrystalSymmetry(oe.data.representative),params:(oe,x)=>({model:v.t.Optional(v.t.Group(c.xE.getParamDefinition(y.f.Model.ModelFromTrajectory,oe,x))),...Me(oe,x)}),apply:(oe,x,F)=>(0,r.A)(function*(){const z=F.builders.structure,me=yield z.createModel(oe,x.model),Pe=yield z.insertModelProperties(me,x.modelProperties),Ge=yield z.createStructure(Pe||me,{name:"symmetry-mates",params:{radius:5}}),Xe=yield z.insertStructureProperties(Ge,x.structureProperties),Qe=yield z.tryCreateUnitcell(Pe,void 0,{isHidden:!0}),lt=x.representationPreset||F.config.get(je.AB.Structure.DefaultRepresentationPreset)||Le.Bj.auto.id;return{model:me,modelProperties:Pe,unitcell:Qe,structure:Ge,structureProperties:Xe,representation:yield F.builders.structure.representation.applyPreset(Xe,lt,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:mt.PO.defaultValues}}}}})}})()}),nn={default:ut,"all-models":sn,unitcell:Gt,supercell:rn,crystalContacts:Mt};class bn{resolveProvider(x){var F;return"string"==typeof x?null!==(F=nn[x])&&void 0!==F?F:(0,ce.L9)(this._providers,z=>z.id===x):x}hasPreset(x){for(const F of this._providers)if(!F.isApplicable||F.isApplicable(x,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(x){if(!x)return this.providers;const F=[];for(const z of this._providers)z.isApplicable&&!z.isApplicable(x,this.plugin)||F.push(z);return F}getPresetSelect(x){const F=[];for(const z of this._providers)x&&z.isApplicable&&!z.isApplicable(x,this.plugin)||F.push([z.id,z.display.name]);return v.t.Select("auto",F)}getPresetsWithOptions(x){const F=[],z=Object.create(null);for(const me of this._providers)me.isApplicable&&!me.isApplicable(x,this.plugin)||(F.push([me.id,me.display.name]),z[me.id]=me.params?v.t.Group(me.params(x,this.plugin)):v.t.EmptyGroup());return 0===F.length?v.t.MappedStatic("",{"":v.t.EmptyGroup()}):v.t.MappedStatic(F[0][0],z,{options:F})}registerPreset(x){if(this.providerMap.has(x.id))throw new Error(`Hierarchy provider with id '${x.id}' already registered.`);this._providers.push(x),this.providerMap.set(x.id,x)}unregisterPreset(x){this.providerMap.delete(x.id),(0,nt.mO)(this._providers,x)}applyPreset(x,F,z){const me=this.resolveProvider(F);if(!me)return;const Ge=c.so.resolveAndCheck(this.plugin.state.data,x);if(!Ge)return void(se.Zq||console.warn("Applying hierarchy preset provider to bad cell."));const Xe=z||(me.params?v.t.getDefaultValues(me.params(Ge.obj,this.plugin)):{}),Qe=R.YZ.create(`${me.display.name}`,()=>me.apply(Ge,Xe,this.plugin));return this.plugin.runTask(Qe)}constructor(x){this.plugin=x,this._providers=[],this.providerMap=new Map,this.defaultProvider=nn.default,(0,ae.IF)(nn,F=>this.registerPreset(F))}}class Dn{get dataState(){return this.plugin.state.data}parseTrajectoryData(x,F){var z=this;return(0,r.A)(function*(){const me="string"==typeof F?z.plugin.dataFormats.get(F):F;if(!me)throw new Error(`'${F}' is not a supported data format.`);const{trajectory:Pe}=yield me.parse(z.plugin,x);return Pe})()}parseTrajectoryBlob(x,F){return this.dataState.build().to(x).apply(y.f.Data.ParseBlob,F,{state:{isGhost:!0}}).apply(y.f.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(x,F){const z=c.so.resolveAndCheck(this.dataState,x);if(!z)throw new Error("Invalid data cell.");return A.O.Data.Blob.is(z.obj)?this.parseTrajectoryBlob(x,F):this.parseTrajectoryData(x,F)}createModel(x,F,z){return this.dataState.build().to(x).apply(y.f.Model.ModelFromTrajectory,F||{modelIndex:0},{state:z}).commit({revertOnError:!0})}insertModelProperties(x,F,z){return this.dataState.build().to(x).apply(y.f.Model.CustomModelProperties,F,{state:z}).commit({revertOnError:!0})}tryCreateUnitcell(x,F,z){var me,Pe,Ge;const Xe=this.dataState,Qe=null===(Pe=null===(me=c.so.resolveAndCheck(Xe,x))||void 0===me?void 0:me.obj)||void 0===Pe?void 0:Pe.data;if(!Qe)return;const lt=null===(Ge=en.i.Provider.get(Qe))||void 0===Ge?void 0:Ge.spacegroup.cell;return Bt.O8.isZero(lt)?void 0:Xe.build().to(x).apply(y.f.Representation.ModelUnitcell3D,F,{state:z}).commit({revertOnError:!0})}createStructure(x,F,z,me){var Pe;const Ge=this.dataState;if(!F){const Qe=c.so.resolveAndCheck(Ge,x);if(Qe){const lt=en.i.Provider.get(null===(Pe=Qe.obj)||void 0===Pe?void 0:Pe.data);(!lt||0===lt?.assemblies.length)&&(F={name:"model",params:{}})}}return Ge.build().to(x).apply(y.f.Model.StructureFromModel,{type:F||{name:"assembly",params:{}}},{state:z,tags:me}).commit({revertOnError:!0})}insertStructureProperties(x,F){return this.dataState.build().to(x).apply(y.f.Model.CustomStructureProperties,F).commit({revertOnError:!0})}isComponentTransform(x){return x.transform.transformer===y.f.Model.StructureComponent}tryCreateComponent(x,F,z,me){var Pe=this;return(0,r.A)(function*(){var Ge,Xe;const Qe=Pe.dataState,lt=Qe.build().to(x),ft=`structure-component-${z}`,wt=lt.applyOrUpdateTagged(ft,y.f.Model.StructureComponent,F,{tags:me?[...me,ft]:[ft]});yield wt.commit();const Ut=wt.selector;if(Ut.isOk&&0!==(null===(Xe=null===(Ge=Ut.cell)||void 0===Ge?void 0:Ge.obj)||void 0===Xe?void 0:Xe.data.elementCount))return Ut;yield Qe.build().delete(Ut.ref).commit()})()}tryCreateComponentFromExpression(x,F,z,me){return this.tryCreateComponent(x,{type:{name:"expression",params:F},nullIfEmpty:!0,label:(me?.label||"").trim()},z,me?.tags)}tryCreateComponentStatic(x,F,z){return this.tryCreateComponent(x,{type:{name:"static",params:F},nullIfEmpty:!0,label:(z?.label||"").trim()},`static-${F}`,z?.tags)}tryCreateComponentFromSelection(x,F,z,me){var Pe=this;return this.plugin.runTask(R.YZ.create("Query Component",function(){var Ge=(0,r.A)(function*(Xe){var Qe,lt;let{label:ft,tags:wt}=me||{};ft=(ft||"").trim();const Ut=null===(lt=null===(Qe=c.so.resolveAndCheck(Pe.dataState,x))||void 0===Qe?void 0:Qe.obj)||void 0===lt?void 0:lt.data;if(!Ut)return;const Jt=F.referencesCurrent?{type:{name:"bundle",params:Je.iZ.Bundle.fromSelection(yield F.getSelection(Pe.plugin,Xe,Ut))},nullIfEmpty:!0,label:ft||F.label}:{type:{name:"expression",params:F.expression},nullIfEmpty:!0,label:ft||F.label};return F.ensureCustomProperties&&(yield F.ensureCustomProperties({runtime:Xe,assetManager:Pe.plugin.managers.asset},Ut)),Pe.tryCreateComponent(x,Jt,z,wt)});return function(Xe){return Ge.apply(this,arguments)}}()))}constructor(x){this.plugin=x,this.hierarchy=new bn(this.plugin),this.representation=new Lt(this.plugin)}}var Ct,$t,jt=n(5953),It=n(1425),Dt=n(3442);!function(oe){oe.create=function x(F){const{name:z}=F;return{descriptor:F,get:me=>me._propertyData[z],set(me,Pe){me.customProperties.add(F),me._propertyData[z]=Pe}}}}(Ct||(Ct={})),function(oe){oe.Descriptor={name:"recommended_iso_value"},oe.Provider=Ct.create(oe.Descriptor)}($t||($t={}));var Vt=n(6570);const Wt="Volume";function yn(oe,x){return Zt.apply(this,arguments)}function Zt(){return Zt=(0,r.A)(function*(oe,x){if(!x)return;const{entryId:F}=x;return F&&F.toLowerCase().startsWith("emd")?oe.runTask(R.YZ.create("Try Set Recommended IsoValue",function(){var z=(0,r.A)(function*(me){try{const Pe=yield(0,Vt.$A)(oe,me,F);$t.Provider.set(x,ee.f.IsoValue.absolute(Pe))}catch(Pe){console.warn(Pe)}});return function(me){return z.apply(this,arguments)}}())):void 0}),Zt.apply(this,arguments)}function kt(oe){const x=$t.Provider.get(oe);if(x)return"relative"===x.kind?x:ee.f.adjustedIsoValue(oe,x.absoluteValue,"absolute")}function Ot(oe,x){return An.apply(this,arguments)}function An(){return An=(0,r.A)(function*(oe,x){const F={},z=x.volume.data&&kt(x.volume.data);return z&&(F.isoValue=z),[yield oe.build().to(x.volume).apply(y.f.Representation.VolumeRepresentation3D,(0,Dt.aK)(oe,x.volume.data,{type:"isosurface",typeParams:F})).commit()]}),An.apply(this,arguments)}const jn=(0,It.N)({label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:Wt,binaryExtensions:["ccp4","mrc","map"],parse:function(){var oe=(0,r.A)(function*(x,F,z){const me=x.build().to(F).apply(y.f.Data.ParseCcp4,{},{state:{isGhost:!0}}),Pe=me.apply(y.f.Volume.VolumeFromCcp4,{entryId:z?.entryId});return yield me.commit({revertOnError:!0}),yield yn(x,Pe.selector.data),{format:me.selector,volume:Pe.selector}});return function(F,z,me){return oe.apply(this,arguments)}}(),visuals:Ot}),On=(0,It.N)({label:"DSN6/BRIX",description:"DSN6/BRIX",category:Wt,binaryExtensions:["dsn6","brix"],parse:function(){var oe=(0,r.A)(function*(x,F,z){const me=x.build().to(F).apply(y.f.Data.ParseDsn6,{},{state:{isGhost:!0}}),Pe=me.apply(y.f.Volume.VolumeFromDsn6,{entryId:z?.entryId});return yield me.commit({revertOnError:!0}),yield yn(x,Pe.selector.data),{format:me.selector,volume:Pe.selector}});return function(F,z,me){return oe.apply(this,arguments)}}(),visuals:Ot}),fr=(0,It.N)({label:"DX",description:"DX",category:Wt,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(){var oe=(0,r.A)(function*(x,F,z){const Pe=x.build().to(F).apply(y.f.Data.ParseDx,{},{state:{isGhost:!0}}).apply(y.f.Volume.VolumeFromDx,{entryId:z?.entryId});return yield Pe.commit({revertOnError:!0}),yield yn(x,Pe.selector.data),{volume:Pe.selector}});return function(F,z,me){return oe.apply(this,arguments)}}(),visuals:Ot}),Dr=(0,It.N)({label:"Cube",description:"Cube",category:Wt,stringExtensions:["cub","cube"],parse:function(){var oe=(0,r.A)(function*(x,F,z){const me=x.build().to(F).apply(y.f.Data.ParseCube,{},{state:{isGhost:!0}}),Pe=me.apply(y.f.Volume.VolumeFromCube,{entryId:z?.entryId}),Ge=me.apply(y.f.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(y.f.Model.ModelFromTrajectory).apply(y.f.Model.StructureFromModel);return yield me.commit({revertOnError:!0}),yield yn(x,Pe.selector.data),{format:me.selector,volume:Pe.selector,structure:Ge.selector}});return function(F,z,me){return oe.apply(this,arguments)}}(),visuals:function(){var oe=(0,r.A)(function*(x,F){var z,me;const Pe=x.build(),Ge=[],Xe=null===(me=null===(z=F.volume.cell)||void 0===z?void 0:z.obj)||void 0===me?void 0:me.data;if(Xe&&ee.f.isOrbitals(Xe)){const ft=Pe.to(F.volume).apply(y.f.Representation.VolumeRepresentation3D,(0,Dt.aK)(x,Xe,{type:"isosurface",typeParams:{isoValue:ee.f.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:_e.s.blue}})),wt=Pe.to(F.volume).apply(y.f.Representation.VolumeRepresentation3D,(0,Dt.aK)(x,Xe,{type:"isosurface",typeParams:{isoValue:ee.f.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:_e.s.red}}));Ge.push(ft.selector,wt.selector)}else{const ft=Pe.to(F.volume).apply(y.f.Representation.VolumeRepresentation3D,(0,Dt.aK)(x,Xe,{type:"isosurface",typeParams:{isoValue:ee.f.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:_e.s.grey}}));Ge.push(ft.selector)}const Qe=yield x.builders.structure.representation.applyPreset(F.structure,"auto");yield Pe.commit();const lt=[];return(0,ae.IF)(Qe?.representations,ft=>{ft&&lt.push(ft)}),[...Ge,...lt]});return function(F,z){return oe.apply(this,arguments)}}()}),Pr=(0,It.N)({label:"DensityServer CIF",description:"DensityServer CIF",category:Wt,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(oe,x)=>"dscif"===(0,It.v)(oe,x),parse:function(){var oe=(0,r.A)(function*(x,F,z){var me;const Pe=yield x.build().to(F).apply(y.f.Data.ParseCif).commit(),Ge=x.build().to(Pe),Xe=Pe.obj.data.blocks;if(0===Xe.length)throw new Error("no data blocks");const Qe=[];let lt=0;for(const ft of Xe){if("SERVER"===ft.header.toUpperCase())continue;const wt=Array.isArray(z?.entryId)?z?.entryId[lt]:z?.entryId;(null===(me=ft.categories.volume_data_3d_info)||void 0===me?void 0:me.rowCount)>0&&(Qe.push(Ge.apply(y.f.Volume.VolumeFromDensityServerCif,{blockHeader:ft.header,entryId:wt}).selector),lt++)}yield Ge.commit();for(const ft of Qe)yield yn(x,ft.data);return{volumes:Qe}});return function(F,z,me){return oe.apply(this,arguments)}}(),visuals:function(){var oe=(0,r.A)(function*(x,F){const{volumes:z}=F,me=x.build(),Pe=[];if(z.length>0){const Ge=z[0].data&&kt(z[0].data)||ee.f.IsoValue.relative(1.5);Pe[0]=me.to(z[0]).apply(y.f.Representation.VolumeRepresentation3D,Ie.VolumeRepresentation3DHelpers.getDefaultParamsStatic(x,"isosurface",{isoValue:Ge,alpha:1},"uniform",{value:_e.s.teal})).selector}if(z.length>1){const Ge=Ie.VolumeRepresentation3DHelpers.getDefaultParamsStatic(x,"isosurface",{isoValue:ee.f.IsoValue.relative(3),alpha:.3},"uniform",{value:_e.s.green}),Xe=Ie.VolumeRepresentation3DHelpers.getDefaultParamsStatic(x,"isosurface",{isoValue:ee.f.IsoValue.relative(-3),alpha:.3},"uniform",{value:_e.s.red});Pe[Pe.length]=me.to(z[1]).apply(y.f.Representation.VolumeRepresentation3D,Ge).selector,Pe[Pe.length]=me.to(z[1]).apply(y.f.Representation.VolumeRepresentation3D,Xe).selector}return yield me.commit(),Pe});return function(F,z){return oe.apply(this,arguments)}}()}),or=(0,It.N)({label:"Segmentation CIF",description:"Segmentation CIF",category:Wt,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(oe,x)=>"segcif"===(0,It.v)(oe,x),parse:function(){var oe=(0,r.A)(function*(x,F){var z;const me=yield x.build().to(F).apply(y.f.Data.ParseCif).commit(),Pe=x.build().to(me),Ge=me.obj.data.blocks;if(0===Ge.length)throw new Error("no data blocks");const Xe=[];for(const Qe of Ge)"SERVER"!==Qe.header.toUpperCase()&&(null===(z=Qe.categories.volume_data_3d_info)||void 0===z?void 0:z.rowCount)>0&&Xe.push(Pe.apply(y.f.Volume.VolumeFromSegmentationCif,{blockHeader:Qe.header}).selector);return yield Pe.commit(),{volumes:Xe}});return function(F,z){return oe.apply(this,arguments)}}(),visuals:function(){var oe=(0,r.A)(function*(x,F){const{volumes:z}=F,me=x.build(),Pe=[];return z.length>0&&ee.f.Segmentation.get(z[0].data)&&(Pe[Pe.length]=me.to(z[0]).apply(y.f.Representation.VolumeRepresentation3D,Ie.VolumeRepresentation3DHelpers.getDefaultParams(x,"segment",z[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),yield me.commit(),Pe});return function(F,z){return oe.apply(this,arguments)}}()}),Nr=[["ccp4",jn],["dsn6",On],["cube",Dr],["dx",fr],["dscif",Pr],["segcif",or]],Jr=[["ply",(0,It.N)({label:"PLY",description:"PLY",category:"Shape",stringExtensions:["ply"],parse:function(){var oe=(0,r.A)(function*(x,F){const z=x.state.data.build().to(F).apply(y.f.Data.ParsePly,{},{state:{isGhost:!0}}),me=z.apply(y.f.Model.ShapeFromPly);return yield z.commit(),{format:z.selector,shape:me.selector}});return function(F,z){return oe.apply(this,arguments)}}(),visuals:(oe,x)=>oe.state.data.build().to(x.shape).apply(y.f.Representation.ShapeRepresentation3D).commit()})]];var To=n(2945),un=n(1169);class ct{get types(){return this._list.map(x=>[x.name,x.provider.label])}get extensions(){if(this._extensions)return this._extensions;const x=new Set;return this._list.forEach(({provider:F})=>{var z,me;null===(z=F.stringExtensions)||void 0===z||z.forEach(Pe=>x.add(Pe)),null===(me=F.binaryExtensions)||void 0===me||me.forEach(Pe=>x.add(Pe))}),this._extensions=x,x}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions;const x=new Set;return this._list.forEach(({provider:F})=>{var z;return null===(z=F.binaryExtensions)||void 0===z?void 0:z.forEach(me=>x.add(me))}),this._binaryExtensions=x,x}get options(){if(this._options)return this._options;const x=[];return this._list.forEach(({name:F,provider:z})=>x.push([F,z.label,z.category||""])),this._options=x,x}constructor(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(const[x,F]of Nr)this.add(x,F);for(const[x,F]of To.PO)this.add(x,F);for(const[x,F]of un.VE)this.add(x,F);for(const[x,F]of Jr)this.add(x,F);for(const[x,F]of jt.HQ)this.add(x,F)}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(x,F){this._clear(),this._list.push({name:x,provider:F}),this._map.set(x,F)}remove(x){this._clear(),this._list.splice(this._list.findIndex(F=>F.name===x),1),this._map.delete(x)}auto(x,F){var z,me;for(let Pe=0,Ge=this.list.length;Pe<Ge;++Pe){const Xe=this._list[Pe].provider;let Qe=!1;if((!(null===(z=Xe.binaryExtensions)||void 0===z)&&z.includes(x.ext)||!(null===(me=Xe.stringExtensions)||void 0===me)&&me.includes(x.ext))&&(Qe=!0),Qe&&(!Xe.isApplicable||Xe.isApplicable(x,F.data)))return Xe}}get(x){if(this._map.has(x))return this._map.get(x);throw new Error(`unknown data format name '${x}'`)}get list(){return this._list}}var dt=n(9096),Yt=n(3182);class cn extends Yt.e{get isEmpty(){return 0===this._animations.length}get current(){return this._current}get animations(){return this._animations}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||(this._params={current:v.t.Select(this._animations[0]&&this._animations[0].name,this._animations.map(x=>[x.name,x.display.name]),{label:"Animation"})}),this._params}updateParams(x){if(this.isEmpty)return;this.updateState({params:{...this.state.params,...x}});const F=this.map.get(this.state.params.current),z=F.params(this.context);this._current={anim:F,params:z,paramValues:v.t.getDefaultValues(z),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(x){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...x},this.triggerUpdate())}register(x){this.map.has(x.name)?this.context.log.error(`Animation '${x.name}' is already registered.`):(this._params=void 0,this.map.set(x.name,x),this._animations.push(x),1===this._animations.length?this.updateParams({current:x.name}):this.triggerUpdate())}play(x,F){var z=this;return(0,r.A)(function*(){yield z.stop(),z.map.has(x.name)||z.register(x),z.updateParams({current:x.name}),z.updateCurrentParams(F),yield z.start()})()}tick(x,F,z){var me=this;return(0,r.A)(function*(){me.currentTime=x,!me.isStopped&&(F||z?yield me.applyFrame(z):me.applyAsync())})()}start(){var x=this;return(0,r.A)(function*(){x.updateState({animationState:"playing"}),x.context.behaviors.state.isAnimating.value||x.context.behaviors.state.isAnimating.next(!0),x.triggerUpdate();const F=x._current.anim;let z=x._current.anim.initialState(x._current.paramValues,x.context);if(F.setup){const me=yield F.setup(x._current.paramValues,z,x.context);me&&(z=me)}x._current.lastTime=0,x._current.startedTime=-1,x._current.state=z,x.isStopped=!1})()}stop(){var x=this;return(0,r.A)(function*(){if(x.isStopped=!0,"stopped"!==x.state.animationState){const F=x._current.anim;F.teardown&&(yield F.teardown(x._current.paramValues,x._current.state,x.context)),x.updateState({animationState:"stopped"}),x.triggerUpdate()}x.context.behaviors.state.isAnimating.value&&x.context.behaviors.state.isAnimating.next(!1)})()}get isAnimating(){return"playing"===this.state.animationState}applyAsync(){var x=this;return(0,r.A)(function*(){if(!x.isApplying){x.isApplying=!0;try{yield x.applyFrame()}finally{x.isApplying=!1}}})()}applyFrame(x){var F=this;return(0,r.A)(function*(){const z=F.currentTime;F._current.startedTime<0&&(F._current.startedTime=z);const me=yield F._current.anim.apply(F._current.state,{lastApplied:F._current.lastTime,current:z-F._current.startedTime,animation:x},{params:F._current.paramValues,plugin:F.context});"finished"===me.kind?F.stop():"next"===me.kind&&(F._current.state=me.state,F._current.lastTime=z-F._current.startedTime),F.triggerApply()})()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(x){this.isEmpty||(this.updateState({animationState:x.state.animationState}),this.updateParams(x.state.params),x.current&&(this.current.paramValues=x.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(x.current.state):x.current.state,this.triggerUpdate(),"playing"===this.state.animationState&&this.resume()))}resume(){var x=this;return(0,r.A)(function*(){x._current.lastTime=0,x._current.startedTime=-1;const F=x._current.anim;x.context.behaviors.state.isAnimating.value||x.context.behaviors.state.isAnimating.next(!0),F.setup&&(yield F.setup(x._current.paramValues,x._current.state,x.context)),x.isStopped=!1})()}constructor(x){super({params:{current:""},animationState:"stopped"}),this.context=x,this.map=new Map,this._animations=[],this.currentTime=0,this._params=void 0,this.events={updated:this.ev(),applied:this.ev()},this.isStopped=!0,this.isApplying=!1}}var xn=n(7136),Rn=n(3246),er=n(8199),ir=n(5276);function br(oe,x,F){const z=F[0],me=F[1],Pe=F[2];return(z*oe[0]+me*oe[1]+Pe*oe[2]+(-z*x[0]-me*x[1]-Pe*x[2]))/Math.sqrt(z*z+me*me+Pe*Pe)}const Ur={identity:g.U.create(1,0,0,0,1,0,0,0,1),rotX90:g.U.create(1,0,0,0,0,1,0,-1,0),rotY90:g.U.create(0,0,-1,0,1,0,1,0,0),rotZ90:g.U.create(0,1,0,-1,0,0,0,0,1),rotX270:g.U.create(1,0,0,0,0,-1,0,1,0),rotY270:g.U.create(0,0,1,0,1,0,-1,0,0),rotZ270:g.U.create(0,-1,0,1,0,0,0,0,1),rotX180:g.U.create(1,0,0,0,-1,0,0,0,-1),rotY180:g.U.create(-1,0,0,0,1,0,0,0,-1),rotZ180:g.U.create(-1,0,0,0,-1,0,0,0,1)};function so(oe,x){const{onlyTrace:F,skipHydrogens:z,skipWater:me}=x,{x:Pe,y:Ge,z:Xe,type_symbol:Qe,label_comp_id:lt}=Je.StructureProperties.atom,ft=[];for(const wt of oe){const Ut=Je.iZ.Location.create(wt);for(const Jt of wt.units){Ut.unit=Jt;const gn=F?Jt.polymerElements:Jt.elements;for(let Pn=0;Pn<gn.length;Pn++)Ut.element=gn[Pn],(!z||"H"!==Qe(Ut))&&(me&&"HOH"===lt(Ut)||ft.push(Pe(Ut),Ge(Ut),Xe(Ut)))}}return ft}function Go(oe,x){const F=Math.floor(x/2);return oe<F?x%2?F-oe:F-oe-1:oe-F}function Pt(oe,x){const F=g.U.invert((0,g.U)(),x),z=g.eB.distance(oe.position,oe.target),me=g.eB.transformMat3((0,g.eB)(),g.eB.create(0,0,z),F),Pe=g.eB.transformMat3((0,g.eB)(),g.eB.create(0,1,0),F),Ge=g.eB.add((0,g.eB)(),oe.target,me);return{...oe,position:Ge,up:Pe}}const Sn={minRadius:5,extraRadius:4,durationMs:250};class Nn{transformedLoci(x){var F,z;if(Je.iZ.Loci.is(x)){const me=null===(z=null===(F=this.plugin.helpers.substructureParent.get(x.structure))||void 0===F?void 0:F.obj)||void 0===z?void 0:z.data;me&&(x=Je.iZ.Loci.remap(x,me))}return x}focusRenderObjects(x,F){if(!x)return;const z=[];for(const me of x){const Pe=me.values.boundingSphere.ref.value;0!==Pe.radius&&z.push(Pe)}this.focusSpheres(z,me=>me,F)}focusLoci(x,F){let z;if(Array.isArray(x)&&x.length>1){const me=[];for(const Pe of x){const Ge=Rn.QN.getBoundingSphere(this.transformedLoci(Pe));Ge&&me.push(Ge)}if(0===me.length)return;this.boundaryHelper.reset();for(const Pe of me)this.boundaryHelper.includeSphere(Pe);this.boundaryHelper.finishedIncludeStep();for(const Pe of me)this.boundaryHelper.radiusSphere(Pe);z=this.boundaryHelper.getSphere()}else if(Array.isArray(x)){if(0===x.length)return;z=Rn.QN.getBoundingSphere(this.transformedLoci(x[0]))}else z=Rn.QN.getBoundingSphere(this.transformedLoci(x));z&&this.focusSphere(z,F)}focusSpheres(x,F,z){const me=[];for(const Pe of x){const Ge=F(Pe);Ge&&me.push(Ge)}if(0!==me.length){if(1===me.length)return this.focusSphere(me[0],z);this.boundaryHelper.reset();for(const Pe of me)this.boundaryHelper.includeSphere(Pe);this.boundaryHelper.finishedIncludeStep();for(const Pe of me)this.boundaryHelper.radiusSphere(Pe);this.focusSphere(this.boundaryHelper.getSphere(),z)}}focusSphere(x,F){var z;const{canvas3d:me}=this.plugin;if(!me)return;const{extraRadius:Pe,minRadius:Ge,durationMs:Xe}={...Sn,...F},Qe=Math.max(x.radius+Pe,Ge);if(F?.principalAxes){const lt=function Mr(oe,x,F){if(!oe.canvas3d)return;const{origin:z,dirA:me,dirB:Pe,dirC:Ge}=F.principalAxes.boxAxes,Xe=M.e.clone(me),Qe=M.e.clone(Ge);if(F.positionToFlip){const{aroundX:ft,aroundY:wt}=function vr(oe,x,F,z){const me=br(oe,x,z);return{aroundX:br(oe,x,F)<0,aroundY:me<0}}(F.positionToFlip,z,Xe,Pe);ft&&(M.e.negate(Qe,Qe),M.e.negate(Xe,Xe)),wt&&M.e.negate(Qe,Qe)}const lt=M.e.scale((0,M.e)(),z,-100);return M.e.dot(lt,Xe)<=0&&M.e.negate(Qe,Qe),M.e.dot(M.e.unitY,Qe)<=0&&M.e.negate(Xe,Xe),oe.canvas3d.camera.getFocus(z,x,Xe,Qe,ir.i.createDefaultSnapshot())}(this.plugin,Qe,F);null===(z=this.plugin.canvas3d)||void 0===z||z.requestCameraReset({durationMs:Xe,snapshot:lt})}else{const lt=me.camera.getFocus(x.center,Qe);me.requestCameraReset({durationMs:Xe,snapshot:lt})}}orientAxes(x,F){if(!this.plugin.canvas3d)return;x||(x=this.plugin.state.data.selectQ(Xe=>Xe.ofType(A.O.Molecule.Structure)).filter(Xe=>Xe.obj&&!Xe.transform.transformer.definition.isDecorator&&!Xe.obj.data.parent).map(Xe=>{var Qe;return null===(Qe=Xe.obj)||void 0===Qe?void 0:Qe.data}).filter(Xe=>!!Xe));const{rotation:z}=function Ro(oe,x){const F=function po(oe,x){let F;return F=so(oe,{onlyTrace:!0}),F.length>=3*x||(F=so(oe,{skipHydrogens:!0,skipWater:!0}),F.length>=3*x)||(F=so(oe,{})),F}(oe,3);return function ro(oe,x){if(0===oe.length)return console.warn("Skipping PCA, no atoms"),{rotation:Ur.identity,origin:g.eB.zero()};const F=er.c.calculateMomentsAxes(oe),z=er.c.calculateNormalizedAxes(F),me=function Wo(oe,x,F){const z=(0,g.U)();return g.U.setValue(z,0,0,oe[0]),g.U.setValue(z,0,1,oe[1]),g.U.setValue(z,0,2,oe[2]),g.U.setValue(z,1,0,x[0]),g.U.setValue(z,1,1,x[1]),g.U.setValue(z,1,2,x[2]),g.U.setValue(z,2,0,F[0]),g.U.setValue(z,2,1,F[1]),g.U.setValue(z,2,2,F[2]),z}(z.dirA,z.dirB,z.dirC);!function We(oe){g.U.determinant(oe)<0&&(g.U.setValue(oe,2,0,-g.U.getValue(oe,2,0)),g.U.setValue(oe,2,1,-g.U.getValue(oe,2,1)),g.U.setValue(oe,2,2,-g.U.getValue(oe,2,2)))}(me);const Pe=x?function ho(oe,x){let F=Ur.identity,z=0;const me=(0,g.U)();for(const Pe of[Ur.identity,Ur.rotX180,Ur.rotY180,Ur.rotZ180]){const Ge=g.U.innerProduct(g.U.mul(me,Pe,oe),x);Ge>z&&(F=Pe,z=Ge)}return F}(me,x):function Bo(oe,x,F){const z=g.eB.create(g.U.getValue(x,0,0),g.U.getValue(x,0,1),g.U.getValue(x,0,2)),me=g.eB.create(g.U.getValue(x,1,0),g.U.getValue(x,1,1),g.U.getValue(x,1,2)),Pe=g.eB.create(g.U.getValue(x,2,0),g.U.getValue(x,2,1),g.U.getValue(x,2,2)),Ge=Math.floor(oe.length/3),Xe=(0,g.eB)();let Qe=0,lt=0,ft=0;for(let Jt=0;Jt<Ge;Jt++)g.eB.fromArray(Xe,oe,3*Jt),g.eB.sub(Xe,Xe,F),Qe+=Jt*g.eB.dot(Xe,z),lt+=Jt*g.eB.dot(Xe,me),ft+=Go(Jt,Ge)*g.eB.dot(Xe,Pe);const wt=ft<0,Ut=wt?Qe+lt<0:Qe-lt<0;return Ut&&wt?Ur.rotY180:wt?Ur.rotX180:Ut?Ur.rotZ180:Ur.identity}(oe,me,F.origin);return g.U.mul(me,Pe,me),{rotation:me,origin:z.origin}}(F,x)}(x),me=Pt(this.plugin.canvas3d.camera.getSnapshot(),z);this.setSnapshot(me,F)}resetAxes(x){if(!this.plugin.canvas3d)return;const F=Pt(this.plugin.canvas3d.camera.getSnapshot(),g.U.Identity);this.setSnapshot(F,x)}setSnapshot(x,F){var z;null===(z=this.plugin.canvas3d)||void 0===z||z.requestCameraReset({snapshot:x,durationMs:F})}reset(x,F){var z;null===(z=this.plugin.canvas3d)||void 0===z||z.requestCameraReset({snapshot:x,durationMs:F})}constructor(x){this.plugin=x,this.boundaryHelper=new xn.Z("98")}}var Kn=n(4986),dr=n(2443),xr=n(6825);class Ft{clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(x){this.providers.push(x),this.providers.sort((F,z)=>(z.priority||0)-(F.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(x){this.providers=this.providers.filter(F=>F!==x),this.isDirty=!0,this.showLabels()}mark(x,F){const z=this.locis.findIndex(me=>dr.YL.Loci.areEqual(x,me));-1===z&&F===xr.xi.Highlight?(this.locis.push(x),this.isDirty=!0):-1!==z&&F===xr.xi.RemoveHighlight&&((0,nt.P6)(this.locis,z),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(const x of this.providers)for(const F of this.locis){if(Rn.QN.isEmpty(F.loci))continue;const z=x.label(F.loci,F.repr);if(z){const me=x.group?x.group(z):z.toString(),Pe=this.groupedLabels.get(me);Pe?Pe.push(z):this.groupedLabels.set(me,[z])}}this.labels.length=0,this.groupedLabels.forEach((x,F)=>{const z=x.length,me=z>1&&x[0]!==x[1]?F:x[0];this.labels.push(1===z?me:`${me} <small>|| \xd7 ${z}</small>`)}),this.isDirty=!1}return this.labels}constructor(x){this.ctx=x,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,x.managers.interactivity.lociHighlights.addProvider((F,z,me)=>{0!==this.providers.length&&(this.mark(F,z),me||this.showLabels())})}}var Qt=n(856),ht=n(9039),pt=n(3917);class fn extends Yt.e{get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(x){if(Je.iZ.Loci.isEmpty(x.loci))return;let z,F=0;for(const me of this.state.history){if(Je.iZ.Loci.areEqual(me.loci,x.loci)){z=me;break}F++}if(z)return(0,nt.P6)(this.state.history,F),this.state.history.unshift(x),void this.events.historyUpdated.next(void 0);this.state.history.unshift(x),this.state.history.length>8&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(x){this.tryAddHistory(x),(!this.state.current||!Je.iZ.Loci.areEqual(this.state.current.loci,x.loci))&&(this.state.current=x,this.behaviors.current.next(x))}setFromLoci(x){const F=Rn.QN.normalize(x);Je.iZ.Loci.is(F)&&!Je.iZ.Loci.isEmpty(F)?this.set({loci:F,label:(0,pt.YQ)(F,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}):this.clear()}addFromLoci(x){const F=this.state.current&&Je.iZ.Loci.is(x)&&x.structure===this.state.current.loci.structure?Je.iZ.Loci.union(x,this.state.current.loci):x;this.setFromLoci(F)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))}getSnapshot(){if(!this.current)return{};const x=this.plugin.helpers.substructureParent.get(this.current.loci.structure),F=x?.transform.ref;return F?{current:{label:this.current.label,ref:F,bundle:Je.iZ.Bundle.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(x){var F,z;if(!x.current)return void this.clear();const{label:me,ref:Pe,bundle:Ge,category:Xe}=x.current,Qe=null===(z=null===(F=this.plugin.state.data.select(c.QX.Generators.byRef(Pe))[0])||void 0===F?void 0:F.obj)||void 0===z?void 0:z.data;if(!Qe)return;const lt=Je.iZ.Bundle.toLoci(Ge,Qe);this.set({label:me,loci:lt,category:Xe})}constructor(x){super({history:[]}),this.plugin=x,this.events={historyUpdated:this.ev()},this.behaviors={current:this.ev.behavior(void 0)},x.state.data.events.object.removed.subscribe(({obj:z})=>{var me;if(!A.O.Molecule.Structure.is(z))return;(null===(me=this.current)||void 0===me?void 0:me.loci.structure)===z.data&&this.clear();const Pe=[];for(const Ge of this.history)Ge.loci.structure===z.data&&Pe.push(Ge);Pe.length!==this.history.length&&(this.history.length=0,this.history.push(...Pe),this.events.historyUpdated.next(void 0))});const F=(0,Bt.f8)();x.state.data.events.object.updated.subscribe(({oldData:z,obj:me,action:Pe})=>{var Ge;if(A.O.Molecule.Structure.is(me)&&z!==me.data&&"in-place"===Pe){const Xe=this.state.current;if(Xe&&Xe.loci.structure===z){const lt=Je.iZ.Loci.remap(Xe.loci,me.data);this.state.current={...Xe,loci:lt},this.behaviors.current.next(this.state.current),Rn.QN.getBoundingSphere(lt,F);const ft=null===(Ge=this.plugin.canvas3d)||void 0===Ge?void 0:Ge.camera,wt=ft.getTargetDistance(F.radius+4);(g.eB.distance(ft.target,F.center)>F.radius||wt>ft.viewport.height/ft.zoom)&&this.plugin.managers.camera.focusSphere(F,{durationMs:0})}}})}}var on=n(2277),En=n(5995),Tt=n(3543);const Fe=new xn.Z("98");class Ye extends Yt.e{get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats||(this.state.stats=this.calcStats()),this.state.stats}getEntry(x){const F=this.plugin.helpers.substructureParent.get(x,!0);if(!F)return;const z=F.transform.ref;if(!this.entries.has(z)){const me=new rt(Je.iZ.Loci(x,[]));return this.entries.set(z,me),me}return this.entries.get(z)}calcStats(){let x=0,F=0;const z=Je.iZ.Stats.create();this.entries.forEach(Pe=>{const{elements:Ge}=Pe.selection;if(Ge.length){x+=1;for(let Xe=0,Qe=Ge.length;Xe<Qe;++Xe)F+=Tt.CD.size(Ge[Xe].indices);Je.iZ.Stats.add(z,z,Je.iZ.Stats.ofLoci(Pe.selection))}});const me=(0,pt.d_)(z,{countsOnly:!0});return{structureCount:x,elementCount:F,label:me}}add(x){if(!Je.iZ.Loci.is(x))return!1;const F=this.getEntry(x.structure);if(!F)return!1;const z=F.selection;return F.selection=Je.iZ.Loci.union(F.selection,x),this.tryAddHistory(x),this.referenceLoci=x,this.events.loci.add.next(x),!Je.iZ.Loci.areEqual(z,F.selection)}remove(x){if(!Je.iZ.Loci.is(x))return!1;const F=this.getEntry(x.structure);if(!F)return!1;const z=F.selection;return F.selection=Je.iZ.Loci.subtract(F.selection,x),this.referenceLoci=x,this.events.loci.remove.next(x),!Je.iZ.Loci.areEqual(z,F.selection)}intersect(x){if(!Je.iZ.Loci.is(x))return!1;const F=this.getEntry(x.structure);if(!F)return!1;const z=F.selection;return F.selection=Je.iZ.Loci.intersect(F.selection,x),this.referenceLoci=x,!Je.iZ.Loci.areEqual(z,F.selection)}set(x){if(!Je.iZ.Loci.is(x))return!1;const F=this.getEntry(x.structure);if(!F)return!1;const z=F.selection;return F.selection=x,this.tryAddHistory(x),this.referenceLoci=void 0,!Je.iZ.Loci.areEqual(z,F.selection)}modifyHistory(x,F,z,me=!1){const Pe=this.additionsHistory,Ge=Pe.indexOf(x);if(Ge<0)return;let Xe;switch(F){case"remove":(0,nt.P6)(Pe,Ge);break;case"up":Xe=Ge-1;break;case"down":Xe=Ge+1}if(void 0!==Xe){const Qe=z?Math.min(Pe.length,z):Pe.length;for(;;){if(Xe%=Qe,Xe<0&&(Xe+=Qe),!me||Pe[Ge].loci.structure===Pe[Xe].loci.structure){const lt=Pe[Ge];Pe[Ge]=Pe[Xe],Pe[Xe]=lt;break}Xe+="up"===F?-1:1}}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(x){if(Rn.QN.isEmpty(x))return;let z,F=0;for(const Ge of this.additionsHistory){if(Rn.QN.areEqual(Ge.loci,x)){z=Ge;break}F++}if(z)return(0,nt.P6)(this.additionsHistory,F),this.additionsHistory.unshift(z),void this.events.additionsHistoryUpdated.next(void 0);const me=Je.iZ.Stats.ofLoci(x),Pe=(0,pt.d_)(me,{reverse:!0});this.additionsHistory.unshift({id:G.kk.create22(),loci:x,label:Pe}),this.additionsHistory.length>24&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){0!==this.state.additionsHistory.length&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(x){const F=[];for(const z of this.state.additionsHistory)z.loci.structure.root===x.root&&F.push(z);for(const z of F)this.modifyHistory(z,"remove");0!==F.length&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(x,F){var z;this.entries.has(x)&&(this.entries.delete(x),F?.data&&this.clearHistoryForStructure(F.data),(null===(z=this.referenceLoci)||void 0===z?void 0:z.structure)===F?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(x,F,z){var me,Pe,Ge,Xe;if(F===z||F?.data===z.data)return;const Qe=this.plugin.helpers.substructureParent.get(z.data,!0);if(!Qe||x!==Qe.transform.ref||!this.entries.has(x))return;const lt=null===(Pe=null===(me=this.plugin.helpers.substructureParent.get(z.data))||void 0===me?void 0:me.obj)||void 0===Pe?void 0:Pe.data;if(lt)if(!F?.data||Je.oE.areUnitIdsAndIndicesEqual(F.data,z.data)){this.entries.set(x,function St(oe,x){return new rt(Je.iZ.Loci.remap(oe.selection,x))}(this.entries.get(x),lt)),(null===(Ge=this.referenceLoci)||void 0===Ge?void 0:Ge.structure.root)===lt.root&&(this.referenceLoci=Je.iZ.Loci.remap(this.referenceLoci,lt));let ft=!1;for(const wt of this.state.additionsHistory)wt.loci.structure.root===lt.root&&(wt.loci=Je.iZ.Loci.remap(wt.loci,lt),ft=!0);ft&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(x,new rt(Je.iZ.Loci(lt,[]))),(null===(Xe=this.referenceLoci)||void 0===Xe?void 0:Xe.structure.root)===lt.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(lt),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){const x=this.entries.keys(),F=[];for(;;){const z=x.next();if(z.done)break;const me=this.entries.get(z.value);Je.iZ.Loci.isEmpty(me.selection)||F.push(me.selection),me.selection=Je.iZ.Loci(me.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),F}getLoci(x){const F=this.getEntry(x);return F?F.selection:Rn.BL}getStructure(x){const F=this.getEntry(x);if(F)return F.structure}structureHasSelection(x){var F,z;const me=null===(z=null===(F=x.cell)||void 0===F?void 0:F.obj)||void 0===z?void 0:z.data;if(!me)return!1;const Pe=this.getEntry(me);return!!Pe&&!Je.iZ.Loci.isEmpty(Pe.selection)}has(x){if(Je.iZ.Loci.is(x)){const F=this.getEntry(x.structure);if(F)return Je.iZ.Loci.isSubset(F.selection,x)}return!1}tryGetRange(x){if(!Je.iZ.Loci.is(x)||1!==x.elements.length||!this.getEntry(x.structure))return;const z=x.elements[0];if(!z)return;const me=this.referenceLoci;if(!me||!Je.iZ.Loci.is(me)||me.structure!==x.structure)return;let Pe;for(const Ge of me.elements)if(z.unit===Ge.unit){Pe=Ge;break}return Pe&&z.unit===Pe.unit?function vt(oe,x,F){const z=Math.min(Tt.CD.min(x.indices),Tt.CD.min(F.indices)),me=Math.max(Tt.CD.max(x.indices),Tt.CD.max(F.indices));return Je.iZ.Loci(oe,[{unit:x.unit,indices:Tt.CD.ofRange(z,me)}])}(x.structure,Pe,z):void 0}elementCount(){let x=0;return this.entries.forEach(F=>{x+=Je.iZ.Loci.size(F.selection)}),x}getBoundary(){const x=g.eB.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=g.eB.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);Fe.reset();const z=[];this.entries.forEach(me=>{const Pe=me.selection;Je.iZ.Loci.isEmpty(Pe)||z.push(Je.iZ.Loci.getBoundary(Pe))});for(let me=0,Pe=z.length;me<Pe;++me){const{box:Ge,sphere:Xe}=z[me];g.eB.min(x,x,Ge.min),g.eB.max(F,F,Ge.max),Fe.includePositionRadius(Xe.center,Xe.radius)}Fe.finishedIncludeStep();for(let me=0,Pe=z.length;me<Pe;++me){const{sphere:Ge}=z[me];Fe.radiusPositionRadius(Ge.center,Ge.radius)}return{box:{min:x,max:F},sphere:Fe.getSphere()}}getPrincipalAxes(){const x=(0,ce.ZR)(this.entries.values());return Je.iZ.Loci.getPrincipalAxesMany(x.map(F=>F.selection))}modify(x,F){let z=!1;switch(x){case"add":z=this.add(F);break;case"remove":z=this.remove(F);break;case"intersect":z=this.intersect(F);break;case"set":z=this.set(F)}z&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(x=>!!x.cell.obj).map(x=>x.cell.obj.data)}triggerInteraction(x,F,z=!0){switch(x){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:F},z);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:F},z);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:F},z);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:F},z)}}fromLoci(x,F,z=!0){this.triggerInteraction(x,F,z)}fromCompiledQuery(x,F,z=!0){for(const me of this.applicableStructures){const Pe=F(new Je.cY(me));this.triggerInteraction(x,Je.cv.toLociWithSourceUnits(Pe),z)}}fromSelectionQuery(x,F,z=!0){var me=this;this.plugin.runTask(R.YZ.create("Structure Selection",function(){var Pe=(0,r.A)(function*(Ge){for(const Xe of me.applicableStructures){const Qe=yield F.getSelection(me.plugin,Ge,Xe);me.triggerInteraction(x,Je.cv.toLociWithSourceUnits(Qe),z)}});return function(Ge){return Pe.apply(this,arguments)}}()))}fromSelections(x){var F;const z=c.so.resolveAndCheck(this.plugin.state.data,x);if(z&&z.obj){if(!A.O.Molecule.Structure.Selections.is(z.obj))return void console.warn("fromSelections applied to wrong object type.",z.obj);this.clear();for(const me of null===(F=z.obj)||void 0===F?void 0:F.data)this.fromLoci("set",me.loci)}}getSnapshot(){const x=[];return this.entries.forEach((F,z)=>{x.push({ref:z,bundle:Je.iZ.Bundle.fromLoci(F.selection)})}),{entries:x}}setSnapshot(x){var F,z;this.entries.clear();for(const{ref:me,bundle:Pe}of x.entries){const Ge=null===(z=null===(F=this.plugin.state.data.select(c.QX.Generators.byRef(me))[0])||void 0===F?void 0:F.obj)||void 0===z?void 0:z.data;if(!Ge)continue;const Xe=Je.iZ.Bundle.toLoci(Pe,Ge);this.fromLoci("set",Xe,!1)}}constructor(x){super({entries:new Map,additionsHistory:[],stats:{structureCount:0,elementCount:0,label:"Nothing Selected"}}),this.plugin=x,this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}},x.helpers.substructureParent.events.removed.subscribe(F=>this.onRemove(F.ref,F.obj)),x.helpers.substructureParent.events.updated.subscribe(F=>this.onUpdate(F.ref,F.oldObj,F.obj))}}class rt{get selection(){return this._selection}set selection(x){this._selection=x,this._structure=void 0}get structure(){return this._structure||(this._structure=Rn.QN.isEmpty(this._selection)?void 0:Je.iZ.Loci.toStructure(this._selection)),this._structure}constructor(x){this._structure=void 0,this._selection=x}}var mn=n(9012);const an=[["full","Full"],["hidden","Hidden"]],Vn={isExpanded:v.t.Boolean(!1),showControls:v.t.Boolean(!0),regionState:v.t.Group({left:v.t.Select("full",[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]]),top:v.t.Select("full",an),right:v.t.Select("full",an),bottom:v.t.Select("full",an)}),controlsDisplay:v.t.Value("outside",{isHidden:!0})};class Fn extends Yt.e{updateProps(x){const F=!!this.state.isExpanded;this.updateState(x),this.root&&"boolean"==typeof x.isExpanded&&x.isExpanded!==F&&this.handleExpand(),this.events.updated.next(void 0)}setProps(x){this.updateState(x)}setRoot(x){this.root=x,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}handleExpand(){try{const x=document.getElementsByTagName("body")[0],F=document.getElementsByTagName("head")[0];if(!x||!F||!this.root)return;if(this.state.isExpanded){const z=F.children,me=[];let Pe=!1;for(let ft=0;ft<z.length;ft++)z[ft]===this.expandedViewport?Pe=!0:"viewport"===(z[ft].name||"").toLowerCase()&&me.push(z[ft]);for(const ft of me)F.removeChild(ft);Pe||F.appendChild(this.expandedViewport);const Ge=x.style,Xe=this.getScrollElement();this.rootState={top:Ge.top,bottom:Ge.bottom,right:Ge.right,left:Ge.left,scrollTop:Xe.scrollTop,scrollLeft:Xe.scrollLeft,position:Ge.position,overflow:Ge.overflow,viewports:me,zIndex:this.root.style.zIndex,width:Ge.width,height:Ge.height,maxWidth:Ge.maxWidth,maxHeight:Ge.maxHeight,margin:Ge.margin,marginLeft:Ge.marginLeft,marginRight:Ge.marginRight,marginTop:Ge.marginTop,marginBottom:Ge.marginBottom},Ge.overflow="hidden",Ge.position="fixed",Ge.top="0",Ge.bottom="0",Ge.right="0",Ge.left="0",Ge.width="100%",Ge.height="100%",Ge.maxWidth="100%",Ge.maxHeight="100%",Ge.margin="0",Ge.marginLeft="0",Ge.marginRight="0",Ge.marginTop="0",Ge.marginBottom="0"}else{const z=F.children;for(let me=0;me<z.length;me++)if(z[me]===this.expandedViewport){F.removeChild(this.expandedViewport);break}if(this.rootState){const me=this.rootState;for(const Xe of me.viewports)F.appendChild(Xe);const Pe=x.style;Pe.top=me.top,Pe.bottom=me.bottom,Pe.left=me.left,Pe.right=me.right,Pe.width=me.width,Pe.height=me.height,Pe.maxWidth=me.maxWidth,Pe.maxHeight=me.maxHeight,Pe.margin=me.margin,Pe.marginLeft=me.marginLeft,Pe.marginRight=me.marginRight,Pe.marginTop=me.marginTop,Pe.marginBottom=me.marginBottom,Pe.position=me.position,Pe.overflow=me.overflow||"";const Ge=this.getScrollElement();Ge.scrollTop=me.scrollTop,Ge.scrollLeft=me.scrollLeft,this.rootState=void 0,this.root.style.zIndex=me.zIndex}}}catch(x){const F="Layout change error, you might have to reload the page.";this.context.log.error(F),console.error(F,x)}}constructor(x){super({...v.t.getDefaultValues(Vn),...x.spec.layout&&x.spec.layout.initial}),this.context=x,this.events={updated:this.ev()},this.rootState=void 0,i.a.Layout.Update.subscribe(x,F=>this.updateProps(F.state)),typeof document<"u"&&(this.expandedViewport=document.createElement("meta"),this.expandedViewport.name="viewport",this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}var rr=n(9283),Vr=n(377),tr=n(2741),Tr=n(2434),oo=n(1888),Gr=n(2556);const Ao={includeTypes:v.t.MultiSelect((0,E.mX)(Tr.I$.Names),v.t.objectToOptions(Tr.I$.Names)),excludeTypes:v.t.MultiSelect([],v.t.objectToOptions(Tr.I$.Names)),ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),aromaticBonds:v.t.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:v.t.Select("symmetric",v.t.arrayToOptions(["off","symmetric","offset"]))},vo=(v.t.getDefaultValues(Ao),{...Vr.Lr,...Ao,adjustCylinderLength:v.t.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})}),Do=(v.t.getDefaultValues(vo),{...Vr.T9,...Ao});function So(oe,x,F){return!Tr.I$.is(oe,F)||Tr.I$.is(x,F)}function ao(oe,x,F){const z=x.elements,me=x.bonds,{a:Pe,b:Ge,edgeProps:Xe}=me,{flags:Qe}=Xe,{ignoreHydrogens:lt,ignoreHydrogensVariant:ft,includeTypes:wt,excludeTypes:Ut}=F,Jt=Tr.I$.fromNames(wt),gn=Tr.I$.fromNames(Ut),Pn=Tr.I$.isAll(Jt)&&0===gn,{child:wn}=oe,Bn=wn?.unitMap.get(x.id);if(wn&&!Bn)throw new Error("expected childUnit to exist if child exists");if(!Pn||lt||wn)return Mn=>{const Ln=Pe[Mn],cr=Ge[Mn];return!!(Bn&&!Tt.SortedArray.has(Bn.elements,z[Ln])||!Pn&&So(Jt,gn,Qe[Mn]))||!!lt&&!(!(0,Gr.v3)(oe,x,z[Ln],ft)&&!(0,Gr.v3)(oe,x,z[cr],ft))}}function Po(oe,x){const F=oe.interUnitBonds,{edges:z}=F,{ignoreHydrogens:me,ignoreHydrogensVariant:Pe,includeTypes:Ge,excludeTypes:Xe}=x,Qe=Tr.I$.fromNames(Ge),lt=Tr.I$.fromNames(Xe),ft=Tr.I$.isAll(Qe)&&0===lt,{child:wt}=oe;if(!ft||me||wt)return Ut=>{if(wt){const Jt=z[Ut],gn=wt.unitMap.get(Jt.unitA);if(!gn)return!0;const wn=oe.unitMap.get(Jt.unitA).elements[Jt.indexA];if(!Tt.SortedArray.has(gn.elements,wn))return!0}if(me){const Jt=z[Ut],gn=oe.unitMap.get(Jt.unitA),Pn=oe.unitMap.get(Jt.unitB);if((0,Gr.v3)(oe,gn,gn.elements[Jt.indexA],Pe)||(0,Gr.v3)(oe,Pn,Pn.elements[Jt.indexB],Pe))return!0}return!(ft||!So(Qe,lt,z[Ut].props.flag))}}var Yr;function jr(oe,x,F){const{objectId:z,instanceId:me,groupId:Pe}=oe;if(F===z){const{structure:Ge,group:Xe}=x,Qe=Xe.units[me];if(Je.Nf.isAtomic(Qe)){const{target:lt}=Ge,ft=Qe.bonds.a[Pe],wt=Qe.bonds.b[Pe];return Je.gn.Loci(lt,[Je.gn.Location(lt,Qe,ft,lt,Qe,wt),Je.gn.Location(lt,Qe,wt,lt,Qe,ft)])}}return Rn.BL}function Co(oe,x,F,z){let me=!1;if(Je.gn.isLoci(oe)){const{structure:Pe,group:Ge}=x;if(!Je.oE.areEquivalent(oe.structure,Pe))return!1;const Xe=Ge.units[0];if(!Je.Nf.isAtomic(Xe))return!1;const Qe=2*Xe.bonds.edgeCount;for(const lt of oe.bonds){if(lt.aUnit!==lt.bUnit)continue;const ft=Ge.unitIndexMap.get(lt.aUnit.id);if(void 0!==ft){const wt=Xe.bonds.getDirectedEdgeIndex(lt.aIndex,lt.bIndex);-1!==wt&&F(Tt.IX.ofSingleton(ft*Qe+wt))&&(me=!0)}}}else if(Je.iZ.Loci.is(oe)){const{structure:Pe,group:Ge}=x;if(!Je.oE.areEquivalent(oe.structure,Pe))return!1;const Xe=Ge.units[0];if(!Je.Nf.isAtomic(Xe))return!1;const Qe=2*Xe.bonds.edgeCount;for(const lt of oe.elements){const ft=Ge.unitIndexMap.get(lt.unit.id);if(void 0!==ft){const{offset:wt,b:Ut}=Xe.bonds;Tt.CD.forEach(lt.indices,Jt=>{for(let gn=wt[Jt],Pn=wt[Jt+1];gn<Pn;gn++)(!z||Tt.CD.has(lt.indices,Ut[gn]))&&F(Tt.IX.ofSingleton(ft*Qe+gn))&&(me=!0)})}}}return me}function Eo(oe,x,F){const{objectId:z,groupId:me}=oe;if(F===z){const{target:Pe}=x,Ge=x.interUnitBonds.edges[me],Xe=x.unitMap.get(Ge.unitA),Qe=x.unitMap.get(Ge.unitB);return Je.gn.Loci(Pe,[Je.gn.Location(Pe,Xe,Ge.indexA,Pe,Qe,Ge.indexB),Je.gn.Location(Pe,Qe,Ge.indexB,Pe,Xe,Ge.indexA)])}return Rn.BL}v.t.getDefaultValues(Do),function(oe){oe.fromGroup=function x(z,me){const{group:Pe,structure:Ge}=z,Xe=Pe.units[0],Qe=Je.Nf.isAtomic(Xe)?2*Xe.bonds.edgeCount:0,lt=Pe.units.length,ft=Je.gn.Location(Ge,void 0,void 0,Ge,void 0,void 0),wt=(Ut,Jt)=>{const gn=Pe.units[Jt];return ft.aUnit=gn,ft.bUnit=gn,ft.aIndex=gn.bonds.a[Ut],ft.bIndex=gn.bonds.b[Ut],ft};if(me?.includeLocation2){const Ut=Je.gn.Location(Ge,void 0,void 0,Ge,void 0,void 0);return(0,oo.iQ)(Qe,lt,1,wt,!1,()=>!1,(gn,Pn)=>{const wn=Pe.units[Pn];return Ut.aUnit=wn,Ut.bUnit=wn,Ut.aIndex=wn.bonds.b[gn],Ut.bIndex=wn.bonds.a[gn],Ut})}return(0,oo.iQ)(Qe,lt,1,wt)},oe.fromStructure=function F(z,me){const Pe=z.interUnitBonds.edgeCount,Xe=Je.gn.Location(z,void 0,void 0,z,void 0,void 0),Qe=lt=>{const ft=z.interUnitBonds.edges[lt];return Xe.aUnit=z.unitMap.get(ft.unitA),Xe.aIndex=ft.indexA,Xe.bUnit=z.unitMap.get(ft.unitB),Xe.bIndex=ft.indexB,Xe};if(me?.includeLocation2){const lt=Je.gn.Location(z,void 0,void 0,z,void 0,void 0);return(0,oo.iQ)(Pe,1,1,Qe,!0,()=>!1,wt=>{const Ut=z.interUnitBonds.edges[wt];return lt.aUnit=z.unitMap.get(Ut.unitB),lt.aIndex=Ut.indexB,lt.bUnit=z.unitMap.get(Ut.unitA),lt.bIndex=Ut.indexA,lt})}return(0,oo.iQ)(Pe,1,1,Qe,!0)}}(Yr||(Yr={}));const Fo=new Map;function ei(oe,x,F,z){let me=!1;if(Je.gn.isLoci(oe)){if(!Je.oE.areEquivalent(oe.structure,x))return!1;for(const Pe of oe.bonds){const Ge=x.interUnitBonds.getBondIndexFromLocation(Pe);-1!==Ge&&F(Tt.IX.ofSingleton(Ge))&&(me=!0)}}else if(Je.iZ.Loci.is(oe)){if(!Je.oE.areEquivalent(oe.structure,x)||z&&1===oe.elements.length)return!1;for(const Pe of oe.elements)Fo.set(Pe.unit.id,Pe.indices);for(const Pe of oe.elements){const{unit:Ge}=Pe;Je.Nf.isAtomic(Ge)&&x.interUnitBonds.getConnectedUnits(Ge.id).forEach(Xe=>{const Qe=Fo.get(Xe.unitB);(!z||Qe)&&Tt.CD.forEach(Pe.indices,lt=>{Xe.connectedIndices.includes(lt)&&Xe.getEdges(lt).forEach(ft=>{if(!z||Qe&&Tt.CD.has(Qe,ft.indexB)){const wt=x.interUnitBonds.getEdgeIndex(lt,Ge.id,ft.indexB,Xe.unitB);F(Tt.IX.ofSingleton(wt))&&(me=!0)}})})})}Fo.clear()}return me}var Yo=n(4506),ci=n(283);const Jo=Tr.I$.is;function Fi(oe,x,F,z){const me=oe.elements,Pe=oe.bonds,{edgeCount:Ge,a:Xe,b:Qe,edgeProps:lt,offset:ft}=Pe,{order:wt,flags:Ut}=lt,{sizeFactor:Jt,sizeAspectRatio:gn,adjustCylinderLength:Pn,aromaticBonds:wn,includeTypes:Bn,excludeTypes:Mn,multipleBonds:Ln}=z,cr="off"===Ln,qn="symmetric"===Ln,zn=So(Tr.I$.fromNames(Bn),Tr.I$.fromNames(Mn),32),Lr=(0,g.eB)(),wr=(0,g.eB)(),to=oe.conformation;let Cr;const Zr=Je.iZ.Location.create(x,oe),Io=Je.gn.Location(x,oe,void 0,x,oe,void 0),{child:wo}=x;if(z.includeParent&&wo){const go=wo.unitMap.get(oe.id);if(!go)throw new Error("expected childUnit to exist");Cr=Qo=>{const $o=me[Qe[Qo]];return Tt.SortedArray.has(go.elements,me[Xe[Qo]])&&!Tt.SortedArray.has(go.elements,$o)}}const{elementRingIndices:li,elementAromaticRingIndices:Vo}=oe.rings,jo=wn?oe.resonance.delocalizedTriplets:void 0;return{linkCount:2*Ge,referencePosition:go=>{let Qo=Xe[go],Ko=Qe[go];const $o=jo?.getThirdElement(Qo,Ko);if(void 0!==$o)return to.invariantPosition(me[$o],Lr);Qo>Ko&&([Qo,Ko]=[Ko,Qo]),ft[Qo+1]-ft[Qo]==1&&([Qo,Ko]=[Ko,Qo]);const fi=Vo.get(Qo)||li.get(Qo);let Zo=0;for(let ii=ft[Qo],Ai=ft[Qo+1];ii<Ai;++ii){const Xi=Qe[ii];if(Xi!==Ko&&Xi!==Qo){if(!fi)return to.invariantPosition(me[Xi],Lr);{const vs=Vo.get(Xi)||li.get(Xi);if(!vs)continue;const As=(0,nt.u$)(fi,vs);As>Zo&&(Zo=As,to.invariantPosition(me[Xi],Lr))}}}return Zo>0?Lr:null},position:(go,Qo,Ko)=>{if(to.invariantPosition(me[Xe[Ko]],go),to.invariantPosition(me[Qe[Ko]],Qo),Pn){const $o=(go=>(Zr.element=me[Xe[go]],F.size.size(Zr)*Jt))(Ko),fi=(go=>(Zr.element=me[Qe[go]],F.size.size(Zr)*Jt))(Ko),Zo=Math.min($o,fi)*gn,ii=Math.sqrt(Math.max(0,$o*$o-Zo*Zo))-.05,Ai=Math.sqrt(Math.max(0,fi*fi-Zo*Zo))-.05;if(ii<=.01&&Ai<=.01)return;g.eB.normalize(wr,g.eB.sub(wr,Qo,go)),g.eB.scaleAndAdd(go,go,wr,ii),g.eB.scaleAndAdd(Qo,Qo,wr,-Ai)}},style:go=>{const Qo=wt[go],Ko=Ut[go];if(Jo(Ko,2)||Jo(Ko,4))return 1;if(3===Qo)return cr?0:qn?4:5;if(wn){const fi=Qe[go],Zo=Vo.get(Xe[go]),ii=Vo.get(fi),Ai=Zo&&ii?(0,nt.u$)(Zo,ii):0;if(Jo(Ko,16)||Ai&&!zn)return 2===Ai?8:7}return 2!==Qo||cr?0:qn?2:3},radius:go=>(go=>(Io.aIndex=Xe[go],Io.bIndex=Qe[go],F.size.size(Io)*Jt))(go)*gn,ignore:ao(x,oe,z),stub:Cr}}function hi(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x)||!x.bonds.edgeCount)return ci.S.createEmpty(Pe);const{child:Ge}=F,Xe=Ge?.unitMap.get(x.id);if(Ge&&!Xe)return ci.S.createEmpty(Pe);const Qe=Fi(x,F,z,me),{cylinders:lt,boundingSphere:ft}=(0,Vr.rm)(oe,Qe,me,Pe);if(ft)lt.setBoundingSphere(ft);else if(lt.cylinderCount>0){const wt=Bt.f8.expand((0,Bt.f8)(),(Xe??x).boundary.sphere,1*me.sizeFactor);lt.setBoundingSphere(wt)}return lt}function No(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x)||!x.bonds.edgeCount)return rr.e.createEmpty(Pe);const{child:Ge}=F,Xe=Ge?.unitMap.get(x.id);if(Ge&&!Xe)return rr.e.createEmpty(Pe);const Qe=Fi(x,F,z,me),{mesh:lt,boundingSphere:ft}=(0,Vr.C1)(oe,Qe,me,Pe);if(ft)lt.setBoundingSphere(ft);else if(lt.triangleCount>0){const wt=Bt.f8.expand((0,Bt.f8)(),(Xe??x).boundary.sphere,1*me.sizeFactor);lt.setBoundingSphere(wt)}return lt}const Ci={...tr.Te,...tr.lm,...vo,sizeFactor:v.t.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:v.t.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:v.t.Boolean(!0),includeParent:v.t.Boolean(!1)};function mi(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth?function qi(oe){return(0,tr.Vb)({defaultProps:v.t.getDefaultValues(Ci),createGeometry:hi,createLocationIterator:(x,F)=>Yr.fromGroup(x,{includeLocation2:"interpolate"===F.colorMode}),getLoci:jr,eachLocation:Co,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.sizeAspectRatio!==z.sizeAspectRatio||F.linkScale!==z.linkScale||F.linkSpacing!==z.linkSpacing||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.linkCap!==z.linkCap||F.aromaticScale!==z.aromaticScale||F.aromaticSpacing!==z.aromaticSpacing||F.aromaticDashCount!==z.aromaticDashCount||F.dashCount!==z.dashCount||F.dashScale!==z.dashScale||F.dashCap!==z.dashCap||F.stubCap!==z.stubCap||!(0,G.af)(F.includeTypes,z.includeTypes)||!(0,G.af)(F.excludeTypes,z.excludeTypes)||F.adjustCylinderLength!==z.adjustCylinderLength||F.aromaticBonds!==z.aromaticBonds||F.multipleBonds!==z.multipleBonds,F.colorMode!==z.colorMode&&(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0);const Qe=Ge.group.units[0],lt=Xe.group.units[0];Je.Nf.isAtomic(Qe)&&Je.Nf.isAtomic(lt)&&(Yo.O.areEqual(Qe.bonds,lt.bonds)||(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0,x.updateSize=!0))},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function Oi(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Ci),createGeometry:No,createLocationIterator:x=>Yr.fromGroup(x),getLoci:jr,eachLocation:Co,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.sizeAspectRatio!==z.sizeAspectRatio||F.radialSegments!==z.radialSegments||F.linkScale!==z.linkScale||F.linkSpacing!==z.linkSpacing||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.linkCap!==z.linkCap||F.aromaticScale!==z.aromaticScale||F.aromaticSpacing!==z.aromaticSpacing||F.aromaticDashCount!==z.aromaticDashCount||F.dashCount!==z.dashCount||F.dashScale!==z.dashScale||F.dashCap!==z.dashCap||F.stubCap!==z.stubCap||!(0,G.af)(F.includeTypes,z.includeTypes)||!(0,G.af)(F.excludeTypes,z.excludeTypes)||F.adjustCylinderLength!==z.adjustCylinderLength||F.aromaticBonds!==z.aromaticBonds||F.multipleBonds!==z.multipleBonds;const Qe=Ge.group.units[0],lt=Xe.group.units[0];Je.Nf.isAtomic(Qe)&&Je.Nf.isAtomic(lt)&&(Yo.O.areEqual(Qe.bonds,lt.bonds)||(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0,x.updateSize=!0))},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}var ti=n(3892),es=n(1839);const Si=new Je.gn.ElementBondIterator;function Pi(oe,x,F,z){for(Si.setElement(x,F,z);Si.hasNext;){const me=Si.move();return me.otherUnit.conformation.position(me.otherUnit.elements[me.otherIndex],oe),oe}return null}const ni=(0,g.eB)();function gi(oe,x,F){const z=Je.iZ.Location.create(oe),me=Je.gn.Location(oe,void 0,void 0,oe,void 0,void 0),Pe=oe.interUnitBonds,{edgeCount:Ge,edges:Xe}=Pe,{sizeFactor:Qe,sizeAspectRatio:lt,adjustCylinderLength:ft,aromaticBonds:wt,multipleBonds:Ut}=F,Jt="off"===Ut,gn="symmetric"===Ut,Pn=(0,g.eB)();let wn;const{child:Bn}=oe;return F.includeParent&&Bn&&(wn=qn=>{const Qn=Xe[qn],Zn=Bn.unitMap.get(Qn.unitA),zn=Bn.unitMap.get(Qn.unitB),wr=oe.unitMap.get(Qn.unitA).elements[Qn.indexA],Cr=oe.unitMap.get(Qn.unitB).elements[Qn.indexB];return Zn&&es.X.has(Zn.elements,wr)&&(!zn||!es.X.has(zn.elements,Cr))}),{linkCount:Ge,referencePosition:qn=>{const Qn=Xe[qn];let Zn,zn,Lr,wr;if(Qn.unitA<Qn.unitB)Zn=oe.unitMap.get(Qn.unitA),zn=oe.unitMap.get(Qn.unitB),Lr=Qn.indexA,wr=Qn.indexB;else{if(!(Qn.unitA>Qn.unitB))throw new Error("same units in createInterUnitBondCylinderMesh");Zn=oe.unitMap.get(Qn.unitB),zn=oe.unitMap.get(Qn.unitA),Lr=Qn.indexB,wr=Qn.indexA}return Pi(ni,oe,Zn,Lr)||Pi(ni,oe,zn,wr)},position:(qn,Qn,Zn)=>{const zn=Xe[Zn],Lr=oe.unitMap.get(zn.unitA),wr=oe.unitMap.get(zn.unitB);if(Lr.conformation.position(Lr.elements[zn.indexA],qn),wr.conformation.position(wr.elements[zn.indexB],Qn),ft){const to=(qn=>{const Qn=Xe[qn];return z.unit=oe.unitMap.get(Qn.unitA),z.element=z.unit.elements[Qn.indexA],x.size.size(z)*Qe})(Zn),Cr=(qn=>{const Qn=Xe[qn];return z.unit=oe.unitMap.get(Qn.unitB),z.element=z.unit.elements[Qn.indexB],x.size.size(z)*Qe})(Zn),Zr=Math.min(to,Cr)*lt,Io=Math.sqrt(Math.max(0,to*to-Zr*Zr))-.05,wo=Math.sqrt(Math.max(0,Cr*Cr-Zr*Zr))-.05;if(Io<=.01&&wo<=.01)return;g.eB.normalize(Pn,g.eB.sub(Pn,Qn,qn)),g.eB.scaleAndAdd(qn,qn,Pn,Io),g.eB.scaleAndAdd(Qn,Qn,Pn,-wo)}},style:qn=>{const Qn=Xe[qn].props.order,Zn=G.NJ.create(Xe[qn].props.flag);return Tr.I$.is(Zn,2)||Tr.I$.is(Zn,4)?1:3===Qn?Jt?0:gn?4:5:wt&&Tr.I$.is(Zn,16)?7:2!==Qn||Jt?0:gn?2:3},radius:qn=>(qn=>{const Qn=Xe[qn];return me.aUnit=oe.unitMap.get(Qn.unitA),me.aIndex=Qn.indexA,me.bUnit=oe.unitMap.get(Qn.unitB),me.bIndex=Qn.indexB,x.size.size(me)*Qe})(qn)*lt,ignore:Po(oe,F),stub:wn}}function Wi(oe,x,F,z,me){if(!x.interUnitBonds.edgeCount)return ci.S.createEmpty(me);const Pe=gi(x,F,z),{cylinders:Ge,boundingSphere:Xe}=(0,Vr.rm)(oe,Pe,z,me);if(Xe)Ge.setBoundingSphere(Xe);else if(Ge.cylinderCount>0){const{child:Qe}=x,lt=Bt.f8.expand((0,Bt.f8)(),(Qe??x).boundary.sphere,1*z.sizeFactor);Ge.setBoundingSphere(lt)}return Ge}function Ri(oe,x,F,z,me){if(!x.interUnitBonds.edgeCount)return rr.e.createEmpty(me);const Pe=gi(x,F,z),{mesh:Ge,boundingSphere:Xe}=(0,Vr.C1)(oe,Pe,z,me);if(Xe)Ge.setBoundingSphere(Xe);else if(Ge.triangleCount>0){const{child:Qe}=x,lt=Bt.f8.expand((0,Bt.f8)(),(Qe??x).boundary.sphere,1*z.sizeFactor);Ge.setBoundingSphere(lt)}return Ge}const Qi={...ti.EN,...ti.KE,...vo,sizeFactor:v.t.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:v.t.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:v.t.Boolean(!0),includeParent:v.t.Boolean(!1)};function Hn(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth?function qr(oe){return(0,ti.UM)({defaultProps:v.t.getDefaultValues(Qi),createGeometry:Wi,createLocationIterator:(x,F)=>Yr.fromStructure(x,{includeLocation2:"interpolate"===F.colorMode}),getLoci:Eo,eachLocation:ei,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.sizeAspectRatio!==z.sizeAspectRatio||F.linkScale!==z.linkScale||F.linkSpacing!==z.linkSpacing||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.linkCap!==z.linkCap||F.aromaticScale!==z.aromaticScale||F.aromaticSpacing!==z.aromaticSpacing||F.aromaticDashCount!==z.aromaticDashCount||F.dashCount!==z.dashCount||F.dashScale!==z.dashScale||F.dashCap!==z.dashCap||F.stubCap!==z.stubCap||!(0,G.af)(F.includeTypes,z.includeTypes)||!(0,G.af)(F.excludeTypes,z.excludeTypes)||F.adjustCylinderLength!==z.adjustCylinderLength||F.multipleBonds!==z.multipleBonds,F.colorMode!==z.colorMode&&(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0),Ge.interUnitBonds!==Xe.interUnitBonds&&(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0,x.updateSize=!0)},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function co(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(Qi),createGeometry:Ri,createLocationIterator:x=>Yr.fromStructure(x),getLoci:Eo,eachLocation:ei,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.sizeAspectRatio!==z.sizeAspectRatio||F.radialSegments!==z.radialSegments||F.linkScale!==z.linkScale||F.linkSpacing!==z.linkSpacing||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.linkCap!==z.linkCap||F.aromaticScale!==z.aromaticScale||F.aromaticSpacing!==z.aromaticSpacing||F.aromaticDashCount!==z.aromaticDashCount||F.dashCount!==z.dashCount||F.dashScale!==z.dashScale||F.dashCap!==z.dashCap||F.stubCap!==z.stubCap||!(0,G.af)(F.includeTypes,z.includeTypes)||!(0,G.af)(F.excludeTypes,z.excludeTypes)||F.adjustCylinderLength!==z.adjustCylinderLength||F.multipleBonds!==z.multipleBonds,Ge.interUnitBonds!==Xe.interUnitBonds&&(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0,x.updateSize=!0)},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}var zr=n(9132),lr=n(573),kr=n(4439),Qr=n(8231);const vi=ce.Gm.add3,Ti=ce.Gm.add;var Bi;!function(oe){oe.create=function x(F=2048,z=1024,me){const Pe=ce.Gm.create(Float32Array,3,z,me?me.centerBuffer.ref.value:F),Ge=ce.Gm.create(Float32Array,1,z,me?me.groupBuffer.ref.value:F);return{add:(Xe,Qe,lt,ft)=>{vi(Pe,Xe,Qe,lt),Ti(Ge,ft)},getSpheres:()=>{const Xe=ce.Gm.compact(Pe,!0),Qe=ce.Gm.compact(Ge,!0);return Qr.v.create(Xe,Qe,Pe.elementCount,me)}}}}(Bi||(Bi={}));const Li=g.eB.add;function bi(oe,x,F){const{ignoreHydrogens:z,ignoreHydrogensVariant:me,traceOnly:Pe}=F,Ge=Je.Nf.isCoarse(x),{child:Xe}=oe,Qe=Xe?.unitMap.get(x.id);if(Xe&&!Qe)throw new Error("expected childUnit to exist if child exists");if(Xe||z||Pe)return lt=>!!Qe&&!Tt.SortedArray.has(Qe.elements,lt)||!Ge&&z&&(0,Gr.v3)(oe,x,lt,me)||Pe&&!(0,Gr.UQ)(x,lt)}function Vi(oe,x,F,z,me,Pe){const{child:Ge}=F,Xe=Ge?.unitMap.get(x.id);if(Ge&&!Xe)return rr.e.createEmpty(Pe);const{detail:Qe,sizeFactor:lt,stride:ft}=me,{elements:wt,conformation:Ut}=x,Jt=wt.length,gn=Jt*(0,zr.J)(Qe),Pn=lr.P.createState(gn,gn/2,Pe),wn=(0,g.eB)(),Bn=bi(F,x,me),Mn=Je.iZ.Location.create(F,x),Ln=z.size.size,cr=(0,g.eB)();let qn=0,Qn=0;for(let wr=0;wr<Jt;wr++){if(ft&&wr%ft!=0||Bn&&Bn(wt[wr]))continue;Ut.invariantPosition(wt[wr],wn),Li(cr,cr,wn),Qn+=1,Mn.element=wt[wr];const to=Ln(Mn);to>qn&&(qn=to),Pn.currentGroup=wr,(0,kr.X)(Pn,wn,to*lt,Qe)}const Zn=Pe?Bt.f8.clone(Pe.boundingSphere):void 0,zn=lr.P.getMesh(Pn);if(0===Qn)return zn;let Lr;return g.eB.scale(cr,cr,1/Qn),Lr=Zn&&g.eB.distance(cr,Zn.center)/Zn.radius<.1?Zn:Bt.f8.expand((0,Bt.f8)(),(Xe??x).boundary.sphere,qn*lt+.05),zn.setBoundingSphere(Lr),zn}function Ei(oe,x,F,z,me,Pe){const{child:Ge}=F,Xe=Ge?.unitMap.get(x.id);if(Ge&&!Xe)return Qr.v.createEmpty(Pe);const{sizeFactor:Qe,stride:lt}=me,{elements:ft,conformation:wt}=x,Ut=ft.length,Jt=Bi.create(Ut,Ut/2,Pe),gn=(0,g.eB)(),Pn=bi(F,x,me),wn=Je.iZ.Location.create(F,x),Bn=z.size.size,Mn=(0,g.eB)();let Ln=0,cr=0;if(lt&&lt>1||Pn||"uniform"!==z.size.granularity)for(let zn=0;zn<Ut;zn++){if(lt&&zn%lt!=0||Pn&&Pn(ft[zn]))continue;wt.invariantPosition(ft[zn],gn),Jt.add(gn[0],gn[1],gn[2],zn),Li(Mn,Mn,gn),cr+=1,wn.element=ft[zn];const Lr=Bn(wn);Lr>Ln&&(Ln=Lr)}else{for(let zn=0;zn<Ut;zn++)wt.invariantPosition(ft[zn],gn),Jt.add(gn[0],gn[1],gn[2],zn),Li(Mn,Mn,gn);cr=Ut,Ln=Bn(wn)}const qn=Pe?Bt.f8.clone(Pe.boundingSphere):void 0,Qn=Jt.getSpheres();if(0===cr)return Qn;let Zn;return g.eB.scale(Mn,Mn,1/cr),Zn=qn&&g.eB.distance(Mn,qn.center)/qn.radius<.1?qn:Bt.f8.expand((0,Bt.f8)(),(Xe??x).boundary.sphere,Ln*Qe+.05),Qn.setBoundingSphere(Zn),Qn}function ln(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe))return!1;const{structure:me,group:Pe}=x;if(!Je.oE.areEquivalent(oe.structure,me))return!1;const Ge=Pe.elements.length,{unitIndexMap:Xe}=Pe;for(const Qe of oe.elements){const lt=Xe.get(Qe.unit.id);if(void 0!==lt){const ft=lt*Ge;if(Tt.IX.is(Qe.indices)){const wt=ft+Tt.IX.start(Qe.indices),Ut=ft+Tt.IX.end(Qe.indices);F(Tt.IX.ofBounds(wt,Ut))&&(z=!0)}else for(let wt=0,Ut=Qe.indices.length;wt<Ut;wt++){const Jt=Qe.indices[wt];let gn=wt+1;for(;gn<Ut&&Qe.indices[gn]===Jt;)gn++;wt=gn-1,z=F(Tt.IX.ofRange(ft+Jt,ft+Qe.indices[wt]))||z}}}return z}function Ht(oe,x,F){const{objectId:z,instanceId:me,groupId:Pe}=oe;if(F===z){const{structure:Ge,group:Xe}=x,Qe=Xe.units[me],lt=Tt.CD.ofSingleton(Pe);return Je.iZ.Loci(Ge.target,[{unit:Qe,indices:lt}])}return Rn.BL}function Gn(oe,x,F,z,me){const{child:Pe}=x,{detail:Ge,sizeFactor:Xe,stride:Qe}=z,{getSerialIndex:lt}=x.serialMapping,wt=x.elementCount*(0,zr.J)(Ge),Ut=lr.P.createState(wt,wt/2,me),Jt=F.size.size,gn=(0,g.eB)();let Pn=0,wn=0;for(const cr of x.units){const qn=Pe?.unitMap.get(cr.id);if(Pe&&!qn)continue;const{elements:Qn,conformation:Zn}=cr,zn=Qn.length,Lr=(0,g.eB)(),wr=bi(x,cr,z),to=Je.iZ.Location.create(x,cr);for(let Cr=0;Cr<zn;Cr++){const Zr=Qn[Cr];if(Qe&&Cr%Qe!=0||wr&&wr(Zr))continue;Zn.position(Zr,Lr),Li(gn,gn,Lr),wn+=1,to.element=Zr;const Io=Jt(to);Io>Pn&&(Pn=Io),Ut.currentGroup=lt(cr,Zr),(0,kr.X)(Ut,Lr,Io*Xe,Ge)}}const Bn=me?Bt.f8.clone(me.boundingSphere):void 0,Mn=lr.P.getMesh(Ut);if(0===wn)return Mn;let Ln;return g.eB.scale(gn,gn,1/wn),Ln=Bn&&g.eB.distance(gn,Bn.center)/Bn.radius<1?Bn:Bt.f8.expand((0,Bt.f8)(),(Pe??x).boundary.sphere,Pn*Xe+.05),Mn.setBoundingSphere(Ln),Mn}function ar(oe,x,F,z,me){const{child:Pe}=x,{sizeFactor:Ge,stride:Xe}=z,{getSerialIndex:Qe}=x.serialMapping,lt=x.elementCount,ft=Bi.create(lt,lt/2,me),wt=F.size.size,Ut=(0,g.eB)();let Jt=0,gn=0;for(const Mn of x.units){const Ln=Pe?.unitMap.get(Mn.id);if(Pe&&!Ln)return Qr.v.createEmpty(me);const{elements:cr,conformation:qn}=Mn,Qn=cr.length,Zn=(0,g.eB)(),zn=bi(x,Mn,z),Lr=Je.iZ.Location.create(x,Mn);if(Xe&&Xe>1||zn||"uniform"!==F.size.granularity)for(let wr=0;wr<Qn;wr++){const to=cr[wr];if(Xe&&wr%Xe!=0||zn&&zn(to))continue;qn.position(to,Zn),ft.add(Zn[0],Zn[1],Zn[2],Qe(Mn,to)),Li(Ut,Ut,Zn),gn+=1,Lr.element=to;const Cr=wt(Lr);Cr>Jt&&(Jt=Cr)}else{for(let wr=0;wr<Qn;wr++){const to=cr[wr];qn.position(to,Zn),ft.add(Zn[0],Zn[1],Zn[2],Qe(Mn,to)),Li(Ut,Ut,Zn)}gn+=Qn,Jt=wt(Lr)}}const Pn=me?Bt.f8.clone(me.boundingSphere):void 0,wn=ft.getSpheres();if(0===gn)return wn;let Bn;return g.eB.scale(Ut,Ut,1/gn),Bn=Pn&&g.eB.distance(Ut,Pn.center)/Pn.radius<1?Pn:Bt.f8.expand((0,Bt.f8)(),(Pe??x).boundary.sphere,Jt*Ge+.05),wn.setBoundingSphere(Bn),wn}function kn(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe)||!Je.oE.areEquivalent(oe.structure,x))return!1;const{cumulativeUnitElementCount:me}=x.serialMapping;for(const Pe of oe.elements){const Ge=x.unitIndexMap.get(Pe.unit.id);if(void 0!==Ge)if(Tt.IX.is(Pe.indices)){const Xe=me[Ge]+Tt.IX.start(Pe.indices),Qe=me[Ge]+Tt.IX.end(Pe.indices);F(Tt.IX.ofBounds(Xe,Qe))&&(z=!0)}else for(let Xe=0,Qe=Pe.indices.length;Xe<Qe;Xe++)F(Tt.IX.ofSingleton(me[Ge]+Pe.indices[Xe]))&&(z=!0)}return z}function ur(oe,x,F){const{objectId:z,groupId:me}=oe;if(F===z){const{unitIndices:Pe,cumulativeUnitElementCount:Ge}=x.serialMapping,Xe=Pe[me],Qe=x.units[Xe],ft=Tt.CD.ofSingleton(me-Ge[Xe]);return Je.iZ.Loci(x,[{unit:Qe,indices:ft}])}return Rn.BL}var sr;!function(oe){oe.fromGroup=function x(z){const{group:me,structure:Pe}=z,Ge=me.elements.length,Xe=me.units.length,Qe=Je.iZ.Location.create(Pe);return(0,oo.iQ)(Ge,Xe,1,(ft,wt)=>{const Ut=me.units[wt];return Qe.unit=Ut,Qe.element=Ut.elements[ft],Qe})},oe.fromStructure=function F(z){const{units:me,elementCount:Pe}=z,Ge=Pe,{unitIndices:Qe,elementIndices:lt}=z.serialMapping,ft=Je.iZ.Location.create(z);return(0,oo.iQ)(Ge,1,1,Ut=>(ft.unit=me[Qe[Ut]],ft.element=lt[Ut],ft),!0)}}(sr||(sr={}));var Jn=n(5019);const Br={sizeFactor:v.t.Numeric(1,{min:0,max:10,step:.1}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),traceOnly:v.t.Boolean(!1),tryUseImpostor:v.t.Boolean(!0),stride:v.t.Numeric(1,{min:1,max:100,step:1})},st={...tr.Te,...tr.qg,...Br};function et(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth&&z.extensions.textureFloat?function at(oe){return(0,tr.uF)({defaultProps:v.t.getDefaultValues(st),createGeometry:Ei,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{x.createGeometry=F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.traceOnly!==z.traceOnly||F.stride!==z.stride},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function Et(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(st),createGeometry:Vi,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.traceOnly!==z.traceOnly||F.stride!==z.stride},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}const Nt={...ti.EN,...ti.T9,...Br};function qt(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth&&z.extensions.textureFloat?function Cn(oe){return(0,ti.zo)({defaultProps:v.t.getDefaultValues(Nt),createGeometry:ar,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{x.createGeometry=F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.traceOnly!==z.traceOnly||F.stride!==z.stride},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function Un(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(Nt),createGeometry:Gn,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.traceOnly!==z.traceOnly||F.stride!==z.stride},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}var vn=n(8688),nr=n(1137),pr=n(1758),Rr=n(5201);const mo={"element-sphere":(oe,x)=>(0,vn.T)("Element sphere",oe,x,et),"intra-bond":(oe,x)=>(0,vn.T)("Intra-unit bond cylinder",oe,x,mi),"inter-bond":(oe,x)=>(0,nr.K)("Inter-unit bond cylinder",oe,x,Hn)},Uo={...st,traceOnly:v.t.Boolean(!1,{isHidden:!0}),...Ci,...Qi,includeParent:v.t.Boolean(!1),unitKinds:(0,Rr.R8)(["atomic"]),sizeFactor:v.t.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:v.t.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:v.t.MultiSelect(["element-sphere","intra-bond","inter-bond"],v.t.objectToOptions(mo)),bumpFrequency:v.t.Numeric(0,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},fo=(0,pr.GT)({name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:function ri(oe,x){return dr.YL.createMulti("Ball & Stick",oe,x,pr.J1,mo)},getParams:function qo(oe,x){if(Je.oE.getSize(x)>=Je.oE.Size.Huge){const z=v.t.clone(Uo);return z.visuals.defaultValue=["element-sphere","intra-bond"],z}return Uo},defaultValues:v.t.getDefaultValues(Uo),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:oe=>oe.elementCount>0,getData:(oe,x)=>x.includeParent?oe.asParent():oe,mustRecreate:(oe,x)=>oe.includeParent!==x.includeParent});function Lo(oe,x,F,z,me){const{links:Pe,elements:Ge}=x.carbohydrates,{linkSizeFactor:Xe}=z,Qe=Je.iZ.Location.create(x),lt={linkCount:Pe.length,position:(Ut,Jt,gn)=>{const Pn=Pe[gn];g.eB.copy(Ut,Ge[Pn.carbohydrateIndexA].geometry.center),g.eB.copy(Jt,Ge[Pn.carbohydrateIndexB].geometry.center)},radius:Ut=>{const gn=Ge[Pe[Ut].carbohydrateIndexA],Pn=gn.unit.rings.all[gn.ringIndex];return Qe.unit=gn.unit,Qe.element=gn.unit.elements[Pn[0]],F.size.size(Qe)*Xe}},{mesh:ft,boundingSphere:wt}=(0,Vr.C1)(oe,lt,z,me);if(wt)ft.setBoundingSphere(wt);else if(ft.triangleCount>0){const Ut=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*Xe);ft.setBoundingSphere(Ut)}return ft}const Ni={...tr.Te,...Vr.Lr,linkSizeFactor:v.t.Numeric(.3,{min:0,max:3,step:.01})};function rs(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(Ni),createGeometry:Lo,createLocationIterator:Gi,getLoci:_o,eachLocation:Wr,setUpdateState:(x,F,z)=>{x.createGeometry=F.linkSizeFactor!==z.linkSizeFactor||F.radialSegments!==z.radialSegments||F.linkCap!==z.linkCap}},oe)}function Gi(oe){const{elements:x,links:F}=oe.carbohydrates,z=F.length,Pe=Je.iZ.Location.create(oe);return(0,oo.iQ)(z,1,1,Xe=>{const lt=x[F[Xe].carbohydrateIndexA],ft=lt.unit.rings.all[lt.ringIndex];return Pe.unit=lt.unit,Pe.element=lt.unit.elements[ft[0]],Pe},!0)}function _o(oe,x,F){const{objectId:z,groupId:me}=oe;if(F===z){const{links:Pe,elements:Ge}=x.carbohydrates,Xe=Pe[me],Qe=Ge[Xe.carbohydrateIndexA],lt=Ge[Xe.carbohydrateIndexB];return Je.iZ.Loci.union((0,Gr.rS)(x,Qe.unit,Qe.residueIndex,Qe.altId),(0,Gr.rS)(x,lt.unit,lt.residueIndex,lt.altId))}return Rn.BL}const hr=new Set;function Wr(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe)||!Je.oE.areEquivalent(oe.structure,x))return!1;const{getLinkIndices:me}=x.carbohydrates;for(const{unit:Pe,indices:Ge}of oe.elements)Je.Nf.isAtomic(Pe)&&(hr.clear(),Tt.CD.forEach(Ge,Xe=>{const Qe=me(Pe,Pe.elements[Xe]);for(let lt=0,ft=Qe.length;lt<ft;++lt)hr.has(Qe[lt])||(hr.add(Qe[lt]),F(Tt.IX.ofSingleton(Qe[lt]))&&(z=!0))}));return z}var no=n(3280),zo=n(6928),Di=n(863);const zi=g.eB.create(0,0,-.5),Ki=g.eB.create(0,0,.5),Mi=(0,g.eB)(),ds=(0,g.eB)(),he=(0,g.eB)(),fe=(0,g.eB)();let Rt,pe;const xt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},hn=g.eB.zero(),dn=g.eB.zero(),In=g.eB.zero(),Tn=g.eB.zero(),_n=g.eB.zero();var Xn=n(8937);const Er=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],$n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],mr=[0,2,4,0,4,3,1,2,5,1,5,3];let Ar,io;(0,Xn.L3)(Er,[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5]);var Xo=n(3220),uo=n(442);const yr=g.$I.identity(),bo=(0,g.eB)(),$r=(0,g.eB)(),_r=1.612,eo=(0,no.az)(),Ho=(0,no.wV)(),wi=function X(){return Rt||(Rt=function ze(oe){const x=oe.length/3,z=(3===x?1:4===x?2:x)+x,Pe=(0,zo.nT)(z,4===x?3*x+4:3*z);for(let Ge=0;Ge<x;++Ge){const Xe=(Ge+1)%x;g.eB.set(Mi,oe[3*Ge],oe[3*Ge+1],-.5),g.eB.set(ds,oe[3*Xe],oe[3*Xe+1],-.5),Pe.add(Mi,ds,Ki)}if(3===x)g.eB.set(Mi,oe[0],oe[1],-.5),g.eB.set(ds,oe[3],oe[4],-.5),g.eB.set(he,oe[6],oe[7],-.5),Pe.add(he,ds,Mi);else if(4===x)g.eB.set(Mi,oe[0],oe[1],-.5),g.eB.set(ds,oe[3],oe[4],-.5),g.eB.set(he,oe[6],oe[7],-.5),g.eB.set(fe,oe[9],oe[10],-.5),Pe.addQuad(fe,he,ds,Mi);else for(let Ge=0;Ge<x;++Ge){const Xe=(Ge+1)%x;g.eB.set(Mi,oe[3*Ge],oe[3*Ge+1],-.5),g.eB.set(ds,oe[3*Xe],oe[3*Xe+1],-.5),Pe.add(zi,ds,Mi)}return Pe.getPrimitive()}((0,Di.n)(8,!0))),Rt}(),ui=function De(){if(!pe){const oe=(0,Di.n)(8,!0),x=new Float32Array(30);for(let z=0;z<8;++z)x[3*z]=oe[3*z],x[3*z+1]=oe[3*z+1],x[3*z+2]=-.5;x[24]=0,x[25]=0,x[26]=-.5,x[27]=0,x[28]=0,x[29]=.5,pe=(0,zo.m9)(x,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return pe}(),Ss=function Wn(oe){const{outerRadius:x,innerRadius:F,thickness:z,pointCount:me}={...xt,...oe},Ge=(0,zo.nT)(2*me*2),Xe=new Float32Array(2*me),Qe=new Float32Array(2*me);for(let lt=0;lt<me;++lt){const ft=2*lt,wt=2*lt+1,Ut=(ft+1)/me*Math.PI,Jt=(wt+1)/me*Math.PI;Qe[ft]=Math.cos(Ut)*x,Qe[wt]=Math.sin(Ut)*x,Xe[ft]=Math.cos(Jt)*F,Xe[wt]=Math.sin(Jt)*F}g.eB.set(hn,0,0,z/2),g.eB.set(dn,0,0,-z/2);for(let lt=0;lt<me;++lt){const ft=(lt+1)%me;g.eB.set(In,Qe[2*lt],Qe[2*lt+1],0),g.eB.set(Tn,Xe[2*lt],Xe[2*lt+1],0),g.eB.set(_n,Qe[2*ft],Qe[2*ft+1],0),Ge.add(hn,In,Tn),Ge.add(Tn,In,dn),Ge.add(hn,Tn,_n),Ge.add(_n,Tn,dn)}return Ge.getPrimitive()}({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Os=function Xr(){return Ar||(Ar=(0,zo.m9)(Er,$n)),Ar}(),ys=function Mo(){return io||(io=(0,zo.m9)(Er,mr)),io}(),Zs=(0,Xo.uo)(),bs=(0,Xo.r7)(),Fu=(0,Xo.jg)(),Nu=(0,Xo.SM)(),Kc=(0,Xo.VH)();function Uu(oe,x,F,z,me){const Pe=lr.P.createState(256,128,me),{detail:Ge,sizeFactor:Xe}=z,Qe=x.carbohydrates,lt=Qe.elements.length,ft=Je.iZ.Location.create(x);for(let wt=0;wt<lt;++wt){const Ut=Qe.elements[wt],Jt=Ut.unit.rings.all[Ut.ringIndex],gn=(0,uo.N0)(Ut.component.type,Jt.length);ft.unit=Ut.unit,ft.element=Ut.unit.elements[Jt[0]];const Pn=F.size.size(ft),wn=Pn*Xe,Bn=Pn*Xe*_r,{center:Mn,normal:Ln,direction:cr}=Ut.geometry;switch(g.eB.add($r,Mn,cr),g.$I.targetTo(yr,Mn,$r,Ln),g.$I.setTranslation(yr,Mn),Pe.currentGroup=2*wt,gn){case uo.RP.FilledSphere:(0,kr.X)(Pe,Mn,wn,Ge);break;case uo.RP.FilledCube:g.$I.scaleUniformly(yr,yr,Bn),lr.P.addPrimitive(Pe,yr,eo);break;case uo.RP.CrossedCube:g.$I.scaleUniformly(yr,yr,Bn),lr.P.addPrimitive(Pe,yr,Ho),g.$I.mul(yr,yr,g.$I.rotZ90X180),Pe.currentGroup+=1,lr.P.addPrimitive(Pe,yr,Ho);break;case uo.RP.FilledCone:g.$I.scaleUniformly(yr,yr,1.2*Bn),lr.P.addPrimitive(Pe,yr,wi);break;case uo.RP.DevidedCone:g.$I.scaleUniformly(yr,yr,1.2*Bn),lr.P.addPrimitive(Pe,yr,ui),g.$I.mul(yr,yr,g.$I.rotZ90),Pe.currentGroup+=1,lr.P.addPrimitive(Pe,yr,ui);break;case uo.RP.FlatBox:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,Bn,Bn,Bn/2)),lr.P.addPrimitive(Pe,yr,eo);break;case uo.RP.FilledStar:g.$I.scaleUniformly(yr,yr,Bn),g.$I.mul(yr,yr,g.$I.rotZY90),lr.P.addPrimitive(Pe,yr,Ss);break;case uo.RP.FilledDiamond:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,1.4*Bn,1.4*Bn,1.4*Bn)),lr.P.addPrimitive(Pe,yr,Os);break;case uo.RP.DividedDiamond:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,1.4*Bn,1.4*Bn,1.4*Bn)),lr.P.addPrimitive(Pe,yr,ys),g.$I.mul(yr,yr,g.$I.rotY90),Pe.currentGroup+=1,lr.P.addPrimitive(Pe,yr,ys);break;case uo.RP.FlatDiamond:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,Bn,Bn/2,Bn/2)),lr.P.addPrimitive(Pe,yr,Zs);break;case uo.RP.DiamondPrism:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,Bn,Bn,Bn/2)),lr.P.addPrimitive(Pe,yr,Zs);break;case uo.RP.PentagonalPrism:case uo.RP.Pentagon:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,Bn,Bn,Bn/2)),lr.P.addPrimitive(Pe,yr,bs);break;case uo.RP.HexagonalPrism:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,Bn,Bn,Bn/2)),lr.P.addPrimitive(Pe,yr,Fu);break;case uo.RP.HeptagonalPrism:g.$I.mul(yr,yr,g.$I.rotZY90),g.$I.scale(yr,yr,g.eB.set(bo,Bn,Bn,Bn/2)),lr.P.addPrimitive(Pe,yr,Kc);break;default:g.$I.mul(yr,yr,g.$I.rotZYZ90),g.$I.scale(yr,yr,g.eB.set(bo,Bn/1.5,Bn,Bn/2)),lr.P.addPrimitive(Pe,yr,Nu)}}return lr.P.getMesh(Pe)}const Es={...ti.EN,detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),sizeFactor:v.t.Numeric(1.75,{min:0,max:10,step:.01})};function ma(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(Es),createGeometry:Uu,createLocationIterator:Ya,getLoci:Zc,eachLocation:_m,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail}},oe)}function Ya(oe){const x=oe.carbohydrates.elements,F=2*x.length,me=Je.iZ.Location.create(oe);return(0,oo.iQ)(F,1,1,function Pe(Xe,Qe){const lt=x[Math.floor(Xe/2)],ft=lt.unit.rings.all[lt.ringIndex];return me.unit=lt.unit,me.element=lt.unit.elements[ft[0]],me},!0,function Ge(Xe,Qe){return Xe%2==1})}function Zc(oe,x,F){const{objectId:z,groupId:me}=oe;if(F===z){const Pe=x.carbohydrates.elements[Math.floor(me/2)];return(0,Gr.rS)(x,Pe.unit,Pe.residueIndex,Pe.altId)}return Rn.BL}const Pa=new Set;function _m(oe,x,F){const{getElementIndices:z}=x.carbohydrates;let me=!1;if(!Je.iZ.Loci.is(oe)||!Je.oE.areEquivalent(oe.structure,x))return!1;for(const{unit:Pe,indices:Ge}of oe.elements)Je.Nf.isAtomic(Pe)&&(Pa.clear(),Tt.CD.forEach(Ge,Xe=>{const Qe=z(Pe,Pe.elements[Xe]);for(let lt=0,ft=Qe.length;lt<ft;++lt)Pa.has(Qe[lt])||(Pa.add(Qe[lt]),F(Tt.IX.ofSingleton(2*Qe[lt]))&&(me=!0))}));return me}var sd=n(6066);function bm(oe,x,F,z,me){const{terminalLinks:Pe,elements:Ge}=x.carbohydrates,{terminalLinkSizeFactor:Xe}=z,Qe=Je.iZ.Location.create(x),lt={linkCount:Pe.length,position:(Ut,Jt,gn)=>{const Pn=Pe[gn];Pn.fromCarbohydrate?(g.eB.copy(Ut,Ge[Pn.carbohydrateIndex].geometry.center),Pn.elementUnit.conformation.position(Pn.elementUnit.elements[Pn.elementIndex],Jt)):(Pn.elementUnit.conformation.position(Pn.elementUnit.elements[Pn.elementIndex],Ut),g.eB.copy(Jt,Ge[Pn.carbohydrateIndex].geometry.center))},radius:Ut=>{const Jt=Pe[Ut];if(Jt.fromCarbohydrate){const gn=Ge[Jt.carbohydrateIndex],Pn=gn.unit.rings.all[gn.ringIndex];Qe.unit=gn.unit,Qe.element=gn.unit.elements[Pn[0]]}else Qe.unit=Jt.elementUnit,Qe.element=Jt.elementUnit.elements[Jt.elementIndex];return F.size.size(Qe)*Xe},style:Ut=>{const Jt=Pe[Ut],Pn=(0,sd.Yd)(Jt.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(Jt.elementUnit.elements[Jt.elementIndex]));return sd.ZL.has(Pn)?1:0}},{mesh:ft,boundingSphere:wt}=(0,Vr.C1)(oe,lt,z,me);if(wt)ft.setBoundingSphere(wt);else if(ft.triangleCount>0){const Ut=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*Xe);ft.setBoundingSphere(Ut)}return ft}const ad={...tr.Te,...Vr.Lr,terminalLinkSizeFactor:v.t.Numeric(.2,{min:0,max:3,step:.01})};function xm(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(ad),createGeometry:bm,createLocationIterator:Cm,getLoci:Sm,eachLocation:Em,setUpdateState:(x,F,z)=>{x.createGeometry=F.terminalLinkSizeFactor!==z.terminalLinkSizeFactor||F.radialSegments!==z.radialSegments||F.linkCap!==z.linkCap}},oe)}function Cm(oe){const{elements:x,terminalLinks:F}=oe.carbohydrates,z=F.length,Pe=Je.iZ.Location.create(oe);return(0,oo.iQ)(z,1,1,Xe=>{const Qe=F[Xe];if(Qe.fromCarbohydrate){const lt=x[Qe.carbohydrateIndex],ft=lt.unit.rings.all[lt.ringIndex];Pe.unit=lt.unit,Pe.element=lt.unit.elements[ft[0]]}else Pe.unit=Qe.elementUnit,Pe.element=Qe.elementUnit.elements[Qe.elementIndex];return Pe},!0)}function Sm(oe,x,F){const{objectId:z,groupId:me}=oe;if(F===z){const{terminalLinks:Pe,elements:Ge}=x.carbohydrates,Xe=Pe[me],Qe=Ge[Xe.carbohydrateIndex];return Je.iZ.Loci.union((0,Gr.rS)(x,Qe.unit,Qe.residueIndex,Qe.altId),(0,Gr.uh)(x,Xe.elementUnit,Xe.elementUnit.elements[Xe.elementIndex]))}return Rn.BL}const Vu=new Set;function Em(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe)||!Je.oE.areEquivalent(oe.structure,x))return!1;const{getTerminalLinkIndices:me}=x.carbohydrates;for(const{unit:Pe,indices:Ge}of oe.elements)Je.Nf.isAtomic(Pe)&&(Vu.clear(),Tt.CD.forEach(Ge,Xe=>{const Qe=me(Pe,Pe.elements[Xe]);for(let lt=0,ft=Qe.length;lt<ft;++lt)Vu.has(Qe[lt])||(Vu.add(Qe[lt]),F(Tt.IX.ofSingleton(Qe[lt]))&&(z=!0))}));return z}const cd={"carbohydrate-symbol":(oe,x)=>(0,nr.K)("Carbohydrate symbol mesh",oe,x,ma),"carbohydrate-link":(oe,x)=>(0,nr.K)("Carbohydrate link cylinder",oe,x,rs),"carbohydrate-terminal-link":(oe,x)=>(0,nr.K)("Carbohydrate terminal link cylinder",oe,x,xm)},ud={...Es,...Ni,...ad,visuals:v.t.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],v.t.objectToOptions(cd)),bumpFrequency:v.t.Numeric(0,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},Pm=(0,pr.GT)({name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:function Am(oe,x){return dr.YL.createMulti("Carbohydrate",oe,x,pr.J1,cd)},getParams:function Im(oe,x){return ud},defaultValues:v.t.getDefaultValues(ud),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.models.some(x=>Je.Kx.hasCarbohydrate(x))});var _i=n(2802),oa=n(5734);function ld(oe,x){switch(oe.kind){case 0:return function Tm(oe,x){const F=oe.model.atomicRanges.cyclicPolymerMap,z=oa.m.transientSegments(Lc(oe),oe.elements),me=Tt.hT.transientSegments(oe.model.atomicHierarchy.residueAtomSegments,oe.elements),Pe=oe.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:Ge}=oe.model.atomicHierarchy.derived.residue;let Xe=-1,Qe=-1,lt=!0,ft=-1,wt=0;for(;z.hasNext;){for(lt=!0,ft=wt,me.setSegment(z.move());me.hasNext;){if(lt){const Jt=me.move().index;if(++wt,!me.hasNext)continue;lt=!1,Qe=Jt}Xe=Qe,Qe=me.move().index,x(Pe[Xe],Pe[Qe],wt-1,wt,Ge[Xe]),++wt}F.has(Qe)&&(Xe=Qe,Qe=F.get(Xe),x(Pe[Xe],Pe[Qe],wt-1,ft,Ge[Xe]))}}(oe,x);case 1:case 2:return function Bm(oe,x){const F=oa.m.transientSegments(Lc(oe),oe.elements),{elements:z}=oe;let me=!0,Pe=0;for(;F.hasNext;){me=!0;const Ge=F.move();for(let lt=Ge.start,ft=Ge.end;lt<ft;++lt){if(me){if(++lt,++Pe,lt>ft)continue;me=!1}x(z[lt-1],z[lt],Pe-1,Pe,0),++Pe}}}(oe,x)}}function dd(oe,x){switch(oe.kind){case 0:return function Dm(oe,x){const F=oa.m.transientSegments(Lc(oe),oe.elements),z=Tt.hT.transientSegments(oe.model.atomicHierarchy.residueAtomSegments,oe.elements),me=oe.model.atomicHierarchy.derived.residue.traceElementIndex;let Pe=0;for(;F.hasNext;)for(z.setSegment(F.move());z.hasNext;)x(me[z.move().index],Pe),++Pe}(oe,x);case 1:case 2:return function Mm(oe,x){const F=oa.m.transientSegments(Lc(oe),oe.elements),{elements:z}=oe;let me=0;for(;F.hasNext;){const Pe=F.move();for(let Qe=Pe.start,lt=Pe.end;Qe<lt;++Qe)x(z[Qe],me),++me}}(oe,x)}}function fd(oe,x){return{centerA:Je.iZ.Location.create(oe,x),centerB:Je.iZ.Location.create(oe,x)}}class Rm{move(){const{elements:x,residueIndex:F}=this.unit,z=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[F[x[z.start]]],this.value.centerB.element=this.traceElementIndex[F[x[z.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}constructor(x,F){this.unit=F,this.hasNext=!1,this.traceElementIndex=F.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=oa.m.transientSegments(xd(F),F.elements),this.value=fd(x,F),this.hasNext=this.gapIt.hasNext}}class Lm{move(){const x=this.gapIt.move();return this.value.centerA.element=this.unit.elements[x.start],this.value.centerB.element=this.unit.elements[x.end-1],this.hasNext=this.gapIt.hasNext,this.value}constructor(x,F){this.unit=F,this.hasNext=!1,this.gapIt=oa.m.transientSegments(xd(F),F.elements),this.value=fd(x,F),this.hasNext=this.gapIt.hasNext}}var Yc=n(8699),wm=n(1692),Fm=n(387),Nm=n(2928);function Um(oe){const{x,y:F,z}=oe.atomicConformation,{polymerType:me,traceElementIndex:Pe}=oe.atomicHierarchy.derived.residue,Ge=me.length,Xe=Tt.CD.ofBounds(0,oe.atomicConformation.atomId.rowCount),Qe=oa.m.transientSegments(oe.atomicRanges.polymerRanges,Xe),lt=Nm.h.transientSegments(oe.atomicHierarchy.residueAtomSegments,Xe),ft=new Float32Array(3*Ge),wt=new Float32Array(3*Ge);let Ut=0,Jt=-1,gn=-1;const Pn=(0,g.eB)(),wn=(0,g.eB)(),Bn=(0,g.eB)(),Mn=(0,g.eB)(),Ln=(0,g.eB)(),cr=(0,g.eB)(),qn=(0,g.eB)(),Qn=(0,g.eB)(),Zn=(0,g.eB)(),zn=(0,g.eB)(),Lr=(0,g.eB)(),wr=(0,g.eB)(),to=(0,g.eB)(),Cr=(0,g.eB)();for(;Qe.hasNext;){const Zr=Qe.move();for(lt.setSegment(Zr),Ut=-1,gn=-1;lt.hasNext;){Ut+=1;const{index:li}=lt.move();0===Ut&&(gn=li),Jt=li-2;const Vo=3*Jt;g.eB.copy(Pn,wn),g.eB.copy(wn,Bn),g.eB.copy(Bn,Mn);const jo=Pe[li];if(g.eB.set(Mn,x[jo],F[jo],z[jo]),Ut<3)continue;g.eB.sub(Ln,wn,Pn),g.eB.sub(cr,Bn,wn),g.eB.sub(qn,Mn,Bn),g.eB.sub(Lr,Ln,cr),g.eB.sub(wr,cr,qn),g.eB.cross(to,Lr,wr),g.eB.normalize(to,to),g.eB.toArray(to,wt,Vo);const go=Math.cos(g.eB.angle(Lr,wr)),Qo=g.eB.magnitude(Lr),Ko=g.eB.magnitude(wr),$o=Math.sqrt(Ko*Qo)/Math.max(2,2*(1-go));g.eB.scale(Qn,Lr,$o/Qo),g.eB.sub(Qn,wn,Qn),g.eB.toArray(Qn,ft,Vo),g.eB.scale(Zn,wr,$o/Ko),g.eB.sub(Zn,Bn,Zn),g.eB.toArray(Zn,ft,Vo+3),g.eB.copy(Cr,to)}const Io=3*gn;g.eB.fromArray(Qn,ft,Io+3),g.eB.fromArray(Zn,ft,Io+6),g.eB.normalize(to,g.eB.sub(to,Qn,Zn));const wo=Pe[gn];g.eB.set(Pn,x[wo],F[wo],z[wo]),g.eB.copy(zn,Pn),g.eB.projectPointOnVector(zn,zn,to,Qn),g.eB.toArray(zn,ft,Io);const si=Jt+2,Ii=3*si;g.eB.fromArray(Qn,ft,Ii-3),g.eB.fromArray(Zn,ft,Ii-6),g.eB.normalize(to,g.eB.sub(to,Qn,Zn));const ai=Pe[si];g.eB.set(Pn,x[ai],F[ai],z[ai]),g.eB.copy(zn,Pn),g.eB.projectPointOnVector(zn,zn,to,Qn),g.eB.toArray(zn,ft,Ii)}return{centers:ft}}const Gu=Fm._.createProvider({label:"Helix Orientation",descriptor:(0,wm.e)({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:()=>({}),isApplicable:oe=>!0,obtain:function(){var oe=(0,r.A)(function*(x,F){return{value:Um(F)}});return function(F,z){return oe.apply(this,arguments)}}()});function Hs(oe){return Tr.gG.is(oe,2)}function zu(oe,x,F={}){switch(oe.kind){case 0:return new Gm(oe,x,F);case 1:case 2:return new zm(oe,x)}}const Xc=Tr.gG.create(536870912);function md(oe,x){return{center:Je.iZ.Location.create(oe,x),centerPrev:Je.iZ.Location.create(oe,x),centerNext:Je.iZ.Location.create(oe,x),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:Xc,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:(0,g.eB)(),p1:(0,g.eB)(),p2:(0,g.eB)(),p3:(0,g.eB)(),p4:(0,g.eB)(),d12:(0,g.eB)(),d23:(0,g.eB)()}}const xo=(0,g.eB)(),$c=(0,g.eB)(),Jc=(0,g.eB)();class Gm{atomicPos(x,F){-1!==F&&(x[0]=this.atomicConformation.x[F],x[1]=this.atomicConformation.y[F],x[2]=this.atomicConformation.z[F])}pos(x,F,z){const me=this.traceElementIndex[F];this.helixOrientationCenters&&Hs(z)?g.eB.fromArray(x,this.helixOrientationCenters,3*F):this.atomicPos(x,me)}updateResidueSegmentRange(x){const{index:F}=this.residueAtomSegments;this.residueSegmentMin=F[this.polymerRanges[2*x.index]],this.residueSegmentMax=F[this.polymerRanges[2*x.index+1]]}getResidueIndex(x){if(x<this.residueSegmentMin){const F=this.cyclicPolymerMap.get(this.residueSegmentMin);x=void 0!==F?F-(this.residueSegmentMin-x-1):this.residueSegmentMin}else if(x>this.residueSegmentMax){const F=this.cyclicPolymerMap.get(this.residueSegmentMax);x=void 0!==F?F+(x-this.residueSegmentMax-1):this.residueSegmentMax}return x}getSecStruc(x){if(this.secondaryStructure){const{type:F,getIndex:z}=this.secondaryStructure,me=F[z(x)];return Hs(me)?2:me}return Xc}setControlPoint(x,F,z,me,Pe){(function Vm(oe){return Tr.gG.is(oe,4)})(Pe)||this.helixOrientationCenters&&Hs(Pe)?g.eB.scale(x,g.eB.add(x,F,g.eB.add(x,me,g.eB.add(x,z,z))),1/4):g.eB.copy(x,z)}setFromToVector(x,F,z){this.value.isCoarseBackbone||this.helixOrientationCenters&&Hs(z)?g.eB.set(x,1,0,0):(this.atomicPos($c,this.directionFromElementIndex[F]),this.atomicPos(Jc,this.directionToElementIndex[F]),g.eB.sub(x,Jc,$c))}setDirection(x,F,z,me){g.eB.matchDirection($c,F,z),g.eB.matchDirection(Jc,me,z),g.eB.scale(x,g.eB.add(x,$c,g.eB.add(x,Jc,g.eB.add(x,z,z))),1/4)}move(){const{residueIt:x,polymerIt:F,value:z}=this;if(0===this.state)for(;F.hasNext;)if(this.polymerSegment=F.move(),x.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),x.hasNext){this.state=1;const me=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],Pe=this.getResidueIndex(me-1);this.currSecStrucType=me===Pe?Xc:this.getSecStruc(Pe),this.nextSecStrucType=this.getSecStruc(me),this.currCoarseBackbone=-1===this.directionFromElementIndex[Pe]||-1===this.directionToElementIndex[Pe],this.nextCoarseBackbone=-1===this.directionFromElementIndex[me]||-1===this.directionToElementIndex[me];break}if(1===this.state){const{index:me}=x.move(),Pe=this.getResidueIndex(me-3),Ge=this.getResidueIndex(me-2),Xe=this.getResidueIndex(me-1),Qe=this.getResidueIndex(me+1),lt=this.getResidueIndex(me+2),ft=this.getResidueIndex(me+3);this.prevSecStrucType=this.getSecStruc(Xe),this.currSecStrucType=this.getSecStruc(me),this.nextSecStrucType=me===Qe?Xc:this.getSecStruc(Qe),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=-1===this.directionFromElementIndex[Qe]||-1===this.directionToElementIndex[Qe],z.secStrucType=this.currSecStrucType,z.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,z.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,z.isCoarseBackbone=this.currCoarseBackbone,z.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,z.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,z.first=me===this.residueSegmentMin,z.last=me===this.residueSegmentMax,z.moleculeType=this.moleculeType[me],z.initial=me===Xe,z.final=me===Qe,z.centerPrev.element=this.traceElementIndex[Xe],z.center.element=this.traceElementIndex[me],z.centerNext.element=this.traceElementIndex[Qe];const wt=this.getSecStruc(Pe),Ut=this.getSecStruc(Ge),Jt=this.getSecStruc(Xe),gn=this.getSecStruc(me),Pn=this.getSecStruc(Qe),wn=this.getSecStruc(lt),Bn=this.getSecStruc(ft);this.pos(this.p0,Pe,wt),this.pos(this.p1,Ge,Ut),this.pos(this.p2,Xe,Jt),this.pos(this.p3,me,gn),this.pos(this.p4,Qe,Pn),this.pos(this.p5,lt,wn),this.pos(this.p6,ft,Bn);const Mn=Hs(wt),Ln=Hs(Ut),cr=Hs(Jt),qn=Hs(gn),Qn=Hs(Pn),Zn=Hs(wn),zn=Hs(Bn);this.helixOrientationCenters&&(qn!==cr?qn?(g.eB.copy(this.p0,this.p3),g.eB.copy(this.p1,this.p3),g.eB.copy(this.p2,this.p3)):cr&&(g.eB.scale(xo,g.eB.sub(xo,this.p2,this.p3),2),g.eB.add(this.p2,this.p3,xo),g.eB.add(this.p1,this.p2,xo),g.eB.add(this.p0,this.p1,xo)):qn!==Ln?qn?(g.eB.copy(this.p0,this.p2),g.eB.copy(this.p1,this.p2)):Ln&&(g.eB.scale(xo,g.eB.sub(xo,this.p1,this.p2),2),g.eB.add(this.p1,this.p2,xo),g.eB.add(this.p0,this.p1,xo)):qn!==Mn&&(qn?g.eB.copy(this.p0,this.p1):Mn&&(g.eB.scale(xo,g.eB.sub(xo,this.p0,this.p1),2),g.eB.add(this.p0,this.p1,xo))),qn!==Qn?qn?(g.eB.copy(this.p4,this.p3),g.eB.copy(this.p5,this.p3),g.eB.copy(this.p6,this.p3)):Qn&&(g.eB.scale(xo,g.eB.sub(xo,this.p4,this.p3),2),g.eB.add(this.p4,this.p3,xo),g.eB.add(this.p5,this.p4,xo),g.eB.add(this.p6,this.p5,xo)):qn!==Zn?qn?(g.eB.copy(this.p5,this.p4),g.eB.copy(this.p6,this.p4)):Zn&&(g.eB.scale(xo,g.eB.sub(xo,this.p5,this.p4),2),g.eB.add(this.p5,this.p4,xo),g.eB.add(this.p6,this.p5,xo)):qn!==zn&&(qn?g.eB.copy(this.p6,this.p5):zn&&(g.eB.scale(xo,g.eB.sub(xo,this.p6,this.p5),2),g.eB.add(this.p6,this.p5,xo)))),this.setFromToVector(this.d01,Xe,Jt),this.setFromToVector(this.d12,me,gn),this.setFromToVector(this.d23,Qe,Pn),this.setFromToVector(this.d34,lt,wn);const Lr=qn&&this.helixOrientationCenters,wr=1.5;me===Xe||gn!==Jt&&Lr?(g.eB.setMagnitude(xo,g.eB.sub(xo,this.p3,this.p4),wr),g.eB.add(this.p2,this.p3,xo),g.eB.add(this.p1,this.p2,xo),g.eB.add(this.p0,this.p1,xo)):Xe===Ge||gn!==Ut&&Lr?(g.eB.setMagnitude(xo,g.eB.sub(xo,this.p2,this.p3),wr),g.eB.add(this.p1,this.p2,xo),g.eB.add(this.p0,this.p1,xo)):(Ge===Pe||gn!==wt&&Lr)&&(g.eB.setMagnitude(xo,g.eB.sub(xo,this.p1,this.p2),wr),g.eB.add(this.p0,this.p1,xo)),me===Qe||gn!==Pn&&Lr?(g.eB.setMagnitude(xo,g.eB.sub(xo,this.p3,this.p2),wr),g.eB.add(this.p4,this.p3,xo),g.eB.add(this.p5,this.p4,xo),g.eB.add(this.p6,this.p5,xo)):Qe===lt||gn!==wn&&Lr?(g.eB.setMagnitude(xo,g.eB.sub(xo,this.p4,this.p3),wr),g.eB.add(this.p5,this.p4,xo),g.eB.add(this.p6,this.p5,xo)):(lt===ft||gn!==Bn&&Lr)&&(g.eB.setMagnitude(xo,g.eB.sub(xo,this.p5,this.p4),wr),g.eB.add(this.p6,this.p5,xo)),this.setControlPoint(z.p0,this.p0,this.p1,this.p2,Ut),this.setControlPoint(z.p1,this.p1,this.p2,this.p3,Jt),this.setControlPoint(z.p2,this.p2,this.p3,this.p4,gn),this.setControlPoint(z.p3,this.p3,this.p4,this.p5,Pn),this.setControlPoint(z.p4,this.p4,this.p5,this.p6,wn),this.setDirection(z.d12,this.d01,this.d12,this.d23),this.setDirection(z.d23,this.d12,this.d23,this.d34),x.hasNext||(this.state=0)}return this.hasNext=x.hasNext||F.hasNext,this.value}constructor(x,F,z={}){var me;if(this.unit=x,this.state=0,this.p0=(0,g.eB)(),this.p1=(0,g.eB)(),this.p2=(0,g.eB)(),this.p3=(0,g.eB)(),this.p4=(0,g.eB)(),this.p5=(0,g.eB)(),this.p6=(0,g.eB)(),this.d01=(0,g.eB)(),this.d12=(0,g.eB)(),this.d23=(0,g.eB)(),this.d34=(0,g.eB)(),this.hasNext=!1,this.atomicConformation=x.model.atomicConformation,this.residueAtomSegments=x.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=x.model.atomicRanges.polymerRanges,this.traceElementIndex=x.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=x.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=x.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=x.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=x.model.atomicRanges.cyclicPolymerMap,this.polymerIt=oa.m.transientSegments(this.polymerRanges,x.elements),this.residueIt=Tt.hT.transientSegments(this.residueAtomSegments,x.elements),this.value=md(F,x),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,z.ignoreSecondaryStructure||(this.secondaryStructure=null===(me=Yc.v.get(F).value)||void 0===me?void 0:me.get(x.invariantId)),z.useHelixOrientation){const Pe=Gu.get(x.model).value;if(!Pe)throw new Error("missing helix-orientation");this.helixOrientationCenters=Pe.centers}}}class zm{getElementIndex(x){return Math.min(Math.max(this.polymerSegment.start,x),this.polymerSegment.end-1)}pos(x,F){const z=this.unit.elements[F];x[0]=this.conformation.x[z],x[1]=this.conformation.y[z],x[2]=this.conformation.z[z]}move(){if(0===this.state)for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}if(1===this.state){const x=this.getElementIndex(this.elementIndex-2),F=this.getElementIndex(this.elementIndex-1),z=this.getElementIndex(this.elementIndex+1),me=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[F],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[z],this.pos(this.value.p0,x),this.pos(this.value.p1,F),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,z),this.pos(this.value.p4,me);const Pe=.5;this.elementIndex===F?(g.eB.scale(xo,g.eB.sub(xo,this.value.p2,this.value.p3),Pe),g.eB.add(this.value.p1,this.value.p2,xo),g.eB.add(this.value.p0,this.value.p1,xo)):F===x&&(g.eB.scale(xo,g.eB.sub(xo,this.value.p1,this.value.p2),Pe),g.eB.add(this.value.p0,this.value.p1,xo)),this.elementIndex===z?(g.eB.scale(xo,g.eB.sub(xo,this.value.p2,this.value.p1),Pe),g.eB.add(this.value.p3,this.value.p2,xo),g.eB.add(this.value.p4,this.value.p3,xo)):z===me&&(g.eB.scale(xo,g.eB.sub(xo,this.value.p3,this.value.p2),Pe),g.eB.add(this.value.p4,this.value.p3,xo)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}constructor(x,F){switch(this.unit=x,this.state=0,this.hasNext=!1,this.polymerIt=oa.m.transientSegments(Lc(x),x.elements),this.value=md(F,x),g.eB.set(this.value.d12,1,0,0),g.eB.set(this.value.d23,1,0,0),x.kind){case 1:this.conformation=x.model.coarseConformation.spheres;break;case 2:this.conformation=x.model.coarseConformation.gaussians}this.hasNext=this.polymerIt.hasNext}}const Ta=g.eB.fromArray,Xa=g.eB.toArray,ku=g.eB.normalize,km=g.eB.sub,$a=g.eB.spline,Hm=g.eB.slerp,pd=g.eB.copy,hd=g.eB.cross,Hu=g.eB.orthogonalize,jm=g.eB.matchDirection,Wm=g.eB.scale,gd=g.eB.add;function ju(oe){const x=oe+1,F=3*x;return{curvePoints:new Float32Array(F),tangentVectors:new Float32Array(F),normalVectors:new Float32Array(F),binormalVectors:new Float32Array(F),widthValues:new Float32Array(x),heightValues:new Float32Array(x),linearSegments:oe}}function Wu(oe,x,F,z){(function Qm(oe,x,F,z){const{curvePoints:me,tangentVectors:Pe,linearSegments:Ge}=oe,{p0:Xe,p1:Qe,p2:lt,p3:ft,p4:wt,secStrucFirst:Ut,secStrucLast:Jt}=x,gn=1-z,Pn=Ut?.5:F,wn=Jt?.5:F;for(let Bn=0;Bn<=Ge;++Bn){const Mn=1*Bn/Ge;if(Mn<gn){const Ln=(0,b.Cc)(Pn,F,Mn);$a(Zu,Xe,Qe,lt,ft,Mn+z,Ln),$a(Qu,Xe,Qe,lt,ft,Mn+z+.01,Pn),$a(Ku,Xe,Qe,lt,ft,Mn+z-.01,Pn)}else{const Ln=(0,b.Cc)(F,wn,Mn);$a(Zu,Qe,lt,ft,wt,Mn-gn,Ln),$a(Qu,Qe,lt,ft,wt,Mn-gn+.01,Ln),$a(Ku,Qe,lt,ft,wt,Mn-gn-.01,Ln)}Xa(Zu,me,3*Bn),ku(pa,km(pa,Qu,Ku)),Xa(pa,Pe,3*Bn)}})(oe,x,F,z),function Zm(oe,x){const{curvePoints:F,tangentVectors:z,normalVectors:me,binormalVectors:Pe}=oe,{d12:Ge,d23:Xe}=x,Qe=F.length/3;Ta(vd,z,0),Ta(_d,z,3*(Qe-1)),Hu(Yu,vd,Ge),Hu(qc,_d,Xe),jm(qc,qc,Yu),pd(Rc,Yu);const lt=Qe-1;for(let ft=0;ft<Qe;++ft){const wt=(0,b.TF)(0,lt,ft)*lt,Ut=0===ft?0:1/(Qe-wt);Ta(pa,z,3*ft),Hu(js,pa,Hm(Km,Rc,qc,Ut)),Xa(js,me,3*ft),pd(Rc,js),ku(Ja,hd(Ja,pa,js)),Xa(Ja,Pe,3*ft)}for(let ft=1;ft<lt;++ft)Ta(Rc,me,3*(ft-1)),Ta(js,me,3*ft),Ta(yd,me,3*(ft+1)),Wm(js,gd(js,Rc,gd(js,yd,js)),1/3),Xa(js,me,3*ft),Ta(pa,z,3*ft),ku(Ja,hd(Ja,pa,js)),Xa(Ja,Pe,3*ft)}(oe,x)}const Qu=(0,g.eB)(),Ku=(0,g.eB)(),Zu=(0,g.eB)(),Km=(0,g.eB)(),pa=(0,g.eB)(),js=(0,g.eB)(),Ja=(0,g.eB)(),Rc=(0,g.eB)(),yd=(0,g.eB)(),vd=(0,g.eB)(),_d=(0,g.eB)(),Yu=(0,g.eB)(),qc=(0,g.eB)();function Xu(oe,x,F,z,me,Pe,Ge,Xe){const{widthValues:Qe,heightValues:lt,linearSegments:ft}=oe,wt=1-Xe;for(let Ut=0;Ut<=ft;++Ut){const Jt=1*Ut/ft;Jt<wt?(Qe[Ut]=(0,b.Cc)(x,F,Jt+Xe),lt[Ut]=(0,b.Cc)(me,Pe,Jt+Xe)):(Qe[Ut]=(0,b.Cc)(F,z,Jt-wt),lt[Ut]=(0,b.Cc)(Pe,Ge,Jt-wt))}}const bd=.5,Ym=.9,eu=.5,tu=.3,nu=2;function Lc(oe){switch(oe.kind){case 0:return oe.model.atomicRanges.polymerRanges;case 1:return oe.model.coarseHierarchy.spheres.polymerRanges;case 2:return oe.model.coarseHierarchy.gaussians.polymerRanges}}function xd(oe){switch(oe.kind){case 0:return oe.model.atomicRanges.gapRanges;case 1:return oe.model.coarseHierarchy.spheres.gapRanges;case 2:return oe.model.coarseHierarchy.gaussians.gapRanges}}var ia,$u,sa;function Ba(oe,x,F){const{objectId:z,instanceId:me,groupId:Pe}=oe;if(F===z){const{structure:Ge,group:Xe}=x,Qe=Xe.units[me];if(Je.Nf.isAtomic(Qe))return(0,Gr.nR)(Ge,Qe,Qe.polymerElements[Pe]);{const{elements:lt}=Qe,wt=Tt.CD.indexOf(lt,Qe.polymerElements[Pe]);if(-1!==wt){const Ut=Tt.CD.ofSingleton(wt);return Je.iZ.Loci(Ge,[{unit:Qe,indices:Ut}])}}}return Rn.BL}function Cd(oe,x,F,z,me,Pe){let Ge=-1,Xe=-1;for(let lt=me;lt<=Pe;lt++){const ft=F[lt];if(!(ft<0)&&(Ge=Tt.CD.indexOf(x,ft),Ge>=0)){Xe=lt;break}}if(Ge<0)return!1;let Qe=Ge;for(let lt=Pe;lt>Xe;lt--){const ft=F[lt];if(ft<0)continue;const wt=Tt.CD.indexOf(x,ft);if(wt>=0){Qe=wt;break}}return z(Tt.IX.ofRange(oe+Ge,oe+Qe))}function Sd(oe,x,F,z,me){let Pe=!1;const{elements:Ge}=me.unit,{traceElementIndex:Xe}=me.unit.model.atomicHierarchy.derived.residue,{index:Qe}=me.unit.model.atomicHierarchy.residueAtomSegments,lt=F(me.unit);if(Tt.IX.is(me.indices))Pe=0===Tt.IX.start(me.indices)&&Tt.IX.end(me.indices)===me.unit.elements.length?z(Tt.IX.ofBounds(oe,oe+x))||Pe:Cd(oe,lt,Xe,z,Qe[Ge[Tt.IX.min(me.indices)]],Qe[Ge[Tt.IX.max(me.indices)]])||Pe;else{const{indices:ft}=me;for(let wt=0,Ut=ft.length;wt<Ut;wt++){const Jt=Qe[Ge[ft[wt]]];let gn=Jt,Pn=wt+1;for(;Pn<Ut;){const wn=Qe[Ge[ft[Pn]]];if(wn-gn>1)break;gn=wn,Pn++}wt=Pn-1,Pe=Cd(oe,lt,Xe,z,Jt,gn)||Pe}}return Pe}function Xm(oe){return oe.polymerElements}function Da(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe))return!1;const{structure:me,group:Pe}=x;if(!Je.oE.areEquivalent(oe.structure,me))return!1;const Ge=Pe.units[0].polymerElements.length;for(const Xe of oe.elements){if(!Pe.unitIndexMap.has(Xe.unit.id))continue;const Qe=Pe.unitIndexMap.get(Xe.unit.id)*Ge;if(Je.Nf.isAtomic(Xe.unit))z=Sd(Qe,Ge,Xm,F,Xe)||z;else if(Tt.IX.is(Xe.indices)){const lt=Qe+Tt.IX.start(Xe.indices),ft=Qe+Tt.IX.end(Xe.indices);z=F(Tt.IX.ofBounds(lt,ft))||z}else for(let lt=0,ft=Xe.indices.length;lt<ft;lt++){const wt=Xe.indices[lt];let Ut=lt+1;for(;Ut<ft&&Xe.indices[Ut]===wt;)Ut++;lt=Ut-1,z=F(Tt.IX.ofRange(Qe+wt,Qe+Xe.indices[lt]))||z}}return z}function $m(oe,x,F){const{objectId:z,instanceId:me,groupId:Pe}=oe;if(F===z){const{structure:Ge,group:Xe}=x,Qe=Xe.units[me],lt=Tt.CD.indexOf(Qe.elements,Qe.gapElements[Pe]),ft=Tt.CD.indexOf(Qe.elements,Qe.gapElements[Pe%2?Pe-1:Pe+1]);if(-1!==lt&&-1!==ft)return Je.gn.Loci(Ge,[Je.gn.Location(Ge,Qe,lt,Ge,Qe,ft),Je.gn.Location(Ge,Qe,ft,Ge,Qe,lt)])}return Rn.BL}function Jm(oe,x,F){let z=!1;if(Je.gn.isLoci(oe)){const{structure:me,group:Pe}=x;if(!Je.oE.areRootsEquivalent(oe.structure,me))return!1;oe=Je.gn.remapLoci(oe,me);const Ge=Pe.units[0].gapElements.length;for(const Xe of oe.bonds){const Qe=Pe.unitIndexMap.get(Xe.aUnit.id);if(void 0!==Qe){const lt=Tt.CD.indexOf(Xe.aUnit.gapElements,Xe.aUnit.elements[Xe.aIndex]),ft=Tt.CD.indexOf(Xe.bUnit.gapElements,Xe.bUnit.elements[Xe.bIndex]);-1!==lt&&-1!==ft&&F(Tt.IX.ofSingleton(Qe*Ge+lt))&&(z=!0)}}}else if(Je.iZ.Loci.is(oe)){const{structure:me,group:Pe}=x;if(!Je.oE.areRootsEquivalent(oe.structure,me))return!1;oe=Je.iZ.Loci.remap(oe,me);const Ge=Pe.units[0].gapElements.length;for(const Xe of oe.elements){const Qe=Pe.unitIndexMap.get(Xe.unit.id);void 0!==Qe&&Tt.CD.forEach(Xe.indices,lt=>{const ft=Tt.CD.indexOf(Xe.unit.gapElements,Xe.unit.elements[lt]);-1!==ft&&F(Tt.IX.ofSingleton(Qe*Ge+ft))&&(z=!0)})}}return z}function Ma(oe,x,F){const{objectId:z,instanceId:me,groupId:Pe}=oe;if(F===z){const{structure:Ge,group:Xe}=x,Qe=Xe.units[me];if(Je.Nf.isAtomic(Qe))return(0,Gr.nR)(Ge,Qe,Qe.nucleotideElements[Pe])}return Rn.BL}function qm(oe){return oe.nucleotideElements}function Oa(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe))return!1;const{structure:me,group:Pe}=x;if(!Je.oE.areEquivalent(oe.structure,me))return!1;const Ge=Pe.units[0];if(!Je.Nf.isAtomic(Ge))return!1;const{nucleotideElements:Xe}=Ge,Qe=Xe.length;for(const lt of oe.elements){if(!Je.Nf.isAtomic(lt.unit)||!Pe.unitIndexMap.has(lt.unit.id))continue;const ft=Pe.unitIndexMap.get(lt.unit.id)*Qe;Je.Nf.isAtomic(lt.unit)&&(z=Sd(ft,Qe,qm,F,lt)||z)}return z}!function(oe){oe.fromGroup=function x(F,z){const{group:me,structure:Pe}=F,Ge=me.units[0].polymerElements,Xe=Ge.length,Qe=me.units.length,lt=Je.iZ.Location.create(Pe),wt=!!z?.asSecondary;return(0,oo.iQ)(Xe,Qe,1,(Jt,gn)=>(lt.unit=me.units[gn],lt.element=Ge[Jt],lt),!1,function Ut(Jt,gn){return wt})}}(ia||(ia={})),function(oe){oe.fromGroup=function x(F){const{group:z,structure:me}=F,Pe=z.units[0].gapElements,Ge=Pe.length,Xe=z.units.length,Qe=Je.iZ.Location.create(me);return(0,oo.iQ)(Ge,Xe,1,(ft,wt)=>(Qe.unit=z.units[wt],Qe.element=Pe[ft],Qe))}}($u||($u={})),function(oe){oe.fromGroup=function x(F){const{group:z,structure:me}=F,Pe=z.units[0],Ge=Je.Nf.isAtomic(Pe)?Pe.nucleotideElements:[],Xe=Ge.length,Qe=z.units.length,lt=Je.iZ.Location.create(me);return(0,oo.iQ)(Xe,Qe,1,(wt,Ut)=>(lt.unit=z.units[Ut],lt.element=Ge[wt],lt))}}(sa||(sa={}));const ep=(0,M.e)(),tp=(0,M.e)();function Ra(oe,x){const{model:F,conformation:z}=oe,{residueAtomSegments:me,atoms:Pe,index:Ge}=F.atomicHierarchy,{label_comp_id:Xe}=Pe,Qe=Xe.value(me.offsets[x]);let lt=(0,Tr.VH)(Qe),ft=(0,Tr.qN)(Qe);if(!lt&&!ft){const wt=Ge.findAtomOnResidue(x,"C4"),Ut=Ge.findAtomOnResidue(x,"N9");-1!==wt&&-1!==Ut&&M.e.distance(z.invariantPosition(wt,ep),z.invariantPosition(Ut,tp))<1.6?lt=!0:ft=!0}return{isPurine:lt,isPyrimidine:ft}}function wa(oe,x,F){const z=x.model.atomicHierarchy.index,{traceElementIndex:me}=x.model.atomicHierarchy.derived.residue;return oe.trace=me[F],oe.N1=z.findAtomOnResidue(F,"N1"),oe.C2=z.findAtomOnResidue(F,"C2"),oe.N3=z.findAtomOnResidue(F,"N3"),oe.C4=z.findAtomOnResidue(F,"C4"),oe.C5=z.findAtomOnResidue(F,"C5"),-1===oe.C5&&(oe.C5=z.findAtomOnResidue(F,"N5")),oe.C6=z.findAtomOnResidue(F,"C6"),oe.N7=z.findAtomOnResidue(F,"N7"),-1===oe.N7&&(oe.N7=z.findAtomOnResidue(F,"C7")),oe.C8=z.findAtomOnResidue(F,"C8"),oe.N9=z.findAtomOnResidue(F,"N9"),oe}function qa(oe){return-1!==oe.trace&&-1!==oe.N1&&-1!==oe.C2&&-1!==oe.N3&&-1!==oe.C4&&-1!==oe.C5&&-1!==oe.C6&&-1!==oe.N7&&-1!==oe.C8&&-1!==oe.N9}function Fa(oe,x,F){const z=x.model.atomicHierarchy.index,{traceElementIndex:me}=x.model.atomicHierarchy.derived.residue;return oe.trace=me[F],oe.N1=z.findAtomOnResidue(F,"N1"),-1===oe.N1&&(oe.N1=z.findAtomOnResidue(F,"C1")),oe.C2=z.findAtomOnResidue(F,"C2"),oe.N3=z.findAtomOnResidue(F,"N3"),oe.C4=z.findAtomOnResidue(F,"C4"),oe.C5=z.findAtomOnResidue(F,"C5"),oe.C6=z.findAtomOnResidue(F,"C6"),oe}function ec(oe){return-1!==oe.trace&&-1!==oe.N1&&-1!==oe.C2&&-1!==oe.N3&&-1!==oe.C4&&-1!==oe.C5&&-1!==oe.C6}function wc(oe,x,F){const z=x.model.atomicHierarchy.index,{traceElementIndex:me}=x.model.atomicHierarchy.derived.residue;return oe.trace=me[F],oe.C1_1=z.findAtomOnResidue(F,"C1'"),oe.C2_1=z.findAtomOnResidue(F,"C2'"),oe.C3_1=z.findAtomOnResidue(F,"C3'"),oe.C4_1=z.findAtomOnResidue(F,"C4'"),oe.O4_1=z.findAtomOnResidue(F,"O4'"),oe}function Fc(oe){return-1!==oe.trace&&-1!==oe.C1_1&&-1!==oe.C2_1&&-1!==oe.C3_1&&-1!==oe.C4_1&&-1!==oe.O4_1}const ru=(0,g.eB)(),Ju=(0,g.eB)(),Ed=(0,g.eB)(),Id=(0,g.eB)(),Ad=(0,g.eB)(),Pd=(0,g.eB)(),ou=(0,g.eB)(),qu=(0,g.eB)(),el=(0,g.eB)(),Td=(0,g.eB)(),Nc=g.$I.identity(),np=(0,g.eB)(),Bd=(0,no.az)(),Dd={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:v.t.Numeric(1,{min:0,max:2,step:.01}),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo)};function rp(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return rr.e.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,thicknessFactor:Qe,radialSegments:lt}=me,ft=Ge*(Bd.vertices.length/3+2*lt),wt=lr.P.createState(ft,ft/4,Pe),{elements:Ut,model:Jt,conformation:gn}=x,{chainAtomSegments:Pn,residueAtomSegments:wn}=Jt.atomicHierarchy,{moleculeType:Bn}=Jt.atomicHierarchy.derived.residue,Mn=Tt.hT.transientSegments(Pn,Ut),Ln=Tt.hT.transientSegments(wn,Ut),cr=1*Xe,Qn=Qe*Xe*2,Zn={radiusTop:cr,radiusBottom:cr,radialSegments:lt,bottomCap:!0};let zn=0;for(;Mn.hasNext;)for(Ln.setSegment(Mn.move());Ln.hasNext;){const{index:to}=Ln.move();if((0,Tr.OV)(Bn[to])){const Cr={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};let Zr=-1,Io=-1,wo=-1,si=-1,Ii=-1,ai=4.5;const{isPurine:li,isPyrimidine:Vo}=Ra(x,to);li?(ai=4.5,wa(Cr,x,to),Zr=Cr.N1,Io=Cr.C4,wo=Cr.C6,si=Cr.C2,Ii=Cr.N9):Vo&&(ai=3,Fa(Cr,x,to),Zr=Cr.N3,Io=Cr.C6,wo=Cr.C4,si=Cr.C2,Ii=Cr.N1),-1!==Ii&&-1!==Cr.trace&&(gn.invariantPosition(Ii,Ad),gn.invariantPosition(Cr.trace,Pd),wt.currentGroup=zn,(0,_i.y9)(wt,Ad,Pd,1,Zn),-1!==Zr&&-1!==Io&&-1!==wo&&-1!==si&&(gn.invariantPosition(Zr,ru),gn.invariantPosition(Io,Ju),gn.invariantPosition(wo,Ed),gn.invariantPosition(si,Id),g.eB.normalize(ou,g.eB.sub(ou,Ju,ru)),g.eB.normalize(qu,g.eB.sub(qu,Id,Ed)),g.eB.normalize(el,g.eB.cross(el,ou,qu)),g.$I.targetTo(Nc,ru,Ju,el),g.eB.scaleAndAdd(Td,ru,ou,ai/2-.2),g.$I.scale(Nc,Nc,g.eB.set(np,4.5,Qn,ai)),g.$I.setTranslation(Nc,Td),lr.P.addPrimitive(wt,Nc,Bd))),++zn}}const Lr=lr.P.getMesh(wt),wr=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,cr);return Lr.setBoundingSphere(wr),Lr}v.t.getDefaultValues(Dd);const Md={...tr.Te,...Dd};function op(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Md),createGeometry:rp,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.thicknessFactor!==z.thicknessFactor||F.radialSegments!==z.radialSegments}},oe)}const iu=(0,g.eB)(),ha=(0,g.eB)(),su=(0,g.eB)(),au=(0,g.eB)(),tc=(0,g.eB)(),nc=(0,g.eB)(),cu=(0,g.eB)(),Od=(0,g.eB)(),Rd=(0,g.eB)(),uu=(0,g.eB)(),ga=(0,g.eB)(),Ld={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:v.t.Numeric(1,{min:0,max:2,step:.01}),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo)},lu=(v.t.getDefaultValues(Ld),new Float32Array(54)),ip=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),sp=new Uint32Array([8,12,14,16,6,4,2,0,10]),ap=new Uint32Array([9,11,1,3,5,7,17,15,13]),du=new Float32Array(36),cp=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),up=new Uint32Array([0,10,8,6,4,2]),lp=new Uint32Array([1,3,5,7,9,11]),wd=(0,g.eB)();function Fd(oe,x,...F){for(let z=0,me=F.length;z<me;++z){const Pe=F[z];g.eB.toArray(g.eB.add(wd,Pe,x),oe,2*z*3),g.eB.toArray(g.eB.sub(wd,Pe,x),oe,3*(2*z+1))}}function dp(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return rr.e.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,thicknessFactor:Qe,radialSegments:lt,detail:ft}=me,wt=Ge*(26+2*lt),Ut=lr.P.createState(wt,wt/4,Pe),{elements:Jt,model:gn,conformation:Pn}=x,{chainAtomSegments:wn,residueAtomSegments:Bn}=gn.atomicHierarchy,{moleculeType:Mn}=gn.atomicHierarchy.derived.residue,Ln=Tt.hT.transientSegments(wn,Jt),cr=Tt.hT.transientSegments(Bn,Jt),qn=1*Xe,Qn=Qe*Xe,Zn={radiusTop:qn,radiusBottom:qn,radialSegments:lt};let zn=0;for(;Ln.hasNext;)for(cr.setSegment(Ln.move());cr.hasNext;){const{index:to}=cr.move();if((0,Tr.OV)(Mn[to])){const Cr={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};Ut.currentGroup=zn;const{isPurine:Zr,isPyrimidine:Io}=Ra(x,to);Zr?(wa(Cr,x,to),-1!==Cr.N9&&-1!==Cr.trace&&(Pn.invariantPosition(Cr.N9,uu),Pn.invariantPosition(Cr.trace,iu),Ut.currentGroup=zn,(0,_i.y9)(Ut,uu,iu,1,Zn),(0,kr.X)(Ut,uu,qn,ft)),qa(Cr)&&(Pn.invariantPosition(Cr.N1,ha),Pn.invariantPosition(Cr.C2,su),Pn.invariantPosition(Cr.N3,au),Pn.invariantPosition(Cr.C4,tc),Pn.invariantPosition(Cr.C5,nc),Pn.invariantPosition(Cr.C6,cu),Pn.invariantPosition(Cr.N7,Od),Pn.invariantPosition(Cr.C8,Rd),g.eB.triangleNormal(ga,ha,tc,nc),g.eB.scale(ga,ga,Qn),Fd(lu,ga,ha,su,au,tc,nc,cu,Od,Rd,uu),lr.P.addTriangleStrip(Ut,lu,ip),lr.P.addTriangleFan(Ut,lu,sp),lr.P.addTriangleFan(Ut,lu,ap))):Io&&(Fa(Cr,x,to),-1!==Cr.N1&&-1!==Cr.trace&&(Pn.invariantPosition(Cr.N1,ha),Pn.invariantPosition(Cr.trace,iu),Ut.currentGroup=zn,(0,_i.y9)(Ut,ha,iu,1,Zn),(0,kr.X)(Ut,ha,qn,ft)),ec(Cr)&&(Pn.invariantPosition(Cr.C2,su),Pn.invariantPosition(Cr.N3,au),Pn.invariantPosition(Cr.C4,tc),Pn.invariantPosition(Cr.C5,nc),Pn.invariantPosition(Cr.C6,cu),g.eB.triangleNormal(ga,ha,tc,nc),g.eB.scale(ga,ga,Qn),Fd(du,ga,ha,su,au,tc,nc,cu),lr.P.addTriangleStrip(Ut,du,cp),lr.P.addTriangleFan(Ut,du,up),lr.P.addTriangleFan(Ut,du,lp))),++zn}}const Lr=lr.P.getMesh(Ut),wr=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,qn);return Lr.setBoundingSphere(wr),Lr}const Nd={...tr.Te,...Ld};function fp(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Nd),createGeometry:dp,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.thicknessFactor!==z.thicknessFactor||F.radialSegments!==z.radialSegments}},oe)}const rc=(0,g.eB)(),fu=(0,g.eB)(),mu=(0,g.eB)(),oc=(0,g.eB)(),ic=(0,g.eB)(),pu=(0,g.eB)(),Ud=(0,g.eB)(),Vd=(0,g.eB)(),Gd=(0,g.eB)(),hu=(0,g.eB)(),tl=(0,g.eB)(),gu=(0,g.eB)(),yu=(0,g.eB)(),nl=(0,g.eB)(),sc=(0,g.eB)(),fs=(0,g.eB)(),ac=(0,g.eB)(),zd={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:v.t.Numeric(1,{min:0,max:2,step:.01})},vu=(v.t.getDefaultValues(zd),new Float32Array(54)),mp=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),pp=new Uint32Array([8,12,14,16,6,4,2,0,10]),hp=new Uint32Array([9,11,1,3,5,7,17,15,13]),_u=new Float32Array(36),gp=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),yp=new Uint32Array([0,10,8,6,4,2,10]),vp=new Uint32Array([1,3,5,7,9,11,3]),bu=new Float32Array(36),_p=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),bp=new Uint32Array([0,10,8,6,4,2]),xp=new Uint32Array([1,3,5,7,9,11]),kd=(0,g.eB)();function rl(oe,x,...F){for(let z=0,me=F.length;z<me;++z){const Pe=F[z];g.eB.toArray(g.eB.add(kd,Pe,x),oe,2*z*3),g.eB.toArray(g.eB.sub(kd,Pe,x),oe,3*(2*z+1))}}function Cp(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return rr.e.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,thicknessFactor:Qe}=me,lt=25*Ge,ft=lr.P.createState(lt,lt/4,Pe),{elements:wt,model:Ut,conformation:Jt}=x,{chainAtomSegments:gn,residueAtomSegments:Pn}=Ut.atomicHierarchy,{moleculeType:wn}=Ut.atomicHierarchy.derived.residue,Bn=Tt.hT.transientSegments(gn,wt),Mn=Tt.hT.transientSegments(Pn,wt),Ln=Xe*Qe;let cr=0;for(;Bn.hasNext;)for(Mn.setSegment(Bn.move());Mn.hasNext;){const{index:Zn}=Mn.move();if((0,Tr.OV)(wn[Zn])){const zn={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};ft.currentGroup=cr,wc(zn,x,Zn),Fc(zn)&&(Jt.invariantPosition(zn.C1_1,hu),Jt.invariantPosition(zn.C2_1,tl),Jt.invariantPosition(zn.C3_1,gu),Jt.invariantPosition(zn.C4_1,yu),Jt.invariantPosition(zn.O4_1,nl),g.eB.triangleNormal(fs,gu,yu,hu),g.eB.scale(sc,g.eB.add(sc,nl,g.eB.add(sc,yu,g.eB.add(sc,gu,g.eB.add(sc,hu,tl)))),.2),g.eB.scale(ac,fs,Ln),rl(_u,ac,sc,gu,yu,nl,hu,tl),lr.P.addTriangleStrip(ft,_u,gp),lr.P.addTriangleFanWithNormal(ft,_u,yp,fs),g.eB.negate(fs,fs),lr.P.addTriangleFanWithNormal(ft,_u,vp,fs));const{isPurine:Lr,isPyrimidine:wr}=Ra(x,Zn);Lr?(wa(zn,x,Zn),qa(zn)&&(Jt.invariantPosition(zn.N1,rc),Jt.invariantPosition(zn.C2,fu),Jt.invariantPosition(zn.N3,mu),Jt.invariantPosition(zn.C4,oc),Jt.invariantPosition(zn.C5,ic),Jt.invariantPosition(zn.C6,pu),Jt.invariantPosition(zn.N7,Ud),Jt.invariantPosition(zn.C8,Vd),Jt.invariantPosition(zn.N9,Gd),g.eB.triangleNormal(fs,rc,oc,ic),g.eB.scale(ac,fs,Ln),rl(vu,ac,rc,fu,mu,oc,ic,pu,Ud,Vd,Gd),lr.P.addTriangleStrip(ft,vu,mp),lr.P.addTriangleFanWithNormal(ft,vu,pp,fs),g.eB.negate(fs,fs),lr.P.addTriangleFanWithNormal(ft,vu,hp,fs))):wr&&(Fa(zn,x,Zn),ec(zn)&&(Jt.invariantPosition(zn.N1,rc),Jt.invariantPosition(zn.C2,fu),Jt.invariantPosition(zn.N3,mu),Jt.invariantPosition(zn.C4,oc),Jt.invariantPosition(zn.C5,ic),Jt.invariantPosition(zn.C6,pu),g.eB.triangleNormal(fs,rc,oc,ic),g.eB.scale(ac,fs,Ln),rl(bu,ac,rc,fu,mu,oc,ic,pu),lr.P.addTriangleStrip(ft,bu,_p),lr.P.addTriangleFanWithNormal(ft,bu,bp,fs),g.eB.negate(fs,fs),lr.P.addTriangleFanWithNormal(ft,bu,xp,fs))),++cr}}const qn=lr.P.getMesh(ft),Qn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,Ln);return qn.setBoundingSphere(Qn),qn}const Hd={...tr.Te,...zd};function Sp(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Hd),createGeometry:Cp,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.thicknessFactor!==z.thicknessFactor}},oe)}var jd=n(1989);const ms=(0,g.eB)(),xi=(0,g.eB)(),os=(0,g.eB)(),is=(0,g.eB)(),ki=(0,g.eB)(),Hi=(0,g.eB)(),ss=(0,g.eB)(),Ys=(0,g.eB)(),Xs=(0,g.eB)(),Zi=(0,g.eB)(),Yi=(0,g.eB)(),$s=(0,g.eB)(),Ps=(0,g.eB)(),Js=(0,g.eB)(),qs=(0,g.eB)(),ol={...tr.Te,...tr.lm,sizeFactor:v.t.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo),tryUseImpostor:v.t.Boolean(!0)};function Ep(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth?function Ap(oe){return(0,tr.Vb)({defaultProps:v.t.getDefaultValues(ol),createGeometry:Ip,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function Tp(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(ol),createGeometry:Pp,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.radialSegments!==z.radialSegments},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}function Ip(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return ci.S.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return ci.S.createEmpty(Pe);const Xe=15*Ge,Qe=jd.h.create(Xe,Xe/4,Pe),{elements:lt,model:ft,conformation:wt}=x,{chainAtomSegments:Ut,residueAtomSegments:Jt}=ft.atomicHierarchy,{moleculeType:gn}=ft.atomicHierarchy.derived.residue,Pn=Tt.hT.transientSegments(Ut,lt),wn=Tt.hT.transientSegments(Jt,lt);let Bn=0;for(;Pn.hasNext;)for(wn.setSegment(Pn.move());wn.hasNext;){const{index:qn}=wn.move();if((0,Tr.OV)(gn[qn])){const Qn={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};wc(Qn,x,qn),Fc(Qn)&&(wt.invariantPosition(Qn.C1_1,Yi),wt.invariantPosition(Qn.C2_1,$s),wt.invariantPosition(Qn.C3_1,Ps),wt.invariantPosition(Qn.C4_1,Js),wt.invariantPosition(Qn.O4_1,qs),wt.invariantPosition(Qn.trace,ms),Qe.add(Ps[0],Ps[1],Ps[2],ms[0],ms[1],ms[2],1,!0,!0,2,Bn),Qe.add(Ps[0],Ps[1],Ps[2],Js[0],Js[1],Js[2],1,!0,!0,2,Bn),Qe.add(Js[0],Js[1],Js[2],qs[0],qs[1],qs[2],1,!0,!0,2,Bn),Qe.add(qs[0],qs[1],qs[2],Yi[0],Yi[1],Yi[2],1,!0,!0,2,Bn),Qe.add(Yi[0],Yi[1],Yi[2],$s[0],$s[1],$s[2],1,!0,!0,2,Bn),Qe.add($s[0],$s[1],$s[2],Ps[0],Ps[1],Ps[2],1,!0,!0,2,Bn));const{isPurine:Zn,isPyrimidine:zn}=Ra(x,qn);Zn?(wa(Qn,x,qn),-1!==Qn.C1_1&&-1!==Qn.N9?(wt.invariantPosition(Qn.C1_1,Yi),wt.invariantPosition(Qn.N9,Zi),Qe.add(Zi[0],Zi[1],Zi[2],Yi[0],Yi[1],Yi[2],1,!0,!0,2,Bn)):-1!==Qn.N9&&-1!==Qn.trace&&(wt.invariantPosition(Qn.N9,Zi),wt.invariantPosition(Qn.trace,ms),Qe.add(Zi[0],Zi[1],Zi[2],ms[0],ms[1],ms[2],1,!0,!0,2,Bn)),qa(Qn)&&(wt.invariantPosition(Qn.N1,xi),wt.invariantPosition(Qn.C2,os),wt.invariantPosition(Qn.N3,is),wt.invariantPosition(Qn.C4,ki),wt.invariantPosition(Qn.C5,Hi),wt.invariantPosition(Qn.C6,ss),wt.invariantPosition(Qn.N7,Ys),wt.invariantPosition(Qn.C8,Xs),wt.invariantPosition(Qn.N9,Zi),Qe.add(Zi[0],Zi[1],Zi[2],Xs[0],Xs[1],Xs[2],1,!0,!0,2,Bn),Qe.add(Xs[0],Xs[1],Xs[2],Ys[0],Ys[1],Ys[2],1,!0,!0,2,Bn),Qe.add(Ys[0],Ys[1],Ys[2],Hi[0],Hi[1],Hi[2],1,!0,!0,2,Bn),Qe.add(Hi[0],Hi[1],Hi[2],ss[0],ss[1],ss[2],1,!0,!0,2,Bn),Qe.add(ss[0],ss[1],ss[2],xi[0],xi[1],xi[2],1,!0,!0,2,Bn),Qe.add(xi[0],xi[1],xi[2],os[0],os[1],os[2],1,!0,!0,2,Bn),Qe.add(os[0],os[1],os[2],is[0],is[1],is[2],1,!0,!0,2,Bn),Qe.add(is[0],is[1],is[2],ki[0],ki[1],ki[2],1,!0,!0,2,Bn),Qe.add(ki[0],ki[1],ki[2],Hi[0],Hi[1],Hi[2],1,!0,!0,2,Bn),Qe.add(ki[0],ki[1],ki[2],Zi[0],Zi[1],Zi[2],1,!0,!0,2,Bn))):zn&&(Fa(Qn,x,qn),-1!==Qn.C1_1&&-1!==Qn.N1?(wt.invariantPosition(Qn.N1,xi),wt.invariantPosition(Qn.C1_1,Yi),Qe.add(xi[0],xi[1],xi[2],Yi[0],Yi[1],Yi[2],1,!0,!0,2,Bn)):-1!==Qn.N1&&-1!==Qn.trace&&(wt.invariantPosition(Qn.N1,xi),wt.invariantPosition(Qn.trace,ms),Qe.add(xi[0],xi[1],xi[2],ms[0],ms[1],ms[2],1,!0,!0,2,Bn)),ec(Qn)&&(wt.invariantPosition(Qn.N1,xi),wt.invariantPosition(Qn.C2,os),wt.invariantPosition(Qn.N3,is),wt.invariantPosition(Qn.C4,ki),wt.invariantPosition(Qn.C5,Hi),wt.invariantPosition(Qn.C6,ss),Qe.add(xi[0],xi[1],xi[2],ss[0],ss[1],ss[2],1,!0,!0,2,Bn),Qe.add(ss[0],ss[1],ss[2],Hi[0],Hi[1],Hi[2],1,!0,!0,2,Bn),Qe.add(Hi[0],Hi[1],Hi[2],ki[0],ki[1],ki[2],1,!0,!0,2,Bn),Qe.add(ki[0],ki[1],ki[2],is[0],is[1],is[2],1,!0,!0,2,Bn),Qe.add(is[0],is[1],is[2],os[0],os[1],os[2],1,!0,!0,2,Bn),Qe.add(os[0],os[1],os[2],xi[0],xi[1],xi[2],1,!0,!0,2,Bn))),++Bn}}const Ln=Qe.getCylinders(),cr=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return Ln.setBoundingSphere(cr),Ln}function Pp(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return rr.e.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,radialSegments:Qe}=me,lt=Ge*(15*Qe),ft=lr.P.createState(lt,lt/4,Pe),{elements:wt,model:Ut,conformation:Jt}=x,{chainAtomSegments:gn,residueAtomSegments:Pn}=Ut.atomicHierarchy,{moleculeType:wn}=Ut.atomicHierarchy.derived.residue,Bn=Tt.hT.transientSegments(gn,wt),Mn=Tt.hT.transientSegments(Pn,wt),Ln={radiusTop:1*Xe,radiusBottom:1*Xe,radialSegments:Qe};let cr=0;for(;Bn.hasNext;)for(Mn.setSegment(Bn.move());Mn.hasNext;){const{index:Zn}=Mn.move();if((0,Tr.OV)(wn[Zn])){const zn={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};ft.currentGroup=cr,wc(zn,x,Zn),Fc(zn)&&(Jt.invariantPosition(zn.C1_1,Yi),Jt.invariantPosition(zn.C2_1,$s),Jt.invariantPosition(zn.C3_1,Ps),Jt.invariantPosition(zn.C4_1,Js),Jt.invariantPosition(zn.O4_1,qs),Jt.invariantPosition(zn.trace,ms),(0,_i.y9)(ft,Ps,ms,1,Ln),(0,_i.y9)(ft,Ps,Js,1,Ln),(0,_i.y9)(ft,Js,qs,1,Ln),(0,_i.y9)(ft,qs,Yi,1,Ln),(0,_i.y9)(ft,Yi,$s,1,Ln),(0,_i.y9)(ft,$s,Ps,1,Ln));const{isPurine:Lr,isPyrimidine:wr}=Ra(x,Zn);Lr?(wa(zn,x,Zn),-1!==zn.C1_1&&-1!==zn.N9?(Jt.invariantPosition(zn.C1_1,Yi),Jt.invariantPosition(zn.N9,Zi),(0,_i.y9)(ft,Zi,Yi,1,Ln)):-1!==zn.N9&&-1!==zn.trace&&(Jt.invariantPosition(zn.N9,Zi),Jt.invariantPosition(zn.trace,ms),(0,_i.y9)(ft,Zi,ms,1,Ln)),qa(zn)&&(Jt.invariantPosition(zn.N1,xi),Jt.invariantPosition(zn.C2,os),Jt.invariantPosition(zn.N3,is),Jt.invariantPosition(zn.C4,ki),Jt.invariantPosition(zn.C5,Hi),Jt.invariantPosition(zn.C6,ss),Jt.invariantPosition(zn.N7,Ys),Jt.invariantPosition(zn.C8,Xs),Jt.invariantPosition(zn.N9,Zi),(0,_i.y9)(ft,Zi,Xs,1,Ln),(0,_i.y9)(ft,Xs,Ys,1,Ln),(0,_i.y9)(ft,Ys,Hi,1,Ln),(0,_i.y9)(ft,Hi,ss,1,Ln),(0,_i.y9)(ft,ss,xi,1,Ln),(0,_i.y9)(ft,xi,os,1,Ln),(0,_i.y9)(ft,os,is,1,Ln),(0,_i.y9)(ft,is,ki,1,Ln),(0,_i.y9)(ft,ki,Hi,1,Ln),(0,_i.y9)(ft,ki,Zi,1,Ln))):wr&&(Fa(zn,x,Zn),-1!==zn.C1_1&&-1!==zn.N1?(Jt.invariantPosition(zn.N1,xi),Jt.invariantPosition(zn.C1_1,Yi),(0,_i.y9)(ft,xi,Yi,1,Ln)):-1!==zn.N1&&-1!==zn.trace&&(Jt.invariantPosition(zn.N1,xi),Jt.invariantPosition(zn.trace,ms),(0,_i.y9)(ft,xi,ms,1,Ln)),ec(zn)&&(Jt.invariantPosition(zn.N1,xi),Jt.invariantPosition(zn.C2,os),Jt.invariantPosition(zn.N3,is),Jt.invariantPosition(zn.C4,ki),Jt.invariantPosition(zn.C5,Hi),Jt.invariantPosition(zn.C6,ss),(0,_i.y9)(ft,xi,ss,1,Ln),(0,_i.y9)(ft,ss,Hi,1,Ln),(0,_i.y9)(ft,Hi,ki,1,Ln),(0,_i.y9)(ft,ki,is,1,Ln),(0,_i.y9)(ft,is,os,1,Ln),(0,_i.y9)(ft,os,xi,1,Ln))),++cr}}const qn=lr.P.getMesh(ft),Qn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return qn.setBoundingSphere(Qn),qn}const cc=(0,g.eB)(),Rs=(0,g.eB)(),Ls=(0,g.eB)(),ws=(0,g.eB)(),Fs=(0,g.eB)(),Ds=(0,g.eB)(),Ns=(0,g.eB)(),uc=(0,g.eB)(),lc=(0,g.eB)(),dc=(0,g.eB)(),fc=(0,g.eB)(),mc=(0,g.eB)(),pc=(0,g.eB)(),hc=(0,g.eB)(),gc=(0,g.eB)(),il={...tr.Te,...tr.qg,sizeFactor:v.t.Numeric(.3,{min:0,max:10,step:.01}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),tryUseImpostor:v.t.Boolean(!0)};function Bp(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth?function Mp(oe){return(0,tr.uF)({defaultProps:v.t.getDefaultValues(il),createGeometry:Dp,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function Rp(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(il),createGeometry:Op,createLocationIterator:sa.fromGroup,getLoci:Ma,eachLocation:Oa,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}function Dp(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return Qr.v.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return Qr.v.createEmpty(Pe);const Xe=15*Ge,Qe=Bi.create(Xe,Xe/4,Pe),{elements:lt,model:ft,conformation:wt}=x,{chainAtomSegments:Ut,residueAtomSegments:Jt}=ft.atomicHierarchy,{moleculeType:gn}=ft.atomicHierarchy.derived.residue,Pn=Tt.hT.transientSegments(Ut,lt),wn=Tt.hT.transientSegments(Jt,lt);let Bn=0;for(;Pn.hasNext;)for(wn.setSegment(Pn.move());wn.hasNext;){const{index:cr}=wn.move();if((0,Tr.OV)(gn[cr])){const qn={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};wc(qn,x,cr),Fc(qn)&&(wt.invariantPosition(qn.C1_1,fc),wt.invariantPosition(qn.C2_1,mc),wt.invariantPosition(qn.C3_1,pc),wt.invariantPosition(qn.C4_1,hc),wt.invariantPosition(qn.O4_1,gc),wt.invariantPosition(qn.trace,cc),Qe.add(cc[0],cc[1],cc[2],Bn),Qe.add(pc[0],pc[1],pc[2],Bn),Qe.add(hc[0],hc[1],hc[2],Bn),Qe.add(gc[0],gc[1],gc[2],Bn),Qe.add(fc[0],fc[1],fc[2],Bn),Qe.add(mc[0],mc[1],mc[2],Bn));const{isPurine:Qn,isPyrimidine:Zn}=Ra(x,cr);Qn?(wa(qn,x,cr),qa(qn)&&(wt.invariantPosition(qn.N1,Rs),wt.invariantPosition(qn.C2,Ls),wt.invariantPosition(qn.N3,ws),wt.invariantPosition(qn.C4,Fs),wt.invariantPosition(qn.C5,Ds),wt.invariantPosition(qn.C6,Ns),wt.invariantPosition(qn.N7,uc),wt.invariantPosition(qn.C8,lc),wt.invariantPosition(qn.N9,dc),Qe.add(dc[0],dc[1],dc[2],Bn),Qe.add(lc[0],lc[1],lc[2],Bn),Qe.add(uc[0],uc[1],uc[2],Bn),Qe.add(Ds[0],Ds[1],Ds[2],Bn),Qe.add(Ns[0],Ns[1],Ns[2],Bn),Qe.add(Rs[0],Rs[1],Rs[2],Bn),Qe.add(Ls[0],Ls[1],Ls[2],Bn),Qe.add(ws[0],ws[1],ws[2],Bn),Qe.add(Fs[0],Fs[1],Fs[2],Bn))):Zn&&(Fa(qn,x,cr),ec(qn)&&(wt.invariantPosition(qn.N1,Rs),wt.invariantPosition(qn.C2,Ls),wt.invariantPosition(qn.N3,ws),wt.invariantPosition(qn.C4,Fs),wt.invariantPosition(qn.C5,Ds),wt.invariantPosition(qn.C6,Ns),Qe.add(Rs[0],Rs[1],Rs[2],Bn),Qe.add(Ns[0],Ns[1],Ns[2],Bn),Qe.add(Ds[0],Ds[1],Ds[2],Bn),Qe.add(Fs[0],Fs[1],Fs[2],Bn),Qe.add(ws[0],ws[1],ws[2],Bn),Qe.add(Ls[0],Ls[1],Ls[2],Bn))),++Bn}}const Mn=Qe.getSpheres(),Ln=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return Mn.setBoundingSphere(Ln),Mn}function Op(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return rr.e.createEmpty(Pe);const Ge=x.nucleotideElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,detail:Qe}=me,lt=Ge*(0,zr.J)(Qe),ft=lr.P.createState(lt,lt/2,Pe),{elements:wt,model:Ut,conformation:Jt}=x,{chainAtomSegments:gn,residueAtomSegments:Pn}=Ut.atomicHierarchy,{moleculeType:wn}=Ut.atomicHierarchy.derived.residue,Bn=Tt.hT.transientSegments(gn,wt),Mn=Tt.hT.transientSegments(Pn,wt),Ln=1*Xe;let cr=0;for(;Bn.hasNext;)for(Mn.setSegment(Bn.move());Mn.hasNext;){const{index:Zn}=Mn.move();if((0,Tr.OV)(wn[Zn])){const zn={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};ft.currentGroup=cr,wc(zn,x,Zn),Fc(zn)&&(Jt.invariantPosition(zn.C1_1,fc),Jt.invariantPosition(zn.C2_1,mc),Jt.invariantPosition(zn.C3_1,pc),Jt.invariantPosition(zn.C4_1,hc),Jt.invariantPosition(zn.O4_1,gc),Jt.invariantPosition(zn.trace,cc),(0,kr.X)(ft,cc,Ln,Qe),(0,kr.X)(ft,hc,Ln,Qe),(0,kr.X)(ft,gc,Ln,Qe),(0,kr.X)(ft,fc,Ln,Qe),(0,kr.X)(ft,mc,Ln,Qe),(0,kr.X)(ft,pc,Ln,Qe));const{isPurine:Lr,isPyrimidine:wr}=Ra(x,Zn);Lr?(wa(zn,x,Zn),qa(zn)&&(Jt.invariantPosition(zn.N1,Rs),Jt.invariantPosition(zn.C2,Ls),Jt.invariantPosition(zn.N3,ws),Jt.invariantPosition(zn.C4,Fs),Jt.invariantPosition(zn.C5,Ds),Jt.invariantPosition(zn.C6,Ns),Jt.invariantPosition(zn.N7,uc),Jt.invariantPosition(zn.C8,lc),Jt.invariantPosition(zn.N9,dc),(0,kr.X)(ft,lc,Ln,Qe),(0,kr.X)(ft,uc,Ln,Qe),(0,kr.X)(ft,Ds,Ln,Qe),(0,kr.X)(ft,Ns,Ln,Qe),(0,kr.X)(ft,Rs,Ln,Qe),(0,kr.X)(ft,Ls,Ln,Qe),(0,kr.X)(ft,ws,Ln,Qe),(0,kr.X)(ft,Fs,Ln,Qe),(0,kr.X)(ft,Ds,Ln,Qe),(0,kr.X)(ft,dc,Ln,Qe))):wr&&(Fa(zn,x,Zn),ec(zn)&&(Jt.invariantPosition(zn.N1,Rs),Jt.invariantPosition(zn.C2,Ls),Jt.invariantPosition(zn.N3,ws),Jt.invariantPosition(zn.C4,Fs),Jt.invariantPosition(zn.C5,Ds),Jt.invariantPosition(zn.C6,Ns),(0,kr.X)(ft,Ns,Ln,Qe),(0,kr.X)(ft,Ds,Ln,Qe),(0,kr.X)(ft,Fs,Ln,Qe),(0,kr.X)(ft,ws,Ln,Qe),(0,kr.X)(ft,Ls,Ln,Qe),(0,kr.X)(ft,Rs,Ln,Qe))),++cr}}const qn=lr.P.getMesh(ft),Qn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return qn.setBoundingSphere(Qn),qn}const Na=g.eB.zero(),yc=g.eB.zero(),Ua=g.eB.zero(),Wd=g.eB.zero(),ts=(0,Di.n)(3,!1);let sl;const Va=g.$I.identity(),Fp=g.eB.zero(),Qd=g.eB.zero(),Kd=g.eB.zero(),cl=g.eB.zero(),Np=4,Up=4,Vp=6,Gp=function wp(){return sl||(sl=function Lp(){const oe=(0,zo.nT)(8);for(let x=0;x<3;++x){const F=(x+1)%3;g.eB.set(Na,ts[3*x],ts[3*x+1],-.5),g.eB.set(yc,ts[3*F],ts[3*F+1],-.5),g.eB.set(Ua,ts[3*F],ts[3*F+1],.5),g.eB.set(Wd,ts[3*x],ts[3*x+1],.5),oe.add(Na,yc,Ua),oe.add(Ua,Wd,Na)}return g.eB.set(Na,ts[0],ts[1],-.5),g.eB.set(yc,ts[3],ts[4],-.5),g.eB.set(Ua,ts[6],ts[7],-.5),oe.add(Ua,yc,Na),g.eB.set(Na,ts[0],ts[1],.5),g.eB.set(yc,ts[3],ts[4],.5),g.eB.set(Ua,ts[6],ts[7],.5),oe.add(Na,yc,Ua),oe.getPrimitive()}()),sl}(),Zd={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01})};function zp(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe}=me,Qe=24*Ge,lt=lr.P.createState(Qe,Qe/10,Pe),wt=ju(1),{normalVectors:Ut,binormalVectors:Jt}=wt;let gn=0;const Pn=zu(x,F);for(;Pn.hasNext;){const Mn=Pn.move();lt.currentGroup=gn;const Ln=(0,Tr.OV)(Mn.moleculeType),cr=Tr.gG.is(Mn.secStrucType,4);if(Wu(wt,Mn,Ln||cr?.5:.9,Ln?.3:.5),cr&&!Mn.secStrucLast||!cr){const Zn=z.size.size(Mn.center)*Xe,zn=Np*Zn,Lr=Up*Zn,wr=Vp*Zn,to=Ln?Jt:Ut;g.eB.fromArray(Qd,to,0),g.eB.fromArray(Kd,to,3),g.eB.normalize(cl,g.eB.add(cl,Qd,Kd)),g.$I.targetTo(Va,Mn.p3,Mn.p1,cl),g.$I.mul(Va,Va,g.$I.rotY90Z180),g.$I.scale(Va,Va,g.eB.set(Fp,wr,Lr,zn)),g.$I.setTranslation(Va,Mn.p2),lr.P.addPrimitive(lt,Va,Gp)}++gn}const wn=lr.P.getMesh(lt),Bn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return wn.setBoundingSphere(Bn),wn}v.t.getDefaultValues(Zd);const Yd={...tr.Te,...Zd};function kp(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Yd),createGeometry:zp,createLocationIterator:x=>ia.fromGroup(x),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor}},oe)}const ul=10,Xd={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo)};function Hp(oe,x,F,z,me,Pe){const Ge=x.gapElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,radialSegments:Qe}=me,lt=ul*Qe*2*Ge*2,ft=lr.P.createState(lt,lt/10,Pe),wt=(0,g.eB)(),Ut=(0,g.eB)(),Jt={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:Qe};let gn=0;const Pn=function Om(oe,x){switch(x.kind){case 0:return new Rm(oe,x);case 1:case 2:return new Lm(oe,x)}}(F,x);for(;Pn.hasNext;){const{centerA:Mn,centerB:Ln}=Pn.move();Mn.element===Ln.element||(x.conformation.invariantPosition(Mn.element,wt),x.conformation.invariantPosition(Ln.element,Ut),Jt.radiusTop=Jt.radiusBottom=z.size.size(Mn)*Xe,ft.currentGroup=gn,(0,_i.GH)(ft,wt,Ut,.5,ul,!1,Jt),Jt.radiusTop=Jt.radiusBottom=z.size.size(Ln)*Xe,ft.currentGroup=gn+1,(0,_i.GH)(ft,Ut,wt,.5,ul,!1,Jt)),gn+=2}const wn=lr.P.getMesh(ft),Bn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return wn.setBoundingSphere(Bn),wn}v.t.getDefaultValues(Xd);const xu={...tr.Te,...Xd};function ll(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(xu),createGeometry:Hp,createLocationIterator:$u.fromGroup,getLoci:$m,eachLocation:Jm,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.radialSegments!==z.radialSegments}},oe)}const oi=(0,g.eB)(),di=(0,g.eB)(),jp=(0,g.eB)(),Ms=(0,g.eB)(),ea=(0,g.eB)(),Cu=(0,g.eB)(),Su=(0,g.eB)(),Uc=(0,g.eB)(),Ws=(0,g.eB)(),ta=(0,g.eB)(),dl=(0,g.eB)(),ya=(0,g.eB)(),va=(0,g.eB)(),_a=(0,g.eB)(),ba=(0,g.eB)(),Us=g.eB.fromArray,vc=g.eB.scale,Vs=g.eB.add,aa=g.eB.sub,Wp=g.eB.magnitude,$d=g.eB.negate,fl=g.eB.copy,Jd=g.eB.cross,Qp=g.eB.set,yi=ce.Gm.add3,Kp=ce.Gm.add;function Eu(oe,x,F,z,me,Pe,Ge,Xe,Qe){const{vertices:lt,normals:ft,indices:wt}=x,Ut=lt.elementCount;if(Us(oi,z,oe),vc(Su,oi,Ge),vc(Cu,oi,Xe),Us(di,me,oe),vc(Ms,di,Pe),Jd(ta,di,oi),Us(Ws,F,oe),Vs(ya,Vs(ya,Ws,Ms),Cu),aa(va,Vs(va,Ws,Ms),Su),aa(_a,aa(_a,Ws,Ms),Su),Vs(ba,aa(ba,Ws,Ms),Cu),Ge<Xe?(yi(lt,ba[0],ba[1],ba[2]),yi(lt,_a[0],_a[1],_a[2]),yi(lt,va[0],va[1],va[2]),yi(lt,ya[0],ya[1],ya[2]),fl(ea,Cu)):(yi(lt,ya[0],ya[1],ya[2]),yi(lt,va[0],va[1],va[2]),yi(lt,_a[0],_a[1],_a[2]),yi(lt,ba[0],ba[1],ba[2]),fl(ea,Su)),Qe){for(let Jt=0;Jt<4;++Jt)yi(ft,-ta[0],-ta[1],-ta[2]);yi(wt,Ut,Ut+1,Ut+2),yi(wt,Ut+2,Ut+3,Ut)}else{for(let Jt=0;Jt<4;++Jt)yi(ft,ta[0],ta[1],ta[2]);yi(wt,Ut+2,Ut+1,Ut),yi(wt,Ut,Ut+3,Ut+2)}}function Iu(oe,x,F,z,me,Pe,Ge,Xe,Qe,lt){const{currentGroup:ft,vertices:wt,normals:Ut,indices:Jt,groups:gn}=oe,Pn=wt.elementCount;let wn=0;Xe>0?(Us(oi,x,0),Us(di,x,3*me),wn=Xe/Wp(aa(jp,di,oi))):Qp(Uc,0,0,0);for(let Mn=0;Mn<=me;++Mn){const Ln=Pe[Mn],qn=0===Xe?Ge[Mn]:Xe*(1-Mn/me),Qn=3*Mn;Us(ea,F,Qn),vc(ea,ea,qn),Us(Ms,z,Qn),vc(Ms,Ms,Ln),Xe>0&&(Us(oi,F,Qn),Us(di,z,Qn),vc(Uc,Jd(Uc,oi,di),wn)),Us(Ws,x,Qn),Us(ta,F,Qn),Us(dl,z,Qn),Vs(oi,Vs(oi,Ws,Ms),ea),Vs(di,ta,Uc),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),Vs(oi,aa(oi,Ws,Ms),ea),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),$d(di,dl),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),aa(oi,aa(oi,Ws,Ms),ea),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),Vs(di,$d(di,ta),Uc),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),aa(oi,Vs(oi,Ws,Ms),ea),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),fl(di,dl),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2]),Vs(oi,Vs(oi,Ws,Ms),ea),yi(wt,oi[0],oi[1],oi[2]),yi(Ut,di[0],di[1],di[2])}for(let Mn=0;Mn<me;++Mn){for(let Ln=0;Ln<2;Ln++)yi(Jt,Pn+8*Mn+2*Ln,Pn+8*(Mn+1)+2*Ln+1,Pn+8*Mn+2*Ln+1),yi(Jt,Pn+8*Mn+2*Ln,Pn+8*(Mn+1)+2*Ln,Pn+8*(Mn+1)+2*Ln+1);for(let Ln=2;Ln<4;Ln++)yi(Jt,Pn+8*Mn+2*Ln,Pn+8*(Mn+1)+2*Ln,Pn+8*Mn+2*Ln+1),yi(Jt,Pn+8*(Mn+1)+2*Ln,Pn+8*(Mn+1)+2*Ln+1,Pn+8*Mn+2*Ln+1)}if(Qe){const cr=0===Xe?Ge[0]:Xe;Eu(0,oe,x,F,z,Pe[0],cr,cr,!1)}else if(Xe>0){const Mn=Pe[0],Ln=Ge[0];Eu(0,oe,x,F,z,Mn,Xe,-Ln,!1),Eu(0,oe,x,F,z,Mn,-Xe,Ln,!1)}if(lt&&0===Xe){const Ln=Ge[me];Eu(3*me,oe,x,F,z,Pe[me],Ln,Ln,!0)}for(let Mn=0,Ln=8*(me+1)+(Qe?4:Xe>0?8:0)+(lt&&0===Xe?4:0);Mn<Ln;++Mn)Kp(gn,ft)}const ji=(0,g.eB)(),ns=(0,g.eB)(),Is=(0,g.eB)(),ps=(0,g.eB)(),xs=(0,g.eB)();function Au(oe,x,F,z,me){oe[0]=x[0]*z+F[0]*me,oe[1]=x[1]*z+F[1]*me,oe[2]=x[2]*z+F[2]*me}function _c(oe,x,F,z,me,Pe){oe[0]=x[0]*me+F[0]*Pe+z[0],oe[1]=x[1]*me+F[1]*Pe+z[1],oe[2]=x[2]*me+F[2]*Pe+z[2]}const ca=g.eB.fromArray,Zp=g.eB.normalize,ml=g.eB.scaleAndAdd,qd=g.eB.cross,Yp=g.eB.dot,Xp=g.eB.unitX,Cs=ce.Gm.add3,pl=new Map;function hl(oe,x,F,z,me,Pe,Ge,Xe,Qe,lt,ft){const{currentGroup:wt,vertices:Ut,normals:Jt,indices:gn,groups:Pn}=oe;let wn=Ut.elementCount;const{cos:Bn,sin:Mn}=function $p(oe,x){const F=x?1:0,z=(0,ce.m1)(oe,F);if(!pl.has(z)){const me=[],Pe=[];for(let Ge=0;Ge<oe;++Ge){const Xe=(2*Ge+F)/oe*Math.PI;me[Ge]=Math.cos(Xe),Pe[Ge]=Math.sin(Xe)}pl.set(z,{cos:me,sin:Pe})}return pl.get(z)}(Pe,"rounded"===ft),Ln=Math.round(Pe/4),cr=3*Ln;for(let Zn=0;Zn<=me;++Zn){const zn=3*Zn;ca(ps,F,zn),ca(xs,z,zn),ca(Is,x,zn);const Lr=Ge[Zn],wr=Xe[Zn],to="rounded"===ft&&wr>Lr;for(let Cr=0;Cr<Pe;++Cr){if(to){_c(ns,ps,xs,Is,Lr*Bn[Cr],Lr*Mn[Cr]);const Zr=Yp(xs,Xp)<0?Cr<Ln||Cr>=cr?wr-Lr:-wr+Lr:Cr>=Ln&&Cr<cr?-wr+Lr:wr-Lr;ml(ns,ns,ps,Zr),Cr===Ln||Cr===Ln-1?Au(ji,ps,xs,0,1):Cr===cr||Cr===cr-1?Au(ji,ps,xs,0,-1):Au(ji,ps,xs,Bn[Cr],Mn[Cr])}else _c(ns,ps,xs,Is,wr*Bn[Cr],Lr*Mn[Cr]),Au(ji,ps,xs,Lr*Bn[Cr],wr*Mn[Cr]);Zp(ji,ji),Cs(Ut,ns[0],ns[1],ns[2]),Cs(Jt,ji[0],ji[1],ji[2])}}const qn=Math.round(Pe/2);for(let Zn=0;Zn<me;++Zn){for(let zn=0;zn<qn;++zn)Cs(gn,wn+Zn*Pe+(zn+1)%Pe,wn+(Zn+1)*Pe+(zn+1)%Pe,wn+Zn*Pe+zn),Cs(gn,wn+(Zn+1)*Pe+(zn+1)%Pe,wn+(Zn+1)*Pe+zn,wn+Zn*Pe+zn);for(let zn=qn;zn<Pe;++zn)Cs(gn,wn+Zn*Pe+(zn+1)%Pe,wn+(Zn+1)*Pe+zn,wn+Zn*Pe+zn),Cs(gn,wn+(Zn+1)*Pe+(zn+1)%Pe,wn+(Zn+1)*Pe+zn,wn+Zn*Pe+(zn+1)%Pe)}if(Qe){const zn=Ut.elementCount;ca(ps,F,0),ca(xs,z,0),ca(Is,x,0),qd(ji,xs,ps),Cs(Ut,Is[0],Is[1],Is[2]),Cs(Jt,ji[0],ji[1],ji[2]);const Lr=Ge[0];let wr=Xe[0];const to="rounded"===ft&&wr>Lr;to&&(wr-=Lr),wn=Ut.elementCount;for(let Cr=0;Cr<Pe;++Cr)to?(_c(ns,ps,xs,Is,Lr*Bn[Cr],Lr*Mn[Cr]),ml(ns,ns,ps,Cr<Ln||Cr>=cr?wr:-wr)):_c(ns,ps,xs,Is,wr*Bn[Cr],Lr*Mn[Cr]),Cs(Ut,ns[0],ns[1],ns[2]),Cs(Jt,ji[0],ji[1],ji[2]),Cs(gn,wn+(Cr+1)%Pe,wn+Cr,zn)}if(lt){const Zn=3*me,zn=Ut.elementCount;ca(ps,F,Zn),ca(xs,z,Zn),ca(Is,x,Zn),qd(ji,ps,xs),Cs(Ut,Is[0],Is[1],Is[2]),Cs(Jt,ji[0],ji[1],ji[2]);const Lr=Ge[me];let wr=Xe[me];const to="rounded"===ft&&wr>Lr;to&&(wr-=Lr),wn=Ut.elementCount;for(let Cr=0;Cr<Pe;++Cr)to?(_c(ns,ps,xs,Is,Lr*Bn[Cr],Lr*Mn[Cr]),ml(ns,ns,ps,Cr<Ln||Cr>=cr?wr:-wr)):_c(ns,ps,xs,Is,wr*Bn[Cr],Lr*Mn[Cr]),Cs(Ut,ns[0],ns[1],ns[2]),Cs(Jt,ji[0],ji[1],ji[2]),Cs(gn,wn+Cr,wn+(Cr+1)%Pe,zn)}ce.Gm.addRepeat(Pn,(me+1)*Pe+(Qe?Pe+1:0)+(lt?Pe+1:0),wt)}const ua=g.eB.fromArray,Jp=g.eB.magnitude,gl=g.eB.sub,ef=g.eB.add,yl=g.eB.scale,qp=g.eB.negate,eh=g.eB.copy,th=g.eB.cross,Gs=ce.Gm.add3,nh=ce.Gm.add,as=(0,g.eB)(),hs=(0,g.eB)(),rh=(0,g.eB)(),vl=(0,g.eB)(),Ga=(0,g.eB)(),tf=(0,g.eB)(),Vc=(0,g.eB)(),oh=(0,g.eB)(),_l=(0,g.eB)();function Pu(oe,x,F,z,me,Pe,Ge,Xe){const{currentGroup:Qe,vertices:lt,normals:ft,indices:wt,groups:Ut}=oe,Jt=lt.elementCount;let gn=0;Xe>0&&(ua(as,x,0),ua(hs,x,3*me),gn=Xe/Jp(gl(rh,hs,as)));for(let wn=0;wn<=me;++wn){const Bn=Pe[wn],Ln=0===Xe?Ge[wn]:Xe*(1-wn/me),cr=3*wn;ua(Ga,F,cr),yl(Ga,Ga,Ln),ua(vl,z,cr),yl(vl,vl,Bn),Xe>0&&(ua(as,F,cr),ua(hs,z,cr),yl(tf,th(tf,as,hs),gn)),ua(Vc,x,cr),ua(oh,F,cr),ua(_l,z,cr),ef(as,Vc,Ga),qp(hs,_l),Gs(lt,as[0],as[1],as[2]),Gs(ft,hs[0],hs[1],hs[2]),gl(as,Vc,Ga),Gs(lt,as[0],as[1],as[2]),Gs(ft,hs[0],hs[1],hs[2]),ef(as,Vc,Ga),eh(hs,_l),Gs(lt,as[0],as[1],as[2]),Gs(ft,hs[0],hs[1],hs[2]),gl(as,Vc,Ga),Gs(lt,as[0],as[1],as[2]),Gs(ft,hs[0],hs[1],hs[2])}for(let wn=0;wn<me;++wn)Gs(wt,Jt+4*wn,Jt+4*(wn+1)+1,Jt+4*wn+1),Gs(wt,Jt+4*wn,Jt+4*(wn+1),Jt+4*(wn+1)+1),Gs(wt,Jt+4*wn+2+1,Jt+4*(wn+1)+2+1,Jt+4*wn+2),Gs(wt,Jt+4*wn+2,Jt+4*(wn+1)+2+1,Jt+4*(wn+1)+2);for(let wn=0,Bn=4*(me+1);wn<Bn;++wn)nh(Ut,Qe)}const nf={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:v.t.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:v.t.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:v.t.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:v.t.Select("elliptical",v.t.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:v.t.Select("square",v.t.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),linearSegments:v.t.Numeric(8,{min:1,max:48,step:1},Jn.iy.CustomQualityParamInfo),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo)},Ts=(v.t.getDefaultValues(nf),(0,g.eB)());function ih(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,detail:Qe,linearSegments:lt,radialSegments:ft,aspectRatio:wt,arrowFactor:Ut,tubularHelices:Jt,helixProfile:gn,nucleicProfile:Pn}=me,wn=lt*ft*Ge+(ft+1)*Ge*2,Bn=lr.P.createState(wn,wn/10,Pe),Mn=Je.Nf.isCoarse(x),Ln=ju(lt),{curvePoints:cr,normalVectors:qn,binormalVectors:Qn,widthValues:Zn,heightValues:zn}=Ln;let Lr=0;const wr=zu(x,F,{ignoreSecondaryStructure:!1,useHelixOrientation:Jt});for(;wr.hasNext;){const Zr=wr.move();Bn.currentGroup=Lr;const Io=(0,Tr.OV)(Zr.moleculeType),wo=Tr.gG.is(Zr.secStrucType,4),si=Tr.gG.is(Zr.secStrucType,2),ai=Io?tu:eu;Wu(Ln,Zr,si&&!Jt?Ym:bd,ai);let li=z.size.size(Zr.centerPrev)*Xe,Vo=z.size.size(Zr.center)*Xe,jo=z.size.size(Zr.centerNext)*Xe;Mn&&(li*=wt/2,Vo*=wt/2,jo*=wt/2);const go=Zr.secStrucFirst||Zr.coarseBackboneFirst||Zr.first,Qo=Zr.secStrucLast||Zr.coarseBackboneLast||Zr.last;let Ko=lt;if(Zr.initial){Ko=Math.max(Math.round(lt*ai),1);const $o=lt-Ko;cr.copyWithin(0,3*$o),Qn.copyWithin(0,3*$o),qn.copyWithin(0,3*$o),g.eB.fromArray(Ts,cr,3),g.eB.normalize(Ts,g.eB.sub(Ts,Zr.p2,Ts)),g.eB.scaleAndAdd(Ts,Zr.p2,Ts,Vo*nu),g.eB.toArray(Ts,cr,0)}else Zr.final&&(Ko=Math.max(Math.round(lt*(1-ai)),1),g.eB.fromArray(Ts,cr,3*Ko-3),g.eB.normalize(Ts,g.eB.sub(Ts,Zr.p2,Ts)),g.eB.scaleAndAdd(Ts,Zr.p2,Ts,Vo*nu),g.eB.toArray(Ts,cr,3*Ko));if(!0===Zr.initial&&!0===Zr.final)(0,kr.X)(Bn,Zr.p2,2*Vo,Qe);else if(wo){const fi=Vo*wt,ii=Zr.secStrucLast?fi*Ut:0;Xu(Ln,li,Vo,jo,li*wt,fi,jo*wt,ai),2===ft?Pu(Bn,cr,qn,Qn,Ko,Zn,zn,ii):Iu(Bn,cr,qn,Qn,Ko,Zn,zn,ii,go,Qo)}else{let $o,fi,Zo;si&&!Zr.isCoarseBackbone?Jt?(li*=1.5*wt,Vo*=1.5*wt,jo*=1.5*wt,$o=li,fi=Vo,Zo=jo):($o=li*wt,fi=Vo*wt,Zo=jo*wt):Io&&!Zr.isCoarseBackbone?($o=li*wt,fi=Vo*wt,Zo=jo*wt):($o=li,fi=Vo,Zo=jo),Xu(Ln,li,Vo,jo,$o,fi,Zo,ai);const[ii,Ai]=Io&&!Zr.isCoarseBackbone?[Qn,qn]:[qn,Qn];if(Io&&!Zr.isCoarseBackbone)for(let vs=0,As=ii.length;vs<As;vs++)ii[vs]*=-1;const Xi=Io?Pn:gn;2===ft?Io&&!Zr.isCoarseBackbone?Pu(Bn,cr,ii,Ai,Ko,zn,Zn,0):Pu(Bn,cr,ii,Ai,Ko,Zn,zn,0):4===ft?Iu(Bn,cr,ii,Ai,Ko,Zn,zn,0,go,Qo):fi===Vo?hl(Bn,cr,ii,Ai,Ko,ft,Zn,zn,go,Qo,"elliptical"):"square"===Xi?Iu(Bn,cr,ii,Ai,Ko,Zn,zn,0,go,Qo):hl(Bn,cr,ii,Ai,Ko,ft,Zn,zn,go,Qo,Xi)}++Lr}const to=lr.P.getMesh(Bn),Cr=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return to.setBoundingSphere(Cr),to}const rf={...tr.Te,...nf};function sh(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(rf),createGeometry:ih,createLocationIterator:x=>ia.fromGroup(x,{asSecondary:!0}),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.tubularHelices!==z.tubularHelices||F.detail!==z.detail||F.linearSegments!==z.linearSegments||F.radialSegments!==z.radialSegments||F.aspectRatio!==z.aspectRatio||F.arrowFactor!==z.arrowFactor||F.helixProfile!==z.helixProfile||F.nucleicProfile!==z.nucleicProfile;const Qe=Yc.v.get(Ge.structure).version;x.info.secondaryStructureHash!==Qe&&(void 0!==x.info.secondaryStructureHash&&(x.createGeometry=!0),x.info.secondaryStructureHash=Qe)}},oe)}const of={"polymer-trace":(oe,x)=>(0,vn.T)("Polymer trace mesh",oe,x,sh),"polymer-gap":(oe,x)=>(0,vn.T)("Polymer gap cylinder",oe,x,ll),"nucleotide-block":(oe,x)=>(0,vn.T)("Nucleotide block mesh",oe,x,op),"nucleotide-ring":(oe,x)=>(0,vn.T)("Nucleotide ring mesh",oe,x,fp),"nucleotide-atomic-ring-fill":(oe,x)=>(0,vn.T)("Nucleotide atomic ring fill",oe,x,Sp),"nucleotide-atomic-bond":(oe,x)=>(0,vn.T)("Nucleotide atomic bond",oe,x,Ep),"nucleotide-atomic-element":(oe,x)=>(0,vn.T)("Nucleotide atomic element",oe,x,Bp),"direction-wedge":(oe,x)=>(0,vn.T)("Polymer direction wedge",oe,x,kp)},sf={...rf,...xu,...Md,...Nd,...ol,...il,...Hd,...Yd,sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),visuals:v.t.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],v.t.objectToOptions(of)),bumpFrequency:v.t.Numeric(2,{min:0,max:10,step:.1},Jn.iy.ShadingCategory),colorMode:v.t.Select("default",v.t.arrayToOptions(["default","interpolate"]),{...Jn.iy.ShadingCategory,isHidden:!0})},uh=(0,pr.GT)({name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:function ch(oe,x){return dr.YL.createMulti("Cartoon",oe,x,pr.J1,of)},getParams:function ah(oe,x){const F=v.t.clone(sf);let z=!1,me=!1;return x.units.forEach(Pe=>{!z&&Je.Nf.isAtomic(Pe)&&Pe.nucleotideElements.length&&(z=!0),!me&&Pe.gapElements.length&&(me=!0)}),F.visuals.defaultValue=["polymer-trace"],z&&F.visuals.defaultValue.push("nucleotide-ring"),me&&F.visuals.defaultValue.push("polymer-gap"),F},defaultValues:v.t.getDefaultValues(sf),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.polymerResidueCount>0,ensureCustomProperties:{attach:function(){var oe=(0,r.A)(function*(x,F){yield Yc.v.attach(x,F,void 0,!0);for(const z of F.models)yield Gu.attach(x,z,void 0,!0)});return function(F,z){return oe.apply(this,arguments)}}(),detach:oe=>{Yc.v.ref(oe,!1);for(const x of oe.models)Gu.ref(x,!1)}}});var af=n(4777),cf=n(8593),bc=n(2028);const uf={...tr.Te,sizeFactor:v.t.Numeric(1,{min:0,max:10,step:.1}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),ignoreHydrogens:v.t.Boolean(!1)};function lh(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(uf),createGeometry:dh,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail||F.ignoreHydrogens!==z.ignoreHydrogens}},oe)}function dh(oe,x,F,z,me,Pe){const{child:Ge}=F,Xe=Ge?.unitMap.get(x.id);if(Ge&&!Xe)return rr.e.createEmpty(Pe);const{detail:Qe,sizeFactor:lt,ignoreHydrogens:ft}=me,{elements:wt,model:Ut}=x,{atomicNumber:Jt}=x.model.atomicHierarchy.derived.atom,gn=wt.length,Pn=gn*(0,zr.J)(Qe),wn=lr.P.createState(Pn,Pn/2,Pe),Bn=cf._.Provider.get(Ut);if(!Bn)return rr.e.createEmpty(Pe);const Mn=(0,g.eB)(),Ln=(0,g.U)(),cr=(0,g.eB)(),qn=(0,g.eB)(),Qn=(0,g.eB)(),{elementToAnsiotrop:Zn,data:zn}=Bn,{U:Lr}=zn,wr=zn._schema.U.space,to=x.conformation,Cr=Je.iZ.Location.create(F);Cr.unit=x;for(let wo=0;wo<gn;wo++){const si=wt[wo],Ii=Zn[si];if(-1!==Ii&&!(Xe&&!es.X.has(Xe.elements,si)||ft&&(0,Gr.R$)(Jt,si))){Cr.element=si,to.invariantPosition(si,Mn),wn.currentGroup=wo,g.qY.toMat3(Ln,wr,Lr.value(Ii)),g.U.symmtricFromLower(Ln,Ln),g.U.symmetricEigenvalues(cr,Ln),g.U.eigenvector(qn,Ln,cr[1]),g.U.eigenvector(Qn,Ln,cr[2]);for(let ai=0;ai<3;++ai)cr[ai]=1.5958*lt*Math.sqrt(Math.abs(cr[ai]));(0,bc.T)(cr[0],cr[1],g.p8)&&(0,bc.T)(cr[1],cr[2],g.p8)?(0,kr.X)(wn,Mn,cr[0],Qe):(0,af.P)(wn,Mn,Qn,qn,cr,Qe)}}const Zr=lr.P.getMesh(wn),Io=Bt.f8.expand((0,Bt.f8)(),(Xe||x).boundary.sphere,1*lt);return Zr.setBoundingSphere(Io),Zr}const lf={"ellipsoid-mesh":(oe,x)=>(0,pr.TP)("Ellipsoid Mesh",oe,x,lh),"intra-bond":(oe,x)=>(0,pr.TP)("Intra-unit bond cylinder",oe,x,mi),"inter-bond":(oe,x)=>(0,pr.Kp)("Inter-unit bond cylinder",oe,x,Hn)},df={...uf,...Ci,...Qi,includeParent:v.t.Boolean(!1),adjustCylinderLength:v.t.Boolean(!1,{isHidden:!0}),unitKinds:(0,Rr.R8)(["atomic"]),sizeFactor:v.t.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:v.t.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:v.t.Boolean(!0),visuals:v.t.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],v.t.objectToOptions(lf)),bumpFrequency:v.t.Numeric(0,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},ph=(0,pr.GT)({name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:function mh(oe,x){return dr.YL.createMulti("Ellipsoid",oe,x,pr.J1,lf)},getParams:function fh(oe,x){return df},defaultValues:v.t.getDefaultValues(df),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.elementCount>0&&oe.models.some(x=>cf._.Provider.isApplicable(x)),getData:(oe,x)=>x.includeParent?oe.asParent():oe,mustRecreate:(oe,x)=>oe.includeParent!==x.includeParent});var hh=n(9421),gh=(n(4951),n(2897)),yh=n(4143),cs=n(4511);const vh="\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute float aRadius;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n\n#if defined(dCalcType_groupId)\n    attribute float aGroup;\n    varying float vGroup;\n#endif\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vRadiusSqInv = 1.0 / (aRadius * aRadius);\n    #if defined(dCalcType_groupId)\n        vGroup = aGroup;\n    #endif\n    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);\n    vPosition = (aPosition - uBboxMin) / uResolution;\n    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n}\n",_h="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        precision highp sampler2D;\n        uniform sampler2D tMinDistanceTex;\n        uniform vec3 uGridTexDim;\n    #elif defined(dGridTexType_3d)\n        precision highp sampler3D;\n        uniform sampler3D tMinDistanceTex;\n    #endif\n    varying float vGroup;\n#endif\n\n#include common\n\nuniform vec3 uGridDim;\nuniform vec2 uGridTexScale;\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uAlpha;\nuniform float uResolution;\nuniform float uRadiusFactorInv;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition) * uResolution;\n\n    #if defined(dCalcType_density)\n        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));\n        gl_FragColor.a = density * uRadiusFactorInv;\n    #elif defined(dCalcType_minDistance)\n        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;\n    #elif defined(dCalcType_groupId)\n        #if defined(dGridTexType_2d)\n            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;\n        #elif defined(dGridTexType_3d)\n            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;\n        #endif\n        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)\n            discard;\n        gl_FragColor.rgb = packIntToRGB(vGroup);\n    #endif\n}\n",bh={drawCount:(0,cs.Xb)("number"),instanceCount:(0,cs.Xb)("number"),aRadius:(0,cs.Yz)("float32",1,0),aPosition:(0,cs.Yz)("float32",3,0),aGroup:(0,cs.Yz)("float32",1,0),uCurrentSlice:(0,cs.w5)("f"),uCurrentX:(0,cs.w5)("f"),uCurrentY:(0,cs.w5)("f"),uBboxMin:(0,cs.w5)("v3","material"),uBboxSize:(0,cs.w5)("v3","material"),uGridDim:(0,cs.w5)("v3","material"),uGridTexDim:(0,cs.w5)("v3","material"),uGridTexScale:(0,cs.w5)("v2","material"),uAlpha:(0,cs.w5)("f","material"),uResolution:(0,cs.w5)("f","material"),uRadiusFactorInv:(0,cs.w5)("f","material"),tMinDistanceTex:(0,cs.$G)("texture","rgba","float","nearest","material"),dGridTexType:(0,cs.$F)("string",["2d","3d"]),dCalcType:(0,cs.$F)("string",["density","minDistance","groupId"])},na="gaussian-density";function bl(oe){return oe.namedFramebuffers[na]||(oe.namedFramebuffers[na]=oe.resources.framebuffer()),oe.namedFramebuffers[na]}function xl(oe,x,F,z,me,Pe){const Ge=`${na}-${oe}`;return x.namedTextures[Ge]||(x.namedTextures[Ge]=x.resources.texture(F,z,me,Pe)),x.namedTextures[Ge]}function ff(oe,x,F,z,me,Pe){return oe.isWebGL2?function xh(oe,x,F,z,me,Pe){se.g$&&oe.timer.mark("GaussianDensityTexture3d");const Ge=function Ch(oe,x,F,z,me,Pe){const{gl:Ge,resources:Xe,state:Qe,extensions:{colorBufferFloat:lt,textureFloat:ft,colorBufferHalfFloat:wt,textureHalfFloat:Ut}}=oe,{smoothness:Jt,resolution:gn}=me,{drawCount:Pn,positions:wn,radii:Bn,groups:Mn,scale:Ln,expandedBox:cr,dim:qn,maxRadius:Qn}=gf(x,F,z,me),[Zn,zn,Lr]=qn,wr=xl("min-dist-3d",oe,"volume-uint8","rgba","ubyte","nearest");wr.define(Zn,zn,Lr);const to=g.ZY.create(1,1),Cr=2*Qn,Zr=yf(oe,Pn,wn,Bn,Mn,wr,cr,qn,qn,to,Jt,gn,Cr),{uCurrentSlice:Io}=Zr.values,wo=bl(oe);function si(Ii,ai){Qe.currentRenderItemId=-1;for(let li=0;li<Lr;++li)G.IQ.update(Io,li),Ii.attachFramebuffer(wo,0,li),ai&&Ge.clear(Ge.COLOR_BUFFER_BIT),Zr.render();Ge.flush()}return wo.bind(),vf(oe),Qe.viewport(0,0,Zn,zn),Qe.scissor(0,0,Zn,zn),Pe||(Pe=wt&&Ut?Xe.texture("volume-float16","rgba","fp16","linear"):lt&&ft?Xe.texture("volume-float32","rgba","float","linear"):Xe.texture("volume-uint8","rgba","ubyte","linear")),Pe.define(Zn,zn,Lr),bf(oe,Zr),si(Pe,!0),_f(oe,Zr),si(wr,!0),xf(oe,Zr),si(Pe,!1),{texture:Pe,scale:Ln,bbox:cr,gridDim:qn,gridTexDim:qn,gridTexScale:to,radiusFactor:Cr,resolution:gn,maxRadius:Qn}}(oe,x,F,z,me,Pe);return se.g$&&oe.timer.markEnd("GaussianDensityTexture3d"),mf(Ge)}(oe,x,F,z,me,Pe):Cl(oe,x,F,z,!1,me,Pe)}function Cl(oe,x,F,z,me,Pe,Ge){se.g$&&oe.timer.mark("GaussianDensityTexture2d");const Xe=function hf(oe,x,F,z,me,Pe,Ge){const{gl:Xe,resources:Qe,state:lt,extensions:{colorBufferFloat:ft,textureFloat:wt,colorBufferHalfFloat:Ut,textureHalfFloat:Jt,blendMinMax:gn}}=oe,{smoothness:Pn,resolution:wn}=Pe,{drawCount:Bn,positions:Mn,radii:Ln,groups:cr,scale:qn,expandedBox:Qn,dim:Zn,maxRadius:zn}=gf(x,F,z,Pe),[Lr,wr,to]=Zn,{texDimX:Cr,texDimY:Zr,texCols:Io,powerOfTwoSize:wo}=function Eh(oe){const F=Math.sqrt(oe[0]*oe[1]*oe[2]),z=Math.pow(2,Math.ceil(Math.log(F)/Math.log(2)));let me=0,Pe=oe[1],Ge=1,Xe=oe[2];return z<oe[0]*oe[2]?(Xe=Math.floor(z/oe[0]),Ge=Math.ceil(oe[2]/Xe),me=Xe*oe[0],Pe*=Ge):me=oe[0]*oe[2],{texDimX:me,texDimY:Pe,texRows:Ge,texCols:Xe,powerOfTwoSize:Pe<z?z:2*z}}(Zn),si=g.eB.create(Cr,Zr,0),Ii=g.ZY.create(Cr/wo,Zr/wo),ai=2*zn,li=me?wo:Cr,Vo=me?wo:Zr,jo=xl("min-dist-2d",oe,"image-uint8","rgba","ubyte","nearest");jo.define(li,Vo);const go=yf(oe,Bn,Mn,Ln,cr,jo,Qn,Zn,si,Ii,Pn,wn,ai),{uCurrentSlice:Qo,uCurrentX:Ko,uCurrentY:$o}=go.values,fi=bl(oe);function Zo(ii,Ai){lt.currentRenderItemId=-1,ii.attachFramebuffer(fi,0),Ai&&(lt.viewport(0,0,li,Vo),lt.scissor(0,0,li,Vo),Xe.clear(Xe.COLOR_BUFFER_BIT)),G.IQ.update($o,0);let Xi=0,vs=0,As=0;for(let xa=0;xa<to;++xa)Xi>=Io&&(Xi-=Io,vs+=wr,As=0,G.IQ.update($o,vs)),G.IQ.update(Ko,As),G.IQ.update(Qo,xa),lt.viewport(As,vs,Lr,wr),lt.scissor(As,vs,Lr,wr),go.render(),++Xi,As+=Lr;Xe.flush()}return fi.bind(),vf(oe),Ge||(Ge=Ut&&Jt?Qe.texture("image-float16","rgba","fp16","linear"):ft&&wt?Qe.texture("image-float32","rgba","float","linear"):Qe.texture("image-uint8","rgba","ubyte","linear")),Ge.define(li,Vo),bf(oe,go),Zo(Ge,!0),gn&&(_f(oe,go),Zo(jo,!0),xf(oe,go),Zo(Ge,!1)),{texture:Ge,scale:qn,bbox:Qn,gridDim:Zn,gridTexDim:si,gridTexScale:Ii,radiusFactor:ai,resolution:wn,maxRadius:zn}}(oe,x,F,z,me,Pe,Ge);return se.g$&&oe.timer.markEnd("GaussianDensityTexture2d"),mf(Xe)}function mf({texture:oe,scale:x,bbox:F,gridDim:z,gridTexDim:me,gridTexScale:Pe,radiusFactor:Ge,resolution:Xe,maxRadius:Qe}){return{transform:pf(x,F),texture:oe,bbox:F,gridDim:z,gridTexDim:me,gridTexScale:Pe,radiusFactor:Ge,resolution:Xe,maxRadius:Qe}}function pf(oe,x){const F=g.$I.identity();return g.$I.fromScaling(F,oe),g.$I.setTranslation(F,x.min),F}function gf(oe,x,F,z){const{resolution:me,radiusOffset:Pe}=z,Ge=1/me,{indices:Xe,x:Qe,y:lt,z:ft,id:wt}=oe,Ut=Tt.CD.size(Xe),Jt=new Float32Array(3*Ut),gn=new Float32Array(Ut),Pn=new Float32Array(Ut);let wn=0;for(let Qn=0;Qn<Ut;++Qn){const Zn=Tt.CD.getAt(Xe,Qn);Jt[3*Qn]=Qe[Zn],Jt[3*Qn+1]=lt[Zn],Jt[3*Qn+2]=ft[Zn];const zn=F(Zn)+Pe;wn<zn&&(wn=zn),gn[Qn]=zn,Pn[Qn]=wt?wt[Qn]:Qn}const Bn=2*wn+4*me,Mn=Bt.DJ.expand((0,Bt.DJ)(),x,g.eB.create(Bn,Bn,Bn)),Ln=Bt.DJ.scale((0,Bt.DJ)(),Mn,Ge),cr=Bt.DJ.size((0,g.eB)(),Ln);return g.eB.ceil(cr,cr),{drawCount:Ut,positions:Jt,radii:gn,groups:Pn,scale:g.eB.create(me,me,me),expandedBox:Mn,dim:cr,maxRadius:wn}}function yf(oe,x,F,z,me,Pe,Ge,Xe,Qe,lt,ft,wt,Ut){if(oe.namedComputeRenderables[na]){const Jt=g.eB.sub((0,g.eB)(),Ge.max,Ge.min),gn=oe.namedComputeRenderables[na].values;G.IQ.updateIfChanged(gn.drawCount,x),G.IQ.updateIfChanged(gn.instanceCount,1),G.IQ.update(gn.aRadius,z),G.IQ.update(gn.aPosition,F),G.IQ.update(gn.aGroup,me),G.IQ.updateIfChanged(gn.uCurrentSlice,0),G.IQ.updateIfChanged(gn.uCurrentX,0),G.IQ.updateIfChanged(gn.uCurrentY,0),G.IQ.update(gn.uBboxMin,Ge.min),G.IQ.update(gn.uBboxSize,Jt),G.IQ.update(gn.uGridDim,Xe),G.IQ.update(gn.uGridTexDim,Qe),G.IQ.update(gn.uGridTexScale,lt),G.IQ.updateIfChanged(gn.uAlpha,ft),G.IQ.updateIfChanged(gn.uResolution,wt),G.IQ.updateIfChanged(gn.uRadiusFactorInv,1/Ut),G.IQ.update(gn.tMinDistanceTex,Pe),G.IQ.updateIfChanged(gn.dGridTexType,Pe.getDepth()>0?"3d":"2d"),G.IQ.updateIfChanged(gn.dCalcType,"density"),oe.namedComputeRenderables[na].update()}else oe.namedComputeRenderables[na]=function Sh(oe,x,F,z,me,Pe,Ge,Xe,Qe,lt,ft,wt,Ut){const Jt=g.eB.sub((0,g.eB)(),Ge.max,Ge.min),gn={drawCount:G.IQ.create(x),instanceCount:G.IQ.create(1),aRadius:G.IQ.create(z),aPosition:G.IQ.create(F),aGroup:G.IQ.create(me),uCurrentSlice:G.IQ.create(0),uCurrentX:G.IQ.create(0),uCurrentY:G.IQ.create(0),uBboxMin:G.IQ.create(Ge.min),uBboxSize:G.IQ.create(Jt),uGridDim:G.IQ.create(Xe),uGridTexDim:G.IQ.create(Qe),uGridTexScale:G.IQ.create(lt),uAlpha:G.IQ.create(ft),uResolution:G.IQ.create(wt),uRadiusFactorInv:G.IQ.create(1/Ut),tMinDistanceTex:G.IQ.create(Pe),dGridTexType:G.IQ.create(Pe.getDepth()>0?"3d":"2d"),dCalcType:G.IQ.create("density")},Pn={...bh},wn=(0,gh.NG)(na,vh,_h),Bn=(0,yh.$h)(oe,"points",wn,Pn,gn);return(0,hh._)(Bn,gn)}(oe,x,F,z,me,Pe,Ge,Xe,Qe,lt,ft,wt,Ut);return oe.namedComputeRenderables[na]}function vf(oe){const{gl:x,state:F}=oe;F.disable(x.CULL_FACE),F.enable(x.BLEND),F.disable(x.DEPTH_TEST),F.enable(x.SCISSOR_TEST),F.depthMask(!1),F.clearColor(0,0,0,0)}function _f(oe,x){const{gl:F,state:z}=oe;if(G.IQ.update(x.values.dCalcType,"minDistance"),x.update(),z.colorMask(!1,!1,!1,!0),z.blendFunc(F.ONE,F.ONE),!oe.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");z.blendEquation(oe.extensions.blendMinMax.MAX)}function bf(oe,x){const{gl:F,state:z}=oe;G.IQ.update(x.values.dCalcType,"density"),x.update(),z.colorMask(!1,!1,!1,!0),z.blendFunc(F.ONE,F.ONE),z.blendEquation(F.FUNC_ADD)}function xf(oe,x){const{gl:F,state:z}=oe;G.IQ.update(x.values.dCalcType,"groupId"),x.update(),z.colorMask(!0,!0,!0,!1),z.blendFunc(F.ONE,F.ZERO),z.blendEquation(F.FUNC_ADD)}var Ah=n(9886);function Cf(oe,x,F,z,me){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,r.A)(function*(oe,x,F,z,me){const{resolution:Pe,radiusOffset:Ge,smoothness:Xe}=me,Qe=1/Pe,{indices:lt,x:ft,y:wt,z:Ut,id:Jt}=x,gn=Tt.CD.size(lt),Pn=new Float32Array(gn);let wn=0;for(let Zo=0;Zo<gn;++Zo){const ii=z(Tt.CD.getAt(lt,Zo))+Ge;wn<ii&&(wn=ii),Pn[Zo]=ii}const Bn=2*wn+Pe,Mn=Bt.DJ.expand((0,Bt.DJ)(),F,g.eB.create(Bn,Bn,Bn)),Ln=Mn.min,cr=Bt.DJ.scale((0,Bt.DJ)(),Mn,Qe),qn=Bt.DJ.size((0,g.eB)(),cr);g.eB.ceil(qn,qn);const Qn=g.qY.Space(qn,[0,1,2],Float32Array),Zn=Qn.create(),zn=g.qY.create(Qn,Zn),Lr=Qn.create();Lr.fill(-1);const wr=g.qY.create(Qn,Lr),[to,Cr,Zr]=qn,Io=Zr,si=Io*Cr,Ii=(0,Bt.oI)(qn[0],Ln[0],Pe),ai=(0,Bt.oI)(qn[1],Ln[1],Pe),li=(0,Bt.oI)(qn[2],Ln[2],Pe),Vo=Qn.create(),jo=Xe,go=Math.ceil(1e5/(Math.pow(Math.pow(wn,3),3)*Qe));function Qo(Zo,ii){for(let Ai=Zo;Ai<ii;++Ai){const Xi=Tt.CD.getAt(lt,Ai),vs=ft[Xi],As=wt[Xi],xa=Ut[Xi],Ca=Pn[Ai],Ic=1/(Ca*Ca),Ac=2*Ca,Ou=Ac*Ac,da=Math.ceil(Ac*Qe),Ha=Math.floor(Qe*(vs-Ln[0])),Ru=Math.floor(Qe*(As-Ln[1])),Lu=Math.floor(Qe*(xa-Ln[2])),jc=Math.max(0,Ha-da),pi=Math.max(0,Ru-da),_s=Math.max(0,Lu-da),$i=Math.min(to,Ha+da+2),Ji=Math.min(Cr,Ru+da+2),us=Math.min(Zr,Lu+da+2);for(let Ui=jc;Ui<$i;++Ui){const gs=Ii[Ui]-vs,ls=Ui*si;for(let Qs=pi;Qs<Ji;++Qs){const Ks=ai[Qs]-As,Sa=gs*gs+Ks*Ks,ja=Qs*Io+ls;for(let ks=_s;ks<us;++ks){const Ea=li[ks]-xa,Ia=Sa+Ea*Ea;if(Ia<=Ou){const fa=(0,Ah.RL)(Ia*Ic*-jo),ra=ks+ja;Zn[ra]+=fa,fa>Vo[ra]&&(Vo[ra]=fa,Lr[ra]=Jt?Jt[Ai]:Ai)}}}}}}function $o(){return($o=(0,r.A)(function*(){for(let Zo=0;Zo<gn;Zo+=go)Qo(Zo,Math.min(Zo+go,gn)),oe.shouldUpdate&&(yield oe.update({message:"filling density grid",current:Zo,max:gn}))})).apply(this,arguments)}yield function Ko(){return $o.apply(this,arguments)}();const fi=g.$I.identity();return g.$I.fromScaling(fi,g.eB.create(Pe,Pe,Pe)),g.$I.setTranslation(fi,Mn.min),{field:zn,idField:wr,transform:fi,radiusFactor:1,resolution:Pe,maxRadius:wn}}),Sl.apply(this,arguments)}const Gc={resolution:v.t.Numeric(1,{min:.1,max:20,step:.1},{description:"Grid resolution/cell spacing.",...Jn.iy.CustomQualityParamInfo}),radiusOffset:v.t.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:v.t.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."}),...Gr.$J};function Sf(oe,x){const F=oe.maxTextureSize/3;return F*F/Math.max(1,x?x.units.length/16:1)}function Ef(oe,x,F,z){const{position:me,boundary:Pe,radius:Ge}=(0,Gr.LT)(oe,x,F,z),Xe=(0,Gr.FC)(Pe.box,z);return R.YZ.create("Gaussian Density",function(){var Qe=(0,r.A)(function*(lt){return yield Cf(lt,me,Pe.box,Ge,Xe)});return function(lt){return Qe.apply(this,arguments)}}())}v.t.getDefaultValues(Gc);var xc=n(6165),If=n(799),Af=n(8187),Tu=n(4992),Pf=n(6280),Bu=n(7187);const Tf={...Gc,...Jn.uE,ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),tryUseGpu:v.t.Boolean(!0),includeParent:v.t.Boolean(!1,{isHidden:!0})},El={...tr.Te,...tr.ii,...Tf},Bf={...ti.EN,...ti.Hj,...Tf};function Df(oe){return oe.extensions.colorBufferFloat&&oe.extensions.textureFloat&&oe.extensions.textureFloatLinear&&oe.extensions.blendMinMax&&oe.extensions.drawBuffers}function Cc(oe,x,F){if(x.resolution>1)return!1;const z=F.maxTextureSize/3,{areaCells:me,maxAreaCells:Pe}=(0,Gr.Dt)(oe.boundary.box,x.resolution,z*z);return me<Pe}function Oh(oe,x,F,z){return F.tryUseGpu&&z&&Df(z)&&Cc(x,F,z)?function Vh(oe){return(0,tr.O$)({defaultProps:v.t.getDefaultValues(El),createGeometry:Uh,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0),F.smoothColors.name!==z.smoothColors.name?x.updateColor=!0:"on"===F.smoothColors.name&&"on"===z.smoothColors.name&&(F.smoothColors.params.resolutionFactor!==z.smoothColors.params.resolutionFactor&&(x.updateColor=!0),F.smoothColors.params.sampleStride!==z.smoothColors.params.sampleStride&&(x.updateColor=!0))},mustRecreate:(x,F,z)=>!F.tryUseGpu||!z||!Cc(x.structure,F,z),processValues:(x,F,z,me,Pe)=>{const{resolution:Ge,colorTexture:Xe}=F.meta,Qe=(0,Jn.Y0)(z.smoothColors,me.color.preferSmoothing,Ge);Qe&&Pe&&((0,Pf._i)(x,Qe.resolution,Qe.stride,Pe,Xe),F.meta.colorTexture=x.tColorGrid.ref.value)},dispose:x=>{var F;x.vertexTexture.ref.value.destroy(),x.groupTexture.ref.value.destroy(),x.normalTexture.ref.value.destroy(),x.doubleBuffer.destroy(),null===(F=x.meta.colorTexture)||void 0===F||F.destroy()}},oe)}(oe):function wh(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(El),createGeometry:Lh,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0),F.smoothColors.name!==z.smoothColors.name?x.updateColor=!0:"on"===F.smoothColors.name&&"on"===z.smoothColors.name&&(F.smoothColors.params.resolutionFactor!==z.smoothColors.params.resolutionFactor&&(x.updateColor=!0),F.smoothColors.params.sampleStride!==z.smoothColors.params.sampleStride&&(x.updateColor=!0))},mustRecreate:(x,F,z)=>F.tryUseGpu&&!!z&&Cc(x.structure,F,z),processValues:(x,F,z,me,Pe)=>{const{resolution:Ge,colorTexture:Xe}=F.meta,Qe=(0,Jn.Y0)(z.smoothColors,me.color.preferSmoothing,Ge);Qe&&((0,Tu.XP)(x,Qe.resolution,Qe.stride,Pe,Xe),F.meta.colorTexture=x.tColorGrid.ref.value)},dispose:x=>{var F;null===(F=x.meta.colorTexture)||void 0===F||F.destroy()}},oe)}(oe)}function Rh(oe,x,F,z){return F.tryUseGpu&&z&&Df(z)&&Cc(x,F,z)?function zh(oe){return(0,ti.hJ)({defaultProps:v.t.getDefaultValues(Bf),createGeometry:Gh,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0),F.smoothColors.name!==z.smoothColors.name?x.updateColor=!0:"on"===F.smoothColors.name&&"on"===z.smoothColors.name&&(F.smoothColors.params.resolutionFactor!==z.smoothColors.params.resolutionFactor&&(x.updateColor=!0),F.smoothColors.params.sampleStride!==z.smoothColors.params.sampleStride&&(x.updateColor=!0))},mustRecreate:(x,F,z)=>!F.tryUseGpu||!z||!Cc(x,F,z),processValues:(x,F,z,me,Pe)=>{const{resolution:Ge,colorTexture:Xe}=F.meta,Qe=(0,Jn.Y0)(z.smoothColors,me.color.preferSmoothing,Ge);Qe&&Pe&&((0,Pf._i)(x,Qe.resolution,Qe.stride,Pe,Xe),F.meta.colorTexture=x.tColorGrid.ref.value)},dispose:x=>{var F;x.vertexTexture.ref.value.destroy(),x.groupTexture.ref.value.destroy(),x.normalTexture.ref.value.destroy(),x.doubleBuffer.destroy(),null===(F=x.meta.colorTexture)||void 0===F||F.destroy()}},oe)}(oe):function Nh(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(Bf),createGeometry:Fh,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.smoothColors.name!==z.smoothColors.name?x.updateColor=!0:"on"===F.smoothColors.name&&"on"===z.smoothColors.name&&(F.smoothColors.params.resolutionFactor!==z.smoothColors.params.resolutionFactor&&(x.updateColor=!0),F.smoothColors.params.sampleStride!==z.smoothColors.params.sampleStride&&(x.updateColor=!0))},mustRecreate:(x,F,z)=>F.tryUseGpu&&!!z&&Cc(x,F,z),processValues:(x,F,z,me,Pe)=>{const{resolution:Ge,colorTexture:Xe}=F.meta,Qe=(0,Jn.Y0)(z.smoothColors,me.color.preferSmoothing,Ge);Qe&&((0,Tu.XP)(x,Qe.resolution,Qe.stride,Pe,Xe),F.meta.colorTexture=x.tColorGrid.ref.value)},dispose:x=>{var F;null===(F=x.meta.colorTexture)||void 0===F||F.destroy()}},oe)}(oe)}function Lh(oe,x,F,z,me,Pe){return Il.apply(this,arguments)}function Il(){return Il=(0,r.A)(function*(oe,x,F,z,me,Pe){const{smoothness:Ge}=me,{transform:Xe,field:Qe,idField:lt,radiusFactor:ft,resolution:wt,maxRadius:Ut}=yield Ef(F,x,z.size,me).runInContext(oe.runtime),Jt={isoLevel:Math.exp(-Ge)/ft,scalarField:Qe,idField:lt},gn=yield(0,xc.O)(Jt,Pe).runAsChild(oe.runtime);gn.meta.resolution=wt,rr.e.transform(gn,Xe),oe.webgl&&!oe.webgl.isWebGL2?(rr.e.uniformTriangleGroup(gn),Bu.IQ.updateIfChanged(gn.varyingGroup,!1)):Bu.IQ.updateIfChanged(gn.varyingGroup,!0);const Pn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,Ut);return gn.setBoundingSphere(Pn),gn}),Il.apply(this,arguments)}function Fh(oe,x,F,z,me){return Al.apply(this,arguments)}function Al(){return Al=(0,r.A)(function*(oe,x,F,z,me){const{smoothness:Pe}=z,{transform:Ge,field:Xe,idField:Qe,radiusFactor:lt,resolution:ft,maxRadius:wt}=yield function Bh(oe,x,F){const{position:z,boundary:me,radius:Pe}=(0,Gr.oc)(oe,x,F),Ge=(0,Gr.FC)(me.box,F);return R.YZ.create("Gaussian Density",function(){var Xe=(0,r.A)(function*(Qe){return yield Cf(Qe,z,me.box,Pe,Ge)});return function(Qe){return Xe.apply(this,arguments)}}())}(x,F.size,z).runInContext(oe.runtime),Ut={isoLevel:Math.exp(-Pe)/lt,scalarField:Xe,idField:Qe},Jt=yield(0,xc.O)(Ut,me).runAsChild(oe.runtime);Jt.meta.resolution=ft,rr.e.transform(Jt,Ge),oe.webgl&&!oe.webgl.isWebGL2?(rr.e.uniformTriangleGroup(Jt),Bu.IQ.updateIfChanged(Jt.varyingGroup,!1)):Bu.IQ.updateIfChanged(Jt.varyingGroup,!0);const gn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,wt);return Jt.setBoundingSphere(gn),Jt}),Al.apply(this,arguments)}const Sc="gaussian-surface";function Uh(oe,x,F,z,me,Pe){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,r.A)(function*(oe,x,F,z,me,Pe){if(!oe.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");se.g$&&oe.webgl.timer.mark("createGaussianSurfaceTextureMesh");const{namedTextures:Ge,resources:Xe,extensions:{colorBufferFloat:Qe,textureFloat:lt,colorBufferHalfFloat:ft,textureHalfFloat:wt}}=oe.webgl;Ge[Sc]||(Ge[Sc]=ft&&wt?Xe.texture("image-float16","rgba","fp16","linear"):Qe&&lt?Xe.texture("image-float32","rgba","float","linear"):Xe.texture("image-uint8","rgba","ubyte","linear"));const Ut=yield function Th(oe,x,F,z,me,Pe,Ge){const{position:Xe,boundary:Qe,radius:lt}=(0,Gr.LT)(oe,x,F,me),ft=(0,Gr.FC)(Qe.box,me,Sf(Pe,oe));return R.YZ.create("Gaussian Density",function(){var wt=(0,r.A)(function*(Ut){return Cl(Pe,Xe,Qe.box,lt,z,ft,Ge)});return function(Ut){return wt.apply(this,arguments)}}())}(F,x,z.size,!0,me,oe.webgl,Ge[Sc]).runInContext(oe.runtime),Jt=Math.exp(-me.smoothness)/Ut.radiusFactor,gn=g.eB.create(0,1,2),Pn=Pe?.doubleBuffer.get(),wn=(0,Af._)(oe.webgl,Ut.texture,Ut.gridDim,Ut.gridTexDim,Ut.gridTexScale,Ut.transform,Jt,!1,!0,gn,!0,Pn?.vertex,Pn?.group,Pn?.normal);se.g$&&oe.webgl.timer.markEnd("createGaussianSurfaceTextureMesh");const Bn=x.elements.length,Mn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,Ut.maxRadius),Ln=If.X.create(wn.vertexCount,Bn,wn.vertexTexture,wn.groupTexture,wn.normalTexture,Mn,Pe);return Ln.meta.resolution=Ut.resolution,Ln.meta.webgl=oe.webgl,Ln}),Pl.apply(this,arguments)}function Gh(oe,x,F,z,me){return Tl.apply(this,arguments)}function Tl(){return Tl=(0,r.A)(function*(oe,x,F,z,me){if(!oe.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");se.g$&&oe.webgl.timer.mark("createStructureGaussianSurfaceTextureMesh");const{namedTextures:Pe,resources:Ge,extensions:{colorBufferFloat:Xe,textureFloat:Qe,colorBufferHalfFloat:lt,textureHalfFloat:ft}}=oe.webgl;Pe[Sc]||(Pe[Sc]=lt&&ft?Ge.texture("image-float16","rgba","fp16","linear"):Xe&&Qe?Ge.texture("image-float32","rgba","float","linear"):Ge.texture("image-uint8","rgba","ubyte","linear"));const wt=yield function Mh(oe,x,F,z,me,Pe){const{box:Ge}=oe.lookup3d.boundary,{position:Xe,boundary:Qe,radius:lt}=(0,Gr.oc)(oe,x,z),ft=(0,Gr.FC)(Qe.box,z);return R.YZ.create("Gaussian Density",function(){var wt=(0,r.A)(function*(Ut){return Cl(me,Xe,Ge,lt,F,ft,Pe)});return function(Ut){return wt.apply(this,arguments)}}())}(x,F.size,!0,z,oe.webgl,Pe[Sc]).runInContext(oe.runtime),Ut=Math.exp(-z.smoothness)/wt.radiusFactor,Jt=g.eB.create(0,1,2),gn=me?.doubleBuffer.get(),Pn=(0,Af._)(oe.webgl,wt.texture,wt.gridDim,wt.gridTexDim,wt.gridTexScale,wt.transform,Ut,!1,!0,Jt,!0,gn?.vertex,gn?.group,gn?.normal);se.g$&&oe.webgl.timer.markEnd("createStructureGaussianSurfaceTextureMesh");const wn=x.elementCount,Bn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,wt.maxRadius),Mn=If.X.create(Pn.vertexCount,wn,Pn.vertexTexture,Pn.groupTexture,Pn.normalTexture,Bn,me);return Mn.meta.resolution=wt.resolution,Mn.meta.webgl=oe.webgl,Mn}),Tl.apply(this,arguments)}var za=n(5315);function kh(oe,x,F,z,me,Pe){return Bl.apply(this,arguments)}function Bl(){return Bl=(0,r.A)(function*(oe,x,F,z,me,Pe){const{smoothness:Ge}=me,{transform:Xe,field:Qe,idField:lt,maxRadius:ft}=yield Ef(F,x,z.size,me).runInContext(oe.runtime),wt={isoLevel:Math.exp(-Ge),scalarField:Qe,idField:lt},Ut=yield(0,xc.e)(wt,Pe).runAsChild(oe.runtime);za.q.transform(Ut,Xe);const Jt=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,ft);return Ut.setBoundingSphere(Jt),Ut}),Bl.apply(this,arguments)}const Mf={...tr.zj,...Gc,sizeFactor:v.t.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:v.t.Boolean(!1),ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),includeParent:v.t.Boolean(!1,{isHidden:!0})};function Hh(oe){return(0,tr.zK)({defaultProps:v.t.getDefaultValues(Mf),createGeometry:kh,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0)}},oe)}const Of={"gaussian-surface-mesh":(oe,x)=>(0,vn.T)("Gaussian surface mesh",oe,x,Oh),"structure-gaussian-surface-mesh":(oe,x)=>(0,pr.Kp)("Structure-Gaussian surface mesh",oe,x,Rh),"gaussian-surface-wireframe":(oe,x)=>(0,vn.T)("Gaussian surface wireframe",oe,x,Hh)},Rf={...El,...Mf,visuals:v.t.MultiSelect(["gaussian-surface-mesh"],v.t.objectToOptions(Of)),bumpFrequency:v.t.Numeric(1,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},Qh=(0,pr.GT)({name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:function Wh(oe,x){return dr.YL.createMulti("Gaussian Surface",oe,x,pr.J1,Of)},getParams:function jh(oe,x){return Rf},defaultValues:v.t.getDefaultValues(Rf),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:oe=>oe.elementCount>0});var Dl=n(7377);const Lf={...ti.ip,background:v.t.Boolean(!1),backgroundMargin:v.t.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:v.t.Color(_e.s.black),backgroundOpacity:v.t.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:v.t.Numeric(.25,{min:0,max:.5,step:.01}),level:v.t.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),chainScale:v.t.Numeric(10,{min:0,max:20,step:.1}),residueScale:v.t.Numeric(1,{min:0,max:20,step:.1}),elementScale:v.t.Numeric(.5,{min:0,max:20,step:.1})};function Kh(oe){return(0,ti.Go)({defaultProps:v.t.getDefaultValues(Lf),createGeometry:Zh,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{x.createGeometry=F.level!==z.level||"chain"===F.level&&F.chainScale!==z.chainScale||"residue"===F.level&&F.residueScale!==z.residueScale||"element"===F.level&&F.elementScale!==z.elementScale||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant}},oe)}function Zh(oe,x,F,z,me){switch(z.level){case"chain":return function Yh(oe,x,F,z,me){const Pe=Je.iZ.Location.create(x),{units:Ge,serialMapping:Xe}=x,{auth_asym_id:Qe,label_asym_id:lt}=Je.StructureProperties.chain,{cumulativeUnitElementCount:ft}=Xe,wt=Ge.length,{chainScale:Ut}=z,Jt=Dl.t.create(z,wt,wt/2,me);for(let gn=0,Pn=Ge.length;gn<Pn;++gn){const wn=Ge[gn];Pe.unit=wn,Pe.element=wn.elements[0];const{center:Bn,radius:Mn}=wn.lookup3d.boundary.sphere;g.eB.transformMat4(zs,Bn,wn.conformation.operator.matrix);const Ln=Qe(Pe),cr=lt(Pe);Jt.add(Ln===cr?cr:`${cr} [${Ln}]`,zs[0],zs[1],zs[2],Mn,Ut,ft[gn])}return Jt.getText()}(0,x,0,z,me);case"residue":return function Xh(oe,x,F,z,me){const Pe=Je.iZ.Location.create(x),{units:Ge,serialMapping:Xe}=x,{label_comp_id:Qe}=Je.StructureProperties.atom,{auth_seq_id:lt}=Je.StructureProperties.residue,{cumulativeUnitElementCount:ft}=Xe,wt=2*x.polymerResidueCount,{residueScale:Ut}=z,Jt=Dl.t.create(z,wt,wt/2,me);for(let gn=0,Pn=Ge.length;gn<Pn;++gn){const wn=Ge[gn],Bn=wn.conformation,{elements:Mn}=wn;Pe.unit=wn,Pe.element=wn.elements[0];const Ln=wn.model.atomicHierarchy.residueAtomSegments.index,cr=ft[gn];let qn=0;const Qn=Mn.length;for(;qn<Qn;){const Zn=qn,zn=Ln[Mn[qn]];for(qn++;qn<Qn&&Ln[Mn[qn]]===zn;)qn++;zc.reset();for(let Io=Zn;Io<qn;Io++)Bn.position(Mn[Io],zs),zc.includePosition(zs);zc.finishedIncludeStep();for(let Io=Zn;Io<qn;Io++)Bn.position(Mn[Io],zs),zc.radiusPosition(zs);Pe.element=Mn[Zn];const{center:Lr,radius:wr}=zc.getSphere(),to=lt(Pe),Zr=`${Qe(Pe)} ${to}`;Jt.add(Zr,Lr[0],Lr[1],Lr[2],wr,Ut,cr+Zn)}}return Jt.getText()}(0,x,0,z,me);case"element":return function $h(oe,x,F,z,me){const Pe=Je.iZ.Location.create(x),{units:Ge,serialMapping:Xe}=x,{label_atom_id:Qe,label_alt_id:lt}=Je.StructureProperties.atom,{cumulativeUnitElementCount:ft}=Xe,wt=F.size,Ut=x.elementCount,{elementScale:Jt}=z,gn=Dl.t.create(z,Ut,Ut/2,me);for(let Pn=0,wn=Ge.length;Pn<wn;++Pn){const Bn=Ge[Pn],Mn=Bn.conformation,{elements:Ln}=Bn;Pe.unit=Bn;const cr=ft[Pn],qn=bi(x,Bn,{...z,traceOnly:!1});for(let Qn=0,Zn=Ln.length;Qn<Zn;Qn++){if(qn&&qn(Ln[Qn]))continue;Pe.element=Ln[Qn],Mn.position(Pe.element,zs);const zn=Qe(Pe),Lr=lt(Pe);gn.add(Lr?`${zn}%${Lr}`:zn,zs[0],zs[1],zs[2],wt.size(Pe),Jt,cr+Qn)}}return gn.getText()}(0,x,F,z,me)}}const zs=(0,g.eB)(),zc=new xn.Z("98"),wf={"label-text":(oe,x)=>(0,pr.Kp)("Label text",oe,x,Kh)},Ff={...Lf,visuals:v.t.MultiSelect(["label-text"],v.t.objectToOptions(wf))},e0=(0,pr.GT)({name:"label",label:"Label",description:"Displays labels.",factory:function qh(oe,x){const F=dr.YL.createMulti("Label",oe,x,pr.J1,wf);return F.setState({pickable:!1,markerActions:xr.xi.None}),F},getParams:function Jh(oe,x){return Ff},defaultValues:v.t.getDefaultValues(Ff),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:oe=>oe.elementCount>0});var Ml=n(6639);const Ol={probeRadius:v.t.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:v.t.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...Jn.iy.CustomQualityParamInfo}),probePositions:v.t.Numeric(36,{min:12,max:90,step:1},{description:"Number of positions tested for probe target intersection.",...Jn.iy.CustomQualityParamInfo})};function Rl(){return Rl=(0,r.A)(function*(oe,x,F,z,me,Pe){let Ge=-1;function Xe(pi,_s,$i,Ji,us){if(-1!==Ge){const Ui=Ge;if(Ui!==Ji&&Ui!==us&&Qe(Ui,pi,_s,$i))return Ui;Ge=-1}for(let Ui=0,gs=to.count;Ui<gs;++Ui){const ls=Tt.CD.getAt(Cr,to.indices[Ui]);if(ls!==Ji&&ls!==us&&Qe(ls,pi,_s,$i))return Ge=ls,ls}return-1}function Qe(pi,_s,$i,Ji){const us=Ii[pi],Ui=Zr[pi]-_s,gs=Io[pi]-$i,ls=wo[pi]-Ji;return Ui*Ui+gs*gs+ls*ls<us*us}function lt(pi,_s){for(let $i=pi;$i<_s;++$i){const Ji=Tt.CD.getAt(Cr,$i),us=Zr[Ji],Ui=Io[Ji],gs=wo[Ji],ls=Ii[Ji],Qs=ls*ls;wr.find(us,Ui,gs,ls);const Ks=Math.ceil(ls*Zn),Sa=Math.floor(Zn*(us-jo)),ja=Math.floor(Zn*(Ui-go)),ks=Math.floor(Zn*(gs-Qo)),Ea=Math.max(0,Sa-Ks),Ia=Math.max(0,ja-Ks),fa=Math.max(0,ks-Ks),ra=Math.min(fi,Sa+Ks+2),Wc=Math.min(Zo,ja+Ks+2),wu=Math.min(ii,ks+Ks+2);for(let Wa=Ea;Wa<ra;++Wa){const Pc=Ac[Wa]-us,ql=Wa*vs;for(let Tc=Ia;Tc<Wc;++Tc){const Qc=Ou[Tc]-Ui,ed=Pc*Pc+Qc*Qc,td=Tc*Ai+ql;for(let Bc=fa;Bc<wu;++Bc){const Aa=da[Bc]-gs,Dc=ed+Aa*Aa;if(Dc<Qs){const Qa=Bc+td;la[Qa]<0&&(la[Qa]*=-1);const Ka=Math.sqrt(Dc),Za=ls/Ka;if(-1===Xe(Pc*Za+us,Qc*Za+Ui,Aa*Za+gs,Ji,-1)){const Oc=ls-Ka;Oc<la[Qa]&&(la[Qa]=Oc,Ic[Qa]=si[$i])}}}}}}}function wt(){return(wt=(0,r.A)(function*(){for(let pi=0;pi<ai;pi+=Ha)lt(pi,Math.min(pi+Ha,ai)),oe.shouldUpdate&&(yield oe.update({message:"projecting points",current:pi,max:ai}))})).apply(this,arguments)}const Ut=(0,g.eB)(),Jt=(0,g.eB)(),gn=(0,g.eB)(),Pn=(0,g.eB)();function wn(pi,_s){const $i=Ii[pi],Ji=Ii[_s],us=Ut[0]=Zr[_s]-Zr[pi],Ui=Ut[1]=Io[_s]-Io[pi],gs=Ut[2]=wo[_s]-wo[pi],Qs=Math.sqrt(us*us+Ui*Ui+gs*gs),Sa=$i*(($i*$i+Qs*Qs-Ji*Ji)/(2*$i*Qs));g.eB.normalize(Ut,Ut),function t0(oe,x){oe[0]=oe[1]=oe[2]=1,0!==x[0]?oe[0]=(x[1]+x[2])/-x[0]:0!==x[1]?oe[1]=(x[0]+x[2])/-x[1]:0!==x[2]&&(oe[2]=(x[0]+x[1])/-x[2])}(gn,Ut),g.eB.normalize(gn,gn),g.eB.cross(Pn,Ut,gn),g.eB.normalize(Pn,Pn);const ja=Math.sqrt($i*$i-Sa*Sa);g.eB.scale(gn,gn,ja),g.eB.scale(Pn,Pn,ja),g.eB.scale(Ut,Ut,Sa),Jt[0]=Ut[0]+Zr[pi],Jt[1]=Ut[1]+Io[pi],Jt[2]=Ut[2]+wo[pi],Ge=-1;for(let ks=0;ks<Qn;++ks){const Ea=As[ks],Ia=xa[ks],fa=Jt[0]+Ea*gn[0]+Ia*Pn[0],ra=Jt[1]+Ea*gn[1]+Ia*Pn[1],Wc=Jt[2]+Ea*gn[2]+Ia*Pn[2];if(-1===Xe(fa,ra,Wc,pi,_s)){const wu=Math.floor(Zn*(fa-jo)),Wa=Math.floor(Zn*(ra-go)),Pc=Math.floor(Zn*(Wc-Qo)),ql=Math.max(0,wu-zn),Tc=Math.max(0,Wa-zn),Qc=Math.max(0,Pc-zn),ed=Math.min(fi,wu+zn+2),td=Math.min(Zo,Wa+zn+2),Bc=Math.min(ii,Pc+zn+2);for(let Aa=ql;Aa<ed;++Aa){const Dc=fa-Ac[Aa],Qa=Aa*vs;for(let Ka=Tc;Ka<td;++Ka){const Za=ra-Ou[Ka],nd=Dc*Dc+Za*Za,rd=Ka*Ai+Qa;for(let Mc=Qc;Mc<Bc;++Mc){const Oc=Wc-da[Mc],vm=nd+Oc*Oc,od=Mc+rd,id=la[od];id>0&&vm<id*id&&(la[od]=Math.sqrt(vm),Ic[od]=si[Tt.CD.indexOf(Cr,Dc*Ut[0]+Za*Ut[1]+Oc*Ut[2]<0?_s:pi)])}}}}}}function Bn(pi,_s){for(let $i=pi;$i<_s;++$i){const Ji=Tt.CD.getAt(Cr,$i);wr.find(Zr[Ji],Io[Ji],wo[Ji],Ii[Ji]);for(let us=0,Ui=to.count;us<Ui;++us){const gs=Tt.CD.getAt(Cr,to.indices[us]);Ji<gs&&wn(Ji,gs)}}}function Ln(){return(Ln=(0,r.A)(function*(){for(let pi=0;pi<ai;pi+=Ha)Bn(pi,Math.min(pi+Ha,ai)),oe.shouldUpdate&&(yield oe.update({message:"projecting torii",current:pi,max:ai}))})).apply(this,arguments)}const{resolution:cr,probeRadius:qn,probePositions:Qn}=Pe,Zn=1/cr,zn=Math.max(5,2+Math.floor(qn*Zn)),Lr=g.eB.create(z,z,z);g.eB.scale(Lr,Lr,2);const wr=(0,Bt.Eh)(x,F,Lr),to=wr.result;null===me&&(me=wr.boundary.box);const{indices:Cr,x:Zr,y:Io,z:wo,id:si,radius:Ii}=x,ai=Tt.CD.size(Cr),li=z+cr,Vo=Bt.DJ.expand((0,Bt.DJ)(),me,g.eB.create(li,li,li)),[jo,go,Qo]=Vo.min,Ko=Bt.DJ.scale((0,Bt.DJ)(),Vo,Zn),$o=Bt.DJ.size((0,g.eB)(),Ko);g.eB.ceil($o,$o);const[fi,Zo,ii]=$o,Ai=ii,vs=Ai*Zo,{cosTable:As,sinTable:xa}=function n0(oe){let x=0;const F=2*Math.PI/oe,z=new Float32Array(oe),me=new Float32Array(oe);for(let Pe=0;Pe<oe;Pe++)z[Pe]=Math.cos(x),me[Pe]=Math.sin(x),x+=F;return{cosTable:z,sinTable:me}}(Qn),Ca=g.qY.Space($o,[0,1,2],Float32Array),la=Ca.create(),Ic=Ca.create();la.fill(-1001),Ic.fill(-1);const Ac=(0,Bt.oI)(fi,jo,cr),Ou=(0,Bt.oI)(Zo,go,cr),da=(0,Bt.oI)(ii,Qo,cr),Ha=Math.ceil(1e5/(Math.pow(Math.pow(z,3),3)*Zn));yield function ft(){return wt.apply(this,arguments)}(),yield function Mn(){return Ln.apply(this,arguments)}();const Ru=g.qY.create(Ca,la),Lu=g.qY.create(Ca,Ic),jc=Ml.$.identity();return Ml.$.fromScaling(jc,g.eB.create(cr,cr,cr)),Ml.$.setTranslation(jc,Vo.min),{field:Ru,idField:Lu,transform:jc,resolution:cr,maxRadius:z}}),Rl.apply(this,arguments)}function Nf(oe,x,F,z){const{position:me,boundary:Pe,maxRadius:Ge}=function o0(oe,x,F,z){const{probeRadius:me}=z,{position:Pe,boundary:Ge,radius:Xe}=(0,Gr.LT)(oe,x,F,z),{indices:Qe}=Pe,lt=Tt.CD.size(Qe),ft=new Float32Array(Tt.CD.end(Qe));let wt=0;for(let Ut=0;Ut<lt;++Ut){const Jt=Tt.CD.getAt(Qe,Ut),gn=Xe(Jt);wt<gn&&(wt=gn),ft[Jt]=gn+me}return{position:{...Pe,radius:ft},boundary:Ge,maxRadius:wt}}(oe,x,F,z),Xe=(0,Gr.FC)(Pe.box,z);return R.YZ.create("Molecular Surface",function(){var Qe=(0,r.A)(function*(lt){return yield Uf(lt,me,Pe,Ge,Pe.box,Xe)});return function(lt){return Qe.apply(this,arguments)}}())}function Uf(oe,x,F,z,me,Pe){return Ll.apply(this,arguments)}function Ll(){return Ll=(0,r.A)(function*(oe,x,F,z,me,Pe){return function r0(oe,x,F,z,me,Pe){return Rl.apply(this,arguments)}(oe,x,F,z,me,Pe)}),Ll.apply(this,arguments)}v.t.getDefaultValues(Ol);const wl={...tr.Te,...Ol,...Gr.$J,...Jn.uE};function a0(oe,x,F,z,me,Pe){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,r.A)(function*(oe,x,F,z,me,Pe){const{transform:Ge,field:Xe,idField:Qe,resolution:lt,maxRadius:ft}=yield Nf(F,x,z.size,me).runInContext(oe.runtime),wt={isoLevel:me.probeRadius,scalarField:Xe,idField:Qe},Ut=yield(0,xc.O)(wt,Pe).runAsChild(oe.runtime);if(me.includeParent){const gn=Math.ceil(2/me.resolution);rr.e.smoothEdges(Ut,{iterations:gn,maxNewEdgeLength:Math.sqrt(2)})}rr.e.transform(Ut,Ge),oe.webgl&&!oe.webgl.isWebGL2?(rr.e.uniformTriangleGroup(Ut),G.IQ.updateIfChanged(Ut.varyingGroup,!1)):G.IQ.updateIfChanged(Ut.varyingGroup,!0);const Jt=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,ft);return Ut.setBoundingSphere(Jt),Ut.meta.resolution=lt,Ut}),Fl.apply(this,arguments)}function c0(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(wl),createGeometry:a0,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.probeRadius!==z.probeRadius&&(x.createGeometry=!0),F.probePositions!==z.probePositions&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0),F.smoothColors.name!==z.smoothColors.name?x.updateColor=!0:"on"===F.smoothColors.name&&"on"===z.smoothColors.name&&(F.smoothColors.params.resolutionFactor!==z.smoothColors.params.resolutionFactor&&(x.updateColor=!0),F.smoothColors.params.sampleStride!==z.smoothColors.params.sampleStride&&(x.updateColor=!0))},processValues:(x,F,z,me,Pe)=>{const{resolution:Ge,colorTexture:Xe}=F.meta,Qe=(0,Jn.Y0)(z.smoothColors,me.color.preferSmoothing,Ge);Qe&&((0,Tu.XP)(x,Qe.resolution,Qe.stride,Pe,Xe),F.meta.colorTexture=x.tColorGrid.ref.value)},dispose:x=>{var F;null===(F=x.meta.colorTexture)||void 0===F||F.destroy()}},oe)}function u0(oe,x,F,z,me){return Nl.apply(this,arguments)}function Nl(){return Nl=(0,r.A)(function*(oe,x,F,z,me){const{transform:Pe,field:Ge,idField:Xe,resolution:Qe,maxRadius:lt}=yield function s0(oe,x,F){const{position:z,boundary:me,maxRadius:Pe}=function i0(oe,x,F){const{probeRadius:z}=F,{position:me,boundary:Pe,radius:Ge}=(0,Gr.oc)(oe,x,F),{indices:Xe}=me,Qe=Tt.CD.size(Xe),lt=new Float32Array(Tt.CD.end(Xe));let ft=0;for(let wt=0;wt<Qe;++wt){const Ut=Tt.CD.getAt(Xe,wt),Jt=Ge(Ut);ft<Jt&&(ft=Jt),lt[Ut]=Jt+z}return{position:{...me,radius:lt},boundary:Pe,maxRadius:ft}}(oe,x,F),Ge=(0,Gr.FC)(me.box,F);return R.YZ.create("Molecular Surface",function(){var Xe=(0,r.A)(function*(Qe){return yield Uf(Qe,z,me,Pe,me.box,Ge)});return function(Qe){return Xe.apply(this,arguments)}}())}(x,F.size,z).runInContext(oe.runtime),ft={isoLevel:z.probeRadius,scalarField:Ge,idField:Xe},wt=yield(0,xc.O)(ft,me).runAsChild(oe.runtime);if(z.includeParent){const Jt=Math.ceil(2/z.resolution);rr.e.smoothEdges(wt,{iterations:Jt,maxNewEdgeLength:Math.sqrt(2)})}rr.e.transform(wt,Pe),oe.webgl&&!oe.webgl.isWebGL2?(rr.e.uniformTriangleGroup(wt),G.IQ.updateIfChanged(wt.varyingGroup,!1)):G.IQ.updateIfChanged(wt.varyingGroup,!0);const Ut=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,lt);return wt.setBoundingSphere(Ut),wt.meta.resolution=Qe,wt}),Nl.apply(this,arguments)}function l0(oe){return(0,ti.wA)({defaultProps:v.t.getDefaultValues(wl),createGeometry:u0,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.probeRadius!==z.probeRadius&&(x.createGeometry=!0),F.probePositions!==z.probePositions&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0),F.smoothColors.name!==z.smoothColors.name?x.updateColor=!0:"on"===F.smoothColors.name&&"on"===z.smoothColors.name&&(F.smoothColors.params.resolutionFactor!==z.smoothColors.params.resolutionFactor&&(x.updateColor=!0),F.smoothColors.params.sampleStride!==z.smoothColors.params.sampleStride&&(x.updateColor=!0))},processValues:(x,F,z,me,Pe)=>{const{resolution:Ge,colorTexture:Xe}=F.meta,Qe=(0,Jn.Y0)(z.smoothColors,me.color.preferSmoothing,Ge);Qe&&((0,Tu.XP)(x,Qe.resolution,Qe.stride,Pe,Xe),F.meta.colorTexture=x.tColorGrid.ref.value)},dispose:x=>{var F;null===(F=x.meta.colorTexture)||void 0===F||F.destroy()}},oe)}const Vf={...tr.zj,...Ol,...Gr.$J,sizeFactor:v.t.Numeric(1.5,{min:0,max:10,step:.1})};function d0(oe,x,F,z,me,Pe){return Ul.apply(this,arguments)}function Ul(){return Ul=(0,r.A)(function*(oe,x,F,z,me,Pe){const{transform:Ge,field:Xe,idField:Qe,maxRadius:lt}=yield Nf(F,x,z.size,me).runInContext(oe.runtime),ft={isoLevel:me.probeRadius,scalarField:Xe,idField:Qe},wt=yield(0,xc.e)(ft,Pe).runAsChild(oe.runtime);za.q.transform(wt,Ge);const Ut=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,lt);return wt.setBoundingSphere(Ut),wt}),Ul.apply(this,arguments)}function f0(oe){return(0,tr.zK)({defaultProps:v.t.getDefaultValues(Vf),createGeometry:d0,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.probeRadius!==z.probeRadius&&(x.createGeometry=!0),F.probePositions!==z.probePositions&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0)}},oe)}const Gf={"molecular-surface-mesh":(oe,x)=>(0,vn.T)("Molecular surface mesh",oe,x,c0),"structure-molecular-surface-mesh":(oe,x)=>(0,pr.Kp)("Structure Molecular surface mesh",oe,x,l0),"molecular-surface-wireframe":(oe,x)=>(0,vn.T)("Molecular surface wireframe",oe,x,f0)},zf={...wl,...Vf,visuals:v.t.MultiSelect(["molecular-surface-mesh"],v.t.objectToOptions(Gf)),bumpFrequency:v.t.Numeric(1,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},h0=(0,pr.GT)({name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:function p0(oe,x){return dr.YL.createMulti("Molecular Surface",oe,x,pr.J1,Gf)},getParams:function m0(oe,x){return zf},defaultValues:v.t.getDefaultValues(zf),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:oe=>oe.elementCount>0}),kf={...tr.Te,sizeFactor:v.t.Numeric(1,{min:0,max:2,step:.1}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo)};function g0(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(kf),createGeometry:v0,createLocationIterator:_0,getLoci:b0,eachLocation:x0,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail}},oe)}function v0(oe,x,F,z,me,Pe){if(!function y0(oe){if(Je.Nf.Traits.is(oe.traits,Je.Nf.Trait.MultiChain)||Je.Nf.Traits.is(oe.traits,Je.Nf.Trait.Partitioned))return!1;if(Je.Nf.isCoarse(oe))return!0;if(0===oe.elements.length)return!1;const F=oe.model.atomicHierarchy.derived.residue.moleculeType[oe.residueIndex[oe.elements[0]]];return!(3===F||2===F)}(x))return rr.e.createEmpty(Pe);const{detail:Ge,sizeFactor:Xe}=me,lt=lr.P.createState(256,128,Pe),ft=x.principalAxes.boxAxes,{origin:wt,dirA:Ut,dirB:Jt}=ft,gn=Bt.n.size((0,g.eB)(),ft);g.eB.scale(gn,gn,Xe/2);const Pn=g.eB.create(gn[2],gn[1],gn[0]);lt.currentGroup=0,(0,af.P)(lt,wt,Ut,Jt,Pn,Ge+1);const wn=lr.P.getMesh(lt),Bn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return wn.setBoundingSphere(Bn),wn}function _0(oe){const{group:x,structure:F}=oe,me=x.units.length,Pe=Je.iZ.Location.create(F);return(0,oo.iQ)(1,me,1,(Xe,Qe)=>{const lt=x.units[Qe];return Pe.unit=lt,Pe.element=lt.elements[Xe],Pe})}function b0(oe,x,F){const{objectId:z,instanceId:me}=oe;if(F===z){const{structure:Pe,group:Ge}=x,Xe=Ge.units[me],Qe=Tt.CD.ofBounds(0,Xe.elements.length);return Je.iZ.Loci(Pe,[{unit:Xe,indices:Qe}])}return Rn.BL}function x0(oe,x,F){let z=!1;if(!Je.iZ.Loci.is(oe))return!1;const{structure:me,group:Pe}=x;if(!Je.oE.areEquivalent(oe.structure,me))return!1;const Ge=Pe.elements.length;for(const Xe of oe.elements){const Qe=Pe.unitIndexMap.get(Xe.unit.id);void 0!==Qe&&Tt.CD.size(Xe.indices)===Ge&&F(Tt.IX.ofSingleton(Qe))&&(z=!0)}return z}const Hf={"orientation-ellipsoid-mesh":(oe,x)=>(0,vn.T)("Orientation ellipsoid mesh",oe,x,g0)},jf={...kf,visuals:v.t.MultiSelect(["orientation-ellipsoid-mesh"],v.t.objectToOptions(Hf)),bumpFrequency:v.t.Numeric(1,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},E0=(0,pr.GT)({name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:function S0(oe,x){return dr.YL.createMulti("Orientation",oe,x,pr.J1,Hf)},getParams:function C0(oe,x){return jf},defaultValues:v.t.getDefaultValues(jf),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.elementCount>0});var Vl=n(5299);const I0=ce.Gm.add3,A0=ce.Gm.add;var Gl;!function(oe){oe.create=function x(F=2048,z=1024,me){const Pe=ce.Gm.create(Float32Array,3,z,me?me.centerBuffer.ref.value:F),Ge=ce.Gm.create(Float32Array,1,z,me?me.groupBuffer.ref.value:F);return{add:(Xe,Qe,lt,ft)=>{I0(Pe,Xe,Qe,lt),A0(Ge,ft)},getPoints:()=>{const Xe=ce.Gm.compact(Pe,!0),Qe=ce.Gm.compact(Ge,!0);return Vl.O.create(Xe,Qe,Pe.elementCount,me)}}}}(Gl||(Gl={}));const Wf=g.eB.add,zl={...tr.PJ,pointSizeAttenuation:v.t.Boolean(!1),ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),traceOnly:v.t.Boolean(!1),stride:v.t.Numeric(1,{min:1,max:100,step:1})};function P0(oe,x,F,z,me,Pe){const{child:Ge}=F;if(Ge&&!Ge.unitMap.get(x.id))return Vl.O.createEmpty(Pe);const Xe=x.elements,Qe=Xe.length,lt=Gl.create(Qe,Qe/10,Pe),ft=(0,g.eB)(),wt=x.conformation,Ut=bi(F,x,me),Jt=(0,g.eB)();let gn=0;if(Ut)for(let Mn=0;Mn<Qe;++Mn)Ut(Xe[Mn])||(wt.invariantPosition(Xe[Mn],ft),Wf(Jt,Jt,ft),gn+=1,lt.add(ft[0],ft[1],ft[2],Mn));else for(let Mn=0;Mn<Qe;++Mn)wt.invariantPosition(Xe[Mn],ft),Wf(Jt,Jt,ft),gn+=1,lt.add(ft[0],ft[1],ft[2],Mn);const Pn=Pe?Bt.f8.clone(Pe.boundingSphere):void 0,wn=lt.getPoints();if(0===gn)return wn;let Bn;return g.eB.scale(Jt,Jt,1/gn),Bn=Pn&&g.eB.distance(Jt,Pn.center)/Pn.radius<.1?Pn:Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor),wn.setBoundingSphere(Bn),wn}function Qf(oe){return(0,tr.fm)({defaultProps:v.t.getDefaultValues(zl),createGeometry:P0,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{x.createGeometry=F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.traceOnly!==z.traceOnly||F.stride!==z.stride}},oe)}const T0={"element-point":(oe,x)=>(0,vn.T)("Points",oe,x,Qf)},Kf={...zl},M0=(0,pr.GT)({name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:function D0(oe,x){return dr.YL.createMulti("Point",oe,x,pr.J1,T0)},getParams:function B0(oe,x){return Kf},defaultValues:v.t.getDefaultValues(Kf),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.elementCount>0}),Zf={sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),linearSegments:v.t.Numeric(8,{min:1,max:48,step:1},Jn.iy.CustomQualityParamInfo),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo)},Bs=(v.t.getDefaultValues(Zf),(0,g.eB)());function O0(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{sizeFactor:Xe,detail:Qe,linearSegments:lt,radialSegments:ft}=me,wt=lt*ft*Ge+(ft+1)*Ge*2,Ut=lr.P.createState(wt,wt/10,Pe),Jt=ju(lt),{curvePoints:gn,normalVectors:Pn,binormalVectors:wn,widthValues:Bn,heightValues:Mn}=Jt;let Ln=0;const cr=zu(x,F,{ignoreSecondaryStructure:!0});for(;cr.hasNext;){const Zn=cr.move();Ut.currentGroup=Ln;const Lr=(0,Tr.OV)(Zn.moleculeType)?tu:eu;Wu(Jt,Zn,bd,Lr);const wr=Zn.coarseBackboneFirst||Zn.first,to=Zn.coarseBackboneLast||Zn.last,Cr=z.size.size(Zn.centerPrev)*Xe,Zr=z.size.size(Zn.center)*Xe,Io=z.size.size(Zn.centerNext)*Xe;Xu(Jt,Cr,Zr,Io,Cr,Zr,Io,Lr);let wo=lt;if(Zn.initial){wo=Math.max(Math.round(lt*Lr),1);const si=lt-wo;gn.copyWithin(0,3*si),wn.copyWithin(0,3*si),Pn.copyWithin(0,3*si),Bn.copyWithin(0,3*si),Mn.copyWithin(0,3*si),g.eB.fromArray(Bs,gn,3),g.eB.normalize(Bs,g.eB.sub(Bs,Zn.p2,Bs)),g.eB.scaleAndAdd(Bs,Zn.p2,Bs,Zr*nu),g.eB.toArray(Bs,gn,0)}else Zn.final&&(wo=Math.max(Math.round(lt*(1-Lr)),1),g.eB.fromArray(Bs,gn,3*wo-3),g.eB.normalize(Bs,g.eB.sub(Bs,Zn.p2,Bs)),g.eB.scaleAndAdd(Bs,Zn.p2,Bs,Zr*nu),g.eB.toArray(Bs,gn,3*wo));!0===Zn.initial&&!0===Zn.final?(0,kr.X)(Ut,Zn.p2,2*Zr,Qe):2===ft?Pu(Ut,gn,Pn,wn,wo,Bn,Mn,0):4===ft?Iu(Ut,gn,Pn,wn,wo,Bn,Mn,0,wr,to):hl(Ut,gn,Pn,wn,wo,ft,Bn,Mn,wr,to,"elliptical"),++Ln}const qn=lr.P.getMesh(Ut),Qn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return qn.setBoundingSphere(Qn),qn}const Yf={...tr.Te,...Zf};function R0(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Yf),createGeometry:O0,createLocationIterator:x=>ia.fromGroup(x,{asSecondary:!0}),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail||F.linearSegments!==z.linearSegments||F.radialSegments!==z.radialSegments}},oe)}const Xf={"polymer-tube":(oe,x)=>(0,vn.T)("Polymer tube mesh",oe,x,R0),"polymer-gap":(oe,x)=>(0,vn.T)("Polymer gap cylinder",oe,x,ll)},$f={...Yf,...xu,sizeFactor:v.t.Numeric(.2,{min:0,max:10,step:.01}),visuals:v.t.MultiSelect(["polymer-tube","polymer-gap"],v.t.objectToOptions(Xf)),bumpFrequency:v.t.Numeric(2,{min:0,max:10,step:.1},Jn.iy.ShadingCategory)},F0=(0,pr.GT)({name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:function w0(oe,x){return dr.YL.createMulti("Putty",oe,x,pr.J1,Xf)},getParams:function L0(oe,x){const F=v.t.clone($f);let z=!1,me=!1;return x.units.forEach(Pe=>{!z&&Je.Nf.isAtomic(Pe)&&Pe.nucleotideElements.length&&(z=!0),!me&&Pe.gapElements.length&&(me=!0)}),F.visuals.defaultValue=["polymer-tube"],me&&F.visuals.defaultValue.push("polymer-gap"),F},defaultValues:v.t.getDefaultValues($f),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:oe=>oe.polymerResidueCount>0}),Jf={"element-sphere":(oe,x)=>(0,vn.T)("Sphere mesh/impostor",oe,x,et),"structure-element-sphere":(oe,x)=>(0,pr.Kp)("Structure sphere mesh/impostor",oe,x,qt)},kl={...st,bumpFrequency:v.t.Numeric(1,{min:0,max:10,step:.1},Jn.iy.ShadingCategory),visuals:v.t.MultiSelect(["element-sphere"],v.t.objectToOptions(Jf))};let Du;const V0=(0,pr.GT)({name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:function U0(oe,x){return dr.YL.createMulti("Spacefill",oe,x,pr.J1,Jf)},getParams:function N0(oe,x){return x.isCoarseGrained?(Du||(Du=v.t.clone(kl),Du.sizeFactor.defaultValue=2),Du):kl},defaultValues:v.t.getDefaultValues(kl),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:oe=>oe.elementCount>0}),Hl=Tr.I$.is;function G0(oe,x,F,z,me,Pe){if(!Je.Nf.isAtomic(x))return za.q.createEmpty(Pe);const{child:Ge}=F,Xe=Ge?.unitMap.get(x.id);if(Ge&&!Xe)return za.q.createEmpty(Pe);const Qe=Je.iZ.Location.create(F,x),lt=x.elements,ft=x.bonds,{edgeCount:wt,a:Ut,b:Jt,edgeProps:gn,offset:Pn}=ft;if(!wt)return za.q.createEmpty(Pe);const{order:wn,flags:Bn}=gn,{sizeFactor:Mn,aromaticBonds:Ln,includeTypes:cr,excludeTypes:qn,multipleBonds:Qn}=me,Zn="off"===Qn,zn="symmetric"===Qn,to=So(Tr.I$.fromNames(cr),Tr.I$.fromNames(qn),32),Cr=(0,g.eB)(),Zr=x.conformation,{elementRingIndices:Io,elementAromaticRingIndices:wo}=x.rings,si=Ln?x.resonance.delocalizedTriplets:void 0,Ii={linkCount:2*wt,referencePosition:Vo=>{let jo=Ut[Vo],go=Jt[Vo];const Qo=si?.getThirdElement(jo,go);if(void 0!==Qo)return Zr.invariantPosition(lt[Qo],Cr);jo>go&&([jo,go]=[go,jo]),Pn[jo+1]-Pn[jo]==1&&([jo,go]=[go,jo]);const Ko=wo.get(jo)||Io.get(jo);let $o=0;for(let fi=Pn[jo],Zo=Pn[jo+1];fi<Zo;++fi){const ii=Jt[fi];if(ii!==go&&ii!==jo){if(!Ko)return Zr.invariantPosition(lt[ii],Cr);{const Ai=wo.get(ii)||Io.get(ii);if(!Ai)continue;const Xi=(0,nt.u$)(Ko,Ai);Xi>$o&&($o=Xi,Zr.invariantPosition(lt[ii],Cr))}}}return $o>0?Cr:null},position:(Vo,jo,go)=>{Zr.invariantPosition(lt[Ut[go]],Vo),Zr.invariantPosition(lt[Jt[go]],jo)},style:Vo=>{const jo=wn[Vo],go=Bn[Vo];if(Hl(go,2)||Hl(go,4))return 1;if(3===jo)return Zn?0:zn?4:5;if(Ln){const Ko=Jt[Vo],$o=wo.get(Ut[Vo]),fi=wo.get(Ko),Zo=$o&&fi?(0,nt.u$)($o,fi):0;if(Hl(go,16)||Zo&&!to)return 2===Zo?8:7}return 2!==jo||Zn?0:zn?2:3},radius:Vo=>{Qe.element=lt[Ut[Vo]];const jo=z.size.size(Qe);Qe.element=lt[Jt[Vo]];const go=z.size.size(Qe);return Math.min(jo,go)*Mn},ignore:ao(F,x,me)},{lines:ai,boundingSphere:li}=(0,Vr.Yz)(oe,Ii,me,Pe);if(li)ai.setBoundingSphere(li);else if(ai.lineCount>0){const Vo=Bt.f8.expand((0,Bt.f8)(),(Xe??x).boundary.sphere,1*Mn);ai.setBoundingSphere(Vo)}return ai}const qf={...tr.zj,...Do,includeParent:v.t.Boolean(!1)};function z0(oe){return(0,tr.zK)({defaultProps:v.t.getDefaultValues(qf),createGeometry:G0,createLocationIterator:x=>Yr.fromGroup(x),getLoci:jr,eachLocation:Co,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.linkScale!==z.linkScale||F.linkSpacing!==z.linkSpacing||F.aromaticDashCount!==z.aromaticDashCount||F.dashCount!==z.dashCount||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||!(0,G.af)(F.includeTypes,z.includeTypes)||!(0,G.af)(F.excludeTypes,z.excludeTypes)||F.aromaticBonds!==z.aromaticBonds||F.multipleBonds!==z.multipleBonds;const Qe=Ge.group.units[0],lt=Xe.group.units[0];Je.Nf.isAtomic(Qe)&&Je.Nf.isAtomic(lt)&&(Yo.O.areEqual(Qe.bonds,lt.bonds)||(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0,x.updateSize=!0))}},oe)}const jl=new Je.gn.ElementBondIterator;function em(oe,x,F,z){for(jl.setElement(x,F,z);jl.hasNext;){const me=jl.move();return me.otherUnit.conformation.position(me.otherUnit.elements[me.otherIndex],oe),oe}return null}function k0(oe,x,F,z,me){const Pe=x.interUnitBonds,{edgeCount:Ge,edges:Xe}=Pe;if(!Ge)return za.q.createEmpty(me);const{sizeFactor:Qe,aromaticBonds:lt,multipleBonds:ft}=z,wt="off"===ft,Ut="symmetric"===ft,Jt=(0,g.eB)(),gn=Je.iZ.Location.create(),Pn={linkCount:Ge,referencePosition:Mn=>{const Ln=Xe[Mn];let cr,qn,Qn,Zn;if(Ln.unitA<Ln.unitB)cr=x.unitMap.get(Ln.unitA),qn=x.unitMap.get(Ln.unitB),Qn=Ln.indexA,Zn=Ln.indexB;else{if(!(Ln.unitA>Ln.unitB))throw new Error("same units in createInterUnitBondLines");cr=x.unitMap.get(Ln.unitB),qn=x.unitMap.get(Ln.unitA),Qn=Ln.indexB,Zn=Ln.indexA}return em(Jt,x,cr,Qn)||em(Jt,x,qn,Zn)},position:(Mn,Ln,cr)=>{const qn=Xe[cr],Qn=x.unitMap.get(qn.unitA),Zn=x.unitMap.get(qn.unitB);Qn.conformation.position(Qn.elements[qn.indexA],Mn),Zn.conformation.position(Zn.elements[qn.indexB],Ln)},style:Mn=>{const Ln=Xe[Mn].props.order,cr=G.NJ.create(Xe[Mn].props.flag);return Tr.I$.is(cr,2)||Tr.I$.is(cr,4)?1:3===Ln?wt?0:Ut?4:5:lt&&Tr.I$.is(cr,16)?7:2!==Ln||wt?0:Ut?2:3},radius:Mn=>{const Ln=Xe[Mn];gn.structure=x,gn.unit=x.unitMap.get(Ln.unitA),gn.element=gn.unit.elements[Ln.indexA];const cr=F.size.size(gn);gn.unit=x.unitMap.get(Ln.unitB),gn.element=gn.unit.elements[Ln.indexB];const qn=F.size.size(gn);return Math.min(cr,qn)*Qe},ignore:Po(x,z)},{lines:wn,boundingSphere:Bn}=(0,Vr.Yz)(oe,Pn,z,me);if(Bn)wn.setBoundingSphere(Bn);else if(wn.lineCount>0){const{child:Mn}=x,Ln=Bt.f8.expand((0,Bt.f8)(),(Mn??x).boundary.sphere,1*Qe);wn.setBoundingSphere(Ln)}return wn}const tm={...ti.YD,...Do,includeParent:v.t.Boolean(!1)};function H0(oe){return(0,ti.yd)({defaultProps:v.t.getDefaultValues(tm),createGeometry:k0,createLocationIterator:x=>Yr.fromStructure(x),getLoci:Eo,eachLocation:ei,setUpdateState:(x,F,z,me,Pe,Ge,Xe)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.linkScale!==z.linkScale||F.linkSpacing!==z.linkSpacing||F.aromaticDashCount!==z.aromaticDashCount||F.dashCount!==z.dashCount||F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||!(0,G.af)(F.includeTypes,z.includeTypes)||!(0,G.af)(F.excludeTypes,z.excludeTypes)||F.multipleBonds!==z.multipleBonds,Ge.interUnitBonds!==Xe.interUnitBonds&&(x.createGeometry=!0,x.updateTransform=!0,x.updateColor=!0,x.updateSize=!0)}},oe)}var j0=n(5821),W0=n(7767);const Ec=g.eB.scaleAndAdd,nm=g.eB.unitX,rm=g.eB.unitY,om=g.eB.unitZ,im={...tr.zj,lineSizeAttenuation:v.t.Boolean(!1),ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),traceOnly:v.t.Boolean(!1),crosses:v.t.Select("lone",v.t.arrayToOptions(["lone","all"])),crossSize:v.t.Numeric(.35,{min:0,max:2,step:.01})};function Q0(oe,x,F,z,me,Pe){const{child:Ge}=F;if(Ge&&!Ge.unitMap.get(x.id))return za.q.createEmpty(Pe);const Xe=x.elements,Qe=Xe.length,lt=j0.d.create(Qe,Qe/10,Pe),ft=(0,g.eB)(),wt=(0,g.eB)(),Ut=(0,g.eB)(),Jt=x.conformation,gn=bi(F,x,me),Pn=me.crossSize/2,wn="lone"===me.crosses;for(let Ln=0;Ln<Qe;++Ln)gn&&gn(Xe[Ln])||wn&&Je.Nf.isAtomic(x)&&0!==(0,W0.Hm)(F,x,Ln)||(Jt.invariantPosition(Xe[Ln],ft),Ec(wt,ft,nm,Pn),Ec(Ut,ft,nm,-Pn),lt.add(wt[0],wt[1],wt[2],Ut[0],Ut[1],Ut[2],Ln),Ec(wt,ft,rm,Pn),Ec(Ut,ft,rm,-Pn),lt.add(wt[0],wt[1],wt[2],Ut[0],Ut[1],Ut[2],Ln),Ec(wt,ft,om,Pn),Ec(Ut,ft,om,-Pn),lt.add(wt[0],wt[1],wt[2],Ut[0],Ut[1],Ut[2],Ln));const Bn=lt.getLines(),Mn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return Bn.setBoundingSphere(Mn),Bn}function K0(oe){return(0,tr.zK)({defaultProps:v.t.getDefaultValues(im),createGeometry:Q0,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{x.createGeometry=F.ignoreHydrogens!==z.ignoreHydrogens||F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant||F.traceOnly!==z.traceOnly||F.crosses!==z.crosses||F.crossSize!==z.crossSize}},oe)}const sm={"intra-bond":(oe,x)=>(0,vn.T)("Intra-unit bond line",oe,x,z0),"inter-bond":(oe,x)=>(0,nr.K)("Inter-unit bond line",oe,x,H0),"element-point":(oe,x)=>(0,vn.T)("Points",oe,x,Qf),"element-cross":(oe,x)=>(0,vn.T)("Crosses",oe,x,K0)},Wl={...qf,...tm,...zl,...im,pointStyle:v.t.Select("circle",v.t.objectToOptions(Vl.O.StyleTypes)),multipleBonds:v.t.Select("offset",v.t.arrayToOptions(["off","symmetric","offset"])),includeParent:v.t.Boolean(!1),sizeFactor:v.t.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:(0,Rr.R8)(["atomic"]),visuals:v.t.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],v.t.objectToOptions(sm))},X0=(0,pr.GT)({name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:function Y0(oe,x){return dr.YL.createMulti("Line",oe,x,pr.J1,sm)},getParams:function Z0(oe,x){if(Je.oE.getSize(x)>=Je.oE.Size.Huge){const z=v.t.clone(Wl);return z.visuals.defaultValue=["intra-bond","element-point","element-cross"],z}return Wl},defaultValues:v.t.getDefaultValues(Wl),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.elementCount>0,getData:(oe,x)=>x.includeParent?oe.asParent():oe,mustRecreate:(oe,x)=>oe.includeParent!==x.includeParent});var am=n(9928);function $0(oe,x,F,z,me){return Ql.apply(this,arguments)}function Ql(){return Ql=(0,r.A)(function*(oe,x,F,z,me){const{runtime:Pe,webgl:Ge}=oe;if(!Ge||!Ge.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");const Xe=me?me.gridTexture.ref.value:void 0,Qe=yield function Dh(oe,x,F,z,me){const{position:Pe,boundary:Ge,radius:Xe}=(0,Gr.oc)(oe,x,F),Qe=(0,Gr.FC)(Ge.box,F);return R.YZ.create("Gaussian Density",function(){var lt=(0,r.A)(function*(ft){return ff(z,Pe,Ge.box,Xe,Qe,me)});return function(ft){return lt.apply(this,arguments)}}())}(x,F.size,z,Ge,Xe).runInContext(Pe),{transform:lt,texture:ft,bbox:wt,gridDim:Ut}=Qe,gn=g.$I.mul((0,g.$I)(),lt,g.$I.fromScaling((0,g.$I)(),Ut)),Pn=g.$I.getScaling((0,g.eB)(),lt),wn=g.eB.create(0,1,2),Bn=am.E.create(wt,Ut,lt,gn,Pn,ft,{min:0,max:1,mean:.04,sigma:.01},!0,wn,me),Mn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,Qe.maxRadius);return Bn.setBoundingSphere(Mn),Bn}),Ql.apply(this,arguments)}const cm={...ti.I,...Gc,ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),includeParent:v.t.Boolean(!1,{isHidden:!0})};function J0(oe){return(0,ti.Yl)({defaultProps:v.t.getDefaultValues(cm),createGeometry:$0,createLocationIterator:sr.fromStructure,getLoci:ur,eachLocation:kn,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0)},dispose:x=>{x.gridTexture.ref.value.destroy()}},oe)}function q0(oe,x,F,z,me,Pe){return Kl.apply(this,arguments)}function Kl(){return Kl=(0,r.A)(function*(oe,x,F,z,me,Pe){const{runtime:Ge,webgl:Xe}=oe;if(!Xe)throw new Error("GaussianDensityVolume requires `webgl`");const Qe=Pe?Pe.gridTexture.ref.value:void 0,lt=yield function Ph(oe,x,F,z,me,Pe){const{position:Ge,boundary:Xe,radius:Qe}=(0,Gr.LT)(oe,x,F,z),lt=(0,Gr.FC)(Xe.box,z,Sf(me,oe));return R.YZ.create("Gaussian Density",function(){var ft=(0,r.A)(function*(wt){return ff(me,Ge,Xe.box,Qe,lt,Pe)});return function(wt){return ft.apply(this,arguments)}}())}(F,x,z.size,me,Xe,Qe).runInContext(Ge),{transform:ft,texture:wt,bbox:Ut,gridDim:Jt}=lt,Pn=g.$I.mul((0,g.$I)(),ft,g.$I.fromScaling((0,g.$I)(),Jt)),wn=g.$I.getScaling((0,g.eB)(),ft),Bn=g.eB.create(0,1,2),Mn=am.E.create(Ut,Jt,ft,Pn,wn,wt,{min:0,max:1,mean:.04,sigma:.01},!0,Bn,Pe),Ln=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,lt.maxRadius);return Mn.setBoundingSphere(Ln),Mn}),Kl.apply(this,arguments)}const eg={...tr.Ny,...Gc,ignoreHydrogens:v.t.Boolean(!1),ignoreHydrogensVariant:v.t.Select("all",v.t.arrayToOptions(["all","non-polar"])),includeParent:v.t.Boolean(!1,{isHidden:!0})};function tg(oe){return(0,tr.Pi)({defaultProps:v.t.getDefaultValues(eg),createGeometry:q0,createLocationIterator:sr.fromGroup,getLoci:Ht,eachLocation:ln,setUpdateState:(x,F,z)=>{F.resolution!==z.resolution&&(x.createGeometry=!0),F.radiusOffset!==z.radiusOffset&&(x.createGeometry=!0),F.smoothness!==z.smoothness&&(x.createGeometry=!0),F.ignoreHydrogens!==z.ignoreHydrogens&&(x.createGeometry=!0),F.ignoreHydrogensVariant!==z.ignoreHydrogensVariant&&(x.createGeometry=!0),F.traceOnly!==z.traceOnly&&(x.createGeometry=!0),F.includeParent!==z.includeParent&&(x.createGeometry=!0)},dispose:x=>{x.gridTexture.ref.value.destroy()}},oe)}const um={"gaussian-volume":(oe,x)=>(0,pr.Kp)("Gaussian volume",oe,x,J0),"units-gaussian-volume":(oe,x)=>(0,pr.TP)("Units-Gaussian volume",oe,x,tg)},lm={...cm,jumpLength:v.t.Numeric(4,{min:0,max:20,step:.1}),visuals:v.t.MultiSelect(["gaussian-volume"],v.t.objectToOptions(um))},og=(0,pr.GT)({name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:function rg(oe,x){return dr.YL.createMulti("Gaussian Volume",oe,x,pr.J1,um)},getParams:function ng(oe,x){return lm},defaultValues:v.t.getDefaultValues(lm),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:oe=>oe.elementCount>0}),ig=g.eB.scale,sg=g.eB.add,ag=g.eB.sub,Zl={...tr.Te,...tr.lm,sizeFactor:v.t.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:v.t.Numeric(16,{min:2,max:56,step:2},Jn.iy.CustomQualityParamInfo),tryUseImpostor:v.t.Boolean(!0)};function cg(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth?function lg(oe){return(0,tr.Vb)({defaultProps:v.t.getDefaultValues(Zl),createGeometry:ug,createLocationIterator:x=>ia.fromGroup(x),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z)=>{},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function fg(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Zl),createGeometry:dg,createLocationIterator:x=>ia.fromGroup(x),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.radialSegments!==z.radialSegments},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}function ug(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return ci.S.createEmpty(Pe);const Xe=2*Ge,Qe=jd.h.create(Xe,Xe/4,Pe),lt=x.conformation,ft=(0,g.eB)(),wt=(0,g.eB)(),Ut=(0,g.eB)();ld(x,function(wn,Bn,Mn,Ln,cr){lt.invariantPosition(wn,ft),lt.invariantPosition(Bn,wt);const Qn=(0,Tr.OV)(cr)?tu:eu;sg(Ut,ft,ig(Ut,ag(Ut,wt,ft),Qn)),Qe.add(ft[0],ft[1],ft[2],Ut[0],Ut[1],Ut[2],1,!1,!1,2,Mn),Qe.add(Ut[0],Ut[1],Ut[2],wt[0],wt[1],wt[2],1,!1,!1,2,Ln)});const gn=Qe.getCylinders(),Pn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return gn.setBoundingSphere(Pn),gn}function dg(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{radialSegments:Xe,sizeFactor:Qe}=me,lt=2*Xe*Ge*2,ft=lr.P.createState(lt,lt/10,Pe),wt=x.conformation,Ut=(0,g.eB)(),Jt=(0,g.eB)(),gn={radiusTop:1,radiusBottom:1,radialSegments:Xe},Pn=Je.iZ.Location.create(F,x),wn=Je.iZ.Location.create(F,x);ld(x,function(cr,qn,Qn,Zn,zn){Pn.element=cr,wn.element=qn,wt.invariantPosition(Pn.element,Ut),wt.invariantPosition(wn.element,Jt);const wr=(0,Tr.OV)(zn)?tu:eu;gn.radiusTop=gn.radiusBottom=z.size.size(Pn)*Qe,ft.currentGroup=Qn,(0,_i.y9)(ft,Ut,Jt,wr,gn),gn.radiusTop=gn.radiusBottom=z.size.size(wn)*Qe,ft.currentGroup=Zn,(0,_i.y9)(ft,Jt,Ut,1-wr,gn)});const Mn=lr.P.getMesh(ft),Ln=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return Mn.setBoundingSphere(Ln),Mn}const Yl={...tr.Te,...tr.qg,sizeFactor:v.t.Numeric(.3,{min:0,max:10,step:.01}),detail:v.t.Numeric(0,{min:0,max:3,step:1},Jn.iy.CustomQualityParamInfo),tryUseImpostor:v.t.Boolean(!0)};function mg(oe,x,F,z){return F.tryUseImpostor&&z&&z.extensions.fragDepth&&z.extensions.textureFloat?function hg(oe){return(0,tr.uF)({defaultProps:v.t.getDefaultValues(Yl),createGeometry:pg,createLocationIterator:x=>ia.fromGroup(x),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z)=>{},mustRecreate:(x,F,z)=>!F.tryUseImpostor||!z},oe)}(oe):function yg(oe){return(0,tr.Pv)({defaultProps:v.t.getDefaultValues(Yl),createGeometry:gg,createLocationIterator:x=>ia.fromGroup(x),getLoci:Ba,eachLocation:Da,setUpdateState:(x,F,z)=>{x.createGeometry=F.sizeFactor!==z.sizeFactor||F.detail!==z.detail},mustRecreate:(x,F,z)=>F.tryUseImpostor&&!!z},oe)}(oe)}function pg(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return Qr.v.createEmpty(Pe);const Xe=Bi.create(Ge,Ge/2,Pe),Qe=x.conformation,lt=(0,g.eB)();dd(x,(Jt,gn)=>{Qe.invariantPosition(Jt,lt),Xe.add(lt[0],lt[1],lt[2],gn)});const wt=Xe.getSpheres(),Ut=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return wt.setBoundingSphere(Ut),wt}function gg(oe,x,F,z,me,Pe){const Ge=x.polymerElements.length;if(!Ge)return rr.e.createEmpty(Pe);const{detail:Xe,sizeFactor:Qe}=me,lt=Ge*(0,zr.J)(Xe),ft=lr.P.createState(lt,lt/2,Pe),wt=x.conformation,Ut=(0,g.eB)(),Jt=Je.iZ.Location.create(F,x);dd(x,(Bn,Mn)=>{Jt.element=Bn,wt.invariantPosition(Jt.element,Ut),ft.currentGroup=Mn,(0,kr.X)(ft,Ut,z.size.size(Jt)*Qe,Xe)});const Pn=lr.P.getMesh(ft),wn=Bt.f8.expand((0,Bt.f8)(),x.boundary.sphere,1*me.sizeFactor);return Pn.setBoundingSphere(wn),Pn}const dm={"polymer-backbone-cylinder":(oe,x)=>(0,vn.T)("Polymer backbone cylinder",oe,x,cg),"polymer-backbone-sphere":(oe,x)=>(0,vn.T)("Polymer backbone sphere",oe,x,mg),"polymer-gap":(oe,x)=>(0,vn.T)("Polymer gap cylinder",oe,x,ll)},fm={...Yl,...Zl,...xu,sizeAspectRatio:v.t.Numeric(1,{min:.1,max:3,step:.1}),visuals:v.t.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],v.t.objectToOptions(dm)),bumpFrequency:v.t.Numeric(0,{min:0,max:10,step:.1},Jn.iy.ShadingCategory),colorMode:v.t.Select("default",v.t.arrayToOptions(["default","interpolate"]),{...Jn.iy.ShadingCategory,isHidden:!0})},bg=(0,pr.GT)({name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:function _g(oe,x){return dr.YL.createMulti("Backbone",oe,x,pr.J1,dm)},getParams:function vg(oe,x){const F=v.t.clone(fm);let z=!1;return x.units.forEach(me=>{!z&&me.gapElements.length&&(z=!0)}),F.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],z&&F.visuals.defaultValue.push("polymer-gap"),F},defaultValues:v.t.getDefaultValues(fm),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:oe=>oe.polymerResidueCount>0});class kc extends dr.lN{constructor(){super(),(0,ae.IF)(kc.BuiltIn,(x,F)=>{if(x.name!==F)throw new Error(`Fix BuiltInStructureRepresentations to have matching names. ${x.name} ${F}`);this.add(x)})}}!function(oe){oe.BuiltIn={cartoon:uh,backbone:bg,"ball-and-stick":fo,carbohydrate:Pm,ellipsoid:ph,"gaussian-surface":Qh,"gaussian-volume":og,label:e0,line:X0,"molecular-surface":h0,orientation:E0,point:M0,putty:F0,spacefill:V0}}(kc||(kc={}));var xg=n(3866),mm=n(274),pm=n(2832),hm=n(190),Cg=n(3188),Hc=n(4080),Mu=n(2229),Xl=n(8956),$l=n(9854),Sg=n(2098);class Eg{get isAnimating(){return this._isAnimating}tick(x,F){var z=this;return(0,r.A)(function*(){var me,Pe;if(yield z.plugin.managers.animation.tick(x,F?.isSynchronous,F?.animation),null===(me=z.plugin.canvas3d)||void 0===me||me.tick(x,F),se.g$){const Ge=null===(Pe=z.plugin.canvas3d)||void 0===Pe?void 0:Pe.webgl.timer.resolve();if(Ge)for(const Xe of Ge)(0,Sg.d)([Xe])}})()}resetTime(x=(0,$l.t)()){var F;null===(F=this.plugin.canvas3d)||void 0===F||F.resetTime(x)}start(x){var F;null===(F=this.plugin.canvas3d)||void 0===F||F.resume(),this._isAnimating=!0,this.resetTime(),x?.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)}stop(x){var F;this._isAnimating=!1,void 0!==this.currentFrame&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),x?.noDraw&&(null===(F=this.plugin.canvas3d)||void 0===F||F.pause(x?.noDraw))}constructor(x){this.plugin=x,this.currentFrame=void 0,this._isAnimating=!1,this.frame=()=>{this.tick((0,$l.t)()),this._isAnimating&&(this.currentFrame=requestAnimationFrame(this.frame))}}}var ka=n(1164),Ig=n(6852),Ag=n(2768);class Pg{getDecorator(x){const F=this.plugin.state.data.tree,z=F.children.get(x);if(1!==z.size)return x;const me=z.first();return F.transforms.get(me).transformer.definition.isDecorator?this.getDecorator(me):x}get(x,F=!1){const z=this.root.get(x);if(z)return this.plugin.state.data.cells.get(F?z.ref:this.getDecorator(z.ref))}addMapping(x,F,z){if(!A.O.Molecule.Structure.is(z))return!1;if(this.tracked.set(F,z.data),this.root.has(z.data))this.root.get(z.data).count++;else{const me=x.select(c.QX.Generators.byRef(F).rootOfType([A.O.Molecule.Structure]))[0];this.root.set(z.data,me?{ref:me.transform.ref,count:1}:{ref:F,count:1})}return!0}removeMapping(x){if(!this.tracked.has(x))return!1;const F=this.tracked.get(x);this.tracked.delete(x);const z=this.root.get(F);return z.count>1?z.count--:this.root.delete(F),!0}updateMapping(x,F,z,me){return!!A.O.Molecule.Structure.is(me)&&(this.removeMapping(F),this.addMapping(x,F,me),!0)}dispose(){this.ev.dispose()}constructor(x){this.plugin=x,this.ev=Xl.V.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,x.state.data.events.object.created.subscribe(F=>{this.addMapping(F.state,F.ref,F.obj)}),x.state.data.events.object.removed.subscribe(F=>{this.removeMapping(F.ref)&&this.events.removed.next({ref:F.ref,obj:F.obj})}),x.state.data.events.object.updated.subscribe(F=>{this.updateMapping(F.state,F.ref,F.oldObj,F.obj)&&this.events.updated.next({ref:F.ref,oldObj:F.oldObj,obj:F.obj})})}}var gm=n(6241);class Jl{constructor(){this.ev=Xl.V.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(x){if(this.abortRequests.has(x.progress.taskId))return x.progress.taskId;for(const F of x.children){const z=this.tryGetAbortTaskId(F);if(void 0!==z)return z}}track(x,F){return z=>{var me;if(z.canAbort&&z.requestAbort){const Ge=this.tryGetAbortTaskId(z.root);void 0!==Ge&&z.requestAbort(this.abortRequests.get(Ge))}const Pe=(0,$l.t)()-z.root.progress.startedTime;this.events.progress.next({id:x,useOverlay:null===(me=this.options.get(F))||void 0===me?void 0:me.useOverlay,level:Pe<250?"none":"background",progress:z})}}run(x,F){var z=this;return(0,r.A)(function*(){const me=z.id++;let Pe;F?.createNewContext||0===z.currentContext.length?Pe={ctx:(0,gm.pm)(x,z.track(me,x.id),100),refCount:1}:(Pe=z.currentContext[z.currentContext.length-1],Pe.refCount++);try{return z.options.set(x.id,{useOverlay:!!F?.useOverlay}),z.runningTasks.add(x.id),yield(0,gm.yR)(Pe.ctx,x)}finally{z.options.delete(x.id),z.runningTasks.delete(x.id),z.events.finished.next({id:me}),z.abortRequests.delete(x.id),Pe.refCount--,0===Pe.refCount&&(0,nt.mO)(z.currentContext,Pe)}})()}requestAbortAll(x){this.runningTasks.forEach(F=>this.abortRequests.set(F,x))}requestAbort(x,F){this.abortRequests.set("number"==typeof x?x:x.root.progress.taskId,F)}dispose(){this.ev.dispose()}}!function(oe){function x(z){return new Promise(me=>setTimeout(me,z))}oe.testTask=function F(z){return R.YZ.create("Test",function(){var me=(0,r.A)(function*(Pe){let Ge=0;for(;Ge<z;)yield x(100+200*Math.random()),Pe.shouldUpdate&&(yield Pe.update({message:"Step "+Ge,current:Ge,max:z,isIndeterminate:!1})),Ge++});return function(Pe){return me.apply(this,arguments)}}())}}(Jl||(Jl={}));class Tg extends Yt.e{findByKey(x){return this.state.entries.find(F=>!!F&&F.key===x)}show(x){let z,F=this.state.entries;const me=++this.serialId;let Pe;x.key&&(z=this.findByKey(x.key))?(void 0!==z.timeout&&clearTimeout(z.timeout),Pe=z.serialNumber,F=F.remove(z.id)):Pe=++this.serialNumber,z={id:me,serialNumber:Pe,key:x.key,title:x.title,message:x.message,timeout:this.timeout(me,x.timeoutMs),hide:()=>this.hideId(me)},this.updateState({entries:F.set(me,z)})&&this.events.changed.next(void 0)}timeout(x,F){if(void 0!==F)return F<0&&(F=500),setTimeout(()=>{const z=this.state.entries.get(x);z.timeout=void 0,this.hide(z)},F)}hideId(x){this.hide(this.state.entries.get(x))}hide(x){x&&(void 0!==x.timeout&&clearTimeout(x.timeout),x.hide=void 0,this.updateState({entries:this.state.entries.delete(x.id)})&&this.events.changed.next(void 0))}constructor(x){super({entries:(0,Se.uY)()}),this.events={changed:this.ev()},this.serialNumber=0,this.serialId=0,i.a.Toast.Show.subscribe(x,F=>this.show(F)),i.a.Toast.Hide.subscribe(x,F=>this.hide(this.findByKey(F.key)))}}var Bg=n(7028),Dg=n(2732),Mg=n(9986);class Og extends Yt.N{createParams(){const x=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:v.t.MappedStatic("viewport",{viewport:v.t.Group({}),hd:v.t.Group({}),"full-hd":v.t.Group({}),"ultra-hd":v.t.Group({}),custom:v.t.Group({width:v.t.Numeric(1920,{min:128,max:x,step:1}),height:v.t.Numeric(1080,{min:128,max:x,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:v.t.Boolean(!1),axes:Bg.kf.axes}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){var x,F;return{width:(null===(x=this.plugin.canvas3d)||void 0===x?void 0:x.webgl.gl.drawingBufferWidth)||0,height:(null===(F=this.plugin.canvas3d)||void 0===F?void 0:F.webgl.gl.drawingBufferHeight)||0}}getSize(){const x=this.values;switch(x.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:x.resolution.params.width,height:x.resolution.params.height}}}createPass(x){const F=this.plugin.canvas3d,{colorBufferFloat:z,textureFloat:me}=F.webgl.extensions,Pe=F.props.postprocessing.occlusion;return F.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...F.props.multiSample,mode:x?"on":"off",sampleLevel:z&&me?4:2},postprocessing:{...F.props.postprocessing,occlusion:"on"===Pe.name?{name:"on",params:{...Pe.params,samples:128,resolutionScale:F.webgl.pixelRatio}}:Pe},marking:{...F.props.marking}})}get previewPass(){return this._previewPass||(this._previewPass=this.createPass(!1))}get imagePass(){if(this._imagePass){const x=this.plugin.canvas3d,F=x.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:{...x.props.postprocessing,occlusion:"on"===F.name?{name:"on",params:{...F.params,samples:128,resolutionScale:x.webgl.pixelRatio}}:F},marking:{...x.props.marking}}),this._imagePass}return this._imagePass=this.createPass(!0)}getFilename(x=".png"){const F=this.plugin.state.data.select(c.QX.Generators.rootsOfType(A.O.Molecule.Model)).map(Pe=>Pe.obj.data),z=new Set;return F.forEach(Pe=>z.add(Pe.entryId.toUpperCase())),`${Mg.M.toArray(z).join("-")||"molstar-image"}${x}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){const x=this.relativeCrop;return(0,bc.T)(x.x,0,1e-5)&&(0,bc.T)(x.y,0,1e-5)&&(0,bc.T)(x.width,1,1e-5)&&(0,bc.T)(x.height,1,1e-5)}autocrop(x=this.cropParams.relativePadding){const{data:F,width:z,height:me}=this.previewData.image,Pe=this.previewData.transparent,Ge=Pe?this.previewData.background:4278190080|this.previewData.background;let Xe=z,Qe=0,lt=me,ft=0;for(let gn=0;gn<me;gn++){const Pn=gn*z;for(let wn=0;wn<z;wn++){const Bn=4*(Pn+wn);if(Pe){if(0===F[Bn+3])continue}else if((F[Bn]<<16|F[Bn+1]<<8|F[Bn+2]|F[Bn+3]<<24)===Ge)continue;wn<Xe&&(Xe=wn),wn>Qe&&(Qe=wn),gn<lt&&(lt=gn),gn>ft&&(ft=gn)}}if(Xe>Qe){const gn=Xe;Xe=Qe,Qe=gn}if(lt>ft){const gn=lt;lt=ft,ft=gn}const wt=Qe-Xe+1,Ut=ft-lt+1;Xe-=x*wt,Qe+=x*wt,lt-=x*Ut,ft+=x*Ut;const Jt={x:Math.max(0,Xe/z),y:Math.max(0,lt/me),width:Math.min(1,(Qe-Xe+1)/z),height:Math.min(1,(ft-lt+1)/me)};this.behaviors.relativeCrop.next(Jt)}getPreview(x=320){const{width:F,height:z}=this.getSize();if(F<=0||z<=0)return;const me=F/z;let Pe=0,Ge=0;me>1?(Pe=x,Ge=Math.round(x/me)):(Ge=x,Pe=Math.round(x*me));const Xe=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:Xe.postprocessing,marking:Xe.marking});const Qe=this.previewPass.getImageData(Pe,Ge),lt=this.previewCanvas;lt.width=Qe.width,lt.height=Qe.height,this.previewData.image=Qe,this.previewData.background=Xe.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;const ft=lt.getContext("2d");if(!ft)throw new Error("Could not create canvas 2d context");return ft.putImageData(Qe,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:lt,width:Pe,height:Ge}}getSizeAndViewport(){const{width:x,height:F}=this.getSize(),z=this.relativeCrop,me={x:Math.floor(z.x*x),y:Math.floor(z.y*F),width:Math.ceil(z.width*x),height:Math.ceil(z.height*F)};return me.width+me.x>x&&(me.width=x-me.x),me.height+me.y>F&&(me.height=F-me.y),{width:x,height:F,viewport:me}}draw(x){var F=this;return(0,r.A)(function*(){const{width:z,height:me,viewport:Pe}=F.getSizeAndViewport();if(z<=0||me<=0)return;yield x.update("Rendering image...");const Ge=F.imagePass;yield Ge.updateBackground();const Xe=Ge.getImageData(z,me,Pe);yield x.update("Encoding image...");const Qe=F.canvas;Qe.width=Xe.width,Qe.height=Xe.height;const lt=Qe.getContext("2d");if(!lt)throw new Error("Could not create canvas 2d context");lt.putImageData(Xe,0,0)})()}copyToClipboardTask(){var x=this;const F=navigator.clipboard;if(F?.write)return R.YZ.create("Copy Image",function(){var z=(0,r.A)(function*(me){yield x.draw(me),yield me.update("Converting image...");const Pe=yield(0,ie.PG)(x.canvas,"png"),Ge=new ClipboardItem({"image/png":Pe});yield F.write([Ge]),x.plugin.log.message("Image copied to clipboard.")});return function(me){return z.apply(this,arguments)}}());this.plugin.log.error("clipboard.write not supported!")}getImageDataUri(){var x=this;return this.plugin.runTask(R.YZ.create("Generate Image",function(){var F=(0,r.A)(function*(z){return yield x.draw(z),yield z.update("Converting image..."),x.canvas.toDataURL("png")});return function(z){return F.apply(this,arguments)}}()))}copyToClipboard(){const x=this.copyToClipboardTask();if(x)return this.plugin.runTask(x)}downloadTask(x){var F=this;return R.YZ.create("Download Image",function(){var z=(0,r.A)(function*(me){yield F.draw(me),yield me.update("Downloading image...");const Pe=yield(0,ie.PG)(F.canvas,"png");(0,Dg.R)(Pe,x??F.getFilename())});return function(me){return z.apply(this,arguments)}}())}download(x){this.plugin.runTask(this.downloadTask(x))}constructor(x){super(),this.plugin=x,this._params=void 0,this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:this.params.resolution.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})},this.events={previewed:this.ev()},this.canvas=document.createElement("canvas"),this.previewCanvas=document.createElement("canvas"),this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:(0,hm.Q1)(0),transparent:!1}}}var ym=n(6101);class Rg{addHandler(x,F){const z=this.handlers.findIndex(me=>me[0]===x);z<0?this.handlers.push([x,F]):this.handlers[z][1]=F}removeHandler(x){const F=this.handlers.findIndex(z=>z[0]===x);F>=0&&this.handlers.splice(F,1)}handle(x){var F=this;return(0,r.A)(function*(){for(let z=F.handlers.length-1;z>=0;z--){const me=F.handlers[z][1];if(yield me(x,F.plugin))return}!function Lg(oe,x){const F=x.filter(z=>{const me=z.name.toLowerCase();return me.endsWith(".molx")||me.endsWith(".molj")});F.length>0?i.a.State.Snapshots.OpenFile(oe,{file:F[0]}):oe.runTask(oe.state.data.applyAction(w.OpenFiles,{files:x.map(z=>p.V.File(z)),format:{name:"auto",params:{}},visuals:!0}))}(F.plugin,x)})()}dispose(){this.handlers.length=0}constructor(x){this.plugin=x,this.handlers=[]}}class wg{get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}initContainer(x){var F;if(this.canvasContainer)return!0;const z=document.createElement("div");Object.assign(z.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});let me=null===(F=x?.canvas3dContext)||void 0===F?void 0:F.canvas;return me||(me=document.createElement("canvas"),x?.checkeredCanvasBackground&&Object.assign(me.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}),z.appendChild(me)),!!this.initViewer(me,z,x?.canvas3dContext)&&(this.canvasContainer=z,!0)}mount(x,F){var z;if(this.disposed)throw new Error("Cannot mount a disposed context");return!!this.initContainer(F)&&(this.canvasContainer.parentElement!==x&&(null===(z=this.canvasContainer.parentElement)||void 0===z||z.removeChild(this.canvasContainer)),x.appendChild(this.canvasContainer),this.handleResize(),!0)}unmount(){var x,F;null===(F=null===(x=this.canvasContainer)||void 0===x?void 0:x.parentElement)||void 0===F||F.removeChild(this.canvasContainer)}initViewer(x,F,z){var me,Pe,Ge,Xe,Qe,lt;try{this.layout.setRoot(F),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),z||(z=Te.H7.fromCanvas(x,this.managers.asset,{antialias:!(null!==(me=this.config.get(je.AB.General.DisableAntialiasing))&&void 0!==me&&me),preserveDrawingBuffer:!(null!==(Pe=this.config.get(je.AB.General.DisablePreserveDrawingBuffer))&&void 0!==Pe&&Pe),preferWebGl1:this.config.get(je.AB.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!(null!==(Ge=this.config.get(je.AB.General.AllowMajorPerformanceCaveat))&&void 0!==Ge&&Ge),powerPreference:this.config.get(je.AB.General.PowerPreference)||"high-performance",handleResize:this.handleResize},{pixelScale:this.config.get(je.AB.General.PixelScale)||1,pickScale:this.config.get(je.AB.General.PickScale)||.25,transparency:this.config.get(je.AB.General.Transparency)||"wboit"})),this.canvas3dContext=z,this.canvas3d=Te.mX.create(this.canvas3dContext),this.canvas3dInit.next(!0);let ft=this.spec.canvas3d;const wt=(0,hm.Q1)(16579577);return ft?(void 0===(null===(Qe=ft.renderer)||void 0===Qe?void 0:Qe.backgroundColor)&&(ft=(0,Oe.jM)(ft,Ut=>{Ut.renderer?Ut.renderer.backgroundColor=wt:Ut.renderer={backgroundColor:wt}})),null===(lt=this.canvas3d)||void 0===lt||lt.setProps(ft)):null===(Xe=this.canvas3d)||void 0===Xe||Xe.setProps({renderer:{backgroundColor:wt}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new Og(this),this.subs.push(this.canvas3d.interaction.click.subscribe(Ut=>this.behaviors.interaction.click.next(Ut))),this.subs.push(this.canvas3d.interaction.drag.subscribe(Ut=>this.behaviors.interaction.drag.next(Ut))),this.subs.push(this.canvas3d.interaction.hover.subscribe(Ut=>this.behaviors.interaction.hover.next(Ut))),this.subs.push(this.canvas3d.input.resize.pipe((0,Ne.B)(50),(0,K.c)(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(Ut=>this.behaviors.interaction.key.next(Ut))),this.subs.push(this.canvas3d.input.keyUp.subscribe(Ut=>this.behaviors.interaction.keyReleased.next(Ut))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),R._F.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(ft){return this.log.error(""+ft),console.error(ft),R._F.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](ft)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(x){this.behaviors.interaction.selectionMode.next(x)}dataTransaction(x,F){return this.runTask(this.state.data.transaction(x,F))}clear(x=!1){var F;return x&&(null===(F=this.canvas3d)||void 0===F||F.setProps(Te.FN)),i.a.State.RemoveObject(this,{state:this.state.data,ref:c.Cn.RootRef})}dispose(x){var F,z;if(!this.disposed){for(const me of this.subs)me.unsubscribe();this.subs=[],this.animationLoop.stop(),this.commands.dispose(),null===(F=this.canvas3d)||void 0===F||F.dispose(),null===(z=this.canvas3dContext)||void 0===z||z.dispose(x),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),(0,ae.IF)(this.managers,me=>{var Pe;return null===(Pe=me?.dispose)||void 0===Pe?void 0:Pe.call(me)}),(0,ae.IF)(this.managers.structure,me=>{var Pe;return null===(Pe=me?.dispose)||void 0===Pe?void 0:Pe.call(me)}),(0,ae.IF)(this.managers.volume,me=>{var Pe;return null===(Pe=me?.dispose)||void 0===Pe?void 0:Pe.call(me)}),this.unmount(),this.canvasContainer=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push((0,Ve.h)(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(Ge=>{this.behaviors.state.isUpdating.value!==Ge&&this.behaviors.state.isUpdating.next(Ge)}));const x=this.config.get(je.AB.General.IsBusyTimeoutMs)||750,F=this.behaviors.state.isBusy;let z;const me=()=>{F.value||F.next(!0)},Pe=()=>{void 0!==z&&clearTimeout(z),z=void 0};this.subs.push((0,Ve.h)(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(Ge=>{this.behaviors.state.isUpdating.value||this.behaviors.state.isAnimating.value?F.value||(Pe(),z=setTimeout(me,x)):(Pe(),F.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(Ge=>{var Xe;Ge||null===(Xe=this.managers.interactivity)||void 0===Xe||Xe.lociSelects.deselectAll()}))}initBuiltInBehavior(){a.U0.State.registerDefault(this),a.U0.Representation.registerDefault(this),a.U0.Camera.registerDefault(this),a.U0.Misc.registerDefault(this),this.subs.push((0,Ve.h)(this.state.data.events.log,this.state.behaviors.events.log).subscribe(x=>this.events.log.next(x)))}initBehaviors(){var x=this;return(0,r.A)(function*(){let F=x.state.behaviors.build();for(const z of Object.keys(ka.A.Categories))F.toRoot().apply(ka.A.CreateCategory,{label:ka.A.Categories[z]},{ref:z,state:{isLocked:!0}});for(const z of x.spec.behaviors)"custom-props"===ka.A.getCategoryId(z.transformer)&&F.to(ka.A.getCategoryId(z.transformer)).apply(z.transformer,z.defaultParams,{ref:z.transformer.id});yield x.runTask(x.state.behaviors.updateTree(F,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),F=x.state.behaviors.build();for(const z of x.spec.behaviors)"custom-props"!==ka.A.getCategoryId(z.transformer)&&F.to(ka.A.getCategoryId(z.transformer)).apply(z.transformer,z.defaultParams,{ref:z.transformer.id});yield x.runTask(x.state.behaviors.updateTree(F,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))})()}initCustomFormats(){if(this.spec.customFormats)for(const x of this.spec.customFormats)this.dataFormats.add(x[0],x[1])}initAnimations(){if(this.spec.animations)for(const x of this.spec.animations)this.managers.animation.register(x)}initDataActions(){if(this.spec.actions)for(const x of this.spec.actions)this.state.data.actions.add(x.action)}init(){var x=this;return(0,r.A)(function*(){try{x.subs.push(x.events.log.subscribe(F=>x.log.entries=x.log.entries.push(F))),x.initCustomFormats(),x.initBehaviorEvents(),x.initBuiltInBehavior(),x.managers.interactivity=new Kn.d(x),x.managers.lociLabels=new Ft(x),x.builders.structure=new Dn(x),x.initAnimations(),x.initDataActions(),yield x.initBehaviors(),x.log.message(`Mol* Plugin ${ym.j} [${ym.s.toLocaleString()}]`),se.Zq||x.log.message("Development mode enabled"),se.Bb&&x.log.message("Debug mode enabled"),x._isInitialized=!0,x.initializedPromiseCallbacks[0]()}catch(F){throw x.initializedPromiseCallbacks[1](F),F}})()}constructor(x){var F;this.spec=x,this.runTask=(z,me)=>this.managers.task.run(z,me),this.resolveTask=z=>{if(z)return R.YZ.is(z)?this.runTask(z):z},this.subs=[],this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}],this._isInitialized=!1,this.initializedPromiseCallbacks=[()=>{},()=>{}],this.disposed=!1,this.canvasContainer=void 0,this.ev=Xl.V.create(),this.config=new je.tf(this.spec.config),this.state=new Ag.p(this),this.commands=new Ig.K,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:dr.YL.Loci.Empty,modifiers:Hc.Fs.None,buttons:0,button:0}),click:this.ev.behavior({current:dr.YL.Loci.Empty,modifiers:Hc.Fs.None,buttons:0,button:0}),drag:this.ev.behavior({current:dr.YL.Loci.Empty,modifiers:Hc.Fs.None,buttons:0,button:0,pageStart:(0,g.ZY)(),pageEnd:(0,g.ZY)()}),key:this.ev.behavior(Hc.Vl),keyReleased:this.ev.behavior(Hc.Vl),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe((0,ne.p)(z=>!!z),(0,be.s)(1))}},this.canvas3dInitialized=new Promise((z,me)=>{this.initCanvas3dPromiseCallbacks=[z,me]}),this.initialized=new Promise((z,me)=>{this.initializedPromiseCallbacks=[z,me]}),this.layout=new Fn(this),this.animationLoop=new Eg(this),this.representation={structure:{registry:new kc,themes:{colorThemeRegistry:mm.J.createRegistry(),sizeThemeRegistry:pm.F.createRegistry()}},volume:{registry:new xg.H,themes:{colorThemeRegistry:mm.J.createRegistry(),sizeThemeRegistry:pm.F.createRegistry()}}},this.query={structure:{registry:new dt.lL}},this.dataFormats=new ct,this.builders={data:new ve(this),structure:void 0},this.helpers={substructureParent:new Pg(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new on.G(this),component:new ht.C(this),measurement:new En.$T(this),selection:new Ye(this),focus:new fn(this)},volume:{hierarchy:new mn.L(this)},interactivity:void 0,camera:new Nn(this),animation:new cn(this),snapshot:new Qt.g(this),lociLabels:void 0,toast:new Tg(this),asset:new p.E,task:new Jl,dragAndDrop:new Rg(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new ue.Registry,this.customStructureProperties=new ue.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.handleResize=()=>{var z,me;const Pe=null===(z=this.canvas3dContext)||void 0===z?void 0:z.canvas,Ge=this.layout.root;Ge&&Pe&&((0,ie.H5)(Pe,Ge,this.canvas3dContext.props.pixelScale),null===(me=this.canvas3d)||void 0===me||me.requestResize())},this.log={entries:(0,Se.B8)(),entry:z=>this.events.log.next(z),error:z=>this.events.log.next(Mu.x.error(z)),message:z=>this.events.log.next(Mu.x.message(z)),info:z=>this.events.log.next(Mu.x.info(z)),warn:z=>this.events.log.next(Mu.x.warning(z))},this.fetch=Cg.hW,(0,Oe.ht)(!1),(0,uo.GW)(null!==(F=this.config.get(je.AB.Structure.SaccharideCompIdMapType))&&void 0!==F?F:"default")}}class Fg extends wg{initCustomParamEditors(){if(this.spec.customParamEditors)for(const[x,F]of this.spec.customParamEditors)this.customParamEditors.set(x.id,F)}dispose(x){super.dispose(x),this.layout.dispose()}constructor(x){super(x),this.spec=x,this.customParamEditors=new Map,this.initCustomParamEditors()}}var Ng=n(6648),Ug=n(6354),Vg=n(9568),Gg=n(4438);let zg=(()=>{class oe{constructor(){this.plugin=new Fg({actions:[W.Action(Q.Structure.DownloadStructure),W.Action(Q.Volume.DownloadDensity),W.Action(Q.DataFormat.DownloadFile),W.Action(Q.DataFormat.OpenFiles),W.Action(Q.Structure.LoadTrajectory),W.Action(Q.Structure.EnableModelCustomProps),W.Action(Q.Structure.EnableStructureCustomProps),W.Action(o.p3),W.Action(o.Cd),W.Action(o.N$),W.Action(y.f.Data.Download),W.Action(y.f.Data.ParseCif),W.Action(y.f.Data.ParseCcp4),W.Action(y.f.Data.ParseDsn6),W.Action(y.f.Model.TrajectoryFromMmCif),W.Action(y.f.Model.TrajectoryFromCifCore),W.Action(y.f.Model.TrajectoryFromPDB),W.Action(y.f.Model.TransformStructureConformation),W.Action(y.f.Model.StructureFromModel),W.Action(y.f.Model.StructureFromTrajectory),W.Action(y.f.Model.ModelFromTrajectory),W.Action(y.f.Model.StructureSelectionFromScript),W.Action(y.f.Representation.StructureRepresentation3D),W.Action(y.f.Representation.StructureSelectionsDistance3D),W.Action(y.f.Representation.StructureSelectionsAngle3D),W.Action(y.f.Representation.StructureSelectionsDihedral3D),W.Action(y.f.Representation.StructureSelectionsLabel3D),W.Action(y.f.Representation.StructureSelectionsOrientation3D),W.Action(y.f.Representation.ModelUnitcell3D),W.Action(y.f.Representation.StructureBoundingBox3D),W.Action(y.f.Representation.ExplodeStructureRepresentation3D),W.Action(y.f.Representation.SpinStructureRepresentation3D),W.Action(y.f.Representation.UnwindStructureAssemblyRepresentation3D),W.Action(y.f.Representation.OverpaintStructureRepresentation3DFromScript),W.Action(y.f.Representation.TransparencyStructureRepresentation3DFromScript),W.Action(y.f.Representation.ClippingStructureRepresentation3DFromScript),W.Action(y.f.Representation.SubstanceStructureRepresentation3DFromScript),W.Action(y.f.Representation.ThemeStrengthRepresentation3D),W.Action(L),W.Action(y.f.Volume.VolumeFromCcp4),W.Action(y.f.Volume.VolumeFromDsn6),W.Action(y.f.Volume.VolumeFromCube),W.Action(y.f.Volume.VolumeFromDx),W.Action(y.f.Representation.VolumeRepresentation3D)],behaviors:[W.Behavior(a.Zw.Representation.HighlightLoci),W.Behavior(a.Zw.Representation.SelectLoci),W.Behavior(a.Zw.Representation.DefaultLociLabelProvider),W.Behavior(a.Zw.Representation.FocusLoci),W.Behavior(a.Zw.Camera.FocusLoci),W.Behavior(a.Zw.Camera.CameraAxisHelper),W.Behavior(a.Zw.Camera.CameraControls),W.Behavior(S.b),W.Behavior(a.Zw.CustomProps.StructureInfo),W.Behavior(a.Zw.CustomProps.AccessibleSurfaceArea),W.Behavior(a.Zw.CustomProps.BestDatabaseSequenceMapping),W.Behavior(a.Zw.CustomProps.Interactions),W.Behavior(a.Zw.CustomProps.SecondaryStructure),W.Behavior(a.Zw.CustomProps.ValenceModel),W.Behavior(a.Zw.CustomProps.CrossLinkRestraint)],animations:[d,u,J,h,O,U,V],customParamEditors:[[o.N$,ke]],config:[[je.AB.VolumeStreaming.Enabled,!1]]}),this.plugin$=(0,Ng.H)(this.plugin.init()).pipe((0,Ug.T)(()=>this.plugin),(0,Vg.t)(1))}static#e=this.\u0275fac=function(z){return new(z||oe)};static#t=this.\u0275prov=Gg.jDH({token:oe,factory:oe.\u0275fac,providedIn:"platform"})}return oe})()},3286:(tn,Ue,n)=>{"use strict";n.d(Ue,{Z:()=>l});var e=n(467),o=n(4412),r=n(5558),t=n(5964),A=n(6354),y=n(6648),c=n(8141),i=n(9568),v=n(9136),O=n(1861);const b=new Map([["ALA","A"],["ARG","R"],["ASN","N"],["ASP","D"],["CYS","C"],["GLN","Q"],["GLU","E"],["GLY","G"],["HIS","H"],["ILE","I"],["LEU","L"],["LYS","K"],["MET","M"],["PHE","F"],["PRO","P"],["SER","S"],["THR","T"],["TRP","W"],["TYR","Y"],["VAL","V"]]);new Map(Array.from(b.entries()).map(([m,u])=>[u,m]));var M=n(4438),I=n(5621);let l=(()=>{class m{set source(d){this.source$.next(d)}constructor(d){var s=this;this.pluginService=d,this.source$=new o.t(null),this.structure$=this.pluginService.plugin$.pipe((0,r.n)(C=>this.source$.pipe((0,t.p)(h=>null!=h),(0,A.T)(h=>({plugin:C,source:h})))),(0,r.n)(({source:C})=>(0,y.H)((0,e.A)(function*(){return"local"===C.type?{data:yield s.parseLocalSource(C),source:C}:{data:yield s.parseRemoteSource(C),source:C}})())),(0,r.n)(({data:C,source:h})=>(0,y.H)((0,e.A)(function*(){const a=s.pluginService.plugin,S=yield a.builders.structure.parseTrajectory(C,h.format),D=yield a.builders.structure.createModel(S,{modelIndex:0});return a.builders.structure.createStructure(D,{name:"model",params:{}})})())),(0,c.M)(C=>{let h=0;this.residues=[];const a=this.r2i=new Map,S=this.i2r=new Map;v.oE.eachAtomicHierarchyElement(C.cell?.obj?.data,{residue:D=>{const R=v.StructureProperties.residue.auth_seq_id(D),f=v.StructureProperties.residue.pdbx_PDB_ins_code(D),p=v.StructureProperties.chain.auth_asym_id(D),E=v.StructureProperties.atom.auth_comp_id(D),T=(p+R+f).trim();a.set(T,h),S.set(h,T),this.residues.push({pdbInsCode:f,authSeqId:R,authAsymId:p,authCompId3:b.has(E)?E:"XXX",authCompId1:b.get(E)||"X"}),h++}})}),(0,i.t)(1))}parseRemoteSource(d){var s=this;return(0,e.A)(function*(){const C=O.V.Url(d.link);return s.pluginService.plugin.builders.data.download({url:C,label:d.label,isBinary:d.binary})})()}parseLocalSource(d){var s=this;return(0,e.A)(function*(){const C=d.binary,h=d.label,a=s.pluginService.plugin;if("string"==typeof d.data)return a.builders.data.rawData({data:d.data,label:h});let S;S=d.data instanceof File?O.V.File(d.data):O.V.File(new File([d.data],`${h}.${"mmcif"===d.format?"cif":"ent"}`));const{data:D}=yield a.builders.data.readFile({file:S,label:h,isBinary:C});return D})()}static#e=this.\u0275fac=function(s){return new(s||m)(M.KVO(I.z))};static#t=this.\u0275prov=M.jDH({token:m,factory:m.\u0275fac,providedIn:"platform"})}return m})()},39:(tn,Ue,n)=>{"use strict";n.d(Ue,{B8:()=>ao,CD:()=>nr,T5:()=>fn,uY:()=>Ci});var e="delete",o=5,r=1<<o,t=r-1,A={};function c(he){he&&(he.value=!0)}function i(){}function v(he){return void 0===he.size&&(he.size=he.__iterate(b)),he.size}function O(he,fe){if("number"!=typeof fe){var ze=fe>>>0;if(""+ze!==fe||4294967295===ze)return NaN;fe=ze}return fe<0?v(he)+fe:fe}function b(){return!0}function _(he,fe,ze){return(0===he&&!m(he)||void 0!==ze&&he<=-ze)&&(void 0===fe||void 0!==ze&&fe>=ze)}function M(he,fe){return l(he,fe,0)}function I(he,fe){return l(he,fe,fe)}function l(he,fe,ze){return void 0===he?ze:m(he)?fe===1/0?fe:0|Math.max(0,fe+he):void 0===fe||fe===he?he:0|Math.min(fe,he)}function m(he){return he<0||0===he&&1/he==-1/0}var u="@@__IMMUTABLE_ITERABLE__@@";function d(he){return!(!he||!he[u])}var s="@@__IMMUTABLE_KEYED__@@";function C(he){return!(!he||!he[s])}var h="@@__IMMUTABLE_INDEXED__@@";function a(he){return!(!he||!he[h])}function S(he){return C(he)||a(he)}var D=function(fe){return d(fe)?fe:xe(fe)},R=function(he){function fe(ze){return C(ze)?ze:le(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe}(D),f=function(he){function fe(ze){return a(ze)?ze:Ae(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe}(D),p=function(he){function fe(ze){return d(ze)&&!S(ze)?ze:Be(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe}(D);D.Keyed=R,D.Indexed=f,D.Set=p;var E="@@__IMMUTABLE_SEQ__@@";function T(he){return!(!he||!he[E])}var L="@@__IMMUTABLE_RECORD__@@";function w(he){return!(!he||!he[L])}function Q(he){return d(he)||w(he)}var G="@@__IMMUTABLE_ORDERED__@@";function V(he){return!(!he||!he[G])}var U=0,N=1,k=2,H="function"==typeof Symbol&&Symbol.iterator,$="@@iterator",J=H||$,W=function(fe){this.next=fe};function te(he,fe,ze,Ze){var it=0===he?fe:1===he?ze:[fe,ze];return Ze?Ze.value=it:Ze={value:it,done:!1},Ze}function de(){return{value:void 0,done:!0}}function ye(he){return!!Array.isArray(he)||!!q(he)}function j(he){return he&&"function"==typeof he.next}function Z(he){var fe=q(he);return fe&&fe.call(he)}function q(he){var fe=he&&(H&&he[H]||he[$]);if("function"==typeof fe)return fe}W.prototype.toString=function(){return"[Iterator]"},W.KEYS=U,W.VALUES=N,W.ENTRIES=k,W.prototype.inspect=W.prototype.toSource=function(){return this.toString()},W.prototype[J]=function(){return this};var g=Object.prototype.hasOwnProperty;function _e(he){return!(!Array.isArray(he)&&"string"!=typeof he)||he&&"object"==typeof he&&Number.isInteger(he.length)&&he.length>=0&&(0===he.length?1===Object.keys(he).length:he.hasOwnProperty(he.length-1))}var xe=function(he){function fe(ze){return null==ze?Oe():Q(ze)?ze.toSeq():function Ne(he){var fe=K(he);if(fe)return function Y(he){var fe=q(he);return fe&&fe===he.entries}(he)?fe.fromEntrySeq():function ee(he){var fe=q(he);return fe&&fe===he.keys}(he)?fe.toSetSeq():fe;if("object"==typeof he)return new Re(he);throw new TypeError("Expected Array or collection object of values, or keyed object: "+he)}(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.toSeq=function(){return this},fe.prototype.toString=function(){return this.__toString("Seq {","}")},fe.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},fe.prototype.__iterate=function(Ze,it){var Rt=this._cache;if(Rt){for(var X=Rt.length,pe=0;pe!==X;){var De=Rt[it?X-++pe:pe++];if(!1===Ze(De[1],De[0],this))break}return pe}return this.__iterateUncached(Ze,it)},fe.prototype.__iterator=function(Ze,it){var Rt=this._cache;if(Rt){var X=Rt.length,pe=0;return new W(function(){if(pe===X)return{value:void 0,done:!0};var De=Rt[it?X-++pe:pe++];return te(Ze,De[0],De[1])})}return this.__iteratorUncached(Ze,it)},fe}(D),le=function(he){function fe(ze){return null==ze?Oe().toKeyedSeq():d(ze)?C(ze)?ze.toSeq():ze.fromEntrySeq():w(ze)?ze.toSeq():Se(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.toKeyedSeq=function(){return this},fe}(xe),Ae=function(he){function fe(ze){return null==ze?Oe():d(ze)?C(ze)?ze.entrySeq():ze.toIndexedSeq():w(ze)?ze.toSeq().entrySeq():Ve(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return fe(arguments)},fe.prototype.toIndexedSeq=function(){return this},fe.prototype.toString=function(){return this.__toString("Seq [","]")},fe}(xe),Be=function(he){function fe(ze){return(d(ze)&&!S(ze)?ze:Ae(ze)).toSetSeq()}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return fe(arguments)},fe.prototype.toSetSeq=function(){return this},fe}(xe);xe.isSeq=T,xe.Keyed=le,xe.Set=Be,xe.Indexed=Ae,xe.prototype[E]=!0;var Ce=function(he){function fe(ze){this._array=ze,this.size=ze.length}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.get=function(Ze,it){return this.has(Ze)?this._array[O(this,Ze)]:it},fe.prototype.__iterate=function(Ze,it){for(var Rt=this._array,X=Rt.length,pe=0;pe!==X;){var De=it?X-++pe:pe++;if(!1===Ze(Rt[De],De,this))break}return pe},fe.prototype.__iterator=function(Ze,it){var Rt=this._array,X=Rt.length,pe=0;return new W(function(){if(pe===X)return{value:void 0,done:!0};var De=it?X-++pe:pe++;return te(Ze,De,Rt[De])})},fe}(Ae),Re=function(he){function fe(ze){var Ze=Object.keys(ze).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(ze):[]);this._object=ze,this._keys=Ze,this.size=Ze.length}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.get=function(Ze,it){return void 0===it||this.has(Ze)?this._object[Ze]:it},fe.prototype.has=function(Ze){return g.call(this._object,Ze)},fe.prototype.__iterate=function(Ze,it){for(var Rt=this._object,X=this._keys,pe=X.length,De=0;De!==pe;){var Ee=X[it?pe-++De:De++];if(!1===Ze(Rt[Ee],Ee,this))break}return De},fe.prototype.__iterator=function(Ze,it){var Rt=this._object,X=this._keys,pe=X.length,De=0;return new W(function(){if(De===pe)return{value:void 0,done:!0};var Ee=X[it?pe-++De:De++];return te(Ze,Ee,Rt[Ee])})},fe}(le);Re.prototype[G]=!0;var we,ke=function(he){function fe(ze){this._collection=ze,this.size=ze.length||ze.size}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.__iterateUncached=function(Ze,it){if(it)return this.cacheResult().__iterate(Ze,it);var X=Z(this._collection),pe=0;if(j(X))for(var De;!(De=X.next()).done&&!1!==Ze(De.value,pe++,this););return pe},fe.prototype.__iteratorUncached=function(Ze,it){if(it)return this.cacheResult().__iterator(Ze,it);var X=Z(this._collection);if(!j(X))return new W(de);var pe=0;return new W(function(){var De=X.next();return De.done?De:te(Ze,pe++,De.value)})},fe}(Ae);function Oe(){return we||(we=new Ce([]))}function Se(he){var fe=K(he);if(fe)return fe.fromEntrySeq();if("object"==typeof he)return new Re(he);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+he)}function Ve(he){var fe=K(he);if(fe)return fe;throw new TypeError("Expected Array or collection object of values: "+he)}function K(he){return _e(he)?new Ce(he):ye(he)?new ke(he):void 0}var ne="@@__IMMUTABLE_MAP__@@";function be(he){return!(!he||!he[ne])}function Te(he){return be(he)&&V(he)}function ie(he){return!(!he||"function"!=typeof he.equals||"function"!=typeof he.hashCode)}function ue(he,fe){if(he===fe||he!=he&&fe!=fe)return!0;if(!he||!fe)return!1;if("function"==typeof he.valueOf&&"function"==typeof fe.valueOf){if((he=he.valueOf())===(fe=fe.valueOf())||he!=he&&fe!=fe)return!0;if(!he||!fe)return!1}return!!(ie(he)&&ie(fe)&&he.equals(fe))}var re="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(fe,ze){var Ze=65535&(fe|=0),it=65535&(ze|=0);return Ze*it+((fe>>>16)*it+Ze*(ze>>>16)<<16>>>0)|0};function ve(he){return he>>>1&1073741824|3221225471&he}var ce=Object.prototype.valueOf;function se(he){if(null==he)return ae(he);if("function"==typeof he.hashCode)return ve(he.hashCode(he));var fe=function Bt(he){return he.valueOf!==ce&&"function"==typeof he.valueOf?he.valueOf(he):he}(he);if(null==fe)return ae(fe);switch(typeof fe){case"boolean":return fe?1108378657:1108378656;case"number":return function ge(he){if(he!=he||he===1/0)return 0;var fe=0|he;for(fe!==he&&(fe^=4294967295*he);he>4294967295;)fe^=he/=4294967295;return ve(fe)}(fe);case"string":return fe.length>ut?function Ie(he){var fe=gt[he];return void 0===fe&&(fe=Le(he),sn===Kt&&(sn=0,gt={}),sn++,gt[he]=fe),fe}(fe):Le(fe);case"object":case"function":return function je(he){var fe;if($e&&void 0!==(fe=mt.get(he))||void 0!==(fe=he[Ke])||!Je&&(void 0!==(fe=he.propertyIsEnumerable&&he.propertyIsEnumerable[Ke])||(fe=function en(he){if(he&&he.nodeType>0)switch(he.nodeType){case 1:return he.uniqueID;case 9:return he.documentElement&&he.documentElement.uniqueID}}(he),void 0!==fe)))return fe;if(fe=pn(),$e)mt.set(he,fe);else{if(void 0!==Lt&&!1===Lt(he))throw new Error("Non-extensible objects are not allowed as keys.");if(Je)Object.defineProperty(he,Ke,{enumerable:!1,configurable:!1,writable:!1,value:fe});else if(void 0!==he.propertyIsEnumerable&&he.propertyIsEnumerable===he.constructor.prototype.propertyIsEnumerable)he.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},he.propertyIsEnumerable[Ke]=fe;else{if(void 0===he.nodeType)throw new Error("Unable to set a non-enumerable property on object.");he[Ke]=fe}}return fe}(fe);case"symbol":return function nt(he){var fe=_t[he];return void 0!==fe||(fe=pn(),_t[he]=fe),fe}(fe);default:if("function"==typeof fe.toString)return Le(fe.toString());throw new Error("Value type "+typeof fe+" cannot be hashed.")}}function ae(he){return null===he?1108378658:1108378659}function Le(he){for(var fe=0,ze=0;ze<he.length;ze++)fe=31*fe+he.charCodeAt(ze)|0;return ve(fe)}var Lt=Object.isExtensible,Je=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function pn(){var he=++Me;return 1073741824&Me&&(Me=0),he}var mt,$e="function"==typeof WeakMap;$e&&(mt=new WeakMap);var _t=Object.create(null),Me=0,Ke="__immutablehash__";"function"==typeof Symbol&&(Ke=Symbol(Ke));var ut=16,Kt=255,sn=0,gt={},yt=function(he){function fe(ze,Ze){this._iter=ze,this._useKeys=Ze,this.size=ze.size}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.get=function(Ze,it){return this._iter.get(Ze,it)},fe.prototype.has=function(Ze){return this._iter.has(Ze)},fe.prototype.valueSeq=function(){return this._iter.valueSeq()},fe.prototype.reverse=function(){var Ze=this,it=nn(this,!0);return this._useKeys||(it.valueSeq=function(){return Ze._iter.toSeq().reverse()}),it},fe.prototype.map=function(Ze,it){var Rt=this,X=Mt(this,Ze,it);return this._useKeys||(X.valueSeq=function(){return Rt._iter.toSeq().map(Ze,it)}),X},fe.prototype.__iterate=function(Ze,it){var Rt=this;return this._iter.__iterate(function(X,pe){return Ze(X,pe,Rt)},it)},fe.prototype.__iterator=function(Ze,it){return this._iter.__iterator(Ze,it)},fe}(le);yt.prototype[G]=!0;var At=function(he){function fe(ze){this._iter=ze,this.size=ze.size}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.includes=function(Ze){return this._iter.includes(Ze)},fe.prototype.__iterate=function(Ze,it){var Rt=this,X=0;return it&&v(this),this._iter.__iterate(function(pe){return Ze(pe,it?Rt.size-++X:X++,Rt)},it)},fe.prototype.__iterator=function(Ze,it){var Rt=this,X=this._iter.__iterator(N,it),pe=0;return it&&v(this),new W(function(){var De=X.next();return De.done?De:te(Ze,it?Rt.size-++pe:pe++,De.value,De)})},fe}(Ae),Gt=function(he){function fe(ze){this._iter=ze,this.size=ze.size}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.has=function(Ze){return this._iter.includes(Ze)},fe.prototype.__iterate=function(Ze,it){var Rt=this;return this._iter.__iterate(function(X){return Ze(X,X,Rt)},it)},fe.prototype.__iterator=function(Ze,it){var Rt=this._iter.__iterator(N,it);return new W(function(){var X=Rt.next();return X.done?X:te(Ze,X.value,X.value,X)})},fe}(Be),rn=function(he){function fe(ze){this._iter=ze,this.size=ze.size}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.entrySeq=function(){return this._iter.toSeq()},fe.prototype.__iterate=function(Ze,it){var Rt=this;return this._iter.__iterate(function(X){if(X){fr(X);var pe=d(X);return Ze(pe?X.get(1):X[1],pe?X.get(0):X[0],Rt)}},it)},fe.prototype.__iterator=function(Ze,it){var Rt=this._iter.__iterator(N,it);return new W(function(){for(;;){var X=Rt.next();if(X.done)return X;var pe=X.value;if(pe){fr(pe);var De=d(pe);return te(Ze,De?pe.get(0):pe[0],De?pe.get(1):pe[1],X)}}})},fe}(le);function tt(he){var fe=Pr(he);return fe._iter=he,fe.size=he.size,fe.flip=function(){return he},fe.reverse=function(){var ze=he.reverse.apply(this);return ze.flip=function(){return he.reverse()},ze},fe.has=function(ze){return he.includes(ze)},fe.includes=function(ze){return he.has(ze)},fe.cacheResult=or,fe.__iterateUncached=function(ze,Ze){var it=this;return he.__iterate(function(Rt,X){return!1!==ze(X,Rt,it)},Ze)},fe.__iteratorUncached=function(ze,Ze){if(ze===k){var it=he.__iterator(ze,Ze);return new W(function(){var Rt=it.next();if(!Rt.done){var X=Rt.value[0];Rt.value[0]=Rt.value[1],Rt.value[1]=X}return Rt})}return he.__iterator(ze===N?U:N,Ze)},fe}function Mt(he,fe,ze){var Ze=Pr(he);return Ze.size=he.size,Ze.has=function(it){return he.has(it)},Ze.get=function(it,Rt){var X=he.get(it,A);return X===A?Rt:fe.call(ze,X,it,he)},Ze.__iterateUncached=function(it,Rt){var X=this;return he.__iterate(function(pe,De,Ee){return!1!==it(fe.call(ze,pe,De,Ee),De,X)},Rt)},Ze.__iteratorUncached=function(it,Rt){var X=he.__iterator(k,Rt);return new W(function(){var pe=X.next();if(pe.done)return pe;var De=pe.value,Ee=De[0];return te(it,Ee,fe.call(ze,De[1],Ee,he),pe)})},Ze}function nn(he,fe){var ze=this,Ze=Pr(he);return Ze._iter=he,Ze.size=he.size,Ze.reverse=function(){return he},he.flip&&(Ze.flip=function(){var it=tt(he);return it.reverse=function(){return he.flip()},it}),Ze.get=function(it,Rt){return he.get(fe?it:-1-it,Rt)},Ze.has=function(it){return he.has(fe?it:-1-it)},Ze.includes=function(it){return he.includes(it)},Ze.cacheResult=or,Ze.__iterate=function(it,Rt){var X=this,pe=0;return Rt&&v(he),he.__iterate(function(De,Ee){return it(De,fe?Ee:Rt?X.size-++pe:pe++,X)},!Rt)},Ze.__iterator=function(it,Rt){var X=0;Rt&&v(he);var pe=he.__iterator(k,!Rt);return new W(function(){var De=pe.next();if(De.done)return De;var Ee=De.value;return te(it,fe?Ee[0]:Rt?ze.size-++X:X++,Ee[1],De)})},Ze}function bn(he,fe,ze,Ze){var it=Pr(he);return Ze&&(it.has=function(Rt){var X=he.get(Rt,A);return X!==A&&!!fe.call(ze,X,Rt,he)},it.get=function(Rt,X){var pe=he.get(Rt,A);return pe!==A&&fe.call(ze,pe,Rt,he)?pe:X}),it.__iterateUncached=function(Rt,X){var pe=this,De=0;return he.__iterate(function(Ee,qe,bt){if(fe.call(ze,Ee,qe,bt))return De++,Rt(Ee,Ze?qe:De-1,pe)},X),De},it.__iteratorUncached=function(Rt,X){var pe=he.__iterator(k,X),De=0;return new W(function(){for(;;){var Ee=pe.next();if(Ee.done)return Ee;var qe=Ee.value,bt=qe[0],xt=qe[1];if(fe.call(ze,xt,bt,he))return te(Rt,Ze?bt:De++,xt,Ee)}})},it}function Dt(he,fe,ze,Ze){var it=he.size;if(_(fe,ze,it))return he;var Rt=M(fe,it),X=I(ze,it);if(Rt!=Rt||X!=X)return Dt(he.toSeq().cacheResult(),fe,ze,Ze);var De,pe=X-Rt;pe==pe&&(De=pe<0?0:pe);var Ee=Pr(he);return Ee.size=0===De?De:he.size&&De||void 0,!Ze&&T(he)&&De>=0&&(Ee.get=function(qe,bt){return(qe=O(this,qe))>=0&&qe<De?he.get(qe+Rt,bt):bt}),Ee.__iterateUncached=function(qe,bt){var xt=this;if(0===De)return 0;if(bt)return this.cacheResult().__iterate(qe,bt);var hn=0,dn=!0,In=0;return he.__iterate(function(Tn,_n){if(!dn||!(dn=hn++<Rt))return In++,!1!==qe(Tn,Ze?_n:In-1,xt)&&In!==De}),In},Ee.__iteratorUncached=function(qe,bt){if(0!==De&&bt)return this.cacheResult().__iterator(qe,bt);if(0===De)return new W(de);var xt=he.__iterator(qe,bt),hn=0,dn=0;return new W(function(){for(;hn++<Rt;)xt.next();if(++dn>De)return{value:void 0,done:!0};var In=xt.next();return Ze||qe===N||In.done?In:te(qe,dn-1,qe===U?void 0:In.value[1],In)})},Ee}function $t(he,fe,ze,Ze){var it=Pr(he);return it.__iterateUncached=function(Rt,X){var pe=this;if(X)return this.cacheResult().__iterate(Rt,X);var De=!0,Ee=0;return he.__iterate(function(qe,bt,xt){if(!De||!(De=fe.call(ze,qe,bt,xt)))return Ee++,Rt(qe,Ze?bt:Ee-1,pe)}),Ee},it.__iteratorUncached=function(Rt,X){var pe=this;if(X)return this.cacheResult().__iterator(Rt,X);var De=he.__iterator(k,X),Ee=!0,qe=0;return new W(function(){var bt,xt,hn;do{if((bt=De.next()).done)return Ze||Rt===N?bt:te(Rt,qe++,Rt===U?void 0:bt.value[1],bt);var dn=bt.value;xt=dn[0],hn=dn[1],Ee&&(Ee=fe.call(ze,hn,xt,pe))}while(Ee);return Rt===k?bt:te(Rt,xt,hn,bt)})},it}function Wt(he,fe,ze){var Ze=Pr(he);return Ze.__iterateUncached=function(it,Rt){if(Rt)return this.cacheResult().__iterate(it,Rt);var X=0,pe=!1;return function De(Ee,qe){Ee.__iterate(function(bt,xt){return(!fe||qe<fe)&&d(bt)?De(bt,qe+1):(X++,!1===it(bt,ze?xt:X-1,Ze)&&(pe=!0)),!pe},Rt)}(he,0),X},Ze.__iteratorUncached=function(it,Rt){if(Rt)return this.cacheResult().__iterator(it,Rt);var X=he.__iterator(it,Rt),pe=[],De=0;return new W(function(){for(;X;){var Ee=X.next();if(!1===Ee.done){var qe=Ee.value;if(it===k&&(qe=qe[1]),fe&&!(pe.length<fe)||!d(qe))return ze?Ee:te(it,De++,qe,Ee);pe.push(X),X=qe.__iterator(it,Rt)}else X=pe.pop()}return{value:void 0,done:!0}})},Ze}function kt(he,fe,ze){fe||(fe=Nr);var Ze=C(he),it=0,Rt=he.toSeq().map(function(X,pe){return[pe,X,it++,ze?ze(X,pe,he):X]}).valueSeq().toArray();return Rt.sort(function(X,pe){return fe(X[3],pe[3])||X[2]-pe[2]}).forEach(Ze?function(X,pe){Rt[pe].length=2}:function(X,pe){Rt[pe]=X[1]}),Ze?le(Rt):a(he)?Ae(Rt):Be(Rt)}function Ot(he,fe,ze){if(fe||(fe=Nr),ze){var Ze=he.toSeq().map(function(it,Rt){return[it,ze(it,Rt,he)]}).reduce(function(it,Rt){return An(fe,it[1],Rt[1])?Rt:it});return Ze&&Ze[0]}return he.reduce(function(it,Rt){return An(fe,it,Rt)?Rt:it})}function An(he,fe,ze){var Ze=he(ze,fe);return 0===Ze&&ze!==fe&&(null==ze||ze!=ze)||Ze>0}function jn(he,fe,ze,Ze){var it=Pr(he),Rt=new Ce(ze).map(function(X){return X.size});return it.size=Ze?Rt.max():Rt.min(),it.__iterate=function(X,pe){for(var Ee,De=this.__iterator(N,pe),qe=0;!(Ee=De.next()).done&&!1!==X(Ee.value,qe++,this););return qe},it.__iteratorUncached=function(X,pe){var De=ze.map(function(bt){return bt=D(bt),Z(pe?bt.reverse():bt)}),Ee=0,qe=!1;return new W(function(){var bt;return qe||(bt=De.map(function(xt){return xt.next()}),qe=Ze?bt.every(function(xt){return xt.done}):bt.some(function(xt){return xt.done})),qe?{value:void 0,done:!0}:te(X,Ee++,fe.apply(null,bt.map(function(xt){return xt.value})))})},it}function On(he,fe){return he===fe?he:T(he)?fe:he.constructor(fe)}function fr(he){if(he!==Object(he))throw new TypeError("Expected [K, V] tuple: "+he)}function Dr(he){return C(he)?R:a(he)?f:p}function Pr(he){return Object.create((C(he)?le:a(he)?Ae:Be).prototype)}function or(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):xe.prototype.cacheResult.call(this)}function Nr(he,fe){return void 0===he&&void 0===fe?0:void 0===he?1:void 0===fe?-1:he>fe?1:he<fe?-1:0}function Ir(he,fe){fe=fe||0;for(var ze=Math.max(0,he.length-fe),Ze=new Array(ze),it=0;it<ze;it++)Ze[it]=he[it+fe];return Ze}function Or(he,fe){if(!he)throw new Error(fe)}function Jr(he){Or(he!==1/0,"Cannot perform this action with an infinite size.")}function To(he){if(_e(he)&&"string"!=typeof he)return he;if(V(he))return he.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+he)}At.prototype.cacheResult=yt.prototype.cacheResult=Gt.prototype.cacheResult=rn.prototype.cacheResult=or;var un=Object.prototype.toString;function dt(he){return"object"==typeof he&&(Q(he)||Array.isArray(he)||function ct(he){if(!he||"object"!=typeof he||"[object Object]"!==un.call(he))return!1;var fe=Object.getPrototypeOf(he);if(null===fe)return!0;for(var ze=fe,Ze=Object.getPrototypeOf(fe);null!==Ze;)ze=Ze,Ze=Object.getPrototypeOf(ze);return ze===fe}(he))}function Yt(he){try{return"string"==typeof he?JSON.stringify(he):String(he)}catch{return JSON.stringify(he)}}function xn(he,fe,ze){return Q(he)?he.get(fe,ze):function cn(he,fe){return Q(he)?he.has(fe):dt(he)&&g.call(he,fe)}(he,fe)?"function"==typeof he.get?he.get(fe):he[fe]:ze}function Rn(he){if(Array.isArray(he))return Ir(he);var fe={};for(var ze in he)g.call(he,ze)&&(fe[ze]=he[ze]);return fe}function Yn(he,fe,ze,Ze){Ze||(Ze=ze,ze=void 0);var it=br(Q(he),he,To(fe),0,ze,Ze);return it===A?ze:it}function br(he,fe,ze,Ze,it,Rt){var X=fe===A;if(Ze===ze.length){var pe=X?it:fe,De=Rt(pe);return De===pe?fe:De}if(!X&&!dt(fe))throw new TypeError("Cannot update within non-data-structure value in path ["+ze.slice(0,Ze).map(Yt)+"]: "+fe);var Ee=ze[Ze],qe=X?A:xn(fe,Ee,A),bt=br(qe===A?he:Q(qe),qe,ze,Ze+1,it,Rt);return bt===qe?fe:bt===A?function er(he,fe){if(!dt(he))throw new TypeError("Cannot update non-data-structure value: "+he);if(Q(he)){if(!he.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+he);return he.remove(fe)}if(!g.call(he,fe))return he;var ze=Rn(he);return Array.isArray(ze)?ze.splice(fe,1):delete ze[fe],ze}(fe,Ee):function ir(he,fe,ze){if(!dt(he))throw new TypeError("Cannot update non-data-structure value: "+he);if(Q(he)){if(!he.set)throw new TypeError("Cannot update immutable value without .set() method: "+he);return he.set(fe,ze)}if(g.call(he,fe)&&ze===he[fe])return he;var Ze=Rn(he);return Ze[fe]=ze,Ze}(X?he?zt():{}:fe,Ee,bt)}function Hr(he,fe){return function vr(he,fe,ze){return Yn(he,fe,A,function(){return ze})}(this,he,fe)}function Fr(he){return function Mr(he,fe){return Yn(he,fe,function(){return A})}(this,he)}function Sr(he,fe,ze,Ze){return Yn(he,[fe],ze,Ze)}function Ur(he,fe,ze){return 1===arguments.length?he(this):Sr(this,he,fe,ze)}function Ro(he,fe,ze){return Yn(this,he,fe,ze)}function ro(){for(var he=[],fe=arguments.length;fe--;)he[fe]=arguments[fe];return so(this,he)}function po(he){for(var fe=[],ze=arguments.length-1;ze-- >0;)fe[ze]=arguments[ze+1];if("function"!=typeof he)throw new TypeError("Invalid merger function: "+he);return so(this,fe,he)}function so(he,fe,ze){for(var Ze=[],it=0;it<fe.length;it++){var Rt=R(fe[it]);0!==Rt.size&&Ze.push(Rt)}return 0===Ze.length?he:0!==he.toSeq().size||he.__ownerID||1!==Ze.length?he.withMutations(function(X){for(var pe=ze?function(Ee,qe){Sr(X,qe,A,function(bt){return bt===A?Ee:ze(bt,Ee,qe)})}:function(Ee,qe){X.set(qe,Ee)},De=0;De<Ze.length;De++)Ze[De].forEach(pe)}):he.constructor(Ze[0])}function We(he,fe,ze){return Pt(he,fe,function Sn(he){return function fe(ze,Ze,it){return dt(ze)&&dt(Ze)&&function Nn(he,fe){var ze=xe(he),Ze=xe(fe);return a(ze)===a(Ze)&&C(ze)===C(Ze)}(ze,Ze)?Pt(ze,[Ze],fe):he?he(ze,Ze,it):Ze}}(ze))}function Pt(he,fe,ze){if(!dt(he))throw new TypeError("Cannot merge into non-data-structure value: "+he);if(Q(he))return"function"==typeof ze&&he.mergeWith?he.mergeWith.apply(he,[ze].concat(fe)):he.merge?he.merge.apply(he,fe):he.concat.apply(he,fe);for(var Ze=Array.isArray(he),it=he,Rt=Ze?f:R,X=Ze?function(De){it===he&&(it=Rn(it)),it.push(De)}:function(De,Ee){var qe=g.call(it,Ee),bt=qe&&ze?ze(it[Ee],De,Ee):De;(!qe||bt!==it[Ee])&&(it===he&&(it=Rn(it)),it[Ee]=bt)},pe=0;pe<fe.length;pe++)Rt(fe[pe]).forEach(X);return it}function Kn(){for(var he=[],fe=arguments.length;fe--;)he[fe]=arguments[fe];return We(this,he)}function dr(he){for(var fe=[],ze=arguments.length-1;ze-- >0;)fe[ze]=arguments[ze+1];return We(this,fe,he)}function xr(he){for(var fe=[],ze=arguments.length-1;ze-- >0;)fe[ze]=arguments[ze+1];return Yn(this,he,zt(),function(Ze){return Pt(Ze,fe)})}function Ft(he){for(var fe=[],ze=arguments.length-1;ze-- >0;)fe[ze]=arguments[ze+1];return Yn(this,he,zt(),function(Ze){return We(Ze,fe)})}function Qt(he){var fe=this.asMutable();return he(fe),fe.wasAltered()?fe.__ensureOwner(this.__ownerID):this}function ht(){return this.__ownerID?this:this.__ensureOwner(new i)}function pt(){return this.__ensureOwner()}function Xt(){return this.__altered}var fn=function(he){function fe(ze){return null==ze?zt():be(ze)&&!V(ze)?ze:zt().withMutations(function(Ze){var it=he(ze);Jr(it.size),it.forEach(function(Rt,X){return Ze.set(X,Rt)})})}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){for(var Ze=[],it=arguments.length;it--;)Ze[it]=arguments[it];return zt().withMutations(function(Rt){for(var X=0;X<Ze.length;X+=2){if(X+1>=Ze.length)throw new Error("Missing value for key: "+Ze[X]);Rt.set(Ze[X],Ze[X+1])}})},fe.prototype.toString=function(){return this.__toString("Map {","}")},fe.prototype.get=function(Ze,it){return this._root?this._root.get(0,void 0,Ze,it):it},fe.prototype.set=function(Ze,it){return an(this,Ze,it)},fe.prototype.remove=function(Ze){return an(this,Ze,A)},fe.prototype.deleteAll=function(Ze){var it=D(Ze);return 0===it.size?this:this.withMutations(function(Rt){it.forEach(function(X){return Rt.remove(X)})})},fe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):zt()},fe.prototype.sort=function(Ze){return Ci(kt(this,Ze))},fe.prototype.sortBy=function(Ze,it){return Ci(kt(this,it,Ze))},fe.prototype.map=function(Ze,it){var Rt=this;return this.withMutations(function(X){X.forEach(function(pe,De){X.set(De,Ze.call(it,pe,De,Rt))})})},fe.prototype.__iterator=function(Ze,it){return new ot(this,Ze,it)},fe.prototype.__iterate=function(Ze,it){var Rt=this,X=0;return this._root&&this._root.iterate(function(pe){return X++,Ze(pe[1],pe[0],Rt)},it),X},fe.prototype.__ensureOwner=function(Ze){return Ze===this.__ownerID?this:Ze?vt(this.size,this._root,Ze,this.__hash):0===this.size?zt():(this.__ownerID=Ze,this.__altered=!1,this)},fe}(R);fn.isMap=be;var on=fn.prototype;on[ne]=!0,on[e]=on.remove,on.removeAll=on.deleteAll,on.setIn=Hr,on.removeIn=on.deleteIn=Fr,on.update=Ur,on.updateIn=Ro,on.merge=on.concat=ro,on.mergeWith=po,on.mergeDeep=Kn,on.mergeDeepWith=dr,on.mergeIn=xr,on.mergeDeepIn=Ft,on.withMutations=Qt,on.wasAltered=Xt,on.asImmutable=pt,on["@@transducer/init"]=on.asMutable=ht,on["@@transducer/step"]=function(he,fe){return he.set(fe[0],fe[1])},on["@@transducer/result"]=function(he){return he.asImmutable()};var En=function(fe,ze){this.ownerID=fe,this.entries=ze};En.prototype.get=function(fe,ze,Ze,it){for(var Rt=this.entries,X=0,pe=Rt.length;X<pe;X++)if(ue(Ze,Rt[X][0]))return Rt[X][1];return it},En.prototype.update=function(fe,ze,Ze,it,Rt,X,pe){for(var De=Rt===A,Ee=this.entries,qe=0,bt=Ee.length;qe<bt&&!ue(it,Ee[qe][0]);qe++);var xt=qe<bt;if(xt?Ee[qe][1]===Rt:De)return this;if(c(pe),(De||!xt)&&c(X),!De||1!==Ee.length){if(!xt&&!De&&Ee.length>=vo)return function Vr(he,fe,ze,Ze){he||(he=new i);for(var it=new Ye(he,se(ze),[ze,Ze]),Rt=0;Rt<fe.length;Rt++){var X=fe[Rt];it=it.update(he,0,void 0,X[0],X[1])}return it}(fe,Ee,it,Rt);var hn=fe&&fe===this.ownerID,dn=hn?Ee:Ir(Ee);return xt?De?qe===bt-1?dn.pop():dn[qe]=dn.pop():dn[qe]=[it,Rt]:dn.push([it,Rt]),hn?(this.entries=dn,this):new En(fe,dn)}};var Tt=function(fe,ze,Ze){this.ownerID=fe,this.bitmap=ze,this.nodes=Ze};Tt.prototype.get=function(fe,ze,Ze,it){void 0===ze&&(ze=se(Ze));var Rt=1<<((0===fe?ze:ze>>>fe)&t),X=this.bitmap;return X&Rt?this.nodes[oo(X&Rt-1)].get(fe+o,ze,Ze,it):it},Tt.prototype.update=function(fe,ze,Ze,it,Rt,X,pe){void 0===Ze&&(Ze=se(it));var De=(0===ze?Ze:Ze>>>ze)&t,Ee=1<<De,qe=this.bitmap,bt=!!(qe&Ee);if(!bt&&Rt===A)return this;var xt=oo(qe&Ee-1),hn=this.nodes,dn=bt?hn[xt]:void 0,In=Vn(dn,fe,ze+o,Ze,it,Rt,X,pe);if(In===dn)return this;if(!bt&&In&&hn.length>=Kr)return function Tr(he,fe,ze,Ze,it){for(var Rt=0,X=new Array(r),pe=0;0!==ze;pe++,ze>>>=1)X[pe]=1&ze?fe[Rt++]:void 0;return X[Ze]=it,new Fe(he,Rt+1,X)}(fe,hn,qe,De,In);if(bt&&!In&&2===hn.length&&Fn(hn[1^xt]))return hn[1^xt];if(bt&&In&&1===hn.length&&Fn(In))return In;var Tn=fe&&fe===this.ownerID,_n=bt?In?qe:qe^Ee:qe|Ee,Wn=bt?In?Gr(hn,xt,In,Tn):function yo(he,fe,ze){var Ze=he.length-1;if(ze&&fe===Ze)return he.pop(),he;for(var it=new Array(Ze),Rt=0,X=0;X<Ze;X++)X===fe&&(Rt=1),it[X]=he[X+Rt];return it}(hn,xt,Tn):function Ao(he,fe,ze,Ze){var it=he.length+1;if(Ze&&fe+1===it)return he[fe]=ze,he;for(var Rt=new Array(it),X=0,pe=0;pe<it;pe++)pe===fe?(Rt[pe]=ze,X=-1):Rt[pe]=he[pe+X];return Rt}(hn,xt,In,Tn);return Tn?(this.bitmap=_n,this.nodes=Wn,this):new Tt(fe,_n,Wn)};var Fe=function(fe,ze,Ze){this.ownerID=fe,this.count=ze,this.nodes=Ze};Fe.prototype.get=function(fe,ze,Ze,it){void 0===ze&&(ze=se(Ze));var X=this.nodes[(0===fe?ze:ze>>>fe)&t];return X?X.get(fe+o,ze,Ze,it):it},Fe.prototype.update=function(fe,ze,Ze,it,Rt,X,pe){void 0===Ze&&(Ze=se(it));var De=(0===ze?Ze:Ze>>>ze)&t,qe=this.nodes,bt=qe[De];if(Rt===A&&!bt)return this;var xt=Vn(bt,fe,ze+o,Ze,it,Rt,X,pe);if(xt===bt)return this;var hn=this.count;if(bt){if(!xt&&--hn<Do)return function tr(he,fe,ze,Ze){for(var it=0,Rt=0,X=new Array(ze),pe=0,De=1,Ee=fe.length;pe<Ee;pe++,De<<=1){var qe=fe[pe];void 0!==qe&&pe!==Ze&&(it|=De,X[Rt++]=qe)}return new Tt(he,it,X)}(fe,qe,hn,De)}else hn++;var dn=fe&&fe===this.ownerID,In=Gr(qe,De,xt,dn);return dn?(this.count=hn,this.nodes=In,this):new Fe(fe,hn,In)};var He=function(fe,ze,Ze){this.ownerID=fe,this.keyHash=ze,this.entries=Ze};He.prototype.get=function(fe,ze,Ze,it){for(var Rt=this.entries,X=0,pe=Rt.length;X<pe;X++)if(ue(Ze,Rt[X][0]))return Rt[X][1];return it},He.prototype.update=function(fe,ze,Ze,it,Rt,X,pe){void 0===Ze&&(Ze=se(it));var De=Rt===A;if(Ze!==this.keyHash)return De?this:(c(pe),c(X),rr(this,fe,ze,Ze,[it,Rt]));for(var Ee=this.entries,qe=0,bt=Ee.length;qe<bt&&!ue(it,Ee[qe][0]);qe++);var xt=qe<bt;if(xt?Ee[qe][1]===Rt:De)return this;if(c(pe),(De||!xt)&&c(X),De&&2===bt)return new Ye(fe,this.keyHash,Ee[1^qe]);var hn=fe&&fe===this.ownerID,dn=hn?Ee:Ir(Ee);return xt?De?qe===bt-1?dn.pop():dn[qe]=dn.pop():dn[qe]=[it,Rt]:dn.push([it,Rt]),hn?(this.entries=dn,this):new He(fe,this.keyHash,dn)};var Ye=function(fe,ze,Ze){this.ownerID=fe,this.keyHash=ze,this.entry=Ze};Ye.prototype.get=function(fe,ze,Ze,it){return ue(Ze,this.entry[0])?this.entry[1]:it},Ye.prototype.update=function(fe,ze,Ze,it,Rt,X,pe){var De=Rt===A,Ee=ue(it,this.entry[0]);return(Ee?Rt===this.entry[1]:De)?this:(c(pe),De?void c(X):Ee?fe&&fe===this.ownerID?(this.entry[1]=Rt,this):new Ye(fe,this.keyHash,[it,Rt]):(c(X),rr(this,fe,ze,se(it),[it,Rt])))},En.prototype.iterate=He.prototype.iterate=function(he,fe){for(var ze=this.entries,Ze=0,it=ze.length-1;Ze<=it;Ze++)if(!1===he(ze[fe?it-Ze:Ze]))return!1},Tt.prototype.iterate=Fe.prototype.iterate=function(he,fe){for(var ze=this.nodes,Ze=0,it=ze.length-1;Ze<=it;Ze++){var Rt=ze[fe?it-Ze:Ze];if(Rt&&!1===Rt.iterate(he,fe))return!1}},Ye.prototype.iterate=function(he,fe){return he(this.entry)};var mn,ot=function(he){function fe(ze,Ze,it){this._type=Ze,this._reverse=it,this._stack=ze._root&&St(ze._root)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.next=function(){for(var Ze=this._type,it=this._stack;it;){var Rt=it.node,X=it.index++,pe=void 0;if(Rt.entry){if(0===X)return rt(Ze,Rt.entry)}else if(Rt.entries){if(X<=(pe=Rt.entries.length-1))return rt(Ze,Rt.entries[this._reverse?pe-X:X])}else if(X<=(pe=Rt.nodes.length-1)){var De=Rt.nodes[this._reverse?pe-X:X];if(De){if(De.entry)return rt(Ze,De.entry);it=this._stack=St(De,it)}continue}it=this._stack=this._stack.__prev}return{value:void 0,done:!0}},fe}(W);function rt(he,fe){return te(he,fe[0],fe[1])}function St(he,fe){return{node:he,index:0,__prev:fe}}function vt(he,fe,ze,Ze){var it=Object.create(on);return it.size=he,it._root=fe,it.__ownerID=ze,it.__hash=Ze,it.__altered=!1,it}function zt(){return mn||(mn=vt(0))}function an(he,fe,ze){var Ze,it;if(he._root){var Rt={value:!1},X={value:!1};if(Ze=Vn(he._root,he.__ownerID,0,void 0,fe,ze,Rt,X),!X.value)return he;it=he.size+(Rt.value?ze===A?-1:1:0)}else{if(ze===A)return he;it=1,Ze=new En(he.__ownerID,[[fe,ze]])}return he.__ownerID?(he.size=it,he._root=Ze,he.__hash=void 0,he.__altered=!0,he):Ze?vt(it,Ze):zt()}function Vn(he,fe,ze,Ze,it,Rt,X,pe){return he?he.update(fe,ze,Ze,it,Rt,X,pe):Rt===A?he:(c(pe),c(X),new Ye(fe,Ze,[it,Rt]))}function Fn(he){return he.constructor===Ye||he.constructor===He}function rr(he,fe,ze,Ze,it){if(he.keyHash===Ze)return new He(fe,Ze,[he.entry,it]);var pe,Rt=(0===ze?he.keyHash:he.keyHash>>>ze)&t,X=(0===ze?Ze:Ze>>>ze)&t,De=Rt===X?[rr(he,fe,ze+o,Ze,it)]:(pe=new Ye(fe,Ze,it),Rt<X?[he,pe]:[pe,he]);return new Tt(fe,1<<Rt|1<<X,De)}function oo(he){return he=(he=(858993459&(he-=he>>1&1431655765))+(he>>2&858993459))+(he>>4)&252645135,127&(he+=he>>8)+(he>>16)}function Gr(he,fe,ze,Ze){var it=Ze?he:Ir(he);return it[fe]=ze,it}var vo=r/4,Kr=r/2,Do=r/4,lo="@@__IMMUTABLE_LIST__@@";function So(he){return!(!he||!he[lo])}var ao=function(he){function fe(ze){var Ze=ei();if(null==ze)return Ze;if(So(ze))return ze;var it=he(ze),Rt=it.size;return 0===Rt?Ze:(Jr(Rt),Rt>0&&Rt<r?Eo(0,Rt,o,null,new Yr(it.toArray())):Ze.withMutations(function(X){X.setSize(Rt),it.forEach(function(pe,De){return X.set(De,pe)})}))}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return this(arguments)},fe.prototype.toString=function(){return this.__toString("List [","]")},fe.prototype.get=function(Ze,it){if((Ze=O(this,Ze))>=0&&Ze<this.size){var Rt=Fi(this,Ze+=this._origin);return Rt&&Rt.array[Ze&t]}return it},fe.prototype.set=function(Ze,it){return function Yo(he,fe,ze){if((fe=O(he,fe))!=fe)return he;if(fe>=he.size||fe<0)return he.withMutations(function(X){fe<0?hi(X,fe).set(0,ze):hi(X,0,fe+1).set(fe,ze)});var Ze=he._tail,it=he._root,Rt={value:!1};return(fe+=he._origin)>=No(he._capacity)?Ze=ci(Ze,he.__ownerID,0,fe,ze,Rt):it=ci(it,he.__ownerID,he._level,fe,ze,Rt),Rt.value?he.__ownerID?(he._root=it,he._tail=Ze,he.__hash=void 0,he.__altered=!0,he):Eo(he._origin,he._capacity,he._level,it,Ze):he}(this,Ze,it)},fe.prototype.remove=function(Ze){return this.has(Ze)?0===Ze?this.shift():Ze===this.size-1?this.pop():this.splice(Ze,1):this},fe.prototype.insert=function(Ze,it){return this.splice(Ze,0,it)},fe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=o,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):ei()},fe.prototype.push=function(){var Ze=arguments,it=this.size;return this.withMutations(function(Rt){hi(Rt,0,it+Ze.length);for(var X=0;X<Ze.length;X++)Rt.set(it+X,Ze[X])})},fe.prototype.pop=function(){return hi(this,0,-1)},fe.prototype.unshift=function(){var Ze=arguments;return this.withMutations(function(it){hi(it,-Ze.length);for(var Rt=0;Rt<Ze.length;Rt++)it.set(Rt,Ze[Rt])})},fe.prototype.shift=function(){return hi(this,1)},fe.prototype.concat=function(){for(var Ze=arguments,it=[],Rt=0;Rt<arguments.length;Rt++){var X=Ze[Rt],pe=he("string"!=typeof X&&ye(X)?X:[X]);0!==pe.size&&it.push(pe)}return 0===it.length?this:0!==this.size||this.__ownerID||1!==it.length?this.withMutations(function(De){it.forEach(function(Ee){return Ee.forEach(function(qe){return De.push(qe)})})}):this.constructor(it[0])},fe.prototype.setSize=function(Ze){return hi(this,0,Ze)},fe.prototype.map=function(Ze,it){var Rt=this;return this.withMutations(function(X){for(var pe=0;pe<Rt.size;pe++)X.set(pe,Ze.call(it,X.get(pe),pe,Rt))})},fe.prototype.slice=function(Ze,it){var Rt=this.size;return _(Ze,it,Rt)?this:hi(this,M(Ze,Rt),I(it,Rt))},fe.prototype.__iterator=function(Ze,it){var Rt=it?this.size:0,X=Co(this,it);return new W(function(){var pe=X();return pe===jr?{value:void 0,done:!0}:te(Ze,it?--Rt:Rt++,pe)})},fe.prototype.__iterate=function(Ze,it){for(var pe,Rt=it?this.size:0,X=Co(this,it);(pe=X())!==jr&&!1!==Ze(pe,it?--Rt:Rt++,this););return Rt},fe.prototype.__ensureOwner=function(Ze){return Ze===this.__ownerID?this:Ze?Eo(this._origin,this._capacity,this._level,this._root,this._tail,Ze,this.__hash):0===this.size?ei():(this.__ownerID=Ze,this.__altered=!1,this)},fe}(f);ao.isList=So;var Po=ao.prototype;Po[lo]=!0,Po[e]=Po.remove,Po.merge=Po.concat,Po.setIn=Hr,Po.deleteIn=Po.removeIn=Fr,Po.update=Ur,Po.updateIn=Ro,Po.mergeIn=xr,Po.mergeDeepIn=Ft,Po.withMutations=Qt,Po.wasAltered=Xt,Po.asImmutable=pt,Po["@@transducer/init"]=Po.asMutable=ht,Po["@@transducer/step"]=function(he,fe){return he.push(fe)},Po["@@transducer/result"]=function(he){return he.asImmutable()};var Yr=function(fe,ze){this.array=fe,this.ownerID=ze};Yr.prototype.removeBefore=function(fe,ze,Ze){if(Ze===ze?1<<ze:0===this.array.length)return this;var it=Ze>>>ze&t;if(it>=this.array.length)return new Yr([],fe);var X,Rt=0===it;if(ze>0){var pe=this.array[it];if((X=pe&&pe.removeBefore(fe,ze-o,Ze))===pe&&Rt)return this}if(Rt&&!X)return this;var De=Jo(this,fe);if(!Rt)for(var Ee=0;Ee<it;Ee++)De.array[Ee]=void 0;return X&&(De.array[it]=X),De},Yr.prototype.removeAfter=function(fe,ze,Ze){if(Ze===(ze?1<<ze:0)||0===this.array.length)return this;var Rt,it=Ze-1>>>ze&t;if(it>=this.array.length)return this;if(ze>0){var X=this.array[it];if((Rt=X&&X.removeAfter(fe,ze-o,Ze))===X&&it===this.array.length-1)return this}var pe=Jo(this,fe);return pe.array.splice(it+1),Rt&&(pe.array[it]=Rt),pe};var Fo,jr={};function Co(he,fe){var ze=he._origin,Ze=he._capacity,it=No(Ze),Rt=he._tail;return function X(Ee,qe,bt){return 0===qe?function pe(Ee,qe){var bt=qe===it?Rt&&Rt.array:Ee&&Ee.array,xt=qe>ze?0:ze-qe,hn=Ze-qe;return hn>r&&(hn=r),function(){if(xt===hn)return jr;var dn=fe?--hn:xt++;return bt&&bt[dn]}}(Ee,bt):function De(Ee,qe,bt){var xt,hn=Ee&&Ee.array,dn=bt>ze?0:ze-bt>>qe,In=1+(Ze-bt>>qe);return In>r&&(In=r),function(){for(;;){if(xt){var Tn=xt();if(Tn!==jr)return Tn;xt=null}if(dn===In)return jr;var _n=fe?--In:dn++;xt=X(hn&&hn[_n],qe-o,bt+(_n<<qe))}}}(Ee,qe,bt)}(he._root,he._level,0)}function Eo(he,fe,ze,Ze,it,Rt,X){var pe=Object.create(Po);return pe.size=fe-he,pe._origin=he,pe._capacity=fe,pe._level=ze,pe._root=Ze,pe._tail=it,pe.__ownerID=Rt,pe.__hash=X,pe.__altered=!1,pe}function ei(){return Fo||(Fo=Eo(0,0,o))}function ci(he,fe,ze,Ze,it,Rt){var De,X=Ze>>>ze&t,pe=he&&X<he.array.length;if(!pe&&void 0===it)return he;if(ze>0){var Ee=he&&he.array[X],qe=ci(Ee,fe,ze-o,Ze,it,Rt);return qe===Ee?he:((De=Jo(he,fe)).array[X]=qe,De)}return pe&&he.array[X]===it?he:(Rt&&c(Rt),De=Jo(he,fe),void 0===it&&X===De.array.length-1?De.array.pop():De.array[X]=it,De)}function Jo(he,fe){return fe&&he&&fe===he.ownerID?he:new Yr(he?he.array.slice():[],fe)}function Fi(he,fe){if(fe>=No(he._capacity))return he._tail;if(fe<1<<he._level+o){for(var ze=he._root,Ze=he._level;ze&&Ze>0;)ze=ze.array[fe>>>Ze&t],Ze-=o;return ze}}function hi(he,fe,ze){void 0!==fe&&(fe|=0),void 0!==ze&&(ze|=0);var Ze=he.__ownerID||new i,it=he._origin,Rt=he._capacity,X=it+fe,pe=void 0===ze?Rt:ze<0?Rt+ze:it+ze;if(X===it&&pe===Rt)return he;if(X>=pe)return he.clear();for(var De=he._level,Ee=he._root,qe=0;X+qe<0;)Ee=new Yr(Ee&&Ee.array.length?[void 0,Ee]:[],Ze),qe+=1<<(De+=o);qe&&(X+=qe,it+=qe,pe+=qe,Rt+=qe);for(var bt=No(Rt),xt=No(pe);xt>=1<<De+o;)Ee=new Yr(Ee&&Ee.array.length?[Ee]:[],Ze),De+=o;var hn=he._tail,dn=xt<bt?Fi(he,pe-1):xt>bt?new Yr([],Ze):hn;if(hn&&xt>bt&&X<Rt&&hn.array.length){for(var In=Ee=Jo(Ee,Ze),Tn=De;Tn>o;Tn-=o){var _n=bt>>>Tn&t;In=In.array[_n]=Jo(In.array[_n],Ze)}In.array[bt>>>o&t]=hn}if(pe<Rt&&(dn=dn&&dn.removeAfter(Ze,0,pe)),X>=xt)X-=xt,pe-=xt,De=o,Ee=null,dn=dn&&dn.removeBefore(Ze,0,X);else if(X>it||xt<bt){for(qe=0;Ee;){var Wn=X>>>De&t;if(Wn!==xt>>>De&t)break;Wn&&(qe+=(1<<De)*Wn),De-=o,Ee=Ee.array[Wn]}Ee&&X>it&&(Ee=Ee.removeBefore(Ze,De,X-qe)),Ee&&xt<bt&&(Ee=Ee.removeAfter(Ze,De,xt-qe)),qe&&(X-=qe,pe-=qe)}return he.__ownerID?(he.size=pe-X,he._origin=X,he._capacity=pe,he._level=De,he._root=Ee,he._tail=dn,he.__hash=void 0,he.__altered=!0,he):Eo(X,pe,De,Ee,dn)}function No(he){return he<r?0:he-1>>>o<<o}var qi,Ci=function(he){function fe(ze){return null==ze?Oi():Te(ze)?ze:Oi().withMutations(function(Ze){var it=R(ze);Jr(it.size),it.forEach(function(Rt,X){return Ze.set(X,Rt)})})}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return this(arguments)},fe.prototype.toString=function(){return this.__toString("OrderedMap {","}")},fe.prototype.get=function(Ze,it){var Rt=this._map.get(Ze);return void 0!==Rt?this._list.get(Rt)[1]:it},fe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Oi()},fe.prototype.set=function(Ze,it){return ti(this,Ze,it)},fe.prototype.remove=function(Ze){return ti(this,Ze,A)},fe.prototype.__iterate=function(Ze,it){var Rt=this;return this._list.__iterate(function(X){return X&&Ze(X[1],X[0],Rt)},it)},fe.prototype.__iterator=function(Ze,it){return this._list.fromEntrySeq().__iterator(Ze,it)},fe.prototype.__ensureOwner=function(Ze){if(Ze===this.__ownerID)return this;var it=this._map.__ensureOwner(Ze),Rt=this._list.__ensureOwner(Ze);return Ze?mi(it,Rt,Ze,this.__hash):0===this.size?Oi():(this.__ownerID=Ze,this.__altered=!1,this._map=it,this._list=Rt,this)},fe}(fn);function mi(he,fe,ze,Ze){var it=Object.create(Ci.prototype);return it.size=he?he.size:0,it._map=he,it._list=fe,it.__ownerID=ze,it.__hash=Ze,it.__altered=!1,it}function Oi(){return qi||(qi=mi(zt(),ei()))}function ti(he,fe,ze){var pe,De,Ze=he._map,it=he._list,Rt=Ze.get(fe),X=void 0!==Rt;if(ze===A){if(!X)return he;it.size>=r&&it.size>=2*Ze.size?(pe=(De=it.filter(function(Ee,qe){return void 0!==Ee&&Rt!==qe})).toKeyedSeq().map(function(Ee){return Ee[0]}).flip().toMap(),he.__ownerID&&(pe.__ownerID=De.__ownerID=he.__ownerID)):(pe=Ze.remove(fe),De=Rt===it.size-1?it.pop():it.set(Rt,void 0))}else if(X){if(ze===it.get(Rt)[1])return he;pe=Ze,De=it.set(Rt,[fe,ze])}else pe=Ze.set(fe,it.size),De=it.set(it.size,[fe,ze]);return he.__ownerID?(he.size=pe.size,he._map=pe,he._list=De,he.__hash=void 0,he.__altered=!0,he):mi(pe,De)}Ci.isOrderedMap=Te,Ci.prototype[G]=!0,Ci.prototype[e]=Ci.prototype.remove;var es="@@__IMMUTABLE_STACK__@@";function Si(he){return!(!he||!he[es])}var Pi=function(he){function fe(ze){return null==ze?Ri():Si(ze)?ze:Ri().pushAll(ze)}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return this(arguments)},fe.prototype.toString=function(){return this.__toString("Stack [","]")},fe.prototype.get=function(Ze,it){var Rt=this._head;for(Ze=O(this,Ze);Rt&&Ze--;)Rt=Rt.next;return Rt?Rt.value:it},fe.prototype.peek=function(){return this._head&&this._head.value},fe.prototype.push=function(){var Ze=arguments;if(0===arguments.length)return this;for(var it=this.size+arguments.length,Rt=this._head,X=arguments.length-1;X>=0;X--)Rt={value:Ze[X],next:Rt};return this.__ownerID?(this.size=it,this._head=Rt,this.__hash=void 0,this.__altered=!0,this):gi(it,Rt)},fe.prototype.pushAll=function(Ze){if(0===(Ze=he(Ze)).size)return this;if(0===this.size&&Si(Ze))return Ze;Jr(Ze.size);var it=this.size,Rt=this._head;return Ze.__iterate(function(X){it++,Rt={value:X,next:Rt}},!0),this.__ownerID?(this.size=it,this._head=Rt,this.__hash=void 0,this.__altered=!0,this):gi(it,Rt)},fe.prototype.pop=function(){return this.slice(1)},fe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Ri()},fe.prototype.slice=function(Ze,it){if(_(Ze,it,this.size))return this;var Rt=M(Ze,this.size);if(I(it,this.size)!==this.size)return he.prototype.slice.call(this,Ze,it);for(var pe=this.size-Rt,De=this._head;Rt--;)De=De.next;return this.__ownerID?(this.size=pe,this._head=De,this.__hash=void 0,this.__altered=!0,this):gi(pe,De)},fe.prototype.__ensureOwner=function(Ze){return Ze===this.__ownerID?this:Ze?gi(this.size,this._head,Ze,this.__hash):0===this.size?Ri():(this.__ownerID=Ze,this.__altered=!1,this)},fe.prototype.__iterate=function(Ze,it){var Rt=this;if(it)return new Ce(this.toArray()).__iterate(function(De,Ee){return Ze(De,Ee,Rt)},it);for(var X=0,pe=this._head;pe&&!1!==Ze(pe.value,X++,this);)pe=pe.next;return X},fe.prototype.__iterator=function(Ze,it){if(it)return new Ce(this.toArray()).__iterator(Ze,it);var Rt=0,X=this._head;return new W(function(){if(X){var pe=X.value;return X=X.next,te(Ze,Rt++,pe)}return{value:void 0,done:!0}})},fe}(f);Pi.isStack=Si;var Wi,ni=Pi.prototype;function gi(he,fe,ze,Ze){var it=Object.create(ni);return it.size=he,it._head=fe,it.__ownerID=ze,it.__hash=Ze,it.__altered=!1,it}function Ri(){return Wi||(Wi=gi(0))}ni[es]=!0,ni.shift=ni.pop,ni.unshift=ni.push,ni.unshiftAll=ni.pushAll,ni.withMutations=Qt,ni.wasAltered=Xt,ni.asImmutable=pt,ni["@@transducer/init"]=ni.asMutable=ht,ni["@@transducer/step"]=function(he,fe){return he.unshift(fe)},ni["@@transducer/result"]=function(he){return he.asImmutable()};var Qi="@@__IMMUTABLE_SET__@@";function Hn(he){return!(!he||!he[Qi])}function qr(he){return Hn(he)&&V(he)}function co(he,fe){if(he===fe)return!0;if(!d(fe)||void 0!==he.size&&void 0!==fe.size&&he.size!==fe.size||void 0!==he.__hash&&void 0!==fe.__hash&&he.__hash!==fe.__hash||C(he)!==C(fe)||a(he)!==a(fe)||V(he)!==V(fe))return!1;if(0===he.size&&0===fe.size)return!0;var ze=!S(he);if(V(he)){var Ze=he.entries();return fe.every(function(De,Ee){var qe=Ze.next().value;return qe&&ue(qe[1],De)&&(ze||ue(qe[0],Ee))})&&Ze.next().done}var it=!1;if(void 0===he.size)if(void 0===fe.size)"function"==typeof he.cacheResult&&he.cacheResult();else{it=!0;var Rt=he;he=fe,fe=Rt}var X=!0,pe=fe.__iterate(function(De,Ee){if(ze?!he.has(De):it?!ue(De,he.get(Ee,A)):!ue(he.get(Ee,A),De))return X=!1,!1});return X&&he.size===pe}function zr(he,fe){var ze=function(Ze){he.prototype[Ze]=fe[Ze]};return Object.keys(fe).forEach(ze),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(fe).forEach(ze),he}function lr(he){if(!he||"object"!=typeof he)return he;if(!d(he)){if(!dt(he))return he;he=xe(he)}if(C(he)){var fe={};return he.__iterate(function(Ze,it){fe[it]=lr(Ze)}),fe}var ze=[];return he.__iterate(function(Ze){ze.push(lr(Ze))}),ze}var kr=function(he){function fe(ze){return null==ze?Li():Hn(ze)&&!V(ze)?ze:Li().withMutations(function(Ze){var it=he(ze);Jr(it.size),it.forEach(function(Rt){return Ze.add(Rt)})})}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return this(arguments)},fe.fromKeys=function(Ze){return this(R(Ze).keySeq())},fe.intersect=function(Ze){return(Ze=D(Ze).toArray()).length?Qr.intersect.apply(fe(Ze.pop()),Ze):Li()},fe.union=function(Ze){return(Ze=D(Ze).toArray()).length?Qr.union.apply(fe(Ze.pop()),Ze):Li()},fe.prototype.toString=function(){return this.__toString("Set {","}")},fe.prototype.has=function(Ze){return this._map.has(Ze)},fe.prototype.add=function(Ze){return vi(this,this._map.set(Ze,Ze))},fe.prototype.remove=function(Ze){return vi(this,this._map.remove(Ze))},fe.prototype.clear=function(){return vi(this,this._map.clear())},fe.prototype.map=function(Ze,it){var Rt=this,X=!1,pe=vi(this,this._map.mapEntries(function(De){var Ee=De[1],qe=Ze.call(it,Ee,Ee,Rt);return qe!==Ee&&(X=!0),[qe,qe]},it));return X?pe:this},fe.prototype.union=function(){for(var Ze=[],it=arguments.length;it--;)Ze[it]=arguments[it];return 0===(Ze=Ze.filter(function(Rt){return 0!==Rt.size})).length?this:0!==this.size||this.__ownerID||1!==Ze.length?this.withMutations(function(Rt){for(var X=0;X<Ze.length;X++)"string"==typeof Ze[X]?Rt.add(Ze[X]):he(Ze[X]).forEach(function(pe){return Rt.add(pe)})}):this.constructor(Ze[0])},fe.prototype.intersect=function(){for(var Ze=[],it=arguments.length;it--;)Ze[it]=arguments[it];if(0===Ze.length)return this;Ze=Ze.map(function(X){return he(X)});var Rt=[];return this.forEach(function(X){Ze.every(function(pe){return pe.includes(X)})||Rt.push(X)}),this.withMutations(function(X){Rt.forEach(function(pe){X.remove(pe)})})},fe.prototype.subtract=function(){for(var Ze=[],it=arguments.length;it--;)Ze[it]=arguments[it];if(0===Ze.length)return this;Ze=Ze.map(function(X){return he(X)});var Rt=[];return this.forEach(function(X){Ze.some(function(pe){return pe.includes(X)})&&Rt.push(X)}),this.withMutations(function(X){Rt.forEach(function(pe){X.remove(pe)})})},fe.prototype.sort=function(Ze){return nr(kt(this,Ze))},fe.prototype.sortBy=function(Ze,it){return nr(kt(this,it,Ze))},fe.prototype.wasAltered=function(){return this._map.wasAltered()},fe.prototype.__iterate=function(Ze,it){var Rt=this;return this._map.__iterate(function(X){return Ze(X,X,Rt)},it)},fe.prototype.__iterator=function(Ze,it){return this._map.__iterator(Ze,it)},fe.prototype.__ensureOwner=function(Ze){if(Ze===this.__ownerID)return this;var it=this._map.__ensureOwner(Ze);return Ze?this.__make(it,Ze):0===this.size?this.__empty():(this.__ownerID=Ze,this._map=it,this)},fe}(p);kr.isSet=Hn;var Bi,Qr=kr.prototype;function vi(he,fe){return he.__ownerID?(he.size=fe.size,he._map=fe,he):fe===he._map?he:0===fe.size?he.__empty():he.__make(fe)}function Ti(he,fe){var ze=Object.create(Qr);return ze.size=he?he.size:0,ze._map=he,ze.__ownerID=fe,ze}function Li(){return Bi||(Bi=Ti(zt()))}Qr[Qi]=!0,Qr[e]=Qr.remove,Qr.merge=Qr.concat=Qr.union,Qr.withMutations=Qt,Qr.asImmutable=pt,Qr["@@transducer/init"]=Qr.asMutable=ht,Qr["@@transducer/step"]=function(he,fe){return he.add(fe)},Qr["@@transducer/result"]=function(he){return he.asImmutable()},Qr.__empty=Li,Qr.__make=Ti;var Vi,bi=function(he){function fe(ze,Ze,it){if(!(this instanceof fe))return new fe(ze,Ze,it);if(Or(0!==it,"Cannot step a Range by 0"),ze=ze||0,void 0===Ze&&(Ze=1/0),it=void 0===it?1:Math.abs(it),Ze<ze&&(it=-it),this._start=ze,this._end=Ze,this._step=it,this.size=Math.max(0,Math.ceil((Ze-ze)/it-1)+1),0===this.size){if(Vi)return Vi;Vi=this}}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},fe.prototype.get=function(Ze,it){return this.has(Ze)?this._start+O(this,Ze)*this._step:it},fe.prototype.includes=function(Ze){var it=(Ze-this._start)/this._step;return it>=0&&it<this.size&&it===Math.floor(it)},fe.prototype.slice=function(Ze,it){return _(Ze,it,this.size)?this:(Ze=M(Ze,this.size),(it=I(it,this.size))<=Ze?new fe(0,0):new fe(this.get(Ze,this._end),this.get(it,this._end),this._step))},fe.prototype.indexOf=function(Ze){var it=Ze-this._start;if(it%this._step==0){var Rt=it/this._step;if(Rt>=0&&Rt<this.size)return Rt}return-1},fe.prototype.lastIndexOf=function(Ze){return this.indexOf(Ze)},fe.prototype.__iterate=function(Ze,it){for(var Rt=this.size,X=this._step,pe=it?this._start+(Rt-1)*X:this._start,De=0;De!==Rt&&!1!==Ze(pe,it?Rt-++De:De++,this);)pe+=it?-X:X;return De},fe.prototype.__iterator=function(Ze,it){var Rt=this.size,X=this._step,pe=it?this._start+(Rt-1)*X:this._start,De=0;return new W(function(){if(De===Rt)return{value:void 0,done:!0};var Ee=pe;return pe+=it?-X:X,te(Ze,it?Rt-++De:De++,Ee)})},fe.prototype.equals=function(Ze){return Ze instanceof fe?this._start===Ze._start&&this._end===Ze._end&&this._step===Ze._step:co(this,Ze)},fe}(Ae);function Ei(he,fe,ze){for(var Ze=To(fe),it=0;it!==Ze.length;)if((he=xn(he,Ze[it++],A))===A)return ze;return he}function ln(he,fe){return Ei(this,he,fe)}function ar(){Jr(this.size);var he={};return this.__iterate(function(fe,ze){he[ze]=fe}),he}D.isIterable=d,D.isKeyed=C,D.isIndexed=a,D.isAssociative=S,D.isOrdered=V,D.Iterator=W,zr(D,{toArray:function(){Jr(this.size);var fe=new Array(this.size||0),ze=C(this),Ze=0;return this.__iterate(function(it,Rt){fe[Ze++]=ze?[Rt,it]:it}),fe},toIndexedSeq:function(){return new At(this)},toJS:function(){return lr(this)},toKeyedSeq:function(){return new yt(this,!0)},toMap:function(){return fn(this.toKeyedSeq())},toObject:ar,toOrderedMap:function(){return Ci(this.toKeyedSeq())},toOrderedSet:function(){return nr(C(this)?this.valueSeq():this)},toSet:function(){return kr(C(this)?this.valueSeq():this)},toSetSeq:function(){return new Gt(this)},toSeq:function(){return a(this)?this.toIndexedSeq():C(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Pi(C(this)?this.valueSeq():this)},toList:function(){return ao(C(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(fe,ze){return 0===this.size?fe+ze:fe+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+ze},concat:function(){for(var fe=[],ze=arguments.length;ze--;)fe[ze]=arguments[ze];return On(this,function Vt(he,fe){var ze=C(he),Ze=[he].concat(fe).map(function(X){return d(X)?ze&&(X=R(X)):X=ze?Se(X):Ve(Array.isArray(X)?X:[X]),X}).filter(function(X){return 0!==X.size});if(0===Ze.length)return he;if(1===Ze.length){var it=Ze[0];if(it===he||ze&&C(it)||a(he)&&a(it))return it}var Rt=new Ce(Ze);return ze?Rt=Rt.toKeyedSeq():a(he)||(Rt=Rt.toSetSeq()),(Rt=Rt.flatten(!0)).size=Ze.reduce(function(X,pe){if(void 0!==X){var De=pe.size;if(void 0!==De)return X+De}},0),Rt}(this,fe))},includes:function(fe){return this.some(function(ze){return ue(ze,fe)})},entries:function(){return this.__iterator(k)},every:function(fe,ze){Jr(this.size);var Ze=!0;return this.__iterate(function(it,Rt,X){if(!fe.call(ze,it,Rt,X))return Ze=!1,!1}),Ze},filter:function(fe,ze){return On(this,bn(this,fe,ze,!0))},partition:function(fe,ze){return function It(he,fe,ze){var Ze=C(he),it=[[],[]];he.__iterate(function(X,pe){it[fe.call(ze,X,pe,he)?1:0].push(Ze?[pe,X]:X)});var Rt=Dr(he);return it.map(function(X){return On(he,Rt(X))})}(this,fe,ze)},find:function(fe,ze,Ze){var it=this.findEntry(fe,ze);return it?it[1]:Ze},forEach:function(fe,ze){return Jr(this.size),this.__iterate(ze?fe.bind(ze):fe)},join:function(fe){Jr(this.size),fe=void 0!==fe?""+fe:",";var ze="",Ze=!0;return this.__iterate(function(it){Ze?Ze=!1:ze+=fe,ze+=null!=it?it.toString():""}),ze},keys:function(){return this.__iterator(U)},map:function(fe,ze){return On(this,Mt(this,fe,ze))},reduce:function(fe,ze,Ze){return Br(this,fe,ze,Ze,arguments.length<2,!1)},reduceRight:function(fe,ze,Ze){return Br(this,fe,ze,Ze,arguments.length<2,!0)},reverse:function(){return On(this,nn(this,!0))},slice:function(fe,ze){return On(this,Dt(this,fe,ze,!0))},some:function(fe,ze){Jr(this.size);var Ze=!1;return this.__iterate(function(it,Rt,X){if(fe.call(ze,it,Rt,X))return Ze=!0,!1}),Ze},sort:function(fe){return On(this,kt(this,fe))},values:function(){return this.__iterator(N)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(fe,ze){return v(fe?this.toSeq().filter(fe,ze):this)},countBy:function(fe,ze){return function Dn(he,fe,ze){var Ze=fn().asMutable();return he.__iterate(function(it,Rt){Ze.update(fe.call(ze,it,Rt,he),0,function(X){return X+1})}),Ze.asImmutable()}(this,fe,ze)},equals:function(fe){return co(this,fe)},entrySeq:function(){var fe=this;if(fe._cache)return new Ce(fe._cache);var ze=fe.toSeq().map(et).toIndexedSeq();return ze.fromEntrySeq=function(){return fe.toSeq()},ze},filterNot:function(fe,ze){return this.filter(at(fe),ze)},findEntry:function(fe,ze,Ze){var it=Ze;return this.__iterate(function(Rt,X,pe){if(fe.call(ze,Rt,X,pe))return it=[X,Rt],!1}),it},findKey:function(fe,ze){var Ze=this.findEntry(fe,ze);return Ze&&Ze[0]},findLast:function(fe,ze,Ze){return this.toKeyedSeq().reverse().find(fe,ze,Ze)},findLastEntry:function(fe,ze,Ze){return this.toKeyedSeq().reverse().findEntry(fe,ze,Ze)},findLastKey:function(fe,ze){return this.toKeyedSeq().reverse().findKey(fe,ze)},first:function(fe){return this.find(b,null,fe)},flatMap:function(fe,ze){return On(this,function yn(he,fe,ze){var Ze=Dr(he);return he.toSeq().map(function(it,Rt){return Ze(fe.call(ze,it,Rt,he))}).flatten(!0)}(this,fe,ze))},flatten:function(fe){return On(this,Wt(this,fe,!0))},fromEntrySeq:function(){return new rn(this)},get:function(fe,ze){return this.find(function(Ze,it){return ue(it,fe)},void 0,ze)},getIn:ln,groupBy:function(fe,ze){return function jt(he,fe,ze){var Ze=C(he),it=(V(he)?Ci():fn()).asMutable();he.__iterate(function(X,pe){it.update(fe.call(ze,X,pe,he),function(De){return(De=De||[]).push(Ze?[pe,X]:X),De})});var Rt=Dr(he);return it.map(function(X){return On(he,Rt(X))}).asImmutable()}(this,fe,ze)},has:function(fe){return this.get(fe,A)!==A},hasIn:function Gn(he){return function Ht(he,fe){return Ei(he,fe,A)!==A}(this,he)},isSubset:function(fe){return fe="function"==typeof fe.includes?fe:D(fe),this.every(function(ze){return fe.includes(ze)})},isSuperset:function(fe){return(fe="function"==typeof fe.isSubset?fe:D(fe)).isSubset(this)},keyOf:function(fe){return this.findKey(function(ze){return ue(ze,fe)})},keySeq:function(){return this.toSeq().map(st).toIndexedSeq()},last:function(fe){return this.toSeq().reverse().first(fe)},lastKeyOf:function(fe){return this.toKeyedSeq().reverse().keyOf(fe)},max:function(fe){return Ot(this,fe)},maxBy:function(fe,ze){return Ot(this,ze,fe)},min:function(fe){return Ot(this,fe?Et(fe):qt)},minBy:function(fe,ze){return Ot(this,ze?Et(ze):qt,fe)},rest:function(){return this.slice(1)},skip:function(fe){return 0===fe?this:this.slice(Math.max(0,fe))},skipLast:function(fe){return 0===fe?this:this.slice(0,-Math.max(0,fe))},skipWhile:function(fe,ze){return On(this,$t(this,fe,ze,!0))},skipUntil:function(fe,ze){return this.skipWhile(at(fe),ze)},sortBy:function(fe,ze){return On(this,kt(this,ze,fe))},take:function(fe){return this.slice(0,Math.max(0,fe))},takeLast:function(fe){return this.slice(-Math.max(0,fe))},takeWhile:function(fe,ze){return On(this,function Ct(he,fe,ze){var Ze=Pr(he);return Ze.__iterateUncached=function(it,Rt){var X=this;if(Rt)return this.cacheResult().__iterate(it,Rt);var pe=0;return he.__iterate(function(De,Ee,qe){return fe.call(ze,De,Ee,qe)&&++pe&&it(De,Ee,X)}),pe},Ze.__iteratorUncached=function(it,Rt){var X=this;if(Rt)return this.cacheResult().__iterator(it,Rt);var pe=he.__iterator(k,Rt),De=!0;return new W(function(){if(!De)return{value:void 0,done:!0};var Ee=pe.next();if(Ee.done)return Ee;var qe=Ee.value,bt=qe[0],xt=qe[1];return fe.call(ze,xt,bt,X)?it===k?Ee:te(it,bt,xt,Ee):(De=!1,{value:void 0,done:!0})})},Ze}(this,fe,ze))},takeUntil:function(fe,ze){return this.takeWhile(at(fe),ze)},update:function(fe){return fe(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function Cn(he){if(he.size===1/0)return 0;var fe=V(he),ze=C(he),Ze=fe?1:0;return function Un(he,fe){return fe=re(fe,3432918353),fe=re(fe<<15|fe>>>-15,461845907),fe=re(fe<<13|fe>>>-13,5),fe=re((fe=fe+3864292196^he)^fe>>>16,2246822507),fe=ve((fe=re(fe^fe>>>13,3266489909))^fe>>>16)}(he.__iterate(ze?fe?function(Rt,X){Ze=31*Ze+vn(se(Rt),se(X))|0}:function(Rt,X){Ze=Ze+vn(se(Rt),se(X))|0}:fe?function(Rt){Ze=31*Ze+se(Rt)|0}:function(Rt){Ze=Ze+se(Rt)|0}),Ze)}(this))}});var kn=D.prototype;kn[u]=!0,kn[J]=kn.values,kn.toJSON=kn.toArray,kn.__toStringMapper=Yt,kn.inspect=kn.toSource=function(){return this.toString()},kn.chain=kn.flatMap,kn.contains=kn.includes,zr(R,{flip:function(){return On(this,tt(this))},mapEntries:function(fe,ze){var Ze=this,it=0;return On(this,this.toSeq().map(function(Rt,X){return fe.call(ze,[X,Rt],it++,Ze)}).fromEntrySeq())},mapKeys:function(fe,ze){var Ze=this;return On(this,this.toSeq().flip().map(function(it,Rt){return fe.call(ze,it,Rt,Ze)}).flip())}});var ur=R.prototype;ur[s]=!0,ur[J]=kn.entries,ur.toJSON=ar,ur.__toStringMapper=function(he,fe){return Yt(fe)+": "+Yt(he)},zr(f,{toKeyedSeq:function(){return new yt(this,!1)},filter:function(fe,ze){return On(this,bn(this,fe,ze,!1))},findIndex:function(fe,ze){var Ze=this.findEntry(fe,ze);return Ze?Ze[0]:-1},indexOf:function(fe){var ze=this.keyOf(fe);return void 0===ze?-1:ze},lastIndexOf:function(fe){var ze=this.lastKeyOf(fe);return void 0===ze?-1:ze},reverse:function(){return On(this,nn(this,!1))},slice:function(fe,ze){return On(this,Dt(this,fe,ze,!1))},splice:function(fe,ze){var Ze=arguments.length;if(ze=Math.max(ze||0,0),0===Ze||2===Ze&&!ze)return this;fe=M(fe,fe<0?this.count():this.size);var it=this.slice(0,fe);return On(this,1===Ze?it:it.concat(Ir(arguments,2),this.slice(fe+ze)))},findLastIndex:function(fe,ze){var Ze=this.findLastEntry(fe,ze);return Ze?Ze[0]:-1},first:function(fe){return this.get(0,fe)},flatten:function(fe){return On(this,Wt(this,fe,!1))},get:function(fe,ze){return(fe=O(this,fe))<0||this.size===1/0||void 0!==this.size&&fe>this.size?ze:this.find(function(Ze,it){return it===fe},void 0,ze)},has:function(fe){return(fe=O(this,fe))>=0&&(void 0!==this.size?this.size===1/0||fe<this.size:-1!==this.indexOf(fe))},interpose:function(fe){return On(this,function Zt(he,fe){var ze=Pr(he);return ze.size=he.size&&2*he.size-1,ze.__iterateUncached=function(Ze,it){var Rt=this,X=0;return he.__iterate(function(pe){return(!X||!1!==Ze(fe,X++,Rt))&&!1!==Ze(pe,X++,Rt)},it),X},ze.__iteratorUncached=function(Ze,it){var pe,Rt=he.__iterator(N,it),X=0;return new W(function(){return(!pe||X%2)&&(pe=Rt.next()).done?pe:X%2?te(Ze,X++,fe):te(Ze,X++,pe.value,pe)})},ze}(this,fe))},interleave:function(){var fe=[this].concat(Ir(arguments)),ze=jn(this.toSeq(),Ae.of,fe),Ze=ze.flatten(!0);return ze.size&&(Ze.size=ze.size*fe.length),On(this,Ze)},keySeq:function(){return bi(0,this.size)},last:function(fe){return this.get(-1,fe)},skipWhile:function(fe,ze){return On(this,$t(this,fe,ze,!1))},zip:function(){return On(this,jn(this,Nt,[this].concat(Ir(arguments))))},zipAll:function(){return On(this,jn(this,Nt,[this].concat(Ir(arguments)),!0))},zipWith:function(fe){var ze=Ir(arguments);return ze[0]=this,On(this,jn(this,fe,ze))}});var sr=f.prototype;sr[h]=!0,sr[G]=!0,zr(p,{get:function(fe,ze){return this.has(fe)?fe:ze},includes:function(fe){return this.has(fe)},keySeq:function(){return this.valueSeq()}});var Jn=p.prototype;function Br(he,fe,ze,Ze,it,Rt){return Jr(he.size),he.__iterate(function(X,pe,De){it?(it=!1,ze=X):ze=fe.call(Ze,ze,X,pe,De)},Rt),ze}function st(he,fe){return fe}function et(he,fe){return[fe,he]}function at(he){return function(){return!he.apply(this,arguments)}}function Et(he){return function(){return-he.apply(this,arguments)}}function Nt(){return Ir(arguments)}function qt(he,fe){return he<fe?1:he>fe?-1:0}function vn(he,fe){return he^fe+2654435769+(he<<6)+(he>>2)}Jn.has=kn.includes,Jn.contains=Jn.includes,Jn.keys=Jn.values,zr(le,ur),zr(Ae,sr),zr(Be,Jn);var nr=function(he){function fe(ze){return null==ze?Uo():qr(ze)?ze:Uo().withMutations(function(Ze){var it=p(ze);Jr(it.size),it.forEach(function(Rt){return Ze.add(Rt)})})}return he&&(fe.__proto__=he),(fe.prototype=Object.create(he&&he.prototype)).constructor=fe,fe.of=function(){return this(arguments)},fe.fromKeys=function(Ze){return this(R(Ze).keySeq())},fe.prototype.toString=function(){return this.__toString("OrderedSet {","}")},fe}(kr);nr.isOrderedSet=qr;var mo,pr=nr.prototype;function Rr(he,fe){var ze=Object.create(pr);return ze.size=he?he.size:0,ze._map=he,ze.__ownerID=fe,ze}function Uo(){return mo||(mo=Rr(Oi()))}pr[G]=!0,pr.zip=sr.zip,pr.zipWith=sr.zipWith,pr.zipAll=sr.zipAll,pr.__empty=Uo,pr.__make=Rr;var fo=function(fe,ze){var Ze;!function ri(he){if(w(he))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(Q(he))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(null===he||"object"!=typeof he)throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}(fe);var it=function(pe){var De=this;if(pe instanceof it)return pe;if(!(this instanceof it))return new it(pe);if(!Ze){Ze=!0;var Ee=Object.keys(fe),qe=Rt._indices={};Rt._name=ze,Rt._keys=Ee,Rt._defaultValues=fe;for(var bt=0;bt<Ee.length;bt++){var xt=Ee[bt];qe[xt]=bt,Rt[xt]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+rs(this)+' with property "'+xt+'" since that property name is part of the Record API.'):_o(Rt,xt)}}return this.__ownerID=void 0,this._values=ao().withMutations(function(hn){hn.setSize(De._keys.length),R(pe).forEach(function(dn,In){hn.set(De._indices[In],dn===De._defaultValues[In]?void 0:dn)})}),this},Rt=it.prototype=Object.create(Lo);return Rt.constructor=it,ze&&(it.displayName=ze),it};fo.prototype.toString=function(){for(var Ze,fe=rs(this)+" { ",ze=this._keys,it=0,Rt=ze.length;it!==Rt;it++)fe+=(it?", ":"")+(Ze=ze[it])+": "+Yt(this.get(Ze));return fe+" }"},fo.prototype.equals=function(fe){return this===fe||w(fe)&&Gi(this).equals(Gi(fe))},fo.prototype.hashCode=function(){return Gi(this).hashCode()},fo.prototype.has=function(fe){return this._indices.hasOwnProperty(fe)},fo.prototype.get=function(fe,ze){if(!this.has(fe))return ze;var it=this._values.get(this._indices[fe]);return void 0===it?this._defaultValues[fe]:it},fo.prototype.set=function(fe,ze){if(this.has(fe)){var Ze=this._values.set(this._indices[fe],ze===this._defaultValues[fe]?void 0:ze);if(Ze!==this._values&&!this.__ownerID)return Ni(this,Ze)}return this},fo.prototype.remove=function(fe){return this.set(fe)},fo.prototype.clear=function(){var fe=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:Ni(this,fe)},fo.prototype.wasAltered=function(){return this._values.wasAltered()},fo.prototype.toSeq=function(){return Gi(this)},fo.prototype.toJS=function(){return lr(this)},fo.prototype.entries=function(){return this.__iterator(k)},fo.prototype.__iterator=function(fe,ze){return Gi(this).__iterator(fe,ze)},fo.prototype.__iterate=function(fe,ze){return Gi(this).__iterate(fe,ze)},fo.prototype.__ensureOwner=function(fe){if(fe===this.__ownerID)return this;var ze=this._values.__ensureOwner(fe);return fe?Ni(this,ze,fe):(this.__ownerID=fe,this._values=ze,this)},fo.isRecord=w,fo.getDescriptiveName=rs;var Lo=fo.prototype;function Ni(he,fe,ze){var Ze=Object.create(Object.getPrototypeOf(he));return Ze._values=fe,Ze.__ownerID=ze,Ze}function rs(he){return he.constructor.displayName||he.constructor.name||"Record"}function Gi(he){return Se(he._keys.map(function(fe){return[fe,he.get(fe)]}))}function _o(he,fe){try{Object.defineProperty(he,fe,{get:function(){return this.get(fe)},set:function(ze){Or(this.__ownerID,"Cannot set on an immutable record."),this.set(fe,ze)}})}catch{}}Lo[L]=!0,Lo[e]=Lo.remove,Lo.deleteIn=Lo.removeIn=Fr,Lo.getIn=ln,Lo.hasIn=kn.hasIn,Lo.merge=ro,Lo.mergeWith=po,Lo.mergeIn=xr,Lo.mergeDeep=Kn,Lo.mergeDeepWith=dr,Lo.mergeDeepIn=Ft,Lo.setIn=Hr,Lo.update=Ur,Lo.updateIn=Ro,Lo.withMutations=Qt,Lo.asMutable=ht,Lo.asImmutable=pt,Lo[J]=Lo.entries,Lo.toJSON=Lo.toObject=kn.toObject,Lo.inspect=Lo.toSource=function(){return this.toString()}},5276:(tn,Ue,n)=>{"use strict";n.d(Ue,{i:()=>O});var e=n(4369),o=n(7361),r=n(127);class t{get source(){return this._source}get target(){return this._target}apply(l,m=0,u){(!this.inTransition||m>0)&&O.copySnapshot(this._source,this.camera.state),this.inTransition||O.copySnapshot(this._target,this.camera.state),O.copySnapshot(this._target,l),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&m<=0||typeof l.mode<"u"&&l.mode!==this.camera.state.mode?this.finish(this._target):(this.inTransition=!0,this.func=u||t.defaultTransition,(!this.inTransition||m>0)&&(this.start=this.t,this.durationMs=m))}tick(l){this.t=l,this.update()}finish(l){O.copySnapshot(this.camera.state,l),this.inTransition=!1}update(){if(!this.inTransition)return;const l=Math.min((this.t-this.start)/this.durationMs,1);1!==l?(this.func(this._current,l,this._source,this._target),O.copySnapshot(this.camera.state,this._current)):this.finish(this._target)}constructor(l){this.camera=l,this.t=0,this.func=t.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=O.createDefaultSnapshot(),this._target=O.createDefaultSnapshot(),this._current=O.createDefaultSnapshot()}}!function(I){const l=e.k.identity();I.defaultTransition=function m(u,d,s,C){O.copySnapshot(u,C),e.k.slerp(l,e.k.Identity,e.k.rotationTo(l,s.up,C.up),d),e.eB.transformQuat(u.up,s.up,l),e.eB.lerp(u.target,s.target,C.target,d),e.eB.lerp(u.position,s.position,C.position,d),u.radius=(0,r.Cc)(s.radius,C.radius,d),u.radiusMax=(0,r.Cc)(s.radiusMax,C.radiusMax,d),u.fov=(0,r.Cc)(s.fov,C.fov,d),u.fog=(0,r.Cc)(s.fog,C.fog,d)}}(t||(t={}));var A=n(4412),y=n(1372);const c=(0,e.eB)(),i=(0,e.eB)(),v=(0,e.Zb)();class O{get position(){return this.state.position}set position(l){e.eB.copy(this.state.position,l)}get up(){return this.state.up}set up(l){e.eB.copy(this.state.up,l)}get target(){return this.state.target}set target(l){e.eB.copy(this.state.target,l)}update(){const l=this.state;if(0===l.radiusMax)return!1;const m=2*Math.tan(l.fov/2)*e.eB.distance(l.position,l.target);switch(this.zoom=this.viewport.height/m,function M(I){let{radius:l,radiusMax:m,fog:d,clipFar:s,minNear:C,minFar:h}=I.state;l<.01&&(l=.01);const a=Math.max(s?l:m,h),S=e.eB.distance(I.position,I.target);let D=S-l,R=S+a;D=Math.max(Math.min(m,C),D),R=Math.max(C,R),D===R&&(R=D+.01);const p=S-a*(-(50-d)/50),E=R;I.near=D,I.far=R,I.fogNear=p,I.fogFar=E}(this),this.state.mode){case"orthographic":!function b(I){const{viewport:l,zoom:m,near:u,far:d,viewOffset:s}=I,C=-l.width/2,h=l.width/2,a=l.height/2,S=-l.height/2,D=(h-C)/(2*m),R=(a-S)/(2*m),f=(h+C)/2,p=(a+S)/2;let E=f-D,T=f+D,L=p+R,w=p-R;if(s.enabled){const Q=m/(s.width/s.fullWidth),G=m/(s.height/s.fullHeight),V=(h-C)/s.width,U=(a-S)/s.height;E+=V*(s.offsetX/Q),T=E+V*(s.width/Q),L-=U*(s.offsetY/G),w=L-U*(s.height/G)}e.$I.ortho(I.projection,E,T,L,w,u,d),e.$I.lookAt(I.view,I.position,I.target,I.up)}(this);break;case"perspective":!function _(I){const l=I.viewport.width/I.viewport.height,{near:m,far:u,viewOffset:d}=I;let s=m*Math.tan(.5*I.state.fov),C=2*s,h=l*C,a=-.5*h;d.enabled&&(a+=d.offsetX*h/d.fullWidth,s-=d.offsetY*C/d.fullHeight,h*=d.width/d.fullWidth,C*=d.height/d.fullHeight),e.$I.perspective(I.projection,a,a+h,s,s-C,m,u),e.$I.lookAt(I.view,I.position,I.target,I.up)}(this);break;default:(0,y.dr)(this.state.mode)}const u=!e.$I.areEqual(this.projection,this.prevProjection,e.p8)||!e.$I.areEqual(this.view,this.prevView,e.p8);if(u){if(e.$I.mul(this.projectionView,this.projection,this.view),!e.$I.tryInvert(this.inverseProjectionView,this.projectionView))return e.$I.copy(this.view,this.prevView),e.$I.copy(this.projection,this.prevProjection),e.$I.mul(this.projectionView,this.projection,this.view),!1;e.$I.copy(this.prevView,this.view),e.$I.copy(this.prevProjection,this.projection)}return u}setState(l,m){this.transition.apply(l,m),this.stateChanged.next(l)}getSnapshot(){return O.copySnapshot(O.createDefaultSnapshot(),this.state)}getTargetDistance(l){return O.targetDistance(l,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height)}getFocus(l,m,u,d,s){var C,h;const a=Math.max(m,.01),S=this.getTargetDistance(a);e.eB.sub(this.deltaDirection,null!==(C=s?.target)&&void 0!==C?C:this.target,null!==(h=s?.position)&&void 0!==h?h:this.position),d&&e.eB.matchDirection(this.deltaDirection,d,this.deltaDirection),e.eB.setMagnitude(this.deltaDirection,this.deltaDirection,S),e.eB.sub(this.newPosition,l,this.deltaDirection);const D=O.copySnapshot(O.createDefaultSnapshot(),this.state);return D.target=e.eB.clone(l),D.radius=a,D.position=e.eB.clone(this.newPosition),u&&e.eB.matchDirection(D.up,u,D.up),D}getCenter(l,m){e.eB.sub(this.deltaDirection,this.target,this.position),e.eB.sub(this.newPosition,l,this.deltaDirection);const u=O.copySnapshot(O.createDefaultSnapshot(),this.state);return u.target=e.eB.clone(l),u.position=e.eB.clone(this.newPosition),m&&(u.radius=Math.max(m,.01)),u}getInvariantFocus(l,m,u,d){const s=Math.max(m,.01),C=this.getTargetDistance(s);e.eB.copy(this.deltaDirection,d),e.eB.setMagnitude(this.deltaDirection,this.deltaDirection,C),e.eB.sub(this.newPosition,l,this.deltaDirection);const h=O.copySnapshot(O.createDefaultSnapshot(),this.state);return h.target=e.eB.clone(l),h.radius=s,h.position=e.eB.clone(this.newPosition),e.eB.copy(h.up,u),h}focus(l,m,u,d,s){m>0&&this.setState(this.getFocus(l,m,d,s),u)}center(l,m){this.setState(this.getCenter(l),m)}project(l,m){return(0,o.$u)(l,m,this.viewport,this.projectionView)}unproject(l,m){return(0,o.IW)(l,m,this.viewport,this.inverseProjectionView)}getPixelSize(l){return this.project(v,l),this.unproject(c,v),v[0]+=1,this.unproject(i,v),e.eB.distance(c,i)}constructor(l,m=o.LM.create(0,0,128,128)){this.view=e.$I.identity(),this.projection=e.$I.identity(),this.projectionView=e.$I.identity(),this.inverseProjectionView=e.$I.identity(),this.state=O.createDefaultSnapshot(),this.viewOffset=O.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new t(this),this.stateChanged=new A.t(this.state),this.prevProjection=e.$I.identity(),this.prevView=e.$I.identity(),this.deltaDirection=(0,e.eB)(),this.newPosition=(0,e.eB)(),this.viewport=m,O.copySnapshot(this.state,l)}}var I;(I=O||(O={})).ViewOffset=function l(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}},I.setViewOffset=function m(a,S,D,R,f,p,E){a.fullWidth=S,a.fullHeight=D,a.offsetX=R,a.offsetY=f,a.width=p,a.height=E},I.copyViewOffset=function u(a,S){a.enabled=S.enabled,a.fullWidth=S.fullWidth,a.fullHeight=S.fullHeight,a.offsetX=S.offsetX,a.offsetY=S.offsetY,a.width=S.width,a.height=S.height},I.targetDistance=function d(a,S,D,R,f){const p=Math.max(a,.01),T=f<R?1:R/f;return Math.abs("orthographic"===S?p/T/Math.tan(D/2):p/T/Math.sin(D/2))},I.createDefaultSnapshot=function s(){return{mode:"perspective",fov:Math.PI/4,position:e.eB.create(0,0,100),up:e.eB.create(0,1,0),target:e.eB.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}},I.copySnapshot=function C(a,S){return S&&(typeof S.mode<"u"&&(a.mode=S.mode),typeof S.fov<"u"&&(a.fov=S.fov),typeof S.position<"u"&&e.eB.copy(a.position,S.position),typeof S.up<"u"&&e.eB.copy(a.up,S.up),typeof S.target<"u"&&e.eB.copy(a.target,S.target),typeof S.radius<"u"&&(a.radius=S.radius),typeof S.radiusMax<"u"&&(a.radiusMax=S.radiusMax),typeof S.fog<"u"&&(a.fog=S.fog),typeof S.clipFar<"u"&&(a.clipFar=S.clipFar),typeof S.minNear<"u"&&(a.minNear=S.minNear),typeof S.minFar<"u"&&(a.minFar=S.minFar)),a},I.areSnapshotsEqual=function h(a,S){return a.mode===S.mode&&a.fov===S.fov&&a.radius===S.radius&&a.radiusMax===S.radiusMax&&a.fog===S.fog&&a.clipFar===S.clipFar&&a.minNear===S.minNear&&a.minFar===S.minFar&&e.eB.exactEquals(a.position,S.position)&&e.eB.exactEquals(a.up,S.up)&&e.eB.exactEquals(a.target,S.target)}},7361:(tn,Ue,n)=>{"use strict";n.d(Ue,{$u:()=>t,IW:()=>A,LM:()=>o});var y,e=n(4369);function o(){return o.zero()}(y=o||(o={})).zero=function c(){return{x:0,y:0,width:0,height:0}},y.create=function i(I,l,m,u){return{x:I,y:l,width:m,height:u}},y.clone=function v(I){return{...I}},y.copy=function O(I,l){return Object.assign(I,l)},y.set=function b(I,l,m,u,d){return I.x=l,I.y=m,I.width=u,I.height=d,I},y.toVec4=function _(I,l){return I[0]=l.x,I[1]=l.y,I[2]=l.width,I[3]=l.height,I},y.equals=function M(I,l){return I.x===l.x&&I.y===l.y&&I.width===l.width&&I.height===l.height};const r=(0,e.Zb)();function t(y,c,i,v){const{x:O,y:b,width:_,height:M}=i;e.Zb.set(r,c[0],c[1],c[2],1),e.Zb.transformMat4(r,r,v);const I=r[3];return 0!==I&&(r[0]/=I,r[1]/=I,r[2]/=I),y[0]=(r[0]+1)*_*.5+O,y[1]=(r[1]+1)*M*.5+b,y[2]=.5*(r[2]+1),y[3]=0===I?0:1/I,y}function A(y,c,i,v){const{x:O,y:b,width:_,height:M}=i,l=c[1]-b,m=c[2];return y[0]=2*(c[0]-O)/_-1,y[1]=2*l/M-1,y[2]=2*m-1,e.eB.transformMat4(y,y,v)}},3177:(tn,Ue,n)=>{"use strict";n.d(Ue,{mX:()=>En,H7:()=>Xt,_i:()=>ht,FN:()=>pt});var e=n(4412),o=n(9854),r=n(4369),t=n(4080),A=n(7361),y=n(190),c=n(9909),i=n(8277),v=n(4490),O=n(6115),b=n(127),_=n(2629),M=n(9137),I=n(9457),l=function(Tt){return Tt[Tt.None=0]="None",Tt[Tt.Object=1]="Object",Tt[Tt.Instance=2]="Instance",Tt[Tt.Group=3]="Group",Tt}(l||{}),m=function(Tt){return Tt[Tt.None=0]="None",Tt[Tt.Depth=1]="Depth",Tt[Tt.Mask=2]="Mask",Tt}(m||{});const u={backgroundColor:i.t.Color((0,y.Q1)(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:i.t.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:i.t.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:i.t.Boolean(!0,{label:"Use Interior Color"}),interiorColor:i.t.Color(y.Q1.fromNormalizedRgb(.3,.3,.3)),colorMarker:i.t.Boolean(!0,{description:"Enable color marker"}),highlightColor:i.t.Color(y.Q1.fromNormalizedRgb(1,.4,.6)),selectColor:i.t.Color(y.Q1.fromNormalizedRgb(.2,1,.1)),dimColor:i.t.Color(y.Q1.fromNormalizedRgb(1,1,1)),highlightStrength:i.t.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:i.t.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:i.t.Numeric(0,{min:0,max:1,step:.1}),markerPriority:i.t.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:i.t.Numeric(1,{min:0,max:3,step:.1}),exposure:i.t.Numeric(1,{min:0,max:3,step:.01}),light:i.t.ObjectList({inclination:i.t.Numeric(150,{min:0,max:180,step:1}),azimuth:i.t.Numeric(320,{min:0,max:360,step:1}),color:i.t.Color(y.Q1.fromNormalizedRgb(1,1,1)),intensity:i.t.Numeric(.6,{min:0,max:5,step:.01})},Tt=>y.Q1.toHexString(Tt.color),{defaultValue:[{inclination:150,azimuth:320,color:y.Q1.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:i.t.Color(y.Q1.fromNormalizedRgb(1,1,1)),ambientIntensity:i.t.Numeric(.4,{min:0,max:2,step:.01})},d=(0,r.eB)(),s=(0,r.eB)();function C(Tt,Fe){const He=Tt.length,{direction:Ye,color:ot}=Fe||{direction:new Array(3*He).fill(0),color:new Array(3*He).fill(0)};for(let rt=0;rt<He;++rt){const St=Tt[rt];r.eB.directionFromSpherical(d,(0,v.pu)(St.inclination),(0,v.pu)(St.azimuth),1),r.eB.toArray(d,Ye,3*rt),r.eB.scale(s,y.Q1.toVec3Normalized(s,St.color),St.intensity),r.eB.toArray(s,ot,3*rt)}return{count:He,direction:Ye,color:ot}}var h;(h||(h={})).create=function Fe(He,Ye={}){const{gl:ot,state:rt,stats:St}=He,vt=i.t.merge(u,i.t.getDefaultValues(u),Ye),mn=C(vt.light),zt=(0,A.LM)(),an=r.ZY.create(ot.drawingBufferWidth,ot.drawingBufferHeight),Vn=y.Q1.toVec3Normalized((0,r.eB)(),vt.backgroundColor);let Fn=!1,rr=null;const Vr=He.resources.texture("image-uint8","rgba","ubyte","nearest");Vr.define(1,1),Vr.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});const tr=[["tDepth",Vr]],Tr=(0,r.$I)(),oo=(0,r.$I)(),Gr=(0,r.$I)(),Ao=(0,r.$I)(),yo=(0,r.$I)(),vo=(0,r.$I)(),Kr=(0,r.$I)(),Do=(0,r.eB)(),lo=(0,r.eB)(),So=(0,I.i)(),ao=(0,r.ZY)(),Po=(0,M.Q)(),Yr=(0,r.eB)();r.eB.scale(Yr,y.Q1.toArrayNormalized(vt.ambientColor,Yr,0),vt.ambientIntensity);const jr={uDrawId:c.IQ.create(0),uModel:c.IQ.create(r.$I.identity()),uView:c.IQ.create(Tr),uInvView:c.IQ.create(oo),uModelView:c.IQ.create(Gr),uInvModelView:c.IQ.create(Ao),uInvProjection:c.IQ.create(yo),uProjection:c.IQ.create((0,r.$I)()),uModelViewProjection:c.IQ.create(vo),uInvModelViewProjection:c.IQ.create(Kr),uIsOrtho:c.IQ.create(1),uViewOffset:c.IQ.create(ao),uPixelRatio:c.IQ.create(He.pixelRatio),uViewport:c.IQ.create(A.LM.toVec4((0,r.Zb)(),zt)),uDrawingBufferSize:c.IQ.create(an),uCameraPosition:c.IQ.create(lo),uCameraDir:c.IQ.create(Do),uCameraPlane:c.IQ.create(I.i.toArray(So,(0,r.Zb)(),0)),uNear:c.IQ.create(1),uFar:c.IQ.create(1e4),uFog:c.IQ.create(!0),uFogNear:c.IQ.create(1),uFogFar:c.IQ.create(1e4),uFogColor:c.IQ.create(Vn),uRenderMask:c.IQ.create(0),uMarkingDepthTest:c.IQ.create(!1),uPickType:c.IQ.create(l.None),uMarkingType:c.IQ.create(m.None),uTransparentBackground:c.IQ.create(!1),uLightDirection:c.IQ.create(mn.direction),uLightColor:c.IQ.create(mn.color),uAmbientColor:c.IQ.create(Yr),uPickingAlphaThreshold:c.IQ.create(vt.pickingAlphaThreshold),uInteriorDarkening:c.IQ.create(vt.interiorDarkening),uInteriorColorFlag:c.IQ.create(vt.interiorColorFlag),uInteriorColor:c.IQ.create(y.Q1.toVec3Normalized((0,r.eB)(),vt.interiorColor)),uHighlightColor:c.IQ.create(y.Q1.toVec3Normalized((0,r.eB)(),vt.highlightColor)),uSelectColor:c.IQ.create(y.Q1.toVec3Normalized((0,r.eB)(),vt.selectColor)),uDimColor:c.IQ.create(y.Q1.toVec3Normalized((0,r.eB)(),vt.dimColor)),uHighlightStrength:c.IQ.create(vt.highlightStrength),uSelectStrength:c.IQ.create(vt.selectStrength),uDimStrength:c.IQ.create(vt.dimStrength),uMarkerPriority:c.IQ.create(vt.markerPriority),uMarkerAverage:c.IQ.create(0),uXrayEdgeFalloff:c.IQ.create(vt.xrayEdgeFalloff),uExposure:c.IQ.create(vt.exposure)},Co=Object.entries(jr);let Eo=!0;const Fo=(Hn,qr,co)=>{var zr,lr,kr;if(Hn.state.disposed||!Hn.state.visible||!Hn.state.pickable&&"pick"===qr||!M.Q.intersectsSphere3D(Po,Hn.values.boundingSphere.ref.value))return;const[Qr,vi]=Hn.values.uLod.ref.value;if(0!==Qr||0!==vi){const{center:bi,radius:Vi}=Hn.values.boundingSphere.ref.value,Ei=I.i.distanceToPoint(So,bi);if(Ei+Vi<Qr||Ei-Vi>vi)return}const Ti=Hn.values.instanceGrid.ref.value.cellSize>1;Ti||Ti&&Hn.values.lodLevels?Hn.cull(So,Po,rr,He.stats):Hn.uncull();let Bi=!1;Hn.values.dLightCount.ref.value!==mn.count&&(c.IQ.update(Hn.values.dLightCount,mn.count),Bi=!0),Hn.values.dColorMarker.ref.value!==vt.colorMarker&&(c.IQ.update(Hn.values.dColorMarker,vt.colorMarker),Bi=!0),Bi&&Hn.update();const Li=Hn.getProgram(qr);if(rt.currentProgramId!==Li.id&&(Eo=!0,Li.use()),Eo&&(Li.setUniforms(Co),Li.bindTextures(tr,0),Eo=!1),"directVolume"===Hn.values.dGeometryType.ref.value){if("color"!==qr)return;rt.disable(ot.CULL_FACE),rt.frontFace(ot.CCW),3===co&&(rt.disable(ot.DEPTH_TEST),rt.depthMask(!1))}else 1===co?(rt.enable(ot.CULL_FACE),null!==(zr=Hn.values.dFlipSided)&&void 0!==zr&&zr.ref.value?(rt.frontFace(ot.CW),rt.cullFace(ot.FRONT)):(rt.frontFace(ot.CCW),rt.cullFace(ot.BACK))):2===co?(rt.enable(ot.CULL_FACE),null!==(lr=Hn.values.dFlipSided)&&void 0!==lr&&lr.ref.value?(rt.frontFace(ot.CW),rt.cullFace(ot.BACK)):(rt.frontFace(ot.CCW),rt.cullFace(ot.FRONT))):(Hn.values.uDoubleSided?Hn.values.uDoubleSided.ref.value||Hn.values.hasReflection.ref.value?rt.disable(ot.CULL_FACE):rt.enable(ot.CULL_FACE):rt.disable(ot.CULL_FACE),null!==(kr=Hn.values.dFlipSided)&&void 0!==kr&&kr.ref.value?(rt.frontFace(ot.CW),rt.cullFace(ot.FRONT)):(rt.frontFace(ot.CCW),rt.cullFace(ot.BACK)));Hn.render(qr,tr.length)},Yo=(Hn,qr,co,zr,lr)=>{(0,O.$6)(tr,"tDepth",co||Vr),c.IQ.update(jr.uModel,Hn.view),c.IQ.update(jr.uModelView,r.$I.mul(Gr,qr.view,Hn.view)),c.IQ.update(jr.uInvModelView,r.$I.invert(Ao,Gr)),c.IQ.update(jr.uModelViewProjection,r.$I.mul(vo,Gr,qr.projection)),c.IQ.update(jr.uInvModelViewProjection,r.$I.invert(Kr,vo)),c.IQ.updateIfChanged(jr.uRenderMask,zr),c.IQ.updateIfChanged(jr.uMarkingDepthTest,lr),rt.enable(ot.SCISSOR_TEST),rt.colorMask(!0,!0,!0,!0);const{x:kr,y:Qr,width:vi,height:Ti}=zt;rt.viewport(kr,Qr,vi,Ti),rt.scissor(kr,Qr,vi,Ti),Eo=!0,rt.currentRenderItemId=-1},ci=function(Hn){var qr,co,zr,lr;const kr=(0,b.qE)(Hn.values.alpha.ref.value*Hn.state.alphaFactor,0,1),Qr="on"===(null===(qr=Hn.values.dXrayShaded)||void 0===qr?void 0:qr.ref.value)||"inverted"===(null===(co=Hn.values.dXrayShaded)||void 0===co?void 0:co.ref.value);return 1===kr&&1!==Hn.values.transparencyAverage.ref.value&&"directVolume"!==Hn.values.dGeometryType.ref.value&&"fuzzy"!==(null===(zr=Hn.values.dPointStyle)||void 0===zr?void 0:zr.ref.value)&&!Qr||"opaque"===(null===(lr=Hn.values.dTransparentBackfaces)||void 0===lr?void 0:lr.ref.value)},Jo=function(Hn){var qr,co,zr;const lr=(0,b.qE)(Hn.values.alpha.ref.value*Hn.state.alphaFactor,0,1),kr="on"===(null===(qr=Hn.values.dXrayShaded)||void 0===qr?void 0:qr.ref.value)||"inverted"===(null===(co=Hn.values.dXrayShaded)||void 0===co?void 0:co.ref.value);return lr<1&&0!==lr||Hn.values.transparencyAverage.ref.value>0||"directVolume"===Hn.values.dGeometryType.ref.value||"fuzzy"===(null===(zr=Hn.values.dPointStyle)||void 0===zr?void 0:zr.ref.value)||"text"===Hn.values.dGeometryType.ref.value||"image"===Hn.values.dGeometryType.ref.value||kr},es=(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderBlendedOpaque"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,1,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];ci(Qr)&&Fo(Qr,"color",0)}_.g$&&He.timer.markEnd("Renderer.renderBlendedOpaque")},Si=(Hn,qr,co)=>{var zr,lr;_.g$&&He.timer.mark("Renderer.renderBlendedTransparent"),Fn?rt.blendFunc(ot.ONE,ot.ONE_MINUS_SRC_ALPHA):rt.blendFuncSeparate(ot.SRC_ALPHA,ot.ONE_MINUS_SRC_ALPHA,ot.ONE,ot.ONE_MINUS_SRC_ALPHA),rt.enable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!1),Yo(Hn,qr,co,2,!1);const{renderables:kr}=Hn;for(let Qr=0,vi=kr.length;Qr<vi;++Qr){const Ti=kr[Qr];Jo(Ti)&&(null!==(zr=Ti.values.uDoubleSided)&&void 0!==zr&&zr.ref.value?("opaque"!==(null===(lr=Ti.values.dTransparentBackfaces)||void 0===lr?void 0:lr.ref.value)&&Fo(Ti,"color",2),Fo(Ti,"color",1)):Fo(Ti,"color",0))}_.g$&&He.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:(Hn,qr)=>{rt.enable(ot.SCISSOR_TEST),rt.enable(ot.DEPTH_TEST),rt.colorMask(!0,!0,!0,!0),rt.depthMask(!0),Fn&&!qr?rt.clearColor(0,0,0,0):Hn?rt.clearColor(Vn[0],Vn[1],Vn[2],1):rt.clearColor(1,1,1,1),ot.clear(ot.COLOR_BUFFER_BIT|ot.DEPTH_BUFFER_BIT)},clearDepth:(Hn=!1)=>{rt.enable(ot.SCISSOR_TEST),Hn?(rt.colorMask(!0,!0,!0,!0),rt.clearColor(1,1,1,1),ot.clear(ot.COLOR_BUFFER_BIT|ot.DEPTH_BUFFER_BIT)):(rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),ot.clear(ot.DEPTH_BUFFER_BIT))},update:(Hn,qr)=>{c.IQ.update(jr.uView,Hn.view),c.IQ.update(jr.uInvView,r.$I.invert(oo,Hn.view)),c.IQ.update(jr.uProjection,Hn.projection),c.IQ.update(jr.uInvProjection,r.$I.invert(yo,Hn.projection)),c.IQ.updateIfChanged(jr.uIsOrtho,"orthographic"===Hn.state.mode?1:0),c.IQ.update(jr.uViewOffset,Hn.viewOffset.enabled?r.ZY.set(ao,16*Hn.viewOffset.offsetX,16*Hn.viewOffset.offsetY):r.ZY.set(ao,0,0)),c.IQ.update(jr.uCameraPosition,r.eB.copy(lo,Hn.state.position)),c.IQ.update(jr.uCameraDir,r.eB.normalize(Do,r.eB.sub(Do,Hn.state.target,Hn.state.position))),c.IQ.updateIfChanged(jr.uFar,Hn.far),c.IQ.updateIfChanged(jr.uNear,Hn.near),c.IQ.updateIfChanged(jr.uFog,Hn.state.fog>0),c.IQ.updateIfChanged(jr.uFogFar,Hn.fogFar),c.IQ.updateIfChanged(jr.uFogNear,Hn.fogNear),c.IQ.updateIfChanged(jr.uTransparentBackground,Fn),M.Q.fromProjectionMatrix(Po,Hn.projectionView),I.i.copy(So,Po[5]),So.constant-=I.i.distanceToPoint(So,lo),c.IQ.update(jr.uCameraPlane,I.i.toArray(So,jr.uCameraPlane.ref.value,0)),c.IQ.updateIfChanged(jr.uMarkerAverage,qr.markerAverage)},renderPick:(Hn,qr,co,zr,lr)=>{_.g$&&He.timer.mark("Renderer.renderPick"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,zr,0,!1),c.IQ.updateIfChanged(jr.uPickType,lr);const{renderables:kr}=Hn;for(let Qr=0,vi=kr.length;Qr<vi;++Qr)kr[Qr].state.colorOnly||Fo(kr[Qr],co,0);_.g$&&He.timer.markEnd("Renderer.renderPick")},renderDepth:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderDepth"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,0,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr)Fo(zr[lr],"depth",0);_.g$&&He.timer.markEnd("Renderer.renderDepth")},renderDepthOpaque:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderDepthOpaque"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,1,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];ci(Qr)&&Fo(Qr,"depth",0)}_.g$&&He.timer.markEnd("Renderer.renderDepthOpaque")},renderDepthTransparent:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderDepthTransparent"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,2,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];Jo(Qr)&&Fo(Qr,"depth",0)}_.g$&&He.timer.markEnd("Renderer.renderDepthTransparent")},renderMarkingDepth:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderMarkingDepth"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,0,!1),c.IQ.updateIfChanged(jr.uMarkingType,m.Depth);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];0!==(0,b.qE)(Qr.values.alpha.ref.value*Qr.state.alphaFactor,0,1)&&1!==Qr.values.transparencyAverage.ref.value&&1!==Qr.values.markerAverage.ref.value&&Fo(zr[lr],"marking",0)}_.g$&&He.timer.markEnd("Renderer.renderMarkingDepth")},renderMarkingMask:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderMarkingMask"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,0,!!co),c.IQ.updateIfChanged(jr.uMarkingType,m.Mask);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr)zr[lr].values.markerAverage.ref.value>0&&Fo(zr[lr],"marking",0);_.g$&&He.timer.markEnd("Renderer.renderMarkingMask")},renderEmissive:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderEmissive"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,1,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];ci(Qr)&&Fo(Qr,"emissive",0)}_.g$&&He.timer.markEnd("Renderer.renderEmissive")},renderBlended:(Hn,qr)=>{Hn.hasOpaque&&es(Hn,qr,null),Hn.opacityAverage<1&&Si(Hn,qr,null)},renderBlendedOpaque:es,renderBlendedTransparent:Si,renderBlendedVolume:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderBlendedVolume"),rt.blendFunc(ot.ONE,ot.ONE_MINUS_SRC_ALPHA),rt.enable(ot.BLEND),rt.depthMask(!1),Yo(Hn,qr,co,2,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];"directVolume"===Qr.values.dGeometryType.ref.value&&Fo(Qr,"color",3)}_.g$&&He.timer.markEnd("Renderer.renderBlendedVolume")},renderWboitOpaque:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderWboitOpaque"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,1,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];ci(Qr)&&Fo(Qr,"color",0)}_.g$&&He.timer.markEnd("Renderer.renderWboitOpaque")},renderWboitTransparent:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderWboitTransparent"),Yo(Hn,qr,co,2,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];Jo(Qr)&&Fo(Qr,"color",0)}_.g$&&He.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitOpaque:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderDpoitOpaque"),rt.disable(ot.BLEND),rt.enable(ot.DEPTH_TEST),rt.depthMask(!0),Yo(Hn,qr,co,1,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];ci(Qr)&&Fo(Qr,"color",0)}_.g$&&He.timer.markEnd("Renderer.renderDpoitOpaque")},renderDpoitTransparent:(Hn,qr,co,zr)=>{_.g$&&He.timer.mark("Renderer.renderDpoitTransparent"),rt.enable(ot.BLEND),(0,O.$6)(tr,"tDpoitDepth",zr.depth),(0,O.$6)(tr,"tDpoitFrontColor",zr.frontColor),(0,O.$6)(tr,"tDpoitBackColor",zr.backColor),Yo(Hn,qr,co,2,!1);const{renderables:lr}=Hn;for(let kr=0,Qr=lr.length;kr<Qr;++kr){const vi=lr[kr];Jo(vi)&&Fo(vi,"color",0)}_.g$&&He.timer.markEnd("Renderer.renderDpoitTransparent")},renderDpoitVolume:(Hn,qr,co)=>{_.g$&&He.timer.mark("Renderer.renderDpoitVolume"),rt.blendFunc(ot.ONE,ot.ONE_MINUS_SRC_ALPHA),rt.enable(ot.BLEND),Yo(Hn,qr,co,2,!1);const{renderables:zr}=Hn;for(let lr=0,kr=zr.length;lr<kr;++lr){const Qr=zr[lr];"directVolume"===Qr.values.dGeometryType.ref.value&&Fo(Qr,"color",0)}_.g$&&He.timer.markEnd("Renderer.renderDpoitVolume")},setProps:Hn=>{void 0!==Hn.backgroundColor&&Hn.backgroundColor!==vt.backgroundColor&&(vt.backgroundColor=Hn.backgroundColor,y.Q1.toVec3Normalized(Vn,vt.backgroundColor),c.IQ.update(jr.uFogColor,r.eB.copy(jr.uFogColor.ref.value,Vn))),void 0!==Hn.pickingAlphaThreshold&&Hn.pickingAlphaThreshold!==vt.pickingAlphaThreshold&&(vt.pickingAlphaThreshold=Hn.pickingAlphaThreshold,c.IQ.update(jr.uPickingAlphaThreshold,vt.pickingAlphaThreshold)),void 0!==Hn.interiorDarkening&&Hn.interiorDarkening!==vt.interiorDarkening&&(vt.interiorDarkening=Hn.interiorDarkening,c.IQ.update(jr.uInteriorDarkening,vt.interiorDarkening)),void 0!==Hn.interiorColorFlag&&Hn.interiorColorFlag!==vt.interiorColorFlag&&(vt.interiorColorFlag=Hn.interiorColorFlag,c.IQ.update(jr.uInteriorColorFlag,vt.interiorColorFlag)),void 0!==Hn.interiorColor&&Hn.interiorColor!==vt.interiorColor&&(vt.interiorColor=Hn.interiorColor,c.IQ.update(jr.uInteriorColor,y.Q1.toVec3Normalized(jr.uInteriorColor.ref.value,vt.interiorColor))),void 0!==Hn.colorMarker&&Hn.colorMarker!==vt.colorMarker&&(vt.colorMarker=Hn.colorMarker),void 0!==Hn.highlightColor&&Hn.highlightColor!==vt.highlightColor&&(vt.highlightColor=Hn.highlightColor,c.IQ.update(jr.uHighlightColor,y.Q1.toVec3Normalized(jr.uHighlightColor.ref.value,vt.highlightColor))),void 0!==Hn.selectColor&&Hn.selectColor!==vt.selectColor&&(vt.selectColor=Hn.selectColor,c.IQ.update(jr.uSelectColor,y.Q1.toVec3Normalized(jr.uSelectColor.ref.value,vt.selectColor))),void 0!==Hn.dimColor&&Hn.dimColor!==vt.dimColor&&(vt.dimColor=Hn.dimColor,c.IQ.update(jr.uDimColor,y.Q1.toVec3Normalized(jr.uDimColor.ref.value,vt.dimColor))),void 0!==Hn.highlightStrength&&Hn.highlightStrength!==vt.highlightStrength&&(vt.highlightStrength=Hn.highlightStrength,c.IQ.update(jr.uHighlightStrength,vt.highlightStrength)),void 0!==Hn.selectStrength&&Hn.selectStrength!==vt.selectStrength&&(vt.selectStrength=Hn.selectStrength,c.IQ.update(jr.uSelectStrength,vt.selectStrength)),void 0!==Hn.dimStrength&&Hn.dimStrength!==vt.dimStrength&&(vt.dimStrength=Hn.dimStrength,c.IQ.update(jr.uDimStrength,vt.dimStrength)),void 0!==Hn.markerPriority&&Hn.markerPriority!==vt.markerPriority&&(vt.markerPriority=Hn.markerPriority,c.IQ.update(jr.uMarkerPriority,vt.markerPriority)),void 0!==Hn.xrayEdgeFalloff&&Hn.xrayEdgeFalloff!==vt.xrayEdgeFalloff&&(vt.xrayEdgeFalloff=Hn.xrayEdgeFalloff,c.IQ.update(jr.uXrayEdgeFalloff,vt.xrayEdgeFalloff)),void 0!==Hn.exposure&&Hn.exposure!==vt.exposure&&(vt.exposure=Hn.exposure,c.IQ.update(jr.uExposure,vt.exposure)),void 0!==Hn.light&&!(0,c.bD)(Hn.light,vt.light)&&(vt.light=Hn.light,Object.assign(mn,C(Hn.light,mn)),c.IQ.update(jr.uLightDirection,mn.direction),c.IQ.update(jr.uLightColor,mn.color)),void 0!==Hn.ambientColor&&Hn.ambientColor!==vt.ambientColor&&(vt.ambientColor=Hn.ambientColor,r.eB.scale(Yr,y.Q1.toArrayNormalized(vt.ambientColor,Yr,0),vt.ambientIntensity),c.IQ.update(jr.uAmbientColor,Yr)),void 0!==Hn.ambientIntensity&&Hn.ambientIntensity!==vt.ambientIntensity&&(vt.ambientIntensity=Hn.ambientIntensity,r.eB.scale(Yr,y.Q1.toArrayNormalized(vt.ambientColor,Yr,0),vt.ambientIntensity),c.IQ.update(jr.uAmbientColor,Yr))},setViewport:(Hn,qr,co,zr)=>{rt.viewport(Hn,qr,co,zr),rt.scissor(Hn,qr,co,zr),(Hn!==zt.x||qr!==zt.y||co!==zt.width||zr!==zt.height)&&(A.LM.set(zt,Hn,qr,co,zr),c.IQ.update(jr.uViewport,r.Zb.set(jr.uViewport.ref.value,Hn,qr,co,zr)))},setTransparentBackground:Hn=>{Fn=Hn},setDrawingBufferSize:(Hn,qr)=>{(Hn!==an[0]||qr!==an[1])&&c.IQ.update(jr.uDrawingBufferSize,r.ZY.set(an,Hn,qr))},setPixelRatio:Hn=>{c.IQ.update(jr.uPixelRatio,Hn)},setOcclusionTest:Hn=>{rr=Hn},props:vt,get stats(){return{programCount:He.stats.resourceCounts.program,shaderCount:He.stats.resourceCounts.shader,attributeCount:He.stats.resourceCounts.attribute,elementsCount:He.stats.resourceCounts.elements,framebufferCount:He.stats.resourceCounts.framebuffer,renderbufferCount:He.stats.resourceCounts.renderbuffer,textureCount:He.stats.resourceCounts.texture,vertexArrayCount:He.stats.resourceCounts.vertexArray,drawCount:St.drawCount,instanceCount:St.instanceCount,instancedDrawCount:St.instancedDrawCount}},get light(){return mn},dispose:()=>{}}};var a=n(4123);const S=t.qt,D=t.Fs,R=a.O.Trigger,f=a.O.TriggerKey,p={dragRotate:(0,a.O)([R(S.Flag.Primary,D.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:(0,a.O)([R(S.Flag.Primary,D.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:(0,a.O)([R(S.Flag.Secondary,D.create()),R(S.Flag.Primary,D.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:a.O.Empty,dragFocus:(0,a.O)([R(S.Flag.Forth,D.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:(0,a.O)([R(S.Flag.Auxilary,D.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:(0,a.O)([R(S.Flag.Auxilary,D.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:(0,a.O)([R(S.Flag.Auxilary,D.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:a.O.Empty,keyMoveForward:(0,a.O)([f("KeyW")],"Move forward","Press ${triggers}"),keyMoveBack:(0,a.O)([f("KeyS")],"Move back","Press ${triggers}"),keyMoveLeft:(0,a.O)([f("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:(0,a.O)([f("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:(0,a.O)([f("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:(0,a.O)([f("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:(0,a.O)([f("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:(0,a.O)([f("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:(0,a.O)([f("ArrowUp",D.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:(0,a.O)([f("ArrowDown",D.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:(0,a.O)([f("ArrowLeft",D.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:(0,a.O)([f("ArrowRight",D.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:(0,a.O)([f("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:(0,a.O)([f("Space",D.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},E={noScroll:i.t.Boolean(!0,{isHidden:!0}),rotateSpeed:i.t.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:i.t.Numeric(7,{min:1,max:15,step:1}),panSpeed:i.t.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:i.t.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:i.t.Numeric(5,{min:.1,max:10,step:.1}),flyMode:i.t.Boolean(!1),animate:i.t.MappedStatic("off",{off:i.t.EmptyGroup(),spin:i.t.Group({speed:i.t.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:i.t.Group({speed:i.t.Numeric(.3,{min:-5,max:5,step:.1}),angle:i.t.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:i.t.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:i.t.Numeric(.2,{},{isHidden:!0}),minDistance:i.t.Numeric(.01,{},{isHidden:!0}),maxDistance:i.t.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:i.t.Numeric(1,{},{isHidden:!0}),maxWheelDelta:i.t.Numeric(.02,{},{isHidden:!0}),bindings:i.t.Value(p,{isHidden:!0}),autoAdjustMinMaxDistance:i.t.MappedStatic("on",{off:i.t.EmptyGroup(),on:i.t.Group({minDistanceFactor:i.t.Numeric(0),minDistancePadding:i.t.Numeric(5),maxDistanceFactor:i.t.Numeric(10),maxDistanceMin:i.t.Numeric(20)})},{isHidden:!0})};var T;(T||(T={})).create=function Fe(He,Ye,ot,rt={}){const St={...i.t.getDefaultValues(E),...rt,bindings:{...p,...rt.bindings}},vt=St.bindings,mn=A.LM.clone(Ye.viewport);let zt=!1;const an=He.drag.subscribe(function et({x:hr,y:Wr,pageX:no,pageY:zo,buttons:Di,modifiers:zi,isStart:Ki}){const Mi=sr(hr,Wr);if(Ki&&Mi||!Ki&&!yo)return;yo=!0,Gi();const ds=a.O.match(vt.dragRotate,Di,zi),he=a.O.match(vt.dragRotateZ,Di,zi),fe=a.O.match(vt.dragPan,Di,zi),ze=a.O.match(vt.dragZoom,Di,zi),Ze=a.O.match(vt.dragFocus,Di,zi),it=a.O.match(vt.dragFocusZoom,Di,zi);ti(no,zo),function qi(hr,Wr){r.ZY.set(mi,(hr-mn.x)/mn.width,(Wr-mn.y)/mn.height)}(no,zo);const Rt=He.pixelRatio,X=(hr*Rt-mn.width/2-mn.x)/mn.width,pe=-(He.height-Wr*Rt-mn.height/2-mn.y)/mn.height;if(Ki&&(ds&&(r.ZY.copy(lo,Oi),r.ZY.copy(Do,lo)),he&&(r.ZY.set(Yr,X,pe),r.ZY.copy(Po,Yr)),(ze||it)&&(r.ZY.copy(Fo,mi),r.ZY.copy(ei,Fo)),Ze&&(r.ZY.copy(Yo,mi),r.ZY.copy(ci,Yo)),fe&&(r.ZY.copy(Jo,mi),r.ZY.copy(Fi,Jo))),ds&&r.ZY.copy(lo,Oi),he&&r.ZY.set(Yr,X,pe),(ze||it)&&r.ZY.copy(ei,mi),Ze&&r.ZY.copy(ci,mi),it){const De=r.eB.distance(Ye.state.position,Ye.state.target);Ye.setState({radius:De/5})}fe&&r.ZY.copy(Fi,mi)}),Vn=He.interactionEnd.subscribe(function at(){yo=!1}),Fn=He.wheel.subscribe(function Et({x:hr,y:Wr,spinX:no,spinY:zo,dz:Di,buttons:zi,modifiers:Ki}){if(sr(hr,Wr))return;let Mi=(0,v.TY)(.075*no,.075*zo,1e-4*Di);Mi<-St.maxWheelDelta?Mi=-St.maxWheelDelta:Mi>St.maxWheelDelta&&(Mi=St.maxWheelDelta),a.O.match(vt.scrollZoom,zi,Ki)&&(ei[1]+=Mi),a.O.match(vt.scrollFocus,zi,Ki)&&(ci[1]+=Mi)}),rr=He.pinch.subscribe(function Nt({fractionDelta:hr,buttons:Wr,modifiers:no}){a.O.match(vt.scrollZoom,Wr,no)&&(yo=!0,ei[1]+=St.gestureScaleFactor*hr)}),Vr=He.gesture.subscribe(function qt({deltaScale:hr}){yo=!0,ei[1]+=St.gestureScaleFactor*hr}),tr=He.keyDown.subscribe(function Un({modifiers:hr,code:Wr,key:no,x:zo,y:Di}){sr(zo,Di)||(a.O.matchKey(vt.keyMoveForward,Wr,hr,no)?Ht.moveForward=1:a.O.matchKey(vt.keyMoveBack,Wr,hr,no)?Ht.moveBack=1:a.O.matchKey(vt.keyMoveLeft,Wr,hr,no)?Ht.moveLeft=1:a.O.matchKey(vt.keyMoveRight,Wr,hr,no)?Ht.moveRight=1:a.O.matchKey(vt.keyMoveUp,Wr,hr,no)?Ht.moveUp=1:a.O.matchKey(vt.keyMoveDown,Wr,hr,no)?Ht.moveDown=1:a.O.matchKey(vt.keyRollLeft,Wr,hr,no)?Ht.rollLeft=1:a.O.matchKey(vt.keyRollRight,Wr,hr,no)?Ht.rollRight=1:a.O.matchKey(vt.keyPitchUp,Wr,hr,no)?Ht.pitchUp=1:a.O.matchKey(vt.keyPitchDown,Wr,hr,no)?Ht.pitchDown=1:a.O.matchKey(vt.keyYawLeft,Wr,hr,no)?Ht.yawLeft=1:a.O.matchKey(vt.keyYawRight,Wr,hr,no)&&(Ht.yawRight=1),a.O.matchKey(vt.boostMove,Wr,hr,no)&&(Ht.boostMove=1),a.O.matchKey(vt.enablePointerLock,Wr,hr,no)&&He.requestPointerLock(mn))}),Tr=He.keyUp.subscribe(function vn({modifiers:hr,code:Wr,key:no,x:zo,y:Di}){var zi,Ki,Mi,ds,he,fe,ze,Ze,it,Rt,X,pe;if(sr(zo,Di))return;let De=!1;Wr.startsWith("Alt")?(De=!0,hr.alt=!0):Wr.startsWith("Shift")?(De=!0,hr.shift=!0):Wr.startsWith("Control")?(De=!0,hr.control=!0):Wr.startsWith("Meta")&&(De=!0,hr.meta=!0);const Ee=[];De?(Ht.moveForward&&Ee.push((null===(zi=vt.keyMoveForward.triggers[0])||void 0===zi?void 0:zi.code)||""),Ht.moveBack&&Ee.push((null===(Ki=vt.keyMoveBack.triggers[0])||void 0===Ki?void 0:Ki.code)||""),Ht.moveLeft&&Ee.push((null===(Mi=vt.keyMoveLeft.triggers[0])||void 0===Mi?void 0:Mi.code)||""),Ht.moveRight&&Ee.push((null===(ds=vt.keyMoveRight.triggers[0])||void 0===ds?void 0:ds.code)||""),Ht.moveUp&&Ee.push((null===(he=vt.keyMoveUp.triggers[0])||void 0===he?void 0:he.code)||""),Ht.moveDown&&Ee.push((null===(fe=vt.keyMoveDown.triggers[0])||void 0===fe?void 0:fe.code)||""),Ht.rollLeft&&Ee.push((null===(ze=vt.keyRollLeft.triggers[0])||void 0===ze?void 0:ze.code)||""),Ht.rollRight&&Ee.push((null===(Ze=vt.keyRollRight.triggers[0])||void 0===Ze?void 0:Ze.code)||""),Ht.pitchUp&&Ee.push((null===(it=vt.keyPitchUp.triggers[0])||void 0===it?void 0:it.code)||""),Ht.pitchDown&&Ee.push((null===(Rt=vt.keyPitchDown.triggers[0])||void 0===Rt?void 0:Rt.code)||""),Ht.yawLeft&&Ee.push((null===(X=vt.keyYawLeft.triggers[0])||void 0===X?void 0:X.code)||""),Ht.yawRight&&Ee.push((null===(pe=vt.keyYawRight.triggers[0])||void 0===pe?void 0:pe.code)||"")):Ee.push(Wr);for(const qe of Ee)a.O.matchKey(vt.keyMoveForward,qe,hr,no)?Ht.moveForward=0:a.O.matchKey(vt.keyMoveBack,qe,hr,no)?Ht.moveBack=0:a.O.matchKey(vt.keyMoveLeft,qe,hr,no)?Ht.moveLeft=0:a.O.matchKey(vt.keyMoveRight,qe,hr,no)?Ht.moveRight=0:a.O.matchKey(vt.keyMoveUp,qe,hr,no)?Ht.moveUp=0:a.O.matchKey(vt.keyMoveDown,qe,hr,no)?Ht.moveDown=0:a.O.matchKey(vt.keyRollLeft,qe,hr,no)?Ht.rollLeft=0:a.O.matchKey(vt.keyRollRight,qe,hr,no)?Ht.rollRight=0:a.O.matchKey(vt.keyPitchUp,qe,hr,no)?Ht.pitchUp=0:a.O.matchKey(vt.keyPitchDown,qe,hr,no)?Ht.pitchDown=0:a.O.matchKey(vt.keyYawLeft,qe,hr,no)?Ht.yawLeft=0:a.O.matchKey(vt.keyYawRight,qe,hr,no)&&(Ht.yawRight=0);a.O.matchKey(vt.boostMove,Wr,hr,no)&&(Ht.boostMove=0)}),oo=He.move.subscribe(function Cn({movementX:hr,movementY:Wr}){if(!He.pointerLock||void 0===hr||void 0===Wr)return;const no=.5*mn.width-mn.x,zo=.5*mn.height-mn.y;r.ZY.copy(Do,ti(no,zo)),r.ZY.copy(lo,ti(hr+no,Wr+zo))}),Gr=He.lock.subscribe(function Rr(hr){hr?nr():pr()}),Ao=He.leave.subscribe(function Uo(){!function mo(){Ht.moveForward=0,Ht.moveBack=0,Ht.moveLeft=0,Ht.moveRight=0,Ht.moveUp=0,Ht.moveDown=0,Ht.rollLeft=0,Ht.rollRight=0,Ht.pitchUp=0,Ht.pitchDown=0,Ht.yawLeft=0,Ht.yawRight=0,Ht.boostMove=0}()});let yo=!1;const vo=(0,r.eB)(),Kr=(0,r.eB)(),Do=(0,r.ZY)(),lo=(0,r.ZY)(),So=(0,r.eB)();let ao=0;const Po=(0,r.ZY)(),Yr=(0,r.ZY)();let jr=0,Co=0,Eo=0;const Fo=(0,r.ZY)(),ei=(0,r.ZY)(),Yo=(0,r.ZY)(),ci=(0,r.ZY)(),Jo=(0,r.ZY)(),Fi=(0,r.ZY)(),hi=r.eB.clone(Ye.target),No=r.eB.clone(Ye.position),Ci=r.eB.clone(Ye.up),mi=(0,r.ZY)(),Oi=(0,r.ZY)();function ti(hr,Wr){return r.ZY.set(Oi,(hr-.5*mn.width-mn.x)/(.5*mn.width),(mn.height+2*(mn.y-Wr))/mn.width)}function es(){return St.rotateSpeed*He.pixelRatio*(He.width/He.height||1)}const Si=(0,r.eB)(),Pi=(0,r.k)(),ni=(0,r.eB)(),gi=(0,r.eB)(),Wi=(0,r.eB)(),Ri=(0,r.eB)(),Hn=(0,r.k)(),qr=(0,r.eB)(),zr=(0,r.k)(),lr=(0,r.eB)(),Qr=(0,r.k)(),vi=(0,r.eB)(),bi=(0,r.ZY)(),Vi=(0,r.eB)(),Ei=(0,r.eB)(),Ht={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},Gn=(0,r.eB)(),ar=(0,r.eB)();function ur(){const hr=Math.min(Math.max(1e3*Ye.state.radiusMax,.01),St.maxDistance);r.eB.squaredMagnitude(Kr)>hr*hr&&(r.eB.setMagnitude(Kr,Kr,hr),r.eB.add(Ye.position,Ye.target,Kr),r.ZY.copy(Fo,ei),r.ZY.copy(Yo,ci)),r.eB.squaredMagnitude(Kr)<St.minDistance*St.minDistance&&(r.eB.setMagnitude(Kr,Kr,St.minDistance),r.eB.add(Ye.position,Ye.target,Kr),r.ZY.copy(Fo,ei),r.ZY.copy(Yo,ci))}function sr(hr,Wr){return Wr*=He.pixelRatio,(hr*=He.pixelRatio)>mn.x+mn.width||He.height-Wr>mn.y+mn.height||hr<mn.x||He.height-Wr<mn.y}let Jn=-1;function Br(hr){if(Jn===hr)return;const Wr=hr-Jn;Jn>0&&("spin"===St.animate.name?function fo(hr){if("spin"!==St.animate.name||0===St.animate.params.speed||yo)return;const Wr=St.animate.params.speed/1e3;ri[0]=60*Math.min(Math.abs(hr),125)/1e3*Wr,r.ZY.add(lo,Do,ri)}(Wr):"rock"===St.animate.name&&function rs(hr){if("rock"!==St.animate.name||0===St.animate.params.speed||yo)return;const Wr=hr/1e3*St.animate.params.speed,no=(0,v.pu)(St.animate.params.angle)/es(),zo=Math.sin(Lo*Math.PI*2)*no,Di=Math.sin((Lo+Wr)*Math.PI*2)*no;Ni[0]=Di-zo,r.ZY.add(lo,Do,Ni),Lo+=Wr,Lo>=1&&(Lo=0)}(Wr)),r.eB.sub(Kr,Ye.position,Ye.target),function Qi(){const hr=lo[0]-Do[0],Wr=lo[1]-Do[1];r.eB.set(Ri,hr,Wr,0);const no=r.eB.magnitude(Ri)*es();no?(r.eB.sub(Kr,Ye.position,Ye.target),r.eB.normalize(ni,Kr),r.eB.normalize(gi,Ye.up),r.eB.normalize(Wi,r.eB.cross(Wi,gi,ni)),r.eB.setMagnitude(gi,gi,Wr),r.eB.setMagnitude(Wi,Wi,hr),r.eB.add(Ri,gi,Wi),r.eB.normalize(Si,r.eB.cross(Si,Ri,Kr)),r.k.setAxisAngle(Pi,Si,no),r.eB.transformQuat(Kr,Kr,Pi),r.eB.transformQuat(Ye.up,Ye.up,Pi),r.eB.copy(So,Si),ao=no):!St.staticMoving&&ao&&(ao*=Math.sqrt(1-St.dynamicDampingFactor),r.eB.sub(Kr,Ye.position,Ye.target),r.k.setAxisAngle(Pi,So,ao),r.eB.transformQuat(Kr,Kr,Pi),r.eB.transformQuat(Ye.up,Ye.up,Pi)),r.ZY.copy(Do,lo)}(),function co(){const hr=(Ht.rollRight-Ht.rollLeft)/45,Wr=(Yr[0]-Po[0])*-Math.sign(Yr[1]),no=(Yr[1]-Po[1])*-Math.sign(Yr[0]),zo=-St.rotateSpeed*(-Wr+no)+hr;zo?(r.eB.normalize(qr,Kr),r.k.setAxisAngle(Hn,qr,zo),r.eB.transformQuat(Ye.up,Ye.up,Hn),jr=zo):!St.staticMoving&&jr&&(jr*=Math.sqrt(1-St.dynamicDampingFactor),r.eB.normalize(qr,Kr),r.k.setAxisAngle(Hn,qr,jr),r.eB.transformQuat(Ye.up,Ye.up,Hn)),r.ZY.copy(Po,Yr)}(),function kr(){const Wr=(Ht.pitchUp-Ht.pitchDown)/(St.flyMode?360:90)*-St.rotateSpeed;Wr?(r.eB.cross(lr,Kr,Ye.up),r.eB.normalize(lr,lr),r.k.setAxisAngle(zr,lr,Wr),r.eB.transformQuat(Kr,Kr,zr),r.eB.transformQuat(Ye.up,Ye.up,zr),Co=Wr):!St.staticMoving&&Co&&(Co*=Math.sqrt(1-St.dynamicDampingFactor),r.eB.cross(lr,Kr,Ye.up),r.eB.normalize(lr,lr),r.k.setAxisAngle(zr,lr,Co),r.eB.transformQuat(Kr,Kr,zr),r.eB.transformQuat(Ye.up,Ye.up,zr))}(),function Ti(){const Wr=(Ht.yawRight-Ht.yawLeft)/(St.flyMode?360:90)*-St.rotateSpeed;Wr?(r.eB.normalize(vi,Ye.up),r.k.setAxisAngle(Qr,vi,Wr),r.eB.transformQuat(Kr,Kr,Qr),r.eB.transformQuat(Ye.up,Ye.up,Qr),Eo=Wr):!St.staticMoving&&Eo&&(Eo*=Math.sqrt(1-St.dynamicDampingFactor),r.eB.normalize(vi,Ye.up),r.k.setAxisAngle(Qr,vi,Eo),r.eB.transformQuat(Kr,Kr,Qr),r.eB.transformQuat(Ye.up,Ye.up,Qr))}(),function Bi(){const hr=1+(ei[1]-Fo[1])*St.zoomSpeed;1!==hr&&hr>0&&r.eB.scale(Kr,Kr,hr),St.staticMoving?r.ZY.copy(Fo,ei):Fo[1]+=(ei[1]-Fo[1])*St.dynamicDampingFactor}(),function Li(){const hr=(ci[1]-Yo[1])*St.zoomSpeed;if(0!==hr){const Wr=Math.max(1,Ye.state.radius+Ye.state.radius*hr);Ye.setState({radius:Wr})}St.staticMoving?r.ZY.copy(Yo,ci):Yo[1]+=(ci[1]-Yo[1])*St.dynamicDampingFactor}(),function ln(){if(r.ZY.sub(bi,r.ZY.copy(bi,Fi),Jo),r.ZY.squaredMagnitude(bi)){const hr=He.pixelRatio*St.panSpeed;bi[0]*=1/Ye.zoom*Ye.viewport.width*hr,bi[1]*=1/Ye.zoom*Ye.viewport.height*hr,r.eB.cross(Ei,r.eB.copy(Ei,Kr),Ye.up),r.eB.setMagnitude(Ei,Ei,bi[0]),r.eB.setMagnitude(Vi,Ye.up,bi[1]),r.eB.add(Ei,Ei,Vi),r.eB.add(Ye.position,Ye.position,Ei),r.eB.add(Ye.target,Ye.target,Ei),St.staticMoving?r.ZY.copy(Jo,Fi):(r.ZY.sub(bi,Fi,Jo),r.ZY.scale(bi,bi,St.dynamicDampingFactor),r.ZY.add(Jo,Jo,bi))}}(),r.eB.add(Ye.position,Ye.target,Kr),ur(),Jn>0&&function kn(hr){r.eB.sub(ar,Ye.position,Ye.target);const Wr=Math.max(Ye.state.minNear,St.minDistance);r.eB.setMagnitude(ar,ar,Wr);const no=.06*hr*St.moveSpeed*(1===Ht.boostMove?St.boostMoveFactor:1);if(1===Ht.moveForward&&(r.eB.normalize(Gn,ar),r.eB.scaleAndSub(Ye.position,Ye.position,Gn,no),(St.flyMode||He.pointerLock)&&r.eB.sub(Ye.target,Ye.position,ar)),1===Ht.moveBack&&(r.eB.normalize(Gn,ar),r.eB.scaleAndAdd(Ye.position,Ye.position,Gn,no),(St.flyMode||He.pointerLock)&&r.eB.sub(Ye.target,Ye.position,ar)),1===Ht.moveLeft&&(r.eB.cross(Gn,ar,Ye.up),r.eB.normalize(Gn,Gn),St.flyMode||He.pointerLock?(r.eB.scaleAndAdd(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,ar)):(r.eB.scaleAndSub(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,Kr))),1===Ht.moveRight&&(r.eB.cross(Gn,ar,Ye.up),r.eB.normalize(Gn,Gn),St.flyMode||He.pointerLock?(r.eB.scaleAndSub(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,ar)):(r.eB.scaleAndAdd(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,Kr))),1===Ht.moveUp&&(r.eB.normalize(Gn,Ye.up),St.flyMode||He.pointerLock?(r.eB.scaleAndAdd(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,ar)):(r.eB.scaleAndSub(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,Kr))),1===Ht.moveDown&&(r.eB.normalize(Gn,Ye.up),St.flyMode||He.pointerLock?(r.eB.scaleAndSub(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,ar)):(r.eB.scaleAndAdd(Ye.position,Ye.position,Gn,no),r.eB.sub(Ye.target,Ye.position,Kr))),St.flyMode||He.pointerLock){const zo=r.eB.distance(Ye.position,ot.boundingSphereVisible.center);Ye.setState({minFar:zo+ot.boundingSphereVisible.radius})}}(Math.min(Wr,250)),r.eB.sub(Kr,Ye.position,Ye.target),ur(),r.eB.squaredDistance(vo,Ye.position)>r.p8&&r.eB.copy(vo,Ye.position),Jn=hr}function nr(){r.eB.sub(ar,Ye.position,Ye.target);const hr=Math.max(Ye.state.minNear,St.minDistance);r.eB.setMagnitude(ar,ar,hr),r.eB.sub(Ye.target,Ye.position,ar);const Wr=r.eB.distance(Ye.position,ot.boundingSphereVisible.center);Ye.setState({minFar:Wr+ot.boundingSphereVisible.radius})}function pr(){const{center:hr,radius:Wr}=ot.boundingSphereVisible;if(r.eB.distance(Ye.position,hr)>Wr){const zo=Ye.getFocus(hr,Wr);Ye.setState({...zo,minFar:0})}else Ye.setState({minFar:0,radius:ot.boundingSphereVisible.radius})}const ri=r.ZY.create(.005,0);let Lo=0;const Ni=r.ZY.create(.005,0);function Gi(){Lo=0}return{viewport:mn,get isAnimating(){return"off"!==St.animate.name},get isMoving(){return 1===Ht.moveForward||1===Ht.moveBack||1===Ht.moveLeft||1===Ht.moveRight||1===Ht.moveUp||1===Ht.moveDown||1===Ht.rollLeft||1===Ht.rollRight||1===Ht.pitchUp||1===Ht.pitchDown||1===Ht.yawLeft||1===Ht.yawRight},get props(){return St},setProps:hr=>{var Wr;"rock"===(null===(Wr=hr.animate)||void 0===Wr?void 0:Wr.name)&&"rock"!==St.animate.name&&Gi(),void 0!==hr.flyMode&&hr.flyMode!==St.flyMode&&(hr.flyMode?nr():pr()),Object.assign(St,hr),Object.assign(vt,hr.bindings)},start:function _o(hr){Jn=-1,Br(hr)},update:Br,reset:function st(){r.eB.copy(Ye.target,hi),r.eB.copy(Ye.position,No),r.eB.copy(Ye.up,Ci),r.eB.sub(Kr,Ye.position,Ye.target),r.eB.copy(vo,Ye.position)},dispose:function qo(){zt||(zt=!0,an.unsubscribe(),Fn.unsubscribe(),rr.unsubscribe(),Vr.unsubscribe(),Vn.unsubscribe(),tr.unsubscribe(),Tr.unsubscribe(),oo.unsubscribe(),Gr.unsubscribe(),Ao.unsubscribe())}}};var L=n(6349),w=n(2443),Q=n(4536),G=n(3246),V=n(5276),U=n(8353),N=n(573),k=n(4439),H=n(9283),$=n(5384),J=n(2745),W=n(9132),te=n(542);const de={sceneBoundingSpheres:i.t.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:i.t.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:i.t.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:i.t.Boolean(!1,{description:"Show bounding spheres of visible instances."})};class ye{constructor(Fe,He,Ye){this.objectsData=new Map,this.instancesData=new Map,this.scene=Q.Z.create(Fe,"blended"),this.parent=He,this._props={...i.t.getDefaultValues(de),...Ye}}update(){const Fe=j(this.scene,this.parent.boundingSphere,this.sceneData,J.s.lightgrey,q);Fe&&(this.sceneData=Fe);const He=j(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,J.s.black,Y);He&&(this.visibleSceneData=He),this.parent.forEach((Ye,ot)=>{const rt=this.objectsData.get(ot),St=j(this.scene,Ye.values.boundingSphere.ref.value,rt,J.s.tomato,ee);St&&this.objectsData.set(ot,St);const vt=this.instancesData.get(ot),mn=j(this.scene,Ye.values.invariantBoundingSphere.ref.value,vt,J.s.skyblue,g,{aTransform:ot.values.aTransform,matrix:ot.values.matrix,transform:ot.values.transform,extraTransform:ot.values.extraTransform,uInstanceCount:ot.values.uInstanceCount,instanceCount:ot.values.instanceCount,aInstance:ot.values.aInstance,hasReflection:ot.values.hasReflection,instanceGrid:ot.values.instanceGrid});mn&&this.instancesData.set(ot,mn)}),this.objectsData.forEach((Ye,ot)=>{this.parent.has(ot)||(this.scene.remove(Ye.renderObject),this.objectsData.delete(ot))}),this.instancesData.forEach((Ye,ot)=>{this.parent.has(ot)||(this.scene.remove(Ye.renderObject),this.instancesData.delete(ot))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((Fe,He)=>{const Ye=this.objectsData.get(He);Ye&&(Ye.renderObject.state.visible=He.state.visible&&this._props.objectBoundingSpheres);const ot=this.instancesData.get(He);ot&&(ot.renderObject.state.visible=He.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(Fe){Object.assign(this._props,Fe),this.isEnabled&&this.update()}}function j(Tt,Fe,He,Ye,ot,rt){if(!He||!$.f8.equals(He.boundingSphere,Fe)){const St=function Z(Tt,Fe){const Ye=(0,W.J)(2),ot=N.P.createState(Ye,Ye/2,Fe);if(Tt.radius&&((0,k.X)(ot,Tt.center,Tt.radius,2),$.f8.hasExtrema(Tt)))for(const rt of Tt.extrema)(0,k.X)(ot,rt,1,0);return N.P.getMesh(ot)}(Fe,He&&He.mesh),vt=He?He.renderObject:function _e(Tt,Fe,He,Ye){const ot=H.e.Utils.createValuesSimple(Tt,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},Fe,1,Ye);return(0,U.o)("mesh",ot,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},He)}(St,Ye,ot,rt);return He?c.IQ.updateIfChanged(vt.values.drawCount,te.V.getDrawCount(St)):Tt.add(vt),{boundingSphere:$.f8.clone(Fe),renderObject:vt,mesh:St}}}const q=(0,U.Q0)(),Y=(0,U.Q0)(),ee=(0,U.Q0)(),g=(0,U.Q0)();var xe=n(9986),le=n(8956),Ae=n(9136),Be=function(Tt){return Tt[Tt.Move=0]="Move",Tt[Tt.Click=1]="Click",Tt[Tt.Drag=2]="Drag",Tt}(Be||{});const Ce=(0,r.eB)(),Re=(0,r.eB)(),ke=(0,r.eB)(),we={maxFps:i.t.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:i.t.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})};class Oe{setProps(Fe){Object.assign(this.props,Fe)}identify(Fe,He){const Ye=this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving;if(Fe===Be.Drag)return void(Ye&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:r.ZY.create(this.startX,this.startY),pageEnd:r.ZY.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY));if(Ye){const rt=this.canvasIdentify(this.endX,this.endY);this.id=rt?.id,this.position=rt?.position,this.startX=this.endX,this.startY=this.endY}if(Fe===Be.Click){const rt=this.getLoci(this.id,this.position);return this.events.click.next({current:rt,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:r.ZY.create(this.endX,this.endY),position:this.position}),void(this.prevLoci=rt)}if(!this.inside||this.currentIdentifyT!==He||!Ye||this.outsideViewport(this.endX,this.endY))return;const ot=this.getLoci(this.id,this.position);this.events.hover.next({current:ot,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:r.ZY.create(this.endX,this.endY),position:this.position}),this.prevLoci=ot}tick(Fe){this.inside&&Fe-this.prevT>1e3/this.props.maxFps&&(this.prevT=Fe,this.currentIdentifyT=Fe,this.identify(this.isInteracting?Be.Drag:Be.Move,Fe))}leave(){this.inside=!1,w.YL.Loci.isEmpty(this.prevLoci)||(this.prevLoci=w.YL.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(Fe,He,Ye,ot,rt){this.inside=!0,this.buttons=Ye,this.button=ot,this.modifiers=rt,this.endX=Fe,this.endY=He}click(Fe,He,Ye,ot,rt){this.endX=Fe,this.endY=He,this.buttons=Ye,this.button=ot,this.modifiers=rt,this.identify(Be.Click,0)}drag(Fe,He,Ye,ot,rt){this.endX=Fe,this.endY=He,this.buttons=Ye,this.button=ot,this.modifiers=rt,this.identify(Be.Drag,0)}modify(Fe){t.Fs.areEqual(Fe,this.modifiers)||(this.modifiers=Fe,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:r.ZY.create(this.endX,this.endY),position:this.position}))}outsideViewport(Fe,He){const{input:Ye,camera:{viewport:ot}}=this;return He*=Ye.pixelRatio,(Fe*=Ye.pixelRatio)>ot.x+ot.width||Ye.height-He>ot.y+ot.height||Fe<ot.x||Ye.height-He<ot.y}getLoci(Fe,He){var Ye;const{repr:ot,loci:rt}=this.lociGetter(Fe);if(He&&ot&&Ae.gn.isLoci(rt)&&2===rt.bonds.length){const{aUnit:St,aIndex:vt}=rt.bonds[0];St.conformation.position(St.elements[vt],Ce),r.eB.sub(ke,this.camera.state.position,this.camera.state.target),r.eB.projectPointOnPlane(Re,He,ke,Ce);const mn=this.camera.getPixelSize(Re);let zt=ot.theme.size.size(rt.bonds[0])*(null!==(Ye=ot.props.sizeFactor)&&void 0!==Ye?Ye:1);if(!1===ot.props.lineSizeAttenuation&&(zt*=mn/2),zt+=this.props.preferAtomPixelPadding*mn,r.eB.distance(Re,Ce)<zt)return{repr:ot,loci:Ae.gn.toFirstStructureElementLoci(rt)}}return{repr:ot,loci:rt}}dispose(){this.ev.dispose()}constructor(Fe,He,Ye,ot,rt,St={}){this.canvasIdentify=Fe,this.lociGetter=He,this.input=Ye,this.camera=ot,this.controls=rt,this.ev=le.V.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=w.YL.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=t.qt.create(0),this.button=t.qt.create(0),this.modifiers=t.Fs.None,this.props={...i.t.getDefaultValues(we),...St},Ye.drag.subscribe(({x:vt,y:mn,buttons:zt,button:an,modifiers:Vn})=>{this.isInteracting=!0,this.drag(vt,mn,zt,an,Vn)}),Ye.move.subscribe(({x:vt,y:mn,inside:zt,buttons:an,button:Vn,modifiers:Fn,onElement:rr})=>{if(zt&&!this.isInteracting){if(!rr)return void this.leave();this.move(vt,mn,an,Vn,Fn)}}),Ye.leave.subscribe(()=>{this.leave()}),Ye.click.subscribe(({x:vt,y:mn,buttons:zt,button:an,modifiers:Vn})=>{this.outsideViewport(vt,mn)||this.click(vt,mn,zt,an,Vn)}),Ye.interactionEnd.subscribe(()=>{this.isInteracting=!1}),Ye.modifiers.subscribe(vt=>{this.modify(vt)})}}var Se=n(3099),Ve=n(9007),Ne=n(4511),K=n(2897),ne=n(4143),be=n(9421),Te=n(9387);const ue={...Ve.du,tColor:(0,Ne.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,Ne.w5)("v2"),uWeight:(0,Ne.w5)("f")},re=(0,K.NG)("compose",Te.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\nuniform float uWeight;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords) * uWeight;\n}\n"),ce={mode:i.t.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:i.t.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:i.t.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'})};class se{static isEnabled(Fe){return"off"!==Fe.mode}constructor(Fe,He){this.webgl=Fe,this.drawPass=He;const{colorBufferFloat:Ye,textureFloat:ot,colorBufferHalfFloat:rt,textureHalfFloat:St}=Fe.extensions,vt=He.colorTarget.getWidth(),mn=He.colorTarget.getHeight();this.colorTarget=Fe.createRenderTarget(vt,mn,!1),this.composeTarget=Fe.createRenderTarget(vt,mn,!1,rt&&St?"fp16":Ye&&ot?"float32":"uint8"),this.holdTarget=Fe.createRenderTarget(vt,mn,!1),this.compose=function ve(Tt,Fe){const He={...Ve.OM,tColor:c.IQ.create(Fe),uTexSize:c.IQ.create(r.ZY.create(Fe.getWidth(),Fe.getHeight())),uWeight:c.IQ.create(1)},Ye={...ue},ot=(0,ne.$h)(Tt,"triangles",re,Ye,He);return(0,be._)(ot,He)}(Fe,He.colorTarget.texture)}syncSize(){const Fe=this.drawPass.colorTarget.getWidth(),He=this.drawPass.colorTarget.getHeight(),[Ye,ot]=this.compose.values.uTexSize.ref.value;(Fe!==Ye||He!==ot)&&(this.colorTarget.setSize(Fe,He),this.composeTarget.setSize(Fe,He),this.holdTarget.setSize(Fe,He),c.IQ.update(this.compose.values.uTexSize,r.ZY.set(this.compose.values.uTexSize.ref.value,Fe,He)))}render(Fe,He,Ye,ot,rt){return"temporal"!==Ye.multiSample.mode||rt?(this.renderMultiSample(He,ot,Ye),-2):this.renderTemporalMultiSample(Fe,He,Ye,ot)}bindOutputTarget(Fe){Fe?this.webgl.unbindFramebuffer():this.colorTarget.bind()}renderMultiSample(Fe,He,Ye){const{camera:ot}=Fe,{compose:rt,composeTarget:St,drawPass:vt,webgl:mn}=this,{gl:zt,state:an}=mn;_.g$&&mn.timer.mark("MultiSamplePass.renderMultiSample");const Vn=ae[Math.max(0,Math.min(Ye.multiSample.sampleLevel,5))],{x:Fn,y:rr,width:Vr,height:tr}=ot.viewport,Tr=1/Vn.length;ot.viewOffset.enabled=!0,c.IQ.update(rt.values.tColor,vt.getColorTarget(Ye.postprocessing).texture),rt.update();for(let Gr=0;Gr<Vn.length;++Gr){const Ao=Vn[Gr];V.i.setViewOffset(ot.viewOffset,Vr,tr,Ao[0],Ao[1],Vr,tr),ot.update(),c.IQ.update(rt.values.uWeight,Tr+.03125*((Gr+.5)/Vn.length-.5)),0===Gr?vt.postprocessing.setOcclusionOffset(0,0):vt.postprocessing.setOcclusionOffset(Ao[0]/Vr,Ao[1]/tr),vt.render(Fe,Ye,!1),St.bind(),an.enable(zt.BLEND),an.blendEquationSeparate(zt.FUNC_ADD,zt.FUNC_ADD),an.blendFuncSeparate(zt.ONE,zt.ONE,zt.ONE,zt.ONE),an.disable(zt.DEPTH_TEST),an.depthMask(!1),an.viewport(Fn,rr,Vr,tr),an.scissor(Fn,rr,Vr,tr),0===Gr&&(an.clearColor(0,0,0,0),zt.clear(zt.COLOR_BUFFER_BIT)),rt.render()}vt.postprocessing.setOcclusionOffset(0,0),c.IQ.update(rt.values.uWeight,1),c.IQ.update(rt.values.tColor,St.texture),rt.update(),this.bindOutputTarget(He),an.viewport(Fn,rr,Vr,tr),an.scissor(Fn,rr,Vr,tr),an.disable(zt.BLEND),rt.render(),ot.viewOffset.enabled=!1,ot.update(),_.g$&&mn.timer.markEnd("MultiSamplePass.renderMultiSample")}renderTemporalMultiSample(Fe,He,Ye,ot){const{camera:rt}=He,{compose:St,composeTarget:vt,holdTarget:mn,drawPass:zt,webgl:an}=this,{gl:Vn,state:Fn}=an;_.g$&&an.timer.mark("MultiSamplePass.renderTemporalMultiSample");const rr=ae[Math.max(0,Math.min(Ye.multiSample.sampleLevel,5))];if(-2===Fe||Fe>=rr.length)return-2;const{x:Vr,y:tr,width:Tr,height:oo}=rt.viewport,Gr=1/rr.length;if(-1===Fe)zt.render(He,Ye,!1),c.IQ.update(St.values.uWeight,1),c.IQ.update(St.values.tColor,zt.getColorTarget(Ye.postprocessing).texture),St.update(),mn.bind(),Fn.disable(Vn.BLEND),Fn.disable(Vn.DEPTH_TEST),Fn.depthMask(!1),Fn.viewport(Vr,tr,Tr,oo),Fn.scissor(Vr,tr,Tr,oo),St.render(),Fe+=1;else{rt.viewOffset.enabled=!0,c.IQ.update(St.values.tColor,zt.getColorTarget(Ye.postprocessing).texture),c.IQ.update(St.values.uWeight,Gr),St.update();const yo=Math.pow(2,Math.max(0,Ye.multiSample.sampleLevel-2));for(let vo=0;vo<yo;++vo){const Kr=rr[Fe];if(V.i.setViewOffset(rt.viewOffset,Tr,oo,Kr[0],Kr[1],Tr,oo),rt.update(),0===Fe?zt.postprocessing.setOcclusionOffset(0,0):zt.postprocessing.setOcclusionOffset(Kr[0]/Tr,Kr[1]/oo),zt.render(He,Ye,!1),vt.bind(),Fn.enable(Vn.BLEND),Fn.blendEquationSeparate(Vn.FUNC_ADD,Vn.FUNC_ADD),Fn.blendFuncSeparate(Vn.ONE,Vn.ONE,Vn.ONE,Vn.ONE),Fn.disable(Vn.DEPTH_TEST),Fn.depthMask(!1),Fn.viewport(Vr,tr,Tr,oo),Fn.scissor(Vr,tr,Tr,oo),0===Fe&&(Fn.clearColor(0,0,0,0),Vn.clear(Vn.COLOR_BUFFER_BIT)),St.render(),(Fe+=1)>=rr.length)break}}zt.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(ot),Fn.viewport(Vr,tr,Tr,oo),Fn.scissor(Vr,tr,Tr,oo);const Ao=Fe*Gr;return Ao>0&&(c.IQ.update(St.values.uWeight,1),c.IQ.update(St.values.tColor,vt.texture),St.update(),Fn.disable(Vn.BLEND),St.render()),Ao<1&&(c.IQ.update(St.values.uWeight,1-Ao),c.IQ.update(St.values.tColor,mn.texture),St.update(),0===Ao?Fn.disable(Vn.BLEND):Fn.enable(Vn.BLEND),St.render()),rt.viewOffset.enabled=!1,rt.update(),_.g$&&an.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),Fe>=rr.length?-2:Fe}}const ae=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];ae.forEach(Tt=>{Tt.forEach(Fe=>{Fe[0]*=.0625,Fe[1]*=.0625})});class ge{update(Fe,He){return Fe&&(this.sampleIndex=-1),"temporal"===He.mode&&-2!==this.sampleIndex}render(Fe,He,Ye,ot){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,Fe,He,Ye,!!ot),this.sampleIndex<0}constructor(Fe){this.multiSamplePass=Fe,this.sampleIndex=-2}}var Ie=n(8437),Le=n(4951);const nt={eyeSeparation:i.t.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:i.t.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},je=i.t.getDefaultValues(nt);class Lt{get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}constructor(Fe,He={}){this.parent=Fe,this.left=new Je,this.right=new Je,this.props={...je,...He}}setProps(Fe){Object.assign(this.props,Fe)}update(){this.parent.update(),function pn(Tt,Fe,He,Ye){A.LM.copy(He.viewport,Tt.viewport),r.$I.copy(He.view,Tt.view),r.$I.copy(He.projection,Tt.projection),V.i.copySnapshot(He.state,Tt.state),V.i.copyViewOffset(He.viewOffset,Tt.viewOffset),He.far=Tt.far,He.near=Tt.near,He.fogFar=Tt.fogFar,He.fogNear=Tt.fogNear,A.LM.copy(Ye.viewport,Tt.viewport),r.$I.copy(Ye.view,Tt.view),r.$I.copy(Ye.projection,Tt.projection),V.i.copySnapshot(Ye.state,Tt.state),V.i.copyViewOffset(Ye.viewOffset,Tt.viewOffset),Ye.far=Tt.far,Ye.near=Tt.near,Ye.fogFar=Tt.fogFar,Ye.fogNear=Tt.fogNear;const ot=Math.floor(Tt.viewport.width/2),rt=ot/Tt.viewport.height;He.viewport.width=ot,Ye.viewport.x+=ot,Ye.viewport.width-=ot;const St=Fe.eyeSeparation/2,vt=St*Tt.near/Fe.focus,mn=Tt.near*Math.tan(.5*Tt.state.fov);let zt,an;en[12]=-St,Bt[12]=St,zt=-mn*rt+vt,an=mn*rt+vt,He.projection[0]=2*Tt.near/(an-zt),He.projection[8]=(an+zt)/(an-zt),r.$I.mul(He.view,He.view,en),r.$I.mul(He.projectionView,He.projection,He.view),r.$I.invert(He.inverseProjectionView,He.projectionView),zt=-mn*rt-vt,an=mn*rt-vt,Ye.projection[0]=2*Tt.near/(an-zt),Ye.projection[8]=(an+zt)/(an-zt),r.$I.mul(Ye.view,Ye.view,Bt),r.$I.mul(Ye.projectionView,Ye.projection,Ye.view),r.$I.invert(Ye.inverseProjectionView,Ye.projectionView)}(this.parent,this.props,this.left,this.right)}}!function(Tt){Tt.is=function Fe(He){return"left"in He&&"right"in He}}(Lt||(Lt={}));class Je{constructor(){this.viewport=A.LM.create(0,0,0,0),this.view=(0,r.$I)(),this.projection=(0,r.$I)(),this.projectionView=(0,r.$I)(),this.inverseProjectionView=(0,r.$I)(),this.state=V.i.createDefaultSnapshot(),this.viewOffset=V.i.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}}const en=r.$I.identity(),Bt=r.$I.identity(),$e=Math.pow(2,24)-2;class mt{constructor(Fe,He,Ye){this.webgl=Fe,this.drawPass=He,this.pickScale=Ye;const ot=Ye/Fe.pixelRatio;this.pickWidth=Math.ceil(He.colorTarget.getWidth()*ot),this.pickHeight=Math.ceil(He.colorTarget.getHeight()*ot);const{resources:rt,extensions:{drawBuffers:St},gl:vt}=Fe;St?(this.objectPickTexture=rt.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=rt.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=rt.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=rt.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=rt.framebuffer(),this.objectPickFramebuffer=rt.framebuffer(),this.instancePickFramebuffer=rt.framebuffer(),this.groupPickFramebuffer=rt.framebuffer(),this.depthPickFramebuffer=rt.framebuffer(),this.framebuffer.bind(),St.drawBuffers([St.COLOR_ATTACHMENT0,St.COLOR_ATTACHMENT1,St.COLOR_ATTACHMENT2,St.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=(0,Ie.C6)(vt)?rt.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):rt.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=Fe.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=Fe.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=Fe.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=Fe.createRenderTarget(this.pickWidth,this.pickHeight))}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(Fe){this.pickScale=Fe,this.syncSize()}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.drawPass.colorTarget.getHeight()}syncSize(){const Fe=this.pickScale/this.webgl.pixelRatio,He=Math.ceil(this.drawPass.colorTarget.getWidth()*Fe),Ye=Math.ceil(this.drawPass.colorTarget.getHeight()*Fe);(He!==this.pickWidth||Ye!==this.pickHeight)&&(this.pickWidth=He,this.pickHeight=Ye,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}renderVariant(Fe,He,Ye,ot,rt,St){Fe.clear(!1),Fe.update(He,Ye),Fe.renderPick(Ye.primitives,He,rt,null,St),ot.handle.isEnabled&&Fe.renderPick(ot.handle.scene,He,rt,null,St),ot.camera.isEnabled&&(ot.camera.update(He),Fe.update(ot.camera.camera,ot.camera.scene),Fe.renderPick(ot.camera.scene,ot.camera.camera,rt,null,St))}render(Fe,He,Ye,ot){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(Fe,He,Ye,ot,"pick",l.None)):(this.objectPickTarget.bind(),this.renderVariant(Fe,He,Ye,ot,"pick",l.Object),this.instancePickTarget.bind(),this.renderVariant(Fe,He,Ye,ot,"pick",l.Instance),this.groupPickTarget.bind(),this.renderVariant(Fe,He,Ye,ot,"pick",l.Group),this.depthPickTarget.bind(),this.renderVariant(Fe,He,Ye,ot,"depth",l.None))}}class _t{setupBuffers(){const Fe=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==Fe)&&(this.objectBuffer=new Uint8Array(Fe),this.instanceBuffer=new Uint8Array(Fe),this.groupBuffer=new Uint8Array(Fe),this.depthBuffer=new Uint8Array(Fe))}setViewport(Fe,He,Ye,ot){A.LM.set(this.viewport,Fe,He,Ye,ot),this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(Fe*this.pickRatio),this.pickY=Math.ceil(He*this.pickRatio);const rt=Math.floor(Ye*this.pickRatio),St=Math.floor(ot*this.pickRatio);(rt!==this.pickWidth||St!==this.pickHeight)&&(this.pickWidth=rt,this.pickHeight=St,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=(0,v.k4)(Math.round(this.pickRatio*this.pickPadding))}syncBuffers(){_.g$&&this.webgl.timer.mark("PickHelper.syncBuffers");const{pickX:Fe,pickY:He,pickWidth:Ye,pickHeight:ot}=this;this.pickPass.bindObject(),this.webgl.readPixels(Fe,He,Ye,ot,this.objectBuffer),this.pickPass.bindInstance(),this.webgl.readPixels(Fe,He,Ye,ot,this.instanceBuffer),this.pickPass.bindGroup(),this.webgl.readPixels(Fe,He,Ye,ot,this.groupBuffer),this.pickPass.bindDepth(),this.webgl.readPixels(Fe,He,Ye,ot,this.depthBuffer),_.g$&&this.webgl.timer.markEnd("PickHelper.syncBuffers")}getBufferIdx(Fe,He){return 4*(He*this.pickWidth+Fe)}getDepth(Fe,He){const Ye=this.getBufferIdx(Fe,He),ot=this.depthBuffer;return(0,Le.FO)(ot[Ye],ot[Ye+1],ot[Ye+2],ot[Ye+3])}getId(Fe,He,Ye){const ot=this.getBufferIdx(Fe,He);return(0,Le.OK)(Ye[ot],Ye[ot+1],Ye[ot+2])}render(Fe){_.g$&&this.webgl.timer.mark("PickHelper.render",!0);const{pickX:He,pickY:Ye,pickWidth:ot,pickHeight:rt,halfPickWidth:St}=this,{renderer:vt,scene:mn,helper:zt}=this;vt.setTransparentBackground(!1),vt.setDrawingBufferSize(ot,rt),vt.setPixelRatio(this.pickRatio),Lt.is(Fe)?(vt.setViewport(He,Ye,St,rt),this.pickPass.render(vt,Fe.left,mn,zt),vt.setViewport(He+St,Ye,ot-St,rt),this.pickPass.render(vt,Fe.right,mn,zt)):(vt.setViewport(He,Ye,ot,rt),this.pickPass.render(vt,Fe,mn,zt)),this.dirty=!1,_.g$&&this.webgl.timer.markEnd("PickHelper.render")}identifyInternal(Fe,He,Ye){const{webgl:ot,pickRatio:rt}=this;if(ot.isContextLost)return;Fe*=ot.pixelRatio,He=this.pickPass.drawingBufferHeight-(He*=ot.pixelRatio);const{viewport:St}=this;if(Fe<St.x||He<St.y||Fe>St.x+St.width||He>St.y+St.height)return;this.dirty&&(_.g$&&this.webgl.timer.mark("PickHelper.identify"),this.render(Ye),this.syncBuffers(),_.g$&&this.webgl.timer.markEnd("PickHelper.identify"));const vt=Fe-St.x,mn=He-St.y,zt=Math.floor(vt*rt),an=Math.floor(mn*rt),Vn=this.getId(zt,an,this.objectBuffer);if(-1===Vn||Vn===$e)return;const Fn=this.getId(zt,an,this.instanceBuffer);if(-1===Fn||Fn===$e)return;const rr=this.getId(zt,an,this.groupBuffer);if(-1===rr||rr===$e)return;const Vr=this.getDepth(zt,an),tr=r.eB.create(Fe,He,Vr);if(Lt.is(Ye)){const Tr=Math.floor(St.width/2);Fe>St.x+Tr?(tr[0]=St.x+2*(vt-Tr),(0,A.IW)(tr,tr,St,Ye.right.inverseProjectionView)):(tr[0]=St.x+2*vt,(0,A.IW)(tr,tr,St,Ye.left.inverseProjectionView))}else(0,A.IW)(tr,tr,St,Ye.inverseProjectionView);return{id:{objectId:Vn,instanceId:Fn,groupId:rr},position:tr}}identify(Fe,He,Ye){for(const ot of this.spiral){const rt=this.identifyInternal(Fe+ot[0],He+ot[1],Ye);if(rt)return rt}}constructor(Fe,He,Ye,ot,rt,St,vt=1){this.webgl=Fe,this.renderer=He,this.scene=Ye,this.helper=ot,this.pickPass=rt,this.pickPadding=vt,this.dirty=!0,this.viewport=(0,A.LM)(),this.setViewport(St.x,St.y,St.width,St.height)}}var Me=n(2021);const ut={...Ve.du,tWboitA:(0,Ne.$G)("texture","rgba","float","nearest"),tWboitB:(0,Ne.$G)("texture","rgba","float","nearest"),uTexSize:(0,Ne.w5)("v2")},Kt=(0,K.NG)("evaluate-wboit",Te.e,"\nprecision highp float;\n\nuniform sampler2D tWboitA;\nuniform sampler2D tWboitB;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec4 accum = texture2D(tWboitA, coords);\n    float r = 1.0 - accum.a;\n\n    accum.a = texture2D(tWboitB, coords).r;\n    // divisor needs to allow very small values for nice fading\n    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);\n}\n");class gt{get supported(){return this._supported}bind(){const{state:Fe,gl:He}=this.webgl;this.framebuffer.bind(),Fe.clearColor(0,0,0,1),He.clear(He.COLOR_BUFFER_BIT),Fe.disable(He.DEPTH_TEST),Fe.blendFuncSeparate(He.ONE,He.ONE,He.ZERO,He.ONE_MINUS_SRC_ALPHA),Fe.enable(He.BLEND)}render(){_.g$&&this.webgl.timer.mark("WboitPass.render");const{state:Fe,gl:He}=this.webgl;Fe.blendFuncSeparate(He.SRC_ALPHA,He.ONE_MINUS_SRC_ALPHA,He.ONE,He.ONE_MINUS_SRC_ALPHA),Fe.enable(He.BLEND),this.renderable.update(),this.renderable.render(),_.g$&&this.webgl.timer.markEnd("WboitPass.render")}setSize(Fe,He){const[Ye,ot]=this.renderable.values.uTexSize.ref.value;(Fe!==Ye||He!==ot)&&(this.textureA.define(Fe,He),this.textureB.define(Fe,He),this.depthRenderbuffer.setSize(Fe,He),c.IQ.update(this.renderable.values.uTexSize,r.ZY.set(this.renderable.values.uTexSize.ref.value,Fe,He)))}reset(){this._supported&&this._init()}_init(){const{extensions:{drawBuffers:Fe}}=this.webgl;this.framebuffer.bind(),Fe.drawBuffers([Fe.COLOR_ATTACHMENT0,Fe.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(Fe){const{extensions:{drawBuffers:He,textureFloat:Ye,colorBufferFloat:ot,depthTexture:rt}}=Fe;if(Ye&&ot&&rt&&He)return!0;if(_.Bb){const St=[];Ye||St.push("textureFloat"),ot||St.push("colorBufferFloat"),rt||St.push("depthTexture"),He||St.push("drawBuffers"),console.log(`Missing "${St.join('", "')}" extensions required for "wboit"`)}return!1}constructor(Fe,He,Ye){if(this.webgl=Fe,this._supported=!1,!gt.isSupported(Fe))return;const{resources:ot,gl:rt}=Fe;this.textureA=ot.texture("image-float32","rgba","float","nearest"),this.textureA.define(He,Ye),this.textureB=ot.texture("image-float32","rgba","float","nearest"),this.textureB.define(He,Ye),this.depthRenderbuffer=(0,Ie.C6)(rt)?ot.renderbuffer("depth32f","depth",He,Ye):ot.renderbuffer("depth16","depth",He,Ye),this.renderable=function sn(Tt,Fe,He){const Ye={...Ve.OM,tWboitA:c.IQ.create(Fe),tWboitB:c.IQ.create(He),uTexSize:c.IQ.create(r.ZY.create(Fe.getWidth(),Fe.getHeight()))},ot={...ut},rt=(0,ne.$h)(Tt,"triangles",Kt,ot,Ye);return(0,be._)(rt,Ye)}(Fe,this.textureA,this.textureB),this.framebuffer=ot.framebuffer(),this._supported=!0,this._init()}}const Gt={...Ve.du,tDpoitBackColor:(0,Ne.$G)("texture","rgba","float","nearest"),uTexSize:(0,Ne.w5)("v2")},rn=(0,K.NG)("blend-back-dpoit",Te.e,"\n    precision highp float;\n\n    uniform sampler2D tDpoitBackColor;\n    uniform vec2 uTexSize;\n\n    void main() {\n        vec2 coords = gl_FragCoord.xy / uTexSize;\n        gl_FragColor = texture2D(tDpoitBackColor, coords);\n        if (gl_FragColor.a == 0.0) {\n            discard;\n        }\n    }\n"),Mt={...Ve.du,tDpoitFrontColor:(0,Ne.$G)("texture","rgba","float","nearest"),uTexSize:(0,Ne.w5)("v2")},nn=(0,K.NG)("evaluate-dpoit",Te.e,"\nprecision highp float;\n\nuniform sampler2D tDpoitFrontColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tDpoitFrontColor, coords);\n}\n");class Dn{get supported(){return this._supported}bind(){const{state:Fe,gl:He,extensions:{blendMinMax:Ye}}=this.webgl;return this.passCount=0,this.depthFramebuffers[0].bind(),Fe.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),He.clear(He.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),Fe.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),He.clear(He.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),Fe.clearColor(0,0,0,0),He.clear(He.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),Fe.clearColor(0,0,0,0),He.clear(He.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),Fe.blendEquation(Ye.MAX),Fe.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){const{state:Fe,gl:He,extensions:{blendMinMax:Ye}}=this.webgl;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),Fe.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),He.clear(He.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),Fe.clearColor(0,0,0,0),He.clear(He.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),Fe.blendEquation(Ye.MAX),Fe.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){_.g$&&this.webgl.timer.mark("DpoitPass.renderBlendBack");const{state:Fe,gl:He}=this.webgl;Fe.blendEquation(He.FUNC_ADD),Fe.blendFuncSeparate(He.SRC_ALPHA,He.ONE_MINUS_SRC_ALPHA,He.ONE,He.ONE_MINUS_SRC_ALPHA),c.IQ.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),_.g$&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")}render(){_.g$&&this.webgl.timer.mark("DpoitPass.render");const{state:Fe,gl:He}=this.webgl;Fe.blendFunc(He.ONE,He.ONE_MINUS_SRC_ALPHA),c.IQ.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),_.g$&&this.webgl.timer.markEnd("DpoitPass.render")}setSize(Fe,He){const[Ye,ot]=this.renderable.values.uTexSize.ref.value;if(Fe!==Ye||He!==ot){for(let rt=0;rt<2;rt++)this.depthTextures[rt].define(Fe,He),this.colorFrontTextures[rt].define(Fe,He),this.colorBackTextures[rt].define(Fe,He);c.IQ.update(this.renderable.values.uTexSize,r.ZY.set(this.renderable.values.uTexSize.ref.value,Fe,He)),c.IQ.update(this.blendBackRenderable.values.uTexSize,r.ZY.set(this.blendBackRenderable.values.uTexSize.ref.value,Fe,He))}}reset(){this._supported&&this._init()}_init(){const{extensions:{drawBuffers:Fe}}=this.webgl;for(let He=0;He<2;He++)this.depthFramebuffers[He].bind(),Fe.drawBuffers([Fe.COLOR_ATTACHMENT0,Fe.COLOR_ATTACHMENT1,Fe.COLOR_ATTACHMENT2]),this.colorFrontTextures[He].attachFramebuffer(this.depthFramebuffers[He],"color0"),this.colorBackTextures[He].attachFramebuffer(this.depthFramebuffers[He],"color1"),this.depthTextures[He].attachFramebuffer(this.depthFramebuffers[He],"color2"),this.colorFramebuffers[He].bind(),Fe.drawBuffers([Fe.COLOR_ATTACHMENT0,Fe.COLOR_ATTACHMENT1]),this.colorFrontTextures[He].attachFramebuffer(this.colorFramebuffers[He],"color0"),this.colorBackTextures[He].attachFramebuffer(this.colorFramebuffers[He],"color1")}static isSupported(Fe){const{extensions:{drawBuffers:He,textureFloat:Ye,colorBufferFloat:ot,depthTexture:rt,blendMinMax:St}}=Fe;if(Ye&&ot&&rt&&He&&St)return!0;if(_.Bb){const vt=[];Ye||vt.push("textureFloat"),ot||vt.push("colorBufferFloat"),rt||vt.push("depthTexture"),He||vt.push("drawBuffers"),St||vt.push("blendMinMax"),console.log(`Missing "${vt.join('", "')}" extensions required for "dpoit"`)}return!1}constructor(Fe,He,Ye){if(this.webgl=Fe,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,!Dn.isSupported(Fe))return;const{resources:ot,extensions:{colorBufferHalfFloat:rt,textureHalfFloat:St}}=Fe;(0,Ie.C6)(Fe.gl)?(this.depthTextures=[ot.texture("image-float32","rg","float","nearest"),ot.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=rt&&St?[ot.texture("image-float16","rgba","fp16","nearest"),ot.texture("image-float16","rgba","fp16","nearest")]:[ot.texture("image-float32","rgba","float","nearest"),ot.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=rt&&St?[ot.texture("image-float16","rgba","fp16","nearest"),ot.texture("image-float16","rgba","fp16","nearest")]:[ot.texture("image-float32","rgba","float","nearest"),ot.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[ot.texture("image-float32","rgba","float","nearest"),ot.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[ot.texture("image-float32","rgba","float","nearest"),ot.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[ot.texture("image-float32","rgba","float","nearest"),ot.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(He,Ye),this.depthTextures[1].define(He,Ye),this.colorFrontTextures[0].define(He,Ye),this.colorFrontTextures[1].define(He,Ye),this.colorBackTextures[0].define(He,Ye),this.colorBackTextures[1].define(He,Ye),this.depthFramebuffers=[ot.framebuffer(),ot.framebuffer()],this.colorFramebuffers=[ot.framebuffer(),ot.framebuffer()],this.blendBackRenderable=function tt(Tt,Fe){const He={...Ve.OM,tDpoitBackColor:c.IQ.create(Fe),uTexSize:c.IQ.create(r.ZY.create(Fe.getWidth(),Fe.getHeight()))},Ye={...Gt},ot=(0,ne.$h)(Tt,"triangles",rn,Ye,He);return(0,be._)(ot,He)}(Fe,this.colorBackTextures[0]),this.renderable=function bn(Tt,Fe){const He={...Ve.OM,tDpoitFrontColor:c.IQ.create(Fe),uTexSize:c.IQ.create(r.ZY.create(Fe.getWidth(),Fe.getHeight()))},Ye={...Mt},ot=(0,ne.$h)(Tt,"triangles",nn,Ye,He);return(0,be._)(ot,He)}(Fe,this.colorFrontTextures[0]),this._supported=!0,this._init()}}const Dt={enabled:i.t.Boolean(!0),highlightEdgeColor:i.t.Color(y.Q1.darken(y.Q1.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:i.t.Color(y.Q1.darken(y.Q1.fromNormalizedRgb(.2,1,.1),1)),edgeScale:i.t.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:i.t.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:i.t.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:i.t.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:i.t.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})};class Ct{static isEnabled(Fe){return Fe.enabled}constructor(Fe,He,Ye){this.webgl=Fe,this.depthTarget=Fe.createRenderTarget(He,Ye),this.maskTarget=Fe.createRenderTarget(He,Ye),this.edgesTarget=Fe.createRenderTarget(He,Ye),this.edge=function Wt(Tt,Fe){const He=Fe.getWidth(),Ye=Fe.getHeight(),ot={...Ve.OM,tMaskTexture:c.IQ.create(Fe),uTexSizeInv:c.IQ.create(r.ZY.create(1/He,1/Ye)),dEdgeScale:c.IQ.create(1)},rt={...$t},St=(0,ne.$h)(Tt,"triangles",Vt,rt,ot);return(0,be._)(St,ot)}(Fe,this.maskTarget.texture),this.overlay=function kt(Tt,Fe){const He=Fe.getWidth(),Ye=Fe.getHeight(),ot={...Ve.OM,tEdgeTexture:c.IQ.create(Fe),uTexSizeInv:c.IQ.create(r.ZY.create(1/He,1/Ye)),uHighlightEdgeColor:c.IQ.create((0,r.eB)()),uSelectEdgeColor:c.IQ.create((0,r.eB)()),uHighlightEdgeStrength:c.IQ.create(1),uSelectEdgeStrength:c.IQ.create(1),uGhostEdgeStrength:c.IQ.create(0),uInnerEdgeFactor:c.IQ.create(0)},rt={...yn},St=(0,ne.$h)(Tt,"triangles",Zt,rt,ot);return(0,be._)(St,ot)}(Fe,this.edgesTarget.texture)}setEdgeState(Fe){const{gl:He,state:Ye}=this.webgl;Ye.enable(He.SCISSOR_TEST),Ye.enable(He.BLEND),Ye.blendFunc(He.ONE,He.ONE),Ye.blendEquation(He.FUNC_ADD),Ye.disable(He.DEPTH_TEST),Ye.depthMask(!1);const{x:ot,y:rt,width:St,height:vt}=Fe;Ye.viewport(ot,rt,St,vt),Ye.scissor(ot,rt,St,vt),Ye.clearColor(0,0,0,0),He.clear(He.COLOR_BUFFER_BIT)}setOverlayState(Fe){const{gl:He,state:Ye}=this.webgl;Ye.enable(He.SCISSOR_TEST),Ye.enable(He.BLEND),Ye.blendFunc(He.SRC_ALPHA,He.ONE_MINUS_SRC_ALPHA),Ye.blendEquation(He.FUNC_ADD),Ye.disable(He.DEPTH_TEST),Ye.depthMask(!1);const{x:ot,y:rt,width:St,height:vt}=Fe;Ye.viewport(ot,rt,St,vt),Ye.scissor(ot,rt,St,vt)}setSize(Fe,He){const Ye=this.depthTarget.getWidth(),ot=this.depthTarget.getHeight();(Fe!==Ye||He!==ot)&&(this.depthTarget.setSize(Fe,He),this.maskTarget.setSize(Fe,He),this.edgesTarget.setSize(Fe,He),c.IQ.update(this.edge.values.uTexSizeInv,r.ZY.set(this.edge.values.uTexSizeInv.ref.value,1/Fe,1/He)),c.IQ.update(this.overlay.values.uTexSizeInv,r.ZY.set(this.overlay.values.uTexSizeInv.ref.value,1/Fe,1/He)))}update(Fe){const{highlightEdgeColor:He,selectEdgeColor:Ye,edgeScale:ot,innerEdgeFactor:rt,ghostEdgeStrength:St,highlightEdgeStrength:vt,selectEdgeStrength:mn}=Fe,{values:zt}=this.edge,an=Math.max(1,Math.round(ot*this.webgl.pixelRatio));zt.dEdgeScale.ref.value!==an&&(c.IQ.update(zt.dEdgeScale,an),this.edge.update());const{values:Vn}=this.overlay;c.IQ.update(Vn.uHighlightEdgeColor,y.Q1.toVec3Normalized(Vn.uHighlightEdgeColor.ref.value,He)),c.IQ.update(Vn.uSelectEdgeColor,y.Q1.toVec3Normalized(Vn.uSelectEdgeColor.ref.value,Ye)),c.IQ.updateIfChanged(Vn.uInnerEdgeFactor,rt),c.IQ.updateIfChanged(Vn.uGhostEdgeStrength,St),c.IQ.updateIfChanged(Vn.uHighlightEdgeStrength,vt),c.IQ.updateIfChanged(Vn.uSelectEdgeStrength,mn)}render(Fe,He){_.g$&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(Fe),this.edge.render(),He?He.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(Fe),this.overlay.render(),_.g$&&this.webgl.timer.markEnd("MarkingPass.render")}}const $t={...Ve.du,tMaskTexture:(0,Ne.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,Ne.w5)("v2"),dEdgeScale:(0,Ne.$F)("number")},Vt=(0,K.NG)("edge",Te.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tMaskTexture;\nuniform vec2 uTexSizeInv;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);\n    vec4 c0 = texture2D(tMaskTexture, coords);\n    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);\n    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);\n    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);\n    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);\n    float diff1 = (c1.r - c2.r) * 0.5;\n    float diff2 = (c3.r - c4.r) * 0.5;\n    float d = length(vec2(diff1, diff2));\n    if (d <= 0.0)\n        discard;\n    float a1 = min(c1.g, c2.g);\n    float a2 = min(c3.g, c4.g);\n    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;\n    float mask = c0.r;\n    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));\n    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));\n    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);\n}\n"),yn={...Ve.du,tEdgeTexture:(0,Ne.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,Ne.w5)("v2"),uHighlightEdgeColor:(0,Ne.w5)("v3"),uSelectEdgeColor:(0,Ne.w5)("v3"),uHighlightEdgeStrength:(0,Ne.w5)("f"),uSelectEdgeStrength:(0,Ne.w5)("f"),uGhostEdgeStrength:(0,Ne.w5)("f"),uInnerEdgeFactor:(0,Ne.w5)("f")},Zt=(0,K.NG)("overlay",Te.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\nuniform sampler2D tEdgeTexture;\nuniform vec3 uHighlightEdgeColor;\nuniform vec3 uSelectEdgeColor;\nuniform float uHighlightEdgeStrength;\nuniform float uSelectEdgeStrength;\nuniform float uGhostEdgeStrength;\nuniform float uInnerEdgeFactor;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 edgeValue = texture2D(tEdgeTexture, coords);\n    if (edgeValue.a > 0.0) {\n        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;\n        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;\n        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;\n        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;\n        gl_FragColor.a *= edgeStrength;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}\n");var Ot=n(6049),An=n(3770);class jn{setTransparency(Fe){"wboit"===Fe?(this.transparencyMode=this.wboit.supported?"wboit":"blended",_.Bb&&!this.wboit.supported&&console.log('Missing "wboit" support, falling back to "blended".')):"dpoit"===Fe?(this.transparencyMode=this.dpoit.supported?"dpoit":"blended",_.Bb&&!this.dpoit.supported&&console.log('Missing "dpoit" support, falling back to "blended".')):this.transparencyMode="blended",this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth")}get transparency(){return this.transparencyMode}constructor(Fe,He,Ye,ot,rt){this.webgl=Fe,this.transparencyMode="blended";const{extensions:St,resources:vt,isWebGL2:mn}=Fe;this.drawTarget=(0,Me.T)(Fe.gl),this.colorTarget=Fe.createRenderTarget(Ye,ot,!0,"uint8","linear"),this.packedDepth=!St.depthTexture,this.depthTargetTransparent=Fe.createRenderTarget(Ye,ot),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?Fe.createRenderTarget(Ye,ot):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:vt.texture("image-depth","depth",mn?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(Ye,ot),this.wboit=new gt(Fe,Ye,ot),this.dpoit=new Dn(Fe,Ye,ot),this.marking=new Ct(Fe,Ye,ot),this.postprocessing=new Se.Pv(Fe,He,this),this.antialiasing=new Se.SK(Fe,Ye,ot),this.bloom=new An.P(Fe,Ye,ot),this.dof=new Ot.z(Fe,Ye,ot),this.copyFboTarget=(0,Ve._0)(Fe,this.colorTarget.texture),this.copyFboPostprocessing=(0,Ve._0)(Fe,this.postprocessing.target.texture),this.setTransparency(rt)}reset(){this.wboit.reset(),this.dpoit.reset()}setSize(Fe,He){const Ye=this.colorTarget.getWidth(),ot=this.colorTarget.getHeight();(Fe!==Ye||He!==ot)&&(this.colorTarget.setSize(Fe,He),this.depthTargetTransparent.setSize(Fe,He),this.depthTargetOpaque?this.depthTargetOpaque.setSize(Fe,He):this.depthTextureOpaque.define(Fe,He),c.IQ.update(this.copyFboTarget.values.uTexSize,r.ZY.set(this.copyFboTarget.values.uTexSize.ref.value,Fe,He)),c.IQ.update(this.copyFboPostprocessing.values.uTexSize,r.ZY.set(this.copyFboPostprocessing.values.uTexSize.ref.value,Fe,He))),this.wboit.supported&&this.wboit.setSize(Fe,He),this.dpoit.supported&&this.dpoit.setSize(Fe,He),this.marking.setSize(Fe,He),this.postprocessing.setSize(Fe,He),this.antialiasing.setSize(Fe,He),this.dof.setSize(Fe,He),this.bloom.setSize(Fe,He)}_renderDpoit(Fe,He,Ye,ot,rt,St){if(!this.dpoit.supported)throw new Error("expected dpoit to be supported");if(this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),Fe.clear(!0),Ye.hasOpaque&&Fe.renderDpoitOpaque(Ye.primitives,He,null),Se.Pv.isEnabled(St)&&((Se.Pv.isTransparentOutlineEnabled(St)||Ot.z.isEnabled(St))&&(this.depthTargetTransparent.bind(),Fe.clearDepth(!0),Ye.opacityAverage<1&&Fe.renderDepthTransparent(Ye.primitives,He,this.depthTextureOpaque)),this.postprocessing.render(He,!1,rt,Fe.props.backgroundColor,St,Fe.light)),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),Ye.opacityAverage<1){const vt=Se.Pv.isEnabled(St)?this.postprocessing.target:this.colorTarget,mn=this.dpoit.bind();Fe.renderDpoitTransparent(Ye.primitives,He,this.depthTextureOpaque,mn);for(let zt=0;zt<ot;zt++){_.g$&&this.webgl.timer.mark("DpoitPass.layer");const an=this.dpoit.bindDualDepthPeeling();Fe.renderDpoitTransparent(Ye.primitives,He,this.depthTextureOpaque,an),vt.bind(),this.dpoit.renderBlendBack(),_.g$&&this.webgl.timer.markEnd("DpoitPass.layer")}vt.bind(),this.dpoit.render()}Ye.volumes.renderables.length>0&&Fe.renderDpoitVolume(Ye.volumes,He,this.depthTextureOpaque)}_renderWboit(Fe,He,Ye,ot,rt){if(!this.wboit.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),Fe.clear(!0),Ye.hasOpaque&&Fe.renderWboitOpaque(Ye.primitives,He,null),Se.Pv.isEnabled(rt)&&((Se.Pv.isTransparentOutlineEnabled(rt)||Ot.z.isEnabled(rt))&&(this.depthTargetTransparent.bind(),Fe.clearDepth(!0),Ye.opacityAverage<1&&Fe.renderDepthTransparent(Ye.primitives,He,this.depthTextureOpaque)),this.postprocessing.render(He,!1,ot,Fe.props.backgroundColor,rt,Fe.light)),(Ye.opacityAverage<1||Ye.volumes.renderables.length>0)&&(this.wboit.bind(),Ye.opacityAverage<1&&Fe.renderWboitTransparent(Ye.primitives,He,this.depthTextureOpaque),Ye.volumes.renderables.length>0&&Fe.renderWboitTransparent(Ye.volumes,He,this.depthTextureOpaque),Se.Pv.isEnabled(rt)?this.postprocessing.target.bind():this.colorTarget.bind(),this.wboit.render())}_renderBlended(Fe,He,Ye,ot,rt,St){var vt,mn,zt,an;if(ot?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),Fe.clear(!0),Ye.hasOpaque&&Fe.renderBlendedOpaque(Ye.primitives,He,null),!ot&&(this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),Fe.clearDepth(!0),Fe.renderDepthOpaque(Ye.primitives,He,null),this.colorTarget.bind()),Se.Pv.isEnabled(St)&&(this.packedDepth?null===(vt=this.colorTarget.depthRenderbuffer)||void 0===vt||vt.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),(Se.Pv.isTransparentOutlineEnabled(St)||Ot.z.isEnabled(St))&&(this.depthTargetTransparent.bind(),Fe.clearDepth(!0),Ye.opacityAverage<1&&Fe.renderDepthTransparent(Ye.primitives,He,this.depthTextureOpaque)),this.postprocessing.render(He,!1,rt,Fe.props.backgroundColor,St,Fe.light),this.packedDepth?null===(mn=this.colorTarget.depthRenderbuffer)||void 0===mn||mn.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),Ye.volumes.renderables.length>0)){const Vn=Se.Pv.isEnabled(St)?this.postprocessing.target:this.colorTarget;this.packedDepth?null===(zt=this.colorTarget.depthRenderbuffer)||void 0===zt||zt.detachFramebuffer(Vn.framebuffer):this.depthTextureOpaque.detachFramebuffer(Vn.framebuffer,"depth"),Vn.bind(),Fe.renderBlendedVolume(Ye.volumes,He,this.depthTextureOpaque),this.packedDepth?null===(an=this.colorTarget.depthRenderbuffer)||void 0===an||an.attachFramebuffer(Vn.framebuffer):this.depthTextureOpaque.attachFramebuffer(Vn.framebuffer,"depth"),Vn.bind()}Ye.opacityAverage<1&&Fe.renderBlendedTransparent(Ye.primitives,He,null)}_render(Fe,He,Ye,ot,rt,St,vt){var mn,zt;const an=Ye.volumes.renderables.length>0,Vn=Se.Pv.isEnabled(vt.postprocessing),Fn=Se.SK.isEnabled(vt.postprocessing),rr=Ct.isEnabled(vt.marking),Vr=Ot.z.isEnabled(vt.postprocessing),{x:tr,y:Tr,width:oo,height:Gr}=He.viewport;Fe.setViewport(tr,Tr,oo,Gr),Fe.update(He,Ye),St&&!Fn&&rt&&(this.drawTarget.bind(),Fe.clear(!1));let Ao=!1;"wboit"===this.transparencyMode&&this.wboit.supported?(this._renderWboit(Fe,He,Ye,St,vt.postprocessing),Ao=!0):"dpoit"===this.transparencyMode&&this.dpoit.supported?(this._renderDpoit(Fe,He,Ye,vt.dpoitIterations,St,vt.postprocessing),Ao=!0):this._renderBlended(Fe,He,Ye,!an&&!Vn&&!Fn&&rt,St,vt.postprocessing);const yo=Vn?this.postprocessing.target:!rt||an||Ao?this.colorTarget:this.drawTarget;if(rr&&Ye.markerAverage>0){const Kr=vt.marking.ghostEdgeStrength<1;Kr&&1!==Ye.markerAverage&&(this.marking.depthTarget.bind(),Fe.clear(!1,!0),Fe.renderMarkingDepth(Ye.primitives,He,null)),this.marking.maskTarget.bind(),Fe.clear(!1,!0),Fe.renderMarkingMask(Ye.primitives,He,Kr?this.marking.depthTarget.texture:null),this.marking.update(vt.marking),this.marking.render(He.viewport,yo)}else yo.bind();ot.debug.isEnabled&&(ot.debug.syncVisibility(),Fe.renderBlended(ot.debug.scene,He)),ot.handle.isEnabled&&Fe.renderBlended(ot.handle.scene,He),ot.camera.isEnabled&&(ot.camera.update(He),Fe.update(ot.camera.camera,ot.camera.scene),Fe.renderBlended(ot.camera.scene,ot.camera.camera));let vo=!1;if(Fn){const Kr=Se.Pv.isEnabled(vt.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.antialiasing.render(He,Kr,rt&&!Vr,vt.postprocessing)}else rt&&!Ot.z.isEnabled(vt.postprocessing)&&(vo=!0);if("on"===vt.postprocessing.dof.name){const Kr=Se.SK.isEnabled(vt.postprocessing)?this.antialiasing.target.texture:Se.Pv.isEnabled(vt.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.dof.update(He,Kr,(null===(mn=this.depthTargetOpaque)||void 0===mn?void 0:mn.texture)||this.depthTextureOpaque,this.depthTextureTransparent,vt.postprocessing.dof.params,Ye.boundingSphereVisible),this.dof.render(He.viewport,rt?void 0:this.getColorTarget(vt.postprocessing))}else rt&&!Se.SK.isEnabled(vt.postprocessing)&&(vo=!0);if(vo&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),Vn?this.copyFboPostprocessing.render():(an||Ao)&&this.copyFboTarget.render()),"on"===vt.postprocessing.bloom.name){const Kr="emissive"===vt.postprocessing.bloom.params.mode;Kr&&Ye.emissiveAverage>0&&(this.bloom.emissiveTarget.bind(),Fe.clear(!1,!0),Fe.update(He,Ye),Fe.renderEmissive(Ye.primitives,He,null)),(!Kr||Ye.emissiveAverage>0)&&(this.bloom.update(this.colorTarget.texture,this.bloom.emissiveTarget.texture,(null===(zt=this.depthTargetOpaque)||void 0===zt?void 0:zt.texture)||this.depthTextureOpaque,vt.postprocessing.bloom.params),this.bloom.render(He.viewport,rt?void 0:this.getColorTarget(vt.postprocessing)))}this.webgl.gl.flush()}render(Fe,He,Ye){_.g$&&this.webgl.timer.mark("DrawPass.render");const{renderer:ot,camera:rt,scene:St,helper:vt}=Fe;this.postprocessing.setTransparentBackground(He.transparentBackground);const mn=He.transparentBackground||this.postprocessing.background.isEnabled(He.postprocessing.background);ot.setTransparentBackground(mn),ot.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),ot.setPixelRatio(this.webgl.pixelRatio),Lt.is(rt)?(_.g$&&this.webgl.timer.mark("StereoCamera.left"),this._render(ot,rt.left,St,vt,Ye,mn,He),_.g$&&this.webgl.timer.markEnd("StereoCamera.left"),_.g$&&this.webgl.timer.mark("StereoCamera.right"),this._render(ot,rt.right,St,vt,Ye,mn,He),_.g$&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(ot,rt,St,vt,Ye,mn,He),_.g$&&this.webgl.timer.markEnd("DrawPass.render")}getColorTarget(Fe){return Ot.z.isEnabled(Fe)?this.dof.target:Se.SK.isEnabled(Fe)?this.antialiasing.target:Se.Pv.isEnabled(Fe)?this.postprocessing.target:this.colorTarget}}var On=n(2775),fr=n(7028);const Dr={transparentBackground:i.t.Boolean(!1),dpoitIterations:i.t.Numeric(2,{min:1,max:10,step:1}),multiSample:i.t.Group(ce),postprocessing:i.t.Group(Se.co),marking:i.t.Group(Dt),cameraHelper:i.t.Group(fr.kf)};class Pr{get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}constructor(Fe,He,Ye,ot,rt,St,vt,mn){this.webgl=Fe,this.renderer=Ye,this.scene=ot,this.camera=rt,this._width=0,this._height=0,this._camera=new V.i,this.props={...i.t.getDefaultValues(Dr),...mn},this.drawPass=new jn(Fe,He,128,128,vt),this.multiSamplePass=new se(Fe,this.drawPass),this.multiSampleHelper=new ge(this.multiSamplePass),this.helper={camera:new fr.WT(Fe,this.props.cameraHelper),debug:St.debug,handle:St.handle},this.setSize(1024,768)}updateBackground(){return new Promise(Fe=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{Fe()})})}setSize(Fe,He){Fe===this._width&&He===this._height||(this._width=Fe,this._height=He,this.drawPass.setSize(Fe,He),this.multiSamplePass.syncSize())}setProps(Fe={}){Object.assign(this.props,Fe),Fe.cameraHelper&&this.helper.camera.setProps(Fe.cameraHelper)}render(){V.i.copySnapshot(this._camera.state,this.camera.state),A.LM.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();const Fe={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};se.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(Fe,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(Fe,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))}getImageData(Fe,He,Ye){var ot,rt;this.setSize(Fe,He),this.render(),this.colorTarget.bind();const St=null!==(ot=Ye?.width)&&void 0!==ot?ot:Fe,vt=null!==(rt=Ye?.height)&&void 0!==rt?rt:He,mn=new Uint8Array(St*vt*4);Ye?this.webgl.readPixels(Ye.x,He-Ye.y-Ye.height,St,vt,mn):this.webgl.readPixels(0,0,St,vt,mn);const zt=On.N.create(mn,St,vt);return On.N.flipY(zt),On.N.divideByAlpha(zt),new ImageData(new Uint8ClampedArray(mn),St,vt)}}var or=n(1025),Nr=n(2802),Ir=n(3558),Or=n(6825),Jr=n(5117),To=n(3543);const un={...H.e.Params,alpha:{...H.e.Params.alpha,defaultValue:1},ignoreLight:{...H.e.Params.ignoreLight,defaultValue:!0},colorX:i.t.Color(J.s.red,{isEssential:!0}),colorY:i.t.Color(J.s.green,{isEssential:!0}),colorZ:i.t.Color(J.s.blue,{isEssential:!0}),scale:i.t.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})},ct={handle:i.t.MappedStatic("off",{on:i.t.Group(un),off:i.t.Group({})},{cycle:!0,description:"Show handle tool"})};class dt{getBoundingSphere(Fe,He){return this.renderObject&&($.f8.copy(Fe,this.renderObject.values.invariantBoundingSphere.ref.value),r.$I.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,16*He),$.f8.transform(Fe,Fe,this._transform)),Fe}setProps(Fe){this.props=(0,or.jM)(this.props,He=>{if(void 0!==Fe.handle&&(He.handle.name=Fe.handle.name,"on"===Fe.handle.name)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;const Ye={...Fe.handle.params,scale:Fe.handle.params.scale*this.webgl.pixelRatio,cellSize:0};this.renderObject=function ir(Tt){const Fe=function er(Tt,Fe){const He=10*Tt.scale,Ye=function Yt(Tt,Fe){const He=N.P.createState(512,256,Fe),Ye=.05*Tt,ot=r.eB.scale((0,r.eB)(),r.eB.unitX,Tt),rt=r.eB.scale((0,r.eB)(),r.eB.unitY,Tt),St=r.eB.scale((0,r.eB)(),r.eB.unitZ,Tt),vt={radiusTop:Ye,radiusBottom:Ye,radialSegments:32};return He.currentGroup=cn.TranslateScreenXY,(0,k.X)(He,r.eB.origin,3*Ye,2),He.currentGroup=cn.TranslateObjectX,(0,k.X)(He,ot,Ye,2),(0,Nr.y9)(He,r.eB.origin,ot,1,vt),He.currentGroup=cn.TranslateObjectY,(0,k.X)(He,rt,Ye,2),(0,Nr.y9)(He,r.eB.origin,rt,1,vt),He.currentGroup=cn.TranslateObjectZ,(0,k.X)(He,St,Ye,2),(0,Nr.y9)(He,r.eB.origin,St,1,vt),N.P.getMesh(He)}(He,Fe?.geometry);Ye.setBoundingSphere($.f8.create(r.eB.create(He/2,He/2,He/2),He+He/4));return Ir.y.create("handle",{},Ye,rt=>{switch(rt){case cn.TranslateObjectX:return Tt.colorX;case cn.TranslateObjectY:return Tt.colorY;case cn.TranslateObjectZ:return Tt.colorZ;default:return J.s.grey}},()=>1,()=>"")}(Tt);return Ir.y.createRenderObject(Fe,Tt)}(Ye),this.scene.add(this.renderObject),this.scene.commit(),He.handle.params={...Fe.handle.params}}})}get isEnabled(){return"on"===this.props.handle.name}update(Fe,He,Ye){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),r.$I.setTranslation(this.renderObject.values.aTransform.ref.value,He),r.$I.fromMat3(this.renderObject.values.aTransform.ref.value,Ye),c.IQ.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(Fe){const{objectId:He,groupId:Ye,instanceId:ot}=Fe;return this.renderObject&&He===this.renderObject.id?function xn(Tt,Fe,He){return(0,G.g9)("handle",Tt,[{groupId:Fe,instanceId:He}],Ye=>Tt.getBoundingSphere(Ye,He),()=>`Handle Helper | Group Id ${Fe} | Instance Id ${He}`)}(this,Ye,ot):G.BL}mark(Fe,He){return!(!Or.sY.is(Or.sY.Highlighting,He)||!((0,G.xc)(Fe)||Rn(Fe)&&Fe.data===this))&&Jr.b.mark(this.renderObject,Fe,He,this.eachGroup)}constructor(Fe,He={}){this.webgl=Fe,this.props={handle:{name:"off",params:{}}},this.pixelRatio=1,this._transform=(0,r.$I)(),this.eachGroup=(Ye,ot)=>{if(!this.renderObject||!Rn(Ye))return!1;let rt=!1;const St=this.renderObject.values.uGroupCount.ref.value,{elements:vt}=Ye;for(const{groupId:mn,instanceId:zt}of vt)ot(To.IX.ofSingleton(zt*St+mn))&&(rt=!0);return rt},this.scene=Q.Z.create(Fe,"blended"),this.setProps(He)}}const cn={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function Rn(Tt){return"data-loci"===Tt.kind&&"handle"===Tt.tag}const Yn={debug:i.t.Group(de),camera:i.t.Group({helper:i.t.Group(fr.kf)}),handle:i.t.Group(ct)},br=i.t.getDefaultValues(Yn);class vr{constructor(Fe,He,Ye={}){const ot={...br,...Ye};this.debug=new ye(Fe,He,ot.debug),this.camera=new fr.WT(Fe,ot.camera.helper),this.handle=new dt(Fe,ot.handle)}}class Hr{constructor(Fe,He,Ye={}){this.webgl=Fe;const{gl:ot}=Fe;this.draw=new jn(Fe,He,ot.drawingBufferWidth,ot.drawingBufferHeight,Ye.transparency||"blended"),this.pick=new mt(Fe,this.draw,Ye.pickScale||.25),this.multiSample=new se(Fe,this.draw)}setPickScale(Fe){this.pick.setPickScale(Fe)}setTransparency(Fe){this.draw.setTransparency(Fe)}updateSize(){const{gl:Fe}=this.webgl,He=Math.max(Fe.drawingBufferWidth,2),Ye=Math.max(Fe.drawingBufferHeight,2);this.draw.setSize(He,Ye),this.pick.syncSize(),this.multiSample.syncSize()}}var Mr=n(9359),Fr=n(325),Sr=n(7187);const Ro={...Ve.du,tPreviousLevel:(0,Ne.$G)("texture","alpha","float","nearest"),uInvSize:(0,Ne.w5)("v2"),uOffset:(0,Ne.w5)("v2")},ro=(0,K.NG)("hi-z",Te.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tPreviousLevel;\nuniform vec2 uInvSize;\nuniform vec2 uOffset;\n\nvoid main(void) {\n    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;\n\n    float x = texture(tPreviousLevel, position).r;\n    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;\n    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;\n    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;\n\n    gl_FragColor = vec4(max(max(x, y), max(z, w)));\n}\n");var so=n(9886),ho=n(2086),Bo=n(4677);const Go=ho.e.transformMat4,Wo=r.Zb.set,We=so.ey;function Nn(Tt,Fe,He,Ye){return-1===Ye[11]?function Pt(Tt,Fe,He){return Fe*He/((He-Fe)*Tt-He)}(Tt,Fe,He):function Sn(Tt,Fe,He){return Tt*(Fe-He)-Fe}(Tt,Fe,He)}const Ft={enabled:i.t.Boolean(!1,{description:"Hierarchical Z-buffer occlusion culling. Only available for WebGL2."}),maxFrameLag:i.t.Numeric(10,{min:1,max:30,step:1},{description:"Maximum number of frames to wait for Z-buffer data."}),minLevel:i.t.Numeric(3,{min:1,max:10,step:1})};class Qt{clear(){if(!this.supported)return;const{gl:Fe}=this.webgl;(0,Ie.C6)(Fe)&&(null!==this.sync&&(Fe.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display="none",this.debug.container.style.display="none"))}render(Fe){if(!this.supported||!this.props.enabled)return;const{gl:He,state:Ye}=this.webgl;if(!(0,Ie.C6)(He)||null!==this.sync)return;this.nextNear=Fe.near,this.nextFar=Fe.far,r.$I.copy(this.nextView,Fe.view),r.$I.copy(this.nextProjection,Fe.projection),_.g$&&this.webgl.timer.mark("hi-Z"),Ye.disable(He.CULL_FACE),Ye.disable(He.BLEND),Ye.disable(He.DEPTH_TEST),Ye.disable(He.SCISSOR_TEST),Ye.depthMask(!1),Ye.colorMask(!0,!0,!0,!0),Ye.clearColor(0,0,0,0);const ot=this.renderable.values,rt=Math.pow(2,Math.ceil(Math.log(Math.max(He.drawingBufferWidth,He.drawingBufferHeight))/Math.log(2))-1);for(let mn=0,zt=this.levelData.length;mn<zt;++mn){const an=this.levelData[mn];an.framebuffer.bind(),mn>0?(Sr.IQ.update(ot.uInvSize,an.invSize),Sr.IQ.update(ot.uOffset,Fr.Z.set(ot.uOffset.ref.value,0,0)),Sr.IQ.update(ot.tPreviousLevel,this.levelData[mn-1].texture)):(Sr.IQ.update(ot.uInvSize,Fr.Z.set(ot.uInvSize.ref.value,1/rt,1/rt)),Sr.IQ.update(ot.uOffset,Fr.Z.set(ot.uOffset.ref.value,this.viewport.x/He.drawingBufferWidth,this.viewport.y/He.drawingBufferHeight)),Sr.IQ.update(ot.tPreviousLevel,this.drawPass.depthTextureOpaque)),Ye.currentRenderItemId=-1,Ye.viewport(0,0,an.size[0],an.size[1]),He.clear(He.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),mn>=this.props.minLevel&&(this.tex.bind(0),He.copyTexSubImage2D(He.TEXTURE_2D,0,an.offset,0,0,0,an.size[0],an.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0);const St=this.tex.getWidth(),vt=this.tex.getHeight();He.bindBuffer(He.PIXEL_PACK_BUFFER,this.buf),He.bufferData(He.PIXEL_PACK_BUFFER,this.buffer.byteLength,He.STREAM_READ),He.readPixels(0,0,St,vt,He.RED,He.FLOAT,0),He.bindBuffer(He.PIXEL_PACK_BUFFER,null),this.sync=He.fenceSync(He.SYNC_GPU_COMMANDS_COMPLETE,0),He.flush(),_.g$&&this.webgl.timer.markEnd("hi-Z")}tick(){if(!this.supported||!this.props.enabled||null===this.sync)return;const{gl:Fe}=this.webgl;if(!(0,Ie.C6)(Fe))return;const He=Fe.clientWaitSync(this.sync,0,0);He===Fe.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(Fe.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):He===Fe.TIMEOUT_EXPIRED?this.frameLag+=1:(Fe.bindBuffer(Fe.PIXEL_PACK_BUFFER,this.buf),Fe.getBufferSubData(Fe.PIXEL_PACK_BUFFER,0,this.buffer),Fe.bindBuffer(Fe.PIXEL_PACK_BUFFER,null),Fe.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,r.$I.copy(this.view,this.nextView),r.$I.copy(this.projection,this.nextProjection))}transform(Fe){const{view:He,vp:Ye}=this;return Go(Ye,Fe.center,He),{vp:Ye,r:1.2*Fe.radius+1.52}}project(Fe,He){const{projection:Ye,aabb:ot,viewport:rt}=this;!function xr(Tt,Fe,He,Ye){return-1===Ye[11]?function Kn(Tt,Fe,He,Ye){const ot=Fe[0]*He,rt=Fe[1]*He,St=Fe[2]*He,vt=Fe[2]*Fe[2]-He*He,mn=Math.sqrt(Fe[0]*Fe[0]+vt),zt=(mn*Fe[0]-St)/(mn*Fe[2]+ot)*Ye[0],an=(mn*Fe[0]+St)/(mn*Fe[2]-ot)*Ye[0],Vn=Math.sqrt(Fe[1]*Fe[1]+vt);return Wo(Tt,-.5*an+.5,(Vn*Fe[1]-St)/(Vn*Fe[2]+rt)*Ye[5]*.5+.5,-.5*zt+.5,(Vn*Fe[1]+St)/(Vn*Fe[2]-rt)*Ye[5]*.5+.5)}(Tt,Fe,He,Ye):function dr(Tt,Fe,He,Ye){const ot=Ye[0],rt=Ye[5];return Wo(Tt,(Fe[0]-He)*ot*.5+.5,(Fe[1]+He)*rt*-.5+.5,(Fe[0]+He)*ot*.5+.5,(Fe[1]-He)*rt*-.5+.5)}(Tt,Fe,He,Ye)}(ot,Fe,He,Ye);const St=ot[2]-ot[0],vt=ot[3]-ot[1],mn=Math.max(St*rt.width,vt*rt.height);return{aabb:ot,w:St,h:vt,pr:mn,lod:Math.ceil(We(mn/2))}}setViewport(Fe,He,Ye,ot){if(!this.supported)return;Ye=Math.max(Ye,2),ot=Math.max(ot,2),A.LM.set(this.viewport,Fe,He,Ye,ot);const rt=Math.ceil(Math.log(Math.max(Ye,ot))/Math.log(2));if(rt===this.levelData.length)return;const{minLevel:St}=this.props;this.buffer=new Float32Array(Math.pow(2,rt-St)*Math.pow(2,rt-1-St)),this.tex.define(Math.pow(2,rt-St),Math.pow(2,rt-1-St));for(const mn of this.levelData)mn.framebuffer.destroy(),mn.texture.destroy();this.levelData.length=0;for(let mn=0;mn<rt;++mn){const zt=this.webgl.resources.framebuffer(),an=Math.pow(2,rt-mn-1),Vn=Fr.Z.create(an,an),Fn=Fr.Z.create(1/an,1/an),rr=this.webgl.resources.texture("image-float32","alpha","float","nearest");rr.define(an,an),rr.attachFramebuffer(zt,0),this.levelData.push({texture:rr,framebuffer:zt,size:Vn,invSize:Fn,offset:0})}let vt=0;for(let mn=0,zt=rt;mn<zt;++mn){const an=this.levelData[mn];mn>=St&&(this.levelData[mn].offset=vt,vt+=an.size[0])}this.clear()}setProps(Fe){if(this.supported)if(this.props.minLevel!==Fe.minLevel){Object.assign(this.props,Fe);const{x:He,y:Ye,width:ot,height:rt}=this.viewport;this.setViewport(He,Ye,ot,rt)}else Object.assign(this.props,Fe),this.props.enabled||this.clear()}initDebug(Fe){if(!Fe.parentElement)return;const He=document.createElement("div");Object.assign(He.style,{display:"block",position:"absolute",pointerEvents:"none"}),Fe.parentElement.appendChild(He);const Ye=document.createElement("canvas"),ot=Ye.getContext("2d");if(!ot)throw new Error("Could not create canvas 2d context");Object.assign(Ye.style,{width:"100%",height:"100%",imageRendering:"pixelated",position:"relative",pointerEvents:"none"}),He.appendChild(Ye);const rt=document.createElement("div");Object.assign(rt.style,{display:"none",position:"absolute",pointerEvents:"none"}),Fe.parentElement.appendChild(rt),this.debug={container:He,canvas:Ye,ctx:ot,rect:rt}}canDebug(Fe){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(Fe,He){if(!this.canDebug(this.debug))return;const{gl:{drawingBufferHeight:Ye},pixelRatio:ot}=this.webgl,{viewport:{x:rt,y:St,width:vt,height:mn}}=this,zt=(Fe[0]*vt+rt)/ot,an=(Fe[1]*mn-St)/ot;Object.assign(this.debug.rect.style,{border:He?"solid red":"solid green",display:"block",left:`${zt}px`,top:`${an+(Ye-mn)/ot}px`,width:(Fe[2]*vt+rt)/ot-zt+"px",height:(Fe[3]*mn-St)/ot-an+"px"})}showBuffer(Fe){if(!this.canDebug(this.debug))return;if(Fe>=this.levelData.length||Fe<this.props.minLevel)return void(this.debug.container.style.display="none");const{offset:He,size:[Ye,ot]}=this.levelData[Fe],rt=this.tex.getWidth(),St=new Uint8ClampedArray(Ye*ot*4);St.fill(255);for(let rr=0;rr<ot;++rr)for(let Vr=0;Vr<Ye;++Vr){const tr=(ot-rr-1)*Ye+Vr,Tr=255*this.buffer[rr*rt+Vr+He];St[4*tr+0]=Tr,St[4*tr+3]=255-Tr}const vt=new ImageData(St,Ye,ot);this.debug.canvas.width=vt.width,this.debug.canvas.height=vt.height,this.debug.ctx.putImageData(vt,0,0);const{viewport:{x:mn,y:zt,width:an,height:Vn},webgl:{pixelRatio:Fn}}=this;Object.assign(this.debug.container.style,{display:"block",bottom:zt/Fn+"px",left:mn/Fn+"px",width:an/Fn+"px",height:Vn/Fn+"px"})}debugOcclusion(Fe){if(!this.canDebug(this.debug))return;if(!Fe)return this.debug.rect.style.display="none",void(this.debug.container.style.display="none");const He=this.isOccluded(Fe),{vp:Ye,r:ot}=this.transform(Fe),{aabb:rt,lod:St}=this.project(Ye,ot);this.showRect(rt,He),this.showBuffer(St)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.webgl.gl.deleteBuffer(this.buf),this.renderable.dispose();for(const Fe of this.levelData)Fe.framebuffer.destroy(),Fe.texture.destroy()}}constructor(Fe,He,Ye,ot){this.webgl=Fe,this.drawPass=He,this.viewport=(0,A.LM)(),this.near=0,this.far=0,this.view=(0,r.$I)(),this.projection=(0,r.$I)(),this.nextNear=0,this.nextFar=0,this.nextView=(0,r.$I)(),this.nextProjection=(0,r.$I)(),this.aabb=(0,r.Zb)(),this.vp=(0,ho.e)(),this.levelData=[],this.sync=null,this.buffer=new Float32Array(0),this.frameLag=0,this.ready=!1,this.isOccluded=zt=>{if(!this.supported||!this.props.enabled||!this.ready)return!1;const{vp:an,r:Vn}=this.transform(zt),{near:Fn,far:rr,projection:Vr}=this,tr=an[2]+Vn;if(-tr<Fn)return!1;const{aabb:Tr,w:oo,h:Gr,lod:Ao}=this.project(an,Vn);if(Ao>=this.levelData.length||Ao<this.props.minLevel)return!1;const{offset:yo,size:vo}=this.levelData[Ao],lo=vo[0],ao=(Tr[1]+Gr/2)*lo,Po=Math.floor((Tr[0]+oo/2)*lo),Yr=Math.ceil(ao),jr=this.tex.getWidth();if(Po+1>=lo||Yr+1>=lo)return!1;const Co=(lo-Yr-1)*jr+Po+yo;if(tr>Nn(this.buffer[Co],Fn,rr,Vr)||tr>Nn(this.buffer[Co+1],Fn,rr,Vr))return!1;const Eo=(lo-Yr+1-1)*jr+Po+yo;return!(tr>Nn(this.buffer[Eo],Fn,rr,Vr)||tr>Nn(this.buffer[Eo+1],Fn,rr,Vr))};const{gl:rt,extensions:St}=Fe;if(!(0,Ie.C6)(rt)||!St.colorBufferFloat)return _.Bb&&console.log('Missing webgl2 and/or colorBufferFloat support required for "Hi-Z"'),void(this.supported=!1);this.fb=Fe.resources.framebuffer(),this.tex=Fe.resources.texture("image-float32","alpha","float","nearest"),this.tex.attachFramebuffer(this.fb,0);const vt=rt.getParameter(rt.IMPLEMENTATION_COLOR_READ_FORMAT),mn=rt.getParameter(rt.IMPLEMENTATION_COLOR_READ_TYPE);if(vt!==rt.RED||mn!==rt.FLOAT)return _.Bb&&console.log('Missing red/float reading support required for "Hi-Z"'),void(this.supported=!1);this.supported=!0,this.props={...i.t.getDefaultValues(Ft),...ot},this.buf=(0,Bo.Zo)(rt),this.renderable=function po(Tt,Fe){const He={...Ve.OM,tPreviousLevel:Sr.IQ.create(Fe),uInvSize:Sr.IQ.create((0,Fr.Z)()),uOffset:Sr.IQ.create((0,Fr.Z)())},Ye={...Ro},ot=(0,ne.$h)(Tt,"triangles",ro,Ye,He);return(0,be._)(ot,He)}(Fe,this.drawPass.depthTextureOpaque),_.Bb&&Ye&&this.initDebug(Ye)}}const ht={camera:i.t.Group({mode:i.t.Select("perspective",i.t.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:i.t.Group(fr.kf,{isFlat:!0}),stereo:i.t.MappedStatic("off",{on:i.t.Group(nt),off:i.t.Group({})},{cycle:!0,hideIf:Tt=>"perspective"!==Tt?.mode}),fov:i.t.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:i.t.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:i.t.MappedStatic("on",{on:i.t.Group({intensity:i.t.Numeric(15,{min:1,max:100,step:1})}),off:i.t.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:i.t.Group({radius:i.t.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:i.t.Boolean(!0,{description:"Hide scene in the distance"}),minNear:i.t.Numeric(5,{min:.1,max:100,step:.1},{description:"Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:i.t.MappedStatic("canvas",{canvas:i.t.Group({}),"static-frame":i.t.Group({x:i.t.Numeric(0),y:i.t.Numeric(0),width:i.t.Numeric(128),height:i.t.Numeric(128)}),"relative-frame":i.t.Group({x:i.t.Numeric(.33,{min:0,max:1,step:.01}),y:i.t.Numeric(.33,{min:0,max:1,step:.01}),width:i.t.Numeric(.5,{min:.01,max:1,step:.01}),height:i.t.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:i.t.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:i.t.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:i.t.Boolean(!1),dpoitIterations:i.t.Numeric(2,{min:1,max:10,step:1}),pickPadding:i.t.Numeric(3,{min:0,max:10,step:1},{description:"extra pixels to around target to check in case target is empty"}),multiSample:i.t.Group(ce),postprocessing:i.t.Group(Se.co),marking:i.t.Group(Dt),hiZ:i.t.Group(Ft),renderer:i.t.Group(u),trackball:i.t.Group(E),interaction:i.t.Group(we),debug:i.t.Group(de),handle:i.t.Group(ct)},pt=i.t.getDefaultValues(ht);var Xt;!function(Tt){Tt.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},Tt.Params={pixelScale:i.t.Numeric(1,{min:.1,max:2,step:.05}),pickScale:i.t.Numeric(.25,{min:.1,max:1,step:.05}),transparency:i.t.Select("wboit",[["blended","Blended"],["wboit","Weighted, Blended"],["dpoit","Depth Peeling"]])},Tt.DefaultProps=i.t.getDefaultValues(Tt.Params),Tt.fromCanvas=function Fe(He,Ye,ot={},rt={}){const St={...Tt.DefaultAttribs,...ot},vt={...Tt.DefaultProps,...rt},{powerPreference:mn,failIfMajorPerformanceCaveat:zt,antialias:an,preserveDrawingBuffer:Vn,preferWebGl1:Fn}=St,rr=(0,L.$i)(He,{powerPreference:mn,failIfMajorPerformanceCaveat:zt,antialias:an,preserveDrawingBuffer:Vn,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:Fn});if(null===rr)throw new Error("Could not create a WebGL rendering context");const{pixelScale:Vr,pickScale:tr,transparency:Tr}=vt,oo=t.bP.fromElement(He,{pixelScale:Vr,preventGestures:!0}),Gr=(0,L.q6)(rr,{pixelScale:Vr}),Ao=new Hr(Gr,Ye,{pickScale:tr,transparency:Tr});if(_.Bb){const lo=rr.getExtension("WEBGL_lose_context");lo&&He.addEventListener("mousedown",So=>{Gr.isContextLost||!So.shiftKey||!So.ctrlKey||!So.altKey||(_.Bb&&console.log("lose context"),lo.loseContext(),setTimeout(()=>{Gr.isContextLost&&(_.Bb&&console.log("restore context"),lo.restoreContext())},1e3))},!1)}const yo=new e.t(0),vo=lo=>{Gr.setContextLost(),lo.preventDefault(),_.Bb&&console.log("context lost"),yo.next((0,o.t)())},Kr=()=>{Gr.isContextLost&&(Gr.handleContextRestored(()=>{Ao.draw.reset()}),_.Bb&&console.log("context restored"))};He.addEventListener("webglcontextlost",vo,!1),He.addEventListener("webglcontextrestored",Kr,!1);const Do=new e.t(void 0);return{canvas:He,webgl:Gr,input:oo,passes:Ao,attribs:St,get props(){return{...vt}},contextLost:yo,contextRestored:Gr.contextRestored,assetManager:Ye,changed:Do,setProps:lo=>{if(!lo)return;let So=!1;void 0!==lo.pixelScale&&lo.pixelScale!==vt.pixelScale&&(vt.pixelScale=lo.pixelScale,oo.setPixelScale(lo.pixelScale),Gr.setPixelScale(lo.pixelScale),St.handleResize(),So=!0),void 0!==lo.pickScale&&lo.pickScale!==vt.pickScale&&(vt.pickScale=lo.pickScale,Ao.setPickScale(lo.pickScale),So=!0),void 0!==lo.transparency&&lo.transparency!==vt.transparency&&(vt.transparency=lo.transparency,Ao.setTransparency(lo.transparency),So=!0),So&&Do.next(void 0)},dispose:lo=>{oo.dispose(),He.removeEventListener("webglcontextlost",vo,!1),He.removeEventListener("webglcontextrestored",Kr,!1),Gr.destroy(lo)}}}}(Xt||(Xt={}));const fn=typeof window<"u"?window.requestAnimationFrame:Tt=>setImmediate(()=>Tt(Date.now())),on=typeof window<"u"?window.cancelAnimationFrame:Tt=>clearImmediate(Tt);var En;!function(Tt){Tt.create=function Fe(He,Ye={}){var ot;const{webgl:rt,input:St,passes:vt,assetManager:mn,canvas:zt}=He,an={...(0,Mr.Go)(pt),...(0,Mr.Go)(Ye)},Vn=new Map,Fn=new Map,rr=new e.t(0);let Vr=(0,o.t)();const tr=new e.t(0),Tr=new e.t(0),oo=new e.t(0),{gl:Gr,contextRestored:Ao}=rt;let yo=0,vo=0,Kr=128,Do=128,lo=!1,So=0;st();const ao=Q.Z.create(rt,vt.draw.transparency);function Po(){return ao.boundingSphere.radius*an.sceneRadiusFactor}const Yr=new V.i({position:r.eB.create(0,0,100),mode:an.camera.mode,fog:"on"===an.cameraFog.name?an.cameraFog.params.intensity:0,clipFar:an.cameraClipping.far,minNear:an.cameraClipping.minNear,fov:(0,v.pu)(an.camera.fov)},{x:yo,y:vo,width:Kr,height:Do}),jr=new Lt(Yr,an.camera.stereo.params),Co=T.create(St,Yr,ao,an.trackball),Eo=new vr(rt,ao,an),Fo=new Qt(rt,vt.draw,zt,an.hiZ),ei=h.create(rt,an.renderer);ei.setOcclusionTest(Fo.isOccluded);const Yo=new _t(rt,ei,ao,Eo,vt.pick,{x:yo,y:vo,width:Kr,height:Do},an.pickPadding),ci=new Oe(kr,qi,St,Yr,Co,an.interaction),Jo=new ge(vt.multiSample);vt.draw.postprocessing.background.update(Yr,an.postprocessing.background,at=>{at&&Ri()});let hi,No,Fi=!1,Ci=!1,mi=!0;function qi(at){let Et=G.BL,Nt=w.YL.Empty;if(at){const qt=Eo.camera.getLoci(at);if(qt!==G.BL)return{loci:qt,repr:Nt};Et=Eo.handle.getLoci(at),Vn.forEach((Cn,Un)=>{const vn=Un.getLoci(at);(0,G.$M)(vn)||((0,G.$M)(Et)||console.warn("found another loci, this should not happen"),Et=vn,Nt=Un)})}return{loci:Et,repr:Nt}}let Oi=[];function Si(at,Et){const{repr:Nt,loci:qt}=at;let Cn=!1;return Nt?Cn=Nt.mark(qt,Et)||Cn:Vn.forEach((Un,vn)=>{Cn=vn.mark(qt,Et)||Cn}),Cn=Eo.handle.mark(qt,Et)||Cn,Cn=Eo.camera.mark(qt,Et)||Cn,Cn}let ni=!1,gi=!1;function Wi(at){gi||function Pi(at){if(rt.isContextLost)return!1;let Et=!1;if(Ci&&(Jn(!1),Ci=!1,Et=!0),yo>Gr.drawingBufferWidth||yo+Kr<0||vo>Gr.drawingBufferHeight||vo+Do<0)return!1;const Nt=function es(){let at=!1;for(const[Et,Nt]of Oi)at=Si(Et,Nt)||at;return Oi=[],at&&(ao.update(void 0,!0),Eo.handle.scene.update(void 0,!0),Eo.camera.scene.update(void 0,!0)),at}()&&(ei.props.colorMarker||an.marking.enabled);let qt=!1;Co.update(So);const Cn=Yr.update(),Un=at||Cn||Et||lo;lo=!1;const vn=Jo.update(Nt||Un,an.multiSample);if(Un||vn||Nt){let nr=Yr;"on"===an.camera.stereo.name&&(jr.update(),nr=jr),_.g$&&rt.timer.mark("Canvas3D.render",!0);const pr={renderer:ei,camera:nr,scene:ao,helper:Eo};se.isEnabled(an.multiSample)?Jo.render(pr,an,!0,an.multiSample.reduceFlicker&&!Cn&&Nt&&!Co.isAnimating):vt.draw.render(pr,an,!0),Fo.render(Yr),_.g$&&rt.timer.markEnd("Canvas3D.render"),Yo.dirty=Yo.dirty||Un,qt=!0}return qt}(!!at?.force)&&mi&&tr.next((0,o.t)()-Vr)}function Ri(){lo=!0}let Qi=0;function Hn(at,Et){So=at,Qr(Et?.isSynchronous),Et?.updateControls&&Co.update(So),Yr.transition.tick(So),Fo.tick(),!Et?.manualDraw&&(Wi(),!Yr.transition.inTransition&&!rt.isContextLost&&ci.tick(So))}function qr(){Hn((0,o.t)()),Qi=fn(qr)}function kr(at,Et){return rt.isContextLost?void 0:Yo.identify(at,Et,"on"===an.camera.stereo.name?jr:Yr)}function Qr(at=!1){(function Vi(at){return!ao.needsCommit||($.f8.copy(Ti,ao.boundingSphereVisible),Fo.clear(),ao.commit(at?void 0:bi)?(oo.next(0),Eo.debug.isEnabled&&Eo.debug.update(),!an.camera.manualReset&&(0===rr.value||function Li(){if(0===Yr.state.radiusMax)return!0;if(Yr.transition.inTransition||No)return!1;let at=!0,Et=!0;$.f8.set(Bi,Yr.state.target,Yr.state.radius);for(const Nt of ao.renderables){if(!Nt.state.visible)continue;const qt=Nt.values.boundingSphere.ref.value;if(!qt.radius)continue;Et=!1;const Cn=r.eB.distance(Bi.center,qt.center);if((Cn>Bi.radius||Cn>qt.radius||qt.radius>Yr.state.radiusMax)&&!$.f8.includes(Ti,qt))return!0;$.f8.overlaps(Bi,qt)&&(at=!1)}return at||!Et&&Bi.radius<=.1}())&&(Fi=!0),0===Ti.radius&&(hi=0),an.camera.manualReset||Yr.setState({radiusMax:Po()},0),rr.next(Vn.size),_.Bb&&Ei(),!0):(oo.next(ao.commitQueueSize),!1))})(at)&&(function vi(){if(!Fi)return;const at=ao.boundingSphereVisible,{center:Et,radius:Nt}=at,qt=Co.props.autoAdjustMinMaxDistance;if("on"===qt.name){const Cn=qt.params.minDistanceFactor*Nt+qt.params.minDistancePadding,Un=Math.max(qt.params.maxDistanceFactor*Nt,qt.params.maxDistanceMin);Co.setProps({minDistance:Cn,maxDistance:Un})}if(Nt>0){const Cn=void 0===hi?an.cameraResetDurationMs:hi,Un=Yr.getFocus(Et,Nt),vn="function"==typeof No?No(ao,Yr):No,nr=vn?{...Un,...vn}:Un;Yr.setState({...nr,radiusMax:Po()},Cn)}hi=void 0,No=void 0,Fi=!1}(),ni&&(Eo.debug.isEnabled&&Eo.debug.update(),Wi({force:!0}),ni=!1),Tr.next((0,o.t)()))}const Ti=(0,$.f8)(),Bi=(0,$.f8)(),bi=250;function Ei(){const at=ao.renderables.map(Cn=>({drawCount:Cn.values.drawCount.ref.value,instanceCount:Cn.values.instanceCount.ref.value,materialId:Cn.materialId,renderItemId:Cn.id}));console.groupCollapsed(`${at.length} RenderItems`),at.length<50?console.table(at):console.log(at),console.log(JSON.stringify(rt.stats,void 0,4));const{texture:Et,attribute:Nt,elements:qt}=rt.resources.getByteCounts();console.log(JSON.stringify({texture:`${(Et/1024/1024).toFixed(3)} MiB`,attribute:`${(Nt/1024/1024).toFixed(3)} MiB`,elements:`${(qt/1024/1024).toFixed(3)} MiB`},void 0,4)),console.log(JSON.stringify(rt.timer.formatedStats(),void 0,4)),console.groupEnd()}function kn(){const at=ao.boundingSphere.radius>0?100-Math.round(Yr.transition.target.radius/Po()*100):0;return{camera:{mode:Yr.state.mode,helper:{...Eo.camera.props},stereo:{...an.camera.stereo},fov:Math.round((0,v.H)(Yr.state.fov)),manualReset:!!an.camera.manualReset},cameraFog:Yr.state.fog>0?{name:"on",params:{intensity:Yr.state.fog}}:{name:"off",params:{}},cameraClipping:{far:Yr.state.clipFar,radius:at,minNear:Yr.state.minNear},cameraResetDurationMs:an.cameraResetDurationMs,sceneRadiusFactor:an.sceneRadiusFactor,transparentBackground:an.transparentBackground,dpoitIterations:an.dpoitIterations,pickPadding:an.pickPadding,viewport:an.viewport,postprocessing:{...an.postprocessing},marking:{...an.marking},multiSample:{...an.multiSample},hiZ:{...Fo.props},renderer:{...ei.props},trackball:{...Co.props},interaction:{...ci.props},debug:{...Eo.debug.props},handle:{...Eo.handle.props}}}const ur=Ao.subscribe(()=>{Yo.dirty=!0,Wi({force:!0}),Wi({force:!0})}),sr=new e.t(0);function Jn(at=!0){vt.updateSize(),st(),et(),at&&Ri(),sr.next(+new Date)}(0,_.fv)(Ei);const Br=null===(ot=He.changed)||void 0===ot?void 0:ot.subscribe(()=>{ao.setTransparency(vt.draw.transparency),Ri()});if(_.Bb&&zt){let at;const Et=Nt=>{const qt=Nt&&G.QN.getBoundingSphere(G.QN.normalize(Nt,"residue"));Fo.debugOcclusion(qt)};St.click.subscribe(Nt=>{if(!Nt.modifiers.control||2!==Nt.button)return;const qt=kr(Nt.x,Nt.y);if(!qt)return at=void 0,void Et(at);at=qi(qt.id).loci,Et(at)}),tr.subscribe(()=>{setTimeout(()=>{Et(at)},100)})}return{webgl:rt,add:function ln(at){!function Gn(at){Fn.has(at)||Fn.set(at,at.updated.subscribe(Et=>{at.state.syncManually||ln(at)}))}(at);const Et=Vn.get(at),Nt=new Set;at.renderObjects.forEach(qt=>Nt.add(qt)),Et?xe.M.areEqual(Nt,Et)||(Nt.forEach(qt=>{Et.has(qt)||ao.add(qt)}),Et.forEach(qt=>{Nt.has(qt)||ao.remove(qt)})):at.renderObjects.forEach(qt=>ao.add(qt)),Vn.set(at,Nt),ao.update(at.renderObjects,!1),ni=!0,_.Bb&&Ei()},remove:function Ht(at){!function ar(at){const Et=Fn.get(at);Et&&(Et.unsubscribe(),Fn.delete(at))}(at);const Et=Vn.get(at);Et&&(Et.forEach(Nt=>ao.remove(Nt)),Vn.delete(at),ni=!0,_.Bb&&Ei())},commit:Qr,update:(at,Et)=>{if(at){if(!Vn.has(at))return;ao.update(at.renderObjects,!!Et)}else ao.update(void 0,!!Et);ni=!0},clear:()=>{Fn.forEach(at=>at.unsubscribe()),Fn.clear(),Vn.clear(),ao.clear(),Eo.debug.clear(),Ri(),rr.next(Vn.size)},syncVisibility:()=>{0===Yr.state.radiusMax&&(Fi=!0,hi=0),ao.syncVisibility()&&Eo.debug.isEnabled&&Eo.debug.update(),Ri()},requestDraw:Ri,tick:Hn,animate:function zr(){gi=!1,Co.start((0,o.t)()),0===Qi&&qr()},resetTime:function co(at){Vr=at,Co.start(at)},pause:function lr(at=!1){gi=at,on(Qi),Qi=0},resume:()=>{gi=!1},identify:kr,mark:function ti(at,Et){Oi.push([at,Et])},getLoci:qi,handleResize:Jn,requestResize:()=>{Ci=!0},requestCameraReset:at=>{hi=at?.durationMs,No=at?.snapshot,Fi=!0},camera:Yr,boundingSphere:ao.boundingSphere,boundingSphereVisible:ao.boundingSphereVisible,get notifyDidDraw(){return mi},set notifyDidDraw(at){mi=at},didDraw:tr,commited:Tr,commitQueueSize:oo,reprCount:rr,resized:sr,setProps:(at,Et=!1)=>{var Nt,qt,Cn,Un;const vn="function"==typeof at?(0,or.jM)(kn(),at):at;void 0!==vn.sceneRadiusFactor&&(an.sceneRadiusFactor=vn.sceneRadiusFactor,Yr.setState({radiusMax:Po()},0));const nr=Object.create(null);vn.camera&&void 0!==vn.camera.mode&&vn.camera.mode!==Yr.state.mode&&(nr.mode=vn.camera.mode);const pr=Math.round((0,v.H)(Yr.state.fov));if(vn.camera&&void 0!==vn.camera.fov&&vn.camera.fov!==pr&&(nr.fov=(0,v.pu)(vn.camera.fov)),void 0!==vn.cameraFog&&vn.cameraFog.params){const Rr="on"===vn.cameraFog.name?vn.cameraFog.params.intensity:0;Rr!==Yr.state.fog&&(nr.fog=Rr)}if(void 0!==vn.cameraClipping&&(void 0!==vn.cameraClipping.far&&vn.cameraClipping.far!==Yr.state.clipFar&&(nr.clipFar=vn.cameraClipping.far),void 0!==vn.cameraClipping.minNear&&vn.cameraClipping.minNear!==Yr.state.minNear&&(nr.minNear=vn.cameraClipping.minNear),void 0!==vn.cameraClipping.radius)){const Rr=Po()/100*(100-vn.cameraClipping.radius);Rr>0&&Rr!==nr.radius&&(nr.radius=Math.max(Rr,.01))}Object.keys(nr).length>0&&Yr.setState(nr),!(null===(Nt=vn.camera)||void 0===Nt)&&Nt.helper&&Eo.camera.setProps(vn.camera.helper),void 0!==(null===(qt=vn.camera)||void 0===qt?void 0:qt.manualReset)&&(an.camera.manualReset=vn.camera.manualReset),void 0!==(null===(Cn=vn.camera)||void 0===Cn?void 0:Cn.stereo)&&(Object.assign(an.camera.stereo,vn.camera.stereo),jr.setProps(an.camera.stereo.params)),void 0!==vn.cameraResetDurationMs&&(an.cameraResetDurationMs=vn.cameraResetDurationMs),void 0!==vn.transparentBackground&&(an.transparentBackground=vn.transparentBackground),void 0!==vn.dpoitIterations&&(an.dpoitIterations=vn.dpoitIterations),void 0!==vn.pickPadding&&(an.pickPadding=vn.pickPadding),void 0!==vn.viewport&&(an.viewport===vn.viewport||an.viewport.name===vn.viewport.name&&(0,c.bN)(an.viewport.params,vn.viewport.params)||(an.viewport=vn.viewport,st(),et())),!(null===(Un=vn.postprocessing)||void 0===Un)&&Un.background&&(Object.assign(an.postprocessing.background,vn.postprocessing.background),vt.draw.postprocessing.background.update(Yr,an.postprocessing.background,Rr=>{Rr&&!Et&&Ri()})),vn.postprocessing&&Object.assign(an.postprocessing,vn.postprocessing),vn.marking&&Object.assign(an.marking,vn.marking),vn.multiSample&&Object.assign(an.multiSample,vn.multiSample),vn.hiZ&&Fo.setProps(vn.hiZ),vn.renderer&&ei.setProps(vn.renderer),vn.trackball&&Co.setProps(vn.trackball),vn.interaction&&ci.setProps(vn.interaction),vn.debug&&Eo.debug.setProps(vn.debug),vn.handle&&Eo.handle.setProps(vn.handle),"orthographic"===nr.mode&&(an.camera.stereo.name="off"),Et||Ri()},getImagePass:(at={})=>new Pr(rt,mn,ei,ao,Yr,Eo,vt.draw.transparency,at),getRenderObjects(){const at=[];return ao.forEach((Et,Nt)=>at.push(Nt)),at},get props(){return kn()},get input(){return St},get stats(){return ei.stats},get interaction(){return ci.events},dispose:()=>{ur.unsubscribe(),Br?.unsubscribe(),on(Qi),Oi=[],ao.clear(),Eo.debug.clear(),Co.dispose(),ei.dispose(),ci.dispose(),Fo.dispose(),(0,_.EF)(Ei)}};function st(){const at=yo,Et=vo,Nt=Kr,qt=Do;"canvas"===an.viewport.name?(yo=0,vo=0,Kr=Gr.drawingBufferWidth,Do=Gr.drawingBufferHeight):"static-frame"===an.viewport.name?(yo=an.viewport.params.x*rt.pixelRatio,Do=an.viewport.params.height*rt.pixelRatio,vo=Gr.drawingBufferHeight-Do-an.viewport.params.y*rt.pixelRatio,Kr=an.viewport.params.width*rt.pixelRatio):"relative-frame"===an.viewport.name&&(yo=Math.round(an.viewport.params.x*Gr.drawingBufferWidth),Do=Math.round(an.viewport.params.height*Gr.drawingBufferHeight),vo=Math.round(Gr.drawingBufferHeight-Do-an.viewport.params.y*Gr.drawingBufferHeight),Kr=Math.round(an.viewport.params.width*Gr.drawingBufferWidth)),(at!==yo||Et!==vo||Nt!==Kr||qt!==Do)&&(lo=!0)}function et(){Yo.setViewport(yo,vo,Kr,Do),ei.setViewport(yo,vo,Kr,Do),A.LM.set(Yr.viewport,yo,vo,Kr,Do),A.LM.set(Co.viewport,yo,vo,Kr,Do),Fo.setViewport(yo,vo,Kr,Do)}}}(En||(En={}))},7028:(tn,Ue,n)=>{"use strict";n.d(Ue,{E2:()=>f,Nz:()=>S,WT:()=>a,kf:()=>h});var e=n(1025),o=n(7103),r=n(2802),t=n(4439),A=n(9283),y=n(573),c=n(4255),i=n(7377),v=n(4536),O=n(5384),b=n(4369),_=n(3246),M=n(3558),I=n(5117),l=n(2745),m=n(6825),u=n(8277),d=n(1372),s=n(5276);const C={alpha:u.t.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:u.t.Color(l.s.red,{isEssential:!0}),colorY:u.t.Color(l.s.green,{isEssential:!0}),colorZ:u.t.Color(l.s.blue,{isEssential:!0}),scale:u.t.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:u.t.Select("bottom-left",u.t.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:u.t.Numeric(0),locationOffsetY:u.t.Numeric(0),originColor:u.t.Color(l.s.grey),radiusScale:u.t.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:u.t.Boolean(!0),planeColorXY:u.t.Color(l.s.grey,{label:"Plane Color XY"}),planeColorXZ:u.t.Color(l.s.grey,{label:"Plane Color XZ"}),planeColorYZ:u.t.Color(l.s.grey,{label:"Plane Color YZ"}),showLabels:u.t.Boolean(!1),labelX:u.t.Text("X"),labelY:u.t.Text("Y"),labelZ:u.t.Text("Z"),labelColorX:u.t.Color(l.s.grey),labelColorY:u.t.Color(l.s.grey),labelColorZ:u.t.Color(l.s.grey),labelOpacity:u.t.Numeric(1,{min:0,max:1,step:.01}),labelScale:u.t.Numeric(.25,{min:.1,max:1,step:.01})},h={axes:u.t.MappedStatic("on",{on:u.t.Group(C),off:u.t.Group({})},{cycle:!0,description:"Show camera orientation axes"})};class a{constructor(U,N={}){this.webgl=U,this.props={axes:{name:"off",params:{}}},this.pixelRatio=1,this.eachGroup=(k,H)=>{if(!f(k))return!1;let $=!1;if(this.meshRenderObject){const J=this.meshRenderObject.values.uGroupCount.ref.value;for(const{groupId:W,instanceId:te}of k.elements)H(o.I.ofSingleton(te*J+W))&&($=!0)}if(this.textRenderObject){const J=this.textRenderObject.values.uGroupCount.ref.value;for(const{groupId:W,instanceId:te}of k.elements)H(o.I.ofSingleton(te*J+W))&&($=!0)}return $},this.scene=v.Z.create(U,"blended"),this.camera=new s.i,b.eB.set(this.camera.up,0,1,0),b.eB.set(this.camera.target,0,0,0),this.setProps(N)}setProps(U){this.props=(0,e.jM)(this.props,N=>{if(void 0!==U.axes&&(N.axes.name=U.axes.name,"on"===U.axes.name)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;const k={...U.axes.params,scale:U.axes.params.scale*this.pixelRatio,labelScale:U.axes.params.labelScale*this.pixelRatio};this.meshRenderObject=function L(V){const U=function T(V,U){const N=100*V.scale,k=function E(V,U){const N=y.P.createState(512,256,U),k=100*V.scale,H=V.radiusScale*k,$=V.showLabels?100*V.labelScale/3:0,J=b.eB.scale((0,b.eB)(),b.eB.unitX,k-$),W=b.eB.scale((0,b.eB)(),b.eB.unitY,k-$),te=b.eB.scale((0,b.eB)(),b.eB.unitZ,k-$),de={radiusTop:H,radiusBottom:H,radialSegments:32};if(N.currentGroup=S.Origin,(0,t.X)(N,b.eB.origin,H,2),N.currentGroup=S.X,(0,t.X)(N,J,H,2),(0,r.y9)(N,b.eB.origin,J,1,de),N.currentGroup=S.Y,(0,t.X)(N,W,H,2),(0,r.y9)(N,b.eB.origin,W,1,de),N.currentGroup=S.Z,(0,t.X)(N,te,H,2),(0,r.y9)(N,b.eB.origin,te,1,de),V.showPlanes){b.eB.scale(J,J,.5),b.eB.scale(W,W,.5),b.eB.scale(te,te,.5),N.currentGroup=S.XY,y.P.addTriangle(N,b.eB.origin,J,W),y.P.addTriangle(N,b.eB.origin,W,J);const ye=b.eB.add((0,b.eB)(),J,W);y.P.addTriangle(N,ye,J,W),y.P.addTriangle(N,ye,W,J),N.currentGroup=S.XZ,y.P.addTriangle(N,b.eB.origin,J,te),y.P.addTriangle(N,b.eB.origin,te,J);const j=b.eB.add((0,b.eB)(),J,te);y.P.addTriangle(N,j,J,te),y.P.addTriangle(N,j,te,J),N.currentGroup=S.YZ,y.P.addTriangle(N,b.eB.origin,W,te),y.P.addTriangle(N,b.eB.origin,te,W);const Z=b.eB.add((0,b.eB)(),W,te);y.P.addTriangle(N,Z,W,te),y.P.addTriangle(N,Z,te,W)}return y.P.getMesh(N)}(V,U?.geometry);k.setBoundingSphere(O.f8.create(b.eB.create(N/2,N/2,N/2),N+N/4));return M.y.create("axes-mesh",{},k,$=>{switch($){case S.X:return V.colorX;case S.Y:return V.colorY;case S.Z:return V.colorZ;case S.XY:return V.planeColorXY;case S.XZ:return V.planeColorXZ;case S.YZ:return V.planeColorYZ;case S.Origin:return V.originColor;default:return l.s.grey}},()=>1,()=>"")}(V);return M.y.createRenderObject(U,{...u.t.getDefaultValues(A.e.Params),...V,ignoreLight:!0,cellSize:0})}(k),this.scene.add(this.meshRenderObject),U.axes.params.showLabels?(this.textRenderObject=function G(V){const U=function Q(V,U){const N=100*V.scale,k=function w(V,U){const N=i.t.create(V,8,8,U),k=100*V.scale,H=b.eB.scale((0,b.eB)(),b.eB.unitX,k),$=b.eB.scale((0,b.eB)(),b.eB.unitY,k),J=b.eB.scale((0,b.eB)(),b.eB.unitZ,k),W=100*V.labelScale;return N.add(V.labelX,H[0],H[1],H[2],0,W,S.X),N.add(V.labelY,$[0],$[1],$[2],0,W,S.Y),N.add(V.labelZ,J[0],J[1],J[2],0,W,S.Z),N.getText()}(V,U?.geometry);k.setBoundingSphere(O.f8.create(b.eB.create(N/2,N/2,N/2),N));return M.y.create("axes-text",{},k,$=>{switch($){case S.X:return V.labelColorX;case S.Y:return V.labelColorY;case S.Z:return V.labelColorZ;default:return l.s.grey}},()=>1,()=>"")}(V);return M.y.createRenderObject(U,{...u.t.getDefaultValues(c.E.Params),...V,alpha:V.labelOpacity,cellSize:0})}(k),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),b.eB.set(this.camera.position,0,0,200*k.scale),b.$I.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),N.axes.params={...U.axes.params}}})}get isEnabled(){return"on"===this.props.axes.name}getLoci(U){const{objectId:N,groupId:k,instanceId:H}=U;return(this.meshRenderObject&&N===this.meshRenderObject.id||this.textRenderObject&&N===this.textRenderObject.id)&&k!==S.None?function R(V,U,N){return(0,_.g9)("camera-axes",V,[{groupId:U,instanceId:N}],void 0,()=>function D(V,U){const N=U.props.axes,k="on"===N.name?N.params.labelX:"X",H="on"===N.name?N.params.labelY:"Y",$="on"===N.name?N.params.labelZ:"Z";switch(V){case S.X:return`${k} Axis`;case S.Y:return`${H} Axis`;case S.Z:return`${$} Axis`;case S.XY:return`${k}${H} Plane`;case S.XZ:return`${k}${$} Plane`;case S.YZ:return`${H}${$} Plane`;case S.Origin:return"Origin";default:return"Axes"}}(U,V))}(this,k,H):_.BL}mark(U,N){return!(!m.sY.is(m.sY.Highlighting,N)||!((0,_.xc)(U)||f(U)&&U.data===this))&&(I.b.mark(this.meshRenderObject,U,N,this.eachGroup)||I.b.mark(this.textRenderObject,U,N,this.eachGroup))}update(U){if(!this.meshRenderObject||"off"===this.props.axes.name)return;this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),function p(V,U,N){const{near:k,far:H}=V,$=-U.width/2,J=U.width/2,W=U.height/2,te=-U.height/2,de=(J-$)/2,ye=(W-te)/2,j=(J+$)/2,Z=(W+te)/2;let q=j-de,Y=j+de,ee=Z+ye,g=Z-ye;if(N.enabled){const _e=(J-$)/N.width,xe=(W-te)/N.height;q+=_e*N.offsetX,Y=q+_e*N.width,ee-=xe*N.offsetY,g=ee-xe*N.height}b.$I.ortho(V.projection,q,Y,ee,g,k,H)}(this.camera,U.viewport,U.viewOffset),b.$I.extractRotation(this.scene.view,U.view);const N=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,k=this.props.axes.params.location,H=this.props.axes.params.locationOffsetX*this.pixelRatio,$=this.props.axes.params.locationOffsetY*this.pixelRatio;"bottom-left"===k?b.$I.setTranslation(this.scene.view,b.eB.create(-U.viewport.width/2+N+H,-U.viewport.height/2+N+$,0)):"bottom-right"===k?b.$I.setTranslation(this.scene.view,b.eB.create(U.viewport.width/2-N-H,-U.viewport.height/2+N+$,0)):"top-left"===k?b.$I.setTranslation(this.scene.view,b.eB.create(-U.viewport.width/2+N+H,U.viewport.height/2-N-$,0)):"top-right"===k?b.$I.setTranslation(this.scene.view,b.eB.create(U.viewport.width/2-N-H,U.viewport.height/2-N-$,0)):(0,d.dr)(k)}}var S=function(V){return V[V.None=0]="None",V[V.X=1]="X",V[V.Y=2]="Y",V[V.Z=3]="Z",V[V.XY=4]="XY",V[V.XZ=5]="XZ",V[V.YZ=6]="YZ",V[V.Origin=7]="Origin",V}(S||{});function f(V){return"data-loci"===V.kind&&"camera-axes"===V.tag}},3770:(tn,Ue,n)=>{"use strict";n.d(Ue,{c:()=>u,P:()=>d});var e=n(9007),o=n(9421),r=n(4511),t=n(2897),A=n(4143),y=n(4648),c=n(4369),i=n(9909),v=n(8277),O=n(9387),b=n(2629),l=n(1094);const u={strength:v.t.Numeric(1,{min:0,max:3,step:.1}),radius:v.t.Numeric(0,{min:0,max:1,step:.01}),threshold:v.t.Numeric(0,{min:0,max:1,step:.01},{description:"Luminosity threshold",hideIf:G=>"emissive"===G.mode}),mode:v.t.Select("emissive",[["luminosity","Luminosity"],["emissive","Emissive"]])};class d{static isEnabled(V){return"on"===V.bloom.name}constructor(V,U,N){this.webgl=V,this.horizontalBlurTargets=[],this.verticalBlurTargets=[],this.emissiveTarget=V.createRenderTarget(U,N,!0,"uint8","linear","rgba"),this.luminosityTarget=V.createRenderTarget(U,N,!1,"uint8","linear"),this.compositeTarget=V.createRenderTarget(U,N,!1,"uint8","linear");let k=Math.round(U/2),H=Math.round(N/2);for(let J=0;J<5;++J)this.horizontalBlurTargets[J]=V.createRenderTarget(k,H,!1,"uint8","linear"),this.verticalBlurTargets[J]=V.createRenderTarget(k,H,!1,"uint8","linear"),k=Math.round(k/2),H=Math.round(H/2);const $=(0,y.z6)();this.luminosityRenderable=function h(G,V,U,N){const k=V.getWidth(),H=V.getHeight(),$={...e.OM,tColor:i.IQ.create(V),tEmissive:i.IQ.create(U),tDepth:i.IQ.create(N),uTexSizeInv:i.IQ.create(c.ZY.create(1/k,1/H)),uDefaultColor:i.IQ.create((0,c.eB)()),uDefaultOpacity:i.IQ.create(0),uLuminosityThreshold:i.IQ.create(0),uSmoothWidth:i.IQ.create(1),dMode:i.IQ.create("emissive")},J={...s},W=(0,A.$h)(G,"triangles",C,J,$);return(0,o._)(W,$)}(V,$,$,$),this.blurRenderable=function T(G,V){const U=V.getWidth(),N=V.getHeight(),k={...e.OM,tInput:i.IQ.create(V),uTexSizeInv:i.IQ.create(c.ZY.create(1/U,1/N)),uDirection:i.IQ.create((0,c.ZY)()),uGaussianCoefficients:i.IQ.create([]),dKernelRadius:i.IQ.create(D[0])},H={...p},$=(0,A.$h)(G,"triangles",E,H,k);return(0,o._)($,k)}(V,$),this.compositeRenderable=function Q(G,V,U,N,k,H,$,J){const W={...e.OM,uTexSizeInv:i.IQ.create(c.ZY.create(V,U)),tBlur1:i.IQ.create(N),tBlur2:i.IQ.create(k),tBlur3:i.IQ.create(H),tBlur4:i.IQ.create($),tBlur5:i.IQ.create(J),uBloomStrength:i.IQ.create(1),uBloomRadius:i.IQ.create(0),uBloomFactors:i.IQ.create([1,.8,.6,.4,.2]),uBloomTints:i.IQ.create(new Array(15).fill(1))},te={...L},de=(0,A.$h)(G,"triangles",w,te,W);return(0,o._)(de,W)}(V,U,N,this.verticalBlurTargets[0].texture,this.verticalBlurTargets[1].texture,this.verticalBlurTargets[2].texture,this.verticalBlurTargets[3].texture,this.verticalBlurTargets[4].texture),this.copyRenderable=(0,e._0)(V,this.compositeTarget.texture)}setSize(V,U){const N=this.luminosityTarget.getWidth(),k=this.luminosityTarget.getHeight();if(V!==N||U!==k){this.emissiveTarget.setSize(V,U),this.luminosityTarget.setSize(V,U),this.compositeTarget.setSize(V,U);let H=Math.round(V/2),$=Math.round(U/2);for(let J=0;J<5;++J)this.horizontalBlurTargets[J].setSize(H,$),this.verticalBlurTargets[J].setSize(H,$),H=Math.round(H/2),$=Math.round($/2);i.IQ.update(this.luminosityRenderable.values.uTexSizeInv,c.ZY.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/V,1/U)),i.IQ.update(this.compositeRenderable.values.uTexSizeInv,c.ZY.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/V,1/U)),i.IQ.update(this.copyRenderable.values.uTexSize,c.ZY.set(this.copyRenderable.values.uTexSize.ref.value,V,U))}}update(V,U,N,k){let H=!1;this.luminosityRenderable.values.tColor.ref.value!==V&&(i.IQ.update(this.luminosityRenderable.values.tColor,V),H=!0),this.luminosityRenderable.values.tEmissive.ref.value!==U&&(i.IQ.update(this.luminosityRenderable.values.tEmissive,U),H=!0),this.luminosityRenderable.values.tDepth.ref.value!==N&&(i.IQ.update(this.luminosityRenderable.values.tDepth,N),H=!0),this.luminosityRenderable.values.dMode.ref.value!==k.mode&&(i.IQ.update(this.luminosityRenderable.values.dMode,k.mode),H=!0),i.IQ.updateIfChanged(this.luminosityRenderable.values.uLuminosityThreshold,k.threshold),H&&this.luminosityRenderable.update();let $=!1;this.blurRenderable.values.tInput.ref.value!==V&&(i.IQ.update(this.blurRenderable.values.tInput,V),$=!0),$&&this.blurRenderable.update(),i.IQ.update(this.compositeRenderable.values.uBloomRadius,k.radius),i.IQ.update(this.compositeRenderable.values.uBloomStrength,k.strength)}render(V,U){b.g$&&this.webgl.timer.mark("BloomPass.render");const{gl:N,state:k}=this.webgl,{x:H,y:$,width:J,height:W}=V;k.viewport(H,$,J,W),k.scissor(H,$,J,W),k.enable(N.SCISSOR_TEST),k.disable(N.BLEND),k.disable(N.DEPTH_TEST),k.depthMask(!1),this.luminosityTarget.bind(),this.luminosityRenderable.render();for(let te=0;te<5;++te){const de=this.horizontalBlurTargets[te].getWidth(),ye=this.horizontalBlurTargets[te].getHeight();k.viewport(0,0,de,ye),k.scissor(0,0,de,ye),i.IQ.update(this.blurRenderable.values.dKernelRadius,D[te]),i.IQ.update(this.blurRenderable.values.uGaussianCoefficients,S(D[te])),i.IQ.update(this.blurRenderable.values.uTexSizeInv,c.ZY.set(this.blurRenderable.values.uTexSizeInv.ref.value,1/de,1/ye)),this.horizontalBlurTargets[te].bind(),i.IQ.update(this.blurRenderable.values.tInput,0===te?this.luminosityTarget.texture:this.verticalBlurTargets[te-1].texture),i.IQ.update(this.blurRenderable.values.uDirection,R),this.blurRenderable.update(),this.blurRenderable.render(),this.verticalBlurTargets[te].bind(),i.IQ.update(this.blurRenderable.values.tInput,this.horizontalBlurTargets[te].texture),i.IQ.update(this.blurRenderable.values.uDirection,f),this.blurRenderable.update(),this.blurRenderable.render()}k.viewport(H,$,J,W),k.scissor(H,$,J,W),this.compositeTarget.bind(),this.compositeRenderable.update(),this.compositeRenderable.render(),U?U.bind():this.webgl.unbindFramebuffer(),k.enable(N.BLEND),k.blendFunc(N.ONE,N.ONE),this.copyRenderable.render(),b.g$&&this.webgl.timer.markEnd("BloomPass.render")}}const s={...e.du,tColor:(0,r.$G)("texture","rgba","ubyte","linear"),tEmissive:(0,r.$G)("texture","rgba","ubyte","linear"),tDepth:(0,r.$G)("texture","rgba","ubyte","nearest"),uTexSizeInv:(0,r.w5)("v2"),uDefaultColor:(0,r.w5)("v3"),uDefaultOpacity:(0,r.w5)("f"),uLuminosityThreshold:(0,r.w5)("f"),uSmoothWidth:(0,r.w5)("f"),dMode:(0,r.$F)("string",["luminosity","emissive"])},C=(0,t.NG)("Bloom Luminosity",O.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tEmissive;\nuniform sampler2D tDepth;\nuniform vec2 uTexSizeInv;\n\nuniform vec3 uDefaultColor;\nuniform float uDefaultOpacity;\nuniform float uLuminosityThreshold;\nuniform float uSmoothWidth;\n\n#include common\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 texel = texture2D(tColor, coords);\n    float emissive = texture2D(tEmissive, coords).a;\n    float depth = getDepth(coords);\n\n    if (isBackground(depth)) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n    }\n\n    vec4 outputColor = vec4(uDefaultColor.rgb, uDefaultOpacity);\n\n    #if defined(dMode_luminosity)\n        vec3 luma = vec3(0.299, 0.587, 0.114);\n        float v = dot(texel.xyz, luma);\n        float alpha = smoothstep(uLuminosityThreshold, uLuminosityThreshold + uSmoothWidth, v);\n\n        gl_FragColor = mix(outputColor, texel, alpha);\n    #elif defined(dMode_emissive)\n        gl_FragColor = mix(outputColor, texel, emissive);\n    #endif\n}\n"),S=(0,l.E)(function a(G){const V=[];for(let U=0;U<G;++U)V.push(.39894*Math.exp(-.5*U*U/(G*G))/G);return V}),D=[3,5,7,9,11],R=c.ZY.create(1,0),f=c.ZY.create(0,1),p={...e.du,tInput:(0,r.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,r.w5)("v2"),uDirection:(0,r.w5)("v2"),uGaussianCoefficients:(0,r.w5)("f[]"),dKernelRadius:(0,r.$F)("number")},E=(0,t.NG)("Bloom Blur",O.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInput;\nuniform vec2 uTexSizeInv;\n\nuniform vec2 uDirection;\nuniform float uGaussianCoefficients[dKernelRadius];\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    float weightSum = uGaussianCoefficients[0];\n    vec4 diffuseSum = texture2D(tInput, coords) * weightSum;\n\n    for(int i = 1; i < dKernelRadius; ++i) {\n        float x = float(i);\n        float w = uGaussianCoefficients[i];\n        vec2 offset = uDirection * uTexSizeInv * x;\n        vec4 sample1 = texture2D(tInput, coords + offset);\n        vec4 sample2 = texture2D(tInput, coords - offset);\n        diffuseSum += (sample1 + sample2) * w;\n        weightSum += 2.0 * w;\n    }\n\n    gl_FragColor = diffuseSum / weightSum;\n}\n"),L={...e.du,tBlur1:(0,r.$G)("texture","rgba","ubyte","linear"),tBlur2:(0,r.$G)("texture","rgba","ubyte","linear"),tBlur3:(0,r.$G)("texture","rgba","ubyte","linear"),tBlur4:(0,r.$G)("texture","rgba","ubyte","linear"),tBlur5:(0,r.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,r.w5)("v2"),uBloomStrength:(0,r.w5)("f"),uBloomRadius:(0,r.w5)("f"),uBloomFactors:(0,r.w5)("f[]"),uBloomTints:(0,r.w5)("v3[]")},w=(0,t.NG)("Bloom Composite",O.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\n\nuniform sampler2D tBlur1;\nuniform sampler2D tBlur2;\nuniform sampler2D tBlur3;\nuniform sampler2D tBlur4;\nuniform sampler2D tBlur5;\nuniform float uBloomStrength;\nuniform float uBloomRadius;\nuniform float uBloomFactors[5];\nuniform vec3 uBloomTints[5];\n\nfloat lerpBloomFactor(const in float factor) {\n    float mirrorFactor = 1.2 - factor;\n    return mix(factor, mirrorFactor, uBloomRadius);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n\n    gl_FragColor = uBloomStrength * (\n        lerpBloomFactor(uBloomFactors[0]) * vec4(uBloomTints[0], 1.0) * texture2D(tBlur1, coords) +\n        lerpBloomFactor(uBloomFactors[1]) * vec4(uBloomTints[1], 1.0) * texture2D(tBlur2, coords) +\n        lerpBloomFactor(uBloomFactors[2]) * vec4(uBloomTints[2], 1.0) * texture2D(tBlur3, coords) +\n        lerpBloomFactor(uBloomFactors[3]) * vec4(uBloomTints[3], 1.0) * texture2D(tBlur4, coords) +\n        lerpBloomFactor(uBloomFactors[4]) * vec4(uBloomTints[4], 1.0) * texture2D(tBlur5, coords)\n    );\n}\n")},6049:(tn,Ue,n)=>{"use strict";n.d(Ue,{w:()=>M,z:()=>I});var e=n(9007),o=n(9421),r=n(4511),t=n(2897),A=n(4143),y=n(4648),c=n(4369),i=n(9909),v=n(8277),O=n(9387),_=n(2629);const M={blurSize:v.t.Numeric(9,{min:1,max:32,step:1}),blurSpread:v.t.Numeric(1,{min:0,max:10,step:.1}),inFocus:v.t.Numeric(0,{min:-5e3,max:5e3,step:1},{description:"Distance from the scene center that will be in focus"}),PPM:v.t.Numeric(20,{min:0,max:5e3,step:.1},{description:"Size of the area that will be in focus"}),center:v.t.Select("camera-target",v.t.arrayToOptions(["scene-center","camera-target"])),mode:v.t.Select("plane",v.t.arrayToOptions(["plane","sphere"]))};class I{static isEnabled(s){return"off"!==s.dof.name}constructor(s,C,h){this.webgl=s,this.target=s.createRenderTarget(C,h,!1);const a=(0,y.z6)();this.renderable=function u(d,s,C,h){const a=s.getWidth(),S=s.getHeight(),D={...e.OM,tDepthOpaque:i.IQ.create(C),tDepthTransparent:i.IQ.create(h),tColor:i.IQ.create(s),uTexSize:i.IQ.create(c.ZY.create(a,S)),uProjection:i.IQ.create(c.$I.identity()),uInvProjection:i.IQ.create(c.$I.identity()),uBounds:i.IQ.create((0,c.Zb)()),uCenter:i.IQ.create((0,c.eB)()),uMode:i.IQ.create(0),dOrthographic:i.IQ.create(0),uNear:i.IQ.create(1),uFar:i.IQ.create(1e4),dBlurSize:i.IQ.create(5),uBlurSpread:i.IQ.create(300),uInFocus:i.IQ.create(20),uPPM:i.IQ.create(20)},R={...l},f=(0,A.$h)(d,"triangles",m,R,D);return(0,o._)(f,D)}(s,a,a,a)}updateState(s){const{gl:C,state:h}=this.webgl;h.enable(C.SCISSOR_TEST),h.disable(C.BLEND),h.disable(C.DEPTH_TEST),h.depthMask(!1);const{x:a,y:S,width:D,height:R}=s;h.viewport(a,S,D,R),h.scissor(a,S,D,R),h.clearColor(0,0,0,1),C.clear(C.COLOR_BUFFER_BIT)}setSize(s,C){const h=this.target.texture.getWidth(),a=this.target.texture.getHeight();(s!==h||C!==a)&&(this.target.setSize(s,C),i.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,s,C)))}update(s,C,h,a,S,D){let R=!1;this.renderable.values.tColor.ref.value!==C&&(i.IQ.update(this.renderable.values.tColor,C),R=!0),this.renderable.values.tDepthOpaque.ref.value!==h&&(i.IQ.update(this.renderable.values.tDepthOpaque,h),R=!0),this.renderable.values.tDepthTransparent.ref.value!==a&&(i.IQ.update(this.renderable.values.tDepthTransparent,a),R=!0);const f="orthographic"===s.state.mode?1:0,p=this.renderable.values.uInvProjection.ref.value;c.$I.invert(p,s.projection);const[E,T]=this.renderable.values.uTexSize.ref.value,L=s.viewport;i.IQ.update(this.renderable.values.uProjection,s.projection),i.IQ.update(this.renderable.values.uInvProjection,p),i.IQ.update(this.renderable.values.uMode,"sphere"===S.mode?1:0),c.Zb.set(this.renderable.values.uBounds.ref.value,L.x/E,L.y/T,(L.x+L.width)/E,(L.y+L.height)/T),i.IQ.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),i.IQ.updateIfChanged(this.renderable.values.uNear,s.near),i.IQ.updateIfChanged(this.renderable.values.uFar,s.far),i.IQ.updateIfChanged(this.renderable.values.dOrthographic,f),this.renderable.values.dBlurSize.ref.value!==S.blurSize&&(i.IQ.update(this.renderable.values.dBlurSize,S.blurSize),R=!0);const w="scene-center"===S.center?D.center:s.state.target,G=c.eB.distance(s.state.position,w)+S.inFocus;i.IQ.updateIfChanged(this.renderable.values.uInFocus,G);const V=this.renderable.values.uCenter.ref.value;c.eB.transformMat4(V,w,s.view),i.IQ.update(this.renderable.values.uCenter,V),i.IQ.updateIfChanged(this.renderable.values.uBlurSpread,S.blurSpread),i.IQ.updateIfChanged(this.renderable.values.uPPM,S.PPM),R&&this.renderable.update()}render(s,C){_.g$&&this.webgl.timer.mark("DofPass.render"),C?C.bind():this.webgl.unbindFramebuffer(),this.updateState(s),this.renderable.render(),_.g$&&this.webgl.timer.markEnd("DofPass.render")}}const l={...e.du,tDepthOpaque:(0,r.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,r.$G)("texture","rgba","ubyte","nearest"),tColor:(0,r.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,r.w5)("v2"),uProjection:(0,r.w5)("m4"),uInvProjection:(0,r.w5)("m4"),uBounds:(0,r.w5)("v4"),uCenter:(0,r.w5)("v3"),uMode:(0,r.w5)("i"),dOrthographic:(0,r.$F)("number"),uNear:(0,r.w5)("f"),uFar:(0,r.w5)("f"),dBlurSize:(0,r.$F)("number"),uBlurSpread:(0,r.w5)("f"),uInFocus:(0,r.w5)("f"),uPPM:(0,r.w5)("f")},m=(0,t.NG)("dof",O.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\n\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uBlurSpread;\nuniform float uInFocus;\nuniform float uPPM;\n\nuniform float uNear; // Near plane\nuniform float uFar;  // Far plane\n\nuniform mat4 uInvProjection; // Inverse projection\nuniform mat4 uProjection; // projection\n\nuniform int uMode; // 0-planar, 1-spherical\nuniform vec3 uCenter; // Center of focus sphere in view space\n\n// Function to convert depth value from depth buffer to view space Z\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\n// Retrieve depth from opaque depth texture\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\n// Retrieve depth from transparent depth texture\nfloat getDepthTransparent(const in vec2 coords) {\n    return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords) {\n    return min(getDepthOpaque(coords), getDepthTransparent(coords));\n}\n\nfloat getCOC(vec2 uv) {\n    float depth = getDepth(uv);\n    float viewDist = getViewZ(depth);\n    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);\n    float focusDist = length(aposition - uCenter);\n    float coc = 0.0;  // Circle of Confusion\n    if (uMode == 0) { // planar Depth of field\n        coc = (abs(viewDist) - uInFocus) / uPPM;  //focus distance, focus range\n    } else if(uMode == 1) { // spherical Depth of field\n        coc = focusDist / uPPM ;\n    }\n    coc = clamp(coc, -1.0, 1.0);\n    return coc;\n}\n\n// Simple box blur for blurring the image\nvec3 getBlurredImage(vec2 coords) {\n    vec4 blurColor = vec4(0);\n    vec2 texelSize = vec2(1.0 / uTexSize.x, 1.0 / uTexSize.y);\n    float count = 0.0;\n    for (int x = 0; x < int(dBlurSize); x++) {\n        for (int y = 0; y < int(dBlurSize); y++) {\n            vec2 offset = vec2(float(x) - float(dBlurSize) / 2.0, float(y) - float(dBlurSize) / 2.0);\n            vec2 uvPixel = coords.xy + offset * texelSize * uBlurSpread;\n            float coc = getCOC(uvPixel);\n            coc = smoothstep(0.0, 1.0, abs(coc));\n            // mix blurColor with new color with weight coc\n            blurColor.rgb = blurColor.rgb + texture2D(tColor, uvPixel).xyz * coc;\n            count+=coc;\n        }\n    }\n    blurColor = blurColor / count;\n    return blurColor.rgb;\n}\n\n// simplification from https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, uv);\n    float depth = getDepth(uv);\n\n    float viewDist = getViewZ(depth);\n\n    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);\n    float focusDist = length(aposition - uCenter);\n    vec3 blurColor = getBlurredImage(uv);\n\n    float coc = getCOC(uv); // Circle of Confusion\n\n    // for debugging the coc\n    // color.rgb = (coc < 0.0) ? (1.0 - abs(coc)) * vec3(1.0,0.0,0.0) : vec3(0.0, 1.0 - coc, 0.0) ;//mix(color.rgb, blurColor.rgb, abs(coc));\n    color.rgb = mix(color.rgb, blurColor, smoothstep(0.0, 1.0, abs(coc))); // Smooth blending based on CoC\n    gl_FragColor = color;\n}\n")},3099:(tn,Ue,n)=>{"use strict";n.d(Ue,{SK:()=>Dn,co:()=>Mt,Pv:()=>bn});var e=n(9007),o=n(4511),r=n(2897),t=n(9909),A=n(4143),y=n(9421),c=n(4369),i=n(8277),v=n(9387),I=n(190),m=n(2629);const u={edgeThresholdMin:i.t.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:i.t.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:i.t.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:i.t.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})};class d{constructor(It,Dt){this.webgl=It,this.renderable=function h(jt,It){const Dt=It.getWidth(),Ct=It.getHeight(),$t={...e.OM,tColor:t.IQ.create(It),uTexSizeInv:t.IQ.create(c.ZY.create(1/Dt,1/Ct)),dEdgeThresholdMin:t.IQ.create(.0312),dEdgeThresholdMax:t.IQ.create(.125),dIterations:t.IQ.create(12),dSubpixelQuality:t.IQ.create(.3)},Vt={...s},Wt=(0,A.$h)(jt,"triangles",C,Vt,$t);return(0,y._)(Wt,$t)}(It,Dt)}updateState(It){const{gl:Dt,state:Ct}=this.webgl;Ct.enable(Dt.SCISSOR_TEST),Ct.disable(Dt.BLEND),Ct.disable(Dt.DEPTH_TEST),Ct.depthMask(!1);const{x:$t,y:Vt,width:Wt,height:yn}=It;Ct.viewport($t,Vt,Wt,yn),Ct.scissor($t,Vt,Wt,yn),Ct.clearColor(0,0,0,1),Dt.clear(Dt.COLOR_BUFFER_BIT)}setSize(It,Dt){t.IQ.update(this.renderable.values.uTexSizeInv,c.ZY.set(this.renderable.values.uTexSizeInv.ref.value,1/It,1/Dt))}update(It,Dt){const{values:Ct}=this.renderable,{edgeThresholdMin:$t,edgeThresholdMax:Vt,iterations:Wt,subpixelQuality:yn}=Dt;let Zt=!1;Ct.tColor.ref.value!==It&&(t.IQ.update(this.renderable.values.tColor,It),Zt=!0),Ct.dEdgeThresholdMin.ref.value!==$t&&(Zt=!0),t.IQ.updateIfChanged(Ct.dEdgeThresholdMin,$t),Ct.dEdgeThresholdMax.ref.value!==Vt&&(Zt=!0),t.IQ.updateIfChanged(Ct.dEdgeThresholdMax,Vt),Ct.dIterations.ref.value!==Wt&&(Zt=!0),t.IQ.updateIfChanged(Ct.dIterations,Wt),Ct.dSubpixelQuality.ref.value!==yn&&(Zt=!0),t.IQ.updateIfChanged(Ct.dSubpixelQuality,yn),Zt&&this.renderable.update()}render(It,Dt){m.g$&&this.webgl.timer.mark("FxaaPass.render"),Dt?Dt.bind():this.webgl.unbindFramebuffer(),this.updateState(It),this.renderable.render(),m.g$&&this.webgl.timer.markEnd("FxaaPass.render")}}const s={...e.du,tColor:(0,o.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,o.w5)("v2"),dEdgeThresholdMin:(0,o.$F)("number"),dEdgeThresholdMax:(0,o.$F)("number"),dIterations:(0,o.$F)("number"),dSubpixelQuality:(0,o.$F)("number")},C=(0,r.NG)("fxaa",v.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\n// adapted from https://github.com/kosua20/Rendu\n// MIT License Copyright (c) 2017 Simon Rodriguez\n\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n\nfloat rgb2luma(vec3 rgb){\n    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));\n}\n\nfloat sampleLuma(vec2 uv) {\n    return rgb2luma(texture2D(tColor, uv).rgb);\n}\n\nfloat sampleLuma(vec2 uv, float uOffset, float vOffset) {\n    uv += uTexSizeInv * vec2(uOffset, vOffset);\n    return sampleLuma(uv);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec2 inverseScreenSize = uTexSizeInv;\n\n    vec4 colorCenter = texture2D(tColor, coords);\n\n    // Luma at the current fragment\n    float lumaCenter = rgb2luma(colorCenter.rgb);\n\n    // Luma at the four direct neighbours of the current fragment.\n    float lumaDown = sampleLuma(coords, 0.0, -1.0);\n    float lumaUp = sampleLuma(coords, 0.0, 1.0);\n    float lumaLeft = sampleLuma(coords, -1.0, 0.0);\n    float lumaRight = sampleLuma(coords, 1.0, 0.0);\n\n    // Find the maximum and minimum luma around the current fragment.\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\n\n    // Compute the delta.\n    float lumaRange = lumaMax - lumaMin;\n\n    // If the luma variation is lower that a threshold (or if we are in a really dark area),\n    // we are not on an edge, don't perform any AA.\n    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {\n        gl_FragColor = colorCenter;\n        return;\n    }\n\n    // Query the 4 remaining corners lumas.\n    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);\n    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);\n    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);\n    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);\n\n    // Combine the four edges lumas (using intermediary variables for future computations\n    // with the same values).\n    float lumaDownUp = lumaDown + lumaUp;\n    float lumaLeftRight = lumaLeft + lumaRight;\n\n    // Same for corners\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\n\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\n\n    // Is the local edge horizontal or vertical ?\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\n\n    // Choose the step size (one pixel) accordingly.\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\n\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\n    // Compute gradients in this direction.\n    float gradient1 = luma1 - lumaCenter;\n    float gradient2 = luma2 - lumaCenter;\n\n    // Which direction is the steepest ?\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\n\n    // Gradient in the corresponding direction, normalized.\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\n\n    // Average luma in the correct direction.\n    float lumaLocalAverage = 0.0;\n    if(is1Steepest){\n        // Switch the direction\n        stepLength = -stepLength;\n        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\n    } else {\n        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\n    }\n\n    // Shift UV in the correct direction by half a pixel.\n    vec2 currentUv = coords;\n    if(isHorizontal){\n        currentUv.y += stepLength * 0.5;\n    } else {\n        currentUv.x += stepLength * 0.5;\n    }\n\n    // Compute offset (for each iteration step) in the right direction.\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\n    // Compute UVs to explore on each side of the edge, orthogonally.\n    // The QUALITY allows us to step faster.\n    vec2 uv1 = currentUv - offset * QUALITY(0);\n    vec2 uv2 = currentUv + offset * QUALITY(0);\n\n    // Read the lumas at both current extremities of the exploration segment,\n    // and compute the delta wrt to the local average luma.\n    float lumaEnd1 = sampleLuma(uv1);\n    float lumaEnd2 = sampleLuma(uv2);\n    lumaEnd1 -= lumaLocalAverage;\n    lumaEnd2 -= lumaLocalAverage;\n\n    // If the luma deltas at the current extremities is larger than the local gradient,\n    // we have reached the side of the edge.\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\n    bool reachedBoth = reached1 && reached2;\n\n    // If the side is not reached, we continue to explore in this direction.\n    if(!reached1){\n        uv1 -= offset * QUALITY(1);\n    }\n    if(!reached2){\n        uv2 += offset * QUALITY(1);\n    }\n\n    // If both sides have not been reached, continue to explore.\n    if(!reachedBoth){\n        for(int i = 2; i < dIterations; i++){\n            // If needed, read luma in 1st direction, compute delta.\n            if(!reached1){\n                lumaEnd1 = sampleLuma(uv1);\n                lumaEnd1 = lumaEnd1 - lumaLocalAverage;\n            }\n            // If needed, read luma in opposite direction, compute delta.\n            if(!reached2){\n                lumaEnd2 = sampleLuma(uv2);\n                lumaEnd2 = lumaEnd2 - lumaLocalAverage;\n            }\n            // If the luma deltas at the current extremities is larger than the local gradient,\n            // we have reached the side of the edge.\n            reached1 = abs(lumaEnd1) >= gradientScaled;\n            reached2 = abs(lumaEnd2) >= gradientScaled;\n            reachedBoth = reached1 && reached2;\n\n            // If the side is not reached, we continue to explore in this direction,\n            // with a variable quality.\n            if(!reached1){\n                uv1 -= offset * QUALITY(i);\n            }\n            if(!reached2){\n                uv2 += offset * QUALITY(i);\n            }\n\n            // If both sides have been reached, stop the exploration.\n            if(reachedBoth){\n                break;\n            }\n        }\n    }\n\n    // Compute the distances to each side edge of the edge (!).\n    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);\n    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);\n\n    // In which direction is the side of the edge closer ?\n    bool isDirection1 = distance1 < distance2;\n    float distanceFinal = min(distance1, distance2);\n\n    // Thickness of the edge.\n    float edgeThickness = (distance1 + distance2);\n\n    // Is the luma at center smaller than the local average ?\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\n\n    // If the luma at center is smaller than at its neighbour,\n    // the delta luma at each end should be positive (same variation).\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\n\n    // Only keep the result in the direction of the closer side of the edge.\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\n\n    // UV offset: read in the direction of the closest side of the edge.\n    float pixelOffset = - distanceFinal / edgeThickness + 0.5;\n\n    // If the luma variation is incorrect, do not offset.\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\n\n    // Sub-pixel shifting\n    // Full weighted average of the luma over the 3x3 neighborhood.\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\n    // Ratio of the delta between the global average and the center luma,\n    // over the luma range in the 3x3 neighborhood.\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\n    // Compute a sub-pixel offset based on this delta.\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);\n\n    // Pick the biggest of the two offsets.\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\n\n    // Compute the final UV coordinates.\n    vec2 finalUv = coords;\n    if(isHorizontal){\n        finalUv.y += finalOffset * stepLength;\n    } else {\n        finalUv.x += finalOffset * stepLength;\n    }\n\n    // Read the color at the new UV coordinates, and use it.\n    gl_FragColor = texture2D(tColor, finalUv);\n}\n");var a=n(4648),T=n(7361);const L={edgeThreshold:i.t.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:i.t.Numeric(16,{min:0,max:32,step:1})};class w{get supported(){return this._supported}constructor(It,Dt){if(this.webgl=It,this._supported=!1,typeof HTMLImageElement>"u")return void(m.Bb&&console.log('Missing "HTMLImageElement" required for "SMAA"'));const Ct=Dt.getWidth(),$t=Dt.getHeight();this.edgesTarget=It.createRenderTarget(Ct,$t,!1,"uint8","linear"),this.weightsTarget=It.createRenderTarget(Ct,$t,!1,"uint8","linear"),this.edgesRenderable=function V(jt,It){const Dt=It.getWidth(),Ct=It.getHeight(),$t={...e.OM,tColor:t.IQ.create(It),uTexSizeInv:t.IQ.create(c.ZY.create(1/Dt,1/Ct)),uViewport:t.IQ.create((0,c.Zb)()),dEdgeThreshold:t.IQ.create(.1)},Vt={...Q},Wt=(0,A.$h)(jt,"triangles",G,Vt,$t);return(0,y._)(Wt,$t)}(It,Dt),this.weightsRenderable=function k(jt,It){const Dt=It.getWidth(),Ct=It.getHeight(),$t=jt.resources.texture("image-uint8","rgb","ubyte","linear"),Vt=jt.resources.texture("image-uint8","rgba","ubyte","nearest"),Wt={...e.OM,tEdges:t.IQ.create(It),tArea:t.IQ.create($t),tSearch:t.IQ.create(Vt),uTexSizeInv:t.IQ.create(c.ZY.create(1/Dt,1/Ct)),uViewport:t.IQ.create((0,c.Zb)()),dMaxSearchSteps:t.IQ.create(16)};(0,a.pg)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=",Wt.tArea,$t),(0,a.pg)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=",Wt.tSearch,Vt);const yn={...U},Zt=(0,A.$h)(jt,"triangles",N,yn,Wt);return(0,y._)(Zt,Wt)}(It,this.edgesTarget.texture),this.blendRenderable=function J(jt,It,Dt){const Ct=It.getWidth(),$t=It.getHeight(),Vt={...e.OM,tColor:t.IQ.create(It),tWeights:t.IQ.create(Dt),uTexSizeInv:t.IQ.create(c.ZY.create(1/Ct,1/$t)),uViewport:t.IQ.create((0,c.Zb)())},Wt={...H},yn=(0,A.$h)(jt,"triangles",$,Wt,Vt);return(0,y._)(yn,Vt)}(It,Dt,this.weightsTarget.texture),this._supported=!0}updateState(It){const{gl:Dt,state:Ct}=this.webgl;Ct.enable(Dt.SCISSOR_TEST),Ct.disable(Dt.BLEND),Ct.disable(Dt.DEPTH_TEST),Ct.depthMask(!1);const{x:$t,y:Vt,width:Wt,height:yn}=It;Ct.viewport($t,Vt,Wt,yn),Ct.scissor($t,Vt,Wt,yn),Ct.colorMask(!0,!0,!0,!0),Ct.clearColor(0,0,0,1),Dt.clear(Dt.COLOR_BUFFER_BIT),t.IQ.update(this.edgesRenderable.values.uViewport,T.LM.toVec4(this.edgesRenderable.values.uViewport.ref.value,It)),t.IQ.update(this.weightsRenderable.values.uViewport,T.LM.toVec4(this.weightsRenderable.values.uViewport.ref.value,It)),t.IQ.update(this.blendRenderable.values.uViewport,T.LM.toVec4(this.blendRenderable.values.uViewport.ref.value,It))}setSize(It,Dt){const Ct=this.edgesTarget.getWidth(),$t=this.edgesTarget.getHeight();(It!==Ct||Dt!==$t)&&(this.edgesTarget.setSize(It,Dt),this.weightsTarget.setSize(It,Dt),t.IQ.update(this.edgesRenderable.values.uTexSizeInv,c.ZY.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/It,1/Dt)),t.IQ.update(this.weightsRenderable.values.uTexSizeInv,c.ZY.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/It,1/Dt)),t.IQ.update(this.blendRenderable.values.uTexSizeInv,c.ZY.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/It,1/Dt)))}update(It,Dt){let Ct=!1;this.edgesRenderable.values.tColor.ref.value!==It&&(t.IQ.update(this.edgesRenderable.values.tColor,It),Ct=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==Dt.edgeThreshold&&(t.IQ.update(this.edgesRenderable.values.dEdgeThreshold,Dt.edgeThreshold),Ct=!0),Ct&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==Dt.maxSearchSteps&&(t.IQ.update(this.weightsRenderable.values.dMaxSearchSteps,Dt.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==It&&(t.IQ.update(this.blendRenderable.values.tColor,It),this.blendRenderable.update())}render(It,Dt){m.g$&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(It),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(It),this.weightsRenderable.render(),Dt?Dt.bind():this.webgl.unbindFramebuffer(),this.updateState(It),this.blendRenderable.render(),m.g$&&this.webgl.timer.markEnd("SmaaPass.render")}}const Q={...e.du,tColor:(0,o.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,o.w5)("v2"),uViewport:(0,o.w5)("v4"),dEdgeThreshold:(0,o.$F)("number")},G=(0,r.NG)("smaa-edges","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvoid SMAAEdgeDetectionVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAAEdgeDetectionVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {\n    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);\n\n    // Calculate color deltas:\n    vec4 delta;\n    vec3 C = texture2D(colorTex, texcoord).rgb;\n\n    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;\n    vec3 t = abs(C - Cleft);\n    delta.x = max(max(t.r, t.g), t.b);\n\n    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;\n    t = abs(C - Ctop);\n    delta.y = max(max(t.r, t.g), t.b);\n\n    // We do the usual threshold:\n    vec2 edges = step(threshold, delta.xy);\n\n    // Then discard if there is no edge:\n    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)\n        discard;\n\n    // Calculate right and bottom deltas:\n    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;\n    t = abs( C - Cright );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;\n    t = abs(C - Cbottom);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the maximum delta in the direct neighborhood:\n    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );\n\n    // Calculate left-left and top-top deltas:\n    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;\n    t = abs( C - Cleftleft );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;\n    t = abs(C - Ctoptop);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the final maximum delta:\n    maxDelta = max(max(maxDelta, delta.z), delta.w);\n\n    // Local contrast adaptation in action:\n    edges.xy *= step(0.5 * maxDelta, delta.xy);\n\n    return vec4(edges, 0.0, 0.0);\n}\n\nvoid main() {\n    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);\n}\n"),U={...e.du,tEdges:(0,o.$G)("texture","rgba","ubyte","linear"),tArea:(0,o.$G)("texture","rgb","ubyte","linear"),tSearch:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSizeInv:(0,o.w5)("v2"),uViewport:(0,o.w5)("v4"),dMaxSearchSteps:(0,o.$F)("number")},N=(0,r.NG)("smaa-weights","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\nvoid SMAABlendingWeightCalculationVS(vec2 texCoord) {\n    vPixCoord = texCoord / uTexSizeInv;\n\n    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components\n\n    // And these for the searches, they indicate the ends of the loops:\n    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAABlendingWeightCalculationVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)\n\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))\n#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)\n\nuniform sampler2D tEdges;\nuniform sampler2D tArea;\nuniform sampler2D tSearch;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\n#if __VERSION__ == 100\n    vec2 round(vec2 x) {\n        return sign(x) * floor(abs(x) + 0.5);\n    }\n#endif\n\nfloat SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {\n    // Not required if searchTex accesses are set to point:\n    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n    e.r = bias + e.r * scale;\n    return 255.0 * texture2D(searchTex, e, 0.0).r;\n}\n\nfloat SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    /**\n     * @PSEUDO_GATHER4\n     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to\n     * sample between edge, thus fetching four edges in a row.\n     * Sampling with different offsets in each direction allows to disambiguate\n     * which edges are active from the four fetched ones.\n     */\n    vec2 e = vec2(0.0, 1.0);\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D( edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    // We correct the previous (-0.25, -0.125) offset we applied:\n    texCoord.x += 0.25 * uTexSizeInv.x;\n\n    // The searches are bias by 1, so adjust the coords accordingly:\n    texCoord.x += uTexSizeInv.x;\n\n    // Disambiguate the length added by the last step:\n    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step\n    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n    return texCoord.x;\n}\n\nfloat SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 0.0, 1.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    texCoord.x -= 0.25 * uTexSizeInv.x;\n    texCoord.x -= uTexSizeInv.x;\n    texCoord.x -= 2.0 * uTexSizeInv.x;\n    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n    return texCoord.x;\n}\n\nfloat SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nfloat SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nvec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {\n    // Rounding prevents precision errors of bilinear filtering:\n    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;\n\n    // We do a scale and bias for mapping to texel space:\n    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);\n\n    // Move to proper place, according to the subpixel offset:\n    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n    return texture2D(areaTex, texCoord, 0.0).rg;\n}\n\nvec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {\n    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 e = texture2D(edgesTex, texCoord).rg;\n\n    if (e.g > 0.0) { // Edge at north\n        vec2 d;\n\n        // Find the distance to the left:\n        vec2 coords;\n        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );\n        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)\n        d.x = coords.x;\n\n        // Now fetch the left crossing edges, two at a time using bilinear\n        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n        // discern what value each edge has:\n        float e1 = texture2D(edgesTex, coords, 0.0).r;\n\n        // Find the distance to the right:\n        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);\n        d.y = coords.x;\n\n        // We want the distances to be in pixel units (doing this here allow to\n        // better interleave arithmetic and memory accesses):\n        d = d / uTexSizeInv.x - pixCoord.x;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the right crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;\n\n        // Ok, we know how this pattern looks like, now it is time for getting\n        // the actual area:\n        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));\n    }\n\n    if (e.r > 0.0) { // Edge at west\n        vec2 d;\n\n        // Find the distance to the top:\n        vec2 coords;\n\n        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );\n        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;\n        d.x = coords.y;\n\n        // Fetch the top crossing edges:\n        float e1 = texture2D(edgesTex, coords, 0.0).g;\n\n        // Find the distance to the bottom:\n        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);\n        d.y = coords.y;\n\n        // We want the distances to be in pixel units:\n        d = d / uTexSizeInv.y - pixCoord.y;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the bottom crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;\n\n        // Get the area for this direction:\n        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));\n    }\n\n    return weights;\n}\n\nvoid main() {\n    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));\n}\n"),H={...e.du,tColor:(0,o.$G)("texture","rgba","ubyte","linear"),tWeights:(0,o.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,o.w5)("v2"),uViewport:(0,o.w5)("v4")},$=(0,r.NG)("smaa-blend","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvoid SMAANeighborhoodBlendingVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAANeighborhoodBlendingVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tWeights;\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {\n    // Fetch the blending weights for current pixel:\n    vec4 a;\n    a.xz = texture2D(blendTex, texCoord).xz;\n    a.y = texture2D(blendTex, offset[1].zw).g;\n    a.w = texture2D(blendTex, offset[1].xy).a;\n\n    // Is there any blending weight with a value greater than 0.0?\n    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {\n        return texture2D(colorTex, texCoord, 0.0);\n    } else {\n        // Up to 4 lines can be crossing a pixel (one through each edge). We\n        // favor blending by choosing the line with the maximum weight for each\n        // direction:\n        vec2 offset;\n        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n        // Then we go in the direction that has the maximum weight:\n        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical\n            offset.y = 0.0;\n        } else {\n            offset.x = 0.0;\n        }\n\n        // Fetch the opposite color and lerp by hand:\n        vec4 C = texture2D(colorTex, texCoord, 0.0);\n        texCoord += sign(offset) * uTexSizeInv;\n        vec4 Cop = texture2D(colorTex, texCoord, 0.0);\n        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);\n\n        // WebGL port note: Added gamma correction\n        C.xyz = pow(C.xyz, vec3(2.2));\n        Cop.xyz = pow(Cop.xyz, vec3(2.2));\n        vec4 mixed = mix(C, Cop, s);\n        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n        return mixed;\n    }\n}\n\nvoid main() {\n    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);\n}\n");var j=n(6639),Z=n(7187),q=n(5276),Y=n(2086),ee=n(325),g=n(1861),_e=n(8599),xe=n(4490),le=n(7630),Ae=n(1372),Be=n(127);function Ce(){return Ce.zero()}!function(jt){function It(){const On=[.1,0,0];return On[0]=0,On}function Ct(On,fr,Dr,Pr){return On[0]=fr,On[0]=Dr,On[0]=Pr,On}function Wt(On,fr,Dr){const Pr=fr[0],or=fr[4],Nr=fr[8],Ir=fr[1],Or=fr[5],Jr=fr[9],To=fr[2],un=fr[6],ct=fr[10];switch(Dr){case"XYZ":On[1]=Math.asin((0,Be.qE)(Nr,-1,1)),Math.abs(Nr)<.9999999?(On[0]=Math.atan2(-Jr,ct),On[2]=Math.atan2(-or,Pr)):(On[0]=Math.atan2(un,Or),On[2]=0);break;case"YXZ":On[0]=Math.asin(-(0,Be.qE)(Jr,-1,1)),Math.abs(Jr)<.9999999?(On[1]=Math.atan2(Nr,ct),On[2]=Math.atan2(Ir,Or)):(On[1]=Math.atan2(-To,Pr),On[2]=0);break;case"ZXY":On[0]=Math.asin((0,Be.qE)(un,-1,1)),Math.abs(un)<.9999999?(On[1]=Math.atan2(-To,ct),On[2]=Math.atan2(-or,Or)):(On[1]=0,On[2]=Math.atan2(Ir,Pr));break;case"ZYX":On[1]=Math.asin(-(0,Be.qE)(To,-1,1)),Math.abs(To)<.9999999?(On[0]=Math.atan2(un,ct),On[2]=Math.atan2(Ir,Pr)):(On[0]=0,On[2]=Math.atan2(-or,Or));break;case"YZX":On[2]=Math.asin((0,Be.qE)(Ir,-1,1)),Math.abs(Ir)<.9999999?(On[0]=Math.atan2(-Jr,Or),On[1]=Math.atan2(-To,Pr)):(On[0]=0,On[1]=Math.atan2(Nr,ct));break;case"XZY":On[2]=Math.asin(-(0,Be.qE)(or,-1,1)),Math.abs(or)<.9999999?(On[0]=Math.atan2(un,Or),On[1]=Math.atan2(Nr,Pr)):(On[0]=Math.atan2(-Jr,ct),On[1]=0);break;default:(0,Ae.dr)(Dr)}return On}jt.zero=It,jt.create=function Dt(On,fr,Dr){const Pr=It();return Pr[0]=On,Pr[1]=fr,Pr[2]=Dr,Pr},jt.set=Ct,jt.clone=function $t(On){const fr=It();return fr[0]=On[0],fr[1]=On[1],fr[2]=On[2],fr},jt.copy=function Vt(On,fr){return On[0]=fr[0],On[1]=fr[1],On[2]=fr[2],On},jt.fromMat4=Wt;const yn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];jt.fromQuat=function Zt(On,fr,Dr){return j.$.fromQuat(yn,fr),Wt(On,yn,Dr)},jt.fromVec3=function kt(On,fr){return Ct(On,fr[0],fr[1],fr[2])},jt.exactEquals=function Ot(On,fr){return On[0]===fr[0]&&On[1]===fr[1]&&On[2]===fr[2]},jt.fromArray=function An(On,fr,Dr){return On[0]=fr[Dr+0],On[1]=fr[Dr+1],On[2]=fr[Dr+2],On},jt.toArray=function jn(On,fr,Dr){return fr[Dr+0]=On[0],fr[Dr+1]=On[1],fr[Dr+2]=On[2],fr}}(Ce||(Ce={}));const Re={opacity:i.t.Numeric(1,{min:0,max:1,step:.01}),saturation:i.t.Numeric(0,{min:-1,max:1,step:.01}),lightness:i.t.Numeric(0,{min:-1,max:1,step:.01})},ke={faces:i.t.MappedStatic("urls",{urls:i.t.Group({nx:i.t.Text("",{label:"Negative X / Left"}),ny:i.t.Text("",{label:"Negative Y / Bottom"}),nz:i.t.Text("",{label:"Negative Z / Back"}),px:i.t.Text("",{label:"Positive X / Right"}),py:i.t.Text("",{label:"Positive Y / Top"}),pz:i.t.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:i.t.Group({nx:i.t.File({label:"Negative X / Left",accept:"image/*"}),ny:i.t.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:i.t.File({label:"Negative Z / Back",accept:"image/*"}),px:i.t.File({label:"Positive X / Right",accept:"image/*"}),py:i.t.File({label:"Positive Y / Top",accept:"image/*"}),pz:i.t.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:i.t.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'}),rotation:i.t.Group({x:i.t.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),y:i.t.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),z:i.t.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0})}),...Re},we={source:i.t.MappedStatic("url",{url:i.t.Text(""),file:i.t.File({accept:"image/*"})}),blur:i.t.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'}),...Re,coverage:i.t.Select("viewport",i.t.arrayToOptions(["viewport","canvas"]))},Oe={topColor:i.t.Color((0,I.Q1)(14540253)),bottomColor:i.t.Color((0,I.Q1)(15658734)),ratio:i.t.Numeric(.5,{min:0,max:1,step:.01}),coverage:i.t.Select("viewport",i.t.arrayToOptions(["viewport","canvas"]))},Se={centerColor:i.t.Color((0,I.Q1)(14540253)),edgeColor:i.t.Color((0,I.Q1)(15658734)),ratio:i.t.Numeric(.5,{min:0,max:1,step:.01}),coverage:i.t.Select("viewport",i.t.arrayToOptions(["viewport","canvas"]))},Ve={variant:i.t.MappedStatic("off",{off:i.t.EmptyGroup(),skybox:i.t.Group(ke,{isExpanded:!0}),image:i.t.Group(we,{isExpanded:!0}),horizontalGradient:i.t.Group(Oe,{isExpanded:!0}),radialGradient:i.t.Group(Se,{isExpanded:!0})},{label:"Environment"})};class Ne{constructor(It,Dt,Ct,$t){this.webgl=It,this.assetManager=Dt,this.camera=new q.i,this.target=(0,Y.e)(),this.position=(0,Y.e)(),this.dir=(0,Y.e)(),this.renderable=function Ie(jt,It,Dt){const Ct={drawCount:Z.IQ.create(6),instanceCount:Z.IQ.create(1),aPosition:Z.IQ.create(e.Wp),tSkybox:Z.IQ.create((0,a.z6)()),tImage:Z.IQ.create((0,a.z6)()),uImageScale:Z.IQ.create((0,ee.Z)()),uImageOffset:Z.IQ.create((0,ee.Z)()),uTexSize:Z.IQ.create(ee.Z.create(It,Dt)),uViewport:Z.IQ.create((0,_e.Z)()),uViewportAdjusted:Z.IQ.create(!0),uViewDirectionProjectionInverse:Z.IQ.create((0,j.$)()),uGradientColorA:Z.IQ.create((0,Y.e)()),uGradientColorB:Z.IQ.create((0,Y.e)()),uGradientRatio:Z.IQ.create(.5),uBlur:Z.IQ.create(0),uOpacity:Z.IQ.create(1),uSaturation:Z.IQ.create(0),uLightness:Z.IQ.create(0),uRotation:Z.IQ.create(le.U.identity()),dVariant:Z.IQ.create("skybox")},$t={...ae},Vt=(0,A.$h)(jt,"triangles",ge,$t,Ct);return(0,y._)(Vt,Ct)}(It,Ct,$t)}setSize(It,Dt){const[Ct,$t]=this.renderable.values.uTexSize.ref.value;(It!==Ct||Dt!==$t)&&Z.IQ.update(this.renderable.values.uTexSize,ee.Z.set(this.renderable.values.uTexSize.ref.value,It,Dt))}clearSkybox(){void 0!==this.skybox&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(It=>this.assetManager.release(It)),this.skybox=void 0)}updateSkybox(It,Dt,Ct){var $t;const Vt=null===($t=this.skybox)||void 0===$t?void 0:$t.props.faces,Wt=Dt.faces.params;if(!(Wt.nx&&Wt.ny&&Wt.nz&&Wt.px&&Wt.py&&Wt.pz))return this.clearSkybox(),void Ct?.(!1);if(this.skybox&&Vt&&function ie(jt,It){return Te(jt)===Te(It)}(Dt.faces,this.skybox.props.faces))Ct?.(!1);else{this.clearSkybox();const{texture:Ot,assets:An}=function ue(jt,It,Dt,Ct){const $t=function ne(jt,It){return"urls"===It.name?{nx:g.V.getUrlAsset(jt,It.params.nx),ny:g.V.getUrlAsset(jt,It.params.ny),nz:g.V.getUrlAsset(jt,It.params.nz),px:g.V.getUrlAsset(jt,It.params.px),py:g.V.getUrlAsset(jt,It.params.py),pz:g.V.getUrlAsset(jt,It.params.pz)}:{nx:It.params.nx,ny:It.params.ny,nz:It.params.nz,px:It.params.px,py:It.params.py,pz:It.params.pz}}(It,Dt),Vt=function be(jt,It){const Dt=Ct=>jt.resolve(Ct,"binary").run().then($t=>new Blob([$t.data]));return{nx:Dt(It.nx),ny:Dt(It.ny),nz:Dt(It.nz),px:Dt(It.px),py:Dt(It.py),pz:Dt(It.pz)}}(It,$t),Wt=[$t.nx,$t.ny,$t.nz,$t.px,$t.py,$t.pz];return typeof HTMLImageElement>"u"?(console.error('Missing "HTMLImageElement" required for background skybox'),Ct?.(!0),{texture:(0,a.z6)(),assets:Wt}):{texture:jt.resources.cubeTexture(Vt,!0,Ct),assets:Wt}}(this.webgl,this.assetManager,Dt.faces,jn=>{this.skybox&&(this.skybox.loaded=!jn),Ct?.(!0)});this.skybox={texture:Ot,props:{...Dt},assets:An,loaded:!1},Z.IQ.update(this.renderable.values.tSkybox,Ot),this.renderable.update()}if(!this.skybox)return;let yn=It;"orthographic"===It.state.mode&&(this.camera.setState({...It.state,mode:"perspective"}),this.camera.update(),yn=this.camera);const Zt=this.renderable.values.uViewDirectionProjectionInverse.ref.value;Y.e.sub(this.dir,yn.state.position,yn.state.target),Y.e.setMagnitude(this.dir,this.dir,.1),Y.e.copy(this.position,this.dir),j.$.lookAt(Zt,this.position,this.target,yn.state.up),j.$.mul(Zt,yn.projection,Zt),j.$.invert(Zt,Zt),Z.IQ.update(this.renderable.values.uViewDirectionProjectionInverse,Zt);const kt=this.renderable.values.uRotation.ref.value;le.U.fromEuler(kt,Ce.create((0,xe.pu)(Dt.rotation.x),(0,xe.pu)(Dt.rotation.y),(0,xe.pu)(Dt.rotation.z)),"XYZ"),Z.IQ.update(this.renderable.values.uRotation,kt),Z.IQ.updateIfChanged(this.renderable.values.uBlur,Dt.blur),Z.IQ.updateIfChanged(this.renderable.values.uOpacity,Dt.opacity),Z.IQ.updateIfChanged(this.renderable.values.uSaturation,Dt.saturation),Z.IQ.updateIfChanged(this.renderable.values.uLightness,Dt.lightness),Z.IQ.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}clearImage(){void 0!==this.image&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(It,Dt){if(!It.source.params)return this.clearImage(),void Dt?.(!1);if(this.image&&this.image.props.source.params&&function ce(jt,It){return ve(jt)===ve(It)}(It.source,this.image.props.source))Dt?.(!1);else{this.clearImage();const{texture:Ct,asset:$t}=function se(jt,It,Dt,Ct){const $t="url"===Dt.name?g.V.getUrlAsset(It,Dt.params):Dt.params;if(typeof HTMLImageElement>"u")return console.error('Missing "HTMLImageElement" required for background image'),Ct?.(!0),{texture:(0,a.z6)(),asset:$t};const Vt=jt.resources.texture("image-uint8","rgba","ubyte","linear"),Wt=new Image;return Wt.onload=()=>{Vt.load(Wt),(jt.isWebGL2||(0,xe.r6)(Wt.width)&&(0,xe.r6)(Wt.height))&&Vt.mipmap(),Ct?.()},Wt.onerror=()=>{Ct?.(!0)},It.resolve($t,"binary").run().then(yn=>{const Zt=new Blob([yn.data]);Wt.src=URL.createObjectURL(Zt)}),{texture:Vt,asset:$t}}(this.webgl,this.assetManager,It.source,Vt=>{this.image&&(this.image.loaded=!Vt),Dt?.(!0)});this.image={texture:Ct,props:{...It},asset:$t,loaded:!1},Z.IQ.update(this.renderable.values.tImage,Ct),this.renderable.update()}this.image&&(Z.IQ.updateIfChanged(this.renderable.values.uBlur,It.blur),Z.IQ.updateIfChanged(this.renderable.values.uOpacity,It.opacity),Z.IQ.updateIfChanged(this.renderable.values.uSaturation,It.saturation),Z.IQ.updateIfChanged(this.renderable.values.uLightness,It.lightness),Z.IQ.updateIfChanged(this.renderable.values.uViewportAdjusted,"viewport"===It.coverage),Z.IQ.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())}updateImageScaling(){var It,Dt;const Ct=this.renderable.values,[$t,Vt]=Ct.uTexSize.ref.value,Wt=(null===(It=this.image)||void 0===It?void 0:It.texture.getWidth())||0,yn=(null===(Dt=this.image)||void 0===Dt?void 0:Dt.texture.getHeight())||0,Zt=$t/Vt;Z.IQ.update(Ct.uImageScale,Zt<Wt/yn?ee.Z.set(Ct.uImageScale.ref.value,Wt*Vt/yn,Vt):ee.Z.set(Ct.uImageScale.ref.value,$t,yn*$t/Wt));const[Ot,An]=Ct.uImageScale.ref.value,jn=Ot/An;Z.IQ.update(Ct.uImageOffset,jn>Zt?ee.Z.set(Ct.uImageOffset.ref.value,(1-Zt/jn)/2,0):ee.Z.set(Ct.uImageOffset.ref.value,0,(1-jn/Zt)/2))}updateGradient(It,Dt,Ct,$t,Vt){Z.IQ.update(this.renderable.values.uGradientColorA,I.Q1.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,It)),Z.IQ.update(this.renderable.values.uGradientColorB,I.Q1.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,Dt)),Z.IQ.updateIfChanged(this.renderable.values.uGradientRatio,Ct),Z.IQ.updateIfChanged(this.renderable.values.uViewportAdjusted,Vt),Z.IQ.updateIfChanged(this.renderable.values.dVariant,$t),this.renderable.update()}update(It,Dt,Ct){if("off"===Dt.variant.name)return this.clearSkybox(),this.clearImage(),void Ct?.(!1);"skybox"===Dt.variant.name?(this.clearImage(),this.updateSkybox(It,Dt.variant.params,Ct)):"image"===Dt.variant.name?(this.clearSkybox(),this.updateImage(Dt.variant.params,Ct)):"horizontalGradient"===Dt.variant.name?(this.clearSkybox(),this.clearImage(),this.updateGradient(Dt.variant.params.topColor,Dt.variant.params.bottomColor,Dt.variant.params.ratio,Dt.variant.name,"viewport"===Dt.variant.params.coverage),Ct?.(!1)):"radialGradient"===Dt.variant.name&&(this.clearSkybox(),this.clearImage(),this.updateGradient(Dt.variant.params.centerColor,Dt.variant.params.edgeColor,Dt.variant.params.ratio,Dt.variant.name,"viewport"===Dt.variant.params.coverage),Ct?.(!1));const{x:$t,y:Vt,width:Wt,height:yn}=It.viewport;Z.IQ.update(this.renderable.values.uViewport,_e.Z.set(this.renderable.values.uViewport.ref.value,$t,Vt,Wt,yn))}isEnabled(It){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===It.variant.name||"radialGradient"===It.variant.name)}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===this.renderable.values.dVariant.ref.value||"radialGradient"===this.renderable.values.dVariant.ref.value)}render(){this.isReady()&&("image"===this.renderable.values.dVariant.ref.value&&this.updateImageScaling(),m.g$&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),m.g$&&this.webgl.timer.markEnd("BackgroundPass.render"))}dispose(){this.clearSkybox(),this.clearImage()}}const K="background-skybox";function Te(jt){var It,Dt,Ct,$t,Vt,Wt;return"urls"===jt.name?`${K}_${jt.params.nx}|${jt.params.ny}|${jt.params.nz}|${jt.params.px}|${jt.params.py}|${jt.params.pz}`:`${K}_${null===(It=jt.params.nx)||void 0===It?void 0:It.id}|${null===(Dt=jt.params.ny)||void 0===Dt?void 0:Dt.id}|${null===(Ct=jt.params.nz)||void 0===Ct?void 0:Ct.id}|${null===($t=jt.params.px)||void 0===$t?void 0:$t.id}|${null===(Vt=jt.params.py)||void 0===Vt?void 0:Vt.id}|${null===(Wt=jt.params.pz)||void 0===Wt?void 0:Wt.id}`}const re="background-image";function ve(jt){var It;return"url"===jt.name?`${re}_${jt.params}`:`${re}_${null===(It=jt.params)||void 0===It?void 0:It.id}`}const ae={drawCount:(0,o.Xb)("number"),instanceCount:(0,o.Xb)("number"),aPosition:(0,o.Yz)("float32",2,0),tSkybox:(0,o.$G)("texture","rgba","ubyte","linear"),tImage:(0,o.$G)("texture","rgba","ubyte","linear"),uImageScale:(0,o.w5)("v2"),uImageOffset:(0,o.w5)("v2"),uTexSize:(0,o.w5)("v2"),uViewport:(0,o.w5)("v4"),uViewportAdjusted:(0,o.w5)("b"),uViewDirectionProjectionInverse:(0,o.w5)("m4"),uGradientColorA:(0,o.w5)("v3"),uGradientColorB:(0,o.w5)("v3"),uGradientRatio:(0,o.w5)("f"),uBlur:(0,o.w5)("f"),uOpacity:(0,o.w5)("f"),uSaturation:(0,o.w5)("f"),uLightness:(0,o.w5)("f"),uRotation:(0,o.w5)("m3"),dVariant:(0,o.$F)("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},ge=(0,r.NG)("background","\nprecision mediump float;\n\nattribute vec2 aPosition;\n\nvarying vec4 vPosition;\n\nvoid main() {\n    vPosition = vec4(aPosition, 1.0, 1.0);\n    gl_Position = vec4(aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\nprecision mediump samplerCube;\nprecision mediump sampler2D;\n\n#if defined(dVariant_skybox)\n    uniform samplerCube tSkybox;\n    uniform mat4 uViewDirectionProjectionInverse;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n    uniform mat3 uRotation;\n#elif defined(dVariant_image)\n    uniform sampler2D tImage;\n    uniform vec2 uImageScale;\n    uniform vec2 uImageOffset;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)\n    uniform vec3 uGradientColorA;\n    uniform vec3 uGradientColorB;\n    uniform float uGradientRatio;\n#endif\n\nuniform vec2 uTexSize;\nuniform vec4 uViewport;\nuniform bool uViewportAdjusted;\nvarying vec4 vPosition;\n\n// TODO: add as general pp option to remove banding?\n// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\nvec3 ScreenSpaceDither(vec2 vScreenPos) {\n    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));\n    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));\n    return vDither.rgb / 255.0;\n}\n\nvec3 saturateColor(vec3 c, float amount) {\n    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(c, W));\n    return mix(intensity, c, 1.0 + amount);\n}\n\nvec3 lightenColor(vec3 c, float amount) {\n    return c + amount;\n}\n\nvoid main() {\n    #if defined(dVariant_skybox)\n        vec4 t = uViewDirectionProjectionInverse * vPosition;\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = textureCubeLodEXT(tSkybox, uRotation * normalize(t.xyz / t.w), uBlur * 8.0);\n        #else\n            gl_FragColor = textureCube(tSkybox, uRotation * normalize(t.xyz / t.w));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_image)\n        vec2 coords;\n        if (uViewportAdjusted) {\n            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;\n        } else {\n            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;\n        }\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);\n        #else\n            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_horizontalGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        } else {\n            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #elif defined(dVariant_radialGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;\n        } else {\n            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #endif\n}\n",{shaderTextureLod:"optional"}),je={sharpness:i.t.Numeric(.5,{min:0,max:1,step:.05}),denoise:i.t.Boolean(!0)};class Lt{constructor(It,Dt){this.webgl=It,this.renderable=function Bt(jt,It){const Dt=It.getWidth(),Ct=It.getHeight(),$t={...e.OM,tColor:t.IQ.create(It),uTexSizeInv:t.IQ.create(c.ZY.create(1/Dt,1/Ct)),uSharpness:t.IQ.create(.5),dDenoise:t.IQ.create(!0)},Vt={...Je},Wt=(0,A.$h)(jt,"triangles",en,Vt,$t);return(0,y._)(Wt,$t)}(It,Dt)}updateState(It){const{gl:Dt,state:Ct}=this.webgl;Ct.enable(Dt.SCISSOR_TEST),Ct.disable(Dt.BLEND),Ct.disable(Dt.DEPTH_TEST),Ct.depthMask(!1);const{x:$t,y:Vt,width:Wt,height:yn}=It;Ct.viewport($t,Vt,Wt,yn),Ct.scissor($t,Vt,Wt,yn),Ct.clearColor(0,0,0,1),Dt.clear(Dt.COLOR_BUFFER_BIT)}setSize(It,Dt){t.IQ.update(this.renderable.values.uTexSizeInv,c.ZY.set(this.renderable.values.uTexSizeInv.ref.value,1/It,1/Dt))}update(It,Dt){const{values:Ct}=this.renderable,{sharpness:$t,denoise:Vt}=Dt;let Wt=!1;Ct.tColor.ref.value!==It&&(t.IQ.update(this.renderable.values.tColor,It),Wt=!0),t.IQ.updateIfChanged(Ct.uSharpness,2-2*Math.pow($t,.25)),Ct.dDenoise.ref.value!==Vt&&(Wt=!0),t.IQ.updateIfChanged(Ct.dDenoise,Vt),Wt&&this.renderable.update()}render(It,Dt){m.g$&&this.webgl.timer.mark("CasPass.render"),Dt?Dt.bind():this.webgl.unbindFramebuffer(),this.updateState(It),this.renderable.render(),m.g$&&this.webgl.timer.markEnd("CasPass.render")}}const Je={...e.du,tColor:(0,o.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,o.w5)("v2"),uSharpness:(0,o.w5)("f"),dDenoise:(0,o.$F)("boolean")},en=(0,r.NG)("cas",v.e,"\nprecision mediump float;\nprecision mediump sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nuniform float uSharpness;\n\n// adapted from https://www.shadertoy.com/view/stXSWB\n\n/*\n* FidelityFX Super Resolution scales up a low resolution\n* image, while adding fine detail.\n*\n* MIT Open License\n*\n* https://gpuopen.com/fsr\n*\n* Left: FSR processed\n* Right: Original texture, bilinear interpolation\n*\n* Mouse at top: Sharpness 0 stops (maximum)\n* Mouse at bottom: Sharpness 2 stops (minimum)\n*\n* It works in two passes-\n*   EASU upsamples the image with a clamped Lanczos kernel.\n*   RCAS sharpens the image at the target resolution.\n*\n* I needed to make a few changes to improve readability and\n* WebGL compatibility in an algorithm I don't fully understand.\n* Expect bugs.\n*\n* Shader not currently running for WebGL1 targets (eg. mobile Safari)\n*\n* There is kind of no point to using FSR in Shadertoy, as it renders buffers\n* at full target resolution. But this might be useful for WebGL based demos\n* running smaller-than-target render buffers.\n*\n* For sharpening with a full resolution render buffer,\n* FidelityFX CAS is a better option.\n* https://www.shadertoy.com/view/ftsXzM\n*\n* For readability and compatibility, these optimisations have been removed:\n*   * Fast approximate inverse and inversesqrt\n*   * textureGather fetches (not WebGL compatible)\n*   * Multiplying by reciprocal instead of division\n*\n* Apologies to AMD for the numerous slowdowns and errors I have introduced.\n*\n*/\n\n/***** RCAS *****/\n#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))\n\n// Input callback prototypes that need to be implemented by calling shader\nvec4 FsrRcasLoadF(vec2 p);\n//------------------------------------------------------------------------------------------------------------------------------\nvoid FsrRcasCon(\n    out float con,\n    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.\n    float sharpness\n) {\n    // Transform from stops to linear value.\n    con = exp2(-sharpness);\n}\n\nvec3 FsrRcasF(\n    vec2 ip, // Integer pixel position in output.\n    float con\n) {\n    // Constant generated by RcasSetup().\n    // Algorithm uses minimal 3x3 pixel neighborhood.\n    //    b\n    //  d e f\n    //    h\n    vec2 sp = vec2(ip);\n    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;\n    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;\n    vec3 e = FsrRcasLoadF(sp).rgb;\n    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;\n    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;\n\n    // Luma times 2.\n    float bL = b.g + .5 * (b.b + b.r);\n    float dL = d.g + .5 * (d.b + d.r);\n    float eL = e.g + .5 * (e.b + e.r);\n    float fL = f.g + .5 * (f.b + f.r);\n    float hL = h.g + .5 * (h.b + h.r);\n\n    // Noise detection.\n    #ifdef dDenoise\n        float nz = .25 * (bL + dL + fL + hL) - eL;\n        nz=clamp(\n            abs(nz)\n            /(\n                max(max(bL,dL),max(eL,max(fL,hL)))\n                -min(min(bL,dL),min(eL,min(fL,hL)))\n            ),\n            0., 1.\n        );\n        nz=1.-.5*nz;\n    #endif\n\n    // Min and max of ring.\n    vec3 mn4 = min(b, min(f, h));\n    vec3 mx4 = max(b, max(f, h));\n\n    // Immediate constants for peak range.\n    vec2 peakC = vec2(1., -4.);\n\n    // Limiters, these need to be high precision RCPs.\n    vec3 hitMin = mn4 / (4. * mx4);\n    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);\n    vec3 lobeRGB = max(-hitMin, hitMax);\n    float lobe = max(\n        -FSR_RCAS_LIMIT,\n        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)\n    )*con;\n\n    // Apply noise removal.\n    #ifdef dDenoise\n        lobe *= nz;\n    #endif\n\n    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.\n    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);\n}\n\n\nvec4 FsrRcasLoadF(vec2 p) {\n    return texture2D(tColor, p * uTexSizeInv);\n}\n\nvoid main() {\n    // Set up constants\n    float con;\n    FsrRcasCon(con, uSharpness);\n\n    // Perform RCAS pass\n    vec3 col = FsrRcasF(gl_FragCoord.xy, con);\n\n    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);\n}\n");var pn=n(6049),$e=n(3770);const mt={...e.du,tDepthOpaque:(0,o.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,o.w5)("v2"),dOrthographic:(0,o.$F)("number"),uNear:(0,o.w5)("f"),uFar:(0,o.w5)("f"),uInvProjection:(0,o.w5)("m4"),uOutlineThreshold:(0,o.w5)("f"),dTransparentOutline:(0,o.$F)("boolean")},Me={...e.du,tDepth:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,o.w5)("v2"),uProjection:(0,o.w5)("m4"),uInvProjection:(0,o.w5)("m4"),uBounds:(0,o.w5)("v4"),dOrthographic:(0,o.$F)("number"),uNear:(0,o.w5)("f"),uFar:(0,o.w5)("f"),dSteps:(0,o.$F)("number"),uMaxDistance:(0,o.w5)("f"),uTolerance:(0,o.w5)("f"),uBias:(0,o.w5)("f"),uLightDirection:(0,o.w5)("v3[]"),uLightColor:(0,o.w5)("v3[]"),dLightCount:(0,o.$F)("number")},ut={...e.du,tDepth:(0,o.$G)("texture","rgba","ubyte","nearest"),tDepthHalf:(0,o.$G)("texture","rgba","ubyte","nearest"),tDepthQuarter:(0,o.$G)("texture","rgba","ubyte","nearest"),uSamples:(0,o.w5)("v3[]"),dNSamples:(0,o.$F)("number"),uProjection:(0,o.w5)("m4"),uInvProjection:(0,o.w5)("m4"),uBounds:(0,o.w5)("v4"),uTexSize:(0,o.w5)("v2"),uRadius:(0,o.w5)("f"),uBias:(0,o.w5)("f"),dMultiScale:(0,o.$F)("boolean"),dLevels:(0,o.$F)("number"),uLevelRadius:(0,o.w5)("f[]"),uLevelBias:(0,o.w5)("f[]"),uNearThreshold:(0,o.w5)("f"),uFarThreshold:(0,o.w5)("f")},sn={...e.du,tSsaoDepth:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,o.w5)("v2"),uKernel:(0,o.w5)("f[]"),dOcclusionKernelSize:(0,o.$F)("number"),uBlurDirectionX:(0,o.w5)("f"),uBlurDirectionY:(0,o.w5)("f"),uInvProjection:(0,o.w5)("m4"),uNear:(0,o.w5)("f"),uFar:(0,o.w5)("f"),uBounds:(0,o.w5)("v4"),dOrthographic:(0,o.$F)("number")};function gt(jt,It,Dt){const Ct={...e.OM,tSsaoDepth:t.IQ.create(It),uTexSize:t.IQ.create(c.ZY.create(It.getWidth(),It.getHeight())),uKernel:t.IQ.create(yt(15)),dOcclusionKernelSize:t.IQ.create(15),uBlurDirectionX:t.IQ.create("horizontal"===Dt?1:0),uBlurDirectionY:t.IQ.create("vertical"===Dt?1:0),uInvProjection:t.IQ.create(c.$I.identity()),uNear:t.IQ.create(0),uFar:t.IQ.create(1e4),uBounds:t.IQ.create((0,c.Zb)()),dOrthographic:t.IQ.create(0)},$t={...sn},Vt=(0,r.NG)("ssao_blur",v.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uKernel[dOcclusionKernelSize];\n\nuniform float uBlurDirectionX;\nuniform float uBlurDirectionY;\n\nuniform mat4 uInvProjection;\nuniform float uNear;\nuniform float uFar;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;\n\n    if (outsideBounds(coords)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfDepth = unpackRGToUnitInterval(packedDepth);\n    // if background and if second pass\n    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfViewZ = getViewZ(selfDepth);\n    float pixelSize = getPixelSize(coords, selfDepth);\n    // max diff depth between two pixels\n    float maxDiffViewZ = 1.0;\n\n    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;\n\n    float sum = 0.0;\n    float kernelSum = 0.0;\n    // only if kernelSize is odd\n    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {\n        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;\n\n        vec2 sampleCoords = coords + float(i) * offset;\n        if (outsideBounds(sampleCoords)) {\n            continue;\n        }\n\n        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);\n\n        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);\n        if (isBackground(sampleDepth)) {\n            continue;\n        }\n\n        float sampleViewZ = getViewZ(sampleDepth);\n        if (abs(selfViewZ - sampleViewZ) > maxDiffViewZ) {\n            continue;\n        }\n\n        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1\n        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);\n\n        sum += kernel * sampleValue;\n        kernelSum += kernel;\n    }\n    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);\n}\n"),Wt=(0,A.$h)(jt,"triangles",Vt,$t,Ct);return(0,y._)(Wt,Ct)}function yt(jt){const It=jt/3,Dt=Math.floor((jt+1)/2),Ct=[];for(let $t=0;$t<Dt;$t++)Ct.push(1/(Math.sqrt(2*Math.PI)*It)*Math.exp(-$t*$t/(2*It*It)));return Ct}const At=[];for(let jt=0;jt<256;jt++){const It=(0,c.eB)();It[0]=2*Math.random()-1,It[1]=2*Math.random()-1,It[2]=Math.random(),c.eB.normalize(It,It),c.eB.scale(It,It,Math.random()),At.push(It)}function Gt(jt){const It=[];for(let Dt=0;Dt<jt;Dt++){let Ct=(Dt*Dt+2*Dt+1)/(jt*jt);Ct=.1+.9*Ct,It.push(At[Dt][0]*Ct),It.push(At[Dt][1]*Ct),It.push(At[Dt][2]*Ct)}return It}const rn={...e.du,tSsaoDepth:(0,o.$G)("texture","rgba","ubyte","nearest"),tColor:(0,o.$G)("texture","rgba","ubyte","nearest"),tDepthOpaque:(0,o.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,o.$G)("texture","rgba","ubyte","nearest"),tShadows:(0,o.$G)("texture","rgba","ubyte","nearest"),tOutlines:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,o.w5)("v2"),dOrthographic:(0,o.$F)("number"),uNear:(0,o.w5)("f"),uFar:(0,o.w5)("f"),uFogNear:(0,o.w5)("f"),uFogFar:(0,o.w5)("f"),uFogColor:(0,o.w5)("v3"),uOutlineColor:(0,o.w5)("v3"),uOcclusionColor:(0,o.w5)("v3"),uTransparentBackground:(0,o.w5)("b"),dOcclusionEnable:(0,o.$F)("boolean"),uOcclusionOffset:(0,o.w5)("v2"),dShadowEnable:(0,o.$F)("boolean"),dOutlineEnable:(0,o.$F)("boolean"),dOutlineScale:(0,o.$F)("number"),dTransparentOutline:(0,o.$F)("boolean")},Mt={occlusion:i.t.MappedStatic("on",{on:i.t.Group({samples:i.t.Numeric(32,{min:1,max:256,step:1}),multiScale:i.t.MappedStatic("off",{on:i.t.Group({levels:i.t.ObjectList({radius:i.t.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:i.t.Numeric(1,{min:0,max:3,step:.1})},jt=>`${jt.radius}, ${jt.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:i.t.Numeric(10,{min:0,max:50,step:1}),farThreshold:i.t.Numeric(1500,{min:0,max:1e4,step:100})}),off:i.t.Group({})},{cycle:!0}),radius:i.t.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:jt=>"on"===jt?.multiScale.name}),bias:i.t.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:i.t.Numeric(15,{min:1,max:25,step:2}),resolutionScale:i.t.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:i.t.Color((0,I.Q1)(0))}),off:i.t.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),shadow:i.t.MappedStatic("off",{on:i.t.Group({steps:i.t.Numeric(1,{min:1,max:64,step:1}),bias:i.t.Numeric(.6,{min:0,max:1,step:.01}),maxDistance:i.t.Numeric(3,{min:0,max:256,step:1}),tolerance:i.t.Numeric(1,{min:0,max:10,step:.1})}),off:i.t.Group({})},{cycle:!0,description:"Simplistic shadows"}),outline:i.t.MappedStatic("off",{on:i.t.Group({scale:i.t.Numeric(1,{min:1,max:5,step:1}),threshold:i.t.Numeric(.33,{min:.01,max:1,step:.01}),color:i.t.Color((0,I.Q1)(0)),includeTransparent:i.t.Boolean(!0,{description:"Whether to show outline for transparent objects"})}),off:i.t.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),dof:i.t.MappedStatic("off",{on:i.t.Group(pn.w),off:i.t.Group({})},{cycle:!0,description:"DOF"}),antialiasing:i.t.MappedStatic("smaa",{fxaa:i.t.Group(u),smaa:i.t.Group(L),off:i.t.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"}),sharpening:i.t.MappedStatic("off",{on:i.t.Group(je),off:i.t.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening"}),background:i.t.Group(Ve,{isFlat:!0}),bloom:i.t.MappedStatic("on",{on:i.t.Group($e.c),off:i.t.Group({})},{cycle:!0,description:"Bloom"})};class bn{static isEnabled(It){return"on"===It.occlusion.name||"on"===It.shadow.name||"on"===It.outline.name||"off"!==It.background.variant.name}static isTransparentOutlineEnabled(It){return"on"===It.outline.name&&It.outline.params.includeTransparent}calcSsaoScale(It){return Math.min(1,1/this.webgl.pixelRatio)*It}constructor(It,Dt,Ct){this.webgl=It,this.drawPass=Ct,this.bgColor=(0,c.eB)(),this.occlusionOffset=[0,0],this.transparentBackground=!1;const{colorTarget:$t,depthTextureTransparent:Vt,depthTextureOpaque:Wt}=Ct,yn=$t.getWidth(),Zt=$t.getHeight();this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.levels=[],this.target=It.createRenderTarget(yn,Zt,!1,"uint8","linear"),this.outlinesTarget=It.createRenderTarget(yn,Zt,!1),this.outlinesRenderable=function _t(jt,It,Dt,Ct){const $t=It.getWidth(),Vt=It.getHeight(),Wt={...e.OM,tDepthOpaque:t.IQ.create(It),tDepthTransparent:t.IQ.create(Dt),uTexSize:t.IQ.create(c.ZY.create($t,Vt)),dOrthographic:t.IQ.create(0),uNear:t.IQ.create(1),uFar:t.IQ.create(1e4),uInvProjection:t.IQ.create(c.$I.identity()),uOutlineThreshold:t.IQ.create(.33),dTransparentOutline:t.IQ.create(Ct)},yn={...mt},Zt=(0,r.NG)("outlines",v.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform mat4 uInvProjection;\n\nuniform float uOutlineThreshold;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    float backgroundViewZ = 2.0 * uFar;\n\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float selfDepthOpaque = getDepthOpaque(coords);\n    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);\n    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;\n\n    float selfDepthTransparent = getDepthTransparent(coords);\n    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);\n    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;\n\n    float outline = 1.0;\n    float bestDepth = 1.0;\n    float transparentFlag = 0.0;\n\n    for (int y = -1; y <= 1; y++) {\n        for (int x = -1; x <= 1; x++) {\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            float sampleDepthOpaque = getDepthOpaque(sampleCoords);\n            float sampleDepthTransparent = getDepthTransparent(sampleCoords);\n\n            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);\n            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestDepth) {\n                outline = 0.0;\n                bestDepth = sampleDepthOpaque;\n            }\n\n            if (sampleDepthTransparent < sampleDepthOpaque) {\n                float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);\n                if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestDepth) {\n                    outline = 0.0;\n                    bestDepth = sampleDepthTransparent;\n                    transparentFlag = 1.0;\n                }\n            }\n        }\n    }\n\n    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), transparentFlag);\n}\n"),kt=(0,A.$h)(jt,"triangles",Zt,yn,Wt);return(0,y._)(kt,Wt)}(It,Wt,Vt,!0),this.shadowsTarget=It.createRenderTarget(yn,Zt,!1),this.shadowsRenderable=function Ke(jt,It){const Dt=It.getWidth(),Ct=It.getHeight(),$t={...e.OM,tDepth:t.IQ.create(It),uTexSize:t.IQ.create(c.ZY.create(Dt,Ct)),uProjection:t.IQ.create(c.$I.identity()),uInvProjection:t.IQ.create(c.$I.identity()),uBounds:t.IQ.create((0,c.Zb)()),dOrthographic:t.IQ.create(0),uNear:t.IQ.create(1),uFar:t.IQ.create(1e4),dSteps:t.IQ.create(1),uMaxDistance:t.IQ.create(3),uTolerance:t.IQ.create(1),uBias:t.IQ.create(.6),uLightDirection:t.IQ.create([]),uLightColor:t.IQ.create([]),dLightCount:t.IQ.create(0)},Vt={...Me},Wt=(0,r.NG)("shadows",v.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uNear;\nuniform float uFar;\n\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\nuniform float uMaxDistance;\nuniform float uTolerance;\nuniform float uBias;\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat screenFade(const in vec2 coords) {\n    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);\n    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));\n    return saturate(1.0 - dot(fade, fade));\n}\n\n// based on https://panoskarabelas.com/posts/screen_space_shadows/\nfloat screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in float stepLength) {\n    // Ray position and direction (in view-space)\n    vec3 rayPos = position;\n    vec3 rayDir = -lightDirection;\n\n    // Compute ray step\n    vec3 rayStep = rayDir * stepLength;\n\n    // Ray march towards the light\n    float occlusion = 0.0;\n    vec4 rayCoords = vec4(0.0);\n    for (int i = 0; i < dSteps; ++i) {\n        // Step the ray\n        rayPos += rayStep;\n\n        rayCoords = uProjection * vec4(rayPos, 1.0);\n        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;\n\n        if (outsideBounds(rayCoords.xy))\n            return 1.0;\n\n        // Compute the difference between the ray's and the camera's depth\n        float depth = getDepth(rayCoords.xy);\n        float viewZ = getViewZ(depth);\n        float zDelta = rayPos.z - viewZ;\n\n        if (zDelta < uTolerance) {\n            occlusion = 1.0;\n\n            // Fade out as we approach the edges of the screen\n            occlusion *= screenFade(rayCoords.xy);\n\n            break;\n        }\n    }\n\n    return 1.0 - (uBias * occlusion);\n}\n\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n    float stepLength = uMaxDistance / float(dSteps);\n\n    float o = 1.0;\n    #if dLightCount != 0\n        float sh[dLightCount];\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            sh[i] = screenSpaceShadow(selfViewPos, uLightDirection[i], stepLength);\n            o = min(o, sh[i]);\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    gl_FragColor = vec4(o);\n}\n"),yn=(0,A.$h)(jt,"triangles",Wt,Vt,$t);return(0,y._)(yn,$t)}(It,Wt),this.ssaoFramebuffer=It.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=It.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=It.resources.framebuffer();const kt=Math.floor(yn*this.ssaoScale),Ot=Math.floor(Zt*this.ssaoScale),An=Math.max(1,Math.floor(.5*kt)),jn=Math.max(1,Math.floor(.5*Ot)),On=Math.max(1,Math.floor(.25*kt)),fr=Math.max(1,Math.floor(.25*Ot));this.downsampledDepthTarget=Ct.packedDepth?It.createRenderTarget(kt,Ot,!1,"uint8","nearest","rgba"):It.createRenderTarget(kt,Ot,!1,"float32","nearest",It.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderable=(0,e._0)(It,Wt);const Dr=1===this.ssaoScale?Wt:this.downsampledDepthTarget.texture;this.depthHalfTarget=Ct.packedDepth?It.createRenderTarget(An,jn,!1,"uint8","nearest","rgba"):It.createRenderTarget(An,jn,!1,"float32","nearest",It.isWebGL2?"alpha":"rgba"),this.depthHalfRenderable=(0,e._0)(It,Dr),this.depthQuarterTarget=Ct.packedDepth?It.createRenderTarget(On,fr,!1,"uint8","nearest","rgba"):It.createRenderTarget(On,fr,!1,"float32","nearest",It.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderable=(0,e._0)(It,this.depthHalfTarget.texture),this.ssaoDepthTexture=It.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(kt,Ot),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=It.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(kt,Ot),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=function Kt(jt,It,Dt,Ct){const $t={...e.OM,tDepth:t.IQ.create(It),tDepthHalf:t.IQ.create(Dt),tDepthQuarter:t.IQ.create(Ct),uSamples:t.IQ.create(Gt(32)),dNSamples:t.IQ.create(32),uProjection:t.IQ.create(c.$I.identity()),uInvProjection:t.IQ.create(c.$I.identity()),uBounds:t.IQ.create((0,c.Zb)()),uTexSize:t.IQ.create(c.ZY.create(jt.gl.drawingBufferWidth,jt.gl.drawingBufferHeight)),uRadius:t.IQ.create(Math.pow(2,5)),uBias:t.IQ.create(.8),dMultiScale:t.IQ.create(!1),dLevels:t.IQ.create(3),uLevelRadius:t.IQ.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:t.IQ.create([.8,.8,.8]),uNearThreshold:t.IQ.create(10),uFarThreshold:t.IQ.create(1500)},Vt={...ut},Wt=(0,r.NG)("ssao",v.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform sampler2D tDepthHalf;\nuniform sampler2D tDepthQuarter;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform vec3 uSamples[dNSamples];\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\n#ifdef dMultiScale\n    uniform float uLevelRadius[dLevels];\n    uniform float uLevelBias[dLevels];\n    uniform float uNearThreshold;\n    uniform float uFarThreshold;\n#else\n    uniform float uRadius;\n#endif\nuniform float uBias;\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\nfloat noise(const in vec2 coords) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(coords, vec2(a,b));\n    float sn = mod(dt, PI);\n    return abs(fract(sin(sn) * c)); // is abs necessary?\n}\n\nvec2 getNoiseVec2(const in vec2 coords) {\n    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, c).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, c));\n    #endif\n}\n\n#define dQuarterThreshold 0.1\n#define dHalfThreshold 0.05\n\nfloat getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    float d = distance(coords, selfCoords);\n    #ifdef depthTextureSupport\n        if (d > dQuarterThreshold) {\n            return texture2D(tDepthQuarter, c).r;\n        } else if (d > dHalfThreshold) {\n            return texture2D(tDepthHalf, c).r;\n        } else {\n            return texture2D(tDepth, c).r;\n        }\n    #else\n        if (d > dQuarterThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));\n        } else if (d > dHalfThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthHalf, c));\n        } else {\n            return unpackRGBAToDepth(texture2D(tDepth, c));\n        }\n    #endif\n}\n\n// adapted from https://gist.github.com/bgolus/a07ed65602c009d5e2f753826e8078a0\nvec3 viewNormalAtPixelPositionAccurate(vec2 vpos) {\n    // current pixel's depth\n    float c = getDepth(vpos);\n\n    // get current pixel's view space position\n    vec3 viewSpacePos_c = screenSpaceToViewSpace(vec3(vpos, c), uInvProjection);\n\n    // get view space position at 1 pixel offsets in each major direction\n    vec3 viewSpacePos_l = screenSpaceToViewSpace(vec3(vpos + vec2(-1.0, 0.0) / uTexSize, getDepth(vpos + vec2(-1.0, 0.0) / uTexSize)), uInvProjection);\n    vec3 viewSpacePos_r = screenSpaceToViewSpace(vec3(vpos + vec2( 1.0, 0.0) / uTexSize, getDepth(vpos + vec2( 1.0, 0.0) / uTexSize)), uInvProjection);\n    vec3 viewSpacePos_d = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0,-1.0) / uTexSize, getDepth(vpos + vec2( 0.0,-1.0) / uTexSize)), uInvProjection);\n    vec3 viewSpacePos_u = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0, 1.0) / uTexSize, getDepth(vpos + vec2( 0.0, 1.0) / uTexSize)), uInvProjection);\n\n    // get the difference between the current and each offset position\n    vec3 l = viewSpacePos_c - viewSpacePos_l;\n    vec3 r = viewSpacePos_r - viewSpacePos_c;\n    vec3 d = viewSpacePos_c - viewSpacePos_d;\n    vec3 u = viewSpacePos_u - viewSpacePos_c;\n\n    // get depth values at 1 & 2 pixels offsets from current along the horizontal axis\n    vec4 H = vec4(\n        getDepth(vpos + vec2(-1.0, 0.0) / uTexSize),\n        getDepth(vpos + vec2( 1.0, 0.0) / uTexSize),\n        getDepth(vpos + vec2(-2.0, 0.0) / uTexSize),\n        getDepth(vpos + vec2( 2.0, 0.0) / uTexSize)\n    );\n\n    // get depth values at 1 & 2 pixels offsets from current along the vertical axis\n    vec4 V = vec4(\n        getDepth(vpos + vec2(0.0,-1.0) / uTexSize),\n        getDepth(vpos + vec2(0.0, 1.0) / uTexSize),\n        getDepth(vpos + vec2(0.0,-2.0) / uTexSize),\n        getDepth(vpos + vec2(0.0, 2.0) / uTexSize)\n    );\n\n    // current pixel's depth difference from slope of offset depth samples\n    // differs from original article because we're using non-linear depth values\n    // see article's comments\n    vec2 he = abs((2.0 * H.xy - H.zw) - c);\n    vec2 ve = abs((2.0 * V.xy - V.zw) - c);\n\n    // pick horizontal and vertical diff with the smallest depth difference from slopes\n    vec3 hDeriv = he.x < he.y ? l : r;\n    vec3 vDeriv = ve.x < ve.y ? d : u;\n\n    // get view space normal from the cross product of the best derivatives\n    vec3 viewNormal = normalize(cross(hDeriv, vDeriv));\n\n    return viewNormal;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\n// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);\n        return;\n    }\n\n    vec3 selfViewNormal = viewNormalAtPixelPositionAccurate(selfCoords);\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n\n    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));\n    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));\n    vec3 bitangent = cross(selfViewNormal, tangent);\n    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);\n\n    float occlusion = 0.0;\n    #ifdef dMultiScale\n        float pixelSize = getPixelSize(selfCoords, selfDepth);\n\n        for(int l = 0; l < dLevels; l++) {\n            // TODO: smooth transition\n            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;\n            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;\n\n            float levelOcclusion = 0.0;\n            for(int i = 0; i < dNSamples; i++) {\n                // get sample position:\n                vec3 sampleViewPos = TBN * uSamples[i];\n                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];\n\n                // project sample position:\n                vec4 offset = vec4(sampleViewPos, 1.0);\n                offset = uProjection * offset;\n                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n                // get sample depth:\n                float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n                float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n                levelOcclusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];\n            }\n            occlusion = max(occlusion, levelOcclusion);\n        }\n    #else\n        for(int i = 0; i < dNSamples; i++) {\n            vec3 sampleViewPos = TBN * uSamples[i];\n            sampleViewPos = selfViewPos + sampleViewPos * uRadius;\n\n            vec4 offset = vec4(sampleViewPos, 1.0);\n            offset = uProjection * offset;\n            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n            float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n            float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n            occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));\n        }\n    #endif\n    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));\n\n    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));\n\n    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);\n}\n"),yn=(0,A.$h)(jt,"triangles",Wt,Vt,$t);return(0,y._)(yn,$t)}(It,Dr,this.depthHalfTarget.texture,this.depthQuarterTarget.texture),this.ssaoBlurFirstPassRenderable=gt(It,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=gt(It,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=function tt(jt,It,Dt,Ct,$t,Vt,Wt,yn){const Zt={...e.OM,tSsaoDepth:t.IQ.create(Wt),tColor:t.IQ.create(It),tDepthOpaque:t.IQ.create(Dt),tDepthTransparent:t.IQ.create(Ct),tShadows:t.IQ.create($t),tOutlines:t.IQ.create(Vt),uTexSize:t.IQ.create(c.ZY.create(It.getWidth(),It.getHeight())),dOrthographic:t.IQ.create(0),uNear:t.IQ.create(1),uFar:t.IQ.create(1e4),uFogNear:t.IQ.create(1e4),uFogFar:t.IQ.create(1e4),uFogColor:t.IQ.create(c.eB.create(1,1,1)),uOutlineColor:t.IQ.create(c.eB.create(0,0,0)),uOcclusionColor:t.IQ.create(c.eB.create(0,0,0)),uTransparentBackground:t.IQ.create(!1),dOcclusionEnable:t.IQ.create(!0),uOcclusionOffset:t.IQ.create(c.ZY.create(0,0)),dShadowEnable:t.IQ.create(!1),dOutlineEnable:t.IQ.create(!1),dOutlineScale:t.IQ.create(1),dTransparentOutline:t.IQ.create(yn)},kt={...rn},Ot=(0,r.NG)("postprocessing",v.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform sampler2D tColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform sampler2D tShadows;\nuniform sampler2D tOutlines;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\nuniform vec3 uOutlineColor;\nuniform vec3 uOcclusionColor;\nuniform bool uTransparentBackground;\nuniform vec2 uOcclusionOffset;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getOutline(const in vec2 coords, const in float opaqueDepth, out float closestTexel) {\n    float backgroundViewZ = 2.0 * uFar;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float transparentDepth = getDepthTransparent(coords);\n    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);\n    float transparentSelfViewZ = isBackground(transparentDepth) ? backgroundViewZ : getViewZ(transparentDepth);\n    float selfDepth = min(opaqueDepth, transparentDepth);\n\n    float outline = 1.0;\n    closestTexel = 1.0;\n    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {\n        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {\n            if (x * x + y * y > dOutlineScale * dOutlineScale) {\n                continue;\n            }\n\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);\n            float sampleOutline = sampleOutlineCombined.r;\n            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);\n            float sampleOutlineViewZ = isBackground(sampleOutlineDepth) ? backgroundViewZ : getViewZ(sampleOutlineDepth);\n\n            float selfViewZ = sampleOutlineCombined.a == 0.0 ? opaqueSelfViewZ : transparentSelfViewZ;\n            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {\n                outline = 0.0;\n                closestTexel = sampleOutlineDepth;\n            }\n        }\n    }\n    return closestTexel < opaqueDepth ? outline : 1.0;\n}\n\nfloat getSsao(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n\n    float viewDist;\n    float fogFactor;\n    float opaqueDepth = getDepthOpaque(coords);\n\n    #ifdef dOcclusionEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            float occlusionFactor = getSsao(coords + uOcclusionOffset);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);\n            } else {\n                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);\n            }\n        }\n    #endif\n\n    #ifdef dShadowEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            vec4 shadow = texture2D(tShadows, coords);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);\n            } else {\n                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);\n            }\n        }\n    #endif\n\n    // outline needs to be handled after occlusion and shadow to keep them clean\n    #ifdef dOutlineEnable\n        float closestTexel;\n        float outline = getOutline(coords, opaqueDepth, closestTexel);\n        if (outline == 0.0) {\n            viewDist = abs(getViewZ(closestTexel));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            if (!uTransparentBackground) {\n                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);\n            } else {\n                color.a = 1.0 - fogFactor;\n                color.rgb = mix(uOutlineColor, color.rgb, fogFactor);\n            }\n        }\n    #endif\n\n    gl_FragColor = color;\n}\n"),An=(0,A.$h)(jt,"triangles",Ot,kt,Zt);return(0,y._)(An,Zt)}(It,$t.texture,Wt,Vt,this.shadowsTarget.texture,this.outlinesTarget.texture,this.ssaoDepthTexture,!0),this.background=new Ne(It,Dt,yn,Zt)}setSize(It,Dt){const[Ct,$t]=this.renderable.values.uTexSize.ref.value,Vt=this.calcSsaoScale(1);if(It!==Ct||Dt!==$t||this.ssaoScale!==Vt){this.ssaoScale=Vt,this.target.setSize(It,Dt),this.outlinesTarget.setSize(It,Dt),this.shadowsTarget.setSize(It,Dt);const Wt=Math.floor(It*this.ssaoScale),yn=Math.floor(Dt*this.ssaoScale);this.downsampledDepthTarget.setSize(Wt,yn),this.ssaoDepthTexture.define(Wt,yn),this.ssaoDepthBlurProxyTexture.define(Wt,yn);const Zt=Math.max(1,Math.floor(.5*Wt)),kt=Math.max(1,Math.floor(.5*yn));this.depthHalfTarget.setSize(Zt,kt);const Ot=Math.max(1,Math.floor(.25*Wt)),An=Math.max(1,Math.floor(.25*yn));this.depthQuarterTarget.setSize(Ot,An),t.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,It,Dt)),t.IQ.update(this.outlinesRenderable.values.uTexSize,c.ZY.set(this.outlinesRenderable.values.uTexSize.ref.value,It,Dt)),t.IQ.update(this.shadowsRenderable.values.uTexSize,c.ZY.set(this.shadowsRenderable.values.uTexSize.ref.value,It,Dt)),t.IQ.update(this.downsampleDepthRenderable.values.uTexSize,c.ZY.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,Wt,yn)),t.IQ.update(this.depthHalfRenderable.values.uTexSize,c.ZY.set(this.depthHalfRenderable.values.uTexSize.ref.value,Zt,kt)),t.IQ.update(this.depthQuarterRenderable.values.uTexSize,c.ZY.set(this.depthQuarterRenderable.values.uTexSize.ref.value,Ot,An)),t.IQ.update(this.ssaoRenderable.values.uTexSize,c.ZY.set(this.ssaoRenderable.values.uTexSize.ref.value,Wt,yn)),t.IQ.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,c.ZY.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,Wt,yn)),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,c.ZY.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,Wt,yn));const jn=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;t.IQ.update(this.depthHalfRenderable.values.tColor,jn),t.IQ.update(this.ssaoRenderable.values.tDepth,jn),this.depthHalfRenderable.update(),this.ssaoRenderable.update(),this.background.setSize(It,Dt)}}updateState(It,Dt,Ct,$t,Vt){var Wt;let yn=!1,Zt=!1,kt=!1,Ot=!1,An=!1,jn=!1;const On="orthographic"===It.state.mode?1:0,fr="on"===$t.outline.name,Dr="on"===$t.shadow.name,Pr="on"===$t.occlusion.name,or=c.$I.identity();c.$I.invert(or,It.projection);const[Nr,Ir]=this.renderable.values.uTexSize.ref.value,Or=It.viewport;if("on"===$t.occlusion.name){t.IQ.update(this.ssaoRenderable.values.uProjection,It.projection),t.IQ.update(this.ssaoRenderable.values.uInvProjection,or);const un=this.ssaoRenderable.values.uBounds,ct=this.ssaoScale;c.Zb.set(un.ref.value,Math.floor(Or.x*ct)/(Nr*ct),Math.floor(Or.y*ct)/(Ir*ct),Math.ceil((Or.x+Or.width)*ct)/(Nr*ct),Math.ceil((Or.y+Or.height)*ct)/(Ir*ct)),t.IQ.update(un,un.ref.value),t.IQ.update(this.ssaoBlurFirstPassRenderable.values.uBounds,un.ref.value),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.uBounds,un.ref.value),t.IQ.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,It.near),t.IQ.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,It.near),t.IQ.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,It.far),t.IQ.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,It.far),t.IQ.update(this.ssaoBlurFirstPassRenderable.values.uInvProjection,or),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.uInvProjection,or),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==On&&(Ot=!0,t.IQ.update(this.ssaoBlurFirstPassRenderable.values.dOrthographic,On),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.dOrthographic,On)),this.nSamples!==$t.occlusion.params.samples&&(kt=!0,this.nSamples=$t.occlusion.params.samples,t.IQ.update(this.ssaoRenderable.values.uSamples,Gt(this.nSamples)),t.IQ.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples));const dt="on"===$t.occlusion.params.multiScale.name;if(this.ssaoRenderable.values.dMultiScale.ref.value!==dt&&(kt=!0,t.IQ.update(this.ssaoRenderable.values.dMultiScale,dt)),"on"===$t.occlusion.params.multiScale.name){const cn=$t.occlusion.params.multiScale.params;if(!(0,t.bD)(this.levels,cn.levels)){kt=!0,this.levels=cn.levels;const xn=function nn(jt,It){const Dt=jt.length,{radius:Ct,bias:$t}=It||{radius:new Array(3*Dt).fill(0),bias:new Array(3*Dt).fill(0)};jt=jt.slice().sort((Vt,Wt)=>Vt.radius-Wt.radius);for(let Vt=0;Vt<Dt;++Vt){const Wt=jt[Vt];Ct[Vt]=Math.pow(2,Wt.radius),$t[Vt]=Wt.bias}return{count:Dt,radius:Ct,bias:$t}}(cn.levels);t.IQ.updateIfChanged(this.ssaoRenderable.values.dLevels,xn.count),t.IQ.update(this.ssaoRenderable.values.uLevelRadius,xn.radius),t.IQ.update(this.ssaoRenderable.values.uLevelBias,xn.bias)}t.IQ.updateIfChanged(this.ssaoRenderable.values.uNearThreshold,cn.nearThreshold),t.IQ.updateIfChanged(this.ssaoRenderable.values.uFarThreshold,cn.farThreshold)}else t.IQ.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,$t.occlusion.params.radius));if(t.IQ.updateIfChanged(this.ssaoRenderable.values.uBias,$t.occlusion.params.bias),this.blurKernelSize!==$t.occlusion.params.blurKernelSize){Ot=!0,this.blurKernelSize=$t.occlusion.params.blurKernelSize;const cn=yt(this.blurKernelSize);t.IQ.update(this.ssaoBlurFirstPassRenderable.values.uKernel,cn),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.uKernel,cn),t.IQ.update(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}const Yt=this.calcSsaoScale($t.occlusion.params.resolutionScale);if(this.ssaoScale!==Yt){kt=!0,An=!0,this.ssaoScale=Yt;const cn=Math.floor(Nr*this.ssaoScale),xn=Math.floor(Ir*this.ssaoScale);this.downsampledDepthTarget.setSize(cn,xn),this.ssaoDepthTexture.define(cn,xn),this.ssaoDepthBlurProxyTexture.define(cn,xn);const Rn=Math.floor(.5*cn),er=Math.floor(.5*xn);this.depthHalfTarget.setSize(Rn,er);const ir=Math.floor(.25*cn),Yn=Math.floor(.25*xn);this.depthQuarterTarget.setSize(ir,Yn);const br=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;t.IQ.update(this.depthHalfRenderable.values.tColor,br),t.IQ.update(this.ssaoRenderable.values.tDepth,br),t.IQ.update(this.ssaoRenderable.values.tDepthHalf,this.depthHalfTarget.texture),t.IQ.update(this.ssaoRenderable.values.tDepthQuarter,this.depthQuarterTarget.texture),t.IQ.update(this.downsampleDepthRenderable.values.uTexSize,c.ZY.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,cn,xn)),t.IQ.update(this.depthHalfRenderable.values.uTexSize,c.ZY.set(this.depthHalfRenderable.values.uTexSize.ref.value,Rn,er)),t.IQ.update(this.depthQuarterRenderable.values.uTexSize,c.ZY.set(this.depthQuarterRenderable.values.uTexSize.ref.value,ir,Yn)),t.IQ.update(this.ssaoRenderable.values.uTexSize,c.ZY.set(this.ssaoRenderable.values.uTexSize.ref.value,cn,xn)),t.IQ.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,c.ZY.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,cn,xn)),t.IQ.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,c.ZY.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,cn,xn))}t.IQ.update(this.renderable.values.uOcclusionColor,I.Q1.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,$t.occlusion.params.color))}if("on"===$t.shadow.name&&(t.IQ.update(this.shadowsRenderable.values.uProjection,It.projection),t.IQ.update(this.shadowsRenderable.values.uInvProjection,or),c.Zb.set(this.shadowsRenderable.values.uBounds.ref.value,Or.x/Nr,Or.y/Ir,(Or.x+Or.width)/Nr,(Or.y+Or.height)/Ir),t.IQ.update(this.shadowsRenderable.values.uBounds,this.shadowsRenderable.values.uBounds.ref.value),t.IQ.updateIfChanged(this.shadowsRenderable.values.uNear,It.near),t.IQ.updateIfChanged(this.shadowsRenderable.values.uFar,It.far),this.shadowsRenderable.values.dOrthographic.ref.value!==On&&(t.IQ.update(this.shadowsRenderable.values.dOrthographic,On),yn=!0),t.IQ.updateIfChanged(this.shadowsRenderable.values.uMaxDistance,$t.shadow.params.maxDistance),t.IQ.updateIfChanged(this.shadowsRenderable.values.uTolerance,$t.shadow.params.tolerance),t.IQ.updateIfChanged(this.shadowsRenderable.values.uBias,$t.shadow.params.bias),this.shadowsRenderable.values.dSteps.ref.value!==$t.shadow.params.steps&&(t.IQ.update(this.shadowsRenderable.values.dSteps,$t.shadow.params.steps),yn=!0),t.IQ.update(this.shadowsRenderable.values.uLightDirection,Vt.direction),t.IQ.update(this.shadowsRenderable.values.uLightColor,Vt.color),this.shadowsRenderable.values.dLightCount.ref.value!==Vt.count&&(t.IQ.update(this.shadowsRenderable.values.dLightCount,Vt.count),yn=!0)),"on"===$t.outline.name){const un=null===(Wt=$t.outline.params.includeTransparent)||void 0===Wt||Wt,ct=Math.max(1,Math.round($t.outline.params.scale*this.webgl.pixelRatio))-1,dt=50*$t.outline.params.threshold*this.webgl.pixelRatio;t.IQ.updateIfChanged(this.outlinesRenderable.values.uNear,It.near),t.IQ.updateIfChanged(this.outlinesRenderable.values.uFar,It.far),t.IQ.update(this.outlinesRenderable.values.uInvProjection,or),this.outlinesRenderable.values.dTransparentOutline.ref.value!==un&&(jn=!0,t.IQ.update(this.outlinesRenderable.values.dTransparentOutline,un)),this.outlinesRenderable.values.dOrthographic.ref.value!==On&&(jn=!0,t.IQ.update(this.outlinesRenderable.values.dOrthographic,On)),t.IQ.updateIfChanged(this.outlinesRenderable.values.uOutlineThreshold,dt),t.IQ.update(this.renderable.values.uOutlineColor,I.Q1.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,$t.outline.params.color)),this.renderable.values.dOutlineScale.ref.value!==ct&&(Zt=!0,t.IQ.update(this.renderable.values.dOutlineScale,ct)),this.renderable.values.dTransparentOutline.ref.value!==un&&(Zt=!0,t.IQ.update(this.renderable.values.dTransparentOutline,un))}t.IQ.updateIfChanged(this.renderable.values.uFar,It.far),t.IQ.updateIfChanged(this.renderable.values.uNear,It.near),t.IQ.updateIfChanged(this.renderable.values.uFogFar,It.fogFar),t.IQ.updateIfChanged(this.renderable.values.uFogNear,It.fogNear),t.IQ.update(this.renderable.values.uFogColor,I.Q1.toVec3Normalized(this.renderable.values.uFogColor.ref.value,Ct)),t.IQ.updateIfChanged(this.renderable.values.uTransparentBackground,Dt),this.renderable.values.dOrthographic.ref.value!==On&&(Zt=!0,t.IQ.update(this.renderable.values.dOrthographic,On)),this.renderable.values.dOutlineEnable.ref.value!==fr&&(Zt=!0,t.IQ.update(this.renderable.values.dOutlineEnable,fr)),this.renderable.values.dShadowEnable.ref.value!==Dr&&(Zt=!0,t.IQ.update(this.renderable.values.dShadowEnable,Dr)),this.renderable.values.dOcclusionEnable.ref.value!==Pr&&(Zt=!0,t.IQ.update(this.renderable.values.dOcclusionEnable,Pr)),jn&&this.outlinesRenderable.update(),yn&&this.shadowsRenderable.update(),kt&&this.ssaoRenderable.update(),Ot&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),An&&this.depthHalfRenderable.update(),Zt&&this.renderable.update();const{gl:Jr,state:To}=this.webgl;To.enable(Jr.SCISSOR_TEST),To.disable(Jr.BLEND),To.disable(Jr.DEPTH_TEST),To.depthMask(!1)}setOcclusionOffset(It,Dt){this.occlusionOffset[0]=It,this.occlusionOffset[1]=Dt,t.IQ.update(this.renderable.values.uOcclusionOffset,c.ZY.set(this.renderable.values.uOcclusionOffset.ref.value,It,Dt))}setTransparentBackground(It){this.transparentBackground=It}render(It,Dt,Ct,$t,Vt,Wt){m.g$&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(It,Ct,$t,Vt,Wt);const{gl:yn,state:Zt}=this.webgl,{x:kt,y:Ot,width:An,height:jn}=It.viewport;if("on"===Vt.occlusion.name&&0===this.occlusionOffset[0]&&0===this.occlusionOffset[1]){m.g$&&this.webgl.timer.mark("SSAO.render");const On=Math.floor(kt*this.ssaoScale),fr=Math.floor(Ot*this.ssaoScale),Dr=Math.ceil(An*this.ssaoScale),Pr=Math.ceil(jn*this.ssaoScale);Zt.viewport(On,fr,Dr,Pr),Zt.scissor(On,fr,Dr,Pr),this.ssaoScale<1&&(m.g$&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTarget.bind(),this.downsampleDepthRenderable.render(),m.g$&&this.webgl.timer.markEnd("SSAO.downsample")),m.g$&&this.webgl.timer.mark("SSAO.half"),this.depthHalfTarget.bind(),this.depthHalfRenderable.render(),m.g$&&this.webgl.timer.markEnd("SSAO.half"),m.g$&&this.webgl.timer.mark("SSAO.quarter"),this.depthQuarterTarget.bind(),this.depthQuarterRenderable.render(),m.g$&&this.webgl.timer.markEnd("SSAO.quarter"),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),m.g$&&this.webgl.timer.markEnd("SSAO.render")}Zt.viewport(kt,Ot,An,jn),Zt.scissor(kt,Ot,An,jn),"on"===Vt.outline.name&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),"on"===Vt.shadow.name&&(this.shadowsTarget.bind(),this.shadowsRenderable.render()),Dt?this.webgl.unbindFramebuffer():this.target.bind(),this.background.update(It,Vt.background),this.background.isEnabled(Vt.background)?(this.transparentBackground?Zt.clearColor(0,0,0,0):(I.Q1.toVec3Normalized(this.bgColor,$t),Zt.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),yn.clear(yn.COLOR_BUFFER_BIT),Zt.enable(yn.BLEND),Zt.blendFuncSeparate(yn.SRC_ALPHA,yn.ONE_MINUS_SRC_ALPHA,yn.ONE,yn.ONE_MINUS_SRC_ALPHA),this.background.render()):(Zt.clearColor(0,0,0,1),yn.clear(yn.COLOR_BUFFER_BIT)),this.renderable.render(),m.g$&&this.webgl.timer.markEnd("PostprocessingPass.render")}}class Dn{static isEnabled(It){return"off"!==It.antialiasing.name}constructor(It,Dt,Ct){this.target=It.createRenderTarget(Dt,Ct,!1),this.internalTarget=It.createRenderTarget(Dt,Ct,!1),this.fxaa=new d(It,this.target.texture),this.smaa=new w(It,this.target.texture),this.cas=new Lt(It,this.target.texture)}setSize(It,Dt){const Ct=this.target.texture.getWidth(),$t=this.target.texture.getHeight();(It!==Ct||Dt!==$t)&&(this.target.setSize(It,Dt),this.internalTarget.setSize(It,Dt),this.fxaa.setSize(It,Dt),this.smaa.supported&&this.smaa.setSize(It,Dt),this.cas.setSize(It,Dt))}_renderFxaa(It,Dt,Ct,$t){"fxaa"===$t.antialiasing.name&&(this.fxaa.update(Dt,$t.antialiasing.params),this.fxaa.render(It.viewport,Ct))}_renderSmaa(It,Dt,Ct,$t){"smaa"===$t.antialiasing.name&&(this.smaa.update(Dt,$t.antialiasing.params),this.smaa.render(It.viewport,Ct))}_renderAntialiasing(It,Dt,Ct,$t){"fxaa"===$t.antialiasing.name?this._renderFxaa(It,Dt,Ct,$t):"smaa"===$t.antialiasing.name&&this._renderSmaa(It,Dt,Ct,$t)}_renderCas(It,Dt,Ct,$t){"on"===$t.sharpening.name&&("off"!==$t.antialiasing.name&&(Dt=this.internalTarget.texture),this.cas.update(Dt,$t.sharpening.params),this.cas.render(It.viewport,Ct))}render(It,Dt,Ct,$t){if("off"===$t.antialiasing.name&&"off"===$t.sharpening.name)return;if("smaa"===$t.antialiasing.name&&!this.smaa.supported)return void console.error('SMAA not supported, missing "HTMLImageElement"');const Vt=!0===Ct?void 0:!1===Ct?this.target:Ct;"off"===$t.sharpening.name?this._renderAntialiasing(It,Dt,Vt,$t):("off"===$t.antialiasing.name||this._renderAntialiasing(It,Dt,this.internalTarget,$t),this._renderCas(It,Dt,Vt,$t))}}},6345:(tn,Ue,n)=>{"use strict";n.d(Ue,{H5:()=>r,PG:()=>A});var e=n(467);function r(c,i,v=1){let O=window.innerWidth,b=window.innerHeight;i!==document.body&&(O=i.offsetWidth,b=i.offsetHeight),function o(c,i,v,O=1){c.width=Math.round(window.devicePixelRatio*O*i),c.height=Math.round(window.devicePixelRatio*O*v),Object.assign(c.style,{width:`${i}px`,height:`${v}px`})}(c,O,b,v)}function A(c,i,v){return y.apply(this,arguments)}function y(){return(y=(0,e.A)(function*(c,i,v){return new Promise((O,b)=>{const _=M=>{M?O(M):b("no blob returned")};HTMLCanvasElement.prototype.toBlob?c.toBlob(_,i,v):function t(c,i,v,O){const b=atob(c.toDataURL(v,O).split(",")[1]),_=b.length,M=_>>2,I=new Uint8Array(_),l=new Uint32Array(I.buffer,0,M);let m=0;for(let d=0;d<M;++d)l[d]=b.charCodeAt(m++)|b.charCodeAt(m++)<<8|b.charCodeAt(m++)<<16|b.charCodeAt(m++)<<24;let u=3&_;for(;u--;)I[m]=b.charCodeAt(m++);i(new Blob([I],{type:v||"image/png"}))}(c,_,i,v)})})).apply(this,arguments)}},6651:(tn,Ue,n)=>{"use strict";n.d(Ue,{VP:()=>O,iu:()=>e,Wm:()=>w,XI:()=>L});var e={};function o(Q,G){return{start:G&&typeof G.start<"u"?Math.max(Math.min(G.start,Q-1),0):0,end:G&&typeof G.end<"u"?Math.min(G.end,Q):Q}}function r(Q,G){const V=G&&typeof G.array<"u"?G.array:Array,{start:U,end:N}=o(Q,G);return{array:new V(N-U),start:U,end:N}}function t(Q,G,V){for(let U=0,N=G.length;U<N;U++)G[U]=Q(V+U);return G}function A(Q,G,V){const{array:U,start:N}=r(Q,V);return t(G,U,N)}function y(Q){return!!Q.buffer&&"number"==typeof Q.byteLength&&"number"==typeof Q.BYTES_PER_ELEMENT}function c(Q,G){const{constructor:V,buffer:U,length:N,byteOffset:k,BYTES_PER_ELEMENT:H}=Q,{start:$,end:J}=o(N,G);return 0===$&&J===N?Q:new V(U,k+H*$,Math.min(N,J-$))}n.r(e),n.d(e,{createAndFillArray:()=>A,createArray:()=>r,fillArrayValues:()=>t,getArrayBounds:()=>o,isTypedArray:()=>y,typedArrayWindow:()=>c});var O,i=n(4369),v=n(2025);function M(Q,G,V,U){return{schema:V,__array:void 0,isDefined:0===U,rowCount:G,value:k=>Q,valueKind:k=>U,toArray:k=>{const{array:H}=r(G,k);for(let $=0,J=H.length;$<J;$++)H[$]=Q;return H},areValuesEqual:(k,H)=>!0}}function I({value:Q,valueKind:G,areValuesEqual:V,rowCount:U,schema:N}){return{schema:N,__array:void 0,isDefined:!0,rowCount:U,value:Q,valueKind:G||(k=>0),toArray:k=>{const{array:H,start:$}=r(U,k);for(let J=0,W=H.length;J<W;J++)H[J]=Q(J+$);return H},areValuesEqual:V||((k,H)=>Q(k)===Q(H))}}function l({array:Q,schema:G,valueKind:V}){const U=Q.length,N=G.T,k="str"===G.valueType?"lowercase"===G.transform?$=>{const J=Q[$];return"string"==typeof J?J.toLowerCase():`${J??N}`.toLowerCase()}:"uppercase"===G.transform?$=>{const J=Q[$];return"string"==typeof J?J.toUpperCase():`${J??N}`.toUpperCase()}:$=>{const J=Q[$];return"string"==typeof J?J:`${J??N}`}:$=>Q[$],H=y(Q);return{schema:G,__array:Q,isDefined:!0,rowCount:U,value:k,valueKind:V||($=>0),toArray:"str"===G.valueType?"lowercase"===G.transform?$=>{const{start:J,end:W}=o(U,$),te=new($&&typeof $.array<"u"?$.array:Q.constructor)(W-J);for(let de=0,ye=W-J;de<ye;de++){const j=Q[J+de];te[de]="string"==typeof j?j.toLowerCase():`${j??N}`.toLowerCase()}return te}:"uppercase"===G.transform?$=>{const{start:J,end:W}=o(U,$),te=new($&&typeof $.array<"u"?$.array:Q.constructor)(W-J);for(let de=0,ye=W-J;de<ye;de++){const j=Q[J+de];te[de]="string"==typeof j?j.toUpperCase():`${j??N}`.toUpperCase()}return te}:$=>{const{start:J,end:W}=o(U,$),te=new($&&typeof $.array<"u"?$.array:Q.constructor)(W-J);for(let de=0,ye=W-J;de<ye;de++){const j=Q[J+de];te[de]="string"==typeof j?j:`${j??N}`}return te}:H?$=>c(Q,$):$=>{const{start:J,end:W}=o(U,$);if(0===J&&W===Q.length)return Q;const te=new($&&typeof $.array<"u"?$.array:Q.constructor)(W-J);for(let de=0,ye=W-J;de<ye;de++)te[de]=Q[J+de];return te},areValuesEqual:($,J)=>Q[$]===Q[J]}}!function(Q){let G;function U(ke,we){return M(we.T,ke,we,1)}function k(ke){return I(ke)}!function(ke){function Ve(Te,ie=ke.float){return{"@type":"tensor",T:Te.create(),space:Te,valueType:"tensor",baseType:ie}}ke.str={"@type":"str",T:"",valueType:"str"},ke.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},ke.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},ke.int={"@type":"int",T:0,valueType:"int"},ke.coord={"@type":"coord",T:0,valueType:"float"},ke.float={"@type":"float",T:0,valueType:"float"},ke.Str=function we(Te){var ie;return{"@type":"str",T:null!==(ie=Te?.defaultValue)&&void 0!==ie?ie:"",transform:Te?.transform,valueType:"str"}},ke.Int=function Oe(Te=0){return{"@type":"int",T:Te,valueType:"int"}},ke.Float=function Se(Te=0){return{"@type":"float",T:Te,valueType:"float"}},ke.Tensor=Ve,ke.Vector=function Ne(Te,ie=ke.float){return Ve(i.qY.Vector(Te,"int"===ie["@type"]?Int32Array:Float64Array),ie)},ke.Matrix=function K(Te,ie,ue=ke.float){return Ve(i.qY.ColumnMajorMatrix(Te,ie,"int"===ue["@type"]?Int32Array:Float64Array),ue)},ke.Aliased=function ne(Te){return Te},ke.List=function be(Te,ie,ue=[]){return{"@type":"list",T:ue,separator:Te,itemParse:ie,valueType:"list"}}}(G=Q.Schema||(Q.Schema={})),Q.is=function V(ke){return!!ke&&!!ke.schema&&!!ke.value},Q.ValueKind={Present:0,NotPresent:1,Unknown:2},Q.Undefined=U,Q.ofConst=function N(ke,we,Oe){return M(ke,we,Oe,0)},Q.ofLambda=k,Q.range=function H(ke,we){return k({value:Oe=>Oe+ke,rowCount:Math.max(we-ke+1,0),schema:G.int})},Q.ofArray=function $(ke){return l(ke)},Q.ofIntArray=function J(ke){return l({array:ke,schema:G.int})},Q.ofFloatArray=function W(ke){return l({array:ke,schema:G.float})},Q.ofStringArray=function te(ke){return l({array:ke,schema:G.str})},Q.ofStringAliasArray=function de(ke){return l({array:ke,schema:G.Aliased(G.str)})},Q.ofStringListArray=function ye(ke,we=","){return l({array:ke,schema:G.List(we,Oe=>Oe)})},Q.ofIntTokens=function j(ke){const{count:we,data:Oe,indices:Se}=ke;return I({value:Ve=>(0,v.H9)(Oe,Se[2*Ve],Se[2*Ve+1])||0,rowCount:we,schema:G.int})},Q.ofFloatTokens=function Z(ke){const{count:we,data:Oe,indices:Se}=ke;return I({value:Ve=>(0,v.sS)(Oe,Se[2*Ve],Se[2*Ve+1])||0,rowCount:we,schema:G.float})},Q.ofStringTokens=function q(ke){const{count:we,data:Oe,indices:Se}=ke;return I({value:Ve=>{const Ne=Oe.substring(Se[2*Ve],Se[2*Ve+1]);return"."===Ne||"?"===Ne?"":Ne},rowCount:we,schema:G.str})},Q.window=function Y(ke,we,Oe){return function m(Q,G,V){return Q.isDefined?0===G&&V===Q.rowCount?Q:Q.__array&&y(Q.__array)?function u(Q,G,V){const U=c(Q.__array,{start:G,end:V}),N=Q.valueKind;return l({array:U,schema:Q.schema,valueKind:k=>N(G+k)})}(Q,G,V):function d(Q,G,V){const U=Q.value,N=Q.valueKind,k=Q.areValuesEqual,H=0===G?U:J=>U(J+G),$=V-G;return{schema:Q.schema,__array:void 0,isDefined:Q.isDefined,rowCount:$,value:H,valueKind:0===G?N:J=>N(J+G),toArray:J=>{const{array:W}=r($,J);for(let te=0,de=W.length;te<de;te++)W[te]=U(te+G);return W},areValuesEqual:0===G?k:(J,W)=>k(J+G,W+G)}}(Q,G,V):O.Undefined(V-G,Q.schema)}(ke,we,Oe)},Q.view=function ee(ke,we,Oe=!0){return function C(Q,G,V){return 0===Q.rowCount||V&&function s(Q,G){if(Q.length!==G)return!1;for(let V=0,U=Q.length;V<U;V++)if(Q[V]!==V)return!1;return!0}(G,Q.rowCount)?Q:Q.__array&&typeof Q.value(0)==typeof Q.__array[0]?function h(Q,G){const V=Q.__array,U=new V.constructor(G.length);for(let k=0,H=G.length;k<H;k++)U[k]=V[G[k]];const N=Q.valueKind;return l({array:U,schema:Q.schema,valueKind:k=>N(G[k])})}(Q,G):function a(Q,G){const V=Q.value,U=Q.valueKind,N=Q.areValuesEqual,H=G.length;return{schema:Q.schema,__array:void 0,isDefined:Q.isDefined,rowCount:H,value:$=>V(G[$]),valueKind:$=>U(G[$]),toArray:$=>{const{array:J}=r(H,$);for(let W=0,te=J.length;W<te;W++)J[W]=V(G[W]);return J},areValuesEqual:($,J)=>N(G[$],G[J])}}(Q,G)}(ke,we,Oe)},Q.createFirstIndexMap=function g(ke){return function b(Q){const G=new Map;for(let V=0,U=Q.rowCount;V<U;V++){const N=Q.value(V);G.has(N)||G.set(Q.value(V),V)}return G}(ke)},Q.createIndexer=function _e(ke){return function _(Q){const G=new Map;for(let V=0,U=Q.rowCount;V<U;V++){const N=Q.value(V);G.has(N)||G.set(Q.value(V),V)}return V=>G.has(V)?G.get(V):-1}(ke)},Q.mapToArray=function xe(ke,we,Oe){return function S(Q,G,V){const U=new V(Q.rowCount);for(let N=0,k=Q.rowCount;N<k;N++)U[N]=G(Q.value(N));return U}(ke,we,Oe||Array)},Q.areEqual=function le(ke,we){return function D(Q,G){return Q===G||Q.rowCount===G.rowCount&&Q.isDefined===G.isDefined&&Q.schema.valueType===G.schema.valueType&&(Q.__array&&G.__array?function R(Q,G){const V=Q.__array,U=G.__array;for(let N=0,k=Q.rowCount;N<k;N++)if(V[N]!==U[N])return!1;return!0}(Q,G):function f(Q,G){const V=Q.value,U=G.value;for(let N=0,k=Q.rowCount;N<k;N++)if(V(N)!==U(N))return!1;return!0}(Q,G))}(ke,we)},Q.indicesOf=function Ae(ke,we){return function p(Q,G){const V=[],U=Q.value;for(let N=0,k=Q.rowCount;N<k;N++)G(U(N))&&(V[V.length]=N);return V}(ke,we)},Q.asArrayColumn=function Be(ke,we){return ke.__array?ke:ke.isDefined?l({array:ke.toArray({array:we}),schema:ke.schema,valueKind:ke.valueKind}):U(ke.rowCount,ke.schema)},Q.copyToArray=function Ce(ke,we,Oe=0){if(!ke.isDefined)return;const Se=ke.__array;if(Se)for(let Ve=0,Ne=Se.length;Ve<Ne;Ve++)we[Oe+Ve]=Se[Ve];else for(let Ve=0,Ne=ke.rowCount;Ve<Ne;Ve++)we[Oe+Ve]=ke.value(Ve)},Q.isIdentity=function Re(ke){for(let we=0,Oe=ke.rowCount;we<Oe;we++)if(we!==ke.value(we))return!1;return!0}}(O||(O={}));var L,w,Q,E=n(5527),T=n(9909);!function(Q){function J(xe,le,Ae){const Be=Object.create(null),Ce=Object.keys(le);Be._rowCount=Ae.length,Be._columns=Ce,Be._schema=le;for(const Re of Ce)Be[Re]=O.view(xe[Re],Ae);return Be}function q(xe,le){const Ae=Object.create(null),{_columns:Be}=xe;for(let Ce=0;Ce<Be.length;Ce++){const Re=Be[Ce];Ae[Re]=xe[Re].value(le)}return Ae}Q.is=function G(xe){return xe&&"number"==typeof xe._rowCount&&!!xe._columns&&!!xe._schema},Q.pickColumns=function V(xe,le,Ae={}){const Be=Object.create(null),Ce=Object.keys(xe);Be._rowCount=le._rowCount,Be._columns=Ce,Be._schema=xe;for(const Re of Ce)if(le[Re])Be[Re]=le[Re];else{if(!Ae[Re])throw Error(`Cannot find column '${Re}'.`);Be[Re]=Ae[Re]}return Be},Q.ofColumns=function U(xe,le){const Ae=Object.keys(le);return{_rowCount:le[Ae[0]].rowCount,_columns:Ae,_schema:xe,...le}},Q.ofPartialColumns=function N(xe,le,Ae){const Be=Object.create(null),Ce=Object.keys(xe);Be._rowCount=Ae,Be._columns=Ce,Be._schema=xe;for(const Re of Ce)Be[Re]=Re in le?le[Re]:O.Undefined(Ae,xe[Re]);return Be},Q.ofUndefinedColumns=function k(xe,le){const Ae=Object.create(null),Be=Object.keys(xe);Ae._rowCount=le,Ae._columns=Be,Ae._schema=xe;for(const Ce of Be)Ae[Ce]=O.Undefined(le,xe[Ce]);return Ae},Q.ofRows=function H(xe,le){const Ae=Object.create(null),Be=le.length,Ce=Object.keys(xe);Ae._rowCount=Be,Ae._columns=Ce,Ae._schema=xe;for(const Re of Ce)Ae[Re]=O.ofLambda({rowCount:Be,schema:xe[Re],value:ke=>le[ke][Re],valueKind:ke=>typeof le[ke][Re]>"u"?1:0});return Ae},Q.ofArrays=function $(xe,le){var Ae;const Be=Object.create(null),Ce=Object.keys(xe);Be._rowCount=0,Be._columns=Ce,Be._schema=xe;for(const Re of Ce)typeof le[Re]<"u"?(Be[Re]=O.ofArray({array:le[Re],schema:xe[Re]}),Be._rowCount=null===(Ae=le[Re])||void 0===Ae?void 0:Ae.length):Be[Re]=O.Undefined(Be._rowCount,xe[Re]);return Be},Q.view=J,Q.pick=function W(xe,le,Ae){const Be=[];for(let Ce=0,Re=xe._rowCount;Ce<Re;++Ce)Ae(Ce)&&Be.push(Ce);return J(xe,le,Be)},Q.window=function te(xe,le,Ae,Be){if(0===Ae&&Be===xe._rowCount)return xe;const Ce=Object.create(null),Re=Object.keys(le);Ce._rowCount=Be-Ae,Ce._columns=Re,Ce._schema=le;for(const ke of Re)Ce[ke]=O.window(xe[ke],Ae,Be);return Ce},Q.concat=function de(xe,le){const Ae=Object.create(null),Be=Object.keys(le);Ae._rowCount=0;for(const ke of xe)Ae._rowCount+=ke._rowCount;const Ce={};for(const ke of Be)Ce[ke]=new Array(Ae._rowCount);Ae._columns=Be,Ae._schema=le;let Re=0;for(const ke of xe){for(const we of Be)O.copyToArray(ke[we],Ce[we],Re);Re+=ke._rowCount}for(const ke of Be)Ae[ke]=O.ofArray({array:Ce[ke],schema:le[ke]});return Ae},Q.columnToArray=function ye(xe,le,Ae){xe[le]=O.asArrayColumn(xe[le],Ae)},Q.sort=function j(xe,le){const Ae=new Int32Array(xe._rowCount);for(let Re=0,ke=Ae.length;Re<ke;Re++)Ae[Re]=Re;(0,E.eh)(Ae,(Re,ke,we)=>le(ke,we));let Be=!0;for(let Re=0,ke=Ae.length;Re<ke;Re++)if(Ae[Re]!==Re){Be=!1;break}if(Be)return xe;const Ce=Object.create(null);Ce._rowCount=xe._rowCount,Ce._columns=xe._columns,Ce._schema=xe._schema;for(const Re of xe._columns)Ce[Re]=O.view(xe[Re],Ae,!1);return Ce},Q.areEqual=function Z(xe,le){if(xe._rowCount!==le._rowCount||xe._columns.length!==le._columns.length)return!1;for(const Ae of xe._columns)if(!le[Ae])return!1;for(const Ae of xe._columns)if(!O.areEqual(xe[Ae],le[Ae]))return!1;return!0},Q.getRow=q,Q.pickRow=function Y(xe,le){for(let Ae=0,Be=xe._rowCount;Ae<Be;++Ae)if(le(Ae))return q(xe,Ae)},Q.getRows=function ee(xe){const le=[],{_rowCount:Ae}=xe;for(let Be=0;Be<Ae;Be++)le[Be]=q(xe,Be);return le},Q.toArrays=function g(xe){const le={},{_columns:Ae}=xe;for(let Be=0;Be<Ae.length;Be++){const Ce=Ae[Be];le[Ce]=xe[Ce].toArray()}return le},Q.formatToString=function _e(xe){const le=T.fe.create(),{_columns:Ae,_rowCount:Be}=xe;let Ce=1;T.fe.write(le,"|");for(let Re=0;Re<Ae.length;Re++)T.fe.write(le,Ae[Re]),T.fe.write(le,"|"),Ce+=Ae[Re].length+1;T.fe.newline(le),T.fe.write(le,new Array(Ce+1).join("-")),T.fe.newline(le);for(let Re=0;Re<Be;Re++){T.fe.write(le,"|");for(let ke=0;ke<Ae.length;ke++){const we=xe[Ae[ke]];0===we.valueKind(Re)?(T.fe.write(le,we.value(Re)),T.fe.write(le,"|")):T.fe.write(le,".|")}T.fe.newline(le)}return T.fe.getString(le)}}(L||(L={})),(Q=w||(w={})).ofTables=function G(U,N,k){const H=Object.keys(k),$=Object.create(null),J=[];$._name=U,$._tableNames=J,$._schema=N;for(const W of H)L.is(k[W])&&($[W]=k[W],J[J.length]=W);return $},Q.getTablesAsRows=function V(U){const N={};for(const k of U._tableNames)N[k]=L.getRows(U[k]);return N}},9677:(tn,Ue,n)=>{"use strict";n.d(Ue,{bw:()=>o,wl:()=>r,th:()=>y});class e{add(i){const v=this.getHash(i);if(this.byHash.has(v)){const O=this.byHash.get(v);for(let b=0,_=O.length;b<_;b++)if(this.areEqual(i,O[b]))return!1;return O[O.length]=i,this.size++,!0}return this.byHash.set(v,[i]),this.size++,!0}has(i){const v=this.getHash(i);if(!this.byHash.has(v))return!1;const O=this.byHash.get(v);for(let b=0,_=O.length;b<_;b++)if(this.areEqual(i,O[b]))return!0;return!1}constructor(i,v){this.getHash=i,this.areEqual=v,this.size=0,this.byHash=new Map}}function o(c,i){return new e(c,i)}function r(){return new A}function t(c){return{previous:null,next:null,inList:!0,value:c}}class A{constructor(){this.count=0,this.first=null,this.last=null}addFirst(i){const v=t(i);return v.inList=!0,this.first&&(this.first.previous=v),v.next=this.first,this.first=v,this.count++,this.last||(this.last=v),v}addLast(i){const v=t(i);return null!==this.last&&(this.last.next=v),v.previous=this.last,this.last=v,null===this.first&&(this.first=v),v.inList=!0,this.count++,v}removeFirst(){const i=this.first;if(i)return this.remove(i),i.value}removeLast(){const i=this.last;if(i)return this.remove(i),i.value}remove(i){i.inList&&(i.inList=!1,null!==i.previous?i.previous.next=i.next:null===i.previous&&(this.first=i.next),null!==i.next?i.next.previous=i.previous:null===i.next&&(this.last=i.previous),i.next=null,i.previous=null,this.count--)}find(i){let v=this.first;for(;null!==v;){if(v.value===i)return v;v=v.next}}}var y,c;(c=y||(y={})).create=function i(){return{keys:new Set,array:[]}},c.add=function v({keys:b,array:_},M,I){return!b.has(M)&&(b.add(M),_[_.length]=I,!0)},c.has=function O({keys:b},_){return b.has(_)}},3543:(tn,Ue,n)=>{"use strict";n.d(Ue,{Yz:()=>v,IX:()=>e.I,YB:()=>y,CD:()=>o.C,hT:()=>r.h,SortedArray:()=>t.X});var e=n(7103),o=n(5100),r=n(2928),t=n(1839);function y(b){return new c(b)}n(3370);class c{remove(_){const{prev:M,next:I}=this,l=M[_],m=I[_];l>=0&&(I[l]=m,M[_]=-1),m>=0&&(M[m]=l,I[_]=-1),_===this.head&&(this.head=l<0?m:l)}has(_){return this.prev[_]>=0||this.next[_]>=0||this.head===_}constructor(_){this.head=_>0?0:-1,this.prev=new Int32Array(_),this.next=new Int32Array(_);for(let M=0;M<_;M++)this.next[M]=M+1,this.prev[M]=M-1;this.prev[0]=-1,this.next[_-1]=-1}}var v,i=n(8382);!function(b){function M(){return new Map}b.Empty=new Map,b.keyArray=function _(u){return(0,i.ZR)(u.keys())},b.Mutable=M,b.asImmutable=function I(u){return u},b.copy=function l(u){const d=M(),s=u.keys();for(;;){const{done:C,value:h}=s.next();if(C)break;d.set(h,u.get(h))}return d},b.addFrom=function m(u,d){const s=d.keys();for(;;){const{done:C,value:h}=s.next();if(C)break;u.set(h,d.get(h))}return u}}(v||(v={})),n(862)},7103:(tn,Ue,n)=>{"use strict";n.d(Ue,{I:()=>R});var e=n(3370);const o=e.U.Zero;function r(f,p){return e.U.create(f,p<f?f:p+1)}function t(f,p){return e.U.create(f,p<=f?f:p)}const y=e.U.is,c=e.U.fst,i=e.U.snd,v=e.U.fst;function O(f){return e.U.snd(f)-1}const b=e.U.diff,_=e.U.hashCode,M=e.U.toString;const u=e.U.areEqual;function d(f,p){const E=b(f),T=b(p);return 0===E&&0===T||E>0&&T>0&&O(f)>=v(p)&&v(f)<=O(p)}function C(f,p){const E=c(f);if(p<=E)return 0;const T=i(f);return p>=T?T-E:p-E}function a(f,p,E){return t(C(f,p),C(f,E+1))}var R,f;(f=R||(R={})).Empty=o,f.ofSingleton=p=>r(p,p),f.ofRange=r,f.ofBounds=t,f.ofLength=function A(f){return e.U.create(0,f<0?0:f)},f.is=y,f.has=function I(f,p){return e.U.fst(f)<=p&&p<e.U.snd(f)},f.indexOf=function l(f,p){const E=c(f);return p>=E&&p<i(f)?p-E:-1},f.getAt=function m(f,p){return e.U.fst(f)+p},f.start=c,f.end=i,f.min=v,f.max=O,f.size=b,f.hashCode=_,f.toString=M,f.areEqual=u,f.areIntersecting=d,f.isSubInterval=function s(f,p){return b(f)?!b(p)||c(f)<=c(p)&&i(f)>=i(p):0===b(p)},f.findPredecessorIndex=C,f.findPredecessorIndexInInterval=function h(f,p,E){const T=c(E),L=c(f);if(p<=T+L)return T;const w=i(E);return p>=w+L?w:p-L},f.findRange=a,f.intersectionSize=function D(f,p){return b(a(f,v(p),O(p)))},f.intersect=function S(f,p){return d(f,p)?t(Math.max(c(f),c(p)),Math.min(i(f),i(p))):o}},5100:(tn,Ue,n)=>{"use strict";n.d(Ue,{C:()=>ye});var e=n(1839),o=n(7103);const r=o.I.Empty,t=o.I.ofSingleton,A=o.I.ofRange,y=o.I.ofBounds;function c(j){return j.length?e.X.isRange(j)?o.I.ofRange(j[0],j[j.length-1]):j:r}function i(j){return o.I.is(j)?o.I.size(j):e.X.size(j)}function b(j,Z){return o.I.is(j)?o.I.getAt(j,Z):j[Z]}function _(j){return o.I.is(j)?o.I.min(j):e.X.min(j)}function M(j){return o.I.is(j)?o.I.max(j):e.X.max(j)}function E(j,Z){return o.I.size(j)===e.X.size(Z)&&o.I.start(j)===e.X.start(Z)&&o.I.end(j)===e.X.end(Z)}function T(j,Z){return 0!==j.length&&0!==o.I.size(e.X.findRange(j,o.I.min(Z),o.I.max(Z)))}function U(j,Z){const q=o.I.size(Z);if(!q)return j;if(function G(j,Z){return i(j)?!i(Z)||_(j)<=_(Z)&&M(j)>=M(Z):0===i(Z)}(Z,j))return Z;const Y=o.I.min(Z),ee=o.I.max(Z),g=e.X.findRange(j,Y,ee),_e=o.I.start(g),xe=o.I.end(g),le=new Int32Array(_e+(j.length-xe)+q);let Ae=0;for(let Be=0;Be<_e;Be++)le[Ae++]=j[Be];for(let Be=Y;Be<=ee;Be++)le[Ae++]=Be;for(let Be=xe,Ce=j.length;Be<Ce;Be++)le[Ae++]=j[Be];return c(le)}function N(j,Z){if(!o.I.size(Z))return 0;const q=e.X.findRange(j,o.I.min(Z),o.I.max(Z));return o.I.end(q)-o.I.start(q)}function k(j,Z){if(!o.I.size(Z))return r;const q=e.X.findRange(j,o.I.min(Z),o.I.max(Z)),Y=o.I.start(q),ee=o.I.end(q),g=ee-Y;if(!g)return r;if(g===j.length)return j;const _e=new Int32Array(g);let xe=0;for(let le=Y;le<ee;le++)_e[xe++]=j[le];return c(_e)}var ye,j;(j=ye||(ye={})).Empty=r,j.ofSingleton=t,j.ofRange=A,j.ofBounds=y,j.ofSortedArray=c,j.has=function v(j,Z){return o.I.is(j)?o.I.has(j,Z):e.X.has(j,Z)},j.indexOf=function O(j,Z){return o.I.is(j)?o.I.indexOf(j,Z):e.X.indexOf(j,Z)},j.getAt=b,j.min=_,j.max=M,j.start=function I(j){return o.I.is(j)?o.I.start(j):e.X.start(j)},j.end=function l(j){return o.I.is(j)?o.I.end(j):e.X.end(j)},j.size=i,j.hashCode=function m(j){return o.I.is(j)?o.I.hashCode(j):e.X.hashCode(j)},j.areEqual=function d(j,Z){return o.I.is(j)?o.I.is(Z)?o.I.areEqual(j,Z):E(j,Z):o.I.is(Z)?E(Z,j):e.X.areEqual(j,Z)},j.areIntersecting=function s(j,Z){return o.I.is(j)?o.I.is(Z)?o.I.areIntersecting(j,Z):T(Z,j):o.I.is(Z)?T(j,Z):e.X.areIntersecting(j,Z)},j.isSubset=function C(j,Z){return o.I.is(j)?o.I.is(Z)?o.I.isSubInterval(j,Z):function w(j,Z){const q=o.I.min(j),Y=o.I.max(j);if(Y-q+1==0)return!1;const ee=e.X.min(Z),g=e.X.max(Z);return ee>=q&&g<=Y}(j,Z):o.I.is(Z)?function L(j,Z){const q=o.I.min(Z),Y=o.I.max(Z);if(Y-q+1==0)return!0;const ee=e.X.min(j),g=e.X.max(j);if(q<ee||Y>g)return!1;const _e=e.X.findRange(j,q,Y);return o.I.size(_e)===o.I.size(Z)}(j,Z):e.X.isSubset(j,Z)},j.union=function R(j,Z){return o.I.is(j)?o.I.is(Z)?function V(j,Z){if(o.I.areEqual(j,Z))return j;const q=o.I.size(j),Y=o.I.size(Z);if(!Y)return j;if(!q)return Z;const ee=o.I.min(j),g=o.I.min(Z);if(function Q(j,Z){const q=i(j),Y=i(Z);return 0===q&&0===Y||q>0&&Y>0&&M(j)>=_(Z)&&_(j)<=M(Z)}(j,Z))return o.I.ofRange(Math.min(ee,g),Math.max(o.I.max(j),o.I.max(Z)));let _e,xe,le,Ae;ee<g?(_e=q,xe=ee,le=Y,Ae=g):(_e=Y,xe=g,le=q,Ae=ee);const Be=new Int32Array(q+Y);for(let Ce=0;Ce<_e;Ce++)Be[Ce]=Ce+xe;for(let Ce=0;Ce<le;Ce++)Be[Ce+_e]=Ce+Ae;return c(Be)}(j,Z):U(Z,j):o.I.is(Z)?U(j,Z):c(e.X.union(j,Z))},j.intersect=function f(j,Z){return o.I.is(j)?o.I.is(Z)?o.I.intersect(j,Z):k(Z,j):o.I.is(Z)?k(j,Z):c(e.X.intersect(j,Z))},j.indexedIntersect=function de(j,Z,q){if(Z===q)return j;const Y=i(j),ee=Z.length,g=q.length;if(0===Y||0===ee||0===g)return r;const _e=e.X.findPredecessorIndex(q,Z[_(j)]),xe=e.X.findPredecessorIndex(q,Z[M(j)]+1);let le=0,Ae=0,Be=0,Ce=_e;for(;Be<Y&&Ce<xe;){const ke=Z[b(j,Be)],we=q[Ce];ke<we?Be++:(ke>we||(le++,Be++),Ce++)}if(0===le)return r;if(le===ee&&le===g)return j;const Re=new Int32Array(le);for(Ae=0,Be=0,Ce=_e;Be<Y&&Ce<xe;){const ke=Z[b(j,Be)],we=q[Ce];ke<we?Be++:(ke>we||(Re[Ae++]=Ce,Be++),Ce++)}return c(Re)},j.subtract=function p(j,Z){return o.I.is(j)?o.I.is(Z)?function H(j,Z){if(o.I.areEqual(j,Z))return r;if(!o.I.areIntersecting(j,Z))return j;const q=o.I.min(j),Y=o.I.max(j),ee=o.I.min(Z),g=o.I.max(Z);if(Y<q||g<ee)return j;if(o.I.isSubInterval(Z,j))return r;if(o.I.isSubInterval(j,Z)){const _e=ee-q,xe=Y-g;if(_e<=0)return o.I.ofRange(g+1,g+xe);if(xe<=0)return o.I.ofRange(q,q+_e-1);const le=new Int32Array(_e+xe);let Ae=0;for(let Be=0;Be<_e;Be++)le[Ae++]=q+Be;for(let Be=1;Be<=xe;Be++)le[Ae++]=g+Be;return c(le)}return q<ee?o.I.ofRange(q,ee-1):o.I.ofRange(g+1,Y)}(j,Z):function J(j,Z){const q=o.I.min(j),Y=o.I.max(j);if(Y<q)return j;const ee=Y-q+1,g=e.X.findRange(Z,q,Y),_e=o.I.start(g),xe=o.I.end(g),le=xe-_e;if(0===le)return j;const Ae=ee-le;if(Ae<=0)return r;const Be=new Int32Array(Ae),Ce=Z.length-1,Re=Z[Math.min(_e,Ce)],ke=Z[Math.min(xe,Ce)];let we=0;for(let Oe=q;Oe<Re;Oe++)Be[we++]=Oe;for(let Oe=Re;Oe<=ke;Oe++)e.X.indexOfInInterval(Z,Oe,g)<0&&(Be[we++]=Oe);for(let Oe=ke+1;Oe<=Y;Oe++)Be[we++]=Oe;return c(Be)}(j,Z):o.I.is(Z)?function $(j,Z){const q=o.I.min(Z),Y=o.I.max(Z);if(Y<q)return j;const ee=e.X.findRange(j,q,Y),g=o.I.start(ee),_e=o.I.end(ee),xe=j.length-(_e-g);if(xe<=0)return r;if(xe===j.length)return j;const le=new Int32Array(xe);let Ae=0;for(let Be=0;Be<g;Be++)le[Ae++]=j[Be];for(let Be=_e,Ce=j.length;Be<Ce;Be++)le[Ae++]=j[Be];return c(le)}(j,Z):c(e.X.subtract(j,Z))},j.findPredecessorIndex=function h(j,Z){return o.I.is(j)?o.I.findPredecessorIndex(j,Z):e.X.findPredecessorIndex(j,Z)},j.findPredecessorIndexInInterval=function a(j,Z,q){return o.I.is(j)?o.I.findPredecessorIndexInInterval(j,Z,q):e.X.findPredecessorIndexInInterval(j,Z,q)},j.findRange=function S(j,Z,q){return o.I.is(j)?o.I.findRange(j,Z,q):e.X.findRange(j,Z,q)},j.intersectionSize=function D(j,Z){return o.I.is(j)?o.I.is(Z)?o.I.intersectionSize(j,Z):N(Z,j):o.I.is(Z)?N(j,Z):e.X.intersectionSize(j,Z)},j.forEach=function Z(xe,le,Ae){return function W(j,Z,q){if(o.I.is(j)){const Y=o.I.min(j);for(let ee=Y,g=o.I.max(j);ee<=g;ee++)Z(ee,ee-Y,q)}else for(let Y=0,ee=j.length;Y<ee;Y++)Z(j[Y],Y,q);return q}(xe,le,Ae)},j.forEachSegment=function q(xe,le,Ae,Be){return function te(j,Z,q,Y){if(o.I.is(j)){let ee=0;for(let g=o.I.min(j),_e=o.I.max(j);g<=_e;g++){const xe=Z(g);let le=g+1;for(;le<_e&&Z(le)===xe;)le++;g=le-1,q(xe,ee,Y),ee++}}else{let ee=0;for(let g=0,_e=j.length;g<_e;g++){const xe=Z(j[g]);let le=g+1;for(;le<_e&&Z(j[le])===xe;)le++;g=le-1,q(xe,ee,Y),ee++}}return Y}(xe,le,Ae,Be)},j.isInterval=function Y(xe){return o.I.is(xe)},j.isSortedArray=function ee(xe){return!o.I.is(xe)},j.toArray=function g(xe){const le=[];return j.forEach(xe,Ae=>le.push(Ae)),le},j.toString=function _e(xe){return function u(j){return o.I.is(j)?o.I.toString(j):e.X.toString(j)}(xe)}},2928:(tn,Ue,n)=>{"use strict";n.d(Ue,{h:()=>b});var b,_,e=n(5100),o=n(7103),r=n(1839);function t(_){const M=r.X.ofSortedArray(_),I=r.X.max(M),l=new Int32Array(I);for(let m=0,u=_.length-1;m<u;m++)for(let d=_[m],s=_[m+1];d<s;d++)l[d]=m;return{offsets:M,index:l,count:_.length-1}}class v{move(){for(;this.hasNext;){if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&o.I.size(this.setRange)>0;break}this.updateSegmentRange()}return this.value}updateValue(){const I=e.C.findPredecessorIndexInInterval(this.set,this.segments[this.segmentMin+1],this.setRange);return this.value.start=o.I.start(this.setRange),this.value.end=I,this.setRange=o.I.ofBounds(I,o.I.end(this.setRange)),I>this.value.start}updateSegmentRange(){const M=o.I.min(this.setRange),I=o.I.max(this.setRange);I<M?this.hasNext=!1:(this.segmentMin=this.segmentMap[e.C.getAt(this.set,M)],this.segmentMax=this.segmentMap[e.C.getAt(this.set,I)],this.hasNext=this.segmentMax>=this.segmentMin)}setSegment(M){this.setRange=o.I.ofBounds(M.start,M.end),this.updateSegmentRange()}constructor(M,I,l,m){this.segments=M,this.segmentMap=I,this.set=l,this.segmentMin=0,this.segmentMax=0,this.setRange=o.I.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=m,this.updateSegmentRange()}}(_=b||(b={})).create=t,_.ofOffsets=function A(_,M){const I=o.I.start(M),l=new Int32Array(_.length+1);for(let m=0,u=_.length;m<u;m++)l[m]=_[m]-I;return l[_.length]=o.I.end(M)-I,t(l)},_.count=function y({count:_}){return _},_.getSegment=function c({index:_},M){return _[M]},_.projectValue=function i({offsets:_},M,I){const m=I>=e.C.max(_)?-1:e.C.findPredecessorIndex(_,I-1);return e.C.findRange(M,e.C.getAt(_,m),e.C.getAt(_,m+1)-1)},_.transientSegments=function O(_,M,I){const l=typeof I<"u"?o.I.ofBounds(I.start,I.end):o.I.ofBounds(0,e.C.size(M));return new v(_.offsets,_.index,M,l)}},1839:(tn,Ue,n)=>{"use strict";n.d(Ue,{X:()=>J});var e=n(8382),o=n(7103);const r=[];function c(W,te){if(te<W)return[];const de=new Int32Array(te-W+1);for(let ye=W;ye<=te;ye++)de[ye-W]=ye;return de}function v(W){return W[W.length-1]-W[0]+1===W.length}function O(W){return W[0]}function b(W){return W[W.length-1]+1}function I(W){return W.length}function u(W,te){const de=W.length;return 0===de?-1:W[0]<=te&&te<=W[de-1]?f(W,te,0,de):-1}function s(W,te,de,ye){return 0===W.length||ye<=de?-1:W[de]<=te&&te<=W[ye-1]?f(W,te,de,ye):-1}function a(W,te){if(W===te)return!0;let de=W.length;if(de!==te.length||W[0]!==te[0]||W[de-1]!==te[de-1])return!1;if(v(W))return!0;de--;for(let ye=1;ye<de;ye++)if(W[ye]!==te[ye])return!1;return!0}function S(W,te){const de=W.length;return te<=W[0]?0:te>W[de-1]?de:p(W,te,0,de)}function f(W,te,de,ye){let j=de,Z=ye-1;for(;j<=Z;){if(j+11>Z){for(let ee=j;ee<=Z;ee++)if(te===W[ee])return ee;return-1}const q=j+Z>>1,Y=W[q];if(te<Y)Z=q-1;else{if(!(te>Y))return q;j=q+1}}return-1}function p(W,te,de,ye){let j=de,Z=ye-1;for(;j<Z;){if(j+11>Z){for(let ee=j;ee<=Z;ee++)if(te<=W[ee])return ee;return Z+1}const q=j+Z>>1,Y=W[q];if(te<Y)Z=q-1;else{if(!(te>Y))return q;j=q+1}}return j>Z?Z+1:W[j]>=te?j:j+1}function G(W,te,de,ye,j,Z){let q=de,Y=ye,ee=0;for(;q<j&&Y<Z;){const g=W[q],_e=te[Y];g<_e?q++:g>_e?Y++:(q++,Y++,ee++)}return ee}const H={startI:0,startJ:0,endI:0,endJ:0};function $(W,te){const de=W.length,ye=te.length,j=de/ye;return de>=128||ye>=128||j<=.34||j>=2.99?(H.startI=S(W,O(te)),H.startJ=S(te,O(W)),H.endI=S(W,b(te)),H.endJ=S(te,b(W))):(H.startI=0,H.startJ=0,H.endI=de,H.endJ=ye),H}var J,W;(W=J||(J={})).Empty=r,W.ofUnsortedArray=function y(W){return(0,e.eh)(W),W},W.ofSingleton=function t(W){return[W]},W.ofSortedArray=function A(W){return W},W.ofRange=c,W.ofBounds=(te,de)=>c(te,de-1),W.is=function i(W){return W&&(Array.isArray(W)||!!W.buffer)},W.isRange=v,W.has=function C(W,te){return u(W,te)>=0},W.indexOf=u,W.indexOfInInterval=function d(W,te,de){return s(W,te,o.I.start(de),o.I.end(de))},W.indexOfInRange=s,W.start=O,W.end=b,W.min=function _(W){return W[0]},W.max=function M(W){return W[W.length-1]},W.size=I,W.hashCode=function l(W){const te=W.length;return te?te>2?(0,e.hX)(te,W[0],W[te-1],W[te>>1]):(0,e.CP)(te,W[0],W[te-1]):0},W.toString=function m(W){const te=W.length;return te>5?`[${W[0]}, ${W[1]}, ..., ${W[te-1]}], length ${te}`:`[${W.join(", ")}]`},W.areEqual=a,W.areIntersecting=function T(W,te){if(W===te)return!0;let{startI:de,startJ:ye,endI:j,endJ:Z}=$(W,te);for(;de<j&&ye<Z;){const q=W[de],Y=te[ye];if(q<Y)de++;else{if(!(q>Y))return!0;ye++}}return!1},W.isSubset=function L(W,te){if(W===te)return!0;const de=te.length;let{startI:ye,startJ:j,endI:Z,endJ:q}=$(W,te);if(q-j<de||Z-ye<de)return!1;let Y=0;for(;ye<Z&&j<q;){const ee=W[ye],g=te[j];ee<g?ye++:ee>g?j++:(ye++,j++,Y++)}return Y===de},W.union=function w(W,te){if(W===te)return W;const de=W.length,ye=te.length;if(0===de)return te;if(0===ye)return W;if(W[0]>te[0])return w(te,W);const{startI:j,startJ:Z,endI:q,endJ:Y}=$(W,te),ee=G(W,te,j,Z,q,Y);if(ee===de&&ee===ye||ee===ye)return W;if(ee===de)return te;const g=new Int32Array(de+ye-ee);let _e=0,xe=0,le=0;for(_e=0;_e<j;_e++)g[le++]=W[_e];for(;xe<Y&&W[j]>te[xe];)g[le++]=te[xe++];for(;_e<q&&xe<Y;){const Ae=W[_e],Be=te[xe];Ae<Be?(g[le++]=Ae,_e++):Ae>Be?(g[le++]=Be,xe++):(g[le++]=Ae,_e++,xe++)}for(;_e<q;_e++)g[le++]=W[_e];for(;xe<Y;xe++)g[le++]=te[xe];for(;_e<de;_e++)g[le++]=W[_e];for(;xe<ye;xe++)g[le++]=te[xe];return g},W.intersect=function V(W,te){if(W===te)return W;const{startI:de,startJ:ye,endI:j,endJ:Z}=$(W,te),q=G(W,te,de,ye,j,Z),Y=W.length,ee=te.length;if(!q)return r;if(q===Y&&q===ee||q===ee)return te;if(q===Y)return W;const g=new Int32Array(q);let _e=0,xe=de,le=ye;for(;xe<j&&le<Z;){const Ae=W[xe],Be=te[le];Ae<Be?xe++:(Ae>Be||(g[_e++]=Ae,xe++),le++)}return g},W.subtract=function U(W,te){if(W===te)return r;const de=W.length,{startI:ye,startJ:j,endI:Z,endJ:q}=$(W,te);let Y=ye,ee=j,g=0;for(;Y<Z&&ee<q;){const le=W[Y],Ae=te[ee];le<Ae?Y++:le>Ae?ee++:(Y++,ee++,g++)}if(!g)return W;if(g>=de)return r;const _e=new Int32Array(de-g);let xe=0;for(let le=0;le<ye;le++)_e[xe++]=W[le];for(Y=ye,ee=j;Y<Z&&ee<q;){const le=W[Y],Ae=te[ee];le<Ae?(_e[xe++]=le,Y++):(le>Ae||Y++,ee++)}for(;Y<de;Y++)_e[xe++]=W[Y];return _e},W.findPredecessorIndex=S,W.findPredecessorIndexInInterval=function D(W,te,de){const ye=o.I.start(de),j=o.I.end(de),Z=W[ye];return te<=Z?ye:j>ye&&te>W[j-1]?j:te-Z<=11?function E(W,te,de,ye){for(let j=de;j<ye;j++)if(te<=W[j])return j;return ye}(W,te,ye+1,j):p(W,te,ye,j)},W.findRange=function R(W,te,de){return o.I.ofBounds(S(W,te),S(W,de+1))},W.intersectionSize=function Q(W,te){if(W===te)return I(W);const{startI:de,startJ:ye,endI:j,endJ:Z}=$(W,te);return G(W,te,de,ye,j,Z)},W.deduplicate=function N(W){if(W.length<2)return W;let te=1;for(let j=0,Z=W.length-1;j<Z;j++)W[j]!==W[j+1]&&te++;if(te===W.length)return W;const de=new Int32Array(te);let ye=0;for(let j=0,Z=W.length-1;j<Z;j++)W[j]!==W[j+1]&&(de[ye++]=W[j]);return de[ye]=W[W.length-1],de},W.indicesOf=function k(W,te){if(a(W,te))return(0,e.vc)(0,W.length-1);const{startI:de,startJ:ye,endI:j,endJ:Z}=$(W,te);let q=de,Y=ye,ee=0;for(;q<j&&Y<Z;){const le=W[q],Ae=te[Y];le<Ae?q++:le>Ae?Y++:(q++,Y++,ee++)}if(!ee)return r;if(ee===W.length)return(0,e.vc)(0,W.length-1);const _e=new Int32Array(ee);let xe=0;for(q=de,Y=ye;q<j&&Y<Z;){const le=W[q],Ae=te[Y];le<Ae?q++:(le>Ae||(_e[xe++]=q,q++),Y++)}return _e}},5734:(tn,Ue,n)=>{"use strict";n.d(Ue,{m:()=>o});var o,e=n(3543);!function(r){function i(S){return S[S.length-1]}function O(S){return S.length/2}function b(S,D){return S[2*D]}function _(S,D){return S[2*D+1]+1}function M(S,D){return S[2*D]}function I(S,D){return S[2*D+1]}function s(S,D){return C(S,D,0)}function C(S,D,R){if(M(S,R)>e.CD.max(D)||i(S)<e.CD.min(D))return-1;for(let f=R,p=O(S);f<p;++f){const E=e.IX.ofRange(M(S,f),I(S,f));if(e.CD.areIntersecting(E,D))return f}return-1}r.ofSortedRanges=function t(S){return e.SortedArray.ofSortedArray(S)},r.start=function A(S){return S[0]},r.end=function y(S){return S[S.length-1]+1},r.min=function c(S){return S[0]},r.max=i,r.size=function v(S){let D=0;for(let R=0,f=S.length;R<f;R+=2)D+=S[R+1]-S[R]+1;return D},r.count=O,r.startAt=b,r.endAt=_,r.minAt=M,r.maxAt=I,r.areEqual=function l(S,D){if(S.length!==D.length)return!1;for(let R=0,f=S.length;R<f;++R)if(S[R]!==D[R])return!1;return!0},r.forEach=function m(S,D){let R=0;for(let f=0,p=S.length;f<p;f+=2)for(let E=S[f],T=S[f+1];E<=T;++E)D(E,R),++R},r.has=function u(S,D){return-1!==s(S,D)},r.hasFrom=function d(S,D,R){return-1!==C(S,D,R)},r.firstIntersectionIndex=s,r.firstIntersectionIndexFrom=C,r.transientSegments=function h(S,D){return new a(S,D)};class a{updateValue(){this.value.index=this.curIndex,this.value.start=e.CD.findPredecessorIndex(this.set,b(this.ranges,this.curIndex)),this.value.end=e.CD.findPredecessorIndex(this.set,_(this.ranges,this.curIndex))}move(){return this.hasNext&&(this.updateValue(),this.curIndex=C(this.ranges,this.set,this.curIndex+1),this.hasNext=-1!==this.curIndex),this.value}constructor(D,R){this.ranges=D,this.set=R,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=s(D,R),this.hasNext=-1!==this.curIndex}}r.Iterator=a}(o||(o={}))},3370:(tn,Ue,n)=>{"use strict";n.d(Ue,{U:()=>o});var o,e=n(8382);!function(r){r.Zero=0;const{_int32:t,_float64:A,_int32_1:y,_float64_1:c}=function(){const d=new ArrayBuffer(8),s=new ArrayBuffer(8);return{_int32:new Int32Array(d),_float64:new Float64Array(d),_int32_1:new Int32Array(s),_float64_1:new Float64Array(s)}}();r.is=function i(d){return"number"==typeof d},r.create=function v(d,s){return t[0]=d,t[1]=s,A[0]},r.diff=function O(d){return A[0]=d,t[1]-t[0]},r.fst=function b(d){return A[0]=d,t[0]},r.snd=function _(d){return A[0]=d,t[1]},r.areEqual=function M(d,s){return A[0]=d,c[0]=s,t[0]===y[0]&&t[1]===y[1]},r.compare=function I(d,s){A[0]=d,c[0]=s;const C=t[0]-y[0];return 0!==C?C:t[1]-y[1]},r.compareInArray=function l(d,s,C){A[0]=d[s],c[0]=d[C];const h=t[0]-y[0];return 0!==h?h:t[1]-y[1]},r.hashCode=function m(d){return A[0]=d,(0,e.vb)(t[0],t[1])},r.toString=function u(d){return A[0]=d,`(${t[0]}, ${t[1]})`}}(o||(o={}))},862:(tn,Ue,n)=>{"use strict";n.d(Ue,{f:()=>y});class e{move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}constructor(i){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=i.length,this.hasNext=i.length>0,this.xs=i,this.index=-1,this.lastValue=i.length>0?i[0]:void 0}}class o{move(){return++this.value,this.hasNext=this.value<this.max,this.value}constructor(i,v){this.max=v,this.value=0,this.hasNext=!1,this.value=i-1,this.hasNext=v>=i}}class r{move(){return this.hasNext=!1,this.value}constructor(i){this.value=i,this.hasNext=!0}}class t{move(){const i=this.f(this.base.move());return this.hasNext=this.base.hasNext,i}constructor(i,v){this.base=i,this.f=v,this.hasNext=!1,this.hasNext=i.hasNext}}class A{move(){const i=this.next;return this.hasNext=this.findNext(),i}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1}constructor(i,v){this.base=i,this.p=v,this.hasNext=this.findNext()}}var y,c;(c=y||(y={})).Empty=new o(0,-1),c.Array=function i(I){return new e(I)},c.Value=function v(I){return new r(I)},c.Range=function O(I,l){return new o(I,l)},c.map=function b(I,l){return new t(I,l)},c.filter=function _(I,l){return new A(I,l)},c.forEach=function M(I,l,m){for(;I.hasNext;)if(l(I.move(),m))return m;return m}},8382:(tn,Ue,n)=>{"use strict";var e;n.d(Ue,{Gm:()=>e,BI:()=>c,L9:()=>h,qI:()=>D,VE:()=>o.VE,m1:()=>M,vc:()=>S,C_:()=>i,vb:()=>v,CP:()=>O,hX:()=>b,TI:()=>m,YZ:()=>_,Ao:()=>l,ZR:()=>a,h3:()=>A,di:()=>o.di,eh:()=>o.eh,bd:()=>I}),function(f){function E(H){const $=H.growBy*H.elementSize;H.currentSize=$,H.currentIndex=0,H.currentChunk=new H.ctor($),H.allocatedSize+=$,H.chunks[H.chunks.length]=H.currentChunk}function N(H,$){const{ctor:J,chunks:W,currentIndex:te}=H;if(!W.length)return new J(0);if(1===W.length&&($||te===H.allocatedSize))return W[0];let de=0;for(let q=0,Y=W.length-1;q<Y;q++)de+=W[q].length;de+=H.currentIndex;const ye=new J(de);let j=0;if(ye.buffer)for(let q=0,Y=W.length-1;q<Y;q++)ye.set(W[q],j),j+=W[q].length;else for(let q=0,Y=W.length-1;q<Y;q++){const ee=W[q];for(let g=0,_e=ee.length;g<_e;g++)ye[j+g]=ee[g];j+=ee.length}const Z=W[W.length-1];if(ye.buffer&&te>=H.currentSize)ye.set(Z,j);else for(let q=0,Y=Z.length;q<Y;q++)ye[j+q]=Z[q];return ye}f.is=function p(H){return H.creator&&H.chunkSize},f.add4=function T(H,$,J,W,te){H.currentIndex>=H.currentSize&&E(H);const de=H.currentChunk,ye=H.currentIndex;return de[ye]=$,de[ye+1]=J,de[ye+2]=W,de[ye+3]=te,H.currentIndex+=4,H.elementCount++},f.add3=function L(H,$,J,W){H.currentIndex>=H.currentSize&&E(H);const te=H.currentChunk,de=H.currentIndex;return te[de]=$,te[de+1]=J,te[de+2]=W,H.currentIndex+=3,H.elementCount++},f.add2=function w(H,$,J){H.currentIndex>=H.currentSize&&E(H);const W=H.currentChunk,te=H.currentIndex;return W[te]=$,W[te+1]=J,H.currentIndex+=2,H.elementCount++},f.add=function Q(H,$){return H.currentIndex>=H.currentSize&&E(H),H.currentChunk[H.currentIndex]=$,H.currentIndex+=1,H.elementCount++},f.addRepeat=function G(H,$,J){for(let W=0;W<$;W++)H.currentIndex>=H.currentSize&&E(H),H.currentChunk[H.currentIndex++]=J,H.elementCount++;return H.elementCount},f.addMany=function V(H,$){const{elementSize:J}=H;for(let W=0,te=$.length;W<te;W+=J){H.currentIndex>=H.currentSize&&E(H);const{currentChunk:de}=H;for(let ye=0;ye<J;ye++)de[H.currentIndex++]=$[W+ye];H.elementCount++}return H.elementCount},f.compact=function U(H,$=!1){return N(H,$)},f._compact=N,f.create=function k(H,$,J,W){const te={ctor:H,elementSize:$,growBy:Math.max(1,Math.ceil(J)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof W>"u")return te;if("number"==typeof W)return te.currentChunk=new H(W*$),te.allocatedSize=W*$,te.currentSize=te.currentChunk.length,te.chunks[0]=te.currentChunk,te;const de=W;if(de.length%$!=0)throw new Error("initialChunk length must be a multiple of the element size.");return te.currentChunk=de,te.allocatedSize=de.length,te.currentSize=de.length,te.chunks[0]=de,te}}(e||(e={}));var o=n(5527);function r(f,p,E){return f[p].key<f[E].key?-1:1}function A(f,p,E){const T=E&&E.start||0,L=E&&E.end||f.length;if(L-T<=0)throw new Error("Can only bucket non-empty collections.");return function t(f,p,E,T,L){const w=new Map,Q=[];let G=p(f[0]),V=!0;for(let $=T;$<L;$++){const J=p(f[$]);if(w.has(J))w.get(J).count++,G!==J&&(V=!1);else{const W={key:J,count:1,offset:$};w.set(J,W),Q[Q.length]=W}G=J}const U=new Int32Array(Q.length+1);U[Q.length]=L;let N=!0;if(E)for(let $=1,J=Q.length;$<J;$++)if(Q[$-1].key>Q[$].key){N=!1;break}if(V&&N){for(let $=0;$<Q.length;$++)U[$]=Q[$].offset;return U}E&&!N&&(0,o.di)(Q,0,Q.length,r,o.VE);let k=0;for(let $=0;$<Q.length;$++){const J=Q[$];J.offset=k,k+=J.count}const H=new Int32Array(L-T);for(let $=T;$<L;$++){const J=p(f[$]);H[w.get(J).offset++]=f[$]}for(let $=0,J=H.length;$<J;$++)f[$+T]=H[$];U[0]=T;for(let $=1;$<Q.length;$++)U[$]=Q[$-1].offset+T;return U}(f,p,!(!E||!E.sort),T,L)}class y{createGroup(p,E){const T=this.id++,L=[p];return this.groups[T]=L,{id:T,keys:L,value:E}}add(p,E){const T=this.getHash(E);if(this.byHash.has(T)){const L=this.byHash.get(T);for(let Q=0,G=L.length;Q<G;Q++){const V=L[Q];if(this.areEqual(E,V.value))return V.keys[V.keys.length]=p,V.value}const w=this.createGroup(p,E);return L[L.length]=w,w.value}{const L=this.createGroup(p,E);return this.byHash.set(T,[L]),L.value}}constructor(p,E){this.getHash=p,this.areEqual=E,this.id=0,this.byHash=new Map,this.groups=[]}}function c(f,p){return new y(f,p)}function i(f){let p=f^f>>4;return p=(3735928559^p)+(p<<5),p^=p>>11,p}function v(f,p){let E=23;return E=31*E+f|0,E=31*E+p|0,E^=E>>4,E=(3735928559^E)+(E<<5),E^=E>>11,E}function O(f,p,E){let T=23;return T=31*T+f|0,T=31*T+p|0,T=31*T+E|0,T^=T>>4,T=(3735928559^T)+(T<<5),T^=T>>11,T}function b(f,p,E,T){let L=23;return L=31*L+f|0,L=31*L+p|0,L=31*L+E|0,L=31*L+T|0,L^=L>>4,L=(3735928559^L)+(L<<5),L^=L>>11,L}function _(f){let p=0;for(let E=0,T=f.length;E<T;E++)p=(p<<5)-p+f.charCodeAt(E)|0;return p}function M(f,p){return(f+p)*(f+p+1)/2+p}function I(f,p){return f<p?M(f,p):M(p,f)}function l(f,p){const E=Math.floor((Math.sqrt(8*p+1)-1)/2),L=p-(E*E+E)/2;return f[0]=E-L,f[1]=L,f}function m(f){let p=2166136261;for(let E=0,T=f.length;E<T;++E)p^=f[E],p+=(p<<1)+(p<<4)+(p<<7)+(p<<8)+(p<<24);return p>>>0}function h(f,p){for(let E=0,T=f.length;E<T;E++)if(p(f[E]))return f[E]}function a(f){if(Array.from)return Array.from(f);const p=[];for(;;){const{done:E,value:T}=f.next();if(E)break;p[p.length]=T}return p}function S(f,p,E){const T=p-f+1,L=E?new E(T):new Int32Array(T);for(let w=0;w<T;w++)L[w]=w+f;return L}function D(f,p){const E=new(function R(f){const p=f.constructor;if(!p)throw new Error("data does not define a constructor and it should");return p}(f))(p.length);for(let T=0,L=p.length;T<L;T++)E[T]=f[p[T]];return E}n(6651)},5527:(tn,Ue,n)=>{"use strict";function e(M,I,l){return M[I]-M[l]}function o(M,I,l){const m=M[I];M[I]=M[l],M[l]=m}function r(M,I,l,m){const u=l+m>>1;return I(M,l,m)>0?I(M,l,u)>0?I(M,u,m)>0?u:m:l:I(M,m,u)>0?I(M,u,l)>0?u:l:m}function t(M,I,l){const{cmp:m,swap:u,data:d,parts:s}=M;let C=I+1,h=l;for(u(d,I,r(d,m,I,l));m(d,h,I)>0;)--h;for(let a=I+1;a<=h;a++){const S=m(d,a,I);if(S>0){for(u(d,a,h),--h;m(d,h,I)>0;)--h;a--}else 0===S&&(u(d,a,C),C++)}for(let a=I;a<C;a++)u(d,a,I+h-a);s[0]=h-C+I+1,s[1]=h}function A({data:M,cmp:I,swap:l},m,u){for(let d=m+1;d<=u;d++){let s=d-1;for(;s>=m&&I(M,s,s+1)>0;)l(M,s,s+1),s-=1}}function y(M,I,l){const{parts:m}=M;for(;I<l;){if(l-I<16)return void A(M,I,l);t(M,I,l);const u=m[0],d=m[1];u-I<l-d?(y(M,I,u-1),I=d+1):(y(M,d+1,l),l=u-1)}}function c(M,I,l,m){let u=l+1,d=m;o(M,l,r(M,e,l,m));const s=M[l];for(;M[d]>s;)--d;for(let C=l+1;C<=d;C++){const h=M[C];if(h>s){for(o(M,C,d),--d;M[d]>s;)--d;C--}else h===s&&(o(M,C,u),++u)}for(let C=l;C<u;C++)o(M,C,l+d-C);I[0]=d-u+l+1,I[1]=d}function i(M,I,l){for(let m=I+1;m<=l;m++){const u=M[m];let d=m-1;for(;d>=I&&M[d]>u;)M[d+1]=M[d],d-=1;M[d+1]=u}}function v(M,I,l,m){for(;l<m;){if(m-l<16)return void i(M,l,m);c(M,I,l,m);const u=I[0],d=I[1];u-l<m-d?(v(M,I,l,u-1),l=d+1):(v(M,I,d+1,m),m=u-1)}}function O(M,I=e){return function b(M,I,l,m=e){return m===e?v(M,[0,0],I,l-1):y({data:M,cmp:m,swap:o,parts:[0,0]},I,l-1),M}(M,0,M.length,I)}function _(M,I,l,m,u){return y({data:M,cmp:m,swap:u,parts:[0,0]},I,l-1),M}n.d(Ue,{VE:()=>o,di:()=>_,eh:()=>O})},5019:(tn,Ue,n)=>{"use strict";n.d(Ue,{Y0:()=>s,iy:()=>C,jH:()=>d,sF:()=>m,uE:()=>u});var e=n(9909),o=n(1888),r=n(8277),t=n(3596),A=n(2745),y=n(364),c=n(9347),i=n(5013),v=n(127),O=n(6765),b=n(9390),_=n(2086),M=n(8599);const l=Object.keys({custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}}),m=r.t.arrayToOptions(l),u={smoothColors:r.t.MappedStatic("auto",{auto:r.t.Group({}),on:r.t.Group({resolutionFactor:r.t.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:r.t.Numeric(3,{min:1,max:12,step:1})}),off:r.t.Group({})})};function d(h){return!!h.smoothColors}function s(h,a,S){if(("on"===h.name||"auto"===h.name&&a)&&S&&S<3){let D=3;return"on"===h.name?(S*=h.params.resolutionFactor,D=h.params.sampleStride):(S*=2-(0,v.TF)(0,1.1,S),(S=Math.max(.5,S))>1.2&&(D=2)),{resolution:S,stride:D}}}var C,h;(h=C||(C={})).MaterialCategory={category:"Material"},h.ShadingCategory={category:"Shading"},h.CullingLodCategory={category:"Culling & LOD"},h.CustomQualityParamInfo={category:"Custom Quality",hideIf:p=>typeof p.quality<"u"&&"custom"!==p.quality},h.Params={alpha:r.t.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:r.t.Select("auto",m,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:O.i.getParam(),clip:r.t.Group(b.B.Params),emissive:r.t.Numeric(0,{min:0,max:1,step:.01}),instanceGranularity:r.t.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),lod:r.t.Vec3((0,_.e)(),void 0,{...h.CullingLodCategory,description:"Level of detail.",fieldLabels:{x:"Min Distance",y:"Max Distance",z:"Overlap (Shader)"}}),cellSize:r.t.Numeric(200,{min:0,max:5e3,step:100},{...h.CullingLodCategory,description:"Instance grid cell size."}),batchSize:r.t.Numeric(2e3,{min:0,max:5e4,step:500},{...h.CullingLodCategory,description:"Instance grid batch size."})},h.createSimple=function a(p=A.s.grey,E=1,T){return T||(T=(0,t.Zk)()),{transform:T,locationIterator:(0,o.iQ)(1,T.instanceCount.ref.value,1,()=>y.LU,!1,()=>!1),theme:{color:(0,c.TA)({},{value:p,lightness:0,saturation:0}),size:(0,i.ru)({},{value:E})}}},h.createValues=function S(p,E){const T=b.B.getClip(p.clip);return{alpha:e.IQ.create(p.alpha),uAlpha:e.IQ.create(p.alpha),uVertexCount:e.IQ.create(E.vertexCount),uGroupCount:e.IQ.create(E.groupCount),drawCount:e.IQ.create(E.drawCount),uMetalness:e.IQ.create(p.material.metalness),uRoughness:e.IQ.create(p.material.roughness),uBumpiness:e.IQ.create(p.material.bumpiness),uEmissive:e.IQ.create(p.emissive),dLightCount:e.IQ.create(1),dColorMarker:e.IQ.create(!0),dClipObjectCount:e.IQ.create(T.objects.count),dClipVariant:e.IQ.create(T.variant),uClipObjectType:e.IQ.create(T.objects.type),uClipObjectInvert:e.IQ.create(T.objects.invert),uClipObjectPosition:e.IQ.create(T.objects.position),uClipObjectRotation:e.IQ.create(T.objects.rotation),uClipObjectScale:e.IQ.create(T.objects.scale),instanceGranularity:e.IQ.create(p.instanceGranularity),uLod:e.IQ.create(M.Z.create(p.lod[0],p.lod[1],p.lod[2],0))}},h.updateValues=function D(p,E){e.IQ.updateIfChanged(p.alpha,E.alpha),e.IQ.updateIfChanged(p.uMetalness,E.material.metalness),e.IQ.updateIfChanged(p.uRoughness,E.material.roughness),e.IQ.updateIfChanged(p.uBumpiness,E.material.bumpiness),e.IQ.updateIfChanged(p.uEmissive,E.emissive);const T=b.B.getClip(E.clip);e.IQ.updateIfChanged(p.dClipObjectCount,T.objects.count),e.IQ.updateIfChanged(p.dClipVariant,T.variant),e.IQ.update(p.uClipObjectType,T.objects.type),e.IQ.update(p.uClipObjectInvert,T.objects.invert),e.IQ.update(p.uClipObjectPosition,T.objects.position),e.IQ.update(p.uClipObjectRotation,T.objects.rotation),e.IQ.update(p.uClipObjectScale,T.objects.scale),e.IQ.updateIfChanged(p.instanceGranularity,E.instanceGranularity),e.IQ.update(p.uLod,M.Z.set(p.uLod.ref.value,E.lod[0],E.lod[1],E.lod[2],0))},h.createRenderableState=function R(p={}){const E=void 0===p.alpha||1===p.alpha;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:E,writeDepth:E}},h.updateRenderableState=function f(p,E){p.opaque=E.alpha*p.alphaFactor>=1,p.writeDepth=p.opaque}},5077:(tn,Ue,n)=>{"use strict";n.d(Ue,{$G:()=>y,EN:()=>i,HB:()=>t,eO:()=>A});var e=n(7187),o=n(4369),r=n(3784);function t(v,O,b,_){return v.fill(_,O,b),!0}function A(v,O,b){v.fill(0,O,b)}function y(v,O,b){const _=(0,r.xg)(Math.max(1,v),1,Uint8Array,b&&b.tClipping.ref.value.array);return b?(e.IQ.update(b.tClipping,_),e.IQ.update(b.uClippingTexDim,o.ZY.create(_.width,_.height)),e.IQ.updateIfChanged(b.dClipping,v>0),e.IQ.updateIfChanged(b.dClippingType,O),b):{tClipping:e.IQ.create(_),uClippingTexDim:e.IQ.create(o.ZY.create(_.width,_.height)),dClipping:e.IQ.create(v>0),dClippingType:e.IQ.create(O)}}const c={array:new Uint8Array(1),width:1,height:1};function i(v){return v?(e.IQ.update(v.tClipping,c),e.IQ.update(v.uClippingTexDim,o.ZY.create(1,1)),e.IQ.updateIfChanged(v.dClipping,!1),v):{tClipping:e.IQ.create(c),uClippingTexDim:e.IQ.create(o.ZY.create(1,1)),dClipping:e.IQ.create(!1),dClippingType:e.IQ.create("groupInstance")}}},2712:(tn,Ue,n)=>{"use strict";n.d(Ue,{D1:()=>c});var e=n(9909),o=n(3784),r=n(190),t=n(4369),A=n(364),y=n(4648);function c(C,h,a,S){const D=function i(C,h,a,S){switch(a.granularity){case"uniform":return function b(C,h,a){return function O(C,h){return h?(e.IQ.update(h.uColor,r.Q1.toVec3Normalized(h.uColor.ref.value,C)),e.IQ.updateIfChanged(h.dColorType,"uniform"),h):{uColor:e.IQ.create(r.Q1.toVec3Normalized((0,t.eB)(),C)),tColor:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:e.IQ.create((0,y.z6)()),tPalette:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:e.IQ.create(t.ZY.create(1,1)),uColorGridDim:e.IQ.create(t.eB.create(1,1,1)),uColorGridTransform:e.IQ.create(t.Zb.create(0,0,0,1)),dColorType:e.IQ.create("uniform"),dUsePalette:e.IQ.create(!1)}}(h(A.LU,!1),a)}(0,a.color,S);case"instance":return C.nonInstanceable?I(C,a.color,S):function M(C,h,a){const{instanceCount:S}=C,D=(0,o.xg)(Math.max(1,S),3,Uint8Array,a&&a.tColor.ref.value.array);for(C.reset();C.hasNext;){const{location:R,isSecondary:f,instanceIndex:p}=C.move();r.Q1.toArray(h(R,f),D.array,3*p),C.skipInstance()}return _(D,"instance",a)}(C,a.color,S);case"group":return I(C,a.color,S);case"groupInstance":return function l(C,h,a){const{groupCount:S,instanceCount:D,hasLocation2:R}=C,p=(0,o.xg)(Math.max(1,D*S*(R?2:1)),3,Uint8Array,a&&a.tColor.ref.value.array);C.reset();const E=R?6:3;for(;C.hasNext;){const{location:T,location2:L,isSecondary:w,index:Q}=C.move();r.Q1.toArray(h(T,w),p.array,Q*E),R&&r.Q1.toArray(h(L,w),p.array,Q*E+3)}return _(p,"groupInstance",a)}(C,a.color,S);case"vertex":return function m(C,h,a){const{groupCount:S,stride:D}=C,R=(0,o.xg)(Math.max(1,S),3,Uint8Array,a&&a.tColor.ref.value.array);for(C.reset(),C.voidInstances();C.hasNext&&!C.isNextNewInstance;){const{location:f,isSecondary:p,groupIndex:E}=C.move(),T=h(f,p);for(let L=0;L<D;++L)r.Q1.toArray(T,R.array,3*(E+L))}return _(R,"vertex",a)}(h,a.color,S);case"vertexInstance":return function u(C,h,a){const{groupCount:S,instanceCount:D,stride:R}=C,p=(0,o.xg)(Math.max(1,D*S),3,Uint8Array,a&&a.tColor.ref.value.array);for(C.reset();C.hasNext;){const{location:E,isSecondary:T,index:L}=C.move(),w=h(E,T);for(let Q=0;Q<R;++Q)r.Q1.toArray(w,p.array,3*(L+Q))}return _(p,"vertexInstance",a)}(h,a.color,S);case"volume":return d(a.grid,"volume",S);case"volumeInstance":return d(a.grid,"volumeInstance",S);case"direct":return function s(C){return C?(e.IQ.updateIfChanged(C.dColorType,"direct"),C):{uColor:e.IQ.create((0,t.eB)()),tColor:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:e.IQ.create((0,y.z6)()),tPalette:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:e.IQ.create(t.ZY.create(1,1)),uColorGridDim:e.IQ.create(t.eB.create(1,1,1)),uColorGridTransform:e.IQ.create(t.Zb.create(0,0,0,1)),dColorType:e.IQ.create("direct"),dUsePalette:e.IQ.create(!1)}}(S)}}(C,h,a,S);return a.palette?(e.IQ.updateIfChanged(D.dUsePalette,!0),function v(C,h){let a=!0;const S=h.ref.value;if(C.colors.length!==S.width||S.filter!==C.filter)a=!1;else{const f=S.array;let p=0;for(const E of C.colors){const[T,L,w]=r.Q1.toRgb(E);if(f[p++]!==T||f[p++]!==L||f[p++]!==w){a=!1;break}}}if(a)return;const D=new Uint8Array(3*C.colors.length);let R=0;for(const f of C.colors){const[p,E,T]=r.Q1.toRgb(f);D[R++]=p,D[R++]=E,D[R++]=T}e.IQ.update(h,{array:D,height:1,width:C.colors.length,filter:C.filter})}(a.palette,D.tPalette)):e.IQ.updateIfChanged(D.dUsePalette,!1),D}function _(C,h,a){return a?(e.IQ.update(a.tColor,C),e.IQ.update(a.uColorTexDim,t.ZY.create(C.width,C.height)),e.IQ.updateIfChanged(a.dColorType,h),a):{uColor:e.IQ.create((0,t.eB)()),tColor:e.IQ.create(C),tColorGrid:e.IQ.create((0,y.z6)()),tPalette:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:e.IQ.create(t.ZY.create(C.width,C.height)),uColorGridDim:e.IQ.create(t.eB.create(1,1,1)),uColorGridTransform:e.IQ.create(t.Zb.create(0,0,0,1)),dColorType:e.IQ.create(h),dUsePalette:e.IQ.create(!1)}}function I(C,h,a){const{groupCount:S,hasLocation2:D}=C,R=(0,o.xg)(Math.max(1,S*(D?2:1)),3,Uint8Array,a&&a.tColor.ref.value.array);C.reset();const f=D?6:3;for(;C.hasNext&&!C.isNextNewInstance;){const{location:p,location2:E,isSecondary:T,groupIndex:L}=C.move();r.Q1.toArray(h(p,T),R.array,L*f),D&&r.Q1.toArray(h(E,T),R.array,L*f+3)}return _(R,"group",a)}function d(C,h,a){const{colors:S,dimension:D,transform:R}=C,f=S.getWidth(),p=S.getHeight();return a?(e.IQ.update(a.tColorGrid,S),e.IQ.update(a.uColorTexDim,t.ZY.create(f,p)),e.IQ.update(a.uColorGridDim,t.eB.clone(D)),e.IQ.update(a.uColorGridTransform,t.Zb.clone(R)),e.IQ.updateIfChanged(a.dColorType,h),a):{uColor:e.IQ.create((0,t.eB)()),tColor:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:e.IQ.create(S),tPalette:e.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:e.IQ.create(t.ZY.create(f,p)),uColorGridDim:e.IQ.create(t.eB.clone(D)),uColorGridTransform:e.IQ.create(t.Zb.clone(R)),dColorType:e.IQ.create(h),dUsePalette:e.IQ.create(!1)}}},1989:(tn,Ue,n)=>{"use strict";n.d(Ue,{h:()=>v});var e=n(8382),o=n(283),r=n(4369);const t=(0,r.eB)(),A=(0,r.eB)(),y=(0,r.eB)(),c=e.Gm.add,i=e.Gm.add3;var v;(v||(v={})).create=function _(M=2048,I=1024,l){const m=e.Gm.create(Float32Array,1,I,l?l.groupBuffer.ref.value:M),u=e.Gm.create(Float32Array,3,I,l?l.startBuffer.ref.value:M),d=e.Gm.create(Float32Array,3,I,l?l.endBuffer.ref.value:M),s=e.Gm.create(Float32Array,1,I,l?l.scaleBuffer.ref.value:M),C=e.Gm.create(Float32Array,1,I,l?l.capBuffer.ref.value:M),h=e.Gm.create(Float32Array,1,I,l?l.colorModeBuffer.ref.value:M),a=(D,R,f,p,E,T,L,w,Q,G,V)=>{for(let U=0;U<6;++U)i(u,D,R,f),i(d,p,E,T),c(m,V),c(s,L),c(C,(w?1:0)+(Q?2:0)),c(h,G)},S=(D,R,f,p,E,T,L,w,Q)=>{const G=r.eB.distance(D,R),V=f%2!=0,U=Math.floor((f+1)/2),N=G/(f+.5);let k=2;r.eB.setMagnitude(y,r.eB.sub(y,R,D),N),r.eB.copy(t,D);for(let H=0;H<U;++H)r.eB.add(t,t,y),V&&H===U-1?(r.eB.copy(A,R),L||(T=!1)):r.eB.add(A,t,y),w&&(k=r.eB.distance(D,A)/(2*G)),a(t[0],t[1],t[2],A[0],A[1],A[2],p,E,T,k,Q),r.eB.add(t,t,y)};return{add:a,addFixedCountDashes:S,addFixedLengthDashes:(D,R,f,p,E,T,L,w)=>{const Q=r.eB.distance(D,R);S(D,R,Q/f,p,E,T,!0,L,w)},getCylinders:()=>{const D=m.elementCount/6,R=e.Gm.compact(m,!0),f=e.Gm.compact(u,!0),p=e.Gm.compact(d,!0),E=e.Gm.compact(s,!0),T=e.Gm.compact(C,!0),L=e.Gm.compact(h,!0),w=l&&D<=l.cylinderCount?l.mappingBuffer.ref.value:new Float32Array(18*D),Q=l&&D<=l.cylinderCount?l.indexBuffer.ref.value:new Uint32Array(12*D);return(!l||D>l.cylinderCount)&&function O(b,_,M){for(let I=0;I<b;++I){const l=18*I;_[l]=-1,_[l+1]=1,_[l+2]=-1,_[l+3]=-1,_[l+4]=-1,_[l+5]=-1,_[l+6]=1,_[l+7]=1,_[l+8]=-1,_[l+9]=1,_[l+10]=1,_[l+11]=1,_[l+12]=1,_[l+13]=-1,_[l+14]=-1,_[l+15]=1,_[l+16]=-1,_[l+17]=1}for(let I=0;I<b;++I){const l=6*I,m=12*I;M[m]=l,M[m+1]=l+1,M[m+2]=l+2,M[m+3]=l+1,M[m+4]=l+4,M[m+5]=l+2,M[m+6]=l+2,M[m+7]=l+4,M[m+8]=l+3,M[m+9]=l+4,M[m+10]=l+5,M[m+11]=l+3}}(D,w,Q),o.S.create(w,Q,R,f,p,E,T,L,D,l)}}}},283:(tn,Ue,n)=>{"use strict";n.d(Ue,{S:()=>d});var d,e=n(9909),o=n(4369),r=n(4559),t=n(2712),A=n(8013),y=n(7684),c=n(1888),i=n(8277),v=n(3784),O=n(5384),b=n(5019),_=n(2075),M=n(9197),I=n(8382),l=n(5077),m=n(8307),u=n(6022);!function(s){function C(G,V,U,N,k,H,$,J,W,te){return te?function D(G,V,U,N,k,H,$,J,W,te){return W>te.cylinderCount&&(e.IQ.update(te.mappingBuffer,G),e.IQ.update(te.indexBuffer,V)),te.cylinderCount=W,e.IQ.update(te.groupBuffer,U),e.IQ.update(te.startBuffer,N),e.IQ.update(te.endBuffer,k),e.IQ.update(te.scaleBuffer,H),e.IQ.update(te.capBuffer,$),e.IQ.update(te.colorModeBuffer,J),te}(G,V,U,N,k,H,$,J,W,te):function S(G,V,U,N,k,H,$,J,W){const te=(0,O.f8)();let de,ye=-1,j=-1;const Z={kind:"cylinders",cylinderCount:W,mappingBuffer:e.IQ.create(G),indexBuffer:e.IQ.create(V),groupBuffer:e.IQ.create(U),startBuffer:e.IQ.create(N),endBuffer:e.IQ.create(k),scaleBuffer:e.IQ.create(H),capBuffer:e.IQ.create($),colorModeBuffer:e.IQ.create(J),get boundingSphere(){const q=a(Z);if(q!==ye){const Y=(0,v.sL)(Z.startBuffer.ref.value,6*Z.cylinderCount,6),ee=(0,v.sL)(Z.endBuffer.ref.value,6*Z.cylinderCount,6);O.f8.expandBySphere(te,Y,ee),ye=q}return te},get groupMapping(){return Z.groupBuffer.ref.version!==j&&(de=(0,r.AA)(Z.groupBuffer.ref.value,Z.cylinderCount,6),j=Z.groupBuffer.ref.version),de},setBoundingSphere(q){O.f8.copy(te,q),ye=a(Z)}};return Z}(G,V,U,N,k,H,$,J,W)}function h(G){return C(G?G.mappingBuffer.ref.value:new Float32Array(0),G?G.indexBuffer.ref.value:new Uint32Array(0),G?G.groupBuffer.ref.value:new Float32Array(0),G?G.startBuffer.ref.value:new Float32Array(0),G?G.endBuffer.ref.value:new Float32Array(0),G?G.scaleBuffer.ref.value:new Float32Array(0),G?G.capBuffer.ref.value:new Float32Array(0),G?G.colorModeBuffer.ref.value:new Float32Array(0),0,G)}function a(G){return(0,I.TI)([G.cylinderCount,G.mappingBuffer.ref.version,G.indexBuffer.ref.version,G.groupBuffer.ref.version,G.startBuffer.ref.version,G.endBuffer.ref.version,G.scaleBuffer.ref.version,G.capBuffer.ref.version,G.colorModeBuffer.ref.version])}function f(G,V){const U=6*G.cylinderCount,N=V.instanceCount.ref.value,k=(0,c.tu)(),H=k.position,$=G.startBuffer.ref.value,J=G.endBuffer.ref.value,W=V.aTransform.ref.value;return(0,c.iQ)(U,N,2,(de,ye)=>{const j=de%6==0?$:J;return ye<0?o.eB.fromArray(H,j,3*de):o.eB.transformMat4Offset(H,j,W,0,3*de,16*ye),k})}function p(G,V,U,N,k){const{instanceCount:H,groupCount:$}=U,J=f(G,V),W=(0,t.D1)(U,J,N.color),te=(0,y.v3)(U,N.size),de=k.instanceGranularity?(0,A.Km)(H,"instance"):(0,A.Km)(H*$,"groupInstance"),ye=(0,_.WG)(),j=(0,M.MD)(),Z=(0,u.JS)(),q=(0,m.IB)(),Y=(0,l.EN)(),ee={drawCount:4*G.cylinderCount*3,vertexCount:6*G.cylinderCount,groupCount:$,instanceCount:H},g=(0,y.yx)(te)*k.sizeFactor,_e=O.f8.clone(G.boundingSphere),xe=(0,v.Ax)(_e,V.aTransform.ref.value,H,0);return{dGeometryType:e.IQ.create("cylinders"),aMapping:G.mappingBuffer,aGroup:G.groupBuffer,aStart:G.startBuffer,aEnd:G.endBuffer,aScale:G.scaleBuffer,aCap:G.capBuffer,aColorMode:G.colorModeBuffer,elements:G.indexBuffer,boundingSphere:e.IQ.create(xe),invariantBoundingSphere:e.IQ.create(_e),uInvariantBoundingSphere:e.IQ.create(o.Zb.ofSphere(_e)),...W,...te,...de,...ye,...j,...Z,...q,...Y,...V,padding:e.IQ.create(g),...b.iy.createValues(k,ee),uSizeFactor:e.IQ.create(k.sizeFactor*k.sizeAspectRatio),uDoubleSided:e.IQ.create(k.doubleSided),dIgnoreLight:e.IQ.create(k.ignoreLight),dXrayShaded:e.IQ.create("inverted"===k.xrayShaded?"inverted":!0===k.xrayShaded?"on":"off"),dTransparentBackfaces:e.IQ.create(k.transparentBackfaces),dSolidInterior:e.IQ.create(k.solidInterior),uBumpFrequency:e.IQ.create(k.bumpFrequency),uBumpAmplitude:e.IQ.create(k.bumpAmplitude),dDualColor:e.IQ.create("interpolate"===k.colorMode)}}function Q(G,V){b.iy.updateRenderableState(G,V),G.opaque=G.opaque&&!V.xrayShaded,G.writeDepth=G.opaque}s.create=C,s.createEmpty=h,s.transform=function R(G,V){const U=G.startBuffer.ref.value;(0,r.pi)(V,U,0,6*G.cylinderCount),e.IQ.update(G.startBuffer,U);const N=G.endBuffer.ref.value;(0,r.pi)(V,N,0,6*G.cylinderCount),e.IQ.update(G.endBuffer,N)},s.Params={...b.iy.Params,sizeFactor:i.t.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:i.t.Numeric(1,{min:0,max:3,step:.01}),doubleSided:i.t.Boolean(!1,b.iy.CustomQualityParamInfo),ignoreLight:i.t.Boolean(!1,b.iy.ShadingCategory),xrayShaded:i.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],b.iy.ShadingCategory),transparentBackfaces:i.t.Select("off",i.t.arrayToOptions(["off","on","opaque"]),b.iy.ShadingCategory),solidInterior:i.t.Boolean(!0,b.iy.ShadingCategory),bumpFrequency:i.t.Numeric(0,{min:0,max:10,step:.1},b.iy.ShadingCategory),bumpAmplitude:i.t.Numeric(1,{min:0,max:5,step:.1},b.iy.ShadingCategory),colorMode:i.t.Select("default",i.t.arrayToOptions(["default","interpolate"]),b.iy.ShadingCategory)},s.Utils={Params:s.Params,createEmpty:h,createValues:p,createValuesSimple:function E(G,V,U,N,k){const H=b.iy.createSimple(U,N,k),$={...i.t.getDefaultValues(s.Params),...V};return p(G,H.transform,H.locationIterator,H.theme,$)},updateValues:function T(G,V){b.iy.updateValues(G,V),e.IQ.updateIfChanged(G.uSizeFactor,V.sizeFactor*V.sizeAspectRatio),e.IQ.updateIfChanged(G.uDoubleSided,V.doubleSided),e.IQ.updateIfChanged(G.dIgnoreLight,V.ignoreLight),e.IQ.updateIfChanged(G.dXrayShaded,"inverted"===V.xrayShaded?"inverted":!0===V.xrayShaded?"on":"off"),e.IQ.updateIfChanged(G.dTransparentBackfaces,V.transparentBackfaces),e.IQ.updateIfChanged(G.dSolidInterior,V.solidInterior),e.IQ.updateIfChanged(G.uBumpFrequency,V.bumpFrequency),e.IQ.updateIfChanged(G.uBumpAmplitude,V.bumpAmplitude),e.IQ.updateIfChanged(G.dDualColor,"interpolate"===V.colorMode)},updateBoundingSphere:function L(G,V){const U=O.f8.clone(V.boundingSphere),N=(0,v.Ax)(U,G.aTransform.ref.value,G.instanceCount.ref.value,0);O.f8.equals(N,G.boundingSphere.ref.value)||e.IQ.update(G.boundingSphere,N),O.f8.equals(U,G.invariantBoundingSphere.ref.value)||(e.IQ.update(G.invariantBoundingSphere,U),e.IQ.update(G.uInvariantBoundingSphere,o.Zb.fromSphere(G.uInvariantBoundingSphere.ref.value,U)))},createRenderableState:function w(G){const V=b.iy.createRenderableState(G);return Q(V,G),V},updateRenderableState:Q,createPositionIterator:f}}(d||(d={}))},9928:(tn,Ue,n)=>{"use strict";n.d(Ue,{E:()=>D});var e=n(8382),o=n(1888),r=n(3784),t=n(4648),A=n(5384),y=n(4369),c=n(9909),i=n(8277),v=n(3280),O=n(5019),b=n(2712),_=n(8013),M=n(2075),I=n(9197),l=n(127);function u(f){return f.map(p=>({x:p[0],alpha:p[1]}))}function d(f,p){const E=[{x:0,alpha:0},{x:0,alpha:0},...f,{x:1,alpha:0},{x:1,alpha:0}],L=p?p.ref.value.array:new Uint8Array(256);let Q,G,V,U,N,k,w=0;const H=f.length+1;for(let J=0;J<H;++J){Q=E[J+1].x,G=E[J+2].x,V=E[J].alpha,U=E[J+1].alpha,N=E[J+2].alpha,k=E[J+3].alpha;const W=Math.round(256*(G-Q));for(let te=0;te<W;++te)L[w]=Math.max(0,255*(0,l.Y7)(V,U,N,k,te/W,.5)),++w}const $={array:L,width:256,height:1};return p?(c.IQ.update(p,$),p):c.IQ.create($)}var s=n(5077),C=n(6853),h=n(8307),a=n(6022);const S=(0,v.az)();var D;!function(f){function p(te,de,ye,j,Z,q,Y,ee,g,_e){return _e?function L(te,de,ye,j,Z,q,Y,ee,g,_e){const xe=q.getWidth(),le=q.getHeight(),Ae=q.getDepth();return c.IQ.update(_e.gridDimension,de),c.IQ.update(_e.gridTexture,q),c.IQ.update(_e.gridTextureDim,y.eB.set(_e.gridTextureDim.ref.value,xe,le,Ae)),c.IQ.update(_e.gridStats,y.Zb.set(_e.gridStats.ref.value,Y.min,Y.max,Y.mean,Y.sigma)),c.IQ.update(_e.bboxMin,te.min),c.IQ.update(_e.bboxMax,te.max),c.IQ.update(_e.bboxSize,y.eB.sub(_e.bboxSize.ref.value,te.max,te.min)),c.IQ.update(_e.transform,ye),c.IQ.update(_e.cellDim,Z),c.IQ.update(_e.unitToCartn,j),c.IQ.update(_e.cartnToUnit,y.$I.invert((0,y.$I)(),j)),c.IQ.updateIfChanged(_e.packedGroup,ee),c.IQ.updateIfChanged(_e.axisOrder,y.eB.fromArray(_e.axisOrder.ref.value,g,0)),_e}(te,de,ye,j,Z,q,Y,ee,g,_e):function T(te,de,ye,j,Z,q,Y,ee,g){const _e=(0,A.f8)();let xe=-1;const le=q.getWidth(),Ae=q.getHeight(),Be=q.getDepth(),Ce={kind:"direct-volume",gridDimension:c.IQ.create(de),gridTexture:c.IQ.create(q),gridTextureDim:c.IQ.create(y.eB.create(le,Ae,Be)),gridStats:c.IQ.create(y.Zb.create(Y.min,Y.max,Y.mean,Y.sigma)),bboxMin:c.IQ.create(te.min),bboxMax:c.IQ.create(te.max),bboxSize:c.IQ.create(y.eB.sub((0,y.eB)(),te.max,te.min)),transform:c.IQ.create(ye),cellDim:c.IQ.create(Z),unitToCartn:c.IQ.create(j),cartnToUnit:c.IQ.create(y.$I.invert((0,y.$I)(),j)),get boundingSphere(){const Re=E(Ce);if(Re!==xe){const ke=function R(f,p){return A.f8.fromDimensionsAndTransform((0,A.f8)(),f,p)}(Ce.gridDimension.ref.value,Ce.transform.ref.value);A.f8.copy(_e,ke),xe=Re}return _e},packedGroup:c.IQ.create(ee),axisOrder:c.IQ.create(g),setBoundingSphere(Re){A.f8.copy(_e,Re),xe=E(Ce)}};return Ce}(te,de,ye,j,Z,q,Y,ee,g)}function E(te){return(0,e.TI)([te.bboxSize.ref.version,te.gridDimension.ref.version,te.gridTexture.ref.version,te.transform.ref.version,te.gridStats.ref.version])}function w(te){return p((0,A.DJ)(),(0,y.eB)(),y.$I.identity(),y.$I.identity(),(0,y.eB)(),(0,t.z6)(),C.x.One.stats,!1,y.eB.create(0,1,2),te)}function G(te,de){return Math.ceil(y.eB.magnitude(te)*de)}function V(te,de){return Math.min(...te)*(1/de)}function U(te){return 1/te}function N(te,de,ye,j,Z){const{gridTexture:q,gridTextureDim:Y,gridStats:ee}=te,{bboxSize:g,bboxMin:_e,bboxMax:xe,gridDimension:le,transform:Ae}=te,{instanceCount:Be,groupCount:Ce}=ye,Re=f.Utils.createPositionIterator(te,de),ke=(0,b.D1)(ye,Re,j.color),we=Z.instanceGranularity?(0,_.Km)(Be,"instance"):(0,_.Km)(Be*Ce,"groupInstance"),Oe=(0,M.WG)(),Se=(0,I.MD)(),Ve=(0,a.JS)(),Ne=(0,h.IB)(),K=(0,s.EN)(),[ne,be,Te]=le.ref.value,ie={drawCount:S.indices.length,vertexCount:ne*be*Te,groupCount:Ce,instanceCount:Be},ue=A.f8.clone(te.boundingSphere),re=(0,r.Ax)(ue,de.aTransform.ref.value,Be,0),ce=d(u(Z.controlPoints));return{dGeometryType:c.IQ.create("directVolume"),...ke,...we,...Oe,...Se,...Ve,...Ne,...K,...de,...O.iy.createValues(Z,ie),aPosition:c.IQ.create(S.vertices),elements:c.IQ.create(S.indices),boundingSphere:c.IQ.create(re),invariantBoundingSphere:c.IQ.create(ue),uInvariantBoundingSphere:c.IQ.create(y.Zb.ofSphere(ue)),uBboxMin:_e,uBboxMax:xe,uBboxSize:g,uMaxSteps:c.IQ.create(G(le.ref.value,Z.stepsPerCell)),uStepScale:c.IQ.create(V(te.cellDim.ref.value,Z.stepsPerCell)),uJumpLength:c.IQ.create(Z.jumpLength),uTransform:Ae,uGridDim:le,tTransferTex:ce,uTransferScale:c.IQ.create(U(Z.stepsPerCell)),dGridTexType:c.IQ.create(q.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:Y,tGridTex:q,uGridStats:ee,uCellDim:te.cellDim,uCartnToUnit:te.cartnToUnit,uUnitToCartn:te.unitToCartn,dPackedGroup:te.packedGroup,dAxisOrder:c.IQ.create(te.axisOrder.ref.value.join("")),dIgnoreLight:c.IQ.create(Z.ignoreLight),dXrayShaded:c.IQ.create("inverted"===Z.xrayShaded?"inverted":!0===Z.xrayShaded?"on":"off")}}f.create=p,f.createEmpty=w,f.Params={...O.iy.Params,ignoreLight:i.t.Boolean(!1,O.iy.ShadingCategory),xrayShaded:i.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],O.iy.ShadingCategory),controlPoints:i.t.LineGraph([y.ZY.create(.19,0),y.ZY.create(.2,.05),y.ZY.create(.25,.05),y.ZY.create(.26,0),y.ZY.create(.79,0),y.ZY.create(.8,.05),y.ZY.create(.85,.05),y.ZY.create(.86,0)],{isEssential:!0}),stepsPerCell:i.t.Numeric(3,{min:1,max:10,step:1}),jumpLength:i.t.Numeric(0,{min:0,max:20,step:.1})},f.Utils={Params:f.Params,createEmpty:w,createValues:N,createValuesSimple:function k(te,de,ye,j,Z){const q=O.iy.createSimple(ye,j,Z),Y={...i.t.getDefaultValues(f.Params),...de};return N(te,q.transform,q.locationIterator,q.theme,Y)},updateValues:function H(te,de){O.iy.updateValues(te,de),c.IQ.updateIfChanged(te.dIgnoreLight,de.ignoreLight),c.IQ.updateIfChanged(te.dXrayShaded,"inverted"===de.xrayShaded?"inverted":!0===de.xrayShaded?"on":"off"),d(u(de.controlPoints),te.tTransferTex),c.IQ.updateIfChanged(te.uMaxSteps,G(te.uGridDim.ref.value,de.stepsPerCell)),c.IQ.updateIfChanged(te.uStepScale,V(te.uCellDim.ref.value,de.stepsPerCell)),c.IQ.updateIfChanged(te.uTransferScale,U(de.stepsPerCell)),c.IQ.updateIfChanged(te.uJumpLength,de.jumpLength)},updateBoundingSphere:function $(te,de){const ye=A.f8.clone(de.boundingSphere),j=(0,r.Ax)(ye,te.aTransform.ref.value,te.instanceCount.ref.value,0);A.f8.equals(j,te.boundingSphere.ref.value)||c.IQ.update(te.boundingSphere,j),A.f8.equals(ye,te.invariantBoundingSphere.ref.value)||(c.IQ.update(te.invariantBoundingSphere,ye),c.IQ.update(te.uInvariantBoundingSphere,y.Zb.fromSphere(te.uInvariantBoundingSphere.ref.value,ye)))},createRenderableState:function J(te){const de=O.iy.createRenderableState(te);return de.opaque=!1,de.writeDepth=!1,de},updateRenderableState:function W(te,de){O.iy.updateRenderableState(te,de),te.opaque=!1,te.writeDepth=!1},createPositionIterator:function Q(te,de){const ye=te.transform.ref.value,[j,Z,q]=te.gridDimension.ref.value,Y=j*Z*q,ee=de.instanceCount.ref.value,g=(0,o.tu)(),_e=g.position,xe=de.aTransform.ref.value;return(0,o.iQ)(Y,ee,1,(Ae,Be)=>{const Ce=Math.floor(Ae/q);return _e[0]=Math.floor(Ce/Z),_e[1]=Ce%Z,_e[2]=Ae%q,y.eB.transformMat4(_e,_e,ye),Be>=0&&y.eB.transformMat4Offset(_e,_e,xe,0,0,16*Be),g})}}}(D||(D={}))},6022:(tn,Ue,n)=>{"use strict";n.d(Ue,{JS:()=>O,Ns:()=>A,Sj:()=>i,bO:()=>y,dQ:()=>c});var e=n(7187),o=n(4369),r=n(3784),t=n(4648);function A(b,_,M,I){for(let l=_;l<M;++l)b[l]=255*I;return!0}function y(b,_){if(0===_||b.length<_)return 0;let M=0;for(let I=0;I<_;++I)M+=b[I];return M/(255*_)}function c(b,_,M){b.fill(0,_,M)}function i(b,_,M){const I=(0,r.xg)(Math.max(1,b),1,Uint8Array,M&&M.tEmissive.ref.value.array);return M?(e.IQ.update(M.tEmissive,I),e.IQ.update(M.uEmissiveTexDim,o.ZY.create(I.width,I.height)),e.IQ.updateIfChanged(M.dEmissive,b>0),e.IQ.updateIfChanged(M.emissiveAverage,y(I.array,b)),e.IQ.updateIfChanged(M.dEmissiveType,_),M):{tEmissive:e.IQ.create(I),uEmissiveTexDim:e.IQ.create(o.ZY.create(I.width,I.height)),dEmissive:e.IQ.create(b>0),emissiveAverage:e.IQ.create(0),tEmissiveGrid:e.IQ.create((0,t.z6)()),uEmissiveGridDim:e.IQ.create(o.eB.create(1,1,1)),uEmissiveGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dEmissiveType:e.IQ.create(_),uEmissiveStrength:e.IQ.create(1)}}const v={array:new Uint8Array(1),width:1,height:1};function O(b){return b?(e.IQ.update(b.tEmissive,v),e.IQ.update(b.uEmissiveTexDim,o.ZY.create(1,1)),b):{tEmissive:e.IQ.create(v),uEmissiveTexDim:e.IQ.create(o.ZY.create(1,1)),dEmissive:e.IQ.create(!1),emissiveAverage:e.IQ.create(0),tEmissiveGrid:e.IQ.create((0,t.z6)()),uEmissiveGridDim:e.IQ.create(o.eB.create(1,1,1)),uEmissiveGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dEmissiveType:e.IQ.create("groupInstance"),uEmissiveStrength:e.IQ.create(1)}}},542:(tn,Ue,n)=>{"use strict";n.d(Ue,{V:()=>b});var b,e=n(9283),o=n(5299),r=n(4255),t=n(5315),A=n(9928),y=n(8231),c=n(6115),i=n(799),v=n(7135),O=n(283);!function(_){function M(d){switch(d.kind){case"mesh":return 3*d.triangleCount;case"points":return d.pointCount;case"spheres":return 2*d.sphereCount*3;case"cylinders":return 4*d.cylinderCount*3;case"text":return 2*d.charCount*3;case"lines":return 2*d.lineCount*3;case"direct-volume":return 36;case"image":return 6;case"texture-mesh":return d.vertexCount}}_.getDrawCount=M,_.getVertexCount=function I(d){switch(d.kind){case"mesh":case"texture-mesh":return d.vertexCount;case"points":return d.pointCount;case"spheres":return 6*d.sphereCount;case"cylinders":return 6*d.cylinderCount;case"text":return 4*d.charCount;case"lines":return 4*d.lineCount;case"direct-volume":const[s,C,h]=d.gridDimension.ref.value;return s*C*h;case"image":return 4}},_.getGroupCount=function l(d){switch(d.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return 0===M(d)?0:(0,c._M)(d.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return(0,c._M)(d.groupTexture.ref.value.array)+1;case"texture-mesh":return d.groupCount}},_.getUtils=function m(d){switch(d.kind){case"mesh":return e.e.Utils;case"points":return o.O.Utils;case"spheres":return y.v.Utils;case"cylinders":return O.S.Utils;case"text":return r.E.Utils;case"lines":return t.q.Utils;case"direct-volume":return A.E.Utils;case"image":return v._V.Utils;case"texture-mesh":return i.X.Utils}},_.getGranularity=function u(d,s){return"instance"===s&&d.nonInstanceable?"group":s}}(b||(b={}))},7135:(tn,Ue,n)=>{"use strict";n.d(Ue,{Bd:()=>a,_V:()=>S});var e=n(8382),o=n(1888),r=n(3784),t=n(5384),A=n(4369),y=n(9909),c=n(8277),i=n(5019),v=n(2712),O=n(8013),b=n(2075),_=n(9197),M=n(6115),I=n(5077),l=n(364),m=n(9007),u=n(8307),d=n(6022);const s=new Uint32Array([0,1,2,1,3,2]),C=new Float32Array([0,1,0,0,1,1,1,0]),h={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},a=Object.keys(h);var S;!function(R){function f(k,H,$,J){return J?function T(k,H,$,J){const W=k.width,te=k.height;return y.IQ.update(J.imageTexture,k),y.IQ.update(J.imageTextureDim,A.ZY.set(J.imageTextureDim.ref.value,W,te)),y.IQ.update(J.cornerBuffer,H),y.IQ.update(J.groupTexture,$),J}(k,H,$,J):function E(k,H,$){const J=(0,t.f8)();let W=-1;const te=k.width,de=k.height,ye={kind:"image",imageTexture:y.IQ.create(k),imageTextureDim:y.IQ.create(A.ZY.create(te,de)),cornerBuffer:y.IQ.create(H),groupTexture:y.IQ.create($),get boundingSphere(){const j=function p(k){return(0,e.TI)([k.cornerBuffer.ref.version])}(ye);if(j!==W){const Z=function D(R){const f=(0,A.eB)(),p=[];for(let L=0,w=R.length;L<w;L+=3){const Q=A.eB.fromArray((0,A.eB)(),R,L);p.push(Q),A.eB.add(f,f,Q)}A.eB.scale(f,f,1/(R.length/3));let E=0;for(const L of p){const w=A.eB.distance(f,L);w>E&&(E=w)}const T=t.f8.create(f,E);return t.f8.setExtrema(T,p),T}(ye.cornerBuffer.ref.value);t.f8.copy(J,Z),W=j}return J}};return ye}(k,H,$)}function L(k){return f((0,r.xg)(0,4,Uint8Array),k?k.cornerBuffer.ref.value:new Float32Array(24),(0,r.xg)(0,4,Uint8Array),k)}function w(k,H,$,J,W){const{instanceCount:te,groupCount:de}=$,ye=R.Utils.createPositionIterator(k,H),j=(0,v.D1)($,ye,J.color),Z=W.instanceGranularity?(0,O.Km)(te,"instance"):(0,O.Km)(te*de,"groupInstance"),q=(0,b.WG)(),Y=(0,_.MD)(),ee=(0,d.JS)(),g=(0,u.IB)(),_e=(0,I.EN)(),xe={drawCount:s.length,vertexCount:m.Wp.length/3,groupCount:de,instanceCount:te},le=t.f8.clone(k.boundingSphere),Ae=(0,r.Ax)(le,H.aTransform.ref.value,te,0);return{dGeometryType:y.IQ.create("image"),...j,...Z,...q,...Y,...ee,...g,..._e,...H,...i.iy.createValues(W,xe),aPosition:k.cornerBuffer,aUv:y.IQ.create(C),elements:y.IQ.create(s),aGroup:y.IQ.create((0,M.WE)(new Float32Array(4))),boundingSphere:y.IQ.create(Ae),invariantBoundingSphere:y.IQ.create(le),uInvariantBoundingSphere:y.IQ.create(A.Zb.ofSphere(le)),dInterpolation:y.IQ.create(W.interpolation),uImageTexDim:k.imageTextureDim,tImageTex:k.imageTexture,tGroupTex:k.groupTexture}}R.create=f,R.createEmpty=L,R.Params={...i.iy.Params,interpolation:c.t.Select("bspline",c.t.objectToOptions(h))},R.Utils={Params:R.Params,createEmpty:L,createValues:w,createValuesSimple:function Q(k,H,$,J,W){const te=i.iy.createSimple($,J,W),de={...c.t.getDefaultValues(R.Params),...H};return w(k,te.transform,te.locationIterator,te.theme,de)},updateValues:function G(k,H){i.iy.updateValues(k,H),y.IQ.updateIfChanged(k.dInterpolation,H.interpolation)},updateBoundingSphere:function V(k,H){const $=t.f8.clone(H.boundingSphere),J=(0,r.Ax)($,k.aTransform.ref.value,k.instanceCount.ref.value,0);t.f8.equals(J,k.boundingSphere.ref.value)||y.IQ.update(k.boundingSphere,J),t.f8.equals($,k.invariantBoundingSphere.ref.value)||(y.IQ.update(k.invariantBoundingSphere,$),y.IQ.update(k.uInvariantBoundingSphere,A.Zb.fromSphere(k.uInvariantBoundingSphere.ref.value,$)))},createRenderableState:function U(k){const H=i.iy.createRenderableState(k);return H.opaque=!1,H},updateRenderableState:function N(k,H){i.iy.updateRenderableState(k,H),k.opaque=!1},createPositionIterator:()=>(0,o.iQ)(1,1,1,()=>l.LU)}}(S||(S={}))},5821:(tn,Ue,n)=>{"use strict";n.d(Ue,{d:()=>v});var e=n(8382),o=n(5315),r=n(4369);const t=(0,r.eB)(),A=(0,r.eB)(),y=(0,r.eB)(),c=e.Gm.add,i=e.Gm.add3;var v;(v||(v={})).create=function _(M=2048,I=1024,l){const m=e.Gm.create(Float32Array,1,I,l?l.groupBuffer.ref.value:M),u=e.Gm.create(Float32Array,3,I,l?l.startBuffer.ref.value:M),d=e.Gm.create(Float32Array,3,I,l?l.endBuffer.ref.value:M),s=(a,S,D,R,f,p,E)=>{for(let T=0;T<4;++T)i(u,a,S,D),i(d,R,f,p),c(m,E)},h=(a,S,D,R)=>{const f=r.eB.distance(a,S),p=D%2!=0,E=Math.floor((D+1)/2),T=f/(D+.5);r.eB.setMagnitude(y,r.eB.sub(y,S,a),T),r.eB.copy(t,a);for(let L=0;L<E;++L)r.eB.add(t,t,y),p&&L===E-1?r.eB.copy(A,S):r.eB.add(A,t,y),s(t[0],t[1],t[2],A[0],A[1],A[2],R),r.eB.add(t,t,y)};return{add:s,addVec:(a,S,D)=>{for(let R=0;R<4;++R)i(u,a[0],a[1],a[2]),i(d,S[0],S[1],S[2]),c(m,D)},addFixedCountDashes:h,addFixedLengthDashes:(a,S,D,R)=>{const f=r.eB.distance(a,S);h(a,S,f/D,R)},addCage:(a,S,D)=>{const{vertices:R,edges:f}=S;for(let p=0,E=f.length;p<E;p+=2)r.eB.fromArray(t,R,3*f[p]),r.eB.fromArray(A,R,3*f[p+1]),r.eB.transformMat4(t,t,a),r.eB.transformMat4(A,A,a),s(t[0],t[1],t[2],A[0],A[1],A[2],D)},getLines:()=>{const a=m.elementCount/4,S=e.Gm.compact(m,!0),D=e.Gm.compact(u,!0),R=e.Gm.compact(d,!0),f=l&&a<=l.lineCount?l.mappingBuffer.ref.value:new Float32Array(8*a),p=l&&a<=l.lineCount?l.indexBuffer.ref.value:new Uint32Array(6*a);return(!l||a>l.lineCount)&&function O(b,_,M){for(let I=0;I<b;++I){const l=8*I;_[l]=-1,_[l+1]=-1,_[l+2]=1,_[l+3]=-1,_[l+4]=-1,_[l+5]=1,_[l+6]=1,_[l+7]=1}for(let I=0;I<b;++I){const l=4*I,m=6*I;M[m]=l,M[m+1]=l+1,M[m+2]=l+2,M[m+3]=l+1,M[m+4]=l+3,M[m+5]=l+2}}(a,f,p),o.q.create(f,p,S,D,R,a,l)}}}},5315:(tn,Ue,n)=>{"use strict";n.d(Ue,{q:()=>s});var s,e=n(9909),o=n(4369),r=n(4559),t=n(2712),A=n(8013),y=n(7684),c=n(1888),i=n(5821),v=n(8277),O=n(3784),b=n(5384),_=n(5019),M=n(2075),I=n(9197),l=n(8382),m=n(5077),u=n(8307),d=n(6022);!function(C){function h(G,V,U,N,k,H,$){return $?function f(G,V,U,N,k,H,$){return H>$.lineCount&&(e.IQ.update($.mappingBuffer,G),e.IQ.update($.indexBuffer,V)),$.lineCount=H,e.IQ.update($.groupBuffer,U),e.IQ.update($.startBuffer,N),e.IQ.update($.endBuffer,k),$}(G,V,U,N,k,H,$):function R(G,V,U,N,k,H){const $=(0,b.f8)();let J,W=-1,te=-1;const de={kind:"lines",lineCount:H,mappingBuffer:e.IQ.create(G),indexBuffer:e.IQ.create(V),groupBuffer:e.IQ.create(U),startBuffer:e.IQ.create(N),endBuffer:e.IQ.create(k),get boundingSphere(){const ye=D(de);if(ye!==W){const j=(0,O.sL)(de.startBuffer.ref.value,4*de.lineCount,4),Z=(0,O.sL)(de.endBuffer.ref.value,4*de.lineCount,4);b.f8.expandBySphere($,j,Z),W=ye}return $},get groupMapping(){return de.groupBuffer.ref.version!==te&&(J=(0,r.AA)(de.groupBuffer.ref.value,de.lineCount,4),te=de.groupBuffer.ref.version),J},setBoundingSphere(ye){b.f8.copy($,ye),W=D(de)}};return de}(G,V,U,N,k,H)}function a(G){return h(G?G.mappingBuffer.ref.value:new Float32Array(0),G?G.indexBuffer.ref.value:new Uint32Array(0),G?G.groupBuffer.ref.value:new Float32Array(0),G?G.startBuffer.ref.value:new Float32Array(0),G?G.endBuffer.ref.value:new Float32Array(0),0,G)}function D(G){return(0,l.TI)([G.lineCount,G.mappingBuffer.ref.version,G.indexBuffer.ref.version,G.groupBuffer.ref.version,G.startBuffer.ref.version,G.endBuffer.ref.version])}function E(G,V){const U=4*G.lineCount,N=V.instanceCount.ref.value,k=(0,c.tu)(),H=k.position,$=G.startBuffer.ref.value,J=G.endBuffer.ref.value,W=V.aTransform.ref.value;return(0,c.iQ)(U,N,2,(de,ye)=>{const j=de%4==0?$:J;return ye<0?o.eB.fromArray(H,j,3*de):o.eB.transformMat4Offset(H,j,W,0,3*de,16*ye),k})}function T(G,V,U,N,k){const{instanceCount:H,groupCount:$}=U,J=E(G,V),W=(0,t.D1)(U,J,N.color),te=(0,y.v3)(U,N.size),de=k.instanceGranularity?(0,A.Km)(H,"instance"):(0,A.Km)(H*$,"groupInstance"),ye=(0,M.WG)(),j=(0,I.MD)(),Z=(0,d.JS)(),q=(0,u.IB)(),Y=(0,m.EN)(),ee={drawCount:2*G.lineCount*3,vertexCount:4*G.lineCount,groupCount:$,instanceCount:H},g=b.f8.clone(G.boundingSphere),_e=(0,O.Ax)(g,V.aTransform.ref.value,H,0);return{dGeometryType:e.IQ.create("lines"),aMapping:G.mappingBuffer,aGroup:G.groupBuffer,aStart:G.startBuffer,aEnd:G.endBuffer,elements:G.indexBuffer,boundingSphere:e.IQ.create(_e),invariantBoundingSphere:e.IQ.create(g),uInvariantBoundingSphere:e.IQ.create(o.Zb.ofSphere(g)),...W,...te,...de,...ye,...j,...Z,...q,...Y,...V,..._.iy.createValues(k,ee),uSizeFactor:e.IQ.create(k.sizeFactor),dLineSizeAttenuation:e.IQ.create(k.lineSizeAttenuation),uDoubleSided:e.IQ.create(!0),dFlipSided:e.IQ.create(!1)}}C.create=h,C.createEmpty=a,C.fromMesh=function S(G,V){const U=G.vertexBuffer.ref.value,N=G.indexBuffer.ref.value,k=G.groupBuffer.ref.value,H=i.d.create(3*G.triangleCount,G.triangleCount/10,V);for(let $=0,J=3*G.triangleCount;$<J;$+=3){const W=N[$],te=N[$+1],de=N[$+2],ye=U[3*W],j=U[3*W+1],Z=U[3*W+2],q=U[3*te],Y=U[3*te+1],ee=U[3*te+2],g=U[3*de],_e=U[3*de+1],xe=U[3*de+2];H.add(ye,j,Z,q,Y,ee,k[W]),H.add(ye,j,Z,g,_e,xe,k[W]),H.add(q,Y,ee,g,_e,xe,k[te])}return H.getLines()},C.transform=function p(G,V){const U=G.startBuffer.ref.value;(0,r.pi)(V,U,0,4*G.lineCount),e.IQ.update(G.startBuffer,U);const N=G.endBuffer.ref.value;(0,r.pi)(V,N,0,4*G.lineCount),e.IQ.update(G.endBuffer,N)},C.Params={..._.iy.Params,sizeFactor:v.t.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:v.t.Boolean(!1)},C.Utils={Params:C.Params,createEmpty:a,createValues:T,createValuesSimple:function L(G,V,U,N,k){const H=_.iy.createSimple(U,N,k),$={...v.t.getDefaultValues(C.Params),...V};return T(G,H.transform,H.locationIterator,H.theme,$)},updateValues:function w(G,V){_.iy.updateValues(G,V),e.IQ.updateIfChanged(G.uSizeFactor,V.sizeFactor),e.IQ.updateIfChanged(G.dLineSizeAttenuation,V.lineSizeAttenuation)},updateBoundingSphere:function Q(G,V){const U=b.f8.clone(V.boundingSphere),N=(0,O.Ax)(U,G.aTransform.ref.value,G.instanceCount.ref.value,0);b.f8.equals(N,G.boundingSphere.ref.value)||e.IQ.update(G.boundingSphere,N),b.f8.equals(U,G.invariantBoundingSphere.ref.value)||(e.IQ.update(G.invariantBoundingSphere,U),e.IQ.update(G.uInvariantBoundingSphere,o.Zb.fromSphere(G.uInvariantBoundingSphere.ref.value,U)))},createRenderableState:_.iy.createRenderableState,updateRenderableState:_.iy.updateRenderableState,createPositionIterator:E}}(s||(s={}))},8013:(tn,Ue,n)=>{"use strict";n.d(Ue,{Km:()=>y,Xl:()=>A});var e=n(7187),o=n(4369),r=n(3784);const t=new Uint8Array(772);function A(v,O){if(0===O)return 0;const b=new Uint32Array(v.buffer,0,v.buffer.byteLength>>2),_=O-4>>2,M=4*_;let I=0;if(_<0)for(let l=0;l<O;++l)I+=v[l]&&1;else{for(let l=0;l<_;++l){const m=b[l];I+=t[65535&m]+t[m>>16]}for(let l=M;l<O;++l)I+=v[l]&&1}return I/O}function y(v,O,b){const _=(0,r.xg)(Math.max(1,v),1,Uint8Array,b&&b.tMarker.ref.value.array),M=A(_.array,v),I=0===M?0:-1;return b?(e.IQ.updateIfChanged(b.uMarker,0),e.IQ.update(b.tMarker,_),e.IQ.update(b.uMarkerTexDim,o.ZY.create(_.width,_.height)),e.IQ.updateIfChanged(b.markerAverage,M),e.IQ.updateIfChanged(b.markerStatus,I),e.IQ.updateIfChanged(b.dMarkerType,O),b):{uMarker:e.IQ.create(0),tMarker:e.IQ.create(_),uMarkerTexDim:e.IQ.create(o.ZY.create(_.width,_.height)),markerAverage:e.IQ.create(M),markerStatus:e.IQ.create(I),dMarkerType:e.IQ.create(O)}}t[1]=1,t[2]=1,t[3]=1,t[256]=1,t[512]=1,t[768]=1,t[257]=2,t[513]=2,t[769]=2,t[258]=2,t[514]=2,t[770]=2,t[259]=2,t[515]=2,t[771]=2,new Uint8Array(1)},2802:(tn,Ue,n)=>{"use strict";n.d(Ue,{y9:()=>D,Jz:()=>R,GH:()=>f});var e=n(4369),o=n(573),r=n(6928);const t={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:2*Math.PI};var y=n(3220),c=n(863),i=n(8382);const v=new Map,O=e.eB.create(0,1,0),b=(0,e.eB)(),_=(0,e.eB)(),M=(0,e.eB)(),I=(0,e.$I)(),l=(0,e.$I)(),m=(0,e.eB)(),u=(0,e.eB)(),d=(0,e.eB)();function s(p,E,T,L,w){return e.eB.setMagnitude(_,T,L/2),e.eB.add(M,E,_),w?e.eB.matchDirection(d,O,_):e.eB.copy(d,O),e.eB.set(m,1,L,1),e.eB.makeRotation(l,d,_),e.$I.scale(p,l,m),e.$I.setTranslation(p,M)}const C=new Int32Array(9);function a(p){const E=function h(p){var E,T,L,w,Q,G,V,U,N;return C[0]=Math.round(1e3*(null!==(E=p.radiusTop)&&void 0!==E?E:t.radiusTop)),C[1]=Math.round(1e3*(null!==(T=p.radiusBottom)&&void 0!==T?T:t.radiusBottom)),C[2]=Math.round(1e3*(null!==(L=p.height)&&void 0!==L?L:t.height)),C[3]=null!==(w=p.radialSegments)&&void 0!==w?w:t.radialSegments,C[4]=null!==(Q=p.heightSegments)&&void 0!==Q?Q:t.heightSegments,C[5]=(null!==(G=p.topCap)&&void 0!==G?G:t.topCap)?1:0,C[6]=(null!==(V=p.bottomCap)&&void 0!==V?V:t.bottomCap)?1:0,C[7]=Math.round(1e3*(null!==(U=p.thetaStart)&&void 0!==U?U:t.thetaStart)),C[8]=Math.round(1e3*(null!==(N=p.thetaLength)&&void 0!==N?N:t.thetaLength)),(0,i.TI)(C)}(p);let T=v.get(E);if(void 0===T){if(p.radialSegments&&p.radialSegments<=4){const L=Math.max(3,p.radialSegments),w=(0,y.My)((0,c.n)(L,!0,p.radiusTop),p);T=(0,r._2)(w,e.$I.rotX90)}else T=function A(p){const{radiusTop:E,radiusBottom:T,height:L,radialSegments:w,heightSegments:Q,topCap:G,bottomCap:V,thetaStart:U,thetaLength:N}={...t,...p},k=[],H=[],$=[];let J=0;const W=[],te=L/2;return function de(){const j=e.eB.zero(),Z=(T-E)/L;for(let q=0;q<=Q;++q){const Y=[],ee=q/Q,g=ee*(T-E)+E;for(let _e=0;_e<=w;++_e){const le=_e/w*N+U,Ae=Math.sin(le),Be=Math.cos(le);H.push(g*Ae,-ee*L+te,g*Be),e.eB.normalize(j,e.eB.set(j,Ae,Z,Be)),$.push(...j),Y.push(J++)}W.push(Y)}for(let q=0;q<w;++q)for(let Y=0;Y<Q;++Y){const g=W[Y+1][q],_e=W[Y+1][q+1],xe=W[Y][q+1];k.push(W[Y][q],g,xe),k.push(g,_e,xe)}}(),G&&E>0&&ye(!0),V&&T>0&&ye(!1),{vertices:new Float32Array(H),normals:new Float32Array($),indices:new Uint32Array(k)};function ye(j){const Z=!0===j?E:T,q=!0===j?1:-1,Y=J;for(let g=1;g<=w;++g)H.push(0,te*q,0),$.push(0,q,0),++J;const ee=J;for(let g=0;g<=w;++g){const xe=g/w*N+U,le=Math.cos(xe),Ae=Math.sin(xe);H.push(Z*Ae,te*q,Z*le),$.push(0,q,0),++J}for(let g=0;g<w;++g){const _e=Y+g,xe=ee+g;!0===j?k.push(xe,xe+1,_e):k.push(xe+1,xe,_e)}}}(p);v.set(E,T)}return T}function D(p,E,T,L,w){const Q=e.eB.distance(E,T)*L;e.eB.sub(b,T,E),s(I,E,b,Q,!0),o.P.addPrimitive(p,I,a(w))}function R(p,E,T,L,w,Q){const G=e.eB.distance(E,T)*L,V=a(Q);e.eB.sub(b,T,E),e.eB.add(u,E,w),s(I,u,b,G,!0),o.P.addPrimitive(p,I,V),e.eB.sub(u,E,w),s(I,u,b,G,!0),o.P.addPrimitive(p,I,V)}function f(p,E,T,L,w,Q,G){const V=e.eB.distance(E,T)*L,U=w%2!=0,N=Math.floor((w+1)/2);let k=V/(w+.5),H=a(G);e.eB.setMagnitude(b,e.eB.sub(b,T,E),k),e.eB.copy(u,E);for(let $=0;$<N;++$)e.eB.add(u,u,b),U&&$===N-1&&(!Q&&G.topCap&&(G.topCap=!1,H=a(G)),k/=2),s(I,u,b,k,!1),o.P.addPrimitive(p,I,H),e.eB.add(u,u,b)}},4777:(tn,Ue,n)=>{"use strict";n.d(Ue,{P:()=>c});var e=n(4369),o=n(573),r=n(4439);const t=e.$I.identity(),A=(0,e.eB)();function c(i,v,O,b,_,M){o.P.addPrimitive(i,function y(i,v,O,b,_){return e.eB.add(A,v,O),e.$I.targetTo(i,v,A,b),e.$I.setTranslation(i,v),e.$I.scale(i,i,_)}(t,v,O,b,_),(0,r.q)(M))}},4439:(tn,Ue,n)=>{"use strict";n.d(Ue,{X:()=>i,q:()=>c});var e=n(4369),o=n(573),r=n(9132);const t=new Map,A=e.$I.identity();function c(v){let O=t.get(v);return void 0===O&&(O=(0,r.i)(v),t.set(v,O)),O}function i(v,O,b,_){o.P.addPrimitive(v,function y(v,O,b){return e.$I.scaleUniformly(v,e.$I.fromTranslation(v,O),b)}(A,O,b),c(_))}},4992:(tn,Ue,n)=>{"use strict";n.d(Ue,{Cn:()=>d,WT:()=>_,XP:()=>O,_j:()=>I,bj:()=>m});var e=n(3784),o=n(5384),r=n(127),t=n(4369),A=n(4178),y=n(9909);function c(s,C,h,a,S){const{colorType:D,vertexCount:R,groupCount:f,positionBuffer:p,transformBuffer:E,groupBuffer:T,itemSize:L}=s,w=D.endsWith("Instance"),Q=o.DJ.fromSphere3D((0,o.DJ)(),w?s.boundingSphere:s.invariantBoundingSphere),G=1+C,V=o.DJ.expand((0,o.DJ)(),Q,t.eB.create(G,G,G)),U=1/C,N=o.DJ.scale((0,o.DJ)(),V,U),k=o.DJ.size((0,t.eB)(),N);t.eB.ceil(k,k),t.eB.add(k,k,t.eB.create(2,2,2));const{min:H}=V,[$,J]=k,{width:W,height:te}=(0,A.Ud)(k),de=new Float32Array(W*te*L),ye=new Float32Array(W*te),j=new Uint8Array(W*te*L),Z={array:j,width:W,height:te,filter:"linear"},q=w?s.instanceCount:1,Y=s.colorData.array;function ee(ke,we,Oe){const Se=Math.floor(Oe*$%W/$),Ve=Math.floor(Oe*$/W);return L*(Ve*J*W+we*W+(Se*$+ke))}const[_e,xe,le]=k,Ae=(0,t.eB)();for(let ke=0;ke<q;++ke)for(let we=0;we<R;we+=h){t.eB.fromArray(Ae,p,3*we),w&&t.eB.transformMat4Offset(Ae,Ae,E,0,0,16*ke),t.eB.sub(Ae,Ae,H),t.eB.scale(Ae,Ae,U);const[Oe,Se,Ve]=Ae,Ne=Math.floor(Oe),K=Math.floor(Se),ne=Math.floor(Ve),be=(ke*f+T[we])*L,Te=Math.max(0,Ne-2),ie=Math.max(0,K-2),ue=Math.max(0,ne-2),re=Math.min(_e,Ne+2+2),ve=Math.min(xe,K+2+2),ce=Math.min(le,ne+2+2);for(let se=Te;se<re;++se){const ae=se-Oe;for(let ge=ie;ge<ve;++ge){const Ie=ge-Se;for(let Le=ue;Le<ce;++Le){const nt=Le-Ve,je=Math.sqrt(ae*ae+Ie*Ie+nt*nt);if(je>2)continue;const Lt=2-je,Je=ee(se,ge,Le);for(let en=0;en<L;++en)de[Je+en]+=Y[be+en]*Lt;ye[Je/L]+=Lt}}}}for(let ke=0,we=ye.length;ke<we;++ke){const Oe=ke*L,Se=ye[ke];for(let Ve=0;Ve<L;++Ve)j[Oe+Ve]=Math.round(de[Oe+Ve]/Se)}const Be=t.ZY.create(W,te),Ce=t.Zb.create(H[0],H[1],H[2],U),Re=w?"volumeInstance":"volume";if(a)return S||(S=a.resources.texture("image-uint8",4===L?"rgba":3===L?"rgb":"alpha","ubyte","linear")),S.load(Z),{kind:"volume",texture:S,gridTexDim:Be,gridDim:k,gridTransform:Ce,type:Re};{const ke=function i(s){const{vertexCount:C,positionBuffer:h,transformBuffer:a,grid:S,gridDim:D,gridTexDim:R,gridTransform:f,vertexStride:p,colorStride:E}=s,T=s.itemOffset||0,L=s.outputStride;if(L+T>E)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");const w=s.colorType.endsWith("Instance"),Q=w?s.instanceCount:1,G=(0,e.xg)(Math.max(1,Q*C),L,Uint8Array),{array:V}=G,[U,N]=D,k=R[0],H=t.eB.fromArray((0,t.eB)(),f,0),$=f[3];function J(j,Z,q){const Y=Math.floor(q*U%k/U),ee=Math.floor(q*U/k);return E*(ee*N*k+Z*k+(Y*U+j))}const W=(0,t.eB)(),te=(0,t.eB)(),de=(0,t.eB)(),ye=(0,t.eB)();for(let j=0;j<Q;++j)for(let Z=0;Z<C;++Z){t.eB.fromArray(W,h,Z*p),w&&t.eB.transformMat4Offset(W,W,a,0,0,16*j),t.eB.sub(W,W,H),t.eB.scale(W,W,$),t.eB.floor(te,W),t.eB.ceil(de,W),t.eB.sub(ye,W,te),t.eB.sub(W,de,te),t.eB.div(ye,ye,W);const[q,Y,ee]=te,[g,_e,xe]=de,[le,Ae,Be]=ye,Ce=J(q,Y,ee)+T,Re=J(g,Y,ee)+T,ke=J(q,Y,xe)+T,we=J(g,Y,xe)+T,Oe=J(q,_e,ee)+T,Se=J(g,_e,ee)+T,Ve=J(q,_e,xe)+T,Ne=J(g,_e,xe)+T,K=(j*C+Z)*L;for(let ne=0;ne<L;++ne){const ie=S[ke+ne],ue=S[we+ne],re=S[Oe+ne],ve=S[Se+ne],ce=S[Ve+ne],se=S[Ne+ne],ae=(0,r.Cc)(S[Ce+ne],S[Re+ne],le),ge=(0,r.Cc)(ie,ue,le),Ie=(0,r.Cc)(re,ve,le),Le=(0,r.Cc)(ce,se,le),nt=(0,r.Cc)(ae,Ie,Ae),je=(0,r.Cc)(ge,Le,Ae);V[K+ne]=(0,r.Cc)(nt,je,Be)}}return G}({vertexCount:R,instanceCount:q,transformBuffer:E,positionBuffer:p,colorType:Re,grid:j,gridDim:k,gridTexDim:Be,gridTransform:Ce,vertexStride:3,colorStride:L,outputStride:L});return{kind:"vertex",texture:ke,texDim:t.ZY.create(ke.width,ke.height),type:w?"vertexInstance":"vertex"}}}function O(s,C,h,a,S){if(!function v(s){return"group"===s||"groupInstance"===s}(s.dColorType.ref.value))return;const D=c({vertexCount:s.uVertexCount.ref.value,instanceCount:s.uInstanceCount.ref.value,groupCount:s.uGroupCount.ref.value,transformBuffer:s.aTransform.ref.value,instanceBuffer:s.aInstance.ref.value,positionBuffer:s.aPosition.ref.value,groupBuffer:s.aGroup.ref.value,colorData:s.tColor.ref.value,colorType:s.dColorType.ref.value,boundingSphere:s.boundingSphere.ref.value,invariantBoundingSphere:s.invariantBoundingSphere.ref.value,itemSize:3},C,h,a,S);"volume"===D.kind?(y.IQ.updateIfChanged(s.dColorType,D.type),y.IQ.update(s.tColorGrid,D.texture),y.IQ.update(s.uColorTexDim,D.gridTexDim),y.IQ.update(s.uColorGridDim,D.gridDim),y.IQ.update(s.uColorGridTransform,D.gridTransform)):"vertex"===D.kind&&(y.IQ.updateIfChanged(s.dColorType,D.type),y.IQ.update(s.tColor,D.texture),y.IQ.update(s.uColorTexDim,D.texDim))}function _(s,C,h,a,S){if(!function b(s){return"groupInstance"===s}(s.dOverpaintType.ref.value))return;const D=c({vertexCount:s.uVertexCount.ref.value,instanceCount:s.uInstanceCount.ref.value,groupCount:s.uGroupCount.ref.value,transformBuffer:s.aTransform.ref.value,instanceBuffer:s.aInstance.ref.value,positionBuffer:s.aPosition.ref.value,groupBuffer:s.aGroup.ref.value,colorData:s.tOverpaint.ref.value,colorType:s.dOverpaintType.ref.value,boundingSphere:s.boundingSphere.ref.value,invariantBoundingSphere:s.invariantBoundingSphere.ref.value,itemSize:4},C,h,a,S);"volume"===D.kind?(y.IQ.updateIfChanged(s.dOverpaintType,D.type),y.IQ.update(s.tOverpaintGrid,D.texture),y.IQ.update(s.uOverpaintTexDim,D.gridTexDim),y.IQ.update(s.uOverpaintGridDim,D.gridDim),y.IQ.update(s.uOverpaintGridTransform,D.gridTransform)):"vertex"===D.kind&&(y.IQ.updateIfChanged(s.dOverpaintType,D.type),y.IQ.update(s.tOverpaint,D.texture),y.IQ.update(s.uOverpaintTexDim,D.texDim))}function I(s,C,h,a,S){if(!function M(s){return"groupInstance"===s}(s.dTransparencyType.ref.value))return;const D=c({vertexCount:s.uVertexCount.ref.value,instanceCount:s.uInstanceCount.ref.value,groupCount:s.uGroupCount.ref.value,transformBuffer:s.aTransform.ref.value,instanceBuffer:s.aInstance.ref.value,positionBuffer:s.aPosition.ref.value,groupBuffer:s.aGroup.ref.value,colorData:s.tTransparency.ref.value,colorType:s.dTransparencyType.ref.value,boundingSphere:s.boundingSphere.ref.value,invariantBoundingSphere:s.invariantBoundingSphere.ref.value,itemSize:1},C,h,a,S);"volume"===D.kind?(y.IQ.updateIfChanged(s.dTransparencyType,D.type),y.IQ.update(s.tTransparencyGrid,D.texture),y.IQ.update(s.uTransparencyTexDim,D.gridTexDim),y.IQ.update(s.uTransparencyGridDim,D.gridDim),y.IQ.update(s.uTransparencyGridTransform,D.gridTransform)):"vertex"===D.kind&&(y.IQ.updateIfChanged(s.dTransparencyType,D.type),y.IQ.update(s.tTransparency,D.texture),y.IQ.update(s.uTransparencyTexDim,D.texDim))}function m(s,C,h,a,S){if(!function l(s){return"groupInstance"===s}(s.dEmissiveType.ref.value))return;const D=c({vertexCount:s.uVertexCount.ref.value,instanceCount:s.uInstanceCount.ref.value,groupCount:s.uGroupCount.ref.value,transformBuffer:s.aTransform.ref.value,instanceBuffer:s.aInstance.ref.value,positionBuffer:s.aPosition.ref.value,groupBuffer:s.aGroup.ref.value,colorData:s.tEmissive.ref.value,colorType:s.dEmissiveType.ref.value,boundingSphere:s.boundingSphere.ref.value,invariantBoundingSphere:s.invariantBoundingSphere.ref.value,itemSize:1},C,h,a,S);"volume"===D.kind?(y.IQ.updateIfChanged(s.dEmissiveType,D.type),y.IQ.update(s.tEmissiveGrid,D.texture),y.IQ.update(s.uEmissiveTexDim,D.gridTexDim),y.IQ.update(s.uEmissiveGridDim,D.gridDim),y.IQ.update(s.uEmissiveGridTransform,D.gridTransform)):"vertex"===D.kind&&(y.IQ.updateIfChanged(s.dEmissiveType,D.type),y.IQ.update(s.tEmissive,D.texture),y.IQ.update(s.uEmissiveTexDim,D.texDim))}function d(s,C,h,a,S){if(!function u(s){return"groupInstance"===s}(s.dSubstanceType.ref.value))return;const D=c({vertexCount:s.uVertexCount.ref.value,instanceCount:s.uInstanceCount.ref.value,groupCount:s.uGroupCount.ref.value,transformBuffer:s.aTransform.ref.value,instanceBuffer:s.aInstance.ref.value,positionBuffer:s.aPosition.ref.value,groupBuffer:s.aGroup.ref.value,colorData:s.tSubstance.ref.value,colorType:s.dSubstanceType.ref.value,boundingSphere:s.boundingSphere.ref.value,invariantBoundingSphere:s.invariantBoundingSphere.ref.value,itemSize:4},C,h,a,S);"volume"===D.kind?(y.IQ.updateIfChanged(s.dSubstanceType,D.type),y.IQ.update(s.tSubstanceGrid,D.texture),y.IQ.update(s.uSubstanceTexDim,D.gridTexDim),y.IQ.update(s.uSubstanceGridDim,D.gridDim),y.IQ.update(s.uSubstanceGridTransform,D.gridTransform)):"vertex"===D.kind&&(y.IQ.updateIfChanged(s.dSubstanceType,D.type),y.IQ.update(s.tSubstance,D.texture),y.IQ.update(s.uSubstanceTexDim,D.texDim))}},573:(tn,Ue,n)=>{"use strict";n.d(Ue,{P:()=>C});var e=n(4369),o=n(8382),r=n(9283),t=n(4439),A=n(2802);const y=(0,e.eB)(),c=(0,e.U)(),i=(0,e.eB)(),v=(0,e.eB)(),O=(0,e.eB)(),b=(0,e.eB)(),_=e.eB.fromArray,M=e.eB.triangleNormal,I=e.eB.copy,l=e.eB.transformMat4,m=e.eB.transformMat3,u=e.U.directionTransform,d=o.Gm.add3,s=o.Gm.add;var C;!function(h){function S(G,V,U,N){const{vertices:k,normals:H,indices:$,groups:J,currentGroup:W}=G,te=k.elementCount;d(k,V[0],V[1],V[2]),d(k,U[0],U[1],U[2]),d(k,N[0],N[1],N[2]),M(y,V,U,N);for(let de=0;de<3;++de)d(H,y[0],y[1],y[2]),s(J,W);d($,te,te+1,te+2)}function D(G,V,U,N,k){const{vertices:H,normals:$,indices:J,groups:W,currentGroup:te}=G,de=H.elementCount;d(H,V[0],V[1],V[2]),d(H,U[0],U[1],U[2]),d(H,N[0],N[1],N[2]);for(let ye=0;ye<3;++ye)d($,k[0],k[1],k[2]),s(W,te);d(J,de,de+1,de+2)}function E(G,V,U){const{vertices:N,normals:k,indices:H}=U,{vertices:$,normals:J,indices:W,groups:te,currentGroup:de}=G,ye=$.elementCount,j=u(c,V);for(let Z=0,q=N.length;Z<q;Z+=3)l(y,_(y,N,Z),V),d($,y[0],y[1],y[2]),m(y,_(y,k,Z),j),d(J,y[0],y[1],y[2]),s(te,de);for(let Z=0,q=H.length;Z<q;Z+=3)d(W,H[Z]+ye,H[Z+1]+ye,H[Z+2]+ye)}h.createState=function a(G=2048,V=1024,U){return{currentGroup:-1,vertices:o.Gm.create(Float32Array,3,V,U?U.vertexBuffer.ref.value:G),normals:o.Gm.create(Float32Array,3,V,U?U.normalBuffer.ref.value:G),indices:o.Gm.create(Uint32Array,3,3*V,U?U.indexBuffer.ref.value:3*G),groups:o.Gm.create(Float32Array,1,V,U?U.groupBuffer.ref.value:G),mesh:U}},h.addTriangle=S,h.addTriangleWithNormal=D,h.addTriangleStrip=function R(G,V,U){_(O,V,3*U[0]),_(b,V,3*U[1]);for(let N=2,k=U.length;N<k;N+=2)I(i,O),I(v,b),_(O,V,3*U[N]),_(b,V,3*U[N+1]),S(G,i,v,O),S(G,v,b,O)},h.addTriangleFan=function f(G,V,U){_(i,V,3*U[0]);for(let N=2,k=U.length;N<k;++N)_(v,V,3*U[N-1]),_(O,V,3*U[N]),S(G,i,O,v)},h.addTriangleFanWithNormal=function p(G,V,U,N){_(i,V,3*U[0]);for(let k=2,H=U.length;k<H;++k)_(v,V,3*U[k-1]),_(O,V,3*U[k]),D(G,i,O,v,N)},h.addPrimitive=E,h.addPrimitiveFlipped=function T(G,V,U){const{vertices:N,normals:k,indices:H}=U,{vertices:$,normals:J,indices:W,groups:te,currentGroup:de}=G,ye=$.elementCount,j=u(c,V);for(let Z=0,q=N.length;Z<q;Z+=3)l(y,_(y,N,Z),V),d($,y[0],y[1],y[2]),m(y,_(y,k,Z),j),d(J,-y[0],-y[1],-y[2]),s(te,de);for(let Z=0,q=H.length;Z<q;Z+=3)d(W,H[Z+2]+ye,H[Z+1]+ye,H[Z]+ye)},h.addCage=function L(G,V,U,N,k,H){const{vertices:$,edges:J}=U,W={radiusTop:N,radiusBottom:N,radialSegments:H};for(let te=0,de=J.length;te<de;te+=2)_(i,$,3*J[te]),_(v,$,3*J[te+1]),l(i,i,V),l(v,v,V),(0,t.X)(G,i,N,k),(0,t.X)(G,v,N,k),(0,A.y9)(G,i,v,1,W)},h.addMesh=function w(G,V,U){E(G,V,{vertices:U.vertexBuffer.ref.value.subarray(0,3*U.vertexCount),normals:U.normalBuffer.ref.value.subarray(0,3*U.vertexCount),indices:U.indexBuffer.ref.value.subarray(0,3*U.triangleCount)})},h.getMesh=function Q(G){const{vertices:V,normals:U,indices:N,groups:k,mesh:H}=G,$=o.Gm.compact(V,!0),J=o.Gm.compact(N,!0),W=o.Gm.compact(U,!0),te=o.Gm.compact(k,!0);return r.e.create($,J,W,te,G.vertices.elementCount,G.indices.elementCount,H)}}(C||(C={}))},9283:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>s});var s,e=n(9909),o=n(4369),r=n(5384),t=n(4559),A=n(8013),y=n(1888),c=n(2712),i=n(8382),v=n(8277),O=n(3784),b=n(5019),_=n(2075),M=n(9197),I=n(5077),l=n(6115),m=n(4490),u=n(8307),d=n(6022);!function(C){function h(q,Y,ee,g,_e,xe,le){return le?function R(q,Y,ee,g,_e,xe,le){return le.vertexCount=_e,le.triangleCount=xe,e.IQ.update(le.vertexBuffer,q),e.IQ.update(le.indexBuffer,Y),e.IQ.update(le.normalBuffer,ee),e.IQ.update(le.groupBuffer,g),le}(q,Y,ee,g,_e,xe,le):function D(q,Y,ee,g,_e,xe){const le=(0,r.f8)();let Ae,Be=-1,Ce=-1;const Re={kind:"mesh",vertexCount:_e,triangleCount:xe,vertexBuffer:e.IQ.create(q),indexBuffer:e.IQ.create(Y),normalBuffer:e.IQ.create(ee),groupBuffer:e.IQ.create(g),varyingGroup:e.IQ.create(!1),get boundingSphere(){const ke=S(Re);if(ke!==Be){const we=(0,O.sL)(Re.vertexBuffer.ref.value,Re.vertexCount,1);r.f8.copy(le,we),Be=ke}return le},get groupMapping(){return Re.groupBuffer.ref.version!==Ce&&(Ae=(0,t.AA)(Re.groupBuffer.ref.value,Re.vertexCount),Ce=Re.groupBuffer.ref.version),Ae},setBoundingSphere(ke){r.f8.copy(le,ke),Be=S(Re)},meta:{}};return Re}(q,Y,ee,g,_e,xe)}function a(q){return h(q?q.vertexBuffer.ref.value:new Float32Array(0),q?q.indexBuffer.ref.value:new Uint32Array(0),q?q.normalBuffer.ref.value:new Float32Array(0),q?q.groupBuffer.ref.value:new Float32Array(0),0,0,q)}function S(q){return(0,i.TI)([q.vertexCount,q.triangleCount,q.vertexBuffer.ref.version,q.indexBuffer.ref.version,q.normalBuffer.ref.version,q.groupBuffer.ref.version])}C.create=h,C.createEmpty=a,C.computeNormals=function f(q){const{vertexCount:Y,triangleCount:ee}=q,g=q.vertexBuffer.ref.value,_e=q.indexBuffer.ref.value,xe=q.normalBuffer.ref.value.length>=3*Y?q.normalBuffer.ref.value:new Float32Array(3*Y);xe===q.normalBuffer.ref.value&&xe.fill(0,0,3*Y),(0,t.xL)(g,_e,xe,Y,ee),e.IQ.update(q.normalBuffer,xe)},C.checkForDuplicateVertices=function p(q,Y=3){const ee=q.vertexBuffer.ref.value,g=new Map,_e=(Ae,Be)=>`${Ae[0].toFixed(Be)}|${Ae[1].toFixed(Be)}|${Ae[2].toFixed(Be)}`;let xe=0;const le=(0,o.eB)();for(let Ae=0,Be=q.vertexCount;Ae<Be;++Ae){o.eB.fromArray(le,ee,3*Ae);const Ce=_e(le,Y),Re=g.get(Ce);void 0!==Re?(xe+=1,g.set(Ce,Re+1)):g.set(Ce,1)}return xe};const E=(0,o.U)();function Q(q){const{vertexCount:Y,triangleCount:ee}=q,g=q.indexBuffer.ref.value,_e=[];for(let xe=0;xe<Y;++xe)_e[xe]=[];for(let xe=0;xe<ee;++xe){const le=g[3*xe],Ae=g[3*xe+1],Be=g[3*xe+2];(0,l.Z2)(_e[le],Ae),(0,l.Z2)(_e[le],Be),(0,l.Z2)(_e[Ae],le),(0,l.Z2)(_e[Ae],Be),(0,l.Z2)(_e[Be],le),(0,l.Z2)(_e[Be],Ae)}return _e}function G(q){const{triangleCount:Y}=q,ee=q.indexBuffer.ref.value,g=new Map,_e=(xe,le)=>{const Ae=(0,i.bd)(xe,le),Be=g.get(Ae)||0;g.set(Ae,Be+1)};for(let xe=0;xe<Y;++xe){const le=ee[3*xe],Ae=ee[3*xe+1],Be=ee[3*xe+2];_e(le,Ae),_e(le,Be),_e(Ae,Be)}return g}function V(q){const Y=new Set,ee=[0,0];return q.forEach((g,_e)=>{1===g&&((0,i.Ao)(ee,_e),Y.add(ee[0]),Y.add(ee[1]))}),Y}function U(q,Y,ee){const g=new Map,_e=(xe,le)=>{g.has(xe)?(0,l.Z2)(g.get(xe),le):g.set(xe,[le])};return Y.forEach(xe=>{const le=q[xe];for(const Ae of le)Y.has(Ae)&&1===ee.get((0,i.bd)(xe,Ae))&&_e(xe,Ae)}),g}function k(q,Y,ee,g){var _e;const{vertexBuffer:xe,indexBuffer:le,normalBuffer:Ae,triangleCount:Be}=q,Ce=xe.ref.value,Re=le.ref.value,ke=Ae.ref.value,we=i.Gm.create(Uint32Array,3,1024,Be);let Oe=0;for(let ge=0;ge<Be;++ge)i.Gm.add3(we,Re[3*ge],Re[3*ge+1],Re[3*ge+2]),Oe+=1;const Se=(0,o.eB)(),Ve=(0,o.eB)(),Ne=(0,o.eB)(),K=(0,o.eB)(),ne=(0,o.eB)(),be=(0,o.eB)(),Te=(0,o.eB)(),ie=(0,o.eB)(),ue=(0,o.eB)(),re=(0,o.eB)(),ve=(0,m.pu)(120),ce=new Set,se=Array.from(ee.keys()).filter(ge=>ee.get(ge).length<2).map(ge=>{const Ie=ee.get(ge);return o.eB.fromArray(Se,Ce,3*ge),o.eB.fromArray(Ve,Ce,3*Ie[0]),o.eB.fromArray(Ne,Ce,3*Ie[1]),o.eB.sub(ne,Ve,Se),o.eB.sub(be,Ne,Se),[ge,o.eB.angle(ne,be)]});se.sort(([,ge],[,Ie])=>ge-Ie);for(const[ge,Ie]of se){if(ce.has(ge)||Ie>ve)continue;const Le=ee.get(ge);if(Y[Le[0]].includes(Le[1])&&(null===(_e=ee.get(Le[0]))||void 0===_e||!_e.includes(Le[1]))||(o.eB.fromArray(Se,Ce,3*ge),o.eB.fromArray(Ve,Ce,3*Le[0]),o.eB.fromArray(Ne,Ce,3*Le[1]),o.eB.sub(ne,Ve,Se),o.eB.sub(be,Ne,Se),o.eB.add(ie,ne,be),o.eB.squaredDistance(Se,Ve)>=g))continue;let nt=!1;for(const je of Y[ge])if(!Le.includes(je)&&(o.eB.fromArray(K,Ce,3*je),o.eB.sub(Te,K,Se),o.eB.dot(ie,Te)<0)){nt=!0;break}nt&&(o.eB.fromArray(ue,ke,3*ge),o.eB.triangleNormal(re,Se,Ve,Ne),o.eB.dot(re,ue)>0?i.Gm.add3(we,ge,Le[0],Le[1]):i.Gm.add3(we,Le[1],Le[0],ge),ce.add(ge),ce.add(Le[0]),ce.add(Le[1]),Oe+=1)}const ae=i.Gm.compact(we);return q.triangleCount=Oe,e.IQ.update(le,ae),q}function J(q,Y){const ee=q.vertexCount,g=Y.instanceCount.ref.value,_e=(0,y.tu)(),xe=_e.position,le=_e.normal,Ae=q.vertexBuffer.ref.value,Be=q.normalBuffer.ref.value,Ce=Y.aTransform.ref.value;return(0,y.iQ)(ee,g,1,(ke,we)=>(we<0?(o.eB.fromArray(xe,Ae,3*ke),o.eB.fromArray(le,Be,3*ke)):(o.eB.transformMat4Offset(xe,Ae,Ce,0,3*ke,16*we),o.eB.transformDirectionOffset(le,Be,Ce,0,3*ke,16*we)),_e))}function W(q,Y,ee,g,_e){const{instanceCount:xe,groupCount:le}=ee,Ae=J(q,Y),Be=(0,c.D1)(ee,Ae,g.color),Ce=_e.instanceGranularity?(0,A.Km)(xe,"instance"):(0,A.Km)(xe*le,"groupInstance"),Re=(0,_.WG)(),ke=(0,M.MD)(),we=(0,d.JS)(),Oe=(0,u.IB)(),Se=(0,I.EN)(),Ve={drawCount:3*q.triangleCount,vertexCount:q.vertexCount,groupCount:le,instanceCount:xe},Ne=r.f8.clone(q.boundingSphere),K=(0,O.Ax)(Ne,Y.aTransform.ref.value,xe,0);return{dGeometryType:e.IQ.create("mesh"),aPosition:q.vertexBuffer,aNormal:q.normalBuffer,aGroup:q.groupBuffer,elements:q.indexBuffer,dVaryingGroup:q.varyingGroup,boundingSphere:e.IQ.create(K),invariantBoundingSphere:e.IQ.create(Ne),uInvariantBoundingSphere:e.IQ.create(o.Zb.ofSphere(Ne)),...Be,...Ce,...Re,...ke,...we,...Oe,...Se,...Y,...b.iy.createValues(_e,Ve),uDoubleSided:e.IQ.create(_e.doubleSided),dFlatShaded:e.IQ.create(_e.flatShaded),dFlipSided:e.IQ.create(_e.flipSided),dIgnoreLight:e.IQ.create(_e.ignoreLight),dXrayShaded:e.IQ.create("inverted"===_e.xrayShaded?"inverted":!0===_e.xrayShaded?"on":"off"),dTransparentBackfaces:e.IQ.create(_e.transparentBackfaces),uBumpFrequency:e.IQ.create(_e.bumpFrequency),uBumpAmplitude:e.IQ.create(_e.bumpAmplitude),meta:e.IQ.create(q.meta)}}function Z(q,Y){b.iy.updateRenderableState(q,Y),q.opaque=q.opaque&&!Y.xrayShaded,q.writeDepth=q.opaque}C.transform=function T(q,Y){const ee=q.vertexBuffer.ref.value;if((0,t.pi)(Y,ee,0,q.vertexCount),!o.$I.isTranslationAndUniformScaling(Y)){const g=o.U.directionTransform(E,Y);(0,t.TL)(g,q.normalBuffer.ref.value,0,q.vertexCount)}e.IQ.update(q.vertexBuffer,ee)},C.getOriginalData=function L(q){const{originalData:Y}="kind"in q?q.meta:q.meta.ref.value;return Y},C.uniformTriangleGroup=function w(q,Y=!0){const{indexBuffer:ee,vertexBuffer:g,groupBuffer:_e,normalBuffer:xe,triangleCount:le,vertexCount:Ae}=q,Be=ee.ref.value,Ce=g.ref.value,Re=_e.ref.value,ke=xe.ref.value,we=i.Gm.create(Uint32Array,3,1024,le),Oe=i.Gm.create(Float32Array,3,1024,Ce);Oe.currentIndex=3*Ae,Oe.elementCount=Ae;const Se=i.Gm.create(Float32Array,3,1024,ke);Se.currentIndex=3*Ae,Se.elementCount=Ae;const Ve=i.Gm.create(Float32Array,1,1024,Re);Ve.currentIndex=Ae,Ve.elementCount=Ae;const Ne=(0,o.eB)(),K=(0,o.eB)(),ne=(0,o.eB)(),be=(0,o.eB)(),Te=(0,o.eB)(),ie=(0,o.eB)();function ue(je){o.eB.fromArray(Ne,Ce,3*je),o.eB.fromArray(be,ke,3*je),i.Gm.add3(Oe,Ne[0],Ne[1],Ne[2]),i.Gm.add3(Se,be[0],be[1],be[2])}function re(je,Lt){o.eB.fromArray(Ne,Ce,3*je),o.eB.fromArray(K,Ce,3*Lt),o.eB.scale(Ne,o.eB.add(Ne,Ne,K),.5),o.eB.fromArray(be,ke,3*je),o.eB.fromArray(Te,ke,3*Lt),o.eB.scale(be,o.eB.add(be,be,Te),.5),i.Gm.add3(Oe,Ne[0],Ne[1],Ne[2]),i.Gm.add3(Se,be[0],be[1],be[2])}function ve(je,Lt,Je){o.eB.fromArray(Ne,Ce,3*je),o.eB.fromArray(K,Ce,3*Lt),o.eB.fromArray(ne,Ce,3*Je),o.eB.scale(Ne,o.eB.add(Ne,o.eB.add(Ne,Ne,K),ne),1/3),o.eB.fromArray(be,ke,3*je),o.eB.fromArray(Te,ke,3*Lt),o.eB.fromArray(ie,ke,3*Je),o.eB.scale(be,o.eB.add(be,o.eB.add(be,be,Te),ie),1/3),i.Gm.add3(Oe,Ne[0],Ne[1],Ne[2]),i.Gm.add3(Se,be[0],be[1],be[2])}function ce(je,Lt,Je,en,Bt){++ae,ue(je),re(je,Lt),re(je,Je),i.Gm.add3(we,se,se+1,se+2);for(let pn=0;pn<3;++pn)i.Gm.add(Ve,en);se+=3,ae+=2,ue(Lt),ue(Je),re(je,Lt),re(je,Je),i.Gm.add3(we,se,se+1,se+3),i.Gm.add3(we,se,se+3,se+2);for(let pn=0;pn<4;++pn)i.Gm.add(Ve,Bt);se+=4}let se=Ae,ae=0;if(Y)for(let je=0,Lt=le;je<Lt;++je){const Je=Be[3*je],en=Be[3*je+1],Bt=Be[3*je+2],pn=Re[Je],$e=Re[en],mt=Re[Bt];if(pn===$e&&pn===mt)++ae,i.Gm.add3(we,Je,en,Bt);else if(pn===$e)ce(Bt,Je,en,mt,pn);else if(pn===mt)ce(en,Bt,Je,$e,mt);else if($e===mt)ce(Je,en,Bt,pn,$e);else{ae+=2,ue(Je),re(Je,en),re(Je,Bt),ve(Je,en,Bt),i.Gm.add3(we,se,se+1,se+3),i.Gm.add3(we,se,se+3,se+2);for(let _t=0;_t<4;++_t)i.Gm.add(Ve,pn);se+=4,ae+=2,ue(en),re(en,Bt),re(en,Je),ve(Je,en,Bt),i.Gm.add3(we,se,se+1,se+3),i.Gm.add3(we,se,se+3,se+2);for(let _t=0;_t<4;++_t)i.Gm.add(Ve,$e);se+=4,ae+=2,ue(Bt),re(Bt,en),re(Bt,Je),ve(Je,en,Bt),i.Gm.add3(we,se+3,se+1,se),i.Gm.add3(we,se+2,se+3,se);for(let _t=0;_t<4;++_t)i.Gm.add(Ve,mt);se+=4}}else for(let je=0,Lt=le;je<Lt;++je){const Je=Be[3*je],en=Be[3*je+1],Bt=Be[3*je+2],pn=Re[Je],$e=Re[en],mt=Re[Bt];if(pn!==$e||pn!==mt){++ae,ue(Je),ue(en),ue(Bt),i.Gm.add3(we,se,se+1,se+2);const _t=$e===mt?$e:pn;for(let Me=0;Me<3;++Me)i.Gm.add(Ve,_t);se+=3}else++ae,i.Gm.add3(we,Je,en,Bt)}const ge=i.Gm.compact(we),Ie=i.Gm.compact(Oe),Le=i.Gm.compact(Se),nt=i.Gm.compact(Ve);return q.vertexCount=se,q.triangleCount=ae,e.IQ.update(g,Ie),e.IQ.update(_e,nt),e.IQ.update(ee,ge),e.IQ.update(xe,Le),q.meta.originalData={indexBuffer:Be,vertexCount:Ae,triangleCount:le},q},C.smoothEdges=function $(q,Y){!function N(q,Y){const{indexBuffer:ee,triangleCount:g}=q,_e=ee.ref.value,xe=i.Gm.create(Uint32Array,3,1024,g);let le=0;for(let Be=0;Be<g;++Be){const Ce=_e[3*Be],Re=_e[3*Be+1],ke=_e[3*Be+2];2===Y[Ce].length||2===Y[Re].length||2===Y[ke].length||(i.Gm.add3(xe,Ce,Re,ke),le+=1)}const Ae=i.Gm.compact(xe);q.triangleCount=le,e.IQ.update(ee,Ae)}(q,Q(q));for(let le=0;le<10;++le){const Ae=q.triangleCount,Be=G(q),Ce=Q(q);if(k(q,Ce,U(Ce,V(Be),Be),Y.maxNewEdgeLength*Y.maxNewEdgeLength),q.triangleCount===Ae)break}const ee=G(q);return function H(q,Y,ee){const{iterations:g,lambda:_e}=ee,xe=(0,o.eB)(),le=(0,o.eB)(),Ae=(0,o.eB)(),Be=(0,o.eB)(),Ce=-_e;let Re=new Float32Array(q.vertexBuffer.ref.value.length);const ke=we=>{const Oe=q.vertexBuffer.ref.value;Re.set(Oe),Y.forEach((Ve,Ne)=>{if(2!==Ve.length)return;o.eB.fromArray(xe,Oe,3*Ne),o.eB.fromArray(le,Oe,3*Ve[0]),o.eB.fromArray(Ae,Oe,3*Ve[1]);const K=1/o.eB.distance(xe,le),ne=1/o.eB.distance(xe,Ae);o.eB.scale(le,le,K),o.eB.scale(Ae,Ae,ne),o.eB.add(Be,le,Ae),o.eB.scale(Be,Be,1/(K+ne)),o.eB.sub(Be,Be,xe),o.eB.scale(Be,Be,we),o.eB.add(Be,xe,Be),o.eB.toArray(Be,Re,3*Ne)});const Se=q.vertexBuffer.ref.value;e.IQ.update(q.vertexBuffer,Re),Re=Se};for(let we=0;we<g;++we)ke(_e),ke(Ce)}(q,U(Q(q),V(ee),ee),{iterations:Y.iterations,lambda:.5}),q},C.Params={...b.iy.Params,doubleSided:v.t.Boolean(!1,b.iy.CustomQualityParamInfo),flipSided:v.t.Boolean(!1,b.iy.ShadingCategory),flatShaded:v.t.Boolean(!1,b.iy.ShadingCategory),ignoreLight:v.t.Boolean(!1,b.iy.ShadingCategory),xrayShaded:v.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],b.iy.ShadingCategory),transparentBackfaces:v.t.Select("off",v.t.arrayToOptions(["off","on","opaque"]),b.iy.ShadingCategory),bumpFrequency:v.t.Numeric(0,{min:0,max:10,step:.1},b.iy.ShadingCategory),bumpAmplitude:v.t.Numeric(1,{min:0,max:5,step:.1},b.iy.ShadingCategory)},C.Utils={Params:C.Params,createEmpty:a,createValues:W,createValuesSimple:function te(q,Y,ee,g,_e){const xe=b.iy.createSimple(ee,g,_e),le={...v.t.getDefaultValues(C.Params),...Y};return W(q,xe.transform,xe.locationIterator,xe.theme,le)},updateValues:function de(q,Y){b.iy.updateValues(q,Y),e.IQ.updateIfChanged(q.uDoubleSided,Y.doubleSided),e.IQ.updateIfChanged(q.dFlatShaded,Y.flatShaded),e.IQ.updateIfChanged(q.dFlipSided,Y.flipSided),e.IQ.updateIfChanged(q.dIgnoreLight,Y.ignoreLight),e.IQ.updateIfChanged(q.dXrayShaded,"inverted"===Y.xrayShaded?"inverted":!0===Y.xrayShaded?"on":"off"),e.IQ.updateIfChanged(q.dTransparentBackfaces,Y.transparentBackfaces),e.IQ.updateIfChanged(q.uBumpFrequency,Y.bumpFrequency),e.IQ.updateIfChanged(q.uBumpAmplitude,Y.bumpAmplitude)},updateBoundingSphere:function ye(q,Y){const ee=r.f8.clone(Y.boundingSphere),g=(0,O.Ax)(ee,q.aTransform.ref.value,q.instanceCount.ref.value,0);r.f8.equals(g,q.boundingSphere.ref.value)||e.IQ.update(q.boundingSphere,g),r.f8.equals(ee,q.invariantBoundingSphere.ref.value)||(e.IQ.update(q.invariantBoundingSphere,ee),e.IQ.update(q.uInvariantBoundingSphere,o.Zb.fromSphere(q.uInvariantBoundingSphere.ref.value,ee)))},createRenderableState:function j(q){const Y=b.iy.createRenderableState(q);return Z(Y,q),Y},updateRenderableState:Z,createPositionIterator:J}}(s||(s={}))},2075:(tn,Ue,n)=>{"use strict";n.d(Ue,{MD:()=>c,WG:()=>O,qp:()=>y,zj:()=>i});var e=n(7187),o=n(4369),r=n(3784),t=n(190),A=n(4648);function y(b,_,M,I){for(let l=_;l<M;++l)t.Q1.toArray(I,b,4*l),b[4*l+3]=255;return!0}function c(b,_,M){return b.fill(0,4*_,4*M),!0}function i(b,_,M){const I=(0,r.xg)(Math.max(1,b),4,Uint8Array,M&&M.tOverpaint.ref.value.array);return M?(e.IQ.update(M.tOverpaint,I),e.IQ.update(M.uOverpaintTexDim,o.ZY.create(I.width,I.height)),e.IQ.updateIfChanged(M.dOverpaint,b>0),e.IQ.updateIfChanged(M.dOverpaintType,_),M):{tOverpaint:e.IQ.create(I),uOverpaintTexDim:e.IQ.create(o.ZY.create(I.width,I.height)),dOverpaint:e.IQ.create(b>0),tOverpaintGrid:e.IQ.create((0,A.z6)()),uOverpaintGridDim:e.IQ.create(o.eB.create(1,1,1)),uOverpaintGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dOverpaintType:e.IQ.create(_),uOverpaintStrength:e.IQ.create(1)}}const v={array:new Uint8Array(4),width:1,height:1};function O(b){return b?(e.IQ.update(b.tOverpaint,v),e.IQ.update(b.uOverpaintTexDim,o.ZY.create(1,1)),b):{tOverpaint:e.IQ.create(v),uOverpaintTexDim:e.IQ.create(o.ZY.create(1,1)),dOverpaint:e.IQ.create(!1),tOverpaintGrid:e.IQ.create((0,A.z6)()),uOverpaintGridDim:e.IQ.create(o.eB.create(1,1,1)),uOverpaintGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dOverpaintType:e.IQ.create("groupInstance"),uOverpaintStrength:e.IQ.create(1)}}},5299:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>d});var d,e=n(9909),o=n(4369),r=n(4559),t=n(2712),A=n(8013),y=n(7684),c=n(1888),i=n(8277),v=n(3784),O=n(5384),b=n(5019),_=n(2075),M=n(9197),I=n(8382),l=n(5077),m=n(8307),u=n(6022);!function(s){function C(G,V,U,N){return N?function D(G,V,U,N){return N.pointCount=U,e.IQ.update(N.centerBuffer,G),e.IQ.update(N.groupBuffer,V),N}(G,V,U,N):function S(G,V,U){const N=(0,O.f8)();let k,H=-1,$=-1;const J={kind:"points",pointCount:U,centerBuffer:e.IQ.create(G),groupBuffer:e.IQ.create(V),get boundingSphere(){const W=a(J);if(W!==H){const te=(0,v.sL)(J.centerBuffer.ref.value,J.pointCount,1);O.f8.copy(N,te),H=W}return N},get groupMapping(){return J.groupBuffer.ref.version!==$&&(k=(0,r.AA)(J.groupBuffer.ref.value,J.pointCount),$=J.groupBuffer.ref.version),k},setBoundingSphere(W){O.f8.copy(N,W),H=a(J)}};return J}(G,V,U)}function h(G){return C(G?G.centerBuffer.ref.value:new Float32Array(0),G?G.groupBuffer.ref.value:new Float32Array(0),0,G)}function a(G){return(0,I.TI)([G.pointCount,G.centerBuffer.ref.version,G.groupBuffer.ref.version])}function f(G,V){const U=G.pointCount,N=V.instanceCount.ref.value,k=(0,c.tu)(),H=k.position,$=G.centerBuffer.ref.value,J=V.aTransform.ref.value;return(0,c.iQ)(U,N,1,(te,de)=>(de<0?o.eB.fromArray(H,$,3*te):o.eB.transformMat4Offset(H,$,J,0,3*te,16*de),k))}function p(G,V,U,N,k){const{instanceCount:H,groupCount:$}=U,J=f(G,V),W=(0,t.D1)(U,J,N.color),te=(0,y.v3)(U,N.size),de=k.instanceGranularity?(0,A.Km)(H,"instance"):(0,A.Km)(H*$,"groupInstance"),ye=(0,_.WG)(),j=(0,M.MD)(),Z=(0,u.JS)(),q=(0,m.IB)(),Y=(0,l.EN)(),ee={drawCount:G.pointCount,vertexCount:G.pointCount,groupCount:$,instanceCount:H},g=O.f8.clone(G.boundingSphere),_e=(0,v.Ax)(g,V.aTransform.ref.value,H,0);return{dGeometryType:e.IQ.create("points"),aPosition:G.centerBuffer,aGroup:G.groupBuffer,boundingSphere:e.IQ.create(_e),invariantBoundingSphere:e.IQ.create(g),uInvariantBoundingSphere:e.IQ.create(o.Zb.ofSphere(g)),...W,...te,...de,...ye,...j,...Z,...q,...Y,...V,...b.iy.createValues(k,ee),uSizeFactor:e.IQ.create(k.sizeFactor),dPointSizeAttenuation:e.IQ.create(k.pointSizeAttenuation),dPointStyle:e.IQ.create(k.pointStyle)}}function Q(G,V){b.iy.updateRenderableState(G,V),G.opaque=G.opaque&&"fuzzy"!==V.pointStyle,G.writeDepth=G.opaque}s.create=C,s.createEmpty=h,s.transform=function R(G,V){const U=G.centerBuffer.ref.value;(0,r.pi)(V,U,0,G.pointCount),e.IQ.update(G.centerBuffer,U)},s.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},s.StyleTypeNames=Object.keys(s.StyleTypes),s.Params={...b.iy.Params,sizeFactor:i.t.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:i.t.Boolean(!1),pointStyle:i.t.Select("square",i.t.objectToOptions(s.StyleTypes))},s.Utils={Params:s.Params,createEmpty:h,createValues:p,createValuesSimple:function E(G,V,U,N,k){const H=b.iy.createSimple(U,N,k),$={...i.t.getDefaultValues(s.Params),...V};return p(G,H.transform,H.locationIterator,H.theme,$)},updateValues:function T(G,V){b.iy.updateValues(G,V),e.IQ.updateIfChanged(G.uSizeFactor,V.sizeFactor),e.IQ.updateIfChanged(G.dPointSizeAttenuation,V.pointSizeAttenuation),e.IQ.updateIfChanged(G.dPointStyle,V.pointStyle)},updateBoundingSphere:function L(G,V){const U=O.f8.clone(V.boundingSphere),N=(0,v.Ax)(U,G.aTransform.ref.value,G.instanceCount.ref.value,0);O.f8.equals(N,G.boundingSphere.ref.value)||e.IQ.update(G.boundingSphere,N),O.f8.equals(U,G.invariantBoundingSphere.ref.value)||(e.IQ.update(G.invariantBoundingSphere,U),e.IQ.update(G.uInvariantBoundingSphere,o.Zb.fromSphere(G.uInvariantBoundingSphere.ref.value,U)))},createRenderableState:function w(G){const V=b.iy.createRenderableState(G);return Q(V,G),V},updateRenderableState:Q,createPositionIterator:f}}(d||(d={}))},7684:(tn,Ue,n)=>{"use strict";n.d(Ue,{v3:()=>c,yx:()=>v});var e=n(9909),o=n(4369),r=n(3784),t=n(364),A=n(542),y=n(4951);function c(d,s,C){switch(A.V.getGranularity(d,s.granularity)){case"uniform":return function M(d,s,C){return function _(d,s){return s?(e.IQ.update(s.uSize,d),e.IQ.updateIfChanged(s.dSizeType,"uniform"),s):{uSize:e.IQ.create(d),tSize:e.IQ.create(O),uSizeTexDim:e.IQ.create(o.ZY.create(1,1)),dSizeType:e.IQ.create("uniform")}}(s(t.LU),C)}(0,s.size,C);case"group":return function m(d,s,C){const{groupCount:h}=d,a=(0,r.xg)(Math.max(1,h),3,Uint8Array,C&&C.tSize.ref.value.array);for(d.reset();d.hasNext&&!d.isNextNewInstance;){const S=d.move();(0,y.Gu)(s(S.location)*i,a.array,3*S.groupIndex)}return I(a,"group",C)}(d,s.size,C);case"groupInstance":return function u(d,s,C){const{groupCount:h,instanceCount:a}=d,D=(0,r.xg)(Math.max(1,a*h),3,Uint8Array,C&&C.tSize.ref.value.array);for(d.reset();d.hasNext;){const R=d.move();(0,y.Gu)(s(R.location)*i,D.array,3*R.index)}return I(D,"groupInstance",C)}(d,s.size,C);case"instance":return function l(d,s,C){const{instanceCount:h}=d,a=(0,r.xg)(Math.max(1,h),3,Uint8Array,C&&C.tSize.ref.value.array);for(d.reset();d.hasNext&&!d.isNextNewInstance;){const S=d.move();(0,y.Gu)(s(S.location)*i,a.array,3*S.instanceIndex),d.skipInstance()}return I(a,"instance",C)}(d,s.size,C)}}const i=100;function v(d){switch(d.dSizeType.ref.value){case"uniform":return d.uSize.ref.value;case"instance":case"group":case"groupInstance":let C=0;const h=d.tSize.ref.value.array;for(let a=0,S=h.length;a<S;a+=3){const D=(0,y.OK)(h[a],h[a+1],h[a+2]);C<D&&(C=D)}return C/i}}const O={array:new Uint8Array(3),width:1,height:1};function I(d,s,C){return C?(e.IQ.update(C.tSize,d),e.IQ.update(C.uSizeTexDim,o.ZY.create(d.width,d.height)),e.IQ.updateIfChanged(C.dSizeType,s),C):{uSize:e.IQ.create(0),tSize:e.IQ.create(d),uSizeTexDim:e.IQ.create(o.ZY.create(d.width,d.height)),dSizeType:e.IQ.create(s)}}},8231:(tn,Ue,n)=>{"use strict";n.d(Ue,{v:()=>d});var d,e=n(9909),o=n(8277),r=n(1888),t=n(2712),A=n(8013),y=n(3784),c=n(5384),i=n(7684),v=n(5019),O=n(2075),b=n(9197),_=n(8382),M=n(4559),I=n(5077),l=n(4369),m=n(8307),u=n(6022);!function(s){function C(H,$,J,W){return W?function D(H,$,J,W){return W.sphereCount=J,e.IQ.update(W.centerBuffer,H),e.IQ.update(W.groupBuffer,$),W.shaderData.update(),W}(H,$,J,W):function S(H,$,J){const W=(0,c.f8)();let te,de=-1,ye=-1;const j=e.IQ.create((0,y.xg)(1,4,Float32Array)),Z=e.IQ.create(l.ZY.create(0,0)),q=e.IQ.create([]),Y=e.IQ.create(0),ee={kind:"spheres",sphereCount:J,centerBuffer:e.IQ.create(H),groupBuffer:e.IQ.create($),get boundingSphere(){const g=a(ee);if(g!==de){const _e=(0,y.sL)(ee.centerBuffer.ref.value,ee.sphereCount,1);c.f8.copy(W,_e),de=g}return W},get groupMapping(){return ee.groupBuffer.ref.version!==ye&&(te=(0,M.AA)(ee.groupBuffer.ref.value,ee.sphereCount),ye=ee.groupBuffer.ref.version),te},setBoundingSphere(g){c.f8.copy(W,g),de=a(ee)},shaderData:{positionGroup:j,texDim:Z,lodLevels:q,sizeFactor:Y,update(g){var _e,xe;const le=null!==(_e=g?.lodLevels)&&void 0!==_e?_e:E(q.ref.value),Ae=null!==(xe=g?.sizeFactor)&&void 0!==xe?xe:Y.ref.value,Be=L(le,Ae),Ce=(0,y.xg)(ee.sphereCount,4,Float32Array,j.ref.value.array),Re=R(Ce,ee.centerBuffer.ref.value,ee.groupBuffer.ref.value,ee.sphereCount,Be),ke=Re?p(le,Ae,Re,ee.sphereCount):[];e.IQ.update(j,Ce),e.IQ.update(Z,l.ZY.set(Z.ref.value,Ce.width,Ce.height)),e.IQ.update(q,ke),e.IQ.update(Y,Ae)}}};return ee.shaderData.update(),ee}(H,$,J)}function h(H){return C(H?H.centerBuffer.ref.value:new Float32Array(0),H?H.groupBuffer.ref.value:new Float32Array(0),0,H)}function a(H){return(0,_.TI)([H.sphereCount,H.centerBuffer.ref.version,H.groupBuffer.ref.version])}function R(H,$,J,W,te){const{array:de}=H;if(0===te.length){for(let Z=0;Z<W;++Z)de[4*Z+0]=$[3*Z+0],de[4*Z+1]=$[3*Z+1],de[4*Z+2]=$[3*Z+2],de[4*Z+3]=J[Z];return}const ye=[0];let j=0;for(let Z=0,q=te.length;Z<q;++Z){const Y=te[Z];for(let ee=0;ee<W;++ee){let g=!1;for(let _e=0;_e<Z;++_e)if(ee%te[_e]==0){g=!0;break}!g&&ee%Y==0&&(de[4*j+0]=$[3*ee+0],de[4*j+1]=$[3*ee+1],de[4*j+2]=$[3*ee+2],de[4*j+3]=J[ee],j+=1)}ye.push(6*j)}return ye}function p(H,$,J,W){return H.map((te,de)=>{const ye=T(te,$);return[te.minDistance,te.maxDistance,te.overlap,J[J.length-1-de],Math.pow(Math.min(W,ye),1/te.scaleBias),te.stride,te.scaleBias]})}function E(H){return H.map($=>({minDistance:$[0],maxDistance:$[1],overlap:$[2],stride:$[5],scaleBias:$[6]}))}function T(H,$){return Math.max(1,Math.round(H.stride/Math.pow($,H.scaleBias)))}function L(H,$){return H.map(J=>T(J,$)).reverse()}function w(H,$){const J=H.sphereCount,W=$.instanceCount.ref.value,te=(0,r.tu)(),de=te.position,ye=H.centerBuffer.ref.value,j=$.aTransform.ref.value;return(0,r.iQ)(J,W,1,(q,Y)=>(Y<0?l.eB.fromArray(de,ye,3*q):l.eB.transformMat4Offset(de,ye,j,0,3*q,16*Y),te))}function Q(H,$,J,W,te){const{instanceCount:de,groupCount:ye}=J,j=w(H,$),Z=(0,t.D1)(J,j,W.color),q=(0,i.v3)(J,W.size),Y=te.instanceGranularity?(0,A.Km)(de,"instance"):(0,A.Km)(de*ye,"groupInstance"),ee=(0,O.WG)(),g=(0,b.MD)(),_e=(0,u.JS)(),xe=(0,m.IB)(),le=(0,I.EN)(),Ae={drawCount:2*H.sphereCount*3,vertexCount:6*H.sphereCount,groupCount:ye,instanceCount:de},Be=H.boundingSphere.radius?(0,i.yx)(q)*te.sizeFactor:0,Ce=c.f8.expand((0,c.f8)(),H.boundingSphere,Be),Re=(0,y.Ax)(Ce,$.aTransform.ref.value,de,0);return H.shaderData.update({lodLevels:te.lodLevels,sizeFactor:te.sizeFactor}),{dGeometryType:e.IQ.create("spheres"),uTexDim:H.shaderData.texDim,tPositionGroup:H.shaderData.positionGroup,boundingSphere:e.IQ.create(Re),invariantBoundingSphere:e.IQ.create(Ce),uInvariantBoundingSphere:e.IQ.create(l.Zb.ofSphere(Ce)),...Z,...q,...Y,...ee,...g,..._e,...xe,...le,...$,padding:e.IQ.create(Be),...v.iy.createValues(te,Ae),uSizeFactor:H.shaderData.sizeFactor,uDoubleSided:e.IQ.create(te.doubleSided),dIgnoreLight:e.IQ.create(te.ignoreLight),dXrayShaded:e.IQ.create("inverted"===te.xrayShaded?"inverted":!0===te.xrayShaded?"on":"off"),dTransparentBackfaces:e.IQ.create(te.transparentBackfaces),dSolidInterior:e.IQ.create(te.solidInterior),dClipPrimitive:e.IQ.create(te.clipPrimitive),dApproximate:e.IQ.create(te.approximate),uAlphaThickness:e.IQ.create(te.alphaThickness),uBumpFrequency:e.IQ.create(te.bumpFrequency),uBumpAmplitude:e.IQ.create(te.bumpAmplitude),lodLevels:H.shaderData.lodLevels,centerBuffer:H.centerBuffer,groupBuffer:H.groupBuffer}}function k(H,$){v.iy.updateRenderableState(H,$),H.opaque=H.opaque&&!$.xrayShaded,H.writeDepth=H.opaque}s.create=C,s.createEmpty=h,s.Params={...v.iy.Params,sizeFactor:o.t.Numeric(1,{min:0,max:10,step:.1}),doubleSided:o.t.Boolean(!1,v.iy.CustomQualityParamInfo),ignoreLight:o.t.Boolean(!1,v.iy.ShadingCategory),xrayShaded:o.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],v.iy.ShadingCategory),transparentBackfaces:o.t.Select("off",o.t.arrayToOptions(["off","on","opaque"]),v.iy.ShadingCategory),solidInterior:o.t.Boolean(!0,v.iy.ShadingCategory),clipPrimitive:o.t.Boolean(!1,{...v.iy.ShadingCategory,description:"Clip whole sphere instead of cutting it."}),approximate:o.t.Boolean(!1,{...v.iy.ShadingCategory,description:"Faster rendering, but has artifacts."}),alphaThickness:o.t.Numeric(0,{min:0,max:20,step:1},{...v.iy.ShadingCategory,description:"If not zero, adjusts alpha for radius."}),bumpFrequency:o.t.Numeric(0,{min:0,max:10,step:.1},v.iy.ShadingCategory),bumpAmplitude:o.t.Numeric(1,{min:0,max:5,step:.1},v.iy.ShadingCategory),lodLevels:o.t.ObjectList({minDistance:o.t.Numeric(0),maxDistance:o.t.Numeric(0),overlap:o.t.Numeric(0),stride:o.t.Numeric(0),scaleBias:o.t.Numeric(3,{min:.1,max:10,step:.1})},H=>`${H.stride}`,{...v.iy.CullingLodCategory,defaultValue:[]})},s.Utils={Params:s.Params,createEmpty:h,createValues:Q,createValuesSimple:function G(H,$,J,W,te){const de=v.iy.createSimple(J,W,te),ye={...o.t.getDefaultValues(s.Params),...$};return Q(H,de.transform,de.locationIterator,de.theme,ye)},updateValues:function V(H,$){v.iy.updateValues(H,$),e.IQ.updateIfChanged(H.uSizeFactor,$.sizeFactor),e.IQ.updateIfChanged(H.uDoubleSided,$.doubleSided),e.IQ.updateIfChanged(H.dIgnoreLight,$.ignoreLight),e.IQ.updateIfChanged(H.dXrayShaded,"inverted"===$.xrayShaded?"inverted":!0===$.xrayShaded?"on":"off"),e.IQ.updateIfChanged(H.dTransparentBackfaces,$.transparentBackfaces),e.IQ.updateIfChanged(H.dSolidInterior,$.solidInterior),e.IQ.updateIfChanged(H.dClipPrimitive,$.clipPrimitive),e.IQ.updateIfChanged(H.dApproximate,$.approximate),e.IQ.updateIfChanged(H.uAlphaThickness,$.alphaThickness),e.IQ.updateIfChanged(H.uBumpFrequency,$.bumpFrequency),e.IQ.updateIfChanged(H.uBumpAmplitude,$.bumpAmplitude);const J=E(H.lodLevels.ref.value);if(!function f(H,$){if(H.length!==$.length)return!1;for(let J=0,W=H.length;J<W;++J)if(H[J].maxDistance!==$[J].maxDistance||H[J].minDistance!==$[J].minDistance||H[J].overlap!==$[J].overlap||H[J].stride!==$[J].stride||H[J].scaleBias!==$[J].scaleBias)return!1;return!0}($.lodLevels,J)){const W=H.uVertexCount.ref.value/6,te=L($.lodLevels,$.sizeFactor),de=R(H.tPositionGroup.ref.value,H.centerBuffer.ref.value,H.groupBuffer.ref.value,W,te),ye=de?p($.lodLevels,$.sizeFactor,de,W):[];e.IQ.update(H.tPositionGroup,H.tPositionGroup.ref.value),e.IQ.update(H.lodLevels,ye)}},updateBoundingSphere:function U(H,$){const J=$.boundingSphere.radius?(0,i.yx)(H)*H.uSizeFactor.ref.value:0,W=c.f8.expand((0,c.f8)(),$.boundingSphere,J),te=(0,y.Ax)(W,H.aTransform.ref.value,H.instanceCount.ref.value,0);c.f8.equals(te,H.boundingSphere.ref.value)||e.IQ.update(H.boundingSphere,te),c.f8.equals(W,H.invariantBoundingSphere.ref.value)||(e.IQ.update(H.invariantBoundingSphere,W),e.IQ.update(H.uInvariantBoundingSphere,l.Zb.fromSphere(H.uInvariantBoundingSphere.ref.value,W))),e.IQ.update(H.padding,J)},createRenderableState:function N(H){const $=v.iy.createRenderableState(H);return k($,H),$},updateRenderableState:k,createPositionIterator:w}}(d||(d={}))},8307:(tn,Ue,n)=>{"use strict";n.d(Ue,{C2:()=>c,IB:()=>O,fZ:()=>i,mx:()=>y});var e=n(7187),o=n(4369),r=n(3784),t=n(4648),A=n(6765);function y(b,_,M,I){for(let l=_;l<M;++l)A.i.toArray(I,b,4*l),b[4*l+3]=255;return!0}function c(b,_,M){return b.fill(0,4*_,4*M),!0}function i(b,_,M){const I=(0,r.xg)(Math.max(1,b),4,Uint8Array,M&&M.tSubstance.ref.value.array);return M?(e.IQ.update(M.tSubstance,I),e.IQ.update(M.uSubstanceTexDim,o.ZY.create(I.width,I.height)),e.IQ.updateIfChanged(M.dSubstance,b>0),e.IQ.updateIfChanged(M.dSubstanceType,_),M):{tSubstance:e.IQ.create(I),uSubstanceTexDim:e.IQ.create(o.ZY.create(I.width,I.height)),dSubstance:e.IQ.create(b>0),tSubstanceGrid:e.IQ.create((0,t.z6)()),uSubstanceGridDim:e.IQ.create(o.eB.create(1,1,1)),uSubstanceGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dSubstanceType:e.IQ.create(_),uSubstanceStrength:e.IQ.create(1)}}const v={array:new Uint8Array(4),width:1,height:1};function O(b){return b?(e.IQ.update(b.tSubstance,v),e.IQ.update(b.uSubstanceTexDim,o.ZY.create(1,1)),b):{tSubstance:e.IQ.create(v),uSubstanceTexDim:e.IQ.create(o.ZY.create(1,1)),dSubstance:e.IQ.create(!1),tSubstanceGrid:e.IQ.create((0,t.z6)()),uSubstanceGridDim:e.IQ.create(o.eB.create(1,1,1)),uSubstanceGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dSubstanceType:e.IQ.create("groupInstance"),uSubstanceStrength:e.IQ.create(1)}}},331:(tn,Ue,n)=>{"use strict";n.d(Ue,{nZ:()=>i,pS:()=>c});var e=n(8277);function o(I,l,m,u,d,s,C){for(let h=0;h<l;h++){for(let a=0;a<m;a++)u[a]=I[a*l+h];r(u,d,s,C,m);for(let a=0;a<m;a++)I[a*l+h]=d[a]}for(let h=0;h<m;h++){for(let a=0;a<l;a++)u[a]=I[h*l+a];r(u,d,s,C,l);for(let a=0;a<l;a++)I[h*l+a]=Math.sqrt(d[a])}}function r(I,l,m,u,d){m[0]=0,u[0]=Number.MIN_SAFE_INTEGER,u[1]=Number.MAX_SAFE_INTEGER;for(let s=1,C=0;s<d;s++){let h=(I[s]+s*s-(I[m[C]]+m[C]*m[C]))/(2*s-2*m[C]);for(;h<=u[C];)C--,h=(I[s]+s*s-(I[m[C]]+m[C]*m[C]))/(2*s-2*m[C]);C++,m[C]=s,u[C]=h,u[C+1]=Number.MAX_SAFE_INTEGER}for(let s=0,C=0;s<d;s++){for(;u[C+1]<s;)C++;l[s]=(s-m[C])*(s-m[C])+I[m[C]]}}var t=n(3784),A=n(8484);const y={};function c(I){const l=JSON.stringify(I);return void 0===y[l]&&(y[l]=new v(I)),y[l]}const i={fontFamily:e.t.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:e.t.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:e.t.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:e.t.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:e.t.Select("normal",[["normal","Normal"],["bold","Bold"]])};class v{constructor(l={}){this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;const m={...e.t.getDefaultValues(i),...l};this.props=m;const u=32*(m.fontQuality+1);this.buffer=u/8,this.radius=u/3,this.lineHeight=Math.round(u+2*this.buffer+this.radius),this.maxWidth=Math.round(.75*this.lineHeight),this.texture=(0,t.xg)(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=function M(I,l,m){if(A.K0)return function b(){throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.")}().createCanvas(I,l).getContext("2d",m);{const u=document.createElement("canvas");return u.width=I,u.height=l,u.getContext("2d",m)}}(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${m.fontStyle} ${m.fontVariant} ${m.fontWeight} ${u}px ${m.fontFamily}`,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get("\ufffd")}get(l){if(void 0===this.mapped[l]){this.draw(l);const{array:m,width:u,height:d}=this.texture,s=this.scratchData;if(this.currentX+this.scratchW>u&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>d)return console.warn("canvas to small"),this.placeholder;this.mapped[l]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(let C=0;C<this.scratchH;++C)for(let h=0;h<this.scratchW;++h)m[u*(this.currentY+C)+this.currentX+h]=s[C*this.scratchW+h];this.currentX+=this.scratchW}return this.mapped[l]}draw(l){const m=this.lineHeight,u=this.scratchContext,d=this.scratchData,s=u.measureText(l),C=Math.min(this.maxWidth,Math.ceil(s.width+2*this.buffer)),h=C*m;u.clearRect(0,0,C,m),u.fillText(l,this.buffer,this.middle);const a=u.getImageData(0,0,C,m);for(let S=0;S<h;S++){const D=a.data[4*S+3]/255;this.gridOuter[S]=1===D?0:0===D?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-D),2),this.gridInner[S]=1===D?Number.MAX_SAFE_INTEGER:0===D?0:Math.pow(Math.max(0,D-.5),2)}o(this.gridOuter,C,m,this.f,this.d,this.v,this.z),o(this.gridInner,C,m,this.f,this.d,this.v,this.z);for(let S=0;S<h;S++)d[S]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[S]-this.gridInner[S])/this.radius+this.cutoff))));this.scratchW=C,this.scratchH=m}}},7377:(tn,Ue,n)=>{"use strict";n.d(Ue,{t:()=>O});var e=n(8277),o=n(8382),r=n(4255),t=n(331),A=n(1372);const y=new Uint16Array([0,1,2,1,3,2]),c=o.Gm.add3,i=o.Gm.add2,v=o.Gm.add;var O;(O||(O={})).create=function _(M={},I=2048,l=1024,m){I*=2,l*=2;const u=o.Gm.create(Float32Array,3,l,m?m.centerBuffer.ref.value:I),d=o.Gm.create(Float32Array,2,l,m?m.mappingBuffer.ref.value:I),s=o.Gm.create(Float32Array,1,l,m?m.depthBuffer.ref.value:I),C=o.Gm.create(Uint32Array,3,l,m?m.indexBuffer.ref.value:I),h=o.Gm.create(Float32Array,1,l,m?m.groupBuffer.ref.value:I),a=o.Gm.create(Float32Array,2,l,m?m.tcoordBuffer.ref.value:I),S={...e.t.getDefaultValues(r.E.Params),...M},{attachment:D,background:R,backgroundMargin:f,tether:p,tetherLength:E,tetherBaseWidth:T}=S,L=(0,t.pS)(S),w=.4*f,Q=L.buffer/L.lineHeight,G=(V,U,N,k,H)=>{c(u,V,U,N),v(s,k),v(h,H)};return{add:(V,U,N,k,H,$,J)=>{let W=0;const te=V.length;for(let _e=0;_e<te;++_e)W+=L.get(V[_e]).nw-2*Q;let ye,j;if(ye=D.startsWith("top")?.8:D.startsWith("middle")?.4:0,j=D.endsWith("right")?W:D.endsWith("center")?W/2:0,p)switch(D){case"bottom-left":j-=E/2+w+.1,ye-=E/2+w;break;case"bottom-center":ye-=E+w;break;case"bottom-right":j+=E/2+w+.1,ye-=E/2+w;break;case"middle-left":j-=E+w+.1;break;case"middle-center":break;case"middle-right":j+=E+w+.1;break;case"top-left":j-=E/2+w+.1,ye+=E/2+w;break;case"top-center":ye+=E+w;break;case"top-right":j+=E/2+w+.1,ye+=E/2+w}const Z=(-j-w-.1)*$,q=(W-j+w+.1)*$,Y=(.8-ye+w)*$,ee=(-ye-w)*$;if(R){i(d,Z,Y),i(d,Z,ee),i(d,q,Y),i(d,q,ee);const _e=u.elementCount;for(let xe=0;xe<4;++xe)i(a,10,10),G(U,N,k,H,J);c(C,_e+y[0],_e+y[1],_e+y[2]),c(C,_e+y[3],_e+y[4],_e+y[5])}if(p){let _e,xe,le,Ae,Be,Ce,Re,ke;const we=E*$,Oe=T*$;switch(D){case"bottom-left":_e=Z-we/2,le=Z+Oe/2,Be=Z,Re=Z,xe=ee-we/2,Ae=ee,Ce=ee+Oe/2,ke=ee;break;case"bottom-center":_e=0,le=Oe/2,Be=-Oe/2,Re=0,xe=ee-we,Ae=ee,Ce=ee,ke=ee;break;case"bottom-right":_e=q+we/2,le=q,Be=q-Oe/2,Re=q,xe=ee-we/2,Ae=ee+Oe/2,Ce=ee,ke=ee;break;case"middle-left":_e=Z-we,le=Z,Be=Z,Re=Z,xe=0,Ae=-Oe/2,Ce=Oe/2,ke=0;break;case"middle-center":_e=0,le=0,Be=0,Re=0,xe=0,Ae=0,Ce=0,ke=0;break;case"middle-right":_e=q+we,le=q,Be=q,Re=q,xe=0,Ae=Oe/2,Ce=-Oe/2,ke=0;break;case"top-left":_e=Z-we/2,le=Z+Oe/2,Be=Z,Re=Z,xe=Y+we/2,Ae=Y,Ce=Y-Oe/2,ke=Y;break;case"top-center":_e=0,le=Oe/2,Be=-Oe/2,Re=0,xe=Y+we,Ae=Y,Ce=Y,ke=Y;break;case"top-right":_e=q+we/2,le=q,Be=q-Oe/2,Re=q,xe=Y+we/2,Ae=Y-Oe/2,Ce=Y,ke=Y;break;default:(0,A.dr)(D)}i(d,_e,xe),i(d,le,Ae),i(d,Be,Ce),i(d,Re,ke);const Se=u.elementCount;for(let Ve=0;Ve<4;++Ve)i(a,10,10),G(U,N,k,H,J);c(C,Se,Se+1,Se+3),c(C,Se,Se+3,Se+2)}j+=Q,ye+=Q;let g=0;for(let _e=0;_e<te;++_e){const xe=L.get(V[_e]),le=(g-j)*$,Ae=(g+xe.nw-j)*$,Be=(xe.nh-ye)*$,Ce=-ye*$;i(d,le,Be),i(d,le,Ce),i(d,Ae,Be),i(d,Ae,Ce);const Re=L.texture.width,ke=L.texture.height;i(a,xe.x/Re,xe.y/ke),i(a,xe.x/Re,(xe.y+xe.h)/ke),i(a,(xe.x+xe.w)/Re,xe.y/ke),i(a,(xe.x+xe.w)/Re,(xe.y+xe.h)/ke),g+=xe.nw-2*Q;const we=u.elementCount;for(let Oe=0;Oe<4;++Oe)G(U,N,k,H,J);c(C,we+y[0],we+y[1],we+y[2]),c(C,we+y[3],we+y[4],we+y[5])}},getText:()=>{const V=L.texture,U=o.Gm.compact(u,!0),N=o.Gm.compact(d,!0),k=o.Gm.compact(s,!0),H=o.Gm.compact(C,!0),$=o.Gm.compact(h,!0),J=o.Gm.compact(a,!0);return r.E.create(V,U,N,k,H,$,J,C.elementCount/2,m)}}}},4255:(tn,Ue,n)=>{"use strict";n.d(Ue,{E:()=>a});var a,e=n(8277),o=n(9909),r=n(1888),t=n(2712),A=n(7684),y=n(8013),c=n(2745),i=n(5384),v=n(3784),O=n(190),b=n(4369),_=n(331),M=n(127),I=n(5019),l=n(2075),m=n(9197),u=n(8382),d=n(4559),s=n(5077),C=n(8307),h=n(6022);function S(D,R,f,p){let E=0,T=0;for(let L=0,w=4*f;L<w;++L){const Q=2*L,G=Math.abs(D[Q]);G>E&&(E=G);const V=Math.abs(D[Q+1]);V>E&&(E=V);const U=Math.abs(R[L]);U>T&&(T=U)}return Math.max(T,p+p*E)}!function(D){function R(k,H,$,J,W,te,de,ye,j){return j?function T(k,H,$,J,W,te,de,ye,j){return j.charCount=ye,o.IQ.update(j.fontTexture,k),o.IQ.update(j.centerBuffer,H),o.IQ.update(j.mappingBuffer,$),o.IQ.update(j.depthBuffer,J),o.IQ.update(j.indexBuffer,W),o.IQ.update(j.groupBuffer,te),o.IQ.update(j.tcoordBuffer,de),j}(k,H,$,J,W,te,de,ye,j):function E(k,H,$,J,W,te,de,ye){const j=(0,i.f8)();let Z,q=-1,Y=-1;const ee={kind:"text",charCount:ye,fontTexture:o.IQ.create(k),centerBuffer:o.IQ.create(H),mappingBuffer:o.IQ.create($),depthBuffer:o.IQ.create(J),indexBuffer:o.IQ.create(W),groupBuffer:o.IQ.create(te),tcoordBuffer:o.IQ.create(de),get boundingSphere(){const g=p(ee);if(g!==q){const _e=(0,v.sL)(ee.centerBuffer.ref.value,4*ee.charCount,4);i.f8.copy(j,_e),q=g}return j},get groupMapping(){return ee.groupBuffer.ref.version!==Y&&(Z=(0,d.AA)(ee.groupBuffer.ref.value,ee.charCount,4),Y=ee.groupBuffer.ref.version),Z},setBoundingSphere(g){i.f8.copy(j,g),q=p(ee)}};return ee}(k,H,$,J,W,te,de,ye)}function f(k){return R(k?k.fontTexture.ref.value:(0,v.xg)(0,1,Uint8Array),k?k.centerBuffer.ref.value:new Float32Array(0),k?k.mappingBuffer.ref.value:new Float32Array(0),k?k.depthBuffer.ref.value:new Float32Array(0),k?k.indexBuffer.ref.value:new Uint32Array(0),k?k.groupBuffer.ref.value:new Float32Array(0),k?k.tcoordBuffer.ref.value:new Float32Array(0),0,k)}function p(k){return(0,u.TI)([k.charCount,k.fontTexture.ref.version,k.centerBuffer.ref.version,k.mappingBuffer.ref.version,k.depthBuffer.ref.version,k.indexBuffer.ref.version,k.groupBuffer.ref.version,k.tcoordBuffer.ref.version])}function L(k,H){const $=4*k.charCount,J=H.instanceCount.ref.value,W=(0,r.tu)(),te=W.position,de=k.centerBuffer.ref.value,ye=H.aTransform.ref.value;return(0,r.iQ)($,J,4,(Z,q)=>(q<0?b.eB.fromArray(te,de,3*Z):b.eB.transformMat4Offset(te,de,ye,0,3*Z,16*q),W))}function w(k,H,$,J,W){const{instanceCount:te,groupCount:de}=$,ye=L(k,H),j=(0,t.D1)($,ye,J.color),Z=(0,A.v3)($,J.size),q=W.instanceGranularity?(0,y.Km)(te,"instance"):(0,y.Km)(te*de,"groupInstance"),Y=(0,l.WG)(),ee=(0,m.MD)(),g=(0,h.JS)(),_e=(0,C.IB)(),xe=(0,s.EN)(),le={drawCount:2*k.charCount*3,vertexCount:4*k.charCount,groupCount:de,instanceCount:te},Ae=S(k.mappingBuffer.ref.value,k.depthBuffer.ref.value,k.charCount,(0,A.yx)(Z)),Be=i.f8.expand((0,i.f8)(),k.boundingSphere,Ae),Ce=(0,v.Ax)(Be,H.aTransform.ref.value,te,0);return{dGeometryType:o.IQ.create("text"),aPosition:k.centerBuffer,aMapping:k.mappingBuffer,aDepth:k.depthBuffer,aGroup:k.groupBuffer,elements:k.indexBuffer,boundingSphere:o.IQ.create(Ce),invariantBoundingSphere:o.IQ.create(Be),uInvariantBoundingSphere:o.IQ.create(b.Zb.ofSphere(Be)),...j,...Z,...q,...Y,...ee,...g,..._e,...xe,...H,aTexCoord:k.tcoordBuffer,tFont:k.fontTexture,padding:o.IQ.create(Ae),...I.iy.createValues(W,le),uSizeFactor:o.IQ.create(W.sizeFactor),uBorderWidth:o.IQ.create((0,M.qE)(W.borderWidth,0,.5)),uBorderColor:o.IQ.create(O.Q1.toArrayNormalized(W.borderColor,b.eB.zero(),0)),uOffsetX:o.IQ.create(W.offsetX),uOffsetY:o.IQ.create(W.offsetY),uOffsetZ:o.IQ.create(W.offsetZ),uBackgroundColor:o.IQ.create(O.Q1.toArrayNormalized(W.backgroundColor,b.eB.zero(),0)),uBackgroundOpacity:o.IQ.create(W.backgroundOpacity)}}function N(k,H){I.iy.updateRenderableState(k,H),k.pickable=!1,k.opaque=!1,k.writeDepth=!0}D.create=R,D.createEmpty=f,D.Params={...I.iy.Params,..._.nZ,sizeFactor:e.t.Numeric(1,{min:0,max:10,step:.1}),borderWidth:e.t.Numeric(0,{min:0,max:.5,step:.01}),borderColor:e.t.Color(c.s.grey),offsetX:e.t.Numeric(0,{min:0,max:10,step:.1}),offsetY:e.t.Numeric(0,{min:0,max:10,step:.1}),offsetZ:e.t.Numeric(0,{min:0,max:10,step:.1}),background:e.t.Boolean(!1),backgroundMargin:e.t.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:e.t.Color(c.s.grey),backgroundOpacity:e.t.Numeric(1,{min:0,max:1,step:.01}),tether:e.t.Boolean(!1),tetherLength:e.t.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:e.t.Numeric(.3,{min:0,max:1,step:.01}),attachment:e.t.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])},D.Utils={Params:D.Params,createEmpty:f,createValues:w,createValuesSimple:function Q(k,H,$,J,W){const te=I.iy.createSimple($,J,W),de={...e.t.getDefaultValues(D.Params),...H};return w(k,te.transform,te.locationIterator,te.theme,de)},updateValues:function G(k,H){I.iy.updateValues(k,H),o.IQ.updateIfChanged(k.uSizeFactor,H.sizeFactor),o.IQ.updateIfChanged(k.uBorderWidth,H.borderWidth),O.Q1.fromNormalizedArray(k.uBorderColor.ref.value,0)!==H.borderColor&&(O.Q1.toArrayNormalized(H.borderColor,k.uBorderColor.ref.value,0),o.IQ.update(k.uBorderColor,k.uBorderColor.ref.value)),o.IQ.updateIfChanged(k.uOffsetX,H.offsetX),o.IQ.updateIfChanged(k.uOffsetY,H.offsetY),o.IQ.updateIfChanged(k.uOffsetZ,H.offsetZ),O.Q1.fromNormalizedArray(k.uBackgroundColor.ref.value,0)!==H.backgroundColor&&(O.Q1.toArrayNormalized(H.backgroundColor,k.uBackgroundColor.ref.value,0),o.IQ.update(k.uBackgroundColor,k.uBackgroundColor.ref.value)),o.IQ.updateIfChanged(k.uBackgroundOpacity,H.backgroundOpacity)},updateBoundingSphere:function V(k,H){const $=S(k.aMapping.ref.value,k.aDepth.ref.value,H.charCount,(0,A.yx)(k)),J=i.f8.expand((0,i.f8)(),H.boundingSphere,$),W=(0,v.Ax)(J,k.aTransform.ref.value,k.instanceCount.ref.value,0);i.f8.equals(W,k.boundingSphere.ref.value)||o.IQ.update(k.boundingSphere,W),i.f8.equals(J,k.invariantBoundingSphere.ref.value)||(o.IQ.update(k.invariantBoundingSphere,J),o.IQ.update(k.uInvariantBoundingSphere,b.Zb.fromSphere(k.uInvariantBoundingSphere.ref.value,J))),o.IQ.update(k.padding,$)},createRenderableState:function U(k){const H=I.iy.createRenderableState(k);return N(H,k),H},updateRenderableState:N,createPositionIterator:L}}(a||(a={}))},6280:(tn,Ue,n)=>{"use strict";n.d(Ue,{_i:()=>V,ij:()=>J,FB:()=>N,DG:()=>te,NQ:()=>H});var e=n(9909),o=n(9421),r=n(4648),t=n(2897),A=n(4143),y=n(4511),c=n(9387);const i="\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tCount;\nuniform vec2 uTexSize;\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n    float count = texture2D(tCount, coords).r;\n\n    gl_FragColor = color / count;\n}\n";var v=n(9007),O=n(4369),b=n(5384);const _="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uResolution;\n\nconst float p = 2.0;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition);\n    if (dist > p) discard;\n\n    float f = p - dist;\n    gl_FragColor = vColor * f;\n    gl_FragData[1] = vec4(f);\n}\n",M="\nprecision highp float;\n\n#include common\n#include read_from_texture\n\nuniform int uGroupCount;\n\nattribute float aSample;\n#define SampleID int(aSample)\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform vec2 uGeoTexDim;\nuniform sampler2D tPosition;\nuniform sampler2D tGroup;\n\nuniform vec2 uColorTexDim;\nuniform sampler2D tColor;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;\n    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);\n\n    position = (aTransform * vec4(position, 1.0)).xyz;\n    gl_PointSize = 7.0;\n    vPosition = (position - uBboxMin) / uResolution;\n    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n\n    #if defined(dColorType_group)\n        vColor = readFromTexture(tColor, group, uColorTexDim);\n    #elif defined(dColorType_groupInstance)\n        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);\n    #endif\n}\n";var I=n(8437),l=n(2629);const m={drawCount:(0,y.Xb)("number"),instanceCount:(0,y.Xb)("number"),stride:(0,y.Xb)("number"),uGroupCount:(0,y.w5)("i","material"),aTransform:(0,y.Yz)("float32",16,1),aInstance:(0,y.Yz)("float32",1,1),aSample:(0,y.Yz)("float32",1,0),uGeoTexDim:(0,y.w5)("v2","material"),tPosition:(0,y.$G)("texture","rgba","float","nearest","material"),tGroup:(0,y.$G)("texture","rgba","float","nearest","material"),uColorTexDim:(0,y.w5)("v2","material"),tColor:(0,y.$G)("texture","rgba","ubyte","nearest","material"),dColorType:(0,y.$F)("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:(0,y.w5)("f"),uCurrentX:(0,y.w5)("f"),uCurrentY:(0,y.w5)("f"),uBboxMin:(0,y.w5)("v3","material"),uBboxSize:(0,y.w5)("v3","material"),uResolution:(0,y.w5)("f","material")},u="color-accumulate",d="color-count";function s(de,ye){const j=new Float32Array(de);for(let Z=0;Z<de;++Z)j[Z]=Z*ye;return j}const S={...v.du,tColor:(0,y.$G)("texture","rgba","float","nearest"),tCount:(0,y.$G)("texture","alpha","float","nearest"),uTexSize:(0,y.w5)("v2")},D="color-normalize";function T(de,ye,j,Z,q){const{drawBuffers:Y}=Z.extensions;if(!Y)throw new Error("need WebGL draw buffers");l.g$&&Z.timer.mark("calcTextureMeshColorSmoothing");const{gl:ee,resources:g,state:_e,extensions:{colorBufferHalfFloat:xe,textureHalfFloat:le}}=Z,Ae=de.colorType.endsWith("Instance"),Be=b.DJ.fromSphere3D((0,b.DJ)(),Ae?de.boundingSphere:de.invariantBoundingSphere),Ce=1+ye,Re=b.DJ.expand((0,b.DJ)(),Be,O.eB.create(Ce,Ce,Ce)),ke=1/ye,we=b.DJ.scale((0,b.DJ)(),Re,ke),Oe=b.DJ.size((0,O.eB)(),we);O.eB.ceil(Oe,Oe),O.eB.add(Oe,Oe,O.eB.create(2,2,2));const{min:Se}=Re,[Ve,Ne,K]=Oe,{texDimX:ne,texDimY:be,texCols:Te}=function E(de){const j=Math.sqrt(de[0]*de[1]*de[2]),Z=Math.pow(2,Math.ceil(Math.log(j)/Math.log(2)));let q=0,Y=de[1],ee=1,g=de[2];return Z<de[0]*de[2]?(g=Math.floor(Z/de[0]),ee=Math.ceil(de[2]/g),q=g*de[0],Y*=ee):q=de[0]*de[2],{texDimX:q,texDimY:Y,texRows:ee,texCols:g,powerOfTwoSize:Y<Z?Z:2*Z}}(Oe);Z.namedFramebuffers[u]||(Z.namedFramebuffers[u]=Z.resources.framebuffer());const ie=Z.namedFramebuffers[u];(0,I.C6)(ee)?(Z.namedTextures[u]||(Z.namedTextures[u]=xe&&le?g.texture("image-float16","rgba","fp16","nearest"):g.texture("image-float32","rgba","float","nearest")),Z.namedTextures[d]||(Z.namedTextures[d]=g.texture("image-float32","alpha","float","nearest"))):(Z.namedTextures[u]||(Z.namedTextures[u]=g.texture("image-float32","rgba","float","nearest")),Z.namedTextures[d]||(Z.namedTextures[d]=g.texture("image-float32","rgba","float","nearest")));const ue=Z.namedTextures[u],re=Z.namedTextures[d];ue.define(ne,be),re.define(ne,be),ue.attachFramebuffer(ie,0),re.attachFramebuffer(ie,1);const ve=function C(de,ye,j,Z,q){if(de.namedComputeRenderables[u]){const Y=O.eB.sub((0,O.eB)(),j.max,j.min),ee=de.namedComputeRenderables[u].values,g=Math.round(ye.vertexCount/q);(g>ee.drawCount.ref.value||q!==ee.stride.ref.value)&&e.IQ.update(ee.aSample,s(g,q)),e.IQ.updateIfChanged(ee.drawCount,g),e.IQ.updateIfChanged(ee.instanceCount,ye.instanceCount),e.IQ.updateIfChanged(ee.stride,q),e.IQ.updateIfChanged(ee.uGroupCount,ye.groupCount),e.IQ.update(ee.aTransform,ye.transformBuffer),e.IQ.update(ee.aInstance,ye.instanceBuffer),e.IQ.update(ee.uGeoTexDim,O.ZY.set(ee.uGeoTexDim.ref.value,ye.positionTexture.getWidth(),ye.positionTexture.getHeight())),e.IQ.update(ee.tPosition,ye.positionTexture),e.IQ.update(ee.tGroup,ye.groupTexture),e.IQ.update(ee.uColorTexDim,O.ZY.set(ee.uColorTexDim.ref.value,ye.colorData.getWidth(),ye.colorData.getHeight())),e.IQ.update(ee.tColor,ye.colorData),e.IQ.updateIfChanged(ee.dColorType,ye.colorType),e.IQ.updateIfChanged(ee.uCurrentSlice,0),e.IQ.updateIfChanged(ee.uCurrentX,0),e.IQ.updateIfChanged(ee.uCurrentY,0),e.IQ.update(ee.uBboxMin,j.min),e.IQ.update(ee.uBboxSize,Y),e.IQ.updateIfChanged(ee.uResolution,Z),de.namedComputeRenderables[u].update()}else de.namedComputeRenderables[u]=function h(de,ye,j,Z,q){const Y=O.eB.sub((0,O.eB)(),j.max,j.min),ee=Math.round(ye.vertexCount/q),g={drawCount:e.IQ.create(ee),instanceCount:e.IQ.create(ye.instanceCount),stride:e.IQ.create(q),uGroupCount:e.IQ.create(ye.groupCount),aTransform:e.IQ.create(ye.transformBuffer),aInstance:e.IQ.create(ye.instanceBuffer),aSample:e.IQ.create(s(ee,q)),uGeoTexDim:e.IQ.create(O.ZY.create(ye.positionTexture.getWidth(),ye.positionTexture.getHeight())),tPosition:e.IQ.create(ye.positionTexture),tGroup:e.IQ.create(ye.groupTexture),uColorTexDim:e.IQ.create(O.ZY.create(ye.colorData.getWidth(),ye.colorData.getHeight())),tColor:e.IQ.create(ye.colorData),dColorType:e.IQ.create(ye.colorType),uCurrentSlice:e.IQ.create(0),uCurrentX:e.IQ.create(0),uCurrentY:e.IQ.create(0),uBboxMin:e.IQ.create(j.min),uBboxSize:e.IQ.create(Y),uResolution:e.IQ.create(Z)},_e={...m},xe=(0,t.NG)("accumulate",M,_,{drawBuffers:"required"}),le=(0,A.$h)(de,"points",xe,_e,g);return(0,o._)(le,g)}(de,ye,j,Z,q);return de.namedComputeRenderables[u]}(Z,de,Re,ye,j);_e.currentRenderItemId=-1,ie.bind(),Y.drawBuffers([Y.COLOR_ATTACHMENT0,Y.COLOR_ATTACHMENT1]);const{uCurrentSlice:ce,uCurrentX:se,uCurrentY:ae}=ve.values;l.g$&&Z.timer.mark("ColorAccumulate.render"),function a(de){const{gl:ye,state:j}=de;j.disable(ye.CULL_FACE),j.enable(ye.BLEND),j.disable(ye.DEPTH_TEST),j.enable(ye.SCISSOR_TEST),j.depthMask(!1),j.clearColor(0,0,0,0),j.blendFunc(ye.ONE,ye.ONE),j.blendEquation(ye.FUNC_ADD)}(Z),_e.viewport(0,0,ne,be),_e.scissor(0,0,ne,be),ee.clear(ee.COLOR_BUFFER_BIT),e.IQ.update(ae,0);let ge=0,Ie=0,Le=0;for(let Je=0;Je<K;++Je)ge>=Te&&(ge-=Te,Ie+=Ne,Le=0,e.IQ.update(ae,Ie)),e.IQ.update(se,Le),e.IQ.update(ce,Je),_e.viewport(Le,Ie,Ve,Ne),_e.scissor(Le,Ie,Ve,Ne),ve.render(),++ge,Le+=Ve;ue.detachFramebuffer(ie,0),re.detachFramebuffer(ie,1),Y.drawBuffers([ee.COLOR_ATTACHMENT0,ee.NONE]),l.g$&&Z.timer.markEnd("ColorAccumulate.render"),l.g$&&Z.timer.mark("ColorNormalize.render"),(!q||(0,r.NP)(q))&&(q=g.texture("image-uint8","rgba","ubyte","linear")),q.define(ne,be);const nt=function R(de,ye,j){if(de.namedComputeRenderables[D]){const Z=de.namedComputeRenderables[D].values;e.IQ.update(Z.tColor,ye),e.IQ.update(Z.tCount,j),e.IQ.update(Z.uTexSize,O.ZY.set(Z.uTexSize.ref.value,ye.getWidth(),ye.getHeight())),de.namedComputeRenderables[D].update()}else de.namedComputeRenderables[D]=function f(de,ye,j){const Z={...v.OM,tColor:e.IQ.create(ye),tCount:e.IQ.create(j),uTexSize:e.IQ.create(O.ZY.create(ye.getWidth(),ye.getHeight()))},q={...S},Y=(0,t.NG)("normalize",c.e,i),ee=(0,A.$h)(de,"triangles",Y,q,Z);return(0,o._)(ee,Z)}(de,ye,j);return de.namedComputeRenderables[D]}(Z,ue,re);_e.currentRenderItemId=-1,function p(de){const{gl:ye,state:j}=de;j.disable(ye.CULL_FACE),j.enable(ye.BLEND),j.disable(ye.DEPTH_TEST),j.enable(ye.SCISSOR_TEST),j.depthMask(!1),j.clearColor(0,0,0,0),j.blendFunc(ye.ONE,ye.ONE),j.blendEquation(ye.FUNC_ADD)}(Z),q.attachFramebuffer(ie,0),_e.viewport(0,0,ne,be),_e.scissor(0,0,ne,be),ee.clear(ee.COLOR_BUFFER_BIT),nt.render(),l.g$&&Z.timer.markEnd("ColorNormalize.render");const je=O.Zb.create(Se[0],Se[1],Se[2],ke),Lt=Ae?"volumeInstance":"volume";return l.g$&&Z.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:q,gridDim:Oe,gridTexDim:O.ZY.create(ne,be),gridTransform:je,type:Lt}}const L="color-smoothing-rgb",w="color-smoothing-rgba",Q="color-smoothing-alpha";function V(de,ye,j,Z,q){if(!function G(de){return"group"===de||"groupInstance"===de}(de.dColorType.ref.value))return;j*=3,Z.namedTextures[L]||(Z.namedTextures[L]=Z.resources.texture("image-uint8","rgb","ubyte","nearest"));const Y=Z.namedTextures[L];Y.load(de.tColor.ref.value);const ee=T({vertexCount:de.uVertexCount.ref.value,instanceCount:de.uInstanceCount.ref.value,groupCount:de.uGroupCount.ref.value,transformBuffer:de.aTransform.ref.value,instanceBuffer:de.aInstance.ref.value,positionTexture:de.tPosition.ref.value,groupTexture:de.tGroup.ref.value,colorData:Y,colorType:de.dColorType.ref.value,boundingSphere:de.boundingSphere.ref.value,invariantBoundingSphere:de.invariantBoundingSphere.ref.value},ye,j,Z,q);e.IQ.updateIfChanged(de.dColorType,ee.type),e.IQ.update(de.tColorGrid,ee.texture),e.IQ.update(de.uColorTexDim,ee.gridTexDim),e.IQ.update(de.uColorGridDim,ee.gridDim),e.IQ.update(de.uColorGridTransform,ee.gridTransform)}function N(de,ye,j,Z,q){if(!function U(de){return"groupInstance"===de}(de.dOverpaintType.ref.value))return;j*=3,Z.namedTextures[w]||(Z.namedTextures[w]=Z.resources.texture("image-uint8","rgba","ubyte","nearest"));const Y=Z.namedTextures[w];Y.load(de.tOverpaint.ref.value);const ee=T({vertexCount:de.uVertexCount.ref.value,instanceCount:de.uInstanceCount.ref.value,groupCount:de.uGroupCount.ref.value,transformBuffer:de.aTransform.ref.value,instanceBuffer:de.aInstance.ref.value,positionTexture:de.tPosition.ref.value,groupTexture:de.tGroup.ref.value,colorData:Y,colorType:de.dOverpaintType.ref.value,boundingSphere:de.boundingSphere.ref.value,invariantBoundingSphere:de.invariantBoundingSphere.ref.value},ye,j,Z,q);e.IQ.updateIfChanged(de.dOverpaintType,ee.type),e.IQ.update(de.tOverpaintGrid,ee.texture),e.IQ.update(de.uOverpaintTexDim,ee.gridTexDim),e.IQ.update(de.uOverpaintGridDim,ee.gridDim),e.IQ.update(de.uOverpaintGridTransform,ee.gridTransform)}function H(de,ye,j,Z,q){if(!function k(de){return"groupInstance"===de}(de.dTransparencyType.ref.value))return;j*=3,Z.namedTextures[Q]||(Z.namedTextures[Q]=Z.resources.texture("image-uint8","alpha","ubyte","nearest"));const Y=Z.namedTextures[Q];Y.load(de.tTransparency.ref.value);const ee=T({vertexCount:de.uVertexCount.ref.value,instanceCount:de.uInstanceCount.ref.value,groupCount:de.uGroupCount.ref.value,transformBuffer:de.aTransform.ref.value,instanceBuffer:de.aInstance.ref.value,positionTexture:de.tPosition.ref.value,groupTexture:de.tGroup.ref.value,colorData:Y,colorType:de.dTransparencyType.ref.value,boundingSphere:de.boundingSphere.ref.value,invariantBoundingSphere:de.invariantBoundingSphere.ref.value},ye,j,Z,q);e.IQ.updateIfChanged(de.dTransparencyType,ee.type),e.IQ.update(de.tTransparencyGrid,ee.texture),e.IQ.update(de.uTransparencyTexDim,ee.gridTexDim),e.IQ.update(de.uTransparencyGridDim,ee.gridDim),e.IQ.update(de.uTransparencyGridTransform,ee.gridTransform)}function J(de,ye,j,Z,q){if(!function $(de){return"groupInstance"===de}(de.dEmissiveType.ref.value))return;j*=3,Z.namedTextures[Q]||(Z.namedTextures[Q]=Z.resources.texture("image-uint8","alpha","ubyte","nearest"));const Y=Z.namedTextures[Q];Y.load(de.tEmissive.ref.value);const ee=T({vertexCount:de.uVertexCount.ref.value,instanceCount:de.uInstanceCount.ref.value,groupCount:de.uGroupCount.ref.value,transformBuffer:de.aTransform.ref.value,instanceBuffer:de.aInstance.ref.value,positionTexture:de.tPosition.ref.value,groupTexture:de.tGroup.ref.value,colorData:Y,colorType:de.dEmissiveType.ref.value,boundingSphere:de.boundingSphere.ref.value,invariantBoundingSphere:de.invariantBoundingSphere.ref.value},ye,j,Z,q);e.IQ.updateIfChanged(de.dEmissiveType,ee.type),e.IQ.update(de.tEmissiveGrid,ee.texture),e.IQ.update(de.uEmissiveTexDim,ee.gridTexDim),e.IQ.update(de.uEmissiveGridDim,ee.gridDim),e.IQ.update(de.uEmissiveGridTransform,ee.gridTransform)}function te(de,ye,j,Z,q){if(!function W(de){return"groupInstance"===de}(de.dSubstanceType.ref.value))return;j*=3,Z.namedTextures[w]||(Z.namedTextures[w]=Z.resources.texture("image-uint8","rgba","ubyte","nearest"));const Y=Z.namedTextures[w];Y.load(de.tSubstance.ref.value);const ee=T({vertexCount:de.uVertexCount.ref.value,instanceCount:de.uInstanceCount.ref.value,groupCount:de.uGroupCount.ref.value,transformBuffer:de.aTransform.ref.value,instanceBuffer:de.aInstance.ref.value,positionTexture:de.tPosition.ref.value,groupTexture:de.tGroup.ref.value,colorData:Y,colorType:de.dSubstanceType.ref.value,boundingSphere:de.boundingSphere.ref.value,invariantBoundingSphere:de.invariantBoundingSphere.ref.value},ye,j,Z,q);e.IQ.updateIfChanged(de.dSubstanceType,ee.type),e.IQ.update(de.tSubstanceGrid,ee.texture),e.IQ.update(de.uSubstanceTexDim,ee.gridTexDim),e.IQ.update(de.uSubstanceGridDim,ee.gridDim),e.IQ.update(de.uSubstanceGridTransform,ee.gridTransform)}},799:(tn,Ue,n)=>{"use strict";n.d(Ue,{X:()=>u});var u,e=n(9909),o=n(5384),r=n(8277),t=n(1888),A=n(2712),y=n(8013),c=n(5019),i=n(2075),v=n(9197),O=n(3784),b=n(4648),_=n(4369),M=n(5077),I=n(364),l=n(8307),m=n(6022);!function(d){class s{constructor(){this.index=0,this.textures=[]}get(){return this.textures[this.index]}set(w,Q,G){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:w,group:Q,normal:G}),this.index=(this.index+1)%2}destroy(){for(const w of this.textures)w.vertex.destroy(),w.group.destroy(),w.normal.destroy()}}function C(L,w,Q,G,V,U,N){const k=Q.getWidth(),H=Q.getHeight();return N?(N.vertexCount=L,N.groupCount=w,e.IQ.update(N.geoTextureDim,_.ZY.set(N.geoTextureDim.ref.value,k,H)),e.IQ.update(N.vertexTexture,Q),e.IQ.update(N.groupTexture,G),e.IQ.update(N.normalTexture,V),N.doubleBuffer.set(Q,G,V),o.f8.copy(N.boundingSphere,U),N):{kind:"texture-mesh",vertexCount:L,groupCount:w,geoTextureDim:e.IQ.create(_.ZY.create(k,H)),vertexTexture:e.IQ.create(Q),groupTexture:e.IQ.create(G),normalTexture:e.IQ.create(V),varyingGroup:e.IQ.create(!1),doubleBuffer:new s,boundingSphere:o.f8.clone(U),meta:{}}}function h(L){return C(0,0,L?L.vertexTexture.ref.value:(0,b.z6)(),L?L.groupTexture.ref.value:(0,b.z6)(),L?L.normalTexture.ref.value:(0,b.z6)(),L?L.boundingSphere:(0,o.f8)(),L)}d.DoubleBuffer=s,d.create=C,d.createEmpty=h,d.Params={...c.iy.Params,doubleSided:r.t.Boolean(!1,c.iy.CustomQualityParamInfo),flipSided:r.t.Boolean(!1,c.iy.ShadingCategory),flatShaded:r.t.Boolean(!1,c.iy.ShadingCategory),ignoreLight:r.t.Boolean(!1,c.iy.ShadingCategory),xrayShaded:r.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],c.iy.ShadingCategory),transparentBackfaces:r.t.Select("off",r.t.arrayToOptions(["off","on","opaque"]),c.iy.ShadingCategory),bumpFrequency:r.t.Numeric(0,{min:0,max:10,step:.1},c.iy.ShadingCategory),bumpAmplitude:r.t.Numeric(1,{min:0,max:5,step:.1},c.iy.ShadingCategory)},d.Utils={Params:d.Params,createEmpty:h,createValues:D,createValuesSimple:function R(L,w,Q,G,V){const U=c.iy.createSimple(Q,G,V),N={...r.t.getDefaultValues(d.Params),...w};return D(L,U.transform,U.locationIterator,U.theme,N)},updateValues:function f(L,w){c.iy.updateValues(L,w),e.IQ.updateIfChanged(L.uDoubleSided,w.doubleSided),e.IQ.updateIfChanged(L.dFlatShaded,w.flatShaded),e.IQ.updateIfChanged(L.dFlipSided,w.flipSided),e.IQ.updateIfChanged(L.dIgnoreLight,w.ignoreLight),e.IQ.updateIfChanged(L.dXrayShaded,"inverted"===w.xrayShaded?"inverted":!0===w.xrayShaded?"on":"off"),e.IQ.updateIfChanged(L.dTransparentBackfaces,w.transparentBackfaces),e.IQ.updateIfChanged(L.uBumpFrequency,w.bumpFrequency),e.IQ.updateIfChanged(L.uBumpAmplitude,w.bumpAmplitude)},updateBoundingSphere:function p(L,w){const Q=o.f8.clone(w.boundingSphere),G=(0,O.Ax)(Q,L.aTransform.ref.value,L.instanceCount.ref.value,0);o.f8.equals(G,L.boundingSphere.ref.value)||e.IQ.update(L.boundingSphere,G),o.f8.equals(Q,L.invariantBoundingSphere.ref.value)||(e.IQ.update(L.invariantBoundingSphere,Q),e.IQ.update(L.uInvariantBoundingSphere,_.Zb.fromSphere(L.uInvariantBoundingSphere.ref.value,Q)))},createRenderableState:function E(L){const w=c.iy.createRenderableState(L);return T(w,L),w},updateRenderableState:T,createPositionIterator:function S(L,w){const Q=L.meta.webgl;if(!Q)return(0,t.iQ)(1,1,1,()=>I.LU);Q.namedFramebuffers[a]||(Q.namedFramebuffers[a]=Q.resources.framebuffer());const G=Q.namedFramebuffers[a],[V,U]=L.geoTextureDim.ref.value,N=new Float32Array(V*U*4);G.bind(),L.vertexTexture.ref.value.attachFramebuffer(G,0),Q.readPixels(0,0,V,U,N);const k=new Float32Array(V*U*4);G.bind(),L.normalTexture.ref.value.attachFramebuffer(G,0),Q.readPixels(0,0,V,U,k);const H=L.vertexCount,$=w.instanceCount.ref.value,J=(0,t.tu)(),W=J.position,te=J.normal,de=w.aTransform.ref.value;return(0,t.iQ)(H,$,1,(j,Z)=>(Z<0?(_.eB.fromArray(W,N,4*j),_.eB.fromArray(te,k,4*j)):(_.eB.transformMat4Offset(W,N,de,0,4*j,16*Z),_.eB.transformDirectionOffset(te,k,de,0,4*j,16*Z)),J))}};const a="texture-mesh";function D(L,w,Q,G,V){const{instanceCount:U,groupCount:N}=Q,k=d.Utils.createPositionIterator(L,w),H=(0,A.D1)(Q,k,G.color),$=V.instanceGranularity?(0,y.Km)(U,"instance"):(0,y.Km)(U*N,"groupInstance"),J=(0,i.WG)(),W=(0,v.MD)(),te=(0,m.JS)(),de=(0,l.IB)(),ye=(0,M.EN)(),j={drawCount:L.vertexCount,vertexCount:L.vertexCount,groupCount:N,instanceCount:U},Z=o.f8.clone(L.boundingSphere),q=(0,O.Ax)(Z,w.aTransform.ref.value,U,0);return{dGeometryType:e.IQ.create("textureMesh"),uGeoTexDim:L.geoTextureDim,tPosition:L.vertexTexture,tGroup:L.groupTexture,tNormal:L.normalTexture,dVaryingGroup:L.varyingGroup,boundingSphere:e.IQ.create(q),invariantBoundingSphere:e.IQ.create(Z),uInvariantBoundingSphere:e.IQ.create(_.Zb.ofSphere(Z)),...H,...$,...J,...W,...te,...de,...ye,...w,...c.iy.createValues(V,j),uDoubleSided:e.IQ.create(V.doubleSided),dFlatShaded:e.IQ.create(V.flatShaded),dFlipSided:e.IQ.create(V.flipSided),dIgnoreLight:e.IQ.create(V.ignoreLight),dXrayShaded:e.IQ.create("inverted"===V.xrayShaded?"inverted":!0===V.xrayShaded?"on":"off"),dTransparentBackfaces:e.IQ.create(V.transparentBackfaces),uBumpFrequency:e.IQ.create(V.bumpFrequency),uBumpAmplitude:e.IQ.create(V.bumpAmplitude),meta:e.IQ.create(L.meta)}}function T(L,w){c.iy.updateRenderableState(L,w),L.opaque=L.opaque&&!w.xrayShaded,L.writeDepth=L.opaque}}(u||(u={}))},3596:(tn,Ue,n)=>{"use strict";n.d(Ue,{Zk:()=>h,l1:()=>s,ES:()=>a,CY:()=>S});var e=n(9909),o=n(4369),r=n(6115),t=n(5100),A=n(5384),y=n(2086),c=n(9307),i=n(8184);const v=y.e.transformMat4Offset,O=y.e.fromArray,b=A.DJ.add;const m=(0,o.U)(),u=(0,o.$I)();function s(D,R,f,p,E,T){const L=function d(D,R){for(let f=0;f<R;f++)if(o.U.fromMat4(m,o.$I.fromArray(u,D,16*f)),o.U.determinant(m)<0)return!0;return!1}(D,R);if(T){e.IQ.update(T.matrix,T.matrix.ref.value);const w=T.transform.ref.value.length>=16*R?T.transform.ref.value:new Float32Array(16*R);w.set(D),e.IQ.update(T.transform,w),e.IQ.updateIfChanged(T.uInstanceCount,R),e.IQ.updateIfChanged(T.instanceCount,R);const Q=T.aTransform.ref.value.length>=16*R?T.aTransform.ref.value:new Float32Array(16*R);e.IQ.update(T.aTransform,Q);const G=T.extraTransform.ref.value.length>=16*R?T.extraTransform.ref.value:new Float32Array(16*R);e.IQ.update(T.extraTransform,a(G,R));const V=T.aInstance.ref.value.length>=R?T.aInstance.ref.value:new Float32Array(R);e.IQ.update(T.aInstance,(0,r.WE)(V,R)),e.IQ.update(T.hasReflection,L)}else T={aTransform:e.IQ.create(new Float32Array(16*R)),matrix:e.IQ.create(o.$I.identity()),transform:e.IQ.create(new Float32Array(D)),extraTransform:e.IQ.create(a(new Float32Array(16*R),R)),uInstanceCount:e.IQ.create(R),instanceCount:e.IQ.create(R),aInstance:e.IQ.create((0,r.WE)(new Float32Array(R))),hasReflection:e.IQ.create(L),instanceGrid:e.IQ.create({cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array})};return S(T,f,p,E),T}const C=new Float32Array(16);function h(D){return s(new Float32Array(C),1,void 0,0,0,D)}function a(D,R){for(let f=0;f<R;f++)D.set(C,16*f);return D}function S(D,R,f,p){const E=D.aTransform.ref.value,T=D.aInstance.ref.value,L=D.instanceCount.ref.value,w=D.matrix.ref.value,Q=D.transform.ref.value,G=D.extraTransform.ref.value;for(let V=0;V<L;V++){const U=16*V;o.$I.mulOffset(E,G,Q,U,U,U),o.$I.mulOffset(E,w,E,U,0,U),T[V]=V}if(R&&L>0){const V=function M(D,R,f){const p=function I(D,R){const{instanceCount:f,instance:p,transform:E,invariantBoundingSphere:T}=D,L=new Float32Array(f),w=new Float32Array(f),Q=new Float32Array(f),G=t.C.ofBounds(0,f),V=A.DJ.setEmpty((0,A.DJ)()),{center:U,radius:N}=T,k=y.e.create(N,N,N),H=(0,y.e)();for(let le=0;le<f;++le)v(H,U,E,0,0,16*le),L[le]=H[0],w[le]=H[1],Q[le]=H[2],b(V,H);A.DJ.expand(V,V,k);const $={x:L,y:w,z:Q,indices:G},J={box:V,sphere:i.f.fromBox3D((0,i.f)(),V)},W=(0,c.E)($,J,y.e.create(R,R,R)),{array:te,offset:de,count:ye}=W.buckets,j=de.length,Z=new Uint32Array(j+1),q=new Float32Array(4*j),Y=new Float32Array(16*f),ee=new Float32Array(f),g=(0,A.DJ)(),_e=(0,i.f)();let xe=0;for(let le=0;le<j;++le){const Ae=de[le],Be=ye[le];Z[le]=Ae;const Ce=xe;for(let Re=Ae,ke=Ae+Be;Re<ke;++Re){const we=te[Re];ee[xe]=p[we];for(let Oe=0;Oe<16;++Oe)Y[16*xe+Oe]=E[16*we+Oe];xe+=1}if(1===Be)v(q,U,Y,4*le,0,16*Ce),q[4*le+3]=N;else{A.DJ.setEmpty(g);const Re=16*Ce;for(let ke=0;ke<Be;++ke)v(H,U,Y,0,0,16*ke+Re),b(g,H);A.DJ.expand(g,g,k),i.f.fromBox3D(_e,g),i.f.toArray(_e,q,4*le)}}return Z[j]=de[j-1]+ye[j-1],{cellSize:R,cellCount:j,cellOffsets:Z,cellSpheres:q,cellTransform:Y,cellInstance:ee}}(D,R),E=function l(D,R){const{cellCount:f,cellSpheres:p}=D,E=new Float32Array(f),T=new Float32Array(f),L=new Float32Array(f),w=t.C.ofBounds(0,f),Q=A.DJ.setEmpty((0,A.DJ)()),G=(0,y.e)();let V=0;for(let ee=0;ee<f;++ee){const g=4*ee;O(G,p,g),E[ee]=G[0],T[ee]=G[1],L[ee]=G[2],b(Q,G),V=Math.max(V,p[g+3])}const U=y.e.create(V,V,V);A.DJ.expand(Q,Q,U);const N={x:E,y:T,z:L,indices:w},k={box:Q,sphere:i.f.fromBox3D((0,i.f)(),Q)},H=(0,c.E)(N,k,y.e.create(R,R,R)),{array:$,offset:J,count:W}=H.buckets,te=J.length,de=new Uint32Array(te+1),ye=new Float32Array(4*te),j=new Uint32Array(f),Z=(0,A.DJ)(),q=(0,i.f)();let Y=0;for(let ee=0;ee<te;++ee){const g=J[ee],_e=W[ee];de[ee]=g;for(let xe=g,le=g+_e;xe<le;++xe)j[Y]=$[xe],Y+=1;if(1===_e){const xe=$[g];ye[4*ee]=p[4*xe],ye[4*ee+1]=p[4*xe+1],ye[4*ee+2]=p[4*xe+2],ye[4*ee+3]=p[4*xe+3]}else{A.DJ.setEmpty(Z),V=0;for(let xe=g,le=g+_e;xe<le;++xe){const Ae=$[xe];G[0]=p[4*Ae],G[1]=p[4*Ae+1],G[2]=p[4*Ae+2],b(Z,G),V=Math.max(V,p[4*Ae+3])}y.e.set(U,V,V,V),A.DJ.expand(Z,Z,U),i.f.fromBox3D(q,Z),i.f.toArray(q,ye,4*ee)}}return de[te]=J[te-1]+W[te-1],{batchSize:R,batchCount:te,batchOffsets:de,batchSpheres:ye,batchCell:j}}(p,f),T=new Uint32Array(p.cellOffsets.length),L=new Float32Array(p.cellSpheres.length),w=new Float32Array(p.cellInstance.length);let Q=0;for(let V=0,U=E.batchCell.length;V<U;++V){const N=E.batchCell[V],k=p.cellOffsets[N],$=p.cellOffsets[N+1]-k;T[V+1]=T[V]+$;for(let J=0;J<4;++J)L[4*V+J]=p.cellSpheres[4*N+J];for(let J=0;J<$;++J){const te=p.cellInstance[k+J];for(let de=0;de<16;++de)p.cellTransform[16*Q+de]=D.transform[16*te+de];w[Q]=te,Q+=1}}return{cellSize:p.cellSize,cellCount:p.cellCount,cellOffsets:T,cellSpheres:L,cellTransform:p.cellTransform,cellInstance:w,batchSize:E.batchSize,batchCount:E.batchCount,batchOffsets:E.batchOffsets,batchSpheres:E.batchSpheres,batchCell:(0,r.WE)(E.batchCell)}}({instanceCount:L,instance:T,transform:E,invariantBoundingSphere:R},f,p);e.IQ.update(D.instanceGrid,V),e.IQ.update(D.aInstance,V.cellInstance),e.IQ.update(D.aTransform,V.cellTransform)}else e.IQ.update(D.aInstance,T),e.IQ.update(D.aTransform,E)}o.$I.toArray(o.$I.identity(),C,0)},9197:(tn,Ue,n)=>{"use strict";n.d(Ue,{Gg:()=>y,MD:()=>O,Ti:()=>i,UG:()=>A,m6:()=>c});var e=n(7187),o=n(4369),r=n(3784),t=n(4648);function A(b,_,M,I){for(let l=_;l<M;++l)b[l]=255*I;return!0}function y(b,_){if(0===_||b.length<_)return 0;let M=0;for(let I=0;I<_;++I)M+=b[I];return M/(255*_)}function c(b,_,M){b.fill(0,_,M)}function i(b,_,M){const I=(0,r.xg)(Math.max(1,b),1,Uint8Array,M&&M.tTransparency.ref.value.array);return M?(e.IQ.update(M.tTransparency,I),e.IQ.update(M.uTransparencyTexDim,o.ZY.create(I.width,I.height)),e.IQ.updateIfChanged(M.dTransparency,b>0),e.IQ.updateIfChanged(M.transparencyAverage,y(I.array,b)),e.IQ.updateIfChanged(M.dTransparencyType,_),M):{tTransparency:e.IQ.create(I),uTransparencyTexDim:e.IQ.create(o.ZY.create(I.width,I.height)),dTransparency:e.IQ.create(b>0),transparencyAverage:e.IQ.create(0),tTransparencyGrid:e.IQ.create((0,t.z6)()),uTransparencyGridDim:e.IQ.create(o.eB.create(1,1,1)),uTransparencyGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dTransparencyType:e.IQ.create(_),uTransparencyStrength:e.IQ.create(1)}}const v={array:new Uint8Array(1),width:1,height:1};function O(b){return b?(e.IQ.update(b.tTransparency,v),e.IQ.update(b.uTransparencyTexDim,o.ZY.create(1,1)),b):{tTransparency:e.IQ.create(v),uTransparencyTexDim:e.IQ.create(o.ZY.create(1,1)),dTransparency:e.IQ.create(!1),transparencyAverage:e.IQ.create(0),tTransparencyGrid:e.IQ.create((0,t.z6)()),uTransparencyGridDim:e.IQ.create(o.eB.create(1,1,1)),uTransparencyGridTransform:e.IQ.create(o.Zb.create(0,0,0,1)),dTransparencyType:e.IQ.create("groupInstance"),uTransparencyStrength:e.IQ.create(1)}}},3280:(tn,Ue,n)=>{"use strict";n.d(Ue,{UC:()=>m,az:()=>_,wV:()=>I});var e=n(4369),o=n(6928),r=n(863),t=n(8937);const A=(0,e.eB)(),y=(0,e.eB)(),c=(0,e.eB)(),i=(0,e.eB)(),v=(0,r.n)(4,!0);function O(u){const C=(0,o.nT)(12,u?36:24);for(let h=0;h<4;++h){const a=(h+1)%4;e.eB.set(A,v[3*h],v[3*h+1],-.5),e.eB.set(y,v[3*a],v[3*a+1],-.5),e.eB.set(c,v[3*a],v[3*a+1],.5),e.eB.set(i,v[3*h],v[3*h+1],.5),u?C.add(A,y,c):C.addQuad(A,y,c,i)}return e.eB.set(A,v[0],v[1],-.5),e.eB.set(y,v[3],v[4],-.5),e.eB.set(c,v[6],v[7],-.5),e.eB.set(i,v[9],v[10],-.5),u?C.add(c,y,A):C.addQuad(i,c,y,A),e.eB.set(A,v[0],v[1],.5),e.eB.set(y,v[3],v[4],.5),e.eB.set(c,v[6],v[7],.5),e.eB.set(i,v[9],v[10],.5),u?C.add(A,y,c):C.addQuad(A,y,c,i),C.getPrimitive()}let b,M,l;function _(){return b||(b=O(!1)),b}function I(){return M||(M=O(!0)),M}function m(){return l||(l=(0,t.L3)([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),l}},8937:(tn,Ue,n)=>{"use strict";n.d(Ue,{L3:()=>o,b0:()=>A,so:()=>r});var e=n(4369);function o(y,c){return{vertices:y,edges:c}}function r(y){return{vertices:new Float32Array(y.vertices),edges:new Uint32Array(y.edges)}}const t=e.eB.zero();function A(y,c){const{vertices:i}=y;for(let v=0,O=i.length;v<O;v+=3)e.eB.transformMat4(t,e.eB.fromArray(t,i,v),c),e.eB.toArray(t,i,v);return y}},863:(tn,Ue,n)=>{"use strict";function e(o,r,t=-1){const A=new Float32Array(3*o),y=-1===t?o<=4?Math.sqrt(2)/2:.6:t,c=r?1:0;for(let i=0,v=o;i<v;++i){const O=(2*i+c)/o*Math.PI;A[3*i]=Math.cos(O)*y,A[3*i+1]=Math.sin(O)*y,A[3*i+2]=0}return A}n.d(Ue,{n:()=>e})},6928:(tn,Ue,n)=>{"use strict";n.d(Ue,{_2:()=>b,m9:()=>A,nT:()=>i});var e=n(4369);const o=(0,e.eB)(),r=(0,e.eB)(),t=(0,e.eB)();function A(_,M){const I=M.length,l=i(I/3);for(let m=0;m<I;m+=3)e.eB.fromArray(o,_,3*M[m]),e.eB.fromArray(r,_,3*M[m+1]),e.eB.fromArray(t,_,3*M[m+2]),l.add(o,r,t);return l.getPrimitive()}const c=(0,e.eB)();function i(_,M){void 0===M&&(M=3*_);const I=new Float32Array(3*M),l=new Float32Array(3*M),m=new Uint32Array(3*_);let u=0,d=0;return{add:(s,C,h)=>{e.eB.toArray(s,I,u),e.eB.toArray(C,I,u+3),e.eB.toArray(h,I,u+6),e.eB.triangleNormal(c,s,C,h);for(let a=0;a<3;++a)e.eB.toArray(c,l,u+3*a),m[d+a]=u/3+a;u+=9,d+=3},addQuad:(s,C,h,a)=>{e.eB.toArray(s,I,u),e.eB.toArray(C,I,u+3),e.eB.toArray(h,I,u+6),e.eB.toArray(a,I,u+9),e.eB.triangleNormal(c,s,C,h);for(let D=0;D<4;++D)e.eB.toArray(c,l,u+3*D);const S=u/3;m[d]=S,m[d+1]=S+1,m[d+2]=S+2,m[d+3]=S+2,m[d+4]=S+3,m[d+5]=S,u+=12,d+=6},getPrimitive:()=>({vertices:I,normals:l,indices:m})}}const v=(0,e.eB)(),O=(0,e.U)();function b(_,M){const{vertices:I,normals:l}=_,m=e.U.directionTransform(O,M);for(let u=0,d=I.length;u<d;u+=3)e.eB.transformMat4(v,e.eB.fromArray(v,I,u),M),e.eB.toArray(v,I,u),e.eB.transformMat3(v,e.eB.fromArray(v,l,u),m),e.eB.toArray(v,l,u);return _}},3220:(tn,Ue,n)=>{"use strict";n.d(Ue,{My:()=>b,SM:()=>s,VH:()=>h,jg:()=>u,r7:()=>l,uo:()=>M});var e=n(4369),o=n(6928),r=n(863);const t=(0,e.eB)(),A=(0,e.eB)(),y=(0,e.eB)(),c=(0,e.eB)(),i=(0,e.eB)(),v=(0,e.eB)(),O={height:1,topCap:!0,bottomCap:!0};function b(T,L){const w=T.length/3;if(w<3)throw new Error("need at least 3 points to build a prism");const{height:Q,topCap:G,bottomCap:V}={...O,...L};let U=2*w,N=4*w;const k=(G?1:0)+(V?1:0);3===w?(U+=k,N+=3*k):4===w?(U+=2*k,N+=4*k):(U+=k*w,N+=k*w*3);const H=(0,o.nT)(U,N),$=.5*Q;e.eB.set(t,0,0,-$),e.eB.set(A,0,0,$);for(let J=0;J<w;++J){const W=(J+1)%w;e.eB.set(y,T[3*J],T[3*J+1],-$),e.eB.set(c,T[3*W],T[3*W+1],-$),e.eB.set(i,T[3*W],T[3*W+1],$),e.eB.set(v,T[3*J],T[3*J+1],$),H.addQuad(y,c,i,v)}if(3===w)G&&(e.eB.set(y,T[0],T[1],-$),e.eB.set(c,T[3],T[4],-$),e.eB.set(i,T[6],T[7],-$),H.add(i,c,y)),V&&(e.eB.set(y,T[0],T[1],$),e.eB.set(c,T[3],T[4],$),e.eB.set(i,T[6],T[7],$),H.add(y,c,i));else if(4===w)G&&(e.eB.set(y,T[0],T[1],-$),e.eB.set(c,T[3],T[4],-$),e.eB.set(i,T[6],T[7],-$),e.eB.set(v,T[9],T[10],-$),H.addQuad(v,i,c,y)),V&&(e.eB.set(y,T[0],T[1],$),e.eB.set(c,T[3],T[4],$),e.eB.set(i,T[6],T[7],$),e.eB.set(v,T[9],T[10],$),H.addQuad(y,c,i,v));else for(let J=0;J<w;++J){const W=(J+1)%w;G&&(e.eB.set(y,T[3*J],T[3*J+1],-$),e.eB.set(c,T[3*W],T[3*W+1],-$),H.add(t,c,y)),V&&(e.eB.set(y,T[3*J],T[3*J+1],$),e.eB.set(c,T[3*W],T[3*W+1],$),H.add(y,c,A))}return H.getPrimitive()}let _,I,m,d,C;function M(){return _||(_=b((0,r.n)(4,!1))),_}function l(){return I||(I=b((0,r.n)(5,!1))),I}function u(){return m||(m=b((0,r.n)(6,!1))),m}function s(){return d||(d=b((0,r.n)(6,!0))),d}function h(){return C||(C=b((0,r.n)(7,!1))),C}},9132:(tn,Ue,n)=>{"use strict";n.d(Ue,{i:()=>s,J:()=>d});var e=n(4369),o=n(4559);const r={radius:1,detail:0};var y=n(6928),c=n(8937);const i=(1+Math.sqrt(5))/2,v=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],O=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];let _;(0,c.L3)(v,[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9]);const{vertices:m,indices:u}=function M(){return _||(_=(0,y.m9)(v,O)),_}();function d(C){return 10*Math.pow(Math.pow(2,C),2)+2}function s(C){return function t(C,h,a){const{radius:S,detail:D}={...r,...a},R=function A(){const C=[],h=[],a=new Map;function S(D){const R=`${D[0].toFixed(5)}|${D[1].toFixed(5)}|${D[2].toFixed(5)}`;let f=a.get(R);return void 0===f&&(f=C.length/3,a.set(R,f),C.push(...D)),f}return{vertices:C,indices:h,add:(D,R,f)=>{h.push(S(D),S(R),S(f))}}}(),{vertices:f,indices:p}=R;(function T(w){const Q=(0,e.eB)(),G=(0,e.eB)(),V=(0,e.eB)();for(let U=0;U<h.length;U+=3)e.eB.fromArray(Q,C,3*h[U+0]),e.eB.fromArray(G,C,3*h[U+1]),e.eB.fromArray(V,C,3*h[U+2]),L(Q,G,V,w)})(D),(0,o.lm)(f,S);const E=new Float32Array(f.length);return(0,o.xL)(f,p,E,f.length/3,p.length/3),{vertices:new Float32Array(f),normals:new Float32Array(E),indices:new Uint32Array(p)};function L(w,Q,G,V){const U=Math.pow(2,V),N=[];for(let k=0;k<=U;++k){N[k]=[];const H=(0,e.eB)();e.eB.lerp(H,w,G,k/U);const $=(0,e.eB)();e.eB.lerp($,Q,G,k/U);const J=U-k;for(let W=0;W<=J;++W)if(0===W&&k===U)N[k][W]=H;else{const te=(0,e.eB)();e.eB.lerp(te,H,$,W/J),N[k][W]=te}}for(let k=0;k<U;++k)for(let H=0;H<2*(U-k)-1;++H){const $=Math.floor(H/2);H%2==0?R.add(N[k][$+1],N[k+1][$],N[k][$]):R.add(N[k][$+1],N[k+1][$+1],N[k+1][$])}}}(m,u,{detail:C,radius:1})}},4559:(tn,Ue,n)=>{"use strict";n.d(Ue,{AA:()=>l,TL:()=>y,lm:()=>c,pi:()=>A,xL:()=>M});var e=n(4369),o=n(6115);const t=(0,e.eB)();function A(m,u,d,s){for(let C=0,h=3*s;C<h;C+=3)e.eB.fromArray(t,u,d+C),e.eB.transformMat4(t,t,m),e.eB.toArray(t,u,d+C)}function y(m,u,d,s){for(let C=0,h=3*s;C<h;C+=3)e.eB.fromArray(t,u,d+C),e.eB.transformMat3(t,t,m),e.eB.toArray(t,u,d+C)}function c(m,u){for(let d=0,s=m.length;d<s;d+=3)e.eB.fromArray(t,m,d),e.eB.normalize(t,t),e.eB.scale(t,t,u),e.eB.toArray(t,m,d)}const i=(0,e.eB)(),v=(0,e.eB)(),O=(0,e.eB)(),b=(0,e.eB)(),_=(0,e.eB)();function M(m,u,d,s,C){for(let h=0,a=3*C;h<a;h+=3){const S=3*u[h],D=3*u[h+1],R=3*u[h+2];e.eB.fromArray(i,m,S),e.eB.fromArray(v,m,D),e.eB.fromArray(O,m,R),e.eB.sub(b,O,v),e.eB.sub(_,i,v),e.eB.cross(b,b,_),d[S]+=b[0],d[S+1]+=b[1],d[S+2]+=b[2],d[D]+=b[0],d[D+1]+=b[1],d[D+2]+=b[2],d[R]+=b[0],d[R+1]+=b[1],d[R+2]+=b[2]}return function r(m,u){for(let d=0,s=3*u;d<s;d+=3){const C=m[d],h=m[d+1],a=m[d+2],S=1/Math.sqrt(C*C+h*h+a*a);m[d]=C*S,m[d+1]=h*S,m[d+2]=a*S}return m}(d,s)}function l(m,u,d=1){const s=(0,o._M)(m),C=new Int32Array(s+2),h=new Int32Array(u),a=new Int32Array(u);for(let R=0,f=u*d;R<f;R+=d)++a[m[R]];let S=0;for(let R=0;R<u;R++)C[R]=S,S+=a[R];C[u]=S;const D=new Int32Array(S);for(let R=0,f=u*d;R<f;R+=d){const p=m[R];D[C[p]+h[p]]=R,++h[p]}return{indices:D,offsets:C}}},1888:(tn,Ue,n)=>{"use strict";n.d(Ue,{ZC:()=>A,iQ:()=>r,tu:()=>t});var e=n(4369),o=n(364);function r(y,c,i,v,O=!1,b=(()=>!1),_){if(y%i!=0)throw new Error("incompatible groupCount and stride");const M={location:o.LU,location2:o.LU,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1};let I=M.groupIndex<y,l=!1,m=0,u=0,d=!1;const s=!!_;return{get hasNext(){return I},get isNextNewInstance(){return l},groupCount:y,instanceCount:c,count:y*c,stride:i,nonInstanceable:O,hasLocation2:s,move:()=>(I&&(M.groupIndex=m,M.instanceIndex=u,M.index=u*y+m,M.location=v(m,d?-1:u),s&&(M.location2=_(m,d?-1:u)),M.isSecondary=b(m,d?-1:u),m+=i,m===y?(++u,l=!0,u<c&&(m=0)):l=!1,I=m<y),M),reset(){M.location=o.LU,M.location2=o.LU,M.index=0,M.groupIndex=0,M.instanceIndex=0,M.isSecondary=!1,I=M.groupIndex<y,l=!1,m=0,u=0,d=!1},skipInstance(){I&&M.instanceIndex===u&&(++u,m=0,I=u<c)},voidInstances(){d=!0}}}function t(y,c){return{kind:"position-location",position:y?e.eB.clone(y):(0,e.eB)(),normal:c?e.eB.clone(c):(0,e.eB)()}}function A(y){return!!y&&"position-location"===y.kind}},6165:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>M,O:()=>_});var e=n(467),o=n(4824),r=n(7834),t=n(9909),A=n(8382),y=n(9283),c=n(5821);function O(m){return{...m,bottomLeft:(0,t.NT)(m.bottomLeft,[0,0,0]),topRight:(0,t.NT)(m.topRight,m.scalarField.space.dimensions)}}function b(m){return{dX:m.topRight[0]-m.bottomLeft[0],dY:m.topRight[1]-m.bottomLeft[1],dZ:m.topRight[2]-m.bottomLeft[2]}}function _(m,u){return o.YZ.create("Marching Cubes Mesh",function(){var d=(0,e.A)(function*(s){const C=O(m),{dX:h,dY:a,dZ:S}=b(C),R=function i(m,u){const d=Math.min(65536,4*m),s=A.Gm.create(Float32Array,3,m,u&&u.vertexBuffer.ref.value),C=A.Gm.create(Float32Array,3,m,u&&u.normalBuffer.ref.value),h=A.Gm.create(Float32Array,1,m,u&&u.groupBuffer.ref.value),a=A.Gm.create(Uint32Array,3,d,u&&u.indexBuffer.ref.value);let S=0,D=0;return{addVertex:(R,f,p)=>(++S,A.Gm.add3(s,R,f,p)),addNormal:(R,f,p)=>{A.Gm.add3(C,R,f,p)},addGroup:R=>{A.Gm.add(h,R)},addTriangle:(R,f,p,E)=>{const T=R[f],L=R[p],w=R[E];T>=0&&L>=0&&w>=0&&(++D,A.Gm.add3(a,T,L,w))},get:()=>{const R=A.Gm.compact(s,!0),f=A.Gm.compact(C,!0),p=A.Gm.compact(a,!0),E=A.Gm.compact(h,!0);return y.e.create(R,p,f,E,S,D,u)}}}(Math.min(262144,Math.max(h*a*S/32,1024)),u);return yield new I(s,R,C).run(),R.get()});return function(s){return d.apply(this,arguments)}}())}function M(m,u){return o.YZ.create("Marching Cubes Lines",function(){var d=(0,e.A)(function*(s){const C=O(m),{dX:h,dY:a,dZ:S}=b(C),R=function v(m,u){const d=A.Gm.create(Float32Array,3,m),s=A.Gm.create(Float32Array,1,m),C=A.Gm.create(Float32Array,2,m);let h=0;return{addVertex:(a,S,D)=>A.Gm.add3(d,a,S,D),addNormal:()=>t.lQ,addGroup:a=>{A.Gm.add(s,a)},addTriangle:(a,S,D,R,f)=>{a[S]>=0&&a[D]>=0&&a[R]>=0&&(r.my[S][D]&f&&(++h,A.Gm.add2(C,a[S],a[D])),r.my[D][R]&f&&(++h,A.Gm.add2(C,a[D],a[R])),r.my[S][R]&f&&(++h,A.Gm.add2(C,a[S],a[R])))},get:()=>{const a=A.Gm.compact(d,!0),S=A.Gm.compact(C,!0),D=A.Gm.compact(s,!0),R=c.d.create(h,h/10,u);for(let f=0;f<h;++f){const p=S[2*f],E=S[2*f+1];R.add(a[3*p],a[3*p+1],a[3*p+2],a[3*E],a[3*E+1],a[3*E+2],D[p])}return R.getLines()}}}(Math.min(262144,Math.max(h*a*S/32,1024)),u);return yield new I(s,R,C).run(),R.get()});return function(s){return d.apply(this,arguments)}}())}class I{doSlices(){var u=this;return(0,e.A)(function*(){let d=0;u.edgeFilter=15;for(let s=u.minZ;s<u.maxZ;s++,u.edgeFilter&=-5)u.slice(s),d+=u.sliceSize,u.ctx.shouldUpdate&&(yield u.ctx.update({message:"Computing surface...",current:d,max:u.size}))})()}slice(u){this.edgeFilter|=2;for(let d=this.minY;d<this.maxY;d++,this.edgeFilter&=-3){this.edgeFilter|=1;for(let s=this.minX;s<this.maxX;s++,this.edgeFilter&=-2)this.state.processCell(s,d,u,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(u)}run(){var u=this;return(0,e.A)(function*(){yield u.doSlices()})()}constructor(u,d,s){this.ctx=u,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new l(d,s),this.minX=s.bottomLeft[0],this.minY=s.bottomLeft[1],this.minZ=s.bottomLeft[2],this.maxX=s.topRight[0]-1,this.maxY=s.topRight[1]-1,this.maxZ=s.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}}class l{get3dOffsetFromEdgeInfo(u){return this.nX*((this.k+u.k)%2*this.nY+this.j+u.j)+this.i+u.i}clearEdgeVertexIndexSlice(u){this.verticesOnEdges.fill(0,u%2==0?0:3*this.nX*this.nY,u%2==0?3*this.nX*this.nY:this.verticesOnEdges.length)}interpolate(u){const d=r.Dn[u],s=3*this.get3dOffsetFromEdgeInfo(d)+d.e,C=this.verticesOnEdges[s];if(C>0)return C-1;const h=this.scalarField,a=this.scalarFieldGet,S=r.WH[u],D=S.a,R=S.b,f=D.i+this.i,p=D.j+this.j,E=D.k+this.k,T=R.i+this.i,L=R.j+this.j,w=R.k+this.k,Q=a(h,f,p,E),G=a(h,T,L,w),V=(this.isoLevel-Q)/(Q-G);if(this.idField){const j=this.idFieldGet(this.idField,f,p,E),Z=this.idFieldGet(this.idField,T,L,w);let q=V<.5?j:Z;if(-1===q&&(q=V<.5?Z:j),-2===q)return-1;this.builder.addGroup(q)}else this.builder.addGroup(0);const U=this.builder.addVertex(f+V*(f-T),p+V*(p-L),E+V*(E-w));this.verticesOnEdges[s]=U+1;const N=a(h,Math.max(0,f-1),p,E)-a(h,Math.min(this.nX-1,f+1),p,E),k=a(h,f,Math.max(0,p-1),E)-a(h,f,Math.min(this.nY-1,p+1),E),H=a(h,f,p,Math.max(0,E-1))-a(h,f,p,Math.min(this.nZ,E+1)),te=N+V*(N-(a(h,Math.max(0,T-1),L,w)-a(h,Math.min(this.nX-1,T+1),L,w))),de=k+V*(k-(a(h,T,Math.max(0,L-1),w)-a(h,T,Math.min(this.nY-1,L+1),w))),ye=H+V*(H-(a(h,T,L,Math.max(0,w-1))-a(h,T,L,Math.min(this.nZ-1,w+1))));return this.isoLevel>=0?this.builder.addNormal(te,de,ye):this.builder.addNormal(-te,-de,-ye),U}constructor(u,d){this.builder=u,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;const s=d.scalarField.space.dimensions;this.nX=s[0],this.nY=s[1],this.nZ=s[2],this.isoLevel=d.isoLevel,this.scalarFieldGet=d.scalarField.space.get,this.scalarField=d.scalarField.data,d.idField&&(this.idField=d.idField.data,this.idFieldGet=d.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get(u,d,s){return this.scalarFieldGet(this.scalarField,u,d,s)}processCell(u,d,s,C){let h=0;if(this.get(u,d,s)<this.isoLevel&&(h|=1),this.get(u+1,d,s)<this.isoLevel&&(h|=2),this.get(u+1,d+1,s)<this.isoLevel&&(h|=4),this.get(u,d+1,s)<this.isoLevel&&(h|=8),this.get(u,d,s+1)<this.isoLevel&&(h|=16),this.get(u+1,d,s+1)<this.isoLevel&&(h|=32),this.get(u+1,d+1,s+1)<this.isoLevel&&(h|=64),this.get(u,d+1,s+1)<this.isoLevel&&(h|=128),0===h||255===h)return;this.i=u,this.j=d,this.k=s;const a=r.IT[h];(1&a)>0&&(this.vertList[0]=this.interpolate(0)),(2&a)>0&&(this.vertList[1]=this.interpolate(1)),(4&a)>0&&(this.vertList[2]=this.interpolate(2)),(8&a)>0&&(this.vertList[3]=this.interpolate(3)),(16&a)>0&&(this.vertList[4]=this.interpolate(4)),(32&a)>0&&(this.vertList[5]=this.interpolate(5)),(64&a)>0&&(this.vertList[6]=this.interpolate(6)),(128&a)>0&&(this.vertList[7]=this.interpolate(7)),(256&a)>0&&(this.vertList[8]=this.interpolate(8)),(512&a)>0&&(this.vertList[9]=this.interpolate(9)),(1024&a)>0&&(this.vertList[10]=this.interpolate(10)),(2048&a)>0&&(this.vertList[11]=this.interpolate(11));const S=r.sE[h];for(let D=0;D<S.length;D+=3){const R=S[D],f=S[D+1],p=S[D+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,R,f,p,C):this.builder.addTriangle(this.vertList,p,f,R,C)}}}},7834:(tn,Ue,n)=>{"use strict";function e(_,M,I){return{i:_,j:M,k:I}}function o(_,M){return{a:_,b:M}}n.d(Ue,{Dn:()=>i,IT:()=>v,WH:()=>c,my:()=>b,sE:()=>O});const y=[e(0,0,0),e(1,0,0),e(1,1,0),e(0,1,0),e(0,0,1),e(1,0,1),e(1,1,1),e(0,1,1)],c=[o(y[0],y[1]),o(y[1],y[2]),o(y[2],y[3]),o(y[3],y[0]),o(y[4],y[5]),o(y[5],y[6]),o(y[6],y[7]),o(y[7],y[4]),o(y[0],y[4]),o(y[1],y[5]),o(y[2],y[6]),o(y[3],y[7])],i=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],v=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],O=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],b=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]]},8187:(tn,Ue,n)=>{"use strict";n.d(Ue,{_:()=>xe});var e=n(9421),o=n(4143),r=n(4511),t=n(2897),A=n(9909),y=n(9007),c=n(4951),i=n(9387);const v="\nprecision highp float;\nprecision highp int;\n\n#if __VERSION__ == 100\n    precision highp sampler2D;\n    uniform sampler2D tTexture;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tTexture;\n#endif\n\nvoid main(void) {\n    #if __VERSION__ == 100\n        gl_FragColor = texture2D(tTexture, vec2(0.5));\n    #else\n        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);\n    #endif\n}\n";var O=n(8437),b=n(2629);const _={...y.du,tTexture:(0,r.$G)("texture","rgba","float","nearest")},M="histopyramid-sum";const u=new Uint8Array(4),d=new Int32Array(4);var C=n(4490);const h="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInputLevel;\n\n// previous level used to evaluate the new level\n#if __VERSION__ == 100\n    uniform sampler2D tPreviousLevel;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tPreviousLevel;\n#endif\n\n// inverted size of the previous level texture.\nuniform float uSize;\nuniform float uTexSize;\nuniform bool uFirst;\n\n#include common\n\nvoid main(void) {\n    float k = 0.5 * uSize;\n    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;\n\n    #if __VERSION__ == 100\n        float a, b, c, d;\n\n        if (uFirst) {\n            a = texture2D(tInputLevel, position).r * 255.0;\n            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;\n            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;\n            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;\n        } else {\n            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);\n            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);\n            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);\n            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);\n        }\n        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);\n    #else\n        int a, b, c, d;\n\n        if (uFirst) {\n            a = int(texture2D(tInputLevel, position).r * 255.0);\n            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);\n            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);\n            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);\n        } else {\n            a = texture2D(tPreviousLevel, position).r;\n            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;\n            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;\n            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;\n        }\n        gl_FragColor = ivec4(a + b + c + d);\n    #endif\n}\n",a={...y.du,tInputLevel:(0,r.$G)("texture","rgba","float","nearest"),tPreviousLevel:(0,r.$G)("texture","rgba","float","nearest"),uSize:(0,r.w5)("f"),uTexSize:(0,r.w5)("f"),uFirst:(0,r.w5)("b")},S="histogram-pyramid";function f(le,Ae){const Be=Math.pow(2,Ae),Ce=`level${Ae}`,Re=le.isWebGL2?T(Ce,le,"image-int32","alpha","int","nearest"):T(Ce,le,"image-uint8","rgba","ubyte","nearest");Re.define(Be,Be);let ke=function L(le,Ae){return Ae.namedFramebuffers[`${S}-${le}`]}(Ce,le);return ke||(ke=E(Ce,le),Re.attachFramebuffer(ke,0)),{texture:Re,framebuffer:ke}}function E(le,Ae){const Be=`${S}-${le}`;return Ae.namedFramebuffers[Be]||(Ae.namedFramebuffers[Be]=Ae.resources.framebuffer()),Ae.namedFramebuffers[Be]}function T(le,Ae,Be,Ce,Re,ke){const we=`${S}-${le}`;return Ae.namedTextures[we]||(Ae.namedTextures[we]=Ae.resources.texture(Be,Ce,Re,ke)),Ae.namedTextures[we]}function w(le,Ae,Be,Ce){b.g$&&le.timer.mark("createHistogramPyramid");const{gl:Re,state:ke}=le,we=Ae.getWidth();if(we!==Ae.getHeight()||!(0,C.r6)(we))throw new Error("inputTexture must be of square power-of-two size");const Se=Math.ceil(Math.log(we)/Math.log(2)),Ve=Math.pow(2,Se),Ne=Math.pow(2,Se),K=Math.pow(2,Se-1),ne=le.isWebGL2?T("pyramid",le,"image-int32","alpha","int","nearest"):T("pyramid",le,"image-uint8","rgba","ubyte","nearest");ne.define(Ne,K);const be=E("pyramid",le);ne.attachFramebuffer(be,0),ke.viewport(0,0,Ne,K),(0,O.C6)(Re)?Re.clearBufferiv(Re.COLOR,0,[0,0,0,0]):Re.clear(Re.COLOR_BUFFER_BIT);const Te=[];for(let ce=0;ce<Se;++ce)Te.push(f(le,ce));const ie=function D(le,Ae,Be){if(le.namedComputeRenderables[S]){const Ce=le.namedComputeRenderables[S].values;A.IQ.update(Ce.tInputLevel,Ae),A.IQ.update(Ce.tPreviousLevel,Be),le.namedComputeRenderables[S].update()}else le.namedComputeRenderables[S]=function R(le,Ae,Be){const Ce={...y.OM,tInputLevel:A.IQ.create(Ae),tPreviousLevel:A.IQ.create(Be),uSize:A.IQ.create(0),uTexSize:A.IQ.create(0),uFirst:A.IQ.create(!0)},Re={...a},ke=(0,t.NG)("reduction",i.e,h,{},{0:"ivec4"}),we=(0,o.$h)(le,"triangles",ke,Re,Ce);return(0,e._)(we,Ce)}(le,Ae,Be);return le.namedComputeRenderables[S]}(le,Ae,Te[0].texture);ke.currentRenderItemId=-1,function p(le){const{gl:Ae,state:Be}=le;Be.disable(Ae.CULL_FACE),Be.disable(Ae.BLEND),Be.disable(Ae.DEPTH_TEST),Be.enable(Ae.SCISSOR_TEST),Be.depthMask(!1),Be.colorMask(!0,!0,!0,!0),Be.clearColor(0,0,0,0)}(le);let ue=0;for(let ce=0;ce<Se;ce++){const se=Se-1-ce;Te[se].framebuffer.bind();const ge=Math.pow(2,se);A.IQ.update(ie.values.uSize,Math.pow(2,ce+1)/Ve),A.IQ.update(ie.values.uTexSize,ge),A.IQ.updateIfChanged(ie.values.uFirst,0===ce),ce>0&&(A.IQ.update(ie.values.tPreviousLevel,Te[Se-ce].texture),ie.update()),ke.currentRenderItemId=-1,ke.viewport(0,0,ge,ge),ke.scissor(0,0,ge,ge),(0,O.C6)(Re)?Re.clearBufferiv(Re.COLOR,0,[0,0,0,0]):Re.clear(Re.COLOR_BUFFER_BIT),ke.scissor(0,0,Ce[0],Ce[1]),ie.render(),ne.bind(0),Re.copyTexSubImage2D(Re.TEXTURE_2D,0,ue,0,0,0,ge,ge),ne.unbind(0),ue+=ge}Re.finish(),b.g$&&le.timer.markEnd("createHistogramPyramid");const re=Math.max(1,function s(le,Ae){b.g$&&le.timer.mark("getHistopyramidSum");const{gl:Be,state:Ce,resources:Re}=le,ke=function I(le,Ae){return le.namedComputeRenderables[M]?(A.IQ.update(le.namedComputeRenderables[M].values.tTexture,Ae),le.namedComputeRenderables[M].update()):le.namedComputeRenderables[M]=function l(le,Ae){const Be={...y.OM,tTexture:A.IQ.create(Ae)},Ce={..._},Re=(0,t.NG)("sum",i.e,v,{},{0:"ivec4"}),ke=(0,o.$h)(le,"triangles",Re,Ce,Be);return(0,e._)(ke,Be)}(le,Ae),le.namedComputeRenderables[M]}(le,Ae);le.state.currentRenderItemId=-1,le.namedFramebuffers[M]||(le.namedFramebuffers[M]=Re.framebuffer());const we=le.namedFramebuffers[M];return le.namedTextures[M]||(le.namedTextures[M]=(0,O.C6)(Be)?Re.texture("image-int32","rgba","int","nearest"):Re.texture("image-uint8","rgba","ubyte","nearest"),le.namedTextures[M].define(1,1)),le.namedTextures[M].attachFramebuffer(we,0),function m(le){const{gl:Ae,state:Be}=le;Be.disable(Ae.CULL_FACE),Be.disable(Ae.BLEND),Be.disable(Ae.DEPTH_TEST),Be.disable(Ae.SCISSOR_TEST),Be.depthMask(!1),Be.colorMask(!0,!0,!0,!0),Be.clearColor(0,0,0,0)}(le),Ce.viewport(0,0,1,1),ke.render(),Be.finish(),le.readPixels(0,0,1,1,(0,O.C6)(Be)?d:u),le.unbindFramebuffer(),b.g$&&le.timer.markEnd("getHistopyramidSum"),(0,O.C6)(Be)?d[0]:(0,c.OK)(u[0],u[1],u[2])}(le,Te[0].texture));return{pyramidTex:ne,count:re,height:Math.ceil(re/Math.pow(2,Se)),levels:Se,scale:Be}}var Q=n(7834),G=n(3784);let V,N;function U(){if(void 0!==V)return V;V=(0,G.xg)(256,1,Uint8Array);const{array:le}=V;for(let Ae=0,Be=Q.sE.length;Ae<Be;++Ae)le[Ae]=Q.sE[Ae].length/3;return V}function k(){if(void 0!==N)return N;N=(0,G.xg)(4096,1,Uint8Array);const{array:le}=N;for(let Ae=0,Be=Q.sE.length;Ae<Be;++Ae)for(let Ce=0;Ce<16;++Ce)le[16*Ae+Ce]=Ce<Q.sE[Ae].length?Q.sE[Ae][Ce]:255;return N}const H="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#if __VERSION__ == 100\n    uniform sampler2D tActiveVoxelsPyramid;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tActiveVoxelsPyramid;\n#endif\n\nuniform sampler2D tActiveVoxelsBase;\nuniform sampler2D tVolumeData;\nuniform sampler2D tTriIndices;\n\nuniform float uIsoValue;\nuniform float uLevels;\nuniform float uSize;\nuniform float uCount;\nuniform bool uInvert;\n\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform mat4 uGridTransform;\n\n// scale to volume data coord\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord + 0.5 / (texDim / uScale));\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvec4 voxelPadded(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nint idot2(const in ivec2 a, const in ivec2 b) {\n    return a.x * b.x + a.y * b.y;\n}\n\nint idot4(const in ivec4 a, const in ivec4 b) {\n    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n}\n\n#if __VERSION__ == 100\n    int pyramidVoxel(vec2 pos) {\n        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));\n    }\n#else\n    int pyramidVoxel(vec2 pos) {\n        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;\n    }\n#endif\n\nvec4 baseVoxel(vec2 pos) {\n    return texture2D(tActiveVoxelsBase, pos / uSize);\n}\n\nvec4 getGroup(const in vec3 p) {\n    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding\n    // note that we swap x and z because the texture is flipped around y\n    #if defined(dAxisOrder_012)\n        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210\n    #elif defined(dAxisOrder_021)\n        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120\n    #elif defined(dAxisOrder_102)\n        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201\n    #elif defined(dAxisOrder_120)\n        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021\n    #elif defined(dAxisOrder_201)\n        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102\n    #elif defined(dAxisOrder_210)\n        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012\n    #endif\n    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);\n}\n\nvoid main(void) {\n    // get 1D index\n    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);\n\n    // ignore 1D indices outside of the grid\n    if(vI >= int(uCount)) discard;\n\n    ivec2 offset = ivec2(int(uSize) - 2, 0);\n\n    int start = 0;\n    ivec4 starts = ivec4(0);\n    ivec4 ends = ivec4(0);\n    int diff = 2;\n    ivec4 m = ivec4(0);\n    ivec2 position = ivec2(0);\n    ivec4 vI4 = ivec4(vI);\n\n    ivec2 relativePosition = ivec2(0);\n    int end = 0;\n    ivec2 pos1 = ivec2(0);\n    ivec2 pos2 = ivec2(0);\n    ivec2 pos3 = ivec2(0);\n    ivec2 pos4 = ivec2(0);\n    ivec3 vI3 = ivec3(vI);\n    ivec3 mask = ivec3(0);\n\n    // traverse the different levels of the pyramid\n    for(int i = 1; i < 14; i++) {\n        if(float(i) >= uLevels) break;\n\n        offset.x -= diff;\n        diff *= 2;\n        relativePosition = position + offset;\n\n        end = start + pyramidVoxel(vec2(relativePosition));\n        pos1 = ivec2(relativePosition);\n        starts.x = start;\n        ends.x = end;\n        pos2 = ivec2(relativePosition + ivec2(1, 0));\n        starts.y = ends.x;\n        ends.y = ends.x + pyramidVoxel(vec2(pos2));\n        pos3 = relativePosition + ivec2(0, 1);\n        starts.z = ends.y;\n        ends.z = ends.y + pyramidVoxel(vec2(pos3));\n        pos4 = relativePosition + ivec2(1, 1);\n        starts.w = ends.z;\n        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n        m = ivec4(mask, 1 - int(any(bvec3(mask))));\n\n        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n        start = idot4(m, starts);\n        position = 2 * (relativePosition - offset);\n    }\n\n    end = start + int(baseVoxel(vec2(position)).r * 255.0);\n    pos1 = position;\n    starts.x = start;\n    ends.x = end;\n    pos2 = position + ivec2(1, 0);\n    starts.y = ends.x;\n    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);\n    pos3 = position + ivec2(0, 1);\n    starts.z = ends.y;\n    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);\n    pos4 = position + ivec2(1, 1);\n    starts.w = ends.z;\n    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n    m = ivec4(mask, 1 - int(any(bvec3(mask))));\n    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n\n    vec2 coord2d = (vec2(position) / uSize) / uScale;\n    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);\n\n    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);\n\n    // current vertex for the up to 15 MC cases\n    int currentVertex = vI - idot4(m, starts);\n\n    // ensure winding-order is the same for negative and positive iso-levels\n    if (uInvert) {\n        int v = imod(currentVertex + 1, 3);\n        if (v == 1) currentVertex += 2;\n        else if (v == 0) currentVertex -= 2;\n    }\n\n    // get index into triIndices table\n    int mcIndex = 16 * int(edgeIndex) + currentVertex;\n    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);\n\n    // bit mask to avoid conditionals (see comment below) for getting MC case corner\n    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));\n\n    // get edge value masks\n    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));\n    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));\n    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));\n\n    // apply bit masks\n    vec3 b0 = coord3d +\n                m1.y * c1 +\n                m1.z * c2 +\n                m1.w * c3 +\n                m2.x * c4 +\n                m2.y * c5 +\n                m2.z * c6 +\n                m2.w * c7 +\n                m3.y * c1 +\n                m3.z * c2 +\n                m3.w * c3;\n    vec3 b1 = coord3d +\n                m1.x * c1 +\n                m1.y * c2 +\n                m1.z * c3 +\n                m2.x * c5 +\n                m2.y * c6 +\n                m2.z * c7 +\n                m2.w * c4 +\n                m3.x * c4 +\n                m3.y * c5 +\n                m3.z * c6 +\n                m3.w * c7;\n\n    // the conditionals that are avoided by above bitmasks\n    // vec3 b0 = coord3d;\n    // vec3 b1 = coord3d;\n    // if (mcIndex == 0.0) {\n    //     b1 += c1;\n    // } else if (mcIndex == 1.0) {\n    //     b0 += c1; b1 += c2;\n    // } else if (mcIndex == 2.0) {\n    //     b0 += c2; b1 += c3;\n    // } else if (mcIndex == 3.0) {\n    //     b0 += c3;\n    // } else if (mcIndex == 4.0) {\n    //     b0 += c4; b1 += c5;\n    // } else if (mcIndex == 5.0) {\n    //     b0 += c5; b1 += c6;\n    // } else if (mcIndex == 6.0) {\n    //     b0 += c6; b1 += c7;\n    // } else if (mcIndex == 7.0) {\n    //     b0 += c7; b1 += c4;\n    // } else if (mcIndex == 8.0) {\n    //     b1 += c4;\n    // } else if (mcIndex == 9.0) {\n    //     b0 += c1; b1 += c5;\n    // } else if (mcIndex == 10.0) {\n    //     b0 += c2; b1 += c6;\n    // } else if (mcIndex == 11.0) {\n    //     b0 += c3; b1 += c7;\n    // }\n    // b0 = floor(b0 + 0.5);\n    // b1 = floor(b1 + 0.5);\n\n    vec4 d0 = voxel(b0);\n    vec4 d1 = voxel(b1);\n\n    float v0 = d0.a;\n    float v1 = d1.a;\n\n    float t = (uIsoValue - v0) / (v0 - v1);\n    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;\n\n    // group id\n    #if __VERSION__ == 100 || defined(dConstantGroup)\n        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)\n        // ensure a constant group id per triangle as needed\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(coord3d);\n        #endif\n    #else\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);\n        #endif\n    #endif\n\n    // normals from gradients\n    vec3 n0 = -normalize(vec3(\n        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,\n        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,\n        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a\n    ));\n    vec3 n1 = -normalize(vec3(\n        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,\n        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,\n        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a\n    ));\n    gl_FragData[2].xyz = -vec3(\n        n0.x + t * (n0.x - n1.x),\n        n0.y + t * (n0.y - n1.y),\n        n0.z + t * (n0.z - n1.z)\n    );\n\n    // ensure normal-direction is the same for negative and positive iso-levels\n    if (uInvert) {\n        gl_FragData[2].xyz *= -1.0;\n    }\n\n    // apply normal matrix\n    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));\n}\n",$="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tTriCount;\nuniform sampler2D tVolumeData;\n\nuniform float uIsoValue;\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord);\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvoid main(void) {\n    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;\n    vec3 posXYZ = index3dFrom2d(uv);\n\n    // get MC case as the sum of corners that are below the given iso level\n    float c = step(voxel(posXYZ).a, uIsoValue)\n        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)\n        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)\n        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)\n        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)\n        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)\n        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)\n        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);\n    c *= step(c, 254.);\n\n    // handle out of bounds positions\n    posXYZ += 1.0;\n    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)\n    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)\n        c = 0.0;\n\n    // get total triangles to generate for calculated MC case from triCount texture\n    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;\n    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);\n}\n",J={...y.du,tTriCount:(0,r.$G)("image-uint8","alpha","ubyte","nearest"),tVolumeData:(0,r.$G)("texture","rgba","ubyte","nearest"),uIsoValue:(0,r.w5)("f"),uGridDim:(0,r.w5)("v3"),uGridTexDim:(0,r.w5)("v3"),uScale:(0,r.w5)("v2")},W="active-voxels";const Z={...y.du,tTriIndices:(0,r.$G)("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:(0,r.$G)("texture","rgba","float","nearest"),tActiveVoxelsBase:(0,r.$G)("texture","rgba","float","nearest"),tVolumeData:(0,r.$G)("texture","rgba","ubyte","nearest"),uIsoValue:(0,r.w5)("f"),uSize:(0,r.w5)("f"),uLevels:(0,r.w5)("f"),uCount:(0,r.w5)("f"),uInvert:(0,r.w5)("b"),uGridDim:(0,r.w5)("v3"),uGridTexDim:(0,r.w5)("v3"),uGridTransform:(0,r.w5)("m4"),uScale:(0,r.w5)("v2"),dPackedGroup:(0,r.$F)("boolean"),dAxisOrder:(0,r.$F)("string",["012","021","102","120","201","210"]),dConstantGroup:(0,r.$F)("boolean")},q="isosurface";function xe(le,Ae,Be,Ce,Re,ke,we,Oe,Se,Ve,Ne,K,ne,be){b.g$&&le.timer.mark("extractIsosurface");const Te=function j(le,Ae,Be,Ce,Re,ke){b.g$&&le.timer.mark("calcActiveVoxels");const{gl:we,state:Oe,resources:Se}=le,Ve=Ae.getWidth(),Ne=Ae.getHeight();le.namedFramebuffers[W]||(le.namedFramebuffers[W]=Se.framebuffer());const K=le.namedFramebuffers[W];K.bind(),le.namedTextures[W]||(le.namedTextures[W]=Se.texture("image-uint8","rgba","ubyte","nearest"));const ne=le.namedTextures[W];ne.define(Ve,Ne);const be=function te(le,Ae,Be,Ce,Re,ke){if(le.namedComputeRenderables[W]){const we=le.namedComputeRenderables[W].values;A.IQ.update(we.uQuadScale,ke),A.IQ.update(we.tVolumeData,Ae),A.IQ.updateIfChanged(we.uIsoValue,Re),A.IQ.update(we.uGridDim,Be),A.IQ.update(we.uGridTexDim,Ce),A.IQ.update(we.uScale,ke),le.namedComputeRenderables[W].update()}else le.namedComputeRenderables[W]=function de(le,Ae,Be,Ce,Re,ke){const we={...y.OM,tTriCount:A.IQ.create(U()),uQuadScale:A.IQ.create(ke),tVolumeData:A.IQ.create(Ae),uIsoValue:A.IQ.create(Re),uGridDim:A.IQ.create(Be),uGridTexDim:A.IQ.create(Ce),uScale:A.IQ.create(ke)},Oe={...J},Se=(0,t.NG)("active-voxels",i.e,$),Ve=(0,o.$h)(le,"triangles",Se,Oe,we);return(0,e._)(Ve,we)}(le,Ae,Be,Ce,Re,ke);return le.namedComputeRenderables[W]}(le,Ae,Be,Ce,Re,ke);return le.state.currentRenderItemId=-1,ne.attachFramebuffer(K,0),function ye(le){const{gl:Ae,state:Be}=le;Be.disable(Ae.CULL_FACE),Be.disable(Ae.BLEND),Be.disable(Ae.DEPTH_TEST),Be.enable(Ae.SCISSOR_TEST),Be.depthMask(!1),Be.colorMask(!0,!0,!0,!0),Be.clearColor(0,0,0,0)}(le),Oe.viewport(0,0,Ve,Ne),Oe.scissor(0,0,Ve,Ne),we.clear(we.COLOR_BUFFER_BIT),Oe.scissor(0,0,Ce[0],Ce[1]),be.render(),we.finish(),b.g$&&le.timer.markEnd("calcActiveVoxels"),ne}(le,Ae,Be,Ce,we,Re),ue=function _e(le,Ae,Be,Ce,Re,ke,we,Oe,Se,Ve,Ne,K,ne,be,Te){const{drawBuffers:ie}=le.extensions;if(!ie)throw new Error("need WebGL draw buffers");b.g$&&le.timer.mark("createIsosurfaceBuffers");const{gl:ue,state:re,resources:ve,extensions:ce}=le,{pyramidTex:se,height:ae,levels:ge,scale:Ie,count:Le}=Ce,nt=se.getWidth();le.namedFramebuffers[q]||(le.namedFramebuffers[q]=ve.framebuffer());const je=le.namedFramebuffers[q];(0,O.C6)(ue)?(ne||(ne=ve.texture("image-float32","rgba","float","nearest")),be||(be=ve.texture("image-uint8","rgba","ubyte","nearest")),Te||(Te=ce.colorBufferHalfFloat&&ce.textureHalfFloat?ve.texture("image-float16","rgba","fp16","nearest"):ve.texture("image-float32","rgba","float","nearest"))):(ne||(ne=ve.texture("image-float32","rgba","float","nearest")),be||(be=ve.texture("image-float32","rgba","float","nearest")),Te||(Te=ve.texture("image-float32","rgba","float","nearest"))),ne.define(nt,ae),be.define(nt,ae),Te.define(nt,ae),ne.attachFramebuffer(je,0),be.attachFramebuffer(je,1),Te.attachFramebuffer(je,2);const Lt=function Y(le,Ae,Be,Ce,Re,ke,we,Oe,Se,Ve,Ne,K,ne,be,Te){if(le.namedComputeRenderables[q]){const ie=le.namedComputeRenderables[q].values;A.IQ.update(ie.tActiveVoxelsPyramid,Ae),A.IQ.update(ie.tActiveVoxelsBase,Be),A.IQ.update(ie.tVolumeData,Ce),A.IQ.updateIfChanged(ie.uIsoValue,Oe),A.IQ.updateIfChanged(ie.uSize,Math.pow(2,Se)),A.IQ.updateIfChanged(ie.uLevels,Se),A.IQ.updateIfChanged(ie.uCount,Ne),A.IQ.updateIfChanged(ie.uInvert,K),A.IQ.update(ie.uGridDim,Re),A.IQ.update(ie.uGridTexDim,ke),A.IQ.update(ie.uGridTransform,we),A.IQ.update(ie.uScale,Ve),A.IQ.updateIfChanged(ie.dPackedGroup,ne),A.IQ.updateIfChanged(ie.dAxisOrder,be.join("")),A.IQ.updateIfChanged(ie.dConstantGroup,Te),le.namedComputeRenderables[q].update()}else le.namedComputeRenderables[q]=function ee(le,Ae,Be,Ce,Re,ke,we,Oe,Se,Ve,Ne,K,ne,be,Te){const ie={...y.OM,tTriIndices:A.IQ.create(k()),tActiveVoxelsPyramid:A.IQ.create(Ae),tActiveVoxelsBase:A.IQ.create(Be),tVolumeData:A.IQ.create(Ce),uIsoValue:A.IQ.create(Oe),uSize:A.IQ.create(Math.pow(2,Se)),uLevels:A.IQ.create(Se),uCount:A.IQ.create(Ne),uInvert:A.IQ.create(K),uGridDim:A.IQ.create(Re),uGridTexDim:A.IQ.create(ke),uGridTransform:A.IQ.create(we),uScale:A.IQ.create(Ve),dPackedGroup:A.IQ.create(ne),dAxisOrder:A.IQ.create(be.join("")),dConstantGroup:A.IQ.create(Te)},ue={...Z},re=(0,t.NG)("isosurface",i.e,H,{drawBuffers:"required"}),ve=(0,o.$h)(le,"triangles",re,ue,ie);return(0,e._)(ve,ie)}(le,Ae,Be,Ce,Re,ke,we,Oe,Se,Ve,Ne,K,ne,be,Te);return le.namedComputeRenderables[q]}(le,se,Ae,Be,Re,ke,we,Oe,ge,Ie,Le,Se,Ve,Ne,K);return le.state.currentRenderItemId=-1,je.bind(),ie.drawBuffers([ie.COLOR_ATTACHMENT0,ie.COLOR_ATTACHMENT1,ie.COLOR_ATTACHMENT2]),function g(le){const{gl:Ae,state:Be}=le;Be.disable(Ae.CULL_FACE),Be.disable(Ae.BLEND),Be.disable(Ae.DEPTH_TEST),Be.disable(Ae.SCISSOR_TEST),Be.depthMask(!1),Be.colorMask(!0,!0,!0,!0),Be.clearColor(0,0,0,0)}(le),re.viewport(0,0,nt,ae),ue.clear(ue.COLOR_BUFFER_BIT),Lt.render(),ue.finish(),b.g$&&le.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:ne,groupTexture:be,normalTexture:Te,vertexCount:Le}}(le,Te,Ae,w(le,Te,Re,Ce),Be,Ce,ke,we,Oe,Se,Ve,Ne,K,ne,be);return b.g$&&le.timer.markEnd("extractIsosurface"),ue}},9007:(tn,Ue,n)=>{"use strict";n.d(Ue,{Wp:()=>O,du:()=>b,OM:()=>_,_0:()=>l}),n(4648);var o=n(9909),r=n(4511),t=n(4369),A=n(2897),c=n(9387),i=n(4143),v=n(9421);const O=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),b={drawCount:(0,r.Xb)("number"),instanceCount:(0,r.Xb)("number"),aPosition:(0,r.Yz)("float32",2,0),uQuadScale:(0,r.w5)("v2")},_={drawCount:o.IQ.create(6),instanceCount:o.IQ.create(1),aPosition:o.IQ.create(O),uQuadScale:o.IQ.create(t.ZY.create(1,1))},M={...b,tColor:(0,r.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,r.w5)("v2")},I=(0,A.NG)("copy",c.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords);\n}\n");function l(a,S){const D={..._,tColor:o.IQ.create(S),uTexSize:o.IQ.create(t.ZY.create(S.getWidth(),S.getHeight()))},R={...M},f=(0,i.$h)(a,"triangles",I,R,D);return(0,v._)(f,D)}},8353:(tn,Ue,n)=>{"use strict";n.d(Ue,{o:()=>E,R2:()=>T,Q0:()=>p});var e=n(7778),o=n(9421),r=n(4143),t=n(4511),A=n(2897),y=n(9909);const c={...t.DQ,aPosition:(0,t.Yz)("float32",3,0),elements:(0,t.Xs)("uint32"),uBboxMin:(0,t.w5)("v3"),uBboxMax:(0,t.w5)("v3"),uBboxSize:(0,t.w5)("v3"),uMaxSteps:(0,t.w5)("i"),uStepScale:(0,t.w5)("f"),uJumpLength:(0,t.w5)("f"),uTransform:(0,t.w5)("m4"),uGridDim:(0,t.w5)("v3"),tTransferTex:(0,t.$G)("image-uint8","alpha","ubyte","linear"),uTransferScale:(0,t.w5)("f","material"),dGridTexType:(0,t.$F)("string",["2d","3d"]),uGridTexDim:(0,t.w5)("v3"),tGridTex:(0,t.$G)("texture","rgba","ubyte","linear"),uGridStats:(0,t.w5)("v4"),uCellDim:(0,t.w5)("v3"),uCartnToUnit:(0,t.w5)("m4"),uUnitToCartn:(0,t.w5)("m4"),dPackedGroup:(0,t.$F)("boolean"),dAxisOrder:(0,t.$F)("string",["012","021","102","120","201","210"]),dIgnoreLight:(0,t.$F)("boolean"),dXrayShaded:(0,t.$F)("string",["off","on","inverted"])},v={...t.DQ,aGroup:(0,t.Yz)("float32",1,0),aPosition:(0,t.Yz)("float32",3,0),aNormal:(0,t.Yz)("float32",3,0),elements:(0,t.Xs)("uint32"),dVaryingGroup:(0,t.$F)("boolean"),dFlatShaded:(0,t.$F)("boolean"),uDoubleSided:(0,t.w5)("b","material"),dFlipSided:(0,t.$F)("boolean"),dIgnoreLight:(0,t.$F)("boolean"),dXrayShaded:(0,t.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,t.$F)("string",["off","on","opaque"]),uBumpFrequency:(0,t.w5)("f","material"),uBumpAmplitude:(0,t.w5)("f","material"),meta:(0,t.Xb)("unknown")},b={...t.DQ,...t.Hw,aGroup:(0,t.Yz)("float32",1,0),aPosition:(0,t.Yz)("float32",3,0),dPointSizeAttenuation:(0,t.$F)("boolean"),dPointStyle:(0,t.$F)("string",["square","circle","fuzzy"])},M={...t.DQ,...t.Hw,aGroup:(0,t.Yz)("float32",1,0),aMapping:(0,t.Yz)("float32",2,0),aStart:(0,t.Yz)("float32",3,0),aEnd:(0,t.Yz)("float32",3,0),elements:(0,t.Xs)("uint32"),dLineSizeAttenuation:(0,t.$F)("boolean"),uDoubleSided:(0,t.w5)("b","material"),dFlipSided:(0,t.$F)("boolean")},l={...t.DQ,...t.Hw,uTexDim:(0,t.w5)("v2"),tPositionGroup:(0,t.$G)("image-float32","rgba","float","nearest"),padding:(0,t.Xb)("number"),uDoubleSided:(0,t.w5)("b","material"),dIgnoreLight:(0,t.$F)("boolean"),dXrayShaded:(0,t.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,t.$F)("string",["off","on","opaque"]),dSolidInterior:(0,t.$F)("boolean"),dClipPrimitive:(0,t.$F)("boolean"),dApproximate:(0,t.$F)("boolean"),uAlphaThickness:(0,t.w5)("f"),uBumpFrequency:(0,t.w5)("f","material"),uBumpAmplitude:(0,t.w5)("f","material"),lodLevels:(0,t.Xb)("unknown"),centerBuffer:(0,t.Xb)("float32"),groupBuffer:(0,t.Xb)("float32")},u={...t.DQ,...t.Hw,aGroup:(0,t.Yz)("float32",1,0),aPosition:(0,t.Yz)("float32",3,0),aMapping:(0,t.Yz)("float32",2,0),aDepth:(0,t.Yz)("float32",1,0),elements:(0,t.Xs)("uint32"),aTexCoord:(0,t.Yz)("float32",2,0),tFont:(0,t.$G)("image-uint8","alpha","ubyte","linear"),padding:(0,t.Xb)("number"),uBorderWidth:(0,t.w5)("f","material"),uBorderColor:(0,t.w5)("v3","material"),uOffsetX:(0,t.w5)("f","material"),uOffsetY:(0,t.w5)("f","material"),uOffsetZ:(0,t.w5)("f","material"),uBackgroundColor:(0,t.w5)("v3","material"),uBackgroundOpacity:(0,t.w5)("f","material")},s={...t.DQ,uGeoTexDim:(0,t.w5)("v2","buffered"),tPosition:(0,t.$G)("texture","rgb","float","nearest"),tGroup:(0,t.$G)("texture","alpha","float","nearest"),tNormal:(0,t.$G)("texture","rgb","float","nearest"),dVaryingGroup:(0,t.$F)("boolean"),dFlatShaded:(0,t.$F)("boolean"),uDoubleSided:(0,t.w5)("b","material"),dFlipSided:(0,t.$F)("boolean"),dIgnoreLight:(0,t.$F)("boolean"),dXrayShaded:(0,t.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,t.$F)("string",["off","on","opaque"]),uBumpFrequency:(0,t.w5)("f","material"),uBumpAmplitude:(0,t.w5)("f","material"),meta:(0,t.Xb)("unknown")};var h=n(7135);const a={...t.DQ,aGroup:(0,t.Yz)("float32",1,0),aPosition:(0,t.Yz)("float32",3,0),aUv:(0,t.Yz)("float32",2,0),elements:(0,t.Xs)("uint32"),uImageTexDim:(0,t.w5)("v2"),tImageTex:(0,t.$G)("image-uint8","rgba","ubyte","nearest"),tGroupTex:(0,t.$G)("image-uint8","rgba","ubyte","nearest"),dInterpolation:(0,t.$F)("string",h.Bd)},D={...t.DQ,...t.Hw,aGroup:(0,t.Yz)("float32",1,0),aStart:(0,t.Yz)("float32",3,0),aEnd:(0,t.Yz)("float32",3,0),aMapping:(0,t.Yz)("float32",3,0),aScale:(0,t.Yz)("float32",1,0),aCap:(0,t.Yz)("float32",1,0),aColorMode:(0,t.Yz)("float32",1,0),elements:(0,t.Xs)("uint32"),padding:(0,t.Xb)("number"),uDoubleSided:(0,t.w5)("b","material"),dIgnoreLight:(0,t.$F)("boolean"),dXrayShaded:(0,t.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,t.$F)("string",["off","on","opaque"]),dSolidInterior:(0,t.$F)("boolean"),uBumpFrequency:(0,t.w5)("f","material"),uBumpAmplitude:(0,t.w5)("f","material"),dDualColor:(0,t.$F)("boolean")},f=(0,e.q)(0,2147483647),p=(0,e.q)(0,2147483647);function E(L,w,Q,G){return{id:f(),type:L,values:w,state:Q,materialId:G}}function T(L,w,Q){switch(w.type){case"mesh":return function O(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...v},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.uO,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"points":return function _(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...b},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"points",A.g2,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"spheres":return function m(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...l},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.n5,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"cylinders":return function R(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...D},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.UT,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"text":return function d(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...u},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.G7,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"lines":return function I(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...M},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.wv,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"direct-volume":return function i(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...c};L.isWebGL2||(N.uMaxSteps=(0,t.$F)("number"));const k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.m5,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"image":return function S(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...a},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.u3,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q);case"texture-mesh":return function C(L,w,Q,G,V,U){const N={...t.X9,...t.YU,...t.rG,...s},k={uObjectId:y.IQ.create(w)},$=(0,r.vC)(L,"triangles",A.uO,N,{...Q,...k},V,U);return(0,o.R)($,Q,G)}(L,w.id,w.values,w.state,w.materialId,Q)}throw new Error("unsupported type")}},9421:(tn,Ue,n)=>{"use strict";n.d(Ue,{R:()=>I,_:()=>l});var e=n(9909),o=n(7778),r=n(127),t=n(9137),A=n(9457),y=n(5384),c=n(8599),i=n(2629);const v=A.i.distanceToPoint,O=t.Q.intersectsSphere3D,b=y.f8.fromArray,_=(0,o.q)();function M(m,u){return u&&u.instanceCounts.length>=m?u:{firsts:new Int32Array(m),counts:new Int32Array(m),offsets:new Int32Array(m),instanceCounts:new Int32Array(m),baseVertices:new Int32Array(m),baseInstances:new Uint32Array(m),count:0,uniforms:[]}}function I(m,u,d){const s=_();let C=M(0);const h=[];let a=!1,S=-1;const D=(0,y.f8)(),R=()=>{var f;const p=null===(f=u.lodLevels)||void 0===f?void 0:f.ref.value;if(p&&p.length>0){const{cellCount:E}=u.instanceGrid.ref.value;h.length=p.length;for(let T=0,L=p.length;T<L;++T)h[T]=M(E,h[T]),h[T].count=0;if(u.lodLevels.ref.version!==S){for(let T=0,L=p.length;T<L;++T)1!==h[T].uniforms.length&&(h[T].uniforms.length=1,h[T].uniforms[0]=["uLod",e.IQ.create((0,c.Z)())]),e.IQ.update(h[T].uniforms[0][1],c.Z.set(h[T].uniforms[0][1].ref.value,p[T][0],p[T][1],p[T][2],p[T][4]));S=u.lodLevels.ref.version}}};return R(),{id:s,materialId:m.materialId,values:u,state:d,cull:(f,p,E,T)=>{var L,w;if(a=!1,0===u.drawCount.ref.value||0===u.instanceCount.ref.value||u.instanceGrid.ref.value.cellSize<=1)return;const{cellOffsets:Q,cellSpheres:G,cellCount:V,batchOffsets:U,batchSpheres:N,batchCount:k,batchCell:H,batchSize:$}=u.instanceGrid.ref.value,[J,W]=u.uLod.ref.value,te=0!==J||0!==W,de=2*$,ye=null===(L=u.lodLevels)||void 0===L?void 0:L.ref.value;if(ye&&ye.length>0){if((null===(w=u.lodLevels)||void 0===w?void 0:w.ref.version)!==S)R();else for(let j=0,Z=ye.length;j<Z;++j)h[j].count=0;for(let j=0;j<k;++j){const Z=U[j],q=U[j+1];if(q-Z==0)continue;b(D,N,4*j);const ee=v(f,D.center);if(te&&(ee+D.radius<J||ee-D.radius>W))i.g$&&(T.culled.lod+=Q[H[q-1]+1]-Q[H[Z]]);else if(O(p,D))if(null!==E&&E(D))i.g$&&(T.culled.occlusion+=Q[H[q-1]+1]-Q[H[Z]]);else for(let g=Z;g<q;++g){const _e=H[g],xe=Q[_e],Ae=Q[_e+1]-xe;if(0===Ae)continue;b(D,G,4*_e);const Be=v(f,D.center);if(te&&(Be+D.radius<J||Be-D.radius>W))i.g$&&(T.culled.lod+=Ae);else if(O(p,D))if(null!==E&&Be-D.radius<de&&E(D))i.g$&&(T.culled.occlusion+=Ae);else for(let Ce=0,Re=ye.length;Ce<Re;++Ce){if(Be+D.radius<ye[Ce][0]||Be-D.radius>ye[Ce][1])continue;const ke=h[Ce],we=ke.count;we>0&&ke.baseInstances[we-1]+ke.instanceCounts[we-1]===xe&&ke.counts[we-1]===ye[Ce][3]?ke.instanceCounts[we-1]+=Ae:(ke.counts[we]=ye[Ce][3],ke.instanceCounts[we]=Ae,ke.baseInstances[we]=xe,ke.count+=1)}else i.g$&&(T.culled.frustum+=Ae)}else i.g$&&(T.culled.frustum+=Q[H[q-1]+1]-Q[H[Z]])}}else{C=M(V,C);const{baseInstances:j,instanceCounts:Z,counts:q}=C;let Y=0;for(let ee=0;ee<k;++ee){const g=U[ee],_e=U[ee+1];if(_e-g!=0){if(b(D,N,4*ee),te){const le=v(f,D.center);if(le+D.radius<J||le-D.radius>W){i.g$&&(T.culled.lod+=Q[H[_e-1]+1]-Q[H[g]]);continue}}if(!O(p,D)){i.g$&&(T.culled.frustum+=Q[H[_e-1]+1]-Q[H[g]]);continue}if(null!==E&&E(D)){i.g$&&(T.culled.occlusion+=Q[H[_e-1]+1]-Q[H[g]]);continue}for(let le=g;le<_e;++le){const Ae=H[le],Be=Q[Ae],Re=Q[Ae+1]-Be;if(0===Re)continue;b(D,G,4*Ae);const ke=v(f,D.center);te&&(ke+D.radius<J||ke-D.radius>W)?i.g$&&(T.culled.lod+=Re):O(p,D)?null!==E&&ke-D.radius<de&&E(D)?i.g$&&(T.culled.occlusion+=Re):Y>0&&j[Y-1]+Z[Y-1]===Be?Z[Y-1]+=Re:(q[Y]=u.drawCount.ref.value,Z[Y]=Re,j[Y]=Be,Y+=1):i.g$&&(T.culled.frustum+=Re)}}}C.count=Y,h.length=1,h[0]=C,h[0].uniforms.length=0}a=!0},uncull:()=>{a=!1},render:(f,p)=>{u.uAlpha&&u.alpha&&e.IQ.updateIfChanged(u.uAlpha,(0,r.qE)(u.alpha.ref.value*d.alphaFactor,0,1)),m.render(f,p,a?h:void 0)},getProgram:f=>m.getProgram(f),setTransparency:f=>m.setTransparency(f),update:()=>{m.update(),R()},dispose:()=>m.destroy()}}function l(m,u){return{id:_(),values:u,render:()=>m.render("compute",0),update:()=>m.update(),dispose:()=>m.destroy()}}},4511:(tn,Ue,n)=>{"use strict";function e(h,a){const S={},D={},R={},f={},p={},E={},T={};return Object.keys(h).forEach(L=>{const w=h[L];"attribute"===w.type&&(S[L]=a[L]),"define"===w.type&&(D[L]=a[L]),"texture"===w.type&&void 0!==a[L]&&("material"===w.variant?f[L]=a[L]:R[L]=a[L]),"uniform"===w.type&&void 0!==a[L]&&("material"===w.variant?E[L]=a[L]:"buffered"===w.variant?T[L]=a[L]:p[L]=a[L])}),{attributeValues:S,defineValues:D,textureValues:R,materialTextureValues:f,uniformValues:p,materialUniformValues:E,bufferedUniformValues:T}}function o(h){const a={};return Object.keys(h).forEach(S=>{a[S]=h[S].ref.version}),a}function r(h,a,S){return{type:"attribute",kind:h,itemSize:a,divisor:S}}function t(h,a){return{type:"uniform",kind:h,variant:a}}function A(h,a,S,D,R){return{type:"texture",kind:h,format:a,dataType:S,filter:D,variant:R}}function y(h){return{type:"elements",kind:h}}function c(h,a){return{type:"define",kind:h,options:a}}function i(h){return{type:"value",kind:h}}n.d(Ue,{$F:()=>c,$G:()=>A,DQ:()=>C,Hw:()=>M,X9:()=>v,Xb:()=>i,Xs:()=>y,YU:()=>O,Yz:()=>r,fb:()=>o,rG:()=>b,tC:()=>e,w5:()=>t});const v={uDrawId:t("i"),uModel:t("m4"),uView:t("m4"),uInvView:t("m4"),uModelView:t("m4"),uInvModelView:t("m4"),uProjection:t("m4"),uInvProjection:t("m4"),uModelViewProjection:t("m4"),uInvModelViewProjection:t("m4"),uIsOrtho:t("f"),uPixelRatio:t("f"),uViewport:t("v4"),uViewOffset:t("v2"),uDrawingBufferSize:t("v2"),uCameraPosition:t("v3"),uCameraDir:t("v3"),uCameraPlane:t("v4"),uNear:t("f"),uFar:t("f"),uFog:t("b"),uFogNear:t("f"),uFogFar:t("f"),uFogColor:t("v3"),uTransparentBackground:t("b"),uLightDirection:t("v3[]"),uLightColor:t("v3[]"),uAmbientColor:t("v3"),uPickingAlphaThreshold:t("f"),uInteriorDarkening:t("f"),uInteriorColorFlag:t("b"),uInteriorColor:t("v3"),uHighlightColor:t("v3"),uSelectColor:t("v3"),uDimColor:t("v3"),uHighlightStrength:t("f"),uSelectStrength:t("f"),uDimStrength:t("f"),uMarkerPriority:t("i"),uMarkerAverage:t("f"),uXrayEdgeFalloff:t("f"),uExposure:t("f"),uRenderMask:t("i"),uMarkingDepthTest:t("b"),uMarkingType:t("i"),uPickType:t("i")},O={tDepth:A("texture","depth","ushort","nearest"),tDpoitDepth:A("texture","rg","float","nearest"),tDpoitFrontColor:A("texture","rgba","float","nearest"),tDpoitBackColor:A("texture","rgba","float","nearest")},b={uObjectId:t("i")},_={uColor:t("v3","material"),uColorTexDim:t("v2"),uColorGridDim:t("v3"),uColorGridTransform:t("v4"),tColor:A("image-uint8","rgb","ubyte","nearest"),tPalette:A("image-uint8","rgb","ubyte","nearest"),tColorGrid:A("texture","rgb","ubyte","linear"),dColorType:c("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:c("boolean")},M={uSize:t("f","material"),uSizeTexDim:t("v2"),tSize:A("image-uint8","rgb","ubyte","nearest"),dSizeType:c("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:t("f","material")},I={uMarker:t("f"),uMarkerTexDim:t("v2"),tMarker:A("image-uint8","alpha","ubyte","nearest"),markerAverage:i("number"),markerStatus:i("number"),dMarkerType:c("string",["instance","groupInstance"])},l={uOverpaintTexDim:t("v2"),tOverpaint:A("image-uint8","rgba","ubyte","nearest"),dOverpaint:c("boolean"),uOverpaintGridDim:t("v3"),uOverpaintGridTransform:t("v4"),tOverpaintGrid:A("texture","rgba","ubyte","linear"),dOverpaintType:c("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:t("f","material")},m={uTransparencyTexDim:t("v2"),tTransparency:A("image-uint8","alpha","ubyte","nearest"),dTransparency:c("boolean"),transparencyAverage:i("number"),uTransparencyGridDim:t("v3"),uTransparencyGridTransform:t("v4"),tTransparencyGrid:A("texture","alpha","ubyte","linear"),dTransparencyType:c("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:t("f","material")},u={uEmissiveTexDim:t("v2"),tEmissive:A("image-uint8","alpha","ubyte","nearest"),dEmissive:c("boolean"),emissiveAverage:i("number"),uEmissiveGridDim:t("v3"),uEmissiveGridTransform:t("v4"),tEmissiveGrid:A("texture","alpha","ubyte","linear"),dEmissiveType:c("string",["instance","groupInstance","volumeInstance"]),uEmissiveStrength:t("f","material")},d={uSubstanceTexDim:t("v2"),tSubstance:A("image-uint8","rgba","ubyte","nearest"),dSubstance:c("boolean"),uSubstanceGridDim:t("v3"),uSubstanceGridTransform:t("v4"),tSubstanceGrid:A("texture","rgba","ubyte","linear"),dSubstanceType:c("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:t("f","material")},s={uClippingTexDim:t("v2"),tClipping:A("image-uint8","alpha","ubyte","nearest"),dClipping:c("boolean"),dClippingType:c("string",["instance","groupInstance"])},C={dGeometryType:c("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"]),..._,...I,...l,...m,...u,...d,...s,dLightCount:c("number"),dColorMarker:c("boolean"),dClipObjectCount:c("number"),dClipVariant:c("string",["instance","pixel"]),uClipObjectType:t("i[]","material"),uClipObjectInvert:t("b[]","material"),uClipObjectPosition:t("v3[]","material"),uClipObjectRotation:t("v4[]","material"),uClipObjectScale:t("v3[]","material"),aInstance:r("float32",1,1),aTransform:r("float32",16,1),uAlpha:t("f","material"),uMetalness:t("f","material"),uRoughness:t("f","material"),uBumpiness:t("f","material"),uEmissive:t("f","material"),uVertexCount:t("i"),uInstanceCount:t("i"),uGroupCount:t("i"),uInvariantBoundingSphere:t("v4"),uLod:t("v4"),drawCount:i("number"),instanceCount:i("number"),alpha:i("number"),matrix:i("m4"),transform:i("float32"),extraTransform:i("float32"),hasReflection:i("boolean"),instanceGranularity:i("boolean"),boundingSphere:i("sphere"),invariantBoundingSphere:i("sphere"),instanceGrid:i("instanceGrid")}},3784:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ax:()=>h,sL:()=>s,xg:()=>i});var e=n(5384),o=n(4369),r=n(7136);n(6115);const A=o.eB.fromArray,y=o.eB.transformMat4Offset;function i(S,D,R,f){const{length:p,width:E,height:T}=function c(S,D){S=Math.max(S,2);const R=Math.sqrt(S);let f=Math.ceil(R);f+=(D-f%D)%D;const p=f>0?Math.ceil(S/f):0;return{width:f,height:p,length:f*p*D}}(S,D);return{array:f=f&&f.length>=p?f:new R(p),width:E,height:T}}const l=(0,o.eB)(),m=new r.Z("14"),u=new r.Z("98");function d(S){return S>1e5?m:u}function s(S,D,R){const f=3*R,p=d(D);p.reset();for(let T=0,L=3*D;T<L;T+=f)A(l,S,T),p.includePosition(l);p.finishedIncludeStep();for(let T=0,L=3*D;T<L;T+=f)A(l,S,T),p.radiusPosition(l);const E=p.getSphere();if(D<=14){const T=[];for(let L=0,w=3*D;L<w;L+=f)T.push(A((0,o.eB)(),S,L));e.f8.setExtrema(E,T)}return E}const C=(0,o.$I)();function h(S,D,R,f){if(1===R){o.$I.fromArray(C,D,f);const w=e.f8.clone(S);return o.$I.isIdentity(C)?w:e.f8.transform(w,w,C)}const p=d(R);p.reset();const{center:E,radius:T,extrema:L}=S;if(L&&R<=14){for(let w=0,Q=R;w<Q;++w)for(const G of L)y(l,G,D,0,0,16*w+f),p.includePosition(l);p.finishedIncludeStep();for(let w=0,Q=R;w<Q;++w)for(const G of L)y(l,G,D,0,0,16*w+f),p.radiusPosition(l)}else{for(let w=0,Q=R;w<Q;++w)y(l,E,D,0,0,16*w+f),p.includePositionRadius(l,T);p.finishedIncludeStep();for(let w=0,Q=R;w<Q;++w)y(l,E,D,0,0,16*w+f),p.radiusPositionRadius(l,T)}return p.getSphere()}},4536:(tn,Ue,n)=>{"use strict";n.d(Ue,{Z:()=>l});var r,e=n(8353),o=n(4369);!function(m){m.create=function u(){return{view:o.$I.identity(),position:o.eB.create(0,0,0),direction:o.eB.create(0,0,-1),up:o.eB.create(0,1,0)}};const d=o.eB.zero();m.update=function s(C){o.eB.add(d,C.position,C.direction),o.$I.lookAt(C.view,C.position,d,C.up)}}(r||(r={}));var t=n(8184),A=n(9677);class y{constructor(){this.removeList=(0,A.wl)(),this.removeMap=new Map,this.addList=(0,A.wl)(),this.addMap=new Map}get isEmpty(){return 0===this.removeList.count&&0===this.addList.count}get size(){return this.removeMap.size+this.addMap.size}add(u){if(this.removeMap.has(u)){const s=this.removeMap.get(u);this.removeMap.delete(u),this.removeList.remove(s)}if(this.addMap.has(u))return;const d=this.addList.addLast(u);this.addMap.set(u,d)}remove(u){if(this.addMap.has(u)){const s=this.addMap.get(u);this.addMap.delete(u),this.addList.remove(s)}if(this.removeMap.has(u))return;const d=this.removeList.addLast(u);this.removeMap.set(u,d)}tryGetRemove(){const u=this.removeList.removeFirst();return u&&this.removeMap.delete(u),u}tryGetAdd(){const u=this.addList.removeFirst();return u&&this.addMap.delete(u),u}}var c=n(9854),i=n(6115),v=n(7136),O=n(8382),b=n(127);const _=new v.Z("98");function M(m,u,d){_.reset();for(let s=0,C=m.length;s<C;++s){if(d&&!m[s].state.visible)continue;const h=m[s].values.boundingSphere.ref.value;h.radius&&_.includeSphere(h)}_.finishedIncludeStep();for(let s=0,C=m.length;s<C;++s){if(d&&!m[s].state.visible)continue;const h=m[s].values.boundingSphere.ref.value;h.radius&&_.radiusSphere(h)}return _.getSphere(u)}function I(m,u){const d=m.getProgram("color").id,s=u.getProgram("color").id,C=m.materialId,h=u.materialId;return d!==s?d-s:C!==h?C-h:m.id-u.id}var l;(l||(l={})).create=function u(d,s="blended"){const C=new Map,h=[],a=(0,t.f)(),S=(0,t.f)(),D=[],R=[];let f=!0,p=!0,E=!0,T=!0,L=!0,w=!0,Q=0,G=0,V=0,U=!1;const N=r.create(),{view:k,position:H,direction:$,up:J}=N;function W(le){if(C.has(le))console.warn(`RenderObject with id '${le.id}' already present`);else{const Ae=(0,e.R2)(d,le,s);h.push(Ae),"direct-volume"===le.type?R.push(Ae):D.push(Ae),C.set(le,Ae),f=!0,p=!0}}function te(le){const Ae=C.get(le);Ae&&(Ae.dispose(),(0,i.K3)(h,Ae),(0,i.K3)(D,Ae),(0,i.K3)(R,Ae),C.delete(le),f=!0,p=!0)}const j=new y;let Z=-1;function Y(){const le=function q(){let le=23;for(let Ae=0,Be=h.length;Ae<Be;++Ae)h[Ae].state.visible&&(le=31*le+h[Ae].id|0);return le=(0,O.C_)(le),-1===le&&(le=0),le}();return le!==Z&&(p=!0,E=!0,T=!0,L=!0,w=!0,Z=le,!0)}return{view:k,position:H,direction:$,up:J,renderables:h,primitives:{view:k,position:H,direction:$,up:J,renderables:D},volumes:{view:k,position:H,direction:$,up:J,renderables:R},syncVisibility:Y,setTransparency:le=>{s=le;for(let Ae=0,Be=h.length;Ae<Be;++Ae)h[Ae].setTransparency(le)},update(le,Ae){var Be;if(r.update(N),le)for(let Ce=0,Re=le.length;Ce<Re;++Ce)null===(Be=C.get(le[Ce]))||void 0===Be||Be.update();else for(let Ce=0,Re=h.length;Ce<Re;++Ce)h[Ce].update();Ae?Y():(f=!0,p=!0),E=!0,T=!0,L=!0,w=!0},add:le=>j.add(le),remove:le=>j.remove(le),commit:(le=Number.MAX_VALUE)=>function ye(le){const Ae=(0,c.t)();let Be=0;for(;;){const Ce=j.tryGetRemove();if(!Ce)break;if(te(Ce),++Be%100==0&&(0,c.t)()-Ae>le)return!1}for(;;){const Ce=j.tryGetAdd();if(!Ce)break;if(W(Ce),++Be%100==0&&(0,c.t)()-Ae>le)return!1}return h.sort(I),E=!0,T=!0,L=!0,w=!0,!0}(le),get commitQueueSize(){return j.size},get needsCommit(){return!j.isEmpty},has:le=>C.has(le),clear:()=>{for(let le=0,Ae=h.length;le<Ae;++le)h[le].dispose();h.length=0,D.length=0,R.length=0,C.clear(),f=!0,p=!0},forEach:le=>{C.forEach(le)},get count(){return h.length},get boundingSphere(){return f&&(M(h,a,!1),f=!1),a},get boundingSphereVisible(){return p&&(M(h,S,!0),p=!1),S},get markerAverage(){return E&&(Q=function ee(){if(0===D.length)return 0;let le=0,Ae=0;for(let Be=0,Ce=D.length;Be<Ce;++Be)D[Be].state.visible&&(Ae+=D[Be].values.markerAverage.ref.value,le+=1);return le>0?Ae/le:0}(),E=!1),Q},get emissiveAverage(){return T&&(G=function g(){if(0===D.length)return 0;let le=0,Ae=0;for(let Be=0,Ce=D.length;Be<Ce;++Be)D[Be].state.visible&&(Ae+=D[Be].values.emissiveAverage.ref.value+D[Be].values.uEmissive.ref.value,le+=1);return le>0?Ae/le:0}(),T=!1),G},get opacityAverage(){return L&&(V=function _e(){var le,Ae;if(0===D.length)return 0;let Be=0,Ce=0;for(let Re=0,ke=D.length;Re<ke;++Re){const we=D[Re];if(!we.state.visible)continue;const Oe=(0,b.qE)(we.values.alpha.ref.value*we.state.alphaFactor,0,1),Se=null!==(le=we.values.dXrayShaded)&&void 0!==le&&le.ref.value?.5:1,Ve="fuzzy"===(null===(Ae=we.values.dPointStyle)||void 0===Ae?void 0:Ae.ref.value)?.5:1;Ce+=(1-we.values.transparencyAverage.ref.value)*Oe*Se*Ve*("text"===we.values.dGeometryType.ref.value?.5:1),Be+=1}return Be>0?Ce/Be:0}(),L=!1),V},get hasOpaque(){return w&&(U=function xe(){var le;if(0===D.length)return!1;for(let Ae=0,Be=D.length;Ae<Be;++Ae){const Ce=D[Ae];if(Ce.state.visible&&(Ce.state.opaque||1===Ce.state.alphaFactor&&1===Ce.values.alpha.ref.value&&1!==Ce.values.transparencyAverage.ref.value||"opaque"===(null===(le=Ce.values.dTransparentBackfaces)||void 0===le?void 0:le.ref.value)))return!0}return!1}(),w=!1),U}}}},2897:(tn,Ue,n)=>{"use strict";n.d(Ue,{UT:()=>ve,m5:()=>ge,u3:()=>Ie,wv:()=>se,uO:()=>ae,g2:()=>ue,NG:()=>be,n5:()=>re,G7:()=>ce,NB:()=>$e});var e=n(7778),o=n(8437),r=n(1372);const Ae=(0,e.q)(),Be={apply_fog:"\nfloat preFogAlpha = gl_FragColor.a;\nif (uFog) {\n    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (!uTransparentBackground) {\n        if (gl_FragColor.a < 1.0) {\n            // transparent objects are blended with background color\n            gl_FragColor.a = fogAlpha;\n        } else {\n            // mix opaque objects with background color\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n        }\n    } else {\n        #if defined(dRenderVariant_colorDpoit)\n            if (gl_FragColor.a < 1.0) {\n                // transparent objects are blended with background color\n                gl_FragColor.a = fogAlpha;\n            } else {\n                // opaque objects need to be pre-multiplied alpha\n                gl_FragColor.rgb *= fogAlpha;\n                gl_FragColor.a = fogAlpha;\n            }\n        #else\n            // pre-multiplied alpha expected for transparent background\n            gl_FragColor.rgb *= fogAlpha;\n            gl_FragColor.a = fogAlpha;\n        #endif\n    }\n}\n",apply_interior_color:"\nif (interior) {\n    if (uInteriorColorFlag) {\n        gl_FragColor.rgb = uInteriorColor;\n    } else {\n        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;\n    }\n\n    #ifdef dTransparentBackfaces_opaque\n        gl_FragColor.a = 1.0;\n    #endif\n}\n",apply_light_color:"\n#if defined(dIgnoreLight)\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;\n            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;\n        }\n    #endif\n\n    #if defined(dRenderVariant_color)\n        material.rgb += material.rgb * emissive;\n    #endif\n\n    gl_FragColor = material;\n#else\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);\n        }\n    #endif\n\n    vec4 color = material;\n\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n    PhysicalMaterial physicalMaterial;\n    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);\n    #ifdef enabledFragDepth\n        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);\n    #else\n        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));\n        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);\n    #endif\n    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);\n    physicalMaterial.specularF90 = 1.0;\n\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = normalize(vViewPosition);\n\n    IncidentLight directLight;\n    #pragma unroll_loop_start\n    for (int i = 0; i < dLightCount; ++i) {\n        directLight.direction = uLightDirection[i];\n        directLight.color = uLightColor[i] * PI; // * PI for punctual light\n        RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);\n    }\n    #pragma unroll_loop_end\n\n    vec3 irradiance = uAmbientColor * PI; // * PI for punctual light\n    RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);\n\n    // indirect specular only metals\n    vec3 radiance = uAmbientColor * metalness;\n    vec3 iblIrradiance = uAmbientColor * metalness;\n    vec3 clearcoatRadiance = vec3(0.0);\n    RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background\n\n    #if defined(dRenderVariant_color)\n        outgoingLight += color.rgb * emissive;\n    #endif\n\n    gl_FragColor = vec4(outgoingLight, color.a);\n#endif\n\n#if defined(dXrayShaded_on)\n    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#elif defined(dXrayShaded_inverted)\n    gl_FragColor.a *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#endif\n\ngl_FragColor.rgb *= uExposure;\n",apply_marker_color:"\n\n#if defined(dColorMarker)\n    if (marker > 0.0) {\n        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering\n        } else {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering\n        }\n    } else if (uMarkerAverage > 0.0) {\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);\n        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering\n    }\n#endif\n",assign_clipping_varying:"\n#if dClipObjectCount != 0 && defined(dClipping)\n    #if defined(dClippingType_instance)\n        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;\n    #endif\n#endif\n",assign_color_varying:"\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_attribute)\n        vColor.rgb = aColor;\n    #elif defined(dColorType_instance)\n        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n    #elif defined(dColorType_group)\n        #if defined(dDualColor)\n            vec4 color2;\n            if (aColorMode == 2.0) {\n                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n            } else {\n                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;\n                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;\n            }\n        #else\n            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #endif\n    #elif defined(dColorType_groupInstance)\n        #if defined(dDualColor)\n            vec4 color2;\n            if (aColorMode == 2.0) {\n                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n            } else {\n                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;\n                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;\n            }\n        #else\n            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #endif\n    #elif defined(dColorType_vertex)\n        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_vertexInstance)\n        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_volume)\n        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #elif defined(dColorType_volumeInstance)\n        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #endif\n\n    #ifdef dUsePalette\n        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);\n        #elif defined(dOverpaintType_groupInstance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);\n        #elif defined(dOverpaintType_vertexInstance)\n            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);\n        #elif defined(dOverpaintType_volumeInstance)\n            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;\n            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);\n        #endif\n\n        // pre-mix to avoid darkening due to empty overpaint\n        #ifdef dColorType_uniform\n            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #else\n            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #endif\n        vOverpaint *= uOverpaintStrength;\n    #endif\n\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance)\n            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_groupInstance)\n            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_vertexInstance)\n            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + VertexID, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_volumeInstance)\n            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;\n            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;\n        #endif\n        vEmissive *= uEmissiveStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance)\n            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);\n        #elif defined(dSubstanceType_groupInstance)\n            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);\n        #elif defined(dSubstanceType_vertexInstance)\n            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);\n        #elif defined(dSubstanceType_volumeInstance)\n            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;\n            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);\n        #endif\n\n        // pre-mix to avoid artifacts due to empty substance\n        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);\n        vSubstance *= uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance)\n            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_groupInstance)\n            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_vertexInstance)\n            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + VertexID, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_volumeInstance)\n            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;\n            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;\n        #endif\n        vEmissive *= uEmissiveStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #ifdef requiredDrawBuffers\n        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        vInstance = vec4(packIntToRGB(aInstance), 1.0);\n        vGroup = vec4(packIntToRGB(group), 1.0);\n    #else\n        if (uPickType == 1) {\n            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        } else if (uPickType == 2) {\n            vColor = vec4(packIntToRGB(aInstance), 1.0);\n        } else {\n            vColor = vec4(packIntToRGB(group), 1.0);\n        }\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance)\n        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_groupInstance)\n        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_vertexInstance)\n        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_volumeInstance)\n        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;\n        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;\n    #endif\n    vTransparency *= uTransparencyStrength;\n#endif\n",assign_group:"\n#ifdef dGeometryType_textureMesh\n    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);\n#else\n    float group = aGroup;\n#endif\n",assign_marker_varying:"\n#if defined(dNeedsMarker)\n    #if defined(dMarkerType_instance)\n        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n    #endif\n#endif\n",assign_material_color:"\n#if defined(dNeedsMarker)\n    float marker = uMarker;\n    if (uMarker == -1.0) {\n        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    }\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dUsePalette)\n        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);\n    #elif defined(dColorType_uniform)\n        vec4 material = vec4(uColor, uAlpha);\n    #elif defined(dColorType_varying)\n        vec4 material = vec4(vColor.rgb, uAlpha);\n    #endif\n\n    // mix material with overpaint\n    #if defined(dOverpaint)\n        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);\n    #endif\n\n    float emissive = uEmissive;\n    #ifdef dEmissive\n        emissive += vEmissive;\n    #endif\n\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float bumpiness = uBumpiness;\n    #ifdef dSubstance\n        float sf = clamp(vSubstance.a, 0.0, 0.99); // clamp to avoid artifacts\n        metalness = mix(metalness, vSubstance.r, sf);\n        roughness = mix(roughness, vSubstance.g, sf);\n        bumpiness = mix(bumpiness, vSubstance.b, sf);\n    #endif\n#elif defined(dRenderVariant_depth)\n    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n        discard;\n    }\n\n    #ifndef dXrayShaded\n        #if defined(dTransparency)\n            float dta = 1.0 - vTransparency;\n            if (vTransparency < 0.2) dta = 1.0; // hard cutoff looks better\n\n            if (uRenderMask == MaskTransparent && uAlpha * dta == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha * dta < 1.0) {\n                discard;\n            }\n        #else\n            if (uRenderMask == MaskTransparent && uAlpha == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha < 1.0) {\n                discard;\n            }\n        #endif\n    #else\n        if (uRenderMask == MaskOpaque) {\n            discard;\n        }\n    #endif\n\n    vec4 material = packDepthToRGBA(fragmentDepth);\n#elif defined(dRenderVariant_marking)\n    vec4 material;\n    if(uMarkingType == 1) {\n        if (marker > 0.0)\n            discard;\n        #ifdef enabledFragDepth\n            material = packDepthToRGBA(gl_FragDepthEXT);\n        #else\n            material = packDepthToRGBA(gl_FragCoord.z);\n        #endif\n    } else {\n        if (marker == 0.0)\n            discard;\n        float depthTest = 1.0;\n        if (uMarkingDepthTest) {\n            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n        }\n        bool isHighlight = intMod(marker, 2.0) > 0.1;\n        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n        if (fogFactor == 1.0)\n            discard;\n        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);\n    }\n#elif defined(dRenderVariant_emissive)\n    float emissive = uEmissive;\n    #ifdef dEmissive\n        emissive += vEmissive;\n    #endif\n    vec4 material = vec4(emissive);\n#endif\n\n// apply per-group transparency\n#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive))\n    float ta = 1.0 - vTransparency;\n    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better\n\n    #if defined(dRenderVariant_pick)\n        if (ta * uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n    #elif defined(dRenderVariant_emissive)\n        if (ta < 1.0)\n            discard; // emissive not supported with transparency\n    #elif defined(dRenderVariant_color)\n        material.a *= ta;\n    #endif\n#endif\n",assign_position:"\nmat4 model = uModel * aTransform;\nmat4 modelView = uView * model;\n#ifdef dGeometryType_textureMesh\n    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;\n#else\n    vec3 position = aPosition;\n#endif\nvec4 position4 = vec4(position, 1.0);\n// for accessing tColorGrid in vert shader and for clipping in frag shader\nvModelPosition = (model * position4).xyz;\nvec4 mvPosition = modelView * position4;\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n",assign_size:"\n#if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);\n#elif defined(dSizeType_group)\n    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);\n#elif defined(dSizeType_groupInstance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size /= 100.0; // NOTE factor also set in TypeScript\n#endif\n\nsize *= uSizeFactor;\n",check_picking_alpha:"\nfloat viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\nfloat fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\nfloat alpha = (1.0 - fogFactor) * uAlpha;\n// if not opaque enough ignore so the element below can be picked\nif (uAlpha < uPickingAlphaThreshold || alpha < 0.1) {\n    #ifdef dTransparentBackfaces_opaque\n        if (!interior) discard;\n    #else\n        discard;\n    #endif\n}\n",check_transparency:"\n#if defined(dRenderVariant_color)\n    #if defined(dTransparentBackfaces_off)\n        if (interior && material.a < 1.0) discard;\n    #elif defined(dTransparentBackfaces_opaque)\n        if (interior) material.a = 1.0;\n    #endif\n\n    #if !defined(dXrayShaded_on) && !defined(dXrayShaded_inverted)\n        if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n            (uRenderMask == MaskTransparent && material.a == 1.0)\n        ) {\n            discard;\n        }\n    #endif\n#endif\n",clip_instance:"\n#if defined(dClipVariant_instance) && dClipObjectCount != 0\n    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);\n    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w)))\n        // move out of [ -w, +w ] to 'discard' in vert shader\n        gl_Position.z = 2.0 * gl_Position.w;\n#endif\n",clip_pixel:"\n#if defined(dClipVariant_pixel) && dClipObjectCount != 0\n    if (clipTest(vec4(vModelPosition, 0.0)))\n        discard;\n#endif\n",color_frag_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n#ifdef bumpEnabled\n    uniform float uBumpFrequency;\n    uniform float uBumpAmplitude;\n#endif\nuniform float uEmissive;\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_varying)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        uniform sampler2D tPalette;\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        varying vec4 vOverpaint;\n    #endif\n\n    #ifdef dEmissive\n        varying float vEmissive;\n    #endif\n\n    #ifdef dSubstance\n        varying vec4 vSubstance;\n    #endif\n#elif defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        varying float vEmissive;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat in vec4 vObject;\n            flat in vec4 vInstance;\n            flat in vec4 vGroup;\n        #else\n            flat in vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    varying float vTransparency;\n#endif\n",color_vert_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_attribute)\n        varying vec4 vColor;\n        attribute vec3 aColor;\n    #elif defined(dColorType_texture)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform sampler2D tColor;\n    #elif defined(dColorType_grid)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform vec3 uColorGridDim;\n        uniform vec4 uColorGridTransform;\n        uniform sampler2D tColorGrid;\n    #elif defined(dColorType_direct)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform sampler2D tOverpaint;\n        #elif defined(dOverpaintType_volumeInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform vec3 uOverpaintGridDim;\n            uniform vec4 uOverpaintGridTransform;\n            uniform sampler2D tOverpaintGrid;\n        #endif\n        uniform float uOverpaintStrength;\n    #endif\n\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform sampler2D tEmissive;\n        #elif defined(dEmissiveType_volumeInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform vec3 uEmissiveGridDim;\n            uniform vec4 uEmissiveGridTransform;\n            uniform sampler2D tEmissiveGrid;\n        #endif\n        uniform float uEmissiveStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform sampler2D tSubstance;\n        #elif defined(dSubstanceType_volumeInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform vec3 uSubstanceGridDim;\n            uniform vec4 uSubstanceGridTransform;\n            uniform sampler2D tSubstanceGrid;\n        #endif\n        uniform float uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform sampler2D tEmissive;\n        #elif defined(dEmissiveType_volumeInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform vec3 uEmissiveGridDim;\n            uniform vec4 uEmissiveGridTransform;\n            uniform sampler2D tEmissiveGrid;\n        #endif\n        uniform float uEmissiveStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat out vec4 vObject;\n            flat out vec4 vInstance;\n            flat out vec4 vGroup;\n        #else\n            flat out vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform sampler2D tTransparency;\n    #elif defined(dTransparencyType_volumeInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform vec3 uTransparencyGridDim;\n        uniform vec4 uTransparencyGridTransform;\n        uniform sampler2D tTransparencyGrid;\n    #endif\n    uniform float uTransparencyStrength;\n#endif\n",common_clip:"\n#if dClipObjectCount != 0\n    vec3 quaternionTransform(const in vec4 q, const in vec3 v) {\n        vec3 t = 2.0 * cross(q.xyz, v);\n        return v + q.w * t + cross(q.xyz, t);\n    }\n\n    vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {\n        return vec4(normalize(normal), -dot(normal, inPoint));\n    }\n\n    float planeSD(const in vec4 plane, const in vec3 center) {\n        return -dot(plane.xyz, center - plane.xyz * -plane.w);\n    }\n\n    float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        return (\n            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0\n        ) * min(min(size.x, size.y), size.z);\n    }\n\n    float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;\n        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));\n    }\n\n    float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n    }\n\n    float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        float q = length(t.xy);\n        return dot(size.xy, vec2(q, t.z));\n    }\n\n    float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale) {\n        if (type == 1) {\n            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));\n            vec4 plane = computePlane(normal, position);\n            return planeSD(plane, center);\n        } else if (type == 2) {\n            return sphereSD(position, rotation, scale * 0.5, center);\n        } else if (type == 3) {\n            return cubeSD(position, rotation, scale * 0.5, center);\n        } else if (type == 4) {\n            return cylinderSD(position, rotation, scale * 0.5, center);\n        } else if (type == 5) {\n            return infiniteConeSD(position, rotation, scale * 0.5, center);\n        } else {\n            return 0.1;\n        }\n    }\n\n    #if __VERSION__ == 100\n        // 8-bit\n        int bitwiseAnd(in int a, in int b) {\n            int d = 128;\n            int result = 0;\n            for (int i = 0; i < 8; ++i) {\n                if (d <= 0) break;\n                if (a >= d && b >= d) result += d;\n                if (a >= d) a -= d;\n                if (b >= d) b -= d;\n                d /= 2;\n            }\n            return result;\n        }\n\n        bool hasBit(const in int mask, const in int bit) {\n            return bitwiseAnd(mask, bit) == 0;\n        }\n    #else\n        bool hasBit(const in int mask, const in int bit) {\n            return (mask & bit) == 0;\n        }\n    #endif\n\n    bool clipTest(const in vec4 sphere) {\n        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)\n        #if defined(dClipping)\n            int flag = int(floor(vClipping * 255.0 + 0.5));\n        #else\n            int flag = 0;\n        #endif\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dClipObjectCount; ++i) {\n            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {\n                // TODO take sphere radius into account?\n                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;\n                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {\n                    return true;\n                }\n            }\n        }\n        #pragma unroll_loop_end\n        return false;\n    }\n#endif\n",common_frag_params:'\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform int uPickType;\nuniform int uMarkingType;\n\nuniform vec4 uCameraPlane;\nuniform vec4 uLod;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat in float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat in float vMarker;\n    #endif\n#endif\n\n#if defined(dRenderVariant_colorDpoit)\n    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript\n    uniform sampler2D tDpoitDepth;\n    uniform sampler2D tDpoitFrontColor;\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\nuniform vec2 uViewOffset;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform bool uTransparentBackground;\n\nuniform bool uDoubleSided;\nuniform float uInteriorDarkening;\nuniform bool uInteriorColorFlag;\nuniform vec3 uInteriorColor;\nbool interior;\n\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform mat4 uProjection;\n\nuniform int uRenderMask;\nuniform bool uMarkingDepthTest;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nfloat getDepthPacked(const in vec2 coords) {\n    return unpackRGBAToDepth(texture2D(tDepth, coords));\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\n// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\nvec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {\n    vec3 sigmaS = dFdx(position);\n    vec3 sigmaT = dFdy(position);\n\n    vec3 r1 = cross(sigmaT, normal);\n    vec3 r2 = cross(normal, sigmaS);\n    float det = dot(sigmaS, r1);\n    if (det == 0.0) return normal;\n\n    float bs = dFdx(height);\n    float bt = dFdy(height);\n\n    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);\n    return normalize(abs(det) * normal - scale * surfGrad);\n}\n\nfloat hash(in float h) {\n    return fract(sin(h) * 43758.5453123);\n}\n\nfloat noise(in vec3 x) {\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f * f * (3.0 - 2.0 * f);\n\n    float n = p.x + p.y * 157.0 + 113.0 * p.z;\n    return mix(\n        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\n            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\n        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\n            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);\n}\n\nfloat fbm(in vec3 p) {\n    float f = 0.0;\n    f += 0.5 * noise(p);\n    p *= 2.01;\n    f += 0.25 * noise(p);\n    p *= 2.02;\n    f += 0.125 * noise(p);\n\n    return f;\n}\n',common_vert_params:"\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\nuniform vec4 uCameraPlane;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\nuniform vec4 uInvariantBoundingSphere;\nuniform vec4 uLod;\n\nuniform bool uDoubleSided;\nuniform int uPickType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        uniform vec2 uClippingTexDim;\n        uniform sampler2D tClipping;\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat out float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat out float vMarker;\n    #endif\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\n#if defined(noNonInstancedActiveAttribs)\n    // int() is needed for some Safari versions\n    // see https://bugs.webkit.org/show_bug.cgi?id=244152\n    #define VertexID int(gl_VertexID)\n#else\n    attribute float aVertex;\n    #define VertexID int(aVertex)\n#endif\n\n#if defined(enabledMultiDraw)\n    #define DrawID gl_DrawID\n#else\n    #define DrawID uDrawId\n#endif\n",common:"\n// TODO find a better place for these convenience defines\n\n#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)\n    #define dRenderVariant_color\n#endif\n\n#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)\n    #define dColorType_texture\n#endif\n\n#if defined(dColorType_volume) || defined(dColorType_volumeInstance)\n    #define dColorType_grid\n#endif\n\n#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)\n    #define dColorType_varying\n#endif\n\n#if (defined(dRenderVariant_color) && defined(dColorMarker)) || defined(dRenderVariant_marking)\n    #define dNeedsMarker\n#endif\n\n#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)\n    #define dXrayShaded\n#endif\n\n#define MaskAll 0\n#define MaskOpaque 1\n#define MaskTransparent 2\n\n//\n\n#define PI 3.14159265\n#define RECIPROCAL_PI 0.31830988618\n#define EPSILON 1e-6\n\n#define saturate(a) clamp(a, 0.0, 1.0)\n\n#if __VERSION__ == 100\n    #define round(x) floor((x) + 0.5)\n#endif\n\nfloat intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }\nvec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }\nfloat intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }\nint imod(const in int a, const in int b) { return a - b * (a / b); }\n\nfloat pow2(const in float x) { return x * x; }\n\nvec3 packIntToRGB(in float value) {\n    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\nfloat unpackRGBToInt(const in vec3 rgb) {\n    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;\n}\n\nvec2 packUnitIntervalToRG(const in float v) {\n    vec2 enc;\n    enc.xy = vec2(fract(v * 256.0), v);\n    enc.y -= enc.x * (1.0 / 256.0);\n    enc.xy *=  256.0 / 255.0;\n\n    return enc;\n}\n\nfloat unpackRGToUnitInterval(const in vec2 enc) {\n    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));\n}\n\nvec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {\n    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);\n    p = invProjection * p;\n    return p.xyz / p.w;\n}\n\nconst float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)\nconst vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);\n}\n\nfloat linearizeDepth(const in float depth, const in float near, const in float far) {\n    return (2.0 * near) / (far + near - depth * (far - near));\n}\n\nfloat perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {\n    return (near * far) / ((far - near) * invClipZ - far);\n}\n\nfloat orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {\n    return linearClipZ * (near - far) - near;\n}\n\nfloat depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {\n    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);\n}\n\n#if __VERSION__ == 100\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose2(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose3(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose4(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    // inverse\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    mat2 inverse2(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse3(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse4(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n\n    #define isNaN(x) ((x) != (x))\n    #define isInf(x) ((x) == (x) + 1.0)\n#else\n    #define transpose2(m) transpose(m)\n    #define transpose3(m) transpose(m)\n    #define transpose4(m) transpose(m)\n\n    #define inverse2(m) inverse(m)\n    #define inverse3(m) inverse(m)\n    #define inverse4(m) inverse(m)\n\n    #define isNaN isnan\n    #define isInf isinf\n#endif\n",fade_lod:"\nif (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n    float d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;\n    float ta = min(\n        smoothstep(uLod.x, uLod.x + uLod.z, d),\n        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)\n    );\n\n    #if defined(dRenderVariant_color)\n        float at = 0.0;\n\n        // shift by view-offset during multi-sample rendering to allow for blending\n        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;\n\n        const mat4 thresholdMatrix = mat4(\n            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,\n            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,\n            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,\n            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0\n        );\n        int ci = int(intMod(coord.x, 4.0));\n        int ri = int(intMod(coord.y, 4.0));\n        #if __VERSION__ == 100\n            vec4 i = vec4(float(ci * 4 + ri));\n            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +\n                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +\n                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +\n                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));\n            at = v.x + v.y + v.z + v.w;\n        #else\n            at = thresholdMatrix[ci][ri];\n        #endif\n\n        if (ta < 0.99 && (ta < 0.01 || ta < at)) {\n            discard;\n        }\n    #else\n        if (ta < uPickingAlphaThreshold) {\n            discard;\n        }\n    #endif\n}\n",float_to_rgba:"\n    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba\n    // MIT License, Copyright (c) 2020 Equinor\n\n    float shiftRight (float v, float amt) {\n    v = floor(v) + 0.5;\n    return floor(v / exp2(amt));\n    }\n    float shiftLeft (float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n    }\n    float maskLast (float v, float bits) {\n        return mod(v, shiftLeft(1.0, bits));\n    }\n    float extractBits (float num, float from, float to) {\n        from = floor(from + 0.5); to = floor(to + 0.5);\n        return maskLast(shiftRight(num, from), to - from);\n    }\n\n    vec4 floatToRgba(float texelFloat, bool littleEndian) {\n        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);\n        float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n        texelFloat = abs(texelFloat);\n        float exponent = floor(log2(texelFloat));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return (\n            littleEndian\n                ? vec4(byte4, byte3, byte2, byte1)\n                : vec4(byte1, byte2, byte3, byte4)\n        );\n    }\n",light_frag_params:"\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\nuniform vec3 uAmbientColor;\n\nstruct PhysicalMaterial {\n    vec3 diffuseColor;\n    float roughness;\n    vec3 specularColor;\n    float specularF90;\n};\n\nstruct IncidentLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n    vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n    vec3 position;\n    vec3 normal;\n    vec3 viewDir;\n};\n\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {\n    // Original approximation by Christophe Schlick '94\n    // float fresnel = pow( 1.0 - dotVH, 5.0 );\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\n    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);\n    return f0 * (1.0 - fresnel) + (f90 * fresnel);\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {\n    float a2 = pow2(alpha);\n    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\n    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\n    return 0.5 / max(gv + gl, EPSILON);\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\nfloat D_GGX(const in float alpha, const in float dotNH) {\n    float a2 = pow2(alpha);\n    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1\n    return RECIPROCAL_PI * a2 / pow2(denom);\n}\n\n// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\nvec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {\n    float alpha = pow2(roughness); // UE4's roughness\n    vec3 halfDir = normalize( lightDir + viewDir);\n    float dotNL = saturate(dot(normal, lightDir));\n    float dotNV = saturate(dot(normal, viewDir));\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotVH = saturate(dot(viewDir, halfDir));\n    vec3 F = F_Schlick(f0, f90, dotVH);\n    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return F * (V * D);\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via 'environmentBRDF' from \"Physically Based Shading on Mobile\"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n    float dotNV = saturate(dot(normal, viewDir));\n    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n    vec4 r = roughness * c0 + c1;\n    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;\n    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;\n    return fab;\n}\n\n// Fdez-Ag\xfcera's \"Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting\"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\n    vec2 fab = DFGApprox(normal, viewDir, roughness);\n    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n    float Ess = fab.x + fab.y;\n    float Ems = 1.0 - Ess;\n    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21\n    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\n    singleScatter += FssEss;\n    multiScatter += Fms * Ems;\n}\n\nvoid RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    float dotNL = saturate(dot(geometry.normal, directLight.direction));\n    vec3 irradiance = dotNL * directLight.color;\n    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\n    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    // Both indirect specular and indirect diffuse light accumulate here\n    vec3 singleScattering = vec3(0.0);\n    vec3 multiScattering = vec3(0.0);\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);\n    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));\n    reflectedLight.indirectSpecular += radiance * singleScattering;\n    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n",matrix_scale:"\nfloat matrixScale(in mat4 m){\n    vec4 r = m[0];\n    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);\n}\n",normal_frag_params:"\nvarying vec3 vNormal;\n",read_from_texture:"\nvec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\nvec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {\n    int x = imod(i, int(dim.x));\n    int y = i / int(dim.x);\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n",rgba_to_float:'\n    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float\n    // BSD 3-Clause License\n    //\n    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.\n    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n    //\n    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n    // OF THE POSSIBILITY OF SUCH DAMAGE.\n\n    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n        ivec4 bytes = ivec4(inputFloats * 255.0);\n        return (\n            littleEndian\n                ? bytes.abgr\n                : bytes\n        );\n    }\n\n    // Break the four bytes down into an array of 32 bits.\n    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n            float acc = float(bytes[channelIndex]);\n            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n                float powerOfTwo = exp2(float(indexInByte));\n                bool bit = acc >= powerOfTwo;\n                bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n                acc = mod(acc, powerOfTwo);\n            }\n        }\n    }\n\n    // Compute the exponent of the 32-bit float.\n    float getExponent(bool bits[32]) {\n        const int startIndex = 1;\n        const int bitStringLength = 8;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        float acc = 0.0;\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Compute the mantissa of the 32-bit float.\n    float getMantissa(bool bits[32], bool subnormal) {\n        const int startIndex = 9;\n        const int bitStringLength = 23;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        // Leading/implicit/hidden bit convention:\n        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n        float acc = float(!subnormal) * exp2(float(bitStringLength));\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Parse the float from its 32 bits.\n    float bitsToFloat(bool bits[32]) {\n        float signBit = float(bits[0]) * -2.0 + 1.0;\n        float exponent = getExponent(bits);\n        bool subnormal = abs(exponent - 0.0) < 0.01;\n        float mantissa = getMantissa(bits, subnormal);\n        float exponentBias = 127.0;\n        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n    }\n\n    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n        bool bits[32];\n        bytesToBits(rgbaBytes, bits);\n        return bitsToFloat(bits);\n    }\n',size_vert_params:"\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n#endif\n\nuniform float uSizeFactor;\n",texture3d_from_1d_trilinear:"\nvec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {\n    float gdYZ = gridDim.z * gridDim.y;\n    float gdZ = gridDim.z;\n    vec3 p0 = floor(pos * gridDim);\n    vec3 p1 = ceil(pos * gridDim);\n    vec3 pd = (pos * gridDim - p0) / (p1 - p0);\n    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s00 = mix(s000, s100, pd.x);\n    vec4 s01 = mix(s001, s101, pd.x);\n    vec4 s10 = mix(s010, s110, pd.x);\n    vec4 s11 = mix(s011, s111, pd.x);\n    vec4 s0 = mix(s00, s10, pd.y);\n    vec4 s1 = mix(s01, s11, pd.y);\n    return mix(s0, s1, pd.z);\n}\n",texture3d_from_2d_linear:"\nvec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice0 = floor(pos.z * gridDim.z);\n    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;\n    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));\n    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color0 = texture2D(tex, coord0);\n\n    float zSlice1 = zSlice0 + 1.0;\n    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;\n    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));\n    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color1 = texture2D(tex, coord1);\n\n    float delta0 = abs((pos.z * gridDim.z) - zSlice0);\n    return mix(color0, color1, delta0);\n}\n",texture3d_from_2d_nearest:"\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n",wboit_write:"\n#if defined(dRenderVariant_colorWboit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n            float alpha = gl_FragColor.a;\n            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);\n            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);\n            // extra alpha is to handle pre-multiplied alpha\n            #ifndef dGeometryType_directVolume\n                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);\n            #else\n                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);\n            #endif\n        } else {\n            discard;\n        }\n    }\n#endif\n",dpoit_write:"\n#if defined(dRenderVariant_colorDpoit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n\n            // adapted from https://github.com/tsherif/webgl2examples\n            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao\n\n            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;\n            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);\n\n            vec4 fragColor = gl_FragColor;\n\n            // depth value always increases\n            // so we can use MAX blend equation\n            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);\n\n            // front color always increases\n            // so we can use MAX blend equation\n            gl_FragColor = lastFrontColor;\n\n            // back color is separately blend afterwards each pass\n            gl_FragData[1] = vec4(0.0);\n\n            float nearestDepth = -lastDepth.x;\n            float furthestDepth = lastDepth.y;\n            float alphaMultiplier = 1.0 - lastFrontColor.a;\n\n            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {\n                // Skip this depth since it's been peeled.\n                return;\n            }\n\n            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {\n                // This needs to be peeled.\n                // The ones remaining after MAX blended for\n                // all need-to-peel will be peeled next pass.\n                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);\n                return;\n            }\n\n            // write to back and front color buffer\n            if (fragmentDepth == nearestDepth) {\n                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;\n                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);\n            } else {\n                gl_FragData[1] += fragColor;\n            }\n\n        } else {\n            discard;\n        }\n    }\n#endif\n"},Ce=/^(?!\/\/)\s*#include\s+(\S+)/gm,Re=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,ke=/[ \t]*\/\/.*\n/g,we=/[ \t]*\/\*[\s\S]*?\*\//g,Oe=/\n{2,}/g;function Se(mt){return mt.replace(Ce,(_t,Me)=>{const Ke=Be[Me];if(!Ke)throw new Error(`empty chunk, '${Me}'`);return Ke}).trim().replace(ke,"\n").replace(we,"\n").replace(Oe,"\n")}function Ne(mt,_t,Me,Ke){let ut="";for(let Kt=parseInt(_t);Kt<parseInt(Me);++Kt)ut+=Ke.replace(/\[\s*i\s*\]/g,`[${Kt}]`).replace(/UNROLLED_LOOP_INDEX/g,`${Kt}`);return ut}function ne(mt,_t){return function Ve(mt){return mt.replace(Re,Ne)}(function K(mt,_t){return _t.dLightCount&&(mt=mt.replace(/dLightCount/g,`${_t.dLightCount.ref.value}`)),_t.dClipObjectCount&&(mt=mt.replace(/dClipObjectCount/g,`${_t.dClipObjectCount.ref.value}`)),mt}(mt,_t))}function be(mt,_t,Me,Ke={},ut={},Kt){return{id:Ae(),name:mt,vert:Se(_t),frag:Se(Me),extensions:Ke,outTypes:ut,ignoreDefine:Kt}}function Te(mt,_t,Me){var Ke;if(!_t.startsWith("color")){const ut=["dColorType","dUsePalette","dLightCount","dXrayShaded","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker"];return"emissive"!==_t&&ut.push("dEmissiveType","dEmissive"),ut.includes(mt)}return"dLightCount"===mt&&!(null===(Ke=Me.dIgnoreLight)||void 0===Ke||!Ke.ref.value)}function ie(mt,_t,Me){return"dLightCount"===mt||Te(mt,_t,Me)}const ue=be("points","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvoid main(){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_size\n\n    #ifdef dPointSizeAttenuation\n        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;\n    #else\n        gl_PointSize = size * uPixelRatio;\n    #endif\n    gl_PointSize = max(1.0, gl_PointSize);\n\n    gl_Position = uProjection * mvPosition;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nconst vec2 center = vec2(0.5);\nconst float radius = 0.5;\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dPointStyle_circle)\n        float dist = distance(gl_PointCoord, center);\n        if (dist > radius) discard;\n    #elif defined(dPointStyle_fuzzy)\n        float dist = distance(gl_PointCoord, center);\n        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);\n        if (fuzzyAlpha < 0.0001) discard;\n    #endif\n\n    #if defined(dPointStyle_fuzzy) && defined(dRenderVariant_color)\n        material.a *= fuzzyAlpha;\n    #endif\n\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ie),re=be("spheres","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\nuniform mat4 uInvProjection;\nuniform float uIsOrtho;\n\nuniform vec2 uTexDim;\nuniform sampler2D tPositionGroup;\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#include matrix_scale\n\n/**\n * Bounding rectangle of a clipped, perspective-projected 3D Sphere.\n * Michael Mara, Morgan McGuire. 2013\n *\n * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018\n * https://github.com/zeux/niagara\n */\nvoid sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {\n    vec3 pr = p * r;\n    float pzr2 = p.z * p.z - r * r;\n\n    float vx = sqrt(p.x * p.x + pzr2);\n    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];\n    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];\n\n    float vy = sqrt(p.y * p.y + pzr2);\n    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];\n    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];\n\n    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;\n    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;\n    gl_Position.xy *= gl_Position.w;\n}\n\nvoid main(void){\n    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5\n    #if __VERSION__ == 100\n        int m = imod(VertexID, 6);\n    #else\n        int m = VertexID % 6;\n    #endif\n    if (m == 0) {\n        mapping = vec2(-1.0, 1.0);\n    } else if (m == 1 || m == 3) {\n        mapping = vec2(-1.0, -1.0);\n    } else if (m == 4) {\n        mapping = vec2(1.0, -1.0);\n    }\n\n    vec4 positionGroup = readFromTexture(tPositionGroup, VertexID / 6, uTexDim);\n    vec3 position = positionGroup.rgb;\n    float group = positionGroup.a;\n\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vRadius = size * matrixScale(uModelView);\n\n    vec4 position4 = vec4(position, 1.0);\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    float d;\n    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n        d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;\n        float f = min(\n            smoothstep(uLod.x, uLod.x + uLod.z, d),\n            1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)\n        ) * uLod.w;\n        vRadius *= f;\n    }\n\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    #ifdef dApproximate\n        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n        mvCorner.xy += mapping * vRadius;\n        gl_Position = uProjection * mvCorner;\n    #else\n        if (uIsOrtho == 1.0) {\n            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n            mvCorner.xy += mapping * vRadius;\n            gl_Position = uProjection * mvCorner;\n        } else {\n            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n            sphereProjection(mvPosition.xyz, vRadius, mapping);\n        }\n    #endif\n\n    vec4 vPoint4 = uInvProjection * gl_Position;\n    vPoint = vPoint4.xyz / vPoint4.w;\n    vPointViewPosition = -mvPosition.xyz / mvPosition.w;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * vRadius; // avoid clipping\n        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;\n    }\n\n    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n        if (d < uLod.x || d > uLod.y) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    }\n\n    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0\n        if (clipTest(vec4(vModelPosition.xyz, 0.0))) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    #else\n        #include clip_instance\n    #endif\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\nuniform mat4 uInvView;\nuniform float uAlphaThickness;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\nbool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){\n    vec3 cameraSpherePos = -vPointViewPosition;\n\n    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);\n    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);\n\n    float B = dot(rayDirection, cameraSphereDir);\n    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);\n\n    if (det < 0.0) return false;\n\n    float sqrtDet = sqrt(det);\n    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);\n    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);\n\n    cameraPos = rayDirection * negT + rayOrigin;\n    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n    fragmentDepth = calcDepth(cameraPos);\n\n    bool objectClipped = false;\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        if (clipTest(vec4(modelPos, 0.0))) {\n            objectClipped = true;\n            fragmentDepth = -1.0;\n        }\n    #endif\n\n    if (fragmentDepth > 0.0) {\n        cameraNormal = normalize(cameraPos - cameraSpherePos);\n        interior = false;\n        return true;\n    } else if (uDoubleSided || solidInterior) {\n        cameraPos = rayDirection * posT + rayOrigin;\n        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n        fragmentDepth = calcDepth(cameraPos);\n        cameraNormal = -normalize(cameraPos - cameraSpherePos);\n        interior = true;\n        if (fragmentDepth > 0.0) {\n            #ifdef dSolidInterior\n                if (!objectClipped) {\n                    fragmentDepth = 0.0 + (0.0000001 / vRadius);\n                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n                }\n            #endif\n            return true;\n        }\n    }\n\n    return false;\n}\n\nvoid main(void){\n    vec3 cameraNormal;\n    float fragmentDepth;\n\n    #ifdef dApproximate\n        vec3 pointDir = -vPointViewPosition - vPoint;\n        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;\n        vec3 vViewPosition = -vPointViewPosition;\n        fragmentDepth = gl_FragCoord.z;\n        #if !defined(dIgnoreLight) || defined(dXrayShaded)\n            pointDir.z -= cos(length(pointDir) / vRadius);\n            cameraNormal = -normalize(pointDir / vRadius);\n        #endif\n        interior = false;\n    #else\n        vec3 modelPos;\n        vec3 cameraPos;\n        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);\n        if (!hit) discard;\n\n        if (fragmentDepth < 0.0) discard;\n        if (fragmentDepth > 1.0) discard;\n\n        gl_FragDepthEXT = fragmentDepth;\n\n        vec3 vModelPosition = modelPos;\n        vec3 vViewPosition = cameraPos;\n    #endif\n\n    #include fade_lod\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        #include clip_pixel\n    #endif\n    #include assign_material_color\n\n    #if defined(dRenderVariant_color)\n        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {\n            material.a *= min(1.0, vRadius / uAlphaThickness);\n        }\n    #endif\n\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        vec3 normal = -cameraNormal;\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},Te),ve=be("cylinders","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec3 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\nattribute float aScale;\nattribute float aCap;\nattribute float aColorMode;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform float uIsOrtho;\nuniform vec3 uCameraDir;\n\nvoid main() {\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelTransform = uModel * aTransform;\n\n    vTransform = aTransform;\n    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;\n    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;\n    vSize = size * aScale;\n    vCap = aCap;\n\n    vModelPosition = (vStart + vEnd) * 0.5;\n    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 dir = vEnd - vStart;\n    float f = aMapping.x > 0.0 ? 1.0 : 0.0;\n    // ensure cylinder 'dir' is pointing towards the camera\n    if(dot(camDir, dir) < 0.0) {\n        dir = -dir;\n        f = 1.0 - f;\n    }\n\n    vec3 left = cross(camDir, dir);\n    vec3 up = cross(left, dir);\n    left = vSize * normalize(left);\n    up = vSize * normalize(up);\n\n    // move vertex in object-space from center to corner\n    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;\n\n    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);\n    vViewPosition = mvPosition.xyz;\n    gl_Position = uProjection * mvPosition;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping\n        gl_Position.z = (uProjection * mvPosition).z;\n    }\n\n    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))\n        // dual-color mixing\n        // - for aColorMode between 0 and 1 use aColorMode to interpolate\n        // - for aColorMode == 2 do nothing, i.e., use vColor\n        // - for aColorMode == 3 use position on cylinder axis to interpolate\n        if (aColorMode <= 1.0){\n            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);\n        } else if (aColorMode == 3.0) {\n            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));\n        }\n    #endif\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\nuniform mat4 uView;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform vec3 uCameraDir;\nuniform vec3 uCameraPosition;\nuniform mat4 uInvView;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\n// adapted from https://www.shadertoy.com/view/4lcSRn\n// The MIT License, Copyright 2016 Inigo Quilez\nbool CylinderImpostor(\n    in vec3 rayOrigin, in vec3 rayDir,\n    in vec3 start, in vec3 end, in float radius,\n    out vec3 cameraNormal, out bool interior,\n    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth\n){\n    vec3 ba = end - start;\n    vec3 oc = rayOrigin - start;\n\n    float baba = dot(ba, ba);\n    float bard = dot(ba, rayDir);\n    float baoc = dot(ba, oc);\n\n    float k2 = baba - bard * bard;\n    float k1 = baba * dot(oc, rayDir) - baoc * bard;\n    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;\n\n    float h = k1 * k1 - k2 * k0;\n    if (h < 0.0) return false;\n\n    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;\n    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;\n\n    #ifdef dSolidInterior\n        bool topInterior = !topCap;\n        bool bottomInterior = !bottomCap;\n        topCap = true;\n        bottomCap = true;\n    #else\n        bool topInterior = false;\n        bool bottomInterior = false;\n    #endif\n\n    bool clipped = false;\n    bool objectClipped = false;\n\n    // body outside\n    h = sqrt(h);\n    float t = (-k1 - h) / k2;\n    float y = baoc + t * bard;\n    if (y > 0.0 && y < baba) {\n        interior = false;\n        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;\n        modelPosition = rayOrigin + t * rayDir;\n        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n        fragmentDepth = calcDepth(viewPosition);\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            if (clipTest(vec4(modelPosition, 0.0))) {\n                objectClipped = true;\n                fragmentDepth = -1.0;\n                #ifdef dSolidInterior\n                    topCap = !topInterior;\n                    bottomCap = !bottomInterior;\n                #endif\n            }\n        #endif\n        if (fragmentDepth > 0.0) return true;\n        clipped = true;\n    }\n\n    if (!clipped) {\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = topInterior;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = bottomInterior;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    if (uDoubleSided || solidInterior) {\n        // body inside\n        h = -h;\n        t = (-k1 - h) / k2;\n        y = baoc + t * bard;\n        if (y > 0.0 && y < baba) {\n            interior = true;\n            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;\n            modelPosition = rayOrigin + t * rayDir;\n            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n            fragmentDepth = calcDepth(viewPosition);\n            if (fragmentDepth > 0.0) {\n                #ifdef dSolidInterior\n                    if (!objectClipped) {\n                        fragmentDepth = 0.0 + (0.0000002 / vSize);\n                        cameraNormal = -rayDir;\n                    }\n                #endif\n                return true;\n            }\n        }\n\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    return false;\n}\n\nvoid main() {\n    vec3 rayOrigin = vModelPosition;\n    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n\n    vec3 cameraNormal;\n    vec3 modelPosition;\n    vec3 viewPosition;\n    float fragmentDepth;\n    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);\n    if (!hit) discard;\n\n    if (fragmentDepth < 0.0) discard;\n    if (fragmentDepth > 1.0) discard;\n\n    gl_FragDepthEXT = fragmentDepth;\n\n    vec3 vViewPosition = viewPosition;\n    vec3 vModelPosition = modelPosition;\n\n    #include fade_lod\n    #include clip_pixel\n    #include assign_material_color\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        mat3 normalMatrix = transpose3(inverse3(mat3(uView)));\n        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},Te),ce=be("text","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute float aDepth;\nattribute vec2 aTexCoord;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nuniform float uOffsetX;\nuniform float uOffsetY;\nuniform float uOffsetZ;\n\nuniform float uIsOrtho;\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nvarying vec2 vTexCoord;\n\n#include matrix_scale\n\nvoid main(void){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vTexCoord = aTexCoord;\n\n    float scale = matrixScale(uModelView);\n\n    float offsetX = uOffsetX * scale;\n    float offsetY = uOffsetY * scale;\n    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;\n\n    vec4 position4 = vec4(aPosition, 1.0);\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // TODO\n    // #ifdef FIXED_SIZE\n    //     if (ortho) {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;\n    //     } else {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;\n    //     }\n    // #endif\n\n    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n\n    if (vTexCoord.x == 10.0) { // indicates background plane\n        // move a bit to the back, taking distance to camera into account to avoid z-fighting\n        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);\n    }\n\n    mvCorner.xy += aMapping * size * scale;\n    mvCorner.x += offsetX;\n    mvCorner.y += offsetY;\n\n    if (uIsOrtho == 1.0) {\n        mvCorner.z += offsetZ;\n    } else {\n        mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n    }\n\n    gl_Position = uProjection * mvCorner;\n\n    vViewPosition = -mvCorner.xyz;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nuniform sampler2D tFont;\n\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform vec3 uBackgroundColor;\nuniform float uBackgroundOpacity;\n\nvarying vec2 vTexCoord;\n\nconst float smoothness = 32.0;\nconst float gamma = 2.2;\n\nvoid main2(){\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    if (vTexCoord.x > 1.0) {\n        #if defined(dRenderVariant_color)\n            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);\n        #endif\n    } else {\n        // retrieve signed distance\n        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;\n\n        // perform adaptive anti-aliasing of the edges\n        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);\n        float a = clamp(0.0, 1.0, smoothstep(0.5 - w, 0.5 + w, sdf));\n\n        // gamma correction for linear attenuation\n        a = pow(a, 1.0 / gamma);\n\n        if (a < 0.5) discard;\n\n        #if defined(dRenderVariant_color)\n            // add border\n            float t = 0.5 + uBorderWidth;\n            if (uBorderWidth > 0.0 && sdf < t) {\n                material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));\n            }\n        #endif\n    }\n\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ie),se=be("lines","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec2 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n    // trim end segment so it terminates between the camera plane and the near plane\n    // conservative estimate of the near plane\n    float a = uProjection[2][2];  // 3rd entry in 3rd column\n    float b = uProjection[3][2];  // 3rd entry in 4th column\n    float nearEstimate = -0.5 * b / a;\n    float alpha = (nearEstimate - start.z) / (end.z - start.z);\n    end.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main(){\n    float aspect = uViewport.z / uViewport.w;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelView = uView * uModel * aTransform;\n\n    // camera space\n    vec4 start = modelView * vec4(aStart, 1.0);\n    vec4 end = modelView * vec4(aEnd, 1.0);\n\n    // assign position\n    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);\n    vec4 mvPosition = modelView * position4;\n    vViewPosition = mvPosition.xyz;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n    // perhaps there is a more elegant solution -- WestLangley\n    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column\n    if (perspective) {\n        if (start.z < 0.0 && end.z >= 0.0) {\n            trimSegment(start, end);\n        } else if (end.z < 0.0 && start.z >= 0.0) {\n            trimSegment(end, start);\n        }\n    }\n\n    // clip space\n    vec4 clipStart = uProjection * start;\n    vec4 clipEnd = uProjection * end;\n\n    // ndc space\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n    // direction\n    vec2 dir = ndcEnd - ndcStart;\n\n    // account for clip-space aspect ratio\n    dir.x *= aspect;\n    dir = normalize(dir);\n\n    // perpendicular to dir\n    vec2 offset = vec2(dir.y, - dir.x);\n\n    // undo aspect ratio adjustment\n    dir.x /= aspect;\n    offset.x /= aspect;\n\n    // sign flip\n    if (aMapping.x < 0.0) offset *= -1.0;\n\n    // calculate linewidth\n    float linewidth;\n    #ifdef dLineSizeAttenuation\n        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;\n    #else\n        linewidth = size * uPixelRatio;\n    #endif\n    linewidth = max(1.0, linewidth);\n\n    // adjust for linewidth\n    offset *= linewidth;\n\n    // adjust for clip-space to screen-space conversion\n    offset /= uViewport.w;\n\n    // select end\n    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;\n\n    // back to clip space\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position = clip;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ie),ae=be("mesh","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include common_clip\n#include texture3d_from_2d_linear\n\n#ifdef dGeometryType_textureMesh\n    uniform vec2 uGeoTexDim;\n    uniform sampler2D tPosition;\n    uniform sampler2D tGroup;\n    uniform sampler2D tNormal;\n#else\n    attribute vec3 aPosition;\n    attribute float aGroup;\n    attribute vec3 aNormal;\n#endif\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec3 vNormal;\n\nvoid main(){\n    #include assign_group\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_color_varying\n    #include clip_instance\n\n    #ifdef dGeometryType_textureMesh\n        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;\n    #else\n        vec3 normal = aNormal;\n    #endif\n    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));\n    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));\n    #if defined(dFlipSided)\n        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR\n            transformedNormal = -transformedNormal;\n        }\n    #endif\n    vNormal = transformedNormal;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include normal_frag_params\n#include common_clip\n\nvoid main() {\n    #include fade_lod\n    #include clip_pixel\n\n    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)\n    vec3 fdx = dFdx(vViewPosition);\n    vec3 fdy = dFdy(vViewPosition);\n    vec3 faceNormal = normalize(cross(fdx,fdy));\n    bool frontFacing = dot(vNormal, faceNormal) > 0.0;\n\n    #if defined(dFlipSided)\n        interior = frontFacing;\n    #else\n        interior = !frontFacing;\n    #endif\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        #if defined(dFlatShaded)\n            vec3 normal = -faceNormal;\n        #else\n            vec3 normal = -normalize(vNormal);\n            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;\n        #endif\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},Te),ge=be("direct-volume","\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform mat4 uModelView;\nuniform mat4 uProjection;\nuniform vec4 uInvariantBoundingSphere;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform mat4 uTransform;\n\nuniform mat4 uUnitToCartn;\n\nvoid main() {\n    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);\n    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;\n\n    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;\n    vInstance = aInstance;\n    vBoundingSphere = vec4(\n        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,\n        uInvariantBoundingSphere.w\n    );\n    vTransform = aTransform;\n\n    gl_Position = uProjection * mvPosition;\n\n    // move z position to near clip plane (but not too close to get precision issues)\n    gl_Position.z = gl_Position.w - 0.01;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include light_frag_params\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n#endif\n#include common_clip\n\n#include read_from_texture\n#include texture3d_from_1d_trilinear\n#include texture3d_from_2d_nearest\n#include texture3d_from_2d_linear\n\nuniform mat4 uProjection, uTransform, uModelView, uModel, uView;\nuniform vec3 uCameraDir;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform mat4 uInvView;\nuniform vec3 uGridDim;\nuniform vec3 uBboxSize;\nuniform sampler2D tTransferTex;\nuniform float uTransferScale;\nuniform float uStepScale;\nuniform float uJumpLength;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n#endif\n\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uEmissive;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform bool uTransparentBackground;\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform int uRenderMask;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform vec3 uCellDim;\nuniform vec3 uCameraPosition;\nuniform mat4 uCartnToUnit;\n\n#if __VERSION__ != 100\n    // for webgl1 this is given as a 'define'\n    uniform int uMaxSteps;\n#endif\n\n#if defined(dGridTexType_2d)\n    precision highp sampler2D;\n    uniform sampler2D tGridTex;\n    uniform vec3 uGridTexDim;\n#elif defined(dGridTexType_3d)\n    precision highp sampler3D;\n    uniform sampler3D tGridTex;\n#endif\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_texture)\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#endif\n\n#ifdef dOverpaint\n    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n        uniform vec2 uOverpaintTexDim;\n        uniform sampler2D tOverpaint;\n    #endif\n#endif\n\n#ifdef dUsePalette\n    uniform sampler2D tPalette;\n#endif\n\n#if defined(dGridTexType_2d)\n    vec4 textureVal(vec3 pos) {\n        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n#elif defined(dGridTexType_3d)\n    vec4 textureVal(vec3 pos) {\n        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);\n    }\n#endif\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat transferFunction(float value) {\n    return texture2D(tTransferTex, vec2(value, 0.0)).a;\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nconst float gradOffset = 0.5;\n\nvec3 v3m4(vec3 p, mat4 m) {\n    return (m * vec4(p, 1.0)).xyz;\n}\n\nfloat preFogAlphaBlended = 0.0;\n\nvec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {\n    mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));\n    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);\n    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n        mat4 modelTransform = uModel * vTransform * uTransform;\n    #endif\n    mat4 modelViewTransform = uModelView * vTransform * uTransform;\n\n    vec3 scaleVol = vec3(1.0) / uGridDim;\n    vec3 pos = startLoc;\n    vec4 cell;\n    float prevValue = -1.0;\n    float value = 0.0;\n    vec4 src = vec4(0.0);\n    vec4 dst = vec4(0.0);\n    float fragmentDepth;\n\n    vec3 posMin = vec3(0.0);\n    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;\n\n    vec3 unitPos;\n\n    vec3 nextPos;\n    float nextValue;\n\n    vec4 material;\n    vec4 overpaint;\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float emissive = uEmissive;\n\n    vec3 gradient = vec3(1.0);\n    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);\n    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);\n    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);\n\n    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);\n    float maxDistSq = maxDist * maxDist;\n\n    for (int i = 0; i < uMaxSteps; ++i) {\n        // break when beyond bounding-sphere or far-plane\n        vec3 distVec = startLoc - pos;\n        if (dot(distVec, distVec) > maxDistSq) break;\n\n        unitPos = v3m4(pos, cartnToUnit);\n\n        // continue when outside of grid\n        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||\n            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z\n        ) {\n            prevValue = value;\n            pos += step;\n            continue;\n        }\n\n        cell = textureVal(unitPos);\n        value = cell.a; // current voxel value\n\n        if (uJumpLength > 0.0 && value < 0.01) {\n            nextPos = pos + rayDir * uJumpLength;\n            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;\n            if (nextValue < 0.01) {\n                prevValue = nextValue;\n                pos = nextPos;\n                continue;\n            }\n        }\n\n        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);\n        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))\n            break;\n\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);\n            if (clipTest(vec4(vModelPosition, 0.0))) {\n                prevValue = value;\n                pos += step;\n                continue;\n            }\n        #endif\n\n        vec3 vViewPosition = mvPosition.xyz;\n        material.a = transferFunction(value);\n\n        #ifdef dPackedGroup\n            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);\n        #else\n            vec3 g = floor(unitPos * uGridDim + 0.5);\n            // note that we swap x and z because the texture is flipped around y\n            #if defined(dAxisOrder_012)\n                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210\n            #elif defined(dAxisOrder_021)\n                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120\n            #elif defined(dAxisOrder_102)\n                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201\n            #elif defined(dAxisOrder_120)\n                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021\n            #elif defined(dAxisOrder_201)\n                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102\n            #elif defined(dAxisOrder_210)\n                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012\n            #endif\n        #endif\n\n        #if defined(dColorType_direct) && defined(dUsePalette)\n            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;\n        #elif defined(dColorType_uniform)\n            material.rgb = uColor;\n        #elif defined(dColorType_instance)\n            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;\n        #elif defined(dColorType_group)\n            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #elif defined(dColorType_groupInstance)\n            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #elif defined(dColorType_vertex)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;\n        #elif defined(dColorType_vertexInstance)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;\n        #endif\n\n        #ifdef dOverpaint\n            #if defined(dOverpaintType_groupInstance)\n                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);\n            #elif defined(dOverpaintType_vertexInstance)\n                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));\n            #endif\n\n            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);\n        #endif\n\n        #if defined(dIgnoreLight)\n            gl_FragColor.rgb = material.rgb;\n        #else\n            if (material.a >= 0.01) {\n                #ifdef dPackedGroup\n                    // compute gradient by central differences\n                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;\n                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;\n                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;\n                #else\n                    gradient = cell.xyz * 2.0 - 1.0;\n                #endif\n                vec3 normal = -normalize(normalMatrix * normalize(gradient));\n                #include apply_light_color\n            } else {\n                gl_FragColor.rgb = material.rgb;\n            }\n        #endif\n\n        gl_FragColor.a = material.a * uAlpha * uTransferScale;\n\n        #if defined(dColorMarker)\n            float marker = uMarker;\n            if (uMarker == -1.0) {\n                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n            }\n        #endif\n        #include apply_marker_color\n\n        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;\n        fragmentDepth = calcDepth(mvPosition.xyz);\n        #include apply_fog\n\n        src = gl_FragColor;\n\n        if (!uTransparentBackground) {\n            // done in 'apply_fog' otherwise\n            src.rgb *= src.a;\n        }\n        dst = (1.0 - dst.a) * src + dst; // standard blending\n\n        // break if the color is opaque enough\n        if (dst.a > 0.95)\n            break;\n\n        pos += step;\n    }\n\n    return dst;\n}\n\n// TODO: support float texture for higher precision values???\n// TODO: support clipping exclusion texture support\n\nvoid main() {\n    #if defined(dRenderVariant_emissive)\n        discard;\n    #else\n        if (gl_FrontFacing)\n            discard;\n\n        vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);\n        vec3 step = rayDir * uStepScale;\n\n        float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;\n        float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);\n        vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);\n        gl_FragColor = raymarch(start, step, rayDir);\n\n        float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);\n        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);\n        #include wboit_write\n    #endif\n}\n",{fragDepth:"optional",drawBuffers:"optional"},{},Te),Ie=be("image","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_vert_params\n\nattribute vec3 aPosition;\nattribute vec2 aUv;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\nvoid main() {\n    #include assign_position\n\n    vUv = aUv;\n    vInstance = aInstance;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_frag_params\n#include common_clip\n\nuniform vec2 uImageTexDim;\nuniform sampler2D tImageTex;\nuniform sampler2D tGroupTex;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\n#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)\n    #define dInterpolation_cubic\n#endif\n\n#if defined(dInterpolation_cubic)\n    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)\n        #if defined(dInterpolation_catmulrom)\n            const float B = 0.0;\n            const float C = 0.5;\n        #elif defined(dInterpolation_mitchell)\n            const float B = 0.333;\n            const float C = 0.333;\n        #endif\n\n        float cubicFilter(float x){\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f < 1.0) {\n                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +\n                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +\n                    (6.0 - 2.0 * B)) / 6.0;\n            }else if (f >= 1.0 && f < 2.0){\n                return ((-B - 6.0 * C) * ( f * f * f)\n                    + (6.0 * B + 30.0 * C) * (f * f) +\n                    (-(12.0 * B) - 48.0 * C) * f +\n                    8.0 * B + 24.0 * C) / 6.0;\n            }else{\n                return 0.0;\n            }\n        }\n    #elif defined(dInterpolation_bspline)\n        float cubicFilter(float x) {\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f >= 0.0 && f <= 1.0){\n                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);\n            } else if (f > 1.0 && f <= 2.0) {\n                return 1.0 / 6.0 * pow((2.0 - f), 3.0);\n            }\n            return 1.0;\n        }\n    #endif\n\n    vec4 biCubic(sampler2D tex, vec2 texCoord) {\n        vec2 texelSize = 1.0 / uImageTexDim;\n        texCoord -= texelSize / 2.0;\n        vec4 nSum = vec4(0.0);\n        float nDenom = 0.0;\n        vec2 cell = fract(texCoord * uImageTexDim);\n        for (float m = -1.0; m <= 2.0; ++m) {\n            for (float n = -1.0; n <= 2.0; ++n) {\n                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));\n                float c = abs(cubicFilter(m - cell.x) * cubicFilter(-n + cell.y));\n                nSum += vecData * c;\n                nDenom += c;\n            }\n        }\n        return nSum / nDenom;\n    }\n#endif\n\nvoid main() {\n    #include fade_lod\n    #include clip_pixel\n\n    #if defined(dInterpolation_cubic)\n        vec4 imageData = biCubic(tImageTex, vUv);\n    #else\n        vec4 imageData = texture2D(tImageTex, vUv);\n    #endif\n    imageData.a = clamp(imageData.a, 0.0, 1.0);\n    if (imageData.a > 0.9) imageData.a = 1.0;\n\n    imageData.a *= uAlpha;\n    if (imageData.a < 0.05)\n        discard;\n\n    float fragmentDepth = gl_FragCoord.z;\n\n    if ((uRenderMask == MaskOpaque && imageData.a < 1.0) ||\n        (uRenderMask == MaskTransparent && imageData.a == 1.0)\n    ) {\n        discard;\n    }\n\n    #if defined(dRenderVariant_pick)\n        if (imageData.a < 0.3)\n            discard;\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);\n            gl_FragData[2] = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            gl_FragData[3] = packDepthToRGBA(gl_FragCoord.z);\n        #else\n            gl_FragColor = vColor;\n            if (uPickType == 1) {\n                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            } else if (uPickType == 2) {\n                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);\n            } else {\n                gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            }\n        #endif\n    #elif defined(dRenderVariant_depth)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #elif defined(dRenderVariant_marking)\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n        if (uMarkingType == 1) {\n            if (marker > 0.0 || imageData.a < 0.05)\n                discard;\n            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n        } else {\n            if (marker == 0.0 || imageData.a < 0.05)\n                discard;\n            float depthTest = 1.0;\n            if (uMarkingDepthTest) {\n                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n            }\n            bool isHighlight = intMod(marker, 2.0) > 0.1;\n            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);\n        }\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = vec4(0.0);\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = imageData;\n\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},ie);function Le(mt,_t){var Me;if(void 0===mt)return"";const Ke=(null===(Me=mt.dRenderVariant)||void 0===Me?void 0:Me.ref.value)||"",ut=[];for(const Kt in mt){if(_t?.(Kt,Ke,mt))continue;const gt=mt[Kt].ref.value;void 0!==gt&&("string"==typeof gt?ut.push(`#define ${Kt}_${gt}`):"number"==typeof gt?ut.push(`#define ${Kt} ${gt}`):"boolean"==typeof gt?gt&&ut.push(`#define ${Kt}`):(0,r.dr)(gt))}return ut.join("\n")+"\n"}const Lt="\n#define attribute in\n#define varying out\n#define texture2D texture\n",Je="\n#define varying in\n#define texture2D texture\n#define textureCube texture\n#define texture2DLodEXT textureLod\n#define textureCubeLodEXT textureLod\n\n#define gl_FragColor out_FragData0\n#define gl_FragDepthEXT gl_FragDepth\n\n#define depthTextureSupport\n";function $e(mt,_t,Me,Ke){const ut=Le(Me,Ke.ignoreDefine),Kt=Le(Me,Ke.ignoreDefine),sn=(0,o.C6)(mt)?function en(mt,_t){const Me=["#version 300 es"];if(_t.drawBuffers&&mt.drawBuffers&&Me.push("#define requiredDrawBuffers"),_t.multiDraw)if(mt.multiDraw)Me.push("#extension GL_ANGLE_multi_draw : require"),Me.push("#define enabledMultiDraw");else if("required"===_t.multiDraw)throw new Error("required 'GL_ANGLE_multi_draw' extension not available");if(_t.clipCullDistance)if(mt.clipCullDistance)Me.push("#extension GL_ANGLE_clip_cull_distance : enable"),Me.push("#define enabledClipCullDistance");else if("required"===_t.clipCullDistance)throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available");if(_t.conservativeDepth)if(mt.conservativeDepth)Me.push("#extension GL_EXT_conservative_depth : enable"),Me.push("#define enabledConservativeDepth");else if("required"===_t.conservativeDepth)throw new Error("required 'GL_EXT_conservative_depth' extension not available");return mt.noNonInstancedActiveAttribs&&Me.push("#define noNonInstancedActiveAttribs"),Me.push(Lt),Me.join("\n")+"\n"}(_t,Ke.extensions):function nt(mt,_t){const Me=[];if(_t.drawBuffers)if(mt.drawBuffers)Me.push("#define requiredDrawBuffers");else if("required"===_t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");if(_t.multiDraw)if(mt.multiDraw)Me.push("#extension GL_ANGLE_multi_draw : require"),Me.push("#define enabledMultiDraw");else if("required"===_t.multiDraw)throw new Error("required 'GL_ANGLE_multi_draw' extension not available");return Me.join("\n")+"\n"}(_t,Ke.extensions),gt=(0,o.C6)(mt)?function Bt(mt,_t,Me,Ke){const ut=["#version 300 es",`layout(location = 0) out highp ${Ke[0]||"vec4"} out_FragData0;`];if(Me.fragDepth&&_t.fragDepth&&ut.push("#define enabledFragDepth"),Me.drawBuffers&&_t.drawBuffers){ut.push("#define requiredDrawBuffers");for(let sn=1,gt=mt.getParameter(mt.MAX_DRAW_BUFFERS);sn<gt;++sn)ut.push(`layout(location = ${sn}) out highp ${Ke[sn]||"vec4"} out_FragData${sn};`)}return Me.shaderTextureLod&&_t.shaderTextureLod&&ut.push("#define enabledShaderTextureLod"),ut.push(Je),ut.join("\n")+"\n"}(mt,_t,Ke.extensions,Ke.outTypes):function je(mt,_t){const Me=["#extension GL_OES_standard_derivatives : enable"];if(_t.fragDepth)if(mt.fragDepth)Me.push("#extension GL_EXT_frag_depth : enable"),Me.push("#define enabledFragDepth");else if("required"===_t.fragDepth)throw new Error("required 'GL_EXT_frag_depth' extension not available");if(_t.drawBuffers)if(mt.drawBuffers)Me.push("#extension GL_EXT_draw_buffers : require"),Me.push("#define requiredDrawBuffers"),Me.push("#define gl_FragColor gl_FragData[0]");else if("required"===_t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");if(_t.shaderTextureLod)if(mt.shaderTextureLod)Me.push("#extension GL_EXT_shader_texture_lod : enable"),Me.push("#define enabledShaderTextureLod");else if("required"===_t.shaderTextureLod)throw new Error("required 'GL_EXT_shader_texture_lod' extension not available");return mt.depthTexture&&Me.push("#define depthTextureSupport"),Me.join("\n")+"\n"}(_t,Ke.extensions),yt=(0,o.C6)(mt)?function pn(mt){return mt.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}(Ke.frag):Ke.frag;return{id:Ae(),name:Ke.name,vert:`${sn}${ut}${ne(Ke.vert,Me)}`,frag:`${gt}${Kt}${ne(yt,Me)}`,extensions:Ke.extensions,outTypes:Ke.outTypes}}},9387:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>e});const e="\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nvoid main(void) {\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n"},4677:(tn,Ue,n)=>{"use strict";n.d(Ue,{Fu:()=>_,Zo:()=>v,ki:()=>I,oq:()=>M,xB:()=>b});var e=n(7778),o=n(1372),r=n(8437);const t=(0,e.q)();function v(l){const m=l.createBuffer();if(null===m)throw new Error("Could not create WebGL buffer");return m}function O(l,m,u,d){let s=v(l);const C=function A(l,m){switch(m){case"static":return l.STATIC_DRAW;case"dynamic":return l.DYNAMIC_DRAW;case"stream":return l.STREAM_DRAW}}(l,u),h=function i(l,m){switch(m){case"attribute":return l.ARRAY_BUFFER;case"elements":return l.ELEMENT_ARRAY_BUFFER;case"uniform":if((0,r.C6)(l))return l.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers")}}(l,d),a=function c(l,m){return m instanceof Uint8Array?l.UNSIGNED_BYTE:m instanceof Int8Array?l.BYTE:m instanceof Uint16Array?l.UNSIGNED_SHORT:m instanceof Int16Array?l.SHORT:m instanceof Uint32Array?l.UNSIGNED_INT:m instanceof Int32Array?l.INT:m instanceof Float32Array?l.FLOAT:void(0,o.dr)(m)}(l,m),S=m.BYTES_PER_ELEMENT,D=m.length;function R(p){l.bindBuffer(h,s),l.bufferData(h,p,C)}R(m);let f=!1;return{id:t(),_usageHint:C,_bufferType:h,_dataType:a,_bpe:S,length:D,getBuffer:()=>s,updateData:R,updateSubData:(p,E,T)=>{l.bindBuffer(h,s),T-E===p.length?l.bufferSubData(h,0,p):l.bufferSubData(h,E*S,p.subarray(E,E+T))},reset:()=>{s=v(l),R(m)},destroy:()=>{f||(l.deleteBuffer(s),f=!0)}}}function b(l,m,u){if("float32"===m)switch(u){case 1:return l.FLOAT;case 2:return l.FLOAT_VEC2;case 3:return l.FLOAT_VEC3;case 4:return l.FLOAT_VEC4;case 16:return l.FLOAT_MAT4}(0,o.dr)(m)}function _(l,m,u,d,s,C,h="static"){const{instancedArrays:a}=u,S=O(l,d,h,"attribute"),{_bufferType:D,_dataType:R,_bpe:f}=S;return{...S,divisor:C,bind:p=>{if(l.bindBuffer(D,S.getBuffer()),16===s)for(let E=0;E<4;++E)m.enableVertexAttrib(p+E),l.vertexAttribPointer(p+E,4,R,!1,16*f,4*E*f),a.vertexAttribDivisor(p+E,C);else m.enableVertexAttrib(p),l.vertexAttribPointer(p,s,R,!1,0,0),a.vertexAttribDivisor(p,C)},changeOffset:(p,E)=>{const T=E*f*s;if(l.bindBuffer(D,S.getBuffer()),16===s)for(let L=0;L<4;++L)l.vertexAttribPointer(p+L,4,R,!1,16*f,4*L*f+T);else l.vertexAttribPointer(p,s,R,!1,0,T)}}}function M(l,m,u){const d=[];return Object.keys(m).forEach(s=>{const C=m[s];"attribute"===C.type&&(d[d.length]=[s,l.resources.attribute(u[s].ref.value,C.itemSize,C.divisor)])}),d}function I(l,m,u="static"){const d=O(l,m,u,"elements");return{...d,bind:()=>{l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,d.getBuffer())}}}},8437:(tn,Ue,n)=>{"use strict";n.d(Ue,{Bs:()=>_,C6:()=>y,CI:()=>h,Du:()=>U,J6:()=>C,JR:()=>M,Kt:()=>R,L4:()=>f,MS:()=>I,MT:()=>l,QB:()=>D,VD:()=>G,WD:()=>c,Yl:()=>T,Z1:()=>Q,af:()=>u,bt:()=>d,ct:()=>m,dh:()=>v,e_:()=>i,jU:()=>S,kR:()=>L,l4:()=>O,m6:()=>s,n_:()=>a,qf:()=>V,qr:()=>E,qt:()=>w,w1:()=>b,wM:()=>p});var e=n(2629),o=n(6349),r=n(7579),t=n(4098);function y(J){return typeof WebGL2RenderingContext<"u"&&J instanceof WebGL2RenderingContext}function c(J){if(y(J))return{drawArraysInstanced:J.drawArraysInstanced.bind(J),drawElementsInstanced:J.drawElementsInstanced.bind(J),vertexAttribDivisor:J.vertexAttribDivisor.bind(J),VERTEX_ATTRIB_ARRAY_DIVISOR:J.VERTEX_ATTRIB_ARRAY_DIVISOR};{const W=J.getExtension("ANGLE_instanced_arrays");return null===W?null:{drawArraysInstanced:W.drawArraysInstancedANGLE.bind(W),drawElementsInstanced:W.drawElementsInstancedANGLE.bind(W),vertexAttribDivisor:W.vertexAttribDivisorANGLE.bind(W),VERTEX_ATTRIB_ARRAY_DIVISOR:W.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}function i(J){if(y(J))return{FRAGMENT_SHADER_DERIVATIVE_HINT:J.FRAGMENT_SHADER_DERIVATIVE_HINT};{const W=J.getExtension("OES_standard_derivatives");return null===W?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:W.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}function v(J){return y(J)?{}:J.getExtension("OES_element_index_uint")}function O(J){if(y(J))return{VERTEX_ARRAY_BINDING:J.VERTEX_ARRAY_BINDING,bindVertexArray:J.bindVertexArray.bind(J),createVertexArray:J.createVertexArray.bind(J),deleteVertexArray:J.deleteVertexArray.bind(J),isVertexArray:J.isVertexArray.bind(J)};{const W=J.getExtension("OES_vertex_array_object");return null===W?null:{VERTEX_ARRAY_BINDING:W.VERTEX_ARRAY_BINDING_OES,bindVertexArray:W.bindVertexArrayOES.bind(W),createVertexArray:W.createVertexArrayOES.bind(W),deleteVertexArray:W.deleteVertexArrayOES.bind(W),isVertexArray:W.isVertexArrayOES.bind(W)}}}function b(J){return y(J)?{}:J.getExtension("OES_texture_float")}function _(J){return J.getExtension("OES_texture_float_linear")}function M(J){if(y(J))return{HALF_FLOAT:J.HALF_FLOAT};{const W=J.getExtension("OES_texture_half_float");return null===W?null:{HALF_FLOAT:W.HALF_FLOAT_OES}}}function I(J){return J.getExtension("OES_texture_half_float_linear")}function l(J){if(y(J))return{MIN:J.MIN,MAX:J.MAX};{const W=J.getExtension("EXT_blend_minmax");return null===W?null:{MIN:W.MIN_EXT,MAX:W.MAX_EXT}}}function m(J){return y(J)?{}:J.getExtension("EXT_frag_depth")}function u(J){if(y(J))return null===J.getExtension("EXT_color_buffer_float")?null:(J.getExtension("EXT_float_blend"),{RGBA32F:J.RGBA32F});{const W=J.getExtension("WEBGL_color_buffer_float");return null===W?(J.getExtension("OES_texture_float"),$(J,J.FLOAT)?{RGBA32F:34836}:null):(J.getExtension("EXT_float_blend"),{RGBA32F:W.RGBA32F_EXT})}}function d(J){if(y(J))return null===J.getExtension("EXT_color_buffer_half_float")?null:(J.getExtension("EXT_float_blend"),{RGBA16F:J.RGBA16F});{const W=J.getExtension("EXT_color_buffer_half_float");return null===W?(J.getExtension("OES_texture_half_float"),$(J,36193)?{RGBA16F:34842}:null):(J.getExtension("EXT_float_blend"),{RGBA16F:W.RGBA16F_EXT})}}function s(J){if(y(J))return{drawBuffers:J.drawBuffers.bind(J),COLOR_ATTACHMENT0:J.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:J.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:J.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:J.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:J.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:J.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:J.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:J.COLOR_ATTACHMENT7,DRAW_BUFFER0:J.DRAW_BUFFER0,DRAW_BUFFER1:J.DRAW_BUFFER1,DRAW_BUFFER2:J.DRAW_BUFFER2,DRAW_BUFFER3:J.DRAW_BUFFER3,DRAW_BUFFER4:J.DRAW_BUFFER4,DRAW_BUFFER5:J.DRAW_BUFFER5,DRAW_BUFFER6:J.DRAW_BUFFER6,DRAW_BUFFER7:J.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:J.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:J.MAX_DRAW_BUFFERS};{const W=J.getExtension("WEBGL_draw_buffers");return null===W?null:{drawBuffers:W.drawBuffersWEBGL.bind(W),COLOR_ATTACHMENT0:W.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:W.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:W.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:W.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:W.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:W.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:W.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:W.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:W.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:W.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:W.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:W.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:W.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:W.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:W.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:W.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:W.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:W.MAX_DRAW_BUFFERS_WEBGL}}}function C(J){const W=J.getExtension("OES_draw_buffers_indexed");return null===W?null:{enablei:W.enableiOES.bind(W),disablei:W.disableiOES.bind(W),blendEquationi:W.blendEquationiOES.bind(W),blendEquationSeparatei:W.blendEquationSeparateiOES.bind(W),blendFunci:W.blendFunciOES.bind(W),blendFuncSeparatei:W.blendFuncSeparateiOES.bind(W),colorMaski:W.colorMaskiOES.bind(W)}}function h(J){return y(J)?{}:J.getExtension("EXT_shader_texture_lod")}function a(J){if(y(J))return{UNSIGNED_INT_24_8:J.UNSIGNED_INT_24_8};{const W=J.getExtension("WEBGL_depth_texture");return null===W?null:{UNSIGNED_INT_24_8:W.UNSIGNED_INT_24_8_WEBGL}}}function S(J){if(y(J))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:J.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:J.SRGB8_ALPHA8,SRGB8:J.SRGB8,SRGB:J.SRGB};{const W=J.getExtension("EXT_sRGB");return null===W?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:W.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:W.SRGB8_ALPHA8_EXT,SRGB8:W.SRGB_ALPHA_EXT,SRGB:W.SRGB_EXT}}}function D(J){if(y(J)){const W=J.getExtension("EXT_disjoint_timer_query_webgl2")||J.getExtension("EXT_disjoint_timer_query");return null===W?null:{QUERY_COUNTER_BITS:W.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:J.CURRENT_QUERY,QUERY_RESULT:J.QUERY_RESULT,QUERY_RESULT_AVAILABLE:J.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:W.TIME_ELAPSED_EXT,TIMESTAMP:W.TIMESTAMP_EXT,GPU_DISJOINT:W.GPU_DISJOINT_EXT,createQuery:J.createQuery.bind(J),deleteQuery:J.deleteQuery.bind(J),isQuery:J.isQuery.bind(J),beginQuery:J.beginQuery.bind(J),endQuery:J.endQuery.bind(J),queryCounter:W.queryCounterEXT.bind(W),getQuery:J.getQuery.bind(J),getQueryParameter:J.getQueryParameter.bind(J)}}{const W=J.getExtension("EXT_disjoint_timer_query");return null===W?null:{QUERY_COUNTER_BITS:W.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:W.CURRENT_QUERY_EXT,QUERY_RESULT:W.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:W.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:W.TIME_ELAPSED_EXT,TIMESTAMP:W.TIMESTAMP_EXT,GPU_DISJOINT:W.GPU_DISJOINT_EXT,createQuery:W.createQueryEXT.bind(W),deleteQuery:W.deleteQueryEXT.bind(W),isQuery:W.isQueryEXT.bind(W),beginQuery:W.beginQueryEXT.bind(W),endQuery:W.endQueryEXT.bind(W),queryCounter:W.queryCounterEXT.bind(W),getQuery:W.getQueryEXT.bind(W),getQueryParameter:W.getQueryObjectEXT.bind(W)}}}function R(J){const W=J.getExtension("WEBGL_multi_draw");return W?{multiDrawArrays:W.multiDrawArraysWEBGL.bind(W),multiDrawElements:W.multiDrawElementsWEBGL.bind(W),multiDrawArraysInstanced:W.multiDrawArraysInstancedWEBGL.bind(W),multiDrawElementsInstanced:W.multiDrawElementsInstancedWEBGL.bind(W)}:null}function f(J){const W=J.getExtension("WEBGL_draw_instanced_base_vertex_base_instance");return W?{drawArraysInstancedBaseInstance:W.drawArraysInstancedBaseInstanceWEBGL.bind(W),drawElementsInstancedBaseVertexBaseInstance:W.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(W)}:null}function p(J){const W=J.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance");return W?{multiDrawArraysInstancedBaseInstance:W.multiDrawArraysInstancedBaseInstanceWEBGL.bind(W),multiDrawElementsInstancedBaseVertexBaseInstance:W.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(W)}:null}function E(J){const W=J.getExtension("KHR_parallel_shader_compile");return null===W?null:{COMPLETION_STATUS:W.COMPLETION_STATUS_KHR}}function T(J){return y(J)?{}:J.getExtension("OES_fbo_render_mipmap")}function L(J){if(y(J)){const W=J.getExtension("WEBGL_provoking_vertex");if(W)return{FIRST_VERTEX_CONVENTION:W.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:W.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:W.PROVOKING_VERTEX_WEBGL,provokingVertex:W.provokingVertexWEBGL.bind(W)}}return null}function w(J){if(y(J)){const W=J.getExtension("WEBGL_clip_cull_distance");if(W)return{MAX_CLIP_DISTANCES:W.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:W.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:W.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:W.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:W.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:W.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:W.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:W.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:W.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:W.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:W.CLIP_DISTANCE7_WEBGL}}return null}function Q(J){return y(J)&&J.getExtension("EXT_conservative_depth")?{}:null}function G(J){if(y(J)){const W=J.getExtension("WEBGL_stencil_texturing");if(W)return{DEPTH_STENCIL_TEXTURE_MODE:W.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:W.STENCIL_INDEX_WEBGL}}return null}function V(J){const W=J.getExtension("EXT_clip_control");return W?{LOWER_LEFT:W.LOWER_LEFT_EXT,UPPER_LEFT:W.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:W.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:W.ZERO_TO_ONE_EXT,CLIP_ORIGIN:W.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:W.CLIP_DEPTH_MODE_EXT,clipControl:W.clipControlEXT.bind(W)}:null}function U(J){if(!y(J))return!1;if(typeof navigator<"u"){const W=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return!W||parseInt(W[1])>=85}return!1}const N="\nattribute vec4 aPosition;\n\nvoid main() {\n    gl_Position = aPosition;\n}",k="\nprecision mediump float;\nuniform vec4 uColor;\nuniform sampler2D uTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;\n}",H=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function $(J,W){const te=(0,t.A)(J,{type:"vert",source:N}),de=(0,t.A)(J,{type:"frag",source:k});if(!te||!de)return!1;const ye=(0,r.J)(J);J.attachShader(ye,te),J.attachShader(ye,de),J.linkProgram(ye),J.useProgram(ye);const j=J.getAttribLocation(ye,"aPosition"),Z=J.getUniformLocation(ye,"uColor");if(!Z)return e.Bb&&console.log("error getting 'uColor' uniform location"),!1;const q=J.createBuffer();J.bindBuffer(J.ARRAY_BUFFER,q),J.bufferData(J.ARRAY_BUFFER,H,J.STATIC_DRAW),J.enableVertexAttribArray(j),J.vertexAttribPointer(j,2,J.FLOAT,!1,0,0);const Y=J.createTexture(),ee=new Uint8Array([255,255,255,255]);J.bindTexture(J.TEXTURE_2D,Y),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,ee);const g=J.createTexture();J.bindTexture(J.TEXTURE_2D,g),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,1,1,0,J.RGBA,W,null),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST);const _e=J.createFramebuffer();if(J.bindFramebuffer(J.FRAMEBUFFER,_e),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,g,0),J.checkFramebufferStatus(J.FRAMEBUFFER)!==J.FRAMEBUFFER_COMPLETE)return e.Bb&&console.log(`error creating framebuffer for '${W}'`),!1;J.bindTexture(J.TEXTURE_2D,Y),J.uniform4fv(Z,[0,10,20,1]),J.drawArrays(J.TRIANGLES,0,6),J.bindTexture(J.TEXTURE_2D,g),J.bindFramebuffer(J.FRAMEBUFFER,null),J.clearColor(1,0,0,1),J.clear(J.COLOR_BUFFER_BIT),J.uniform4fv(Z,[0,.1,.05,1]),J.drawArrays(J.TRIANGLES,0,6);const le=new Uint8Array(4);if(J.readPixels(0,0,1,1,J.RGBA,J.UNSIGNED_BYTE,le),0!==le[0]||le[1]<248||le[2]<248||le[3]<254)return e.Bb&&console.log(`not able to actually render to '${W}' texture`),!1;if(W===J.FLOAT){J.bindFramebuffer(J.FRAMEBUFFER,_e);const Ae=new Float32Array(4);J.readPixels(0,0,1,1,J.RGBA,J.FLOAT,Ae);const Be=J.getError();if(Be)return e.Bb&&console.log(`error reading float pixels: '${(0,o.tL)(J,Be)}'`),!1}return!0}},6349:(tn,Ue,n)=>{"use strict";n.d(Ue,{Lq:()=>N,q6:()=>ee,tL:()=>U,$i:()=>V});var e=n(467),o=n(8437),r=n(3648),t=n(4824),A=n(2629);function y(g){const _e=(0,o.WD)(g);if(null===_e)throw new Error('Could not find support for "instanced_arrays"');const xe=(0,o.dh)(g);if(null===xe)throw new Error('Could not find support for "element_index_uint"');const le=(0,o.e_)(g);if(null===le)throw new Error('Could not find support for "standard_derivatives"');const Ae=(0,o.w1)(g);A.Bb&&null===Ae&&console.log('Could not find support for "texture_float"');const Be=(0,o.Bs)(g);A.Bb&&null===Be&&console.log('Could not find support for "texture_float_linear"');const Ce=(0,o.JR)(g);A.Bb&&null===Ce&&console.log('Could not find support for "texture_half_float"');const Re=(0,o.MS)(g);A.Bb&&null===Re&&console.log('Could not find support for "texture_half_float_linear"');const ke=(0,o.n_)(g);A.Bb&&null===ke&&console.log('Could not find support for "depth_texture"');const we=(0,o.MT)(g);A.Bb&&null===we&&console.log('Could not find support for "blend_minmax"');const Oe=(0,o.l4)(g);A.Bb&&null===Oe&&console.log('Could not find support for "vertex_array_object"');const Se=(0,o.ct)(g);A.Bb&&null===Se&&console.log('Could not find support for "frag_depth"');const Ve=(0,o.af)(g);A.Bb&&null===Ve&&console.log('Could not find support for "color_buffer_float"');const Ne=(0,o.bt)(g);A.Bb&&null===Ne&&console.log('Could not find support for "color_buffer_half_float"');const K=(0,o.m6)(g);A.Bb&&null===K&&console.log('Could not find support for "draw_buffers"');const ne=(0,o.J6)(g);A.Bb&&null===ne&&console.log('Could not find support for "draw_buffers_indexed"');const be=(0,o.CI)(g);A.Bb&&null===be&&console.log('Could not find support for "shader_texture_lod"');const Te=(0,o.jU)(g);A.Bb&&null===Te&&console.log('Could not find support for "sRGB"');const ie=(0,o.QB)(g);A.Bb&&null===ie&&console.log('Could not find support for "disjoint_timer_query"');const ue=(0,o.Kt)(g);A.Bb&&null===ue&&console.log('Could not find support for "multi_draw"');const re=(0,o.L4)(g);A.Bb&&null===re&&console.log('Could not find support for "draw_instanced_base_vertex_base_instance"');const ve=(0,o.wM)(g);A.Bb&&null===ve&&console.log('Could not find support for "multi_draw_instanced_base_vertex_base_instance"');const ce=(0,o.qr)(g);A.Bb&&null===ce&&console.log('Could not find support for "parallel_shader_compile"');const se=(0,o.Yl)(g);A.Bb&&null===se&&console.log('Could not find support for "fbo_render_mipmap"');const ae=(0,o.kR)(g);A.Bb&&null===ae&&console.log('Could not find support for "provoking_vertex"');const ge=(0,o.qt)(g);A.Bb&&null===ge&&console.log('Could not find support for "clip_cull_distance"');const Ie=(0,o.Z1)(g);A.Bb&&null===Ie&&console.log('Could not find support for "conservative_depth"');const Le=(0,o.VD)(g);A.Bb&&null===Le&&console.log('Could not find support for "stencil_texturing"');const nt=(0,o.qf)(g);return A.Bb&&null===nt&&console.log('Could not find support for "clip_control"'),{instancedArrays:_e,standardDerivatives:le,elementIndexUint:xe,textureFloat:Ae,textureFloatLinear:Be,textureHalfFloat:Ce,textureHalfFloatLinear:Re,depthTexture:ke,blendMinMax:we,vertexArrayObject:Oe,fragDepth:Se,colorBufferFloat:Ve,colorBufferHalfFloat:Ne,drawBuffers:K,drawBuffersIndexed:ne,shaderTextureLod:be,sRGB:Te,disjointTimerQuery:ie,multiDraw:ue,drawInstancedBaseVertexBaseInstance:re,multiDrawInstancedBaseVertexBaseInstance:ve,parallelShaderCompile:ce,fboRenderMipmap:se,provokingVertex:ae,clipCullDistance:ge,conservativeDepth:Ie,stencilTexturing:Le,clipControl:nt,noNonInstancedActiveAttribs:(0,o.Du)(g)}}var i=n(2775),v=n(7579),O=n(4098),b=n(4677);function I(g,_e,xe){const le=new Map;return{get:Ae=>{const Be=g(Ae);let Ce=le.get(Be);return Ce||(Ce=function _(g,_e=0){return{value:g,usageCount:_e}}(_e(Ae)),le.set(Be,Ce)),Ce.usageCount+=1,function M(g){return{free:()=>{g.usageCount-=1},value:g.value}}(Ce)},clear:()=>{le.forEach((Ae,Be)=>{Ae.usageCount<=0&&(Ae.usageCount<0&&console.warn("Reference usageCount below zero."),xe(Ae.value),le.delete(Be))})},get count(){return le.size},dispose:()=>{le.forEach(Ae=>xe(Ae.value)),le.clear()}}}var l=n(8382),m=n(7778);const u=(0,m.q)();function C(g){const _e=g.createRenderbuffer();if(null===_e)throw new Error("Could not create WebGL renderbuffer");return _e}var a=n(4648);const S=(0,m.q)();function D(g){const{vertexArrayObject:_e}=g;if(!_e)throw new Error("VertexArrayObject not supported");const xe=_e.createVertexArray();if(!xe)throw new Error("Could not create WebGL vertex array");return xe}function R(g){const{vertexArrayObject:_e}=g;if(null===_e)throw new Error("VertexArrayObject not supported");return _e}function E(g){return{...g.value,destroy:()=>{g.free()}}}function T(g,_e,xe,le){const Ae={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function Be(we,Oe){return Ae[we].add(Oe),xe.resourceCounts[we]+=1,{...Oe,destroy:()=>{Oe.destroy(),Ae[we].delete(Oe),xe.resourceCounts[we]-=1}}}const Ce=I(we=>JSON.stringify(we),we=>Be("shader",(0,O.g)(g,we)),we=>{we.destroy()});function Re(we,Oe){return E(Ce.get({type:we,source:Oe}))}const ke=I(we=>{var Oe;const Se=[we.shaderCode.id],Ve=(null===(Oe=we.defineValues.dRenderVariant)||void 0===Oe?void 0:Oe.ref.value)||"";return Object.keys(we.defineValues).forEach(Ne=>{var K,ne;null!==(ne=(K=we.shaderCode).ignoreDefine)&&void 0!==ne&&ne.call(K,Ne,Ve,we.defineValues)||Se.push((0,l.YZ)(Ne),function p(g){return"boolean"==typeof g?g?1:0:"number"==typeof g?1e4*g:(0,l.YZ)(g)}(we.defineValues[Ne].ref.value))}),(0,l.TI)(Se).toString()},we=>Be("program",(0,v.r)(g,_e,le,Re,we)),we=>{we.destroy()});return{attribute:(we,Oe,Se,Ve)=>Be("attribute",(0,b.Fu)(g,_e,le,we,Oe,Se,Ve)),elements:(we,Oe)=>Be("elements",(0,b.ki)(g,we,Oe)),framebuffer:()=>Be("framebuffer",(0,r.oN)(g)),program:(we,Oe,Se)=>E(ke.get({defineValues:we,shaderCode:Oe,schema:Se})),renderbuffer:(we,Oe,Se,Ve)=>Be("renderbuffer",function h(g,_e,xe,le,Ae){let Be=C(g);const Ce=()=>g.bindRenderbuffer(g.RENDERBUFFER,Be),Re=function d(g,_e){switch(_e){case"depth16":return g.DEPTH_COMPONENT16;case"stencil8":return g.STENCIL_INDEX8;case"rgba4":return g.RGBA4;case"depth-stencil":return g.DEPTH_STENCIL;case"depth24":if((0,o.C6)(g))return g.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if((0,o.C6)(g))return g.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if((0,o.C6)(g))return g.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if((0,o.C6)(g))return g.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}(g,_e),ke=function s(g,_e){switch(_e){case"depth":return g.DEPTH_ATTACHMENT;case"stencil":return g.STENCIL_ATTACHMENT;case"depth-stencil":return g.DEPTH_STENCIL_ATTACHMENT;case"color0":return g.COLOR_ATTACHMENT0}}(g,xe);function we(){Ce(),g.renderbufferStorage(g.RENDERBUFFER,Re,le,Ae)}we();let Oe=!1;return{id:u(),bind:Ce,attachFramebuffer:Se=>{Se.bind(),Ce(),g.framebufferRenderbuffer(g.FRAMEBUFFER,ke,g.RENDERBUFFER,Be),A.Bb&&(0,r.kD)(g)},detachFramebuffer:Se=>{Se.bind(),Ce(),g.framebufferRenderbuffer(g.FRAMEBUFFER,ke,g.RENDERBUFFER,null),A.Bb&&(0,r.kD)(g)},setSize:(Se,Ve)=>{le=Se,Ae=Ve,we()},reset:()=>{Be=C(g),we()},destroy:()=>{Oe||(g.deleteRenderbuffer(Be),Oe=!0)}}}(g,we,Oe,Se,Ve)),shader:Re,texture:(we,Oe,Se,Ve)=>Be("texture",(0,a.sZ)(g,le,we,Oe,Se,Ve)),cubeTexture:(we,Oe,Se)=>Be("cubeTexture",(0,a.ji)(g,we,Oe,Se)),vertexArray:(we,Oe,Se)=>Be("vertexArray",function f(g,_e,xe,le,Ae){const Be=S();let Ce=D(_e),Re=R(_e);function ke(){Re.bindVertexArray(Ce),Ae&&Ae.bind(),xe.bindAttributes(le),Re.bindVertexArray(null)}ke();let we=!1;return{id:Be,bind:()=>{Re.bindVertexArray(Ce)},update:ke,reset:()=>{Ce=D(_e),Re=R(_e),ke()},destroy:()=>{we||(Ae&&(Re.bindVertexArray(Ce),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null)),Re.deleteVertexArray(Ce),we=!0)}}}(g,le,we,Oe,Se)),getByteCounts:()=>{let we=0;Ae.texture.forEach(Ve=>{we+=Ve.getByteCount()}),Ae.cubeTexture.forEach(Ve=>{we+=Ve.getByteCount()});let Oe=0;Ae.attribute.forEach(Ve=>{Oe+=4*Ve.length});let Se=0;return Ae.elements.forEach(Ve=>{Se+=4*Ve.length}),{texture:we,attribute:Oe,elements:Se}},reset:()=>{Ae.attribute.forEach(we=>we.reset()),Ae.elements.forEach(we=>we.reset()),Ae.framebuffer.forEach(we=>we.reset()),Ae.renderbuffer.forEach(we=>we.reset()),Ae.shader.forEach(we=>we.reset()),Ae.program.forEach(we=>we.reset()),Ae.vertexArray.forEach(we=>we.reset()),Ae.texture.forEach(we=>we.reset())},destroy:()=>{Ae.attribute.forEach(we=>we.destroy()),Ae.elements.forEach(we=>we.destroy()),Ae.framebuffer.forEach(we=>we.destroy()),Ae.renderbuffer.forEach(we=>we.destroy()),Ae.shader.forEach(we=>we.destroy()),Ae.program.forEach(we=>we.destroy()),Ae.vertexArray.forEach(we=>we.destroy()),Ae.texture.forEach(we=>we.destroy()),Ce.clear(),ke.clear()}}}var L=n(2021),w=n(4412),Q=n(9854),G=n(2098);function V(g,_e){function xe(Ae){try{return g.getContext(Ae,_e)}catch{return null}}const le=(_e?.preferWebGl1?null:xe("webgl2"))||xe("webgl")||xe("experimental-webgl");return A.Bb&&console.log(`isWebgl2: ${(0,o.C6)(le)}`),le}function U(g,_e){switch(_e){case g.NO_ERROR:return"no error";case g.INVALID_ENUM:return"invalid enum";case g.INVALID_VALUE:return"invalid value";case g.INVALID_OPERATION:return"invalid operation";case g.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case g.OUT_OF_MEMORY:return"out of memory";case g.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function N(g){const _e=g.getError();if(_e!==g.NO_ERROR)throw new Error(`WebGL error: '${U(g,_e)}'`)}function $(g){g.bindFramebuffer(g.FRAMEBUFFER,null)}const J=new Uint8Array(4);function W(g,_e,xe){g.getSyncParameter(_e,g.SYNC_STATUS)===g.SIGNALED?(g.deleteSync(_e),xe()):t._F.setImmediate(W,g,_e,xe)}function te(g,_e){const xe=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);xe?t._F.setImmediate(W,g,xe,_e):(console.warn("Could not create a WebGLSync object"),g.readPixels(0,0,1,1,g.RGBA,g.UNSIGNED_BYTE,J),_e())}let de=!1;function j(g){g.bindFramebuffer(g.FRAMEBUFFER,null),g.readPixels(0,0,1,1,g.RGBA,g.UNSIGNED_BYTE,J)}function Z(g,_e,xe,le,Ae,Be){if(A.Bb&&(0,r.kD)(g),Be instanceof Uint8Array)g.readPixels(_e,xe,le,Ae,g.RGBA,g.UNSIGNED_BYTE,Be);else if(Be instanceof Float32Array)g.readPixels(_e,xe,le,Ae,g.RGBA,g.FLOAT,Be);else{if(!(Be instanceof Int32Array&&(0,o.C6)(g)))throw new Error("unsupported readPixels buffer type");g.readPixels(_e,xe,le,Ae,g.RGBA_INTEGER,g.INT,Be)}A.Bb&&N(g)}function ee(g,_e={}){const xe=y(g),le=function c(g,_e){let xe={},le=g.getParameter(g.FRONT_FACE),Ae=g.getParameter(g.CULL_FACE_MODE),Be=g.getParameter(g.DEPTH_WRITEMASK),Ce=g.getParameter(g.DEPTH_CLEAR_VALUE),Re=g.getParameter(g.DEPTH_FUNC),ke=g.getParameter(g.COLOR_WRITEMASK),we=g.getParameter(g.COLOR_CLEAR_VALUE),Oe=g.getParameter(g.BLEND_SRC_RGB),Se=g.getParameter(g.BLEND_DST_RGB),Ve=g.getParameter(g.BLEND_SRC_ALPHA),Ne=g.getParameter(g.BLEND_DST_ALPHA),K=g.getParameter(g.BLEND_COLOR),ne=g.getParameter(g.BLEND_EQUATION_RGB),be=g.getParameter(g.BLEND_EQUATION_ALPHA),Te=g.getParameter(g.STENCIL_FUNC),ie=g.getParameter(g.STENCIL_VALUE_MASK),ue=g.getParameter(g.STENCIL_REF),re=g.getParameter(g.STENCIL_BACK_FUNC),ve=g.getParameter(g.STENCIL_BACK_VALUE_MASK),ce=g.getParameter(g.STENCIL_BACK_REF),se=g.getParameter(g.STENCIL_WRITEMASK),ae=g.getParameter(g.STENCIL_BACK_WRITEMASK),ge=g.getParameter(g.STENCIL_FAIL),Ie=g.getParameter(g.STENCIL_PASS_DEPTH_PASS),Le=g.getParameter(g.STENCIL_PASS_DEPTH_FAIL),nt=g.getParameter(g.STENCIL_BACK_FAIL),je=g.getParameter(g.STENCIL_BACK_PASS_DEPTH_PASS),Lt=g.getParameter(g.STENCIL_BACK_PASS_DEPTH_FAIL),Je=g.getParameter(g.MAX_VERTEX_ATTRIBS);const en=[];let Bt=g.getParameter(g.VIEWPORT),pn=g.getParameter(g.SCISSOR_BOX),$e=_e.clipControl?g.getParameter(_e.clipControl.CLIP_ORIGIN):-1,mt=_e.clipControl?g.getParameter(_e.clipControl.CLIP_DEPTH_MODE):-1;const _t=()=>{for(let Me=0;Me<Je;++Me)en[Me]=0};return _t(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:Me=>{!0!==xe[Me]&&(g.enable(Me),xe[Me]=!0)},disable:Me=>{!1!==xe[Me]&&(g.disable(Me),xe[Me]=!1)},frontFace:Me=>{Me!==le&&(g.frontFace(Me),le=Me)},cullFace:Me=>{Me!==Ae&&(g.cullFace(Me),Ae=Me)},depthMask:Me=>{Me!==Be&&(g.depthMask(Me),Be=Me)},clearDepth:Me=>{Me!==Ce&&(g.clearDepth(Me),Ce=Me)},depthFunc:Me=>{Me!==Re&&(g.depthFunc(Me),Re=Me)},colorMask:(Me,Ke,ut,Kt)=>{(Me!==ke[0]||Ke!==ke[1]||ut!==ke[2]||Kt!==ke[3])&&(g.colorMask(Me,Ke,ut,Kt),ke[0]=Me,ke[1]=Ke,ke[2]=ut,ke[3]=Kt)},clearColor:(Me,Ke,ut,Kt)=>{(Me!==we[0]||Ke!==we[1]||ut!==we[2]||Kt!==we[3])&&(g.clearColor(Me,Ke,ut,Kt),we[0]=Me,we[1]=Ke,we[2]=ut,we[3]=Kt)},blendFunc:(Me,Ke)=>{(Me!==Oe||Ke!==Se||Me!==Ve||Ke!==Ne)&&(g.blendFunc(Me,Ke),Oe=Me,Se=Ke,Ve=Me,Ne=Ke)},blendFuncSeparate:(Me,Ke,ut,Kt)=>{(Me!==Oe||Ke!==Se||ut!==Ve||Kt!==Ne)&&(g.blendFuncSeparate(Me,Ke,ut,Kt),Oe=Me,Se=Ke,Ve=ut,Ne=Kt)},blendEquation:Me=>{(Me!==ne||Me!==be)&&(g.blendEquation(Me),ne=Me,be=Me)},blendEquationSeparate:(Me,Ke)=>{(Me!==ne||Ke!==be)&&(g.blendEquationSeparate(Me,Ke),ne=Me,be=Ke)},blendColor:(Me,Ke,ut,Kt)=>{(Me!==K[0]||Ke!==K[1]||ut!==K[2]||Kt!==K[3])&&(g.blendColor(Me,Ke,ut,Kt),K[0]=Me,K[1]=Ke,K[2]=ut,K[3]=Kt)},stencilFunc:(Me,Ke,ut)=>{(Me!==Te||Ke!==ue||ut!==ie||Me!==re||Ke!==ce||ut!==ve)&&(g.stencilFunc(Me,Ke,ut),Te=Me,ue=Ke,ie=ut,re=Me,ce=Ke,ve=ut)},stencilFuncSeparate:(Me,Ke,ut,Kt)=>{Me===g.FRONT?(Ke!==Te||ut!==ue||Kt!==ie)&&(g.stencilFuncSeparate(Me,Ke,ut,Kt),Te=Ke,ue=ut,ie=Kt):Me===g.BACK?(Ke!==re||ut!==ce||Kt!==ve)&&(g.stencilFuncSeparate(Me,Ke,ut,Kt),re=Ke,ce=ut,ve=Kt):Me===g.FRONT_AND_BACK&&(Ke!==Te||ut!==ue||Kt!==ie||Ke!==re||ut!==ce||Kt!==ve)&&(g.stencilFuncSeparate(Me,Ke,ut,Kt),Te=Ke,ue=ut,ie=Kt,re=Ke,ce=ut,ve=Kt)},stencilMask:Me=>{(Me!==se||Me!==ae)&&(g.stencilMask(Me),se=Me,ae=Me)},stencilMaskSeparate:(Me,Ke)=>{Me===g.FRONT?Ke!==se&&(g.stencilMaskSeparate(Me,Ke),se=Ke):Me===g.BACK?Ke!==ae&&(g.stencilMaskSeparate(Me,Ke),ae=Ke):Me===g.FRONT_AND_BACK&&(Ke!==se||Ke!==ae)&&(g.stencilMaskSeparate(Me,Ke),se=Ke,ae=Ke)},stencilOp:(Me,Ke,ut)=>{(Me!==ge||Ke!==Le||ut!==Ie||Me!==nt||Ke!==Lt||ut!==je)&&(g.stencilOp(Me,Ke,ut),ge=Me,Le=Ke,Ie=ut,nt=Me,Lt=Ke,je=ut)},stencilOpSeparate:(Me,Ke,ut,Kt)=>{Me===g.FRONT?(Ke!==ge||ut!==Le||Kt!==Ie)&&(g.stencilOpSeparate(Me,Ke,ut,Kt),ge=Ke,Le=ut,Ie=Kt):Me===g.BACK?(Ke!==nt||ut!==Lt||Kt!==je)&&(g.stencilOpSeparate(Me,Ke,ut,Kt),nt=Ke,Lt=ut,je=Kt):Me===g.FRONT_AND_BACK&&(Ke!==ge||ut!==Le||Kt!==Ie||Ke!==nt||ut!==Lt||Kt!==je)&&(g.stencilOpSeparate(Me,Ke,ut,Kt),ge=Ke,Le=ut,Ie=Kt,nt=Ke,Lt=ut,je=Kt)},enableVertexAttrib:Me=>{g.enableVertexAttribArray(Me),en[Me]=1},clearVertexAttribsState:_t,disableUnusedVertexAttribs:()=>{for(let Me=0;Me<Je;++Me)0===en[Me]&&g.disableVertexAttribArray(Me)},viewport:(Me,Ke,ut,Kt)=>{(Me!==Bt[0]||Ke!==Bt[1]||ut!==Bt[2]||Kt!==Bt[3])&&(g.viewport(Me,Ke,ut,Kt),Bt[0]=Me,Bt[1]=Ke,Bt[2]=ut,Bt[3]=Kt)},scissor:(Me,Ke,ut,Kt)=>{(Me!==pn[0]||Ke!==pn[1]||ut!==pn[2]||Kt!==pn[3])&&(g.scissor(Me,Ke,ut,Kt),pn[0]=Me,pn[1]=Ke,pn[2]=ut,pn[3]=Kt)},clipControl:_e.clipControl?(Me,Ke)=>{(Me!==$e||Ke!==mt)&&(_e.clipControl.clipControl(Me,Ke),$e=Me,mt=Ke)}:void 0,reset:()=>{xe={},le=g.getParameter(g.FRONT_FACE),Ae=g.getParameter(g.CULL_FACE_MODE),Be=g.getParameter(g.DEPTH_WRITEMASK),Ce=g.getParameter(g.DEPTH_CLEAR_VALUE),Re=g.getParameter(g.DEPTH_FUNC),ke=g.getParameter(g.COLOR_WRITEMASK),we=g.getParameter(g.COLOR_CLEAR_VALUE),Oe=g.getParameter(g.BLEND_SRC_RGB),Se=g.getParameter(g.BLEND_DST_RGB),Ve=g.getParameter(g.BLEND_SRC_ALPHA),Ne=g.getParameter(g.BLEND_DST_ALPHA),K=g.getParameter(g.BLEND_COLOR),ne=g.getParameter(g.BLEND_EQUATION_RGB),be=g.getParameter(g.BLEND_EQUATION_ALPHA),Te=g.getParameter(g.STENCIL_FUNC),ie=g.getParameter(g.STENCIL_VALUE_MASK),ue=g.getParameter(g.STENCIL_REF),re=g.getParameter(g.STENCIL_BACK_FUNC),ve=g.getParameter(g.STENCIL_BACK_VALUE_MASK),ce=g.getParameter(g.STENCIL_BACK_REF),se=g.getParameter(g.STENCIL_WRITEMASK),ae=g.getParameter(g.STENCIL_BACK_WRITEMASK),ge=g.getParameter(g.STENCIL_FAIL),Ie=g.getParameter(g.STENCIL_PASS_DEPTH_PASS),Le=g.getParameter(g.STENCIL_PASS_DEPTH_FAIL),nt=g.getParameter(g.STENCIL_BACK_FAIL),je=g.getParameter(g.STENCIL_BACK_PASS_DEPTH_PASS),Lt=g.getParameter(g.STENCIL_BACK_PASS_DEPTH_FAIL),Je=g.getParameter(g.MAX_VERTEX_ATTRIBS),en.length=0;for(let Me=0;Me<Je;++Me)en[Me]=0;Bt=g.getParameter(g.VIEWPORT),pn=g.getParameter(g.SCISSOR_BOX),$e=_e.clipControl?g.getParameter(_e.clipControl.CLIP_ORIGIN):-1,mt=_e.clipControl?g.getParameter(_e.clipControl.CLIP_DEPTH_MODE):-1}}}(g,xe),Ae={resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}},Be=T(g,le,Ae,xe),Ce=(0,G.C)(g,xe,Ae),Re={maxTextureSize:g.getParameter(g.MAX_TEXTURE_SIZE),max3dTextureSize:(0,o.C6)(g)?g.getParameter(g.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:g.getParameter(g.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:xe.drawBuffers?g.getParameter(xe.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:g.getParameter(g.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(Re.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');const ke=xe.provokingVertex;ke?.provokingVertex(ke.FIRST_VERTEX_CONVENTION);let we=!1;const Oe=new w.t(0);let Ve,Se=_e.pixelScale||1;if((0,o.C6)(g)){const K=g.createBuffer();let ne,be,Te=!1;const ie=()=>{g.bindBuffer(g.PIXEL_PACK_BUFFER,K),g.getBufferSubData(g.PIXEL_PACK_BUFFER,0,ne),g.bindBuffer(g.PIXEL_PACK_BUFFER,null),Te=!1,be(),be=void 0,ne=void 0};Ve=(ue,re,ve,ce,se)=>new Promise((ae,ge)=>{Te?ge("Can not call multiple readPixelsAsync at the same time"):(Te=!0,g.bindBuffer(g.PIXEL_PACK_BUFFER,K),g.bufferData(g.PIXEL_PACK_BUFFER,ve*ce*4,g.STREAM_READ),g.readPixels(ue,re,ve,ce,g.RGBA,g.UNSIGNED_BYTE,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null),be=ae,ne=se,te(g,ie))})}else Ve=function(){var K=(0,e.A)(function*(ne,be,Te,ie,ue){Z(g,ne,be,Te,ie,ue)});return function(be,Te,ie,ue,re){return K.apply(this,arguments)}}();const Ne=new Set;return{gl:g,isWebGL2:(0,o.C6)(g),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(Se||1)},extensions:xe,state:le,stats:Ae,resources:Be,timer:Ce,get maxTextureSize(){return Re.maxTextureSize},get max3dTextureSize(){return Re.max3dTextureSize},get maxRenderbufferSize(){return Re.maxRenderbufferSize},get maxDrawBuffers(){return Re.maxDrawBuffers},get maxTextureImageUnits(){return Re.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return we||g.isContextLost()},contextRestored:Oe,setContextLost:()=>{we=!0,Ce.clear()},handleContextRestored:K=>{Object.assign(xe,y(g)),le.reset(),le.currentMaterialId=-1,le.currentProgramId=-1,le.currentRenderItemId=-1,Be.reset(),Ne.forEach(ne=>ne.reset()),K?.(),we=!1,Oe.next((0,Q.t)())},setPixelScale:K=>{Se=K},createRenderTarget:(K,ne,be,Te,ie,ue)=>{const re=(0,L.m)(g,Be,K,ne,be,Te,ie,ue);return Ne.add(re),{...re,destroy:()=>{re.destroy(),Ne.delete(re)}}},unbindFramebuffer:()=>$(g),readPixels:(K,ne,be,Te,ie)=>{Z(g,K,ne,be,Te,ie)},readPixelsAsync:Ve,waitForGpuCommandsComplete:()=>function ye(g){return new Promise(_e=>{(0,o.C6)(g)?te(g,_e):(de||(console.info("Sync object not supported in WebGL"),de=!0),j(g),_e())})}(g),waitForGpuCommandsCompleteSync:()=>j(g),getDrawingBufferPixelData:()=>function q(g,_e){const xe=g.drawingBufferWidth,le=g.drawingBufferHeight,Ae=new Uint8Array(xe*le*4);return $(g),_e.viewport(0,0,xe,le),Z(g,0,0,xe,le,Ae),i.N.flipY(i.N.create(Ae,xe,le))}(g,le),clear:(K,ne,be,Te)=>{$(g),le.enable(g.SCISSOR_TEST),le.depthMask(!0),le.colorMask(!0,!0,!0,!0),le.clearColor(K,ne,be,Te),le.viewport(0,0,g.drawingBufferWidth,g.drawingBufferHeight),le.scissor(0,0,g.drawingBufferWidth,g.drawingBufferHeight),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)},destroy:K=>{var ne,be;Be.destroy(),function H(g){const _e=g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS);for(let Ae=0;Ae<_e;++Ae)g.activeTexture(g.TEXTURE0+Ae),g.bindTexture(g.TEXTURE_2D,null),g.bindTexture(g.TEXTURE_CUBE_MAP,null),(0,o.C6)(g)&&(g.bindTexture(g.TEXTURE_2D_ARRAY,null),g.bindTexture(g.TEXTURE_3D,null));const xe=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,xe);const le=g.getParameter(g.MAX_VERTEX_ATTRIBS);for(let Ae=0;Ae<le;++Ae)g.vertexAttribPointer(Ae,1,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,null),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null),g.bindRenderbuffer(g.RENDERBUFFER,null),$(g)}(g),K?.doNotForceWebGLContextLoss||(null===(ne=g.getExtension("WEBGL_lose_context"))||void 0===ne||ne.loseContext(),null===(be=g.getExtension("STACKGL_destroy_context"))||void 0===be||be.destroy())}}}},3648:(tn,Ue,n)=>{"use strict";n.d(Ue,{Vv:()=>i,kD:()=>A,oN:()=>c});var e=n(7778),o=n(8437);const r=(0,e.q)();function A(v){const O=v.checkFramebufferStatus(v.FRAMEBUFFER);if(O!==v.FRAMEBUFFER_COMPLETE){const b=function t(v,O){switch(O){case v.FRAMEBUFFER_COMPLETE:return"complete";case v.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case v.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case v.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case v.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if((0,o.C6)(v))switch(O){case v.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case v.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}(v,O);throw new Error(`Framebuffer status: ${b}`)}}function y(v){const O=v.createFramebuffer();if(null===O)throw new Error("Could not create WebGL framebuffer");return O}function c(v){let O=y(v),b=!1;return{id:r(),bind:()=>v.bindFramebuffer(v.FRAMEBUFFER,O),reset:()=>{O=y(v)},destroy:()=>{b||(v.deleteFramebuffer(O),b=!0)}}}function i(){return{id:r(),bind:()=>{},reset:()=>{},destroy:()=>{}}}},7579:(tn,Ue,n)=>{"use strict";n.d(Ue,{J:()=>_,r:()=>M});var e=n(2897),o=n(2879),r=n(4677),t=n(7778),A=n(2629),y=n(8437);const c=(0,t.q)();function _(I){const l=I.createProgram();if(null===l)throw new Error("Could not create WebGL program");return l}function M(I,l,m,u,d){const{defineValues:s,shaderCode:C,schema:h}=d;let a=_(I);const S=c(),D=(0,e.NB)(I,m,s,C),R=u("vert",D.vert),f=u("frag",D.frag);let p,E;function T(){R.attach(a),f.attach(a),I.linkProgram(a),A.Bb&&function b(I,l){if(!I.getProgramParameter(l,I.LINK_STATUS))throw new Error(`Could not compile WebGL program. \n\n${I.getProgramInfoLog(l)}`)}(I,a),p=function i(I,l,m){const u={};return Object.keys(m).forEach(d=>{const s=m[d];if("attribute"===s.type){const C=I.getAttribLocation(l,d);u[d]=C}else if("uniform"===s.type){let C=I.getUniformLocation(l,d);null===C&&(0,o.a5)(s.kind)&&(C=I.getUniformLocation(l,d+"[0]")),u[d]=C}else if("texture"===s.type){const C=I.getUniformLocation(l,d);u[d]=C}}),u}(I,a,h),E=(0,o.Pi)(h),A.Bb&&(function v(I,l,m){const u=I.getProgramParameter(l,I.ACTIVE_ATTRIBUTES);for(let d=0;d<u;++d){const s=I.getActiveAttrib(l,d);if(s){const{name:C,type:h}=s;if(C.startsWith("__activeAttribute")||"gl_InstanceID"===C||"gl_VertexID"===C||"gl_DrawID"===C)continue;const a=m[C];if(void 0===a)throw new Error(`missing 'uniform' or 'texture' with name '${C}' in schema`);if("attribute"!==a.type)throw new Error(`'${C}' must be of type 'attribute' but is '${a.type}'`);const S=(0,r.xB)(I,a.kind,a.itemSize);if(S!==h)throw new Error(`unexpected attribute type '${S}' for ${C}, expected '${h}'`)}}}(I,a,h),function O(I,l,m){const u=I.getProgramParameter(l,I.ACTIVE_UNIFORMS);for(let d=0;d<u;++d){const s=I.getActiveUniform(l,d);if(s){const{name:C,type:h}=s;if(C.startsWith("__activeUniform")||"gl_InstanceID"===C||"gl_VertexID"===C||"gl_DrawID"===C)continue;const S=m[C.replace(/[[0-9]+\]$/,"")];if(void 0===S)throw new Error(`missing 'uniform' or 'texture' with name '${C}' in schema`);if("uniform"===S.type){if((0,o.NM)(I,S.kind)!==h)throw new Error(`unexpected uniform type for ${C}`)}else{if("texture"!==S.type)throw new Error(`'${C}' must be of type 'uniform' or 'texture' but is '${S.type}'`);if("image-float32"===S.kind||"image-uint8"===S.kind){if(h!==I.SAMPLER_2D)throw new Error(`unexpected sampler type for '${C}'`)}else if("volume-float32"===S.kind||"volume-uint8"===S.kind){if(!(0,y.C6)(I))throw new Error("WebGL2 is required to use SAMPLER_3D");if(h!==I.SAMPLER_3D)throw new Error(`unexpected sampler type for '${C}'`)}}}}}(I,a,h))}T();let L=!1;return{id:S,use:()=>{l.currentProgramId=S,I.useProgram(a)},setUniforms:w=>{for(let Q=0,G=w.length;Q<G;++Q){const[V,U]=w[Q];if(U){const N=p[V];null!==N&&E[V](I,N,U.ref.value)}}},uniform:(w,Q)=>{const G=p[w];null!==G&&E[w](I,G,Q)},bindAttributes:w=>{l.clearVertexAttribsState();for(let Q=0,G=w.length;Q<G;++Q){const[V,U]=w[Q],N=p[V];-1!==N&&U.bind(N)}l.disableUnusedVertexAttribs()},offsetAttributes:(w,Q)=>{for(let G=0,V=w.length;G<V;++G){const[U,N]=w[G],k=p[U];-1!==k&&N.changeOffset(k,Q)}},bindTextures:(w,Q)=>{for(let G=0,V=w.length;G<V;++G){const[U,N]=w[G],k=p[U];null!=k&&(N.bind(G+Q),E[U](I,k,G+Q))}},reset:()=>{a=_(I),T()},destroy:()=>{L||(R.destroy(),f.destroy(),I.deleteProgram(a),L=!0)}}}},4143:(tn,Ue,n)=>{"use strict";n.d(Ue,{$h:()=>S,vC:()=>a});var e=n(4677),o=n(4648),r=n(6349),t=n(4511),A=n(7778),y=n(9909),c=n(3648),i=n(2629),v=n(6115),O=n(9359),b=n(2879);const _=(0,A.q)(),l=Object.keys({color:"",pick:"",depth:"",marking:"",emissive:""}),u=Object.keys({compute:""});function d(R,f,p,E,T){return p={...p,dRenderVariant:y.IQ.create(f)},void 0===T.dRenderVariant&&Object.defineProperty(T,"dRenderVariant",{value:(0,t.$F)("string")}),R.resources.program(p,E,T)}function h(R,f){if("color"===R)switch(f){case"blended":return"colorBlended";case"wboit":return"colorWboit";case"dpoit":return"colorDpoit"}return R}function a(R,f,p,E,T,L,w){return D(R,f,p,E,T,L,l,w)}function S(R,f,p,E,T,L=-1){return D(R,f,p,E,T,L,u,void 0)}function D(R,f,p,E,T,L,w,Q){const G=_(),{stats:V,state:U,resources:N}=R,{instancedArrays:k,vertexArrayObject:H,multiDrawInstancedBaseVertexBaseInstance:$,drawInstancedBaseVertexBaseInstance:J}=R.extensions;T.uVertexCount&&!R.extensions.noNonInstancedActiveAttribs&&(T.aVertex=y.IQ.create((0,v.WE)(new Float32Array(T.uVertexCount.ref.value))),E.aVertex=(0,t.Yz)("float32",1,0));const{attributeValues:W,defineValues:te,textureValues:de,materialTextureValues:ye,uniformValues:j,materialUniformValues:Z,bufferedUniformValues:q}=(0,t.tC)(E,T),Y=Object.entries(j),ee=Object.entries(Z),g=Object.entries(q),_e=Object.entries((0,b.kB)(q)),xe=Object.entries(te),le=(0,t.fb)(T),Ae=function M(R,f){const{gl:p}=R;switch(f){case"points":return p.POINTS;case"lines":return p.LINES;case"line-strip":return p.LINE_STRIP;case"line-loop":return p.LINE_LOOP;case"triangles":return p.TRIANGLES;case"triangle-strip":return p.TRIANGLE_STRIP;case"triangle-fan":return p.TRIANGLE_FAN}}(R,f),Be={};for(const ie of w)Be[ie]=d(R,h(ie,Q),te,p,E);const Ce=(0,o.z1)(R,E,de),Re=(0,o.z1)(R,E,ye),ke=(0,e.oq)(R,E,W),we=[];for(let ie=0,ue=ke.length;ie<ue;++ie){const re=ke[ie];1===re[1].divisor&&we.push(re)}let Oe;const Se=T.elements;Se&&Se.ref.value&&(Oe=N.elements(Se.ref.value));const Ve={};for(const ie of w)Ve[ie]=H?N.vertexArray(Be[ie],ke,Oe):null;let Ne=T.drawCount.ref.value,K=T.instanceCount.ref.value;V.drawCount+=Ne,V.instanceCount+=K,V.instancedDrawCount+=K*Ne;const ne={attributes:!1,defines:!1,elements:!1,textures:!1};let be=!1,Te=-1;return{id:G,materialId:L,getProgram:ie=>Be[ie],setTransparency:ie=>{if(ie!==Q){Q=ie;for(const ue of w)Be[ue].destroy(),Be[ue]=d(R,h(ue,Q),te,p,E)}},render:(ie,ue,re)=>{if(0===Ne||0===K)return;const ve=Be[ie];if(ve.id===Te&&U.currentRenderItemId===G)ve.setUniforms(Y),ve.bindTextures(Ce,ue);else{const ce=Ve[ie];(ve.id!==U.currentProgramId||ve.id!==Te||-1===L||L!==U.currentMaterialId)&&(ve.id!==U.currentProgramId&&ve.use(),ve.setUniforms(ee),ve.bindTextures(Re,ue+Ce.length),U.currentMaterialId=L,Te=ve.id),ve.setUniforms(Y),ve.setUniforms(_e),ve.bindTextures(Ce,ue),ce?(ce.bind(),Oe&&Oe.bind()):(Oe&&Oe.bind(),ve.bindAttributes(ke)),U.currentRenderItemId=G}if(i.Bb)try{(0,c.kD)(R.gl)}catch(ce){throw new Error(`Framebuffer error rendering item id ${G}: '${ce}'`)}if(re){for(const ce of re)if(0!==ce.count){if(ve.setUniforms(ce.uniforms),$)Oe?$.multiDrawElementsInstancedBaseVertexBaseInstance(Ae,ce.counts,0,Oe._dataType,ce.offsets,0,ce.instanceCounts,0,ce.baseVertices,0,ce.baseInstances,0,ce.count):$.multiDrawArraysInstancedBaseInstance(Ae,ce.firsts,0,ce.counts,0,ce.instanceCounts,0,ce.baseInstances,0,ce.count);else if(J)if(Oe)for(let se=0;se<ce.count;++se)ce.counts[se]>0&&(ve.uniform("uDrawId",se),J.drawElementsInstancedBaseVertexBaseInstance(Ae,ce.counts[se],Oe._dataType,ce.offsets[se],ce.instanceCounts[se],ce.baseVertices[se],ce.baseInstances[se]));else for(let se=0;se<ce.count;++se)ce.counts[se]>0&&(ve.uniform("uDrawId",se),J.drawArraysInstancedBaseInstance(Ae,ce.firsts[se],ce.counts[se],ce.instanceCounts[se],ce.baseInstances[se]));else if(Oe)for(let se=0;se<ce.count;++se)ce.counts[se]>0&&(ve.uniform("uDrawId",se),ve.offsetAttributes(we,ce.baseInstances[se]),k.drawElementsInstanced(Ae,ce.counts[se],Oe._dataType,ce.offsets[se],ce.instanceCounts[se]));else for(let se=0;se<ce.count;++se)ce.counts[se]>0&&(ve.uniform("uDrawId",se),ve.offsetAttributes(we,ce.baseInstances[se]),k.drawArraysInstanced(Ae,0,ce.counts[se],ce.instanceCounts[se]));if(i.g$){$?V.calls.multiDrawInstancedBase+=1:J?V.calls.drawInstancedBase+=ce.count:V.calls.drawInstanced+=ce.count;for(let se=0;se<ce.count;++se)V.calls.counts+=ce.instanceCounts[se]}}}else Oe?k.drawElementsInstanced(Ae,Ne,Oe._dataType,0,K):k.drawArraysInstanced(Ae,0,Ne,K),i.g$&&(V.calls.drawInstanced+=1,V.calls.counts+=K);if(i.Bb)try{(0,r.Lq)(R.gl)}catch(ce){throw new Error(`Draw error rendering item id ${G}: '${ce}'`)}},update:()=>{if(function C(R){R.attributes=!1,R.defines=!1,R.elements=!1,R.textures=!1}(ne),T.aVertex){const ie=T.uVertexCount.ref.value;T.aVertex.ref.value.length<ie&&y.IQ.update(T.aVertex,(0,v.WE)(new Float32Array(ie)))}for(let ie=0,ue=xe.length;ie<ue;++ie){const[re,ve]=xe[ie];ve.ref.version!==le[re]&&(ne.defines=!0,le[re]=ve.ref.version)}if(ne.defines)for(const ie of w)Be[ie].destroy(),Be[ie]=d(R,h(ie,Q),te,p,E);T.drawCount.ref.version!==le.drawCount&&(V.drawCount+=T.drawCount.ref.value-Ne,V.instancedDrawCount+=K*T.drawCount.ref.value-K*Ne,Ne=T.drawCount.ref.value,le.drawCount=T.drawCount.ref.version),T.instanceCount.ref.version!==le.instanceCount&&(V.instanceCount+=T.instanceCount.ref.value-K,V.instancedDrawCount+=T.instanceCount.ref.value*Ne-K*Ne,K=T.instanceCount.ref.value,le.instanceCount=T.instanceCount.ref.version);for(let ie=0,ue=ke.length;ie<ue;++ie){const[re,ve]=ke[ie],ce=W[re];if(ce.ref.version!==le[re]){if(ve.length>=ce.ref.value.length)ve.updateSubData(ce.ref.value,0,ve.length);else{ve.destroy();const{itemSize:se,divisor:ae}=E[re];ke[ie][1]=N.attribute(ce.ref.value,se,ae),ne.attributes=!0}le[re]=ce.ref.version}}if(Oe&&T.elements.ref.version!==le.elements&&(Oe.length>=T.elements.ref.value.length?Oe.updateSubData(T.elements.ref.value,0,Oe.length):(Oe.destroy(),Oe=N.elements(T.elements.ref.value),ne.elements=!0),le.elements=T.elements.ref.version),ne.attributes||ne.defines||ne.elements)for(const ie of w){const ue=Ve[ie];ue&&ue.destroy(),Ve[ie]=H?N.vertexArray(Be[ie],ke,Oe):null}for(let ie=0,ue=Ce.length;ie<ue;++ie){const[re,ve]=Ce[ie],ce=de[re];ce.ref.version!==le[re]&&("texture"!==E[re].kind?(ve.load(ce.ref.value),ne.textures=!0):Ce[ie][1]=ce.ref.value,le[re]=ce.ref.version)}for(let ie=0,ue=Re.length;ie<ue;++ie){const[re,ve]=Re[ie],ce=ye[re];ce.ref.version!==le[re]&&("texture"!==E[re].kind?(ve.load(ce.ref.value),ne.textures=!0):Re[ie][1]=ce.ref.value,le[re]=ce.ref.version)}for(let ie=0,ue=g.length;ie<ue;++ie){const[re,ve]=g[ie];ve.ref.version!==le[re]&&(y.IQ.update(_e[ie][1],(0,O.Go)(ve.ref.value)),le[re]=ve.ref.version)}},destroy:()=>{if(!be){for(const ie of w){Be[ie].destroy();const ue=Ve[ie];ue&&ue.destroy()}Ce.forEach(([ie,ue])=>{"texture"!==E[ie].kind&&ue.destroy()}),Re.forEach(([ie,ue])=>{"texture"!==E[ie].kind&&ue.destroy()}),ke.forEach(([ie,ue])=>ue.destroy()),Oe&&Oe.destroy(),V.drawCount-=Ne,V.instanceCount-=K,V.instancedDrawCount-=K*Ne,be=!0}}}}},2021:(tn,Ue,n)=>{"use strict";n.d(Ue,{T:()=>c,m:()=>y});var e=n(7778),o=n(4648),r=n(3648),t=n(8437);const A=(0,e.q)();function y(i,v,O,b,_=!0,M="uint8",I="nearest",l="rgba"){if("alpha"===l&&!(0,t.C6)(i))throw new Error("cannot render to alpha format in webgl1");const m=v.framebuffer(),u="fp16"===M?v.texture("image-float16",l,"fp16",I):"float32"===M?v.texture("image-float32",l,"float",I):v.texture("image-uint8",l,"ubyte",I),d=_?(0,t.C6)(i)?v.renderbuffer("depth32f","depth",O,b):v.renderbuffer("depth16","depth",O,b):null;function s(){u.define(O,b),u.attachFramebuffer(m,"color0"),d&&d.attachFramebuffer(m)}s();let C=!1;return{id:A(),texture:u,framebuffer:m,depthRenderbuffer:d,getWidth:()=>O,getHeight:()=>b,bind:()=>{m.bind()},setSize:(h,a)=>{O===h&&b===a||(u.define(O=h,b=a),d&&d.setSize(O,b))},reset:()=>{s()},destroy:()=>{C||(u.destroy(),m.destroy(),d&&d.destroy(),C=!0)}}}function c(i){return{id:A(),texture:(0,o.z6)(i),framebuffer:(0,r.Vv)(),depthRenderbuffer:null,getWidth:()=>0,getHeight:()=>0,bind:()=>{i.bindFramebuffer(i.FRAMEBUFFER,null)},setSize:()=>{},reset:()=>{},destroy:()=>{}}}},4098:(tn,Ue,n)=>{"use strict";n.d(Ue,{A:()=>A,g:()=>y});var e=n(7778),o=n(2629);const r=(0,e.q)();function A(c,i){const{type:v,source:O}=i,b=c.createShader("vert"===v?c.VERTEX_SHADER:c.FRAGMENT_SHADER);if(null===b)throw new Error(`Error creating ${v} shader`);if(c.shaderSource(b,O),c.compileShader(b),o.Bb&&!1===c.getShaderParameter(b,c.COMPILE_STATUS))throw console.warn(`'${v}' shader info log '${c.getShaderInfoLog(b)}'\n${function t(c){const i=c.split("\n");for(let v=0;v<i.length;++v)i[v]=v+1+": "+i[v];return i.join("\n")}(O)}`),new Error(`Error compiling ${v} shader`);return b}function y(c,i){let v=A(c,i);return{id:r(),attach:O=>{c.attachShader(O,v)},reset:()=>{v=A(c,i)},destroy:()=>{c.deleteShader(v)}}}},4648:(tn,Ue,n)=>{"use strict";n.d(Ue,{NP:()=>p,ji:()=>R,pg:()=>S,sZ:()=>h,z1:()=>a,z6:()=>E});var e=n(9909),o=n(7778),r=n(8437),t=n(1372),A=n(9359),y=n(4490);const c=(0,o.q)();function v(T,L,w){switch(L){case"alpha":return(0,r.C6)(T)&&"float"===w?T.RED:(0,r.C6)(T)&&"int"===w?T.RED_INTEGER:T.ALPHA;case"rgb":return(0,r.C6)(T)&&"int"===w?T.RGB_INTEGER:T.RGB;case"rg":if((0,r.C6)(T)&&"float"===w)return T.RG;if((0,r.C6)(T)&&"int"===w)return T.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return(0,r.C6)(T)&&"int"===w?T.RGBA_INTEGER:T.RGBA;case"depth":return T.DEPTH_COMPONENT}}function b(T,L,w,Q,G){return function _(T){switch(T){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":case"depth":return 4}}(T)*function M(T){switch(T){case"ubyte":return 1;case"ushort":case"fp16":return 2;case"float":case"int":return 4}}(L)*w*Q*(G||1)}function l(T,L){switch(L){case"nearest":return T.NEAREST;case"linear":return T.LINEAR}}function m(T,L,w){switch(w){case"depth":return T.DEPTH_ATTACHMENT;case"stencil":return T.STENCIL_ATTACHMENT;case"color0":case 0:return T.COLOR_ATTACHMENT0}if(L.drawBuffers)switch(w){case"color1":case 1:return L.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return L.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return L.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return L.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return L.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return L.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return L.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function u(T){return typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement}function s(T,L,w){return L===w.TEXTURE_3D}function C(T){const L=T.createTexture();if(null===L)throw new Error("Could not create WebGL texture");return L}function h(T,L,w,Q,G,V){const U=c();let N=C(T);if(w.endsWith("float32")&&"float"!==G||w.endsWith("float16")&&"fp16"!==G||w.endsWith("uint8")&&"ubyte"!==G||w.endsWith("int32")&&"int"!==G||w.endsWith("depth")&&"ushort"!==G&&"float"!==G)throw new Error(`texture kind '${w}' and type '${G}' are incompatible`);if(!L.depthTexture&&"depth"===Q)throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");const k=function i(T,L){switch(L){case"image-uint8":case"image-float32":case"image-float16":case"image-depth":return T.TEXTURE_2D}if((0,r.C6)(T))switch(L){case"image-int32":return T.TEXTURE_2D;case"volume-uint8":case"volume-float32":case"volume-float16":return T.TEXTURE_3D}throw new Error(`unknown texture kind '${L}'`)}(T,w),H=l(T,V),$=v(T,Q,G),J=function O(T,L,w){if((0,r.C6)(T))switch(L){case"alpha":switch(w){case"ubyte":return T.ALPHA;case"float":return T.R32F;case"fp16":return T.R16F;case"int":return T.R32I}case"rg":switch(w){case"ubyte":return T.RG;case"float":return T.RG32F;case"fp16":return T.RG16F;case"int":return T.RG32I}case"rgb":switch(w){case"ubyte":return T.RGB;case"float":return T.RGB32F;case"fp16":return T.RGB16F;case"int":return T.RGB32I}case"rgba":switch(w){case"ubyte":return T.RGBA;case"float":return T.RGBA32F;case"fp16":return T.RGBA16F;case"int":return T.RGBA32I}case"depth":switch(w){case"ushort":return T.DEPTH_COMPONENT16;case"float":return T.DEPTH_COMPONENT32F}}return v(T,L,w)}(T,Q,G),W=function I(T,L,w){switch(w){case"ubyte":return T.UNSIGNED_BYTE;case"ushort":return T.UNSIGNED_SHORT;case"float":return T.FLOAT;case"fp16":if(L.textureHalfFloat)return L.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if((0,r.C6)(T))return T.INT;throw new Error('texture type "int" requires webgl2')}}(T,L,G);function te(){T.bindTexture(k,N),T.texParameteri(k,T.TEXTURE_MAG_FILTER,H),T.texParameteri(k,T.TEXTURE_MIN_FILTER,H),T.texParameteri(k,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(k,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.bindTexture(k,null)}te();let Z,de=0,ye=0,j=0,q=!1,Y=!1;function ee(le,Ae,Be){if(0===le||0===Ae||(0,r.C6)(T)&&k===T.TEXTURE_3D&&0===Be)throw new Error("empty textures are not allowed");if(de!==le||ye!==Ae||j!==(Be||0))if(de=le,ye=Ae,j=Be||0,T.bindTexture(k,N),k===T.TEXTURE_2D)T.texImage2D(k,0,J,de,ye,0,$,W,null);else{if(!(0,r.C6)(T)||k!==T.TEXTURE_3D||void 0===j)throw new Error("unknown texture target");T.texImage3D(k,0,J,de,ye,j,0,$,W,null)}}function g(le,Ae=!1){if(0===le.width||0===le.height||!u(le)&&(0,r.C6)(T)&&s(0,k,T)&&0===le.depth)throw new Error("empty textures are not allowed");if(T.bindTexture(k,N),T.pixelStorei(T.UNPACK_ALIGNMENT,1),T.pixelStorei(T.UNPACK_COLORSPACE_CONVERSION_WEBGL,T.NONE),T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),u(le))de=le.width,ye=le.height,T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!1),T.bindTexture(T.TEXTURE_2D,N),T.texImage2D(T.TEXTURE_2D,0,J,$,W,le);else if(function d(T,L,w){return L===w.TEXTURE_2D}(0,k,T)){const Be=le.filter?l(T,le.filter):H;T.texParameteri(k,T.TEXTURE_MAG_FILTER,Be),T.texParameteri(k,T.TEXTURE_MIN_FILTER,Be),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!!le.flipY),Ae?T.texSubImage2D(k,0,0,0,le.width,le.height,$,W,le.array):(de=le.width,ye=le.height,T.texImage2D(k,0,J,de,ye,0,$,W,le.array))}else{if(!(0,r.C6)(T)||!s(0,k,T))throw new Error("unknown texture target");T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!1),Ae?T.texSubImage3D(k,0,0,0,0,le.width,le.height,le.depth,$,W,le.array):(de=le.width,ye=le.height,j=le.depth,T.texImage3D(k,0,J,de,ye,j,0,$,W,le.array))}T.bindTexture(k,null),Z=le}function _e(){if(k!==T.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(!((0,r.C6)(T)||(0,y.r6)(de)&&(0,y.r6)(ye)))throw new Error("mipmap unsupported for non-power-of-two textures and webgl1");T.bindTexture(k,N),T.texParameteri(k,T.TEXTURE_MIN_FILTER,T.LINEAR_MIPMAP_LINEAR),T.generateMipmap(k),T.bindTexture(k,null),q=!0}return ee(1,1,(0,r.C6)(T)&&k===T.TEXTURE_3D?1:0),{id:U,target:k,format:$,internalFormat:J,type:W,filter:H,getWidth:()=>de,getHeight:()=>ye,getDepth:()=>j,getByteCount:()=>b(Q,G,de,ye,j),define:ee,load:g,mipmap:_e,bind:le=>{T.activeTexture(T.TEXTURE0+le),T.bindTexture(k,N)},unbind:le=>{T.activeTexture(T.TEXTURE0+le),T.bindTexture(k,null)},attachFramebuffer:function xe(le,Ae,Be){if(le.bind(),k===T.TEXTURE_2D)T.framebufferTexture2D(T.FRAMEBUFFER,m(T,L,Ae),T.TEXTURE_2D,N,0);else{if(!(0,r.C6)(T)||k!==T.TEXTURE_3D)throw new Error("unknown/unsupported texture target");if(void 0===Be)throw new Error("need `layer` to attach 3D texture");T.framebufferTextureLayer(T.FRAMEBUFFER,m(T,L,Ae),N,0,Be)}},detachFramebuffer:(le,Ae)=>{if(le.bind(),k===T.TEXTURE_2D)T.framebufferTexture2D(T.FRAMEBUFFER,m(T,L,Ae),T.TEXTURE_2D,null,0);else{if(!(0,r.C6)(T)||k!==T.TEXTURE_3D)throw new Error("unknown texture target");T.framebufferTextureLayer(T.FRAMEBUFFER,m(T,L,Ae),null,0,0)}},reset:()=>{N=C(T),te();const[le,Ae,Be]=[de,ye,j];de=0,ye=0,j=0,ee(le,Ae,Be),Z&&g(Z),q&&_e()},destroy:()=>{Y||(T.deleteTexture(N),Y=!0)}}}function a(T,L,w){const{resources:Q}=T,G=[];return Object.keys(L).forEach(V=>{const U=L[V];if("texture"===U.type){const N=w[V];if(N)if("texture"===U.kind)G[G.length]=[V,N.ref.value];else{const k=Q.texture(U.kind,U.format,U.dataType,U.filter);k.load(N.ref.value),G[G.length]=[V,k]}}}),G}function S(T,L,w){const Q=new Image;Q.onload=function(){w.load(Q),e.IQ.update(L,w)},Q.src=T}function R(T,L,w,Q){const G=T.TEXTURE_CUBE_MAP,V=T.LINEAR,U=T.RGBA,N=T.RGBA,k=T.UNSIGNED_BYTE;let H=0;const $=T.createTexture();T.bindTexture(G,$);let J=0;(0,A.IF)(L,(te,de)=>{if(!te)return;const j=function D(T,L){switch(L){case"nx":return T.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return T.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return T.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return T.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return T.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return T.TEXTURE_CUBE_MAP_POSITIVE_Z}}(T,de),Z=new Image;te instanceof File?Z.src=URL.createObjectURL(te):(0,t.$X)(te)?te.then(q=>{Z.src=URL.createObjectURL(q)}):Z.src=te,Z.addEventListener("load",()=>{0===H&&(H=Z.width),T.texImage2D(j,0,U,H,H,0,N,k,null),T.pixelStorei(T.UNPACK_ALIGNMENT,4),T.pixelStorei(T.UNPACK_COLORSPACE_CONVERSION_WEBGL,T.NONE),T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!1),T.bindTexture(G,$),T.texImage2D(j,0,U,N,k,Z),J+=1,6===J&&(W||(w?(T.texParameteri(G,T.TEXTURE_MIN_FILTER,T.LINEAR_MIPMAP_LINEAR),T.generateMipmap(G)):T.texParameteri(G,T.TEXTURE_MIN_FILTER,V),T.texParameteri(G,T.TEXTURE_MAG_FILTER,V)),Q?.(W))}),Z.addEventListener("error",()=>{Q?.(!0)})});let W=!1;return{id:c(),target:G,format:N,internalFormat:U,type:k,filter:V,getWidth:()=>H,getHeight:()=>H,getDepth:()=>0,getByteCount:()=>6*b("rgba","ubyte",H,H,0)*(w?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:te=>{T.activeTexture(T.TEXTURE0+te),T.bindTexture(G,$)},unbind:te=>{T.activeTexture(T.TEXTURE0+te),T.bindTexture(G,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{},destroy:()=>{W||(T.deleteTexture($),W=!0)}}}const f=-1;function p(T){return T.format===f}function E(T){var L;const w=null!==(L=T?.TEXTURE_2D)&&void 0!==L?L:3553;return{id:c(),target:w,format:f,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:Q=>{T&&(T.activeTexture(T.TEXTURE0+Q),T.bindTexture(w,null))},unbind:Q=>{T&&(T.activeTexture(T.TEXTURE0+Q),T.bindTexture(w,null))},attachFramebuffer:()=>{throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:()=>{throw new Error("cannot detach null-texture from a framebuffer")},reset:()=>{},destroy:()=>{}}}},2098:(tn,Ue,n)=>{"use strict";n.d(Ue,{C:()=>y,d:()=>i});var e=n(9854);class r{add(O,b){let _=this.avgs.get(O)||b;return _=function o(v,O,b){return(v-=v/b)+O/b}(_,b,this.count),this.avgs.set(O,_),_}get(O){return this.avgs.get(O)}stats(){return Object.fromEntries(this.avgs.entries())}clear(){this.avgs.clear()}constructor(O){this.count=O,this.avgs=new Map}}function y(v,O,b,_){var M;const I=O.disjointTimerQuery,l=null!==(M=_?.avgCount)&&void 0!==M?M:30,m=new Map,u=new Map,d=[],s=new r(l),C=new r(l);let h=[],a=null,S=!1;const D=()=>{I&&(m.forEach((f,p)=>{I.deleteQuery(p)}),u.clear(),d.length=0,s.clear(),C.clear(),h=[],a=null,S=!1)},R=()=>{if(!I)return;const f=function A(v){return v.disjointTimerQuery?v.disjointTimerQuery.createQuery():null}(O);f&&(I.beginQuery(I.TIME_ELAPSED,f),u.forEach((p,E)=>{p.queries.push(f)}),m.set(f,{refCount:u.size}),a=f)};return{resolve:()=>{const f=[];if(!I||!h.length)return f;m.forEach((E,T)=>{if(void 0!==E.timeElapsed)return;const L=I.getQueryParameter(T,I.QUERY_RESULT_AVAILABLE),w=v.getParameter(I.GPU_DISJOINT);if(L&&!w){const Q=I.getQueryParameter(T,I.QUERY_RESULT);E.timeElapsed=Q}(L||w)&&I.deleteQuery(T)});const p=[];for(const E of h)if(E.queries.every(T=>{var L;return void 0!==(null===(L=m.get(T))||void 0===L?void 0:L.timeElapsed)})){let T=0;for(const L of E.queries){const w=m.get(L);T+=w.timeElapsed,w.refCount-=1}if(E.timeElapsed=T,E.root){const L=[],w=(G,V)=>{for(const U of G){const N=U.timeElapsed,k=U.cpu.end-U.cpu.start,H={label:U.label,gpuElapsed:N,gpuAvg:s.add(U.label,N),cpuElapsed:k,cpuAvg:C.add(U.label,k),children:[],calls:U.calls};V.push(H),w(U.children,H.children)}};w(E.children,L);const Q=E.cpu.end-E.cpu.start;f.push({label:E.label,gpuElapsed:T,gpuAvg:s.add(E.label,T),cpuElapsed:Q,cpuAvg:C.add(E.label,Q),children:L,calls:E.calls})}}else p.push(E);return h=p,m.forEach((E,T)=>{0===E.refCount&&m.delete(T)}),f},mark:(f,p=!1)=>{if(!I)return;if(u.has(f))throw new Error(`Timer mark for '${f}' already exists`);null!==a&&I.endQuery(I.TIME_ELAPSED);const E={label:f,queries:[],children:[],root:null===a,cpu:{start:(0,e.t)(),end:-1},captureStats:p};if(u.set(f,E),d.length&&d[d.length-1].children.push(E),d.push(E),p){if(S)throw new Error("Already capturing stats");(function t(v){v.calls.drawInstanced=0,v.calls.drawInstancedBase=0,v.calls.multiDrawInstancedBase=0,v.calls.counts=0,v.culled.lod=0,v.culled.frustum=0,v.culled.occlusion=0})(b),S=!0}R()},markEnd:f=>{var p;if(!I)return;const E=u.get(f);if(!E)throw new Error(`Timer mark for '${f}' does not exist`);if((null===(p=d.pop())||void 0===p?void 0:p.label)!==f)throw new Error(`Timer mark for '${f}' has pending nested mark`);I.endQuery(I.TIME_ELAPSED),u.delete(f),E.cpu.end=(0,e.t)(),E.captureStats&&(E.calls={...b.calls},S=!1),h.push(E),u.size>0?R():a=null},stats:()=>({gpu:s.stats(),cpu:C.stats()}),formatedStats:()=>{const f={},p=s.stats(),E=C.stats();for(const T of Object.keys(p)){const L=`${(p[T]/1e3/1e3).toFixed(2)}`,w=`${E[T].toFixed(2)}`;f[T]=`${L} ms | CPU: ${w} ms`}return f},clear:D,destroy:()=>{D()}}}function i(v){v.map(O=>{const b=function c(v){const O=`${(v.gpuElapsed/1e3/1e3).toFixed(2)}`,b=`${(v.gpuAvg/1e3/1e3).toFixed(2)}`,_=`${v.cpuElapsed.toFixed(2)}`,M=`${v.cpuAvg.toFixed(2)}`;return`${v.label} ${O} ms (avg. ${b} ms) | CPU: ${_} ms (avg. ${M} ms)`}(O);O.children.length||O.calls?(console.groupCollapsed(b),O.calls&&console.log(O.calls),i(O.children),console.groupEnd()):console.log(b)})}},2879:(tn,Ue,n)=>{"use strict";n.d(Ue,{NM:()=>r,Pi:()=>d,a5:()=>t,kB:()=>h});var e=n(9909),o=n(9359);function r(a,S){switch(S){case"b":case"b[]":return a.BOOL;case"f":case"f[]":return a.FLOAT;case"i":case"i[]":return a.INT;case"v2":case"v2[]":return a.FLOAT_VEC2;case"v3":case"v3[]":return a.FLOAT_VEC3;case"v4":case"v4[]":return a.FLOAT_VEC4;case"iv2":case"iv2[]":return a.INT_VEC2;case"iv3":case"iv3[]":return a.INT_VEC3;case"iv4":case"iv4[]":return a.INT_VEC4;case"m3":case"m3[]":return a.FLOAT_MAT3;case"m4":case"m4[]":return a.FLOAT_MAT4;default:console.error(`unknown uniform kind '${S}'`)}}function t(a){return a.endsWith("[]")}function A(a,S,D){a.uniform1f(S,D)}function y(a,S,D){a.uniform1fv(S,D)}function c(a,S,D){a.uniform1i(S,D)}function i(a,S,D){a.uniform1iv(S,D)}function v(a,S,D){a.uniform2fv(S,D)}function O(a,S,D){a.uniform3fv(S,D)}function b(a,S,D){a.uniform4fv(S,D)}function _(a,S,D){a.uniform2iv(S,D)}function M(a,S,D){a.uniform3iv(S,D)}function I(a,S,D){a.uniform4iv(S,D)}function l(a,S,D){a.uniformMatrix3fv(S,!1,D)}function m(a,S,D){a.uniformMatrix4fv(S,!1,D)}function u(a){switch(a){case"f":return A;case"f[]":return y;case"i":case"t":case"b":return c;case"i[]":case"t[]":case"b[]":return i;case"v2":case"v2[]":return v;case"v3":case"v3[]":return O;case"v4":case"v4[]":return b;case"iv2":case"iv2[]":return _;case"iv3":case"iv3[]":return M;case"iv4":case"iv4[]":return I;case"m3":case"m3[]":return l;case"m4":case"m4[]":return m}}function d(a){const S={};return Object.keys(a).forEach(D=>{const R=a[D];"uniform"===R.type?S[D]=u(R.kind):"texture"===R.type&&(S[D]=u("t"))}),S}function h(a){const S={};return Object.keys(a).forEach(D=>{S[D]=e.IQ.create((0,o.Go)(a[D].ref.value))}),S}},144:(tn,Ue,n)=>{"use strict";n.d(Ue,{ar:()=>D.ar,ND:()=>D.ND,xv:()=>e.x,D4:()=>t});var e=n(7864),o=n(3897),r=n(1372);function t(f){let p=f.data;for(let E=f.encoding.length-1;E>=0;E--)p=A(p,f.encoding[E]);return p}function A(f,p){switch(p.kind){case"ByteArray":switch(p.type){case e.W.IntDataType.Uint8:return f;case e.W.IntDataType.Int8:return function i(f){return new Int8Array(f.buffer,f.byteOffset)}(f);case e.W.IntDataType.Int16:return function O(f){return v(f,2,Int16Array)}(f);case e.W.IntDataType.Uint16:return function b(f){return v(f,2,Uint16Array)}(f);case e.W.IntDataType.Int32:return function _(f){return v(f,4,Int32Array)}(f);case e.W.IntDataType.Uint32:return function M(f){return v(f,4,Uint32Array)}(f);case e.W.FloatDataType.Float32:return function I(f){return v(f,4,Float32Array)}(f);case e.W.FloatDataType.Float64:return function l(f){return v(f,8,Float64Array)}(f);default:(0,r.dr)(p.type)}case"FixedPoint":return function m(f,p){const E=f.length,T=c(p.srcType,E),L=1/p.factor;for(let w=0;w<E;w++)T[w]=L*f[w];return T}(f,p);case"IntervalQuantization":return function u(f,p){const E=f.length,T=c(p.srcType,E),L=(p.max-p.min)/(p.numSteps-1),w=p.min;for(let Q=0;Q<E;Q++)T[Q]=w+L*f[Q];return T}(f,p);case"RunLength":return function d(f,p){const E=y(p.srcType,p.srcSize);let T=0;for(let L=0,w=f.length;L<w;L+=2){const Q=f[L],G=f[L+1];for(let V=0;V<G;++V)E[T++]=Q}return E}(f,p);case"Delta":return function s(f,p){const E=f.length,T=y(p.srcType,E);if(!E)return f;T[0]=f[0]+(0|p.origin);for(let L=1;L<E;++L)T[L]=f[L]+T[L-1];return T}(f,p);case"IntegerPacking":return function a(f,p){return f.length===p.srcSize?f:p.isUnsigned?function h(f,p){const E=1===p.byteCount?255:65535,T=f.length,L=new Int32Array(p.srcSize);let w=0,Q=0;for(;w<T;){let G=0,V=f[w];for(;V===E;)G+=V,w++,V=f[w];G+=V,L[Q]=G,w++,Q++}return L}(f,p):function C(f,p){const E=1===p.byteCount?127:32767,T=-E-1,L=f.length,w=new Int32Array(p.srcSize);let Q=0,G=0;for(;Q<L;){let V=0,U=f[Q];for(;U===E||U===T;)V+=U,Q++,U=f[Q];V+=U,w[G]=V,Q++,G++}return w}(f,p)}(f,p);case"StringArray":return function S(f,p){const E=t({encoding:p.offsetEncoding,data:p.offsets}),T=t({encoding:p.dataEncoding,data:f}),L=p.stringData,w=new Array(E.length);w[0]="";for(let V=1,U=E.length;V<U;V++)w[V]=L.substring(E[V-1],E[V]);let Q=0;const G=new Array(T.length);for(let V=0,U=T.length;V<U;V++)G[Q++]=w[T[V]+1];return G}(f,p)}}function y(f,p){switch(f){case e.W.IntDataType.Int8:return new Int8Array(p);case e.W.IntDataType.Int16:return new Int16Array(p);case e.W.IntDataType.Int32:return new Int32Array(p);case e.W.IntDataType.Uint8:return new Uint8Array(p);case e.W.IntDataType.Uint16:return new Uint16Array(p);case e.W.IntDataType.Uint32:return new Uint32Array(p);default:return new Int32Array(p)}}function c(f,p){return f===e.W.FloatDataType.Float32?new Float32Array(p):new Float64Array(p)}function v(f,p,E){return new E(o.vX?f.buffer:(0,o.yw)(f,p))}var D=n(5657);n(6640)},5657:(tn,Ue,n)=>{"use strict";n.d(Ue,{ND:()=>y,ar:()=>A});var A,y,e=n(8382),o=n(7864),r=n(6640);class t{and(i){return new t(this.providers.concat([i]))}encode(i){const v=[];for(const O of this.providers){const b=O(i);if(!b.encodings.length)throw new Error("Encodings must be non-empty.");i=b.data;for(const _ of b.encodings)v.push(_)}if(!(i instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:v,data:i}}constructor(i){this.providers=i}}!function(c){function i(b){return new t([b])}function O(b){switch(b.kind){case"ByteArray":return y.byteArray;case"FixedPoint":return y.fixedPoint(b.factor);case"IntervalQuantization":return y.intervalQuantizaiton(b.min,b.max,b.numSteps);case"RunLength":return y.runLength;case"Delta":return y.delta;case"IntegerPacking":return y.integerPacking;case"StringArray":return y.stringArray}}c.by=i,c.fromEncoding=function v(b){let _=i(O(b[0]));for(let M=1;M<b.length&&"IntegerPacking"!==b[M-1].kind;M++)_=_.and(O(b[M]));return _}}(A||(A={})),function(c){c.by=function i(p){return new t([p])};const b={[o.W.IntDataType.Int16]:function(p,E,T){p.setInt16(2*E,T,!0)},[o.W.IntDataType.Uint16]:function(p,E,T){p.setUint16(2*E,T,!0)},[o.W.IntDataType.Int32]:function(p,E,T){p.setInt32(4*E,T,!0)},[o.W.IntDataType.Uint32]:function(p,E,T){p.setUint32(4*E,T,!0)},[o.W.FloatDataType.Float32]:function(p,E,T){p.setFloat32(4*E,T,!0)},[o.W.FloatDataType.Float64]:function(p,E,T){p.setFloat64(8*E,T,!0)}},_={[o.W.IntDataType.Int16]:2,[o.W.IntDataType.Uint16]:2,[o.W.IntDataType.Int32]:4,[o.W.IntDataType.Uint32]:4,[o.W.FloatDataType.Float32]:4,[o.W.FloatDataType.Float64]:8};function M(p){const E=o.W.getDataType(p);if(E===o.W.IntDataType.Int8)return function O(p){return{encodings:[{kind:"ByteArray",type:o.W.IntDataType.Int8}],data:new Uint8Array(p.buffer,p.byteOffset)}}(p);if(E===o.W.IntDataType.Uint8)return function v(p){return{encodings:[{kind:"ByteArray",type:o.W.IntDataType.Uint8}],data:p}}(p);const T=new Uint8Array(p.length*_[E]),L=b[E],w=new DataView(T.buffer);for(let Q=0,G=p.length;Q<G;Q++)L(w,Q,p[Q]);return{encodings:[{kind:"ByteArray",type:E}],data:T}}function h(p,E){let T=0;for(let L=0,w=p.length;L<w;L++)T+=p[L]/E|0;return T+=p.length,T}function a(p,E){const T=-E-1;let L=0;for(let w=0,Q=p.length;w<Q;w++){const G=p[w];L+=G>=0?G/E|0:G/T|0}return L+=p.length,L}c.byteArray=M,c.fixedPoint=function l(p){return E=>function I(p,E){const T=o.W.getDataType(p),L=new Int32Array(p.length);for(let w=0,Q=p.length;w<Q;w++)L[w]=Math.round(p[w]*E);return{encodings:[{kind:"FixedPoint",factor:E,srcType:T}],data:L}}(E,p)},c.intervalQuantizaiton=function u(p,E,T,L=Int32Array){return w=>function m(p,E,T,L,w){const Q=o.W.getDataType(p);if(!p.length)return{encodings:[{kind:"IntervalQuantization",min:E,max:T,numSteps:L,srcType:Q}],data:new Int32Array(0)};if(T<E){const U=E;E=T,T=U}const G=(T-E)/(L-1),V=new w(p.length);for(let U=0,N=p.length;U<N;U++){const k=p[U];V[U]=k<=E?0:k>=T?L-1:0|Math.round((k-E)/G)}return{encodings:[{kind:"IntervalQuantization",min:E,max:T,numSteps:L,srcType:Q}],data:V}}(w,p,E,T,L)},c.runLength=function d(p){let E=o.W.getDataType(p);if(void 0===E&&(p=new Int32Array(p),E=o.W.IntDataType.Int32),!p.length)return{encodings:[{kind:"RunLength",srcType:E,srcSize:0}],data:new Int32Array(0)};let T=2;for(let G=1,V=p.length;G<V;G++)p[G-1]!==p[G]&&(T+=2);const L=new Int32Array(T);let w=0,Q=1;for(let G=1,V=p.length;G<V;G++)p[G-1]!==p[G]?(L[w]=p[G-1],L[w+1]=Q,Q=1,w+=2):++Q;return L[w]=p[p.length-1],L[w+1]=Q,{encodings:[{kind:"RunLength",srcType:E,srcSize:p.length}],data:L}},c.delta=function s(p){if(!o.W.isSignedIntegerDataType(p))throw new Error("Only signed integer types can be encoded using delta encoding.");let E=o.W.getDataType(p);if(void 0===E&&(p=new Int32Array(p),E=o.W.IntDataType.Int32),!p.length)return{encodings:[{kind:"Delta",origin:0,srcType:E}],data:new p.constructor(0)};const T=new p.constructor(p.length),L=p[0];T[0]=p[0];for(let w=1,Q=p.length;w<Q;w++)T[w]=p[w]-p[w-1];return T[0]=0,{encodings:[{kind:"Delta",origin:L,srcType:E}],data:T}},c.integerPacking=function R(p){const E=function S(p){const E=function C(p){for(let E=0,T=p.length;E<T;E++)if(p[E]<0)return!0;return!1}(p),T=E?a(p,127):h(p,255),L=E?a(p,32767):h(p,65535);return 4*p.length<2*L?{isSigned:E,size:p.length,bytesPerElement:4}:2*L<T?{isSigned:E,size:L,bytesPerElement:2}:{isSigned:E,size:T,bytesPerElement:1}}(p);return 4===E.bytesPerElement?M(p):function D(p,E){const T=E.isSigned?1===E.bytesPerElement?127:32767:1===E.bytesPerElement?255:65535,L=-T-1,w=p.length,Q=E.isSigned?1===E.bytesPerElement?new Int8Array(E.size):new Int16Array(E.size):1===E.bytesPerElement?new Uint8Array(E.size):new Uint16Array(E.size);let G=0;for(let U=0;U<w;U++){let N=p[U];if(N>=0)for(;N>=T;)Q[G]=T,++G,N-=T;else for(;N<=L;)Q[G]=L,++G,N-=L;Q[G]=N,++G}const V=M(Q);return{encodings:[{kind:"IntegerPacking",byteCount:E.bytesPerElement,isUnsigned:!E.isSigned,srcSize:w},V.encodings[0]],data:V.data}}(p,E)},c.stringArray=function f(p){const E=Object.create(null),T=[],L=new Int32Array(p.length),w=e.Gm.create(Int32Array,1,Math.min(1024,p.length<32?p.length+1:Math.round(p.length/8)+1));e.Gm.add(w,0);let Q=0,G=0;for(const $ of p){if(null==$){L[G++]=-1;continue}let J=E[$];void 0===J&&(Q+=$.length,J=T.length,T[J]=$,E[$]=J,e.Gm.add(w,Q)),L[G++]=J}const V=e.Gm.compact(w),N=(0,r.P)(V).encode(V),H=(0,r.P)(L).encode(L);return{encodings:[{kind:"StringArray",dataEncoding:H.encoding,stringData:T.join(""),offsetEncoding:N.encoding,offsets:N.data}],data:H.data}}}(y||(y={}))},6640:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>A,P:()=>t});var y,c,e=n(5657),o=n(229),r=n(1372);function t(i){return y.classify(i)}function A(i){return c.classify(i)}!function(i){function v(h,a){return h>=0?Math.ceil((h+1)/a):Math.ceil((h+1)/(-a-1))}function _({limit8:h,limit16:a},S,D){S.pack8+=v(D,h),S.pack16+=v(D,a),S.count+=1}function M(h,a){h.pack8+=v(a,127),h.pack16+=v(a,32767),h.count+=1}function I(h){return 4*h.count<2*h.pack16?{length:4*h.count,elem:4}:2*h.pack16<h.pack8?{length:2*h.pack16,elem:2}:{length:h.pack8,elem:1}}function l(h,a){const S={pack8:0,pack16:0,count:0};for(let D=0,R=h.length;D<R;D++)_(a,S,h[D]);return{...I(S),kind:"pack"}}function m(h,a){const S={pack8:0,pack16:0,count:0};let D=h[0];for(let R=1,f=h.length;R<f;R++)M(S,h[R]-D),D=h[R];return{...I(S),kind:"delta"}}function u(h,a){const S={pack8:0,pack16:0,count:0};let D=1;for(let R=1,f=h.length;R<f;R++)h[R-1]!==h[R]?(_(a,S,h[R-1]),_(a,S,D),D=1):D++;return _(a,S,h[h.length-1]),_(a,S,D),{...I(S),kind:"rle"}}function d(h,a){const S={pack8:0,pack16:0,count:0};let D=1,R=0,f=0;for(let p=1,E=h.length;p<E;p++){const T=h[p]-R;f!==T?(M(S,f),M(S,D),D=1):D++,f=T,R=h[p]}return M(S,f),M(S,D),{...I(S),kind:"delta-rle"}}function s(h){const a=function O(h){let a=!1;for(let S=0,D=h.length;S<D;S++)if(h[S]<0){a=!0;break}return a?{signed:a,limit8:127,limit16:32767}:{signed:a,limit8:255,limit16:65535}}(h),S=[l(h,a),u(h,a),m(h),d(h)];return S.sort((D,R)=>D.length-R.length),S}i.getSize=s,i.classify=function C(h){if(h.length<2)return e.ND.by(e.ND.byteArray);const S=s(h)[0];switch(S.kind){case"pack":return e.ND.by(e.ND.integerPacking);case"rle":return e.ND.by(e.ND.runLength).and(e.ND.integerPacking);case"delta":return e.ND.by(e.ND.delta).and(e.ND.integerPacking);case"delta-rle":return e.ND.by(e.ND.delta).and(e.ND.runLength).and(e.ND.integerPacking);default:(0,r.dr)(S)}}}(y||(y={})),(c||(c={})).classify=function O(_){const{mantissaDigits:I,integerDigits:l}=(0,o.In)(_,4,1e-6);if(I<0||I+l>10)return e.ND.by(e.ND.byteArray);if(0===I)return y.classify(_);const m=function b(_){let M=1;for(let I=0;I<_;I++)M*=10;return M}(I),u=new Int32Array(_.length);for(let h=0,a=_.length;h<a;h++)u[h]=Math.round(m*_[h]);const s=y.getSize(u)[0],C=e.ND.by(e.ND.fixedPoint(m));switch(s.kind){case"pack":return C.and(e.ND.integerPacking);case"rle":return C.and(e.ND.runLength).and(e.ND.integerPacking);case"delta":return C.and(e.ND.delta).and(e.ND.integerPacking);case"delta-rle":return C.and(e.ND.delta).and(e.ND.runLength).and(e.ND.integerPacking);default:(0,r.dr)(s)}}},7864:(tn,Ue,n)=>{"use strict";n.d(Ue,{W:()=>o,x:()=>e});const e="0.3.0";var o;!function(r){let t;var i;let A;(i=t=r.IntDataType||(r.IntDataType={}))[i.Int8=1]="Int8",i[i.Int16=2]="Int16",i[i.Int32=3]="Int32",i[i.Uint8=4]="Uint8",i[i.Uint16=5]="Uint16",i[i.Uint32=6]="Uint32",function(i){i[i.Float32=32]="Float32",i[i.Float64=33]="Float64"}(A=r.FloatDataType||(r.FloatDataType={})),r.getDataType=function y(i){let v;return v=i instanceof Int8Array?r.IntDataType.Int8:i instanceof Int16Array?r.IntDataType.Int16:i instanceof Int32Array?r.IntDataType.Int32:i instanceof Uint8Array?r.IntDataType.Uint8:i instanceof Uint16Array?r.IntDataType.Uint16:i instanceof Uint32Array?r.IntDataType.Uint32:i instanceof Float32Array?r.FloatDataType.Float32:i instanceof Float64Array?r.FloatDataType.Float64:r.IntDataType.Int32,v},r.isSignedIntegerDataType=function c(i){if(i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array)return!0;for(let v=0,O=i.length;v<O;v++)if(v<0)return!1;return!0}}(o||(o={}))},3897:(tn,Ue,n)=>{"use strict";n.d(Ue,{$q:()=>t,vX:()=>e,yw:()=>o});const e=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0];function o(A,y){const c=new ArrayBuffer(A.length),i=new Uint8Array(c);for(let v=0,O=A.length;v<O;v+=y)for(let b=0;b<y;b++)i[v+y-b-1]=A[v+b];return c}const r=28672;function t(A){if(A.length>r){const y=[];for(let c=0;c<A.length;c+=r)y.push(String.fromCharCode.apply(null,A.subarray(c,c+r)));return y.join("")}return String.fromCharCode.apply(null,A)}},1009:(tn,Ue,n)=>{"use strict";n.d(Ue,{L:()=>r});var r,e=n(9909),o=n(1241);(r||(r={})).fromBuffer=function A(y,c){return{name:c,readBuffer:(i,v,O,b)=>{let _,M;if("number"==typeof v){O=(0,e.NT)(O,v);const I=i,l=Math.min(y.length,I+O);_=l-I,M=o.N.fromUint8Array(new Uint8Array(y.buffer,I,l-I))}else{O=(0,e.NT)(O,v.length);const I=i,l=Math.min(y.length,I+O);v.set(y.subarray(I,l),b),_=l-I,M=v}return O!==_&&console.warn(`byteCount ${O} and bytesRead ${_} differ`),Promise.resolve({bytesRead:_,buffer:M})},writeBuffer:(i,v,O)=>(O=(0,e.NT)(O,v.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)),writeBufferSync:(i,v,O)=>(O=(0,e.NT)(O,v.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0),close:e.lQ}}},5295:(tn,Ue,n)=>{"use strict";n.d(Ue,{J:()=>o});var e=n(275);function o(i){return c({buffer:i,offset:0,dataView:new DataView(i.buffer)})}function r(i,v){const O={};for(let b=0;b<v;b++)O[c(i)]=c(i);return O}function t(i,v){const O=new Uint8Array(v),b=i.offset;for(let _=0;_<v;_++)O[_]=i.buffer[_+b];return i.offset+=v,O}function A(i,v){const O=(0,e.ss)(i.buffer,i.offset,v);return i.offset+=v,O}function y(i,v){const O=new Array(v);for(let b=0;b<v;b++)O[b]=c(i);return O}function c(i){const v=i.buffer[i.offset];let O,b;if(!(128&v))return i.offset++,v;if(128==(240&v))return b=15&v,i.offset++,r(i,b);if(144==(240&v))return b=15&v,i.offset++,y(i,b);if(160==(224&v))return b=31&v,i.offset++,A(i,b);if(!(224&~v))return O=i.dataView.getInt8(i.offset),i.offset++,O;switch(v){case 192:return i.offset++,null;case 194:return i.offset++,!1;case 195:return i.offset++,!0;case 196:return b=i.dataView.getUint8(i.offset+1),i.offset+=2,t(i,b);case 197:return b=i.dataView.getUint16(i.offset+1),i.offset+=3,t(i,b);case 198:return b=i.dataView.getUint32(i.offset+1),i.offset+=5,t(i,b);case 202:return O=i.dataView.getFloat32(i.offset+1),i.offset+=5,O;case 203:return O=i.dataView.getFloat64(i.offset+1),i.offset+=9,O;case 204:return O=i.buffer[i.offset+1],i.offset+=2,O;case 205:return O=i.dataView.getUint16(i.offset+1),i.offset+=3,O;case 206:return O=i.dataView.getUint32(i.offset+1),i.offset+=5,O;case 208:return O=i.dataView.getInt8(i.offset+1),i.offset+=2,O;case 209:return O=i.dataView.getInt16(i.offset+1),i.offset+=3,O;case 210:return O=i.dataView.getInt32(i.offset+1),i.offset+=5,O;case 217:return b=i.dataView.getUint8(i.offset+1),i.offset+=2,A(i,b);case 218:return b=i.dataView.getUint16(i.offset+1),i.offset+=3,A(i,b);case 219:return b=i.dataView.getUint32(i.offset+1),i.offset+=5,A(i,b);case 220:return b=i.dataView.getUint16(i.offset+1),i.offset+=3,y(i,b);case 221:return b=i.dataView.getUint32(i.offset+1),i.offset+=5,y(i,b);case 222:return b=i.dataView.getUint16(i.offset+1),i.offset+=3,r(i,b);case 223:return b=i.dataView.getUint32(i.offset+1),i.offset+=5,r(i,b)}throw new Error("Unknown type 0x"+v.toString(16))}},1241:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>o});var o,e=n(9909);!function(r){function t(O){const b=new DataView(O.buffer);return Object.assign(O.subarray(0),{readInt8:_=>b.getInt8(_),readUInt8:_=>b.getUint8(_),writeInt8:(_,M)=>b.setInt8(M,_),writeUInt8:(_,M)=>b.setUint8(M,_),readInt16LE:_=>b.getInt16(_,!0),readInt32LE:_=>b.getInt32(_,!0),readUInt16LE:_=>b.getUint16(_,!0),readUInt32LE:_=>b.getUint32(_,!0),readFloatLE:_=>b.getFloat32(_,!0),readDoubleLE:_=>b.getFloat64(_,!0),writeInt16LE:(_,M)=>b.setInt16(M,_,!0),writeInt32LE:(_,M)=>b.setInt32(M,_,!0),writeUInt16LE:(_,M)=>b.setUint16(M,_,!0),writeUInt32LE:(_,M)=>b.setUint32(M,_,!0),writeFloatLE:(_,M)=>b.setFloat32(M,_,!0),writeDoubleLE:(_,M)=>b.setFloat64(M,_,!0),readInt16BE:_=>b.getInt16(_,!1),readInt32BE:_=>b.getInt32(_,!1),readUInt16BE:_=>b.getUint16(_,!1),readUInt32BE:_=>b.getUint32(_,!1),readFloatBE:_=>b.getFloat32(_,!1),readDoubleBE:_=>b.getFloat64(_,!1),writeInt16BE:(_,M)=>b.setInt16(M,_,!1),writeInt32BE:(_,M)=>b.setInt32(M,_,!1),writeUInt16BE:(_,M)=>b.setUint16(M,_,!1),writeUInt32BE:(_,M)=>b.setUint32(M,_,!1),writeFloatBE:(_,M)=>b.setFloat32(M,_,!1),writeDoubleBE:(_,M)=>b.setFloat64(M,_,!1),copy:(_,M,I,l)=>(M=(0,e.NT)(M,0),I=(0,e.NT)(I,0),l=(0,e.NT)(l,O.length),_.set(O.subarray(I,l),M),l-I)})}function c(O,b,_,M,I){for(let l=0,m=_;l<m;l+=M)for(let u=0;u<M;u++)b[I+l+M-u-1]=O[I+l+u]}r.fromUint8Array=t,r.fromArrayBuffer=function A(O){return t(new Uint8Array(O))},r.fromBuffer=function y(O){return O},r.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],r.flipByteOrder=c,r.flipByteOrderInPlace2=function i(O,b=0,_){const M=new Int16Array(O,b,_);for(let I=0,l=M.length;I<l;++I){const m=M[I];M[I]=(255&m)<<8|m>>8&255}},r.ensureLittleEndian=function v(O,b,_,M,I){r.IsNativeEndianLittle||!_||M<=1||c(O,b,_,M,I)}}(o||(o={}))},702:(tn,Ue,n)=>{"use strict";n.d(Ue,{RW:()=>r,SV:()=>t,tM:()=>c,ye:()=>i});var e=n(467),o=n(1241),r=function(O){return O.Float32="float32",O.Int8="int8",O.Int16="int16",O.Uint16="uint16",O}(r||{});function t(O){return O===r.Float32?4:O===r.Int16||O===r.Uint16?2:1}function A(O,b,_=0,M){return O===r.Float32?new Float32Array(b,_,M):O===r.Int16?new Int16Array(b,_,M):O===r.Uint16?new Uint16Array(b,_,M):new Int8Array(b,_,M)}function c(O,b){const _=t(b),M=new ArrayBuffer(_*O),I=o.N.fromArrayBuffer(M),l=o.N.IsNativeEndianLittle?M:new ArrayBuffer(_*O);return{type:b,elementByteSize:_,readBuffer:I,valuesBuffer:new Uint8Array(l),values:A(b,l)}}function i(O,b,_,M,I,l){return v.apply(this,arguments)}function v(){return(v=(0,e.A)(function*(O,b,_,M,I,l){return yield b.readBuffer(_,O.readBuffer,M,I),O.elementByteSize>1&&(void 0!==l&&l!==o.N.IsNativeEndianLittle||!o.N.IsNativeEndianLittle)&&o.N.flipByteOrder(O.readBuffer,O.valuesBuffer,M,O.elementByteSize,I),O.values})).apply(this,arguments)}},275:(tn,Ue,n)=>{"use strict";function e(i,v,O){for(let b=0,_=O.length;b<_;b++){const M=O.charCodeAt(b);if(M<128)i[v++]=M>>>0&127;else if(M<2048)i[v++]=M>>>6&31|192,i[v++]=M>>>0&63|128;else if(M<65536)i[v++]=M>>>12&15|224,i[v++]=M>>>6&63|128,i[v++]=M>>>0&63|128;else{if(!(M<1114112))throw new Error("bad codepoint "+M);i[v++]=M>>>18&7|240,i[v++]=M>>>12&63|128,i[v++]=M>>>6&63|128,i[v++]=M>>>0&63|128}}}n.d(Ue,{VH:()=>c,rj:()=>e,ss:()=>y});const o=function(){const i=[];for(let v=0;v<1024;v++)i[v]=String.fromCharCode(v);return i}();function r(i){throw new Error(i)}const A=typeof TextDecoder<"u"?new TextDecoder:void 0;function y(i,v,O){if(A){const b=v||O!==i.length?i.subarray(v,v+O):i;return A.decode(b)}return function t(i,v,O){const b=o;let _,M=0;const I=[];for(let m=v,u=v+O;m<u;m++){const d=i[m];128&d?192==(224&d)?I[M++]=b[(15&d)<<6|63&i[++m]]:224==(240&d)?I[M++]=String.fromCharCode((15&d)<<12|(63&i[++m])<<6|63&i[++m]):240==(248&d)?I[M++]=String.fromCharCode((7&d)<<18|(63&i[++m])<<12|(63&i[++m])<<6|63&i[++m]):r("Invalid byte "+d.toString(16)):I[M++]=b[d],512===M&&(_=_||[],_[_.length]=I.join(""),M=0)}return _?(M>0&&(_[_.length]=I.slice(0,M).join("")),_.join("")):I.slice(0,M).join("")}(i,v,O)}function c(i){let v=0;for(let O=0,b=i.length;O<b;O++){const _=i.charCodeAt(O);_<128?v+=1:_<2048?v+=2:_<65536?v+=3:_<1114112?v+=4:r("bad codepoint "+_)}return v}},5732:(tn,Ue,n)=>{"use strict";n.d(Ue,{q7:()=>M,qg:()=>d});var e=n(467),o=n(4824),r=n(355),t=n(1009),A=n(1241),y=n(702);function i(){return(i=(0,e.A)(function*(s){const{buffer:h}=yield s.readBuffer(0,1024),a=String.fromCharCode(h.readUInt8(208),h.readUInt8(209),h.readUInt8(210),h.readUInt8(211));if("MAP "!==a)throw new Error('ccp4 format error, missing "MAP " string');const S=[h.readUInt8(212),h.readUInt8(213)];let D=!1;68===S[0]&&65===S[1]?D=!0:17===S[0]&&17===S[1]?D=!1:h.readInt32LE(12)<=16&&(D=!0);const R=D?E=>h.readInt32LE(4*E):E=>h.readInt32BE(4*E),f=D?E=>h.readFloatLE(4*E):E=>h.readFloatBE(4*E);return{header:{NC:R(0),NR:R(1),NS:R(2),MODE:R(3),NCSTART:R(4),NRSTART:R(5),NSSTART:R(6),NX:R(7),NY:R(8),NZ:R(9),xLength:f(10),yLength:f(11),zLength:f(12),alpha:f(13),beta:f(14),gamma:f(15),MAPC:R(16),MAPR:R(17),MAPS:R(18),AMIN:f(19),AMAX:f(20),AMEAN:f(21),ISPG:R(22),NSYMBT:R(23),LSKFLG:R(24),SKWMAT:[],SKWTRN:[],userFlag1:R(39),userFlag2:R(40),originX:f(49),originY:f(50),originZ:f(51),MAP:a,MACHST:S,ARMS:f(54)},littleEndian:D}})).apply(this,arguments)}function O(){return(O=(0,e.A)(function*(s,C,h,a,S,D){if(_(s)){const R=3*S;yield h.readBuffer(a,C.readBuffer,S,R);const f=new Int8Array(C.valuesBuffer.buffer,R),p=(s.AMAX-s.AMIN)/255,E=.5*(s.AMIN+s.AMAX+p);for(let T=0,L=S;T<L;++T)C.values[T]=p*f[T]+E}else yield(0,y.ye)(C,h,a,S,0,D)})).apply(this,arguments)}function b(s){switch(s){case 0:return y.RW.Int8;case 1:return y.RW.Int16;case 2:return y.RW.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error(`unknown mode '${s}'`)}function _(s){return-128===s.userFlag1&&127===s.userFlag2}function M(s){return _(s)?y.RW.Float32:b(s.MODE)}function m(){return m=(0,e.A)(function*(s,C,h){yield h.update({message:"Parsing CCP4/MRC/MAP file..."});const{header:a,littleEndian:S}=yield function c(s){return i.apply(this,arguments)}(s),D=function I(s){return 1024+s.NSYMBT}(a),R=b(a.MODE),f=M(a),p=a.NC*a.NR*a.NS,T=p*(0,y.SV)(R),L=(0,y.tM)(p,f);return function v(s,C,h,a,S,D){O.apply(this,arguments)}(a,L,s,D,T,S),{header:a,values:L.values,name:s.name}}),m.apply(this,arguments)}function d(s,C){return function u(s,C){return o.YZ.create("Parse CCP4/MRC/MAP",function(){var h=(0,e.A)(function*(a){try{return r.H.success(yield function l(s,C,h){return m.apply(this,arguments)}(s,C,a))}catch(S){return r.H.error(S)}});return function(a){return h.apply(this,arguments)}}())}(t.L.fromBuffer(A.N.fromUint8Array(s),C),s.length)}},5165:(tn,Ue,n)=>{"use strict";n.d(Ue,{f$:()=>rn,xA:()=>o.xA,RF:()=>o.RF});var e=n(467),o=n(2241),r=n(5555),t=n(355),A=n(4824);function y(tt){for(;tt.position<tt.length;)switch(tt.data.charCodeAt(tt.position)){case 9:case 10:case 13:case 32:return void(tt.tokenEnd=tt.position);default:++tt.position}tt.tokenEnd=tt.position}function M(tt){return!(tt.length-tt.position<2||39!==tt.data.charCodeAt(tt.position+1)||39!==tt.data.charCodeAt(tt.position+2))}function d(tt,Mt,nn){let bn;const Dn=nn-Mt,jt=tt.tokenStart-Mt,It=tt.tokenEnd-tt.tokenStart;if(It<Dn)return!1;for(bn=Mt;bn<nn;++bn)if(tt.data.charCodeAt(bn)!==tt.data.charCodeAt(bn+jt))return!1;return Dn===It||46===tt.data.charCodeAt(bn+jt)}function s(tt){let Mt;for(Mt=tt.tokenStart;Mt<tt.tokenEnd;++Mt)if(46===tt.data.charCodeAt(Mt))return Mt;return Mt}function C(tt,Mt){return tt.data.substring(tt.tokenStart,Mt)}function a(tt){return tt.data.substring(tt.tokenStart,tt.tokenEnd)}function S(tt){const Mt=function _(tt){let Mt=10;for(;tt.position<tt.length;){const nn=tt.data.charCodeAt(tt.position);switch(nn){case 9:case 32:Mt=nn,++tt.position;break;case 10:13!==Mt&&++tt.lineNumber,Mt=nn,++tt.position;break;case 13:Mt=nn,++tt.position,++tt.lineNumber;break;default:return Mt}}return Mt}(tt);if(tt.position>=tt.length)return void(tt.tokenType=6);tt.tokenStart=tt.position,tt.tokenEnd=tt.position,tt.isEscaped=!1;const nn=tt.data.charCodeAt(tt.position);switch(nn){case 35:(function b(tt){for(;tt.position<tt.length;){const Mt=tt.data.charCodeAt(tt.position);if(10===Mt||13===Mt)return;++tt.position}})(tt),tt.tokenType=5;break;case 39:if(M(tt)){(function i(tt){for(tt.position+=3;tt.position<tt.length;){if(39===tt.data.charCodeAt(tt.position)&&M(tt))return tt.tokenStart+=3,tt.tokenEnd=tt.position,tt.isEscaped=!0,void(tt.position+=3);++tt.position}tt.tokenEnd=tt.position})(tt),tt.tokenType=3;break}case 34:(function c(tt,Mt){let nn,bn;for(++tt.position;tt.position<tt.length;)if(bn=tt.data.charCodeAt(tt.position),bn===Mt)switch(nn=tt.data.charCodeAt(tt.position+1),nn){case 9:case 10:case 13:case 32:return tt.tokenStart++,tt.tokenEnd=tt.position,tt.isEscaped=!0,void++tt.position;default:if(void 0===nn)return tt.tokenStart++,tt.tokenEnd=tt.position,tt.isEscaped=!0,void++tt.position;++tt.position}else{if(10===bn||13===bn)return void(tt.tokenEnd=tt.position);++tt.position}tt.tokenEnd=tt.position})(tt,nn),tt.tokenType=3;break;case 59:10===Mt||13===Mt?function v(tt){let bn,Mt=59,nn=tt.position+1;for(;nn<tt.length;){if(bn=tt.data.charCodeAt(nn),59===bn&&(10===Mt||13===Mt)){for(tt.position=nn+1,tt.tokenStart++,nn--,bn=tt.data.charCodeAt(nn);10===bn||13===bn;)nn--,bn=tt.data.charCodeAt(nn);return tt.tokenEnd=nn+1,void(tt.isEscaped=!0)}(13===bn||10===bn&&13!==Mt)&&tt.lineNumber++,Mt=bn,++nn}tt.position=nn}(tt):y(tt),tt.tokenType=3;break;default:tt.isImportGet?function O(tt){for(;tt.position<tt.length;){if(93===tt.data.charCodeAt(tt.position))return++tt.position,tt.tokenEnd=tt.position,void(tt.isImportGet=!1);++tt.position}}(tt):y(tt),tt.isEscaped?tt.tokenType=3:95===tt.data.charCodeAt(tt.tokenStart)?(tt.inSaveFrame&&function u(tt){return!(tt.tokenEnd-tt.tokenStart!=11||105!==tt.data.charCodeAt(tt.tokenStart+1)||109!==tt.data.charCodeAt(tt.tokenStart+2)||112!==tt.data.charCodeAt(tt.tokenStart+3)||111!==tt.data.charCodeAt(tt.tokenStart+4)||114!==tt.data.charCodeAt(tt.tokenStart+5)||116!==tt.data.charCodeAt(tt.tokenStart+6)||46!==tt.data.charCodeAt(tt.tokenStart+7)||103!==tt.data.charCodeAt(tt.tokenStart+8)||101!==tt.data.charCodeAt(tt.tokenStart+9)||116!==tt.data.charCodeAt(tt.tokenStart+10))}(tt)&&(tt.isImportGet=!0),tt.tokenType=4):tt.tokenType=tt.tokenEnd-tt.tokenStart>=5&&95===tt.data.charCodeAt(tt.tokenStart+4)?function I(tt){let Mt=tt.data.charCodeAt(tt.tokenStart);return!(68!==Mt&&100!==Mt||(Mt=tt.data.charCodeAt(tt.tokenStart+1),65!==Mt&&97!==Mt)||(Mt=tt.data.charCodeAt(tt.tokenStart+2),84!==Mt&&116!==Mt)||(Mt=tt.data.charCodeAt(tt.tokenStart+3),65!==Mt&&97!==Mt))}(tt)?0:function l(tt){let Mt=tt.data.charCodeAt(tt.tokenStart);return!(83!==Mt&&115!==Mt||(Mt=tt.data.charCodeAt(tt.tokenStart+1),65!==Mt&&97!==Mt)||(Mt=tt.data.charCodeAt(tt.tokenStart+2),86!==Mt&&118!==Mt)||(Mt=tt.data.charCodeAt(tt.tokenStart+3),69!==Mt&&101!==Mt))}(tt)?1:function m(tt){if(tt.tokenEnd-tt.tokenStart!=5)return!1;let Mt=tt.data.charCodeAt(tt.tokenStart);return!(76!==Mt&&108!==Mt||(Mt=tt.data.charCodeAt(tt.tokenStart+1),79!==Mt&&111!==Mt)||(Mt=tt.data.charCodeAt(tt.tokenStart+2),79!==Mt&&111!==Mt)||(Mt=tt.data.charCodeAt(tt.tokenStart+3),80!==Mt&&112!==Mt))}(tt)?2:3:3}}function D(tt){for(S(tt);5===tt.tokenType;)S(tt)}function f(){return{categoryNames:[],categoryData:Object.create(null)}}function p(tt,Mt){const nn=Object.create(null);for(const bn of tt){const Dn=Mt[bn];nn[bn]=o.xA(Dn.name,Dn.rowCount,Dn.fieldNames,Dn.fields)}return nn}function E(tt,Mt,nn){return o.IU(tt.categoryNames,p(tt.categoryNames,tt.categoryData),Mt,nn)}function T(tt,Mt){return o.IU(tt.categoryNames,p(tt.categoryNames,tt.categoryData),Mt)}function L(tt,Mt,nn,bn,Dn){if(Mt in tt.categoryData){const jt=tt.categoryData[Mt];jt.fieldNames.push(...bn),Object.assign(jt.fields,Dn)}else tt.categoryData[Mt]={name:Mt,rowCount:nn,fieldNames:bn,fields:Dn},tt.categoryNames.push(Mt)}function w(tt,Mt){const nn=tt.tokenStart,bn=s(tt),Dn=C(tt,bn),jt=Object.create(null),It=[];let Dt=!0;for(;Dt;){if(4!==tt.tokenType||!d(tt,nn,bn)){Dt=!1;break}const Ct=a(tt).substring(Dn.length+1);if(D(tt),3!==tt.tokenType)return{hasError:!0,errorLine:tt.lineNumber,errorMessage:"Expected value."};jt[Ct]=o.RF.ofTokens({data:tt.data,indices:[tt.tokenStart,tt.tokenEnd],count:1}),It[It.length]=Ct,D(tt)}return L(Mt,Dn.substr(1),1,It,jt),{hasError:!1,errorLine:0,errorMessage:""}}function Q(tt,Mt){const{tokenizer:nn,tokens:bn,fieldCount:Dn}=Mt;let jt=Mt.tokenCount,It=0;for(;3===nn.tokenType&&It<tt;)r.tM.add(bn[jt++%Dn],nn.tokenStart,nn.tokenEnd),D(nn),It++;return Mt.tokenCount=jt,It}function G(tt,Mt){return tt.update({message:"Parsing...",current:Mt.tokenizer.position,max:Mt.tokenizer.data.length})}function V(tt,Mt){return U.apply(this,arguments)}function U(){return(U=(0,e.A)(function*(tt,Mt){const nn=tt.lineNumber;D(tt);const bn=C(tt,s(tt)),Dn=function h(tt){let Mt;for(Mt=tt.tokenStart;Mt<tt.tokenEnd;++Mt)if(46===tt.data.charCodeAt(Mt))return!1;return!0}(tt),jt=[];for(;4===tt.tokenType;)jt[jt.length]=Dn?a(tt):a(tt).substring(bn.length+1),D(tt);const It="_atom_site"===bn?tt.data.length/100|0:32,Dt=[],Ct=jt.length;for(let Wt=0;Wt<Ct;Wt++)Dt[Wt]=r.tM.create(tt.data,It);const $t={fieldCount:Ct,tokenCount:0,tokenizer:tt,tokens:Dt};if(yield(0,A.yB)(tt.runtimeCtx,1e6,$t,Q,G),$t.tokenCount%Ct!=0)return{hasError:!0,errorLine:tt.lineNumber,errorMessage:`The number of values for loop starting at line ${nn} is not a multiple of the number of columns.`};const Vt=$t.tokenCount/Ct|0;if(Dn)for(let Wt=0;Wt<Ct;Wt++){const yn={"":o.RF.ofTokens(Dt[Wt])};L(Mt,jt[Wt].substr(1),Vt,[""],yn)}else{const Wt=Object.create(null);for(let yn=0;yn<Ct;yn++)Wt[jt[yn]]=o.RF.ofTokens(Dt[yn]);L(Mt,bn.substr(1),Vt,jt,Wt)}return{hasError:!1,errorLine:0,errorMessage:""}})).apply(this,arguments)}function N(tt,Mt){return t.H.error(Mt,tt)}function $(){return($=(0,e.A)(function*(tt,Mt){const nn=[],bn=function R(tt,Mt){return{data:tt,length:tt.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:Mt}}(tt,Mt);let Dn="",jt=f(),It=[],Dt=f();const Ct=o.p4(Dt.categoryNames,p(Dt.categoryNames,Dt.categoryData),"");let $t="";for(Mt.update({message:"Parsing...",current:0,max:tt.length}),D(bn);6!==bn.tokenType;){const Vt=bn.tokenType;if(0===Vt){if(bn.inSaveFrame)return N(bn.lineNumber,"Unexpected data block inside a save frame.");jt.categoryNames.length>0&&nn.push(E(jt,Dn,It)),Dn=tt.substring(bn.tokenStart+5,bn.tokenEnd),jt=f(),It=[],D(bn)}else if(1===Vt){if(bn.tokenEnd-bn.tokenStart==5)Dt.categoryNames.length>0&&(It[It.length]=T(Dt,$t)),bn.inSaveFrame=!1;else{if(bn.inSaveFrame)return N(bn.lineNumber,"Save frames cannot be nested.");bn.inSaveFrame=!0,$t=tt.substring(bn.tokenStart+5,bn.tokenEnd),Dt=f()}D(bn)}else if(2===Vt){const Wt=yield V(bn,bn.inSaveFrame?Dt:jt);if(Wt.hasError)return N(Wt.errorLine,Wt.errorMessage)}else{if(4!==Vt)return console.log(bn.tokenType,r._F.getTokenString(bn)),N(bn.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const Wt=w(bn,bn.inSaveFrame?Dt:jt);if(Wt.hasError)return N(Wt.errorLine,Wt.errorMessage)}}}return bn.inSaveFrame?N(bn.lineNumber,`Unfinished save frame (${Ct.header}).`):((jt.categoryNames.length>0||It.length>0)&&nn.push(E(jt,Dn,It)),function k(tt){return t.H.success(tt)}(o.jG(nn)))})).apply(this,arguments)}function J(tt){return A.YZ.create("Parse CIF",function(){var Mt=(0,e.A)(function*(nn){return yield function H(tt,Mt){return $.apply(this,arguments)}(tt,nn)});return function(nn){return Mt.apply(this,arguments)}}())}var W=n(6651),te=n(144),de=n(2025),j=n(5295);function q(tt){const Mt=Object.create(null),nn=Object.create(null);for(const bn of tt.columns)Mt[bn.name]=bn;return{rowCount:tt.rowCount,name:tt.name.substr(1),fieldNames:tt.columns.map(bn=>bn.name),getField(bn){const Dn=Mt[bn];if(Dn)return nn[bn]||(nn[bn]=function ye(tt){const Mt=tt.mask?(0,te.D4)(tt.mask):void 0,nn=(0,te.D4)(tt.data),bn=W.iu.isTypedArray(nn),Dn=bn?Mt?$t=>0===Mt[$t]?""+nn[$t]:"":$t=>""+nn[$t]:Mt?$t=>0===Mt[$t]?nn[$t]:"":$t=>nn[$t],jt=bn?$t=>nn[$t]:$t=>{const Vt=nn[$t];return(0,de.H9)(Vt,0,Vt.length)},It=bn?$t=>nn[$t]:$t=>{const Vt=nn[$t];return(0,de.sS)(Vt,0,Vt.length)},Ct=nn.length;return{__array:nn,binaryEncoding:tt.data.encoding,isDefined:!0,rowCount:Ct,str:Dn,int:jt,float:It,valueKind:Mt?$t=>Mt[$t]:$t=>0,areValuesEqual:($t,Vt)=>nn[$t]===nn[Vt],toStringArray:$t=>W.iu.createAndFillArray(Ct,Dn,$t),toIntArray:bn?$t=>W.iu.typedArrayWindow(nn,$t):$t=>W.iu.createAndFillArray(Ct,jt,$t),toFloatArray:bn?$t=>W.iu.typedArrayWindow(nn,$t):$t=>W.iu.createAndFillArray(Ct,It,$t)}}(Dn)),nn[bn]}}}function Y(tt){return A.YZ.create("Parse BinaryCIF",function(){var Mt=(0,e.A)(function*(nn){const bn=[0,3];try{const Dn=(0,j.J)(tt);if(!function Z(tt,Mt){for(let nn=0;nn<2;nn++)if(tt[nn]>Mt[nn])return!1;return!0}(bn,Dn.version.match(/(\d)\.(\d)\.\d/).slice(1).map(It=>+It)))return t.H.error(`Unsupported format version. Current ${Dn.version}, required ${bn.join(".")}.`);const jt=o.jG(Dn.dataBlocks.map(It=>{const Dt=Object.create(null);for(const Ct of It.categories)Dt[Ct.name.substr(1)]=q(Ct);return o.IU(It.categories.map(Ct=>Ct.name.substr(1)),Dt,It.header)}));return t.H.success(jt)}catch(Dn){return t.H.error(""+Dn)}});return function(nn){return Mt.apply(this,arguments)}}())}var ee=n(7754),g=n(7357),_e=W.VP.Schema;const xe=_e.str,Ae=_e.List,Be=_e.lstr,Ce=_e.Aliased,Re=_e.int,ke=_e.coord,we={chem_comp:{formula:xe,formula_weight:_e.float,id:xe,mon_nstd_parent_comp_id:Ae(",",tt=>tt),name:xe,one_letter_code:xe,three_letter_code:xe,type:Ce(Be),pdbx_synonyms:Ae(";",tt=>tt),pdbx_type:xe,pdbx_ambiguous_flag:xe,pdbx_replaced_by:xe,pdbx_replaces:xe,pdbx_formal_charge:Re,pdbx_model_coordinates_details:xe,pdbx_model_coordinates_db_code:xe,pdbx_ideal_coordinates_details:xe,pdbx_ideal_coordinates_missing_flag:Ce(Be),pdbx_model_coordinates_missing_flag:Ce(Be),pdbx_initial_date:xe,pdbx_modified_date:xe,pdbx_release_status:Ce(xe),pdbx_processing_site:Ce(xe)},chem_comp_atom:{alt_atom_id:xe,atom_id:xe,charge:Re,model_Cartn_x:ke,model_Cartn_y:ke,model_Cartn_z:ke,comp_id:xe,type_symbol:xe,pdbx_align:Re,pdbx_ordinal:Re,pdbx_model_Cartn_x_ideal:ke,pdbx_model_Cartn_y_ideal:ke,pdbx_model_Cartn_z_ideal:ke,pdbx_stereo_config:Ce(Be),pdbx_aromatic_flag:Ce(Be),pdbx_leaving_atom_flag:Ce(Be)},chem_comp_bond:{atom_id_1:xe,atom_id_2:xe,comp_id:xe,value_order:Ce(Be),pdbx_ordinal:Re,pdbx_stereo_config:Ce(Be),pdbx_aromatic_flag:Ce(Be)},pdbx_chem_comp_descriptor:{comp_id:xe,descriptor:xe,type:Ce(Be),program:xe,program_version:xe},pdbx_chem_comp_identifier:{comp_id:xe,identifier:xe,type:Ce(xe),program:xe,program_version:xe}};var Oe=W.VP.Schema;const Se=Oe.str,Ne=Oe.lstr,K=Oe.Aliased,ne=Oe.int,be={pdbx_reference_molecule:{prd_id:Se,formula_weight:Oe.float,formula:Se,type:K(Ne),type_evidence_code:Se,class:K(Ne),class_evidence_code:Se,name:Se,represent_as:K(Ne),chem_comp_id:Se,compound_details:Se,description:Se,representative_PDB_id_code:Se,release_status:K(Ne),replaces:Se,replaced_by:Se},pdbx_reference_entity_list:{prd_id:Se,ref_entity_id:Se,type:K(Ne),details:Se,component_id:ne},pdbx_reference_entity_nonpoly:{prd_id:Se,ref_entity_id:Se,name:Se,chem_comp_id:Se},pdbx_reference_entity_link:{link_id:ne,prd_id:Se,details:Se,ref_entity_id_1:Se,ref_entity_id_2:Se,entity_seq_num_1:ne,entity_seq_num_2:ne,comp_id_1:Se,comp_id_2:Se,atom_id_1:Se,atom_id_2:Se,value_order:K(Ne),component_1:ne,component_2:ne,link_class:K(Se)},pdbx_reference_entity_poly_link:{link_id:ne,prd_id:Se,ref_entity_id:Se,component_id:ne,entity_seq_num_1:ne,entity_seq_num_2:ne,comp_id_1:Se,comp_id_2:Se,atom_id_1:Se,atom_id_2:Se,value_order:K(Ne)},pdbx_reference_entity_poly:{prd_id:Se,ref_entity_id:Se,type:K(Se),db_code:Se,db_name:Se},pdbx_reference_entity_poly_seq:{prd_id:Se,ref_entity_id:Se,mon_id:Se,parent_mon_id:Se,num:ne,observed:K(Ne),hetero:K(Ne)},pdbx_reference_entity_sequence:{prd_id:Se,ref_entity_id:Se,type:K(Se),NRP_flag:K(Se),one_letter_codes:Se},pdbx_reference_entity_src_nat:{prd_id:Se,ref_entity_id:Se,ordinal:ne,organism_scientific:Se,taxid:Se,db_code:Se,db_name:Se},pdbx_prd_audit:{prd_id:Se,date:Se,processing_site:K(Se),action_type:K(Se)}};var Te=W.VP.Schema;const ie=Te.str,nt={datablock:{id:ie,description:ie},dictionary:{title:ie,datablock_id:ie,version:ie},dictionary_history:{version:ie,update:ie,revision:ie},sub_category:{id:ie,description:ie},category_group_list:{id:ie,parent_id:ie,description:ie},item_type_list:{code:ie,primitive_code:ie,construct:ie,detail:ie},item_units_list:{code:ie,detail:ie},item_units_conversion:{from_code:ie,to_code:ie,operator:ie,factor:Te.float}};var je=W.VP.Schema;const Lt=je.str,Je=je.int,en=je.float,Bt=je.Aliased,pn=je.Vector,mt=(Bt(Lt),Bt(Lt),Bt(Lt),Bt(Lt),pn(3),pn(3),{volume_data_3d_info:{name:Lt,axis_order:pn(3,Je),origin:pn(3),dimensions:pn(3),sample_rate:Je,sample_count:pn(3,Je),spacegroup_number:Je,spacegroup_cell_size:pn(3),spacegroup_cell_angles:pn(3),mean_source:en,mean_sampled:en,sigma_source:en,sigma_sampled:en,min_source:en,min_sampled:en,max_source:en,max_sampled:en},volume_data_3d:{values:en}});var _t=W.VP.Schema;const Me=_t.float,Ke=_t.int,ut=_t.str,sn={cell:{angle_alpha:Me,angle_beta:Me,angle_gamma:Me,formula_units_z:Ke,length_a:Me,length_b:Me,length_c:Me,volume:Me},chemical:{melting_point:Me,name_common:ut,name_systematic:ut},chemical_formula:{moiety:ut,sum:ut,weight:Me},space_group:{crystal_system:ut,it_number:Ke,"name_h-m_full":ut},space_group_symop:{operation_xyz:ut},geom_bond:{atom_site_label_1:ut,atom_site_label_2:ut,distance:Me,publ_flag:ut,site_symmetry_1:ut,site_symmetry_2:ut,valence:Me},audit:{block_doi:ut},database_code:{cod:ut,csd:ut,depnum_ccdc_archive:ut,depnum_ccdc_fiz:ut,icsd:ut,mdf:ut,nbs:ut},atom_site:{adp_type:ut,calc_flag:ut,disorder_assembly:ut,disorder_group:ut,fract_x:Me,fract_y:Me,fract_z:Me,label:ut,occupancy:Me,refinement_flags:ut,site_symmetry_multiplicity:Ke,type_symbol:ut,u_iso_or_equiv:Me},atom_site_aniso:{label:ut,u_11:Me,u:(0,_t.Matrix)(3,3),u_12:Me,u_13:Me,u_22:Me,u_23:Me,u_33:Me},atom_type:{description:ut,symbol:ut},atom_type_scat:{dispersion_imag:Me,dispersion_real:Me,source:ut}},gt={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},At=W.VP.Schema.int,Gt={volume_data_3d_info:mt.volume_data_3d_info,segmentation_data_table:{set_id:At,segment_id:At},segmentation_data_3d:{values:At}},rn={parse:tt=>"string"==typeof tt?J(tt):Y(tt),parseText:J,parseBinary:Y,toDatabaseCollection:ee.nN,toDatabase:ee.Pd,schema:{mmCIF:tt=>(0,ee.Pd)(g.r,tt),CCD:tt=>(0,ee.Pd)(we,tt),BIRD:tt=>(0,ee.Pd)(be,tt),dic:tt=>(0,ee.Pd)(nt,tt),cifCore:tt=>(0,ee.Pd)(sn,tt,gt),densityServer:tt=>(0,ee.Pd)(mt,tt),segmentation:tt=>(0,ee.Pd)(Gt,tt)}}},2241:(tn,Ue,n)=>{"use strict";n.d(Ue,{G:()=>v,IU:()=>A,RF:()=>i,cS:()=>O,jG:()=>t,p4:()=>y,xA:()=>c});var i,e=n(6651),o=n(2025),r=n(3656);function t(_,M){return{name:M,blocks:_}}function A(_,M,I,l=[]){return{categoryNames:_,header:I,categories:M,saveFrames:l,getField(m){const[u,d]=m.split(".");return M[u].getField(d||"")}}}function y(_,M,I){return{categoryNames:_,header:I,categories:M}}function c(_,M,I,l){return{rowCount:M,name:_,fieldNames:[...I],getField:m=>l[m]}}function v(_,M,I,l){const m=I?0:1;switch(M){case 1:return"brackets"===l?u=>`${_}[${u+m}]`:u=>`${_}_${u+m}`;case 2:return"brackets"===l?(u,d)=>`${_}[${u+m}][${d+m}]`:(u,d)=>`${_}_${u+m}${d+m}`;case 3:return"brackets"===l?(u,d,s)=>`${_}[${u+m}][${d+m}][${s+m}]`:(u,d,s)=>`${_}_${u+m}${d+m}${s+m}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function O(_,M,I,l){const m=M.create();if(1===M.rank){const u=M.dimensions[0];for(let d=0;d<u;d++){const s=_.getField(l(d));M.set(m,d,s?s.float(I):0)}}else if(2===M.rank){const u=M.dimensions[0],d=M.dimensions[1];for(let s=0;s<u;s++)for(let C=0;C<d;C++){const h=_.getField(l(s,C));M.set(m,s,C,h?h.float(I):0)}}else{if(3!==M.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const u=M.dimensions[0],d=M.dimensions[1],s=M.dimensions[2];for(let C=0;C<u;C++)for(let h=0;h<d;h++)for(let a=0;a<s;a++){const S=_.getField(l(C,h,a));M.set(m,C,h,a,S?S.float(I):0)}}}return m}!function(_){function I(m,u){const d=Object.keys(u);return{rowCount:d.length>0?u[d[0]].rowCount:0,name:m,fieldNames:d,getField:s=>u[s]}}_.empty=function M(m){return{rowCount:0,name:m,fieldNames:[],getField(u){}}},_.ofFields=I,_.ofTable=function l(m,u){const d={};for(const s of u._columns)d[s]=i.ofColumn(u[s]);return I(m,d)}}(c||(c={})),function(_){function I(s){const C=s.length,h=R=>{const f=s[R];return f&&"."!==f&&"?"!==f?f:""},a=R=>{const f=s[R];return(0,o.H9)(f,0,f.length)||0},S=R=>{const f=s[R];return(0,o.sS)(f,0,f.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:C,str:h,int:a,float:S,valueKind:R=>{const f=s[R],p=f.length;if(p>1)return 0;if(0===p)return 1;const E=f.charCodeAt(0);return 46===E?1:63===E?2:0},areValuesEqual:(R,f)=>s[R]===s[f],toStringArray:R=>R?e.iu.createAndFillArray(C,h,R):s,toIntArray:R=>e.iu.createAndFillArray(C,a,R),toFloatArray:R=>e.iu.createAndFillArray(C,S,R)}}function u(s){const{rowCount:C,valueKind:h,areValuesEqual:a,isDefined:S}=s;let D,R,f;switch(s.schema.valueType){case"float":case"int":D=E=>""+s.value(E),R=s.value,f=s.value;break;case"str":D=s.value,R=E=>{const T=s.value(E);return(0,o.H9)(T,0,T.length)||0},f=E=>{const T=s.value(E);return(0,o.sS)(T,0,T.length)||0};break;case"list":const{separator:p}=s.schema;D=E=>s.value(E).join(p),R=E=>NaN,f=E=>NaN;break;default:throw new Error(`unsupported valueType '${s.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:S,rowCount:C,str:D,int:R,float:f,valueKind:h,areValuesEqual:a,toStringArray:p=>e.iu.createAndFillArray(C,D,p),toIntArray:p=>e.iu.createAndFillArray(C,R,p),toFloatArray:p=>e.iu.createAndFillArray(C,f,p)}}_.ofString=function M(s){return I([s])},_.ofStrings=I,_.ofNumbers=function l(s){const C=s.length,h=R=>""+s[R],a=R=>s[R],D=R=>!R||R.array&&s instanceof R.array?s:e.iu.createAndFillArray(C,a,R);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:C,str:h,int:a,float:a,valueKind:R=>0,areValuesEqual:(R,f)=>s[R]===s[f],toStringArray:R=>e.iu.createAndFillArray(C,h,R),toIntArray:D,toFloatArray:D}},_.ofTokens=function m(s){const{data:C,indices:h,count:a}=s,S=p=>{const E=C.substring(h[2*p],h[2*p+1]);return"."===E||"?"===E?"":E},D=p=>(0,o.H9)(C,h[2*p],h[2*p+1])||0,R=p=>(0,o.sS)(C,h[2*p],h[2*p+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:a,str:S,int:D,float:R,valueKind:p=>{const E=h[2*p],T=h[2*p+1]-E;if(T>1)return 0;if(0===T)return 1;const L=C.charCodeAt(E);return 46===L?1:63===L?2:0},areValuesEqual:(0,r.k5)(s),toStringArray:p=>e.iu.createAndFillArray(a,S,p),toIntArray:p=>e.iu.createAndFillArray(a,D,p),toFloatArray:p=>e.iu.createAndFillArray(a,R,p)}},_.ofColumn=u,_.ofUndefined=function d(s,C){return u(e.VP.Undefined(s,C))}}(i||(i={}))},7754:(tn,Ue,n)=>{"use strict";n.d(Ue,{MR:()=>i,Pd:()=>c,nN:()=>y});var A,e=n(6651),o=n(4369),r=n(9909),t=n(2241);function y(s,C,h){const a={};for(const S of C.blocks)a[S.header]=c(s,S,h);return a}function c(s,C,h){return function l(s,C,h){const a=Object.create(null);for(const S of Object.keys(s))a[S]=d(S,s[S],C,h);return e.Wm.ofTables(C.header,s,a)}(s,C,h)}function i(s,C){return new I(C,s,!0)}function v(s){switch(s.valueType){case"str":return(C,h,a)=>function O(s,C,h,a){return{schema:s,__array:C.__array,isDefined:C.isDefined,rowCount:C.rowCount,value:"lowercase"===s.transform?S=>h(S).toLowerCase():"uppercase"===s.transform?S=>h(S).toUpperCase():h,valueKind:C.valueKind,areValuesEqual:C.areValuesEqual,toArray:"lowercase"===s.transform?S=>Array.from(a(S)).map(D=>D.toLowerCase()):"uppercase"===s.transform?S=>Array.from(a(S)).map(D=>D.toUpperCase()):a}}(s,C,C.str,C.toStringArray);case"int":return(C,h,a)=>b(s,C,C.int,C.toIntArray);case"float":return(C,h,a)=>b(s,C,C.float,C.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function b(s,C,h,a){return{schema:s,__array:C.__array,isDefined:C.isDefined,rowCount:C.rowCount,value:h,valueKind:C.valueKind,areValuesEqual:C.areValuesEqual,toArray:a}}function _(s,C,h){const a=s.separator,S=s.itemParse,D=C.getField(h),R=D?p=>D.str(p).split(a).map(E=>S(E.trim())).filter(E=>!!E):p=>[];return{schema:s,__array:void 0,isDefined:!!D,rowCount:C.rowCount,value:R,valueKind:D?D.valueKind:()=>1,areValuesEqual:(p,E)=>(0,r.af)(R(p),R(E)),toArray:p=>e.iu.createAndFillArray(C.rowCount,R,p)}}function M(s,C,h){const a=s.space,S=C.fieldNames.includes(`${h}[0]`)||C.fieldNames.includes(`${h}[0][0]`)||C.fieldNames.includes(`${h}[0][0][0]`),D=S?0:1,R=C.fieldNames.includes(`${h}_1`)||C.fieldNames.includes(`${h}_11`)||C.fieldNames.includes(`${h}_111`)?"underscore":"brackets",f=t.G(h,a.rank,S,R),p=C.getField(f(D,D,D))||e.VP.Undefined(C.rowCount,s),E=L=>t.cS(C,a,L,f);return{schema:s,__array:void 0,isDefined:p.isDefined,rowCount:C.rowCount,value:E,valueKind:p.valueKind,areValuesEqual:(L,w)=>o.qY.areEqualExact(E(L),E(w)),toArray:L=>e.iu.createAndFillArray(C.rowCount,E,L)}}!function(s){function C(S){return S.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}s.canonical=C,s.equal=function h(S,D){return C(S)===C(D)},s.create=function a(S,D,R=!1){const f=`${S}${D?`.${D}`:""}`;return R?C(f):f}}(A||(A={}));class I{constructor(C,h,a){this._isDefined=a;const S=Object.keys(h);this._rowCount=C.rowCount,this._columns=S,this._schema=h;const D=Object.create(null);for(const R of S)Object.defineProperty(this,R,{get:function(){if(D[R])return D[R];const f=h[R];if("list"===f.valueType)D[R]=_(f,C,R);else if("tensor"===f.valueType)D[R]=M(f,C,R);else{const p=v(f),E=C.getField(R);D[R]=E?p(E,C,R):e.VP.Undefined(C.rowCount,f)}return D[R]},enumerable:!0,configurable:!1})}}function u(s,C,h,a){const S=A.create(C,s),D=A.canonical(S);if(D in h)return h[D];if(a&&S in a)for(const R of a[S]){const f=A.canonical(R);if(f in h)return h[f]}}function d(s,C,h,a){let S=h.categories[s];if(a){const D=function m(s){const C=Object.create(null);for(const h of Object.keys(s.categories))for(const a of s.categories[h].fieldNames)C[A.create(h,a,!0)]=s.categories[h].getField(a);return C}(h),R=Object.create(null),f=[];let p=0;for(const E of Object.keys(C)){const T=u(E,s,D,a);T&&(R[E]=T,f.push(E),p=T.rowCount)}S={rowCount:p,name:s,fieldNames:[...f],getField:E=>R[E]}}return new I(S||t.xA.empty(s),C,!!S)}},7357:(tn,Ue,n)=>{"use strict";n.d(Ue,{r:()=>_});var o=n(6651).VP.Schema;const r=o.str,t=o.int,A=o.float,y=o.coord,c=o.Aliased,i=o.Matrix,v=o.Vector,O=o.lstr,b=o.List,_={atom_site:{auth_asym_id:r,auth_atom_id:r,auth_comp_id:r,auth_seq_id:t,B_iso_or_equiv:A,Cartn_x:y,Cartn_y:y,Cartn_z:y,group_PDB:c(r),id:t,label_alt_id:r,label_asym_id:r,label_atom_id:r,label_comp_id:r,label_entity_id:r,label_seq_id:t,occupancy:A,type_symbol:r,pdbx_PDB_ins_code:r,pdbx_PDB_model_num:t,pdbx_formal_charge:t,pdbx_label_index:t,pdbx_sifts_xref_db_name:r,pdbx_sifts_xref_db_acc:r,pdbx_sifts_xref_db_num:r,pdbx_sifts_xref_db_res:r,ihm_model_id:t},atom_site_anisotrop:{id:t,type_symbol:r,U:i(3,3),U_esd:i(3,3),pdbx_auth_seq_id:r,pdbx_auth_asym_id:r,pdbx_auth_atom_id:r,pdbx_auth_comp_id:r,pdbx_label_seq_id:t,pdbx_label_alt_id:r,pdbx_label_asym_id:r,pdbx_label_atom_id:r,pdbx_label_comp_id:r,pdbx_PDB_ins_code:r},atom_sites:{entry_id:r,fract_transf_matrix:i(3,3),fract_transf_vector:v(3)},audit_author:{name:r,pdbx_ordinal:t,identifier_ORCID:r},audit_conform:{dict_location:r,dict_name:r,dict_version:r},cell:{angle_alpha:A,angle_beta:A,angle_gamma:A,entry_id:r,length_a:A,length_b:A,length_c:A,Z_PDB:t,pdbx_unique_axis:r},chem_comp:{formula:r,formula_weight:A,id:r,mon_nstd_flag:c(O),name:r,type:c(O),pdbx_synonyms:b(";",M=>M)},chem_comp_bond:{atom_id_1:r,atom_id_2:r,comp_id:r,value_order:c(O),pdbx_ordinal:t,pdbx_stereo_config:c(O),pdbx_aromatic_flag:c(O)},citation:{book_publisher:r,country:r,id:r,journal_abbrev:r,journal_id_ASTM:r,journal_id_CSD:r,journal_id_ISSN:r,journal_volume:r,page_first:r,page_last:r,title:r,year:t,pdbx_database_id_DOI:r,pdbx_database_id_PubMed:t},citation_author:{citation_id:r,name:r,ordinal:t},database_2:{database_id:c(O),database_code:r},entity:{details:r,formula_weight:A,id:r,src_method:c(O),type:c(O),pdbx_description:b(",",M=>M),pdbx_number_of_molecules:t,pdbx_mutation:r,pdbx_fragment:r,pdbx_ec:b(",",M=>M)},entity_poly:{entity_id:r,nstd_linkage:c(O),nstd_monomer:c(O),type:c(r),pdbx_strand_id:b(",",M=>M),pdbx_seq_one_letter_code:r,pdbx_seq_one_letter_code_can:r,pdbx_target_identifier:r},entity_poly_seq:{entity_id:r,hetero:c(O),mon_id:r,num:t},entry:{id:r},exptl:{entry_id:r,method:c(r)},software:{classification:r,date:r,description:r,name:r,type:c(O),version:r,pdbx_ordinal:t},struct:{entry_id:r,title:r,pdbx_descriptor:r},struct_asym:{details:r,entity_id:r,id:r,pdbx_modified:r,pdbx_blank_PDB_chainid_flag:c(r)},struct_conf:{beg_label_asym_id:r,beg_label_comp_id:r,beg_label_seq_id:t,beg_auth_asym_id:r,beg_auth_comp_id:r,beg_auth_seq_id:t,conf_type_id:c(O),details:r,end_label_asym_id:r,end_label_comp_id:r,end_label_seq_id:t,end_auth_asym_id:r,end_auth_comp_id:r,end_auth_seq_id:t,id:r,pdbx_beg_PDB_ins_code:r,pdbx_end_PDB_ins_code:r,pdbx_PDB_helix_class:r,pdbx_PDB_helix_length:t,pdbx_PDB_helix_id:r},struct_conn:{conn_type_id:c(O),details:r,id:r,ptnr1_label_asym_id:r,ptnr1_label_atom_id:r,ptnr1_label_comp_id:r,ptnr1_label_seq_id:t,ptnr1_auth_asym_id:r,ptnr1_auth_comp_id:r,ptnr1_auth_seq_id:t,ptnr1_symmetry:r,ptnr2_label_asym_id:r,ptnr2_label_atom_id:r,ptnr2_label_comp_id:r,ptnr2_label_seq_id:t,ptnr2_auth_asym_id:r,ptnr2_auth_comp_id:r,ptnr2_auth_seq_id:t,ptnr2_symmetry:r,pdbx_ptnr1_PDB_ins_code:r,pdbx_ptnr1_label_alt_id:r,pdbx_ptnr1_standard_comp_id:r,pdbx_ptnr2_PDB_ins_code:r,pdbx_ptnr2_label_alt_id:r,pdbx_ptnr3_PDB_ins_code:r,pdbx_ptnr3_label_alt_id:r,pdbx_ptnr3_label_asym_id:r,pdbx_ptnr3_label_atom_id:r,pdbx_ptnr3_label_comp_id:r,pdbx_ptnr3_label_seq_id:t,pdbx_PDB_id:r,pdbx_dist_value:A,pdbx_value_order:c(O)},struct_conn_type:{criteria:r,id:c(O),reference:r},struct_keywords:{entry_id:r,text:b(",",M=>M),pdbx_keywords:r},struct_ncs_oper:{code:c(r),details:r,id:t,matrix:i(3,3),vector:v(3)},struct_sheet_range:{beg_label_asym_id:r,beg_label_comp_id:r,beg_label_seq_id:t,end_label_asym_id:r,end_label_comp_id:r,end_label_seq_id:t,beg_auth_asym_id:r,beg_auth_comp_id:r,beg_auth_seq_id:t,end_auth_asym_id:r,end_auth_comp_id:r,end_auth_seq_id:t,id:r,sheet_id:r,pdbx_beg_PDB_ins_code:r,pdbx_end_PDB_ins_code:r},struct_site:{details:r,id:r,pdbx_num_residues:t,pdbx_evidence_code:r,pdbx_auth_asym_id:r,pdbx_auth_comp_id:r,pdbx_auth_seq_id:r,pdbx_auth_ins_code:r},struct_site_gen:{details:r,id:r,label_alt_id:r,label_asym_id:r,label_atom_id:r,label_comp_id:r,label_seq_id:t,auth_asym_id:r,auth_comp_id:r,auth_seq_id:r,site_id:r,symmetry:r,pdbx_auth_ins_code:r,pdbx_num_res:t},symmetry:{entry_id:r,cell_setting:c(O),Int_Tables_number:t,space_group_name_Hall:r,"space_group_name_H-M":r},pdbx_database_status:{status_code:c(r),status_code_sf:c(r),status_code_mr:c(r),entry_id:r,recvd_initial_deposition_date:r,SG_entry:c(O),deposit_site:c(r),process_site:c(r),status_code_cs:c(r),methods_development_category:c(r),pdb_format_compatible:c(O)},pdbx_nonpoly_scheme:{asym_id:r,entity_id:r,mon_id:r,pdb_strand_id:r,ndb_seq_num:r,pdb_seq_num:r,auth_seq_num:r,pdb_mon_id:r,auth_mon_id:r,pdb_ins_code:r},pdbx_database_related:{db_name:r,details:r,db_id:r,content_type:c(r)},pdbx_entity_nonpoly:{entity_id:r,comp_id:r,name:r},pdbx_chem_comp_synonyms:{name:r,comp_id:r,provenance:c(r)},pdbx_chem_comp_identifier:{comp_id:r,identifier:r,type:c(r),program:r,program_version:r},pdbx_unobs_or_zero_occ_residues:{id:t,polymer_flag:c(O),occupancy_flag:c(t),PDB_model_num:t,auth_asym_id:r,auth_comp_id:r,auth_seq_id:r,PDB_ins_code:r,label_asym_id:r,label_comp_id:r,label_seq_id:t},pdbx_struct_mod_residue:{id:t,auth_asym_id:r,auth_comp_id:r,auth_seq_id:t,PDB_ins_code:r,label_asym_id:r,label_comp_id:r,label_seq_id:t,parent_comp_id:r,details:r},pdbx_struct_oper_list:{id:r,type:c(r),name:r,symmetry_operation:r,matrix:i(3,3),vector:v(3)},pdbx_struct_assembly:{method_details:r,oligomeric_details:r,oligomeric_count:t,details:r,id:r},pdbx_struct_assembly_gen:{asym_id_list:b(",",M=>M),assembly_id:r,oper_expression:r},pdbx_reference_entity_list:{prd_id:r,ref_entity_id:r,type:c(O),details:r,component_id:t},pdbx_reference_entity_link:{link_id:t,prd_id:r,details:r,ref_entity_id_1:r,ref_entity_id_2:r,entity_seq_num_1:t,entity_seq_num_2:t,comp_id_1:r,comp_id_2:r,atom_id_1:r,atom_id_2:r,value_order:c(O),component_1:t,component_2:t,link_class:c(r)},pdbx_reference_entity_poly_link:{link_id:t,prd_id:r,ref_entity_id:r,component_id:t,entity_seq_num_1:t,entity_seq_num_2:t,comp_id_1:r,comp_id_2:r,atom_id_1:r,atom_id_2:r,value_order:c(O)},pdbx_molecule:{prd_id:r,instance_id:t,asym_id:r},pdbx_molecule_features:{prd_id:r,class:c(O),type:c(O),name:r,details:r},entity_src_nat:{entity_id:r,pdbx_organism_scientific:r,pdbx_plasmid_name:r,pdbx_src_id:t,pdbx_beg_seq_num:t,pdbx_end_seq_num:t},entity_src_gen:{entity_id:r,pdbx_gene_src_gene:b(",",M=>M),pdbx_gene_src_scientific_name:r,plasmid_name:r,pdbx_src_id:t,pdbx_beg_seq_num:t,pdbx_end_seq_num:t},pdbx_entity_src_syn:{organism_scientific:r,entity_id:r,pdbx_src_id:t,pdbx_beg_seq_num:t,pdbx_end_seq_num:t},pdbx_entity_branch_descriptor:{entity_id:r,descriptor:r,type:c(O),program:r,program_version:r,ordinal:t},pdbx_entity_instance_feature:{details:r,feature_type:c(r),auth_asym_id:r,asym_id:r,auth_seq_num:r,seq_num:t,comp_id:r,auth_comp_id:r,ordinal:t},pdbx_entity_branch_list:{entity_id:r,hetero:c(O),comp_id:r,num:t},pdbx_entity_branch_link:{link_id:t,details:r,entity_id:r,entity_branch_list_num_1:t,entity_branch_list_num_2:t,comp_id_1:r,comp_id_2:r,atom_id_1:r,leaving_atom_id_1:r,atom_stereo_config_1:c(O),atom_id_2:r,leaving_atom_id_2:r,atom_stereo_config_2:c(O),value_order:c(O)},pdbx_entity_branch:{entity_id:r,type:c(r)},pdbx_branch_scheme:{entity_id:r,hetero:c(O),asym_id:r,mon_id:r,num:t,pdb_asym_id:r,pdb_seq_num:r,pdb_mon_id:r,auth_asym_id:r,auth_seq_num:r,auth_mon_id:r},pdbx_chem_comp_related:{comp_id:r,related_comp_id:r,relationship_type:c(r),details:r},ihm_starting_model_details:{starting_model_id:r,entity_id:r,entity_description:r,asym_id:r,entity_poly_segment_id:t,starting_model_source:c(r),starting_model_auth_asym_id:r,starting_model_sequence_offset:t,dataset_list_id:t},ihm_starting_comparative_models:{id:t,starting_model_id:r,starting_model_auth_asym_id:r,starting_model_seq_id_begin:t,starting_model_seq_id_end:t,template_auth_asym_id:r,template_seq_id_begin:t,template_seq_id_end:t,template_sequence_identity:A,template_sequence_identity_denominator:c(t),template_dataset_list_id:t,alignment_file_id:t},ihm_starting_model_seq_dif:{id:t,entity_id:r,asym_id:r,seq_id:t,comp_id:r,starting_model_id:r,db_asym_id:r,db_seq_id:t,db_comp_id:r,details:r},ihm_model_representation:{id:t,name:r,details:r},ihm_model_representation_details:{id:t,representation_id:t,entity_poly_segment_id:t,entity_id:r,entity_description:r,entity_asym_id:r,model_object_primitive:c(r),starting_model_id:r,model_mode:c(r),model_granularity:c(r),model_object_count:t},ihm_struct_assembly_details:{id:t,assembly_id:t,parent_assembly_id:t,entity_description:r,entity_id:r,asym_id:r,entity_poly_segment_id:t},ihm_struct_assembly:{id:t,name:r,description:r},ihm_modeling_protocol:{id:t,num_steps:t,protocol_name:r},ihm_modeling_protocol_details:{id:t,protocol_id:t,step_id:t,struct_assembly_id:t,dataset_group_id:t,struct_assembly_description:r,step_name:r,step_method:r,num_models_begin:t,num_models_end:t,multi_scale_flag:c(O),multi_state_flag:c(O),ordered_flag:c(O),script_file_id:t,software_id:t},ihm_multi_state_modeling:{state_id:t,state_group_id:t,population_fraction:A,population_fraction_sd:A,state_type:r,state_name:r,experiment_type:c(r),details:r},ihm_modeling_post_process:{id:t,protocol_id:t,analysis_id:t,step_id:t,type:c(r),feature:c(r),num_models_begin:t,num_models_end:t},ihm_ensemble_info:{ensemble_id:t,ensemble_name:r,post_process_id:t,model_group_id:t,ensemble_clustering_method:c(r),ensemble_clustering_feature:c(r),num_ensemble_models:t,num_ensemble_models_deposited:t,ensemble_precision_value:A,ensemble_file_id:t},ihm_model_list:{model_id:t,model_name:r,assembly_id:t,protocol_id:t,representation_id:t},ihm_model_group:{id:t,name:r,details:r},ihm_model_group_link:{model_id:t,group_id:t},ihm_model_representative:{id:t,model_group_id:t,model_id:t,selection_criteria:c(r)},ihm_dataset_list:{id:t,data_type:c(r),database_hosted:c(O)},ihm_dataset_group:{id:t,name:r,application:c(r),details:r},ihm_dataset_group_link:{dataset_list_id:t,group_id:t},ihm_related_datasets:{dataset_list_id_derived:t,dataset_list_id_primary:t},ihm_dataset_related_db_reference:{id:t,dataset_list_id:t,db_name:c(r),accession_code:r,version:r,details:r},ihm_external_reference_info:{reference_id:t,reference_provider:r,reference_type:c(r),reference:r,refers_to:c(r),associated_url:r},ihm_external_files:{id:t,reference_id:t,file_path:r,content_type:c(r),file_size_bytes:A,details:r},ihm_dataset_external_reference:{id:t,dataset_list_id:t,file_id:t},ihm_localization_density_files:{id:t,file_id:t,ensemble_id:t,entity_id:r,entity_poly_segment_id:t,asym_id:r},ihm_predicted_contact_restraint:{id:t,group_id:t,entity_id_1:r,entity_id_2:r,asym_id_1:r,asym_id_2:r,comp_id_1:r,comp_id_2:r,seq_id_1:t,seq_id_2:t,rep_atom_1:c(r),rep_atom_2:c(r),distance_lower_limit:A,distance_upper_limit:A,probability:A,restraint_type:c(r),model_granularity:c(r),dataset_list_id:t,software_id:t},ihm_cross_link_list:{id:t,group_id:t,entity_description_1:r,entity_description_2:r,entity_id_1:r,entity_id_2:r,comp_id_1:r,comp_id_2:r,seq_id_1:t,seq_id_2:t,linker_type:c(r),dataset_list_id:t},ihm_cross_link_restraint:{id:t,group_id:t,entity_id_1:r,entity_id_2:r,asym_id_1:r,asym_id_2:r,comp_id_1:r,comp_id_2:r,seq_id_1:t,seq_id_2:t,atom_id_1:r,atom_id_2:r,restraint_type:c(r),conditional_crosslink_flag:c(r),model_granularity:c(r),distance_threshold:A,psi:A,sigma_1:A,sigma_2:A},ihm_cross_link_result_parameters:{id:t,restraint_id:t,model_id:t,psi:A,sigma_1:A,sigma_2:A},ihm_2dem_class_average_restraint:{id:t,dataset_list_id:t,number_raw_micrographs:t,pixel_size_width:A,pixel_size_height:A,image_resolution:A,image_segment_flag:c(O),number_of_projections:t,struct_assembly_id:t,details:r},ihm_2dem_class_average_fitting:{id:t,restraint_id:t,model_id:t,cross_correlation_coefficient:A,rot_matrix:i(3,3),tr_vector:v(3)},ihm_3dem_restraint:{id:t,dataset_list_id:t,model_id:t,struct_assembly_id:t,fitting_method:r,number_of_gaussians:t,cross_correlation_coefficient:A},ihm_sas_restraint:{id:t,dataset_list_id:t,model_id:t,struct_assembly_id:t,profile_segment_flag:c(O),fitting_atom_type:r,fitting_method:r,fitting_state:c(r),radius_of_gyration:A,chi_value:A,details:r},ihm_starting_model_coord:{ordinal_id:t,starting_model_id:r,group_PDB:c(r),id:t,type_symbol:r,entity_id:r,atom_id:r,comp_id:r,seq_id:t,asym_id:r,Cartn_x:A,Cartn_y:A,Cartn_z:A,B_iso_or_equiv:A},ihm_sphere_obj_site:{id:t,entity_id:r,seq_id_begin:t,seq_id_end:t,asym_id:r,Cartn_x:A,Cartn_y:A,Cartn_z:A,object_radius:A,rmsf:A,model_id:t},ihm_gaussian_obj_site:{id:t,entity_id:r,seq_id_begin:t,seq_id_end:t,asym_id:r,mean_Cartn_x:A,mean_Cartn_y:A,mean_Cartn_z:A,weight:A,covariance_matrix:i(3,3),model_id:t},ihm_gaussian_obj_ensemble:{id:t,entity_id:r,seq_id_begin:t,seq_id_end:t,asym_id:r,mean_Cartn_x:A,mean_Cartn_y:A,mean_Cartn_z:A,weight:A,covariance_matrix:i(3,3),ensemble_id:t},ihm_feature_list:{feature_id:t,feature_type:c(r),entity_type:c(r)},ihm_poly_residue_feature:{ordinal_id:t,feature_id:t,entity_id:r,asym_id:r,comp_id_begin:r,comp_id_end:r,seq_id_begin:t,seq_id_end:t},ihm_derived_distance_restraint:{id:t,group_id:t,feature_id_1:t,feature_id_2:t,group_conditionality:c(r),random_exclusion_fraction:A,distance_upper_limit:A,restraint_type:c(r),dataset_list_id:t},ma_model_list:{ordinal_id:t,model_id:t,model_group_id:t,model_name:r,model_group_name:r,model_type:c(r),data_id:t},ma_target_entity:{entity_id:r,data_id:t,origin:c(r)},ma_target_entity_instance:{asym_id:r,entity_id:r,details:r},ma_target_ref_db_details:{target_entity_id:r,db_name:c(r),db_code:r,db_accession:r,seq_db_isoform:r,seq_db_align_begin:r,seq_db_align_end:r,ncbi_taxonomy_id:r,organism_scientific:r},ma_data:{id:t,content_type:c(r),content_type_other_details:r,name:r},ma_software_group:{ordinal_id:t,group_id:t,software_id:t},ma_qa_metric:{id:t,name:r,type:c(r),mode:c(r),software_group_id:t},ma_qa_metric_global:{ordinal_id:t,model_id:t,metric_id:t,metric_value:A},ma_qa_metric_local:{ordinal_id:t,model_id:t,label_asym_id:r,label_seq_id:t,label_comp_id:r,metric_id:t,metric_value:A}}},3656:(tn,Ue,n)=>{"use strict";n.d(Ue,{E7:()=>t,Yb:()=>y,do:()=>r,k5:()=>A});var e=n(6651),o=n(2025);function r(c){return function(i){return t(c,i)}}function t(c,i){const{data:v,indices:O,count:b}=c,{valueType:_}=i,M="str"===_?I=>v.substring(O[2*I],O[2*I+1]):"int"===_?I=>(0,o.H9)(v,O[2*I],O[2*I+1])||0:I=>(0,o.sS)(v,O[2*I],O[2*I+1])||0;return{schema:i,__array:void 0,isDefined:!0,rowCount:b,value:M,valueKind:I=>0,toArray:I=>e.iu.createAndFillArray(b,M,I),areValuesEqual:A(c)}}function A(c){const{data:i,indices:v}=c;return function(O,b){const _=v[2*O],M=v[2*b],I=v[2*O+1]-_;if(I!==v[2*b+1]-M)return!1;for(let l=0;l<I;l++)if(i.charCodeAt(l+_)!==i.charCodeAt(l+M))return!1;return!0}}function y(c){const{count:i,indices:v}=c;for(let O=0;O<i;++O)if(v[2*O]!==v[2*O+1])return!1;return!0}},2025:(tn,Ue,n)=>{"use strict";function e(O,b,_){for(;b<_&&32===O.charCodeAt(b);)b++;return o(O,b,_)}function o(O,b,_){let M=b,I=0,l=1;for(45===O.charCodeAt(M)?(l=-1,++M):43===O.charCodeAt(M)&&++M;M<_;M++){const m=O.charCodeAt(M)-48;if(m>9||m<0)return l*I|0;I=10*I+m|0}return l*I}function r(O,b,_,M){return 43===b.charCodeAt(_)&&_++,O*Math.pow(10,o(b,_,M))}function t(O,b,_){for(;b<_&&32===O.charCodeAt(b);)b++;return A(O,b,_)}function A(O,b,_){let M=b,I=1,l=0,m=0,u=1;for(45===O.charCodeAt(M)?(I=-1,++M):43===O.charCodeAt(M)&&++M;M<_;){let d=O.charCodeAt(M)-48;if(!(d>=0&&d<10)){if(-2===d){for(++M;M<_;){if(d=O.charCodeAt(M)-48,!(d>=0&&d<10))return 53===d||21===d?r(I*(l+m/u),O,M+1,_):I*(l+m/u);m=10*m+d,u*=10,++M}return I*(l+m/u)}if(53===d||21===d)return r(I*l,O,M+1,_);break}l=10*l+d,++M}return I*l}n.d(Ue,{Al:()=>t,H9:()=>o,jj:()=>e,sS:()=>A})},5555:(tn,Ue,n)=>{"use strict";n.d(Ue,{_F:()=>r,qk:()=>t,tM:()=>A});var A,e=n(467),o=n(4824);function r(y){return{data:y,position:0,length:y.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function t(y,c,i){let v=c,O=i-1,b=y.charCodeAt(v);for(;(9===b||32===b)&&v<=O;)b=y.charCodeAt(++v);for(b=y.charCodeAt(O);(9===b||32===b)&&O>=v;)b=y.charCodeAt(--O);return y.substring(v,O+1)}!function(y){function c(f){return f.data.substring(f.tokenStart,f.tokenEnd)}function v(f){const{data:p}=f;for(;f.position<f.length;)switch(p.charCodeAt(f.position)){case 10:return f.tokenEnd=f.position,++f.position,++f.lineNumber,!0;case 13:return f.tokenEnd=f.position,++f.position,++f.lineNumber,10===p.charCodeAt(f.position)&&++f.position,!0;default:++f.position}return f.tokenEnd=f.position,f.tokenStart!==f.tokenEnd}function b(f){return f.tokenStart=f.position,v(f)}function I(f,p,E){let T=0;for(let L=0;L<p;L++){if(!b(f))return T;A.addUnchecked(E,f.tokenStart,f.tokenEnd),T++}return T}function d(){return(d=(0,e.A)(function*(f,p,E,T=1e5){const L=A.create(f.data,2*p);let w=0;return yield(0,o.yB)(E,T,f,(Q,G)=>{const V=Math.min(p-w,Q);return I(G,V,L),w+=V,V},(Q,G)=>Q.update({message:"Parsing...",current:G.position,max:G.length})),L})).apply(this,arguments)}function a(){return(a=(0,e.A)(function*(f,p,E=1e5){const T=y(f),L=A.create(T.data,Math.max(f.length/80,2));return yield(0,o.yB)(p,E,T,(w,Q)=>(function C(f,p,E){let T=0;for(let L=0;L<p;L++){if(!b(f))return T;A.add(E,f.tokenStart,f.tokenEnd),T++}}(Q,w,L),Q.position<Q.length?w:0),(w,Q)=>w.update({message:"Parsing...",current:Q.position,max:Q.length})),L})).apply(this,arguments)}function R(f,p,E){const{data:T}=f;let L=p,w=E-1,Q=T.charCodeAt(L);for(;(9===Q||32===Q)&&L<=w;)Q=T.charCodeAt(++L);for(Q=T.charCodeAt(w);(9===Q||32===Q)&&w>=L;)Q=T.charCodeAt(--w);return f.tokenStart=L,f.tokenEnd=w+1,f.position=E,f}y.getTokenString=c,y.reset=function i(f){f.position=0,f.lineNumber=1,f.tokenStart=0,f.tokenEnd=0},y.eatLine=v,y.markStart=function O(f){f.tokenStart=f.position},y.markLine=b,y.readLine=function _(f){return b(f),c(f)},y.readLineTrim=function M(f){b(f);const p=f.position;return R(f,f.tokenStart,f.tokenEnd),f.position=p,c(f)},y.markLines=function l(f,p){const E=A.create(f.data,2*p);return I(f,p,E),E},y.readLines=function m(f,p){const E=[];for(let T=0;T<p;T++)E.push(y.readLine(f));return E},y.readLinesAsync=function u(f,p,E){return d.apply(this,arguments)},y.readAllLines=function s(f){const p=y(f),E=A.create(p.data,Math.max(f.length/80,2));for(;b(p);)A.add(E,p.tokenStart,p.tokenEnd);return E},y.readAllLinesAsync=function h(f,p){return a.apply(this,arguments)},y.eatValue=function S(f){for(;f.position<f.length;)switch(f.data.charCodeAt(f.position)){case 9:case 10:case 13:case 32:return void(f.tokenEnd=f.position);default:++f.position}f.tokenEnd=f.position},y.skipWhitespace=function D(f){let p=-1;for(;f.position<f.length;){const E=f.data.charCodeAt(f.position);switch(E){case 9:case 32:p=E,++f.position;break;case 10:13!==p&&++f.lineNumber,p=E,++f.position;break;case 13:p=E,++f.position,++f.lineNumber;break;default:return p}}return p},y.trim=R}(r||(r={})),function(y){function i(_,M,I){const l=_;l.offset>l.indicesLenMinus2&&function c(_){const M=new Uint32Array(1.61*_.indices.length|0);M.set(_.indices),_.indices=M,_.indicesLenMinus2=M.length-2|0}(l),l.indices[l.offset++]=M,l.indices[l.offset++]=I,_.count++}y.add=i,y.addToken=function v(_,M){i(_,M.tokenStart,M.tokenEnd)},y.addUnchecked=function O(_,M,I){_.indices[_.offset++]=M,_.indices[_.offset++]=I,_.count++},y.create=function b(_,M){return{data:_,indicesLenMinus2:(M=Math.max(10,M))-2|0,count:0,offset:0,indices:new Uint32Array(M)}}}(A||(A={}))},355:(tn,Ue,n)=>{"use strict";var e;n.d(Ue,{H:()=>e}),function(o){o.error=function r(c,i=-1){return new A(c,i)},o.success=function t(c,i=[]){return new y(c,i)};class A{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(i,v){this.message=i,this.line=v,this.isError=!0}}o.Error=A;class y{constructor(i,v){this.result=i,this.warnings=v,this.isError=!1}}o.Success=y}(e||(e={}))},7421:(tn,Ue,n)=>{"use strict";n.d(Ue,{c:()=>Z});var A,y,q,c,e=n(9115),o=n(862),r=n(144),t=n(1372);function i(q){return(Y,ee)=>ee[q].value(Y)}function v(q){return(Y,ee)=>ee[q].value(Y).join(ee[q].schema.separator)}function O(q,...Y){return(ee,g)=>g[q].schema.space.get(g[q].value(ee),...Y)}function b(q){return(Y,ee)=>ee[q].valueKind(Y)}function _(q,Y){const ee=[],_e=b(q);if(1===Y.rank){const xe=Y.dimensions[0];for(let le=0;le<xe;le++)ee.push({name:`${q}[${le+1}]`,type:2,value:O(q,le),valueKind:_e})}else if(2===Y.rank){const xe=Y.dimensions[0],le=Y.dimensions[1];for(let Ae=0;Ae<xe;Ae++)for(let Be=0;Be<le;Be++)ee.push({name:`${q}[${Ae+1}][${Be+1}]`,type:2,value:O(q,Ae,Be),valueKind:_e})}else{if(3!==Y.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const xe=Y.dimensions[0],le=Y.dimensions[1],Ae=Y.dimensions[2];for(let Be=0;Be<xe;Be++)for(let Ce=0;Ce<le;Ce++)for(let Re=0;Re<Ae;Re++)ee.push({name:`${q}[${Be+1}][${Ce+1}][${Re+1}]`,type:2,value:O(q,Be,Ce,Re),valueKind:_e})}}return ee}function M(q){const Y=[];for(const ee of Object.keys(q)){const g=q[ee];"int"===g.valueType?Y.push({name:ee,type:1,value:i(ee),valueKind:b(ee)}):"float"===g.valueType?Y.push({name:ee,type:2,value:i(ee),valueKind:b(ee)}):"str"===g.valueType?Y.push({name:ee,type:0,value:i(ee),valueKind:b(ee)}):"list"===g.valueType?Y.push({name:ee,type:0,value:v(ee),valueKind:b(ee)}):"tensor"===g.valueType?Y.push(..._(ee,g.space)):(0,t.dr)(g.valueType)}return Y}function d(q){return q.defaultFormat&&typeof q.defaultFormat.digitCount<"u"?Math.max(0,Math.min(q.defaultFormat.digitCount,16)):6}function s(q){return q.fields.some(Y=>!!Y.shouldInclude)?q.fields.filter(Y=>!Y.shouldInclude||q.source.some(ee=>Y.shouldInclude(ee.data))):q.fields}function C(q,Y){const ee=q.instance(Y),g=ee.source.filter(le=>le.rowCount>0);return g.length?{instance:ee,rowCount:g.reduce((le,Ae)=>le+Ae.rowCount,0),source:g.map(le=>({data:le.data,keys:()=>le.keys?le.keys():o.f.Range(0,le.rowCount-1),rowCount:le.rowCount}))}:{instance:ee,rowCount:0,source:[]}}!function(q){function ee(Ae,Be,Ce){return{name:Ae,type:1,value:Be,valueKind:Ce&&Ce.valueKind,defaultFormat:Ce?{encoder:Ce.encoder,typedArray:Ce.typedArray}:void 0,shouldInclude:Ce&&Ce.shouldInclude}}q.str=function Y(Ae,Be,Ce){return{name:Ae,type:0,value:Be,valueKind:Ce&&Ce.valueKind,defaultFormat:Ce&&Ce.encoder?{encoder:Ce.encoder}:void 0,shouldInclude:Ce&&Ce.shouldInclude}},q.int=ee,q.float=function g(Ae,Be,Ce){return{name:Ae,type:2,value:Be,valueKind:Ce&&Ce.valueKind,defaultFormat:Ce?{encoder:Ce.encoder,typedArray:Ce.typedArray,digitCount:typeof Ce.digitCount<"u"?Ce.digitCount:void 0}:void 0,shouldInclude:Ce&&Ce.shouldInclude}},q.index=function _e(Ae){return ee(Ae,(Be,Ce,Re)=>Re+1,{typedArray:Int32Array,encoder:r.ND.by(r.ND.delta).and(r.ND.runLength).and(r.ND.integerPacking)})};class xe{constructor(){this.fields=[]}index(Be){return this.fields.push(q.index(Be)),this}str(Be,Ce,Re){return this.fields.push(q.str(Be,Ce,Re)),this}int(Be,Ce,Re){return this.fields.push(q.int(Be,Ce,Re)),this}vec(Be,Ce,Re){for(let ke=0;ke<Ce.length;ke++)this.fields.push(q.int(`${Be}[${ke+1}]`,Ce[ke],Re));return this}float(Be,Ce,Re){return this.fields.push(q.float(Be,Ce,Re)),this}many(Be){for(let Ce=0;Ce<Be.length;Ce++)this.fields.push(Be[Ce]);return this}add(Be){return this.fields.push(Be),this}getFields(){return this.fields}}q.Builder=xe,q.build=function le(){return new xe}}(A||(A={})),(q=y||(y={})).Empty={fields:[],source:[]},q.filterOf=function Y(g){const _e=[],xe=[],le=[],Ae=[];for(let Ce of g.split(/[\r\n]+/)){if(Ce=Ce.trim(),0===Ce.length)continue;const Re=/^!/.test(Ce);Re&&(Ce=Ce.substr(1));const ke=Ce.split(/\./),we=ke[1],Oe=Re?we?Ae:xe:we?le:_e;Oe[Oe.length]=Ce,we&&!_e.includes(ke[0])&&(_e[_e.length]=ke[0])}const Be=le.map(Ce=>Ce.split(".")[0]);return{includeCategory:Ce=>!xe.includes(Ce)&&(_e.length<=0||-1!==_e.indexOf(Ce)),includeField(Ce,Re){const ke=Ce+"."+Re;return!Ae.includes(ke)&&(!Be.includes(Ce)||le.includes(ke))}}},q.DefaultFilter={includeCategory:g=>!0,includeField:(g,_e)=>!0},q.DefaultFormatter={getFormat(g,_e){}},q.ofTable=function ee(g,_e){return _e?{fields:M(g._schema),source:[{data:g,rowCount:_e.length,keys:()=>o.f.Array(_e)}]}:{fields:M(g._schema),source:[{data:g,rowCount:g._rowCount}]}},function(q){function Y(g,_e,xe){g.startDataBlock(_e);for(const le of xe._tableNames)g.writeCategory({name:le,instance:()=>y.ofTable(xe[le])})}q.writeDatabase=Y,q.writeDatabaseCollection=function ee(g,_e){for(const xe of Object.keys(_e))Y(g,xe,_e[xe])}}(c||(c={})),n(6651),n(3543),n(8382),n(9677);class h{constructor(){this.builder=e.f.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=y.DefaultFilter,this.formatter=y.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}setFilter(Y){this.filter=Y||y.DefaultFilter}isCategoryIncluded(Y){return this.filter.includeCategory(Y)}setFormatter(Y){this.formatter=Y||y.DefaultFormatter}startDataBlock(Y){this.dataBlockCreated=!0,e.f.write(this.builder,`data_${(Y||"").replace(/[ \n\t]/g,"").toUpperCase()}\n#\n`)}writeCategory(Y,ee,g){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!g?.ignoreFilter&&!this.filter.includeCategory(Y.name))return;const{instance:_e,rowCount:xe,source:le}=C(Y,ee);xe&&(1===xe?function D(q,Y,ee,g,_e,xe){const le=s(Y),Ae=ee[0],Be=Ae.data;let Ce=le.reduce((Oe,Se)=>_e.includeField(q.name,Se.name)?Math.max(Oe,Se.name.length):0,0);if(0===Ce)return;Ce+=q.name.length+6;const ke=Ae.keys().move(),we=S(q.name,Y.fields,xe);for(let Oe=0;Oe<le.length;Oe++){const Se=le[Oe];_e.includeField(q.name,Se.name)&&(e.f.writePadRight(g,`_${q.name}.${Se.name}`,Ce),a(g,Be,ke,Se,we[Oe],0)||e.f.newline(g))}e.f.write(g,"#\n")}(Y,_e,le,this.builder,this.filter,this.formatter):function R(q,Y,ee,g,_e,xe){const le=s(Y),Ae=_e===y.DefaultFilter?le:le.filter(ke=>_e.includeField(q.name,ke.name)),Be=Ae.length;if(0===Be)return;const Ce=S(q.name,Ae,xe);p(g,"loop_");for(let ke=0;ke<Be;ke++)p(g,`_${q.name}.${Ae[ke].name}`);let Re=0;for(let ke=0;ke<ee.length;ke++){const we=ee[ke],Oe=we.data;if(0===we.rowCount)continue;const Se=we.keys();for(;Se.hasNext;){const Ve=Se.move();let Ne=!1;for(let K=0;K<Be;K++)Ne=a(g,Oe,Ve,Ae[K],Ce[K],Re);Ne||e.f.newline(g),Re++}}e.f.write(g,"#\n")}(Y,_e,le,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(Y){const ee=e.f.getChunks(this.builder);for(let g=0,_e=ee.length;g<_e;g++)Y.writeString(ee[g])}getSize(){return e.f.getSize(this.builder)}getData(){return e.f.getString(this.builder)}}function a(q,Y,ee,g,_e,xe){const le=g.valueKind,Ae=le?le(ee,Y):0;if(0!==Ae)1===Ae?function L(q){e.f.writeSafe(q,". ")}(q):function w(q){e.f.writeSafe(q,"? ")}(q);else{const Be=g.value(ee,Y,xe),Ce=g.type;if(0===Ce)return function f(q){return"string"==typeof q&&q.indexOf("\n")>=0}(Be)?(G(q,Be),!0):function Q(q,Y){if(!Y)return e.f.writeSafe(q,". "),!1;const ee=Y.charCodeAt(0);let g=!1,_e=0,xe=!1,le=!1;for(let Ae=0,Be=Y.length-1;Ae<=Be;Ae++)switch(Y.charCodeAt(Ae)){case 9:case 32:g=!0;break;case 10:return G(q,Y),!0;case 34:if(Ae&&Ae===Be)break;if(xe)return G(q,Y),!0;le=!0,g=!0,_e=0;break;case 39:if(Ae&&Ae===Be)break;if(le)return G(q,Y),!0;xe=!0,g=!0,_e=1}return!g&&(35===ee||36===ee||59===ee||91===ee||93===ee||95===ee)&&(g=!0),g?(e.f.writeSafe(q,_e?'"':"'"),e.f.writeSafe(q,Y),e.f.writeSafe(q,_e?'" ':"' ")):(e.f.writeSafe(q,Y),e.f.writeSafe(q," ")),!1}(q,Be);1===Ce?function E(q,Y){e.f.writeInteger(q,Y),e.f.whitespace1(q)}(q,Be):function T(q,Y,ee){e.f.writeFloat(q,Y,ee),e.f.whitespace1(q)}(q,Be,_e)}return!1}function S(q,Y,ee){const g=[];for(const _e of Y){const xe=ee.getFormat(q,_e.name);g[g.length]=xe&&typeof xe.digitCount<"u"?2===_e.type?Math.pow(10,Math.max(0,Math.min(xe.digitCount,15))):0:2===_e.type?Math.pow(10,d(_e)):0}return g}function p(q,Y){e.f.write(q,Y),e.f.newline(q)}function G(q,Y){e.f.writeSafe(q,"\n;"+Y),e.f.writeSafe(q,"\n;\n")}var V=n(275);function U(q){const Y=new ArrayBuffer(N(q)),ee=new DataView(Y),g=new Uint8Array(Y);return k(q,ee,g,0),g}function N(q){const Y=typeof q;if("string"===Y){const ee=(0,V.VH)(q);if(ee<32)return 1+ee;if(ee<256)return 2+ee;if(ee<65536)return 3+ee;if(ee<4294967296)return 5+ee}if(q instanceof Uint8Array){const ee=q.byteLength;if(ee<256)return 2+ee;if(ee<65536)return 3+ee;if(ee<4294967296)return 5+ee}if("number"===Y){if(Math.floor(q)!==q)return 9;if(q>=0){if(q<128)return 1;if(q<256)return 2;if(q<65536)return 3;if(q<4294967296)return 5;throw new Error("Number too big 0x"+q.toString(16))}if(q>=-32)return 1;if(q>=-128)return 2;if(q>=-32768)return 3;if(q>=-2147483648)return 5;throw new Error("Number too small -0x"+q.toString(16).substr(1))}if("boolean"===Y||null==q)return 1;if("object"===Y){let ee,g=0;if(Array.isArray(q)){ee=q.length;for(let _e=0;_e<ee;_e++)g+=N(q[_e])}else{const _e=Object.keys(q);ee=_e.length;for(let xe=0;xe<ee;xe++){const le=_e[xe];g+=N(le)+N(q[le])}}if(ee<16)return 1+g;if(ee<65536)return 3+g;if(ee<4294967296)return 5+g;throw new Error("Array or object too long 0x"+ee.toString(16))}throw new Error("Unknown type "+Y)}function k(q,Y,ee,g){const _e=typeof q;if("string"===_e){const xe=(0,V.VH)(q);if(xe<32)return Y.setUint8(g,160|xe),(0,V.rj)(ee,g+1,q),1+xe;if(xe<256)return Y.setUint8(g,217),Y.setUint8(g+1,xe),(0,V.rj)(ee,g+2,q),2+xe;if(xe<65536)return Y.setUint8(g,218),Y.setUint16(g+1,xe),(0,V.rj)(ee,g+3,q),3+xe;if(xe<4294967296)return Y.setUint8(g,219),Y.setUint32(g+1,xe),(0,V.rj)(ee,g+5,q),5+xe}if(q instanceof Uint8Array){const xe=q.byteLength,le=new Uint8Array(Y.buffer);if(xe<256)return Y.setUint8(g,196),Y.setUint8(g+1,xe),le.set(q,g+2),2+xe;if(xe<65536)return Y.setUint8(g,197),Y.setUint16(g+1,xe),le.set(q,g+3),3+xe;if(xe<4294967296)return Y.setUint8(g,198),Y.setUint32(g+1,xe),le.set(q,g+5),5+xe}if("number"===_e){if(!isFinite(q))throw new Error("Number not finite: "+q);if(Math.floor(q)!==q)return Y.setUint8(g,203),Y.setFloat64(g+1,q),9;if(q>=0){if(q<128)return Y.setUint8(g,q),1;if(q<256)return Y.setUint8(g,204),Y.setUint8(g+1,q),2;if(q<65536)return Y.setUint8(g,205),Y.setUint16(g+1,q),3;if(q<4294967296)return Y.setUint8(g,206),Y.setUint32(g+1,q),5;throw new Error("Number too big 0x"+q.toString(16))}if(q>=-32)return Y.setInt8(g,q),1;if(q>=-128)return Y.setUint8(g,208),Y.setInt8(g+1,q),2;if(q>=-32768)return Y.setUint8(g,209),Y.setInt16(g+1,q),3;if(q>=-2147483648)return Y.setUint8(g,210),Y.setInt32(g+1,q),5;throw new Error("Number too small -0x"+(-q).toString(16).substr(1))}if(null==q)return Y.setUint8(g,192),1;if("boolean"===_e)return Y.setUint8(g,q?195:194),1;if("object"===_e){let xe,le=0;const Ae=Array.isArray(q);let Be;if(Ae?xe=q.length:(Be=Object.keys(q),xe=Be.length),xe<16?(Y.setUint8(g,xe|(Ae?144:128)),le=1):xe<65536?(Y.setUint8(g,Ae?220:222),Y.setUint16(g+1,xe),le=3):xe<4294967296&&(Y.setUint8(g,Ae?221:223),Y.setUint32(g+1,xe),le=5),Ae)for(let Ce=0;Ce<xe;Ce++)le+=k(q[Ce],Y,ee,g+le);else for(let Ce=0,Re=Be.length;Ce<Re;Ce++){const ke=Be[Ce];le+=k(ke,Y,ee,g+le),le+=k(q[ke],Y,ee,g+le)}return le}throw new Error("Unknown type "+_e)}var Z,H=n(6640);class ${setFilter(Y){this.filter=Y||y.DefaultFilter}isCategoryIncluded(Y){return this.filter.includeCategory(Y)}setFormatter(Y){this.formatter=Y||y.DefaultFormatter}startDataBlock(Y){this.dataBlocks.push({header:(Y||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})}writeCategory(Y,ee,g){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!g?.ignoreFilter&&!this.filter.includeCategory(Y.name))return;const{instance:_e,rowCount:xe,source:le}=C(Y,ee);if(!xe)return;const Ae={name:"_"+Y.name,columns:[],rowCount:xe},Be=s(_e);for(const Ce of Be){if(!this.filter.includeField(Y.name,Ce.name))continue;const Re=this.formatter.getFormat(Y.name,Ce.name);Ae.columns.push(ye(Y.name,Ce,le,xe,Re,this.binaryEncodingProvider,this.autoClassify))}Ae.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(Ae)}encode(){this.encodedData||(this.encodedData=U(this.data),this.data=null,this.dataBlocks=null)}writeTo(Y){Y.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}constructor(Y,ee,g){this.autoClassify=g,this.dataBlocks=[],this.filter=y.DefaultFilter,this.formatter=y.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=ee,this.data={encoder:Y,version:r.xv,dataBlocks:this.dataBlocks}}}function ye(q,Y,ee,g,_e,xe,le){const{array:Ae,allPresent:Be,mask:Ce}=function j(q,Y,ee,g){const _e=0===q.type,xe=new Y(ee),le=new Uint8Array(ee),Ae=q.valueKind,Be=q.value;let Ce=!0,Re=0;for(let ke=0;ke<g.length;ke++){const we=g[ke].data,Oe=g[ke].keys();for(;Oe.hasNext;){const Se=Oe.move(),Ve=Ae?Ae(Se,we):0;if(0!==Ve)le[Re]=Ve,_e&&(xe[Re]=""),Ce=!1;else{const Ne=Be(Se,we,Re);"string"!=typeof Ne||Ne?le[Re]=0:(le[Re]=1,Ce=!1),xe[Re]=Ne}Re++}}return{array:xe,allPresent:Ce,mask:le}}(Y,function J(q,Y){return Y&&Y.typedArray?Y.typedArray:q.defaultFormat&&q.defaultFormat.typedArray?q.defaultFormat.typedArray:0===q.type?Array:1===q.type?Int32Array:Float64Array}(Y,_e),g,ee);let Re;Re=0===Y.type?r.ar.by(r.ND.stringArray):function te(q,Y,ee,g){return ee&&ee.encoder?ee.encoder:Y.defaultFormat&&Y.defaultFormat.encoder?Y.defaultFormat.encoder:g?g.get(q,Y.name):void 0}(q,Y,_e,xe),Re||(Re=le?function de(q,Y){return 0===q?r.ar.by(r.ND.stringArray):1===q?(0,H.P)(Y):(0,H.O)(Y)}(Y.type,Ae):function W(q){return r.ar.by(0===q?r.ND.stringArray:r.ND.byteArray)}(Y.type));const ke=Re.encode(Ae);let we;if(!Be){const Oe=r.ar.by(r.ND.runLength).and(r.ND.byteArray).encode(Ce);we=Oe.data.length<Ce.length?Oe:r.ar.by(r.ND.byteArray).encode(Ce)}return{name:Y.name,data:ke,mask:we}}!function(q){q.Encoder=c,q.Category=y,q.Field=A,q.Encoding=r.ND,q.createEncoder=function Y(Be){const{binary:Ce=!1,encoderName:Re="mol*"}=Be||{};return Ce?new $(Re,Be?Be.binaryEncodingPovider:void 0,!!Be&&!!Be.binaryAutoClassifyEncoding):new h},q.fields=function ee(){return q.Field.build()};var g=q.Encoding;function Ae(Be){const Ce=Be.precision;if(void 0!==Ce){const Re=Math.pow(10,Ce),ke=g.by(g.fixedPoint(Re));switch(Be.encoding){case"pack":return ke.and(g.integerPacking);case"rle":return ke.and(g.runLength).and(g.integerPacking);case"delta":return ke.and(g.delta).and(g.integerPacking);case"delta-rle":return ke.and(g.delta).and(g.runLength).and(g.integerPacking)}}else switch(Be.encoding){case"pack":return g.by(g.integerPacking);case"rle":return g.by(g.runLength).and(g.integerPacking);case"delta":return g.by(g.delta).and(g.integerPacking);case"delta-rle":return g.by(g.delta).and(g.runLength).and(g.integerPacking)}throw new Error("cannot be reached")}q.Encodings={deltaRLE:g.by(g.delta).and(g.runLength).and(g.integerPacking),fixedPoint2:g.by(g.fixedPoint(100)).and(g.delta).and(g.integerPacking),fixedPoint3:g.by(g.fixedPoint(1e3)).and(g.delta).and(g.integerPacking)},q.categoryInstance=function _e(Be,Ce){return{fields:Be,source:[Ce]}},q.createEncodingProviderFromCifFrame=function xe(Be){return{get(Ce,Re){const ke=Be.categories[Ce];if(!ke)return;const we=ke.getField(Re);return we&&we.binaryEncoding?r.ar.fromEncoding(we.binaryEncoding):void 0}}},q.createEncodingProviderFromJsonConfig=function le(Be){return{get(Ce,Re){for(let ke=0;ke<Be.length;ke++){const we=Be[ke];if(we.categoryName===Ce&&we.columnName===Re)return Ae(we)}}}}}(Z||(Z={}))},9886:(tn,Ue,n)=>{"use strict";n.d(Ue,{RL:()=>O,ey:()=>d});const e=new ArrayBuffer(4);new Int32Array(e),new Float32Array(e);const A=new ArrayBuffer(4),y=new Int32Array(A),c=new Float32Array(A);function O(Se){return function i(Se){return y[0]=(1<<23)*((Se<-126?-126:Se)+126.94269504),c[0]}(1.44269504*Se)}const b=new ArrayBuffer(8);new Int32Array(b),new Float32Array(b);const l=new ArrayBuffer(4),m=new Int32Array(l),u=new Float32Array(l);function d(Se){return u[0]=Se,1.1920928955078125e-7*m[0]-126.94269504}Math,Math,Math,Math,Math,Math,Math,Math,Math;const k=new ArrayBuffer(16);new Int32Array(k),new Float32Array(k);const te=new ArrayBuffer(8);new Int32Array(te),new Float32Array(te);const xe=new ArrayBuffer(4);new Int32Array(xe),new Float32Array(xe),Math},5384:(tn,Ue,n)=>{"use strict";n.d(Ue,{n:()=>C.n,DJ:()=>d.D,Eh:()=>u.E,Q7:()=>m.Q,is:()=>l,O8:()=>I,f8:()=>s.f,JX:()=>t.J,oI:()=>r});var e=n(4369);function r(h,a,S){const D=new Float32Array(h);for(let R=0;R<D.length;R++)D[R]=a+S*R;return D}var t=n(7552);const A=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],y=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],c=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],i={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function O(h){if(h<146)return h+1;if(146===h)return 1146;if(h<149)return h+1-1;if(149===h)return 1148;if(h<157)return h+1-2;if(157===h)return 1155;if(h<163)return h+1-3;if(163===h)return 1160;if(h<165)return h+1-4;if(165===h)return 1161;if(h<171)return h+1-5;if(171===h)return 1166;if(h<173)return h+1-6;if(173===h)return 1167;if(h<237)return h+1-7;if(237===h)return 1003;if(238===h)return 1004;if(239===h)return 1005;if(240===h)return 2005;if(241===h)return 3005;if(242===h)return 4005;if(243===h)return 5005;if(244===h)return 1006;if(245===h)return 1007;if(246===h)return 1008;if(247===h)return 1009;if(248===h)return 1010;if(249===h)return 1011;if(250===h)return 1012;if(251===h)return 1013;if(252===h)return 1014;if(253===h)return 2014;if(254===h)return 3014;if(255===h)return 1015;if(256===h)return 1017;if(257===h)return 2017;if(258===h)return 1018;if(259===h)return 2018;if(260===h)return 3018;if(261===h)return 1020;if(262===h)return 1021;if(263===h)return 1022;if(264===h)return 1023;if(265===h)return 1059;if(266===h)return 1094;if(267===h)return 1197;throw new Error(`unknown spacegroup index '${h}'`)}const b=function(){const h=Object.create(null);for(const a of Object.keys(i))h[i[a]]=a;return h}(),_=function(){const h=Object.create(null);for(const a of Object.keys(i)){const S=i[a];h[S]=O(S)}return h}();var I,l;!function(h){function S(D,R,f){const p=function M(h){const a="number"==typeof h?function v(h){switch(h){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}let a=0;return h>146&&++a,h>148&&++a,h>155&&++a,h>160&&++a,h>161&&++a,h>166&&++a,h>167&&++a,h-1+a}(h):i[h];return typeof a>"u"||typeof b[a]>"u"?-1:a}(D);if(p<0)return console.warn(`Unknown spacegroup '${D}', returning a 'P 1' with cellsize [1, 1, 1]`),h.Zero;const E=R[0]*R[1]*R[2],T=f[0],L=f[1],w=f[2],Q=R[0],G=R[1],V=R[2],U=Math.cos(L),N=(Math.cos(T)-Math.cos(L)*Math.cos(w))/Math.sin(w),k=Math.sqrt(1-U*U-N*N),H=[Q,0,0],$=[Math.cos(w)*G,Math.sin(w)*G,0],J=[U*V,N*V,k*V],W=e.$I.ofRows([[H[0],$[0],J[0],0],[0,$[1],J[1],0],[0,0,J[2],0],[0,0,0,1]]);return{index:p,size:R,volume:E,anglesInRadians:f,toFractional:e.$I.invert(e.$I.zero(),W),fromFractional:W}}h.Zero=S("P 1",e.eB.create(1,1,1),e.eB.create(Math.PI/2,Math.PI/2,Math.PI/2)),h.isZero=function a(D){return!D||0===D.index&&1===D.size[0]&&1===D.size[1]&&1===D.size[1]},h.create=S}(I||(I={})),function(h){function a(k){const H=c[k.index].map(W=>function Q(k){return e.$I.ofRows([A[k[0]],A[k[1]],A[k[2]],[0,0,0,1]])}(y[W]));return{name:b[k.index],num:_[k.index],cell:k,operators:H}}h.ZeroP1=a(I.Zero),h.create=a;const S=(0,e.eB)(),D=(0,e.$I)();function R(k,H,$,J,W,te){return e.eB.set(S,$,J,W),e.$I.fromTranslation(D,S),e.$I.mul(te,e.$I.mul(te,e.$I.mul(te,k.cell.fromFractional,D),k.operators[H]),k.cell.toFractional)}h.setOperatorMatrix=R,h.getSymmetryOperator=function f(k,H,$,J,W){const te=R(k,H,$,J,W,e.$I.zero());return t.J.create(`${H+1}_${5+$}${5+J}${5+W}`,te,{hkl:e.eB.create($,J,W),spgrOp:H})};const p=(0,e.eB)(),E=(0,e.eB)(),T=(0,e.eB)(),L=(0,e.eB)();function V(k,H,$){const J=[];if(k>0?J.push("+X"):k<0&&J.push("-X"),H>0?J.push("+Y"):H<0&&J.push("-Y"),$>0?J.push("+Z"):$<0&&J.push("-Z"),1===J.length)return"+"===J[0].charAt(0)?J[0].substr(1):J[0];if(2===J.length){const W=J[0].charAt(0),te=J[1].charAt(0);if("+"===W)return`${J[0].substr(1)}${J[1]}`;if("+"===te)return`${J[1].substr(1)}${J[0]}`}throw new Error(`unknown rotation '${J}', ${k} ${H} ${$}`)}function U(k){switch(k){case.5:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function N(k,H){return""===H?k:k.length>2?`${k}+${H}`:"-"===k.charAt(0)?`${H}${k}`:`${H}+${k}`}h.getSymmetryOperatorRef=function w(k,H,$,J,W,te){const de=e.$I.zero();e.eB.set(S,$,J,W),e.eB.floor(p,te),e.$I.copy(de,k.operators[H]),e.eB.floor(E,e.eB.transformMat4(E,te,de)),e.$I.getTranslation(L,de),e.eB.sub(L,L,E),e.eB.add(L,L,p),e.eB.add(L,L,S),e.$I.setTranslation(de,L),e.$I.mul(de,k.cell.fromFractional,de),e.$I.mul(de,de,k.cell.toFractional),e.eB.sub(T,E,p);const ye=$-T[0],j=J-T[1],Z=W-T[2];return t.J.create(`${H+1}_${5+ye}${5+j}${5+Z}`,de,{hkl:e.eB.create(ye,j,Z),spgrOp:H})},h.getOperatorXyz=function G(k){return[N(V(k[0],k[4],k[8]),U(k[12])),N(V(k[1],k[5],k[9]),U(k[13])),N(V(k[2],k[6],k[10]),U(k[14]))].join(",")}}(l||(l={}));var m=n(654),u=n(9307),d=n(6642),s=n(8184),C=n(5560)},7136:(tn,Ue,n)=>{"use strict";n.d(Ue,{Z:()=>v});var e=n(2086),o=n(6290),r=n(5384),t=n(6642);const A=e.e.dot,y=e.e.copy,c=e.e.scaleAndSub,i=e.e.scaleAndAdd;class v{computeExtrema(d,s){const C=A(this.dir[d],s);C<this.minDist[d]&&(this.minDist[d]=C,y(this.extrema[2*d],s)),C>this.maxDist[d]&&(this.maxDist[d]=C,y(this.extrema[2*d+1],s))}computeSphereExtrema(d,s,C){const h=this.dir[d],a=A(h,s);a-C<this.minDist[d]&&(this.minDist[d]=a-C,c(this.extrema[2*d],s,h,C)),a+C>this.maxDist[d]&&(this.maxDist[d]=a+C,i(this.extrema[2*d+1],s,h,C))}includeSphere(d){if(r.f8.hasExtrema(d)&&d.extrema.length>1)for(const s of d.extrema)this.includePosition(s);else this.includePositionRadius(d.center,d.radius)}includePosition(d){for(let s=0;s<this.dirLength;++s)this.computeExtrema(s,d)}includePositionRadius(d,s){for(let C=0;C<this.dirLength;++C)this.computeSphereExtrema(C,d,s)}finishedIncludeStep(){for(let d=0;d<this.extrema.length;d++)this.centroidHelper.includeStep(this.extrema[d]);this.centroidHelper.finishedIncludeStep()}radiusSphere(d){if(r.f8.hasExtrema(d)&&d.extrema.length>1)for(const s of d.extrema)this.radiusPosition(s);else this.radiusPositionRadius(d.center,d.radius)}radiusPosition(d){this.centroidHelper.radiusStep(d)}radiusPositionRadius(d,s){this.centroidHelper.radiusSphereStep(d,s)}getSphere(d){return r.f8.setExtrema(this.centroidHelper.getSphere(d),this.extrema.slice())}getBox(d){return t.D.fromVec3Array(d||(0,t.D)(),this.extrema)}reset(){for(let d=0;d<this.dirLength;++d)this.minDist[d]=1/0,this.maxDist[d]=-1/0,this.extrema[2*d]=(0,e.e)(),this.extrema[2*d+1]=(0,e.e)();this.centroidHelper.reset()}constructor(d){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new o.p,this.dir=function O(u){let d;switch(u){case"6":d=[...b];break;case"14":d=[...b,..._];break;case"26":d=[...b,..._,...M];break;case"98":d=[...b,..._,...M,...I,...l,...m]}return d.map(s=>{const C=e.e.create(s[0],s[1],s[2]);return e.e.normalize(C,C)})}(d),this.dirLength=this.dir.length,this.reset()}}const b=[[1,0,0],[0,1,0],[0,0,1]],_=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],M=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],I=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],l=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],m=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]]},9535:(tn,Ue,n)=>{"use strict";n.d(Ue,{b:()=>v,r:()=>b});var e=n(4369),o=n(3543),r=n(7136),t=n(5384);const A=e.eB.set,y=new r.Z("14"),c=new r.Z("98");function v(_){const M=t.DJ.computeBounding(_);return{box:M,sphere:t.f8.fromBox3D((0,t.f8)(),M)}}const O=(0,e.eB)();function b(_){const{x:M,y:I,z:l,radius:m,indices:u}=_,d=o.CD.size(u);if(d>25e4)return v(_);const s=function i(_){return _>1e4?y:c}(d);s.reset();for(let h=0;h<d;h++){const a=o.CD.getAt(u,h);A(O,M[a],I[a],l[a]),s.includePositionRadius(O,m&&m[a]||0)}s.finishedIncludeStep();for(let h=0;h<d;h++){const a=o.CD.getAt(u,h);A(O,M[a],I[a],l[a]),s.radiusPositionRadius(O,m&&m[a]||0)}const C=s.getSphere();if(!m&&t.f8.hasExtrema(C)&&d<=C.extrema.length){const h=[];for(let a=0;a<d;a++){const S=o.CD.getAt(u,a);h.push(e.eB.create(M[S],I[S],l[S]))}t.f8.setExtrema(C,h)}return{box:s.getBox(),sphere:C}}},6290:(tn,Ue,n)=>{"use strict";n.d(Ue,{p:()=>y});var e=n(2086),o=n(8184);const r=e.e.add,t=e.e.squaredDistance,A=e.e.distance;class y{reset(){e.e.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(i){r(this.center,this.center,i),this.count++}finishedIncludeStep(){0!==this.count&&e.e.scale(this.center,this.center,1/this.count)}radiusStep(i){const v=t(i,this.center);v>this.radiusSq&&(this.radiusSq=v)}radiusSphereStep(i,v){const O=A(i,this.center)+v,b=O*O;b>this.radiusSq&&(this.radiusSq=b)}getSphere(i){return i||(i=(0,o.f)()),e.e.copy(i.center,this.center),i.radius=Math.sqrt(this.radiusSq),i}getCount(){return this.count}constructor(){this.count=0,this.center=(0,e.e)(),this.radiusSq=0}}!function(c){const i=new c,v=(0,e.e)(),O=(0,e.e)();c.fromArrays=function b({x:I,y:l,z:m},u){i.reset();const d=I.length;for(let s=0;s<d;s++)e.e.set(v,I[s],l[s],m[s]),i.includeStep(v);i.finishedIncludeStep();for(let s=0;s<d;s++)e.e.set(v,I[s],l[s],m[s]),i.radiusStep(v);return e.e.copy(u.center,i.center),u.radius=Math.sqrt(i.radiusSq),u},c.fromProvider=function _(I,l,m){i.reset();for(let u=0;u<I;u++)l(u,v),i.includeStep(v);i.finishedIncludeStep();for(let u=0;u<I;u++)l(u,v),i.radiusStep(v);return e.e.copy(m.center,i.center),m.radius=Math.sqrt(i.radiusSq),m},c.fromPairProvider=function M(I,l,m){i.reset();for(let u=0;u<I;u++)l(u,v,O),i.includeStep(v),i.includeStep(O);i.finishedIncludeStep();for(let u=0;u<I;u++)l(u,v,O),i.radiusStep(v),i.radiusStep(O);return e.e.copy(m.center,i.center),m.radius=Math.sqrt(i.radiusSq),m}}(y||(y={}))},654:(tn,Ue,n)=>{"use strict";var e,o;n.d(Ue,{Q:()=>e}),(o=e||(e={})).add=function r(c,i,v){c.squaredDistances[c.count]=v,c.indices[c.count++]=i},o.reset=function t(c){c.count=0},o.create=function A(){return{count:0,indices:[],squaredDistances:[]}},o.copy=function y(c,i){for(let v=0;v<i.count;++v)c.indices[v]=i.indices[v],c.squaredDistances[v]=i.squaredDistances[v];return c.count=i.count,c}},9307:(tn,Ue,n)=>{"use strict";n.d(Ue,{E:()=>y});var e=n(654),o=n(6642),r=n(4369),t=n(3543),A=n(8361);function y(h,a,S){return new c(h,a,S)}class c{find(a,S,D,R,f){this.ctx.x=a,this.ctx.y=S,this.ctx.z=D,this.ctx.radius=R,this.ctx.isCheck=!1;const p=f??this.result;return b(this.ctx,p),p}nearest(a,S,D,R=1,f,p){this.ctx.x=a,this.ctx.y=S,this.ctx.z=D,this.ctx.k=R,this.ctx.stopIf=f;const E=p??this.result;return function C(h,a){const{min:S,expandedBox:D,boundingSphere:{center:R},size:[f,p,E],bucketOffset:T,bucketCounts:L,bucketArray:w,grid:Q,data:{x:G,y:V,z:U,indices:N,radius:k},delta:H,maxRadius:$}=h.grid,{x:J,y:W,z:te,k:de,stopIf:ye}=h,j=t.CD.size(N);if(e.Q.reset(a),0===j||de<=0)return!1;let Z,q,Y,Re,ee=!1,g=1,_e=!0,xe=0,le=m,Ae=u,Be=0,Ce=!0,ke=!1;const we=d,Oe=$*$;le.length=0,we.length=0,I.clear(),s.clear(),r.eB.set(M,J,W,te),o.D.containsVec3(D,M)?(Z=Math.floor((J-S[0])/H[0]),q=Math.floor((W-S[1])/H[1]),Y=Math.floor((te-S[2])/H[2])):(o.D.nearestIntersectionWithRay(M,D,M,r.eB.normalize(_,r.eB.sub(_,R,M))),Z=Math.max(0,Math.min(f-1,Math.floor((M[0]-S[0])/H[0]))),q=Math.max(0,Math.min(p-1,Math.floor((M[1]-S[1])/H[1]))),Y=Math.max(0,Math.min(E-1,Math.floor((M[2]-S[2])/H[2]))));const Se=0!==$?Math.max(1,Math.min(f-1,Math.ceil($/H[0]))):1,Ve=0!==$?Math.max(1,Math.min(p-1,Math.ceil($/H[1]))):1,Ne=0!==$?Math.max(1,Math.min(E-1,Math.ceil($/H[2]))):1;for(le.push(Z,q,Y,(Z*p+q)*E+Y);a.count<j;){const K=4*g;for(let ne=0;ne<K;ne+=4)if(Re=le[ne+3],!I.has(Re)){I.add(Re),ke=I.size>=Q.length;const be=Q[Re];if(0!==be){const Te=Be,ie=be-1,ue=T[ie],ve=ue+L[ie];for(let ce=ue;ce<ve;ce++){const se=w[ce],ae=t.CD.getAt(N,se),ge=G[ae]-J,Ie=V[ae]-W,Le=U[ae]-te;let nt=ge*ge+Ie*Ie+Le*Le;if(0!==$){const je=k[ae];nt-=je*je}Ce&&nt>Be&&(Be=nt),s.insert(nt,se)}Te<Be&&(Ce=!1)}}Ae.length=0,xe=0,l.clear();for(let ne=0;ne<K;ne+=4){Z=le[ne],q=le[ne+1],Y=le[ne+2];for(let be=-Se;be<=Se;be++){const Te=Z+be;if(!(Te<0||Te>=f))for(let ie=-Ve;ie<=Ve;ie++){const ue=q+ie;if(!(ue<0||ue>=p))for(let re=-Ne;re<=Ne;re++){const ve=Y+re;if(!(ve<0||ve>=E||(Re=(Te*p+ue)*E+ve,l.has(Re)||(l.add(Re),I.has(Re))))){if(!_e){const ce=S[0]+Te*H[0]-J,se=S[1]+ue*H[1]-W,ae=S[2]+ve*H[2]-te;if(ce*ce+se*se+ae*ae-Oe>Be){we.push(Te,ue,ve,Re);continue}}Ae.push(Te,ue,ve,Re),xe++}}}}}if(_e=!1,0===xe){if(1===de){const ne=s.findMinimum();if(ne){const{key:be,value:Te}=ne;return e.Q.add(a,Te,be),!0}}else for(;!s.isEmpty()&&(ke||s.findMinimum().key<=Be)&&a.count<de;){const ne=s.extractMinimum(),be=ne.key,Te=ne.value;e.Q.add(a,Te,be),ye&&!ee&&(ee=ye(Te,be))}if(a.count>=de||ee||a.count>=j)return a.count>0;if(_e=!0,Ce=!0,we.length>0){for(let ne=0,be=we.length;ne<be;ne++)le.push(we[ne]);we.length=0,g=le.length}}else{const ne=le;le=Ae,Ae=ne,g=xe}}}(this.ctx,E),E}check(a,S,D,R){return this.ctx.x=a,this.ctx.y=S,this.ctx.z=D,this.ctx.radius=R,this.ctx.isCheck=!0,b(this.ctx,this.result)}constructor(a,S,D){const R=function v(h,a,S){const D=o.D.expand((0,o.D)(),a.box,r.eB.create(.5,.5,.5)),{indices:R}=h,f=o.D.size((0,r.eB)(),D);let p,E;const T=t.CD.size(R),L="number"==typeof S?S:32,w=Array.isArray(S)&&S;if(w&&!r.eB.isZero(w))E=[Math.ceil(f[0]/w[0]),Math.ceil(f[1]/w[1]),Math.ceil(f[2]/w[2])],p=w;else if(T>0){const V=Math.ceil(T/L),U=Math.pow(V/(f[0]*f[1]*f[2]),1/3);E=[Math.ceil(f[0]*U),Math.ceil(f[1]*U),Math.ceil(f[2]*U)],p=[f[0]/E[0],f[1]/E[1],f[2]/E[2]]}else p=f,E=[1,1,1];return function i(h){const{expandedBox:a,size:[S,D,R],data:{x:f,y:p,z:E,radius:T,indices:L},elementCount:w,delta:Q}=h,G=S*D*R,{min:[V,U,N]}=a;let k=0,H=0;const $=new Uint32Array(G),J=new Int32Array(w);for(let j=0;j<w;j++){const Z=t.CD.getAt(L,j),g=(Math.floor((f[Z]-V)/Q[0])*D+Math.floor((p[Z]-U)/Q[1]))*R+Math.floor((E[Z]-N)/Q[2]);1===($[g]+=1)&&(H+=1),J[j]=g}if(T)for(let j=0;j<w;j++){const Z=t.CD.getAt(L,j);T[Z]>k&&(k=T[Z])}const W=new Int32Array(H);for(let j=0,Z=0;j<G;j++){const q=$[j];q>0&&($[j]=Z+1,W[Z]=q,Z+=1)}const te=new Uint32Array(H);for(let j=1;j<H;++j)te[j]+=te[j-1]+W[j-1];const de=new Int32Array(H),ye=new Int32Array(w);for(let j=0;j<w;j++){const Z=$[J[j]];if(Z>0){const q=Z-1;ye[te[q]+de[q]]=j,de[q]+=1}}return{size:h.size,bucketArray:ye,bucketCounts:W,bucketOffset:te,grid:$,delta:Q,min:h.expandedBox.min,data:h.data,maxRadius:k,expandedBox:h.expandedBox,boundingBox:h.boundingBox,boundingSphere:h.boundingSphere}}({size:E,data:{x:h.x,y:h.y,z:h.z,indices:R,radius:h.radius},expandedBox:D,boundingBox:a.box,boundingSphere:a.sphere,elementCount:T,delta:p})}(a,S,D);this.ctx=function O(h){return{grid:h,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}(R),this.boundary={box:R.boundingBox,sphere:R.boundingSphere},this.buckets={offset:R.bucketOffset,count:R.bucketCounts,array:R.bucketArray},this.result=e.Q.create()}}function b(h,a){const{min:S,size:[D,R,f],bucketOffset:p,bucketCounts:E,bucketArray:T,grid:L,data:{x:w,y:Q,z:G,indices:V,radius:U},delta:N,maxRadius:k}=h.grid,{radius:H,isCheck:$,x:J,y:W,z:te}=h,de=H+k,ye=de*de;e.Q.reset(a);const j=Math.max(0,Math.floor((J-de-S[0])/N[0])),Z=Math.max(0,Math.floor((W-de-S[1])/N[1])),q=Math.max(0,Math.floor((te-de-S[2])/N[2])),Y=Math.min(D-1,Math.floor((J+de-S[0])/N[0])),ee=Math.min(R-1,Math.floor((W+de-S[1])/N[1])),g=Math.min(f-1,Math.floor((te+de-S[2])/N[2]));if(j>Y||Z>ee||q>g)return!1;for(let _e=j;_e<=Y;_e++)for(let xe=Z;xe<=ee;xe++)for(let le=q;le<=g;le++){const Ae=L[(_e*R+xe)*f+le];if(0===Ae)continue;const Be=Ae-1,Ce=p[Be],ke=Ce+E[Be];for(let we=Ce;we<ke;we++){const Oe=t.CD.getAt(V,T[we]),Se=w[Oe]-J,Ve=Q[Oe]-W,Ne=G[Oe]-te,K=Se*Se+Ve*Ve+Ne*Ne;if(K<=ye){if(k>0&&Math.sqrt(K)-U[Oe]>H)continue;if($)return!0;e.Q.add(a,T[we],K)}}}return a.count>0}const _=(0,r.eB)(),M=(0,r.eB)(),I=new Set,l=new Set,m=[.1],u=[.1],d=[.1],s=new A.h},5560:(tn,Ue,n)=>{"use strict";n.d(Ue,{n:()=>o});var e=n(4369);function o(){return o.empty()}!function(r){function A(){return{origin:(0,e.eB)(),dirA:(0,e.eB)(),dirB:(0,e.eB)(),dirC:(0,e.eB)()}}function y(l,m){return e.eB.copy(l.origin,m.origin),e.eB.copy(l.dirA,m.dirA),e.eB.copy(l.dirB,m.dirB),e.eB.copy(l.dirC,m.dirC),l}function i(l,m){return e.eB.set(l,2*e.eB.magnitude(m.dirA),2*e.eB.magnitude(m.dirB),2*e.eB.magnitude(m.dirC))}r.create=function t(l,m,u,d){return{origin:l,dirA:m,dirB:u,dirC:d}},r.empty=A,r.copy=y,r.clone=function c(l){return y(A(),l)},r.size=i;const v=(0,e.eB)();r.volume=function O(l){return i(v,l),v[0]*v[1]*v[2]},r.normalize=function b(l,m){return e.eB.copy(l.origin,m.origin),e.eB.normalize(l.dirA,m.dirA),e.eB.normalize(l.dirB,m.dirB),e.eB.normalize(l.dirC,m.dirC),l};const _=(0,e.U)();r.transform=function M(l,m,u){e.eB.transformMat4(l.origin,m.origin,u);const d=e.U.directionTransform(_,u);return e.eB.transformMat3(l.dirA,m.dirA,d),e.eB.transformMat3(l.dirB,m.dirB,d),e.eB.transformMat3(l.dirC,m.dirC,d),l},r.scale=function I(l,m,u){return e.eB.scale(l.dirA,m.dirA,u),e.eB.scale(l.dirB,m.dirB,u),e.eB.scale(l.dirC,m.dirC,u),l}}(o||(o={}))},6642:(tn,Ue,n)=>{"use strict";n.d(Ue,{D:()=>t});var e=n(3543),o=n(8184),r=n(2086);function t(){return t.zero()}!function(A){function c(){return{min:(0,r.e)(),max:(0,r.e)()}}function i(L,w){return r.e.copy(L.min,w.min),r.e.copy(L.max,w.max),L}A.create=function y(L,w){return{min:L,max:w}},A.zero=c,A.copy=i,A.clone=function v(L){return i(c(),L)};const O=(0,r.e)();function _(L,w){for(let Q=0,G=w.length;Q<G;Q++)h(L,w[Q]);return L}function M(L,w){return C(L),_(L,w),L}function u(L,w){return r.e.sub(L,w.max,w.min)}A.fromSphere3D=function b(L,w){return o.f.hasExtrema(w)&&w.extrema.length>=14?M(L,w.extrema):(r.e.set(O,w.radius,w.radius,w.radius),r.e.sub(L.min,w.center,O),r.e.add(L.max,w.center,O),L)},A.addVec3Array=_,A.fromVec3Array=M,A.addSphere3D=function I(L,w){return o.f.hasExtrema(w)&&w.extrema.length>=14?_(L,w.extrema):(h(L,r.e.subScalar(O,w.center,w.radius)),h(L,r.e.addScalar(O,w.center,w.radius)),L)},A.intersectsSphere3D=function l(L,w){return r.e.clamp(O,w.center,L.min,L.max),r.e.squaredDistance(O,w.center)<=w.radius*w.radius},A.computeBounding=function m(L){const w=r.e.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=r.e.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:G,y:V,z:U,indices:N}=L;for(let k=0,H=e.CD.size(N);k<H;k++){const $=e.CD.getAt(N,k);w[0]=Math.min(G[$],w[0]),w[1]=Math.min(V[$],w[1]),w[2]=Math.min(U[$],w[2]),Q[0]=Math.max(G[$],Q[0]),Q[1]=Math.max(V[$],Q[1]),Q[2]=Math.max(U[$],Q[2])}return{min:w,max:Q}},A.size=u;const d=(0,r.e)();function C(L){return r.e.set(L.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.e.set(L.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),L}function h(L,w){return r.e.min(L.min,L.min,w),r.e.max(L.max,L.max,w),L}A.volume=function s(L){return u(d,L),d[0]*d[1]*d[2]},A.setEmpty=C,A.add=h,A.expand=function a(L,w,Q){return r.e.sub(L.min,w.min,Q),r.e.add(L.max,w.max,Q),L},A.scale=function S(L,w,Q){return r.e.scale(L.min,w.min,Q),r.e.scale(L.max,w.max,Q),L};const D=(0,r.e)();A.transform=function R(L,w,Q){const[G,V,U]=w.min,[N,k,H]=w.max;return C(L),h(L,r.e.transformMat4(D,r.e.set(D,G,V,U),Q)),h(L,r.e.transformMat4(D,r.e.set(D,G,V,H),Q)),h(L,r.e.transformMat4(D,r.e.set(D,G,k,U),Q)),h(L,r.e.transformMat4(D,r.e.set(D,G,k,H),Q)),h(L,r.e.transformMat4(D,r.e.set(D,N,V,U),Q)),h(L,r.e.transformMat4(D,r.e.set(D,N,V,H),Q)),h(L,r.e.transformMat4(D,r.e.set(D,N,k,U),Q)),h(L,r.e.transformMat4(D,r.e.set(D,N,k,H),Q)),L},A.containsVec3=function f(L,w){return!(w[0]<L.min[0]||w[0]>L.max[0]||w[1]<L.min[1]||w[1]>L.max[1]||w[2]<L.min[2]||w[2]>L.max[2])},A.overlaps=function p(L,w){return!(L.max[0]<w.min[0]||L.min[0]>w.max[0]||L.max[1]<w.min[1]||L.min[1]>w.max[1]||L.max[2]<w.min[2]||L.min[2]>w.max[2])},A.containsSphere3D=function E(L,w){const Q=w.center,G=w.radius;return!(Q[0]-G<L.min[0]||Q[0]+G>L.max[0]||Q[1]-G<L.min[1]||Q[1]+G>L.max[1]||Q[2]-G<L.min[2]||Q[2]+G>L.max[2])},A.nearestIntersectionWithRay=function T(L,w,Q,G){const[V,U,N]=w.min,[k,H,$]=w.max,[J,W,te]=Q,de=1/G[0],ye=1/G[1],j=1/G[2];let Z,q,Y,ee,g,_e;return de>=0?(Z=(V-J)*de,q=(k-J)*de):(Z=(k-J)*de,q=(V-J)*de),ye>=0?(Y=(U-W)*ye,ee=(H-W)*ye):(Y=(H-W)*ye,ee=(U-W)*ye),j>=0?(g=(N-te)*j,_e=($-te)*j):(g=($-te)*j,_e=(N-te)*j),Y>Z&&(Z=Y),ee<q&&(q=ee),g>Z&&(Z=g),_e<q&&(q=_e),r.e.scale(L,G,Z),r.e.set(L,L[0]+J,L[1]+W,L[2]+te)}}(t||(t={}))},9137:(tn,Ue,n)=>{"use strict";n.d(Ue,{Q:()=>r});var e=n(2086),o=n(9457);function r(){return r.create((0,o.i)(),(0,o.i)(),(0,o.i)(),(0,o.i)(),(0,o.i)(),(0,o.i)())}!function(t){function y(M,I){for(let l=0;l<6;++l)o.i.copy(M[l],I[l]);return M}t.create=function A(M,I,l,m,u,d){return[M,I,l,m,u,d]},t.copy=y,t.clone=function c(M){return y(t(),M)},t.fromProjectionMatrix=function i(M,I){const l=I[0],m=I[1],u=I[2],d=I[3],s=I[4],C=I[5],h=I[6],a=I[7],S=I[8],D=I[9],R=I[10],f=I[11],p=I[12],E=I[13],T=I[14],L=I[15];return o.i.setUnnormalized(M[0],d-l,a-s,f-S,L-p),o.i.setUnnormalized(M[1],d+l,a+s,f+S,L+p),o.i.setUnnormalized(M[2],d+m,a+C,f+D,L+E),o.i.setUnnormalized(M[3],d-m,a-C,f-D,L-E),o.i.setUnnormalized(M[4],d-u,a-h,f-R,L-T),o.i.setUnnormalized(M[5],d+u,a+h,f+R,L+T),M},t.intersectsSphere3D=function v(M,I){const l=I.center,m=-I.radius;for(let u=0;u<6;++u)if(o.i.distanceToPoint(M[u],l)<m)return!1;return!0};const O=(0,e.e)();t.intersectsBox3D=function b(M,I){for(let l=0;l<6;++l){const m=M[l];if(O[0]=m.normal[0]>0?I.max[0]:I.min[0],O[1]=m.normal[1]>0?I.max[1]:I.min[1],O[2]=m.normal[2]>0?I.max[2]:I.min[2],o.i.distanceToPoint(m,O)<0)return!1}return!0},t.containsPoint=function _(M,I){for(let l=0;l<6;++l)if(o.i.distanceToPoint(M[l],I)<0)return!1;return!0}}(r||(r={}))},9457:(tn,Ue,n)=>{"use strict";n.d(Ue,{i:()=>o});var e=n(2086);function o(){return o.create(e.e.create(1,0,0),0)}!function(r){function A(d,s){return e.e.copy(d.normal,s.normal),d.constant=s.constant,d}function b(d,s,C){return e.e.copy(d.normal,s),d.constant=-e.e.dot(d.normal,C),d}r.create=function t(d,s){return{normal:d,constant:s}},r.copy=A,r.clone=function y(d){return A(r(),d)},r.normalize=function c(d,s){const C=1/e.e.magnitude(s.normal);return e.e.scale(d.normal,s.normal,C),d.constant=s.constant*C,d},r.negate=function i(d,s){return e.e.negate(d.normal,s.normal),d.constant=-s.constant,d},r.toArray=function v(d,s,C){return e.e.toArray(d.normal,s,C),s[C+3]=d.constant,s},r.fromArray=function O(d,s,C){return e.e.fromArray(d.normal,s,C),d.constant=s[C+3],d},r.fromNormalAndCoplanarPoint=b,r.fromCoplanarPoints=function _(d,s,C,h){return b(d,e.e.triangleNormal((0,e.e)(),s,C,h),s),d};const M=(0,e.e)();function l(d,s){return e.e.dot(d.normal,s)+d.constant}r.setUnnormalized=function I(d,s,C,h,a){e.e.set(M,s,C,h);const S=1/e.e.magnitude(M);return e.e.scale(d.normal,M,S),d.constant=a*S,d},r.distanceToPoint=l,r.distanceToSpher3D=function m(d,s){return l(d,s.center)-s.radius},r.projectPoint=function u(d,s,C){return e.e.scaleAndAdd(d,d,s.normal,-l(s,C))}}(o||(o={}))},8184:(tn,Ue,n)=>{"use strict";n.d(Ue,{f:()=>A});var e=n(4369),o=n(3543),r=n(5560),t=n(8199);function A(){return A.zero()}!function(y){function c(V){return void 0!==V.extrema}function i(V,U){return{center:V,radius:U}}function M(V,U){return void 0!==V.extrema?(V.extrema.length=0,V.extrema.push(...U)):V.extrema=U,V}y.hasExtrema=c,y.create=i,y.zero=function v(){return{center:(0,e.eB)(),radius:0}},y.clone=function O(V){const U=i(e.eB.clone(V.center),V.radius);return c(V)&&(U.extrema=V.extrema.map(N=>e.eB.clone(N))),U},y.set=function b(V,U,N){return e.eB.copy(V.center,U),V.radius=N,V},y.copy=function _(V,U){return e.eB.copy(V.center,U.center),V.radius=U.radius,c(U)&&M(V,U.extrema.map(N=>e.eB.clone(N))),V},y.setExtrema=M,y.computeBounding=function I(V){const{x:U,y:N,z:k,indices:H}=V;let $=0,J=0,W=0,te=0;const de=o.CD.size(H);for(let ye=0;ye<de;ye++){const j=o.CD.getAt(H,ye);$+=U[j],J+=N[j],W+=k[j]}de>0&&($/=de,J/=de,W/=de);for(let ye=0;ye<de;ye++){const j=o.CD.getAt(H,ye),Z=U[j]-$,q=N[j]-J,Y=k[j]-W,ee=Z*Z+q*q+Y*Y;ee>te&&(te=ee)}return{center:e.eB.create($,J,W),radius:Math.sqrt(te)}},y.transform=function l(V,U,N){return e.eB.transformMat4(V.center,U.center,N),V.radius=U.radius*e.$I.getMaxScaleOnAxis(N),c(U)&&M(V,U.extrema.map(k=>e.eB.transformMat4((0,e.eB)(),k,N))),V},y.translate=function m(V,U,N){return e.eB.add(V.center,U.center,N),c(U)&&M(V,U.extrema.map(k=>e.eB.add((0,e.eB)(),k,N))),V},y.toArray=function u(V,U,N){return e.eB.toArray(V.center,U,N),U[N+3]=V.radius,U},y.fromArray=function d(V,U,N){return e.eB.fromArray(V.center,U,N),V.radius=U[N+3],V},y.fromBox3D=function s(V,U){return e.eB.scale(V.center,e.eB.add(V.center,U.max,U.min),.5),V.radius=e.eB.distance(V.center,U.max),y.setExtrema(V,[e.eB.create(U.min[0],U.min[1],U.min[2]),e.eB.create(U.max[0],U.max[1],U.max[2]),e.eB.create(U.max[0],U.min[1],U.min[2]),e.eB.create(U.min[0],U.max[1],U.max[2]),e.eB.create(U.min[0],U.min[1],U.max[2]),e.eB.create(U.max[0],U.min[1],U.max[2]),e.eB.create(U.max[0],U.max[1],U.min[2]),e.eB.create(U.min[0],U.max[1],U.min[2])]),V},y.fromAxes3D=function C(V,U){return e.eB.copy(V.center,U.origin),V.radius=Math.max(e.eB.magnitude(U.dirA),e.eB.magnitude(U.dirB),e.eB.magnitude(U.dirC)),V};const h=(0,e.eB)();y.fromDimensionsAndTransform=function a(V,U,N){const[k,H,$]=U,J=e.eB.create(0,0,0);e.eB.transformMat4(J,J,N);const W=e.eB.create(k,H,$);e.eB.transformMat4(W,W,N);const te=e.eB.create(k,0,0);e.eB.transformMat4(te,te,N);const de=e.eB.create(0,H,$);e.eB.transformMat4(de,de,N);const ye=e.eB.create(0,0,$);e.eB.transformMat4(ye,ye,N);const j=e.eB.create(k,0,$);e.eB.transformMat4(j,j,N);const Z=e.eB.create(k,H,0);e.eB.transformMat4(Z,Z,N);const q=e.eB.create(0,H,0);e.eB.transformMat4(q,q,N),e.eB.add(h,J,W),e.eB.scale(h,h,.5);const Y=Math.max(e.eB.distance(J,W),e.eB.distance(te,de));return y.set(V,h,Y/2),y.setExtrema(V,[J,W,te,de,ye,j,Z,q]),V};const S=(0,e.eB)();y.addVec3=function D(V,U,N){return e.eB.distance(U.center,N)<U.radius?y.copy(V,U):(e.eB.sub(S,U.center,N),e.eB.sub(S,U.center,S),e.eB.setMagnitude(S,S,U.radius),e.eB.scale(V.center,e.eB.add(S,S,N),.5),V.radius=e.eB.distance(V.center,N),V)},y.expandBySphere=function R(V,U,N){return e.eB.copy(V.center,U.center),V.radius=Math.max(U.radius,e.eB.distance(U.center,N.center)+N.radius),c(U)&&c(N)&&M(V,[...U.extrema.map(k=>e.eB.clone(k)),...N.extrema.map(k=>e.eB.clone(k))]),V};const f=(0,e.eB)();y.expand=function p(V,U,N){var k,H;if(e.eB.copy(V.center,U.center),V.radius=U.radius+N,U.radius<1e-12||(null!==(H=null===(k=U.extrema)||void 0===k?void 0:k.length)&&void 0!==H?H:0)<=1)return V.extrema=void 0,V;if(c(U)){const $=new Float32Array(3*U.extrema.length);for(let W=0;W<U.extrema.length;W++)e.eB.toArray(U.extrema[W],$,3*W);const J=t.c.calculateMomentsAxes($);r.n.scale(J,r.n.normalize(J,J),N),M(V,U.extrema.map(W=>{e.eB.normalize(f,e.eB.sub(f,W,U.center));const te=e.eB.clone(W),de=e.eB.dot(f,J.dirA)<0?-1:1;e.eB.scaleAndAdd(te,te,J.dirA,de);const ye=e.eB.dot(f,J.dirB)<0?-1:1;e.eB.scaleAndAdd(te,te,J.dirB,ye);const j=e.eB.dot(f,J.dirC)<0?-1:1;return e.eB.scaleAndAdd(te,te,J.dirC,j),e.eB.distance(V.center,te)>V.radius&&(U.extrema.length>=14&&e.eB.normalize(f,e.eB.sub(f,te,U.center)),e.eB.scaleAndAdd(te,V.center,f,V.radius)),te}))}return V},y.exactEquals=function E(V,U){return V.radius===U.radius&&e.eB.exactEquals(V.center,U.center)},y.equals=function T(V,U){const N=V.radius,k=U.radius;return Math.abs(N-k)<=e.p8*Math.max(1,Math.abs(N),Math.abs(k))&&e.eB.equals(V.center,U.center)},y.includes=function L(V,U){if(c(U)){for(const N of U.extrema)if(e.eB.distance(V.center,N)>V.radius)return!1;return!0}return e.eB.distance(V.center,U.center)+U.radius<=V.radius},y.overlaps=function w(V,U){return e.eB.distance(V.center,U.center)<=V.radius+U.radius},y.distance=function Q(V,U){return e.eB.distance(V.center,U.center)-V.radius+U.radius},y.distanceToVec=function G(V,U){const{center:N,radius:k}=V;return e.eB.distance(U,N)-k}}(A||(A={}))},7552:(tn,Ue,n)=>{"use strict";n.d(Ue,{J:()=>y});var y,e=n(127),o=n(7630),r=n(6639),t=n(5126),A=n(2086);function c(v){return 0}!function(v){function O(p,E,T){let{assembly:L,ncsId:w,hkl:Q,spgrOp:G,key:V}=T||{};const U=Q?A.e.clone(Q):(0,A.e)();G=G??-1,V=V??-1,w=w||-1;const N=r.$.isIdentity(E),k=function _(p,E){if(!p)return"";if(p.assembly)return function b(p){return!!p&&!!p.matrix&&!!p.inverse&&"string"==typeof p.name}(p)?p.suffix:E?"":`_${p.assembly.operId}`;if(typeof p.spgrOp<"u"&&typeof p.hkl<"u"&&-1!==p.spgrOp){const[T,L,w]=p.hkl;return`-${p.spgrOp+1}_${5+T}${5+L}${5+w}`}return-1!==p.ncsId?`_${p.ncsId}`:""}(T,N);return N?{name:p,assembly:L,matrix:E,inverse:r.$.identity(),isIdentity:!0,hkl:U,spgrOp:G,ncsId:w,suffix:k,key:V}:(r.$.isRotationAndTranslation(E,v.RotationTranslationEpsilon)||console.warn(`Symmetry operator (${p}) should be a composition of rotation and translation.`),{name:p,assembly:L,matrix:E,inverse:r.$.invert((0,r.$)(),E),isIdentity:!1,hkl:U,spgrOp:G,key:V,ncsId:w,suffix:k})}v.DefaultName="1_555",v.Default=O(v.DefaultName,r.$.identity()),v.RotationTranslationEpsilon=.005,v.create=O;const M=(0,r.$)();v.checkIfRotationAndTranslation=function I(p,E){r.$.setIdentity(M);for(let T=0;T<3;T++)for(let L=0;L<3;L++)r.$.setValue(M,T,L,o.U.getValue(p,T,L));return r.$.setTranslation(M,E),r.$.isRotationAndTranslation(M,v.RotationTranslationEpsilon)},v.ofRotationAndOffset=function l(p,E,T,L){const w=r.$.identity();for(let Q=0;Q<3;Q++)for(let G=0;G<3;G++)r.$.setValue(w,Q,G,o.U.getValue(E,Q,G));return r.$.setTranslation(w,T),O(p,w,{ncsId:L})};const m=t.k.identity(),u=(0,t.k)(),d=(0,t.k)(),s=(0,A.e)();v.lerpFromIdentity=function C(p,E,T){const L=E.inverse;if(E.isIdentity)return r.$.copy(p,L);const w=1-T;r.$.getRotation(u,L),t.k.slerp(u,m,u,w);const Q=t.k.getAxisAngle(s,u);return r.$.fromRotation(p,Q,s),r.$.setValue(p,0,3,w*r.$.getValue(L,0,3)),r.$.setValue(p,1,3,w*r.$.getValue(L,1,3)),r.$.setValue(p,2,3,w*r.$.getValue(L,2,3)),p},v.slerp=function h(p,E,T,L){if(Math.abs(L)<=1e-5)return r.$.copy(p,E);if(Math.abs(L-1)<=1e-5)return r.$.copy(p,T);r.$.getRotation(u,E),r.$.getRotation(d,T),t.k.slerp(d,u,d,L);const w=t.k.getAxisAngle(s,d);return r.$.fromRotation(p,w,s),r.$.setValue(p,0,3,(0,e.Cc)(r.$.getValue(E,0,3),r.$.getValue(T,0,3),L)),r.$.setValue(p,1,3,(0,e.Cc)(r.$.getValue(E,1,3),r.$.getValue(T,1,3),L)),r.$.setValue(p,2,3,(0,e.Cc)(r.$.getValue(E,2,3),r.$.getValue(T,2,3),L)),p},v.compose=function a(p,E){const T=r.$.mul((0,r.$)(),E.matrix,p.matrix);return O(E.name,T,E)};class S{constructor(E,T,L=c){this.operator=E,this.coordinates=T,this.r=L,this._x=T.x,this._y=T.y,this._z=T.z,this._m=E.matrix}invariantPosition(E,T){return T[0]=this._x[E],T[1]=this._y[E],T[2]=this._z[E],T}position(E,T){return T[0]=this._x[E],T[1]=this._y[E],T[2]=this._z[E],A.e.transformMat4(T,T,this._m),T}x(E){const T=this._m,V=this._x[E],U=this._y[E],N=this._z[E];return(T[0]*V+T[4]*U+T[8]*N+T[12])/(T[3]*V+T[7]*U+T[11]*N+T[15]||1)}y(E){const T=this._m,V=this._x[E],U=this._y[E],N=this._z[E];return(T[1]*V+T[5]*U+T[9]*N+T[13])/(T[3]*V+T[7]*U+T[11]*N+T[15]||1)}z(E){const T=this._m,V=this._x[E],U=this._y[E],N=this._z[E];return(T[2]*V+T[6]*U+T[10]*N+T[14])/(T[3]*V+T[7]*U+T[11]*N+T[15]||1)}}class D{constructor(E,T,L=c){this.operator=E,this.coordinates=T,this.r=L,this._x=T.x,this._y=T.y,this._z=T.z,this._m=E.matrix}invariantPosition(E,T){return T[0]=this._x[E],T[1]=this._y[E],T[2]=this._z[E],T}position(E,T){return T[0]=this.x(E),T[1]=this.y(E),T[2]=this.z(E),T}x(E){const T=this._m;return T[0]*this._x[E]+T[4]*this._y[E]+T[8]*this._z[E]+T[12]}y(E){const T=this._m;return T[1]*this._x[E]+T[5]*this._y[E]+T[9]*this._z[E]+T[13]}z(E){const T=this._m;return T[2]*this._x[E]+T[6]*this._y[E]+T[10]*this._z[E]+T[14]}}class R{constructor(E,T,L=c){this.operator=E,this.coordinates=T,this.r=L,this._x=T.x,this._y=T.y,this._z=T.z}invariantPosition(E,T){return T[0]=this._x[E],T[1]=this._y[E],T[2]=this._z[E],T}position(E,T){return T[0]=this._x[E],T[1]=this._y[E],T[2]=this._z[E],T}x(E){return this._x[E]}y(E){return this._y[E]}z(E){return this._z[E]}}v.createMapping=function f(p,E,T=c){return r.$.isIdentity(p.matrix)?new R(p,E,T):function i(v){return 0===v[3]&&0===v[7]&&0===v[11]&&1===v[15]}(p.matrix)?new D(p,E,T):new S(p,E,T)}}(y||(y={}))},4506:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>r});var r,e=n(8382),o=n(3543);function t(A,y,c,i,v){const{b:O,offset:b}=A,_=[];for(let M=0,I=y.length;M<I;++M){const l=y[M];for(let m=b[l],u=b[l+1];m<u;++m){const d=O[m];if(!v.has(d)){if(o.SortedArray.has(c,d))return!0;v.add(d),_[_.length]=d}}}return i>1&&t(A,_,c,i-1,v)}!function(A){A.areEqual=function y(m,u){if(m===u)return!0;if(m.vertexCount!==u.vertexCount||m.edgeCount!==u.edgeCount)return!1;const{a:d,b:s,offset:C}=m,{a:h,b:a,offset:S}=u;for(let D=0,R=m.a.length;D<R;D++)if(d[D]!==h[D])return!1;for(let D=0,R=m.b.length;D<R;D++)if(s[D]!==a[D])return!1;for(let D=0,R=m.offset.length;D<R;D++)if(C[D]!==S[D])return!1;for(const D of Object.keys(m.edgeProps)){const R=m.edgeProps[D],f=u.edgeProps[D];if(!f)return!1;for(let p=0,E=R.length;p<E;p++)if(R[p]!==f[p])return!1}return!0};class c{getEdgeIndex(u,d){let s,C;u<d?(s=u,C=d):(s=d,C=u);for(let h=this.offset[s],a=this.offset[s+1];h<a;h++)if(this.b[h]===C)return h;return-1}getDirectedEdgeIndex(u,d){for(let s=this.offset[u],C=this.offset[u+1];s<C;s++)if(this.b[s]===d)return s;return-1}getVertexEdgeCount(u){return this.offset[u+1]-this.offset[u]}constructor(u,d,s,C,h,a){this.offset=u,this.a=d,this.b=s,this.edgeCount=C,this.props=a,this.vertexCount=u.length-1,this.edgeProps=h||{}}}function i(m,u,d,s,C,h){return new c(m,u,d,s,C,h)}A.create=i;class v{createGraph(u,d){return i(this.offsets,this.a,this.b,this.edgeCount,u,d)}addNextEdge(){const u=this.xs[this.current],d=this.ys[this.current],s=this.offsets[u]+this.bucketFill[u];this.a[s]=u,this.b[s]=d,this.bucketFill[u]++;const C=this.offsets[d]+this.bucketFill[d];this.a[C]=d,this.b[C]=u,this.bucketFill[d]++,this.current++,this.curA=s,this.curB=C}addAllEdges(){for(let u=0;u<this.edgeCount;u++)this.addNextEdge()}assignProperty(u,d){u[this.curA]=d,u[this.curB]=d}assignDirectedProperty(u,d,s,C){u[this.curA]=d,u[this.curB]=C,s[this.curB]=d,s[this.curA]=C}constructor(u,d,s){this.vertexCount=u,this.xs=d,this.ys=s,this.current=0,this.curA=0,this.curB=0,this.edgeCount=d.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);const C=new Int32Array(this.vertexCount);for(let a=0,S=this.xs.length;a<S;a++)C[this.xs[a]]++;for(let a=0,S=this.ys.length;a<S;a++)C[this.ys[a]]++;let h=0;for(let a=0;a<this.vertexCount;a++)this.offsets[a]=h,h+=C[a];this.offsets[this.vertexCount]=h,this.slotCount=h,this.a=new Int32Array(h),this.b=new Int32Array(h)}}function _(m,u,d){const s=new A.EdgeBuilder(m,u,d);return s.addAllEdges(),s.createGraph({})}A.EdgeBuilder=v,A.DirectedEdgeBuilder=class O{createGraph(u,d){return i(this.offsets,this.a,this.b,this.edgeCount,u,d)}addNextEdge(){const u=this.xs[this.current],d=this.ys[this.current],s=this.offsets[u]+this.bucketFill[u];this.a[s]=u,this.b[s]=d,this.bucketFill[u]++,this.current++,this.curA=s}addAllEdges(){for(let u=0;u<this.edgeCount;u++)this.addNextEdge()}assignProperty(u,d){u[this.curA]=d}constructor(u,d,s){this.vertexCount=u,this.xs=d,this.ys=s,this.current=0,this.curA=0,this.edgeCount=d.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);const C=new Int32Array(this.vertexCount);for(let a=0,S=this.xs.length;a<S;a++)C[this.xs[a]]++;let h=0;for(let a=0;a<this.vertexCount;a++)this.offsets[a]=h,h+=C[a];this.offsets[this.vertexCount]=h,this.slotCount=h,this.a=new Int32Array(h),this.b=new Int32Array(h)}},A.UniqueEdgeBuilder=class b{addEdge(u,d){let s=u,C=d;u>d&&(s=d,C=u);const h=(0,e.m1)(s,C);return!this.included.has(h)&&(this.included.add(h),this.xs[this.xs.length]=s,this.ys[this.ys.length]=C,!0)}getGraph(){return _(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new v(this.vertexCount,this.xs,this.ys)}constructor(u){this.vertexCount=u,this.xs=[],this.ys=[],this.included=new Set}},A.fromVertexPairs=_,A.induceByVertices=function M(m,u,d){const{b:s,offset:C,vertexCount:h,edgeProps:a}=m,S=new Int32Array(h);for(let Q=0,G=u.length;Q<G;Q++)S[u[Q]]=Q+1;let D=0;for(let Q=0;Q<h;Q++)if(0!==S[Q])for(let G=C[Q],V=C[Q+1];G<V;G++)s[G]>Q&&0!==S[s[G]]&&D++;const R=new Int32Array(u.length+1),f=new Int32Array(2*D),p=new Int32Array(2*D),E=new Int32Array(2*D);let T=0,L=0;for(let Q=0;Q<h;Q++){if(0===S[Q])continue;const G=S[Q]-1;for(let V=C[Q],U=C[Q+1];V<U;V++){const N=S[s[V]];0!==N&&(p[T]=G,E[T]=N-1,f[T]=V,T++)}R[++L]=T}const w={};for(const Q of Object.keys(a))w[Q]=(0,e.qI)(a[Q],f);return i(R,p,E,D,w,d)},A.connectedComponents=function I(m){const u=m.vertexCount;if(0===u)return{componentCount:0,componentIndex:new Int32Array(0)};if(0===m.edgeCount){const D=new Int32Array(u);for(let R=0,f=u;R<f;R++)D[R]=R;return{componentCount:u,componentIndex:D}}const d=new Int32Array(u);for(let D=0,R=u;D<R;D++)d[D]=-1;let s=0;d[0]=s;const{offset:C,b:h}=m,a=[0],S=(0,o.YB)(u);for(S.remove(0);a.length>0;){const D=a.pop(),R=d[D];for(let f=C[D],p=C[D+1];f<p;f++){const E=h[f];S.has(E)&&(S.remove(E),a.push(E),d[E]=R)}0===a.length&&S.head>=0&&(a.push(S.head),d[S.head]=++s,S.remove(S.head))}return{componentCount:u,componentIndex:d}},A.areVertexSetsConnected=function l(m,u,d,s){if(o.SortedArray.areIntersecting(u,d))return!0;if(s<1)return!1;const C=new Set;for(let h=0,a=u.length;h<a;++h)C.add(u[h]);return t(m,u,d,s,C)}}(r||(r={}))},481:(tn,Ue,n)=>{"use strict";n.d(Ue,{Z:()=>o});var e=n(9677);class o{getConnectedUnits(A){return this.map.has(A)?this.map.get(A):r}getEdgeIndex(A,y,c,i){const v=o.getEdgeKey(A,y,c,i),O=this.edgeKeyIndex.get(v);return void 0!==O?O:-1}hasEdge(A,y,c,i){return-1!==this.getEdgeIndex(A,y,c,i)}getEdge(A,y,c,i){const v=this.getEdgeIndex(A,y,c,i);return-1!==v?this.edges[v]:void 0}getEdgeIndices(A,y){return this.vertexKeyIndex.get(o.getVertexKey(A,y))||[]}constructor(A){this.map=A;let y=0;const c=[],i=new Map,v=new Map;this.map.forEach(O=>{O.forEach(b=>{y+=b.edgeCount,b.connectedIndices.forEach(_=>{b.getEdges(_).forEach(M=>{const{unitA:I,unitB:l}=b,m=o.getEdgeKey(_,I,M.indexB,l);i.set(m,c.length);const u=o.getVertexKey(_,I),d=v.get(u);void 0===d?v.set(u,[c.length]):d.push(c.length),c.push({...M,indexA:_,unitA:I,unitB:l})})})})}),this.edgeCount=y,this.edges=c,this.edgeKeyIndex=i,this.vertexKeyIndex=v}}!function(t){class A{hasEdges(b){return this.edgeMap.has(b)}getEdges(b){return this.edgeMap.has(b)?this.edgeMap.get(b):r}get areUnitsOrdered(){return this.unitA<this.unitB}constructor(b,_,M,I,l){this.unitA=b,this.unitB=_,this.edgeCount=M,this.connectedIndices=I,this.edgeMap=l}}function i(O,b,_){O.has(b)?O.get(b).push(_):O.set(b,[_])}t.UnitPairEdges=A,t.getEdgeKey=function y(O,b,_,M){return`${O}|${b}|${_}|${M}`},t.getVertexKey=function c(O,b){return`${O}|${b}`},t.Builder=class v{constructor(){this.map=new Map}startUnitPair(b,_){this.uA=b,this.uB=_,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=e.th.create(),this.linkedB=e.th.create(),this.linkCount=0}finishUnitPair(){0!==this.linkCount&&(i(this.map,this.uA,new A(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),i(this.map,this.uB,new A(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(b,_,M){i(this.mapAB,b,{indexB:_,props:M}),i(this.mapBA,_,{indexB:b,props:M}),e.th.add(this.linkedA,b,b),e.th.add(this.linkedB,_,_),this.linkCount+=1}getMap(){return this.map}}}(o||(o={}));const r=[]},127:(tn,Ue,n)=>{"use strict";function o(M,I,l){return Math.max(I,Math.min(l,M))}function y(M,I,l){return M+(I-M)*l}function c(M,I,l,m,u,d){const s=(l-M)*d,C=(m-I)*d,h=u*u;return(2*I-2*l+s+C)*(u*h)+(-3*I+3*l-2*s-C)*h+s*u+I}function i(M,I,l,m){const u=1-m;return u*u*M+2*u*m*I+m*m*l}function v(M,I,l){return(l=function t(M){return o(M,0,1)}(function e(M,I,l){return(M-I)/(l-I)}(l,M,I)))*l*(3-2*l)}n.d(Ue,{Cc:()=>y,TF:()=>v,Y7:()=>c,iD:()=>i,qE:()=>o})},4369:(tn,Ue,n)=>{"use strict";n.d(Ue,{p8:()=>c.p,U:()=>o.U,$I:()=>e.$,k:()=>y.k,qY:()=>i,ZY:()=>r.Z,eB:()=>t.e,Zb:()=>A.Z});var i,e=n(6639),o=n(7630),r=n(325),t=n(2086),A=n(8599),y=n(5126),c=n(2028);!function(v){function _(L,w,Q){const G=function O(L,w,Q){const G=[];for(let U=0;U<w.length;U++)G[U]=w[w.length-U-1];const V=[1];for(let U=1;U<L.length;U++)V[U]=L[G[U-1]];return{dimensions:L,axisOrderFastToSlow:G,axisOrderSlowToFast:w,accessDimensions:V,defaultCtor:Q||Float64Array}}(L,w,Q),{get:V,set:U,add:N,dataOffset:k,getCoords:H}=function a(L){const{dimensions:w,axisOrderFastToSlow:Q}=L;switch(w.length){case 1:return{get:(G,V)=>G[V],set:(G,V,U)=>G[V]=U,add:(G,V,U)=>G[V]+=U,dataOffset:G=>G,getCoords:(G,V)=>(V[0]=G,V)};case 2:if(0===Q[0]&&1===Q[1]){const G=w[0];return{get:(V,U,N)=>V[N*G+U],set:(V,U,N,k)=>V[N*G+U]=k,add:(V,U,N,k)=>V[N*G+U]+=k,dataOffset:(V,U)=>U*G+V,getCoords:(V,U)=>(U[0]=V%G,U[1]=Math.floor(V/G),U)}}if(1===Q[0]&&0===Q[1]){const G=w[1];return{get:(V,U,N)=>V[U*G+N],set:(V,U,N,k)=>V[U*G+N]=k,add:(V,U,N,k)=>V[U*G+N]+=k,dataOffset:(V,U)=>V*G+U,getCoords:(V,U)=>(U[0]=Math.floor(V/G),U[1]=V%G,U)}}throw new Error("bad axis order");case 3:if(0===Q[0]&&1===Q[1]&&2===Q[2]){const G=w[0],V=w[1],U=G*V;return{get:(N,k,H,$)=>N[k+H*G+$*U],set:(N,k,H,$,J)=>N[k+H*G+$*U]=J,add:(N,k,H,$,J)=>N[k+H*G+$*U]+=J,dataOffset:(N,k,H)=>N+k*G+H*U,getCoords:(N,k)=>{const H=Math.floor(N/G);return k[0]=N%G,k[1]=H%V,k[2]=Math.floor(H/V),k}}}if(0===Q[0]&&2===Q[1]&&1===Q[2]){const G=w[0],V=w[2],U=G*V;return{get:(N,k,H,$)=>N[k+$*G+H*U],set:(N,k,H,$,J)=>N[k+$*G+H*U]=J,add:(N,k,H,$,J)=>N[k+$*G+H*U]+=J,dataOffset:(N,k,H)=>N+H*G+k*U,getCoords:(N,k)=>{const H=Math.floor(N/G);return k[0]=N%G,k[1]=Math.floor(H/V),k[2]=H%V,k}}}if(1===Q[0]&&0===Q[1]&&2===Q[2]){const G=w[1],V=w[0],U=G*V;return{get:(N,k,H,$)=>N[H+k*G+$*U],set:(N,k,H,$,J)=>N[H+k*G+$*U]=J,add:(N,k,H,$,J)=>N[H+k*G+$*U]+=J,dataOffset:(N,k,H)=>k+N*G+H*U,getCoords:(N,k)=>{const H=Math.floor(N/G);return k[0]=H%V,k[1]=N%G,k[2]=Math.floor(H/V),k}}}if(1===Q[0]&&2===Q[1]&&0===Q[2]){const G=w[1],V=w[2],U=G*V;return{get:(N,k,H,$)=>N[H+$*G+k*U],set:(N,k,H,$,J)=>N[H+$*G+k*U]=J,add:(N,k,H,$,J)=>N[H+$*G+k*U]+=J,dataOffset:(N,k,H)=>k+H*G+N*U,getCoords:(N,k)=>{const H=Math.floor(N/G);return k[0]=Math.floor(H/V),k[1]=N%G,k[2]=H%V,k}}}if(2===Q[0]&&0===Q[1]&&1===Q[2]){const G=w[2],V=w[0],U=G*V;return{get:(N,k,H,$)=>N[$+k*G+H*U],set:(N,k,H,$,J)=>N[$+k*G+H*U]=J,add:(N,k,H,$,J)=>N[$+k*G+H*U]+=J,dataOffset:(N,k,H)=>H+N*G+k*U,getCoords:(N,k)=>{const H=Math.floor(N/G);return k[0]=H%V,k[1]=Math.floor(H/V),k[2]=N%G,k}}}if(2===Q[0]&&1===Q[1]&&0===Q[2]){const G=w[2],V=w[1],U=G*V;return{get:(N,k,H,$)=>N[$+H*G+k*U],set:(N,k,H,$,J)=>N[$+H*G+k*U]=J,add:(N,k,H,$,J)=>N[$+H*G+k*U]+=J,dataOffset:(N,k,H)=>H+k*G+N*U,getCoords:(N,k)=>{const H=Math.floor(N/G);return k[0]=Math.floor(H/V),k[1]=H%V,k[2]=N%G,k}}}throw new Error("bad axis order");default:return{get:(G,...V)=>G[D(L,V)],set:(G,...V)=>G[D(L,V)]=V[V.length-1],add:(G,...V)=>G[D(L,V)]+=V[V.length-1],dataOffset:(...G)=>D(L,G),getCoords:(G,V)=>function R(L,w,Q){const{dimensions:G,axisOrderFastToSlow:V}=L,U=G.length;let N=w;for(let k=0;k<U;k++){const H=G[V[k]];Q[V[k]]=N%H,N=Math.floor(N/H)}return Q[V[U+1]]=N,Q}(L,G,V)}}}(G);return{rank:L.length,dimensions:L,axisOrderSlowToFast:w,create:S(G),get:V,set:U,add:N,dataOffset:k,getCoords:H}}function S(L){const{dimensions:w}=L;let Q=1;for(let G=0,V=w.length;G<V;G++)Q*=w[G];return G=>new(G||L.defaultCtor)(Q)}function D(L,w){const{accessDimensions:Q,axisOrderFastToSlow:G}=L,V=Q.length-1;let U=Q[V]*w[G[V]];for(let N=V-1;N>=0;N--)U=(U+w[G[N]])*Q[N];return U}function p(L,w){const Q=[];for(let G=0;G<L.length;G++)Q[G]=L[w[G]];return Q}v.create=function b(L,w){return{space:L,data:w}},v.Space=_,v.Data1=function M(L){return L},v.Vector=function I(L,w){return _([L],[0],w)},v.ColumnMajorMatrix=function l(L,w,Q){return _([L,w],[1,0],Q)},v.RowMajorMatrix=function m(L,w,Q){return _([L,w],[0,1],Q)},v.toMat4=function u(L,w,Q){if(2!==w.rank)throw new Error("Invalid tensor rank");const G=Math.min(4,w.dimensions[0]),V=Math.min(4,w.dimensions[1]);for(let U=0;U<G;U++)for(let N=0;N<V;N++)e.$.setValue(L,U,N,w.get(Q,U,N));return L},v.toMat3=function d(L,w,Q){if(2!==w.rank)throw new Error("Invalid tensor rank");const G=Math.min(3,w.dimensions[0]),V=Math.min(3,w.dimensions[1]);for(let U=0;U<G;U++)for(let N=0;N<V;N++)o.U.setValue(L,U,N,w.get(Q,U,N));return L},v.toVec3=function s(L,w,Q){if(1!==w.rank)throw new Error("Invalid tensor rank");const G=Math.min(3,w.dimensions[0]);for(let V=0;V<G;V++)L[V]=Q[V];return L},v.toVec4=function C(L,w,Q){if(1!==w.rank)throw new Error("Invalid tensor rank");const G=Math.min(4,w.dimensions[0]);for(let V=0;V<G;V++)L[V]=Q[V];return L},v.areEqualExact=function h(L,w){const Q=L.length;if(Q!==w.length)return!1;for(let G=0;G<Q;G++)if(L[G]!==w[G])return!1;return!0},v.invertAxisOrder=function f(L){const w=[];for(let Q=0;Q<L.length;Q++)w[Q]=L[L.length-Q-1];return w},v.convertToCanonicalAxisIndicesFastToSlow=function E(L){const w=new Int32Array(L.length);for(let Q=0;Q<L.length;Q++)w[L[Q]]=Q;return Q=>p(Q,w)},v.convertToCanonicalAxisIndicesSlowToFast=function T(L){const w=new Int32Array(L.length);for(let Q=0;Q<L.length;Q++)w[L[L.length-Q-1]]=Q;return Q=>p(Q,w)}}(i||(i={}))},2028:(tn,Ue,n)=>{"use strict";n.d(Ue,{T:()=>o,p:()=>e});const e=1e-6;function o(r,t,A){return Math.abs(r-t)<=A}},7630:(tn,Ue,n)=>{"use strict";n.d(Ue,{U:()=>t});var e=n(2028),o=n(6639),r=n(2086);function t(){return t.zero()}!function(A){function y(){const Y=[.1,0,0,0,0,0,0,0,0];return Y[0]=0,Y}function c(){const Y=y();return Y[0]=1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=1,Y[5]=0,Y[6]=0,Y[7]=0,Y[8]=1,Y}function _(Y,ee){return Y[0]=ee[0],Y[1]=ee[1],Y[2]=ee[2],Y[3]=ee[4],Y[4]=ee[5],Y[5]=ee[6],Y[6]=ee[8],Y[7]=ee[9],Y[8]=ee[10],Y}A.zero=y,A.identity=c,A.setIdentity=function i(Y){return Y[0]=1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=1,Y[5]=0,Y[6]=0,Y[7]=0,Y[8]=1,Y},A.toArray=function v(Y,ee,g){return ee[g+0]=Y[0],ee[g+1]=Y[1],ee[g+2]=Y[2],ee[g+3]=Y[3],ee[g+4]=Y[4],ee[g+5]=Y[5],ee[g+6]=Y[6],ee[g+7]=Y[7],ee[g+8]=Y[8],ee},A.fromArray=function O(Y,ee,g){return Y[0]=ee[g+0],Y[1]=ee[g+1],Y[2]=ee[g+2],Y[3]=ee[g+3],Y[4]=ee[g+4],Y[5]=ee[g+5],Y[6]=ee[g+6],Y[7]=ee[g+7],Y[8]=ee[g+8],Y},A.fromColumns=function b(Y,ee,g,_e){return Y[0]=ee[0],Y[1]=ee[1],Y[2]=ee[2],Y[3]=g[0],Y[4]=g[1],Y[5]=g[2],Y[6]=_e[0],Y[7]=_e[1],Y[8]=_e[2],Y},A.fromMat4=_;const M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];A.fromEuler=function I(Y,ee,g){return o.$.fromEuler(M,ee,g),_(Y,M)},A.create=function l(Y,ee,g,_e,xe,le,Ae,Be,Ce){const Re=y();return Re[0]=Y,Re[1]=ee,Re[2]=g,Re[3]=_e,Re[4]=xe,Re[5]=le,Re[6]=Ae,Re[7]=Be,Re[8]=Ce,Re};const m=c();function C(Y,ee,g){for(let _e=0;_e<9;_e++)if(Math.abs(Y[_e]-ee[_e])>g)return!1;return!0}function S(Y,ee){return Y[0]=ee[0],Y[1]=ee[1],Y[2]=ee[2],Y[3]=ee[3],Y[4]=ee[4],Y[5]=ee[5],Y[6]=ee[6],Y[7]=ee[7],Y[8]=ee[8],Y}function D(Y,ee){if(Y===ee){const g=ee[1],_e=ee[2],xe=ee[5];Y[1]=ee[3],Y[2]=ee[6],Y[3]=g,Y[5]=ee[7],Y[6]=_e,Y[7]=xe}else Y[0]=ee[0],Y[1]=ee[3],Y[2]=ee[6],Y[3]=ee[1],Y[4]=ee[4],Y[5]=ee[7],Y[6]=ee[2],Y[7]=ee[5],Y[8]=ee[8];return Y}function R(Y,ee){const g=ee[0],_e=ee[1],xe=ee[2],le=ee[3],Ae=ee[4],Be=ee[5],Ce=ee[6],Re=ee[7],ke=ee[8],we=ke*Ae-Be*Re,Oe=-ke*le+Be*Ce,Se=Re*le-Ae*Ce;let Ve=g*we+_e*Oe+xe*Se;return Ve?(Ve=1/Ve,Y[0]=we*Ve,Y[1]=(-ke*_e+xe*Re)*Ve,Y[2]=(Be*_e-xe*Ae)*Ve,Y[3]=Oe*Ve,Y[4]=(ke*g-xe*Ce)*Ve,Y[5]=(-Be*g+xe*le)*Ve,Y[6]=Se*Ve,Y[7]=(-Re*g+_e*Ce)*Ve,Y[8]=(Ae*g-_e*le)*Ve,Y):(console.warn("non-invertible matrix.",ee),Y)}function E(Y){const xe=Y[3],le=Y[4],Ae=Y[5],Be=Y[6],Ce=Y[7],Re=Y[8];return Y[0]*(Re*le-Ae*Ce)+Y[1]*(-Re*xe+Ae*Be)+Y[2]*(Ce*xe-le*Be)}function T(Y){return Y[0]+Y[4]+Y[8]}function L(Y,ee,g){return Y[0]=ee[0]-g[0],Y[1]=ee[1]-g[1],Y[2]=ee[2]-g[2],Y[3]=ee[3]-g[3],Y[4]=ee[4]-g[4],Y[5]=ee[5]-g[5],Y[6]=ee[6]-g[6],Y[7]=ee[7]-g[7],Y[8]=ee[8]-g[8],Y}function U(Y,ee,g){return Y[0]=ee[0]*g,Y[1]=ee[1]*g,Y[2]=ee[2]*g,Y[3]=ee[3]*g,Y[4]=ee[4]*g,Y[5]=ee[5]*g,Y[6]=ee[6]*g,Y[7]=ee[7]*g,Y[8]=ee[8]*g,Y}A.isIdentity=function u(Y,ee){return C(Y,m,typeof ee>"u"?e.p:ee)},A.hasNaN=function d(Y){for(let ee=0;ee<9;ee++)if(isNaN(Y[ee]))return!0;return!1},A.clone=function s(Y){return S(y(),Y)},A.areEqual=C,A.setValue=function h(Y,ee,g,_e){Y[3*g+ee]=_e},A.getValue=function a(Y,ee,g){return Y[3*g+ee]},A.copy=S,A.transpose=D,A.invert=R,A.symmtricFromUpper=function f(Y,ee){return Y===ee?(Y[3]=ee[1],Y[6]=ee[2],Y[7]=ee[5]):(Y[0]=ee[0],Y[1]=ee[1],Y[2]=ee[2],Y[3]=ee[1],Y[4]=ee[4],Y[5]=ee[5],Y[6]=ee[2],Y[7]=ee[5],Y[8]=ee[8]),Y},A.symmtricFromLower=function p(Y,ee){return Y===ee?(Y[1]=ee[3],Y[2]=ee[6],Y[5]=ee[7]):(Y[0]=ee[0],Y[1]=ee[3],Y[2]=ee[6],Y[3]=ee[3],Y[4]=ee[4],Y[5]=ee[7],Y[6]=ee[6],Y[7]=ee[7],Y[8]=ee[8]),Y},A.determinant=E,A.trace=T,A.sub=L,A.add=function w(Y,ee,g){return Y[0]=ee[0]+g[0],Y[1]=ee[1]+g[1],Y[2]=ee[2]+g[2],Y[3]=ee[3]+g[3],Y[4]=ee[4]+g[4],Y[5]=ee[5]+g[5],Y[6]=ee[6]+g[6],Y[7]=ee[7]+g[7],Y[8]=ee[8]+g[8],Y},A.mul=function Q(Y,ee,g){const _e=ee[0],xe=ee[1],le=ee[2],Ae=ee[3],Be=ee[4],Ce=ee[5],Re=ee[6],ke=ee[7],we=ee[8],Oe=g[0],Se=g[1],Ve=g[2],Ne=g[3],K=g[4],ne=g[5],be=g[6],Te=g[7],ie=g[8];return Y[0]=Oe*_e+Se*Ae+Ve*Re,Y[1]=Oe*xe+Se*Be+Ve*ke,Y[2]=Oe*le+Se*Ce+Ve*we,Y[3]=Ne*_e+K*Ae+ne*Re,Y[4]=Ne*xe+K*Be+ne*ke,Y[5]=Ne*le+K*Ce+ne*we,Y[6]=be*_e+Te*Ae+ie*Re,Y[7]=be*xe+Te*Be+ie*ke,Y[8]=be*le+Te*Ce+ie*we,Y},A.subScalar=function G(Y,ee,g){return Y[0]=ee[0]-g,Y[1]=ee[1]-g,Y[2]=ee[2]-g,Y[3]=ee[3]-g,Y[4]=ee[4]-g,Y[5]=ee[5]-g,Y[6]=ee[6]-g,Y[7]=ee[7]-g,Y[8]=ee[8]-g,Y},A.addScalar=function V(Y,ee,g){return Y[0]=ee[0]+g,Y[1]=ee[1]+g,Y[2]=ee[2]+g,Y[3]=ee[3]+g,Y[4]=ee[4]+g,Y[5]=ee[5]+g,Y[6]=ee[6]+g,Y[7]=ee[7]+g,Y[8]=ee[8]+g,Y},A.mulScalar=U;const N=Math.PI/3,k=y();A.symmetricEigenvalues=function H(Y,ee){const g=ee[1]*ee[1]+ee[2]*ee[2]+ee[5]*ee[5];if(0===g)Y[0]=ee[0],Y[1]=ee[4],Y[2]=ee[8];else{const _e=T(ee)/3,xe=ee[0]-_e,le=ee[4]-_e,Ae=ee[8]-_e,Ce=Math.sqrt((xe*xe+le*le+Ae*Ae+2*g)/6);U(k,A.Identity,_e),L(k,ee,k),U(k,k,1/Ce);const Re=E(k)/2,ke=Re<=-1?N:Re>=1?0:Math.acos(Re)/3;Y[0]=_e+2*Ce*Math.cos(ke),Y[2]=_e+2*Ce*Math.cos(ke+2*N),Y[1]=3*_e-Y[0]-Y[2]}return Y};const $=[.1,0,0],J=[.1,0,0],W=[.1,0,0],te=[.1,0,0],de=[.1,0,0],ye=[.1,0,0];A.eigenvector=function j(Y,ee,g){r.e.set($,ee[0]-g,ee[1],ee[2]),r.e.set(J,ee[1],ee[4]-g,ee[5]),r.e.set(W,ee[2],ee[5],ee[8]-g),r.e.cross(te,$,J),r.e.cross(de,$,W),r.e.cross(ye,J,W);const _e=r.e.dot(te,te),xe=r.e.dot(de,de),le=r.e.dot(ye,ye);let Ae=_e,Be=0;return xe>Ae&&(Ae=xe,Be=1),le>Ae&&(Be=2),0===Be?r.e.scale(Y,te,1/Math.sqrt(_e)):1===Be?r.e.scale(Y,de,1/Math.sqrt(xe)):r.e.scale(Y,ye,1/Math.sqrt(le)),Y},A.directionTransform=function Z(Y,ee){return _(Y,ee),R(Y,Y),D(Y,Y),Y},A.Identity=c(),A.innerProduct=function q(Y,ee){return Y[0]*ee[0]+Y[1]*ee[1]+Y[2]*ee[2]+Y[3]*ee[3]+Y[4]*ee[4]+Y[5]*ee[5]+Y[6]*ee[6]+Y[7]*ee[7]+Y[8]*ee[8]}}(t||(t={}))},6639:(tn,Ue,n)=>{"use strict";n.d(Ue,{$:()=>t});var e=n(2028),o=n(2086),r=n(4490);function t(){return t.zero()}!function(A){function y(){const K=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return K[0]=0,K}function c(){const K=y();return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function i(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function v(K){for(let ne=0;ne<16;ne++)K[ne]=0;return K}A.zero=y,A.identity=c,A.setIdentity=i,A.setZero=v,A.ofRows=function O(K){const ne=y();for(let be=0;be<4;be++){const Te=K[be];for(let ie=0;ie<4;ie++)ne[4*ie+be]=Te[ie]}return ne};const b=c();function I(K,ne,be){for(let Te=0;Te<16;Te++)if(Math.abs(K[Te]-ne[Te])>be)return!1;return!0}function l(K,ne,be,Te){K[4*be+ne]=Te}function C(K,ne){return K[0]=ne[0],K[1]=ne[1],K[2]=ne[2],K[3]=ne[3],K[4]=ne[4],K[5]=ne[5],K[6]=ne[6],K[7]=ne[7],K[8]=ne[8],K[9]=ne[9],K[10]=ne[10],K[11]=ne[11],K[12]=ne[12],K[13]=ne[13],K[14]=ne[14],K[15]=ne[15],K}function D(K,ne){const be=ne[0]+ne[5]+ne[10];let Te=0;return be>0?(Te=2*Math.sqrt(be+1),K[3]=.25*Te,K[0]=(ne[6]-ne[9])/Te,K[1]=(ne[8]-ne[2])/Te,K[2]=(ne[1]-ne[4])/Te):ne[0]>ne[5]&&ne[0]>ne[10]?(Te=2*Math.sqrt(1+ne[0]-ne[5]-ne[10]),K[3]=(ne[6]-ne[9])/Te,K[0]=.25*Te,K[1]=(ne[1]+ne[4])/Te,K[2]=(ne[8]+ne[2])/Te):ne[5]>ne[10]?(Te=2*Math.sqrt(1+ne[5]-ne[0]-ne[10]),K[3]=(ne[8]-ne[2])/Te,K[0]=(ne[1]+ne[4])/Te,K[1]=.25*Te,K[2]=(ne[6]+ne[9])/Te):(Te=2*Math.sqrt(1+ne[10]-ne[0]-ne[5]),K[3]=(ne[1]-ne[4])/Te,K[0]=(ne[8]+ne[2])/Te,K[1]=(ne[6]+ne[9])/Te,K[2]=.25*Te),K}function p(K,ne){const be=ne[0],Te=ne[1],ie=ne[2],ue=ne[3],re=ne[4],ve=ne[5],ce=ne[6],se=ne[7],ae=ne[8],ge=ne[9],Ie=ne[10],Le=ne[11],nt=ne[12],je=ne[13],Lt=ne[14],Je=ne[15],en=be*ve-Te*re,Bt=be*ce-ie*re,pn=be*se-ue*re,$e=Te*ce-ie*ve,mt=Te*se-ue*ve,_t=ie*se-ue*ce,Me=ae*je-ge*nt,Ke=ae*Lt-Ie*nt,ut=ae*Je-Le*nt,Kt=ge*Lt-Ie*je,sn=ge*Je-Le*je,gt=Ie*Je-Le*Lt;let yt=en*gt-Bt*sn+pn*Kt+$e*ut-mt*Ke+_t*Me;return!!yt&&(yt=1/yt,K[0]=(ve*gt-ce*sn+se*Kt)*yt,K[1]=(ie*sn-Te*gt-ue*Kt)*yt,K[2]=(je*_t-Lt*mt+Je*$e)*yt,K[3]=(Ie*mt-ge*_t-Le*$e)*yt,K[4]=(ce*ut-re*gt-se*Ke)*yt,K[5]=(be*gt-ie*ut+ue*Ke)*yt,K[6]=(Lt*pn-nt*_t-Je*Bt)*yt,K[7]=(ae*_t-Ie*pn+Le*Bt)*yt,K[8]=(re*sn-ve*ut+se*Me)*yt,K[9]=(Te*ut-be*sn-ue*Me)*yt,K[10]=(nt*mt-je*pn+Je*en)*yt,K[11]=(ge*pn-ae*mt-Le*en)*yt,K[12]=(ve*Ke-re*Kt-ce*Me)*yt,K[13]=(be*Kt-Te*Ke+ie*Me)*yt,K[14]=(je*Bt-nt*$e-Lt*en)*yt,K[15]=(ae*$e-ge*Bt+Ie*en)*yt,!0)}function T(K,ne,be){const Te=ne[0],ie=ne[1],ue=ne[2],re=ne[3],ve=ne[4],ce=ne[5],se=ne[6],ae=ne[7],ge=ne[8],Ie=ne[9],Le=ne[10],nt=ne[11],je=ne[12],Lt=ne[13],Je=ne[14],en=ne[15];let Bt=be[0],pn=be[1],$e=be[2],mt=be[3];return K[0]=Bt*Te+pn*ve+$e*ge+mt*je,K[1]=Bt*ie+pn*ce+$e*Ie+mt*Lt,K[2]=Bt*ue+pn*se+$e*Le+mt*Je,K[3]=Bt*re+pn*ae+$e*nt+mt*en,Bt=be[4],pn=be[5],$e=be[6],mt=be[7],K[4]=Bt*Te+pn*ve+$e*ge+mt*je,K[5]=Bt*ie+pn*ce+$e*Ie+mt*Lt,K[6]=Bt*ue+pn*se+$e*Le+mt*Je,K[7]=Bt*re+pn*ae+$e*nt+mt*en,Bt=be[8],pn=be[9],$e=be[10],mt=be[11],K[8]=Bt*Te+pn*ve+$e*ge+mt*je,K[9]=Bt*ie+pn*ce+$e*Ie+mt*Lt,K[10]=Bt*ue+pn*se+$e*Le+mt*Je,K[11]=Bt*re+pn*ae+$e*nt+mt*en,Bt=be[12],pn=be[13],$e=be[14],mt=be[15],K[12]=Bt*Te+pn*ve+$e*ge+mt*je,K[13]=Bt*ie+pn*ce+$e*Ie+mt*Lt,K[14]=Bt*ue+pn*se+$e*Le+mt*Je,K[15]=Bt*re+pn*ae+$e*nt+mt*en,K}function k(K,ne,be){let Te=be[0],ie=be[1],ue=be[2],re=Math.sqrt(Te*Te+ie*ie+ue*ue);if(Math.abs(re)<e.p)return i(K);re=1/re,Te*=re,ie*=re,ue*=re;const ve=Math.sin(ne),ce=Math.cos(ne),se=1-ce;return K[0]=Te*Te*se+ce,K[1]=ie*Te*se+ue*ve,K[2]=ue*Te*se-ie*ve,K[3]=0,K[4]=Te*ie*se-ue*ve,K[5]=ie*ie*se+ce,K[6]=ue*ie*se+Te*ve,K[7]=0,K[8]=Te*ue*se+ie*ve,K[9]=ie*ue*se-Te*ve,K[10]=ue*ue*se+ce,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}A.isIdentity=function _(K,ne){return I(K,b,typeof ne>"u"?e.p:ne)},A.hasNaN=function M(K){for(let ne=0;ne<16;ne++)if(isNaN(K[ne]))return!0;return!1},A.areEqual=I,A.setValue=l,A.getValue=function m(K,ne,be){return K[4*be+ne]},A.toArray=function u(K,ne,be){return ne[be+0]=K[0],ne[be+1]=K[1],ne[be+2]=K[2],ne[be+3]=K[3],ne[be+4]=K[4],ne[be+5]=K[5],ne[be+6]=K[6],ne[be+7]=K[7],ne[be+8]=K[8],ne[be+9]=K[9],ne[be+10]=K[10],ne[be+11]=K[11],ne[be+12]=K[12],ne[be+13]=K[13],ne[be+14]=K[14],ne[be+15]=K[15],ne},A.fromArray=function d(K,ne,be){return K[0]=ne[be+0],K[1]=ne[be+1],K[2]=ne[be+2],K[3]=ne[be+3],K[4]=ne[be+4],K[5]=ne[be+5],K[6]=ne[be+6],K[7]=ne[be+7],K[8]=ne[be+8],K[9]=ne[be+9],K[10]=ne[be+10],K[11]=ne[be+11],K[12]=ne[be+12],K[13]=ne[be+13],K[14]=ne[be+14],K[15]=ne[be+15],K},A.fromBasis=function s(K,ne,be,Te){return v(K),l(K,0,0,ne[0]),l(K,1,0,ne[1]),l(K,2,0,ne[2]),l(K,0,1,be[0]),l(K,1,1,be[1]),l(K,2,1,be[2]),l(K,0,2,Te[0]),l(K,1,2,Te[1]),l(K,2,2,Te[2]),l(K,3,3,1),K},A.copy=C,A.clone=function h(K){return C(y(),K)},A.getTranslation=function a(K,ne){return K[0]=ne[12],K[1]=ne[13],K[2]=ne[14],K},A.getScaling=function S(K,ne){const be=ne[0],Te=ne[1],ie=ne[2],ue=ne[4],re=ne[5],ve=ne[6],ce=ne[8],se=ne[9],ae=ne[10];return K[0]=Math.sqrt(be*be+Te*Te+ie*ie),K[1]=Math.sqrt(ue*ue+re*re+ve*ve),K[2]=Math.sqrt(ce*ce+se*se+ae*ae),K},A.getRotation=D,A.extractRotation=function R(K,ne){const be=1/Math.sqrt(ne[0]*ne[0]+ne[1]*ne[1]+ne[2]*ne[2]),Te=1/Math.sqrt(ne[4]*ne[4]+ne[5]*ne[5]+ne[6]*ne[6]),ie=1/Math.sqrt(ne[8]*ne[8]+ne[9]*ne[9]+ne[10]*ne[10]);return K[0]=ne[0]*be,K[1]=ne[1]*be,K[2]=ne[2]*be,K[3]=0,K[4]=ne[4]*Te,K[5]=ne[5]*Te,K[6]=ne[6]*Te,K[7]=0,K[8]=ne[8]*ie,K[9]=ne[9]*ie,K[10]=ne[10]*ie,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},A.transpose=function f(K,ne){if(K===ne){const be=ne[1],Te=ne[2],ie=ne[3],ue=ne[6],re=ne[7],ve=ne[11];K[1]=ne[4],K[2]=ne[8],K[3]=ne[12],K[4]=be,K[6]=ne[9],K[7]=ne[13],K[8]=Te,K[9]=ue,K[11]=ne[14],K[12]=ie,K[13]=re,K[14]=ve}else K[0]=ne[0],K[1]=ne[4],K[2]=ne[8],K[3]=ne[12],K[4]=ne[1],K[5]=ne[5],K[6]=ne[9],K[7]=ne[13],K[8]=ne[2],K[9]=ne[6],K[10]=ne[10],K[11]=ne[14],K[12]=ne[3],K[13]=ne[7],K[14]=ne[11],K[15]=ne[15];return K},A.tryInvert=p,A.invert=function E(K,ne){return p(K,ne)||console.warn("non-invertible matrix.",ne),K},A.mul=T,A.mulOffset=function L(K,ne,be,Te,ie,ue){const re=ne[0+ie],ve=ne[1+ie],ce=ne[2+ie],se=ne[3+ie],ae=ne[4+ie],ge=ne[5+ie],Ie=ne[6+ie],Le=ne[7+ie],nt=ne[8+ie],je=ne[9+ie],Lt=ne[10+ie],Je=ne[11+ie],en=ne[12+ie],Bt=ne[13+ie],pn=ne[14+ie],$e=ne[15+ie];let mt=be[0+ue],_t=be[1+ue],Me=be[2+ue],Ke=be[3+ue];return K[0+Te]=mt*re+_t*ae+Me*nt+Ke*en,K[1+Te]=mt*ve+_t*ge+Me*je+Ke*Bt,K[2+Te]=mt*ce+_t*Ie+Me*Lt+Ke*pn,K[3+Te]=mt*se+_t*Le+Me*Je+Ke*$e,mt=be[4+ue],_t=be[5+ue],Me=be[6+ue],Ke=be[7+ue],K[4+Te]=mt*re+_t*ae+Me*nt+Ke*en,K[5+Te]=mt*ve+_t*ge+Me*je+Ke*Bt,K[6+Te]=mt*ce+_t*Ie+Me*Lt+Ke*pn,K[7+Te]=mt*se+_t*Le+Me*Je+Ke*$e,mt=be[8+ue],_t=be[9+ue],Me=be[10+ue],Ke=be[11+ue],K[8+Te]=mt*re+_t*ae+Me*nt+Ke*en,K[9+Te]=mt*ve+_t*ge+Me*je+Ke*Bt,K[10+Te]=mt*ce+_t*Ie+Me*Lt+Ke*pn,K[11+Te]=mt*se+_t*Le+Me*Je+Ke*$e,mt=be[12+ue],_t=be[13+ue],Me=be[14+ue],Ke=be[15+ue],K[12+Te]=mt*re+_t*ae+Me*nt+Ke*en,K[13+Te]=mt*ve+_t*ge+Me*je+Ke*Bt,K[14+Te]=mt*ce+_t*Ie+Me*Lt+Ke*pn,K[15+Te]=mt*se+_t*Le+Me*Je+Ke*$e,K},A.mul3=function w(K,ne,be,Te){return T(K,T(K,ne,be),Te)},A.translate=function Q(K,ne,be){const Te=be[0],ie=be[1],ue=be[2];let re,ve,ce,se,ae,ge,Ie,Le,nt,je,Lt,Je;return ne===K?(K[12]=ne[0]*Te+ne[4]*ie+ne[8]*ue+ne[12],K[13]=ne[1]*Te+ne[5]*ie+ne[9]*ue+ne[13],K[14]=ne[2]*Te+ne[6]*ie+ne[10]*ue+ne[14],K[15]=ne[3]*Te+ne[7]*ie+ne[11]*ue+ne[15]):(re=ne[0],ve=ne[1],ce=ne[2],se=ne[3],ae=ne[4],ge=ne[5],Ie=ne[6],Le=ne[7],nt=ne[8],je=ne[9],Lt=ne[10],Je=ne[11],K[0]=re,K[1]=ve,K[2]=ce,K[3]=se,K[4]=ae,K[5]=ge,K[6]=Ie,K[7]=Le,K[8]=nt,K[9]=je,K[10]=Lt,K[11]=Je,K[12]=re*Te+ae*ie+nt*ue+ne[12],K[13]=ve*Te+ge*ie+je*ue+ne[13],K[14]=ce*Te+Ie*ie+Lt*ue+ne[14],K[15]=se*Te+Le*ie+Je*ue+ne[15]),K},A.fromTranslation=function G(K,ne){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=ne[0],K[13]=ne[1],K[14]=ne[2],K[15]=1,K},A.setTranslation=function V(K,ne){return K[12]=ne[0],K[13]=ne[1],K[14]=ne[2],K},A.setAxes=function U(K,ne,be,Te){return K[0]=be[0],K[4]=be[1],K[8]=be[2],K[1]=Te[0],K[5]=Te[1],K[9]=Te[2],K[2]=ne[0],K[6]=ne[1],K[10]=ne[2],K},A.rotate=function N(K,ne,be,Te){let ie=Te[0],ue=Te[1],re=Te[2],ve=Math.sqrt(ie*ie+ue*ue+re*re);if(Math.abs(ve)<e.p)return c();ve=1/ve,ie*=ve,ue*=ve,re*=ve;const ce=Math.sin(be),se=Math.cos(be),ae=1-se,ge=ne[0],Ie=ne[1],Le=ne[2],nt=ne[3],je=ne[4],Lt=ne[5],Je=ne[6],en=ne[7],Bt=ne[8],pn=ne[9],$e=ne[10],mt=ne[11],_t=ie*ie*ae+se,Me=ue*ie*ae+re*ce,Ke=re*ie*ae-ue*ce,ut=ie*ue*ae-re*ce,Kt=ue*ue*ae+se,sn=re*ue*ae+ie*ce,gt=ie*re*ae+ue*ce,yt=ue*re*ae-ie*ce,At=re*re*ae+se;return K[0]=ge*_t+je*Me+Bt*Ke,K[1]=Ie*_t+Lt*Me+pn*Ke,K[2]=Le*_t+Je*Me+$e*Ke,K[3]=nt*_t+en*Me+mt*Ke,K[4]=ge*ut+je*Kt+Bt*sn,K[5]=Ie*ut+Lt*Kt+pn*sn,K[6]=Le*ut+Je*Kt+$e*sn,K[7]=nt*ut+en*Kt+mt*sn,K[8]=ge*gt+je*yt+Bt*At,K[9]=Ie*gt+Lt*yt+pn*At,K[10]=Le*gt+Je*yt+$e*At,K[11]=nt*gt+en*yt+mt*At,ne!==K&&(K[12]=ne[12],K[13]=ne[13],K[14]=ne[14],K[15]=ne[15]),K},A.fromRotation=k,A.scale=function H(K,ne,be){const Te=be[0],ie=be[1],ue=be[2];return K[0]=ne[0]*Te,K[1]=ne[1]*Te,K[2]=ne[2]*Te,K[3]=ne[3]*Te,K[4]=ne[4]*ie,K[5]=ne[5]*ie,K[6]=ne[6]*ie,K[7]=ne[7]*ie,K[8]=ne[8]*ue,K[9]=ne[9]*ue,K[10]=ne[10]*ue,K[11]=ne[11]*ue,K[12]=ne[12],K[13]=ne[13],K[14]=ne[14],K[15]=ne[15],K},A.scaleUniformly=function $(K,ne,be){return K[0]=ne[0]*be,K[1]=ne[1]*be,K[2]=ne[2]*be,K[3]=ne[3]*be,K[4]=ne[4]*be,K[5]=ne[5]*be,K[6]=ne[6]*be,K[7]=ne[7]*be,K[8]=ne[8]*be,K[9]=ne[9]*be,K[10]=ne[10]*be,K[11]=ne[11]*be,K[12]=ne[12],K[13]=ne[13],K[14]=ne[14],K[15]=ne[15],K},A.fromScaling=function J(K,ne){return K[0]=ne[0],K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=ne[1],K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=ne[2],K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},A.fromUniformScaling=function W(K,ne){return K[0]=ne,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=ne,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=ne,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},A.fromMat3=function te(K,ne){return K[0]=ne[0],K[1]=ne[1],K[2]=ne[2],K[4]=ne[3],K[5]=ne[4],K[6]=ne[5],K[8]=ne[6],K[9]=ne[7],K[10]=ne[8],K},A.compose=function de(K,ne,be,Te){const[ie,ue,re,ve]=be,ce=ie+ie,se=ue+ue,ae=re+re,ge=ie*ce,Ie=ie*se,Le=ie*ae,nt=ue*se,je=ue*ae,Lt=re*ae,Je=ve*ce,en=ve*se,Bt=ve*ae,[pn,$e,mt]=Te;return K[0]=(1-(nt+Lt))*pn,K[1]=(Ie+Bt)*pn,K[2]=(Le-en)*pn,K[3]=0,K[4]=(Ie-Bt)*$e,K[5]=(1-(ge+Lt))*$e,K[6]=(je+Je)*$e,K[7]=0,K[8]=(Le+en)*mt,K[9]=(je-Je)*mt,K[10]=(1-(ge+nt))*mt,K[11]=0,K[12]=ne[0],K[13]=ne[1],K[14]=ne[2],K[15]=1,K};const ye=[0,0,0],j=y();function Y(K){const ne=K[0],be=K[1],Te=K[2],ie=K[3],ue=K[4],re=K[5],ve=K[6],ce=K[7],se=K[8],ae=K[9],ge=K[10],Ie=K[11],Le=K[12],nt=K[13],je=K[14],Lt=K[15];return(ne*re-be*ue)*(ge*Lt-Ie*je)-(ne*ve-Te*ue)*(ae*Lt-Ie*nt)+(ne*ce-ie*ue)*(ae*je-ge*nt)+(be*ve-Te*re)*(se*Lt-Ie*Le)-(be*ce-ie*re)*(se*je-ge*Le)+(Te*ce-ie*ve)*(se*nt-ae*Le)}A.decompose=function Z(K,ne,be,Te){let ie=o.e.magnitude(o.e.set(ye,K[0],K[1],K[2]));const ue=o.e.magnitude(o.e.set(ye,K[4],K[5],K[6])),re=o.e.magnitude(o.e.set(ye,K[8],K[9],K[10]));Y(K)<0&&(ie=-ie),ne[0]=K[12],ne[1]=K[13],ne[2]=K[14],C(j,K);const ce=1/ie,se=1/ue,ae=1/re;return j[0]*=ce,j[1]*=ce,j[2]*=ce,j[4]*=se,j[5]*=se,j[6]*=se,j[8]*=ae,j[9]*=ae,j[10]*=ae,D(be,j),Te[0]=ie,Te[1]=ue,Te[2]=re,K},A.makeTable=function q(K){let ne="";for(let be=0;be<4;be++){for(let Te=0;Te<4;Te++)ne+=K[4*Te+be].toString(),Te<3&&(ne+=" ");be<3&&(ne+="\n")}return ne},A.determinant=Y,A.isRotationAndTranslation=function ee(K,ne){return function g(K,ne){const be=K[0],Te=K[1],ie=K[2],ue=K[3],re=K[4],ve=K[5],ce=K[6],se=K[7],ae=K[8],ge=K[9],Ie=K[10],Le=K[11];if(!((0,e.T)(K[15],1,ne)&&(0,e.T)(ue,0,ne)&&(0,e.T)(se,0,ne)&&(0,e.T)(Le,0,ne)))return!1;const je=Math.abs(be*(ve*Ie-ce*ge)-Te*(re*Ie-ce*ae)+ie*(re*ge-ve*ae));return!!(0,e.T)(je,1,ne)}(K,typeof ne<"u"?ne:e.p)},A.isTranslationAndUniformScaling=function _e(K,ne){return function xe(K,ne){const be=K[0];return(0,e.T)(K[1],0,ne)&&(0,e.T)(K[2],0,ne)&&(0,e.T)(K[3],0,ne)&&(0,e.T)(K[4],0,ne)&&(0,e.T)(K[5],be,ne)&&(0,e.T)(K[6],0,ne)&&(0,e.T)(K[7],0,ne)&&(0,e.T)(K[8],0,ne)&&(0,e.T)(K[9],0,ne)&&(0,e.T)(K[10],be,ne)&&(0,e.T)(K[11],0,ne)&&(0,e.T)(K[15],1,ne)}(K,typeof ne<"u"?ne:e.p)},A.fromQuat=function le(K,ne){const be=ne[0],Te=ne[1],ie=ne[2],ue=ne[3],re=be+be,ve=Te+Te,ce=ie+ie,se=be*re,ae=Te*re,ge=Te*ve,Ie=ie*re,Le=ie*ve,nt=ie*ce,je=ue*re,Lt=ue*ve,Je=ue*ce;return K[0]=1-ge-nt,K[1]=ae+Je,K[2]=Ie-Lt,K[3]=0,K[4]=ae-Je,K[5]=1-se-nt,K[6]=Le+je,K[7]=0,K[8]=Ie+Lt,K[9]=Le-je,K[10]=1-se-ge,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},A.fromEuler=function Ae(K,ne,be){const Te=ne[0],ie=ne[1],ue=ne[2],re=Math.cos(Te),ve=Math.sin(Te),ce=Math.cos(ie),se=Math.sin(ie),ae=Math.cos(ue),ge=Math.sin(ue);if("XYZ"===be){const Ie=re*ae,Le=re*ge,nt=ve*ae,je=ve*ge;K[0]=ce*ae,K[4]=-ce*ge,K[8]=se,K[1]=Le+nt*se,K[5]=Ie-je*se,K[9]=-ve*ce,K[2]=je-Ie*se,K[6]=nt+Le*se,K[10]=re*ce}else if("YXZ"===be){const Ie=ce*ae,Le=ce*ge,nt=se*ae,je=se*ge;K[0]=Ie+je*ve,K[4]=nt*ve-Le,K[8]=re*se,K[1]=re*ge,K[5]=re*ae,K[9]=-ve,K[2]=Le*ve-nt,K[6]=je+Ie*ve,K[10]=re*ce}else if("ZXY"===be){const Ie=ce*ae,Le=ce*ge,nt=se*ae,je=se*ge;K[0]=Ie-je*ve,K[4]=-re*ge,K[8]=nt+Le*ve,K[1]=Le+nt*ve,K[5]=re*ae,K[9]=je-Ie*ve,K[2]=-re*se,K[6]=ve,K[10]=re*ce}else if("ZYX"===be){const Ie=re*ae,Le=re*ge,nt=ve*ae,je=ve*ge;K[0]=ce*ae,K[4]=nt*se-Le,K[8]=Ie*se+je,K[1]=ce*ge,K[5]=je*se+Ie,K[9]=Le*se-nt,K[2]=-se,K[6]=ve*ce,K[10]=re*ce}else if("YZX"===be){const Ie=re*ce,Le=re*se,nt=ve*ce,je=ve*se;K[0]=ce*ae,K[4]=je-Ie*ge,K[8]=nt*ge+Le,K[1]=ge,K[5]=re*ae,K[9]=-ve*ae,K[2]=-se*ae,K[6]=Le*ge+nt,K[10]=Ie-je*ge}else if("XZY"===be){const Ie=re*ce,Le=re*se,nt=ve*ce,je=ve*se;K[0]=ce*ae,K[4]=-ge,K[8]=se*ae,K[1]=Ie*ge+je,K[5]=re*ae,K[9]=Le*ge-nt,K[2]=nt*ge-Le,K[6]=ve*ae,K[10]=je*ge+Ie}return K[3]=0,K[7]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},A.perspective=function Be(K,ne,be,Te,ie,ue,re){const ce=2*ue/(Te-ie),se=(be+ne)/(be-ne),ae=(Te+ie)/(Te-ie),ge=-(re+ue)/(re-ue),Ie=-2*re*ue/(re-ue);return K[0]=2*ue/(be-ne),K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=ce,K[6]=0,K[7]=0,K[8]=se,K[9]=ae,K[10]=ge,K[11]=-1,K[12]=0,K[13]=0,K[14]=Ie,K[15]=0,K},A.ortho=function Ce(K,ne,be,Te,ie,ue,re){const ve=1/(be-ne),ce=1/(Te-ie),se=1/(re-ue),ae=(be+ne)*ve,ge=(Te+ie)*ce,Ie=(re+ue)*se;return K[0]=2*ve,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=2*ce,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=-2*se,K[11]=0,K[12]=-ae,K[13]=-ge,K[14]=-Ie,K[15]=1,K},A.lookAt=function Re(K,ne,be,Te){let ie,ue,re,ve,ce,se,ae,ge,Ie,Le;const nt=ne[0],je=ne[1],Lt=ne[2],Je=Te[0],en=Te[1],Bt=Te[2],pn=be[0],$e=be[1],mt=be[2];return Math.abs(nt-pn)<e.p&&Math.abs(je-$e)<e.p&&Math.abs(Lt-mt)<e.p?i(K):(ae=nt-pn,ge=je-$e,Ie=Lt-mt,Le=1/Math.sqrt(ae*ae+ge*ge+Ie*Ie),ae*=Le,ge*=Le,Ie*=Le,ie=en*Ie-Bt*ge,ue=Bt*ae-Je*Ie,re=Je*ge-en*ae,Le=Math.sqrt(ie*ie+ue*ue+re*re),Le?(Le=1/Le,ie*=Le,ue*=Le,re*=Le):(ie=0,ue=0,re=0),ve=ge*re-Ie*ue,ce=Ie*ie-ae*re,se=ae*ue-ge*ie,Le=Math.sqrt(ve*ve+ce*ce+se*se),Le?(Le=1/Le,ve*=Le,ce*=Le,se*=Le):(ve=0,ce=0,se=0),K[0]=ie,K[1]=ve,K[2]=ae,K[3]=0,K[4]=ue,K[5]=ce,K[6]=ge,K[7]=0,K[8]=re,K[9]=se,K[10]=Ie,K[11]=0,K[12]=-(ie*nt+ue*je+re*Lt),K[13]=-(ve*nt+ce*je+se*Lt),K[14]=-(ae*nt+ge*je+Ie*Lt),K[15]=1,K)},A.targetTo=function ke(K,ne,be,Te){const ie=ne[0],ue=ne[1],re=ne[2],ve=Te[0],ce=Te[1],se=Te[2];let ae=ie-be[0],ge=ue-be[1],Ie=re-be[2],Le=ae*ae+ge*ge+Ie*Ie;Le>0&&(Le=1/Math.sqrt(Le),ae*=Le,ge*=Le,Ie*=Le);let nt=ce*Ie-se*ge,je=se*ae-ve*Ie,Lt=ve*ge-ce*ae;return Le=nt*nt+je*je+Lt*Lt,Le>0&&(Le=1/Math.sqrt(Le),nt*=Le,je*=Le,Lt*=Le),K[0]=nt,K[1]=je,K[2]=Lt,K[3]=0,K[4]=ge*Lt-Ie*je,K[5]=Ie*nt-ae*Lt,K[6]=ae*je-ge*nt,K[7]=0,K[8]=ae,K[9]=ge,K[10]=Ie,K[11]=0,K[12]=ie,K[13]=ue,K[14]=re,K[15]=1,K},A.fromPermutation=function we(K,ne){v(K);for(let be=0;be<4;be++)l(K,be,ne[be],1);return K},A.getMaxScaleOnAxis=function Oe(K){return Math.sqrt(Math.max(K[0]*K[0]+K[1]*K[1]+K[2]*K[2],K[4]*K[4]+K[5]*K[5]+K[6]*K[6],K[8]*K[8]+K[9]*K[9]+K[10]*K[10]))};const Se=[1,0,0],Ve=[0,1,0],Ne=[0,0,1];A.rotX90=k(y(),(0,r.pu)(90),Se),A.rotX180=k(y(),(0,r.pu)(180),Se),A.rotY90=k(y(),(0,r.pu)(90),Ve),A.rotY180=k(y(),(0,r.pu)(180),Ve),A.rotY270=k(y(),(0,r.pu)(270),Ve),A.rotZ90=k(y(),(0,r.pu)(90),Ne),A.rotZ180=k(y(),(0,r.pu)(180),Ne),A.rotXY90=T(y(),A.rotX90,A.rotY90),A.rotZY90=T(y(),A.rotZ90,A.rotY90),A.rotZYZ90=T(y(),A.rotZY90,A.rotZ90),A.rotZ90X180=T(y(),A.rotZ90,A.rotX180),A.rotY90Z180=T(y(),A.rotY90,A.rotZ180),A.id=c()}(t||(t={}))},5126:(tn,Ue,n)=>{"use strict";n.d(Ue,{k:()=>t});var e=n(2086),o=n(2028),r=n(1372);function t(){return t.zero()}!function(A){function y(){const j=[.1,0,0,0];return j[0]=0,j}function c(){const j=y();return j[3]=1,j}function b(j,Z,q){q*=.5;const Y=Math.sin(q);return j[0]=Y*Z[0],j[1]=Y*Z[1],j[2]=Y*Z[2],j[3]=Math.cos(q),j}function d(j,Z,q,Y){const ee=Z[0],g=Z[1],_e=Z[2],xe=Z[3];let Re,ke,we,Oe,Se,le=q[0],Ae=q[1],Be=q[2],Ce=q[3];return ke=ee*le+g*Ae+_e*Be+xe*Ce,ke<0&&(ke=-ke,le=-le,Ae=-Ae,Be=-Be,Ce=-Ce),1-ke>1e-6?(Re=Math.acos(ke),we=Math.sin(Re),Oe=Math.sin((1-Y)*Re)/we,Se=Math.sin(Y*Re)/we):(Oe=1-Y,Se=Y),j[0]=Oe*ee+Se*le,j[1]=Oe*g+Se*Ae,j[2]=Oe*_e+Se*Be,j[3]=Oe*xe+Se*Ce,j}function a(j,Z){const q=Z[0]+Z[4]+Z[8];let Y;if(q>0)Y=Math.sqrt(q+1),j[3]=.5*Y,Y=.5/Y,j[0]=(Z[5]-Z[7])*Y,j[1]=(Z[6]-Z[2])*Y,j[2]=(Z[1]-Z[3])*Y;else{let ee=0;Z[4]>Z[0]&&(ee=1),Z[8]>Z[3*ee+ee]&&(ee=2);const g=(ee+1)%3,_e=(ee+2)%3;Y=Math.sqrt(Z[3*ee+ee]-Z[3*g+g]-Z[3*_e+_e]+1),j[ee]=.5*Y,Y=.5/Y,j[3]=(Z[3*g+_e]-Z[3*_e+g])*Y,j[g]=(Z[3*g+ee]+Z[3*ee+g])*Y,j[_e]=(Z[3*_e+ee]+Z[3*ee+_e])*Y}return j}A.zero=y,A.identity=c,A.setIdentity=function i(j){j[0]=0,j[1]=0,j[2]=0,j[3]=1},A.hasNaN=function v(j){return isNaN(j[0])||isNaN(j[1])||isNaN(j[2])||isNaN(j[3])},A.create=function O(j,Z,q,Y){const ee=c();return ee[0]=j,ee[1]=Z,ee[2]=q,ee[3]=Y,ee},A.setAxisAngle=b,A.getAxisAngle=function _(j,Z){const q=2*Math.acos(Z[3]),Y=Math.sin(q/2);return 0!==Y?(j[0]=Z[0]/Y,j[1]=Z[1]/Y,j[2]=Z[2]/Y):(j[0]=1,j[1]=0,j[2]=0),q},A.multiply=function M(j,Z,q){const Y=Z[0],ee=Z[1],g=Z[2],_e=Z[3],xe=q[0],le=q[1],Ae=q[2],Be=q[3];return j[0]=Y*Be+_e*xe+ee*Ae-g*le,j[1]=ee*Be+_e*le+g*xe-Y*Ae,j[2]=g*Be+_e*Ae+Y*le-ee*xe,j[3]=_e*Be-Y*xe-ee*le-g*Ae,j},A.rotateX=function I(j,Z,q){q*=.5;const Y=Z[0],ee=Z[1],g=Z[2],_e=Z[3],xe=Math.sin(q),le=Math.cos(q);return j[0]=Y*le+_e*xe,j[1]=ee*le+g*xe,j[2]=g*le-ee*xe,j[3]=_e*le-Y*xe,j},A.rotateY=function l(j,Z,q){q*=.5;const Y=Z[0],ee=Z[1],g=Z[2],_e=Z[3],xe=Math.sin(q),le=Math.cos(q);return j[0]=Y*le-g*xe,j[1]=ee*le+_e*xe,j[2]=g*le+Y*xe,j[3]=_e*le-ee*xe,j},A.rotateZ=function m(j,Z,q){q*=.5;const Y=Z[0],ee=Z[1],g=Z[2],_e=Z[3],xe=Math.sin(q),le=Math.cos(q);return j[0]=Y*le+ee*xe,j[1]=ee*le-Y*xe,j[2]=g*le+_e*xe,j[3]=_e*le-g*xe,j},A.calculateW=function u(j,Z){const q=Z[0],Y=Z[1],ee=Z[2];return j[0]=q,j[1]=Y,j[2]=ee,j[3]=Math.sqrt(Math.abs(1-q*q-Y*Y-ee*ee)),j},A.slerp=d,A.invert=function s(j,Z){const q=Z[0],Y=Z[1],ee=Z[2],g=Z[3],_e=q*q+Y*Y+ee*ee+g*g,xe=_e?1/_e:0;return j[0]=-q*xe,j[1]=-Y*xe,j[2]=-ee*xe,j[3]=g*xe,j},A.conjugate=function C(j,Z){return j[0]=-Z[0],j[1]=-Z[1],j[2]=-Z[2],j[3]=Z[3],j},A.dot=function h(j,Z){return j[0]*Z[0]+j[1]*Z[1]+j[2]*Z[2]+j[3]*Z[3]},A.fromMat3=a,A.fromEuler=function S(j,Z,q){const[Y,ee,g]=Z,_e=Math.cos(Y/2),xe=Math.cos(ee/2),le=Math.cos(g/2),Ae=Math.sin(Y/2),Be=Math.sin(ee/2),Ce=Math.sin(g/2);switch(q){case"XYZ":j[0]=Ae*xe*le+_e*Be*Ce,j[1]=_e*Be*le-Ae*xe*Ce,j[2]=_e*xe*Ce+Ae*Be*le,j[3]=_e*xe*le-Ae*Be*Ce;break;case"YXZ":j[0]=Ae*xe*le+_e*Be*Ce,j[1]=_e*Be*le-Ae*xe*Ce,j[2]=_e*xe*Ce-Ae*Be*le,j[3]=_e*xe*le+Ae*Be*Ce;break;case"ZXY":j[0]=Ae*xe*le-_e*Be*Ce,j[1]=_e*Be*le+Ae*xe*Ce,j[2]=_e*xe*Ce+Ae*Be*le,j[3]=_e*xe*le-Ae*Be*Ce;break;case"ZYX":j[0]=Ae*xe*le-_e*Be*Ce,j[1]=_e*Be*le+Ae*xe*Ce,j[2]=_e*xe*Ce-Ae*Be*le,j[3]=_e*xe*le+Ae*Be*Ce;break;case"YZX":j[0]=Ae*xe*le+_e*Be*Ce,j[1]=_e*Be*le+Ae*xe*Ce,j[2]=_e*xe*Ce-Ae*Be*le,j[3]=_e*xe*le-Ae*Be*Ce;break;case"XZY":j[0]=Ae*xe*le-_e*Be*Ce,j[1]=_e*Be*le-Ae*xe*Ce,j[2]=_e*xe*Ce+Ae*Be*le,j[3]=_e*xe*le+Ae*Be*Ce;break;default:(0,r.dr)(q)}return j};const D=[0,0,0];function V(j,Z){const q=Z[0],Y=Z[1],ee=Z[2],g=Z[3];let _e=q*q+Y*Y+ee*ee+g*g;return _e>0&&(_e=1/Math.sqrt(_e),j[0]=q*_e,j[1]=Y*_e,j[2]=ee*_e,j[3]=g*_e),j}A.fromUnitVec3=function R(j,Z,q){let Y=e.e.dot(Z,q)+1;return Y<o.p?(Y=0,Math.abs(Z[0])>Math.abs(Z[2])?e.e.set(D,-Z[1],Z[0],0):e.e.set(D,0,-Z[2],Z[1])):e.e.cross(D,Z,q),j[0]=D[0],j[1]=D[1],j[2]=D[2],j[3]=Y,V(j,j),j},A.clone=function f(j){const Z=y();return Z[0]=j[0],Z[1]=j[1],Z[2]=j[2],Z[3]=j[3],Z},A.toArray=function p(j,Z,q){return Z[q+0]=j[0],Z[q+1]=j[1],Z[q+2]=j[2],Z[q+3]=j[3],Z},A.fromArray=function E(j,Z,q){return j[0]=Z[q+0],j[1]=Z[q+1],j[2]=Z[q+2],j[3]=Z[q+3],j},A.copy=function T(j,Z){return j[0]=Z[0],j[1]=Z[1],j[2]=Z[2],j[3]=Z[3],j},A.set=function L(j,Z,q,Y,ee){return j[0]=Z,j[1]=q,j[2]=Y,j[3]=ee,j},A.exactEquals=function w(j,Z){return j[0]===Z[0]&&j[1]===Z[1]&&j[2]===Z[2]&&j[3]===Z[3]},A.equals=function Q(j,Z){const q=j[0],Y=j[1],ee=j[2],g=j[3],_e=Z[0],xe=Z[1],le=Z[2],Ae=Z[3];return Math.abs(q-_e)<=o.p*Math.max(1,Math.abs(q),Math.abs(_e))&&Math.abs(Y-xe)<=o.p*Math.max(1,Math.abs(Y),Math.abs(xe))&&Math.abs(ee-le)<=o.p*Math.max(1,Math.abs(ee),Math.abs(le))&&Math.abs(g-Ae)<=o.p*Math.max(1,Math.abs(g),Math.abs(Ae))},A.add=function G(j,Z,q){return j[0]=Z[0]+q[0],j[1]=Z[1]+q[1],j[2]=Z[2]+q[2],j[3]=Z[3]+q[3],j},A.normalize=V;const U=[0,0,0],N=[1,0,0],k=[0,1,0];A.rotationTo=function H(j,Z,q){const Y=e.e.dot(Z,q);return Y<-.999999?(e.e.cross(U,N,Z),e.e.magnitude(U)<1e-6&&e.e.cross(U,k,Z),e.e.normalize(U,U),b(j,U,Math.PI),j):Y>.999999?(j[0]=0,j[1]=0,j[2]=0,j[3]=1,j):(e.e.cross(U,Z,q),j[0]=U[0],j[1]=U[1],j[2]=U[2],j[3]=1+Y,V(j,j))};const $=y(),J=y();A.sqlerp=function W(j,Z,q,Y,ee,g){return d($,Z,ee,g),d(J,q,Y,g),d(j,$,J,2*g*(1-g)),j};const te=[0,0,0,0,0,0,0,0,0];A.setAxes=function de(j,Z,q,Y){return te[0]=q[0],te[3]=q[1],te[6]=q[2],te[1]=Y[0],te[4]=Y[1],te[7]=Y[2],te[2]=-Z[0],te[5]=-Z[1],te[8]=-Z[2],V(j,a(j,te))},A.toString=function ye(j,Z){return`[${j[0].toPrecision(Z)} ${j[1].toPrecision(Z)} ${j[2].toPrecision(Z)}  ${j[3].toPrecision(Z)}]`},A.Identity=c()}(t||(t={}))},325:(tn,Ue,n)=>{"use strict";function e(){return e.zero()}n.d(Ue,{Z:()=>e}),function(o){function r(){const f=[.1,0];return f[0]=0,f}o.zero=r,o.clone=function t(f){const p=r();return p[0]=f[0],p[1]=f[1],p},o.create=function A(f,p){const E=r();return E[0]=f,E[1]=p,E},o.hasNaN=function y(f){return isNaN(f[0])||isNaN(f[1])},o.toArray=function c(f,p,E){return p[E+0]=f[0],p[E+1]=f[1],p},o.fromArray=function i(f,p,E){return f[0]=p[E+0],f[1]=p[E+1],f},o.copy=function v(f,p){return f[0]=p[0],f[1]=p[1],f},o.set=function O(f,p,E){return f[0]=p,f[1]=E,f},o.add=function b(f,p,E){return f[0]=p[0]+E[0],f[1]=p[1]+E[1],f},o.sub=function _(f,p,E){return f[0]=p[0]-E[0],f[1]=p[1]-E[1],f},o.mul=function M(f,p,E){return f[0]=p[0]*E[0],f[1]=p[1]*E[1],f},o.div=function I(f,p,E){return f[0]=p[0]/E[0],f[1]=p[1]/E[1],f},o.scale=function l(f,p,E){return f[0]=p[0]*E,f[1]=p[1]*E,f},o.round=function m(f,p){return f[0]=Math.round(p[0]),f[1]=Math.round(p[1]),f},o.ceil=function u(f,p){return f[0]=Math.ceil(p[0]),f[1]=Math.ceil(p[1]),f},o.floor=function d(f,p){return f[0]=Math.floor(p[0]),f[1]=Math.floor(p[1]),f},o.distance=function s(f,p){const E=p[0]-f[0],T=p[1]-f[1];return Math.sqrt(E*E+T*T)},o.squaredDistance=function C(f,p){const E=p[0]-f[0],T=p[1]-f[1];return E*E+T*T},o.magnitude=function h(f){const p=f[0],E=f[1];return Math.sqrt(p*p+E*E)},o.squaredMagnitude=function a(f){const p=f[0],E=f[1];return p*p+E*E},o.inverse=function S(f,p){return f[0]=1/p[0],f[1]=1/p[1],f},o.areEqual=function D(f,p){return f[0]===p[0]&&f[1]===p[1]},o.toString=function R(f,p){return`[${f[0].toPrecision(p)} ${f[1].toPrecision(p)}}]`}}(e||(e={}))},2086:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>A});var e=n(6639),o=n(127),r=n(2028);const t=isFinite;function A(){return A.zero()}!function(y){function c(){const Me=[.1,0,0];return Me[0]=0,Me}function m(Me,Ke,ut){const Kt=c();return Kt[0]=Me,Kt[1]=Ke,Kt[2]=ut,Kt}function s(Me,Ke){return Me[0]=Ke[0],Me[1]=Ke[1],Me[2]=Ke[2],Me}function C(Me,Ke,ut){return Me[0]=Ke[0]+ut[0],Me[1]=Ke[1]+ut[1],Me[2]=Ke[2]+ut[2],Me}function h(Me,Ke,ut){return Me[0]=Ke[0]-ut[0],Me[1]=Ke[1]-ut[1],Me[2]=Ke[2]-ut[2],Me}function D(Me,Ke,ut){return Me[0]=Ke[0]*ut,Me[1]=Ke[1]*ut,Me[2]=Ke[2]*ut,Me}function R(Me,Ke,ut,Kt){return Me[0]=Ke[0]+ut[0]*Kt,Me[1]=Ke[1]+ut[1]*Kt,Me[2]=Ke[2]+ut[2]*Kt,Me}function J(Me){const Ke=Me[0],ut=Me[1],Kt=Me[2];return Ke*Ke+ut*ut+Kt*Kt}function te(Me,Ke){return Me[0]=-Ke[0],Me[1]=-Ke[1],Me[2]=-Ke[2],Me}function ye(Me,Ke){const ut=Ke[0],Kt=Ke[1],sn=Ke[2];let gt=ut*ut+Kt*Kt+sn*sn;return gt>0&&(gt=1/Math.sqrt(gt),Me[0]=Ke[0]*gt,Me[1]=Ke[1]*gt,Me[2]=Ke[2]*gt),Me}function j(Me,Ke){return Me[0]*Ke[0]+Me[1]*Ke[1]+Me[2]*Ke[2]}function Z(Me,Ke,ut){const Kt=Ke[0],sn=Ke[1],gt=Ke[2],yt=ut[0],At=ut[1],Gt=ut[2];return Me[0]=sn*Gt-gt*At,Me[1]=gt*yt-Kt*Gt,Me[2]=Kt*At-sn*yt,Me}y.zero=c,y.clone=function i(Me){const Ke=c();return Ke[0]=Me[0],Ke[1]=Me[1],Ke[2]=Me[2],Ke},y.isFinite=function v(Me){return t(Me[0])&&t(Me[1])&&t(Me[2])},y.hasNaN=function O(Me){return isNaN(Me[0])||isNaN(Me[1])||isNaN(Me[2])},y.setNaN=function b(Me){return Me[0]=NaN,Me[1]=NaN,Me[2]=NaN,Me},y.fromObj=function _(Me){return m(Me.x,Me.y,Me.z)},y.toObj=function M(Me){return{x:Me[0],y:Me[1],z:Me[2]}},y.fromArray=function I(Me,Ke,ut){return Me[0]=Ke[ut+0],Me[1]=Ke[ut+1],Me[2]=Ke[ut+2],Me},y.toArray=function l(Me,Ke,ut){return Ke[ut+0]=Me[0],Ke[ut+1]=Me[1],Ke[ut+2]=Me[2],Ke},y.create=m,y.ofArray=function u(Me){const Ke=c();return Ke[0]=Me[0],Ke[1]=Me[1],Ke[2]=Me[2],Ke},y.set=function d(Me,Ke,ut,Kt){return Me[0]=Ke,Me[1]=ut,Me[2]=Kt,Me},y.copy=s,y.add=C,y.sub=h,y.mul=function a(Me,Ke,ut){return Me[0]=Ke[0]*ut[0],Me[1]=Ke[1]*ut[1],Me[2]=Ke[2]*ut[2],Me},y.div=function S(Me,Ke,ut){return Me[0]=Ke[0]/ut[0],Me[1]=Ke[1]/ut[1],Me[2]=Ke[2]/ut[2],Me},y.scale=D,y.scaleAndAdd=R,y.scaleAndSub=function f(Me,Ke,ut,Kt){return Me[0]=Ke[0]-ut[0]*Kt,Me[1]=Ke[1]-ut[1]*Kt,Me[2]=Ke[2]-ut[2]*Kt,Me},y.addScalar=function p(Me,Ke,ut){return Me[0]=Ke[0]+ut,Me[1]=Ke[1]+ut,Me[2]=Ke[2]+ut,Me},y.subScalar=function E(Me,Ke,ut){return Me[0]=Ke[0]-ut,Me[1]=Ke[1]-ut,Me[2]=Ke[2]-ut,Me},y.round=function T(Me,Ke){return Me[0]=Math.round(Ke[0]),Me[1]=Math.round(Ke[1]),Me[2]=Math.round(Ke[2]),Me},y.ceil=function L(Me,Ke){return Me[0]=Math.ceil(Ke[0]),Me[1]=Math.ceil(Ke[1]),Me[2]=Math.ceil(Ke[2]),Me},y.floor=function w(Me,Ke){return Me[0]=Math.floor(Ke[0]),Me[1]=Math.floor(Ke[1]),Me[2]=Math.floor(Ke[2]),Me},y.trunc=function Q(Me,Ke){return Me[0]=Math.trunc(Ke[0]),Me[1]=Math.trunc(Ke[1]),Me[2]=Math.trunc(Ke[2]),Me},y.abs=function G(Me,Ke){return Me[0]=Math.abs(Ke[0]),Me[1]=Math.abs(Ke[1]),Me[2]=Math.abs(Ke[2]),Me},y.min=function V(Me,Ke,ut){return Me[0]=Math.min(Ke[0],ut[0]),Me[1]=Math.min(Ke[1],ut[1]),Me[2]=Math.min(Ke[2],ut[2]),Me},y.max=function U(Me,Ke,ut){return Me[0]=Math.max(Ke[0],ut[0]),Me[1]=Math.max(Ke[1],ut[1]),Me[2]=Math.max(Ke[2],ut[2]),Me},y.clamp=function N(Me,Ke,ut,Kt){return Me[0]=Math.max(ut[0],Math.min(Kt[0],Ke[0])),Me[1]=Math.max(ut[1],Math.min(Kt[1],Ke[1])),Me[2]=Math.max(ut[2],Math.min(Kt[2],Ke[2])),Me},y.distance=function k(Me,Ke){const ut=Ke[0]-Me[0],Kt=Ke[1]-Me[1],sn=Ke[2]-Me[2];return Math.sqrt(ut*ut+Kt*Kt+sn*sn)},y.squaredDistance=function H(Me,Ke){const ut=Ke[0]-Me[0],Kt=Ke[1]-Me[1],sn=Ke[2]-Me[2];return ut*ut+Kt*Kt+sn*sn},y.magnitude=function $(Me){const Ke=Me[0],ut=Me[1],Kt=Me[2];return Math.sqrt(Ke*Ke+ut*ut+Kt*Kt)},y.squaredMagnitude=J,y.setMagnitude=function W(Me,Ke,ut){return D(Me,ye(Me,Ke),ut)},y.negate=te,y.inverse=function de(Me,Ke){return Me[0]=1/Ke[0],Me[1]=1/Ke[1],Me[2]=1/Ke[2],Me},y.normalize=ye,y.dot=j,y.cross=Z,y.lerp=function q(Me,Ke,ut,Kt){const sn=Ke[0],gt=Ke[1],yt=Ke[2];return Me[0]=sn+Kt*(ut[0]-sn),Me[1]=gt+Kt*(ut[1]-gt),Me[2]=yt+Kt*(ut[2]-yt),Me};const Y=c();function Se(Me,Ke){const ut=Math.sqrt(J(Me)*J(Ke));if(0===ut)return Math.PI/2;const Kt=j(Me,Ke)/ut;return Math.acos((0,o.qE)(Kt,-1,1))}y.slerp=function ee(Me,Ke,ut,Kt){const sn=(0,o.qE)(j(Ke,ut),-1,1),gt=Math.acos(sn)*Kt;return R(Y,ut,Ke,-sn),ye(Y,Y),C(Me,D(Me,Ke,Math.cos(gt)),D(Y,Y,Math.sin(gt)))},y.hermite=function g(Me,Ke,ut,Kt,sn,gt){const yt=gt*gt,At=yt*(2*gt-3)+1,Gt=yt*(gt-2)+gt,rn=yt*(gt-1),tt=yt*(3-2*gt);return Me[0]=Ke[0]*At+ut[0]*Gt+Kt[0]*rn+sn[0]*tt,Me[1]=Ke[1]*At+ut[1]*Gt+Kt[1]*rn+sn[1]*tt,Me[2]=Ke[2]*At+ut[2]*Gt+Kt[2]*rn+sn[2]*tt,Me},y.bezier=function _e(Me,Ke,ut,Kt,sn,gt){const yt=1-gt,At=yt*yt,Gt=gt*gt,rn=At*yt,tt=3*gt*At,Mt=3*Gt*yt,nn=Gt*gt;return Me[0]=Ke[0]*rn+ut[0]*tt+Kt[0]*Mt+sn[0]*nn,Me[1]=Ke[1]*rn+ut[1]*tt+Kt[1]*Mt+sn[1]*nn,Me[2]=Ke[2]*rn+ut[2]*tt+Kt[2]*Mt+sn[2]*nn,Me},y.quadraticBezier=function xe(Me,Ke,ut,Kt,sn){return Me[0]=(0,o.iD)(Ke[0],ut[0],Kt[0],sn),Me[1]=(0,o.iD)(Ke[1],ut[1],Kt[1],sn),Me[2]=(0,o.iD)(Ke[2],ut[2],Kt[2],sn),Me},y.spline=function le(Me,Ke,ut,Kt,sn,gt,yt){return Me[0]=(0,o.Y7)(Ke[0],ut[0],Kt[0],sn[0],gt,yt),Me[1]=(0,o.Y7)(Ke[1],ut[1],Kt[1],sn[1],gt,yt),Me[2]=(0,o.Y7)(Ke[2],ut[2],Kt[2],sn[2],gt,yt),Me},y.random=function Ae(Me,Ke){const ut=2*Math.random()*Math.PI,Kt=2*Math.random()-1,sn=Math.sqrt(1-Kt*Kt)*Ke;return Me[0]=Math.cos(ut)*sn,Me[1]=Math.sin(ut)*sn,Me[2]=Kt*Ke,Me},y.transformMat4=function Be(Me,Ke,ut){const Kt=Ke[0],sn=Ke[1],gt=Ke[2],yt=1/(ut[3]*Kt+ut[7]*sn+ut[11]*gt+ut[15]||1);return Me[0]=(ut[0]*Kt+ut[4]*sn+ut[8]*gt+ut[12])*yt,Me[1]=(ut[1]*Kt+ut[5]*sn+ut[9]*gt+ut[13])*yt,Me[2]=(ut[2]*Kt+ut[6]*sn+ut[10]*gt+ut[14])*yt,Me},y.transformDirection=function Ce(Me,Ke,ut){const Kt=Ke[0],sn=Ke[1],gt=Ke[2];return Me[0]=ut[0]*Kt+ut[4]*sn+ut[8]*gt,Me[1]=ut[1]*Kt+ut[5]*sn+ut[9]*gt,Me[2]=ut[2]*Kt+ut[6]*sn+ut[10]*gt,ye(Me,Me)},y.transformMat4Offset=function Re(Me,Ke,ut,Kt,sn,gt){const yt=Ke[0+sn],At=Ke[1+sn],Gt=Ke[2+sn],rn=1/(ut[3+gt]*yt+ut[7+gt]*At+ut[11+gt]*Gt+ut[15+gt]||1);return Me[0+Kt]=(ut[0+gt]*yt+ut[4+gt]*At+ut[8+gt]*Gt+ut[12+gt])*rn,Me[1+Kt]=(ut[1+gt]*yt+ut[5+gt]*At+ut[9+gt]*Gt+ut[13+gt])*rn,Me[2+Kt]=(ut[2+gt]*yt+ut[6+gt]*At+ut[10+gt]*Gt+ut[14+gt])*rn,Me},y.transformDirectionOffset=function ke(Me,Ke,ut,Kt,sn,gt){const yt=Ke[0+sn],At=Ke[1+sn],Gt=Ke[2+sn];Me[0+Kt]=ut[0+gt]*yt+ut[4+gt]*At+ut[8+gt]*Gt,Me[1+Kt]=ut[1+gt]*yt+ut[5+gt]*At+ut[9+gt]*Gt,Me[2+Kt]=ut[2+gt]*yt+ut[6+gt]*At+ut[10+gt]*Gt;const rn=Math.hypot(Me[0+Kt],Me[1+Kt],Me[2+Kt]);return rn>0&&(Me[0+Kt]/=rn,Me[1+Kt]/=rn,Me[2+Kt]/=rn),Me},y.transformMat3=function we(Me,Ke,ut){const Kt=Ke[0],sn=Ke[1],gt=Ke[2];return Me[0]=Kt*ut[0]+sn*ut[3]+gt*ut[6],Me[1]=Kt*ut[1]+sn*ut[4]+gt*ut[7],Me[2]=Kt*ut[2]+sn*ut[5]+gt*ut[8],Me},y.transformQuat=function Oe(Me,Ke,ut){const Kt=Ke[0],sn=Ke[1],gt=Ke[2],yt=ut[0],At=ut[1],Gt=ut[2],rn=ut[3],tt=rn*Kt+At*gt-Gt*sn,Mt=rn*sn+Gt*Kt-yt*gt,nn=rn*gt+yt*sn-At*Kt,bn=-yt*Kt-At*sn-Gt*gt;return Me[0]=tt*rn+bn*-yt+Mt*-Gt-nn*-At,Me[1]=Mt*rn+bn*-At+nn*-yt-tt*-Gt,Me[2]=nn*rn+bn*-Gt+tt*-At-Mt*-yt,Me},y.angle=Se;const Ve=c(),Ne=c(),K=c(),ne=c(),be=c(),Te=c(),ie=c();y.dihedralAngle=function ue(Me,Ke,ut,Kt){h(Ve,Me,Ke),h(Ne,ut,Ke),h(K,Ke,ut),h(ne,Kt,ut),Z(be,Ve,Ne),Z(Te,K,ne);const sn=Se(be,Te);return Z(ie,be,Te),j(Ne,ie)>0?sn:-sn},y.directionFromSpherical=function re(Me,Ke,ut,Kt){return y.set(Me,Kt*Math.cos(ut)*Math.sin(Ke),Kt*Math.sin(ut)*Math.sin(Ke),Kt*Math.cos(Ke))},y.exactEquals=function ve(Me,Ke){return Me[0]===Ke[0]&&Me[1]===Ke[1]&&Me[2]===Ke[2]},y.equals=function ce(Me,Ke){const ut=Me[0],Kt=Me[1],sn=Me[2],gt=Ke[0],yt=Ke[1],At=Ke[2];return Math.abs(ut-gt)<=r.p*Math.max(1,Math.abs(ut),Math.abs(gt))&&Math.abs(Kt-yt)<=r.p*Math.max(1,Math.abs(Kt),Math.abs(yt))&&Math.abs(sn-At)<=r.p*Math.max(1,Math.abs(sn),Math.abs(At))};const se=c();y.makeRotation=function ae(Me,Ke,ut){const Kt=Se(Ke,ut);if(Math.abs(Kt)<1e-4)return e.$.setIdentity(Me);if(Math.abs(Kt-Math.PI)<r.p)return e.$.fromScaling(Me,y.negUnit);const sn=Z(se,Ke,ut);return e.$.fromRotation(Me,Kt,sn)},y.isZero=function ge(Me){return 0===Me[0]&&0===Me[1]&&0===Me[2]},y.projectPointOnVector=function Ie(Me,Ke,ut,Kt){return h(Me,Ke,Kt),C(Me,D(Me,ut,j(ut,Me)/J(ut)),Kt)};const Le=c();function je(Me,Ke,ut){return D(Me,ut,j(ut,Ke)/J(ut))}y.projectPointOnPlane=function nt(Me,Ke,ut,Kt){return ye(Le,ut),h(Me,Ke,Kt),h(Me,Ke,D(Le,Le,j(Me,Le)))},y.projectOnVector=je;const Lt=c();y.projectOnPlane=function Je(Me,Ke,ut){return je(Lt,Ke,ut),h(Me,Ke,Lt)},y.orthogonalize=function en(Me,Ke,ut){return ye(Me,Z(Me,Z(Me,Ke,ut),Ke))},y.matchDirection=function Bt(Me,Ke,ut){return j(Ke,ut)>0?s(Me,Ke):te(Me,s(Me,Ke)),Me};const pn=c(),$e=c();y.triangleNormal=function mt(Me,Ke,ut,Kt){return h(pn,ut,Ke),h($e,Kt,Ke),ye(Me,Z(Me,pn,$e))},y.toString=function _t(Me,Ke){return`[${Me[0].toPrecision(Ke)} ${Me[1].toPrecision(Ke)} ${Me[2].toPrecision(Ke)}]`},y.origin=m(0,0,0),y.unit=m(1,1,1),y.negUnit=m(-1,-1,-1),y.unitX=m(1,0,0),y.unitY=m(0,1,0),y.unitZ=m(0,0,1),y.negUnitX=m(-1,0,0),y.negUnitY=m(0,-1,0),y.negUnitZ=m(0,0,-1)}(A||(A={}))},8599:(tn,Ue,n)=>{"use strict";n.d(Ue,{Z:()=>o});var e=n(2028);function o(){return o.zero()}!function(r){function t(){const w=[.1,0,0,0];return w[0]=0,w}function c(w,Q){return w[0]=Q.center[0],w[1]=Q.center[1],w[2]=Q.center[2],w[3]=Q.radius,w}r.zero=t,r.clone=function A(w){const Q=t();return Q[0]=w[0],Q[1]=w[1],Q[2]=w[2],Q[3]=w[3],Q},r.create=function y(w,Q,G,V){const U=t();return U[0]=w,U[1]=Q,U[2]=G,U[3]=V,U},r.fromSphere=c,r.ofSphere=function i(w){return c(t(),w)},r.hasNaN=function v(w){return isNaN(w[0])||isNaN(w[1])||isNaN(w[2])||isNaN(w[3])},r.toArray=function O(w,Q,G){return Q[G+0]=w[0],Q[G+1]=w[1],Q[G+2]=w[2],Q[G+3]=w[3],Q},r.fromArray=function b(w,Q,G){return w[0]=Q[G+0],w[1]=Q[G+1],w[2]=Q[G+2],w[3]=Q[G+3],w},r.toVec3Array=function _(w,Q,G){Q[G+0]=w[0],Q[G+1]=w[1],Q[G+2]=w[2]},r.fromVec3Array=function M(w,Q,G){return w[0]=Q[G+0],w[1]=Q[G+1],w[2]=Q[G+2],w[3]=0,w},r.copy=function I(w,Q){return w[0]=Q[0],w[1]=Q[1],w[2]=Q[2],w[3]=Q[3],w},r.set=function l(w,Q,G,V,U){return w[0]=Q,w[1]=G,w[2]=V,w[3]=U,w},r.add=function m(w,Q,G){return w[0]=Q[0]+G[0],w[1]=Q[1]+G[1],w[2]=Q[2]+G[2],w[3]=Q[3]+G[3],w},r.distance=function u(w,Q){const G=Q[0]-w[0],V=Q[1]-w[1],U=Q[2]-w[2],N=Q[3]-w[3];return Math.sqrt(G*G+V*V+U*U+N*N)},r.scale=function d(w,Q,G){return w[0]=Q[0]*G,w[1]=Q[1]*G,w[2]=Q[2]*G,w[4]=Q[4]*G,w},r.round=function s(w,Q){return w[0]=Math.round(Q[0]),w[1]=Math.round(Q[1]),w[2]=Math.round(Q[2]),w[3]=Math.round(Q[3]),w},r.ceil=function C(w,Q){return w[0]=Math.ceil(Q[0]),w[1]=Math.ceil(Q[1]),w[2]=Math.ceil(Q[2]),w[3]=Math.ceil(Q[3]),w},r.floor=function h(w,Q){return w[0]=Math.floor(Q[0]),w[1]=Math.floor(Q[1]),w[2]=Math.floor(Q[2]),w[3]=Math.floor(Q[3]),w},r.squaredDistance=function a(w,Q){const G=Q[0]-w[0],V=Q[1]-w[1],U=Q[2]-w[2],N=Q[3]-w[3];return G*G+V*V+U*U+N*N},r.norm=function S(w){const Q=w[0],G=w[1],V=w[2],U=w[3];return Math.sqrt(Q*Q+G*G+V*V+U*U)},r.squaredNorm=function D(w){const Q=w[0],G=w[1],V=w[2],U=w[3];return Q*Q+G*G+V*V+U*U},r.transformMat4=function R(w,Q,G){const V=Q[0],U=Q[1],N=Q[2],k=Q[3];return w[0]=G[0]*V+G[4]*U+G[8]*N+G[12]*k,w[1]=G[1]*V+G[5]*U+G[9]*N+G[13]*k,w[2]=G[2]*V+G[6]*U+G[10]*N+G[14]*k,w[3]=G[3]*V+G[7]*U+G[11]*N+G[15]*k,w},r.dot=function f(w,Q){return w[0]*Q[0]+w[1]*Q[1]+w[2]*Q[2]+w[3]*Q[3]},r.inverse=function p(w,Q){return w[0]=1/Q[0],w[1]=1/Q[1],w[2]=1/Q[2],w[3]=1/Q[3],w},r.exactEquals=function E(w,Q){return w[0]===Q[0]&&w[1]===Q[1]&&w[2]===Q[2]&&w[3]===Q[3]},r.equals=function T(w,Q){const G=w[0],V=w[1],U=w[2],N=w[3],k=Q[0],H=Q[1],$=Q[2],J=Q[3];return Math.abs(G-k)<=e.p*Math.max(1,Math.abs(G),Math.abs(k))&&Math.abs(V-H)<=e.p*Math.max(1,Math.abs(V),Math.abs(H))&&Math.abs(U-$)<=e.p*Math.max(1,Math.abs(U),Math.abs($))&&Math.abs(N-J)<=e.p*Math.max(1,Math.abs(N),Math.abs(J))},r.toString=function L(w,Q){return`[${w[0].toPrecision(Q)} ${w[1].toPrecision(Q)} ${w[2].toPrecision(Q)}  ${w[3].toPrecision(Q)}]`}}(o||(o={}))},1778:(tn,Ue,n)=>{"use strict";var e,o;n.d(Ue,{u:()=>e}),(o=e||(e={})).create=function r(I,l,m=Float32Array){const u=I*l;return{data:new m(u),size:u,cols:I,rows:l}},o.get=function t(I,l,m){return I.data[I.rows*m+l]},o.set=function A(I,l,m,u){return I.data[I.rows*m+l]=u,I},o.add=function y(I,l,m,u){return I.data[I.rows*m+l]+=u,I},o.makeZero=function c(I){return I.data.fill(0),I},o.clone=function i(I){return{data:I.data.slice(),size:I.size,cols:I.cols,rows:I.rows}},o.fromArray=function v(I,l,m){return{data:I,size:l*m,cols:l,rows:m}},o.transpose=function O(I,l){if(I.cols!==l.rows||I.rows!==l.cols)throw new Error("transpose: matrix dimensions incompatible");if(I.data===l.data)throw new Error("transpose: matrices share memory");const m=l.rows,u=l.cols,d=l.data,s=I.data;for(let C=0,h=0,a=0;C<m;a+=1,h+=u,++C){let S=a;for(let D=0;D<u;S+=m,D++)s[S]=d[h+D]}return I},o.multiplyABt=function b(I,l,m){const u=l.cols,d=l.rows,s=m.rows,C=l.data,h=m.data,a=I.data;for(let S=0,D=0,R=0;S<d;D+=u,S++)for(let f=0,p=0;p<s;R++,p++){let E=0,T=D;for(let L=0;L<u;T++,f++,L++)E+=C[T]*h[f];a[R]=E}return I},o.meanRows=function _(I){const l=I.rows,m=I.cols,u=I.data,d=new Array(m);for(let s=0;s<m;++s)d[s]=0;for(let s=0,C=0;s<l;++s)for(let h=0;h<m;++h,++C)d[h]+=u[C];for(let s=0;s<m;++s)d[s]/=l;return d},o.subRows=function M(I,l){const m=I.rows,u=I.cols,d=I.data;for(let s=0,C=0;s<m;++s)for(let h=0;h<u;++h,++C)d[C]-=l[h];return I}},8199:(tn,Ue,n)=>{"use strict";n.d(Ue,{c:()=>b});var e=n(1778),o=n(2086);function r(_,M,I,l){l=_[M],_[M]=_[I],_[I]=l}function t(_,M){return(_=Math.abs(_))>(M=Math.abs(M))?(M/=_,_*Math.sqrt(1+M*M)):M>0?(_/=M,M*Math.sqrt(1+_*_)):0}var b,v=n(5384),O=n(2028);!function(_){function I(d){if(3===d.length)return v.n.create(o.e.fromArray((0,o.e)(),d,0),o.e.create(1,0,0),o.e.create(0,1,0),o.e.create(0,0,1));const s=e.u.fromArray(d,3,d.length/3),C=s.rows,h=C/3,a=e.u.create(3,3),S=e.u.create(1,3),D=e.u.create(3,3),R=e.u.create(3,3),f=e.u.meanRows(s),p=e.u.subRows(e.u.clone(s),f),E=e.u.transpose(e.u.create(C,3),p);e.u.multiplyABt(a,E,E),function i(_,M,I,l){let m=0,u=0;const d=_.rows,s=_.cols;let C=d,h=s;C<h&&(m=1,u=C,C=h,h=u);const a=e.u.create(C,C),S=e.u.create(1,h),D=e.u.create(h,h);if(0===m)e.u.transpose(a,_);else{for(u=0;u<s*d;u++)a.data[u]=_.data[u];for(;u<h*C;u++)a.data[u]=0}if(function c(_,M,I,l,m,u,d,s){let a=0,S=0,D=0,R=0;const f=Math.max(u,30);let p=0,E=0,T=0,L=0,w=0,Q=0,G=0,V=0,U=0,N=0,k=0,H=0,$=0,J=0,W=0,te=0,de=0,ye=4660,j=0,Z=0,q=0;const Y=new Float64Array(d<<3);for(;a<d;a++){for(D=0,k=0;D<u;D++)V=_[a*M+D],k+=V*V;if(Y[a]=k,l){for(D=0;D<d;D++)l[a*m+D]=0;l[a*m+a]=1}}for(;R<f;R++){for(w=0,a=0;a<d-1;a++)for(S=a+1;S<d;S++){for(p=a*M|0,E=S*M|0,W=Y[a],te=0,de=Y[S],D=2,te+=_[p]*_[E],te+=_[p+1]*_[E+1];D<u;D++)te+=_[p+D]*_[E+D];if(!(Math.abs(te)<=2.384185792e-7*Math.sqrt(W*de))){for(te*=2,H=W-de,$=t(te,H),H<0?(J=.5*($-H),G=Math.sqrt(J/$),Q=te/($*G*2)):(Q=Math.sqrt(($+H)/(2*$)),G=te/($*Q*2)),W=0,de=0,D=2,U=Q*_[p]+G*_[E],N=-G*_[p]+Q*_[E],_[p]=U,_[E]=N,W+=U*U,de+=N*N,U=Q*_[p+1]+G*_[E+1],N=-G*_[p+1]+Q*_[E+1],_[p+1]=U,_[E+1]=N,W+=U*U,de+=N*N;D<u;D++)U=Q*_[p+D]+G*_[E+D],N=-G*_[p+D]+Q*_[E+D],_[p+D]=U,_[E+D]=N,W+=U*U,de+=N*N;if(Y[a]=W,Y[S]=de,w=1,l)for(T=a*m|0,L=S*m|0,D=2,U=Q*l[T]+G*l[L],N=-G*l[T]+Q*l[L],l[T]=U,l[L]=N,U=Q*l[T+1]+G*l[L+1],N=-G*l[T+1]+Q*l[L+1],l[T+1]=U,l[L+1]=N;D<d;D++)U=Q*l[T+D]+G*l[L+D],N=-G*l[T+D]+Q*l[L+D],l[T+D]=U,l[L+D]=N}}if(0===w)break}for(a=0;a<d;a++){for(D=0,k=0;D<u;D++)V=_[a*M+D],k+=V*V;Y[a]=Math.sqrt(k)}for(a=0;a<d-1;a++){for(S=a,D=a+1;D<d;D++)Y[S]<Y[D]&&(S=D);if(a!==S&&(r(Y,a,S,k),l)){for(D=0;D<u;D++)r(_,a*M+D,S*M+D,V);for(D=0;D<d;D++)r(l,a*m+D,S*m+D,V)}}for(a=0;a<d;a++)I[a]=Y[a];if(l)for(a=0;a<s;a++){for(k=a<d?Y[a]:0;k<=1e-37;){for(Z=1/u,D=0;D<u;D++)ye=214013*ye+2531011,j=256&ye>>16?Z:-Z,_[a*M+D]=j;for(R=0;R<2;R++)for(S=0;S<a;S++){for(k=0,D=0;D<u;D++)k+=_[a*M+D]*_[S*M+D];for(q=0,D=0;D<u;D++)V=_[a*M+D]-k*_[S*M+D],_[a*M+D]=V,q+=Math.abs(V);for(q=q?1/q:0,D=0;D<u;D++)_[a*M+D]*=q}for(k=0,D=0;D<u;D++)V=_[a*M+D],k+=V*V;k=Math.sqrt(k)}for(G=1/k,D=0;D<u;D++)_[a*M+D]*=G}}(a.data,C,S.data,D.data,h,C,h,C),M){for(u=0;u<h;u++)M.data[u]=S.data[u];for(;u<s;u++)M.data[u]=0}0===m?(I&&e.u.transpose(I,a),l&&e.u.transpose(l,D)):(I&&e.u.transpose(I,D),l&&e.u.transpose(l,a))}(a,S,D,R);const T=o.e.create(f[0],f[1],f[2]),L=o.e.create(D.data[0],D.data[3],D.data[6]),w=o.e.create(D.data[1],D.data[4],D.data[7]),Q=o.e.create(D.data[2],D.data[5],D.data[8]);return o.e.scale(L,L,Math.sqrt(S.data[0]/h)),o.e.scale(w,w,Math.sqrt(S.data[1]/h)),o.e.scale(Q,Q,Math.sqrt(S.data[2]/h)),v.n.create(T,L,w,Q)}function l(d){const s=v.n.clone(d);return o.e.magnitude(s.dirC)<O.p&&o.e.cross(s.dirC,s.dirA,s.dirB),v.n.normalize(s,s)}_.ofPositions=function M(d){const s=I(d);return{momentsAxes:s,boxAxes:u(d,s)}},_.calculateMomentsAxes=I,_.calculateNormalizedAxes=l;const m=(0,o.e)();function u(d,s){if(3===d.length)return v.n.clone(s);let C=-1/0,h=-1/0,a=-1/0,S=-1/0,D=-1/0,R=-1/0;const f=(0,o.e)(),p=(0,o.e)(),E=s.origin,T=l(s);for(let H=0,$=d.length;H<$;H+=3){o.e.projectPointOnVector(f,o.e.fromArray(f,d,H),T.dirA,E);const J=o.e.dot(T.dirA,o.e.normalize(p,o.e.sub(p,f,E))),W=o.e.distance(f,E);J>0?W>C&&(C=W):W>h&&(h=W),o.e.projectPointOnVector(f,o.e.fromArray(f,d,H),T.dirB,E);const te=o.e.dot(T.dirB,o.e.normalize(p,o.e.sub(p,f,E))),de=o.e.distance(f,E);te>0?de>a&&(a=de):de>S&&(S=de),o.e.projectPointOnVector(f,o.e.fromArray(f,d,H),T.dirC,E);const ye=o.e.dot(T.dirC,o.e.normalize(p,o.e.sub(p,f,E))),j=o.e.distance(f,E);ye>0?j>D&&(D=j):j>R&&(R=j)}const L=o.e.setMagnitude((0,o.e)(),T.dirA,(C+h)/2),w=o.e.setMagnitude((0,o.e)(),T.dirB,(a+S)/2),Q=o.e.setMagnitude((0,o.e)(),T.dirC,(D+R)/2),G=o.e.isFinite(L),V=o.e.isFinite(w),U=o.e.isFinite(Q),N=(0,o.e)(),k=function(H,$,J){o.e.copy(m,E),G&&o.e.scaleAndAdd(m,m,T.dirA,H),V&&o.e.scaleAndAdd(m,m,T.dirB,$),U&&o.e.scaleAndAdd(m,m,T.dirC,J),o.e.add(N,N,m)};return k(C,a,D),k(C,a,-R),k(C,-S,-R),k(C,-S,D),k(-h,-S,-R),k(-h,-S,D),k(-h,a,D),k(-h,a,-R),o.e.scale(N,N,1/8),v.n.create(N,L,w,Q)}_.calculateBoxAxes=u}(b||(b={}))},4490:(tn,Ue,n)=>{"use strict";n.d(Ue,{H:()=>t,N7:()=>c,TY:()=>y,fC:()=>e,k4:()=>i,pu:()=>r,r6:()=>A});const e=Math.PI/2,o=Math.PI/180;function r(v){return v*o}function t(v){return v/o}function A(v){return 0!==v&&!(v&v-1)}function y(...v){let O=0,b=0;for(let _=0,M=v.length;_<M;++_){const I=v[_],l=Math.abs(I);l>b&&(O=I,b=l)}return O}function c(v,O){return v*O}function i(v){let O=0,b=0;const _=[0,-1],M=2*v+1,I=M/2,l=[];for(let m=Math.pow(M,2);m>0;--m)-I<O&&O<=I&&-I<b&&b<=I&&l.push([O,b]),(O===b||O<0&&O===-b||O>0&&O===1-b)&&([_[0],_[1]]=[-_[1],_[0]]),O+=_[0],b+=_[1];return l}},2921:(tn,Ue,n)=>{"use strict";n.d(Ue,{X:()=>ae});var e=n(467),o=n(6651),r=n(3559),t=n(4632),A=n(1692),y=n(3543),c=n(7754),i=n(5384),v=n(4369),O=n(1490),b=n(2008),_=n(2434),M=n(2789),I=n(2629),m=n(6724),u=n(8382);function d($e,mt){return mt?1===mt.length?(0,u.m1)(mt.charCodeAt(0),$e):2===mt.length?(0,u.m1)(mt.charCodeAt(0),(0,u.m1)(mt.charCodeAt(1),$e)):`${$e} ${mt}`:$e}function s($e,mt,_t,Me){if($e.has(mt)){const Ke=$e.get(mt);Ke.has(_t)||Ke.set(_t,Me)}else{const Ke=new Map;$e.set(mt,Ke),Ke.set(_t,Me)}}function C($e){throw new Error(`Missing entity entry for entity id '${$e}'.`)}const a=m.or.EmptyResidueKey();class S{getEntityFromChain(mt){return this.map.chain_index_entity_index[mt]}findEntity(mt){const _t=this.map.label_asym_id.get(mt);return void 0!==_t?_t:-1}findChainLabel(mt){const _t=this.entityIndex(mt.label_entity_id);if(_t<0||!this.map.entity_index_label_asym_id.has(_t))return-1;const Me=this.map.entity_index_label_asym_id.get(_t);return Me&&Me.has(mt.label_asym_id)?Me.get(mt.label_asym_id):-1}findChainAuth(mt){if(!this.map.auth_asym_id_auth_seq_id.has(mt.auth_asym_id))return-1;const _t=this.map.auth_asym_id_auth_seq_id.get(mt.auth_asym_id);return _t.has(mt.auth_seq_id)?_t.get(mt.auth_seq_id):-1}findResidue(mt,_t,Me,Ke){let ut;1===arguments.length?ut=mt:(a.label_entity_id=mt,a.label_asym_id=_t,a.auth_seq_id=Me,a.pdbx_PDB_ins_code=Ke,ut=a);const Kt=this.findChainLabel(ut);if(Kt<0)return-1;const sn=this.map.chain_index_auth_seq_id.get(Kt),gt=d(ut.auth_seq_id,ut.pdbx_PDB_ins_code||"");return sn.has(gt)?sn.get(gt):-1}findResidueLabel(mt){const _t=this.findChainLabel(mt);if(_t<0)return-1;const Me=this.map.chain_index_label_seq_id.get(_t),Ke=d(mt.label_seq_id,mt.pdbx_PDB_ins_code||"");return Me.has(Ke)?Me.get(Ke):-1}findResidueAuth(mt){const _t=this.findChainAuth(mt);if(_t<0)return-1;const Me=this.map.chain_index_auth_seq_id.get(_t),Ke=d(mt.auth_seq_id,mt.pdbx_PDB_ins_code||"");return Me.has(Ke)?Me.get(Ke):-1}findResidueInsertion(mt){const _t=this.findChainLabel(mt);if(_t<0)return-1;const Me=this.map.chain_index_label_seq_id.get(_t),Ke=d(mt.label_seq_id,mt.pdbx_PDB_ins_code||"");if(Me.has(Ke))return Me.get(Ke);const ut=y.SortedArray.findPredecessorIndex(this.map.label_seq_id,mt.label_seq_id),Kt=m.vE.chainStartResidueIndex(this.map.segments,_t);if(ut<Kt)return Kt;const sn=m.vE.chainEndResidueIndexExcl(this.map.segments,_t)-1;return ut>=sn?sn:ut}findAtom(mt){const _t=this.findResidue(mt);return _t<0?-1:typeof mt.label_alt_id>"u"?D(this.residueOffsets[_t],this.residueOffsets[_t+1],this.map.label_atom_id,mt.label_atom_id):f(this.residueOffsets[_t],this.residueOffsets[_t+1],this.map.label_atom_id,this.map.label_alt_id,mt.label_atom_id,mt.label_alt_id)}findAtomAuth(mt){const _t=this.findResidueAuth(mt);return _t<0?-1:typeof mt.label_alt_id>"u"?D(this.residueOffsets[_t],this.residueOffsets[_t+1],this.map.auth_atom_id,mt.auth_atom_id):f(this.residueOffsets[_t],this.residueOffsets[_t+1],this.map.auth_atom_id,this.map.label_alt_id,mt.auth_atom_id,mt.label_alt_id)}findAtomOnResidue(mt,_t,Me){return typeof Me>"u"?D(this.residueOffsets[mt],this.residueOffsets[mt+1],this.map.label_atom_id,_t):f(this.residueOffsets[mt],this.residueOffsets[mt+1],this.map.label_atom_id,this.map.label_alt_id,_t,Me)}findAtomsOnResidue(mt,_t){return function R($e,mt,_t,Me){for(let Ke=$e;Ke<mt;Ke++)if(Me.has(_t.value(Ke)))return Ke;return-1}(this.residueOffsets[mt],this.residueOffsets[mt+1],this.map.label_atom_id,_t)}findElementOnResidue(mt,_t){return function p($e,mt,_t,Me){for(let Ke=$e;Ke<mt;Ke++)if(_t.value(Ke)===Me)return Ke;return-1}(this.residueOffsets[mt],this.residueOffsets[mt+1],this.map.type_symbol,_t)}constructor(mt){this.map=mt,this.entityIndex=mt.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}}function D($e,mt,_t,Me){for(let Ke=$e;Ke<mt;Ke++)if(_t.value(Ke)===Me)return Ke;return-1}function f($e,mt,_t,Me,Ke,ut){for(let Kt=$e;Kt<mt;Kt++)if(_t.value(Kt)===Ke&&Me.value(Kt)===ut)return Kt;return-1}var T=n(2524);function U($e,mt,_t,Me,Ke,ut){const Kt=function L($e){if(0===$e._rowCount)return{residues:[],chains:[]};const _t=$e._rowCount,Me=[0],Ke=[0],{label_entity_id:ut,label_asym_id:Kt,label_seq_id:sn,auth_seq_id:gt,pdbx_PDB_ins_code:yt}=$e;for(let At=1;At<_t;At++){const Gt=!ut.areValuesEqual(At-1,At)||!Kt.areValuesEqual(At-1,At);(Gt||!sn.areValuesEqual(At-1,At)||!gt.areValuesEqual(At-1,At)||!yt.areValuesEqual(At-1,At))&&(Me[Me.length]=At),Gt&&(Ke[Ke.length]=At)}return{residues:Me,chains:Ke}}($e),sn=function w($e,mt,_t){const Me=o.XI.ofColumns(b.wi,{type_symbol:o.VP.ofArray({array:o.VP.mapToArray($e.type_symbol,_.F1),schema:o.VP.Schema.Aliased(o.VP.Schema.str)}),label_atom_id:$e.label_atom_id,auth_atom_id:$e.auth_atom_id,label_alt_id:$e.label_alt_id,label_comp_id:$e.label_comp_id,auth_comp_id:$e.auth_comp_id,pdbx_formal_charge:$e.pdbx_formal_charge}),Ke=o.XI.view($e,b.yA,_t.residues),ut=o.XI.view($e,b.c1,_t.chains);if(!Ke.label_seq_id.isDefined){const Kt=new Int32Array(Ke.label_seq_id.rowCount),{residues:sn,chains:gt}=_t;let yt=0,At=0;for(let Gt=0,rn=Kt.length;Gt<rn;++Gt)sn[Gt]>=gt[yt+1]&&(yt+=1,At=0),Kt[Gt]=++At;Ke.label_seq_id=o.VP.ofIntArray(Kt)}return o.XI.columnToArray(Ke,"label_seq_id",Int32Array),o.XI.columnToArray(Ke,"auth_seq_id",Int32Array),{atoms:Me,residues:Ke,chains:ut,atomSourceIndex:mt}}($e,mt,Kt),gt=function V($e,mt){const _t=new Map;if(!T.K4.is(mt))return _t;const{molstar_atom_site_operator_mapping:Me}=(0,c.Pd)(O.mQ,mt.data.frame);if(0===Me._rowCount)return _t;const Ke=new Map,ut=new Map;for(let At=0;At<Me._rowCount;At++){const Gt=0===Me.assembly_operator_id.valueKind(At)?{id:Me.assembly_id.value(At),operList:[],operId:Me.assembly_operator_id.value(At)}:void 0,rn=i.JX.create(Me.operator_name.value(At),v.$I.identity(),{assembly:Gt,spgrOp:0===Me.symmetry_operator_index.valueKind(At)?Me.symmetry_operator_index.value(At):void 0,hkl:v.eB.ofArray(Me.symmetry_hkl.value(At)),ncsId:Me.ncs_id.value(At)}),tt=Me.suffix.value(At),Mt=Me.label_asym_id.value(At);Ke.set(`${Mt}${tt}`,{name:Mt,operator:rn});const nn=Me.auth_asym_id.value(At);ut.set(`${nn}${tt}`,nn)}const{label_asym_id:Kt,auth_asym_id:sn}=$e.chains,gt=new Array(Kt.rowCount),yt=new Array(Kt.rowCount);for(let At=0;At<Kt.rowCount;At++){const Gt=Kt.value(At),rn=sn.value(At);if(!Ke.has(Gt)){gt[At]=Gt,yt[At]=rn;continue}const{name:tt,operator:Mt}=Ke.get(Gt);_t.set(At,Mt),gt[At]=tt,yt[At]=ut.get(rn)||rn}return $e.chains.label_asym_id=o.VP.ofArray({array:gt,valueKind:$e.chains.label_asym_id.valueKind,schema:$e.chains.label_asym_id.schema}),$e.chains.auth_asym_id=o.VP.ofArray({array:yt,valueKind:$e.chains.auth_asym_id.valueKind,schema:$e.chains.auth_asym_id.schema}),_t}(sn,Ke);if(ut&&function G($e,mt){return o.XI.areEqual($e.chains,mt.chains)&&o.XI.areEqual($e.residues,mt.residues)&&o.XI.areEqual($e.atoms,mt.atoms)}(ut.atomicHierarchy,sn))return{sameAsPrevious:!0,hierarchy:ut.atomicHierarchy,chainOperatorMapping:gt};const yt={residueAtomSegments:y.hT.ofOffsets(Kt.residues,y.IX.ofBounds(0,$e._rowCount)),chainAtomSegments:y.hT.ofOffsets(Kt.chains,y.IX.ofBounds(0,$e._rowCount))},At=function E($e,mt,_t){const Me=function h($e,mt,_t){return{entities:$e,segments:_t,label_seq_id:y.SortedArray.ofSortedArray(mt.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:mt.atoms.label_atom_id,auth_atom_id:mt.atoms.auth_atom_id,label_alt_id:mt.atoms.label_alt_id,type_symbol:mt.atoms.type_symbol,chain_index_entity_index:new Int32Array(mt.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}(mt,$e,_t),{label_seq_id:Ke,auth_seq_id:ut,pdbx_PDB_ins_code:Kt}=$e.residues,{label_entity_id:sn,label_asym_id:gt,auth_asym_id:yt}=$e.chains,At=y.IX.ofBounds(0,$e.atoms._rowCount),Gt=y.hT.transientSegments(_t.chainAtomSegments,At);for(;Gt.hasNext;){const rn=Gt.move(),tt=rn.index,Mt=mt.getEntityIndex(sn.value(tt));Mt<0&&C(sn.value(tt)),Me.chain_index_entity_index[tt]=Mt;const nn=yt.value(tt);let bn=Me.auth_asym_id_auth_seq_id.get(nn);bn||(bn=new Map,Me.auth_asym_id_auth_seq_id.set(nn,bn));const Dn=gt.value(tt);Me.label_asym_id.has(Dn)||Me.label_asym_id.set(Dn,Mt),s(Me.entity_index_label_asym_id,Mt,Dn,tt);const jt=new Map,It=new Map;Me.chain_index_label_seq_id.set(tt,jt),Me.chain_index_auth_seq_id.set(tt,It);const Dt=y.hT.transientSegments(_t.residueAtomSegments,At,rn);for(;Dt.hasNext;){const $t=Dt.move().index,Vt=ut.value($t),Wt=Kt.value($t);jt.set(d(Ke.value($t),Wt),$t),It.set(d(Vt,Wt),$t),bn.set(Vt,tt)}}return new S(Me)}(sn,_t,yt),Gt=function l($e,mt,_t,Me){const{label_comp_id:Ke,type_symbol:ut,_rowCount:Kt}=$e.atoms,{_rowCount:sn}=$e.residues,{offsets:gt}=mt.residueAtomSegments,yt=new Uint8Array(Kt);for(let Dn=0;Dn<Kt;++Dn)yt[Dn]=(0,b.PR)(ut.value(Dn));const At=new Int32Array(sn),Gt=new Int32Array(sn),rn=new Int32Array(sn),tt=new Uint8Array(sn),Mt=new Uint8Array(sn),nn=new Map,bn=new Map;for(let Dn=0;Dn<sn;++Dn){const jt=Ke.value(gt[Dn]),It=Me;let Dt,Ct;if(nn.has(jt))Dt=nn.get(jt),Ct=bn.get(jt);else{let Zt;It.has(jt)?Zt=It.get(jt).type:(I.Zq||console.info("chemComp not found",jt),Zt=(0,_.ut)(jt)),Dt=(0,_.RN)(Zt,jt),Ct=(0,_.nO)(Zt,Dt),nn.set(jt,Dt),bn.set(jt,Ct)}tt[Dn]=Dt,Mt[Dn]=Ct;const $t=(0,M.HQ)(Ct,"trace");let Vt=_t.findAtomsOnResidue(Dn,$t);if(-1===Vt){const Zt=(0,M.HQ)(Ct,"coarseBackbone");Vt=_t.findAtomsOnResidue(Dn,Zt),-1===Vt&&(0,_.z7)(Dt)&&(Vt=_t.findElementOnResidue(Dn,(0,_.F1)("C")))}At[Dn]=Vt;const Wt=(0,M.HQ)(Ct,"directionFrom");Gt[Dn]=_t.findAtomsOnResidue(Dn,Wt);const yn=(0,M.HQ)(Ct,"directionTo");rn[Dn]=_t.findAtomsOnResidue(Dn,yn)}return{atom:{atomicNumber:yt},residue:{traceElementIndex:At,directionFromElementIndex:Gt,directionToElementIndex:rn,moleculeType:tt,polymerType:Mt}}}(sn,yt,At,Me);return{sameAsPrevious:!1,hierarchy:{...sn,...yt,index:At,derived:Gt},chainOperatorMapping:gt}}function N($e,mt,_t,Me,Ke,ut){const{sameAsPrevious:Kt,hierarchy:sn,chainOperatorMapping:gt}=U($e,mt,_t,Me,Ke,ut),yt=function Q($e){return{id:r.k.create22(),atomId:$e.id,occupancy:$e.occupancy.isDefined?$e.occupancy:o.VP.ofConst(1,$e._rowCount,o.VP.Schema.float),B_iso_or_equiv:$e.B_iso_or_equiv,xyzDefined:$e.Cartn_x.isDefined&&$e.Cartn_y.isDefined&&$e.Cartn_z.isDefined,x:$e.Cartn_x.toArray({array:Float32Array}),y:$e.Cartn_y.toArray({array:Float32Array}),z:$e.Cartn_z.toArray({array:Float32Array})}}($e);return{sameAsPrevious:Kt,hierarchy:sn,conformation:yt,chainOperatorMapping:gt}}var k=n(5734);const H={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:o.VP.Undefined(0,o.VP.Schema.str),asym_id:o.VP.Undefined(0,o.VP.Schema.str),seq_id_begin:o.VP.Undefined(0,o.VP.Schema.int),seq_id_end:o.VP.Undefined(0,o.VP.Schema.int),chainElementSegments:y.hT.create([]),polymerRanges:k.m.ofSortedRanges([]),gapRanges:k.m.ofSortedRanges([])};var $=function($e){return $e.Empty={isDefined:!1,spheres:H,gaussians:H},$e}($||{});function J($e,mt,_t){if($e.has(mt))return $e.get(mt);const Me=_t.index++;return $e.set(mt,Me),Me}function W($e,mt){if($e.has(mt))return $e.get(mt);const _t=new Map;return $e.set(mt,_t),_t}function de($e){throw new Error(`Missing entity entry for entity id '${$e}'.`)}function ye($e,mt){const{entity_id:_t,asym_id:Me,seq_id_begin:Ke,seq_id_end:ut,count:Kt,chainElementSegments:sn}=$e,gt=new Map,yt=new Map,At={index:0},Gt=new Int32Array(Kt),rn=new Int32Array(Kt),tt=new Int32Array(sn.count);for(let Dn=0;Dn<Kt;Dn++)rn[Dn]=mt.getEntityIndex(_t.value(Dn)),rn[Dn]<0&&de(_t.value(Dn));for(let Dn=0;Dn<sn.count;Dn++){const jt=sn.offsets[Dn],It=sn.offsets[Dn+1],Dt=rn[jt];tt[Dn]=Dt;const $t=J(W(yt,Dt),Me.value(jt),At);for(let Zt=jt;Zt<It;Zt++)Gt[Zt]=$t;const Vt=[],Wt=[];for(let Zt=jt;Zt<It;Zt++){const kt=Ke.value(Zt),Ot=ut.value(Zt);Vt.push(Zt),Wt.push(kt,Ot)}const yn={elementIndices:Vt,seqRanges:k.m.ofSortedRanges(Wt)};gt.set($t,yn)}const{findChainKey:Mt,findSequenceKey:nn}=function te($e,mt,_t){const Me=$e.getEntityIndex;return{findChainKey:(Kt,sn)=>{const gt=Me(Kt);if(gt<0)return-1;const yt=mt.get(gt);return yt.has(sn)?yt.get(sn):-1},findSequenceKey:(Kt,sn,gt)=>{const yt=Me(Kt);if(yt<0)return-1;const At=mt.get(yt);if(void 0===At)return-1;const Gt=At.get(sn);if(void 0===Gt)return-1;const rn=_t.get(Gt),{elementIndices:tt,seqRanges:Mt}=rn,nn=k.m.firstIntersectionIndex(Mt,y.CD.ofSingleton(gt));return-1!==nn?tt[nn]:-1}}}(mt,yt,gt);return{chainKey:Gt,entityKey:rn,findSequenceKey:nn,findChainKey:Mt,getEntityFromChain:Dn=>tt[Dn]}}var j=n(9909);function Z($e,mt){const _t=[],Me=[],Ke=y.hT.transientSegments($e.chainElementSegments,y.IX.ofBounds(0,$e.count)),{seq_id_begin:ut,seq_id_end:Kt}=$e;for(;Ke.hasNext;){const{start:sn,end:gt}=Ke.move();let yt=-1,At=-1;for(let Gt=sn;Gt<gt;++Gt){const rn=Kt.value(Gt);Gt===sn?(yt=Gt,At=Kt.value(Gt)):ut.value(Gt)-At>1&&(_t.push(yt,Gt-1),Me.push(Gt-1,Gt),yt=Gt),Gt===gt-1&&_t.push(yt,Gt),At=rn}}return{polymerRanges:k.m.ofSortedRanges(_t),gapRanges:k.m.ofSortedRanges(Me)}}var q=n(2449);const Y={hierarchy:$.Empty,conformation:void 0};function xe($e,mt,_t){const Me=[0];for(let Ke=1,ut=$e.rowCount;Ke<ut;Ke++)!$e.areValuesEqual(Ke-1,Ke)&&(Me[Me.length]=Ke);return{chainElementSegments:y.hT.ofOffsets(Me,y.IX.ofBounds(0,$e.rowCount))}}function le($e){const{entity_id:mt,seq_id_begin:_t,seq_id_end:Me,asym_id:Ke}=$e;return{count:mt.rowCount,entity_id:mt,asym_id:Ke,seq_id_begin:_t,seq_id_end:Me,...xe(Ke)}}var Ae=n(6144),Be=n(4699);function Ce($e,mt,_t,Me){if(!$e.entity_poly_seq||!$e.entity_poly_seq._rowCount)return Ae.V.fromHierarchy(mt,_t,Me);const{entity_id:Ke,num:ut,mon_id:Kt}=$e.entity_poly_seq,sn={},gt=[],yt=Ke.rowCount;let At=0;for(;At<yt;){const Gt=At;for(;At<yt-1&&Ke.areValuesEqual(At,At+1);)At++;At++;const rn=Ke.value(Gt),tt=o.VP.window(Kt,Gt,At),Mt=o.VP.window(ut,Gt,At),nn=mt.getEntityIndex(rn);sn[nn]={entityId:rn,sequence:Be.g.ofResidueNames(tt,Mt)},gt.push(sn[nn])}return{byEntityKey:sn,sequences:gt}}var Re=n(6115);function ke($e,mt,_t,Me){return we.apply(this,arguments)}function we(){return(we=(0,e.A)(function*($e,mt,_t,Me){const Ke=(0,u.vc)(_t,Me-1),{label_entity_id:ut,label_asym_id:Kt,label_seq_id:sn}=mt,gt=(0,u.h3)(Ke,ut.value);$e.shouldUpdate&&(yield $e.update());for(let yt=0,At=gt.length-1;yt<At;yt++){const Gt=(0,u.h3)(Ke,Kt.value,{start:gt[yt],end:gt[yt+1]});for(let rn=0,tt=Gt.length-1;rn<tt;rn++){const Mt=Gt[rn];0===sn.valueKind(Mt)&&((0,u.h3)(Ke,sn.value,{sort:!0,start:Mt,end:Gt[rn+1]}),$e.shouldUpdate&&(yield $e.update()))}$e.shouldUpdate&&(yield $e.update())}return(0,Re.qW)(Ke)&&Ke.length===mt._rowCount?{atom_site:mt,sourceIndex:o.VP.ofIntArray(Ke)}:{atom_site:o.XI.view(mt,mt._schema,Ke),sourceIndex:o.VP.ofIntArray(Ke)}})).apply(this,arguments)}function Oe($e,mt,_t,Me,Ke){const{polymerType:ut,traceElementIndex:Kt,directionFromElementIndex:sn,directionToElementIndex:gt}=Ke.residue,yt=ut[$e],At=ut[mt];if(0===yt||0===At||-1===Kt[$e]||-1===Kt[mt])return!1;let Gt=Me.findAtomsOnResidue($e,(0,M.HQ)(yt,"backboneStart")),rn=Me.findAtomsOnResidue(mt,(0,M.HQ)(At,"backboneEnd"));(-1===Gt||-1===rn)&&(Gt=Me.findAtomsOnResidue($e,(0,M.HQ)(yt,"coarseBackbone")),rn=Me.findAtomsOnResidue(mt,(0,M.HQ)(At,"coarseBackbone")));const{x:tt,y:Mt,z:nn}=_t,bn=v.eB.create(tt[Gt],Mt[Gt],nn[Gt]),Dn=v.eB.create(tt[rn],Mt[rn],nn[rn]),jt=-1===sn[$e]||-1===gt[$e]||-1===sn[mt]||-1===gt[mt];return v.eB.distance(bn,Dn)<(jt?10:3)}function Se($e,mt,_t,Me){const Ke=[],ut=[],Kt=new Map,sn=y.hT.transientSegments($e.chainAtomSegments,y.IX.ofBounds(0,$e.atoms._rowCount)),gt=y.hT.transientSegments($e.residueAtomSegments,y.IX.ofBounds(0,$e.atoms._rowCount)),{index:yt,derived:At}=$e,{label_seq_id:Gt}=$e.residues,{label_entity_id:rn}=$e.chains,{moleculeType:tt,traceElementIndex:Mt}=At.residue;let nn,bn,Dn,jt;for(;sn.hasNext;){const It=sn.move();gt.setSegment(It),nn=-1,bn=-1,Dn=-1,jt=-1;const Dt=mt.getEntityIndex(rn.value(It.index)),Ct=Me.byEntityKey[Dt],$t=Ct?Ct.sequence.seqId.value(Ct.sequence.seqId.rowCount-1):-1,Vt=$e.residueAtomSegments.index[It.start],Wt=$e.residueAtomSegments.index[It.end-1],yn=Gt.value(Vt),Zt=Gt.value(Wt);for(1===yn&&Zt===$t&&_t.xyzDefined&&Oe(Vt,Wt,_t,yt,At)&&(Kt.set(Vt,Wt),Kt.set(Wt,Vt));gt.hasNext;){const kt=gt.move(),Ot=kt.index,An=Gt.value(Ot);(0,_.z7)(tt[Ot])&&-1!==Mt[Ot]?-1!==jt?An!==nn+1?(Ke.push(jt,Dn-1),ut.push(bn,kt.end-1),jt=kt.start):gt.hasNext?_t.xyzDefined&&!Oe($e.residueAtomSegments.index[kt.start],$e.residueAtomSegments.index[Dn-1],_t,$e.index,At)&&(Ke.push(jt,Dn-1),ut.push(bn,kt.end-1),jt=kt.start):Ke.push(jt,kt.end-1):jt=kt.start:-1!==jt&&(Ke.push(jt,Dn-1),jt=-1),bn=kt.start,Dn=kt.end,nn=An}}return{polymerRanges:k.m.ofSortedRanges(Ke),gapRanges:k.m.ofSortedRanges(ut),cyclicPolymerMap:Kt}}var Ve=n(442);function K($e){const mt=new Map,_t=(Ke,ut,Kt)=>`${Ke}|${ut}|${Kt}`,Me=$e.pdbx_unobs_or_zero_occ_residues;for(let Ke=0,ut=Me._rowCount;Ke<ut;++Ke){const Kt=_t(Me.PDB_model_num.value(Ke),Me.label_asym_id.value(Ke),Me.label_seq_id.value(Ke));mt.set(Kt,{polymer_flag:Me.polymer_flag.value(Ke),occupancy_flag:Me.occupancy_flag.value(Ke)})}return{has:(Ke,ut,Kt)=>mt.has(_t(Ke,ut,Kt)),get:(Ke,ut,Kt)=>mt.get(_t(Ke,ut,Kt)),size:mt.size}}function ne($e){const mt=new Map;if($e.chem_comp._rowCount>0){const{id:_t}=$e.chem_comp;for(let Me=0,Ke=_t.rowCount;Me<Ke;++Me)mt.set(_t.value(Me),o.XI.getRow($e.chem_comp,Me))}else Te($e).forEach(Me=>{mt.set(Me,(0,_.bM)(Me))});return mt}function be($e){const mt=new Map;if($e.pdbx_chem_comp_identifier._rowCount>0){const{comp_id:_t,type:Me,identifier:Ke}=$e.pdbx_chem_comp_identifier;for(let ut=0,Kt=_t.rowCount;ut<Kt;++ut)if("SNFG CARBOHYDRATE SYMBOL"===Me.value(ut)||"SNFG CARB SYMBOL"===Me.value(ut)){const sn=Ke.value(ut),gt=Ve.Dr.get(sn);gt?mt.set(_t.value(ut),gt):console.warn(`Unknown SNFG name '${sn}'`)}}if($e.chem_comp._rowCount>0){const{id:_t,type:Me}=$e.chem_comp;for(let Ke=0,ut=_t.rowCount;Ke<ut;++Ke){const Kt=_t.value(Ke);if(mt.has(Kt))continue;const sn=Me.value(Ke);Ve.yt.has(Kt)?mt.set(Kt,Ve.yt.get(Kt)):9===(0,_.RN)(sn,Kt)&&mt.set(Kt,Ve.xY)}}else{const _t=Te($e);Ve.yt.forEach((Me,Ke)=>{!mt.has(Ke)&&_t.has(Ke)&&mt.set(Ke,Me)})}return mt}const Te=(0,n(1094).E)($e=>{const mt=new Set,{label_comp_id:_t,auth_comp_id:Me}=$e.atom_site,Ke=_t.isDefined?_t:Me;for(let ut=0,Kt=Ke.rowCount;ut<Kt;++ut)mt.add(Ke.value(ut));return mt});function ie($e,mt){const _t=new Map,{auth_asym_id:Me,label_asym_id:Ke,label_entity_id:ut}=$e.chains;for(let Kt=0,sn=$e.chains._rowCount;Kt<sn;Kt++){const gt=Ke.value(Kt);_t.set(gt,{id:gt,auth_id:Me.value(Kt),entity_id:ut.value(Kt)})}if(mt?.struct_asym._rowCount){const{id:Kt,entity_id:sn}=mt.struct_asym;for(let gt=0,yt=Kt.rowCount;gt<yt;++gt){const At=Kt.value(gt);_t.has(At)||_t.set(At,{id:At,auth_id:"",entity_id:sn.value(gt)})}}return _t}const ue=o.VP.Schema.Aliased(o.VP.Schema.Str());function re($e){let mt;if($e.entity.id.isDefined)mt=$e.entity;else{const sn=new Set,gt=[],yt=[],{label_entity_id:At,label_comp_id:Gt}=$e.atom_site;for(let Mt=0,nn=$e.atom_site._rowCount;Mt<nn;Mt++){const bn=At.value(Mt);sn.has(bn)||(gt.push(bn),yt.push((0,_.wZ)(Gt.value(Mt))),sn.add(bn))}const{entity_id:rn}=$e.ihm_sphere_obj_site;for(let Mt=0,nn=$e.ihm_sphere_obj_site._rowCount;Mt<nn;Mt++){const bn=rn.value(Mt);sn.has(bn)||(gt.push(bn),yt.push("polymer"),sn.add(bn))}const{entity_id:tt}=$e.ihm_gaussian_obj_site;for(let Mt=0,nn=$e.ihm_gaussian_obj_site._rowCount;Mt<nn;Mt++){const bn=tt.value(Mt);sn.has(bn)||(gt.push(bn),yt.push("polymer"),sn.add(bn))}mt=o.XI.ofPartialColumns(q.e.entity,{id:o.VP.ofArray({array:gt,schema:q.e.entity.id}),type:o.VP.ofArray({array:yt,schema:q.e.entity.type})},gt.length)}const _t=o.VP.createIndexer(mt.id),Me=new Array(mt._rowCount);Me.fill("other");const Ke=new Set;let ut=!1;if($e.entity_poly&&$e.entity_poly.type.isDefined){const{entity_id:sn,type:gt,_rowCount:yt}=$e.entity_poly;for(let At=0;At<yt;++At){const Gt=sn.value(At);Me[_t(Gt)]=gt.value(At),Ke.add(Gt)}}else ut=!0;if($e.pdbx_entity_branch&&$e.pdbx_entity_branch.entity_id.isDefined){const{entity_id:sn,type:gt,_rowCount:yt}=$e.pdbx_entity_branch;for(let At=0;At<yt;++At){const Gt=sn.value(At);Me[_t(Gt)]=gt.value(At),Ke.add(Gt)}}else ut=!0;if(Ke.size<Me.length&&(ut=!0),ut){const sn=new Map;if($e.chem_comp){const{id:gt,type:yt}=$e.chem_comp;for(let At=0,Gt=$e.chem_comp._rowCount;At<Gt;At++)sn.set(gt.value(At),yt.value(At))}if($e.atom_site){const{label_entity_id:gt,label_comp_id:yt}=$e.atom_site;for(let At=0,Gt=$e.atom_site._rowCount;At<Gt;At++){const rn=gt.value(At);if(!Ke.has(rn)){const tt=yt.value(At),Mt=sn.get(tt)||"other";Me[_t(rn)]=(0,_.UC)(tt,Mt),Ke.add(rn)}}}}return{data:mt,subtype:o.VP.ofArray({array:Me,schema:ue}),getEntityIndex:_t}}function ve($e,mt,_t){var Me;if(!$e.pdbx_molecule||!$e.pdbx_molecule.prd_id.isDefined)return mt;const Ke=new Array(mt.data._rowCount);Ke.fill("");const{asym_id:ut,prd_id:Kt,_rowCount:sn}=$e.pdbx_molecule;for(let yt=0;yt<sn;++yt){const At=ut.value(yt),Gt=null===(Me=_t.get(At))||void 0===Me?void 0:Me.entity_id;void 0!==Gt&&(Ke[mt.getEntityIndex(Gt)]=Kt.value(yt))}const gt=o.VP.ofArray({array:Ke,schema:o.VP.Schema.str});return{...mt,prd_id:gt}}var ce=n(1049),se=n(7024);function ae($e,mt,_t){return ge.apply(this,arguments)}function ge(){return ge=(0,e.A)(function*($e,mt,_t){const Me=function Ie($e,mt){return{missingResidues:K($e),chemicalComponentMap:ne($e),saccharideComponentMap:be($e)}}($e),Ke=$e.ihm_model_list._rowCount>0?yield function Bt($e,mt,_t,Me){return pn.apply(this,arguments)}(_t,$e,Me,mt):yield function Lt($e,mt,_t,Me){return Je.apply(this,arguments)}(_t,$e,Me,mt);for(let ut=0;ut<Ke.length;ut++)t.K.TrajectoryInfo.set(Ke[ut],{index:ut,size:Ke.length});return new se.P(Ke)}),ge.apply(this,arguments)}function Le($e,mt,_t,Me,Ke,ut,Kt){const sn=N(mt,_t,Me,Ke.chemicalComponentMap,ut,Kt),gt=mt.pdbx_PDB_model_num.value(0);if(Kt&&sn.sameAsPrevious)return{...Kt,id:r.k.create22(),modelNum:gt,atomicConformation:sn.conformation,_dynamicPropertyData:Object.create(null)};const yt=Y,At=Ce($e,Me,sn.hierarchy,yt.hierarchy),Gt=Se(sn.hierarchy,Me,sn.conformation,At),rn=ie(sn.hierarchy),tt=0===$e.entry.id.valueKind(0)?$e.entry.id.value(0):ut.name,Mt=[];return tt&&Mt.push(tt),0===$e.struct.title.valueKind(0)&&Mt.push($e.struct.title.value(0)),{id:r.k.create22(),entryId:tt,label:Mt.join(" | "),entry:tt,sourceData:ut,modelNum:gt,parent:void 0,entities:ve($e,Me,rn),sequence:At,atomicHierarchy:sn.hierarchy,atomicConformation:sn.conformation,atomicRanges:Gt,atomicChainOperatorMappinng:sn.chainOperatorMapping,coarseHierarchy:yt.hierarchy,coarseConformation:yt.conformation,properties:{...Ke,structAsymMap:rn},customProperties:new A.v,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function nt($e,mt,_t,Me){const Ke=N(mt.atom_site,mt.atom_site_sourceIndex,mt.entities,_t.chemicalComponentMap,Me),ut=function ee($e,mt){const{ihm_sphere_obj_site:_t,ihm_gaussian_obj_site:Me}=$e;if(0===_t._rowCount&&0===Me._rowCount)return Y;const Ke=le(_t),ut=function g($e){return{x:$e.Cartn_x.toArray({array:Float32Array}),y:$e.Cartn_y.toArray({array:Float32Array}),z:$e.Cartn_z.toArray({array:Float32Array}),radius:$e.object_radius.toArray({array:Float32Array}),rmsf:$e.rmsf.toArray({array:Float32Array})}}(_t),Kt=ye(Ke,$e.entities),sn=Z(Ke),gt=le(Me),yt=function _e($e){const mt=q.e.ihm_gaussian_obj_site.covariance_matrix.space,_t=[],{covariance_matrix:Me}=$e;for(let Ke=0,ut=Me.rowCount;Ke<ut;Ke++)_t[Ke]=v.qY.toMat3((0,v.U)(),mt,Me.value(Ke));return{x:$e.mean_Cartn_x.toArray({array:Float32Array}),y:$e.mean_Cartn_y.toArray({array:Float32Array}),z:$e.mean_Cartn_z.toArray({array:Float32Array}),weight:$e.weight.toArray({array:Float32Array}),covariance_matrix:_t}}(Me),At=ye(gt,$e.entities),Gt=Z(gt);return{hierarchy:{isDefined:!0,spheres:{...Ke,...Kt,...sn},gaussians:{...gt,...At,...Gt}},conformation:{id:j.kk.create22(),spheres:ut,gaussians:yt}}}(mt),Kt=Ce($e,mt.entities,Ke.hierarchy,ut.hierarchy),sn=Se(Ke.hierarchy,mt.entities,Ke.conformation,Kt),gt=0===$e.entry.id.valueKind(0)?$e.entry.id.value(0):Me.name,yt=[];gt&&yt.push(gt),0===$e.struct.title.valueKind(0)&&yt.push($e.struct.title.value(0)),mt.model_name&&yt.push(mt.model_name),mt.model_group_name&&yt.push(mt.model_group_name);const At=ie(Ke.hierarchy,$e);return{id:r.k.create22(),entryId:gt,label:yt.join(" | "),entry:gt,sourceData:Me,modelNum:mt.model_id,parent:void 0,entities:ve($e,mt.entities,At),sequence:Kt,atomicHierarchy:Ke.hierarchy,atomicConformation:Ke.conformation,atomicRanges:sn,atomicChainOperatorMappinng:Ke.chainOperatorMapping,coarseHierarchy:ut.hierarchy,coarseConformation:ut.conformation,properties:{..._t,structAsymMap:At},customProperties:new A.v,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function je($e,mt){const _t=$e.rowCount;if(!$e.isDefined)return _t;let Me=mt+1;for(;Me<_t&&$e.areValuesEqual(mt,Me);)Me++;return Me}function Je(){return(Je=(0,e.A)(function*($e,mt,_t,Me){const Ke=[];if(mt.atom_site){const ut=mt.atom_site.id.rowCount,Kt=re(mt);let sn=0;for(;sn<ut;){const gt=je(mt.atom_site.pdbx_PDB_model_num,sn),{atom_site:yt,sourceIndex:At}=yield ke($e,mt.atom_site,sn,gt),Gt=Le(mt,yt,At,Kt,_t,Me,Ke.length>0?Ke[Ke.length-1]:void 0);Ke.push(Gt),sn=gt}}return Ke})).apply(this,arguments)}function en($e,mt){const _t=new Map,Me=$e._rowCount;let Ke=0;for(;Ke<Me;){const ut=je(mt,Ke),Kt=mt.value(Ke);_t.set(Kt,{table:o.XI.window($e,$e._schema,Ke,ut),start:Ke,end:ut}),Ke=ut}return _t}function pn(){return(pn=(0,e.A)(function*($e,mt,_t,Me){const Ke=re(mt),Kt=en(mt.atom_site,mt.atom_site.ihm_model_id.isDefined?mt.atom_site.ihm_model_id:mt.atom_site.pdbx_PDB_model_num),sn=en(mt.ihm_sphere_obj_site,mt.ihm_sphere_obj_site.model_id),gt=en(mt.ihm_gaussian_obj_site,mt.ihm_gaussian_obj_site.model_id),yt=[];if(mt.ihm_model_list){const{model_id:At,model_name:Gt}=mt.ihm_model_list;for(let rn=0;rn<mt.ihm_model_list._rowCount;rn++){const tt=At.value(rn);let Mt,nn;if(Kt.has(tt)){const jt=Kt.get(tt),{atom_site:It,sourceIndex:Dt}=yield ke($e,mt.atom_site,jt.start,jt.end);Mt=It,nn=Dt}else Mt=o.XI.window(mt.atom_site,mt.atom_site._schema,0,0),nn=o.VP.ofIntArray([]);const Dn=nt(mt,{model_id:tt,model_name:Gt.value(rn),model_group_name:(0,ce.O)(tt,mt),entities:Ke,atom_site:Mt,atom_site_sourceIndex:nn,ihm_sphere_obj_site:sn.has(tt)?sn.get(tt).table:o.XI.window(mt.ihm_sphere_obj_site,mt.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:gt.has(tt)?gt.get(tt).table:o.XI.window(mt.ihm_gaussian_obj_site,mt.ihm_gaussian_obj_site._schema,0,0)},_t,Me);yt.push(Dn)}}return yt})).apply(this,arguments)}},2449:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>c,z:()=>i});var e=n(7357),o=n(6651);o.VP.Schema.Str();const A={...e.r.chem_comp,type:o.VP.Schema.Aliased(o.VP.Schema.str)};var y=n(1049);const c={entry:e.r.entry,struct:e.r.struct,struct_asym:e.r.struct_asym,ihm_model_list:e.r.ihm_model_list,ihm_model_group:e.r.ihm_model_group,ihm_model_group_link:e.r.ihm_model_group_link,entity:e.r.entity,entity_poly:e.r.entity_poly,entity_poly_seq:e.r.entity_poly_seq,pdbx_entity_branch:e.r.pdbx_entity_branch,chem_comp:A,pdbx_chem_comp_identifier:e.r.pdbx_chem_comp_identifier,atom_site:e.r.atom_site,ihm_sphere_obj_site:e.r.ihm_sphere_obj_site,ihm_gaussian_obj_site:e.r.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:e.r.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:e.r.pdbx_molecule};function i(v,O=!1){const b=Object.create(null);for(const _ of Object.keys(c))b[_]=_ in v?v[_]:o.XI.ofUndefinedColumns(c[_],0);return O&&(b.atom_site=(0,y.W)(b.atom_site)),b}},1049:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>o,W:()=>A});var e=n(6651);function o(y,c){const{ihm_model_group:i,ihm_model_group_link:v}=c,O=e.XI.pickRow(v,b=>v.model_id.value(b)===y);if(O){const b=e.XI.pickRow(i,_=>i.id.value(_)===O.group_id);if(b)return b.name}return""}function r(y){for(let c=0,i=y.rowCount;c<i;c++)if(0===y.valueKind(c))return!0;return!1}function t(y,c,i){(!y[c].isDefined||!r(y[c]))&&(y[c]=y[i]),(!y[i].isDefined||!r(y[i]))&&(y[i]=y[c])}function A(y){const c=e.XI.ofColumns(y._schema,y);return t(c,"label_atom_id","auth_atom_id"),t(c,"label_comp_id","auth_comp_id"),t(c,"label_seq_id","auth_seq_id"),t(c,"label_asym_id","auth_asym_id"),c}},3671:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>_});var e=n(6651),o=n(2434),r=n(9986),t=n(2449),A=n(442);const y=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],c=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],i=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],v=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),O=function(){const M=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(l=>M.set(l.id,l)),M}(),b=function(){const M=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(l=>M.set(l.id,l)),M}();class _{set(I){this.comps.set(I.id,I),this.ids.push(I.id),this.names.push(I.name),this.types.push(I.type),this.mon_nstd_flags.push(o.px.has(I.id)?"y":"n")}getAtomIds(I){const l=new Set,m=this.seqId.value(I);for(;I<this.seqId.rowCount;){if(this.seqId.value(I)!==m)break;l.add(this.atomId.value(I)),I+=1}return l}hasAtomIds(I,l){for(let m=0,u=l.length;m<u;++m)if(!r.M.areIntersecting(I,l[m]))return!1;return!0}getType(I){return this.hasAtomIds(I,y)?"peptide linking":this.hasAtomIds(I,c)?"rna linking":this.hasAtomIds(I,i)?"dna linking":"other"}has(I){return this.comps.has(I)}get(I){return this.comps.get(I)}add(I,l){if(!this.has(I))if(O.has(I))this.set(O.get(I));else if(o.mw.has(I))this.set({id:I,name:"WATER",type:"non-polymer"});else if(v.has(I.toUpperCase()))this.set({id:I,name:this.namesMap.get(I)||I,type:"non-polymer"});else if(A.yt.has(I.toUpperCase()))this.set({id:I,name:this.namesMap.get(I)||I,type:"saccharide"});else{const m=this.getAtomIds(l);if(1===m.size&&b.has(I))this.set(b.get(I));else{const u=this.getType(m);this.set({id:I,name:this.namesMap.get(I)||I,type:u})}}return this.get(I)}getChemCompTable(){return e.XI.ofPartialColumns(t.e.chem_comp,{id:e.VP.ofStringArray(this.ids),name:e.VP.ofStringArray(this.names),type:e.VP.ofStringAliasArray(this.types),mon_nstd_flag:e.VP.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(I){I.forEach(l=>this.namesMap.set(l[0],l[1]))}constructor(I,l){this.seqId=I,this.atomId=l,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}}},3573:(tn,Ue,n)=>{"use strict";n.d(Ue,{V:()=>t});var e=n(2434),o=n(6651),r=n(2449);class t{constructor(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}set(y,c){this.count+=1,this.ids.push(`${this.count}`),this.types.push(y),this.descriptions.push([c])}getEntityId(y,c,i,v){return 2===c?(void 0===this.waterId&&(this.set("water",v?.customName||"Water"),this.waterId=`${this.count}`),this.waterId):(0,e.z7)(c)?this.compoundsMap.has(i)?this.compoundsMap.get(i):(this.chainMap.has(i)||(this.set("polymer",v?.customName||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(i,`${this.count}`)),this.chainMap.get(i)):(this.heteroMap.has(y)||(this.set("non-polymer",v?.customName||this.namesMap.get(y)||y),this.heteroMap.set(y,`${this.count}`)),this.heteroMap.get(y))}getEntityTable(){return o.XI.ofPartialColumns(r.e.entity,{id:o.VP.ofStringArray(this.ids),type:o.VP.ofStringAliasArray(this.types),pdbx_description:o.VP.ofStringListArray(this.descriptions)},this.count)}setCompounds(y){for(let c=0,i=y.length;c<i;++c){const{chains:v,description:O}=y[c];this.set("polymer",O);for(let b=0,_=v.length;b<_;++b)this.compoundsMap.set(v[b],`${this.count}`)}}setNames(y){y.forEach(c=>this.namesMap.set(c[0],c[1]))}}},9207:(tn,Ue,n)=>{"use strict";n.d(Ue,{q:()=>o});class e{constructor(){this.map=new Map,this.applicable=new Map}add(t,A,y){this.map.set(t,A),y&&this.applicable.set(t,y)}remove(t){this.map.delete(t),this.applicable.delete(t)}get(t){return this.map.get(t)}isApplicable(t){if(!this.map.has(t.sourceData.kind))return!1;const A=this.applicable.get(t.sourceData.kind);return!A||A(t)}}var o;(o||(o={})).create=function t(A,y){const{name:c}=A,i=new e;return{descriptor:A,formatRegistry:i,isApplicable:v=>i.isApplicable(v),get(v){const O=y?.asDynamic?v._dynamicPropertyData:v._staticPropertyData;if(O[c])return O[c];if(v.customProperties.has(A))return;const b=i.get(v.sourceData.kind);return b?(O[c]=b(v),v.customProperties.add(A),O[c]):void 0},set(v,O){y?.asDynamic?v._dynamicPropertyData[c]=O:v._staticPropertyData[c]=O},delete(v){y?.asDynamic?delete v._dynamicPropertyData[c]:delete v._staticPropertyData[c]}}}},2524:(tn,Ue,n)=>{"use strict";n.d(Ue,{K4:()=>S,OQ:()=>D,YG:()=>f});var S,w,R,e=n(467),o=n(4632),r=n(4824),t=n(5165),A=n(2921),y=n(9651),c=n(6710),i=n(6651),v=n(8593),O=n(9344),b=n(8737),_=n(9136),M=n(4811),I=n(2449),l=n(3573),m=n(3671);function D(w,Q){const G=S.fromFrame(w,void 0,void 0,Q),V=(0,I.z)(G.data.db,!0);return r.YZ.create("Create mmCIF Model",U=>(0,A.X)(V,G,U))}function f(w){const Q=R.fromFrame(w);return r.YZ.create("Create CCD Models",G=>function p(w,Q,G){return E.apply(this,arguments)}(Q.data.db,R.fromFrame(w),G))}function E(){return E=(0,e.A)(function*(w,Q,G){const V=yield T(w,Q,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},G),U=yield T(w,Q,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},G),N=[];V&&N.push(V),U&&N.push(U);for(let k=0,H=N.length;k<H;++k)o.K.TrajectoryInfo.set(N[k],{index:k,size:N.length});return new _.P4(N)}),E.apply(this,arguments)}function T(w,Q,G,V){return L.apply(this,arguments)}function L(){return L=(0,e.A)(function*(w,Q,G,V){const{chem_comp:U,chem_comp_atom:N,chem_comp_bond:k}=w,{coordinateType:H,cartn_x:$,cartn_y:J,cartn_z:W}=G,te=U.name.value(0),de=U.id.value(0),{atom_id:ye,charge:j,comp_id:Z,pdbx_ordinal:q,type_symbol:Y}=N,ee=N._rowCount,g=[];for(let ce=0;ce<ee;ce++)N[$].valueKind(ce)>0||(g[g.length]=ce);const _e=g.length,xe=i.VP.ofConst("A",_e,i.VP.Schema.str),le=i.VP.ofConst(1,_e,i.VP.Schema.int),Ae=i.VP.ofConst("1",_e,i.VP.Schema.str),Be=i.VP.ofConst(1,_e,i.VP.Schema.float),Ce=i.VP.ofConst(1,_e,i.VP.Schema.int),Re=i.VP.view(ye,g),ke=i.VP.view(Z,g),we=i.VP.view(N[$],g),Oe=i.VP.view(N[J],g),Se=i.VP.view(N[W],g),Ve=i.VP.view(q,g),Ne=i.VP.view(Y,g),K=i.VP.view(j,g),ne=i.XI.ofPartialColumns(I.e.atom_site,{auth_asym_id:xe,auth_atom_id:Re,auth_comp_id:ke,auth_seq_id:le,Cartn_x:we,Cartn_y:Oe,Cartn_z:Se,id:Ve,label_asym_id:xe,label_atom_id:Re,label_comp_id:ke,label_seq_id:le,label_entity_id:Ae,occupancy:Be,type_symbol:Ne,pdbx_PDB_model_num:Ce,pdbx_formal_charge:K},_e),be=new l.V;be.setNames([[de,`${te} (${H})`]]),be.getEntityId(de,0,"A");const Te=new m.N(le,Y);Te.setNames([[de,`${te} (${H})`]]),Te.add(de,0);const ie=(0,I.z)({entity:be.getEntityTable(),chem_comp:Te.getChemCompTable(),atom_site:ne}),ue=yield(0,A.X)(ie,Q,V);if(!ue.representative)return;const re=ue.representative,ve=O.X.getEntriesFromChemCompBond(k);return O.X.Provider.set(re,{data:k,entries:ve}),R.CoordinateType.set(re,H),ue.representative}),L.apply(this,arguments)}y.i.Provider.formatRegistry.add("mmCIF",function u(w){if(S.is(w.sourceData))return y.i.fromData(w.sourceData.data.db)}),c.v.Provider.formatRegistry.add("mmCIF",function d(w){if(!S.is(w.sourceData))return;const{struct_conf:Q,struct_sheet_range:G}=w.sourceData.data.db;return c.v.fromStruct(Q,G,w.atomicHierarchy)}),v._.Provider.formatRegistry.add("mmCIF",function s(w){if(!S.is(w.sourceData))return;const{atom_site_anisotrop:Q}=w.sourceData.data.db;return{data:i.XI.ofColumns(v._.Schema,Q),elementToAnsiotrop:v._.getElementToAnsiotrop(w.atomicConformation.atomId,Q.id)}},function C(w){return!!S.is(w.sourceData)&&w.sourceData.data.db.atom_site_anisotrop.U.isDefined}),O.X.Provider.formatRegistry.add("mmCIF",function h(w){if(!S.is(w.sourceData))return;const{chem_comp_bond:Q}=w.sourceData.data.db;return 0!==Q._rowCount?{data:Q,entries:O.X.getEntriesFromChemCompBond(Q)}:void 0}),b.A.Provider.formatRegistry.add("mmCIF",function a(w){if(!S.is(w.sourceData))return;const{struct_conn:Q}=w.sourceData.data.db;if(0===Q._rowCount)return;const G=b.A.getEntriesFromStructConn(Q,w);return{data:Q,byAtomIndex:b.A.getAtomIndexFromEntries(G),entries:G}}),M.T.Provider.formatRegistry.add("mmCIF",M.T.fromMmCif,M.T.hasData),(w=S||(S={})).is=function Q(V){return"mmCIF"===V?.kind},w.fromFrame=function G(V,U,N,k){return U||(U=t.f$.schema.mmCIF(V)),{kind:"mmCIF",name:U._name,data:{db:U,file:k,frame:V,source:N}}},function(w){const Q="__CcdCoordinateType__";w.CoordinateType={get:U=>U._staticPropertyData[Q],set:(U,N)=>U._staticPropertyData[Q]=N},w.is=function G(U){return"CCD"===U?.kind},w.fromFrame=function V(U,N){return N||(N=t.f$.schema.CCD(U)),{kind:"CCD",name:N._name,data:{db:N,frame:U}}}}(R||(R={}))},8593:(tn,Ue,n)=>{"use strict";n.d(Ue,{_:()=>y});var y,c,e=n(7357),o=n(7421),r=n(9207),t=n(2524);(c=y||(y={})).Schema={U:e.r.atom_site_anisotrop.U,U_esd:e.r.atom_site_anisotrop.U_esd},c.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:O=>c.Provider.get(O.firstModel)&&t.K4.is(O.firstModel.sourceData)?o.c.Category.ofTable(O.firstModel.sourceData.data.db.atom_site_anisotrop):o.c.Category.Empty}]}},c.Provider=r.q.create(c.Descriptor),c.getElementToAnsiotrop=function i(O,b){const _=new Int32Array(O.rowCount);_.fill(-1);for(let I=0,l=O.rowCount;I<l;I++)_[O.value(I)]=I;const M=new Int32Array(O.rowCount);M.fill(-1);for(let I=0,l=b.rowCount;I<l;++I){const m=_[b.value(I)];-1!==m&&(M[m]=I)}return M},c.getElementToAnsiotropFromLabel=function v(O,b){const _={};for(let I=0,l=O.rowCount;I<l;I++)_[O.value(I)]=I;const M=new Int32Array(O.rowCount);M.fill(-1);for(let I=0,l=b.rowCount;I<l;++I){const m=_[b.value(I)];void 0!==m&&(M[m]=I)}return M}},9344:(tn,Ue,n)=>{"use strict";n.d(Ue,{X:()=>A});var A,e=n(7357),o=n(7421),r=n(6651),t=n(9207);!function(y){y.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance(O){const b=y.Provider.get(O.firstModel);if(!b)return o.c.Category.Empty;const _=b.data;if(!_)return o.c.Category.Empty;const M=O.structures[0].uniqueResidueNames,{comp_id:I,_rowCount:l}=_,m=[];for(let u=0;u<l;u++)M.has(I.value(u))&&(m[m.length]=u);return o.c.Category.ofTable(_,m)}}]}},y.Provider=t.q.create(y.Descriptor),y.chemCompBondFromTable=function c(O,b){return r.XI.pick(b,e.r.chem_comp_bond,_=>O.properties.chemicalComponentMap.has(b.comp_id.value(_)))},y.getEntriesFromChemCompBond=function i(O){const b=new Map;function _(h){if(b.has(h))return b.get(h);const a=new v(h);return b.set(h,a),a}const{comp_id:M,atom_id_1:I,atom_id_2:l,value_order:m,pdbx_aromatic_flag:u,_rowCount:d,pdbx_ordinal:s}=O;let C=_(M.value(0));for(let h=0;h<d;h++){const a=M.value(h),S=I.value(h),D=l.value(h),R=m.value(h),f="y"===u.value(h),p=s.value(h);C.id!==a&&(C=_(a));let E=1,T=1;switch(f&&(E|=16),R.toLowerCase()){case"delo":E|=16;break;case"doub":T=2;break;case"trip":T=3;break;case"quad":T=4}C.add(S,D,T,E,p)}return b};class v{add(b,_,M,I,l,m=!0){const u=this.map.get(b);if(void 0!==u)void 0===u.get(_)&&u.set(_,{order:M,flags:I,key:l});else{const d=new Map;d.set(_,{order:M,flags:I,key:l}),this.map.set(b,d)}m&&this.add(_,b,M,I,l,!1)}constructor(b){this.id=b,this.map=new Map}}y.Entry=v}(A||(A={}))},8334:(tn,Ue,n)=>{"use strict";n.d(Ue,{z:()=>t});var t,A,e=n(4506),o=n(9207);function r(A,y,c,i){const v=new e.O.EdgeBuilder(i,A,y),O=new Int32Array(v.slotCount),b=new Array(v.slotCount),_=new Array(v.slotCount),M=new Int8Array(v.slotCount),I=new Array(v.slotCount),l=new Array(v.slotCount);for(let m=0,u=v.edgeCount;m<u;m++)v.addNextEdge(),v.assignProperty(O,c.key?c.key[m]:-1),v.assignDirectedProperty(b,c.operatorA?c.operatorA[m]:-1,_,c.operatorB?c.operatorB[m]:-1),v.assignProperty(M,c.order?c.order[m]:1),v.assignProperty(I,c.distance?c.distance[m]:-1),v.assignProperty(l,c.flag?c.flag[m]:1);return v.createGraph({key:O,operatorA:b,operatorB:_,order:M,distance:I,flag:l})}(A=t||(t={})).Descriptor={name:"index_pair_bonds"},A.Provider=o.q.create(A.Descriptor,{asDynamic:!0}),A.DefaultProps={maxDistance:-1,cacheable:!0},A.fromData=function y(i,v={}){const O={...A.DefaultProps,...v},{pairs:b,count:_}=i;return{bonds:r(b.indexA.toArray(),b.indexB.toArray(),{key:b.key&&b.key.toArray(),operatorA:b.operatorA&&b.operatorA.toArray(),operatorB:b.operatorB&&b.operatorB.toArray(),order:b.order&&b.order.toArray(),distance:b.distance&&b.distance.toArray(),flag:b.flag&&b.flag.toArray()},_),maxDistance:O.maxDistance,cacheable:O.cacheable}},A.getEdgeIndexForOperators=function c(i,v,O,b,_){let M,I,l,m;v<O?(M=v,I=O,l=b,m=_):(M=O,I=v,l=_,m=b);for(let u=i.offset[M],d=i.offset[M+1];u<d;u++)if(i.b[u]===I&&i.edgeProps.operatorA[u]===l&&i.edgeProps.operatorB[u]===m)return u;return-1}},8737:(tn,Ue,n)=>{"use strict";n.d(Ue,{A:()=>y});var y,e=n(6651),o=n(3543),r=n(7421),t=n(5373),A=n(9207);!function(c){function v({units:_},M){for(let I=0,l=_.length;I<l;I++)if(o.SortedArray.indexOf(_[I].elements,M)>=0)return!0;return!1}c.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance(_){const M=c.Provider.get(_.firstModel);if(!M||0===M.entries.length)return r.c.Category.Empty;const I=_.structures[0],l=[];for(const m of M.entries)v(I,m.partnerA.atomIndex)&&v(I,m.partnerB.atomIndex)&&(l[l.length]=m.rowIndex);return r.c.Category.ofTable(M.data,l)}}]}},c.Provider=A.q.create(c.Descriptor),c.isExhaustive=function i(_){const M=c.Provider.get(_);return!!M&&M.data.id.rowCount/_.atomicConformation.atomId.rowCount>.95},c.getAtomIndexFromEntries=function O(_){const M=new Map;for(const I of _){const{partnerA:{atomIndex:l},partnerB:{atomIndex:m}}=I;M.has(l)?M.get(l).push(I):M.set(l,[I]),M.has(m)?M.get(m).push(I):M.set(m,[I])}return M},c.getEntriesFromStructConn=function b(_,M){const{conn_type_id:I,pdbx_dist_value:l,pdbx_value_order:m}=_,u={label_asym_id:_.ptnr1_label_asym_id,label_seq_id:_.ptnr1_label_seq_id,auth_seq_id:_.ptnr1_auth_seq_id,label_atom_id:_.ptnr1_label_atom_id,label_alt_id:_.pdbx_ptnr1_label_alt_id,ins_code:_.pdbx_ptnr1_PDB_ins_code,symmetry:_.ptnr1_symmetry},d={label_asym_id:_.ptnr2_label_asym_id,label_seq_id:_.ptnr2_label_seq_id,auth_seq_id:_.ptnr2_auth_seq_id,label_atom_id:_.ptnr2_label_atom_id,label_alt_id:_.pdbx_ptnr2_label_alt_id,ins_code:_.pdbx_ptnr2_PDB_ins_code,symmetry:_.ptnr2_symmetry},s=Array.from(M.entities.data.id.toArray()),C=(a,S)=>{if(0!==S.label_asym_id.valueKind(a))return;const D=S.label_asym_id.value(a),R=S.label_atom_id.value(a);if(!R)return;const f=S.auth_seq_id.valueKind(a)===e.VP.ValueKind.Present?S.auth_seq_id.value(a):S.label_seq_id.value(a),p=S.ins_code.value(a),E=S.label_alt_id.value(a);for(const T of s){const L=M.atomicHierarchy.index.findResidue(T,D,f,p);if(L<0)continue;const w=M.atomicHierarchy.index.findAtomOnResidue(L,R,E);if(!(w<0))return{residueIndex:L,atomIndex:w,symmetry:S.symmetry.value(a)}}},h=[];for(let a=0;a<_._rowCount;a++){const S=C(a,u),D=C(a,d);if(void 0===S||void 0===D)continue;const R=I.value(a);let p=0,E=1;switch(m.value(a)||""){case"sing":E=1;break;case"doub":E=2;break;case"trip":E=3;break;case"quad":E=4;break;default:E=(0,t.m)(_.ptnr1_label_comp_id.value(a),_.ptnr1_label_atom_id.value(a),_.ptnr2_label_comp_id.value(a),_.ptnr2_label_atom_id.value(a))}switch(R){case"covale":p=1;break;case"disulf":p=9;break;case"hydrog":p=4;break;case"metalc":p=2}h.push({rowIndex:a,flags:p,order:E,distance:l.value(a),partnerA:S,partnerB:D})}return h}}(y||(y={}))},4366:(tn,Ue,n)=>{"use strict";n.d(Ue,{j:()=>o});var o,r,e=n(9207);(r=o||(o={})).Descriptor={name:"atom_partial_charge"},r.Provider=e.q.create(r.Descriptor)},6710:(tn,Ue,n)=>{"use strict";n.d(Ue,{v:()=>A});var A,b,e=n(2434),o=n(2008),r=n(4743),t=n(9207);function v(b,_,M,I,l,m){const{auth_seq_id:u,label_seq_id:d,pdbx_PDB_ins_code:s}=b.residues,{endSeqId:C,endInsCode:h,key:a,type:S}=M,D="label"===_?d:u;let R=I;for(;R<l;){const f=D.value(R);if(m.type[R]=S,m.key[R]=a,f>C||f===C&&s.value(R)===h)break;R++}}(b=A||(A={})).Descriptor={name:"model_secondary_structure"},b.Provider=t.q.create(b.Descriptor),b.fromStruct=function _(M,I,l){const m=new Map,u=[{kind:"none"}],d=function y(b,_){if(b._rowCount>0){if(0!==b.beg_label_seq_id.valueKind(0)||0!==b.end_label_seq_id.valueKind(0))return"auth"}else if(_&&(0!==_.beg_label_seq_id.valueKind(0)||0!==_.end_label_seq_id.valueKind(0)))return"auth";return"label"}(M,I);(function c(b,_,M,I){if(!b._rowCount)return;const{beg_label_asym_id:l,beg_label_seq_id:m,beg_auth_seq_id:u,pdbx_beg_PDB_ins_code:d}=b,{end_label_seq_id:s,end_auth_seq_id:C,pdbx_end_PDB_ins_code:h}=b,{pdbx_PDB_helix_class:a,conf_type_id:S,details:D}=b,R="label"===_?m:u,f="label"===_?s:C;for(let p=0,E=b._rowCount;p<E;p++){const T=e.gG.create(0===a.valueKind(p)?e.gG.SecondaryStructurePdb[a.value(p)]:0===S.valueKind(p)?e.gG.SecondaryStructureMmcif[S.value(p)]:536870912),L={kind:"helix",flags:T,type_id:0===S.valueKind(p)?S.value(p):"helx_p",helix_class:a.value(p),details:0===D.valueKind(p)?D.value(p):void 0},w={startSeqId:R.value(p),startInsCode:d.value(p),endSeqId:f.value(p),endInsCode:h.value(p),type:T,key:I.length};I[I.length]=L;const Q=l.value(p);if(M.has(Q)){const G=M.get(Q);G.has(w.startSeqId)?G.get(w.startSeqId).push(w):G.set(w.startSeqId,[w])}else M.set(Q,new Map([[w.startSeqId,[w]]]))}})(M,d,m,u),function i(b,_,M,I,l){if(!b._rowCount)return;const{beg_label_asym_id:m,beg_label_seq_id:u,beg_auth_seq_id:d,pdbx_beg_PDB_ins_code:s}=b,{end_label_seq_id:C,end_auth_seq_id:h,pdbx_end_PDB_ins_code:a}=b,{sheet_id:S}=b,D="label"===_?u:d,R="label"===_?C:h,f=new Map;let p=I+1;for(let E=0,T=b._rowCount;E<T;E++){const L=S.value(E);let w;f.has(L)?w=f.get(L):(w=p++,f.set(L,w));const Q=e.gG.create(8388612),G={kind:"sheet",flags:Q,sheet_id:L,symmetry:void 0},V={startSeqId:D.value(E),startInsCode:s.value(E),endSeqId:R.value(E),endInsCode:a.value(E),type:Q,key:l.length};l[l.length]=G;const U=m.value(E);if(M.has(U)){const N=M.get(U);N.has(V.startSeqId)?N.get(V.startSeqId).push(V):N.set(V.startSeqId,[V])}else M.set(U,new Map([[V.startSeqId,[V]]]))}}(I,d,m,M._rowCount,u);const s=l.residues._rowCount,h={type:new Int32Array(s),key:new Int32Array(s),elements:u};return m.size>0&&function O(b,_,M,I){const{count:l}=b.chainAtomSegments,{label_asym_id:m}=b.chains,{auth_seq_id:u,label_seq_id:d,pdbx_PDB_ins_code:s}=b.residues,C="label"===_?d:u;for(let h=0;h<l;h++){const a=o.vE.chainStartResidueIndex(b,h),S=o.vE.chainEndResidueIndexExcl(b,h),D=m.value(h);if(M.has(D)){const R=M.get(D);for(let f=a;f<S;f++){const p=C.value(f);if(R.has(p)){const E=R.get(p);for(const T of E){const L=s.value(f);T.startInsCode===L&&v(b,_,T,f,S,I)}}}}}}(l,d,m,h),(0,r.M)(h.type,h.key,h.elements,a=>a)}},9651:(tn,Ue,n)=>{"use strict";n.d(Ue,{i:()=>m});var e=n(7357),o=n(5384),r=n(4369),t=n(7552),A=n(9032),y=n(9136);function i(h,a,S,D){const R=h.id.value(S),f=h.details.value(S),p=[],{assembly_id:E,oper_expression:T,asym_id_list:L}=a;for(let w=0,Q=a._rowCount;w<Q;w++)E.value(w)===R&&(p[p.length]={assemblyId:R,expression:T.value(w),asymIds:L.value(w)});return A.N.create(R,f,function v(h,a){return()=>{const S=[];let D=0;for(let R=0;R<h.length;R++){const f=h[R],E=b(I(f.expression)),T=M(a,E,D,f.assemblyId),L=y.RT.generators.atoms({chainTest:y.RT.pred.and(y.RT.pred.eq(w=>y.StructureProperties.unit.operator_name(w.element),t.J.DefaultName),y.RT.pred.inSet(w=>y.StructureProperties.chain.label_asym_id(w.element),f.asymIds))});S[S.length]={selector:L,operators:T,asymIds:f.asymIds},D+=T.length}return S}}(p,D))}function b(h){const a=[],S=[];for(let D=0;D<h.length;D++)S[D]="";return _(h,a,h.length-1,S),a}function _(h,a,S,D){if(S<0)return void(a[a.length]=D.slice(0));const R=h[S],f=R.length;for(let p=0;p<f;p++)D[S]=R[p],_(h,a,S-1,D)}function M(h,a,S,D){const R=[];let f=S;for(const p of a){const E=r.$I.identity();for(let T=0;T<p.length;T++)r.$I.mul(E,E,h.get(p[T]));f++,R[R.length]=t.J.create(`ASM_${f}`,E,{assembly:{id:D,operId:f,operList:p}})}return R}function I(h){const a=/\(?([^\(\)]+)\)?]*/g,S=[],D=[];let R;for(;R=a.exec(h);)S[S.length]=R[1];return S.forEach(f=>{const p=[];f.split(",").forEach(E=>{const T=E.indexOf("-");if(T>0){const L=parseInt(E.substring(0,T)),w=parseInt(E.substr(T+1));for(let Q=L;Q<=w;Q++)p[p.length]=Q.toString()}else p[p.length]=E.trim()}),D[D.length]=p}),D}var m,h,l=n(9207);function C(h){if(0===h._rowCount)return;const{id:a,matrix:S,vector:D}=h,R=e.r.struct_ncs_oper.matrix.space,f=e.r.struct_ncs_oper.vector.space,p=[];for(let E=0;E<h._rowCount;E++){const T=r.qY.toMat3((0,r.U)(),R,S.value(E)),L=r.qY.toVec3((0,r.eB)(),f,D.value(E));if(!o.JX.checkIfRotationAndTranslation(T,L)||"given"===h.code.value(E)&&!r.U.isIdentity(T)&&!r.eB.isZero(L))continue;const w=a.value(E);p[p.length]=o.JX.ofRotationAndOffset(`ncs_${w}`,T,L,w)}return p}(h=m||(m={})).Descriptor={name:"model_symmetry"},h.Provider=l.q.create(h.Descriptor),h.fromData=function a(D){const R=function c(h,a,S){if(!h._rowCount)return[];const D=function O(h){const{id:a,matrix:S,vector:D,_schema:R}=h,f=new Map,p=(0,r.eB)();for(let E=0,T=h._rowCount;E<T;E++){const L=r.qY.toMat4((0,r.$I)(),R.matrix.space,S.value(E));r.qY.toVec3(p,R.vector.space,D.value(E)),r.$I.setTranslation(L,p),r.$I.setValue(L,3,3,1),f.set(a.value(E),L)}return f}(S),R=[];for(let f=0;f<h._rowCount;f++)R[R.length]=i(h,a,f,D);return R}(D.pdbx_struct_assembly,D.pdbx_struct_assembly_gen,D.pdbx_struct_oper_list),f=function s(h,a){if(0===h._rowCount||0===a._rowCount)return o.is.ZeroP1;const S=a.length_a.value(0),D=a.length_b.value(0),R=a.length_c.value(0);if(0===S||0===D||0===R)return o.is.ZeroP1;const f=a.angle_alpha.value(0),p=a.angle_beta.value(0),E=a.angle_gamma.value(0);if(0===f||0===p||0===E)return o.is.ZeroP1;const T=function d(h){const a=h.Int_Tables_number.value(0),S=h["space_group_name_H-M"].value(0);return h.Int_Tables_number.isDefined?h["space_group_name_H-M"].isDefined?S:a:S}(h),L=o.O8.create(T,r.eB.create(S,D,R),r.eB.scale((0,r.eB)(),r.eB.create(f,p,E),Math.PI/180));return o.is.create(L)}(D.symmetry,D.cell);return{assemblies:R,spacegroup:f,isNonStandardCrystalFrame:!1,ncsOperators:C(D.struct_ncs_oper)}},h.fromCell=function S(D,R){const f=o.O8.create("P 1",D,R);return{assemblies:[],spacegroup:o.is.create(f),isNonStandardCrystalFrame:!1}}},3420:(tn,Ue,n)=>{"use strict";n.d(Ue,{C:()=>y,f:()=>c});var c,i,e=n(467),o=n(4369),r=n(4824),t=n(6115),A=n(1692);function y(i,v){return r.YZ.create("Create Volume",(0,e.A)(function*(){const{header:O,values:b}=i,_=o.qY.Space(O.dim,[0,1,2],Float64Array);let M;if(0===O.dataSetIds.length)M=b;else{const[u,d,s]=O.dim,C=(v?.dataIndex||0)+1;let h=0,a=0;M=new Float64Array(u*d*s);for(let S=0;S<u;S++)for(let D=0;D<d;D++)for(let R=0;R<s;R++)M[h++]=b[a],a+=C}const I=o.qY.create(_,o.qY.Data1(M)),l=o.$I.fromTranslation((0,o.$I)(),O.origin),m=o.$I.fromBasis((0,o.$I)(),O.basisX,O.basisY,O.basisZ);return o.$I.mul(l,l,m),{label:v?.label,entryId:v?.entryId,grid:{transform:{kind:"matrix",matrix:l},cells:I,stats:{min:(0,t.GP)(M),max:(0,t._M)(M),mean:(0,t.VR)(M),sigma:(0,t.C2)(M)}},sourceData:c.create(i),customProperties:new A.v,_propertyData:Object.create(null)}}))}(i=c||(c={})).is=function v(b){return"cube"===b?.kind},i.create=function O(b){return{kind:"cube",name:b.name,data:b}}},4625:(tn,Ue,n)=>{"use strict";n.d(Ue,{G:()=>y,T:()=>c});var c,i,e=n(467),o=n(4824),r=n(5384),t=n(4369),A=n(1692);function y(i,v){return o.YZ.create("Create Volume",function(){var O=(0,e.A)(function*(b){const{volume_data_3d_info:_,volume_data_3d:M}=i,I=r.O8.create(_.spacegroup_number.value(0),t.eB.ofArray(_.spacegroup_cell_size.value(0)),t.eB.scale(t.eB.zero(),t.eB.ofArray(_.spacegroup_cell_angles.value(0)),Math.PI/180)),l=_.axis_order.value(0),m=t.qY.convertToCanonicalAxisIndicesFastToSlow(l),u=m(_.sample_count.value(0)),d=t.qY.Space(u,t.qY.invertAxisOrder(l),Float32Array),s=t.qY.create(d,t.qY.Data1(M.values.toArray({array:Float32Array}))),C=t.eB.ofArray(m(_.origin.value(0))),h=t.eB.ofArray(m(_.dimensions.value(0)));return{label:v?.label,entryId:v?.entryId,grid:{transform:{kind:"spacegroup",cell:I,fractionalBox:r.DJ.create(C,t.eB.add(t.eB.zero(),C,h))},cells:s,stats:{min:_.min_sampled.value(0),max:_.max_sampled.value(0),mean:_.mean_sampled.value(0),sigma:_.sigma_sampled.value(0)}},sourceData:c.create(i),customProperties:new A.v,_propertyData:Object.create(null)}});return function(b){return O.apply(this,arguments)}}())}(i=c||(c={})).is=function v(b){return"dscif"===b?.kind},i.create=function O(b){return{kind:"dscif",name:b._name,data:b}}},387:(tn,Ue,n)=>{"use strict";n.d(Ue,{_:()=>y});var y,e=n(467),o=n(8277),r=n(9909),t=n(1692),A=n(7785);!function(c){function i(O){const b=O.descriptor.name,_="static"===O.type?"_staticPropertyData":"_dynamicPropertyData",M=l=>(b in l[_]||(l[_][b]={props:{...o.t.getDefaultValues(O.getParams(l))},data:r.xv.create(void 0)}),l[_][b]),I=(l,m,u)=>{const d=M(l);l[_][b]={props:m,data:r.xv.withValue(d.data,u)}};return{label:O.label,descriptor:O.descriptor,isHidden:O.isHidden,getParams:l=>{const m=o.t.clone(O.getParams(l));return o.t.setDefaultValues(m,M(l).props),m},defaultParams:O.defaultParams,isApplicable:O.isApplicable,attach:(l=(0,e.A)(function*(m,u,d={},s){s&&u.customProperties.reference(O.descriptor,!0);const C=M(u),h=o.t.merge(O.defaultParams,C.props,d);if(C.data.value&&o.t.areEqual(O.defaultParams,C.props,h))return;const{value:a,assets:S}=yield O.obtain(m,u,h);u.customProperties.add(O.descriptor),u.customProperties.assets(O.descriptor,S),I(u,h,a)}),function(u,d){return l.apply(this,arguments)}),ref:(l,m)=>l.customProperties.reference(O.descriptor,m),get:l=>{var m;return null===(m=M(l))||void 0===m?void 0:m.data},set:(l,m={},u)=>{const d=M(l),s=o.t.merge(O.defaultParams,d.props,m);o.t.areEqual(O.defaultParams,d.props,s)||(I(l,s,u),l.customProperties.assets(O.descriptor))},props:l=>M(l).props};var l}c.createProvider=i,c.createSimple=function v(O,b,_){const M={value:o.t.Value(_,{isHidden:!0})};return i({label:(0,A.Mk)(O),descriptor:(0,t.e)({name:O}),isHidden:!0,type:b,defaultParams:M,getParams:()=>({value:o.t.Value(_,{isHidden:!0})}),isApplicable:()=>!0,obtain:(I=(0,e.A)(function*(l,m,u){return{...o.t.getDefaultValues(M),...u}}),function(m,u,d){return I.apply(this,arguments)})});var I}}(y||(y={}))},5439:(tn,Ue,n)=>{"use strict";n.d(Ue,{S:()=>y});var y,e=n(467),o=n(8277),r=n(9909),t=n(1692),A=n(7785);!function(c){function i(O){const b=O.descriptor.name,_="root"===O.type?"inheritedPropertyData":"currentPropertyData",M=l=>(b in l[_]||(l[_][b]={props:{...o.t.getDefaultValues(O.getParams(l))},data:r.xv.create(void 0)}),l[_][b]),I=(l,m,u)=>{const d=M(l);l[_][b]={props:m,data:r.xv.withValue(d.data,u)}};return{label:O.label,descriptor:O.descriptor,isHidden:O.isHidden,getParams:l=>{const m=o.t.clone(O.getParams(l));return o.t.setDefaultValues(m,M(l).props),m},defaultParams:O.defaultParams,isApplicable:O.isApplicable,attach:(l=(0,e.A)(function*(m,u,d={},s){s&&u.customPropertyDescriptors.reference(O.descriptor,!0),"root"===O.type&&(u=u.root);const C=M(u.root).props,h=M(u),a=o.t.merge(O.defaultParams,C,d);if(h.data.value&&o.t.areEqual(O.defaultParams,h.props,a))return;const{value:S,assets:D}=yield O.obtain(m,u,a);u.customPropertyDescriptors.add(O.descriptor),u.customPropertyDescriptors.assets(O.descriptor,D),I(u,a,S)}),function(u,d){return l.apply(this,arguments)}),ref:(l,m)=>l.customPropertyDescriptors.reference(O.descriptor,m),get:l=>M(l).data,set:(l,m={},u)=>{"root"===O.type&&(l=l.root);const d=M(l),s=o.t.merge(O.defaultParams,d.props,m);o.t.areEqual(O.defaultParams,d.props,s)||(I(l,s,u),l.customPropertyDescriptors.assets(O.descriptor))},props:l=>M(l).props};var l}c.createProvider=i,c.createSimple=function v(O,b,_){const M={value:o.t.Value(_,{isHidden:!0})};return i({label:(0,A.Mk)(O),descriptor:(0,t.e)({name:O}),isHidden:!0,type:b,defaultParams:M,getParams:()=>({value:o.t.Value(_,{isHidden:!0})}),isApplicable:()=>!0,obtain:(I=(0,e.A)(function*(l,m,u){return{...o.t.getDefaultValues(M),...u}}),function(m,u,d){return I.apply(this,arguments)})});var I}}(y||(y={}))},6948:(tn,Ue,n)=>{"use strict";n.d(Ue,{GE:()=>h,VL:()=>b,XM:()=>d,bf:()=>_,lo:()=>M,vM:()=>u,z$:()=>m}),n(7126),n(2434);var r=n(7767);function b(S,D,R){return"S"===(0,r.$X)(D,R)&&3===(0,r.IS)(S,D,R,"O")}function _(S,D,R){return"S"===(0,r.$X)(D,R)&&4===(0,r.IS)(S,D,R,"O")}function M(S,D,R){return"P"===(0,r.$X)(D,R)&&(0,r.IS)(S,D,R,"O")===(0,r.Hm)(S,D,R)}function m(S,D,R){let f=0;return"C"===(0,r.$X)(D,R)&&2===(0,r.IS)(S,D,R,"O")&&1===(0,r.IS)(S,D,R,"C")&&(0,r.LH)(S,D,R,(p,E)=>{"O"===(0,r.$X)(p,E)&&(0,r.Hm)(S,p,E)-(0,r.IS)(S,p,E,"H")==1&&(f+=1)}),2===f}function u(S,D,R){let f=0;return"C"===(0,r.$X)(D,R)&&3===(0,r.Hm)(S,D,R)&&3===(0,r.IS)(S,D,R,"N")&&(0,r.LH)(S,D,R,(p,E)=>{(0,r.Hm)(S,p,E)-(0,r.IS)(S,p,E,"H")==1&&(f+=1)}),2===f}function d(S,D,R){let f=0;return"C"===(0,r.$X)(D,R)&&3===(0,r.Hm)(S,D,R)&&2===(0,r.IS)(S,D,R,"N")&&1===(0,r.IS)(S,D,R,"C")&&(0,r.LH)(S,D,R,(p,E)=>{(0,r.Hm)(S,p,E)-(0,r.IS)(S,p,E,"H")==1&&(f+=1)}),2===f}const s=new Set(["N","O","S","F","CL","BR","I"]);function h(S,D,R){let f=!1;return(0,r.LH)(S,D,R,(p,E)=>{(function C(S){return s.has(S)})((0,r.$X)(p,E))&&(f=!0)}),f}},3024:(tn,Ue,n)=>{"use strict";n.d(Ue,{$Z:()=>I,Ci:()=>M,Fc:()=>A,G0:()=>t,UV:()=>c,kx:()=>y});var e=n(4490),o=n(4369),r=n(7767),t=function(l){return l[l.Spherical=0]="Spherical",l[l.Terminal=1]="Terminal",l[l.Linear=2]="Linear",l[l.Trigonal=3]="Trigonal",l[l.Tetrahedral=4]="Tetrahedral",l[l.TrigonalBiPyramidal=5]="TrigonalBiPyramidal",l[l.Octahedral=6]="Octahedral",l[l.SquarePlanar=7]="SquarePlanar",l[l.Unknown=8]="Unknown",l}(t||{});function A(l){switch(l){case t.Spherical:return"Spherical";case t.Terminal:return"Terminal";case t.Linear:return"Linear";case t.Trigonal:return"Trigonal";case t.Tetrahedral:return"Tetrahedral";case t.TrigonalBiPyramidal:return"Trigonal Bi-Pyramidal";case t.Octahedral:return"Octahedral";case t.SquarePlanar:return"Square Planar";case t.Unknown:return"Unknown"}}function y(l){switch(l){case 0:return t.Spherical;case 1:return t.Terminal;case 2:return t.Linear;case 3:return t.Trigonal;case 4:return t.Tetrahedral;default:return t.Unknown}}const c=new Map([[t.Linear,(0,e.pu)(180)],[t.Trigonal,(0,e.pu)(120)],[t.Tetrahedral,(0,e.pu)(109.4721)],[t.Octahedral,(0,e.pu)(90)]]),i=(0,o.eB)(),v=(0,o.eB)(),O=(0,o.eB)(),b=(0,o.eB)(),_=(0,o.eB)();function M(l,m,u,d,s){const C=[];return m.conformation.position(m.elements[u],O),d.conformation.position(d.elements[s],b),o.eB.sub(i,b,O),(0,r.LH)(l,m,u,(h,a)=>{"H"!==(0,r.$X)(h,a)&&(h.conformation.position(h.elements[a],_),o.eB.sub(v,_,O),C.push(o.eB.angle(i,v)))}),C}function I(l,m,u,d,s){m.conformation.position(m.elements[u],O),d.conformation.position(d.elements[s],b),o.eB.sub(i,b,O);const C=[(0,o.eB)(),(0,o.eB)()];let a,S,h=0;if((0,r.LH)(l,m,u,(D,R)=>{h>1||"H"!==(0,r.$X)(D,R)&&(a=D,S=R,D.conformation.position(D.elements[R],_),o.eB.sub(C[h++],_,O))}),1===h&&a&&S&&(0,r.LH)(l,a,S,(D,R)=>{h>1||D===m&&R===u||"H"!==(0,r.$X)(D,R)&&(D.conformation.position(D.elements[R],_),o.eB.sub(C[h++],_,O))}),2===h)return o.eB.cross(v,C[0],C[1]),Math.abs(Math.PI/2-o.eB.angle(v,i))}},7767:(tn,Ue,n)=>{"use strict";n.d(Ue,{$X:()=>r,B8:()=>m,Hm:()=>O,IS:()=>b,LH:()=>u,M0:()=>t,nZ:()=>A,q9:()=>y,tZ:()=>c,z7:()=>I});var e=n(2434);function r(s,C){return s.model.atomicHierarchy.atoms.type_symbol.value(s.elements[C])}function t(s,C){return s.model.atomicHierarchy.atoms.pdbx_formal_charge.value(s.elements[C])}function A(s,C){return s.model.atomicHierarchy.atoms.label_atom_id.value(s.elements[C])}function y(s,C){return s.model.atomicHierarchy.atoms.label_alt_id.value(s.elements[C])}function c(s,C){return s.model.atomicHierarchy.atoms.label_comp_id.value(s.elements[C])}function O(s,C,h){return function i(s,C,h){let a=0;const S=s.interUnitBonds.getEdgeIndices(h,C.id);for(let D=0,R=S.length;D<R;++D)e.I$.isCovalent(s.interUnitBonds.edges[S[D]].props.flag)&&(a+=1);return a}(s,C,h)+function v(s,C){let h=0;const{offset:a,edgeProps:{flags:S}}=s.bonds;for(let D=a[C],R=a[C+1];D<R;++D)e.I$.isCovalent(S[D])&&(h+=1);return h}(C,h)}function b(s,C,h,a){let S=0;return u(s,C,h,(D,R)=>{r(D,R)===a&&(S+=1)}),S}function I(s,C,h,a,S){return C===a?function _(s,C,h){const{offset:a,b:S,edgeProps:{flags:D}}=s.bonds;for(let R=a[C],f=a[C+1];R<f;++R)if(S[R]===h&&e.I$.isCovalent(D[R]))return!0;return!1}(C,h,S):function M(s,C,h,a,S){const D=s.interUnitBonds.getEdge(h,C.id,S,a.id);return D&&e.I$.isCovalent(D.props.flag)}(s,C,h,a,S)}function m(s,C,h){const{offset:a,b:S,edgeProps:{flags:D}}=s.bonds;for(let R=a[C],f=a[C+1];R<f;++R)e.I$.isCovalent(D[R])&&h(s,S[R])}function u(s,C,h,a){(function l(s,C,h,a){const S=s.interUnitBonds.getEdgeIndices(h,C.id);for(let D=0,R=S.length;D<R;++D){const f=s.interUnitBonds.edges[S[D]],p=s.unitMap.get(f.unitB);e.I$.isCovalent(f.props.flag)&&a(p,f.indexB)}})(s,C,h,a),m(C,h,a)}n(3543)},6713:(tn,Ue,n)=>{"use strict";n.d(Ue,{r:()=>c});var e=n(467),o=n(8277),r=n(9126),t=n(5439),A=n(1692);const y={...r.yB},c=t.S.createProvider({label:"Interactions",descriptor:(0,A.e)({name:"molstar_computed_interactions"}),type:"local",defaultParams:y,getParams:i=>y,isApplicable:i=>!i.isCoarseGrained,obtain:(i=(0,e.A)(function*(v,O,b){const _={...o.t.getDefaultValues(y),...b};return{value:yield(0,r.h3)(v,O,_)}}),function(O,b,_){return i.apply(this,arguments)})});var i},9469:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ls:()=>y,Tg:()=>r,X8:()=>A,XH:()=>i,dE:()=>o,mO:()=>v,tA:()=>t,y9:()=>O});var o,e=n(481);(o||(o={})).createElementsIndex=function _(M,I,l){const m=new Int32Array(l+1),u=new Int32Array(l),d=new Int32Array(l),{members:s,offsets:C}=I;for(let S=0,D=2*M.edgeCount;S<D;++S){const R=M.a[S],f=M.b[S];if(!(R>f)){for(let p=C[R],E=C[R+1];p<E;++p)++d[s[p]];for(let p=C[f],E=C[f+1];p<E;++p)++d[s[p]]}}let h=0;for(let S=0;S<l;S++)m[S]=h,h+=d[S];m[l]=h;const a=new Int32Array(h);for(let S=0,D=2*M.edgeCount;S<D;++S){const R=M.a[S],f=M.b[S];if(!(R>f)){for(let p=C[R],E=C[R+1];p<E;++p){const T=s[p];a[m[T]+u[T]]=S,++u[T]}for(let p=C[f],E=C[f+1];p<E;++p){const T=s[p];a[m[T]+u[T]]=S,++u[T]}}}return{indices:a,offsets:m}};class r extends e.Z{getContactIndicesForElement(_,M){return this.elementKeyIndex.get(this.getElementKey(_,M.id))||[]}getElementKey(_,M){return`${_}|${M}`}constructor(_,M){super(_),this.elementKeyIndex=new Map;for(let I=0,l=this.edges.length;I<l;++I){const{unitA:m,indexA:u}=this.edges[I],{offsets:d,members:s}=M.get(m);for(let C=d[u],h=d[u+1];C<h;++C){const a=this.getElementKey(s[C],m),S=this.elementKeyIndex.get(a);void 0===S?this.elementKeyIndex.set(a,[I]):S.push(I)}}}}var t=function(b){return b[b.None=0]="None",b[b.Filtered=1]="Filtered",b}(t||{}),A=function(b){return b[b.Unknown=0]="Unknown",b[b.Ionic=1]="Ionic",b[b.CationPi=2]="CationPi",b[b.PiStacking=3]="PiStacking",b[b.HydrogenBond=4]="HydrogenBond",b[b.HalogenBond=5]="HalogenBond",b[b.Hydrophobic=6]="Hydrophobic",b[b.MetalCoordination=7]="MetalCoordination",b[b.WeakHydrogenBond=8]="WeakHydrogenBond",b}(A||{});function y(b){switch(b){case A.HydrogenBond:return"Hydrogen Bond";case A.Hydrophobic:return"Hydrophobic Contact";case A.HalogenBond:return"Halogen Bond";case A.Ionic:return"Ionic Interaction";case A.MetalCoordination:return"Metal Coordination";case A.CationPi:return"Cation-Pi Interaction";case A.PiStacking:return"Pi Stacking";case A.WeakHydrogenBond:return"Weak Hydrogen Bond";case A.Unknown:return"Unknown Interaction"}}function i(b){switch(b){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}var v=function(b){return b[b.None=0]="None",b[b.QuaternaryAmine=1]="QuaternaryAmine",b[b.TertiaryAmine=2]="TertiaryAmine",b[b.Sulfonium=3]="Sulfonium",b[b.SulfonicAcid=4]="SulfonicAcid",b[b.Sulfate=5]="Sulfate",b[b.Phosphate=6]="Phosphate",b[b.Halocarbon=7]="Halocarbon",b[b.Guanidine=8]="Guanidine",b[b.Acetamidine=9]="Acetamidine",b[b.Carboxylate=10]="Carboxylate",b}(v||{});function O(b){switch(b){case v.None:return"None";case v.QuaternaryAmine:return"Quaternary Amine";case v.TertiaryAmine:return"Tertiary Amine";case v.Sulfonium:return"Sulfonium";case v.SulfonicAcid:return"Sulfonic Acid";case v.Sulfate:return"Sulfate";case v.Phosphate:return"Phosphate";case v.Halocarbon:return"Halocarbon";case v.Guanidine:return"Guanidine";case v.Acetamidine:return"Acetamidine";case v.Carboxylate:return"Carboxylate"}}},9126:(tn,Ue,n)=>{"use strict";n.d(Ue,{OG:()=>Go,yB:()=>Nn,h3:()=>Kn});var O,b,e=n(467),o=n(8277),r=n(9136),t=n(8382),A=n(5384),y=n(3543),c=n(9311),i=n(4369),v=n(9535);!function(ht){function Xt(rt,St){const vt=new Int32Array(St+1),mn=new Int32Array(St),zt=new Int32Array(St),{members:an,count:Vn,offsets:Fn}=rt;for(let tr=0,Tr=Fn[Vn];tr<Tr;++tr)++zt[an[tr]];let rr=0;for(let tr=0;tr<St;tr++)vt[tr]=rr,rr+=zt[tr];vt[St]=rr;const Vr=new Int32Array(rr);for(let tr=0;tr<Vn;++tr)for(let Tr=Fn[tr],oo=Fn[tr+1];Tr<oo;++Tr){const Gr=an[Tr];Vr[vt[Gr]+mn[Gr]]=tr,++mn[Gr]}return{indices:Vr,offsets:vt}}function on(rt,St){let vt;const{count:mn,types:zt}=rt,an=[];for(let Fn=0;Fn<mn;++Fn)St.has(zt[Fn])&&an.push(Fn);const Vn=y.SortedArray.ofSortedArray(an);return{indices:Vn,get lookup3d(){if(!vt){const Fn={x:rt.x,y:rt.y,z:rt.z,indices:Vn};vt=(0,A.Eh)(Fn,(0,v.r)(Fn))}return vt}}}ht.setPosition=function pt(rt,St,vt,mn){return i.eB.set(rt,mn.x[vt],mn.y[vt],mn.z[vt]),i.eB.transformMat4(rt,rt,St.conformation.operator.matrix),rt},ht.createElementsIndex=Xt,ht.create=function fn(rt,St){let vt,mn;return{...St,get lookup3d(){if(!vt){const zt={x:St.x,y:St.y,z:St.z,indices:y.CD.ofBounds(0,St.count)};vt=(0,A.Eh)(zt,(0,v.r)(zt))}return vt},get elementsIndex(){return mn||(mn=Xt(St,rt))},subset:zt=>on(St,zt)}},ht.createSubset=on,ht.Info=function En(rt,St,vt){const mn=c.F.get(rt).value;if(!mn||!mn.has(St.id))throw new Error("valence model required");return{unit:St,types:vt.types,feature:-1,x:vt.x,y:vt.y,z:vt.z,members:vt.members,offsets:vt.offsets,idealGeometry:mn.get(St.id).idealGeometry}},ht.position=function Tt(rt,St){return i.eB.set(rt,St.x[St.feature],St.y[St.feature],St.z[St.feature]),i.eB.transformMat4(rt,rt,St.unit.conformation.operator.matrix),rt};const Fe=(0,i.eB)(),He=(0,i.eB)();ht.distance=function Ye(rt,St){const mn=St.members[St.offsets[St.feature]];return rt.unit.conformation.position(rt.unit.elements[rt.members[rt.offsets[rt.feature]]],Fe),St.unit.conformation.position(St.unit.elements[mn],He),i.eB.distance(Fe,He)},ht.Provider=function ot(rt,St){return{types:new Set(rt),add:St}}}(O||(O={})),(b||(b={})).create=function pt(Xt=2048,fn=1024,on){const En=t.Gm.create(Float32Array,1,fn,on?on.x:Xt),Tt=t.Gm.create(Float32Array,1,fn,on?on.y:Xt),Fe=t.Gm.create(Float32Array,1,fn,on?on.z:Xt),He=t.Gm.create(Uint8Array,1,fn,on?on.types:Xt),Ye=t.Gm.create(Uint8Array,1,fn,on?on.groups:Xt),ot=t.Gm.create(Uint32Array,1,fn,on?on.offsets:Xt),rt=t.Gm.create(Uint32Array,1,fn,on?on.members:Xt),St={x:0,y:0,z:0,offset:0,count:0};return{startState:()=>{St.x=0,St.y=0,St.z=0,St.offset=rt.elementCount,St.count=0},pushMember:(vt,mn,zt,an)=>{t.Gm.add(rt,an),St.x+=vt,St.y+=mn,St.z+=zt,St.count+=1},finishState:(vt,mn)=>{const{count:zt}=St;0!==zt&&(t.Gm.add(He,vt),t.Gm.add(Ye,mn),t.Gm.add(En,St.x/zt),t.Gm.add(Tt,St.y/zt),t.Gm.add(Fe,St.z/zt),t.Gm.add(ot,St.offset))},add:(vt,mn,zt,an,Vn,Fn)=>{t.Gm.add(He,vt),t.Gm.add(Ye,mn),t.Gm.add(En,zt),t.Gm.add(Tt,an),t.Gm.add(Fe,Vn),t.Gm.add(ot,rt.elementCount),t.Gm.add(rt,Fn)},getFeatures:vt=>{t.Gm.add(ot,rt.elementCount);const mn=t.Gm.compact(En,!0),zt=t.Gm.compact(Tt,!0),an=t.Gm.compact(Fe,!0);return O.create(vt,{x:mn,y:zt,z:an,count:En.elementCount,types:t.Gm.compact(He,!0),groups:t.Gm.compact(Ye,!0),offsets:t.Gm.compact(ot,!0),members:t.Gm.compact(rt,!0)})}}};var l,m,_=n(9469),M=n(4506),I=n(481);(l||(l={})).create=function pt(Xt,fn){const on=[],En=[],Tt=[];return{add(Fe,He,Ye){on[on.length]=Fe,En[En.length]=He,Tt[Tt.length]=Ye},getContacts(){const Fe=new M.O.EdgeBuilder(Xt.count,on,En),He=new Int8Array(Fe.slotCount),Ye=new Int8Array(Fe.slotCount);for(let vt=0,mn=Fe.edgeCount;vt<mn;vt++)Fe.addNextEdge(),Fe.assignProperty(He,Tt[vt]);const ot=Fe.createGraph({type:He,flag:Ye});let rt;return Object.defineProperty(ot,"elementsIndex",{get:()=>rt||(rt=_.dE.createElementsIndex(ot,Xt,fn))})}}},function(ht){ht.create=function pt(){const Xt=new I.Z.Builder;return{startUnitPair(fn,on){Xt.startUnitPair(fn.id,on.id)},finishUnitPair(){Xt.finishUnitPair()},add(fn,on,En){Xt.add(fn,on,{type:En,flag:_.tA.None})},getContacts:fn=>new _.Tg(Xt.getMap(),fn)}}}(m||(m={}));var u=n(2008),d=n(6871),s=n(7767);const C={lineOfSightDistFactor:o.t.Numeric(1,{min:0,max:3,step:.1})},h=3;function a(ht,pt,Xt){const fn=pt.members[pt.offsets[pt.feature]],on=Xt.members[Xt.offsets[Xt.feature]];if(fn===on&&pt.unit===Xt.unit)return!1;const En=(0,s.q9)(pt.unit,fn),Tt=(0,s.q9)(Xt.unit,on);return!(En&&Tt&&En!==Tt||pt.unit===Xt.unit&&pt.unit.model.atomicHierarchy.residueAtomSegments.count>1&&pt.unit.residueIndex[pt.unit.elements[fn]]===Xt.unit.residueIndex[Xt.unit.elements[on]]||(0,s.z7)(ht,pt.unit,fn,Xt.unit,on))}function S(ht,pt,Xt,fn){const on=(0,s.q9)(ht,pt),En=(0,s.q9)(Xt,fn);return on&&En&&on!==En}function D(ht,pt){const{feature:Xt,offsets:fn,members:on}=pt;for(let En=fn[Xt],Tt=fn[Xt+1];En<Tt;++En)if(on[En]===ht)return!0;return!1}const R=(0,i.eB)(),f=(0,i.eB)(),p=(0,i.eB)(),E=(0,d.Jq)();function T(ht,pt,Xt,fn){const Tt=pt.members[pt.offsets[pt.feature]],Fe=Xt.members[Xt.offsets[Xt.feature]];O.position(f,pt),O.position(p,Xt),i.eB.scale(R,i.eB.add(R,f,p),.5);const He=fn*h,{count:Ye,indices:ot,units:rt,squaredDistances:St}=ht.lookup3d.find(R[0],R[1],R[2],He,E);if(0===Ye)return!0;for(let vt=0;vt<Ye;++vt){const mn=ot[vt],zt=rt[vt];if(!r.Nf.isAtomic(zt))continue;const an=(0,s.$X)(zt,mn);if("H"===an)continue;const Vn=(0,u.sO)(an);if(!(Vn*Vn*fn*fn<=St[vt]||S(zt,mn,pt.unit,Tt)||S(zt,mn,Xt.unit,Fe)||pt.unit===zt&&D(mn,pt)||Xt.unit===zt&&D(mn,Xt)||(zt.conformation.position(zt.elements[mn],R),i.eB.squaredDistance(R,f)<1||i.eB.squaredDistance(R,p)<1)))return!1}return!0}function w(ht,pt,Xt,fn,on,En){const{x:Tt,y:Fe,z:He}=Xt,{lookup3d:Ye,indices:ot}=Xt.subset(on.requiredFeatures),rt=O.Info(ht,pt,Xt),St={...rt},vt=En.lineOfSightDistFactor;for(let mn=0,zt=y.CD.size(ot);mn<zt;++mn){const an=y.CD.getAt(ot,mn),{count:Vn,indices:Fn,squaredDistances:rr}=Ye.find(Tt[an],Fe[an],He[an],on.maxDistance);if(0!==Vn){rt.feature=an;for(let Vr=0;Vr<Vn;++Vr){const tr=y.CD.getAt(ot,Fn[Vr]);if(tr<=an||(St.feature=tr,!a(ht,rt,St)))continue;const Tr=on.getType(ht,rt,St,rr[Vr]);Tr&&T(ht,rt,St,vt)&&fn.add(an,tr,Tr)}}}}const Q=(0,i.$I)();var V=n(3024),U=n(4490);const N={distanceMax:o.t.Numeric(4,{min:1,max:5,step:.1}),angleMax:o.t.Numeric(30,{min:0,max:60,step:1})},k=["CL","BR","I","AT"],$=["N","O","S"],J=["C","N","P","S"],de=(0,U.pu)(180),ye=(0,U.pu)(120),q=O.Provider([6],function H(ht,pt,Xt){const{elements:fn}=pt,{x:on,y:En,z:Tt}=pt.model.atomicConformation;for(let Fe=0,He=fn.length;Fe<He;++Fe){const Ye=(0,s.$X)(pt,Fe);k.includes(Ye)&&Xt.add(6,_.mO.None,on[fn[Fe]],En[fn[Fe]],Tt[fn[Fe]],Fe)}}),Y=O.Provider([7],function W(ht,pt,Xt){const{elements:fn}=pt,{x:on,y:En,z:Tt}=pt.model.atomicConformation;for(let Fe=0,He=fn.length;Fe<He;++Fe){const Ye=(0,s.$X)(pt,Fe);if($.includes(Ye)){let ot=!1;(0,s.LH)(ht,pt,Fe,(rt,St)=>{J.includes((0,s.$X)(rt,St))&&(ot=!0)}),ot&&Xt.add(7,_.mO.None,on[fn[Fe]],En[fn[Fe]],Tt[fn[Fe]],Fe)}}}),ee={name:"halogen-bonds",params:N,createTester:ht=>{const pt=function j(ht){return{angleMax:(0,U.pu)(ht.angleMax)}}(ht);return{maxDistance:ht.distanceMax,requiredFeatures:new Set([6,7]),getType:(Xt,fn,on)=>function Z(ht,pt,Xt,fn){const on=pt.types[pt.feature];if(!function te(ht,pt){return 7===ht&&6===pt||6===ht&&7===pt}(on,Xt.types[Xt.feature]))return;const[Tt,Fe]=6===on?[pt,Xt]:[Xt,pt],He=Tt.members[Tt.offsets[Tt.feature]],Ye=Fe.members[Fe.offsets[Fe.feature]],ot=(0,V.Ci)(ht,Tt.unit,He,Fe.unit,Ye);if(1!==ot.length||de-ot[0]>fn.angleMax)return;const rt=(0,V.Ci)(ht,Fe.unit,Ye,Tt.unit,He);return 0===rt.length||rt.some(St=>ye-St>fn.angleMax)?void 0:_.X8.HalogenBond}(Xt,fn,on,pt)}}};var g=n(2434);const _e={distanceMax:o.t.Numeric(3.5,{min:1,max:5,step:.1}),backbone:o.t.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:o.t.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:o.t.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:o.t.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:o.t.Numeric(45,{min:0,max:180,step:1})},xe={..._e,water:o.t.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:o.t.Numeric(4.1,{min:1,max:5,step:.1})},le={..._e};function Ae(ht,pt){const Xt=c.F.get(ht).value;if(!Xt)throw Error("expected valence model to be available");const fn=Xt.get(pt.id);if(!fn)throw Error("expected valence model for unit to be available");return fn}function Re(ht,pt){const{elementAromaticRingIndices:Xt,all:fn}=ht.rings,on=Xt.get(pt);if(void 0===on)return!1;for(let En=0,Tt=on.length;En<Tt;++En){const Fe=fn[on[En]];for(let He=0,Ye=Fe.length;He<Ye;++He){const ot=(0,s.$X)(ht,Fe[He]);if("N"===ot||"O"===ot)return!0}}return!1}function we(ht,pt){return 2===ht.model.atomicHierarchy.derived.residue.moleculeType[ht.residueIndex[ht.elements[pt]]]}function Oe(ht,pt){return g.DB.has((0,s.nZ)(ht,pt))}function Ve(ht,pt){return"HIS"===(0,s.tZ)(ht,pt)&&"N"===(0,s.$X)(ht,pt)&&function Se(ht,pt){return ht.rings.elementRingIndices.has(pt)}(ht,pt)}function Te(ht){return{includeBackbone:ht.backbone,maxAccAngleDev:(0,U.pu)(ht.accAngleDevMax),maxDonAngleDev:(0,U.pu)(ht.donAngleDevMax),maxAccOutOfPlaneAngle:(0,U.pu)(ht.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:(0,U.pu)(ht.donOutOfPlaneAngleMax)}}const ue=(0,U.pu)(120);function re(ht,pt,Xt,fn){const on=pt.members[pt.offsets[pt.feature]],En=Xt.members[Xt.offsets[Xt.feature]];if(!fn.includeBackbone&&function Ne(ht,pt,Xt,fn){return Oe(ht,pt)&&Oe(Xt,fn)}(pt.unit,on,Xt.unit,En))return;const Tt=(0,V.Ci)(ht,pt.unit,on,Xt.unit,En),Fe=V.UV.get(pt.idealGeometry[on])||ue;if(Tt.some(ot=>Math.abs(Fe-ot)>fn.maxDonAngleDev))return;if(pt.idealGeometry[on]===V.G0.Trigonal){const ot=(0,V.$Z)(ht,pt.unit,on,Xt.unit,En);if(void 0!==ot&&ot>fn.maxDonOutOfPlaneAngle)return}const He=(0,V.Ci)(ht,Xt.unit,En,pt.unit,on),Ye=V.UV.get(Xt.idealGeometry[En])||ue;if(!He.some(ot=>Ye-ot>fn.maxAccAngleDev)){if(Xt.idealGeometry[En]===V.G0.Trigonal){const ot=(0,V.$Z)(ht,Xt.unit,En,pt.unit,on);if(void 0!==ot&&ot>fn.maxAccOutOfPlaneAngle)return}return!0}}const se=O.Provider([4],function Be(ht,pt,Xt){const{totalH:fn}=Ae(ht,pt),{elements:on}=pt,{x:En,y:Tt,z:Fe}=pt.model.atomicConformation;for(let He=0,Ye=on.length;He<Ye;++He){const ot=(0,s.$X)(pt,He);(Ve(pt,He)||fn[He]>0&&("N"===ot||"O"===ot||"S"===ot))&&Xt.add(4,_.mO.None,En[on[He]],Tt[on[He]],Fe[on[He]],He)}}),ae=O.Provider([9],function Ce(ht,pt,Xt){const{totalH:fn}=Ae(ht,pt),{elements:on}=pt,{x:En,y:Tt,z:Fe}=pt.model.atomicConformation;for(let He=0,Ye=on.length;He<Ye;++He)"C"===(0,s.$X)(pt,He)&&fn[He]>0&&((0,s.IS)(ht,pt,He,"N")>0||(0,s.IS)(ht,pt,He,"O")>0||Re(pt,He))&&Xt.add(9,_.mO.None,En[on[He]],Tt[on[He]],Fe[on[He]],He)}),ge=O.Provider([5],function ke(ht,pt,Xt){const{charge:fn,implicitH:on,idealGeometry:En}=Ae(ht,pt),{elements:Tt}=pt,{x:Fe,y:He,z:Ye}=pt.model.atomicConformation,ot=rt=>{Xt.add(5,_.mO.None,Fe[Tt[rt]],He[Tt[rt]],Ye[Tt[rt]],rt)};for(let rt=0,St=Tt.length;rt<St;++rt){const vt=(0,s.$X)(pt,rt);if("O"===vt)ot(rt);else if("N"===vt){if(Ve(pt,rt))ot(rt);else if(fn[rt]<1){const mn=(0,s.Hm)(ht,pt,rt)+on[rt],zt=En[rt];(zt===V.G0.Tetrahedral&&mn<4||zt===V.G0.Trigonal&&mn<3||zt===V.G0.Linear&&mn<2)&&ot(rt)}}else if("S"===vt){const mn=(0,s.tZ)(pt,rt);("CYS"===mn||"MET"===mn||-1===(0,s.M0)(pt,rt))&&ot(rt)}}}),Ie={name:"hydrogen-bonds",params:xe,createTester:ht=>{const pt=Math.max(ht.distanceMax,ht.sulfurDistanceMax),Xt=function ie(ht){return{...Te(ht),includeWater:ht.water,maxSulfurDistSq:ht.sulfurDistanceMax*ht.sulfurDistanceMax,maxDistSq:ht.distanceMax*ht.distanceMax}}(ht);return{maxDistance:pt,requiredFeatures:new Set([4,5]),getType:(fn,on,En,Tt)=>function ve(ht,pt,Xt,fn,on){const Tt=Xt.types[Xt.feature];if(!function ne(ht,pt){return 5===ht&&4===pt||4===ht&&5===pt}(pt.types[pt.feature],Tt))return;const[Fe,He]=5===Tt?[pt,Xt]:[Xt,pt],Ye=Fe.members[Fe.offsets[Fe.feature]],ot=He.members[He.offsets[He.feature]];return fn>("S"===(0,s.$X)(Fe.unit,Ye)||"S"===(0,s.$X)(He.unit,ot)?on.maxSulfurDistSq:on.maxDistSq)||!on.includeWater&&function K(ht,pt,Xt,fn){return we(ht,pt)&&we(Xt,fn)}(Fe.unit,Ye,He.unit,ot)||!re(ht,Fe,He,on)?void 0:_.X8.HydrogenBond}(fn,on,En,Tt,Xt)}}},Le={name:"weak-hydrogen-bonds",params:le,createTester:ht=>{const pt=Te(ht);return{maxDistance:ht.distanceMax,requiredFeatures:new Set([9,5]),getType:(Xt,fn,on,En)=>function ce(ht,pt,Xt,fn,on){const Tt=Xt.types[Xt.feature];if(!function be(ht,pt){return 9===ht&&5===pt||5===ht&&9===pt}(pt.types[pt.feature],Tt))return;const[Fe,He]=5===Tt?[pt,Xt]:[Xt,pt];return re(ht,Fe,He,on)?_.X8.WeakHydrogenBond:void 0}(Xt,fn,on,0,pt)}}};var nt=n(6948);const je={distanceMax:o.t.Numeric(5,{min:0,max:8,step:.1})},Lt={distanceMax:o.t.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:o.t.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:o.t.Numeric(30,{min:0,max:180,step:1})},Je={distanceMax:o.t.Numeric(6,{min:1,max:8,step:.1}),offsetMax:o.t.Numeric(2,{min:0,max:4,step:.1})},en=["ARG","HIS","LYS"],Bt=["GLU","ASP"];function pn(ht,pt){const Xt=c.F.get(ht).value;if(!Xt)throw Error("expected valence model to be available");const fn=Xt.get(pt.id);if(!fn)throw Error("expected valence model for unit to be available");return fn}const Kt=(0,i.eB)(),sn=(0,i.eB)(),yt=(0,i.eB)(),At=(0,i.eB)(),Gt=(0,i.eB)(),rn=(0,i.eB)();function tt(ht,pt){const{unit:Xt,feature:fn,offsets:on,members:En}=pt,{elements:Tt}=Xt,Fe=on[fn];return pt.unit.conformation.position(Tt[En[Fe]],yt),pt.unit.conformation.position(Tt[En[Fe+1]],At),pt.unit.conformation.position(Tt[En[Fe+2]],Gt),i.eB.triangleNormal(ht,yt,At,Gt)}const Mt=function(ht,pt,Xt){return O.position(yt,ht),O.position(At,pt),i.eB.sub(Gt,yt,At),i.eB.projectOnPlane(rn,Gt,Xt),i.eB.add(rn,rn,At),i.eB.distance(rn,At)},jt=(0,U.pu)(180),It=(0,U.pu)(90),Dt=(0,i.eB)(),Ct=(0,i.eB)();const yn=O.Provider([2],function mt(ht,pt,Xt){const{charge:fn}=pn(ht,pt),{elements:on}=pt,{x:En,y:Tt,z:Fe}=pt.model.atomicConformation,He=new Set,{label_comp_id:Ye}=pt.model.atomicHierarchy.atoms,ot=y.hT.transientSegments(pt.model.atomicHierarchy.residueAtomSegments,on);for(;ot.hasNext;){const{index:rt,start:St,end:vt}=ot.move(),mn=Ye.value(pt.model.atomicHierarchy.residueAtomSegments.offsets[rt]);if(Bt.includes(mn)){Xt.startState();for(let zt=St;zt<vt;++zt)"O"===(0,s.$X)(pt,zt)&&!g.DB.has((0,s.nZ)(pt,zt))&&Xt.pushMember(En[on[zt]],Tt[on[zt]],Fe[on[zt]],zt);Xt.finishState(2,_.mO.None)}else if(g.ii.has(mn))for(let zt=St;zt<vt;++zt)(0,nt.lo)(ht,pt,zt)&&(Xt.startState(),(0,s.LH)(ht,pt,zt,(an,Vn)=>{"O"===(0,s.$X)(pt,Vn)&&Xt.pushMember(En[on[Vn]],Tt[on[Vn]],Fe[on[Vn]],Vn)}),Xt.finishState(2,_.mO.Phosphate));else if(!g.px.has(mn)){for(let zt=St;zt<vt;++zt){Xt.startState(),"N"===(0,s.$X)(pt,zt)&&!g.DB.has((0,s.nZ)(pt,zt))&&Xt.pushMember(En[on[zt]],Tt[on[zt]],Fe[on[zt]],zt),Xt.finishState(2,_.mO.None);let an=_.mO.None;(0,nt.VL)(ht,pt,zt)?an=_.mO.SulfonicAcid:(0,nt.lo)(ht,pt,zt)?an=_.mO.Phosphate:(0,nt.bf)(ht,pt,zt)?an=_.mO.Sulfate:(0,nt.z$)(ht,pt,zt)&&(an=_.mO.Carboxylate),an&&(Xt.startState(),(0,s.LH)(ht,pt,zt,(Vn,Fn)=>{"O"===(0,s.$X)(pt,Fn)&&(He.add(Fn),Xt.pushMember(En[on[Fn]],Tt[on[Fn]],Fe[on[Fn]],Fn))}),Xt.finishState(2,an))}for(let zt=St;zt<vt;++zt)fn[zt]<0&&!He.has(zt)&&Xt.add(2,_.mO.None,En[on[zt]],Tt[on[zt]],Fe[on[zt]],zt)}}}),Zt=O.Provider([1],function $e(ht,pt,Xt){const{charge:fn}=pn(ht,pt),{elements:on}=pt,{x:En,y:Tt,z:Fe}=pt.model.atomicConformation,He=new Set,{label_comp_id:Ye}=pt.model.atomicHierarchy.atoms,ot=y.hT.transientSegments(pt.model.atomicHierarchy.residueAtomSegments,on);for(;ot.hasNext;){const{index:rt,start:St,end:vt}=ot.move(),mn=Ye.value(pt.model.atomicHierarchy.residueAtomSegments.offsets[rt]);if(en.includes(mn)){Xt.startState();for(let zt=St;zt<vt;++zt)"N"===(0,s.$X)(pt,zt)&&!g.DB.has((0,s.nZ)(pt,zt))&&Xt.pushMember(En[on[zt]],Tt[on[zt]],Fe[on[zt]],zt);Xt.finishState(1,_.mO.None)}else if(!g.px.has(mn)){He.clear();for(let zt=St;zt<vt;++zt){let an=_.mO.None;(0,nt.vM)(ht,pt,zt)?an=_.mO.Guanidine:(0,nt.XM)(ht,pt,zt)&&(an=_.mO.Acetamidine),an&&(Xt.startState(),(0,s.LH)(ht,pt,zt,(Vn,Fn)=>{"N"===(0,s.$X)(pt,Fn)&&(He.add(Fn),Xt.pushMember(En[on[Fn]],Tt[on[Fn]],Fe[on[Fn]],Fn))}),Xt.finishState(1,an))}for(let zt=St;zt<vt;++zt)fn[zt]>0&&!He.has(zt)&&Xt.add(1,_.mO.None,En[on[zt]],Tt[on[zt]],Fe[on[zt]],zt)}}}),kt=O.Provider([3],function _t(ht,pt,Xt){const{elements:fn}=pt,{x:on,y:En,z:Tt}=pt.model.atomicConformation;for(const Fe of pt.rings.aromaticRings){const He=pt.rings.all[Fe];Xt.startState();for(let Ye=0,ot=He.length;Ye<ot;++Ye){const rt=He[Ye];Xt.pushMember(on[fn[rt]],En[fn[rt]],Tt[fn[rt]],rt)}Xt.finishState(3,_.mO.None)}}),Ot={name:"ionic",params:je,createTester:ht=>{const pt=function nn(ht){return{distanceMaxSq:ht.distanceMax*ht.distanceMax}}(ht);return{maxDistance:ht.distanceMax,requiredFeatures:new Set([2,1]),getType:(Xt,fn,on,En)=>function $t(ht,pt,Xt,fn,on){if(function Me(ht,pt){return 2===ht&&1===pt||1===ht&&2===pt}(pt.types[pt.feature],Xt.types[Xt.feature])&&function gt(ht,pt,Xt){const{feature:fn,offsets:on,members:En}=ht,{feature:Tt,offsets:Fe,members:He}=pt;for(let Ye=on[fn],ot=on[fn+1];Ye<ot;++Ye){ht.unit.conformation.position(ht.unit.elements[En[Ye]],Kt);for(let St=Fe[Tt],vt=Fe[Tt+1];St<vt;++St)if(pt.unit.conformation.position(pt.unit.elements[He[St]],sn),i.eB.squaredDistance(Kt,sn)<Xt)return!0}return!1}(pt,Xt,on.distanceMaxSq))return _.X8.Ionic}(0,fn,on,0,pt)}}},An={name:"pi-stacking",params:Lt,createTester:ht=>{const pt=function bn(ht){return{offsetMax:ht.offsetMax,angleDevMax:(0,U.pu)(ht.angleDevMax)}}(ht);return{maxDistance:ht.distanceMax,requiredFeatures:new Set([3]),getType:(Xt,fn,on,En)=>function Vt(ht,pt,Xt,fn,on){if(function Ke(ht,pt){return 3===ht&&3===pt}(pt.types[pt.feature],Xt.types[Xt.feature])){tt(Dt,pt),tt(Ct,Xt);const Fe=i.eB.angle(Dt,Ct);if(Math.min(Mt(pt,Xt,Ct),Mt(Xt,pt,Dt))<=on.offsetMax){if(Fe<=on.angleDevMax||Fe>=jt-on.angleDevMax)return _.X8.PiStacking;if(Fe<=on.angleDevMax+It&&Fe>=It-on.angleDevMax)return _.X8.PiStacking}}}(0,fn,on,0,pt)}}},jn={name:"cation-pi",params:Je,createTester:ht=>{const pt=function Dn(ht){return{offsetMax:ht.offsetMax}}(ht);return{maxDistance:ht.distanceMax,requiredFeatures:new Set([3,1]),getType:(Xt,fn,on,En)=>function Wt(ht,pt,Xt,fn,on){const En=pt.types[pt.feature];if(function ut(ht,pt){return 3===ht&&1===pt||1===ht&&3===pt}(En,Xt.types[Xt.feature])){const[Fe,He]=3===En?[pt,Xt]:[Xt,pt];if(tt(Dt,Fe),Mt(He,Fe,Dt)<=on.offsetMax)return _.X8.CationPi}}(0,fn,on,0,pt)}}},On={distanceMax:o.t.Numeric(4,{min:1,max:5,step:.1})},or=O.Provider([8],function fr(ht,pt,Xt){const{elements:fn}=pt,{x:on,y:En,z:Tt}=pt.model.atomicConformation;for(let Fe=0,He=fn.length;Fe<He;++Fe){const Ye=(0,s.$X)(pt,Fe);let ot=!1;"C"===Ye?(ot=!0,(0,s.LH)(ht,pt,Fe,(rt,St)=>{const vt=(0,s.$X)(rt,St);"C"!==vt&&"H"!==vt&&(ot=!1)})):"F"===Ye&&(ot=!0),ot&&Xt.add(8,_.mO.None,on[fn[Fe]],En[fn[Fe]],Tt[fn[Fe]],Fe)}}),Nr={name:"hydrophobic",params:On,createTester:ht=>({maxDistance:ht.distanceMax,requiredFeatures:new Set([8]),getType:(pt,Xt,fn,on)=>function Pr(ht,pt,Xt,fn){if(!function Dr(ht,pt){return 8===ht&&8===pt}(pt.types[pt.feature],Xt.types[Xt.feature]))return;const Fe=Xt.members[Xt.offsets[Xt.feature]];return"F"!==(0,s.$X)(pt.unit,pt.members[pt.offsets[pt.feature]])||"F"!==(0,s.$X)(Xt.unit,Fe)?_.X8.Hydrophobic:void 0}(0,Xt,fn)})};var Ir=n(9986),Or=n(7126);const Jr={distanceMax:o.t.Numeric(3,{min:1,max:5,step:.1})},To=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function ct(ht){return!g.DB.has(ht)}function dt(ht){return g.DB.has(ht)}function Yt(ht){return g.HA.has(ht)}function xn(ht,pt){return 12===ht?11===pt||12===pt:13===ht?10===pt:void 0}const er=O.Provider([13,12],function un(ht,pt,Xt){const{elements:fn}=pt,{x:on,y:En,z:Tt}=pt.model.atomicConformation;for(let Fe=0,He=fn.length;Fe<He;++Fe){const Ye=(0,s.$X)(pt,Fe);let ot=0;To.includes(Ye)?ot=13:((0,Or.Hx)(Ye)||"ZN"===Ye||"CD"===Ye)&&(ot=12),ot&&Xt.add(ot,_.mO.None,on[fn[Fe]],En[fn[Fe]],Tt[fn[Fe]],Fe)}}),ir=O.Provider([10,11],function cn(ht,pt,Xt){const{elements:fn}=pt,{x:on,y:En,z:Tt}=pt.model.atomicConformation;for(let Fe=0,He=fn.length;Fe<He;++Fe){const Ye=(0,s.$X)(pt,Fe),ot=(0,s.tZ)(pt,Fe),rt=(0,s.nZ)(pt,Fe);let St=!1,vt=!1;const mn=g.uA.has(ot),zt=g.ii.has(ot);mn||zt?mn?"O"===Ye?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(ot)&&ct(rt)||dt(rt))&&(St=!0,vt=!0):"S"!==Ye||"CYS"!==ot&&"MET"!==ot?"N"===Ye&&"HIS"===ot&&ct(rt)&&(St=!0):(St=!0,vt=!0):zt&&("O"===Ye&&Yt(rt)?(St=!0,vt=!0):["N3","N4","N7"].includes(rt)?St=!0:["O2","O4","O6"].includes(rt)&&(St=!0,vt=!0)):(0,Or.lb)(Ye)||"O"===Ye||"S"===Ye?(St=!0,vt=!0):"N"===Ye&&(St=!0),St&&Xt.add(11,_.mO.None,on[fn[Fe]],En[fn[Fe]],Tt[fn[Fe]],Fe),vt&&Xt.add(10,_.mO.None,on[fn[Fe]],En[fn[Fe]],Tt[fn[Fe]],Fe)}}),Yn={name:"metal-coordination",params:Jr,createTester:ht=>({maxDistance:ht.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:(pt,Xt,fn,on)=>function Rn(ht,pt,Xt,fn){const on=pt.types[pt.feature],En=Xt.types[Xt.feature];if(xn(on,En)||xn(En,on))return _.X8.MetalCoordination}(0,Xt,fn)})};function vr(ht,pt){const{contacts:Xt}=pt,fn=function(Ye,ot,rt,St,vt){const[mn,zt]=St.get(rt)||[1/0,-1];Ye<mn?(-1!==zt&&vt(zt),St.set(rt,[Ye,ot])):vt(ot)};function on(Ye,ot,rt,St,vt){const mn=ot.members[ot.offsets[ot.feature]],zt=rt.members[rt.offsets[rt.feature]],an=ot.unit.getResidueIndex(mn),Vn=rt.unit.getResidueIndex(zt),Fn=`${mn}|${ot.unit.id}|${Vn}|${rt.unit.id}|A`,rr=`${zt}|${rt.unit.id}|${an}|${ot.unit.id}|B`,Vr=O.distance(ot,rt);fn(Vr,Ye,Fn,St,vt),fn(Vr,Ye,rr,St,vt)}const En=new Map,Tt=Ye=>Xt.edges[Ye].props.flag=_.tA.Filtered;let Fe,He;return{isApplicable:Ye=>Ye===_.X8.Hydrophobic,handleInterContact:(Ye,ot,rt)=>{on(Ye,ot,rt,En,Tt)},startUnit:(Ye,ot,rt)=>{Fe=new Map,He=St=>ot.edgeProps.flag[St]=_.tA.Filtered},handleIntraContact:(Ye,ot,rt)=>{on(Ye,ot,rt,Fe,He)}}}function Hr(ht,pt){const{contacts:Xt}=pt,fn=(on,En)=>{const Tt=9===on.types[on.feature]?En:on,Fe=Tt.members[Tt.offsets[Tt.feature]],{edgeProps:{type:He},elementsIndex:{offsets:Ye,indices:ot}}=pt.unitsContacts.get(Tt.unit.id);for(let St=Ye[Fe],vt=Ye[Fe+1];St<vt;++St)if(He[ot[St]]===_.X8.HydrogenBond)return!0;const rt=Xt.getEdgeIndices(Tt.feature,Tt.unit.id);for(let St=0,vt=rt.length;St<vt;++St)if(Xt.edges[rt[St]].props.type===_.X8.HydrogenBond)return!0;return!1};return{isApplicable:on=>on===_.X8.WeakHydrogenBond,handleInterContact:(on,En,Tt)=>{fn(En,Tt)&&(Xt.edges[on].props.flag=_.tA.Filtered)},startUnit:()=>{},handleIntraContact:(on,En,Tt)=>{if(fn(En,Tt)){const{flag:Fe}=pt.unitsContacts.get(En.unit.id).edgeProps;Fe[on]=_.tA.Filtered}}}}function Mr(ht,pt,Xt,fn,on){const{offsets:En,feature:Tt}=Xt,{offsets:Fe,feature:He}=fn;for(let Ye=En[Tt],ot=En[Tt+1];Ye<ot;++Ye){const St=on.getContactIndicesForElement(Xt.members[Ye],Xt.unit);for(let vt=0,mn=St.length;vt<mn;++vt){const zt=St[vt];if(ht.includes(on.edges[zt].props.type))for(let an=Fe[He],Vn=Fe[He+1];an<Vn;++an)if(on.getContactIndicesForElement(fn.members[an],fn.unit).includes(zt))return void(on.edges[pt].props.flag=_.tA.Filtered)}}}function Fr(ht,pt,Xt,fn,on){const{edgeProps:{type:En,flag:Tt},elementsIndex:{offsets:Fe,indices:He}}=on,{offsets:Ye,feature:ot}=Xt,{offsets:rt,feature:St}=fn;for(let vt=Ye[ot],mn=Ye[ot+1];vt<mn;++vt){const zt=Xt.members[vt];for(let an=Fe[zt],Vn=Fe[zt+1];an<Vn;++an){const Fn=He[an];if(ht.includes(En[Fn]))for(let rr=rt[St],Vr=rt[St+1];rr<Vr;++rr){const tr=fn.members[rr];for(let Tr=Fe[tr],oo=Fe[tr+1];Tr<oo;++Tr)if(Fn===He[Tr])return void(Tt[pt]=_.tA.Filtered)}}}}function Sr(ht,pt){const{contacts:Xt}=pt;return{isApplicable:fn=>fn===_.X8.Ionic,handleInterContact:(fn,on,En)=>{Mr([_.X8.HydrogenBond,_.X8.WeakHydrogenBond],fn,on,En,Xt)},startUnit:()=>{},handleIntraContact:(fn,on,En)=>{Fr([_.X8.HydrogenBond,_.X8.WeakHydrogenBond],fn,on,En,pt.unitsContacts.get(on.unit.id))}}}function Ur(ht,pt){const{contacts:Xt}=pt;return{isApplicable:fn=>fn===_.X8.Hydrophobic||fn===_.X8.CationPi,handleInterContact:(fn,on,En)=>{Mr([_.X8.PiStacking],fn,on,En,Xt)},startUnit:()=>{},handleIntraContact:(fn,on,En)=>{Fr([_.X8.PiStacking],fn,on,En,pt.unitsContacts.get(on.unit.id))}}}function Ro(ht,pt){const{contacts:Xt}=pt;return{isApplicable:fn=>fn===_.X8.Ionic,handleInterContact:(fn,on,En)=>{Mr([_.X8.MetalCoordination],fn,on,En,Xt)},startUnit:()=>{},handleIntraContact:(fn,on,En)=>{Fr([_.X8.MetalCoordination],fn,on,En,pt.unitsContacts.get(on.unit.id))}}}var Go,ro=n(364),po=n(6290),so=n(3246),ho=n(3917),Bo=n(1372);!function(ht){function on(ot,rt){const{unitA:St,indexA:vt,unitB:mn,indexB:zt}=rt,{contacts:an,unitsContacts:Vn}=ot;if(St===mn){const Fn=Vn.get(St.id),rr=Fn.getDirectedEdgeIndex(vt,zt);return(0,_.Ls)(Fn.edgeProps.type[rr])}{const Fn=an.getEdgeIndex(vt,St.id,zt,mn.id);return(0,_.Ls)(an.edges[Fn].props.type)}}function He(ot,rt,St){const{unitsFeatures:vt}=ot;return po.p.fromPairProvider(rt.length,(mn,zt,an)=>{const Vn=rt[mn];O.setPosition(zt,Vn.unitA,Vn.indexA,vt.get(Vn.unitA.id)),O.setPosition(an,Vn.unitB,Vn.indexB,vt.get(Vn.unitB.id))},St)}function Ye(ot,rt,St){const vt=St[0];if(void 0===vt)return"";const{unitA:mn,indexA:zt,unitB:an,indexB:Vn}=vt,{unitsFeatures:Fn}=rt,{members:rr,offsets:Vr}=Fn.get(mn.id),{members:tr,offsets:Tr}=Fn.get(an.id),oo={granularity:"element"};return(Vr[zt+1]-Vr[zt]>1||Tr[Vn+1]-Tr[Vn]>1)&&(oo.granularity="residue"),[on(rt,vt),(0,ho.CR)(r.gn.Location(ot,mn,rr[Vr[zt]],ot,an,tr[Tr[Vn]]),oo)].join("</br>")}ht.Location=function pt(ot,rt,St,vt,mn,zt){return(0,ro.cG)("interactions",{structure:rt,interactions:ot},{unitA:St,indexA:vt,unitB:mn,indexB:zt})},ht.isLocation=function Xt(ot){return!!ot&&"data-location"===ot.kind&&"interactions"===ot.tag},ht.areLocationsEqual=function fn(ot,rt){return ot.data.structure===rt.data.structure&&ot.data.interactions===rt.data.interactions&&ot.element.indexA===rt.element.indexA&&ot.element.indexB===rt.element.indexB&&ot.element.unitA===rt.element.unitA&&ot.element.unitB===rt.element.unitB},ht.locationLabel=function En(ot){return on(ot.data.interactions,ot.element)},ht.Loci=function Tt(ot,rt,St){return(0,so.g9)("interactions",{structure:ot,interactions:rt},St,vt=>He(rt,St,vt),()=>Ye(ot,rt,St))},ht.isLoci=function Fe(ot){return!!ot&&"data-loci"===ot.kind&&"interactions"===ot.tag},ht.getBoundingSphere=He,ht.getLabel=Ye}(Go||(Go={}));const Wo=[se,ae,ge,yn,Zt,kt,q,Y,or,er,ir],We={ionic:Ot,"pi-stacking":An,"cation-pi":jn,"halogen-bonds":ee,"hydrogen-bonds":Ie,"weak-hydrogen-bonds":Le,hydrophobic:Nr,"metal-coordination":Yn},Sn=function Pt(ht=[]){const pt=Object.create(null);return Object.keys(We).forEach(Xt=>{pt[Xt]=o.t.MappedStatic(ht.includes(Xt)?"on":"off",{on:o.t.Group(We[Xt].params),off:o.t.Group({})},{cycle:!0})}),pt}(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),Nn={providers:o.t.Group(Sn,{isFlat:!0}),contacts:o.t.Group(C,{label:"Advanced Options"})};function Kn(ht,pt,Xt){return dr.apply(this,arguments)}function dr(){return dr=(0,e.A)(function*(ht,pt,Xt){const fn={...o.t.getDefaultValues(Nn),...Xt};yield c.F.attach(ht,pt);const on=[];(0,Bo.mX)(We).forEach(rt=>{const{name:St,params:vt}=fn.providers[rt];"on"===St&&on.push(We[rt].createTester(vt))});const En=new Set;on.forEach(rt=>Ir.M.add(En,rt.requiredFeatures));const Tt=Wo.filter(rt=>Ir.M.areIntersecting(En,rt.types)),Fe=y.Yz.Mutable(),He=y.Yz.Mutable();for(let rt=0,St=pt.unitSymmetryGroups.length;rt<St;++rt){const vt=pt.unitSymmetryGroups[rt];ht.runtime.shouldUpdate&&(yield ht.runtime.update({message:"computing interactions",current:rt,max:St}));const mn=xr(pt,vt.units[0],Tt),zt=Ft(pt,vt.units[0],mn,on,fn.contacts);for(let an=0,Vn=vt.units.length;an<Vn;++an){const Fn=vt.units[an];Fe.set(Fn.id,mn),He.set(Fn.id,zt)}}const Ye=function Qt(ht,pt,Xt,fn){const on=m.create();return r.oE.eachUnitPair(ht,(En,Tt)=>{const Fe=pt.get(En.id),He=pt.get(Tt.id);!function G(ht,pt,Xt,fn,on,En,Tt,Fe){const{count:He,x:Ye,y:ot,z:rt}=Xt,{lookup3d:St}=on,vt=i.$I.mul(Q,fn.conformation.operator.inverse,pt.conformation.operator.matrix),mn=!i.$I.isIdentity(vt),zt=(0,i.eB)(),an=Math.max(...Tt.map(oo=>oo.maxDistance)),{center:Vn,radius:Fn}=St.boundary.sphere,rr=(Fn+an)*(Fn+an),Vr=Fe.lineOfSightDistFactor,tr=O.Info(ht,pt,Xt),Tr=O.Info(ht,fn,on);En.startUnitPair(pt,fn);for(let oo=0;oo<He;++oo){if(i.eB.set(zt,Ye[oo],ot[oo],rt[oo]),mn&&i.eB.transformMat4(zt,zt,vt),i.eB.squaredDistance(zt,Vn)>rr)continue;const{indices:Gr,count:Ao,squaredDistances:yo}=St.find(zt[0],zt[1],zt[2],an);if(0!==Ao){tr.feature=oo;for(let vo=0;vo<Ao;++vo){const Kr=Gr[vo];if(Tr.feature=Kr,!a(ht,tr,Tr))continue;const Do=yo[vo];for(const lo of Tt)if(Do<lo.maxDistance*lo.maxDistance){const So=lo.getType(ht,tr,Tr,Do);if(So&&T(ht,tr,Tr,Vr)){En.add(oo,Kr,So);break}}}}}En.finishUnitPair()}(ht,En,Fe,Tt,He,on,Xt,fn)},{maxRadius:Math.max(...Xt.map(En=>En.maxDistance)),validUnit:En=>r.Nf.isAtomic(En),validUnitPair:(En,Tt)=>r.oE.validUnitPair(ht,En,Tt)}),on.getContacts(pt)}(pt,Fe,on,fn.contacts),ot={unitsFeatures:Fe,unitsContacts:He,contacts:Ye};return function br(ht,pt){const{contacts:Xt,unitsContacts:fn,unitsFeatures:on}=pt,En=[vr(0,pt),Hr(0,pt),Sr(0,pt),Ur(0,pt),Ro(0,pt)];for(let Fe=0,He=Xt.edgeCount;Fe<He;++Fe){const Ye=Xt.edges[Fe],ot=ht.unitMap.get(Ye.unitA),rt=ht.unitMap.get(Ye.unitB),St=O.Info(ht,ot,on.get(Ye.unitA));St.feature=Ye.indexA;const vt=O.Info(ht,rt,on.get(Ye.unitB));vt.feature=Ye.indexB;for(const mn of En)mn.isApplicable(Ye.props.type)&&mn.handleInterContact(Fe,St,vt)}const Tt=fn.keys();for(;;){const{done:Fe,value:He}=Tt.next();if(Fe)break;const Ye=fn.get(He),ot=on.get(He),rt=ht.unitMap.get(He);if(!r.Nf.isAtomic(rt))continue;const St=O.Info(ht,rt,ot),vt=O.Info(ht,rt,ot);for(const mn of En)mn.startUnit(rt,Ye,ot);for(let mn=0,zt=2*Ye.edgeCount;mn<zt;++mn){St.feature=Ye.a[mn],vt.feature=Ye.b[mn];for(const an of En)an.isApplicable(Ye.edgeProps.type[mn])&&an.handleIntraContact(mn,St,vt)}}}(pt,ot),ot}),dr.apply(this,arguments)}function xr(ht,pt,Xt){const fn=pt.elements.length,on=b.create(fn,fn/2);if(r.Nf.isAtomic(pt))for(const En of Xt)En.add(ht,pt,on);return on.getFeatures(fn)}function Ft(ht,pt,Xt,fn,on){const En=l.create(Xt,pt.elements.length);return r.Nf.isAtomic(pt)&&function L(ht,pt,Xt,fn,on,En){for(const Tt of on)w(ht,pt,Xt,fn,Tt,En)}(ht,pt,Xt,En,fn,on),En.getContacts()}},2361:(tn,Ue,n)=>{"use strict";n.d(Ue,{MH:()=>ye});var e=n(8277),o=n(2443),r=n(1758),t=n(467),A=n(9136),y=n(4369),c=n(3246),i=n(3543),v=n(9283),O=n(6713),b=n(377),_=n(2741),M=n(1888),I=n(9126),l=n(9469),m=n(5384),u=n(2556),d=n(1372);const s={sizeFactor:e.t.Numeric(.3,{min:0,max:10,step:.01}),dashCount:e.t.Numeric(6,{min:1,max:10,step:1}),dashScale:e.t.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:e.t.Boolean(!1),ignoreHydrogensVariant:e.t.Select("all",e.t.arrayToOptions(["all","non-polar"])),includeParent:e.t.Boolean(!1),parentDisplay:e.t.Select("stub",e.t.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};var C=n(7767);function h(j,Z,q,Y,ee,g){return a.apply(this,arguments)}function a(){return(a=(0,t.A)(function*(j,Z,q,Y,ee,g){if(!A.Nf.isAtomic(Z))return v.e.createEmpty(g);const{child:_e}=q,xe=_e?.unitMap.get(Z.id);if(_e&&!xe)return v.e.createEmpty(g);const le=A.iZ.Location.create(q,Z),Ae=O.r.get(q).value,Be=Ae.unitsFeatures.get(Z.id),Ce=Ae.unitsContacts.get(Z.id),{x:Re,y:ke,z:we,members:Oe,offsets:Se}=Be,{edgeCount:Ve,a:Ne,b:K,edgeProps:{flag:ne,type:be}}=Ce,{sizeFactor:Te,ignoreHydrogens:ie,ignoreHydrogensVariant:ue,parentDisplay:re}=ee;if(!Ve)return v.e.createEmpty(g);const{elements:ve,conformation:ce}=Z,se=(0,y.eB)(),ae=(0,y.eB)(),ge=(0,y.eB)(),Ie={linkCount:2*Ve,position:(je,Lt,Je)=>{const en=be[Je];if(ie&&"all"===ue||en!==l.X8.HydrogenBond&&en!==l.X8.WeakHydrogenBond)y.eB.set(je,Re[Ne[Je]],ke[Ne[Je]],we[Ne[Je]]),y.eB.set(Lt,Re[K[Je]],ke[K[Je]],we[K[Je]]);else{const Bt=Oe[Se[Ne[Je]]],pn=Oe[Se[K[Je]]];ce.invariantPosition(ve[Bt],ae),ce.invariantPosition(ve[pn],ge);let $e=y.eB.distance(ae,ge),mt=$e;y.eB.copy(je,ae),y.eB.copy(Lt,ge),(0,C.B8)(Z,Bt,(_t,Me)=>{if((0,u.v3)(q,Z,ve[Me],"polar")){ce.invariantPosition(ve[Me],se);const Ke=y.eB.distance(se,ge);Ke<$e&&($e=Ke,y.eB.copy(je,se))}}),(0,C.B8)(Z,pn,(_t,Me)=>{if((0,u.v3)(q,Z,ve[Me],"polar")){ce.invariantPosition(ve[Me],se);const Ke=y.eB.distance(se,ae);Ke<mt&&(mt=Ke,y.eB.copy(Lt,se))}})}},style:je=>1,radius:je=>{le.element=ve[Oe[Se[Ne[je]]]];const Lt=Y.size.size(le);le.element=ve[Oe[Se[K[je]]]];const Je=Y.size.size(le);return Math.min(Lt,Je)*Te},ignore:je=>{if(ne[je]===l.tA.Filtered)return!0;if(xe)if("stub"===re){const Lt=Ne[je];for(let Je=Se[Lt],en=Se[Lt+1];Je<en;++Je)if(!i.SortedArray.has(xe.elements,ve[Oe[Se[Je]]]))return!0}else{if("full"===re||"between"===re){let Lt=!1,Je=!1;const en=Ne[je];for(let pn=Se[en],$e=Se[en+1];pn<$e;++pn)i.SortedArray.has(xe.elements,ve[Oe[Se[pn]]])||(Lt=!0);const Bt=K[je];for(let pn=Se[Bt],$e=Se[Bt+1];pn<$e;++pn)i.SortedArray.has(xe.elements,ve[Oe[Se[pn]]])||(Je=!0);return"full"===re?Lt&&Je:Lt===Je}(0,d.dr)(re)}return!1}},{mesh:Le,boundingSphere:nt}=(0,b.C1)(j,Ie,ee,g);if(nt)Le.setBoundingSphere(nt);else if(Le.triangleCount>0){const je=m.f8.expand((0,m.f8)(),(xe??Z).boundary.sphere,1*Te);Le.setBoundingSphere(je)}return Le})).apply(this,arguments)}const S={..._.Te,...b.Lr,...s};function D(j){return(0,_.Pv)({defaultProps:e.t.getDefaultValues(S),createGeometry:h,createLocationIterator:E,getLoci:R,eachLocation:p,setUpdateState:(Z,q,Y,ee,g,_e,xe)=>{Z.createGeometry=q.sizeFactor!==Y.sizeFactor||q.dashCount!==Y.dashCount||q.dashScale!==Y.dashScale||q.dashCap!==Y.dashCap||q.radialSegments!==Y.radialSegments||q.ignoreHydrogens!==Y.ignoreHydrogens||q.ignoreHydrogensVariant!==Y.ignoreHydrogensVariant||q.parentDisplay!==Y.parentDisplay;const le=O.r.get(_e.structure).version;Z.info.interactionsHash!==le&&(Z.createGeometry=!0,Z.updateTransform=!0,Z.updateColor=!0,Z.info.interactionsHash=le)}},j)}function R(j,Z,q){const{objectId:Y,instanceId:ee,groupId:g}=j;if(q===Y){const{structure:_e,group:xe}=Z,le=_e.unitMap.get(xe.units[ee].id),Ae=O.r.get(_e).value,{a:Be,b:Ce}=Ae.unitsContacts.get(le.id);return I.OG.Loci(_e,Ae,[{unitA:le,indexA:Be[g],unitB:le,indexB:Ce[g]},{unitA:le,indexA:Ce[g],unitB:le,indexB:Be[g]}])}return c.BL}const f=new Set;function p(j,Z,q,Y){let ee=!1;if(I.OG.isLoci(j)){const{structure:g,group:_e}=Z;if(!A.oE.areEquivalent(j.data.structure,g))return!1;const xe=O.r.get(g).value;if(j.data.interactions!==xe)return!1;const Ae=xe.unitsContacts.get(_e.units[0].id),Be=2*Ae.edgeCount;for(const Ce of j.elements){if(Ce.unitA!==Ce.unitB)continue;const Re=_e.unitIndexMap.get(Ce.unitA.id);if(void 0!==Re){const ke=Ae.getDirectedEdgeIndex(Ce.indexA,Ce.indexB);-1!==ke&&q(i.IX.ofSingleton(Re*Be+ke))&&(ee=!0)}}}else if(A.iZ.Loci.is(j)){const{structure:g,group:_e}=Z;if(!A.oE.areEquivalent(j.structure,g))return!1;const xe=O.r.get(g).value;if(!xe)return!1;const le=_e.units[0],Ae=xe.unitsContacts.get(le.id),Be=xe.unitsFeatures.get(le.id),Ce=2*Ae.edgeCount,{offset:Re}=Ae,{offsets:ke,indices:we}=Be.elementsIndex,{members:Oe,offsets:Se}=Be;for(const Ve of j.elements){const Ne=_e.unitIndexMap.get(Ve.unit.id);void 0!==Ne&&(i.CD.forEach(Ve.indices,K=>{for(let ne=ke[K],be=ke[K+1];ne<be;++ne){const Te=we[ne];for(let ie=Re[Te],ue=Re[Te+1];ie<ue;++ie)f.add(ie)}}),f.forEach(K=>{if(Y){const ne=Ae.a[K];for(let Te=Se[ne],ie=Se[ne+1];Te<ie;++Te)if(!i.CD.has(Ve.indices,Oe[Te]))return;const be=Ae.b[K];for(let Te=Se[be],ie=Se[be+1];Te<ie;++Te)if(!i.CD.has(Ve.indices,Oe[Te]))return}q(i.IX.ofSingleton(Ne*Ce+K))&&(ee=!0)}),f.clear())}}return ee}function E(j){const{structure:Z,group:q}=j,Y=q.units[0],ee=O.r.get(Z).value,g=ee.unitsContacts.get(Y.id),_e=2*g.edgeCount,xe=q.units.length,le=I.OG.Location(ee,Z),{element:Ae}=le;return(0,M.iQ)(_e,xe,1,(Ce,Re)=>{const ke=q.units[Re];return Ae.unitA=ke,Ae.indexA=g.a[Ce],Ae.unitB=ke,Ae.indexB=g.b[Ce],le})}var T=n(3892),L=n(8672);function w(j,Z,q,Y,ee){if(!Z.hasAtomic)return v.e.createEmpty(ee);const g=A.iZ.Location.create(Z),_e=O.r.get(Z).value,{contacts:xe,unitsFeatures:le}=_e,{edgeCount:Ae,edges:Be}=xe,{sizeFactor:Ce,ignoreHydrogens:Re,ignoreHydrogensVariant:ke,parentDisplay:we}=Y;if(!Ae)return v.e.createEmpty(ee);const{child:Oe}=Z,Se=(0,y.eB)(),Ve=(0,y.eB)(),Ne=(0,y.eB)(),K={linkCount:Ae,position:(Te,ie,ue)=>{const{unitA:re,indexA:ve,unitB:ce,indexB:se,props:{type:ae}}=Be[ue],ge=le.get(re),Ie=le.get(ce),Le=Z.unitMap.get(re),nt=Z.unitMap.get(ce);if(Re&&"all"===ke||ae!==l.X8.HydrogenBond&&ae!==l.X8.WeakHydrogenBond)y.eB.set(Te,ge.x[ve],ge.y[ve],ge.z[ve]),y.eB.transformMat4(Te,Te,Le.conformation.operator.matrix),y.eB.set(ie,Ie.x[se],Ie.y[se],Ie.z[se]),y.eB.transformMat4(ie,ie,nt.conformation.operator.matrix);else{const je=ge.members[ge.offsets[ve]],Lt=Ie.members[Ie.offsets[se]];Le.conformation.position(Le.elements[je],Ve),nt.conformation.position(nt.elements[Lt],Ne);let Je=y.eB.distance(Ve,Ne),en=Je;y.eB.copy(Te,Ve),y.eB.copy(ie,Ne),(0,C.LH)(Z,Le,je,(Bt,pn)=>{const $e=Bt.elements[pn];if((0,u.v3)(Z,Bt,$e,"polar")){Bt.conformation.position($e,Se);const mt=y.eB.distance(Se,Ne);mt<Je&&(Je=mt,y.eB.copy(Te,Se))}}),(0,C.LH)(Z,nt,Lt,(Bt,pn)=>{const $e=Bt.elements[pn];if((0,u.v3)(Z,Bt,$e,"polar")){Bt.conformation.position($e,Se);const mt=y.eB.distance(Se,Ve);mt<en&&(en=mt,y.eB.copy(ie,Se))}})}},style:Te=>1,radius:Te=>{const ie=Be[Te],ue=le.get(ie.unitA);g.unit=Z.unitMap.get(ie.unitA),g.element=g.unit.elements[ue.members[ue.offsets[ie.indexA]]];const re=q.size.size(g),ve=le.get(ie.unitB);g.unit=Z.unitMap.get(ie.unitB),g.element=g.unit.elements[ve.members[ve.offsets[ie.indexB]]];const ce=q.size.size(g);return Math.min(re,ce)*Ce},ignore:Te=>{if(Be[Te].props.flag===l.tA.Filtered)return!0;if(Oe){const ie=Be[Te];if("stub"===we){const ue=Oe.unitMap.get(ie.unitA);if(!ue)return!0;const re=Z.unitMap.get(ie.unitA),{offsets:ve,members:ce}=le.get(ie.unitA);for(let se=ve[ie.indexA],ae=ve[ie.indexA+1];se<ae;++se)if(!i.SortedArray.has(ue.elements,re.elements[ce[se]]))return!0}else{if("full"===we||"between"===we){let ue=!1,re=!1;const ve=Oe.unitMap.get(ie.unitA);if(ve){const se=Z.unitMap.get(ie.unitA),{offsets:ae,members:ge}=le.get(ie.unitA);for(let Ie=ae[ie.indexA],Le=ae[ie.indexA+1];Ie<Le;++Ie)i.SortedArray.has(ve.elements,se.elements[ge[Ie]])||(ue=!0)}else ue=!0;const ce=Oe.unitMap.get(ie.unitB);if(ce){const se=Z.unitMap.get(ie.unitB),{offsets:ae,members:ge}=le.get(ie.unitB);for(let Ie=ae[ie.indexB],Le=ae[ie.indexB+1];Ie<Le;++Ie)i.SortedArray.has(ce.elements,se.elements[ge[Ie]])||(re=!0)}else re=!0;return"full"===we?ue&&re:ue===re}(0,d.dr)(we)}}return!1}},{mesh:ne,boundingSphere:be}=(0,b.C1)(j,K,Y,ee);if(be)ne.setBoundingSphere(be);else if(ne.triangleCount>0){const{child:Te}=Z,ie=m.f8.expand((0,m.f8)(),(Te??Z).boundary.sphere,1*Ce);ne.setBoundingSphere(ie)}return ne}const Q={...T.EN,...b.Lr,...s};function G(j){return(0,T.wA)({defaultProps:e.t.getDefaultValues(Q),createGeometry:w,createLocationIterator:H,getLoci:V,eachLocation:k,setUpdateState:(Z,q,Y,ee,g,_e,xe)=>{Z.createGeometry=q.sizeFactor!==Y.sizeFactor||q.dashCount!==Y.dashCount||q.dashScale!==Y.dashScale||q.dashCap!==Y.dashCap||q.radialSegments!==Y.radialSegments||q.ignoreHydrogens!==Y.ignoreHydrogens||q.ignoreHydrogensVariant!==Y.ignoreHydrogensVariant||q.parentDisplay!==Y.parentDisplay;const le=O.r.get(_e).version;Z.info.interactionsHash!==le&&(Z.createGeometry=!0,Z.updateTransform=!0,Z.updateColor=!0,Z.info.interactionsHash=le)}},j)}function V(j,Z,q){const{objectId:Y,groupId:ee}=j;if(q===Y){const g=O.r.get(Z).value,_e=g.contacts.edges[ee],xe=Z.unitMap.get(_e.unitA),le=Z.unitMap.get(_e.unitB);return I.OG.Loci(Z,g,[{unitA:xe,indexA:_e.indexA,unitB:le,indexB:_e.indexB},{unitA:le,indexA:_e.indexB,unitB:xe,indexB:_e.indexA}])}return c.BL}const U=new Map,N=new Set;function k(j,Z,q,Y){let ee=!1;if(I.OG.isLoci(j)){if(!A.oE.areEquivalent(j.data.structure,Z))return!1;const g=O.r.get(Z).value;if(j.data.interactions!==g)return!1;const{contacts:_e}=g;for(const xe of j.elements){const le=_e.getEdgeIndex(xe.indexA,xe.unitA.id,xe.indexB,xe.unitB.id);-1!==le&&q(i.IX.ofSingleton(le))&&(ee=!0)}}else if(A.iZ.Loci.is(j)){if(!A.oE.areEquivalent(j.structure,Z)||Y&&1===j.elements.length)return!1;const g=O.r.get(Z).value;if(!g)return!1;const{contacts:_e,unitsFeatures:xe}=g;for(const le of j.elements)U.set(le.unit.id,le.indices);for(const le of j.elements){const{unit:Ae}=le;L.Nf.isAtomic(Ae)&&i.CD.forEach(le.indices,Be=>{for(const Ce of _e.getContactIndicesForElement(Be,Ae))N.add(Ce)})}N.forEach(le=>{if(Y){const{indexA:Ae,unitA:Be,indexB:Ce,unitB:Re}=_e.edges[le],ke=U.get(Be),we=U.get(Re);if(!ke||!we)return;const{offsets:Oe,members:Se}=xe.get(Be);for(let K=Oe[Ae],ne=Oe[Ae+1];K<ne;++K)if(!i.CD.has(ke,Se[K]))return;const{offsets:Ve,members:Ne}=xe.get(Re);for(let K=Ve[Ce],ne=Ve[Ce+1];K<ne;++K)if(!i.CD.has(we,Ne[K]))return}q(i.IX.ofSingleton(le))&&(ee=!0)}),U.clear(),N.clear()}return ee}function H(j){const Z=O.r.get(j).value,{contacts:q}=Z,Y=q.edgeCount,g=I.OG.Location(Z,j),{element:_e}=g;return(0,M.iQ)(Y,1,1,le=>{const Ae=q.edges[le];return _e.unitA=j.unitMap.get(Ae.unitA),_e.indexA=Ae.indexA,_e.unitB=j.unitMap.get(Ae.unitB),_e.indexB=Ae.indexB,g},!0)}var $=n(5201);const J={"intra-unit":(j,Z)=>(0,r.TP)("Intra-unit interactions cylinder",j,Z,D),"inter-unit":(j,Z)=>(0,r.Kp)("Inter-unit interactions cylinder",j,Z,G)},W={...S,...Q,unitKinds:(0,$.R8)(["atomic"]),sizeFactor:e.t.Numeric(.2,{min:.01,max:1,step:.01}),visuals:e.t.MultiSelect(["intra-unit","inter-unit"],e.t.objectToOptions(J))},ye=(0,r.GT)({name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:function de(j,Z){return o.YL.createMulti("Interactions",j,Z,r.J1,J)},getParams:function te(j,Z){return e.t.clone(W)},defaultValues:e.t.getDefaultValues(W),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:j=>j.elementCount>0&&O.r.isApplicable(j),ensureCustomProperties:{attach:(j,Z)=>O.r.attach(j,Z,void 0,!0),detach:j=>O.r.ref(j,!1)},getData:(j,Z)=>Z.includeParent?j.asParent():j,mustRecreate:(j,Z)=>j.includeParent!==Z.includeParent})},8699:(tn,Ue,n)=>{"use strict";n.d(Ue,{v:()=>_e});var e=n(467),o=n(4743),r=n(2434),t=n(8277),A=n(4369),y=n(4490),i=n(4506);const v=9,O=-27.888,b=-.5,_=-9.9;function M(Ce,Re,ke,we){const Oe=A.eB.distance(Ce,we),Se=A.eB.distance(Re,we),Ve=A.eB.distance(Re,ke),Ne=A.eB.distance(Ce,ke),be=O/Oe-O/Se+(O/Ve-O/Ne);return be<_?_:be}var u,Ce,m=n(9909);(Ce=u||(u={})).is=m.NJ.has,Ce.create=m.NJ.create;class d{constructor(Re,ke,we){this.partner1=Math.min(Re,ke),this.partner2=Math.max(Re,ke),this.type=we}}function h(Ce,Re){if(Re.type!==Ce.type||Re.partner1!==Ce.firstEnd+1)return!1;if(0===Re.type){if(Re.partner2===Ce.secondEnd+1)return!0}else if(Re.partner2===Ce.secondStart-1)return!0;return!1}function a(Ce,Re){return Ce.type===Re.type&&Re.firstStart-Ce.firstEnd<6&&Ce.firstStart<Re.firstStart&&0===Re.nextLadder&&(0===Ce.type?S(Ce,Re):S(Re,Ce))}function S(Ce,Re){return Re.secondStart-Ce.secondEnd>0&&(Re.secondStart-Ce.secondEnd<6&&Re.firstStart-Ce.firstEnd<3||Re.secondStart-Ce.secondEnd<3)}function f(Ce){return u.is(Ce,8)||u.is(Ce,1)||u.is(Ce,16)}var T=n(5384),L=n(3543),w=n(9535);const V={oldDefinition:t.t.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:t.t.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function U(Ce,Re){return N.apply(this,arguments)}function N(){return N=(0,e.A)(function*(Ce,Re){const ke=function G(Ce){const{index:Re}=Ce.model.atomicHierarchy,{proteinElements:ke,residueIndex:we}=Ce,Oe=ke.length,Se=new Uint32Array(Oe),Ve=new Int32Array(Oe),Ne=new Int32Array(Oe),K=new Int32Array(Oe),ne=new Int32Array(Oe);for(let be=0;be<Oe;++be){const Te=we[ke[be]];Se[be]=Te,Ve[be]=Re.findAtomOnResidue(Te,"C"),Ne[be]=Re.findAtomOnResidue(Te,"H"),K[be]=Re.findAtomOnResidue(Te,"O"),ne[be]=Re.findAtomOnResidue(Te,"N")}return{residueIndices:L.SortedArray.ofSortedArray(Se),cIndices:Ve,hIndices:Ne,oIndices:K,nIndices:ne}}(Ce),{residueIndices:we}=ke,Oe=function Q(Ce,Re){const{x:ke,y:we,z:Oe}=Ce.model.atomicConformation,{traceElementIndex:Se}=Ce.model.atomicHierarchy.derived.residue,Ve=new Uint32Array(Re.length);for(let K=0,ne=Re.length;K<ne;++K)Ve[K]=Se[Re[K]];const Ne={x:ke,y:we,z:Oe,indices:L.SortedArray.ofSortedArray(Ve)};return(0,T.Eh)(Ne,(0,w.r)(Ne))}(Ce,we),Se=function I(Ce,Re,ke){const{residueIndices:we,cIndices:Oe,hIndices:Se,nIndices:Ve,oIndices:Ne}=Re,{index:K}=Ce.model.atomicHierarchy,ne=Ce.conformation,{traceElementIndex:be}=Ce.model.atomicHierarchy.derived.residue,Te=we.length,ie=[],ue=[],re=[],ve=(0,A.eB)(),ce=(0,A.eB)(),se=(0,A.eB)(),ae=(0,A.eB)(),ge=(0,A.eB)(),Ie=(0,A.eB)(),Le=(0,A.eB)();for(let nt=0,je=we.length;nt<je;++nt){const Lt=nt,Je=we[nt],en=Ne[Lt],Bt=Oe[Lt],pn=be[Je];if(-1===en||-1===Bt||-1!==K.findAtomOnResidue(Je,"OXT"))continue;ne.invariantPosition(en,ve),ne.invariantPosition(Bt,ce),ne.invariantPosition(pn,se);const{indices:$e,count:mt}=ke.find(se[0],se[1],se[2],v);for(let _t=0;_t<mt;++_t){const Me=$e[_t];if(Me===Lt||Me-1===Lt||Me+1===Lt)continue;const Ke=Ve[Me];if(-1===Ke)continue;ne.invariantPosition(Ke,ae);const ut=Se[Me];if(-1===ut){if(0===Me)continue;const sn=Me-1,gt=Ne[sn],yt=Oe[sn];if(-1===gt||-1===yt)continue;ne.invariantPosition(gt,Le),ne.invariantPosition(yt,Ie),A.eB.sub(ge,Ie,Le);const At=A.eB.distance(Le,Ie);A.eB.scaleAndAdd(ge,ae,ge,1/At)}else ne.invariantPosition(ut,ge);const Kt=M(ve,ce,ae,ge);Kt>b||(ie[ie.length]=Lt,ue[ue.length]=Me,re[re.length]=Kt)}}return function l(Ce,Re,ke,we){const Oe=new i.O.DirectedEdgeBuilder(Ce,Re,ke),Se=new Float32Array(Oe.slotCount);for(let Ve=0,Ne=Oe.edgeCount;Ve<Ne;Ve++)Oe.addNextEdge(),Oe.assignProperty(Se,we[Ve]);return Oe.createGraph({energies:we})}(Te,ie,ue,re)}(Ce,ke,Oe),Ve=we.length,Ne=new Uint32Array(Ve),K=function E(Ce,Re){const{cIndices:ke,nIndices:we,residueIndices:Oe}=Re,Se=Ce.conformation,{index:Ve}=Ce.model.atomicHierarchy,{traceElementIndex:Ne}=Ce.model.atomicHierarchy.derived.residue,K=Oe.length,ne=(Le,nt)=>-1===Le?A.eB.setNaN(nt):Se.position(Le,nt);let be=(0,A.eB)(),Te=(0,A.eB)(),ie=(0,A.eB)(),ue=(0,A.eB)(),re=(0,A.eB)(),ve=(0,A.eB)();const ce=(0,A.eB)(),se=(0,A.eB)(),ae=(0,A.eB)();if(0===K)return{phi:new Float32Array(0),psi:new Float32Array(0)};const ge=new Float32Array(K-1),Ie=new Float32Array(K-1);ne(-1,be),ne(-1,Te),ne(-1,ie),ne(ke[0],ue),ne(Ne[Oe[0]],re),ne(we[0],ve),ne(ke[1],ce),ne(Ne[Oe[1]],se),ne(we[1],ae);for(let Le=0;Le<K-1;++Le)-1===Ve.findAtomOnResidue(Oe[Le],"OXT")&&(ge[Le]=(0,y.H)(A.eB.dihedralAngle(be,ve,re,ue)),Ie[Le]=(0,y.H)(A.eB.dihedralAngle(ve,re,ue,ae)),be=ue,Te=re,ie=ve,ue=ce,re=se,ve=ae,ne(ke[Le+1],ce),ne(Ne[Oe[Le+1]],se),ne(we[Le+1],ae));return{phi:ge,psi:Ie}}(Ce,ke),Te=Re.oldDefinition?$:W,ue={params:Re,getResidueFlag:Te,getFlagName:Re.oldOrdering?J:te,unit:Ce,proteinInfo:ke,flags:Ne,hbonds:Se,torsionAngles:K,ladders:[],bridges:[]};(function s(Ce){const{proteinInfo:Re,hbonds:ke,flags:we}=Ce,Oe=[1024,2048,4096,128,256,512];for(let Se=0;Se<3;Se++)for(let Ve=0,Ne=Re.residueIndices.length-1;Ve<Ne;++Ve)if(-1!==ke.getDirectedEdgeIndex(Ve,Ve+Se+3))if(we[Ve]|=Oe[Se+3]|Oe[Se],Ce.params.oldDefinition)for(let K=1;K<Se+3;++K)we[Ve+K]|=64|Oe[Se+3];else for(let K=0;K<=Se+3;++K)we[Ve+K]|=64|Oe[Se+3]})(ue),function C(Ce){const{proteinInfo:Re,flags:ke}=Ce,we=Re.residueIndices.length,Oe=[1024,2048,4096,128,256,512],Se=[0,0,0,8,1,16],Ve=Ce.params.oldOrdering?[4,3,5]:[3,4,5];for(let Ne=0;Ne<Ve.length;Ne++){const K=Ve[Ne];for(let ne=1,be=we-K;ne<be;ne++){const Te=u.create(ke[ne]),ie=u.create(ke[ne-1]),ue=u.create(ke[ne+1]);if(Ce.params.oldOrdering){if(3===K&&(u.is(Te,1)||u.is(ue,1))||5===K&&(u.is(Te,1)||u.is(Te,8)||u.is(ue,1)||u.is(ue,8)))continue}else if(4===K&&(u.is(Te,8)||u.is(ue,8))||5===K&&(u.is(Te,1)||u.is(Te,8)||u.is(ue,1)||u.is(ue,8)))continue;if(u.is(Te,Oe[K])&&u.is(Te,Oe[K-3])&&u.is(ie,Oe[K])&&u.is(ie,Oe[K-3]))if(Ce.params.oldDefinition)for(let re=0;re<K;re++)ke[ne+re]|=Se[K];else for(let re=-1;re<=K;re++)ke[ne+re]|=Se[K]}}}(ue),function c(Ce){const{unit:Re,flags:ke,proteinInfo:we}=Ce,Oe=Re.conformation,{traceElementIndex:Se}=Re.model.atomicHierarchy.derived.residue,{residueIndices:Ve,nIndices:Ne}=we,K=Ve.length,ne=(se,ae)=>-1===se?A.eB.setNaN(ae):Oe.position(se,ae),be=(0,A.eB)(),Te=(0,A.eB)(),ie=(0,A.eB)(),ue=(0,A.eB)(),re=(0,A.eB)(),ve=(0,A.eB)(),ce=(0,A.eB)();e:for(let se=2;se<K-2;se++){for(let Je=0;Je<4;Je++){const en=se+Je-2;if(ne(Se[en],ue),ne(Ne[en+1],re),A.eB.squaredDistance(ue,re)>6.25)continue e}const nt=Se[Ve[se]],je=Se[Ve[se+2]];ne(Se[Ve[se-2]],be),ne(nt,Te),ne(je,ie),A.eB.sub(ve,be,Te),A.eB.sub(ce,Te,ie);const Lt=(0,y.H)(A.eB.angle(ve,ce));Lt&&Lt>70&&(ke[se]|=32)}}(ue),function R(Ce){const{proteinInfo:Re,hbonds:ke,flags:we,bridges:Oe}=Ce,{offset:Se,b:Ve}=ke;let Ne,K;for(let ne=0,be=Re.residueIndices.length;ne<be;++ne)for(let Te=Se[ne],ie=Se[ne+1];Te<ie;Te++){const ue=Ve[Te];ne>ue||(Ne=ne+1,K=ue,Ne!==K&&-1!==ke.getDirectedEdgeIndex(K,Ne+1)&&(we[Ne]|=2,we[K]|=2,Oe[Oe.length]=new d(Ne,K,0)),Ne=ne,K=ue-1,Ne!==K&&-1!==ke.getDirectedEdgeIndex(K-1,Ne)&&(we[Ne]|=2,we[K]|=2,Oe[Oe.length]=new d(K,Ne,0)),Ne=ne,K=ue,Ne!==K&&-1!==ke.getDirectedEdgeIndex(K,Ne)&&(we[Ne]|=2,we[K]|=2,Oe[Oe.length]=new d(K,Ne,1)),Ne=ne+1,K=ue-1,Ne!==K&&-1!==ke.getDirectedEdgeIndex(K-1,Ne+1)&&(we[Ne]|=2,we[K]|=2,Oe[Oe.length]=new d(K,Ne,1)))}Oe.sort((ne,be)=>ne.partner1>be.partner1?1:ne.partner1<be.partner1?-1:0)}(ue),function D(Ce){const{bridges:Re,ladders:ke}=Ce;for(let we=0;we<Re.length;we++){const Oe=Re[we];let Se=!1;for(let Ve=0;Ve<ke.length;Ve++){const Ne=ke[Ve];h(Ne,Oe)&&(Se=!0,Ne.firstEnd++,0===Oe.type?Ne.secondEnd++:Ne.secondStart--)}Se||(ke[ke.length]={previousLadder:0,nextLadder:0,firstStart:Oe.partner1,firstEnd:Oe.partner1,secondStart:Oe.partner2,secondEnd:Oe.partner2,type:Oe.type})}for(let we=0;we<ke.length;we++){const Oe=ke[we];for(let Se=we;Se<ke.length;Se++){const Ve=ke[Se];a(Oe,Ve)&&(Oe.nextLadder=Se,Ve.previousLadder=we)}}}(ue),function p(Ce){const{ladders:Re,flags:ke}=Ce;for(let we=0;we<Re.length;we++){const Oe=Re[we];for(let Ve=Oe.firstStart;Ve<=Oe.firstEnd;Ve++){const K=Oe.secondStart-(Oe.firstStart-Ve);Oe.firstStart!==Oe.firstEnd?(ke[Ve]|=4,ke[K]|=4):(!f(ke[Ve])&&u.is(ke[Ve],4)&&(ke[Ve]|=2),!f(ke[K])&&u.is(ke[K],4)&&(ke[K]|=2))}if(0===Oe.nextLadder)continue;const Se=Re[Oe.nextLadder];for(let Ve=Oe.firstStart;Ve<=Se.firstEnd;Ve++)ke[Ve]|=4;if(0===Oe.type)for(let Ve=Oe.secondStart;Ve<=Se.secondEnd;Ve++)ke[Ve]|=4;else for(let Ve=Se.secondEnd;Ve<=Oe.secondStart;Ve++)ke[Ve]|=4}}(ue);const re=function de(Ce,Re){const ke=new Uint32Array(Ce.length);for(let we=0,Oe=Ce.length;we<Oe;++we){const Se=u.create(Ce[we]);ke[we]=Re(Se)}return ke}(Ne,Te),ve=new Uint32Array(Ve),ce=[],se=[];for(let ge=0,Ie=we.length;ge<Ie;++ge){const Le=re[ge];ve[ge]=Le;const nt=Te(Ne[ge]);(0===se.length||nt!==se[se.length-1].flags)&&(se[se.length]=k(H(Le),Ne[ge],Te)),ce[ge]=se.length-1}return(0,o.M)(ve,ce,se,ge=>L.SortedArray.indexOf(we,ge))}),N.apply(this,arguments)}function k(Ce,Re,ke){return"helix"===Ce?{kind:"helix",flags:ke(Re)}:"sheet"===Ce?{kind:"sheet",flags:ke(Re)}:"turn"===Ce||"bend"===Ce?{kind:"turn",flags:ke(Re)}:{kind:"none"}}function H(Ce){return Ce===r.gG.SecondaryStructureDssp.H||Ce===r.gG.SecondaryStructureDssp.G||Ce===r.gG.SecondaryStructureDssp.I?"helix":Ce===r.gG.SecondaryStructureDssp.B||Ce===r.gG.SecondaryStructureDssp.E?"sheet":Ce===r.gG.SecondaryStructureDssp.T?"turn":Ce===r.gG.SecondaryStructureDssp.S?"bend":"none"}function $(Ce){return u.is(Ce,1)?r.gG.SecondaryStructureDssp.H:u.is(Ce,4)?r.gG.SecondaryStructureDssp.E:u.is(Ce,2)?r.gG.SecondaryStructureDssp.B:u.is(Ce,8)?r.gG.SecondaryStructureDssp.G:u.is(Ce,16)?r.gG.SecondaryStructureDssp.I:u.is(Ce,64)?r.gG.SecondaryStructureDssp.T:u.is(Ce,32)?r.gG.SecondaryStructureDssp.S:0}function J(Ce){return u.is(Ce,1)?"H":u.is(Ce,4)?"E":u.is(Ce,2)?"B":u.is(Ce,8)?"G":u.is(Ce,16)?"I":u.is(Ce,64)?"T":u.is(Ce,32)?"S":"-"}function W(Ce){return u.is(Ce,16)?r.gG.SecondaryStructureDssp.I:u.is(Ce,1)?r.gG.SecondaryStructureDssp.H:u.is(Ce,4)?r.gG.SecondaryStructureDssp.E:u.is(Ce,2)?r.gG.SecondaryStructureDssp.B:u.is(Ce,8)?r.gG.SecondaryStructureDssp.G:u.is(Ce,64)?r.gG.SecondaryStructureDssp.T:u.is(Ce,32)?r.gG.SecondaryStructureDssp.S:0}function te(Ce){return u.is(Ce,16)?"I":u.is(Ce,1)?"H":u.is(Ce,4)?"E":u.is(Ce,2)?"B":u.is(Ce,8)?"G":u.is(Ce,64)?"T":u.is(Ce,32)?"S":"-"}var ye=n(8672),j=n(5439),Z=n(6710),q=n(1692),Y=n(5644);function ee(Ce){let Re="model";if(Ce){Re="dssp";for(let ke=0,we=Ce.models.length;ke<we;++ke){const Oe=Ce.models[ke];if(Y.Kx.isFromPdbArchive(Oe)||Y.Kx.hasSecondaryStructure(Oe)){Re="model";break}}}return{type:t.t.MappedStatic(Re,{model:t.t.EmptyGroup({label:"Model"}),dssp:t.t.Group(V,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}const g=ee(),_e=j.S.createProvider({label:"Secondary Structure",descriptor:(0,q.e)({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:g,getParams:ee,isApplicable:Ce=>!0,obtain:function(){var Ce=(0,e.A)(function*(Re,ke,we){const Oe={...t.t.getDefaultValues(g),...we};switch(Oe.type.name){case"dssp":return{value:yield xe(ke,Oe.type.params)};case"model":return{value:yield Ae(ke)}}});return function(ke,we,Oe){return Ce.apply(this,arguments)}}()});function xe(Ce,Re){return le.apply(this,arguments)}function le(){return le=(0,e.A)(function*(Ce,Re){const ke=new Map;for(let we=0,Oe=Ce.unitSymmetryGroups.length;we<Oe;++we){const Se=Ce.unitSymmetryGroups[we].units[0];if(ye.Nf.isAtomic(Se)&&!Y.Kx.isCoarseGrained(Se.model)){const Ve=yield U(Se,Re);ke.set(Se.invariantId,Ve)}}return ke}),le.apply(this,arguments)}function Ae(Ce){return Be.apply(this,arguments)}function Be(){return Be=(0,e.A)(function*(Ce){const Re=new Map;for(let ke=0,we=Ce.unitSymmetryGroups.length;ke<we;++ke){const Oe=Ce.unitSymmetryGroups[ke].units[0];if(ye.Nf.isAtomic(Oe)){const Se=Z.v.Provider.get(Oe.model);Se&&Re.set(Oe.invariantId,Se)}}return Re}),Be.apply(this,arguments)}},9778:(tn,Ue,n)=>{"use strict";n.d(Ue,{YU:()=>u});var e=n(190),o=n(8277),r=n(6713),t=n(274),A=n(9469),y=n(2293),c=n(9126),i=n(8382);const v=(0,e.Q1)(13421772),b=(0,e._j)({HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404}),_=[["Hydrogen Bond",b.HydrogenBond],["Hydrophobic",b.Hydrophobic],["Halogen Bond",b.HalogenBond],["Ionic",b.Ionic],["Metal Coordination",b.MetalCoordination],["Cation Pi",b.CationPi],["Pi Stacking",b.PiStacking],["Weak HydrogenBond",b.WeakHydrogenBond]];function M(d){switch(d){case A.X8.HydrogenBond:return b.HydrogenBond;case A.X8.Hydrophobic:return b.Hydrophobic;case A.X8.HalogenBond:return b.HalogenBond;case A.X8.Ionic:return b.Ionic;case A.X8.MetalCoordination:return b.MetalCoordination;case A.X8.CationPi:return b.CationPi;case A.X8.PiStacking:return b.PiStacking;case A.X8.WeakHydrogenBond:return b.WeakHydrogenBond;case A.X8.Unknown:return v}}const I={},u={name:"interaction-type",label:"Interaction Type",category:t.J.Category.Misc,factory:function m(d,s){let C;const h=d.structure?r.r.get(d.structure):void 0,a=h?(0,i.vb)(h.id,h.version):-1;return C=h&&h.value?S=>{if(c.OG.isLocation(S)){const{unitsContacts:D,contacts:R}=S.data.interactions,{unitA:f,unitB:p,indexA:E,indexB:T}=S.element;if(f===p){const L=D.get(f.id),w=L.getDirectedEdgeIndex(E,T);return M(L.edgeProps.type[w])}{const L=R.getEdgeIndex(E,f.id,T,p.id);return M(R.edges[L].props.type)}}return v}:()=>v,{factory:m,granularity:"group",color:C,props:s,contextHash:a,description:"Assigns colors according the interaction type of a link.",legend:(0,y.h)(_)}},getParams:function l(d){return I},defaultValues:o.t.getDefaultValues(I),isApplicable:d=>!!d.structure,ensureCustomProperties:{attach:(d,s)=>s.structure?r.r.attach(d,s.structure,void 0,!0):Promise.resolve(),detach:d=>d.structure&&r.r.ref(d.structure,!1)}}},9311:(tn,Ue,n)=>{"use strict";n.d(Ue,{F:()=>D});var e=n(467),o=n(8277),r=n(9136),t=n(7126),A=n(3024),y=n(7767),c=n(2629),i=n(3543),v=n(2434);const O=new r.gn.ElementBondIterator,b=new r.gn.ElementBondIterator,I=new r.gn.ElementBondIterator,l=new r.gn.ElementBondIterator;function m(R,f,p,E){const T=(0,y.IS)(R,f,p,"H"),L=(0,y.$X)(f,p);let w=(0,y.M0)(f,p);const Q="always"===E.assignCharge||"auto"===E.assignCharge&&0===w,G="always"===E.assignH||"auto"===E.assignH&&0===T,V=(0,y.Hm)(R,f,p),U=function M(R,f,p){let E=0;const{offset:T,edgeProps:{flags:L,order:w}}=f.bonds;for(let Q=T[p],G=T[p+1];Q<G;++Q)v.I$.isCovalent(L[Q])&&(E+=w[Q]);return R.interUnitBonds.getEdgeIndices(p,f.id).forEach(Q=>{const G=R.interUnitBonds.edges[Q];v.I$.isCovalent(G.props.flag)&&(E+=G.props.order)}),E}(R,f,p),N=function _(R,f,p){const E=(0,y.$X)(f,p),T="O"===E||"N"===E;if(T&&4===(0,y.Hm)(R,f,p))return!1;for(O.setElement(R,f,p);O.hasNext;){const L=O.move();if(L.order>1)return!0;if(T){const w=(0,y.$X)(L.otherUnit,L.otherIndex);for(b.setElement(R,L.otherUnit,L.otherIndex);b.hasNext;){const Q=b.move();if(Q.order>1){if(("P"===w||"S"===w)&&"O"===(0,y.$X)(Q.otherUnit,Q.otherIndex))continue;return!0}}}}return!1}(R,f,p),k=U-V>0;let H=0,$=A.G0.Unknown;switch(L){case"H":Q&&(0===V?(w=1,$=A.G0.Spherical):1===V&&(w=0,$=A.G0.Terminal));break;case"C":Q&&(w=0),G&&(H=Math.max(0,4-U-Math.abs(w))),$=(0,A.kx)(V+H+Math.max(0,-w));break;case"N":if(Q)if(G)if(N&&U<4)w=V-T==1&&U-T==2?1:0;else for(I.setElement(R,f,p);I.hasNext;){const J=I.move(),W=(0,y.$X)(J.otherUnit,J.otherIndex);if("S"===W||(0,t.kV)(W)){w=0;break}w=1}else w=U-3;G&&(H=Math.max(0,3-U+w)),$=(0,A.kx)(N&&!k?V+H-w:V+H+1-w);break;case"O":if(Q&&(G||(w=U-2),1===U)){I.setElement(R,f,p);e:for(;I.hasNext;){const J=I.move();for(l.setElement(R,J.otherUnit,J.otherIndex);l.hasNext;){const W=l.move();if((W.otherUnit!==f||W.otherIndex!==p)&&"O"===(0,y.$X)(W.otherUnit,W.otherIndex)&&2===W.order){w=-1;break e}}}}G&&(H=Math.max(0,2-U+w)),$=(0,A.kx)(N&&!k?V+H-w+1:V+H-w+2);break;case"S":Q&&(G||(w=U<=3&&0===(0,y.IS)(R,f,p,"O")?U-2:0)),G&&U<2&&(H=Math.max(0,2-U+w)),U<=3&&($=(0,A.kx)(V+H-w+2));break;case"F":case"CL":case"BR":case"I":case"AT":Q&&(w=U-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":Q&&(w=1-U);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":Q&&(w=2-U);break;default:c.Bb&&console.warn("Requested charge, protonation for an unhandled element",L)}return[w,H,H+T,$]}function u(R,f,p){const E=f.elements.length,T=new Int8Array(E),L=new Int8Array(E),w=new Int8Array(E),Q=new Int8Array(E),G=!!R.parent;let V;if(G){const U=R.root.unitMap.get(f.id);if(V=i.SortedArray.indicesOf(U.elements,f.elements),V.length!==f.elements.length)throw new Error("expected to find an index for every element");f=U,R=R.root}for(let U=0;U<E;++U){const N=G?V[U]:U,[k,H,$,J]=m(R,f,N,p);T[U]=k,L[U]=H,w[U]=$,Q[U]=J}return{charge:T,implicitH:L,totalH:w,idealGeometry:Q}}const d={assignCharge:o.t.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:o.t.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function s(R,f,p){return C.apply(this,arguments)}function C(){return(C=(0,e.A)(function*(R,f,p){const E={...o.t.getDefaultValues(d),...p},T=new Map;for(let L=0,w=f.units.length;L<w;++L){const Q=f.units[L];if(r.Nf.isAtomic(Q)){const G=u(f,Q,E);T.set(Q.id,G)}}return T})).apply(this,arguments)}var h=n(5439),a=n(1692);const S={...d},D=h.S.createProvider({label:"Valence Model",descriptor:(0,a.e)({name:"molstar_computed_valence_model"}),type:"local",defaultParams:S,getParams:R=>S,isApplicable:R=>!0,obtain:(R=(0,e.A)(function*(f,p,E){const T={...o.t.getDefaultValues(S),...E};return{value:yield s(f.runtime,p,T)}}),function(p,E,T){return R.apply(this,arguments)})});var R},6220:(tn,Ue,n)=>{"use strict";n.d(Ue,{W:()=>A});var A,e=n(467),o=n(2524),r=n(1692),t=n(387);!function(y){var b;function c(b){if(!o.K4.is(b.sourceData))return!1;const{pdbx_sifts_xref_db_name:_,pdbx_sifts_xref_db_acc:M,pdbx_sifts_xref_db_num:I,pdbx_sifts_xref_db_res:l}=b.sourceData.data.db.atom_site;return _.isDefined&&M.isDefined&&I.isDefined&&l.isDefined}function O(b){if(!o.K4.is(b.sourceData))return;const{pdbx_sifts_xref_db_name:_,pdbx_sifts_xref_db_acc:M,pdbx_sifts_xref_db_num:I,pdbx_sifts_xref_db_res:l}=b.sourceData.data.db.atom_site;if(!(_.isDefined&&M.isDefined&&I.isDefined&&l.isDefined))return;const{atomSourceIndex:m}=b.atomicHierarchy,{count:u,offsets:d}=b.atomicHierarchy.residueAtomSegments,s=new Array(u),C=new Array(u),h=new Array(u),a=new Array(u);for(let S=0;S<u;S++){const D=m.value(d[S]);0===_.valueKind(D)?(s[S]=_.value(D),C[S]=M.value(D),h[S]=I.value(D),a[S]=l.value(D)):(s[S]="",C[S]="",h[S]="",a[S]="")}return{dbName:s,accession:C,num:h,residue:a}}y.Provider=t._.createProvider({label:"SIFTS Mapping",descriptor:(0,r.e)({name:"sifts_sequence_mapping"}),type:"static",defaultParams:{},getParams:()=>({}),isApplicable:b=>c(b),obtain:(b=(0,e.A)(function*(_,M){return{value:O(M)}}),function(M,I){return b.apply(this,arguments)})}),y.isAvailable=c,y.getKey=function i(b){const _=b.unit.model,M=y.Provider.get(_).value;return M?M.accession[_.atomicHierarchy.residueAtomSegments.index[b.element]]:""},y.getLabel=function v(b){const _=b.unit.model,M=y.Provider.get(_).value;if(!M)return;const I=_.atomicHierarchy.residueAtomSegments.index[b.element],l=M.dbName[I];return l?`${l} ${M.accession[I]} ${M.num[I]} ${M.residue[I]}`:void 0}}(A||(A={}))},1692:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>o,v:()=>r});var e=n(9909);function o(t){return t}(o||(o={})).getUUID=function A(y){return y.__key||(y.__key=e.kk.create22()),y.__key};class r{constructor(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}get all(){return this._list}add(A){this._set.has(A)||(this._list.push(A),this._set.add(A))}reference(A,y){let c=this._refs.get(A)||0;c+=y?1:-1,this._refs.set(A,Math.max(c,0))}hasReference(A){return(this._refs.get(A)||0)>0}has(A){return this._set.has(A)}assets(A,y){const c=this._assets.get(A);if(c)for(const i of c)i.dispose();y?this._assets.set(A,y):this._assets.delete(A)}dispose(){this._assets.forEach(A=>{for(const y of A)y.dispose()})}}},364:(tn,Ue,n)=>{"use strict";n.d(Ue,{LU:()=>e,cG:()=>r});const e={kind:"null-location"};function r(A,y,c){return{kind:"data-location",tag:A,data:y,element:c}}},3246:(tn,Ue,n)=>{"use strict";n.d(Ue,{$M:()=>l,BL:()=>I,FE:()=>_,QN:()=>C,e4:()=>m,g9:()=>s,xc:()=>M});var e=n(9136),o=n(1739),r=n(3558),t=n(5384),A=n(4369),y=n(8672),c=n(8277),i=n(9909),v=n(7136),O=n(7785),b=n(3162);const _={kind:"every-loci"};function M(h){return!!h&&"every-loci"===h.kind}const I={kind:"empty-loci"};function l(h){return!!h&&"empty-loci"===h.kind}function m(h){return!!h&&"data-loci"===h.kind}function s(h,a,S,D,R){return{kind:"data-loci",tag:h,data:a,elements:S,getBoundingSphere:D,getLabel:R}}var C;!function(h){const a=new v.Z("98");function E(N,k){var H;if("every-loci"!==N.kind&&"empty-loci"!==N.kind){if(k||(k=(0,t.f8)()),"structure-loci"===N.kind)return t.f8.copy(k,N.structure.boundary.sphere);if("element-loci"===N.kind)return t.f8.copy(k,e.iZ.Loci.getBoundary(N).sphere);if("bond-loci"===N.kind)return o.gn.getBoundingSphere(N,k);if("shape-loci"===N.kind)return t.f8.copy(k,N.shape.geometry.boundingSphere);if("group-loci"===N.kind)return r.$.getBoundingSphere(N,k);if("data-loci"===N.kind)return null===(H=N.getBoundingSphere)||void 0===H?void 0:H.call(N,k);if("volume-loci"===N.kind)return b.f.getBoundingSphere(N.volume,k);if("isosurface-loci"===N.kind)return b.f.Isosurface.getBoundingSphere(N.volume,N.isoValue,k);if("cell-loci"===N.kind)return b.f.Cell.getBoundingSphere(N.volume,N.indices,k);if("segment-loci"===N.kind)return b.f.Segment.getBoundingSphere(N.volume,N.segments,k)}}h.getBundleBoundingSphere=function S(N){const k=N.loci.map(H=>E(H)).filter(H=>!!H);a.reset();for(const H of k)a.includePositionRadius(H.center,H.radius);a.finishedIncludeStep();for(const H of k)a.radiusPositionRadius(H.center,H.radius);return a.getSphere()},h.areEqual=function D(N,k){return!!(M(N)&&M(k)||l(N)&&l(k))||(m(N)&&m(k)?function u(h,a){if(!(0,i.bN)(h.data,a.data)||h.tag!==a.tag||h.elements.length!==a.elements.length)return!1;for(let S=0,D=h.elements.length;S<D;++S)if(!(0,i.bN)(h.elements[S],a.elements[S]))return!1;return!0}(N,k):y.oE.isLoci(N)&&y.oE.isLoci(k)?y.oE.areLociEqual(N,k):e.iZ.Loci.is(N)&&e.iZ.Loci.is(k)?e.iZ.Loci.areEqual(N,k):o.gn.isLoci(N)&&o.gn.isLoci(k)?o.gn.areLociEqual(N,k):r.y.isLoci(N)&&r.y.isLoci(k)?r.y.areLociEqual(N,k):r.$.isLoci(N)&&r.$.isLoci(k)?r.$.areLociEqual(N,k):b.f.isLoci(N)&&b.f.isLoci(k)?b.f.areLociEqual(N,k):b.f.Isosurface.isLoci(N)&&b.f.Isosurface.isLoci(k)?b.f.Isosurface.areLociEqual(N,k):b.f.Cell.isLoci(N)&&b.f.Cell.isLoci(k)?b.f.Cell.areLociEqual(N,k):!(!b.f.Segment.isLoci(N)||!b.f.Segment.isLoci(k))&&b.f.Segment.areLociEqual(N,k))},h.isEvery=function R(N){return!!N&&"every-loci"===N.kind},h.isEmpty=function f(N){return!M(N)&&(!!l(N)||(m(N)?function d(h){return 0===h.elements.length}(N):y.oE.isLoci(N)?y.oE.isLociEmpty(N):e.iZ.Loci.is(N)?e.iZ.Loci.isEmpty(N):o.gn.isLoci(N)?o.gn.isLociEmpty(N):r.y.isLoci(N)?r.y.isLociEmpty(N):r.$.isLoci(N)?r.$.isLociEmpty(N):b.f.isLoci(N)?b.f.isLociEmpty(N):b.f.Isosurface.isLoci(N)?b.f.Isosurface.isLociEmpty(N):b.f.Cell.isLoci(N)?b.f.Cell.isLociEmpty(N):!!b.f.Segment.isLoci(N)&&b.f.Segment.isLociEmpty(N)))},h.remap=function p(N,k){return k instanceof y.oE&&(e.iZ.Loci.is(N)?N=e.iZ.Loci.remap(N,k):y.oE.isLoci(N)?N=y.oE.remapLoci(N,k):o.gn.isLoci(N)&&(N=o.gn.remapLoci(N,k))),N},h.getBoundingSphere=E;const T=t.f8.zero();h.getCenter=function L(N,k){const H=E(N,T);return H?A.eB.copy(k||(0,A.eB)(),H.center):void 0},h.getPrincipalAxes=function w(N){if("every-loci"!==N.kind&&"empty-loci"!==N.kind){if("structure-loci"===N.kind)return e.iZ.Loci.getPrincipalAxes(y.oE.toStructureElementLoci(N.structure));if("element-loci"===N.kind)return e.iZ.Loci.getPrincipalAxes(N);if("bond-loci"===N.kind)return;if("shape-loci"===N.kind)return;if("group-loci"===N.kind)return;if("data-loci"===N.kind)return;if("volume-loci"===N.kind)return;if("isosurface-loci"===N.kind)return;if("cell-loci"===N.kind)return;if("segment-loci"===N.kind)return}};const Q={element:N=>N,residue:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToWholeResidues(N,!0):N,chain:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToWholeChains(N):N,entity:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToWholeEntities(N):N,model:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToWholeModels(N):N,operator:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToWholeOperators(N):N,structure:N=>e.iZ.Loci.is(N)?y.oE.toStructureElementLoci(N.structure):r.$.isLoci(N)?r.y.Loci(N.shape):b.f.Cell.isLoci(N)?b.f.Loci(N.volume):N,elementInstances:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToAllInstances(N):N,residueInstances:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToAllInstances(e.iZ.Loci.extendToWholeResidues(N,!0)):N,chainInstances:N=>e.iZ.Loci.is(N)?e.iZ.Loci.extendToAllInstances(e.iZ.Loci.extendToWholeChains(N)):N};function V(N,k){return Q[k](N)}h.GranularityOptions=c.t.objectToOptions(Q,N=>{switch(N){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return N.indexOf("Instances")?[(0,O.Mk)(N),"With Symmetry"]:(0,O.Mk)(N)}}),h.simpleGranularity=function G(N){return N.replace("Instances","")},h.applyGranularity=V,h.normalize=function U(N,k,H=!1){return("element"!==k||H)&&o.gn.isLoci(N)&&(N=o.gn.toStructureElementLoci(N)),y.oE.isLoci(N)&&(N=y.oE.toStructureElementLoci(N.structure)),e.iZ.Loci.is(N)&&(N=e.iZ.Loci.remap(N,N.structure.root)),k&&(N=V(N,k)),N}}(C||(C={}))},4699:(tn,Ue,n)=>{"use strict";n.d(Ue,{g:()=>v});const e={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},o={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},r={A:"A",C:"C",G:"G",T:"T",U:"U"};function t(O){return e[O]||"X"}function A(O){return r[O]||"X"}function y(O){return o[O]||"X"}var v,c=n(6651),i=n(1372);!function(O){let b;var s;(s=b=O.Kind||(O.Kind={})).Protein="protein",s.RNA="RNA",s.DNA="DNA",s.Generic="generic",O.getSequenceString=function _(s){const C=s.code.toArray();return(C instanceof Array?C:Array.from(C)).join("")},O.ofResidueNames=function l(s,C){if(0===C.rowCount)throw new Error("cannot be empty");const h=function M(s){for(let C=0,h=Math.min(s.rowCount,10);C<h;C++){const a=s.value(C)||"";if("X"!==t(a))return b.Protein;if("X"!==A(a))return b.RNA;if("X"!==y(a))return b.DNA}return b.Generic}(s);return new m(h,s,C)};class m{index(C){return this.indexMap.get(C)}constructor(C,h,a){this.kind=C,this.microHet=new Map;const S=function I(s,C){let h;switch(s){case b.Protein:h=t;break;case b.DNA:h=y;break;case b.RNA:h=A;break;case b.Generic:h=()=>"X";break;default:(0,i.dr)(s)}return C&&C.size>0?a=>{const S=h(a);return"X"===S&&C.has(a)?h(C.get(a)):S}:h}(C),D=[],R=[],f=[],p=new Map;let E=0;const T=new Map;for(let w=0,Q=a.rowCount;w<Q;++w){const G=a.value(w);if(T.has(G))p.has(G)?p.get(G).push(h.value(w)):p.set(G,[R[T.get(G)],h.value(w)]);else{T.set(G,E);const V=h.value(w);R[E]=V,f[E]=G,D[E]=S(V),E+=1}}const L=[];for(let w=0,Q=E;w<Q;++w){const G=p.get(f[w]);if(G){const V=G.map(U=>{const N=S(U);return"X"===N?U:N});L[w]=`(${V.join("|")})`}else L[w]="X"===D[w]?R[w]:D[w]}this.length=E,this.code=c.VP.ofStringArray(D),this.compId=c.VP.ofStringArray(R),this.seqId=c.VP.ofIntArray(f),this.label=c.VP.ofStringArray(L),this.microHet=p,this.indexMap=T}}O.ofSequenceRanges=function u(s,C){return new d(b.Generic,s,C)};class d{index(C){return C-this.minSeqId}constructor(C,h,a){this.kind=C,this.seqIdStart=h,this.seqIdEnd=a,this.microHet=new Map;let S=0,D=Number.MAX_SAFE_INTEGER;for(let f=0,p=this.seqIdStart.rowCount;f<p;f++){const E=this.seqIdStart.value(f),T=this.seqIdEnd.value(f);E<D&&(D=E),S<T&&(S=T)}const R=S-D+1;this.code=c.VP.ofConst("X",R,c.VP.Schema.str),this.label=c.VP.ofConst("",R,c.VP.Schema.str),this.seqId=c.VP.ofLambda({value:f=>f+D+1,rowCount:R,schema:c.VP.Schema.int}),this.compId=c.VP.ofConst("",R,c.VP.Schema.str),this.length=R,this.minSeqId=D}}}(v||(v={}))},3558:(tn,Ue,n)=>{"use strict";n.d(Ue,{$:()=>e.$,y:()=>e.y});var e=n(528)},528:(tn,Ue,n)=>{"use strict";n.d(Ue,{$:()=>M,y:()=>_});var _,M,e=n(9909),o=n(3543),r=n(542),t=n(4369),A=n(5384),y=n(6290),c=n(350),i=n(2476),v=n(3596),O=n(8353),b=n(1888);!function(I){function m(D){return{color:(0,i.h2)({shape:D},{}),size:(0,c.$d)({shape:D},{})}}function u(D){const R=D.transforms.length,f=M.Location(D);return(0,b.iQ)(D.groupCount,R,1,(E,T)=>(f.group=E,f.instance=T,f))}function d(D,R,f,p,E){const T=E&&E.aTransform.ref.value.length>=16*D.length?E.aTransform.ref.value:new Float32Array(16*D.length);for(let L=0,w=D.length;L<w;++L)t.$I.toArray(D[L],T,16*L);return(0,v.l1)(T,D.length,R,f,p,E)}I.create=function l(D,R,f,p,E,T,L){return{id:e.kk.create22(),name:D,sourceData:R,geometry:f,transforms:L||[t.$I.identity()],get groupCount(){return r.V.getGroupCount(f)},getColor:p,getSize:E,getLabel:T}},I.getTheme=m,I.groupIterator=u,I.createTransform=d,I.createRenderObject=function s(D,R){const f=m(D),p=r.V.getUtils(D.geometry),E=(0,O.Q0)(),T=u(D),L=d(D.transforms,D.geometry.boundingSphere,R.cellSize,R.batchSize),w=p.createValues(D.geometry,L,T,f,R),Q=p.createRenderableState(R);return(0,O.o)(D.geometry.kind,w,Q,E)},I.Loci=function C(D){return{kind:"shape-loci",shape:D}},I.isLoci=function h(D){return!!D&&"shape-loci"===D.kind},I.areLociEqual=function a(D,R){return D.shape===R.shape},I.isLociEmpty=function S(D){return 0===D.shape.groupCount}}(_||(_={})),function(I){function h(p){let E=0;for(const T of p.groups)E+=o.CD.size(T.ids);return E}I.Location=function l(p,E=0,T=0){return{kind:"group-location",shape:p,group:E,instance:T}},I.isLocation=function m(p){return!!p&&"group-location"===p.kind},I.Loci=function u(p,E){return{kind:"group-loci",shape:p,groups:E}},I.isLoci=function d(p){return!!p&&"group-loci"===p.kind},I.areLociEqual=function s(p,E){if(p.shape!==E.shape||p.groups.length!==E.groups.length)return!1;for(let T=0,L=p.groups.length;T<L;++T){const{ids:w,instance:Q}=p.groups[T],{ids:G,instance:V}=E.groups[T];if(Q!==V||!o.CD.areEqual(w,G))return!1}return!0},I.isLociEmpty=function C(p){return 0===h(p)},I.size=h;const a=new y.p,S=t.eB.zero();function D(p,E,T,L){const{indices:w,offsets:Q}=E;for(const{ids:G,instance:V}of p)o.CD.forEach(G,U=>{for(let N=Q[U],k=Q[U+1];N<k;++N)t.eB.fromArray(S,T,3*w[N]),t.eB.transformMat4(S,S,L[V]),a.includeStep(S)})}function R(p,E,T,L){const{indices:w,offsets:Q}=E;for(const{ids:G,instance:V}of p)o.CD.forEach(G,U=>{for(let N=Q[U],k=Q[U+1];N<k;++N)t.eB.fromArray(S,T,3*w[N]),t.eB.transformMat4(S,S,L[V]),a.radiusStep(S)})}I.getBoundingSphere=function f(p,E){E||(E=(0,A.f8)()),a.reset();let T=0;const{geometry:L,transforms:w}=p.shape;if("mesh"===L.kind||"points"===L.kind){const Q="mesh"===L.kind?L.vertexBuffer.ref.value:L.centerBuffer.ref.value;D(p.groups,L.groupMapping,Q,w),a.finishedIncludeStep(),R(p.groups,L.groupMapping,Q,w)}else if("lines"===L.kind){const Q=L.startBuffer.ref.value,G=L.endBuffer.ref.value;D(p.groups,L.groupMapping,Q,w),D(p.groups,L.groupMapping,G,w),a.finishedIncludeStep(),R(p.groups,L.groupMapping,Q,w),R(p.groups,L.groupMapping,G,w)}else{if("spheres"!==L.kind&&"text"!==L.kind)return A.f8.copy(E,L.boundingSphere);{const Q=L.centerBuffer.ref.value;D(p.groups,L.groupMapping,Q,w),a.finishedIncludeStep(),R(p.groups,L.groupMapping,Q,w);for(const{ids:G,instance:V}of p.groups)o.CD.forEach(G,U=>{const N=p.shape.getSize(U,V);T<N&&(T=N)})}}return t.eB.copy(E.center,a.center),E.radius=Math.sqrt(a.radiusSq),A.f8.expand(E,E,T),E}}(M||(M={}))},9136:(tn,Ue,n)=>{"use strict";n.d(Ue,{P4:()=>y.P,gn:()=>t.gn,Kx:()=>r.Kx,RT:()=>A.RT,cY:()=>A.cY,oE:()=>t.oE,iZ:()=>t.iZ,StructureProperties:()=>t.StructureProperties,Oz:()=>A.Oz,cv:()=>A.cv,us:()=>t.us,vw:()=>r.vw,Nf:()=>t.Nf,X$:()=>t.X$}),n(1071),n(3346);var r=n(5644),t=n(8672),A=n(2516),y=n(7024)},1071:(tn,Ue,n)=>{"use strict";n.d(Ue,{E:()=>t,g:()=>r});var t,e=n(9909),o=n(6651);function r(A,y){return{value:A,unit:y}}!function(A){A.create=function y(M,I,l){const m=!!M[0].cell,u=!!M[0].velocities,d=!!M[0].forces;return{id:e.kk.create22(),frames:M,hasCell:m,hasVelocities:u,hasForces:d,deltaTime:I,timeOffset:l}},A.getAtomicConformation=function c(M,I,l){var m,u;let{x:d,y:s,z:C}=M;return M.xyzOrdering.frozen?l?M.xyzOrdering.isIdentity?(d=b(d,l),s=b(s,l),C=b(C,l)):(0,e.af)(M.xyzOrdering.index,l)||(d=O(d,M.xyzOrdering.index,l),s=O(s,M.xyzOrdering.index,l),C=O(C,M.xyzOrdering.index,l)):M.xyzOrdering.isIdentity||(d=_(d,M.xyzOrdering.index),s=_(s,M.xyzOrdering.index),C=_(C,M.xyzOrdering.index)):l&&(M.xyzOrdering.isIdentity?(M.xyzOrdering.isIdentity=!1,M.xyzOrdering.index=l,v(d,l),v(s,l),v(C,l)):(0,e.af)(M.xyzOrdering.index,l)||(d=O(d,M.xyzOrdering.index,l),s=O(s,M.xyzOrdering.index,l),C=O(C,M.xyzOrdering.index,l))),M.xyzOrdering.frozen=!0,{id:e.kk.create22(),atomId:I.atomId,occupancy:null!==(m=I.occupancy)&&void 0!==m?m:o.VP.ofConst(1,M.elementCount,o.VP.Schema.int),B_iso_or_equiv:null!==(u=I.B_iso_or_equiv)&&void 0!==u?u:o.VP.ofConst(0,M.elementCount,o.VP.Schema.float),xyzDefined:!0,x:d,y:s,z:C}};const i=[.123];function v(M,I){const l=i;for(let m=0,u=M.length;m<u;m++)l[m]=M[I[m]];for(let m=0,u=M.length;m<u;m++)M[m]=l[m]}function O(M,I,l){const m=new Float32Array(M.length);for(let u=0,d=M.length;u<d;u++)m[u]=M[I[l[u]]];return m}function b(M,I){const l=new Float32Array(M.length);for(let m=0,u=M.length;m<u;m++)l[m]=M[I[m]];return l}function _(M,I){const l=new Float32Array(M.length);for(let m=0,u=M.length;m<u;m++)l[I[m]]=M[m];return l}}(t||(t={}))},1490:(tn,Ue,n)=>{"use strict";n.d(Ue,{mQ:()=>c}),n(8672),n(3543);var r=n(7421),t=n(6651);const c={molstar_atom_site_operator_mapping:{label_asym_id:t.VP.Schema.Str(),auth_asym_id:t.VP.Schema.Str(),operator_name:t.VP.Schema.Str(),suffix:t.VP.Schema.Str(),assembly_id:t.VP.Schema.Str(),assembly_operator_id:t.VP.Schema.Int(),symmetry_operator_index:t.VP.Schema.Int(),symmetry_hkl:t.VP.Schema.Vector(3),ncs_id:t.VP.Schema.Int()}},i=(M,I)=>typeof I[M].operator.assembly>"u"?1:0,v=(M,I)=>-1===I[M].operator.spgrOp?1:0;r.c.fields().str("label_asym_id",(M,I)=>I[M].label_asym_id).str("auth_asym_id",(M,I)=>I[M].auth_asym_id).str("operator_name",(M,I)=>I[M].operator.name).str("suffix",(M,I)=>I[M].operator.suffix).str("assembly_id",(M,I)=>{var l;return(null===(l=I[M].operator.assembly)||void 0===l?void 0:l.id)||""},{valueKind:i}).int("assembly_operator_id",(M,I)=>{var l;return(null===(l=I[M].operator.assembly)||void 0===l?void 0:l.operId)||0},{valueKind:i}).int("symmetry_operator_index",(M,I)=>I[M].operator.spgrOp,{valueKind:v}).vec("symmetry_hkl",[(M,I)=>I[M].operator.hkl[0],(M,I)=>I[M].operator.hkl[1],(M,I)=>I[M].operator.hkl[2]],{valueKind:v}).int("ncs_id",(M,I)=>I[M].operator.ncsId,{valueKind:v}).getFields()},5644:(tn,Ue,n)=>{"use strict";n.d(Ue,{Kx:()=>e.K,vw:()=>r.v});var i,e=n(4632),r=(n(2434),n(9032)),A=(n(6144),n(8672)),y=n(3543),c=n(9909);function v(M){const I=new Map;for(let l=0,m=M.length;l<m;l++)I.set(l,M[l]);return I}!function(M){M.getCifDataSource=function I(D,R,f){if(!R)return{rowCount:0};if(f&&f[R.id])return f[R.id];const p=R.getElements(D),E={data:p,rowCount:p.elements.length};return f&&(f[R.id]=E),E},M.fromAtomMap=function l(D){return new b(D)},M.fromAtomArray=function m(D){return new b(v(D))};const u=D=>D.atomicHierarchy.residueAtomSegments;M.fromResidueMap=function d(D){return new O("residue",D,u,0)},M.fromResidueArray=function s(D){return new O("residue",v(D),u,0)};const C=D=>D.atomicHierarchy.chainAtomSegments;M.fromChainMap=function h(D){return new O("chain",D,C,0)},M.fromChainArray=function a(D){return new O("chain",v(D),C,0)},M.fromEntityMap=function S(D){return new _(D)}}(i||(i={}));class O{has(I){return this.map.has(I)}get(I){return this.map.get(I)}getStructureElements(I){const l=I.models;if(1!==l.length)throw new Error("Only works on structures with a single model.");const m=new Set,u=I.unitSymmetryGroups,d=[],s=this.segmentGetter(l[0]);for(const C of u){const h=C.units[0];if(h.kind!==this.kind)continue;const a=y.hT.transientSegments(s,h.elements);for(;a.hasNext;){const S=a.move();!this.has(S.index)||m.has(S.index)||(m.add(S.index),d[d.length]=A.iZ.Location.create(I,h,h.elements[S.start]))}}return d.sort((C,h)=>C.element-h.element),d}getElements(I){const l=this.segmentGetter(I.model).index,m=this.getStructureElements(I);return{elements:m,property:u=>this.get(l[m[u].element])}}constructor(I,l,m,u){this.level=I,this.map=l,this.segmentGetter=m,this.id=c.kk.create22(),this.kind=u}}class b{has(I){return this.map.has(I)}get(I){return this.map.get(I)}getStructureElements(I){if(1!==I.models.length)throw new Error("Only works on structures with a single model.");const m=new Set,u=I.unitSymmetryGroups,d=[];for(const s of u){const C=s.units[0];if(C.kind!==this.kind)continue;const h=C.elements;for(let a=0,S=h.length;a<S;a++){const D=h[a];!this.has(D)||m.has(D)||(m.add(h[a]),d[d.length]=A.iZ.Location.create(I,C,D))}}return d.sort((s,C)=>s.element-C.element),d}getElements(I){const l=this.getStructureElements(I);return{elements:l,property:m=>this.get(l[m].element)}}constructor(I){this.map=I,this.id=c.kk.create22(),this.level="atom",this.kind=0}}class _{has(I){return this.map.has(I)}get(I){return this.map.get(I)}getStructureElements(I){const l=I.models;if(1!==l.length)throw new Error("Only works on structures with a single model.");const m=l[0].atomicHierarchy.index,u=new Set,d=I.unitSymmetryGroups,s=[],C=l[0].atomicHierarchy.chainAtomSegments;for(const h of d){const a=h.units[0];if(a.kind!==this.kind)continue;const S=y.hT.transientSegments(C,a.elements);for(;S.hasNext;){const D=S.move(),R=m.getEntityFromChain(D.index);!this.has(R)||u.has(R)||(u.add(R),s[s.length]=A.iZ.Location.create(I,a,a.elements[D.start]))}}return s.sort((h,a)=>h.element-a.element),s}getElements(I){const l=this.getStructureElements(I),m=I.model.atomicHierarchy.chainAtomSegments.index,u=I.model.atomicHierarchy.index;return{elements:l,property:d=>this.get(u.getEntityFromChain(m[l[d].element]))}}constructor(I){this.map=I,this.id=c.kk.create22(),this.level="entity",this.kind=0}}},4632:(tn,Ue,n)=>{"use strict";n.d(Ue,{K:()=>d});var d,e=n(467),o=n(3559),r=n(1692),t=n(4369),A=n(6115),i=n(1071),v=n(4824),O=n(8334),b=n(2921),_=n(2524),M=n(9651),I=n(6651),l=n(387),m=n(7024),u=n(6710);!function(s){function C(_e,xe){const le=[],{frames:Ae}=xe,Be=_e.atomicHierarchy.atomSourceIndex,Re=I.VP.isIdentity(Be)?void 0:Be.toArray({array:Int32Array}),ke=V(_e),we=_e.atomicHierarchy.atoms._rowCount;for(let Oe=0,Se=Ae.length;Oe<Se;++Oe){const Ve=Ae[Oe];if(Ve.elementCount!==we)throw new Error(`Frame element count mismatch, got ${Ve.elementCount} but expected ${we}.`);const Ne={..._e,id:o.k.create22(),modelNum:Oe,atomicConformation:i.E.getAtomicConformation(Ve,{atomId:_e.atomicConformation.atomId,occupancy:_e.atomicConformation.occupancy,B_iso_or_equiv:_e.atomicConformation.B_iso_or_equiv},Re),customProperties:new r.v,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)};if(Ve.cell){const K=M.i.fromCell(Ve.cell.size,Ve.cell.anglesInRadians);M.i.Provider.set(Ne,K)}s.TrajectoryInfo.set(Ne,{index:Oe,size:Ae.length}),s.CoarseGrained.set(Ne,ke),le.push(Ne)}return{trajectory:le,srcIndexArray:Re}}s.trajectoryFromModelAndCoordinates=function h(_e,xe){return new m.P(C(_e,xe).trajectory)},s.trajectoryFromTopologyAndCoordinates=function a(_e,xe){return v.YZ.create("Create Trajectory",function(){var le=(0,e.A)(function*(Ae){const Be=yield(0,b.X)(_e.basic,_e.sourceData,Ae);if(0===Be.frameCount)throw new Error("found no model");const Ce=Be.representative,{trajectory:Re}=C(Ce,xe),we=O.z.fromData({pairs:_e.bonds,count:Ce.atomicHierarchy.atoms._rowCount}),Oe=V(Ce);let Se=0;for(const Ve of Re)O.z.Provider.set(Ve,we),s.TrajectoryInfo.set(Ve,{index:Se++,size:Re.length}),s.CoarseGrained.set(Ve,Oe);return new m.P(Re)});return function(Ae){return le.apply(this,arguments)}}())};const S="__Center__";s.getCenter=function D(_e){if(_e._dynamicPropertyData[S])return _e._dynamicPropertyData[S];const xe=function y(s,C){const h=[],a=[],S=[];s.x.length&&(h.push(...(0,A.em)(s.x)),a.push(...(0,A.em)(s.y)),S.push(...(0,A.em)(s.z))),C&&(C.spheres.x.length&&(h.push(...(0,A.em)(C.spheres.x)),a.push(...(0,A.em)(C.spheres.y)),S.push(...(0,A.em)(C.spheres.z))),C.gaussians.x.length&&(h.push(...(0,A.em)(C.gaussians.x)),a.push(...(0,A.em)(C.gaussians.y)),S.push(...(0,A.em)(C.gaussians.z))));const[D,R]=(0,A.em)(h),[f,p]=(0,A.em)(a),[E,T]=(0,A.em)(S);return t.eB.create(D+(R-D)/2,f+(p-f)/2,E+(T-E)/2)}(_e.atomicConformation,_e.coarseConformation);return _e._dynamicPropertyData[S]=xe,xe};const f="__InvertedAtomSrcIndex__";s.getInvertedAtomSourceIndex=function p(_e){if(_e._staticPropertyData[f])return _e._staticPropertyData[f];const xe=function R(_e){const xe=new Int32Array(_e.rowCount);let le=!1;for(let Ae=0,Be=_e.rowCount;Ae<Be;Ae++){const Ce=_e.value(Ae);Ce!==Ae&&(le=!1),xe[Ce]=Ae}return{isIdentity:le,invertedIndex:xe}}(_e.atomicHierarchy.atomSourceIndex);return _e._staticPropertyData[f]=xe,xe};const E="__TrajectoryInfo__";s.TrajectoryInfo={get:_e=>_e._dynamicPropertyData[E]||{index:0,size:1},set:(_e,xe)=>_e._dynamicPropertyData[E]=xe};const T="__AsymIdCount__";s.AsymIdCount={get(_e){if(_e._dynamicPropertyData[T])return _e._dynamicPropertyData[T];const xe=function c(s){const C=new Set,h=new Set;return s.properties.structAsymMap.forEach(({auth_id:a},S)=>{C.add(a),h.add(S)}),{auth:C.size,label:h.size}}(_e);return _e._dynamicPropertyData[T]=xe,xe}},s.AsymIdOffset=l._.createSimple("asym_id_offset","static"),s.Index=l._.createSimple("index","static"),s.MaxIndex=l._.createSimple("max_index","static"),s.getRoot=function L(_e){return _e.parent||_e},s.areHierarchiesEqual=function w(_e,xe){return _e.atomicHierarchy===xe.atomicHierarchy&&_e.coarseHierarchy===xe.coarseHierarchy};const Q="__CoordinatesHistory__";s.CoordinatesHistory={get:_e=>_e._staticPropertyData[Q],set:(_e,xe)=>_e._staticPropertyData[Q]=xe};const G="__CoarseGrained__";function V(_e){let xe=s.CoarseGrained.get(_e);if(void 0===xe){let le=0;const{polymerType:Ae}=_e.atomicHierarchy.derived.residue;for(let we=0;we<Ae.length;++we)0!==Ae[we]&&(le+=1);let Be=!1,Ce=!1;const{label_atom_id:Re,_rowCount:ke}=_e.atomicHierarchy.atoms;for(let we=0;we<ke;++we){const Oe=Re.value(we);if(!Be&&"BB"===Oe&&(Be=!0),!Ce&&"SC1"===Oe&&(Ce=!0),Be&&Ce)break}xe=Be&&Ce||!(!le||!ke)&&ke/le<3,s.CoarseGrained.set(_e,xe)}return xe}function $(_e){return!!_.K4.is(_e.sourceData)&&(null!==_e.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)||null!==_e.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i))}s.CoarseGrained={get:_e=>_e._staticPropertyData[G],set:(_e,xe)=>_e._staticPropertyData[G]=xe},s.isCoarseGrained=V,s.hasCarbohydrate=function U(_e){return _e.properties.saccharideComponentMap.size>0},s.hasProtein=function N(_e){const{subtype:xe}=_e.entities;for(let le=0,Ae=xe.rowCount;le<Ae;++le)if(xe.value(le).startsWith("polypeptide"))return!0;return!1},s.hasNucleic=function k(_e){const{subtype:xe}=_e.entities;for(let le=0,Ae=xe.rowCount;le<Ae;++le){const Be=xe.value(le);if(Be.endsWith("ribonucleotide hybrid")||Be.endsWith("ribonucleotide"))return!0}return!1},s.isFromPdbArchive=function H(_e){if(!_.K4.is(_e.sourceData))return!1;const{db:xe}=_e.sourceData.data;for(let le=0,Ae=xe.database_2.database_id.rowCount;le<Ae;++le)if("pdb"===xe.database_2.database_id.value(le))return!0;return!1},s.hasPdbId=$,s.hasSecondaryStructure=function J(_e){if(_.K4.is(_e.sourceData)){const{db:xe}=_e.sourceData.data;return xe.struct_conf.id.isDefined||xe.struct_sheet_range.id.isDefined}return u.v.Provider.isApplicable(_e)};const W=t.eB.create(1.5707963,1.5707963,1.5707963),te=t.eB.create(1,1,1);function ye(_e){if(!_.K4.is(_e.sourceData))return!1;const{db:xe}=_e.sourceData.data;for(let le=0;le<xe.exptl.method.rowCount;le++)if(xe.exptl.method.value(le).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}function j(_e){if(!_.K4.is(_e.sourceData))return!1;const{db:xe}=_e.sourceData.data;for(let le=0;le<xe.exptl.method.rowCount;le++)if(xe.exptl.method.value(le).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}function q(_e){if(!_.K4.is(_e.sourceData)||!ye(_e))return!1;const{db:xe}=_e.sourceData.data,{status_code_sf:le}=xe.pdbx_database_status;return le.isDefined&&"REL"===le.value(0)}function Y(_e){if(!_.K4.is(_e.sourceData))return!1;const{db:xe}=_e.sourceData.data,{db_name:le,content_type:Ae}=xe.pdbx_database_related;for(let Be=0,Ce=xe.pdbx_database_related._rowCount;Be<Ce;++Be)if("EMDB"===le.value(Be).toUpperCase()&&"associated EM volume"===Ae.value(Be))return!0;return!1}function ee(_e){return!!_.K4.is(_e.sourceData)&&(q(_e)||Y(_e))}s.hasCrystalSymmetry=function de(_e){var xe;const le=null===(xe=M.i.Provider.get(_e))||void 0===xe?void 0:xe.spacegroup;return!(!le||1===le.num&&t.eB.equals(le.cell.anglesInRadians,W)&&t.eB.equals(le.cell.size,te))},s.isFromXray=ye,s.isFromEm=j,s.isFromNmr=function Z(_e){if(!_.K4.is(_e.sourceData))return!1;const{db:xe}=_e.sourceData.data;for(let le=0;le<xe.exptl.method.rowCount;le++)if(xe.exptl.method.value(le).toUpperCase().indexOf("NMR")>=0)return!0;return!1},s.hasXrayMap=q,s.hasEmMap=Y,s.hasDensityMap=ee,s.probablyHasDensityMap=function g(_e){if(!_.K4.is(_e.sourceData))return!1;const{db:xe}=_e.sourceData.data;return ee(_e)||$(_e)&&(!xe.exptl.method.isDefined||ye(_e)&&(!xe.pdbx_database_status.status_code_sf.isDefined||2===xe.pdbx_database_status.status_code_sf.valueKind(0))||j(_e)&&!xe.pdbx_database_related.db_name.isDefined)}}(d||(d={}))},2008:(tn,Ue,n)=>{"use strict";n.d(Ue,{A9:()=>o.A9,K9:()=>o.K9,PR:()=>o.PR,c1:()=>e.c1,sO:()=>o.sO,vE:()=>e.vE,wi:()=>e.wi,yA:()=>e.yA});var e=n(6724),o=n(5342)},5373:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>r,m:()=>A});var e=n(2434);const o=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function r(y,c,i){return[c,i]=c<i?[c,i]:[i,c],e.uA.has(y)&&"C"===c&&"O"===i||e.ii.has(y)&&"OP1"===c&&"P"===i?2:o.get(`${y}|${c}|${i}`)||1}const t=new Map([["LYS|NZ|RET|C15",2]]);function A(y,c,i,v){return y>i&&([y,i]=[i,y],[c,v]=[v,c]),t.get(`${y}|${c}|${i}|${v}`)||1}},6724:(tn,Ue,n)=>{"use strict";n.d(Ue,{c1:()=>A,or:()=>y,vE:()=>c,wi:()=>r,yA:()=>t});var e=n(6651),o=n(7357);const r={type_symbol:e.VP.Schema.Aliased(o.r.atom_site.type_symbol),label_atom_id:o.r.atom_site.label_atom_id,auth_atom_id:o.r.atom_site.auth_atom_id,label_alt_id:o.r.atom_site.label_alt_id,label_comp_id:o.r.atom_site.label_comp_id,auth_comp_id:o.r.atom_site.auth_comp_id,pdbx_formal_charge:o.r.atom_site.pdbx_formal_charge},t={group_PDB:o.r.atom_site.group_PDB,label_seq_id:o.r.atom_site.label_seq_id,auth_seq_id:o.r.atom_site.auth_seq_id,pdbx_PDB_ins_code:o.r.atom_site.pdbx_PDB_ins_code},A={label_asym_id:o.r.atom_site.label_asym_id,auth_asym_id:o.r.atom_site.auth_asym_id,label_entity_id:o.r.atom_site.label_entity_id};var y,c;(y||(y={})).EmptyResidueKey=function v(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}},function(i){function v(_,M){return _.residueAtomSegments.index[_.chainAtomSegments.offsets[M]]}function O(_,M){return _.residueAtomSegments.index[_.chainAtomSegments.offsets[M+1]-1]+1}i.chainStartResidueIndex=v,i.chainEndResidueIndexExcl=O,i.chainResidueCount=function b(_,M){return O(_,M)-v(_,M)}}(c||(c={}))},5342:(tn,Ue,n)=>{"use strict";n.d(Ue,{A9:()=>i,K9:()=>e,PR:()=>v,sO:()=>c});const e={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},o={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},r={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},t=1.7,A=10.81,y=0;function c(O){const b=e[O];return void 0===b?t:o[b]}function i(O){const b=e[O];return void 0===b?A:r[b]}function v(O){const b=e[O];return void 0===b?y:b}},7126:(tn,Ue,n)=>{"use strict";n.d(Ue,{Hx:()=>s,Z6:()=>o,kV:()=>a,lb:()=>d});var e=n(5342);const o={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},r=new Set(["LI","NA","K","RB","CS","FR"]),A=new Set(["BE","MG","CA","SR","BA","RA"]),M=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]),u=new Set(["F","CL","BR","I","AT"]);function d(D){return u.has(D)}function s(D){const R=(0,e.PR)(D);return R>=21&&R<=29||R>=39&&R<=47||R>=72&&R<=79||R>=104&&R<=108}function a(D){return function t(D){return r.has(D)}(D)||function y(D){return A.has(D)}(D)||function C(D){const R=(0,e.PR)(D);return R>=57&&R<=71}(D)||function h(D){const R=(0,e.PR)(D);return R>=89&&R<=103}(D)||s(D)||function I(D){return M.has(D)}(D)}},4811:(tn,Ue,n)=>{"use strict";n.d(Ue,{T:()=>c});var c,e=n(9207),o=n(1692),r=n(6651),t=n(7421),A=n(2524),y=n(7754);!function(i){const v="molstar_global_model_transform_info";function b(l){return i.Provider.get(l)}i.Schema={[v]:{matrix:r.VP.Schema.Matrix(4,4,r.VP.Schema.float)}},i.Descriptor=(0,o.e)({name:v,cifExport:{categories:[{name:v,instance(l){const m=b(l.firstModel);if(!m)return t.c.Category.Empty;const u=r.XI.ofRows(i.Schema.molstar_global_model_transform_info,[{matrix:m}]);return t.c.Category.ofTable(u)}}],prefix:"molstar"}}),i.Provider=e.q.create(i.Descriptor),i.attach=function O(l,m){l.customProperties.has(i.Descriptor)||l.customProperties.add(i.Descriptor),i.Provider.set(l,m)},i.get=b,i.fromMmCif=function _(l){if(!A.K4.is(l.sourceData))return;const m=l.sourceData.data.frame.categories[v];if(!m)return;const u=(0,y.MR)(i.Schema[v],m);return 0!==u._rowCount?u.matrix.value(0):void 0},i.hasData=function M(l){if(!A.K4.is(l.sourceData))return!1;const m=l.sourceData.data.frame.categories[v];return!!m&&m.rowCount>0},i.writeMmCif=function I(l,m){l.writeCategory({name:v,instance(){const u=r.XI.ofRows(i.Schema.molstar_global_model_transform_info,[{matrix:m}]);return t.c.Category.ofTable(u)}})}}(c||(c={}))},4743:(tn,Ue,n)=>{"use strict";function e(o,r,t,A){return{type:o,key:r,elements:t,getIndex:A}}n.d(Ue,{M:()=>e})},6144:(tn,Ue,n)=>{"use strict";n.d(Ue,{V:()=>r});var r,e=n(6651),o=n(4699);!function(t){const A={byEntityKey:{},sequences:[]};function y(...b){const _=[],M={};for(let I=0,l=b.length;I<l;++I)_.push(...b[I].sequences),Object.assign(M,b[I].byEntityKey);return{sequences:_,byEntityKey:M}}function i(b,_){const{label_comp_id:M}=_.atoms,{label_seq_id:I}=_.residues,{chainAtomSegments:l,residueAtomSegments:m}=_,{count:u,offsets:d}=l,s={},C=[];if(1===u&&0===d[0]&&0===d[1])return{byEntityKey:s,sequences:C};for(let h=0,a=_.chains._rowCount;h<a;h++){const S=_.index.getEntityFromChain(h);if(void 0!==s[S]||"polymer"!==b.data.type.value(S))continue;const D=h;for(h++;h<a&&S===_.index.getEntityFromChain(h)&&"polymer"!==b.data.type.value(S);)h++;h--;const R=m.index[d[D]],f=m.index[d[h+1]-1]+1,p=e.VP.window(I,R,f),E=[];for(let L=R;L<f;++L)E.push(M.value(m.offsets[L]));const T=e.VP.ofStringArray(E);s[S]={entityId:b.data.id.value(S),sequence:o.g.ofResidueNames(T,p)},C.push(s[S])}return{byEntityKey:s,sequences:C}}function v(b,_){return y(O(b,_.spheres),O(b,_.gaussians))}function O(b,_){const{chainElementSegments:M,seq_id_begin:I,seq_id_end:l}=_,{count:m,offsets:u}=M,d={},s=[];if(1===m&&0===u[0]&&0===u[1])return{byEntityKey:d,sequences:s};for(let C=0,h=m;C<h;C++){const a=_.getEntityFromChain(C);if(void 0!==d[a])continue;const S=C;for(C++;C<h&&a===_.getEntityFromChain(C);)C++;C--;const D=u[S],R=u[C+1]-1,f=e.VP.window(I,D,R),p=e.VP.window(l,D,R);d[a]={entityId:b.data.id.value(a),sequence:o.g.ofSequenceRanges(f,p)},s.push(d[a])}return{byEntityKey:d,sequences:s}}t.fromHierarchy=function c(b,_,M){return y(i(b,_),M.isDefined?v(b,M):A)},t.fromAtomicHierarchy=i,t.fromCoarseHierarchy=v,t.fromCoarseElements=O}(r||(r={}))},9032:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>A,v:()=>y});var c,y,e=n(8382),o=n(5384),r=n(9651),t=n(4490);class A{get operatorGroups(){return this._operators||(this._operators=this.operatorsProvider()),this._operators}constructor(i,v,O){this.operatorsProvider=O,this.id=i,this.details=v}}(c=A||(A={})).create=function i(v,O,b){return new c(v,O,b)},function(c){c.Default={assemblies:[],spacegroup:o.is.ZeroP1,isNonStandardCrystalFrame:!1},c.findAssembly=function i(O,b){const _=b.toLocaleLowerCase(),M=r.i.Provider.get(O);return M?(0,e.L9)(M.assemblies,I=>I.id.toLowerCase()===_):void 0},c.getUnitcellLabel=function v(O){const{cell:b,name:_,num:M}=O.spacegroup,{size:I,anglesInRadians:l}=b,m=I[0].toFixed(2),u=I[1].toFixed(2),d=I[2].toFixed(2),s=(0,t.H)(l[0]).toFixed(2),C=(0,t.H)(l[1]).toFixed(2),h=(0,t.H)(l[2]).toFixed(2),a=[];return a.push(`Unit Cell <b>${_}</b> #${M}`),a.push(`${m}\xd7${u}\xd7${d} \u212b`),a.push(`\u03b1=${s}\xb0 \u03b2=${C}\xb0 \u03b3=${h}\xb0`),a.join(" | ")}}(y||(y={}))},2434:(tn,Ue,n)=>{"use strict";n.d(Ue,{uA:()=>L,Ke:()=>E,ii:()=>k,I$:()=>le,K5:()=>w,DF:()=>G,F1:()=>c,HA:()=>M,px:()=>J,Pt:()=>b,DB:()=>_,Xk:()=>Ae,XQ:()=>Q,gG:()=>g,mw:()=>p,ut:()=>de,bM:()=>ye,FW:()=>v,UC:()=>Z,wZ:()=>j,RN:()=>W,nO:()=>te,OV:()=>Y,z7:()=>q,iu:()=>ee,VH:()=>H,qN:()=>$});var e=n(9455),o=n(442),r=n(9986);const t=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),A=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),y=function(){const Ce=Object.create(null),Re=[];for(let ke=65;ke<=90;ke++)Re[Re.length]=String.fromCharCode(ke);for(let ke=97;ke<=122;ke++)Re[Re.length]=String.fromCharCode(ke);for(let ke=48;ke<=57;ke++)Re[Re.length]=String.fromCharCode(ke);for(const ke of Re){Ce[ke]=ke.toUpperCase();for(const we of Re){Ce[ke+we]=(ke+we).toUpperCase();for(const Oe of Re)Ce[ke+we+Oe]=(ke+we+Oe).toUpperCase()}}return Ce}();function c(Ce){return y[Ce]||Ce.toUpperCase()}const i=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(Ce=>[Ce[0],c(Ce[1])]));function v(Ce){return i.has(Ce)?i.get(Ce):c("H")}const b={0:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},1:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},2:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},3:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},4:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},5:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},6:{trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])}},_=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),M=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),I=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),l=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),m=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),u=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),d=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),s=new Set(["peptide linking","peptide-like"]),C=r.M.unionMany(I,l,s),h=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),a=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),S=r.M.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),D=new Set(["non-polymer","other"]),R=new Set(["ion"]),f=new Set(["lipid"]),p=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),E=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),T=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),L=r.M.unionMany(E,T),w=new Set(["NME","ACE","NH2","FOR","FMT"]),Q=new Set(["A","C","T","G","I","U","N"]),G=new Set(["DA","DC","DT","DG","DI","DU","DN"]),V=new Set(["APN","CPN","TPN","GPN"]),U=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),N=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),k=r.M.unionMany(Q,G,V),H=Ce=>U.has(Ce.toUpperCase()),$=Ce=>N.has(Ce.toUpperCase()),J=r.M.unionMany(L,k);function W(Ce,Re){return Re=Re.toUpperCase(),V.has(Re)?8:C.has(Ce)?5:a.has(Ce)?6:h.has(Ce)?7:S.has(Ce)?9:p.has(Re)?2:A.has(Re)?3:t.has(Re)?4:D.has(Ce)?o.yt.has(Re)?9:L.has(Re)?5:Q.has(Re)?6:G.has(Re)?7:1:0}function te(Ce,Re){return 5===Re?m.has(Ce)?2:u.has(Ce)?3:d.has(Ce)?0:1:6===Re?4:7===Re?5:8===Re?6:0}function de(Ce){return Ce=Ce.toUpperCase(),L.has(Ce)?"peptide linking":Q.has(Ce)?"rna linking":G.has(Ce)?"dna linking":o.yt.has(Ce)?"saccharide":"other"}function ye(Ce){return{formula:"",formula_weight:0,id:Ce,name:Ce,mon_nstd_flag:J.has(Ce)?"y":"n",pdbx_synonyms:[],type:de(Ce)}}function j(Ce){return Ce=Ce.toUpperCase(),p.has(Ce)?"water":J.has(Ce)?"polymer":o.yt.has(Ce)?"branched":"non-polymer"}function Z(Ce,Re){return Ce=Ce.toUpperCase(),l.has(Re)?"polypeptide(L)":I.has(Re)?"polypeptide(D)":a.has(Re)?"polyribonucleotide":h.has(Re)?"polydeoxyribonucleotide":S.has(Re)||o.yt.has(Ce)?"oligosaccharide":V.has(Ce)?"peptide nucleic acid":E.has(Ce)?"polypeptide(L)":T.has(Ce)?"polypeptide(D)":Q.has(Ce)?"polyribonucleotide":G.has(Ce)?"polydeoxyribonucleotide":R.has(Re)||A.has(Ce)?"ion":f.has(Re)||t.has(Ce)?"lipid":s.has(Re)?"peptide-like":"other"}function q(Ce){return Y(Ce)||ee(Ce)}function Y(Ce){return 7===Ce||6===Ce||8===Ce}function ee(Ce){return 5===Ce}var g,Ce,le;(Ce=g||(g={})).is=e.N.has,Ce.create=e.N.create,Ce.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},Ce.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},Ce.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},Ce.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8},function(Ce){function Se(Ne){switch(Ne){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}Ce.is=e.N.has,Ce.create=function Re(Ne){return e.N.create(Ne)},Ce.isCovalent=function ke(Ne){return!!(1&Ne)},Ce.isAll=function we(Ne){return Ne===Math.pow(2,6)-1},Ce.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32},Ce.isName=function Oe(Ne){return Ne in Ce.Names},Ce.fromName=Se,Ce.fromNames=function Ve(Ne){let K=0;for(let ne=0,be=Ne.length;ne<be;++ne)K|=Se(Ne[ne]);return K}}(le||(le={}));const Ae={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]}},2516:(tn,Ue,n)=>{"use strict";n.d(Ue,{RT:()=>sn,cY:()=>O,Oz:()=>_,cv:()=>y.c});var e={};n.r(e),n.d(e,{all:()=>C,atoms:()=>R,bondedAtomicPairs:()=>Q,chains:()=>a,none:()=>s,querySelection:()=>w,residues:()=>h,rings:()=>L});var o={};n.r(o),n.d(o,{exceptBy:()=>Ce,expandProperty:()=>ke,includeConnected:()=>we,includeSurroundings:()=>le,intersectBy:()=>Be,querySelection:()=>Ae,surroundingLigands:()=>Ve,union:()=>Re,wholeResidues:()=>Y});var r={};n.r(r),n.d(r,{areIntersectedBy:()=>je,first:()=>ge,getCurrentStructureProperties:()=>Ie,isConnectedTo:()=>$e,pick:()=>ae,withSameAtomProperties:()=>nt,within:()=>Lt});var t={};n.r(t),n.d(t,{intersect:()=>_t,merge:()=>mt});var A={};n.r(A),n.d(A,{atomCount:()=>Me,countQuery:()=>Ke,propertySet:()=>ut});var _,y=n(6424),c=n(8672),i=n(9854),v=n(5988);class O{pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=c.iZ.Location.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new b,this.atomicBond}popCurrentBond(){this.atomicBond=this.currentAtomicBondStack.length>0?this.currentAtomicBondStack.pop():void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructure=this.currentStructureStack.length?this.currentStructureStack.pop():void 0}pushInputStructure(yt){this.inputStructureStack.push(this.inputStructure),this.inputStructure=yt}popInputStructure(){if(0===this.inputStructureStack.length)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(0!==this.timeoutMs&&(0,i.t)()-this.timeCreated>this.timeoutMs)throw new Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection}constructor(yt,At){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=(0,i.t)(),this.element=c.iZ.Location.create(void 0),this.currentStructure=void 0,this.atomicBond=new b,this.currentSelection=void 0,this.inputStructure=yt,this.timeoutMs=At&&At.timeoutMs||0,this.currentSelection=At&&At.currentSelection}}class b{constructor(){this.a=c.iZ.Location.create(void 0),this.aIndex=0,this.b=c.iZ.Location.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.key=-1,this.testFn=v.defaultBondTest}setStructure(yt){this.a.structure=yt,this.b.structure=yt}setTestFn(yt){this.testFn=yt||v.defaultBondTest}test(yt,At){return!!this.testFn(yt)||!!At&&(this.swap(),this.testFn(yt))}swap(){const yt=this.aIndex;this.aIndex=this.bIndex,this.bIndex=yt;const At=this.a.unit;this.a.unit=this.b.unit,this.b.unit=At;const Gt=this.a.element;this.a.element=this.b.element,this.b.element=Gt}get length(){return c.iZ.Location.distance(this.a,this.b)}}(_||(_={})).run=function yt(At,Gt,rn){return At(new O(Gt,rn))};var M=n(9677),I=n(3543),l=n(1969),m=n(3916);class u{add(yt){yt.elementCount&&(1!==yt.elementCount&&(this.allSingletons=!1),this.set.add(yt)&&(this.structures[this.structures.length]=yt))}getSelection(){return this.allSingletons?y.c.Singletons(this.source,(0,m.l6)(this.source,this.structures)):y.c.Sequence(this.source,this.structures)}constructor(yt){this.source=yt,this.set=(0,M.bw)(c.oE.hashCode,c.oE.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}}class d{add(yt,At,Gt){let rn=this.builderMap.get(yt);rn||(rn=this.source.subsetBuilder(!0),this.builders[this.builders.length]=rn,this.builderMap.set(yt,rn)),rn.addToUnit(At,Gt)}allSingletons(){for(let yt=0,At=this.builders.length;yt<At;yt++)if(this.builders[yt].elementCount>1)return!1;return!0}singletonSelection(){const yt=this.source.subsetBuilder(!0),At=c.iZ.Location.create(this.source);for(let Gt=0,rn=this.builders.length;Gt<rn;Gt++)this.builders[Gt].setSingletonLocation(At),yt.addToUnit(At.unit.id,At.element);return y.c.Singletons(this.source,yt.getStructure())}fullSelection(){const yt=new Array(this.builders.length);for(let At=0,Gt=this.builders.length;At<Gt;At++)yt[At]=this.builders[At].getStructure();return y.c.Sequence(this.source,yt)}getSelection(){return 0===this.builders.length?y.c.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}constructor(yt){this.source=yt,this.builders=[],this.builderMap=new Map}}const s=gt=>y.c.Sequence(gt.inputStructure,[]),C=gt=>y.c.Singletons(gt.inputStructure,gt.inputStructure);function h(gt){return R({...gt,groupBy:yt=>c.StructureProperties.residue.key(yt.element)})}function a(gt){return R({...gt,groupBy:yt=>c.StructureProperties.chain.key(yt.element)})}function S(gt){return!0}function D(gt){return 0}function R(gt){if(!gt||!(gt.atomTest||gt.residueTest||gt.chainTest||gt.entityTest||gt.unitTest||gt.groupBy))return C;if(gt.atomTest&&!gt.residueTest&&!gt.chainTest&&!gt.entityTest&&!gt.unitTest&&!gt.groupBy)return function f(gt){return function(At){const{inputStructure:Gt}=At,{units:rn}=Gt,tt=At.pushCurrentElement(),Mt=Gt.subsetBuilder(!0);tt.structure=Gt;for(const nn of rn){tt.unit=nn;const bn=nn.elements;Mt.beginUnit(nn.id);for(let Dn=0,jt=bn.length;Dn<jt;Dn++)tt.element=bn[Dn],gt(At)&&Mt.addElement(tt.element);Mt.commitUnit(),At.throwIfTimedOut()}return At.popCurrentElement(),y.c.Singletons(Gt,Mt.getStructure())}}(gt.atomTest);const yt={unitTest:gt.unitTest||S,entityTest:gt.entityTest||S,chainTest:gt.chainTest||S,residueTest:gt.residueTest||S,atomTest:gt.atomTest||S,groupBy:gt.groupBy||D};return gt.groupBy?function E({unitTest:gt,entityTest:yt,chainTest:At,residueTest:Gt,atomTest:rn,groupBy:tt}){return function(nn){const{inputStructure:bn}=nn,{units:Dn}=bn,jt=nn.pushCurrentElement(),It=new d(bn);jt.structure=bn;for(const Dt of Dn){if(jt.unit=Dt,!gt(nn))continue;const{elements:Ct,model:$t}=Dt;if(0===Dt.kind){const Vt=I.hT.transientSegments($t.atomicHierarchy.chainAtomSegments,Ct),Wt=I.hT.transientSegments($t.atomicHierarchy.residueAtomSegments,Ct);for(;Vt.hasNext;){const yn=Vt.move();if(jt.element=Ct[yn.start],yt(nn)&&At(nn))for(Wt.setSegment(yn);Wt.hasNext;){const Zt=Wt.move();if(jt.element=Ct[Zt.start],Gt(nn))for(let kt=Zt.start,Ot=Zt.end;kt<Ot;kt++)jt.element=Ct[kt],rn(nn)&&It.add(tt(nn),Dt.id,jt.element)}}}else{const{chainElementSegments:Vt}=$t.coarseHierarchy.spheres,Wt=I.hT.transientSegments(Vt,Ct);for(;Wt.hasNext;){const yn=Wt.move();if(jt.element=Ct[yn.start],yt(nn)&&At(nn))for(let Zt=yn.start,kt=yn.end;Zt<kt;Zt++)jt.element=Ct[Zt],Gt(nn)&&It.add(tt(nn),Dt.id,jt.element)}}nn.throwIfTimedOut()}return nn.popCurrentElement(),It.getSelection()}}(yt):function p({unitTest:gt,entityTest:yt,chainTest:At,residueTest:Gt,atomTest:rn}){return function(Mt){const{inputStructure:nn}=Mt,{units:bn}=nn,Dn=Mt.pushCurrentElement(),jt=nn.subsetBuilder(!0),It=Gt===S&&rn===S,Dt=rn===S;Dn.structure=nn;for(const Ct of bn){if(Dn.unit=Ct,!gt(Mt))continue;const{elements:$t,model:Vt}=Ct;if(jt.beginUnit(Ct.id),0===Ct.kind){const Wt=I.hT.transientSegments(Ct.model.atomicHierarchy.chainAtomSegments,$t),yn=I.hT.transientSegments(Ct.model.atomicHierarchy.residueAtomSegments,$t);for(;Wt.hasNext;){const Zt=Wt.move();if(Dn.element=$t[Zt.start],yt(Mt)&&At(Mt)){if(It){jt.addElementRange($t,Zt.start,Zt.end);continue}for(yn.setSegment(Zt);yn.hasNext;){const kt=yn.move();if(Dn.element=$t[kt.start],Gt(Mt)){if(Dt){jt.addElementRange($t,kt.start,kt.end);continue}for(let Ot=kt.start,An=kt.end;Ot<An;Ot++)Dn.element=$t[Ot],rn(Mt)&&jt.addElement(Dn.element)}}}}}else{const{chainElementSegments:Wt}=Vt.coarseHierarchy.spheres,yn=I.hT.transientSegments(Wt,$t);for(;yn.hasNext;){const Zt=yn.move();if(Dn.element=$t[Zt.start],yt(Mt)&&At(Mt)){if(It){jt.addElementRange($t,Zt.start,Zt.end);continue}for(let kt=Zt.start,Ot=Zt.end;kt<Ot;kt++)Dn.element=$t[kt],Gt(Mt)&&jt.addElement(Dn.element)}}}jt.commitUnit(),Mt.throwIfTimedOut()}return Mt.popCurrentElement(),y.c.Singletons(nn,jt.getStructure())}}(yt)}function T(gt,yt,At){const Gt=new Int32Array(yt.length);for(let rn=0,tt=yt.length;rn<tt;rn++)Gt[rn]=gt.elements[yt[rn]];return l.o.create([gt.getChild(I.SortedArray.ofSortedArray(Gt))],{parent:At})}function L(gt,yt){return function(Gt){const{units:rn}=Gt.inputStructure,tt=y.c.LinearBuilder(Gt.inputStructure);if(gt&&0!==gt.length){const Mt=M.th.create();for(let nn=0;nn<gt.length;nn++)M.th.add(Mt,gt[nn],gt[nn]);for(const nn of rn){if(!c.Nf.isAtomic(nn))continue;const bn=nn.rings;for(const Dn of Mt.array)if(bn.byFingerprint.has(Dn))for(const jt of bn.byFingerprint.get(Dn))yt&&!bn.aromaticRings.includes(jt)||tt.add(T(nn,bn.all[jt],Gt.inputStructure))}}else for(const Mt of rn)if(c.Nf.isAtomic(Mt))if(yt)for(const nn of Mt.rings.aromaticRings)tt.add(T(Mt,Mt.rings.all[nn],Gt.inputStructure));else for(const nn of Mt.rings.all)tt.add(T(Mt,nn,Gt.inputStructure));return tt.getSelection()}}function w(gt,yt,At=!1){return function(rn){const tt=gt(rn);if(0===y.c.structureCount(tt))return tt;const Mt=At?(0,m.Kt)(rn.inputStructure,y.c.unionStructure(tt)):y.c.unionStructure(tt);if(0===Mt.elementCount)return y.c.Empty(rn.inputStructure);rn.throwIfTimedOut(),rn.pushInputStructure(Mt);const nn=yt(rn);return rn.popInputStructure(),y.c.withInputStructure(nn,rn.inputStructure)}}function Q(gt){return function(At){const Gt=At.inputStructure,rn=Gt.interUnitBonds,tt=y.c.UniqueBuilder(At.inputStructure);At.pushCurrentBond();const Mt=At.atomicBond;Mt.setTestFn(gt),Mt.setStructure(Gt);for(const nn of Gt.units){if(0!==nn.kind)continue;const{offset:bn,b:Dn,edgeProps:{flags:jt,order:It,key:Dt}}=nn.bonds;Mt.a.unit=nn,Mt.b.unit=nn;for(let Ct=0,$t=nn.elements.length;Ct<$t;Ct++){Mt.aIndex=Ct,Mt.a.element=nn.elements[Ct];for(let Vt=bn[Ct],Wt=bn[Ct+1];Vt<Wt;Vt++)if(Mt.bIndex=Dn[Vt],Mt.b.element=nn.elements[Dn[Vt]],Mt.type=jt[Vt],Mt.order=It[Vt],Mt.key=Dt[Vt],Mt.test(At,!1)){const yn=Gt.subsetBuilder(!1);yn.beginUnit(nn.id),yn.addElement(Mt.a.element),yn.addElement(Mt.b.element),yn.commitUnit(),tt.add(yn.getStructure())}}}for(const nn of rn.edges)if(Mt.a.unit=Gt.unitMap.get(nn.unitA),Mt.a.element=Mt.a.unit.elements[nn.indexA],Mt.aIndex=nn.indexA,Mt.b.unit=Gt.unitMap.get(nn.unitB),Mt.b.element=Mt.b.unit.elements[nn.indexB],Mt.bIndex=nn.indexB,Mt.order=nn.props.order,Mt.type=nn.props.flag,Mt.key=nn.props.key,Mt.test(At,!1)){const bn=Gt.subsetBuilder(!1);bn.addToUnit(Mt.a.unit.id,Mt.a.element),bn.addToUnit(Mt.b.unit.id,Mt.b.element),tt.add(bn.getStructure())}return At.popCurrentBond(),tt.getSelection()}}var G=n(8382),V=n(5685);class U{addToUnit(yt,At){const Gt=this.unitMap.get(yt);if(Gt)M.th.add(Gt,At,At)&&this.elementCount++;else{const rn=M.th.create();M.th.add(rn,At,At),this.unitMap.set(yt,rn),this.ids[this.ids.length]=yt,this.elementCount++}}has(yt,At){const Gt=this.unitMap.get(yt);return!!Gt&&M.th.has(Gt,At)}beginUnit(yt){this.parentId=yt,this.currentUnit=this.unitMap.has(yt)?this.unitMap.get(yt):this.currentUnit.array.length>0?M.th.create():this.currentUnit}addElement(yt){M.th.add(this.currentUnit,yt,yt)&&this.elementCount++}commitUnit(){0===this.currentUnit.array.length||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return l.o.Empty;const yt=[];(0,G.eh)(this.ids);const At=V.u.UnitEquivalenceBuilder();for(let Gt=0,rn=this.ids.length;Gt<rn;Gt++){const tt=this.ids[Gt],Mt=this.parent.unitMap.get(tt),nn=this.unitMap.get(tt).array,bn=nn.length;if(nn.length===Mt.elements.length){yt[yt.length]=Mt,At.add(Mt.id,Mt);continue}bn>1&&(0,G.eh)(nn);let Dn=Mt.getChild(I.SortedArray.ofSortedArray(nn));const jt=At.add(Dn.id,Dn);Dn!==jt&&(Dn=jt.applyOperator(Dn.id,Dn.conformation.operator,!0)),yt[yt.length]=Dn}return l.o.create(yt,{parent:this.parent})}get isEmpty(){return 0===this.elementCount}constructor(yt){this.parent=yt,this.ids=[],this.unitMap=I.Yz.Mutable(),this.parentId=-1,this.currentUnit=M.th.create(),this.elementCount=0}}var N=n(1541),k=n(2524),H=n(14);class ${add(yt){let At=this.index.get(yt.label_asym_id);At||(At=new Map,this.index.set(yt.label_asym_id,At));let Gt=At.get(yt.label_seq_id);return Gt||(Gt=[],At.set(yt.label_seq_id,Gt)),!this._find(yt,Gt)&&(Gt.push(yt),!0)}hasLabelAsymId(yt){return this.index.has(yt)}has(yt){var At,Gt;const rn=J(yt);if(!this.index.has(rn))return;const tt=this.index.get(rn),Mt=W(yt);if(!tt.has(Mt))return;const nn=tt.get(Mt),bn=te(yt),Dn=de(yt),jt=ye(yt),It=null!==(At=j(yt))&&void 0!==At?At:"1_555";for(const Dt of nn)if(Dt.label_comp_id===bn&&Dt.label_alt_id===Dn&&Dt.ins_code===jt&&(!this.checkOperator||(null!==(Gt=Dt.operator_name)&&void 0!==Gt?Gt:"1_555")===It))return Dt}static getLabel(yt,At=!1){var Gt;return`${yt.label_asym_id} ${yt.label_comp_id} ${yt.label_seq_id}:${yt.ins_code}:${yt.label_alt_id}${At?" "+(null!==(Gt=yt.operator_name)&&void 0!==Gt?Gt:"1_555"):""}`}static getEntryFromLocation(yt){var At;return{label_asym_id:J(yt),label_comp_id:te(yt),label_seq_id:W(yt),label_alt_id:de(yt),ins_code:ye(yt),operator_name:null!==(At=j(yt))&&void 0!==At?At:"1_555"}}_find(yt,At){var Gt,rn;for(const tt of At)if(tt.label_comp_id===yt.label_comp_id&&tt.label_alt_id===yt.label_alt_id&&tt.ins_code===yt.ins_code&&(!this.checkOperator||(null!==(Gt=tt.operator_name)&&void 0!==Gt?Gt:"1_555")===(null!==(rn=yt.operator_name)&&void 0!==rn?rn:"1_555")))return!0;return!1}constructor(yt){var At;this.index=new Map,this.checkOperator=!1,this.checkOperator=null!==(At=yt?.checkOperator)&&void 0!==At&&At}}const J=H.Z.chain.label_asym_id,W=H.Z.residue.label_seq_id,te=H.Z.atom.label_comp_id,de=H.Z.atom.label_alt_id,ye=H.Z.residue.pdbx_PDB_ins_code,j=H.Z.unit.operator_name;var Z=n(6115);function q(gt,yt,At){const Gt=yt.subsetBuilder(!0);for(const rn of At.units){if(0!==rn.kind){Gt.setUnit(rn.id,rn.elements);continue}const{residueAtomSegments:tt}=rn.model.atomicHierarchy,Mt=yt.unitMap.get(rn.id).elements,nn=rn.elements;Gt.beginUnit(rn.id);const bn=I.hT.transientSegments(tt,nn);for(;bn.hasNext;){const Dn=bn.move().index;for(let jt=tt.offsets[Dn],It=tt.offsets[Dn+1];jt<It;jt++)I.SortedArray.has(Mt,jt)&&Gt.addElement(jt)}Gt.commitUnit(),gt.throwIfTimedOut()}return Gt.getStructure()}function Y(gt){return function(At){const Gt=gt(At);if(y.c.isSingleton(Gt))return y.c.Singletons(At.inputStructure,q(At,At.inputStructure,Gt.structure));{const rn=new u(At.inputStructure);for(const tt of Gt.structures)rn.add(q(At,At.inputStructure,tt));return rn.getSelection()}}}function ee(gt,yt,At,Gt){const rn=new U(yt),tt=yt.lookup3d,Mt=Gt.radius;for(const nn of At.units){const bn=nn.conformation,Dn=nn.elements;for(let jt=0,It=Dn.length;jt<It;jt++){const Dt=Dn[jt];tt.findIntoBuilder(bn.x(Dt),bn.y(Dt),bn.z(Dt),Mt,rn)}gt.throwIfTimedOut()}return Gt.wholeResidues?q(gt,yt,rn.getStructure()):rn.getStructure()}function g(gt,yt,At,Gt){const rn=new U(yt),tt=yt.lookup3d,{elementRadius:Mt,elementRadiusClosure:nn,sourceMaxRadius:bn,radius:Dn}=Gt;gt.pushCurrentElement(),gt.element.structure=At;for(const jt of At.units){gt.element.unit=jt;const It=jt.conformation,Dt=jt.elements;for(let Ct=0,$t=Dt.length;Ct<$t;Ct++){const Vt=Dt[Ct];gt.element.element=Vt;const Wt=Mt(gt);tt.findIntoBuilderWithRadius(It.x(Vt),It.y(Vt),It.z(Vt),Wt,bn,Dn,nn,rn)}gt.throwIfTimedOut()}return gt.popCurrentElement(),Gt.wholeResidues?q(gt,yt,rn.getStructure()):rn.getStructure()}function _e(gt,yt){return At=>(gt.element.structure=At.structure,gt.element.unit=At.unit,gt.element.element=At.element,yt(gt))}function xe(gt,yt){let At=0;gt.element.structure=gt.inputStructure;for(const Gt of gt.inputStructure.units){gt.element.unit=Gt;const rn=Gt.elements;for(let tt=0,Mt=rn.length;tt<Mt;tt++){gt.element.element=rn[tt];const bn=yt(gt);bn>At&&(At=bn)}}return gt.throwIfTimedOut(),At}function le(gt,yt){return function(Gt){const rn=gt(Gt);if(yt.elementRadius){const tt={...yt,elementRadius:yt.elementRadius,elementRadiusClosure:_e(Gt,yt.elementRadius),sourceMaxRadius:xe(Gt,yt.elementRadius)};if(y.c.isSingleton(rn)){const Mt=g(Gt,Gt.inputStructure,rn.structure,tt);return y.c.Singletons(Gt.inputStructure,Mt)}{const Mt=new u(Gt.inputStructure);for(const nn of rn.structures)Mt.add(g(Gt,Gt.inputStructure,nn,tt));return Mt.getSelection()}}if(y.c.isSingleton(rn)){const tt=ee(Gt,Gt.inputStructure,rn.structure,yt);return y.c.Singletons(Gt.inputStructure,tt)}{const tt=new u(Gt.inputStructure);for(const Mt of rn.structures)tt.add(ee(Gt,Gt.inputStructure,Mt,yt));return tt.getSelection()}}}function Ae(gt,yt){return function(Gt){const rn=gt(Gt);if(0===y.c.structureCount(rn))return rn;const tt=y.c.UniqueBuilder(Gt.inputStructure),Mt=nn=>tt.add(nn);return y.c.forEach(rn,(nn,bn)=>{Gt.pushInputStructure(nn),y.c.forEach(yt(Gt),Mt),Gt.popInputStructure(),bn%10==0&&Gt.throwIfTimedOut()}),tt.getSelection()}}function Be(gt,yt){return function(Gt){const rn=gt(Gt);if(0===y.c.structureCount(rn))return rn;const tt=yt(Gt);if(0===y.c.structureCount(tt))return y.c.Empty(Gt.inputStructure);const Mt=y.c.unionStructure(tt),nn=y.c.UniqueBuilder(Gt.inputStructure);return y.c.forEach(rn,(bn,Dn)=>{const jt=(0,m.jU)(Mt,bn);0!==jt.elementCount&&nn.add(jt),Dn%50==0&&Gt.throwIfTimedOut()}),nn.getSelection()}}function Ce(gt,yt){return function(Gt){const rn=gt(Gt);if(0===y.c.structureCount(rn))return rn;const tt=yt(Gt);if(0===y.c.structureCount(tt))return rn;const Mt=y.c.unionStructure(tt),nn=y.c.UniqueBuilder(Gt.inputStructure);return y.c.forEach(rn,(bn,Dn)=>{const jt=(0,m.Kt)(bn,Mt);0!==jt.elementCount&&nn.add(jt),Dn%50==0&&Gt.throwIfTimedOut()}),nn.getSelection()}}function Re(gt){return function(At){const Gt=y.c.LinearBuilder(At.inputStructure);return Gt.add(y.c.unionStructure(gt(At))),Gt.getSelection()}}function ke(gt,yt){return function(Gt){const rn=gt(Gt),tt=new Map,Mt=[];Gt.pushCurrentElement(),y.c.forEach(rn,(bn,Dn)=>{Gt.element.structure=bn;for(const jt of bn.units){Gt.element.unit=jt;const It=jt.elements;for(let Dt=0,Ct=It.length;Dt<Ct;Dt++){Gt.element.element=It[Dt];const $t=yt(Gt);let Vt;tt.has($t)?Vt=tt.get($t):(Vt=M.th.create(),tt.set($t,Vt)),M.th.add(Vt,Dn,Dn)}}Mt[Dn]=Gt.inputStructure.subsetBuilder(!0),Dn%10==0&&Gt.throwIfTimedOut()}),Gt.element.structure=Gt.inputStructure;for(const bn of Gt.inputStructure.units){Gt.element.unit=bn;const Dn=bn.elements;for(let jt=0,It=Dn.length;jt<It;jt++){Gt.element.element=Dn[jt];const Dt=yt(Gt);if(!tt.has(Dt))continue;const Ct=tt.get(Dt).array;for(let $t=0,Vt=Ct.length;$t<Vt;$t++)Mt[Ct[$t]].addToUnit(bn.id,Dn[jt])}}Gt.popCurrentElement();const nn=y.c.UniqueBuilder(Gt.inputStructure);for(const bn of Mt)nn.add(bn.getStructure());return nn.getSelection()}}function we({query:gt,layerCount:yt,wholeResidues:At,bondTest:Gt,fixedPoint:rn}){const tt=Math.max(yt,0);return function(nn){const bn=y.c.UniqueBuilder(nn.inputStructure),Dn=gt(nn);return nn.pushCurrentBond(),nn.atomicBond.setTestFn(Gt),y.c.forEach(Dn,(jt,It)=>{let Dt=jt;if(rn)for(;;){const Ct=Dt.elementCount;if(Dt=Oe(nn,At,Dt),Dt.elementCount===Ct)break}else for(let Ct=0;Ct<tt;Ct++)Dt=Oe(nn,At,Dt);bn.add(Dt),It%10==0&&nn.throwIfTimedOut()}),nn.popCurrentBond(),bn.getSelection()}}function Oe(gt,yt,At){const Gt=function Se(gt,yt){const At=gt.inputStructure,Gt=At.interUnitBonds,rn=new U(At),tt=gt.atomicBond;for(const Mt of yt.units){if(0!==Mt.kind){rn.beginUnit(Mt.id);for(let Ct=0,$t=Mt.elements.length;Ct<$t;Ct++)rn.addElement(Mt.elements[Ct]);rn.commitUnit();continue}const nn=At.unitMap.get(Mt.id),{offset:bn,b:Dn,edgeProps:{flags:jt,order:It,key:Dt}}=nn.bonds;tt.setStructure(At),tt.a.unit=nn,tt.b.unit=nn;for(let Ct=0,$t=Mt.elements.length;Ct<$t;Ct++){rn.addToUnit(Mt.id,Mt.elements[Ct]);const Vt=I.SortedArray.indexOf(nn.elements,Mt.elements[Ct]);for(let Wt=bn[Vt],yn=bn[Vt+1];Wt<yn;Wt++){const Zt=Dn[Wt],kt=nn.elements[Zt];I.SortedArray.has(Mt.elements,kt)||rn.has(Mt.id,kt)||(tt.aIndex=Vt,tt.a.element=Mt.elements[Ct],tt.bIndex=Zt,tt.b.element=kt,tt.type=jt[Wt],tt.order=It[Wt],tt.key=Dt[Wt],tt.test(gt,!0)&&rn.addToUnit(Mt.id,kt))}}for(const Ct of Gt.getConnectedUnits(nn.id)){const $t=yt.unitMap.get(Ct.unitB),Vt=At.unitMap.get(Ct.unitB);for(const Wt of Ct.connectedIndices)if(I.SortedArray.has(Mt.elements,nn.elements[Wt]))for(const yn of Ct.getEdges(Wt)){const Zt=Vt.elements[yn.indexB];$t&&I.SortedArray.has($t.elements,Zt)||rn.has(Ct.unitB,Zt)||(tt.a.unit=nn,tt.aIndex=Wt,tt.a.element=nn.elements[Wt],tt.b.unit=Vt,tt.bIndex=yn.indexB,tt.b.element=Zt,tt.type=yn.props.flag,tt.order=yn.props.order,tt.key=yn.props.key,tt.test(gt,!0)&&rn.addToUnit(Ct.unitB,Zt))}}}return rn.getStructure()}(gt,At);return yt?q(gt,gt.inputStructure,Gt):Gt}function Ve({query:gt,radius:yt,includeWater:At}){return function(rn){const tt=y.c.unionStructure(gt(rn)),Mt=q(rn,rn.inputStructure,ee(rn,rn.inputStructure,tt,{radius:yt})),nn=function ne(gt){const yt=gt.models[0],At=new Set;if(!k.K4.is(yt.sourceData))return At;const{_rowCount:Gt,asym_id:rn}=yt.sourceData.data.db.pdbx_molecule;for(let tt=0;tt<Gt;tt++)At.add(rn.value(tt));return At}(rn.inputStructure),bn=function be(gt){var yt,At;const Gt=gt.models[0],rn=new Te;if(!k.K4.is(Gt.sourceData))return rn;const tt=Gt.sourceData.data.db.struct_conn,{conn_type_id:Mt}=tt,{ptnr1_label_asym_id:nn,ptnr1_label_comp_id:bn,ptnr1_label_seq_id:Dn,ptnr1_symmetry:jt,pdbx_ptnr1_label_alt_id:It,pdbx_ptnr1_PDB_ins_code:Dt}=tt,{ptnr2_label_asym_id:Ct,ptnr2_label_comp_id:$t,ptnr2_label_seq_id:Vt,ptnr2_symmetry:Wt,pdbx_ptnr2_label_alt_id:yn,pdbx_ptnr2_PDB_ins_code:Zt}=tt;for(let kt=0;kt<tt._rowCount;kt++){const Ot=Mt.value(kt);if("covale"!==Ot&&"metalc"!==Ot)continue;const An={label_asym_id:nn.value(kt),label_comp_id:bn.value(kt),label_seq_id:Dn.value(kt),label_alt_id:It.value(kt),ins_code:Dt.value(kt),operator_name:null!==(yt=jt.value(kt))&&void 0!==yt?yt:"1_555"},jn={label_asym_id:Ct.value(kt),label_comp_id:$t.value(kt),label_seq_id:Vt.value(kt),label_alt_id:yn.value(kt),ins_code:Zt.value(kt),operator_name:null!==(At=Wt.value(kt))&&void 0!==At?At:"1_555"};rn.addEdge(An,jn)}return rn}(rn.inputStructure),Dn=N.i.Location.create(Mt),jt=new Map,It=new $({checkOperator:!0});for(const $t of Mt.units){if(0!==$t.kind)continue;Dn.unit=$t;const{elements:Vt}=$t,Wt=I.hT.transientSegments($t.model.atomicHierarchy.chainAtomSegments,Vt),yn=I.hT.transientSegments($t.model.atomicHierarchy.residueAtomSegments,Vt);for(;Wt.hasNext;){const Zt=Wt.move();Dn.element=Vt[Zt.start];const kt=H.Z.chain.label_asym_id(Dn),Ot=H.Z.unit.operator_name(Dn);if(nn.has(kt)){jt.has(kt)?(0,Z.Z2)(jt.get(kt),Ot):jt.set(kt,[Ot]);continue}const An=H.Z.entity.type(Dn);if("water"!==An&&"polymer"!==An)for(yn.setSegment(Zt);yn.hasNext;){const jn=yn.move();Dn.element=Vt[jn.start],bn.addComponent($.getEntryFromLocation(Dn),It)}}rn.throwIfTimedOut()}const Dt=rn.inputStructure.subsetBuilder(!0);for(const $t of rn.inputStructure.units){if(0!==$t.kind)continue;Dn.unit=$t;const{elements:Vt}=$t,Wt=I.hT.transientSegments($t.model.atomicHierarchy.chainAtomSegments,Vt),yn=I.hT.transientSegments($t.model.atomicHierarchy.residueAtomSegments,Vt);for(Dt.beginUnit($t.id);Wt.hasNext;){const Zt=Wt.move();Dn.element=Vt[Zt.start];const kt=H.Z.chain.label_asym_id(Dn),Ot=H.Z.unit.operator_name(Dn);if(jt.has(kt)&&jt.get(kt).indexOf(Ot)>=0)Dt.addElementRange(Vt,Zt.start,Zt.end);else if(It.hasLabelAsymId(kt))for(yn.setSegment(Zt);yn.hasNext;){const An=yn.move();Dn.element=Vt[An.start],It.has(Dn)&&Dt.addElementRange(Vt,An.start,An.end)}}Dt.commitUnit(),rn.throwIfTimedOut()}const Ct=(0,m.l6)(rn.inputStructure,[Dt.getStructure(),tt]);if(At){const $t=new U(rn.inputStructure),Vt=rn.inputStructure.lookup3d;for(const Wt of Ct.units){const yn=Wt.conformation,Zt=Wt.elements;for(let kt=0,Ot=Zt.length;kt<Ot;kt++){const An=Zt[kt];Vt.findIntoBuilderIf(yn.x(An),yn.y(An),yn.z(An),yt,$t,K),$t.addToUnit(Wt.id,An)}rn.throwIfTimedOut()}return y.c.Sequence(rn.inputStructure,[$t.getStructure()])}return y.c.Sequence(rn.inputStructure,[Ct])}}const Ne=H.Z.entity.type;function K(gt){return"water"===Ne(gt)}class Te{constructor(){this.vertices=new Map,this.edges=new Map}addVertex(yt,At){this.vertices.has(At)||(this.vertices.set(At,yt),this.edges.set(At,[]))}addEdge(yt,At){const Gt=$.getLabel(yt),rn=$.getLabel(At);this.addVertex(yt,Gt),this.addVertex(At,rn),(0,Z.Z2)(this.edges.get(Gt),rn),(0,Z.Z2)(this.edges.get(rn),Gt)}addComponent(yt,At){const Gt=$.getLabel(yt);if(!this.vertices.has(Gt))return void At.add(yt);const rn=new Set,tt=new Set,Mt=[Gt];for(tt.add(Gt),At.add(yt);Mt.length>0;){const nn=Mt.pop();rn.add(nn);const bn=this.vertices.get(nn);for(const Dn of this.edges.get(nn)){if(rn.has(Dn)||(Mt.push(Dn),tt.has(Dn)))continue;tt.add(Dn);const jt=this.vertices.get(Dn);At.add(bn.operator_name===jt.operator_name?{...jt,operator_name:yt.operator_name}:jt)}}}}var ce,se,Kt,ie=n(9986),ue=n(4369);function ae(gt,yt){return At=>{const Gt=gt(At),rn=y.c.LinearBuilder(At.inputStructure);return At.pushCurrentElement(),y.c.forEach(Gt,(tt,Mt)=>{At.currentStructure=tt,yt(At)&&rn.add(tt),Mt%100&&At.throwIfTimedOut()}),At.popCurrentStructure(),rn.getSelection()}}function ge(gt){return yt=>{const At=gt(yt),Gt=y.c.LinearBuilder(yt.inputStructure);if("singletons"===At.kind){if(At.structure.elementCount>0){const rn=At.structure.units[0],tt=l.o.create([rn.getChild(I.SortedArray.ofSingleton(rn.elements[0]))],{parent:yt.inputStructure});Gt.add(tt)}}else At.structures.length>0&&Gt.add(At.structures[0]);return Gt.getSelection()}}function Ie(gt,yt,At){const{units:Gt}=gt.currentStructure,rn=gt.pushCurrentElement();rn.structure=gt.currentStructure;for(const tt of Gt){rn.unit=tt;const Mt=tt.elements,nn=yt;if(nn){for(let bn=0,Dn=Mt.length;bn<Dn;bn++)rn.element=Mt[bn],At.add(nn(gt));gt.throwIfTimedOut()}}return gt.popCurrentElement(),At}function nt(gt,yt,At){return Gt=>{const rn=gt(Gt),tt=function Le(gt,yt,At){const Gt=new Set,rn=yt(gt);return gt.pushCurrentElement(),y.c.forEach(rn,(tt,Mt)=>{gt.currentStructure=tt,Ie(gt,At,Gt),Mt%10&&gt.throwIfTimedOut()}),gt.popCurrentElement(),Gt}(Gt,yt,At),Mt=y.c.LinearBuilder(Gt.inputStructure);return Gt.pushCurrentStructure(),y.c.forEach(rn,(nn,bn)=>{Gt.currentStructure=nn;const Dn=Ie(Gt,At,new Set);ie.M.isSuperset(tt,Dn)&&Mt.add(nn),bn%10&&Gt.throwIfTimedOut()}),Gt.popCurrentStructure(),Mt.getSelection()}}function je(gt,yt){return At=>{const Gt=y.c.unionStructure(yt(At)),rn=y.c.LinearBuilder(At.inputStructure);return y.c.forEach(gt(At),(tt,Mt)=>{(0,m.HK)(Gt,tt)&&rn.add(tt),Mt%10&&At.throwIfTimedOut()}),rn.getSelection()}}function Lt(gt){return yt=>{const At={queryCtx:yt,selection:gt.query(yt),target:gt.target(yt),maxRadius:gt.maxRadius,minRadius:gt.minRadius?Math.max(0,gt.minRadius):0,elementRadius:gt.elementRadius,invert:!!gt.invert};return 0===At.minRadius&&typeof gt.minRadius>"u"?function Je({queryCtx:gt,selection:yt,target:At,maxRadius:Gt,invert:rn}){const tt=y.c.unionStructure(At).lookup3d,Mt=y.c.LinearBuilder(gt.inputStructure),nn=ue.eB.zero();return y.c.forEach(yt,(bn,Dn)=>{const{units:jt}=bn;let It=!1;for(let Dt=0,Ct=jt.length;Dt<Ct;Dt++){const $t=jt[Dt],{elements:Vt,conformation:Wt}=$t;for(let yn=0,Zt=Vt.length;yn<Zt;yn++){const kt=Vt[yn];if(Wt.position(kt,nn),tt.check(nn[0],nn[1],nn[2],Gt+Wt.r(kt))){It=!0;break}}if(It)break}rn&&(It=!It),It&&Mt.add(bn),Dn%10==0&&gt.throwIfTimedOut()}),Mt.getSelection()}(At):0===At.minRadius?function en({queryCtx:gt,selection:yt,target:At,maxRadius:Gt,invert:rn,elementRadius:tt}){const Mt=y.c.unionStructure(At),nn=y.c.LinearBuilder(gt.inputStructure);return gt.pushCurrentElement(),y.c.forEach(yt,(bn,Dn)=>{let jt=function ve(gt,yt,At,Gt,rn){return 0===yt.elementCount||0===At.elementCount||(yt.elementCount<=At.elementCount?se.check(gt,yt,At,Gt,rn):se.check(gt,At,yt,Gt,rn))}(gt,Mt,bn,Gt,tt);rn&&(jt=!jt),jt&&nn.add(bn),Dn%10==0&&gt.throwIfTimedOut()}),gt.popCurrentElement(),nn.getSelection()}(At):function Bt({queryCtx:gt,selection:yt,target:At,minRadius:Gt,maxRadius:rn,invert:tt,elementRadius:Mt}){const nn=y.c.unionStructure(At),bn=y.c.LinearBuilder(gt.inputStructure);return gt.pushCurrentElement(),y.c.forEach(yt,(Dn,jt)=>{let It=function re(gt,yt,At,Gt,rn,tt){return 0===yt.elementCount||0===At.elementCount||(yt.elementCount<=At.elementCount?ce.check(gt,yt,At,Gt,rn,tt):ce.check(gt,At,yt,Gt,rn,tt))}(gt,nn,Dn,Gt,rn,Mt);tt&&(It=!It),It&&bn.add(Dn),jt%10==0&&gt.throwIfTimedOut()}),gt.popCurrentElement(),bn.getSelection()}(At)}}function $e({query:gt,target:yt,disjunct:At,invert:Gt,bondTest:rn}){return tt=>{const Mt=yt(tt);if(y.c.isEmpty(Mt))return Mt;const nn=gt(tt);if(y.c.isEmpty(nn))return nn;const bn={queryCtx:tt,input:tt.inputStructure,disjunct:At,target:y.c.unionStructure(Mt)},Dn=y.c.LinearBuilder(tt.inputStructure);return tt.pushCurrentBond(),tt.atomicBond.setTestFn(rn),y.c.forEach(nn,(jt,It)=>{(function pn(gt,yt){const{queryCtx:At,input:Gt,target:rn,disjunct:tt}=gt,Mt=At.atomicBond,nn=Gt.interUnitBonds;Mt.setStructure(Gt);for(const bn of yt.units){if(!c.Nf.isAtomic(bn))continue;const Dn=Gt.unitMap.get(bn.id),{offset:jt,b:It,edgeProps:{flags:Dt,order:Ct,key:$t}}=Dn.bonds,Vt=nn.getConnectedUnits(bn.id),Wt=Vt.length,yn=bn.elements,Zt=Dn.elements;for(let kt=0,Ot=yn.length;kt<Ot;kt++){const An=I.SortedArray.indexOf(Zt,yn[kt]);Mt.a.unit=Dn,Mt.b.unit=Dn;for(let jn=jt[An],On=jt[An+1];jn<On;jn++)if(Mt.b.element=Dn.elements[It[jn]],(!tt||!I.SortedArray.has(bn.elements,Mt.b.element))&&rn.hasElement(Mt.b)&&(Mt.aIndex=An,Mt.a.element=yn[kt],Mt.bIndex=It[jn],Mt.type=Dt[jn],Mt.order=Ct[jn],Mt.key=$t[jn],Mt.test(At,!0)))return!0;for(let jn=0;jn<Wt;jn++){const On=Vt[jn],fr=Gt.unitMap.get(On.unitB),Dr=fr.elements,Pr=On.getEdges(An);for(let or=0,Nr=Pr.length;or<Nr;or++){const Ir=Pr[or];if(Mt.b.unit=fr,Mt.b.element=Dr[Ir.indexB],rn.hasElement(Mt.b)&&(!tt||!yt.hasElement(Mt.b))&&(Mt.a.unit=Dn,Mt.aIndex=An,Mt.a.element=yn[kt],Mt.bIndex=Ir.indexB,Mt.type=Ir.props.flag,Mt.order=Ir.props.order,Mt.key=Ir.props.key,Mt.test(At,!0)))return!0}}}}return!1}(bn,jt)||Gt)&&Dn.add(jt),It%5==0&&tt.throwIfTimedOut()}),tt.popCurrentBond(),Dn.getSelection()}}function mt(gt){return 0===gt.length?s:1===gt.length?gt[0]:yt=>{const At=y.c.UniqueBuilder(yt.inputStructure);for(let Gt=0;Gt<gt.length;Gt++)y.c.forEach(gt[Gt](yt),(rn,tt)=>{At.add(rn),Gt%100&&yt.throwIfTimedOut()});return At.getSelection()}}function _t(gt){return 0===gt.length?s:1===gt.length?gt[0]:yt=>{const At=[];for(let nn=0;nn<gt.length;nn++)At.push(gt[nn](yt));let Gt=0,rn=y.c.structureCount(At[0]);for(let nn=1;nn<At.length;nn++){const bn=y.c.structureCount(At[nn]);bn<rn&&(Gt=nn,rn=bn)}yt.throwIfTimedOut();const tt=(0,M.bw)(nn=>nn.hashCode,c.oE.areUnitIdsAndIndicesEqual);y.c.forEach(At[Gt],nn=>tt.add(nn));const Mt=y.c.UniqueBuilder(yt.inputStructure);for(let nn=0;nn<At.length;nn++)nn!==Gt&&(y.c.forEach(At[nn],bn=>{tt.has(bn)&&Mt.add(bn)}),yt.throwIfTimedOut());return Mt.getSelection()}}function Me(gt){return gt.currentStructure.elementCount}function Ke(gt){return yt=>{const At=gt(yt);return y.c.structureCount(At)}}function ut(gt){return yt=>Ie(yt,gt,new Set)}!function(gt){const yt=(0,ue.eB)();function At(Mt,nn,bn,Dn,jt,It,Dt){const{elements:Ct,conformation:$t}=nn,Vt=yt;Mt.element.unit=nn;let Wt=!1;for(let yn=0,Zt=Ct.length;yn<Zt;yn++){const kt=Ct[yn];Mt.element.element=kt;const Ot=Math.max(0,ue.eB.distance(bn,$t.position(kt,Vt))-Dn-Dt(Mt));if(Ot<jt)return 0;Ot<It&&(Wt=!0)}return Wt?1:2}function Gt(Mt,nn,bn,Dn,jt,It,Dt){const{units:Ct}=nn;let $t=!1;for(let Vt=0,Wt=Ct.length;Vt<Wt;Vt++){const yn=At(Mt,Ct[Vt],bn,Dn,jt,It,Dt);if(0===yn)return 0;1===yn&&($t=!0)}return $t?1:2}const rn=(0,ue.eB)();gt.check=function tt(Mt,nn,bn,Dn,jt,It){if(0===nn.elementCount||0===bn.elementCount)return 0;const{units:Dt}=nn;let Ct=!1;Mt.element.structure=nn;for(let $t=0,Vt=Dt.length;$t<Vt;$t++){const Wt=Dt[$t],{elements:yn,conformation:Zt}=Wt;Mt.element.unit=Wt;for(let kt=0,Ot=yn.length;kt<Ot;kt++){const An=yn[kt];Mt.element.element=An;const jn=Gt(Mt,bn,Zt.position(An,rn),It(Mt),Dn,jt,It);if(0===jn)return!1;1===jn&&(Ct=!0)}}return Ct}}(ce||(ce={})),function(gt){const yt=(0,ue.eB)();function At(Mt,nn,bn,Dn,jt,It){const{elements:Dt,conformation:Ct}=nn,$t=yt;Mt.element.unit=nn;for(let Vt=0,Wt=Dt.length;Vt<Wt;Vt++){const yn=Dt[Vt];if(Mt.element.element=yn,Math.max(0,ue.eB.distance(bn,Ct.position(yn,$t))-Dn-It(Mt))<=jt)return!0}return!1}function Gt(Mt,nn,bn,Dn,jt,It){const{units:Dt}=nn;for(let Ct=0,$t=Dt.length;Ct<$t;Ct++)if(At(Mt,Dt[Ct],bn,Dn,jt,It))return!0;return!1}const rn=(0,ue.eB)();gt.check=function tt(Mt,nn,bn,Dn,jt){if(0===nn.elementCount||0===bn.elementCount)return 0;const{units:It}=nn;Mt.element.structure=nn;for(let Dt=0,Ct=It.length;Dt<Ct;Dt++){const $t=It[Dt];Mt.element.unit=$t;const{elements:Vt,conformation:Wt}=$t;for(let yn=0,Zt=Vt.length;yn<Zt;yn++){const kt=Vt[yn];if(Mt.element.element=kt,Gt(Mt,bn,Wt.position(kt,rn),jt(Mt),Dn,jt))return!0}}return!1}}(se||(se={})),function(gt){function nn(Dt){return!0}function bn(Dt){return!1}gt.eq=function At(Dt,Ct){return $t=>Dt($t)===Ct},gt.lt=function Gt(Dt,Ct){return $t=>Dt($t)<Ct},gt.lte=function rn(Dt,Ct){return $t=>Dt($t)<=Ct},gt.gt=function tt(Dt,Ct){return $t=>Dt($t)>Ct},gt.gte=function Mt(Dt,Ct){return $t=>Dt($t)>=Ct},gt.inSet=function Dn(Dt,Ct){if(function yt(Dt){return!!Dt&&!!Dt.has}(Ct))return $t=>Ct.has(Dt($t));{if(0===Ct.length)return bn;const $t=new Set;for(let Vt=0;Vt<Ct.length;Vt++)$t.add(Ct[Vt]);return Vt=>$t.has(Dt(Vt))}},gt.and=function jt(...Dt){switch(Dt.length){case 0:return nn;case 1:return Dt[0];case 2:{const Ct=Dt[0],$t=Dt[1];return Vt=>Ct(Vt)&&$t(Vt)}case 3:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2];return Wt=>Ct(Wt)&&$t(Wt)&&Vt(Wt)}case 4:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2],Wt=Dt[3];return yn=>Ct(yn)&&$t(yn)&&Vt(yn)&&Wt(yn)}case 5:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2],Wt=Dt[3],yn=Dt[4];return Zt=>Ct(Zt)&&$t(Zt)&&Vt(Zt)&&Wt(Zt)&&yn(Zt)}case 6:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2],Wt=Dt[3],yn=Dt[4],Zt=Dt[5];return kt=>Ct(kt)&&$t(kt)&&Vt(kt)&&Wt(kt)&&yn(kt)&&Zt(kt)}default:{const Ct=Dt.length;return $t=>{for(let Vt=0;Vt<Ct;Vt++)if(!Dt[Vt])return!1;return!0}}}},gt.or=function It(...Dt){switch(Dt.length){case 0:return bn;case 1:return Dt[0];case 2:{const Ct=Dt[0],$t=Dt[1];return Vt=>Ct(Vt)||$t(Vt)}case 3:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2];return Wt=>Ct(Wt)||$t(Wt)||Vt(Wt)}case 4:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2],Wt=Dt[3];return yn=>Ct(yn)||$t(yn)||Vt(yn)||Wt(yn)}case 5:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2],Wt=Dt[3],yn=Dt[4];return Zt=>Ct(Zt)||$t(Zt)||Vt(Zt)||Wt(Zt)||yn(Zt)}case 6:{const Ct=Dt[0],$t=Dt[1],Vt=Dt[2],Wt=Dt[3],yn=Dt[4],Zt=Dt[5];return kt=>Ct(kt)||$t(kt)||Vt(kt)||Wt(kt)||yn(kt)||Zt(kt)}default:{const Ct=Dt.length;return $t=>{for(let Vt=0;Vt<Ct;Vt++)if(Dt[Vt])return!0;return!1}}}}}(Kt||(Kt={}));const sn={generators:e,filters:r,modifiers:o,combinators:t,pred:Kt,internal:v,atomset:A}},5988:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{atomicHet:()=>b,atomicSequence:()=>v,bundleElementImpl:()=>M,bundleGenerator:()=>I,defaultBondTest:()=>i,spheres:()=>_,water:()=>O});var e=n(3543),o=n(1541),r=n(8672),t=n(1969),A=n(6424),y=n(2434),c=n(7686);function i(l){return y.I$.isCovalent(l.atomicBond.type)}function v(){return function(m){const{inputStructure:u}=m,d=o.i.Location.create(u),s=[];for(const C of u.units){if(0!==C.kind)continue;d.unit=C;const h=C.elements;if(d.element=h[0],"polymer"!==r.StructureProperties.entity.type(d))continue;const a=e.hT.transientSegments(C.model.atomicHierarchy.residueAtomSegments,h);let S=0;for(;a.hasNext;)S++,a.move();S<8||s.push(C)}return A.c.Singletons(u,t.o.create(s,{parent:u}))}}function O(){return function(m){const{inputStructure:u}=m,d=o.i.Location.create(u),s=[];for(const C of u.units)0===C.kind&&(d.unit=C,d.element=C.elements[0],"water"===r.StructureProperties.entity.type(d)&&s.push(C));return A.c.Singletons(u,t.o.create(s,{parent:u}))}}function b(){return function(m){const{inputStructure:u}=m,d=o.i.Location.create(u),s=[];for(const C of u.units){if(0!==C.kind)continue;d.unit=C;const h=C.elements;if(d.element=h[0],"water"!==r.StructureProperties.entity.type(d)){if("polymer"===r.StructureProperties.entity.type(d)){const a=e.hT.transientSegments(C.model.atomicHierarchy.residueAtomSegments,h);let S=0;for(;a.hasNext;)S++,a.move();if(S>=8)continue}s.push(C)}}return A.c.Singletons(u,t.o.create(s,{parent:u}))}}function _(){return function(m){const{inputStructure:u}=m,d=[];for(const s of u.units)1===s.kind&&d.push(s);return A.c.Singletons(u,t.o.create(d,{parent:u}))}}function M(l,m,u){return{groupedUnits:l,ranges:m,set:u}}function I(l){return function(u){return A.c.Sequence(u.inputStructure,[c.N.toStructure({hash:u.inputStructure.hashCode,elements:l},u.inputStructure)])}}},6424:(tn,Ue,n)=>{"use strict";n.d(Ue,{c:()=>A});var A,e=n(9677),o=n(8672),r=n(3916),t=n(3543);!function(y){function c(S,D){return{kind:"singletons",source:S,structure:D}}function i(S,D){return{kind:"sequence",source:S,structures:D}}function v(S){return c(S,o.oE.Empty)}function O(S){return"singletons"===S.kind}function b(S){return O(S)?0===S.structure.units.length:0===S.structures.length}function M(S){return b(S)?o.oE.Empty:O(S)?S.structure:(0,r.l6)(S.source,S.structures)}function m(S,D,R){return 0===D.length?v(S):R?c(S,(0,r.l6)(S,D)):i(S,D)}y.Singletons=c,y.Sequence=i,y.Empty=v,y.isSingleton=O,y.isEmpty=b,y.structureCount=function _(S){return O(S)?S.structure.elementCount:S.structures.length},y.unionStructure=M,y.toLociWithCurrentUnits=function I(S){const D=[],{unitMap:R}=S.source;for(const f of M(S).units)D[D.length]=f===R.get(f.id)?{unit:f,indices:t.CD.ofBounds(0,f.elements.length)}:{unit:f,indices:t.CD.ofSortedArray(t.SortedArray.indicesOf(R.get(f.id).elements,f.elements))};return o.iZ.Loci(S.source,D)},y.toLociWithSourceUnits=function l(S){const D=[],{unitMap:R}=S.source;for(const f of M(S).units){const p=R.get(f.id);D[D.length]=p===f?{unit:p,indices:t.CD.ofBounds(0,p.elements.length)}:{unit:p,indices:t.CD.ofSortedArray(t.SortedArray.indicesOf(p.elements,f.elements))}}return o.iZ.Loci(S.source,D)};class u{add(D){const R=D.elementCount;0!==R&&(this.structures[this.structures.length]=D,1!==R&&(this.allSingletons=!1))}getSelection(){return m(this.source,this.structures,this.allSingletons)}constructor(D){this.source=D,this.structures=[],this.allSingletons=!0}}class d{add(D){const R=D.elementCount;0===R||!this.uniqueSets.add(D)||(this.structures[this.structures.length]=D,1!==R&&(this.allSingletons=!1))}getSelection(){return m(this.structure,this.structures,this.allSingletons)}constructor(D){this.structure=D,this.structures=[],this.allSingletons=!0,this.uniqueSets=(0,e.bw)(o.oE.hashCode,o.oE.areUnitIdsAndIndicesEqual)}}y.LinearBuilder=function s(S){return new u(S)},y.UniqueBuilder=function C(S){return new d(S)},y.forEach=function h(S,D){let R=0;if(y.isSingleton(S))for(const f of S.structure.units){const{elements:p}=f;for(let E=0,T=p.length;E<T;E++)D(o.oE.create([f.getChild(t.SortedArray.ofSingleton(p[E]))],{parent:S.source}),R++)}else for(const f of S.structures)D(f,R++)},y.withInputStructure=function a(S,D){return O(S)?c(D,S.structure):i(D,S.structures)}}(A||(A={}))},3916:(tn,Ue,n)=>{"use strict";n.d(Ue,{HK:()=>y,IP:()=>A,Kt:()=>i,jU:()=>c,l6:()=>r});var e=n(8672),o=n(3543);function r(v,O){if(0===O.length)return e.oE.Empty;if(1===O.length)return O[0];const b=new Map,_=new Set;for(const{units:I}of O)for(let l=0,m=I.length;l<m;l++){const u=I[l];if(b.has(u.id)){if(_.has(u.id))continue;const d=o.SortedArray.union(b.get(u.id),u.elements);b.set(u.id,d),d.length===v.unitMap.get(u.id).elements.length&&_.add(u.id)}else b.set(u.id,u.elements),u.elements.length===v.unitMap.get(u.id).elements.length&&_.add(u.id)}const M=v.subsetBuilder(!0);return b.forEach(t,M),M.getStructure()}function t(v,O){this.setUnit(O,v)}function A(v,O){if(v===O)return!0;if(v.units.length!==O.units.length)return!1;const b=v.units,_=O.unitMap;for(let M=0,I=b.length;M<I;M++){const l=b[M];if(!_.has(l.id))return!1;const m=_.get(l.id);if(!o.SortedArray.areEqual(l.elements,m.elements))return!1}return!0}function y(v,O){if(v===O)return!0;let b,_;v.units.length<O.units.length?(b=v,_=O):(b=O,_=v);const M=b.units,I=_.unitMap;for(let l=0,m=M.length;l<m;l++){const u=M[l];if(!I.has(u.id))continue;const d=I.get(u.id);if(o.SortedArray.areIntersecting(u.elements,d.elements))return!0}return!1}function c(v,O){if(v===O)return v;if(!y(v,O))return e.oE.Empty;let b,_;v.units.length<O.units.length?(b=v,_=O):(b=O,_=v);const M=b.units,I=_.unitMap,l=[];for(let m=0,u=M.length;m<u;m++){const d=M[m];if(!I.has(d.id))continue;const s=I.get(d.id);if(o.SortedArray.areIntersecting(d.elements,s.elements)){const C=o.SortedArray.intersect(d.elements,s.elements);l[l.length]=d.getChild(C)}}return e.oE.create(l,{parent:v.parent||O.parent})}function i(v,O){if(v===O)return e.oE.Empty;if(!y(v,O))return v;const b=v.units,_=O.unitMap,M=[];for(let I=0,l=b.length;I<l;I++){const m=b[I];if(!_.has(m.id)){M[M.length]=m;continue}const u=_.get(m.id),d=o.SortedArray.subtract(m.elements,u.elements);d.length>0&&(M[M.length]=m.getChild(d))}return e.oE.create(M,{parent:v.parent||O.parent})}},8672:(tn,Ue,n)=>{"use strict";n.d(Ue,{gn:()=>A.gn,oE:()=>o.o,iZ:()=>e.i,StructureProperties:()=>y.Z,us:()=>t.u,Nf:()=>r.N,X$:()=>c.X});var e=n(1541),o=n(1969),r=n(8960),t=n(5685),A=n(1739),y=n(14),c=n(4561),i=n(7421),v=n(2524);n(6220);n(3543),n(6710);var N=n(6651),H=(n(9986),n(9677)),$=n(8382);function W(ae,ge){if(v.K4.is(ae.sourceData))return ae.sourceData.data.db[ge]}function ye(ae){if(0===ae.length)return[];if(1===ae.length)return ae[0].entityIndices;const ge=H.th.create();for(const Ie of ae)for(const Le of Ie.entityIndices)H.th.add(ge,Le,Le);return(0,$.eh)(ge.array),ge.array}function j(ae,ge){return{name:ae,instance({structures:Ie}){if(ge&&!ge(Ie[0]))return i.c.Category.Empty;const Le=Ie[0].model;if(!v.K4.is(Le.sourceData))return i.c.Category.Empty;const nt=Le.sourceData.data.db[ae];return nt&&nt._rowCount?i.c.Category.ofTable(nt):i.c.Category.Empty}}}n(5165);var le=i.c.Category;Re("struct_asym"),Re("entity_poly"),Re("entity_poly_seq");function Re(ae){return{name:ae,instance:({structures:ge,cache:Ie})=>function ke(ae,ge,Ie){const Le=W(ae[0].model,ge);if(!Le)return le.Empty;const{entity_id:nt}=Le,je=Ie.uniqueEntityIds||(Ie.uniqueEntityIds=function de(ae){if(0===ae.length)return new Set;const ge=ae[0].model.entities.data.id;return new Set(ye(ae).map(Ie=>ge.value(Ie)))}(ae)),Lt=N.VP.indicesOf(nt,Je=>je.has(Je));return le.ofTable(Le,Lt)}(ge,ae,Ie)}}n(1692),n(1490);var Ve;(Ve||(Ve={})).create=function ge(Ie){const Le=Array.isArray(Ie)?Ie:[Ie];return{structures:Le,firstModel:Le[0].model,cache:Object.create(null)}};function K(ae){return ae.units.every(ge=>ge.conformation.operator.isIdentity)}function ne(ae){return K(ae)&&ae.units.every(ge=>!ge.conformation.operator.assembly&&!ge.conformation.operator.suffix)}var Te;j("entry"),j("exptl"),j("cell",K),j("symmetry",K),j("pdbx_struct_assembly",ne),j("pdbx_struct_assembly_gen",ne),j("pdbx_struct_oper_list",ne),j("pdbx_entity_branch"),j("pdbx_entity_branch_link"),j("pdbx_branch_scheme"),j("struct_conn"),j("atom_sites"),(Te||(Te={})).AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])},442:(tn,Ue,n)=>{"use strict";n.d(Ue,{dV:()=>M,G7:()=>t,yt:()=>C,RP:()=>r,Dr:()=>_,xY:()=>O,N0:()=>v,GW:()=>s});var e=n(190);const o=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9RN","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1AIO","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VDF","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WOO","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6X","X6Y","XBP","XDP","XDX","XGP","XIL","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]);var r=function(h){return h[h.FilledSphere=0]="FilledSphere",h[h.FilledCube=1]="FilledCube",h[h.CrossedCube=2]="CrossedCube",h[h.DividedDiamond=3]="DividedDiamond",h[h.FilledCone=4]="FilledCone",h[h.DevidedCone=5]="DevidedCone",h[h.FlatBox=6]="FlatBox",h[h.FilledStar=7]="FilledStar",h[h.FilledDiamond=8]="FilledDiamond",h[h.FlatDiamond=9]="FlatDiamond",h[h.FlatHexagon=10]="FlatHexagon",h[h.Pentagon=11]="Pentagon",h[h.DiamondPrism=12]="DiamondPrism",h[h.PentagonalPrism=13]="PentagonalPrism",h[h.HexagonalPrism=14]="HexagonalPrism",h[h.HeptagonalPrism=15]="HeptagonalPrism",h}(r||{});const t=(0,e._j)({Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817});var A=function(h){return h[h.Hexose=0]="Hexose",h[h.HexNAc=1]="HexNAc",h[h.Hexosamine=2]="Hexosamine",h[h.Hexuronate=3]="Hexuronate",h[h.Deoxyhexose=4]="Deoxyhexose",h[h.DeoxyhexNAc=5]="DeoxyhexNAc",h[h.DiDeoxyhexose=6]="DiDeoxyhexose",h[h.Pentose=7]="Pentose",h[h.Deoxynonulosonate=8]="Deoxynonulosonate",h[h.DiDeoxynonulosonate=9]="DiDeoxynonulosonate",h[h.Unknown=10]="Unknown",h[h.Assigned=11]="Assigned",h}(A||{});const i={[A.Hexose]:r.FilledSphere,[A.HexNAc]:r.FilledCube,[A.Hexosamine]:r.CrossedCube,[A.Hexuronate]:r.DividedDiamond,[A.Deoxyhexose]:r.FilledCone,[A.DeoxyhexNAc]:r.DevidedCone,[A.DiDeoxyhexose]:r.FlatBox,[A.Pentose]:r.FilledStar,[A.Deoxynonulosonate]:r.FilledDiamond,[A.DiDeoxynonulosonate]:r.FlatDiamond,[A.Unknown]:r.FlatHexagon,[A.Assigned]:r.Pentagon};function v(h,a){return h===A.Unknown?4===a?r.DiamondPrism:5===a?r.PentagonalPrism:6===a?r.HexagonalPrism:7===a?r.HeptagonalPrism:r.FlatHexagon:i[h]}const O={abbr:"Unk",name:"Unknown",color:t.Secondary,type:A.Unknown},b=[{abbr:"Glc",name:"Glucose",color:t.Blue,type:A.Hexose},{abbr:"Man",name:"Mannose",color:t.Green,type:A.Hexose},{abbr:"Gal",name:"Galactose",color:t.Yellow,type:A.Hexose},{abbr:"Gul",name:"Gulose",color:t.Orange,type:A.Hexose},{abbr:"Alt",name:"Altrose",color:t.Pink,type:A.Hexose},{abbr:"All",name:"Allose",color:t.Purple,type:A.Hexose},{abbr:"Tal",name:"Talose",color:t.LightBlue,type:A.Hexose},{abbr:"Ido",name:"Idose",color:t.Brown,type:A.Hexose},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:t.Blue,type:A.HexNAc},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:t.Green,type:A.HexNAc},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:t.Yellow,type:A.HexNAc},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:t.Orange,type:A.HexNAc},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:t.Pink,type:A.HexNAc},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:t.Purple,type:A.HexNAc},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:t.LightBlue,type:A.HexNAc},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:t.Brown,type:A.HexNAc},{abbr:"GlcN",name:"Glucosamine",color:t.Blue,type:A.Hexosamine},{abbr:"ManN",name:"Mannosamine",color:t.Green,type:A.Hexosamine},{abbr:"GalN",name:"Galactosamine",color:t.Yellow,type:A.Hexosamine},{abbr:"GulN",name:"Gulosamine",color:t.Orange,type:A.Hexosamine},{abbr:"AltN",name:"Altrosamine",color:t.Pink,type:A.Hexosamine},{abbr:"AllN",name:"Allosamine",color:t.Purple,type:A.Hexosamine},{abbr:"TalN",name:"Talosamine",color:t.LightBlue,type:A.Hexosamine},{abbr:"IdoN",name:"Idosamine",color:t.Brown,type:A.Hexosamine},{abbr:"GlcA",name:"Glucuronic Acid",color:t.Blue,type:A.Hexuronate},{abbr:"ManA",name:"Mannuronic Acid",color:t.Green,type:A.Hexuronate},{abbr:"GalA",name:"Galacturonic Acid",color:t.Yellow,type:A.Hexuronate},{abbr:"GulA",name:"Guluronic Acid",color:t.Orange,type:A.Hexuronate},{abbr:"AltA",name:"Altruronic Acid",color:t.Pink,type:A.Hexuronate},{abbr:"AllA",name:"Alluronic Acid",color:t.Purple,type:A.Hexuronate},{abbr:"TalA",name:"Taluronic Acid",color:t.LightBlue,type:A.Hexuronate},{abbr:"IdoA",name:"Iduronic Acid",color:t.Brown,type:A.Hexuronate},{abbr:"Qui",name:"Quinovose",color:t.Blue,type:A.Deoxyhexose},{abbr:"Rha",name:"Rhamnose",color:t.Green,type:A.Deoxyhexose},{abbr:"6dGul",name:"6-Deoxy Gulose",color:t.Orange,type:A.Deoxyhexose},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:t.Pink,type:A.Deoxyhexose},{abbr:"6dTal",name:"6-Deoxy Talose",color:t.LightBlue,type:A.Deoxyhexose},{abbr:"Fuc",name:"Fucose",color:t.Red,type:A.Deoxyhexose},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:t.Blue,type:A.DeoxyhexNAc},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:t.Green,type:A.DeoxyhexNAc},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:t.Pink,type:A.DeoxyhexNAc},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:t.LightBlue,type:A.DeoxyhexNAc},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:t.Red,type:A.DeoxyhexNAc},{abbr:"Oli",name:"Olivose",color:t.Blue,type:A.DiDeoxyhexose},{abbr:"Tyv",name:"Tyvelose",color:t.Green,type:A.DiDeoxyhexose},{abbr:"Abe",name:"Abequose",color:t.Orange,type:A.DiDeoxyhexose},{abbr:"Par",name:"Paratose",color:t.Pink,type:A.DiDeoxyhexose},{abbr:"Dig",name:"Digitoxose",color:t.Purple,type:A.DiDeoxyhexose},{abbr:"Col",name:"Colitose",color:t.LightBlue,type:A.DiDeoxyhexose},{abbr:"Ara",name:"Arabinose",color:t.Green,type:A.Pentose},{abbr:"Lyx",name:"Lyxose",color:t.Yellow,type:A.Pentose},{abbr:"Xyl",name:"Xylose",color:t.Orange,type:A.Pentose},{abbr:"Rib",name:"Ribose",color:t.Pink,type:A.Pentose},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:t.Green,type:A.Deoxynonulosonate},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:t.Purple,type:A.Deoxynonulosonate},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:t.LightBlue,type:A.Deoxynonulosonate},{abbr:"Neu",name:"Neuraminic Acid",color:t.Brown,type:A.Deoxynonulosonate},{abbr:"Sia",name:"Sialic acid",color:t.Red,type:A.Deoxynonulosonate},{abbr:"Pse",name:"Pseudaminic Acid",color:t.Green,type:A.DiDeoxynonulosonate},{abbr:"Leg",name:"Legionaminic Acid",color:t.Yellow,type:A.DiDeoxynonulosonate},{abbr:"Aci",name:"Acinetaminic Acid",color:t.Pink,type:A.DiDeoxynonulosonate},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:t.LightBlue,type:A.DiDeoxynonulosonate},{abbr:"Bac",name:"Bacillosamine",color:t.Blue,type:A.Unknown},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:t.Green,type:A.Unknown},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:t.Yellow,type:A.Unknown},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:t.Orange,type:A.Unknown},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:t.Pink,type:A.Unknown},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:t.Purple,type:A.Unknown},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:t.LightBlue,type:A.Unknown},{abbr:"Mur",name:"Muramic Acid",color:t.Brown,type:A.Unknown},{abbr:"Api",name:"Apicose",color:t.Green,type:A.Assigned},{abbr:"Fru",name:"Fructose",color:t.Green,type:A.Assigned},{abbr:"Tag",name:"Tagatose",color:t.Yellow,type:A.Assigned},{abbr:"Sor",name:"Sorbose",color:t.Orange,type:A.Assigned},{abbr:"Psi",name:"Psicose",color:t.Pink,type:A.Assigned}],_=function(){const h=new Map;for(let a=0,S=b.length;a<S;++a){const D=b[a];h.set(D.abbr,D)}return h}(),M=[["Glc-family",t.Blue],["Man-family",t.Green],["Gal-family",t.Yellow],["Gul-family",t.Orange],["Alt-family",t.Pink],["All-family",t.Purple],["Tal-family",t.LightBlue],["Ido-family",t.Brown],["Fuc-family",t.Red],["Generic/Unknown/Secondary",t.Secondary]],I={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},l={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},m={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"],Abe:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"],Bac:["0BC","3BC","0bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"]},u=function(){const h=new Map;for(let a=0,S=b.length;a<S;++a){const D=b[a],R=I[D.abbr];if(R)for(let p=0,E=R.length;p<E;++p)h.set(R[p],D);const f=l[D.abbr];if(f)for(let p=0,E=f.length;p<E;++p)h.set(f[p],D)}return o.forEach(a=>{h.has(a)||h.set(a,O)}),h}(),d=function(){const h=new Map;for(let a=0,S=b.length;a<S;++a){const D=b[a],R=I[D.abbr];if(R)for(let E=0,T=R.length;E<T;++E)h.set(R[E],D);const f=l[D.abbr];if(f)for(let E=0,T=f.length;E<T;++E)h.set(f[E],D);const p=m[D.abbr];if(p)for(let E=0,T=p.length;E<T;++E)h.has(p[E])||h.set(p[E],D)}return o.forEach(a=>{h.has(a)||h.set(a,O)}),h}();function s(h){C="default"===h?u:d}let C=u},1541:(tn,Ue,n)=>{"use strict";n.d(Ue,{i:()=>e});var e={};n.r(e),n.d(e,{Bundle:()=>t.N,Location:()=>o.a,Loci:()=>r.Q,Stats:()=>c,atomicProperty:()=>b,chainIndex:()=>I,coarseProperty:()=>_,entityIndex:()=>l,property:()=>v,residueIndex:()=>M});var c,o=n(1185),r=n(3931),t=n(7686),A=n(3543),y=n(8960);!function(m){function u(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:o.a.create(void 0),firstConformationLoc:o.a.create(void 0),firstResidueLoc:o.a.create(void 0),firstChainLoc:o.a.create(void 0),firstUnitLoc:o.a.create(void 0),firstStructureLoc:o.a.create(void 0)}}function d(D,R,f){const p=D.get(R)||0;D.set(R,p+f)}function s(D,R,f){const{indices:p,unit:E}=f,{elements:T}=E,L=A.CD.size(p),w=new Map,Q=new Map;if(L>0&&o.a.set(D.firstElementLoc,R,E,T[A.CD.start(p)]),L===T.length)D.unitCount+=1,1===D.unitCount&&o.a.set(D.firstUnitLoc,R,E,T[A.CD.start(p)]);else if(1===L){if(y.N.Traits.is(E.traits,y.N.Trait.MultiChain))return;D.elementCount+=1,1===D.elementCount&&o.a.set(D.firstElementLoc,R,E,T[A.CD.start(p)])}else if(y.N.isAtomic(E)){const{index:G,offsets:V}=E.model.atomicHierarchy.residueAtomSegments,{label_alt_id:U}=E.model.atomicHierarchy.atoms;let N=0;for(;N<L;){w.clear();let k=0;const H=T[A.CD.getAt(p,N)],$=G[H];for(d(w,U.value(H),1),++N,++k;N<L;){const J=T[A.CD.getAt(p,N)];if(G[J]!==$)break;d(w,U.value(J),1),++N,++k}if(V[$+1]-V[$]===k)D.residueCount+=1,1===D.residueCount&&o.a.set(D.firstResidueLoc,R,E,V[$]);else{Q.clear();for(let J=V[$],W=V[$+1];J<W;++J)d(Q,U.value(J),1);Q.get("")===w.get("")&&w.forEach((J,W)=>{if(Q.get(W)===J){if(""!==W&&(D.conformationCount+=1,1===D.conformationCount))for(let te=V[$],de=V[$+1];te<de;++te)if(W===U.value(te)){o.a.set(D.firstConformationLoc,R,E,te);break}k-=J}}),D.elementCount+=k}}}else D.elementCount+=L,1===D.elementCount&&o.a.set(D.firstElementLoc,R,E,T[A.CD.start(p)])}function C(D,R,f){const{indices:p,unit:E}=f,T=A.CD.size(p);if(0===T)return;const{elements:L}=E;if(!y.N.Traits.is(E.traits,y.N.Trait.MultiChain))return void(T===L.length&&(D.chainCount+=1,1===D.chainCount&&o.a.set(D.firstChainLoc,R,E,L[A.CD.start(p)])));const w=y.N.isAtomic(E)?E.model.atomicHierarchy.chainAtomSegments:y.N.isSpheres(E)?E.model.coarseHierarchy.spheres.chainElementSegments:y.N.isGaussians(E)?E.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!w)return void console.warn("StructureElement loci stats: unknown unit type");const{index:Q,offsets:G}=w;let V=0;for(;V<T;){let U=0;const N=L[A.CD.getAt(p,V)],k=Q[N];for(++V,++U;V<T&&Q[L[A.CD.getAt(p,V)]]===k;)++V,++U;G[k+1]-G[k]===U?(D.chainCount+=1,1===D.chainCount&&o.a.set(D.firstChainLoc,R,E,G[k])):1===T&&(D.elementCount+=1,1===D.elementCount&&o.a.set(D.firstElementLoc,R,E,N))}}function h(D,R,f,p,E){let T=f[p];const L=y.N.isAtomic(T.unit)?T.unit.model.atomicHierarchy.chainAtomSegments:y.N.isSpheres(T.unit)?T.unit.model.coarseHierarchy.spheres.chainElementSegments:y.N.isGaussians(T.unit)?T.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!L)return void console.warn("StructureElement loci stats: unknown unit type");const{index:w,offsets:Q}=L,G=new Map;for(let U=p;U<E;U++){T=f[U];const{indices:N,unit:k}=T,H=A.CD.size(N);if(0===H)continue;const{elements:$}=k;if(!y.N.Traits.is(k.traits,y.N.Trait.MultiChain)){d(G,w[$[A.CD.start(N)]],$.length);continue}let J=0;for(;J<H;){let W=0;const de=w[$[A.CD.getAt(N,J)]];for(++J,++W;J<H&&w[$[A.CD.getAt(N,J)]]===de;)++J,++W;d(G,de,W)}}let V=-1;if(G.forEach((U,N)=>{Q[N+1]-Q[N]===U&&(D.chainCount+=1,1===D.chainCount&&(V=N))}),!(V<0))for(let U=p;U<E;U++){T=f[U];const{indices:N,unit:k}=T,H=A.CD.size(N);if(0===H)continue;const{elements:$}=k,J=0;for(;J<H;){const W=$[A.CD.getAt(N,J)];if(w[W]===V)return void o.a.set(D.firstChainLoc,R,k,W)}}}m.create=u,m.ofLoci=function a(D){const R=u();if(r.Q.isEmpty(D))return R;let f=!1;if(r.Q.isWholeStructure(D)){if(R.structureCount+=1,1===R.structureCount){const{unit:p,indices:E}=D.elements[0];o.a.set(R.firstStructureLoc,D.structure,p,p.elements[A.CD.min(E)])}}else for(const p of D.elements)s(R,D.structure,p),y.N.Traits.is(p.unit.traits,y.N.Trait.Partitioned)?f=!0:C(R,D.structure,p);if(f)for(let p=0,E=D.elements.length;p<E;p++){const T=D.elements[p];if(!y.N.Traits.is(T.unit.traits,y.N.Trait.Partitioned))continue;const L=p;for(;p<E&&y.N.areSameChainOperatorGroup(D.elements[p].unit,T.unit);)p++;const w=p;p--,w-L==1?C(R,D.structure,T):h(R,D.structure,D.elements,L,w)}return R},m.add=function S(D,R,f){return 1===R.elementCount&&0===f.elementCount?o.a.copy(D.firstElementLoc,R.firstElementLoc):0===R.elementCount&&1===f.elementCount&&o.a.copy(D.firstElementLoc,f.firstElementLoc),1===R.conformationCount&&0===f.conformationCount?o.a.copy(D.firstConformationLoc,R.firstConformationLoc):0===R.conformationCount&&1===f.conformationCount&&o.a.copy(D.firstConformationLoc,f.firstConformationLoc),1===R.residueCount&&0===f.residueCount?o.a.copy(D.firstResidueLoc,R.firstResidueLoc):0===R.residueCount&&1===f.residueCount&&o.a.copy(D.firstResidueLoc,f.firstResidueLoc),1===R.chainCount&&0===f.chainCount?o.a.copy(D.firstChainLoc,R.firstChainLoc):0===R.chainCount&&1===f.chainCount&&o.a.copy(D.firstChainLoc,f.firstChainLoc),1===R.unitCount&&0===f.unitCount?o.a.copy(D.firstUnitLoc,R.firstUnitLoc):0===R.unitCount&&1===f.unitCount&&o.a.copy(D.firstUnitLoc,f.firstUnitLoc),1===R.structureCount&&0===f.structureCount?o.a.copy(D.firstStructureLoc,R.firstStructureLoc):0===R.structureCount&&1===f.structureCount&&o.a.copy(D.firstStructureLoc,f.firstStructureLoc),D.elementCount=R.elementCount+f.elementCount,D.conformationCount=R.conformationCount+f.conformationCount,D.residueCount=R.residueCount+f.residueCount,D.chainCount=R.chainCount+f.chainCount,D.unitCount=R.unitCount+f.unitCount,D.structureCount=R.structureCount+f.structureCount,D}}(c||(c={}));var i=n(14);function v(m){return m}function O(m){throw new Error(`Property only available for ${m} models.`)}function b(m){return u=>y.N.isAtomic(u.unit)?m(u):O("atomic")}function _(m){return u=>y.N.isCoarse(u.unit)?m(u):O("coarse")}function M(m){return y.N.isAtomic(m.unit)?m.unit.residueIndex[m.element]:-1}function I(m){return y.N.isAtomic(m.unit)?m.unit.chainIndex[m.element]:-1}function l(m){return i.Z.entity.key(m)}},7686:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>i});var i,e=n(3543),o=n(1969),r=n(8382),t=n(5734),A=n(3931),y=n(9767),c=n(2516);!function(v){function _(s){const C=[];for(const S of s.elements){const{unit:D,indices:R}=S;if(0===e.CD.size(R))continue;const f=[],p=[];if(e.CD.isInterval(R))1===e.CD.size(R)?p.push(e.IX.min(R)):f.push(e.IX.min(R),e.IX.max(R));else{let E=0;const T=R.length;for(;E<T;){const L=E;for(E++;E<T&&R[E-1]+1===R[E];)E++;const w=E;if(w-L>2)f.push(R[L],R[w-1]);else for(let Q=L;Q<w;Q++)p[p.length]=R[Q]}}C.push({unit:D,set:e.SortedArray.ofSortedArray(p),ranges:t.m.ofSortedRanges(f)})}const h=new Map;for(let S=0,D=C.length;S<D;++S){const R=C[S],f=(0,r.vb)((0,r.TI)(R.ranges),(0,r.TI)(R.set));if(h.has(f)){const{groupedUnits:p}=h.get(f);p.has(R.unit.invariantId)?p.get(R.unit.invariantId).push(R.unit.id):p.set(R.unit.invariantId,[R.unit.id])}else{const p=new Map;p.set(R.unit.invariantId,[R.unit.id]),h.set(f,{groupedUnits:p,set:R.set,ranges:R.ranges})}}const a=[];return h.forEach(S=>{const D=[];S.groupedUnits.forEach(R=>D.push(e.SortedArray.ofUnsortedArray(R))),D.sort((R,f)=>R[0]-f[0]),a.push({groupedUnits:D,set:S.set,ranges:S.ranges})}),{hash:s.structure.hashCode,elements:a}}function M(s,C){const h=[];for(let a=0,S=s.length;a<S;++a){const D=s[a];C.unitMap.has(D)&&h.push(C.unitMap.get(D))}return h}function m(s){return y.J.internal.generator.bundleElement({groupedUnits:y.J.core.type.list(s.groupedUnits.map(C=>y.J.core.type.list(C))),ranges:y.J.core.type.list(s.ranges),set:y.J.core.type.list(s.set)})}v.Empty={hash:-1,elements:[]},v.fromSubStructure=function O(s,C){return _(c.cv.toLociWithSourceUnits(c.cv.Singletons(s,C)))},v.fromSelection=function b(s){return _(c.cv.toLociWithSourceUnits(s))},v.fromLoci=_,v.toLoci=function I(s,C){-1!==s.hash&&s.hash!==C.hashCode&&new Error("Bundle not compatible with given structure");const h=[];for(const a of s.elements)for(const S of a.groupedUnits){const D=M(S,C);if(0===D.length)continue;let R;if(0===a.ranges.length)R=a.set;else if(0===a.set.length)if(2===a.ranges.length)R=e.IX.ofRange(a.ranges[0],a.ranges[1]);else{const f=new Int32Array(t.m.size(a.ranges));t.m.forEach(a.ranges,(p,E)=>f[E]=p),R=e.SortedArray.ofSortedArray(f)}else{const f=t.m.size(a.ranges),p=new Int32Array(a.set.length+f);t.m.forEach(a.ranges,(E,T)=>p[T]=E),p.set(a.set,f),R=e.SortedArray.ofUnsortedArray(p)}for(const f of D)h.push({unit:f,indices:R})}return(0,A.Q)(C,h)},v.toStructure=function l(s,C){-1!==s.hash&&s.hash!==C.hashCode&&new Error("Bundle not compatible with given structure");const h=[];for(const a of s.elements)for(const S of a.groupedUnits){const D=M(S,C);if(0===D.length)continue;const R=D[0].elements,f=t.m.size(a.ranges),p=a.set.length,E=new Int32Array(p+f);let T;if(0===f){for(let L=0,w=p;L<w;++L)E[L]=R[a.set[L]];T=e.SortedArray.ofSortedArray(E)}else if(0===p)t.m.forEach(a.ranges,(L,w)=>E[w]=R[L]),T=e.SortedArray.ofSortedArray(E);else if(e.SortedArray.min(a.set)>t.m.max(a.ranges)){t.m.forEach(a.ranges,(L,w)=>E[w]=R[L]);for(let L=0,w=p;L<w;++L)E[L+f]=R[a.set[L]];T=e.SortedArray.ofSortedArray(E)}else if(t.m.min(a.ranges)>e.SortedArray.max(a.set)){for(let L=0,w=p;L<w;++L)E[L]=R[a.set[L]];t.m.forEach(a.ranges,(L,w)=>E[w+p]=R[L]),T=e.SortedArray.ofSortedArray(E)}else{t.m.forEach(a.ranges,(L,w)=>E[w]=R[L]);for(let L=0,w=p;L<w;++L)E[L+f]=R[a.set[L]];T=e.SortedArray.ofUnsortedArray(E)}for(const L of D)h.push(L.getChild(T))}return o.o.create(h,{parent:C})},v.toExpression=function u(s){return y.J.internal.generator.bundle({elements:y.J.core.type.list(s.elements.map(m))})},v.areEqual=function d(s,C){if(s.elements.length!==C.elements.length)return!1;for(let h=0,a=s.elements.length;h<a;++h){const S=s.elements[h],D=C.elements[h];if(S.groupedUnits.length!==D.groupedUnits.length)return!1;for(let R=0,f=D.groupedUnits.length;R<f;++R)if(!e.SortedArray.areEqual(S.groupedUnits[R],D.groupedUnits[R]))return!1;if(!e.SortedArray.areEqual(S.set,D.set)||!t.m.areEqual(S.ranges,D.ranges))return!1}return!0}}(i||(i={}))},1185:(tn,Ue,n)=>{"use strict";n.d(Ue,{a:()=>o});var o,e=n(4369);!function(r){function t(m,u,d){return{kind:"element-location",structure:m,unit:u,element:d||0}}r.create=t,r.clone=function A(m){return t(m.structure,m.unit,m.element)},r.set=function y(m,u,d,s){return u&&(m.structure=u),d&&(m.unit=d),void 0!==s&&(m.element=s),m},r.copy=function c(m,u){return m.unit=u.unit,m.element=u.element,m},r.is=function i(m){return!!m&&"element-location"===m.kind},r.areEqual=function v(m,u){return m.unit===u.unit&&m.element===u.element};const O=(0,e.eB)(),b=(0,e.eB)();r.distance=function _(m,u){return m.unit.conformation.position(m.element,O),u.unit.conformation.position(u.element,b),e.eB.distance(O,b)},r.position=function M(m,u){return u.unit.conformation.position(u.element,m)},r.residueIndex=function I(m){return m.unit.model.atomicHierarchy.residueAtomSegments.index[m.element]},r.chainIndex=function l(m){return m.unit.model.atomicHierarchy.chainAtomSegments.index[m.element]}}(o||(o={}))},3931:(tn,Ue,n)=>{"use strict";n.d(Ue,{Q:()=>I});var e=n(9677),o=n(3543),r=n(4369),t=n(9767),A=n(1969),y=n(8960),c=n(8382),i=n(1185),v=n(8199),O=n(14),b=n(7136);const M=n(3370).U.diff;function I(l,m){return{kind:"element-loci",structure:l,elements:m}}!function(l){function d(we){for(const Oe of we.elements)if(o.CD.size(Oe.indices)>0)return!1;return!0}function C(we){let Oe=0;for(const{indices:Se}of we.elements)Oe+="number"==typeof Se?M(Se):Se.length;return Oe}function D(we){return d(we)?we:l(we.structure,[{unit:we.elements[0].unit,indices:o.CD.ofSingleton(o.CD.start(we.elements[0].indices))}])}function U(we){return we.length>3&&o.SortedArray.isRange(we)?o.IX.ofRange(we[0],we[we.length-1]):o.SortedArray.ofSortedArray(we)}function N(we,Oe){const Se=[],Ve=new Set;for(const Ne of we.elements)if(H(Ne))Se[Se.length]=Ne;else if(0===Ne.unit.kind){const K=Ne.unit.elements,ne=Ne.unit.model.atomicHierarchy,{label_alt_id:be}=Ne.unit.model.atomicHierarchy.atoms,{index:Te,offsets:ie}=ne.residueAtomSegments,ue=[],re=Ne.indices,ve=o.CD.size(re);let ce=0;for(;ce<ve;){Ve.clear();const se=K[o.CD.getAt(re,ce)],ae=Te[se];for(Ve.add(be.value(se)),ce++;ce<ve;){const Ie=K[o.CD.getAt(re,ce)];if(Te[Ie]!==ae)break;Ve.add(be.value(Ie)),ce++}const ge=Ve.has("");for(let Ie=ie[ae],Le=ie[ae+1];Ie<Le;Ie++){const nt=o.CD.indexOf(K,Ie);if(nt>=0){const je=be.value(Ie);(!Oe||ge||!je||Ve.has(je))&&(ue[ue.length]=nt)}}}Se[Se.length]={unit:Ne.unit,indices:U(ue)}}else Se[Se.length]=Ne;return l(we.structure,Se)}function k(we){switch(we.kind){case 0:return we.model.atomicHierarchy.chainAtomSegments;case 1:return we.model.coarseHierarchy.spheres.chainElementSegments;case 2:return we.model.coarseHierarchy.gaussians.chainElementSegments}}function H(we){return we.unit.elements.length===o.CD.size(we.indices)}function $(we,Oe,Se){const{index:Ve}=k(we),Ne=we.elements;let K=0;for(let be=0,Te=Ne.length;be<Te;be++)Oe.has(Ve[Ne[be]])&&K++;if(K===we.elements.length)return void(Se[Se.length]={unit:we,indices:o.IX.ofBounds(0,K)});const ne=new Int32Array(K);K=0;for(let be=0,Te=Ne.length;be<Te;be++)Oe.has(Ve[Ne[be]])&&(ne[K++]=be);ne.length>0&&(Se[Se.length]={unit:we,indices:U(ne)})}function J(we,Oe,Se,Ve,Ne){const{index:K}=k(we.elements[0].unit),ne=new Set;for(let be=Oe;be<Se;be++){const Te=we.elements[be],ie=Te.indices,ue=Te.unit.elements;for(let re=0,ve=o.CD.size(ie);re<ve;re++)ne.add(K[ue[o.CD.getAt(ie,re)]])}if(Ve){const be=we.elements[0].unit;for(const Te of we.structure.units)y.N.areSameChainOperatorGroup(Te,be)&&$(Te,ne,Ne)}else for(let be=Oe;be<Se;be++)$(we.elements[be].unit,ne,Ne)}function W(we){const Oe=[];for(let Se=0,Ve=we.elements.length;Se<Ve;Se++){const Ne=we.elements[Se];if(y.N.Traits.is(Ne.unit.traits,y.N.Trait.Partitioned)){const K=Se;for(;Se<Ve&&y.N.areSameChainOperatorGroup(we.elements[Se].unit,Ne.unit);)Se++;const ne=Se;Se--,J(we,K,ne,!0,Oe)}else H(Ne)?Oe[Oe.length]=Ne:J(we,Se,Se+1,!1,Oe)}return l(we.structure,Oe)}function te(we){return`${we.unit.model.id}|${O.Z.entity.id(we)}`}function j(we,Oe){const Se=[];for(let Ve=0,Ne=o.CD.size(Oe);Ve<Ne;++Ve)Se.push(we[o.CD.getAt(Oe,Ve)]);return o.SortedArray.ofSortedArray(Se)}function Z(we,Oe){return o.SortedArray.isRange(we)&&o.SortedArray.areEqual(we,Oe)?o.IX.ofLength(we.length):U(o.SortedArray.indicesOf(we,Oe))}l.is=function m(we){return!!we&&"element-loci"===we.kind},l.areEqual=function u(we,Oe){if(we.structure!==Oe.structure||we.elements.length!==Oe.elements.length)return!1;for(let Se=0,Ve=we.elements.length;Se<Ve;++Se){const Ne=we.elements[Se],K=Oe.elements[Se];if(Ne.unit.id!==K.unit.id||!o.CD.areEqual(Ne.indices,K.indices))return!1}return!0},l.isEmpty=d,l.isWholeStructure=function s(we){return C(we)===we.structure.elementCount},l.size=C,l.all=function h(we){return l(we,we.units.map(Oe=>({unit:Oe,indices:o.CD.ofBounds(0,Oe.elements.length)})))},l.none=function a(we){return l(we,[])},l.getFirstLocation=function S(we,Oe){if(d(we))return;const Se=we.elements[0].unit,Ve=Se.elements[o.CD.getAt(we.elements[0].indices,0)];return Oe?(Oe.structure=we.structure,Oe.unit=we.elements[0].unit,Oe.element=Ve,Oe):i.a.create(we.structure,Se,Ve)},l.firstElement=D,l.firstResidue=function R(we){return d(we)?we:N(D(we))},l.firstChain=function f(we){return d(we)?we:W(D(we))},l.toStructure=function p(we){const Oe=[];for(const Se of we.elements){const{unit:Ve,indices:Ne}=Se,K=new Int32Array(o.CD.size(Ne));o.CD.forEach(Ne,(ne,be)=>K[be]=Ve.elements[ne]),Oe.push(Ve.getChild(o.SortedArray.ofSortedArray(K)))}return A.o.create(Oe,{parent:we.structure.parent})},l.forEachLocation=function E(we,Oe){if(l.isEmpty(we))return;const Se=i.a.create(we.structure);for(const Ve of we.elements){const{unit:Ne,indices:K}=Ve;Se.unit=Ne;const{elements:ne}=Ve.unit;for(let be=0,Te=o.CD.size(K);be<Te;be++)Se.element=ne[o.CD.getAt(K,be)],Oe(Se)}},l.remap=function T(we,Oe){if(Oe===we.structure)return we;const Se=[];return we.elements.forEach(Ve=>{if(!Oe.unitMap.has(Ve.unit.id))return;const Ne=Oe.unitMap.get(Ve.unit.id),K=o.CD.indexedIntersect(Ve.indices,Ve.unit.elements,Ne.elements);o.CD.size(K)>0&&Se.push({unit:Ne,indices:K})}),l(Oe,Se)},l.union=function L(we,Oe){if(we.elements.length>Oe.elements.length)return L(Oe,we);if(l.isEmpty(we))return Oe;const Se=new Map;for(const Ne of we.elements)Se.set(Ne.unit.id,Ne.indices);const Ve=[];for(const Ne of Oe.elements)Se.has(Ne.unit.id)?(Ve[Ve.length]={unit:Ne.unit,indices:o.CD.union(Se.get(Ne.unit.id),Ne.indices)},Se.delete(Ne.unit.id)):Ve[Ve.length]=Ne;return Se.forEach((Ne,K)=>{Ve[Ve.length]={unit:we.structure.unitMap.get(K),indices:Ne}}),l(we.structure,Ve)},l.subtract=function w(we,Oe){const Se=new Map;for(const Ne of Oe.elements)Se.set(Ne.unit.id,Ne.indices);const Ve=[];for(const Ne of we.elements)if(Se.has(Ne.unit.id)){const K=o.CD.subtract(Ne.indices,Se.get(Ne.unit.id));if(0===o.CD.size(K))continue;Ve[Ve.length]={unit:Ne.unit,indices:K}}else Ve[Ve.length]=Ne;return l(we.structure,Ve)},l.intersect=function Q(we,Oe){const Se=new Map;for(const Ne of we.elements)Se.set(Ne.unit.id,Ne.indices);const Ve=[];for(const Ne of Oe.elements){if(!Se.has(Ne.unit.id))continue;const K=o.CD.intersect(Se.get(Ne.unit.id),Ne.indices);0!==o.CD.size(K)&&(Ve[Ve.length]={unit:Ne.unit,indices:K})}return l(we.structure,Ve)},l.areIntersecting=function G(we,Oe){if(we.elements.length>Oe.elements.length)return G(Oe,we);if(l.isEmpty(we))return l.isEmpty(Oe);const Se=new Map;for(const Ve of we.elements)Se.set(Ve.unit.id,Ve.indices);for(const Ve of Oe.elements)if(Se.has(Ve.unit.id)&&o.CD.areIntersecting(Se.get(Ve.unit.id),Ve.indices))return!0;return!1},l.isSubset=function V(we,Oe){if(l.isEmpty(we))return l.isEmpty(Oe);const Se=new Map;for(const Ne of we.elements)Se.set(Ne.unit.id,Ne.indices);let Ve=!1;for(const Ne of Oe.elements)if(Se.has(Ne.unit.id)){if(!o.CD.isSubset(Se.get(Ne.unit.id),Ne.indices))return!1;Ve=!0}return Ve},l.extendToWholeResidues=N,l.extendToWholeChains=W,l.extendToWholeEntities=function de(we){const Oe=[],Se=i.a.create(we.structure),Ve=new Set,{units:Ne}=we.structure;for(let K=0,ne=we.elements.length;K<ne;K++){const be=we.elements[K];Se.unit=be.unit,Se.element=be.unit.elements[0],Ve.add(te(Se))}for(let K=0,ne=Ne.length;K<ne;++K){const be=Ne[K];if(Se.unit=be,Se.element=be.elements[0],Ve.has(te(Se))){const Te=o.CD.ofBounds(0,be.elements.length);Oe[Oe.length]={unit:be,indices:Te}}}return l(we.structure,Oe)},l.extendToWholeModels=function ye(we){const Oe=[],Se=new Set,{units:Ve}=we.structure;for(let Ne=0,K=we.elements.length;Ne<K;Ne++)Se.add(we.elements[Ne].unit.model.id);for(let Ne=0,K=Ve.length;Ne<K;++Ne){const ne=Ve[Ne];if(Se.has(ne.model.id)){const be=o.CD.ofBounds(0,ne.elements.length);Oe[Oe.length]={unit:ne,indices:be}}}return l(we.structure,Oe)},l.extendToAllInstances=function q(we){const Oe=[],Se=new Map;for(let Ve=0,Ne=we.elements.length;Ve<Ne;Ve++){const K=we.elements[Ve],{model:ne}=K.unit,be=j(K.unit.elements,K.indices);Se.has(ne)?Se.set(ne,o.SortedArray.union(be,Se.get(ne))):Se.set(ne,be)}for(let Ve=0,Ne=we.structure.units.length;Ve<Ne;++Ve){const K=we.structure.units[Ve],ne=Se.get(K.model);if(!ne)continue;const be=Z(K.elements,ne);o.CD.size(be)&&(Oe[Oe.length]={unit:K,indices:be})}return l(we.structure,Oe)},l.extendToWholeOperators=function Y(we){const Oe=[],Se=new Set,{units:Ve}=we.structure;for(let Ne=0,K=we.elements.length;Ne<K;Ne++)Se.add(we.elements[Ne].unit.conformation.operator.name);for(let Ne=0,K=Ve.length;Ne<K;++Ne){const ne=Ve[Ne];if(Se.has(ne.conformation.operator.name)){const be=o.CD.ofBounds(0,ne.elements.length);Oe[Oe.length]={unit:ne,indices:be}}}return l(we.structure,Oe)};const ee=new b.Z("98"),g=(0,r.eB)();l.getBoundary=function _e(we,Oe){ee.reset();for(const Se of we.elements){const{indices:Ve}=Se,{elements:Ne,conformation:K}=Se.unit;for(let ne=0,be=o.CD.size(Ve);ne<be;ne++){const Te=Ne[o.CD.getAt(Ve,ne)];K.position(Te,g),Oe&&r.eB.transformMat4(g,g,Oe),ee.includePositionRadius(g,K.r(Te))}}ee.finishedIncludeStep();for(const Se of we.elements){const{indices:Ve}=Se,{elements:Ne,conformation:K}=Se.unit;for(let ne=0,be=o.CD.size(Ve);ne<be;ne++){const Te=Ne[o.CD.getAt(Ve,ne)];K.position(Te,g),Oe&&r.eB.transformMat4(g,g,Oe),ee.radiusPositionRadius(g,K.r(Te))}}return{box:ee.getBox(),sphere:ee.getSphere()}};const xe=(0,r.eB)();function le(we,Oe,Se=0){let Ve=Se;for(const Ne of we.elements){const{indices:K}=Ne,{elements:ne,conformation:be}=Ne.unit,Te=o.CD.size(K);for(let ie=0;ie<Te;ie++){const ue=ne[o.CD.getAt(K,ie)];be.position(ue,xe),r.eB.toArray(xe,Oe,Ve+3*ie)}Ve+=3*Te}return Oe}function Ce(we,Oe){return y.N.isAtomic(we)?we.model.atomicHierarchy.atomSourceIndex.value(Oe):Oe}function ke(we,Oe,Se,Ve,Ne){(0,c.eh)(Oe);const K=[],ne=[];let be=0;const Te=Oe.length;for(;be<Te;){const ie=be;for(be++;be<Te&&Oe[be-1]+1===Oe[be];)be++;const ue=be;if(ue-ie>12)K[K.length]=Oe[ie],K[K.length]=Oe[ue-1];else for(let re=ie;re<ue;re++)ne[ne.length]=Oe[re]}return Se?{atom:{set:ne,ranges:K},chain:{opName:[we]},entity:{modelLabel:Ve,modelIndex:Ne}}:{atom:{set:ne,ranges:K},chain:{opName:[we]}}}l.toPositionsArray=le,l.getPrincipalAxes=function Ae(we){const Oe=C(we),Se=le(we,new Float32Array(3*Oe));return v.c.ofPositions(Se)},l.getPrincipalAxesMany=function Be(we){let Oe=0;we.forEach(Ne=>{Oe+=C(Ne)});const Se=new Float32Array(3*Oe);let Ve=0;return we.forEach(Ne=>{le(Ne,Se,Ve),Ve+=3*C(Ne)}),v.c.ofPositions(Se)},l.toExpression=function Re(we){if(l.isEmpty(we))return t.J.struct.generator.empty();const Oe=we.structure.models,Se=new Map;for(const be of we.elements){const{indices:Te}=be,{elements:ie}=be.unit,ue=be.unit.conformation.operator.name;let re;Se.has(ue)?re=Se.get(ue).xs:(re=e.th.create(),Se.set(ue,{modelLabel:be.unit.model.label,modelIndex:be.unit.model.modelNum,xs:re}));for(let ve=0,ce=o.CD.size(Te);ve<ce;ve++){const se=Ce(be.unit,ie[o.CD.getAt(Te,ve)]);e.th.add(re,se,se)}}const Ve=[],Ne=Se.keys();for(;;){const be=Ne.next();if(be.done)break;const Te=Se.get(be.value);Ve.push(ke(be.value,Te.xs.array,Oe.length>1,Te.modelLabel,Te.modelIndex))}const K=new Map;for(let be=0,Te=Ve.length;be<Te;++be){const ie=Ve[be],re=`${(0,c.vb)((0,c.TI)(ie.atom.ranges),(0,c.TI)(ie.atom.set))}|${ie.entity?ie.entity.modelLabel+ie.entity.modelIndex:""}`;K.has(re)?K.get(re).chain.opName.push(...ie.chain.opName):K.set(re,ie)}const ne=[];return K.forEach(be=>{const{ranges:Te,set:ie}=be.atom,{opName:ue}=be.chain,re=t.J.struct.atomProperty.core.operatorName(),ve=t.J.struct.atomProperty.core.sourceIndex(),ce=[];ie.length>0&&(ce[ce.length]=t.J.core.set.has([t.J.core.type.set(ie),ve]));for(let se=0,ae=Te.length/2;se<ae;se++)ce[ce.length]=t.J.core.rel.inRange([ve,Te[2*se],Te[2*se+1]]);if(be.entity){const{modelLabel:se,modelIndex:ae}=be.entity;ne.push(t.J.struct.generator.atomGroups({"atom-test":ce.length>1?t.J.core.logic.or(ce):ce[0],"chain-test":ue.length>1?t.J.core.set.has([t.J.core.type.set(ue),re]):t.J.core.rel.eq([re,ue[0]]),"entity-test":t.J.core.logic.and([t.J.core.rel.eq([t.J.struct.atomProperty.core.modelLabel(),se]),t.J.core.rel.eq([t.J.struct.atomProperty.core.modelIndex(),ae])])}))}else ne.push(t.J.struct.generator.atomGroups({"atom-test":ce.length>1?t.J.core.logic.or(ce):ce[0],"chain-test":ue.length>1?t.J.core.set.has([t.J.core.type.set(ue),re]):t.J.core.rel.eq([re,ue[0]])}))}),t.J.struct.modifier.union([1===ne.length?ne[0]:t.J.struct.combinator.merge(ne.map(be=>t.J.struct.modifier.union([be])))])}}(I||(I={}))},14:(tn,Ue,n)=>{"use strict";n.d(Ue,{Z:()=>h});var e=n(8960),o=n(2008),r=n(8699),t=n(5384);function c(){throw new Error("Property only available for atomic models.")}function i(a){throw a?new Error(`Property only available for coarse models (${a}).`):new Error("Property only available for coarse models.")}const v={key:a=>a.element,x:a=>a.unit.conformation.x(a.element),y:a=>a.unit.conformation.y(a.element),z:a=>a.unit.conformation.z(a.element),id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicConformation.atomId.value(a.element):c(),occupancy:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicConformation.occupancy.value(a.element):c(),B_iso_or_equiv:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicConformation.B_iso_or_equiv.value(a.element):c(),sourceIndex:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atomSourceIndex.value(a.element):a.element,type_symbol:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atoms.type_symbol.value(a.element):c(),label_atom_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atoms.label_atom_id.value(a.element):c(),auth_atom_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atoms.auth_atom_id.value(a.element):c(),label_alt_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atoms.label_alt_id.value(a.element):c(),label_comp_id:O,auth_comp_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atoms.auth_comp_id.value(a.element):c(),pdbx_formal_charge:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(a.element):c(),vdw_radius:a=>e.N.isAtomic(a.unit)?(0,o.sO)(a.unit.model.atomicHierarchy.atoms.type_symbol.value(a.element)):c()};function O(a){return e.N.isAtomic(a.unit)||c(),a.unit.model.atomicHierarchy.atoms.label_comp_id.value(a.element)}function b(a){return e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.residues.label_seq_id.value(a.unit.residueIndex[a.element]):c()}function M(a){e.N.isAtomic(a.unit)||c();const S=a.unit.model.sequence.byEntityKey[u(a)];return S&&S.sequence.microHet.get(b(a))||[O(a)]}function u(a){switch(a.unit.kind){case 0:return a.unit.model.atomicHierarchy.index.getEntityFromChain(a.unit.chainIndex[a.element]);case 1:return a.unit.model.coarseHierarchy.spheres.entityKey[a.element];case 2:return a.unit.model.coarseHierarchy.gaussians.entityKey[a.element]}}const s=[],h={constant:{true:a=>!0,false:a=>!1,zero:a=>0},atom:v,residue:{key:a=>e.N.isAtomic(a.unit)?a.unit.residueIndex[a.element]:c(),group_PDB:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.residues.group_PDB.value(a.unit.residueIndex[a.element]):c(),label_seq_id:b,auth_seq_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.residues.auth_seq_id.value(a.unit.residueIndex[a.element]):c(),pdbx_PDB_ins_code:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(a.unit.residueIndex[a.element]):c(),isNonStandard:a=>e.N.isAtomic(a.unit)?M(a).some(S=>"n"===a.unit.model.properties.chemicalComponentMap.get(S).mon_nstd_flag[0]):c(),hasMicroheterogeneity:function _(a){e.N.isAtomic(a.unit)||c();const S=a.unit.model.sequence.byEntityKey[u(a)];return S&&S.sequence.microHet.has(b(a))},microheterogeneityCompIds:M,secondary_structure_type:a=>{var S;e.N.isAtomic(a.unit)||c();const D=null===(S=r.v.get(a.structure).value)||void 0===S?void 0:S.get(a.unit.invariantId);return D?D.type[D.getIndex(a.unit.residueIndex[a.element])]:536870912},secondary_structure_key:a=>{var S;e.N.isAtomic(a.unit)||c();const D=null===(S=r.v.get(a.structure).value)||void 0===S?void 0:S.get(a.unit.invariantId);return D?D.key[D.getIndex(a.unit.residueIndex[a.element])]:-1},chem_comp_type:a=>e.N.isAtomic(a.unit)?a.unit.model.properties.chemicalComponentMap.get(O(a)).type:c()},chain:{key:a=>e.N.isAtomic(a.unit)?a.unit.chainIndex[a.element]:c(),label_asym_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.chains.label_asym_id.value(a.unit.chainIndex[a.element]):c(),auth_asym_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.chains.auth_asym_id.value(a.unit.chainIndex[a.element]):c(),label_entity_id:a=>e.N.isAtomic(a.unit)?a.unit.model.atomicHierarchy.chains.label_entity_id.value(a.unit.chainIndex[a.element]):c()},entity:{key:u,id:a=>a.unit.model.entities.data.id.value(u(a)),type:a=>a.unit.model.entities.data.type.value(u(a)),src_method:a=>a.unit.model.entities.data.src_method.value(u(a)),pdbx_description:a=>a.unit.model.entities.data.pdbx_description.value(u(a)),formula_weight:a=>a.unit.model.entities.data.formula_weight.value(u(a)),pdbx_number_of_molecules:a=>a.unit.model.entities.data.pdbx_number_of_molecules.value(u(a)),details:a=>a.unit.model.entities.data.details.value(u(a)),pdbx_mutation:a=>a.unit.model.entities.data.pdbx_mutation.value(u(a)),pdbx_fragment:a=>a.unit.model.entities.data.pdbx_fragment.value(u(a)),pdbx_ec:a=>a.unit.model.entities.data.pdbx_ec.value(u(a)),subtype:a=>a.unit.model.entities.subtype.value(u(a)),prd_id:a=>{var S,D;return null!==(D=null===(S=a.unit.model.entities.prd_id)||void 0===S?void 0:S.value(u(a)))&&void 0!==D?D:""}},unit:{id:a=>a.unit.id,chainGroupId:a=>a.unit.chainGroupId,multiChain:a=>e.N.Traits.is(a.unit.traits,e.N.Trait.MultiChain),object_primitive:a=>a.unit.objectPrimitive,operator_name:a=>a.unit.conformation.operator.name,operator_key:a=>a.unit.conformation.operator.key,model_index:a=>a.unit.model.modelNum,model_label:a=>a.unit.model.label,model_entry_id:a=>a.unit.model.entryId,hkl:a=>a.unit.conformation.operator.hkl,spgrOp:a=>a.unit.conformation.operator.spgrOp,model_num:a=>a.unit.model.modelNum,pdbx_struct_assembly_id:a=>{var S;return(null===(S=a.unit.conformation.operator.assembly)||void 0===S?void 0:S.id)||t.JX.DefaultName},pdbx_struct_oper_list_ids:a=>{var S;return(null===(S=a.unit.conformation.operator.assembly)||void 0===S?void 0:S.operList)||s},struct_ncs_oper_id:a=>a.unit.conformation.operator.ncsId},coarse:{key:v.key,entityKey:a=>e.N.isCoarse(a.unit)?a.unit.coarseElements.entityKey[a.element]:i(),x:v.x,y:v.y,z:v.z,asym_id:a=>e.N.isCoarse(a.unit)?a.unit.coarseElements.asym_id.value(a.element):i(),entity_id:a=>e.N.isCoarse(a.unit)?a.unit.coarseElements.entity_id.value(a.element):i(),seq_id_begin:a=>e.N.isCoarse(a.unit)?a.unit.coarseElements.seq_id_begin.value(a.element):i(),seq_id_end:a=>e.N.isCoarse(a.unit)?a.unit.coarseElements.seq_id_end.value(a.element):i(),sphere_radius:a=>e.N.isSpheres(a.unit)?a.unit.coarseConformation.radius[a.element]:i("spheres"),sphere_rmsf:a=>e.N.isSpheres(a.unit)?a.unit.coarseConformation.rmsf[a.element]:i("spheres"),gaussian_weight:a=>e.N.isGaussians(a.unit)?a.unit.coarseConformation.weight[a.element]:i("gaussians"),gaussian_covariance_matrix:a=>e.N.isGaussians(a.unit)?a.unit.coarseConformation.covariance_matrix[a.element]:i("gaussians")}}},1969:(tn,Ue,n)=>{"use strict";n.d(Ue,{o:()=>le});var e=n(467),o=n(3543),r=n(9677),t=n(7552),A=n(5644),y=n(8382),c=n(1541),i=n(8960),v=n(6871),O=n(5685);class b{addToUnit(Te,ie){const ue=this.unitMap.get(Te);ue?ue[ue.length]=ie:(this.unitMap.set(Te,[ie]),this.ids[this.ids.length]=Te),this.elementCount++}beginUnit(Te){this.parentId=Te,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(Te){this.currentUnit[this.currentUnit.length]=Te,this.elementCount++}addElementRange(Te,ie,ue){for(let re=ie;re<ue;re++)this.currentUnit[this.currentUnit.length]=Te[re],this.elementCount++}commitUnit(){0!==this.currentUnit.length&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(Te,ie){this.ids[this.ids.length]=Te,this.unitMap.set(Te,ie),this.elementCount+=ie.length}_getStructure(Te){if(this.isEmpty)return le.Empty;const ie=[];(0,y.eh)(this.ids);const ue=O.u.UnitEquivalenceBuilder();for(let re=0,ve=this.ids.length;re<ve;re++){const ce=this.ids[re],se=this.parent.unitMap.get(ce);let ae=this.unitMap.get(ce),ge=!1;Te&&(this.isSorted||(0,y.eh)(ae),ae=o.SortedArray.deduplicate(o.SortedArray.ofSortedArray(this.currentUnit)),ge=!0);const Ie=ae.length;if(ae.length===se.elements.length){ie[ie.length]=se,ue.add(se.id,se);continue}!this.isSorted&&!ge&&Ie>1&&(0,y.eh)(ae);let Le=se.getChild(o.SortedArray.ofSortedArray(ae));const nt=ue.add(Le.id,Le);Le!==nt&&(Le=nt.applyOperator(Le.id,Le.conformation.operator,!0)),ie[ie.length]=Le}return le.create(ie,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(Te){const ie=this.ids[0];Te.unit=this.parent.unitMap.get(ie),Te.element=this.unitMap.get(ie)[0]}get isEmpty(){return 0===this.elementCount}constructor(Te,ie){this.parent=Te,this.isSorted=ie,this.ids=[],this.unitMap=o.Yz.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}}var _=n(1739),M=n(14);function I(be,Te){let ie=1;for(;Te--;)ie*=be--;return ie}class u{move(){if(this.hasNext){let Te=0,ie=0,ue=this.index;for(;ue;ue>>>=1,Te++)1&ue&&(this.value[ie++]=this.array[Te]);this.index=function m(be){const Te=be&-be,ie=be+Te;return ie|((ie&-ie)/Te>>1)-1}(this.index),this.hasNext=this.index<this.maxIndex}return this.value}constructor(Te,ie){this.array=Te,this.hasNext=!1,this.index=(1<<ie)-1,this.size=function l(be,Te){return Te>be?0:I(be,Te)/I(Te,Te)}(Te.length,ie),this.maxIndex=1<<Te.length,this.value=new Array(ie),this.hasNext=ie>0&&ie<=Te.length}}function d(be,Te){const ie=[],ue=new u(be,Te);for(;ue.hasNext;)ie.push(ue.move().slice());return ie}var s=n(4506),C=n(4369),h=n(8199),a=n(6115),S=n(2434),D=n(2789);const R=[],f={links:R,terminalLinks:R,elements:R,partialElements:R,getElementIndices:()=>R,getLinkIndices:()=>R,getTerminalLinkIndices:()=>R};var p=n(4561);const E=(0,S.F1)("C"),T=(0,S.F1)("O"),L=[p.X.elementFingerprint([E,E,E,T]),p.X.elementFingerprint([E,E,E,E,T]),p.X.elementFingerprint([E,E,E,E,E,T]),p.X.elementFingerprint([E,E,E,E,E,E,T])];function w(be,Te){let ie=-1,ue=-1,re=-1,ve=-1;const{elements:ce}=be,{type_symbol:se,label_atom_id:ae}=be.model.atomicHierarchy.atoms,{b:ge,offset:Ie}=be.bonds;for(let Le=0,nt=Te.length;Le<nt;++Le){const je=ce[Te[Le]];if(se.value(je)!==E)continue;let Lt=0,Je=0;for(let en=Ie[Te[Le]],Bt=Ie[Te[Le]+1];en<Bt;++en){const $e=se.value(ce[ge[en]]);$e===T?++Lt:$e===E&&++Je}if(2===Lt){ie=je;break}1===Lt&&1===Je?ue=je:ae.value(je).startsWith("C1")?re=je:ve=je}return-1!==ie?ie:-1!==ue?ue:-1!==re?re:-1!==ve?ve:ce[Te[0]]}function G(be,Te,ie,ue){return C.eB.normalize(be,C.eB.sub(be,ue,Te.conformation.position(ie,be))),be}function V(be,Te){const{elements:ie}=be,{label_atom_id:ue}=be.model.atomicHierarchy.atoms;return ue.value(ie[Te])}function U(be,Te){if(!Te||!Te.length)return;const{unit:ie,all:ue}=be,re=new Set,ve=d((0,a.WE)(new Array(Te.length)),2);for(let ce=0,se=ve.length;ce<se;++ce){const ae=ve[ce],ge=ue[Te[ae[0]]],Ie=ue[Te[ae[1]]];o.SortedArray.areIntersecting(ge,Ie)&&p.X.getAltId(ie,ge)===p.X.getAltId(ie,Ie)&&(re.add(Te[ae[0]]),re.add(Te[ae[1]]))}if(re.size){const ce=[];for(let se=0,ae=Te.length;se<ae;++se)re.has(Te[se])||ce.push(Te[se]);return ce}return Te}function N(be,Te){return Te.properties.saccharideComponentMap.get(be)}function H(be,Te,ie){function ue(Le,nt){return(0,y.m1)(Le.id,nt)}function re(Le,nt,je){const Lt=[],Je=Le.get(ue(nt,je));if(void 0!==Je)for(const en of Je)(0,a.Z2)(Lt,en);return Lt}const ve=new Map;for(let Le=0,nt=be.length;Le<nt;++Le){const{unit:je,ringIndex:Lt}=be[Le],Je=je.rings.all[Lt];for(let en=0,Bt=Je.length;en<Bt;++en){const pn=ue(je,je.elements[Je[en]]),$e=ve.get(pn);void 0===$e?ve.set(pn,[Le]):$e.push(Le)}}const se=new Map;for(let Le=0,nt=Te.length;Le<nt;++Le){const je=Te[Le],{unit:Lt,ringIndex:Je}=be[je.carbohydrateIndexA],en=Lt.rings.all[Je];for(let Bt=0,pn=en.length;Bt<pn;++Bt){const $e=ue(Lt,Lt.elements[en[Bt]]),mt=se.get($e);void 0===mt?se.set($e,[Le]):mt.push(Le)}}const ge=new Map;for(let Le=0,nt=ie.length;Le<nt;++Le){const{fromCarbohydrate:je,carbohydrateIndex:Lt,elementUnit:Je,elementIndex:en}=ie[Le];if(je){const{unit:Bt,ringIndex:pn}=be[Lt],$e=Bt.rings.all[pn];for(let mt=0,_t=$e.length;mt<_t;++mt){const Me=ue(Bt,Bt.elements[$e[mt]]),Ke=ge.get(Me);void 0===Ke?ge.set(Me,[Le]):Ke.push(Le)}}else{const Bt=ue(Je,Je.elements[en]),pn=ge.get(Bt);void 0===pn?ge.set(Bt,[Le]):pn.push(Le)}}return{getElementIndices:function ce(Le,nt){return re(ve,Le,nt)},getLinkIndices:function ae(Le,nt){return re(se,Le,nt)},getTerminalLinkIndices:function Ie(Le,nt){return re(ge,Le,nt)}}}var $=n(7778),J=n(5384),W=n(1692),te=n(2008),de=n(6424),ye=n(9535),j=n(5439),Z=n(4824),q=n(7136);const Y=(0,J.f8)(),ee=new q.Z("14"),g=new q.Z("98");class le{subsetBuilder(Te){return new b(this,Te)}get elementCount(){return this.state.elementCount}get bondCount(){return-1===this.state.bondCount&&(this.state.bondCount=this.interUnitBonds.edgeCount+_.gn.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new W.v),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return-1===this.state.polymerResidueCount&&(this.state.polymerResidueCount=function Se(be){const{units:Te}=be;let ie=0;for(let ue=0,re=Te.length;ue<re;ue++)ie+=Te[ue].polymerElements.length;return ie}(this)),this.state.polymerResidueCount}get polymerGapCount(){return-1===this.state.polymerGapCount&&(this.state.polymerGapCount=function Ve(be){const{units:Te}=be;let ie=0;for(let ue=0,re=Te.length;ue<re;ue++)ie+=Te[ue].gapElements.length/2;return ie}(this)),this.state.polymerGapCount}get polymerUnitCount(){return-1===this.state.polymerUnitCount&&(this.state.polymerUnitCount=function Ne(be){const{units:Te}=be;let ie=0;for(let ue=0,re=Te.length;ue<re;ue++)Te[ue].polymerElements.length>0&&(ie+=1);return ie}(this)),this.state.polymerUnitCount}get uniqueElementCount(){return-1===this.state.uniqueElementCount&&(this.state.uniqueElementCount=function Oe(be){const{unitSymmetryGroups:Te}=be;let ie=0;for(let ue=0,re=Te.length;ue<re;ue++)ie+=Te[ue].elements.length;return ie}(this)),this.state.uniqueElementCount}get atomicResidueCount(){return-1===this.state.atomicResidueCount&&(this.state.atomicResidueCount=function K(be){const{units:Te}=be;let ie=0;for(let ue=0,re=Te.length;ue<re;ue++){const ve=Te[ue];if(!i.N.isAtomic(ve))continue;const{elements:ce,residueIndex:se}=ve;let ae=-1,ge=-1;for(let Ie=0,Le=ce.length;Ie<Le;++Ie)ae=se[ce[Ie]],ae!==ge&&(ie+=1,ge=ae)}return ie}(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(Te=>A.Kx.isCoarseGrained(Te))}get isEmpty(){return 0===this.units.length}get hashCode(){return-1!==this.state.hashCode?this.state.hashCode:this.computeHash()}get transformHash(){return-1!==this.state.transformHash||(this.state.transformHash=(0,y.TI)(this.units.map(Te=>Te.id))),this.state.transformHash}computeHash(){let Te=23;for(let ie=0,ue=this.units.length;ie<ue;ie++){const re=this.units[ie];Te=31*Te+re.id|0,Te=31*Te+o.SortedArray.hashCode(re.elements)|0}return Te=31*Te+this.elementCount|0,Te=(0,y.C_)(Te),-1===Te&&(Te=0),this.state.hashCode=Te,Te}elementLocations(){return new le.ElementLocationIterator(this)}get root(){var Te;return null!==(Te=this.state.parent)&&void 0!==Te?Te:this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary||(this.state.boundary=function xe(be){const{units:Te}=be,ie=function _e(be){return be>500?ee:g}(Te.length);ie.reset();for(let ue=0,re=Te.length;ue<re;ue++){const ve=Te[ue],ce=ve.boundary,se=ve.conformation.operator;se.isIdentity?ie.includeSphere(ce.sphere):(J.f8.transform(Y,ce.sphere,se.matrix),ie.includeSphere(Y))}ie.finishedIncludeStep();for(let ue=0,re=Te.length;ue<re;ue++){const ve=Te[ue],ce=ve.boundary,se=ve.conformation.operator;se.isIdentity?ie.radiusSphere(ce.sphere):(J.f8.transform(Y,ce.sphere,se.matrix),ie.radiusSphere(Y))}return{box:ie.getBox(),sphere:ie.getSphere()}}(this)),this.state.boundary}get lookup3d(){return this.state.lookup3d||(this.state.lookup3d=new v.jM(this)),this.state.lookup3d}get interUnitBonds(){return this.state.interUnitBonds||(this.state.interUnitBonds=this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&0===this.parent.state.interUnitBonds.edgeCount?new _.dZ(new Map):(0,_.kD)(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair})),this.state.interUnitBonds}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups||(this.state.unitSymmetryGroups=O.u.computeTransformGroups(this)),this.state.unitSymmetryGroups}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap||(this.state.unitSymmetryGroupsIndexMap=i.N.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups)),this.state.unitSymmetryGroupsIndexMap}get carbohydrates(){return this.state.carbohydrates||(this.state.carbohydrates=function k(be){if(0===be.models.reduce((nt,je)=>nt+je.properties.saccharideComponentMap.size,0))return f;const Te=[],ie=[],ue=[],re=[],ve=new Map;function ce(nt,je,Lt){return`${nt}|${je}|${Lt}`}function se(nt,je){ve.has(nt)?ve.get(nt).push(je):ve.set(nt,[je])}function ae(nt,je){C.eB.sub(ue[nt].geometry.direction,ue[je].geometry.center,ue[nt].geometry.center),C.eB.normalize(ue[nt].geometry.direction,ue[nt].geometry.direction)}const ge=(0,C.eB)();function Ie(nt,je,Lt){const en=ue[nt].geometry;C.eB.sub(en.direction,Lt.conformation.position(Lt.elements[je],ge),en.center),C.eB.normalize(en.direction,en.direction)}for(let nt=0,je=be.units.length;nt<je;++nt){const Lt=be.units[nt];if(!i.N.isAtomic(Lt))continue;const{model:Je,rings:en}=Lt,{chainAtomSegments:Bt,residueAtomSegments:pn,atoms:$e}=Je.atomicHierarchy,{label_comp_id:mt}=$e,_t=o.hT.transientSegments(Bt,Lt.elements),Me=o.hT.transientSegments(pn,Lt.elements);let Ke;for(;_t.hasNext;)for(Me.setSegment(_t.move());Me.hasNext;){const{index:ut}=Me.move(),Kt=N(mt.value(pn.offsets[ut]),Je);if(!Kt)continue;Ke||(Ke=p.g.byFingerprintAndResidue(en,L));const sn=U(en,Ke.get(ut));if(!sn||!sn.length){re.push({unit:Lt,residueIndex:ut,component:Kt});continue}const gt=[];for(let At=0,Gt=sn.length;At<Gt;++At){const rn=en.all[sn[At]],tt=w(Lt,rn),Mt=h.c.calculateMomentsAxes((0,D.Dt)(Lt,rn)),nn=h.c.calculateNormalizedAxes(Mt),bn=C.eB.copy((0,C.eB)(),nn.origin),Dn=C.eB.copy((0,C.eB)(),nn.dirC),jt=G((0,C.eB)(),Lt,tt,bn);C.eB.orthogonalize(jt,Dn,jt);const It=p.X.getAltId(Lt,rn),Dt=ue.length;gt.push(Dt),se(ce(ut,Lt.id,It),Dt),It&&se(ce(ut,Lt.id,""),Dt),ue.push({geometry:{center:bn,normal:Dn,direction:jt},component:Kt,ringIndex:sn[At],altId:It,unit:Lt,residueIndex:ut})}const yt=d((0,a.WE)(new Array(sn.length)),2);for(let At=0,Gt=yt.length;At<Gt;++At){const rn=yt[At];if(s.O.areVertexSetsConnected(Lt.bonds,en.all[sn[rn[0]]],en.all[sn[rn[1]]],3)){const nn=gt[rn[0]],bn=gt[rn[1]];ue[nn].altId===ue[bn].altId&&(ae(nn,bn),ae(bn,nn),Te.push({carbohydrateIndexA:nn,carbohydrateIndexB:bn}),Te.push({carbohydrateIndexA:bn,carbohydrateIndexB:nn}))}}}}function Le(nt,je){return ve.get(ce(nt.getResidueIndex(je),nt.id,function Q(be,Te){const{elements:ie}=be,{label_alt_id:ue}=be.model.atomicHierarchy.atoms;return ue.value(ie[Te])}(nt,je)))||[]}for(let nt=0,je=ue.length;nt<je;++nt){const Lt=ue[nt],{unit:Je}=Lt;for(let en=nt+1;en<je;++en){const Bt=ue[en];Je===Bt.unit&&Lt.residueIndex!==Bt.residueIndex&&s.O.areVertexSetsConnected(Je.bonds,Je.rings.all[Lt.ringIndex],Je.rings.all[Bt.ringIndex],3)&&(ae(nt,en),ae(en,nt),Te.push({carbohydrateIndexA:nt,carbohydrateIndexB:en}),Te.push({carbohydrateIndexA:en,carbohydrateIndexB:nt}))}}for(let nt=0,je=be.units.length;nt<je;++nt){const Lt=be.units[nt];i.N.isAtomic(Lt)&&be.interUnitBonds.getConnectedUnits(Lt.id).forEach(Je=>{Je.connectedIndices.forEach(en=>{Je.getEdges(en).forEach(({props:Bt,indexB:pn})=>{if(!S.I$.isCovalent(Bt.flag))return;const $e=be.unitMap.get(Je.unitA),mt=be.unitMap.get(Je.unitB),_t=Le($e,en),Me=Le(mt,pn);if(_t.length>0&&Me.length>0){const Ke=_t.length,ut=Me.length;for(let Kt=0,sn=Math.max(Ke,ut);Kt<sn;++Kt){const gt=_t[Math.min(Kt,Ke-1)],yt=Me[Math.min(Kt,ut-1)],At=V($e,en);(At.startsWith("O1")||At.startsWith("C1"))&&ae(gt,yt),Te.push({carbohydrateIndexA:gt,carbohydrateIndexB:yt})}}else if(0===Me.length)for(const Ke of _t){const ut=V($e,en);(ut.startsWith("O1")||ut.startsWith("C1"))&&Ie(Ke,pn,mt),ie.push({carbohydrateIndex:Ke,elementIndex:pn,elementUnit:mt,fromCarbohydrate:!0})}else if(0===_t.length)for(const Ke of Me)ie.push({carbohydrateIndex:Ke,elementIndex:en,elementUnit:$e,fromCarbohydrate:!1})})})})}return{links:Te,terminalLinks:ie,elements:ue,partialElements:re,...H(ue,Te,ie)}}(this)),this.state.carbohydrates}get models(){return this.state.models||(this.state.models=function Be(be){const{units:Te}=be,ie=r.th.create();for(const ue of Te)r.th.add(ie,ue.model.id,ue.model);return ie.array}(this)),this.state.models}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=function Ce(be){const{microheterogeneityCompIds:Te}=M.Z.residue,ie=new Set,ue=c.i.Location.create(be);for(const re of be.unitSymmetryGroups){const ve=re.units[0];if(!i.N.isAtomic(ve))continue;const ce=o.hT.transientSegments(ve.model.atomicHierarchy.residueAtomSegments,ve.elements);for(ue.unit=ve;ce.hasNext;){const se=ce.move();ue.element=ve.elements[se.start];const ae=Te(ue);for(const ge of ae)ie.add(ge)}}return ie}(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=function Re(be){const Te=M.Z.atom.type_symbol,ie=new Set,ue=c.i.Location.create(be);for(const re of be.unitSymmetryGroups){const ve=re.units[0];if(i.N.isAtomic(ve)){ue.unit=ve;for(let ce=0,se=ve.elements.length;ce<se;++ce)ue.element=ve.elements[ce],ie.add(Te(ue))}}return ie}(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=function ke(be){const{units:Te}=be,ie=c.i.Location.create(be),ue=r.th.create();for(const re of Te){const ve=0===re.kind?M.Z.entity.key:M.Z.coarse.entityKey;ie.unit=re;const ce=re.elements,se=o.hT.transientSegments(re.model.atomicHierarchy.chainAtomSegments,ce);for(;se.hasNext;){const ae=se.move();ie.element=ce[ae.start];const ge=ve(ie);r.th.add(ue,ge,ge)}}return(0,y.eh)(ue.array),ue.array}(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=function we(be){const Te=new Map,ie=[],ue=be.unitSymmetryGroups;for(const ve of ue){const ce=ve.units[0];if(!i.N.isAtomic(ce))continue;let se;Te.has(ce.model.id)?se=Te.get(ce.model.id):(se=r.th.create(),ie.push(ce.model.id),Te.set(ce.model.id,se));const ae=o.hT.transientSegments(ce.model.atomicHierarchy.residueAtomSegments,ce.elements);for(;ae.hasNext;){const ge=ae.move();r.th.add(se,ge.index,ge.index)}}const re=new Map;for(const ve of ie){const ce=Te.get(ve).array;(0,y.eh)(ce),re.set(ve,ce)}return re}(this))}get isAtomic(){for(const Te of this.units)if(!i.N.isAtomic(Te))return!1;return!0}get hasAtomic(){for(const Te of this.units)if(i.N.isAtomic(Te))return!0;return!1}get isCoarse(){for(const Te of this.units)if(!i.N.isCoarse(Te))return!1;return!0}get hasCoarse(){for(const Te of this.units)if(i.N.isCoarse(Te))return!0;return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=function ne(be){const{units:Te,elementCount:ie,unitIndexMap:ue}=be,re=new Uint32Array(Te.length),ve=new Uint32Array(ie),ce=new Uint32Array(ie);for(let se=0,ae=0,ge=Te.length;se<ge;++se){re[se]=ae;const{elements:Ie}=Te[se];for(let Le=0,nt=Ie.length;Le<nt;++Le){const je=ae+Le;ve[je]=se,ce[je]=Ie[Le]}ae+=Ie.length}return{cumulativeUnitElementCount:re,unitIndices:ve,elementIndices:ce,getSerialIndex:(se,ae)=>re[ue.get(se.id)]+o.CD.indexOf(se.elements,ae)}}(this))}get model(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;const Te=this.models;if(Te.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=Te[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(Te){return!!this.unitMap.has(Te.unit.id)&&o.SortedArray.has(this.unitMap.get(Te.unit.id).elements,Te.element)}getModelIndex(Te){return this.models.indexOf(Te)}remapModel(Te){const{dynamicBonds:ie,interUnitBonds:ue,parent:re}=this.state,ve=[];for(const ce of this.unitSymmetryGroups){const se=ce.units[0].remapModel(Te,ie);ve.push(se);for(let ae=1,ge=ce.units.length;ae<ge;++ae)ve.push(ce.units[ae].remapModel(Te,ie,se.props))}return le.create(ve,{parent:re?.remapModel(Te),label:this.label,interUnitBonds:ie?void 0:ue,dynamicBonds:ie,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy;if(this.parent){const Te=this.parent.coordinateSystem.isIdentity?this.parent:le.transform(this.parent,this.parent.coordinateSystem.inverse),ie=this.coordinateSystem.isIdentity?Te:le.transform(Te,this.coordinateSystem.matrix);this._proxy=new le(ie.units,ie.unitMap,ie.unitIndexMap,{...ie.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this;return this._proxy}get child(){return this._child}get target(){var Te;return null!==(Te=this._target)&&void 0!==Te?Te:this}constructor(Te,ie,ue,re,ve){this.units=Te,this.unitMap=ie,this.unitIndexMap=ue,this.state=re,this._child=ve?.child,this._target=ve?.target,this._proxy=void 0}}function Ae(be,Te,ie){return be[Te].id-be[ie].id}!function(be){function Te(kt){return{kind:"structure-loci",structure:kt}}function ae(kt,Ot={}){const An=o.Yz.Mutable(),jn=o.Yz.Mutable();let On=0,fr=!0,Dr=kt.length>0?kt[0].id:0;for(let or=0,Nr=kt.length;or<Nr;or++){const Ir=kt[or];An.set(Ir.id,Ir),On+=Ir.elements.length,Ir.id<Dr&&(fr=!1),Dr=Ir.id}fr||(0,y.di)(kt,0,kt.length,Ae,y.VE);for(let or=0,Nr=kt.length;or<Nr;or++)jn.set(kt[or].id,or);const Pr={hashCode:-1,transformHash:-1,elementCount:On,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:t.J.Default,label:""};return Ot.parent&&(Pr.parent=Ot.parent.parent||Ot.parent),Ot.interUnitBonds&&(Pr.interUnitBonds=Ot.interUnitBonds),Ot.interBondsValidUnit?Pr.interBondsValidUnit=Ot.interBondsValidUnit:Ot.parent&&(Pr.interBondsValidUnit=Ot.parent.interBondsValidUnit),Ot.interBondsValidUnitPair?Pr.interBondsValidUnitPair=Ot.interBondsValidUnitPair:Ot.parent&&(Pr.interBondsValidUnitPair=Ot.parent.interBondsValidUnitPair),Ot.dynamicBonds?Pr.dynamicBonds=Ot.dynamicBonds:Ot.parent&&(Pr.dynamicBonds=Ot.parent.dynamicBonds),Ot.coordinateSystem?Pr.coordinateSystem=Ot.coordinateSystem:Ot.parent&&(Pr.coordinateSystem=Ot.parent.coordinateSystem),Ot.label?Pr.label=Ot.label:Ot.parent&&(Pr.label=Ot.parent.label),Ot.masterModel?Pr.masterModel=Ot.masterModel:Ot.parent&&(Pr.masterModel=Ot.parent.masterModel),Ot.representativeModel?Pr.representativeModel=Ot.representativeModel:Ot.parent&&(Pr.representativeModel=Ot.parent.representativeModel),new be(kt,An,jn,Pr)}function Ie(){return(Ie=(0,e.A)(function*(kt,Ot){if(0===kt.frameCount)return be.Empty;const An=[];let jn,On=0;for(let fr=0,Dr=kt.frameCount;fr<Dr;++fr){const Pr=yield Z.YZ.resolveInContext(kt.getFrameAtIndex(fr),Ot);jn||(jn=Pr);const or=nt(Pr);for(let Nr=0,Ir=or.units.length;Nr<Ir;++Nr){const Or=or.units[Nr],un=i.N.create(An.length,Or.invariantId+On,Or.chainGroupId+On,Or.traits,Or.kind,Or.model,Or.conformation.operator,Or.elements);An.push(un)}On=An.length}return ae(An,{representativeModel:jn,label:jn.label})})).apply(this,arguments)}be.Empty=ae([]),be.Loci=Te,be.toStructureElementLoci=function ie(kt){const Ot=[];for(const An of kt.units)Ot.push({unit:An,indices:o.IX.ofBounds(0,An.elements.length)});return c.i.Loci(kt,Ot)},be.toSubStructureElementLoci=function ue(kt,Ot){return de.c.toLociWithSourceUnits(de.c.Singletons(kt,Ot))},be.isLoci=function re(kt){return!!kt&&"structure-loci"===kt.kind},be.areLociEqual=function ve(kt,Ot){return kt.structure===Ot.structure},be.isLociEmpty=function ce(kt){return kt.structure.isEmpty},be.remapLoci=function se(kt,Ot){return Ot===kt.structure?kt:Te(Ot)},be.create=ae,be.ofTrajectory=function ge(kt,Ot){return Ie.apply(this,arguments)};const Le=!1;function nt(kt,Ot={}){const An=kt.atomicHierarchy.chainAtomSegments,{index:jn}=kt.atomicHierarchy,{auth_asym_id:On}=kt.atomicHierarchy.chains,{atomicChainOperatorMappinng:fr}=kt,Dr=new $e({label:kt.label,...Ot});for(let or=0;or<An.count;or++){const Nr=fr.get(or)||t.J.Default,Ir=An.offsets[or];let Or=te.vE.chainResidueCount(kt.atomicHierarchy,or)===An.offsets[or+1]-An.offsets[or],Jr=!1;if(je(kt,or))for(;or+1<An.count&&je(kt,or+1)&&fr.get(or)===fr.get(or+1);)Jr=!0,or++;else for(;or+1<An.count&&An.offsets[or+1]-An.offsets[or]==1&&An.offsets[or+2]-An.offsets[or+1]==1&&(Or=!0,jn.getEntityFromChain(or)===jn.getEntityFromChain(or+1))&&On.value(or)===On.value(or+1)&&fr.get(or)===fr.get(or+1);)Jr=!0,or++;const To=o.SortedArray.ofBounds(Ir,An.offsets[or+1]);Le?Or&&!Lt(kt,or)?Je(kt,To,Dr,Jr,Nr):To.length>2e5||je(kt,or)?en(kt,To,Dr,Jr,Nr):Dr.addUnit(0,kt,Nr,To,Jr?i.N.Trait.MultiChain:i.N.Trait.None):Dr.addUnit(0,kt,Nr,To,Jr?i.N.Trait.MultiChain:i.N.Trait.None)}const Pr=kt.coarseHierarchy;return Pr.isDefined&&(Pr.spheres.count>0&&Bt(Dr,kt,kt.coarseHierarchy.spheres,1),Pr.gaussians.count>0&&Bt(Dr,kt,kt.coarseHierarchy.gaussians,2)),Dr.getStructure()}function je(kt,Ot){const An=kt.atomicHierarchy.index.getEntityFromChain(Ot);return"water"===kt.entities.data.type.value(An)}function Lt(kt,Ot){const An=kt.atomicHierarchy.index.getEntityFromChain(Ot);return"polymer"===kt.entities.data.type.value(An)}function Je(kt,Ot,An,jn,On){const{x:fr,y:Dr,z:Pr}=kt.atomicConformation,or={x:fr,y:Dr,z:Pr,indices:Ot},Nr=(0,J.Eh)(or,(0,ye.r)(or),8192),{offset:Ir,count:Or,array:Jr}=Nr.buckets,To=(jn?i.N.Trait.MultiChain:i.N.Trait.None)|(Ir.length>1?i.N.Trait.Partitioned:i.N.Trait.None);An.beginChainGroup();for(let un=0,ct=Ir.length;un<ct;un++){const dt=Ir[un],Yt=new Int32Array(Or[un]);for(let cn=0,xn=Or[un];cn<xn;cn++)Yt[cn]=Ot[Jr[dt+cn]];An.addUnit(0,kt,On,o.SortedArray.ofSortedArray(Yt),To)}An.endChainGroup()}function en(kt,Ot,An,jn,On){const{residueAtomSegments:fr}=kt.atomicHierarchy,Dr=[],Pr=[],or=o.hT.transientSegments(fr,Ot);for(;or.hasNext;){const Rn=or.move();Dr[Dr.length]=Ot[Rn.start],Pr[Pr.length]=Ot[Rn.end]}const Ir=512*(Pr[0]-Dr[0]),{x:Or,y:Jr,z:To}=kt.atomicConformation,un={x:Or,y:Jr,z:To,indices:o.SortedArray.ofSortedArray(Dr)},ct=(0,J.Eh)(un,(0,ye.r)(un),Ir),{offset:dt,count:Yt,array:cn}=ct.buckets,xn=(jn?i.N.Trait.MultiChain:i.N.Trait.None)|(dt.length>1?i.N.Trait.Partitioned:i.N.Trait.None);An.beginChainGroup();for(let Rn=0,er=dt.length;Rn<er;Rn++){const ir=dt[Rn],Yn=[];for(let br=0,vr=Yt[Rn];br<vr;br++){const Hr=cn[ir+br];for(let Mr=Dr[Hr],Fr=Pr[Hr];Mr<Fr;Mr++)Yn[Yn.length]=Mr}An.addUnit(0,kt,On,o.SortedArray.ofSortedArray(new Int32Array(Yn)),xn)}An.endChainGroup()}function Bt(kt,Ot,An,jn){const{chainElementSegments:On}=An;for(let fr=0;fr<On.count;fr++){const Dr=o.SortedArray.ofBounds(On.offsets[fr],On.offsets[fr+1]);kt.addUnit(jn,Ot,t.J.Default,Dr,i.N.Trait.None)}}be.ofModel=nt,be.transform=function pn(kt,Ot){if(C.$I.isIdentity(Ot))return kt;if(!C.$I.isRotationAndTranslation(Ot,t.J.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");const An=[];for(const fr of kt.units){const Dr=fr.conformation.operator,Pr=t.J.create(Dr.name,Ot,Dr);An.push(fr.applyOperator(fr.id,Pr))}const jn=kt.coordinateSystem;return ae(An,{parent:kt,coordinateSystem:t.J.compose(t.J.create(jn.name,Ot,jn),jn)})};class $e{beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(Ot,An,jn,On,fr,Dr){void 0===Dr&&(Dr=this.invariantId());const Pr=this.inChainGroup?this.chainGroupId:++this.chainGroupId,or=i.N.create(this.units.length,Dr,Pr,fr,Ot,An,jn,On);return this.add(or)}add(Ot){if(1===Ot.elements.length){Ot.conformation.position(Ot.elements[0],this.p);const An=[Ot.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(An))return this.singleElementUnits.get(An);this.singleElementUnits.set(An,Ot)}return this.units.push(Ot),Ot}addWithOperator(Ot,An,jn=!1){return this.add(Ot.applyOperator(this.units.length,An,jn))}getStructure(){return ae(this.units,this.props)}get isEmpty(){return 0===this.units.length}constructor(Ot={}){this.props=Ot,this.units=[],this.invariantId=(0,$.q)(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=(0,C.eB)(),this.singleElementUnits=new Map}}function Ke(kt,Ot){if(kt===Ot)return!0;if(kt.elementCount!==Ot.elementCount)return!1;const An=kt.units.length;if(An!==Ot.units.length)return!1;for(let jn=0;jn<An;jn++)if(kt.units[jn].id!==Ot.units[jn].id)return!1;return!0}function sn(kt,Ot){return kt===Ot||kt.hashCode===Ot.hashCode&&O.u.areTransformGroupsEquivalent(kt.unitSymmetryGroups,Ot.unitSymmetryGroups)}be.StructureBuilder=$e,be.Builder=function mt(kt={}){return new $e(kt)},be.hashCode=function _t(kt){return kt.hashCode},be.conformationHash=function Me(kt){return(0,y.YZ)(kt.units.map(Ot=>i.N.conformationId(Ot)).join("|"))},be.areUnitIdsEqual=Ke,be.areUnitIdsAndIndicesEqual=function ut(kt,Ot){if(kt===Ot)return!0;if(!Ke(kt,Ot))return!1;for(let An=0,jn=kt.units.length;An<jn;An++)if(!o.SortedArray.areEqual(kt.units[An].elements,Ot.units[An].elements))return!1;return!0},be.areHierarchiesEqual=function Kt(kt,Ot){if(kt.hashCode!==Ot.hashCode)return!1;const An=kt.models.length;if(An!==Ot.models.length)return!1;for(let jn=0;jn<An;jn++)if(!A.Kx.areHierarchiesEqual(kt.models[jn],Ot.models[jn]))return!1;return!0},be.areEquivalent=sn,be.areRootsEquivalent=function gt(kt,Ot){return sn(kt.root,Ot.root)},be.areRootsEqual=function yt(kt,Ot){return kt.root===Ot.root},be.ElementLocationIterator=class At{move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx)return this.idx++,void(this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length));this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length?this.hasNext=!1:(this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,0===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length))}constructor(Ot){this.structure=Ot,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=c.i.Location.create(Ot),this.hasNext=Ot.elementCount>0,this.hasNext&&(this.elements=Ot.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=Ot.units[0])}};const Gt=(0,C.eB)();function rn(kt,Ot,An){const{elements:jn,conformation:On}=kt,fr=Gt;let Dr=Number.MAX_VALUE;for(let Pr=0,or=jn.length;Pr<or;Pr++){const Nr=jn[Pr],Ir=C.eB.distance(Ot,On.position(Nr,fr))-An-On.r(Nr);Ir<Dr&&(Dr=Ir)}return Dr}function tt(kt,Ot,An){const{units:jn}=kt;let On=Number.MAX_VALUE;for(let fr=0,Dr=jn.length;fr<Dr;fr++){const or=rn(jn[fr],Ot,An);or<On&&(On=or)}return On}be.minDistanceToPoint=tt;const Mt=(0,C.eB)();function Dt(kt){return kt.unitSymmetryGroups.filter(Ot=>Ot.units[0].polymerElements.length>0)}let Vt;var kt;be.distance=function nn(kt,Ot){if(0===kt.elementCount||0===Ot.elementCount)return 0;const{units:An}=kt;let jn=Number.MAX_VALUE;for(let On=0,fr=An.length;On<fr;On++){const Dr=An[On],{elements:Pr,conformation:or}=Dr;for(let Nr=0,Ir=Pr.length;Nr<Ir;Nr++){const Or=Pr[Nr],Jr=tt(Ot,or.position(Or,Mt),or.r(Or));Jr<jn&&(jn=Jr)}}return jn},be.elementDescription=function bn(kt){return 1===kt.elementCount?"1 element":`${kt.elementCount} elements`},be.validUnitPair=function Dn(kt,Ot,An){return kt.masterModel?Ot.model===An.model||Ot.model===kt.masterModel||An.model===kt.masterModel:Ot.model===An.model},be.eachUnitPair=function jt(kt,Ot,An){const{maxRadius:jn,validUnit:On,validUnitPair:fr}=An;if(!kt.units.some(or=>On(or)))return;const Dr=kt.lookup3d,Pr=(0,C.eB)();for(const or of kt.units){if(!On(or))continue;const Nr=or.boundary.sphere;C.eB.transformMat4(Pr,Nr.center,or.conformation.operator.matrix);const Ir=Dr.findUnitIndices(Pr[0],Pr[1],Pr[2],Nr.radius+jn);for(let Or=0;Or<Ir.count;Or++){const Jr=kt.units[Ir.indices[Or]];or.id>=Jr.id||!On(Jr)||!fr(or,Jr)||(Jr.elements.length>=or.elements.length?Ot(or,Jr):Ot(Jr,or))}}},be.eachAtomicHierarchyElement=function It(kt,{chain:Ot,residue:An,atom:jn}){const On=c.i.Location.create(kt);for(const fr of kt.units){if(0!==fr.kind)continue;On.unit=fr;const{elements:Dr}=fr,Pr=o.hT.transientSegments(fr.model.atomicHierarchy.chainAtomSegments,Dr),or=o.hT.transientSegments(fr.model.atomicHierarchy.residueAtomSegments,Dr);for(;Pr.hasNext;){const Nr=Pr.move();if(Ot&&(On.element=Dr[Nr.start],Ot(On)),An||jn)for(or.setSegment(Nr);or.hasNext;){const Ir=or.move();if(An&&(On.element=Dr[Ir.start],An(On)),jn)for(let Or=Ir.start,Jr=Ir.end;Or<Jr;Or++)On.element=Dr[Or],jn(On)}}}},be.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15},(kt=Vt=be.Size||(be.Size={}))[kt.Small=0]="Small",kt[kt.Medium=1]="Medium",kt[kt.Large=2]="Large",kt[kt.Huge=3]="Huge",kt[kt.Gigantic=4]="Gigantic",be.getSize=function Wt(kt,Ot={},An=1){const jn={...be.DefaultSizeThresholds,...Ot};return kt.polymerResidueCount>=jn.largeResidueCount*An?function $t(kt,Ot){const An=Dt(kt);return An.length>=1&&An[0].units.length>Ot.highSymmetryUnitCount}(kt,jn)?Vt.Huge:Vt.Gigantic:function Ct(kt,Ot){const An=Dt(kt);return 1===An.length&&An[0].units.length>2&&An[0].units[0].polymerElements.length<Ot.fiberResidueCount}(kt,jn)||kt.polymerResidueCount<jn.smallResidueCount*An?Vt.Small:kt.polymerResidueCount<jn.mediumResidueCount*An?Vt.Medium:Vt.Large},be.Index=j.S.createSimple("index","root"),be.MaxIndex=j.S.createSimple("max_index","root");const yn="__PrincipalAxes__";be.getPrincipalAxes=function Zt(kt){if(kt.currentPropertyData[yn])return kt.currentPropertyData[yn];const Ot=c.i.Loci.getPrincipalAxes(be.toStructureElementLoci(kt));return kt.currentPropertyData[yn]=Ot,Ot}}(le||(le={}))},5685:(tn,Ue,n)=>{"use strict";n.d(Ue,{u:()=>M});var M,e=n(467),o=n(3543),r=n(8382),t=n(5384),A=n(4369),y=n(4824),c=n(5644),i=n(2516),v=n(1969),O=n(8960),b=n(9651),_=n(14);function I(R){return i.RT.generators.atoms({chainTest:i.RT.pred.and(i.RT.pred.eq(f=>_.Z.unit.operator_name(f.element),t.JX.DefaultName),i.RT.pred.inSet(f=>_.Z.chain.label_asym_id(f.element),R))})}function l(R,f,p,E,T,L){const{spacegroup:w,ncsOperators:Q}=R,G=[],{toFractional:V}=w.cell,U=A.eB.transformMat4((0,A.eB)(),L,V),N=t.is.getSymmetryOperatorRef(w,f,p,E,T,U);if(Q&&Q.length)for(let k=0,H=Q.length;k<H;++k){const $=Q[k],J=A.$I.mul((0,A.$I)(),N.matrix,$.matrix),W=t.JX.create(`${N.name} ${$.name}`,J,{assembly:N.assembly,ncsId:$.ncsId,hkl:N.hkl,spgrOp:N.spgrOp});G.push(W)}else G.push(N);return G}function m(R,f,p,E){const{spacegroup:T,ncsOperators:L}=R,w=L&&L.length||0,Q=[];!w&&f[0]<=0&&p[0]>=0&&f[1]<=0&&p[1]>=0&&f[2]<=0&&p[2]>=0&&(Q[0]=t.is.getSymmetryOperator(T,0,0,0,0));for(let G=0;G<T.operators.length;G++)for(let V=f[0];V<=p[0];V++)for(let U=f[1];U<=p[1];U++)for(let N=f[2];N<=p[2];N++)!w&&0===G&&0===V&&0===U&&0===N||Q.push(...l(R,G,V,U,N,E));return Q}function d(R,f){const p=v.o.Builder({label:R.label,dynamicBonds:R.dynamicBonds}),{units:E}=R;for(const T of f)for(const L of E)p.addWithOperator(L,T);return p.getStructure()}function C(){return(C=(0,e.A)(function*(R,f){const p=f.models;if(1!==p.length)throw new Error("Can only build NCS from structures based on 1 model.");const E=b.i.Provider.get(p[0]);if(!E)return f;const T=E.ncsOperators;return T&&T.length?d(f,T):f})).apply(this,arguments)}function a(){return(a=(0,e.A)(function*(R,f,p,E){const T=f.models;if(1!==T.length)throw new Error("Can only build symmetries from structures based on 1 model.");const L=b.i.Provider.get(T[0]);if(!L)return f;const{spacegroup:w}=L;return t.O8.isZero(w.cell)?f:d(f,m(L,p,E,c.Kx.getCenter(T[0])))})).apply(this,arguments)}function D(){return(D=(0,e.A)(function*(R,f,p){const E=f.models;if(1!==E.length)throw new Error("Can only build symmetries from structures based on 1 model.");const T=b.i.Provider.get(E[0]);if(!T)return f;const{spacegroup:L}=T;if(t.O8.isZero(L.cell))return f;R.shouldUpdate&&(yield R.update("Initialing..."));const Q=function u(R,f){return R._operators_333&&A.eB.equals(f,R._operators_333.ref)||(R._operators_333={ref:A.eB.clone(f),operators:m(R,A.eB.create(-3,-3,-3),A.eB.create(3,3,3),f)}),R._operators_333.operators}(T,c.Kx.getCenter(E[0])),G=f.lookup3d,V=new Set;function U($,J){return`${$.invariantId}|${J.name}`}const N=v.o.Builder({label:f.label,dynamicBonds:f.dynamicBonds}),{units:k}=f,H=A.eB.zero();for(const $ of Q){for(const J of k){const W=J.lookup3d.boundary.sphere;A.eB.transformMat4(H,W.center,$.matrix);const te=G.findUnitIndices(H[0],H[1],H[2],W.radius+p);for(let de=0,ye=te.count;de<ye;de++){if(!k[te.indices[de]].lookup3d.check(H[0],H[1],H[2],W.radius+p))continue;const Z=U(J,$);V.has(Z)||(N.addWithOperator(J,$),V.add(Z))}}R.shouldUpdate&&(yield R.update("Building symmetry..."))}return N.getStructure()})).apply(this,arguments)}!function(R){function w(U,N){return U.invariantId===N.invariantId&&U.model.id===N.model.id&&o.SortedArray.areEqual(U.elements,N.elements)}function Q(){return(0,r.BI)(O.N.hashUnit,w)}R.buildAssembly=function f(U,N){return y.YZ.create("Build Assembly",function(){var k=(0,e.A)(function*(H){const $=U.models;if(1!==$.length)throw new Error("Can only build assemblies from structures based on 1 model.");const J=c.vw.findAssembly($[0],N);if(!J)throw new Error(`Assembly '${N}' is not defined.`);const W=t.JX.create(J.id,A.$I.identity(),{assembly:{id:J.id,operId:0,operList:[]}}),te=v.o.Builder({coordinateSystem:W,label:U.label,dynamicBonds:U.dynamicBonds}),de=new i.cY(U);for(const ye of J.operatorGroups){const j=ye.selector(de);if(0===i.cv.structureCount(j))continue;const{units:Z}=i.cv.unionStructure(j);for(const q of ye.operators)for(const Y of Z)te.addWithOperator(Y,q)}return te.getStructure()});return function(H){return k.apply(this,arguments)}}())},R.buildSymmetryAssembly=function p(U,N,k){return y.YZ.create("Build Symmetry Assembly",function(){var H=(0,e.A)(function*($){const J=U.models;if(1!==J.length)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");const W=(0,A.eB)(),te=v.o.Builder({label:U.label,representativeModel:J[0],dynamicBonds:U.dynamicBonds}),de=new i.cY(U);for(const ye of N){const Z=I(ye.asymIds)(de);if(0===i.cv.structureCount(Z))continue;const{units:q}=i.cv.unionStructure(Z);for(const{index:Y,shift:[ee,g,_e]}of ye.operators){const xe=l(k,Y,ee,g,_e,W);for(const le of q)for(const Ae of xe)te.addWithOperator(le,Ae)}}return te.getStructure()});return function($){return H.apply(this,arguments)}}())},R.builderSymmetryMates=function E(U,N){return y.YZ.create("Find Symmetry Mates",k=>function S(R,f,p){return D.apply(this,arguments)}(k,U,N))},R.buildSymmetryRange=function T(U,N,k){return y.YZ.create("Build Symmetry",H=>function h(R,f,p,E){return a.apply(this,arguments)}(H,U,N,k))},R.buildNcs=function L(U){return y.YZ.create("Build NCS",N=>function s(R,f){return C.apply(this,arguments)}(N,U))},R.areUnitsEquivalent=w,R.UnitEquivalenceBuilder=Q,R.computeTransformGroups=function G(U){const N=Q();for(const H of U.units)N.add(H.id,H);const k=[];for(const H of N.groups)k.push(O.N.SymmetryGroup(H.map($=>U.unitMap.get($))));return k},R.areTransformGroupsEquivalent=function V(U,N){if(U.length!==N.length)return!1;for(let k=0,H=U.length;k<H;++k){const $=U[k].units,J=N[k].units;if($.length!==J.length||U[k].hashCode!==N[k].hashCode)return!1;for(let W=0,te=$.length;W<te;W++)if($[W].conformation!==J[W].conformation)return!1}return!0}}(M||(M={}))},8960:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>L});var e=n(7552),o=n(5644),r=n(5384),t=n(1739),A=n(9909),y=n(4561),c=n(3543),i=n(8382),v=n(9136),O=n(5734),b=n(2434),d=n(8199),s=n(4369);const C=(0,s.eB)();function a(w){const Q=function h(w){const{elements:Q,conformation:G}=w,V=new Float32Array(3*Q.length);for(let U=0,N=Q.length;U<N;U++)G.invariantPosition(Q[U],C),s.eB.toArray(C,V,3*U);return V}(w);return d.c.ofPositions(Q)}var S=n(9535),D=n(8334);class R{constructor(){this.data=new Map}get(Q){const G=c.SortedArray.hashCode(Q);if(this.data.has(G))for(const[V,U]of this.data.get(G))if(c.SortedArray.areEqual(Q,V))return U}set(Q,G){const V=c.SortedArray.hashCode(Q);if(this.data.has(V)){const U=this.data.get(V);for(const N of U)if(c.SortedArray.areEqual(Q,N[0]))return void(N[1]=G);U.push([Q,G])}else this.data.set(V,[[Q,G]])}static get(Q){return Q._dynamicPropertyData.ElementSetIntraBondCache||(Q._dynamicPropertyData.ElementSetIntraBondCache=new R),Q._dynamicPropertyData.ElementSetIntraBondCache}}var L,f=n(9651),p=n(1839);function T(w){const Q=w.bonds,{b:G,edgeProps:V,offset:U}=Q,{flags:k}=V,{elementAromaticRingIndices:H}=w.rings,$=[],J=new Map,W=new Map,te=(de,ye,j)=>{const Z=$.length;$.push(p.X.ofUnsortedArray([de,ye,j])),J.set((0,i.bd)(de,ye),j),W.has(de)?W.get(de).push(Z):W.set(de,[Z])};for(let de=0;de<w.elements.length;de++){if(H.has(de)||U[de+1]-U[de]+1<2)continue;const j=[];for(let Z=U[de],q=U[de+1];Z<q;Z++)b.I$.is(k[Z],16)&&j.push(G[Z]);if(j.length>=2){te(de,j[0],j[1]);for(let Z=1,q=j.length;Z<q;Z++)te(de,j[Z],j[0])}}return{getThirdElement:(de,ye)=>J.get((0,i.bd)(de,ye)),getTripletIndices:de=>W.get(de),triplets:$}}!function(w){let Q;var ne;function $(ne){const be=[];for(let Te=0,ie=ne.length;Te<ie;Te++)be.push(ne[Te].id);return(0,i.TI)(be)}function J(ne){const be={};return{elements:ne[0].elements,units:ne,get unitIndexMap(){return be.unitIndexMap||(be.unitIndexMap=function H(ne){const be=c.Yz.Mutable();for(let Te=0,ie=ne.length;Te<ie;Te++)be.set(ne[Te].id,Te);return be}(ne)),be.unitIndexMap},hashCode:te(ne[0]),transformHash:$(ne)}}function te(ne){return(0,i.vb)(ne.invariantId,c.SortedArray.hashCode(ne.elements))}let de,ye;function Z(ne){const be=ne.coarseConformation.spheres.radius;return Te=>be[Te]}(ne=Q=w.Kinds||(w.Kinds={}))[ne.Atomic=0]="Atomic",ne[ne.Spheres=1]="Spheres",ne[ne.Gaussians=2]="Gaussians",w.isAtomic=function G(ne){return 0===ne.kind},w.isCoarse=function V(ne){return 1===ne.kind||2===ne.kind},w.isSpheres=function U(ne){return 1===ne.kind},w.isGaussians=function N(ne){return 2===ne.kind},w.create=function k(ne,be,Te,ie,ue,re,ve,ce,se){switch(ue){case 0:return new Y(ne,be,Te,ie,re,ce,e.J.createMapping(ve,re.atomicConformation),se??{});case 1:return Be(ne,be,Te,ie,re,1,ce,e.J.createMapping(ve,re.coarseConformation.spheres,Z(re)),se??{});case 2:return Be(ne,be,Te,ie,re,2,ce,e.J.createMapping(ve,re.coarseConformation.gaussians,be=>0),se??{})}},w.SymmetryGroup=J,function(ne){ne.areInvariantElementsEqual=function be(ie,ue){return ie.hashCode===ue.hashCode&&c.SortedArray.areEqual(ie.elements,ue.elements)},ne.getUnitSymmetryGroupsIndexMap=function Te(ie){const ue=c.Yz.Mutable();for(let re=0,ve=ie.length;re<ve;++re){const ce=ie[re];for(let se=0,ae=ce.units.length;se<ae;++se)ue.set(ce.units[se].id,re)}return ue}}(J=w.SymmetryGroup||(w.SymmetryGroup={})),w.conformationId=function W(ne){return w.isAtomic(ne)?ne.model.atomicConformation.id:ne.model.coarseConformation.id},w.hashUnit=te,function(ne){ne[ne.None=0]="None",ne[ne.MultiChain=1]="MultiChain",ne[ne.Partitioned=2]="Partitioned",ne[ne.FastBoundary=4]="FastBoundary"}(de=w.Trait||(w.Trait={})),function(ne){ne.is=A.NJ.has,ne.create=A.NJ.create}(ye=w.Traits||(w.Traits={}));class Y{getChild(be){return be.length===this.elements.length?this:new Y(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,be,this.conformation,{})}applyOperator(be,Te,ie=!1){const ue=ie?Te:e.J.compose(this.conformation.operator,Te);return new Y(be,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,e.J.createMapping(ue,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(be,Te,ie){var ue,re;ie||(ie={...this.props,bonds:!Te||null!==(re=null===(ue=this.props.bonds)||void 0===ue?void 0:ue.props)&&void 0!==re&&re.canRemap?we(this,this.props.bonds,be,Te):void 0},w.isSameConformation(this,be)||(ie.boundary=void 0,ie.lookup3d=void 0,ie.principalAxes=void 0));let ve=this.conformation.operator;const ce=f.i.Provider.get(be);if(-1!==ve.spgrOp&&ce&&ce!==f.i.Provider.get(this.model)){const[ae,ge,Ie]=ve.hkl,{toFractional:Le}=ce.spacegroup.cell,nt=s.eB.transformMat4((0,s.eB)(),o.Kx.getCenter(be),Le);ve=r.is.getSymmetryOperatorRef(ce.spacegroup,ve.spgrOp,ae,ge,Ie,nt)}const se=this.model.atomicConformation!==be.atomicConformation||ve!==this.conformation.operator?e.J.createMapping(ve,be.atomicConformation):this.conformation;return new Y(this.id,this.invariantId,this.chainGroupId,this.traits,be,this.elements,se,ie)}get boundary(){if(this.props.boundary)return this.props.boundary;const{x:be,y:Te,z:ie}=this.model.atomicConformation;return this.props.boundary=ye.is(this.traits,de.FastBoundary)?(0,S.b)({x:be,y:Te,z:ie,indices:this.elements}):(0,S.r)({x:be,y:Te,z:ie,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;const{x:be,y:Te,z:ie}=this.model.atomicConformation;return this.props.lookup3d=(0,r.Eh)({x:be,y:Te,z:ie,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=a(this)),this.props.principalAxes}get bonds(){var be;if(this.props.bonds)return this.props.bonds;const Te=R.get(this.model);let ie=Te.get(this.elements);return ie||(ie=(0,t.MQ)(this),!(null===(be=ie.props)||void 0===be)&&be.cacheable&&Te.set(this.elements,ie)),this.props.bonds=ie,this.props.bonds}get rings(){return this.props.rings||(this.props.rings=y.g.create(this)),this.props.rings}get resonance(){return this.props.resonance||(this.props.resonance=function E(w){return{delocalizedTriplets:T(w)}}(this)),this.props.resonance}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=function _(w){const Q=[],{elements:G,model:V}=w,{residueAtomSegments:U}=w.model.atomicHierarchy,{traceElementIndex:N}=V.atomicHierarchy.derived.residue,k=O.m.transientSegments(w.model.atomicRanges.polymerRanges,G),H=c.hT.transientSegments(U,G);for(;k.hasNext;){const $=k.move();for(H.setSegment($);H.hasNext;){const J=H.move(),{start:W,end:te,index:de}=J;if(c.CD.areIntersecting(c.IX.ofRange(G[W],G[te-1]),G)){const ye=N[de];Q.push(-1===ye?U.offsets[de]:ye)}}}return c.SortedArray.ofSortedArray(Q)}(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=function I(w){const Q=[],{elements:G,model:V,residueIndex:U}=w,{residueAtomSegments:N}=w.model.atomicHierarchy,{traceElementIndex:k}=V.atomicHierarchy.derived.residue,H=O.m.transientSegments(w.model.atomicRanges.gapRanges,w.elements);for(;H.hasNext;){const $=H.move(),J=U[G[$.start]],W=U[G[$.end-1]],te=k[J],de=k[W];Q.push(-1===te?N.offsets[J]:te),Q.push(-1===de?N.offsets[W]:de)}return c.SortedArray.ofSortedArray(Q)}(this)),this.props.gapElements}get nucleotideElements(){return this.props.nucleotideElements||(this.props.nucleotideElements=function m(w){const Q=[],{elements:G,model:V}=w,{chainAtomSegments:U,residueAtomSegments:N}=V.atomicHierarchy,{moleculeType:k,traceElementIndex:H}=V.atomicHierarchy.derived.residue,$=c.hT.transientSegments(U,G),J=c.hT.transientSegments(N,G);for(;$.hasNext;)for(J.setSegment($.move());J.hasNext;){const{index:W}=J.move();if((0,b.OV)(k[W])){const te=H[W];Q.push(-1===te?N.offsets[W]:te)}}return c.SortedArray.ofSortedArray(Q)}(this)),this.props.nucleotideElements}get proteinElements(){return this.props.proteinElements||(this.props.proteinElements=function u(w){const Q=[],{elements:G,model:V}=w,{chainAtomSegments:U,residueAtomSegments:N}=V.atomicHierarchy,{moleculeType:k,traceElementIndex:H}=V.atomicHierarchy.derived.residue,$=c.hT.transientSegments(U,G),J=c.hT.transientSegments(N,G);for(;$.hasNext;)for(J.setSegment($.move());J.hasNext;){const{index:W}=J.move();if((0,b.iu)(k[W])){const te=H[W];Q.push(-1===te?N.offsets[W]:te)}}return c.SortedArray.ofSortedArray(Q)}(this)),this.props.proteinElements}get residueCount(){if(void 0!==this.props.residueCount)return this.props.residueCount;let be=0;const Te=c.hT.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);for(;Te.hasNext;)Te.move(),be+=1;return this.props.residueCount=be,this.props.residueCount}getResidueIndex(be){return this.residueIndex[this.elements[be]]}constructor(be,Te,ie,ue,re,ve,ce,se){this.kind=0,this.objectPrimitive="atomistic",this.id=be,this.invariantId=Te,this.chainGroupId=ie,this.traits=ue,this.model=re,this.elements=ve,this.conformation=ce,this.residueIndex=re.atomicHierarchy.residueAtomSegments.index,this.chainIndex=re.atomicHierarchy.chainAtomSegments.index,this.props=se}}w.Atomic=Y;class g{getChild(be){return be.length===this.elements.length?this:Be(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,be,this.conformation,{})}applyOperator(be,Te,ie=!1){const ue=ie?Te:e.J.compose(this.conformation.operator,Te);return Be(be,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,e.J.createMapping(ue,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(be,Te,ie){const ue=this.getCoarseConformation(),re=_e(this.kind,be);ie||(ie={...this.props},w.isSameConformation(this,be)||(ie.boundary=void 0,ie.lookup3d=void 0,ie.principalAxes=void 0));const ve=ue!==re?e.J.createMapping(this.conformation.operator,re,1===this.kind?Z(be):be=>0):this.conformation;return new g(this.id,this.invariantId,this.chainGroupId,this.traits,be,this.kind,this.elements,ve,ie)}get boundary(){if(this.props.boundary)return this.props.boundary;const{x:be,y:Te,z:ie}=this.getCoarseConformation();return this.props.boundary=ye.is(this.traits,de.FastBoundary)?(0,S.b)({x:be,y:Te,z:ie,indices:this.elements}):(0,S.r)({x:be,y:Te,z:ie,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;const{x:be,y:Te,z:ie}=this.getCoarseConformation();return this.props.lookup3d=(0,r.Eh)({x:be,y:Te,z:ie,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=a(this)),this.props.principalAxes}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=function M(w){const Q=[],{elements:G,model:V}=w,{spheres:U,gaussians:N}=V.coarseHierarchy,k=v.Nf.isSpheres(w)?U.polymerRanges:N.polymerRanges,H=O.m.transientSegments(k,G);for(;H.hasNext;){const{start:$,end:J}=H.move();for(let W=$;W<J;++W)Q.push(G[W])}return c.SortedArray.ofSortedArray(Q)}(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=function l(w){const Q=[],{elements:G,model:V}=w,{spheres:U,gaussians:N}=V.coarseHierarchy,k=v.Nf.isSpheres(w)?U.gapRanges:N.gapRanges,H=O.m.transientSegments(k,G);for(;H.hasNext;){const{start:$,end:J}=H.move();Q.push(G[$],G[J-1])}return c.SortedArray.ofSortedArray(Q)}(this)),this.props.gapElements}getCoarseConformation(){return _e(this.kind,this.model)}constructor(be,Te,ie,ue,re,ve,ce,se,ae){this.kind=ve,this.objectPrimitive=1===ve?"sphere":"gaussian",this.id=be,this.invariantId=Te,this.chainGroupId=ie,this.traits=ue,this.model=re,this.elements=ce,this.conformation=se,this.coarseElements=1===ve?re.coarseHierarchy.spheres:re.coarseHierarchy.gaussians,this.coarseConformation=1===ve?re.coarseConformation.spheres:re.coarseConformation.gaussians,this.props=ae}}function _e(ne,be){return 1===ne?be.coarseConformation.spheres:be.coarseConformation.gaussians}function Be(ne,be,Te,ie,ue,re,ve,ce,se){return new g(ne,be,Te,ie,ue,re,ve,ce,se)}function we(ne,be,Te,ie){var ue;if(!be)return;if(ne.model.atomicConformation.id===Te.atomicConformation.id)return be;const re=D.z.Provider.get(ne.model);if(re){const ve=D.z.Provider.get(Te);return ve&&re!==ve?void 0:be}return null!==(ue=be.props)&&void 0!==ue&&ue.canRemap||!ie||Oe(ne,Te)?be:void 0}function Oe(ne,be){const Te=o.Kx.CoordinatesHistory.get(o.Kx.getRoot(be));if(Te)return Te.areEqual(ne.elements,ne.kind,be);const ie=ne.elements,{x:ue,y:re,z:ve}=ne.conformation.coordinates,{x:ce,y:se,z:ae}=Se(ne.kind,be);for(let ge=0,Ie=ie.length;ge<Ie;ge++){const Le=ie[ge];if(ue[Le]!==ce[Le]||re[Le]!==se[Le]||ve[Le]!==ae[Le])return!1}return!0}function Se(ne,be){return 0===ne?be.atomicConformation:1===ne?be.coarseConformation.spheres:be.coarseConformation.gaussians}function Ne(ne,be){return 0===ne?be.atomicHierarchy:1===ne?be.coarseHierarchy.spheres:be.coarseHierarchy.gaussians}w.Spheres=class le extends g{},w.Gaussians=class Ae extends g{},w.areSameChainOperatorGroup=function Ce(ne,be){return ne.chainGroupId===be.chainGroupId&&ne.conformation.operator.name===be.conformation.operator.name},w.areOperatorsEqual=function Re(ne,be){return s.$I.areEqual(ne.conformation.operator.matrix,be.conformation.operator.matrix,1e-6)},w.areConformationsEqual=function ke(ne,be){return ne===be||!!c.SortedArray.areEqual(ne.elements,be.elements)&&Oe(ne,be.model)},w.isSameConformation=Oe,w.getModelConformationOfKind=Se,w.getConformation=function Ve(ne){return Se(ne.kind,ne.model)},w.getModelHierarchyOfKind=Ne,w.getHierarchy=function K(ne){return Ne(ne.kind,ne.model)}}(L||(L={}))},1739:(tn,Ue,n)=>{"use strict";n.d(Ue,{gn:()=>de,dZ:()=>v,kD:()=>W,MQ:()=>f});var i,e=n(8672),o=n(2434),r=n(3543),t=n(6290),A=n(4506),y=n(8960),c=n(481);(i||(i={})).Empty=A.O.create([],[],[],0,{flags:[],order:[],key:[]});class v extends c.Z{getBondFromLocation(j){return y.N.isAtomic(j.aUnit)&&y.N.isAtomic(j.bUnit)?this.getEdge(j.aIndex,j.aUnit.id,j.bIndex,j.bUnit.id):void 0}getBondIndexFromLocation(j){return y.N.isAtomic(j.aUnit)&&y.N.isAtomic(j.bUnit)?this.getEdgeIndex(j.aIndex,j.aUnit.id,j.bIndex,j.bUnit.id):-1}}(v||(v={})).UnitPairBonds=class j extends c.Z.UnitPairEdges{};var O=n(6066),b=n(5373),_=n(8334),M=n(9344),I=n(8737),l=n(4369),m=n(2028),u=n(4632);const d=l.eB.distance;function s(ye,j,Z,q,Y,ee,g){const _e=new A.O.EdgeBuilder(ee,ye,j),xe=new Uint16Array(_e.slotCount),le=new Int8Array(_e.slotCount),Ae=new Uint32Array(_e.slotCount);for(let Be=0,Ce=_e.edgeCount;Be<Ce;Be++)_e.addNextEdge(),_e.assignProperty(xe,q[Be]),_e.assignProperty(le,Z[Be]),_e.assignProperty(Ae,Y[Be]);return _e.createGraph({flags:xe,order:le,key:Ae},g)}const C=(0,l.eB)(),h=(0,l.eB)();function a(ye,j,Z){return ye.conformation.position(j,C),ye.conformation.position(Z,h),d(C,h)}const S=new Set;function f(ye,j){const Z={...O.kD,...j};return Z.noCompute||u.K.isCoarseGrained(ye.model)&&!_.z.Provider.get(ye.model)&&!I.A.isExhaustive(ye.model)?i.Empty:!Z.forceCompute&&_.z.Provider.get(ye.model)?function D(ye){const j=_.z.Provider.get(ye.model),{elements:Z}=ye,{type_symbol:q}=ye.model.atomicHierarchy.atoms,Y=ye.elements.length,{maxDistance:ee}=j,{offset:g,b:_e,edgeProps:{order:xe,distance:le,flag:Ae,key:Be,operatorA:Ce,operatorB:Re}}=j.bonds,{atomSourceIndex:ke}=ye.model.atomicHierarchy,{invertedIndex:we}=u.K.getInvertedAtomSourceIndex(ye.model),Oe=[],Se=[],Ve=[],Ne=[],K=[],ne=ye.conformation.operator.key;for(let be=0;be<Y;be++){const Te=Z[be],ie=(0,O.Yd)(q.value(Te)),ue=(0,O.v3)(ie),re=ke.value(Te);for(let ve=g[re],ce=g[re+1];ve<ce;++ve){const se=we[_e[ve]];if(Te>=se)continue;const ae=r.SortedArray.indexOf(ye.elements,se);if(ae<0)continue;const ge=Ce[ve],Ie=Re[ve];if(ge>=0&&ge!==ne||Ie>=0&&Ie!==ne)continue;const Le=(0,O.Yd)(q.value(se)),nt=le[ve],je=a(ye,Te,se);let Lt=!1;nt>=0?Lt=(0,m.T)(je,nt,.3):ee>=0?Lt=je<ee:(Lt=je<(0,O.on)(ie,Le,(0,O.O6)(ie),(0,O.O6)(Le)),ue&&(0,O.v3)(Le)&&(Lt=!1)),Lt&&(Oe[Oe.length]=be,Se[Se.length]=ae,Ne[Ne.length]=xe[ve],Ve[Ve.length]=Ae[ve],K[K.length]=Be[ve])}}return s(Oe,Se,Ne,Ve,K,Y,{canRemap:!1,cacheable:j.cacheable})}(ye):function R(ye,j){const{maxRadius:Z}=j,{x:q,y:Y,z:ee}=ye.model.atomicConformation,g=ye.elements.length,{elements:_e,residueIndex:xe,chainIndex:le}=ye,{type_symbol:Ae,label_atom_id:Be,label_alt_id:Ce,label_comp_id:Re}=ye.model.atomicHierarchy.atoms,{label_seq_id:ke}=ye.model.atomicHierarchy.residues,{index:we}=ye.model.atomicHierarchy,{byEntityKey:Oe}=ye.model.sequence,Se=ye.lookup3d,Ve=I.A.Provider.get(ye.model),Ne=M.X.Provider.get(ye.model),K=I.A.isExhaustive(ye.model),ne=[],be=[],Te=[],ie=[],ue=[];let ve,re=-1,ce=!0,se=!0,ae=!0;const ge=S;for(let Ie=0;Ie<g;Ie++){const Le=_e[Ie],nt=Ae.value(Le);ce&&"H"!==nt&&"O"!==nt&&(ce=!1);const je=j.forceCompute?void 0:Ve&&Ve.byAtomIndex.get(Le);let Lt=!1;if(je)for(const yt of je){const{partnerA:At,partnerB:Gt}=yt;if(At.symmetry!==Gt.symmetry)continue;const tt=r.SortedArray.indexOf(ye.elements,(At.atomIndex===Le?Gt:At).atomIndex);tt<0||_e[tt]<Le||(ne[ne.length]=Ie,be[be.length]=tt,Te[Te.length]=yt.flags,ie[ie.length]=yt.order,ue[ue.length]=yt.rowIndex,Lt||ge.clear(),Lt=!0,ge.add(tt))}if(K)continue;const Je=xe[Le],en=ke.value(Je),Bt=Re.value(Le);if(!j.forceCompute&&Je!==re)if(Ne&&Ne.entries.has(Bt)){const yt=Oe[we.getEntityFromChain(le[Le])];ve=yt&&yt.sequence.microHet.has(en)?void 0:Ne.entries.get(Bt).map}else ve=void 0;re=Je;const pn=(0,O.Yd)(nt),$e=Be.value(Le),mt=ve?ve.get($e):void 0,{indices:_t,count:Me,squaredDistances:Ke}=Se.find(q[Le],Y[Le],ee[Le],Z),ut=(0,O.v3)(pn),Kt=(0,O.O6)(pn),sn=Ce.value(Le),gt=O.ZL.has(pn);for(let yt=0;yt<Me;yt++){const At=_t[yt];if(Lt&&ge.has(At))continue;const Gt=_e[At];if(Gt<=Le)continue;const rn=Ce.value(Gt);if(sn&&rn&&sn!==rn)continue;const tt=(0,O.Yd)(Ae.value(Gt)),Mt=(0,O.v3)(tt);if(ut&&Mt)continue;const nn=(gt||O.ZL.has(tt))&&!(ut||Mt),bn=xe[Gt];if(Je===bn&&mt){const It=mt.get(Be.value(Gt));if(It){ne[ne.length]=Ie,be[be.length]=At,ie[ie.length]=It.order;let Dt=It.flags;nn&&(1|Dt&&(Dt^=1),Dt|=2),Te[Te.length]=Dt,ue[ue.length]=It.key}continue}const Dn=Math.sqrt(Ke[yt]);if(0!==Dn&&Dn<=(0,O.on)(pn,tt,Kt,(0,O.O6)(tt))){ne[ne.length]=Ie,be[be.length]=At,ie[ie.length]=(0,b.e)(Bt,$e,Be.value(Gt)),Te[Te.length]=32|(nn?2:1),ue[ue.length]=-1;const It=ke.value(bn);en===It&&(se=!1),Math.abs(en-It)>1&&(ae=!1)}}}return s(ne,be,ie,Te,ue,g,{canRemap:ce||se&&ae})}(ye,Z)}var p=n(1969),E=n(5644);const T=l.eB.distance,L=l.eB.set,w=l.eB.squaredDistance,Q=l.eB.transformMat4,G=(0,l.eB)(),V=(0,l.eB)();function U(ye,j,Z,q){return ye.conformation.position(j,G),Z.conformation.position(q,V),T(G,V)}const N=(0,l.$I)(),k=(0,l.eB)(),$={...O.kD,ignoreWater:!0,ignoreIon:!0};function W(ye,j){const Z={...$,...j};return function J(ye,j){const Z=new c.Z.Builder,q=ye.models.some(ee=>_.z.Provider.get(ee)),Y=ye.models.some(ee=>I.A.isExhaustive(ee));return j.noCompute||ye.isCoarseGrained&&!q&&!Y||p.o.eachUnitPair(ye,(ee,g)=>{!function H(ye,j,Z,q){const{maxRadius:Y}=Z,{elements:ee,residueIndex:g}=ye,{x:_e,y:xe,z:le}=ye.model.atomicConformation,{elements:Ae,residueIndex:Be}=j,Ce=ye.elements.length,{type_symbol:Re,label_alt_id:ke,label_atom_id:we,label_comp_id:Oe}=ye.model.atomicHierarchy.atoms,{type_symbol:Se,label_alt_id:Ve,label_atom_id:Ne,label_comp_id:K}=j.model.atomicHierarchy.atoms,{auth_seq_id:ne}=ye.model.atomicHierarchy.residues,{auth_seq_id:be}=j.model.atomicHierarchy.residues,{occupancy:Te}=ye.model.atomicConformation,{occupancy:ie}=j.model.atomicConformation,ue=Te.isDefined&&ie.isDefined,re=ye.model===j.model&&I.A.Provider.get(ye.model),ve=!Z.forceCompute&&ye.model===j.model&&_.z.Provider.get(ye.model),{atomSourceIndex:ce}=ye.model.atomicHierarchy,{invertedIndex:se}=ve?E.Kx.getInvertedAtomSourceIndex(j.model):{invertedIndex:void 0},ae=ye.model===j.model&&I.A.isExhaustive(ye.model),ge=l.$I.mul(N,j.conformation.operator.inverse,ye.conformation.operator.matrix),Ie=!l.$I.isIdentity(ge),{center:Le,radius:nt}=j.boundary.sphere,je=(nt+Y)*(nt+Y);q.startUnitPair(ye.id,j.id);const Lt=ye.conformation.operator.key,Je=j.conformation.operator.key;for(let en=0;en<Ce;en++){const Bt=ee[en];if(L(k,_e[Bt],xe[Bt],le[Bt]),Ie&&Q(k,k,ge),w(k,Le)>je)continue;if(!Z.forceCompute&&ve){const{maxDistance:rn}=ve,{offset:tt,b:Mt,edgeProps:{order:nn,distance:bn,flag:Dn,key:jt,operatorA:It,operatorB:Dt}}=ve.bonds,Ct=ce.value(Bt),$t=(0,O.Yd)(Re.value(Bt));for(let Vt=tt[Ct],Wt=tt[Ct+1];Vt<Wt;++Vt){const yn=se[Mt[Vt]],Zt=r.SortedArray.indexOf(j.elements,yn);if(Zt<0)continue;const kt=It[Vt],Ot=Dt[Vt];if(kt>=0&&Ot>=0&&(kt===Ot||kt!==Lt||Ot!==Je))continue;const An=(0,O.Yd)(Re.value(yn)),jn=bn[Vt],On=U(ye,Bt,j,yn);let fr=!1;jn>=0?fr=(0,m.T)(On,jn,.3):rn>=0?fr=On<rn:(fr=On<(0,O.on)($t,An,(0,O.O6)($t),(0,O.O6)(An)),(0,O.v3)($t)&&(0,O.v3)(An)&&(fr=!1)),fr&&q.add(en,Zt,{order:nn[Vt],flag:Dn[Vt],key:jt[Vt]})}continue}const pn=Z.forceCompute?void 0:re&&re.byAtomIndex.get(Bt);if(pn&&pn.length){let rn=!1;for(const tt of pn){const{partnerA:Mt,partnerB:nn}=tt,bn=Mt.atomIndex===Bt?nn:Mt,Dn=r.SortedArray.indexOf(j.elements,bn.atomIndex);Dn<0||U(ye,Bt,j,bn.atomIndex)>Y||(q.add(en,Dn,{order:tt.order,flag:tt.flags,key:tt.rowIndex}),rn=!0)}if(rn)continue}if(ae)continue;const $e=Te.value(Bt),{lookup3d:mt}=j,{indices:_t,count:Me,squaredDistances:Ke}=mt.find(k[0],k[1],k[2],Y);if(0===Me)continue;const ut=(0,O.Yd)(Re.value(Bt)),Kt=(0,O.v3)(ut),sn=(0,O.O6)(ut),gt=ke.value(Bt),yt=O.ZL.has(ut),At=we.value(Bt),Gt=Oe.value(g[Bt]);for(let rn=0;rn<Me;rn++){const tt=_t[rn],Mt=Ae[tt],nn=Ve.value(Mt);if(gt&&nn&&gt!==nn||ue&&ie.value(Mt)<1&&$e<1&&ne.value(Bt)===be.value(Mt))continue;const bn=(0,O.Yd)(Se.value(Mt)),Dn=(0,O.v3)(bn);if(Kt&&Dn)continue;const jt=(yt||O.ZL.has(bn))&&!(Kt||Dn),It=Math.sqrt(Ke[rn]);if(0!==It&&It<=(0,O.on)(ut,bn,sn,(0,O.O6)(bn))){const Ct=Ne.value(Mt),$t=K.value(Be[Mt]);q.add(en,tt,{order:(0,b.m)(Gt,$t,At,Ct),flag:32|(jt?2:1),key:-1})}}}q.finishUnitPair()}(ee,g,j,Z)},{maxRadius:j.maxRadius,validUnit:ee=>j.validUnit(ee),validUnitPair:(ee,g)=>j.validUnitPair(ye,ee,g)}),new v(Z.getMap())}(ye,{...Z,validUnit:j&&j.validUnit||(q=>y.N.isAtomic(q)),validUnitPair:j&&j.validUnitPair||((q,Y,ee)=>{if(!p.o.validUnitPair(q,Y,ee))return!1;const _e=Y.model.atomicHierarchy.derived.residue.moleculeType,xe=ee.model.atomicHierarchy.derived.residue.moleculeType,le=!(y.N.isAtomic(Y)&&2===_e[Y.residueIndex[Y.elements[0]]]||y.N.isAtomic(ee)&&2===xe[ee.residueIndex[ee.elements[0]]]),Ae=!y.N.isAtomic(Y)||3!==_e[Y.residueIndex[Y.elements[0]]],Be=!y.N.isAtomic(ee)||3!==xe[ee.residueIndex[ee.elements[0]]];return!(!le&&Z.ignoreWater||(!Ae||!Be)&&Z.ignoreIon)||function te(ye,j){if(ye.model!==j.model||!y.N.isAtomic(ye)||!y.N.isAtomic(j))return!1;const Z=I.A.Provider.get(ye.model);if(!Z)return!1;const q=ye.elements.length<j.elements.length?ye:j,Y=ye.elements.length>=j.elements.length?ye:j,{elements:ee}=q,{elements:g}=Y,{indexOf:_e}=r.SortedArray;for(let xe=0,le=ee.length;xe<le;xe++){const Ae=ee[xe],Be=Z.byAtomIndex.get(Ae);if(Be?.length)for(const Ce of Be)if(_e(g,Ce.partnerA.atomIndex===Ae?Ce.partnerB.atomIndex:Ce.partnerA.atomIndex)>=0)return!0}return!1}(Y,ee)})})}var de;!function(ye){function j(Oe,Se,Ve,Ne,K,ne){return{kind:"bond-location",aStructure:Oe,aUnit:Se,aIndex:Ve,bStructure:Ne,bUnit:K,bIndex:ne}}function q(Oe,Se){return Oe.aStructure.label===Se.aStructure.label&&Oe.bStructure.label===Se.bStructure.label&&Oe.aIndex===Se.aIndex&&Oe.bIndex===Se.bIndex&&Oe.aUnit.id===Se.aUnit.id&&Oe.bUnit.id===Se.bUnit.id}function Y(Oe,Se){return{kind:"bond-loci",structure:Oe,bonds:Se}}ye.Location=j,ye.isLocation=function Z(Oe){return!!Oe&&"bond-location"===Oe.kind},ye.areLocationsEqual=q,ye.Loci=Y,ye.isLoci=function ee(Oe){return!!Oe&&"bond-loci"===Oe.kind},ye.areLociEqual=function g(Oe,Se){if(Oe.structure!==Se.structure||Oe.bonds.length!==Se.bonds.length)return!1;for(let Ve=0,Ne=Oe.bonds.length;Ve<Ne;++Ve)if(!q(Oe.bonds[Ve],Se.bonds[Ve]))return!1;return!0},ye.isLociEmpty=function _e(Oe){return 0===Oe.bonds.length},ye.remapLoci=function xe(Oe,Se){if(Se===Oe.structure)return Oe;const Ve=[];return Oe.bonds.forEach(Ne=>{const K=Se.unitMap.get(Ne.aUnit.id);if(!K)return;const ne=Se.unitMap.get(Ne.bUnit.id);if(!ne)return;const Te=r.SortedArray.indexOf(K.elements,Ne.aUnit.elements[Ne.aIndex]);if(-1===Te)return;const ue=r.SortedArray.indexOf(ne.elements,Ne.bUnit.elements[Ne.bIndex]);-1!==ue&&Ve.push(j(Oe.structure,K,Te,Oe.structure,ne,ue))}),Y(Se,Ve)},ye.toStructureElementLoci=function le(Oe){const Se=[],Ve=new Map;for(const Ne of Oe.bonds){const{aIndex:K,aUnit:ne,bIndex:be,bUnit:Te}=Ne;ne===Te?Ve.has(ne.id)?Ve.get(ne.id).push(K,be):Ve.set(ne.id,[K,be]):(Ve.has(ne.id)?Ve.get(ne.id).push(K):Ve.set(ne.id,[K]),Ve.has(Te.id)?Ve.get(Te.id).push(be):Ve.set(Te.id,[be]))}return Ve.forEach((Ne,K)=>{Se.push({unit:Oe.structure.unitMap.get(K),indices:r.SortedArray.deduplicate(r.SortedArray.ofUnsortedArray(Ne))})}),e.iZ.Loci(Oe.structure,Se)},ye.toFirstStructureElementLoci=function Ae(Oe){const{aUnit:Se,aIndex:Ve}=Oe.bonds[0];return e.iZ.Loci(Oe.structure,[{unit:Se,indices:r.CD.ofSingleton(Ve)}])},ye.getType=function Be(Oe,Se){if(Se.aUnit===Se.bUnit){const Ve=Se.aUnit.bonds,Ne=Ve.getEdgeIndex(Se.aIndex,Se.bIndex);return o.I$.create(Ne<0?0:Ve.edgeProps.flags[Ne])}{const Ve=Oe.interUnitBonds.getBondFromLocation(Se);return o.I$.create(Ve?Ve.props.flag:0)}},ye.getOrder=function Ce(Oe,Se){if(Se.aUnit===Se.bUnit){const Ve=Se.aUnit.bonds,Ne=Ve.getEdgeIndex(Se.aIndex,Se.bIndex);return Ne<0?0:Ve.edgeProps.order[Ne]}{const Ve=Oe.interUnitBonds.getBondFromLocation(Se);return Ve?Ve.props.order:0}},ye.getIntraUnitBondCount=function Re(Oe){let Se=0;for(let Ve=0,Ne=Oe.units.length;Ve<Ne;++Ve){const K=Oe.units[Ve];e.Nf.isAtomic(K)&&(Se+=K.bonds.edgeCount)}return Se},ye.ElementBondIterator=class ke{move(){return this.advance(),this.current}setElement(Se,Ve,Ne){this.structure=Se,this.unit=Ve,this.index=Ne,this.interBondIndices=Se.interUnitBonds.getEdgeIndices(Ne,Ve.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=Ve.bonds.offset[Ne+1],this.intraBondIndex=Ve.bonds.offset[Ne],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else{if(!(this.interBondIndex<this.interBondCount))return void(this.hasNext=!1);{const Se=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(Se.unitA!==this.unit.id?Se.unitA:Se.unitB),this.current.otherIndex=Se.indexA!==this.index?Se.indexA:Se.indexB,this.current.type=Se.props.flag,this.current.order=Se.props.order,this.interBondIndex+=1}}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}constructor(){this.current={},this.hasNext=!1}},ye.getBoundingSphere=function we(Oe,Se){return t.p.fromPairProvider(Oe.bonds.length,(Ve,Ne,K)=>{const{aUnit:ne,aIndex:be,bUnit:Te,bIndex:ie}=Oe.bonds[Ve];ne.conformation.position(ne.elements[be],Ne),Te.conformation.position(Te.elements[ie],K)},Se)}}(de||(de={}))},6066:(tn,Ue,n)=>{"use strict";n.d(Ue,{O6:()=>b,Yd:()=>v,ZL:()=>c,kD:()=>o,on:()=>_,v3:()=>I});const o={forceCompute:!1,noCompute:!1,maxRadius:4},r={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},t={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},A={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},y=2.001,c=function(){const l=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],m=new Set;for(const u of l)m.add(r[u]);return m}();function v(l){const m=r[l];return void 0===m?-1:m}function b(l){if(l<0)return y;const m=t[l];return void 0===m?y:m}function _(l,m,u,d){const s=function O(l,m){if(l<0||m<0)return-1;const u=A[function i(l,m){return l<m?(l+m)*(l+m+1)/2+m:(l+m)*(l+m+1)/2+l}(l,m)];return void 0===u?-1:u}(l,m);return s>0?s:m<0?u:(u+d)/1.95}const M=r.H;function I(l){return l===M}},4561:(tn,Ue,n)=>{"use strict";n.d(Ue,{X:()=>S,g:()=>a});var e=n(3543),o=n(4506),r=n(2434),t=n(8382),A=n(6115);function i(E){E.count=E.endVertex-E.startVertex;const{isRingAtom:T,pred:L,color:w,depth:Q,marked:G}=E;for(let V=0;V<E.count;V++)T[V]=0,L[V]=-1,G[V]=-1,w[V]=0,Q[V]=0;E.currentColor=0,E.currentAltLoc="",E.hasAltLoc=!1}function v(E){const{depth:T}=E;for(let L=0;L<E.count;L++)T[L]=E.count+1}function b(E,T){const L=E.bonds.offset,w=E.startVertex+T,V=L[w+1]-L[w];return!(V<=1||E.isRingAtom[T]&&2===V)}function _(E,T,L){if(E.startVertex=T,E.endVertex=L,E.endVertex-E.startVertex<3)return;E.currentRings=[];const{elements:w}=E.unit,Q=[];for(let V=E.startVertex;V<E.endVertex;V++){const U=E.altLoc.value(w[V]);(0,A.Z2)(Q,U)}(0,A.K3)(Q,"");let G=1;if(0===Q.length){i(E);for(let V=0;V<E.count;V++)b(E,V)&&(v(E),G=I(E,V,G))}else for(let V=0;V<Q.length;V++){i(E),E.hasAltLoc=!0,E.currentAltLoc=Q[V];for(let U=0;U<E.count;U++){if(!b(E,U))continue;const N=E.altLoc.value(w[E.startVertex+U]);N&&N!==E.currentAltLoc||(v(E),G=I(E,U,G))}}for(let V=0,U=E.currentRings.length;V<U;V++)E.rings.push(E.currentRings[V])}function M(E,T,L,w){if(L<T)return!1;const{pred:Q,color:G,left:V,right:U}=E,N=++E.currentColor;let k=T;for(let j=0;j<5&&(G[k]=N,k=Q[k],!(k<0));j++);let H=0,$=0,J=!1,W=0;k=L;for(let j=0;j<5;j++){if(G[k]===N){W=k,J=!0;break}if(U[$++]=k,k=Q[k],k<0)break}if(!J)return!1;k=T;for(let j=0;j<5&&(V[H++]=k,!(W===k||(k=Q[k],k<0)));j++);const te=H+$;if(te<3)return!1;const de=new Int32Array(te);let ye=0;for(let j=0;j<H;j++)de[ye++]=E.startVertex+V[j],w[V[j]]=1;for(let j=$-1;j>=0;j--)de[ye++]=E.startVertex+U[j],w[U[j]]=1;(0,t.eh)(de);for(let j=0,Z=E.currentRings.length;j<Z;j++){const q=E.currentRings[j];if(de.length===q.length){if(e.SortedArray.areEqual(de,q))return!1}else if(de.length>q.length&&e.SortedArray.isSubset(de,q))return!1}return E.currentRings.push(e.SortedArray.ofSortedArray(de)),!0}function I(E,T,L){const{bonds:w,startVertex:Q,endVertex:G,isRingAtom:V,marked:U,queue:N,pred:k,depth:H}=E,{elements:$}=E.unit,{b:J,edgeProps:{flags:W},offset:te}=w;U[T]=L,H[T]=0,N[0]=T;let de=0,ye=1;for(;de<ye;){const j=N[de++],Z=H[j],q=Q+j,ee=te[q+1];for(let g=te[q];g<ee;g++){const _e=J[g];if(_e<Q||_e>=G||!r.I$.isCovalent(W[g]))continue;if(E.hasAltLoc){const Ae=E.altLoc.value($[_e]);if(Ae&&E.currentAltLoc!==Ae)continue}const xe=_e-Q;if(U[xe]===L){if(k[xe]!==j&&k[j]!==xe&&M(E,j,xe,V))return L+1;continue}const le=Math.min(H[xe],Z+1);le>5||(H[xe]=le,U[xe]=L,N[ye++]=xe,k[xe]=j)}}return L+1}function m(E){const T=E.length,L=new Int32Array(2*T);for(let V=0;V<L.length;V++)L[V]=-1;let w="",Q="",G=0;for(let V=1;V<L.length;V++){let U=L[V-G-1];for(;-1!==U&&(w=E[V%T],Q=E[(G+U+1)%T],w!==Q);)w<Q&&(G=V-U-1),U=L[U];-1===U?(w=E[V%T],Q=E[(G+U+1)%T],w!==Q?(w<Q&&(G=V),L[V-G]=-1):L[V-G]=U+1):L[V-G]=U+1}return G}function u(E,T){const L=E.length,w=[];let Q;for(Q=0;Q<L-1;Q++)w.push(E[(Q+T)%L]),w.push("-");return w.push(E[(Q+T)%L]),w.join("")}var S,E,s=n(2789),C=n(8199),h=n(4369);class a{get index(){return this._index||(this._index=function d(E,T){const L=new Map,w=new Map;for(let N=0,k=E.length;N<k;N++){const H=E[N];for(let $=0,J=H.length;$<J;$++){const W=H[$];L.has(W)?L.get(W).push(N):L.set(W,[N])}}for(let N=0,k=T.length;N<k;N++){const H=T[N],$=E[H];for(let J=0,W=$.length;J<W;J++){const te=$[J];w.has(te)?w.get(te).push(H):w.set(te,[H])}}const Q=new o.O.UniqueEdgeBuilder(E.length);for(let N=0,k=E.length;N<k;N++){const H=E[N];for(let $=0,J=H.length;$<J;$++){const te=L.get(H[$]);if(1!==te.length)for(let de=0,ye=te.length;de<ye;de++){const j=te[de];N>=j||Q.addEdge(N,j)}}}const G=o.O.connectedComponents(Q.getGraph()),V=G.componentIndex,U=[];for(let N=0;N<G.componentCount;N++)U[N]=[];for(let N=0,k=E.length;N<k;N++)U[V[N]].push(N);return{elementRingIndices:L,elementAromaticRingIndices:w,ringComponentIndex:V,ringComponents:U}}(this.all,this.aromaticRings)),this._index}get byFingerprint(){return this._byFingerprint||(this._byFingerprint=function D(E,T){const L=new Map;let w=0;for(let Q=0,G=T.length;Q<G;Q++){const U=S.fingerprint(E,T[Q]);L.has(U)?L.get(U).push(w):L.set(U,[w]),w++}return L}(this.unit,this.all)),this._byFingerprint}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings||(this._aromaticRings=function p(E,T){const L=[];for(let w=0,Q=T.length;w<Q;++w)S.isAromatic(E,T[w])&&L.push(w);return L}(this.unit,this.all)),this._aromaticRings}constructor(T,L){this.unit=L,this.all=T}}function R(E,T){const{elements:L}=E,w=E.model.atomicHierarchy.residueAtomSegments.index,Q=w[L[T[0]]];for(let G=1,V=T.length;G<V;G++)if(Q!==w[L[T[G]]])return-1;return Q}function f(E,T,L){const w=E.byFingerprint.get(T);if(w)for(let Q=0,G=w.length;Q<G;Q++){const V=w[Q],U=R(E.unit,E.all[V]);U>=0&&(L.has(U)?L.get(U).push(V):L.set(U,[V]))}}(function(E){function L(U){return function l(E){const T=E.length,L=new Array(T);for(let V=0;V<T;V++)L[V]=E[T-V-1];const w=m(E),Q=m(L);let G=!1;for(let V=0;V<T;V++){const U=E[(V+w)%T],N=L[(V+Q)%T];if(U!==N){G=U<N;break}}return G?u(E,w):u(L,Q)}(U)}E.fingerprint=function T(U,N){const{elements:k}=U,{type_symbol:H}=U.model.atomicHierarchy.atoms,$=[];for(let J=0,W=N.length;J<W;J++)$[$.length]=H.value(k[N[J]]);return L($)},E.elementFingerprint=L;const w=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]);E.isAromatic=function G(U,N){const{elements:k,bonds:{b:H,offset:$,edgeProps:{flags:J}}}=U,{type_symbol:W,label_comp_id:te}=U.model.atomicHierarchy.atoms;if("PRO"===te.value(U.elements[N[0]]))return!1;let de=0,ye=!1;for(let Z=0,q=N.length;Z<q;++Z){const Y=N[Z];!ye&&w.has(W.value(k[Y]))&&(ye=!0);for(let ee=$[Y],g=$[Y+1];ee<g;++ee)r.I$.is(16,J[ee])&&e.SortedArray.has(N,H[ee])&&(de+=1)}if(de===2*N.length)return!0;if(!ye||N.length<5||de>0)return!1;const j=C.c.calculateMomentsAxes((0,s.Dt)(U,N));return h.eB.magnitude(j.dirC)<.05},E.getAltId=function V(U,N){const{label_alt_id:k}=U.model.atomicHierarchy.atoms,{elements:H}=U;for(let $=0,J=N.length;$<J;++$){const te=k.value(H[N[$]]);if(te)return te}return""}})(S||(S={})),(E=a||(a={})).create=function T(w){const Q=function y(E){const T=function O(E){const T=e.hT.transientSegments(E.model.atomicHierarchy.residueAtomSegments,E.elements);let L=0;for(;T.hasNext;){const w=T.move();L=Math.max(L,w.end-w.start)}return L}(E),L=function c(E,T){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(T),marked:new Int32Array(T),queue:new Int32Array(T),pred:new Int32Array(T),depth:new Int32Array(T),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(T),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:E,bonds:E.bonds,altLoc:E.model.atomicHierarchy.atoms.label_alt_id}}(E,T),w=e.hT.transientSegments(E.model.atomicHierarchy.residueAtomSegments,E.elements);for(;w.hasNext;){const Q=w.move();_(L,Q.start,Q.end)}return L.rings}(w);return new E(Q,w)},E.byFingerprintAndResidue=function L(w,Q){const G=new Map;for(let V=0,U=Q.length;V<U;V++)f(w,Q[V],G);return G}},6871:(tn,Ue,n)=>{"use strict";n.d(Ue,{Jq:()=>c,jM:()=>i});var y,v,e=n(5384),o=n(4369),r=n(3543),t=n(1541),A=n(8361);function c(){return{result:y.create(),closeUnitsResult:e.Q7.create(),unitGroupResult:e.Q7.create()}}(v=y||(y={})).add=function O(M,I,l,m){M.indices[M.count]=l,M.units[M.count]=I,M.squaredDistances[M.count]=m,M.count++},v.create=function b(){return{count:0,indices:[],units:[],squaredDistances:[]}},v.copy=function _(M,I){for(let l=0;l<I.count;++l)M.indices[l]=I.indices[l],M.units[l]=I.units[l],M.squaredDistances[l]=I.squaredDistances[l];return M.count=I.count,M};class i{findUnitIndices(O,b,_,M){return this.unitLookup.find(O,b,_,M)}find(O,b,_,M,I){return this._find(O,b,_,M,I??this.findContext)}_find(O,b,_,M,I){e.Q7.reset(I.result);const{units:l}=this.structure,m=this.unitLookup.find(O,b,_,M,I.closeUnitsResult);if(0===m.count)return I.result;for(let u=0,d=m.count;u<d;u++){const s=l[m.indices[u]];o.eB.set(this.pivot,O,b,_),s.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,s.conformation.operator.inverse);const h=s.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],M,I.unitGroupResult);for(let a=0,S=h.count;a<S;a++)y.add(I.result,s,h.indices[a],h.squaredDistances[a])}return I.result}nearest(O,b,_,M=1,I){return this._nearest(O,b,_,M,I??this.findContext)}_nearest(O,b,_,M,I){const l=I.result,m=this.heap;e.Q7.reset(l),m.clear();const{units:u}=this.structure;let d=0;const s=this.unitLookup.nearest(O,b,_,u.length,a=>(d+=u[a].elements.length)>=M,I.closeUnitsResult);if(0===s.count)return l;let C=0,h=-Number.MAX_VALUE;for(let a=0,S=s.count;a<S&&!(C>=M&&h<s.squaredDistances[a]);a++){o.eB.set(this.pivot,O,b,_);const R=u[s.indices[a]];R.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,R.conformation.operator.inverse);const p=R.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],M,void 0,I.unitGroupResult);if(0!==p.count){C+=p.count,h=Math.max(h,p.squaredDistances[p.count-1]);for(let E=0,T=p.count;E<T;E++)m.insert(p.squaredDistances[E],{index:p.indices[E],unit:R})}}if(1===M){const a=m.findMinimum();if(a){const{key:S}=a,{unit:D,index:R}=a.value;y.add(l,D,R,S)}}else for(;!m.isEmpty()&&l.count<M;){const a=m.extractMinimum(),{key:S}=a,{unit:D,index:R}=a.value;y.add(l,D,R,S)}return l}findIntoBuilder(O,b,_,M,I){const{units:l}=this.structure,m=this.unitLookup.find(O,b,_,M);if(0!==m.count)for(let u=0,d=m.count;u<d;u++){const s=l[m.indices[u]];o.eB.set(this.pivot,O,b,_),s.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,s.conformation.operator.inverse);const h=s.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],M);if(0===h.count)continue;const a=s.elements;I.beginUnit(s.id);for(let S=0,D=h.count;S<D;S++)I.addElement(a[h.indices[S]]);I.commitUnit()}}findIntoBuilderIf(O,b,_,M,I,l){const{units:m}=this.structure,u=this.unitLookup.find(O,b,_,M);if(0===u.count)return;const d=t.i.Location.create(this.structure);for(let s=0,C=u.count;s<C;s++){const h=m[u.indices[s]];o.eB.set(this.pivot,O,b,_),h.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,h.conformation.operator.inverse);const S=h.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],M);if(0===S.count)continue;const D=h.elements;d.unit=h,I.beginUnit(h.id);for(let R=0,f=S.count;R<f;R++)d.element=D[S.indices[R]],l(d)&&I.addElement(d.element);I.commitUnit()}}findIntoBuilderWithRadius(O,b,_,M,I,l,m,u){const{units:d}=this.structure,s=this.unitLookup.find(O,b,_,l);if(0===s.count)return;const C=t.i.Location.create(this.structure),h=M+I+l;for(let a=0,S=s.count;a<S;a++){const D=d[s.indices[a]];o.eB.set(this.pivot,O,b,_),D.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,D.conformation.operator.inverse);const f=D.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],h);if(0===f.count)continue;const p=D.elements;C.unit=D,u.beginUnit(D.id);for(let E=0,T=f.count;E<T;E++){C.element=p[f.indices[E]];const L=m(C);Math.sqrt(f.squaredDistances[E])-M-L>l||u.addElement(p[f.indices[E]])}u.commitUnit()}}check(O,b,_,M){const{units:I}=this.structure,l=this.unitLookup.find(O,b,_,M);if(0===l.count)return!1;for(let m=0,u=l.count;m<u;m++){const d=I[l.indices[m]];if(o.eB.set(this.pivot,O,b,_),d.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,d.conformation.operator.inverse),d.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],M))return!0}return!1}get boundary(){return this.structure.boundary}constructor(O){this.structure=O,this.pivot=(0,o.eB)(),this.heap=new A.h,this.findContext=c();const{units:b,boundary:_}=O,M=b.length,I=new Float32Array(M),l=new Float32Array(M),m=new Float32Array(M),u=new Float32Array(M),d=(0,o.eB)();for(let C=0;C<M;C++){const h=b[C],a=h.boundary.sphere;o.eB.transformMat4(d,a.center,h.conformation.operator.matrix),I[C]=d[0],l[C]=d[1],m[C]=d[2],u[C]=a.radius}const s={x:I,y:l,z:m,radius:u,indices:r.CD.ofBounds(0,M)};this.unitLookup=(0,e.Eh)(s,_)}}},3346:(tn,Ue,n)=>{"use strict";n.d(Ue,{c:()=>o});var o,e=n(9909);(o||(o={})).create=function t(A,y,c,i){return{id:e.kk.create22(),label:A,basic:y,sourceData:i,bonds:c}}},7024:(tn,Ue,n)=>{"use strict";n.d(Ue,{P:()=>e});class e{getFrameAtIndex(r){return this.frames[r]}constructor(r){this.frames=r,this.frameCount=r.length,this.representative=r[0],this.duration=r.length}}},2789:(tn,Ue,n)=>{"use strict";n.d(Ue,{Dt:()=>v,HQ:()=>c,Ju:()=>t});var e=n(2434),o=n(4369);function t(O,b){switch(O.kind){case 0:return O.model.atomicHierarchy.derived.residue.moleculeType[O.residueIndex[b]];case 1:case 2:const _=function r(O,b){const M=O.model.sequence.byEntityKey[O.coarseElements.entityKey[b]].sequence,I=O.coarseElements.seq_id_begin.value(b);return M.compId.value(I-1)}(O,b),M=O.model.properties.chemicalComponentMap.get(_);if(M)return(0,e.RN)(M.type,_)}return 0}const y=new Set;function c(O,b){const _=e.Pt[O];if(void 0!==_){const M=_[b];if(void 0!==M)return M}return y}const i=o.eB.zero();function v(O,b){const _=O.conformation,M=new Float32Array(3*b.length),{elements:I}=O;for(let l=0,m=b.length;l<m;++l)_.position(I[b[l]],i),o.eB.toArray(i,M,3*l);return M}},6853:(tn,Ue,n)=>{"use strict";n.d(Ue,{f:()=>e.f,x:()=>o.x});var e=n(3162),o=n(5879)},5879:(tn,Ue,n)=>{"use strict";n.d(Ue,{x:()=>y});var y,e=n(5384),o=n(4369),r=n(6115);function A(c,i,v,O){let b=(O-v)/i;0===b&&(b=1);const _=new Int32Array(i);for(let M=0,I=c.length;M<I;M++){let l=Math.floor((c[M]-v)/b);l>=i?l=i-1:l<0&&(l=0),_[l]++}return{min:v,max:O,binWidth:b,counts:_}}!function(c){c.One={transform:{kind:"matrix",matrix:o.$I.identity()},cells:o.qY.create(o.qY.Space([1,1,1],[0,1,2]),o.qY.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};const i=o.$I.zero(),v=o.$I.zero();c.getGridToCartesianTransform=function O(l){if("matrix"===l.transform.kind)return o.$I.copy((0,o.$I)(),l.transform.matrix);if("spacegroup"===l.transform.kind){const{cells:{space:m}}=l,u=o.$I.fromScaling(i,o.eB.div(o.eB.zero(),e.DJ.size(o.eB.zero(),l.transform.fractionalBox),o.eB.ofArray(m.dimensions))),d=o.$I.fromTranslation(v,l.transform.fractionalBox.min);return o.$I.mul3(o.$I.zero(),l.transform.cell.fromFractional,d,u)}return o.$I.identity()},c.areEquivalent=function b(l,m){return l===m},c.isEmpty=function _(l){return 0===l.cells.data.length},c.getBoundingSphere=function M(l,m){m||(m=(0,e.f8)());const u=l.cells.space.dimensions,d=c.getGridToCartesianTransform(l);return e.f8.fromDimensionsAndTransform(m,u,d)},c.getHistogram=function I(l,m){let u=l._historams;return u||(u=l._historams={}),u[m]||(u[m]=function t(c,i,v){if(v)return A(c,i,v.min,v.max);{const[O,b]=(0,r.em)(c);return A(c,i,O,b)}}(l.cells.data,m,{min:l.stats.min,max:l.stats.max})),u[m]}}(y||(y={}))},3162:(tn,Ue,n)=>{"use strict";n.d(Ue,{f:()=>_});var _,e=n(5879),o=n(3543),r=n(5384),t=n(4369),A=n(7136),y=n(3420),c=n(2028),i=n(1692),v=n(8277),O=n(229),b=n(4625);!function(M){let l;M.is=function I(L){var w,Q,G,V;return(null===(V=null===(G=null===(Q=null===(w=L?.grid)||void 0===w?void 0:w.cells)||void 0===Q?void 0:Q.space)||void 0===G?void 0:G.dimensions)||void 0===V?void 0:V.length)&&L?.sourceData&&L?.customProperties&&L?._propertyData},function(L){function N($,J){return"absolute"===$.kind?$:{kind:"absolute",absoluteValue:L.calcAbsolute(J,$.relativeValue)}}L.areSame=function w($,J,W){return(0,c.T)(N($,W).absoluteValue,N(J,W).absoluteValue,W.sigma/100)},L.absolute=function Q($){return{kind:"absolute",absoluteValue:$}},L.relative=function G($){return{kind:"relative",relativeValue:$}},L.calcAbsolute=function V($,J){return J*$.sigma+$.mean},L.calcRelative=function U($,J){return 0===$.sigma?0:(J-$.mean)/$.sigma},L.toAbsolute=N,L.toRelative=function k($,J){return"relative"===$.kind?$:{kind:"relative",relativeValue:L.calcRelative(J,$.absoluteValue)}},L.toString=function H($){return"relative"===$.kind?`${$.relativeValue.toFixed(2)} \u03c3`:`${$.absoluteValue.toPrecision(4)}`}}(l=M.IsoValue||(M.IsoValue={})),M.adjustedIsoValue=function m(L,w,Q){if("relative"===Q)return l.relative(w);const G=l.absolute(w);if(b.T.is(L.sourceData)){const V={min:L.sourceData.data.volume_data_3d_info.min_source.value(0),max:L.sourceData.data.volume_data_3d_info.max_source.value(0),mean:L.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:L.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return M.IsoValue.toRelative(G,V)}return G};const u={min:-1,max:1,mean:0,sigma:.1};function d(L,w){const Q=w||u,{min:G,max:V,mean:U,sigma:N}=Q,k=(G-U)/N,H=(V-U)/N;let $=L;return"absolute"===L.kind?L.absoluteValue<G?$=M.IsoValue.absolute(G):L.absoluteValue>V&&($=M.IsoValue.absolute(V)):L.relativeValue<k?$=M.IsoValue.relative(k):L.relativeValue>H&&($=M.IsoValue.relative(H)),v.t.Conditioned($,{absolute:v.t.Converted(J=>M.IsoValue.toAbsolute(J,e.x.One.stats).absoluteValue,J=>M.IsoValue.absolute(J),v.t.Numeric(U,{min:G,max:V,step:(0,O.QX)(N/100,2)},{immediateUpdate:!0})),relative:v.t.Converted(J=>M.IsoValue.toRelative(J,e.x.One.stats).relativeValue,J=>M.IsoValue.relative(J),v.t.Numeric(Math.min(1,H),{min:k,max:H,step:(0,O.QX)(Math.round((V-G)/N)/100,2)},{immediateUpdate:!0}))},J=>"absolute"===J.kind?"absolute":"relative",(J,W)=>"absolute"===W?M.IsoValue.toAbsolute(J,Q):M.IsoValue.toRelative(J,Q),{isEssential:!0})}let p,E,T;M.createIsoValueParam=d,M.IsoValueParam=d(M.IsoValue.relative(2)),M.One={label:"",grid:e.x.One,sourceData:{kind:"",name:"",data:{}},customProperties:new i.v,_propertyData:Object.create(null)},M.areEquivalent=function s(L,w){return e.x.areEquivalent(L.grid,w.grid)},M.isEmpty=function C(L){return e.x.isEmpty(L.grid)},M.isOrbitals=function h(L){return!!y.f.is(L.sourceData)&&L.sourceData.data.header.orbitals},M.Loci=function a(L){return{kind:"volume-loci",volume:L}},M.isLoci=function S(L){return!!L&&"volume-loci"===L.kind},M.areLociEqual=function D(L,w){return L.volume===w.volume},M.isLociEmpty=function R(L){return e.x.isEmpty(L.volume.grid)},M.getBoundingSphere=function f(L,w){return e.x.getBoundingSphere(L.grid,w)},function(L){L.Loci=function w(k,H){return{kind:"isosurface-loci",volume:k,isoValue:H}},L.isLoci=function Q(k){return!!k&&"isosurface-loci"===k.kind},L.areLociEqual=function G(k,H){return k.volume===H.volume&&M.IsoValue.areSame(k.isoValue,H.isoValue,k.volume.grid.stats)},L.isLociEmpty=function V(k){return 0===k.volume.grid.cells.data.length};const U=(0,r.DJ)();L.getBoundingSphere=function N(k,H,$){const J=M.IsoValue.toAbsolute(H,k.grid.stats).absoluteValue,W=J<0,te=[0,0,0],de=k.grid.cells.space.getCoords,ye=k.grid.cells.data,[j,Z,q]=k.grid.cells.space.dimensions;let Y=j-1,ee=Z-1,g=q-1,_e=0,xe=0,le=0;for(let Be=0,Ce=ye.length;Be<Ce;++Be)(W&&ye[Be]<=J||!W&&ye[Be]>=J)&&(de(Be,te),te[0]<Y&&(Y=te[0]),te[1]<ee&&(ee=te[1]),te[2]<g&&(g=te[2]),te[0]>_e&&(_e=te[0]),te[1]>xe&&(xe=te[1]),te[2]>le&&(le=te[2]));t.eB.set(U.min,Y-1,ee-1,g-1),t.eB.set(U.max,_e+1,xe+1,le+1);const Ae=e.x.getGridToCartesianTransform(k.grid);return r.DJ.transform(U,U,Ae),r.f8.fromBox3D($||(0,r.f8)(),U)}}(p=M.Isosurface||(M.Isosurface={})),function(L){L.Loci=function w(H,$){return{kind:"cell-loci",volume:H,indices:$}},L.isLoci=function Q(H){return!!H&&"cell-loci"===H.kind},L.areLociEqual=function G(H,$){return H.volume===$.volume&&o.CD.areEqual(H.indices,$.indices)},L.isLociEmpty=function V(H){return 0===o.CD.size(H.indices)};const U=new A.Z("98"),N=(0,t.eB)();L.getBoundingSphere=function k(H,$,J){U.reset();const W=e.x.getGridToCartesianTransform(H.grid),{getCoords:te}=H.grid.cells.space;for(let ye=0,j=o.CD.size($);ye<j;ye++)te(o.CD.getAt($,ye),N),t.eB.transformMat4(N,N,W),U.includePosition(N);U.finishedIncludeStep();for(let ye=0,j=o.CD.size($);ye<j;ye++)te(o.CD.getAt($,ye),N),t.eB.transformMat4(N,N,W),U.radiusPosition(N);const de=U.getSphere(J);return r.f8.expand(de,de,10*t.$I.getMaxScaleOnAxis(W))}}(E=M.Cell||(M.Cell={})),function(L){L.Loci=function w($,J){return{kind:"segment-loci",volume:$,segments:o.SortedArray.ofUnsortedArray(J)}},L.isLoci=function Q($){return!!$&&"segment-loci"===$.kind},L.areLociEqual=function G($,J){return $.volume===J.volume&&o.SortedArray.areEqual($.segments,J.segments)},L.isLociEmpty=function V($){return 0===$.volume.grid.cells.data.length||0===$.segments.length};const U=(0,r.DJ)();L.getBoundingSphere=function N($,J,W){const te=M.Segmentation.get($);if(te){r.DJ.setEmpty(U);for(let ye=0,j=J.length;ye<j;++ye){const Z=te.bounds[J[ye]];r.DJ.add(U,Z.min),r.DJ.add(U,Z.max)}const de=e.x.getGridToCartesianTransform($.grid);return r.DJ.transform(U,U,de),r.f8.fromBox3D(W||(0,r.f8)(),U)}return M.getBoundingSphere($,W)},L.Location=function k($,J){return{kind:"segment-location",volume:$,segment:J}},L.isLocation=function H($){return!!$&&"segment-location"===$.kind}}(T=M.Segment||(M.Segment={})),M.PickingGranularity={set(L,w){L._propertyData.__picking_granularity__=w},get(L){var w;return null!==(w=L._propertyData.__picking_granularity__)&&void 0!==w?w:"voxel"}},M.Segmentation={set(L,w){L._propertyData.__segmentation__=w},get:L=>L._propertyData.__segmentation__}}(_||(_={}))},6511:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{DownloadFile:()=>_,OpenFiles:()=>b});var e=n(467),o=n(1832),r=n(4824),t=n(1861),A=n(675),y=n(8277),c=n(6985),i=n(381);function v(M,I,l,m){return O.apply(this,arguments)}function O(){return(O=(0,e.A)(function*(M,I,l,m){var u,d,s,C;const h=(0,A.o)(null!==(d=null===(u=M.file)||void 0===u?void 0:u.name)&&void 0!==d?d:""),a=I.dataFormats.binaryExtensions.has(h.ext),{data:S}=yield I.builders.data.readFile({file:M,isBinary:a}),D="auto"===l?I.dataFormats.auto(h,null===(s=S.cell)||void 0===s?void 0:s.obj):I.dataFormats.get(l);if(!D)return I.log.warn(`OpenFiles: could not find data provider for '${h.ext}'`),void(yield I.state.data.build().delete(S).commit());const R=yield D.parse(I,S);m&&(yield null===(C=D.visuals)||void 0===C?void 0:C.call(D,I,R))})).apply(this,arguments)}const b=o.KW.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:i.O.Root,params:(M,I)=>{const{extensions:l,options:m}=I.dataFormats;return{files:y.t.FileList({accept:Array.from(l.values()).map(u=>`.${u}`).join(",")+",.gz,.zip",multiple:!0}),format:y.t.MappedStatic("auto",{auto:y.t.EmptyGroup(),specific:y.t.Select(m[0][0],m)}),visuals:y.t.Boolean(!0,{description:"Add default visuals"})}}})(({params:M,state:I},l)=>r.YZ.create("Open Files",function(){var m=(0,e.A)(function*(u){l.behaviors.layout.leftPanelTabName.next("data"),yield I.transaction((0,e.A)(function*(){if(null!==M.files)for(const d of M.files)try{if(d.file&&d.name.toLowerCase().endsWith(".zip")){const s=yield(0,c.$1)(u,yield d.file.arrayBuffer());for(const[C,h]of Object.entries(s)){if(!(h instanceof Uint8Array)||0===h.length)continue;const a=t.V.File(new File([h],C));yield v(a,l,"auto",M.visuals)}}else{const s="auto"===M.format.name?"auto":M.format.params;yield v(d,l,s,M.visuals)}}catch(s){console.error(s),l.log.error(`Error opening file '${d.name}'`)}else l.log.error("No file(s) selected")})).runInContext(u)});return function(u){return m.apply(this,arguments)}}())),_=o.KW.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:i.O.Root,params:(M,I)=>{const l=[...I.dataFormats.options,["zip","Zip"],["gzip","Gzip"]];return{url:y.t.Url(""),format:y.t.Select(l[0][0],l),isBinary:y.t.Boolean(!1),visuals:y.t.Boolean(!0,{description:"Add default visuals"})}}})(({params:M,state:I},l)=>r.YZ.create("Open Files",function(){var m=(0,e.A)(function*(u){l.behaviors.layout.leftPanelTabName.next("data"),yield I.transaction((0,e.A)(function*(){var d,s,C;try{if("zip"===M.format||"gzip"===M.format){const h=yield l.builders.data.download({url:M.url,isBinary:!0});if("zip"===M.format){const a=yield(0,c.$1)(u,(null===(d=h.obj)||void 0===d?void 0:d.data).buffer);for(const[S,D]of Object.entries(a)){if(!(D instanceof Uint8Array)||0===D.length)continue;const R=t.V.File(new File([D],S));yield v(R,l,"auto",M.visuals)}}else{const a=t.V.getUrl(M.url),S=(0,A.o)(a).name;yield v(t.V.File(new File([null===(s=h.obj)||void 0===s?void 0:s.data],S)),l,"auto",M.visuals)}}else{const h=l.dataFormats.get(M.format);if(!h)return void l.log.warn(`DownloadFile: could not find data provider for '${M.format}'`);const a=yield l.builders.data.download({url:M.url,isBinary:M.isBinary}),S=yield h.parse(l,a);M.visuals&&(yield null===(C=h.visuals)||void 0===C?void 0:C.call(h,l,S))}}catch(h){console.error(h),l.log.error(`Error downloading '${"string"==typeof M.url?M.url:M.url.url}'`)}})).runInContext(u)});return function(u){return m.apply(this,arguments)}}()))},1732:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{AddTrajectory:()=>w,DownloadStructure:()=>s,EnableModelCustomProps:()=>T,EnableStructureCustomProps:()=>L,LoadTrajectory:()=>Q,PdbDownloadProvider:()=>d,UpdateTrajectory:()=>E});var e=n(467),o=n(1832),r=n(4824),t=n(8277),A=n(9880),y=n(5953),c=n(1295),i=n(381),v=n(1073),O=n(1855),b=n(1861),_=n(237),M=n(675),I=n(1372),l=n(2945),m=n(1169);const d={rcsb:t.t.Group({encoding:t.t.Select("bcif",t.t.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:t.t.Group({variant:t.t.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:t.t.EmptyGroup({label:"PDBj"})},s=o.KW.build({from:i.O.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:(G,V)=>{const U=(G=>{const V=G.config.get(_.AB.Structure.DefaultRepresentationPreset)||A.Bj.auto.id;return t.t.Group({type:c.z.getParams(void 0,"auto").type,representation:t.t.Select(V,G.builders.structure.representation.getPresets().map(U=>[U.id,U.display.name,U.display.group]),{description:"Which representation preset to use."}),representationParams:t.t.Group(A.n9.CommonParams,{isHidden:!0}),asTrajectory:t.t.Optional(t.t.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})})(V),N=V.config.get(_.AB.Download.DefaultPdbProvider)||"pdbe";return{source:t.t.MappedStatic("pdb",{pdb:t.t.Group({provider:t.t.Group({id:t.t.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:t.t.MappedStatic(N,d)},{pivot:"id"}),options:U},{isFlat:!0,label:"PDB"}),"pdb-dev":t.t.Group({provider:t.t.Group({id:t.t.Text("PDBDEV_00000001",{label:"PDB-Dev Id(s)",description:"One or more comma/space separated ids."}),encoding:t.t.Select("bcif",t.t.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:U},{isFlat:!0,label:"PDB-Dev"}),swissmodel:t.t.Group({id:t.t.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:U},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:t.t.Group({id:t.t.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:U},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:t.t.Group({id:t.t.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:U},{isFlat:!0,label:"Model Archive"}),pubchem:t.t.Group({id:t.t.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:U},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:t.t.Group({url:t.t.Url(""),format:t.t.Select("mmcif",t.t.arrayToOptions(y.HQ.map(k=>k[0]),k=>k)),isBinary:t.t.Boolean(!1),label:t.t.Optional(t.t.Text("")),options:U},{isFlat:!0,label:"URL"})})}}})(({params:G,state:V},U)=>r.YZ.create("Download Structure",function(){var N=(0,e.A)(function*(k){U.behaviors.layout.leftPanelTabName.next("data");const H=G.source;let $,J=!1,W="mmcif";switch(H.name){case"url":$=[{url:H.params.url,isBinary:H.params.isBinary,label:H.params.label||void 0}],W=H.params.format;break;case"pdb":$=yield"pdbe"===H.params.provider.server.name?function a(G){return S.apply(this,arguments)}(H):"pdbj"===H.params.provider.server.name?function D(G){return R.apply(this,arguments)}(H):"rcsb"===H.params.provider.server.name?function f(G){return p.apply(this,arguments)}(H):(0,I.dr)(H),J=!!H.params.options.asTrajectory;break;case"pdb-dev":$=yield C(H.params.provider.id,j=>{const Z=j.toUpperCase().startsWith("PDBDEV_")?j:`PDBDEV_${j.padStart(8,"0")}`;return"bcif"===H.params.provider.encoding?`https://pdb-dev.wwpdb.org/bcif/${Z.toUpperCase()}.bcif`:`https://pdb-dev.wwpdb.org/cif/${Z.toUpperCase()}.cif`},j=>j.toUpperCase().startsWith("PDBDEV_")?j:`PDBDEV_${j.padStart(8,"0")}`,"bcif"===H.params.provider.encoding),J=!!H.params.options.asTrajectory;break;case"swissmodel":$=yield C(H.params.id,j=>`https://swissmodel.expasy.org/repository/uniprot/${j.toUpperCase()}.pdb`,j=>`SWISS-MODEL: ${j}`,!1),J=!!H.params.options.asTrajectory,W="pdb";break;case"alphafolddb":$=yield C(H.params.id,function(){var j=(0,e.A)(function*(Z){const q=`https://www.alphafold.ebi.ac.uk/api/prediction/${Z.toUpperCase()}`,Y=yield U.runTask(U.fetch({url:q,type:"json"}));if(Array.isArray(Y)&&Y.length>0)return Y[0].cifUrl;throw new Error(`No AlphaFold DB entry for '${Z}'`)});return function(Z){return j.apply(this,arguments)}}(),j=>`AlphaFold DB: ${j}`,!1),J=!!H.params.options.asTrajectory,W="mmcif";break;case"modelarchive":$=yield C(H.params.id,j=>`https://www.modelarchive.org/doi/10.5452/${j.toLowerCase()}.cif`,j=>`Model Archive: ${j}`,!1),J=!!H.params.options.asTrajectory,W="mmcif";break;case"pubchem":$=yield C(H.params.id,j=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${j.trim()}/record/SDF/?record_type=3d`,j=>`PubChem: ${j}`,!1),J=!!H.params.options.asTrajectory,W="mol";break;default:(0,I.dr)(H)}const te=G.source.params.options.representation||U.config.get(_.AB.Structure.DefaultRepresentationPreset)||A.Bj.auto.id,de=te!==A.Bj.empty.id,ye="auto"===H.params.options.type.name?void 0:H.params.options.type;yield V.transaction((0,e.A)(function*(){if($.length>0&&J){const j=yield U.builders.data.downloadBlob({sources:$.map((q,Y)=>({id:""+Y,url:q.url,isBinary:q.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),Z=yield U.builders.structure.parseTrajectory(j,{formats:$.map((q,Y)=>({id:""+Y,format:"cif"}))});yield U.builders.structure.hierarchy.applyPreset(Z,"default",{structure:ye,showUnitcell:de,representationPreset:te,representationPresetParams:G.source.params.options.representationParams})}else for(const j of $){const Z=yield U.builders.data.download(j,{state:{isGhost:!0}}),q=U.dataFormats.get(W);if(!q)throw new Error("unknown file format");const Y=yield U.builders.structure.parseTrajectory(Z,q);yield U.builders.structure.hierarchy.applyPreset(Y,"default",{structure:ye,showUnitcell:de,representationPreset:te,representationPresetParams:G.source.params.options.representationParams})}})).runInContext(k)});return function(k){return N.apply(this,arguments)}}()));function C(G,V,U,N){return h.apply(this,arguments)}function h(){return(h=(0,e.A)(function*(G,V,U,N){const k=G.split(/[,\s]/).map($=>$.trim()).filter($=>!!$&&($.length>=4||/^[1-9][0-9]*$/.test($))),H=[];for(const $ of k)H.push({url:b.V.Url(yield V($)),isBinary:N,label:U($)});return H})).apply(this,arguments)}function S(){return(S=(0,e.A)(function*(G){if("pdb"!==G.name||"pdbe"!==G.params.provider.server.name)throw new Error("expected pdbe");return"updated"===G.params.provider.server.params.variant?C(G.params.provider.id,V=>`https://www.ebi.ac.uk/pdbe/static/entry/${V.toLowerCase()}_updated.cif`,V=>`PDBe: ${V} (updated cif)`,!1):"updated-bcif"===G.params.provider.server.params.variant?C(G.params.provider.id,V=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${V.toLowerCase()}.bcif`,V=>`PDBe: ${V} (updated cif)`,!0):C(G.params.provider.id,V=>`https://www.ebi.ac.uk/pdbe/static/entry/${V.toLowerCase()}.cif`,V=>`PDBe: ${V} (cif)`,!1)})).apply(this,arguments)}function R(){return(R=(0,e.A)(function*(G){if("pdb"!==G.name||"pdbj"!==G.params.provider.server.name)throw new Error("expected pdbj");return C(G.params.provider.id,V=>`https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${V.toLowerCase().substring(1,3)}/${V.toLowerCase()}.cif`,V=>`PDBj: ${V} (cif)`,!1)})).apply(this,arguments)}function p(){return(p=(0,e.A)(function*(G){if("pdb"!==G.name||"rcsb"!==G.params.provider.server.name)throw new Error("expected rcsb");return"cif"===G.params.provider.server.params.encoding?C(G.params.provider.id,V=>`https://files.rcsb.org/download/${V.toUpperCase()}.cif`,V=>`RCSB PDB: ${V} (cif)`,!1):C(G.params.provider.id,V=>`https://models.rcsb.org/${V.toUpperCase()}.bcif`,V=>`RCSB PDB: ${V} (bcif)`,!0)})).apply(this,arguments)}const E=o.KW.build({display:{name:"Update Trajectory"},params:{action:t.t.Select("advance",t.t.arrayToOptions(["advance","reset"])),by:t.t.Optional(t.t.Numeric(1,{min:-1,max:1,step:1}))}})(({params:G,state:V})=>{const U=V.selectQ(k=>k.ofTransformer(v.f.Model.ModelFromTrajectory)),N=V.build();if("reset"===G.action)for(const k of U)N.to(k).update({modelIndex:0});else for(const k of U){const H=o.QX.findAncestorOfType(V.tree,V.cells,k.transform.ref,i.O.Molecule.Trajectory);if(!H||!H.obj)continue;const $=H.obj;N.to(k).update(J=>{let W=(J.modelIndex+G.by)%$.data.frameCount;return W<0&&(W+=$.data.frameCount),{modelIndex:W}})}return V.updateTree(N)}),T=o.KW.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:i.O.Molecule.Model,params:(G,V)=>V.customModelProperties.getParams(G?.data),isApplicable:(G,V,U)=>V.transformer!==O.CustomModelProperties})(({ref:G,params:V},U)=>U.builders.structure.insertModelProperties(G,V)),L=o.KW.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:i.O.Molecule.Structure,params:(G,V)=>V.customStructureProperties.getParams(G?.data),isApplicable:(G,V,U)=>V.transformer!==O.CustomStructureProperties})(({ref:G,params:V},U)=>U.builders.structure.insertStructureProperties(G,V)),w=o.KW.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:i.O.Root,params(G,V){const U=V.state.data,k=[...U.selectQ(J=>J.rootsOfType(i.O.Molecule.Model)),...U.selectQ(J=>J.rootsOfType(i.O.Molecule.Topology))].map(J=>[J.transform.ref,J.obj.label]),$=U.selectQ(J=>J.rootsOfType(i.O.Molecule.Coordinates)).map(J=>[J.transform.ref,J.obj.label]);return{model:t.t.Select(k.length?k[0][0]:"",k),coordinates:t.t.Select($.length?$[0][0]:"",$)}}})(({params:G,state:V},U)=>r.YZ.create("Add Trajectory",N=>V.transaction((0,e.A)(function*(){const k=[G.model,G.coordinates],H=V.build().toRoot().apply(O.TrajectoryFromModelAndCoordinates,{modelRef:G.model,coordinatesRef:G.coordinates},{dependsOn:k}).apply(v.f.Model.ModelFromTrajectory,{modelIndex:0});yield V.updateTree(H).runInContext(N);const $=yield U.builders.structure.createStructure(H.selector);yield U.builders.structure.representation.applyPreset($,"auto")})).runInContext(N))),Q=o.KW.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:i.O.Root,params(G,V){const{options:U}=V.dataFormats,N=U.filter(J=>J[2]===y.RB||J[2]===l.nE),k=U.filter(J=>J[2]===m.jM),H=[],$=[];for(const{provider:J}of V.dataFormats.list)J.category===y.RB||J.category===l.nE?(J.binaryExtensions&&H.push(...J.binaryExtensions),J.stringExtensions&&H.push(...J.stringExtensions)):J.category===m.jM&&(J.binaryExtensions&&$.push(...J.binaryExtensions),J.stringExtensions&&$.push(...J.stringExtensions));return{source:t.t.MappedStatic("file",{url:t.t.Group({model:t.t.Group({url:t.t.Url(""),format:t.t.Select(N[0][0],N),isBinary:t.t.Boolean(!1)},{isExpanded:!0}),coordinates:t.t.Group({url:t.t.Url(""),format:t.t.Select(k[0][0],k)},{isExpanded:!0})},{isFlat:!0}),file:t.t.Group({model:t.t.File({accept:H.map(J=>`.${J}`).join(","),label:"Model"}),coordinates:t.t.File({accept:$.map(J=>`.${J}`).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(({params:G,state:V},U)=>r.YZ.create("Load Trajectory",N=>V.transaction((0,e.A)(function*(){const k=G.source;if("file"===k.name&&(null===k.params.model||null===k.params.coordinates))return void U.log.error("No file(s) selected");if(!("url"!==k.name||k.params.model&&k.params.coordinates))return void U.log.error("No URL(s) given");const H=function(){var J=(0,e.A)(function*(W,te,de){const ye=yield U.builders.data.download({url:W,isBinary:de}),j=U.dataFormats.get(te);if(j)return j.parse(U,ye);U.log.warn(`LoadTrajectory: could not find data provider for '${te}'`)});return function(te,de,ye){return J.apply(this,arguments)}}(),$=function(){var J=(0,e.A)(function*(W){var te,de,ye;if(!W)throw new Error("No file selected");const j=(0,M.o)(null!==(de=null===(te=W.file)||void 0===te?void 0:te.name)&&void 0!==de?de:""),Z=U.dataFormats.binaryExtensions.has(j.ext),{data:q}=yield U.builders.data.readFile({file:W,isBinary:Z}),Y=U.dataFormats.auto(j,null===(ye=q.cell)||void 0===ye?void 0:ye.obj);return Y?Y.parse(U,q):(U.log.warn(`LoadTrajectory: could not find data provider for '${j.ext}'`),void(yield U.state.data.build().delete(q).commit()))});return function(te){return J.apply(this,arguments)}}();try{const J="url"===k.name?yield H(k.params.model.url,k.params.model.format,k.params.model.isBinary):yield $(k.params.model);let W;W="trajectory"in J?yield V.build().to(J.trajectory).apply(O.ModelFromTrajectory,{modelIndex:0}).commit():J.topology;const te="url"===k.name?yield H(k.params.coordinates.url,k.params.coordinates.format,!0):yield $(k.params.coordinates),de=[W.ref,te.ref],ye=V.build().toRoot().apply(O.TrajectoryFromModelAndCoordinates,{modelRef:W.ref,coordinatesRef:te.ref},{dependsOn:de}).apply(v.f.Model.ModelFromTrajectory,{modelIndex:0});yield V.updateTree(ye).runInContext(N);const j=yield U.builders.structure.createStructure(ye.selector);yield U.builders.structure.representation.applyPreset(j,"auto")}catch(J){console.error(J),U.log.error("Error loading trajectory")}})).runInContext(N)))},9880:(tn,Ue,n)=>{"use strict";n.d(Ue,{Bj:()=>Q,n9:()=>m});var e=n(467),o=n(8277),r=n(5019),t=n(9136),A=n(1832),y=n(9096),c=n(237),i=n(445),v=n(1893),O=n(8742),b=n(8103),_=n(8334),M=n(8737),I=n(1372),l=n(2086);function m(G){return G}!function(G){function V(H){return"chain-id"===H?{name:H,params:O.oy.defaultValues}:"operator-name"===H?{name:H,params:b.PO.defaultValues}:{name:H,params:{}}}G.CommonParams={ignoreHydrogens:o.t.Optional(o.t.Boolean(!1)),ignoreHydrogensVariant:o.t.Optional(o.t.Select("all",o.t.arrayToOptions(["all","non-polar"]))),ignoreLight:o.t.Optional(o.t.Boolean(!1)),quality:o.t.Optional(o.t.Select("auto",r.sF)),theme:o.t.Optional(o.t.Group({globalName:o.t.Optional(o.t.Text("")),globalColorParams:o.t.Optional(o.t.Value({},{isHidden:!0})),carbonColor:o.t.Optional(o.t.Select("chain-id",o.t.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:o.t.Optional(o.t.Text("")),symmetryColorParams:o.t.Optional(o.t.Value({},{isHidden:!0})),focus:o.t.Optional(o.t.Group({name:o.t.Optional(o.t.Text("")),params:o.t.Optional(o.t.Value({}))}))}))},G.reprBuilder=function N(H,$,J){var W,te,de,ye,j,Z,q,Y,ee,g,_e,xe,le,Ae;const Be=H.state.data.build(),Ce=H.builders.structure.representation,Re=H.managers.structure.component.state.options.hydrogens,ke={quality:H.managers.structure.component.state.options.visualQuality,ignoreHydrogens:"all"!==Re,ignoreHydrogensVariant:"only-polar"===Re?"non-polar":"all",ignoreLight:H.managers.structure.component.state.options.ignoreLight};$.quality&&"auto"!==$.quality&&(ke.quality=$.quality),void 0!==$.ignoreHydrogens&&(ke.ignoreHydrogens=!!$.ignoreHydrogens),void 0!==$.ignoreHydrogensVariant&&(ke.ignoreHydrogensVariant=$.ignoreHydrogensVariant),void 0!==$.ignoreLight&&(ke.ignoreLight=!!$.ignoreLight);const we=null!==(W=$.theme)&&void 0!==W&&W.globalName?null===(te=$.theme)||void 0===te?void 0:te.globalName:void 0,Oe=void 0!==(null===(de=$.theme)||void 0===de?void 0:de.carbonColor)?{carbonColor:V(null===(ye=$.theme)||void 0===ye?void 0:ye.carbonColor),...null===(j=$.theme)||void 0===j?void 0:j.globalColorParams}:{...null===(Z=$.theme)||void 0===Z?void 0:Z.globalColorParams},Se=J&&null!==(q=$.theme)&&void 0!==q&&q.symmetryColor&&function U(H){return H.units.some($=>!$.conformation.operator.assembly&&$.conformation.operator.spgrOp>=0)}(J)?null===(Y=$.theme)||void 0===Y?void 0:Y.symmetryColor:we;return{update:Be,builder:Ce,color:we,symmetryColor:Se,symmetryColorParams:null!==(ee=$.theme)&&void 0!==ee&&ee.symmetryColorParams?{...null===(g=$.theme)||void 0===g?void 0:g.globalColorParams,...null===(_e=$.theme)||void 0===_e?void 0:_e.symmetryColorParams}:{...null===(xe=$.theme)||void 0===xe?void 0:xe.globalColorParams},globalColorParams:null!==(le=$.theme)&&void 0!==le&&le.globalColorParams?{...null===(Ae=$.theme)||void 0===Ae?void 0:Ae.globalColorParams}:void 0,typeParams:ke,ballAndStickColor:Oe}},G.updateFocusRepr=function k(H,$,J,W){if(H.state.hasBehavior(i.b))return H.state.updateBehavior(i.b,te=>{const de=(0,v.IZ)(H,$,"ball-and-stick",J||"element-symbol",W);te.surroundingsParams.colorTheme=de,te.targetParams.colorTheme=de})}}(m||(m={}));const u=m.CommonParams,d=m.reprBuilder,s=m.updateFocusRepr,C=m({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:()=>u,apply(G,V,U){var N,k;const H=null===(k=null===(N=A.so.resolveAndCheck(U.state.data,G))||void 0===N?void 0:N.obj)||void 0===k?void 0:k.data;if(!H)return{};const $=U.config.get(c.AB.Structure.SizeThresholds)||t.oE.DefaultSizeThresholds,J=t.oE.getSize(H,$),W=H.polymerResidueCount/H.polymerGapCount;switch(J){case t.oE.Size.Gigantic:case t.oE.Size.Huge:return R.apply(G,V,U);case t.oE.Size.Large:return f.apply(G,V,U);case t.oE.Size.Medium:if(W>3)return S.apply(G,V,U);case t.oE.Size.Small:return p.apply(G,{...V,showCarbohydrateSymbol:!0},U);default:(0,I.dr)(J)}}}),h=m({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:(G,V,U)=>(0,e.A)(function*(){return{}})()}),a="Basic",S=m({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:a,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:()=>u,apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$,J,W,te,de,ye,j;const Z=A.so.resolveAndCheck(U.state.data,G);if(!Z)return{};const q={polymer:yield L(U,Z,"polymer"),ligand:yield L(U,Z,"ligand"),nonStandard:yield L(U,Z,"non-standard"),branched:yield L(U,Z,"branched",{label:"Carbohydrate"}),water:yield L(U,Z,"water"),ion:yield L(U,Z,"ion"),lipid:yield L(U,Z,"lipid"),coarse:yield L(U,Z,"coarse")},Y=Z.obj.data,ee={sizeFactor:Y.isCoarseGrained?.8:.2},g=((null===(H=null===(k=null===(N=q.water)||void 0===N?void 0:N.obj)||void 0===k?void 0:k.data)||void 0===H?void 0:H.elementCount)||0)>5e4?"line":"ball-and-stick",_e=((null===(W=null===(J=null===($=q.lipid)||void 0===$?void 0:$.obj)||void 0===J?void 0:J.data)||void 0===W?void 0:W.elementCount)||0)>2e4?"line":"ball-and-stick",{update:xe,builder:le,typeParams:Ae,color:Be,symmetryColor:Ce,symmetryColorParams:Re,globalColorParams:ke,ballAndStickColor:we}=d(U,V,Y),Oe={polymer:le.buildRepresentation(xe,q.polymer,{type:"cartoon",typeParams:{...Ae,...ee},color:Ce,colorParams:Re},{tag:"polymer"}),ligand:le.buildRepresentation(xe,q.ligand,{type:"ball-and-stick",typeParams:Ae,color:Be,colorParams:we},{tag:"ligand"}),nonStandard:le.buildRepresentation(xe,q.nonStandard,{type:"ball-and-stick",typeParams:Ae,color:Be,colorParams:we},{tag:"non-standard"}),branchedBallAndStick:le.buildRepresentation(xe,q.branched,{type:"ball-and-stick",typeParams:{...Ae,alpha:.3},color:Be,colorParams:we},{tag:"branched-ball-and-stick"}),branchedSnfg3d:le.buildRepresentation(xe,q.branched,{type:"carbohydrate",typeParams:Ae,color:Be,colorParams:ke},{tag:"branched-snfg-3d"}),water:le.buildRepresentation(xe,q.water,{type:g,typeParams:{...Ae,alpha:.6,visuals:"line"===g?["intra-bond","element-point"]:void 0},color:Be,colorParams:{carbonColor:{name:"element-symbol",params:{}},...ke}},{tag:"water"}),ion:le.buildRepresentation(xe,q.ion,{type:"ball-and-stick",typeParams:Ae,color:Be,colorParams:{carbonColor:{name:"element-symbol",params:{}},...ke}},{tag:"ion"}),lipid:le.buildRepresentation(xe,q.lipid,{type:_e,typeParams:{...Ae,alpha:.6,visuals:"line"===_e?["intra-bond"]:void 0},color:Be,colorParams:{carbonColor:{name:"element-symbol",params:{}},...ke}},{tag:"lipid"}),coarse:le.buildRepresentation(xe,q.coarse,{type:"spacefill",typeParams:Ae,color:Be||"chain-id",colorParams:ke},{tag:"coarse"})};return yield xe.commit({revertOnError:!1}),yield s(U,Y,null===(de=null===(te=V.theme)||void 0===te?void 0:te.focus)||void 0===de?void 0:de.name,null===(j=null===(ye=V.theme)||void 0===ye?void 0:ye.focus)||void 0===j?void 0:j.params),{components:q,representations:Oe}})()}),D=m({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:a,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:()=>u,apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$;const J=A.so.resolveAndCheck(U.state.data,G);if(!J)return{};const W={protein:yield w(U,J,"protein"),nucleic:yield w(U,J,"nucleic")},te=J.obj.data,de={sizeFactor:te.isCoarseGrained?.8:.2},ye={radiusOffset:te.isCoarseGrained?2:0,smoothness:te.isCoarseGrained?1:1.5},{update:j,builder:Z,typeParams:q,symmetryColor:Y,symmetryColorParams:ee}=d(U,V,te),g={protein:Z.buildRepresentation(j,W.protein,{type:"cartoon",typeParams:{...q,...de},color:Y,colorParams:ee},{tag:"protein"}),nucleic:Z.buildRepresentation(j,W.nucleic,{type:"gaussian-surface",typeParams:{...q,...ye},color:Y,colorParams:ee},{tag:"nucleic"})};return yield j.commit({revertOnError:!0}),yield s(U,te,null===(k=null===(N=V.theme)||void 0===N?void 0:N.focus)||void 0===k?void 0:k.name,null===($=null===(H=V.theme)||void 0===H?void 0:H.focus)||void 0===$?void 0:$.params),{components:W,representations:g}})()}),R=m({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:a,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:()=>u,apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$;const J=A.so.resolveAndCheck(U.state.data,G);if(!J)return{};const W={polymer:yield L(U,J,"polymer"),lipid:yield L(U,J,"lipid")},te=J.obj.data,de=U.config.get(c.AB.Structure.SizeThresholds)||t.oE.DefaultSizeThresholds,ye=t.oE.getSize(te,de),j=Object.create(null);ye===t.oE.Size.Gigantic?Object.assign(j,{traceOnly:!te.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):ye===t.oE.Size.Huge?Object.assign(j,{radiusOffset:te.isCoarseGrained?2:0,smoothness:1}):te.isCoarseGrained&&Object.assign(j,{radiusOffset:2,smoothness:1});const{update:Z,builder:q,typeParams:Y,symmetryColor:ee,symmetryColorParams:g}=d(U,V,te),_e={polymer:q.buildRepresentation(Z,W.polymer,{type:"gaussian-surface",typeParams:{...Y,...j},color:ee,colorParams:g},{tag:"polymer"}),lipid:q.buildRepresentation(Z,W.lipid,{type:"gaussian-surface",typeParams:{...Y,...j},color:ee,colorParams:g},{tag:"lipid"})};return yield Z.commit({revertOnError:!0}),yield s(U,te,null===(k=null===(N=V.theme)||void 0===N?void 0:N.focus)||void 0===k?void 0:k.name,null===($=null===(H=V.theme)||void 0===H?void 0:H.focus)||void 0===$?void 0:$.params),{components:W,representations:_e}})()}),f=m({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:a,description:"Shows polymers as Cartoon."},params:()=>u,apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$;const J=A.so.resolveAndCheck(U.state.data,G);if(!J)return{};const W={polymer:yield L(U,J,"polymer")},te=J.obj.data,de={sizeFactor:te.isCoarseGrained?.8:.2},{update:ye,builder:j,typeParams:Z,symmetryColor:q,symmetryColorParams:Y}=d(U,V,te),ee={polymer:j.buildRepresentation(ye,W.polymer,{type:"cartoon",typeParams:{...Z,...de},color:q,colorParams:Y},{tag:"polymer"})};return yield ye.commit({revertOnError:!0}),yield s(U,te,null===(k=null===(N=V.theme)||void 0===N?void 0:N.focus)||void 0===k?void 0:k.name,null===($=null===(H=V.theme)||void 0===H?void 0:H.focus)||void 0===$?void 0:$.params),{components:W,representations:ee}})()}),p=m({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:a,description:"Shows everything in atomic detail with Ball & Stick."},params:()=>({...u,showCarbohydrateSymbol:o.t.Boolean(!1)}),apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$,J,W;const te=A.so.resolveAndCheck(U.state.data,G);if(!te)return{};const de={all:yield L(U,te,"all"),branched:void 0},ye=te.obj.data,j=ye.elementCount>1e5,Z=ye.atomicResidueCount&&ye.elementCount>1e3&&ye.atomicResidueCount/ye.elementCount<3,q=ye.models[0],Y=!!_.z.Provider.get(q)||M.A.isExhaustive(q);let ee="ball-and-stick";ye.isCoarseGrained?ee=ye.elementCount>1e6?"point":"spacefill":Z&&!Y?ee="spacefill":j&&(ee="line");const g=V.showCarbohydrateSymbol&&!j&&!Z;g&&Object.assign(de,{branched:yield L(U,te,"branched",{label:"Carbohydrate"})});const{update:_e,builder:xe,typeParams:le,color:Ae,ballAndStickColor:Be,globalColorParams:Ce}=d(U,V,ye),Re=Z&&!Y?{carbonColor:{name:"element-symbol",params:{}},...Ce}:Be,ke={all:xe.buildRepresentation(_e,de.all,{type:ee,typeParams:le,color:Ae,colorParams:Re},{tag:"all"})};return g&&Object.assign(ke,{snfg3d:xe.buildRepresentation(_e,de.branched,{type:"carbohydrate",typeParams:{...le,alpha:.4,visuals:["carbohydrate-symbol"]},color:Ae,colorParams:Ce},{tag:"snfg-3d"})}),yield _e.commit({revertOnError:!0}),yield s(U,ye,null!==(H=null===(k=null===(N=V.theme)||void 0===N?void 0:N.focus)||void 0===k?void 0:k.name)&&void 0!==H?H:Ae,null!==(W=null===(J=null===($=V.theme)||void 0===$?void 0:$.focus)||void 0===J?void 0:J.params)&&void 0!==W?W:Re),{components:de,representations:ke}})()}),E=m({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:()=>({...u,showCarbohydrateSymbol:o.t.Boolean(!1)}),apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$,J;const W=A.so.resolveAndCheck(U.state.data,G);if(!W)return{};const te={all:yield L(U,W,"all"),branched:void 0},de=W.obj.data,{update:ye,builder:j,typeParams:Z,color:q}=d(U,V,de),Y={all:j.buildRepresentation(ye,te.all,{type:"spacefill",typeParams:{...Z,ignoreLight:!0},color:"illustrative"},{tag:"all"})};return yield ye.commit({revertOnError:!0}),yield s(U,de,null!==(H=null===(k=null===(N=V.theme)||void 0===N?void 0:N.focus)||void 0===k?void 0:k.name)&&void 0!==H?H:q,null===(J=null===($=V.theme)||void 0===$?void 0:$.focus)||void 0===J?void 0:J.params),{components:te,representations:Y}})()}),T=m({id:"preset-structure-representation-auto-lod",display:{name:"Automatic Detail",group:"Miscellaneous",description:"Shows more (or less) detailed representations automatically based on camera distance."},params:()=>u,apply:(G,V,U)=>(0,e.A)(function*(){var N,k,H,$;const J=A.so.resolveAndCheck(U.state.data,G);if(!J)return{};const W={all:yield L(U,J,"all")},te=J.obj.data,de={sizeFactor:te.isCoarseGrained?.8:.2},{update:ye,builder:j,typeParams:Z,color:q,symmetryColor:Y,symmetryColorParams:ee,ballAndStickColor:g}=d(U,V,te),_e={gaussianSurface:j.buildRepresentation(ye,W.all,{type:"gaussian-surface",typeParams:{...Z,lod:l.e.create(30,1e7,100)},color:Y,colorParams:ee},{tag:"gaussian-surface"}),cartoon:j.buildRepresentation(ye,W.all,{type:"cartoon",typeParams:{...Z,...de,lod:l.e.create(-20,300,100)},color:Y,colorParams:ee},{tag:"cartoon"}),ballAndStick:j.buildRepresentation(ye,W.all,{type:"ball-and-stick",typeParams:{...Z,lod:l.e.create(-20,40,20)},color:q,colorParams:g},{tag:"ball-and-stick"})};return yield ye.commit({revertOnError:!1}),yield s(U,te,null===(k=null===(N=V.theme)||void 0===N?void 0:N.focus)||void 0===k?void 0:k.name,null===($=null===(H=V.theme)||void 0===H?void 0:H.focus)||void 0===$?void 0:$.params),{components:W,representations:_e}})()});function L(G,V,U,N){return G.builders.structure.tryCreateComponentStatic(V,U,N)}function w(G,V,U,N){return G.builders.structure.tryCreateComponentFromSelection(V,y.Ou[U],`selection-${U}`,N)}const Q={empty:h,auto:C,"atomic-detail":p,"polymer-cartoon":f,"polymer-and-ligand":S,"protein-and-nucleic":D,"coarse-surface":R,illustrative:E,"auto-lod":T}},3182:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>t,e:()=>A});var e=n(9359),o=n(8956),r=n(6115);class t{constructor(){this.subs=void 0}subscribe(c,i){typeof this.subs>"u"&&(this.subs=[]);let v=c.subscribe(i);return this.subs.push(v),{unsubscribe:()=>{v&&this.subs&&(0,r.K3)(this.subs,v)&&(v.unsubscribe(),v=void 0)}}}get ev(){return this._ev||(this._ev=o.V.create())}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(const c of this.subs)c.unsubscribe();this.subs=void 0}}}class A extends t{updateState(...c){const i=this.state,v=(0,e.Wv)(i,c);return v!==i&&(this._state=v,!0)}get state(){return this._state}constructor(c){super(),this._state=c}}},1169:(tn,Ue,n)=>{"use strict";n.d(Ue,{VE:()=>i,jM:()=>r});var e=n(1073),o=n(1425);const r="Coordinates",i=[["dcd",(0,o.N)({label:"DCD",description:"DCD",category:r,binaryExtensions:["dcd"],parse:(v,O)=>v.state.data.build().to(O).apply(e.f.Model.CoordinatesFromDcd).commit()})],["xtc",(0,o.N)({label:"XTC",description:"XTC",category:r,binaryExtensions:["xtc"],parse:(v,O)=>v.state.data.build().to(O).apply(e.f.Model.CoordinatesFromXtc).commit()})],["trr",(0,o.N)({label:"TRR",description:"TRR",category:r,binaryExtensions:["trr"],parse:(v,O)=>v.state.data.build().to(O).apply(e.f.Model.CoordinatesFromTrr).commit()})],["nctraj",(0,o.N)({label:"NCTRAJ",description:"NCTRAJ",category:r,binaryExtensions:["nc","nctraj"],parse:(v,O)=>v.state.data.build().to(O).apply(e.f.Model.CoordinatesFromNctraj).commit()})]]},1425:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>o,v:()=>r});var e=n(5295);function o(t){return t}function r(t,A){if("bcif"===t.ext)try{const{encoder:y}=(0,e.J)(A);if(y.startsWith("VolumeServer"))return"dscif";if(y.startsWith("volseg-volume-server"))return"segcif"}catch(y){console.error(y)}else if("cif"===t.ext){const y=A;if(y.startsWith("data_SERVER\n#\n_density_server_result"))return"dscif";if(y.startsWith("data_SERVER\n#\ndata_SEGMENTATION_DATA"))return"segcif";if(y.includes("atom_site_fract_x")||y.includes("atom_site.fract_x"))return"coreCif"}return-1}},2945:(tn,Ue,n)=>{"use strict";n.d(Ue,{PO:()=>i,nE:()=>t});var e=n(467),o=n(1073),r=n(1425);const t="Topology",A=(0,r.N)({label:"PSF",description:"PSF",category:t,stringExtensions:["psf"],parse:(v=(0,e.A)(function*(O,b){const _=O.state.data.build().to(b).apply(o.f.Data.ParsePsf,{},{state:{isGhost:!0}}),M=_.apply(o.f.Model.TopologyFromPsf);return yield _.commit(),{format:_.selector,topology:M.selector}}),function(b,_){return v.apply(this,arguments)})}),y=(0,r.N)({label:"PRMTOP",description:"PRMTOP",category:t,stringExtensions:["prmtop","parm7"],parse:function(){var v=(0,e.A)(function*(O,b){const _=O.state.data.build().to(b).apply(o.f.Data.ParsePrmtop,{},{state:{isGhost:!0}}),M=_.apply(o.f.Model.TopologyFromPrmtop);return yield _.commit(),{format:_.selector,topology:M.selector}});return function(b,_){return v.apply(this,arguments)}}()}),c=(0,r.N)({label:"TOP",description:"TOP",category:t,stringExtensions:["top"],parse:function(){var v=(0,e.A)(function*(O,b){const _=O.state.data.build().to(b).apply(o.f.Data.ParseTop,{},{state:{isGhost:!0}}),M=_.apply(o.f.Model.TopologyFromTop);return yield _.commit(),{format:_.selector,topology:M.selector}});return function(b,_){return v.apply(this,arguments)}}()}),i=[["psf",A],["prmtop",y],["top",c]];var v},5953:(tn,Ue,n)=>{"use strict";n.d(Ue,{HQ:()=>m,RB:()=>t});var e=n(467),o=n(1073),r=n(1425);const t="Trajectory";function A(u,d){return u.builders.structure.hierarchy.applyPreset(d.trajectory,"default")}const y={label:"mmCIF",description:"mmCIF",category:t,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:(u,d)=>"mmcif"===u.ext||"mcif"===u.ext||("cif"===u.ext||"bcif"===u.ext)&&-1===(0,r.v)(u,d),parse:(u=(0,e.A)(function*(d,s,C){var h,a;const D=d.state.data.build().to(s).apply(o.f.Data.ParseCif,void 0,{state:{isGhost:!0}}),R=yield D.apply(o.f.Model.TrajectoryFromMmCif,void 0,{tags:C?.trajectoryTags}).commit({revertOnError:!0});return((null===(a=null===(h=D.selector.cell)||void 0===h?void 0:h.obj)||void 0===a?void 0:a.data.blocks.length)||0)>1&&d.state.data.updateCellState(D.ref,{isGhost:!1}),{trajectory:R}}),function(s,C,h){return u.apply(this,arguments)}),visuals:A},c={label:"cifCore",description:"CIF Core",category:t,stringExtensions:["cif"],isApplicable:(u,d)=>"cif"===u.ext&&"coreCif"===(0,r.v)(u,d),parse:function(){var u=(0,e.A)(function*(d,s,C){var h,a;const D=d.state.data.build().to(s).apply(o.f.Data.ParseCif,void 0,{state:{isGhost:!0}}),R=yield D.apply(o.f.Model.TrajectoryFromCifCore,void 0,{tags:C?.trajectoryTags}).commit({revertOnError:!0});return((null===(a=null===(h=D.selector.cell)||void 0===h?void 0:h.obj)||void 0===a?void 0:a.data.blocks.length)||0)>1&&d.state.data.updateCellState(D.ref,{isGhost:!1}),{trajectory:R}});return function(s,C,h){return u.apply(this,arguments)}}(),visuals:A};var u;function i(u,d){return function(){var s=(0,e.A)(function*(C,h,a){return{trajectory:yield C.state.data.build().to(h).apply(u,d,{tags:a?.trajectoryTags}).commit({revertOnError:!0})}});return function(C,h,a){return s.apply(this,arguments)}}()}const v={label:"PDB",description:"PDB",category:t,stringExtensions:["pdb","ent"],parse:i(o.f.Model.TrajectoryFromPDB),visuals:A},O={label:"PDBQT",description:"PDBQT",category:t,stringExtensions:["pdbqt"],parse:i(o.f.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:A},b={label:"XYZ",description:"XYZ",category:t,stringExtensions:["xyz"],parse:i(o.f.Model.TrajectoryFromXYZ),visuals:A},m=[["mmcif",y],["cifCore",c],["pdb",v],["pdbqt",O],["gro",{label:"GRO",description:"GRO",category:t,stringExtensions:["gro"],binaryExtensions:[],parse:i(o.f.Model.TrajectoryFromGRO),visuals:A}],["xyz",b],["mol",{label:"MOL",description:"MOL",category:t,stringExtensions:["mol"],parse:i(o.f.Model.TrajectoryFromMOL),visuals:A}],["sdf",{label:"SDF",description:"SDF",category:t,stringExtensions:["sdf","sd"],parse:i(o.f.Model.TrajectoryFromSDF),visuals:A}],["mol2",{label:"MOL2",description:"MOL2",category:t,stringExtensions:["mol2"],parse:i(o.f.Model.TrajectoryFromMOL2),visuals:A}]]},1295:(tn,Ue,n)=>{"use strict";n.d(Ue,{z:()=>_});var e=n(467),o=n(9136),r=n(7785),t=n(5384),A=n(8277),y=n(4369),c=n(9032),i=n(381),v=n(9651),O=n(1372);const b={dynamicBonds:A.t.Optional(A.t.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))};var _;!function(M){function m(f,p,E,T,L){return u.apply(this,arguments)}function u(){return(u=(0,e.A)(function*(f,p,E,T,L){let w;const Q=v.i.Provider.get(E);!T&&Q&&0!==Q.assemblies.length&&(T=Q.assemblies[0].id),Q&&0!==Q.assemblies.length?(w=c.v.findAssembly(E,T||""),w||f.log.warn(`Model '${E.entryId}' has no assembly called '${T}', returning model structure.`)):f.log.warn(`Model '${E.entryId}' has no assembly, returning model structure.`);const G=o.oE.ofModel(E,L);if(!w){const N={label:"Model",description:o.oE.elementDescription(G)};return new i.O.Molecule.Structure(G,N)}T=w.id;const V=yield o.us.buildAssembly(G,T).runInContext(p),U={label:`Assembly ${T}`,description:o.oE.elementDescription(V)};return new i.O.Molecule.Structure(V,U)})).apply(this,arguments)}function s(){return(s=(0,e.A)(function*(f,p,E,T,L){const w=o.oE.ofModel(p,L),Q=yield o.us.buildSymmetryRange(w,E,T).runInContext(f),G={label:`Symmetry [${E}] to [${T}]`,description:o.oE.elementDescription(Q)};return new i.O.Molecule.Structure(Q,G)})).apply(this,arguments)}function h(){return(h=(0,e.A)(function*(f,p,E,T){const L=o.oE.ofModel(p,T),w=yield o.us.builderSymmetryMates(L,E).runInContext(f),Q={label:"Symmetry Mates",description:o.oE.elementDescription(w)};return new i.O.Molecule.Structure(w,Q)})).apply(this,arguments)}function S(){return(S=(0,e.A)(function*(f,p,E,T,L){const w=o.oE.ofModel(p,L),Q=yield o.us.buildSymmetryAssembly(w,E,T).runInContext(f),G={label:"Symmetry Assembly",description:o.oE.elementDescription(Q)};return new i.O.Molecule.Structure(Q,G)})).apply(this,arguments)}function R(){return R=(0,e.A)(function*(f,p,E,T){const L=T?.params,w=v.i.Provider.get(E);if(!w||!T||"model"===T.name){const Q=o.oE.ofModel(E,L);return new i.O.Molecule.Structure(Q,{label:"Model",description:o.oE.elementDescription(Q)})}if("auto"===T.name){if(0===w.assemblies.length){const Q=o.oE.ofModel(E,L);return new i.O.Molecule.Structure(Q,{label:"Model",description:o.oE.elementDescription(Q)})}return m(f,p,E,void 0,L)}return"assembly"===T.name?m(f,p,E,T.params.id,L):"symmetry"===T.name?function d(f,p,E,T,L){return s.apply(this,arguments)}(p,E,T.params.ijkMin,T.params.ijkMax,L):"symmetry-mates"===T.name?function C(f,p,E,T){return h.apply(this,arguments)}(p,E,T.params.radius,L):"symmetry-assembly"===T.name?function a(f,p,E,T,L){return S.apply(this,arguments)}(p,E,T.params.generators,w,L):void(0,O.dr)(T)}),R.apply(this,arguments)}M.getParams=function I(f,p){const E=f&&v.i.Provider.get(f),T=E?E.assemblies.map(U=>[U.id,`${U.id}: ${(0,r.Mk)(U.details)}`]):[],L=!E||!t.O8.isZero(E.spacegroup.cell),w=[];if(E){const{operators:U}=E.spacegroup;for(let N=0,k=U.length;N<k;N++)w.push([N,`${N+1}: ${t.is.getOperatorXyz(U[N])}`])}const Q=[];f&&f.properties.structAsymMap.forEach(U=>{Q.push([U.id,U.id===U.auth_id?U.id:`${U.id} [auth ${U.auth_id}]`])});const G={auto:A.t.Group(b),model:A.t.Group(b),assembly:A.t.Group({id:A.t.Optional(f?A.t.Select(T.length?T[0][0]:"",T,{label:"Asm Id",description:"Assembly Id"}):A.t.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"})),...b},{isFlat:!0}),"symmetry-mates":A.t.Group({radius:A.t.Numeric(5,{min:0,max:50,step:1}),...b},{isFlat:!0}),symmetry:A.t.Group({ijkMin:A.t.Vec3(y.eB.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:A.t.Vec3(y.eB.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),...b},{isFlat:!0}),"symmetry-assembly":A.t.Group({generators:A.t.ObjectList({operators:A.t.ObjectList({index:A.t.Select(0,w),shift:A.t.Vec3((0,y.eB)(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},U=>`${U.index+1}_${U.shift.map(N=>N+5).join("")}`,{defaultValue:[]}),asymIds:A.t.MultiSelect([],Q)},U=>`${U.asymIds.length} asym ids, ${U.operators.length} operators`,{defaultValue:[]}),...b},{isFlat:!0})},V=[];return"auto"===p&&V.push(["auto","Auto"]),V.push(["model","Model"]),T.length>0&&V.push(["assembly","Assembly"]),L&&(V.push(["symmetry-mates","Symmetry Mates"]),V.push(["symmetry","Symmetry (indices)"]),V.push(["symmetry-assembly","Symmetry (assembly)"])),{type:A.t.MappedStatic(p||"model",G,{options:V})}},M.canAutoUpdate=function l(f,p){return!("symmetry-assembly"===p.name||"symmetry"===p.name&&"symmetry"===f.name)},M.create=function D(f,p,E,T){return R.apply(this,arguments)}}(_||(_={}))},1893:(tn,Ue,n)=>{"use strict";n.d(Ue,{A8:()=>t,IZ:()=>A,eD:()=>y,pQ:()=>r});var e=n(9136),o=n(8277);function r(v,O,b={}){return"string"==typeof b.type||"string"==typeof b.color||"string"==typeof b.size?function c(v,O,b){const _=b.type&&v.representation.structure.registry.get(b.type)||v.representation.structure.registry.default.provider,M=b.color&&v.representation.structure.themes.colorThemeRegistry.get(b.color)||v.representation.structure.themes.colorThemeRegistry.get(_.defaultColorTheme.name),I=b.size&&v.representation.structure.themes.sizeThemeRegistry.get(b.size)||v.representation.structure.themes.sizeThemeRegistry.get(_.defaultSizeTheme.name);return i(v,O,{type:_,typeParams:b.typeParams,color:M,colorParams:b.colorParams,size:I,sizeParams:b.sizeParams})}(v,O||e.oE.Empty,b):i(v,O||e.oE.Empty,b)}function t(v,O){const{themes:b}=v.representation.structure;return O?b.colorThemeRegistry.getApplicableTypes({structure:O}):b.colorThemeRegistry.types}function A(v,O,b,_,M){const{registry:I,themes:l}=v.representation.structure,m=I.get(b||I.default.name),u=l.colorThemeRegistry.get(_||m.defaultColorTheme.name),d=o.t.getDefaultValues(u.getParams({structure:O||e.oE.Empty}));return u.name===m.defaultColorTheme.name&&Object.assign(d,m.defaultColorTheme.props),{name:u.name,params:Object.assign(d,M)}}function y(v,O,b,_,M){const{registry:I,themes:l}=v.representation.structure,m=I.get(b||I.default.name),u=l.sizeThemeRegistry.get(_||m.defaultSizeTheme.name),d=o.t.getDefaultValues(u.getParams({structure:O||e.oE.Empty}));return u.name===m.defaultSizeTheme.name&&Object.assign(d,m.defaultSizeTheme.props),{name:u.name,params:Object.assign(d,M)}}function i(v,O,b={}){const{themes:_}=v.representation.structure,M={structure:O},I=b.type||v.representation.structure.registry.default.provider,l=o.t.getDefaultValues(I.getParams(_,O)),m=Object.assign(l,b.typeParams),u=b.color||_.colorThemeRegistry.get(I.defaultColorTheme.name),d=o.t.getDefaultValues(u.getParams(M));u.name===I.defaultColorTheme.name&&Object.assign(d,I.defaultColorTheme.props);const s=Object.assign(d,b.colorParams),C=b.size||_.sizeThemeRegistry.get(I.defaultSizeTheme.name),h=o.t.getDefaultValues(C.getParams(M));C.name===I.defaultSizeTheme.name&&Object.assign(h,I.defaultSizeTheme.props);const a=Object.assign(h,b.sizeParams);return{type:{name:I.name,params:m},colorTheme:{name:u.name,params:s},sizeTheme:{name:C.name,params:a}}}},9096:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ag:()=>ke,ET:()=>b,HU:()=>Ce,Mt:()=>Re,Ou:()=>Oe,g7:()=>O,lL:()=>Se});var e=n(467),o=n(9136),r=n(2434),t=n(9767),A=n(7291),y=n(9986),i=(n(1073),n(7126)),v=n(8699),O=function(Ve){return Ve.Type="Type",Ve.Structure="Structure Property",Ve.Atom="Atom Property",Ve.Bond="Bond Property",Ve.Residue="Residue Property",Ve.AminoAcid="Amino Acid",Ve.NucleicBase="Nucleic Base",Ve.Manipulate="Manipulate Selection",Ve.Validation="Validation",Ve.Misc="Miscellaneous",Ve.Internal="Internal",Ve}(O||{});function b(Ve,Ne,K={}){var ne;let be;return{label:Ve,expression:Ne,description:K.description||"",category:null!==(ne=K.category)&&void 0!==ne?ne:O.Misc,isHidden:!!K.isHidden,priority:K.priority||0,referencesCurrent:!!K.referencesCurrent,get query(){return be||(be=(0,A.wE)(Ne)),be},ensureCustomProperties:K.ensureCustomProperties,getSelection:(Te,ie,ue)=>(0,e.A)(function*(){const re=Te.managers.structure.selection.getStructure(ue),ve=re?o.cv.Sequence(ue,[re]):o.cv.Empty(ue);return K.ensureCustomProperties&&(yield K.ensureCustomProperties({runtime:ie,assetManager:Te.managers.asset},ue)),be||(be=(0,A.wE)(Ne)),be(new o.cY(ue,{currentSelection:ve}))})()}}const _=b("All",t.J.struct.generator.all(),{category:"",priority:1e3}),M=b("Current Selection",t.J.internal.generator.current(),{category:"",referencesCurrent:!0}),I=b("Polymer",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.logic.and([t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),t.J.core.str.match([t.J.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),t.J.ammp("entitySubtype")])])})]),{category:O.Type}),l=b("Trace",t.J.struct.modifier.union([t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),"chain-test":t.J.core.set.has([t.J.set("sphere","gaussian"),t.J.ammp("objectPrimitive")])})]),t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"atom-test":t.J.core.set.has([t.J.set("CA","P"),t.J.ammp("label_atom_id")])})])])]),{category:O.Structure}),m=t.J.core.logic.and([t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),t.J.core.str.match([t.J.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),t.J.ammp("entitySubtype")])]),u=t.J.core.logic.and([t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),t.J.core.str.match([t.J.re("(nucleotide|peptide nucleic acid)","i"),t.J.ammp("entitySubtype")])]),d=t.J.core.str.match([t.J.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),t.J.ammp("chemCompType")]),s=b("Backbone",t.J.struct.modifier.union([t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":m,"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([d]),"atom-test":t.J.core.set.has([t.J.set(...y.M.toArray(r.DB)),t.J.ammp("label_atom_id")])})]),t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":u,"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([d]),"atom-test":t.J.core.set.has([t.J.set(...y.M.toArray(r.HA)),t.J.ammp("label_atom_id")])})])])]),{category:O.Structure}),C=b("Sidechain",t.J.struct.modifier.union([t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":m,"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([d]),"atom-test":t.J.core.logic.or([t.J.core.logic.not([t.J.core.set.has([t.J.set(...y.M.toArray(r.DB)),t.J.ammp("label_atom_id")])])])})]),t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":u,"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([d]),"atom-test":t.J.core.logic.or([t.J.core.logic.not([t.J.core.set.has([t.J.set(...y.M.toArray(r.HA)),t.J.ammp("label_atom_id")])])])})])])]),{category:O.Structure}),h=b("Sidechain with Trace",t.J.struct.modifier.union([t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":m,"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([d]),"atom-test":t.J.core.logic.or([t.J.core.logic.not([t.J.core.set.has([t.J.set(...y.M.toArray(r.DB)),t.J.ammp("label_atom_id")])]),t.J.core.rel.eq([t.J.ammp("label_atom_id"),"CA"]),t.J.core.logic.and([t.J.core.rel.eq([t.J.ammp("auth_comp_id"),"PRO"]),t.J.core.rel.eq([t.J.ammp("label_atom_id"),"N"])])])})]),t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":u,"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([d]),"atom-test":t.J.core.logic.or([t.J.core.logic.not([t.J.core.set.has([t.J.set(...y.M.toArray(r.HA)),t.J.ammp("label_atom_id")])]),t.J.core.rel.eq([t.J.ammp("label_atom_id"),"P"])])})])])]),{category:O.Structure}),a=b("Protein",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":m})]),{category:O.Type}),S=b("Nucleic",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":u})]),{category:O.Type}),D=b("Helix",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":m,"residue-test":t.J.core.flags.hasAny([t.J.ammp("secondaryStructureFlags"),t.J.core.type.bitflags([2])])})]),{category:O.Structure,ensureCustomProperties:(Ve,Ne)=>v.v.attach(Ve,Ne)}),R=b("Beta Strand/Sheet",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":m,"residue-test":t.J.core.flags.hasAny([t.J.ammp("secondaryStructureFlags"),t.J.core.type.bitflags([4])])})]),{category:O.Structure,ensureCustomProperties:(Ve,Ne)=>v.v.attach(Ve,Ne)}),f=b("Water",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entityType"),"water"])})]),{category:O.Type}),p=b("Ion",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entitySubtype"),"ion"])})]),{category:O.Type}),E=b("Lipid",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entitySubtype"),"lipid"])})]),{category:O.Type}),T=b("Carbohydrate",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.logic.or([t.J.core.rel.eq([t.J.ammp("entityType"),"branched"]),t.J.core.logic.and([t.J.core.rel.eq([t.J.ammp("entityType"),"non-polymer"]),t.J.core.str.match([t.J.re("oligosaccharide","i"),t.J.ammp("entitySubtype")])])])})]),{category:O.Type}),L=b("Carbohydrate with Connected",t.J.struct.modifier.union([t.J.struct.modifier.includeConnected({0:T.expression,"layer-count":1,"as-whole-residues":!0})]),{category:O.Internal,isHidden:!0}),w=b("Connected to Carbohydrate",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:L.expression,by:T.expression})]),{category:O.Internal,isHidden:!0}),Q=b("Ligand",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:t.J.struct.modifier.union([t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.logic.and([t.J.core.logic.or([t.J.core.rel.eq([t.J.ammp("entityType"),"non-polymer"]),t.J.core.rel.neq([t.J.ammp("entityPrdId"),""])]),t.J.core.logic.not([t.J.core.str.match([t.J.re("(oligosaccharide|lipid|ion)","i"),t.J.ammp("entitySubtype")])])]),"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.logic.not([t.J.core.str.match([t.J.re("saccharide","i"),t.J.ammp("chemCompType")])])})]),t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":d})])])]),by:t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.set.has([t.J.set(...y.M.toArray(r.px)),t.J.ammp("label_comp_id")])})]),t.J.struct.generator.atomGroups({"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.core.set.has([t.J.set(...y.M.toArray(r.K5)),t.J.ammp("label_comp_id")])})])})]),{category:O.Type}),G=b("Ligand with Connected",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:t.J.struct.modifier.union([t.J.struct.modifier.includeConnected({0:Q.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":t.J.core.flags.hasAny([t.J.struct.bondProperty.flags(),t.J.core.type.bitflags([3])])})]),by:T.expression})]),{category:O.Internal,isHidden:!0}),V=b("Connected to Ligand",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:G.expression,by:Q.expression})]),{category:O.Internal,isHidden:!0}),U=b("Connected to Ligand or Carbohydrate",t.J.struct.modifier.union([t.J.struct.combinator.merge([w.expression,V.expression])]),{category:O.Internal,isHidden:!0}),N=b("Disulfide Bridges",t.J.struct.modifier.union([t.J.struct.combinator.merge([t.J.struct.modifier.union([t.J.struct.modifier.wholeResidues([t.J.struct.filter.isConnectedTo({0:t.J.struct.generator.atomGroups({"residue-test":t.J.core.set.has([t.J.set("CYS"),t.J.ammp("auth_comp_id")]),"atom-test":t.J.core.set.has([t.J.set("SG"),t.J.ammp("label_atom_id")])}),target:t.J.struct.generator.atomGroups({"residue-test":t.J.core.set.has([t.J.set("CYS"),t.J.ammp("auth_comp_id")]),"atom-test":t.J.core.set.has([t.J.set("SG"),t.J.ammp("label_atom_id")])}),"bond-test":!0})])]),t.J.struct.modifier.union([t.J.struct.modifier.wholeResidues([t.J.struct.modifier.union([t.J.struct.generator.bondedAtomicPairs({0:t.J.core.flags.hasAny([t.J.struct.bondProperty.flags(),t.J.core.type.bitflags([8])])})])])])])]),{category:O.Bond}),k=b("NOS Bridges",t.J.struct.modifier.union([t.J.struct.modifier.wholeResidues([t.J.struct.filter.isConnectedTo({0:t.J.struct.generator.atomGroups({"residue-test":t.J.core.set.has([t.J.set("CSO","LYS"),t.J.ammp("auth_comp_id")]),"atom-test":t.J.core.set.has([t.J.set("OD","NZ"),t.J.ammp("label_atom_id")])}),target:t.J.struct.generator.atomGroups({"residue-test":t.J.core.set.has([t.J.set("CSO","LYS"),t.J.ammp("auth_comp_id")]),"atom-test":t.J.core.set.has([t.J.set("OD","NZ"),t.J.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:O.Bond}),H=b("Non-standard Residues in Polymers",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.rel.eq([t.J.ammp("entityType"),"polymer"]),"chain-test":t.J.core.rel.eq([t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":t.J.ammp("isNonStandard")})]),{category:O.Residue}),$=b("Coarse Elements",t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"chain-test":t.J.core.set.has([t.J.set("sphere","gaussian"),t.J.ammp("objectPrimitive")])})]),{category:O.Type}),J=b("Rings in Residues",t.J.struct.modifier.union([t.J.struct.generator.rings()]),{category:O.Residue}),W=b("Aromatic Rings in Residues",t.J.struct.modifier.union([t.J.struct.generator.rings({"only-aromatic":!0})]),{category:O.Residue}),te=b("Surrounding Residues (5 \u212b) of Selection",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:t.J.struct.modifier.includeSurroundings({0:t.J.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:t.J.internal.generator.current()})]),{description:"Select residues within 5 \u212b of the current selection.",category:O.Manipulate,referencesCurrent:!0}),de=b("Surrounding Ligands (5 \u212b) of Selection",t.J.struct.modifier.union([t.J.struct.modifier.surroundingLigands({0:t.J.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212b of the current selection.",category:O.Manipulate,referencesCurrent:!0}),ye=b("Surrounding Atoms (5 \u212b) of Selection",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:t.J.struct.modifier.includeSurroundings({0:t.J.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:t.J.internal.generator.current()})]),{description:"Select atoms within 5 \u212b of the current selection.",category:O.Manipulate,referencesCurrent:!0}),j=b("Inverse / Complement of Selection",t.J.struct.modifier.union([t.J.struct.modifier.exceptBy({0:t.J.struct.generator.all(),by:t.J.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:O.Manipulate,referencesCurrent:!0}),Z=b("Residues Covalently Bonded to Selection",t.J.struct.modifier.union([t.J.struct.modifier.includeConnected({0:t.J.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:O.Manipulate,referencesCurrent:!0}),q=b("Covalently Bonded Component",t.J.struct.modifier.union([t.J.struct.modifier.includeConnected({0:t.J.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:O.Manipulate,referencesCurrent:!0}),Y=b("Residues with Cov. or Metallic Bond to Selection",t.J.struct.modifier.union([t.J.struct.modifier.includeConnected({0:t.J.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":t.J.core.flags.hasAny([t.J.struct.bondProperty.flags(),t.J.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:O.Manipulate,referencesCurrent:!0}),ee=b("Whole Residues of Selection",t.J.struct.modifier.union([t.J.struct.modifier.wholeResidues({0:t.J.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:O.Manipulate,referencesCurrent:!0}),g=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort((Ve,Ne)=>Ve[1]<Ne[1]?-1:Ve[1]>Ne[1]?1:0),_e=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort((Ve,Ne)=>Ve[1]<Ne[1]?-1:Ve[1]>Ne[1]?1:0);function xe([Ve,Ne],K,ne=0){const be=1!==Ve.length||Be.has(Ve[0])?`${Ne} (${Ve.join(", ")})`:`[${Ve[0]}] ${Ne}`;return b(be,t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"residue-test":t.J.core.set.has([t.J.set(...Ve),t.J.ammp("auth_comp_id")])})]),{category:K,priority:ne,description:be})}const Be=y.M.unionMany(r.Ke,r.XQ,r.DF,r.mw);function Ce(Ve){const Ne=new Set;for(const ne of Ve)ne.uniqueElementSymbols.forEach(be=>Ne.add(be));const K=[];return Ne.forEach(ne=>{K.push(function le([Ve,Ne],K,ne){const be=`${Ne} (${Ve.join(", ")})`;return b(be,t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"atom-test":t.J.core.set.has([t.J.set(...Ve),t.J.acp("elementSymbol")])})]),{category:K,priority:ne,description:be})}([[ne],i.Z6[ne]||ne],"Element Symbol",0))}),K}function Re(Ve){const Ne=new Map,K=new Set;for(const be of Ve){be.uniqueResidueNames.forEach(Te=>K.add(Te));for(const Te of be.models)be.uniqueResidueNames.forEach(ie=>{const ue=Te.properties.chemicalComponentMap.get(ie);ue&&Ne.set(ie,ue.name)})}const ne=[];return y.M.difference(K,Be).forEach(be=>{const Te=Ne.get(be)||be;ne.push(xe([[be],Te],"Ligand/Non-standard Residue",200))}),ne}function ke(Ve){const Ne=new Map,K=o.iZ.Location.create();for(const be of Ve){K.structure=be;for(const Te of be.unitSymmetryGroups){K.unit=Te.units[0],K.element=Te.elements[0];const ie=o.StructureProperties.entity.type(K);if("polymer"===ie||"branched"===ie){const ue=o.StructureProperties.entity.pdbx_description(K);Ne.set(ue.join(", "),ue)}}}const ne=[];return Ne.forEach((be,Te)=>{ne.push(function Ae([Ve,Ne],K,ne){const be=`${Ne}`;return b(`${Ne}`,t.J.struct.modifier.union([t.J.struct.generator.atomGroups({"entity-test":t.J.core.list.equal([t.J.list(...Ve),t.J.ammp("entityDescription")])})]),{category:K,priority:ne,description:be})}([be,Te],"Polymer/Carbohydrate Entities",300))}),ne}const Oe={all:_,current:M,polymer:I,trace:l,backbone:s,sidechain:C,sidechainWithTrace:h,protein:a,nucleic:S,helix:D,beta:R,water:f,ion:p,lipid:E,branched:T,branchedPlusConnected:L,branchedConnectedOnly:w,ligand:Q,ligandPlusConnected:G,ligandConnectedOnly:V,connectedOnly:U,disulfideBridges:N,nosBridges:k,nonStandardPolymer:H,coarse:$,ring:J,aromaticRing:W,surroundings:te,surroundingLigands:de,surroundingAtoms:ye,complement:j,covalentlyBonded:Z,covalentlyOrMetallicBonded:Y,covalentlyBondedComponent:q,wholeResidues:ee};class Se{add(Ne){this.list.push(Ne),this.options.push([Ne,Ne.label,Ne.category]),this.version+=1}remove(Ne){const K=this.list.indexOf(Ne);-1!==K&&(this.list.splice(K,1),this.options.splice(K,1),this.version+=1)}constructor(){this.list=[],this.options=[],this.version=1,this.list.push(...Object.values(Oe),...g.map(Ne=>xe(Ne,O.AminoAcid)),..._e.map(Ne=>xe(Ne,O.NucleicBase))),this.options.push(...this.list.map(Ne=>[Ne,Ne.label,Ne.category]))}}},3442:(tn,Ue,n)=>{"use strict";n.d(Ue,{aK:()=>r});var e=n(6853),o=n(8277);function r(v,O,b={}){return"string"==typeof b.type||"string"==typeof b.color||"string"==typeof b.size?function c(v,O,b){const _=b.type&&v.representation.volume.registry.get(b.type)||v.representation.volume.registry.default.provider,M=b.color&&v.representation.volume.themes.colorThemeRegistry.get(b.color)||v.representation.volume.themes.colorThemeRegistry.get(_.defaultColorTheme.name),I=b.size&&v.representation.volume.themes.sizeThemeRegistry.get(b.size)||v.representation.volume.themes.sizeThemeRegistry.get(_.defaultSizeTheme.name);return i(v,O,{type:_,typeParams:b.typeParams,color:M,colorParams:b.colorParams,size:I,sizeParams:b.sizeParams})}(v,O||e.f.One,b):i(v,O||e.f.One,b)}function i(v,O,b={}){const{themes:_}=v.representation.volume,M={volume:O},I=b.type||v.representation.volume.registry.default.provider,l=o.t.getDefaultValues(I.getParams(_,O)),m=Object.assign(l,b.typeParams),u=b.color||_.colorThemeRegistry.get(I.defaultColorTheme.name),d=o.t.getDefaultValues(u.getParams(M));u.name===I.defaultColorTheme.name&&Object.assign(d,I.defaultColorTheme.props);const s=Object.assign(d,b.colorParams),C=b.size||_.sizeThemeRegistry.get(I.defaultSizeTheme.name),h=o.t.getDefaultValues(C.getParams(M));C.name===I.defaultSizeTheme.name&&Object.assign(h,I.defaultSizeTheme.props);const a=Object.assign(h,b.sizeParams);return{type:{name:I.name,params:m},colorTheme:{name:u.name,params:s},sizeTheme:{name:C.name,params:a}}}},4986:(tn,Ue,n)=>{"use strict";n.d(Ue,{d:()=>v});var e=n(3246),o=n(9136),r=n(2443),t=n(6825),A=n(9359),y=n(8277),c=n(3182);class v extends c.e{get props(){return{...this.state.props}}setProps(b){const M={...this.state.props,...b};(0,A.bN)(this.props,M)||(this.updateState({props:M}),this.lociSelects.setProps(M),this.lociHighlights.setProps(M),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}constructor(b,_={}){super({props:{...y.t.getDefaultValues(v.Params),..._}}),this.plugin=b,this._props=y.t.getDefaultValues(v.Params),this.events={propsUpdated:this.ev()},this.lociSelects=new v.LociSelectManager(b,this._props),this.lociHighlights=new v.LociHighlightManager(b,this._props)}}!function(O){O.Params={granularity:y.t.Select("residue",e.QN.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};class b{setProps(l){Object.assign(this.props,l)}addProvider(l){this.providers.push(l)}removeProvider(l){this.providers=this.providers.filter(m=>m!==l)}normalizedLoci(l,m,u=!1){const{loci:d,repr:s}=l;return{loci:e.QN.normalize(d,m?this.props.granularity:void 0,u),repr:s}}mark(l,m,u=!1){if(!e.QN.isEmpty(l.loci))for(const d of this.providers)d(l,m,u)}dispose(){this.providers.length=0,this.sel.dispose()}constructor(l,m={}){this.ctx=l,this.providers=[],this.props=y.t.getDefaultValues(O.Params),this.sel=l.managers.structure.selection,this.setProps(m)}}O.LociMarkManager=b,O.LociHighlightManager=class _ extends b{constructor(){super(...arguments),this.prev=[],this.clearHighlights=(l=!1)=>{for(const m of this.prev)this.mark(m,t.xi.RemoveHighlight,l);this.prev.length=0}}isHighlighted(l){for(const m of this.prev)if(r.YL.Loci.areEqual(m,l))return!0;return!1}addHighlight(l){this.mark(l,t.xi.Highlight),this.prev.push(l)}highlight(l,m=!0){const u=this.normalizedLoci(l,m);this.isHighlighted(u)||this.addHighlight(u)}highlightOnly(l,m=!0){const u=this.normalizedLoci(l,m);this.isHighlighted(u)||(e.QN.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))}highlightOnlyExtend(l,m=!0){const u=this.normalizedLoci(l,m);if(o.iZ.Loci.is(u.loci)){const d={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(d)||(e.QN.isEmpty(d.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(d)))}}dispose(){super.dispose(),this.prev.length=0}},O.LociSelectManager=class M extends b{toggle(l,m=!0){if(e.QN.isEmpty(l.loci))return;const u=this.normalizedLoci(l,m,!0);o.iZ.Loci.is(u.loci)?this.toggleSel(u):super.mark(u,t.xi.Toggle)}toggleExtend(l,m=!0){if(e.QN.isEmpty(l.loci))return;const u=this.normalizedLoci(l,m,!0);if(o.iZ.Loci.is(u.loci)){const d=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:d,repr:u.repr})}}select(l,m=!0){const u=this.normalizedLoci(l,m,!0);o.iZ.Loci.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,t.xi.Select)}selectJoin(l,m=!0){const u=this.normalizedLoci(l,m,!0);o.iZ.Loci.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,t.xi.Select)}selectOnly(l,m=!0){const u=this.normalizedLoci(l,m,!0);o.iZ.Loci.is(u.loci)&&(this.mark({loci:o.oE.Loci(u.loci.structure),repr:u.repr},t.xi.Deselect),this.sel.modify("set",u.loci)),this.mark(u,t.xi.Select)}deselect(l,m=!0){const u=this.normalizedLoci(l,m,!0);o.iZ.Loci.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,t.xi.Deselect)}deselectAll(){this.sel.clear(),this.mark({loci:e.FE},t.xi.Deselect)}deselectAllOnEmpty(l){(0,e.$M)(l.loci)&&this.deselectAll()}mark(l,m){const{loci:u}=l;if(!e.QN.isEmpty(u))if(o.iZ.Loci.is(u)){const d=this.sel.getLoci(u.structure);super.mark({loci:o.oE.Loci(u.structure)},t.xi.Deselect,!e.QN.isEmpty(d)),super.mark({loci:d},t.xi.Select)}else super.mark(l,m)}toggleSel(l){this.sel.has(l.loci)?(this.sel.modify("remove",l.loci),this.mark(l,t.xi.Deselect)):(this.sel.modify("add",l.loci),this.mark(l,t.xi.Select))}}}(v||(v={}))},856:(tn,Ue,n)=>{"use strict";n.d(Ue,{g:()=>b});var e=n(467),o=n(39),r=n(9909),t=n(3182),A=n(275),y=n(6985),c=n(3188),i=n(9359),v=n(6101),O=n(6345);let b=(()=>{class _ extends t.e{getIndex(I){return this.state.entries.indexOf(I)}getEntry(I){if(I)return this.entryMap.get(I)}remove(I){const l=this.entryMap.get(I);l&&(l?.image&&this.plugin.managers.asset.delete(l.image),this.entryMap.delete(I),this.updateState({current:this.state.current===I?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(l))}),this.events.changed.next(void 0))}add(I){this.entryMap.set(I.snapshot.id,I),this.updateState({current:I.snapshot.id,entries:this.state.entries.push(I)}),this.events.changed.next(void 0)}replace(I,l,m){var u,d,s;const C=this.getEntry(I);if(!C)return;this.defaultSnapshotId=void 0,C?.image&&this.plugin.managers.asset.delete(C.image);const h=this.getIndex(C),a=_.Entry(l,{key:null!==(u=m?.key)&&void 0!==u?u:C.key,name:null!==(d=m?.name)&&void 0!==d?d:C.name,description:null!==(s=m?.description)&&void 0!==s?s:C.description,image:m?.image});this.entryMap.set(l.id,a),this.updateState({current:a.snapshot.id,entries:this.state.entries.set(h,a)}),this.events.changed.next(void 0)}move(I,l){const m=this.state.entries.size;if(m<2)return;const u=this.getEntry(I);if(!u)return;const d=this.getIndex(u);let s=(d+l)%m;s<0&&(s+=m);const C=this.state.entries.get(s),h=this.state.entries.asMutable();h.set(s,u),h.set(d,C),this.updateState({current:u.snapshot.id,entries:h.asImmutable()}),this.events.changed.next(void 0)}update(I,l){var m,u,d;const s=this.getIndex(I);if(s<0)return;const C=this.state.entries.set(s,{...I,key:(null===(m=l.key)||void 0===m?void 0:m.trim())||void 0,name:(null===(u=l.name)||void 0===u?void 0:u.trim())||void 0,description:(null===(d=l.description)||void 0===d?void 0:d.trim())||void 0});this.updateState({entries:C}),this.entryMap.set(I.snapshot.id,this.state.entries.get(s)),this.events.changed.next(void 0)}clear(){0!==this.state.entries.size&&(this.entryMap.forEach(I=>{I?.image&&this.plugin.managers.asset.delete(I.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:(0,o.B8)()}),this.events.changed.next(void 0))}applyKey(I){const l=this.state.entries.find(m=>m.key===I);l&&(this.updateState({current:l.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(l.snapshot))}setCurrent(I){const l=this.getEntry(I);return l&&(this.updateState({current:I}),this.events.changed.next(void 0)),l&&l.snapshot}getNextId(I,l){const m=this.state.entries.size;if(!I){if(0===m)return;return this.state.entries.get(-1===l?m-1:0).snapshot.id}const u=this.getEntry(I);if(!u)return;let d=this.getIndex(u);return d<0?void 0:(d=(d+l)%m,d<0&&(d+=m),this.state.entries.get(d).snapshot.id)}setStateSnapshot(I){var l=this;return(0,e.A)(function*(){l.clear();const m=(0,o.B8)().asMutable();for(const C of I.entries)l.entryMap.set(C.snapshot.id,C),m.push(C);const u=I.current?I.current:I.entries.length>0?I.entries[0].snapshot.id:void 0;if(l.updateState({current:u,entries:m.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:I.playback?I.playback.nextSnapshotDelayInMs:_.DefaultNextSnapshotDelayInMs}),l.events.changed.next(void 0),!u)return;const d=l.getEntry(u),s=d&&d.snapshot;return s?(yield l.plugin.state.setSnapshot(s),I.playback&&I.playback.isPlaying&&l.play(!0),s):void 0})()}syncCurrent(I){var l=this;return(0,e.A)(function*(){var m,u;const d=0===l.state.entries.size,s=1===l.state.entries.size&&l.state.current&&l.state.current===l.defaultSnapshotId;if(!d&&!s)return;const C=l.plugin.state.getSnapshot(I?.params),h=(null!==(u=null===(m=I?.params)||void 0===m?void 0:m.image)&&void 0!==u?u:l.plugin.state.snapshotParams.value.image)?yield _.getCanvasImageAsset(l.plugin,`${C.id}-image.png`):void 0;if(d)l.add(_.Entry(C,{name:I?.name,description:I?.description,image:h}));else if(s){const a=l.getEntry(l.state.current);a?.image&&l.plugin.managers.asset.delete(a.image),l.replace(l.state.current,C,{image:h})}l.defaultSnapshotId=C.id})()}getStateSnapshot(I){var l=this;return(0,e.A)(function*(){return yield l.syncCurrent(I),{timestamp:+new Date,version:v.j,name:I&&I.name,description:I&&I.description,current:l.state.current,playback:{isPlaying:!(!I||!I.playOnLoad),nextSnapshotDelayInMs:l.state.nextSnapshotDelayInMs},entries:l.state.entries.valueSeq().toArray()}})()}serialize(I){var l=this;return(0,e.A)(function*(){const m=JSON.stringify(yield l.getStateSnapshot({params:I?.params}),null,2);if(!I?.type||"json"===I.type||"molj"===I.type)return new Blob([m],{type:"application/json;charset=utf-8"});{const u=new Uint8Array((0,A.VH)(m));(0,A.rj)(u,0,m);const d={"state.json":u},s=[];for(const{asset:h,file:a}of l.plugin.managers.asset.assets)s.push([h.id,h]),d[`assets/${h.id}`]=new Uint8Array(yield a.arrayBuffer());if(s.length>0){const h=JSON.stringify(s,null,2),a=new Uint8Array((0,A.VH)(h));(0,A.rj)(a,0,h),d["assets.json"]=a}const C=yield l.plugin.runTask((0,y.qQ)(d));return new Blob([C],{type:"application/zip"})}})()}open(I){var l=this;return(0,e.A)(function*(){try{const m=I.name.toLowerCase();if(m.endsWith("json")||m.endsWith("molj")){const u=yield l.plugin.runTask((0,c.dH)(I,"string")),d=JSON.parse(u);_.isStateSnapshot(d)?yield l.setStateSnapshot(d):_.isStateSnapshot(d.data)?yield l.setStateSnapshot(d.data):yield l.plugin.state.setSnapshot(d)}else{const u=yield l.plugin.runTask((0,c.dH)(I,"zip")),d=Object.create(null);(0,i.IF)(u,(a,S)=>{if("state.json"===S||"assets.json"===S)return;const D=S.substring(S.indexOf("/")+1);d[D]=a});const s=new File([u["state.json"]],"state.json"),C=yield l.plugin.runTask((0,c.dH)(s,"string"));if(u["assets.json"]){const a=new File([u["assets.json"]],"assets.json"),S=JSON.parse(yield l.plugin.runTask((0,c.dH)(a,"string")));for(const[D,R]of S)l.plugin.managers.asset.set(R,new File([d[D]],R.name))}const h=JSON.parse(C);yield l.setStateSnapshot(h)}l.events.opened.next(void 0)}catch(m){console.error(m),l.plugin.log.error("Error reading state")}})()}play(I=!1){if(this.updateState({isPlaying:!0}),I){const l=this.getEntry(this.state.current);if(!l)return void this.next();this.events.changed.next(void 0);const m=l.snapshot;this.timeoutHandle=setTimeout(this.next,typeof m.durationInMs<"u"?m.durationInMs:this.state.nextSnapshotDelayInMs)}else this.next()}stop(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}togglePlay(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()}dispose(){super.dispose(),this.entryMap.clear()}constructor(I){var l;super({current:void 0,entries:(0,o.B8)(),isPlaying:!1,nextSnapshotDelayInMs:_.DefaultNextSnapshotDelayInMs}),l=this,this.plugin=I,this.entryMap=new Map,this.defaultSnapshotId=void 0,this.events={changed:this.ev(),opened:this.ev()},this.timeoutHandle=void 0,this.next=(0,e.A)(function*(){l.timeoutHandle=void 0;const m=l.getNextId(l.state.current,1);if(!m||m===l.state.current)return void l.stop();const u=l.setCurrent(m);yield l.plugin.state.setSnapshot(u),l.state.isPlaying&&(l.timeoutHandle=setTimeout(l.next,typeof u.durationInMs<"u"?u.durationInMs:l.state.nextSnapshotDelayInMs))})}}return _.DefaultNextSnapshotDelayInMs=1500,_})();!function(_){function m(){return(m=(0,e.A)(function*(u,d){if(!u.helpers.viewportScreenshot)return;const s=u.helpers.viewportScreenshot.getPreview(512);if(!s)return;const C=yield(0,O.PG)(s.canvas,"png"),h=new File([C],d),a={kind:"file",id:r.kk.create22(),name:d};return u.managers.asset.set(a,h),a})).apply(this,arguments)}_.Entry=function M(u,d){return{timestamp:+new Date,snapshot:u,...d}},_.isStateSnapshot=function I(u){return!!u&&!!u.timestamp&&!!u.entries},_.getCanvasImageAsset=function l(u,d){return m.apply(this,arguments)}}(b||(b={}))},9039:(tn,Ue,n)=>{"use strict";n.d(Ue,{C:()=>be});var e=n(467),o=n(5019),r=n(6713),t=n(9136),A=n(3916),y=n(1827),c=n(4824),i=n(9909),v=n(2745),O=n(9359),b=n(8277),_=n(3182),M=n(1073),I=n(1832),l=n(261),m=n(190),u=n(3246);const d="overpaint-controls";function s(Te,ie,ue,re,ve){return C.apply(this,arguments)}function C(){return C=(0,e.A)(function*(Te,ie,ue,re,ve){yield function S(Te,ie,ue){return D.apply(this,arguments)}(Te,ie,function(){var ce=(0,e.A)(function*(se,ae,ge){if(ve&&ve.length>0&&!ve.includes(ae.params.values.type.name))return;const Ie=ae.obj.data.sourceData,Le=yield re(Ie.root);if(u.QN.isEmpty(Le)||(0,u.$M)(Le))return;const nt={bundle:t.iZ.Bundle.fromLoci(Le),color:-1===ue?(0,m.Q1)(0):ue,clear:-1===ue};if(ge){const Lt=R([...ge.params.values.layers,nt],Ie);se.to(ge).update(l.l.toBundle(Lt))}else{const je=R([nt],Ie);se.to(ae.transform.ref).apply(M.f.Representation.OverpaintStructureRepresentation3DFromBundle,l.l.toBundle(je),{tags:d})}});return function(se,ae,ge){return ce.apply(this,arguments)}}())}),C.apply(this,arguments)}function D(){return(D=(0,e.A)(function*(Te,ie,ue){const re=Te.state.data,ve=re.build();for(const ce of ie)for(const se of ce.representations){const ae=re.select(I.QX.Generators.ofTransformer(M.f.Representation.OverpaintStructureRepresentation3DFromBundle,se.cell.transform.ref).withTag(d));yield ue(ve,se.cell,ae[0])}return ve.commit({doNotUpdateCurrent:!0})})).apply(this,arguments)}function R(Te,ie){const ue=l.l.ofBundle(Te,ie.root),re=l.l.merge(ue);return l.l.filter(re,ie)}var f=n(1893),p=n(9096),E=n(8010),T=n(7981);const L="clipping-controls";function w(Te,ie,ue,re,ve){return Q.apply(this,arguments)}function Q(){return Q=(0,e.A)(function*(Te,ie,ue,re,ve){yield function G(Te,ie,ue){return V.apply(this,arguments)}(Te,ie,function(){var ce=(0,e.A)(function*(se,ae,ge){if(ve&&ve.length>0&&!ve.includes(ae.params.values.type.name))return;const Ie=ae.obj.data.sourceData,Le=yield re(Ie.root);if(u.QN.isEmpty(Le)||(0,u.$M)(Le))return;const nt={bundle:t.iZ.Bundle.fromLoci(Le),groups:ue};if(ge){const Lt=U([...ge.params.values.layers,nt],Ie);se.to(ge).update(T.l.toBundle(Lt))}else{const je=U([nt],Ie);se.to(ae.transform.ref).apply(M.f.Representation.ClippingStructureRepresentation3DFromBundle,T.l.toBundle(je),{tags:L})}});return function(se,ae,ge){return ce.apply(this,arguments)}}())}),Q.apply(this,arguments)}function V(){return(V=(0,e.A)(function*(Te,ie,ue){const re=Te.state.data,ve=re.build();for(const ce of ie)for(const se of ce.representations){const ae=re.select(I.QX.Generators.ofTransformer(M.f.Representation.ClippingStructureRepresentation3DFromBundle,se.cell.transform.ref).withTag(L));yield ue(ve,se.cell,ae[0])}return ve.commit({doNotUpdateCurrent:!0})})).apply(this,arguments)}function U(Te,ie){const ue=T.l.ofBundle(Te,ie.root),re=T.l.merge(ue);return T.l.filter(re,ie)}var N=n(1965);const k="transparency-controls";function H(Te,ie,ue,re,ve){return $.apply(this,arguments)}function $(){return $=(0,e.A)(function*(Te,ie,ue,re,ve){yield function te(Te,ie,ue){return de.apply(this,arguments)}(Te,ie,function(){var ce=(0,e.A)(function*(se,ae,ge){if(ve&&ve.length>0&&!ve.includes(ae.params.values.type.name))return;const Ie=ae.obj.data.sourceData,Le=yield re(Ie.root);if(u.QN.isEmpty(Le)||(0,u.$M)(Le))return;const nt={bundle:t.iZ.Bundle.fromLoci(Le),value:ue};if(ge){const Lt=ye([...ge.params.values.layers,nt],Ie);se.to(ge).update(N.x.toBundle(Lt))}else{const je=ye([nt],Ie);se.to(ae.transform.ref).apply(M.f.Representation.TransparencyStructureRepresentation3DFromBundle,N.x.toBundle(je),{tags:k})}});return function(se,ae,ge){return ce.apply(this,arguments)}}())}),$.apply(this,arguments)}function de(){return(de=(0,e.A)(function*(Te,ie,ue){const re=Te.state.data,ve=re.build();for(const ce of ie)for(const se of ce.representations){const ae=re.select(I.QX.Generators.ofTransformer(M.f.Representation.TransparencyStructureRepresentation3DFromBundle,se.cell.transform.ref).withTag(k));yield ue(ve,se.cell,ae[0])}return ve.commit({doNotUpdateCurrent:!0})})).apply(this,arguments)}function ye(Te,ie){const ue=N.x.ofBundle(Te,ie.root),re=N.x.merge(ue);return N.x.filter(re,ie)}var j=n(445),Z=n(9213),q=n(6765);const Y="substance-controls";function ee(Te,ie,ue,re,ve){return g.apply(this,arguments)}function g(){return g=(0,e.A)(function*(Te,ie,ue,re,ve){yield function le(Te,ie,ue){return Ae.apply(this,arguments)}(Te,ie,function(){var ce=(0,e.A)(function*(se,ae,ge){if(ve&&ve.length>0&&!ve.includes(ae.params.values.type.name))return;const Ie=ae.obj.data.sourceData,Le=yield re(Ie.root);if(u.QN.isEmpty(Le)||(0,u.$M)(Le))return;const nt={bundle:t.iZ.Bundle.fromLoci(Le),material:ue??(0,q.i)(),clear:!ue};if(ge){const Lt=Be([...ge.params.values.layers,nt],Ie);se.to(ge).update(Z.l.toBundle(Lt))}else{const je=Be([nt],Ie);se.to(ae.transform.ref).apply(M.f.Representation.SubstanceStructureRepresentation3DFromBundle,Z.l.toBundle(je),{tags:Y})}});return function(se,ae,ge){return ce.apply(this,arguments)}}())}),g.apply(this,arguments)}function Ae(){return(Ae=(0,e.A)(function*(Te,ie,ue){const re=Te.state.data,ve=re.build();for(const ce of ie)for(const se of ce.representations){const ae=re.select(I.QX.Generators.ofTransformer(M.f.Representation.SubstanceStructureRepresentation3DFromBundle,se.cell.transform.ref).withTag(Y));yield ue(ve,se.cell,ae[0])}return ve.commit({doNotUpdateCurrent:!0})})).apply(this,arguments)}function Be(Te,ie){const ue=Z.l.ofBundle(Te,ie.root),re=Z.l.merge(ue);return Z.l.filter(re,ie)}var Ce=n(9390),Re=n(3488);const ke="emissive-controls";function we(Te,ie,ue,re,ve){return Oe.apply(this,arguments)}function Oe(){return Oe=(0,e.A)(function*(Te,ie,ue,re,ve){yield function Ne(Te,ie,ue){return K.apply(this,arguments)}(Te,ie,function(){var ce=(0,e.A)(function*(se,ae,ge){if(ve&&ve.length>0&&!ve.includes(ae.params.values.type.name))return;const Ie=ae.obj.data.sourceData,Le=yield re(Ie.root);if(u.QN.isEmpty(Le)||(0,u.$M)(Le))return;const nt={bundle:t.iZ.Bundle.fromLoci(Le),value:ue};if(ge){const Lt=ne([...ge.params.values.layers,nt],Ie);se.to(ge).update(Re.a.toBundle(Lt))}else{const je=ne([nt],Ie);se.to(ae.transform.ref).apply(M.f.Representation.EmissiveStructureRepresentation3DFromBundle,Re.a.toBundle(je),{tags:ke})}});return function(se,ae,ge){return ce.apply(this,arguments)}}())}),Oe.apply(this,arguments)}function K(){return(K=(0,e.A)(function*(Te,ie,ue){const re=Te.state.data,ve=re.build();for(const ce of ie)for(const se of ce.representations){const ae=re.select(I.QX.Generators.ofTransformer(M.f.Representation.EmissiveStructureRepresentation3DFromBundle,se.cell.transform.ref).withTag(ke));yield ue(ve,se.cell,ae[0])}return ve.commit({doNotUpdateCurrent:!0})})).apply(this,arguments)}function ne(Te,ie){const ue=Re.a.ofBundle(Te,ie.root),re=Re.a.merge(ue);return Re.a.filter(re,ie)}class be extends _.e{get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(ie){this.updateState({options:ie}),this.events.optionsUpdated.next(void 0)}setOptions(ie){var ue=this;return(0,e.A)(function*(){const re=ie.interactions!==ue.state.options.interactions;ue.updateState({options:ie}),ue.events.optionsUpdated.next(void 0);const ve=ue.dataState.build();for(const ce of ue.currentStructures)for(const se of ce.components)ue.updateReprParams(ve,se);return ue.plugin.dataTransaction((0,e.A)(function*(){yield ve.commit(),yield ue.plugin.state.updateBehavior(j.b,ce=>{ce.ignoreHydrogens="all"!==ie.hydrogens,ce.ignoreHydrogensVariant="only-polar"===ie.hydrogens?"non-polar":"all",ce.ignoreLight=ie.ignoreLight,ce.material=ie.materialStyle,ce.clip=ie.clipObjects}),re&&(yield ue.updateInterationProps())}))})()}updateReprParams(ie,ue){const{hydrogens:re,visualQuality:ve,ignoreLight:ce,materialStyle:se,clipObjects:ae}=this.state.options,ge="all"!==re,Ie="only-polar"===re?"non-polar":"all";for(const Le of ue.representations){if(Le.cell.transform.transformer!==E.StructureRepresentation3D)continue;const nt=Le.cell.transform.params;(!!nt.type.params.ignoreHydrogens!==ge||nt.type.params.ignoreHydrogensVariant!==Ie||nt.type.params.quality!==ve||nt.type.params.ignoreLight!==ce||!(0,i.bN)(nt.type.params.material,se)||!b.t.areEqual(Ce.B.Params,nt.type.params.clip,ae))&&ie.to(Le.cell).update(je=>{je.type.params.ignoreHydrogens=ge,je.type.params.ignoreHydrogensVariant=Ie,je.type.params.quality=ve,je.type.params.ignoreLight=ce,je.type.params.material=se,je.type.params.clip=ae})}}updateInterationProps(){var ie=this;return(0,e.A)(function*(){var ue,re,ve;for(const ce of ie.currentStructures){const se=r.r.getParams(null===(ue=ce.cell.obj)||void 0===ue?void 0:ue.data);if(ce.properties){const ae=null===(re=ce.properties.cell.transform.params)||void 0===re?void 0:re.properties[r.r.descriptor.name];if(b.t.areEqual(se,ae,ie.state.options.interactions))continue;yield ie.dataState.build().to(ce.properties.cell).update(ge=>{ge.properties[r.r.descriptor.name]=ie.state.options.interactions}).commit()}else{const ae=ie.plugin.customStructureProperties.getParams(null===(ve=ce.cell.obj)||void 0===ve?void 0:ve.data),ge=b.t.getDefaultValues(ae);if(b.t.areEqual(se,ge.properties[r.r.descriptor.name],ie.state.options.interactions))continue;ge.properties[r.r.descriptor.name]=ie.state.options.interactions,yield ie.plugin.builders.structure.insertStructureProperties(ce.cell,ge)}}})()}applyPreset(ie,ue,re){var ve=this;return this.plugin.dataTransaction((0,e.A)(function*(){for(const ce of ie){const se=yield ve.plugin.builders.structure.representation.applyPreset(ce.cell,ue,re);yield ve.syncPreset(ce,se)}}),{canUndo:"Preset"})}syncPreset(ie,ue){if(!ue||!ue.components)return this.clearComponents([ie]);const re=new Set;if((0,O.IF)(ue.components,ae=>{ae&&re.add(ae.ref)}),ue.representations&&(0,O.IF)(ue.representations,ae=>{ae&&re.add(ae.ref)}),0===re.size)return this.clearComponents([ie]);let ve=!1;const ce=this.dataState.build(),se=ae=>{re.has(ae.cell.transform.ref)||(ve=!0,ce.delete(ae.cell))};for(const ae of ie.components){se(ae);for(const ge of ae.representations)se(ge);if(ae.genericRepresentations)for(const ge of ae.genericRepresentations)se(ge)}if(ie.genericRepresentations)for(const ae of ie.genericRepresentations)se(ae);return ve?ce.commit():void 0}clear(ie){return this.clearComponents(ie)}selectThis(ie){var ue;const re=this.plugin.managers.structure.selection;re.clear();for(const ve of ie){const ce=t.oE.toSubStructureElementLoci(ve.structure.cell.obj.data,null===(ue=ve.cell.obj)||void 0===ue?void 0:ue.data);re.fromLoci("set",ce)}}canBeModified(ie){return this.plugin.builders.structure.isComponentTransform(ie.cell)}modifyByCurrentSelection(ie,ue){var re=this;return this.plugin.runTask(c.YZ.create("Modify Component",function(){var ve=(0,e.A)(function*(ce){const se=re.dataState.build();for(const ae of ie){if(!re.canBeModified(ae))continue;const ge=re.plugin.managers.structure.selection.getStructure(ae.structure.cell.obj.data);!ge||0===ge.elementCount||re.modifyComponent(se,ae,ge,ue)}yield re.dataState.updateTree(se,{canUndo:"Modify Selection"}).runInContext(ce)});return function(ce){return ve.apply(this,arguments)}}()))}toggleVisibility(ie,ue){if(0!==ie.length)if(ue){const re=ie[0].representations.indexOf(ue),ve=!ue.cell.state.isHidden;for(const ce of ie){const se=ce.representations[re];se&&(0,y.setSubtreeVisibility)(this.dataState,se.cell.transform.ref,ve)}}else{const re=!ie[0].cell.state.isHidden;for(const ve of ie)(0,y.setSubtreeVisibility)(this.dataState,ve.cell.transform.ref,re)}}removeRepresentations(ie,ue){if(0===ie.length)return;const re=[];if(ue){const ve=ie[0].representations.indexOf(ue);if(ve<0)return;for(const ce of ie)ce.representations[ve]&&re.push(ce.representations[ve])}else for(const ve of ie)for(const ce of ve.representations)re.push(ce);return this.plugin.managers.structure.hierarchy.remove(re,!0)}updateRepresentations(ie,ue,re){if(0===ie.length)return Promise.resolve();const ve=ie[0].representations.indexOf(ue);if(ve<0)return Promise.resolve();const ce=this.dataState.build();for(const se of ie){const ae=se.representations[ve];ae&&ae.cell.transform.transformer===ue.cell.transform.transformer&&ce.to(ae.cell).update(re)}return ce.commit({canUndo:"Update Representation"})}updateRepresentationsTheme(ie,ue){var re,ve,ce,se;if(0===ie.length)return;const ae=this.dataState.build();for(const ge of ie)for(const Ie of ge.representations){const Le=Ie.cell.transform.params,nt="function"==typeof ue?ue(ge,Ie):ue,je="default"===nt.color?(0,f.IZ)(this.plugin,null===(re=ge.structure.cell.obj)||void 0===re?void 0:re.data,Le?.type.name):nt.color?(0,f.IZ)(this.plugin,null===(ve=ge.structure.cell.obj)||void 0===ve?void 0:ve.data,Le?.type.name,nt.color,nt.colorParams):void 0,Lt="default"===nt.size?(0,f.eD)(this.plugin,null===(ce=ge.structure.cell.obj)||void 0===ce?void 0:ce.data,Le?.type.name):nt.color?(0,f.eD)(this.plugin,null===(se=ge.structure.cell.obj)||void 0===se?void 0:se.data,Le?.type.name,nt.size,nt.sizeParams):void 0;(je||Lt)&&ae.to(Ie.cell).update(Je=>{je&&(Je.colorTheme=je),Lt&&(Je.sizeTheme=Lt)})}return ae.commit({canUndo:"Update Theme"})}addRepresentation(ie,ue){var re=this;if(0===ie.length)return;const{hydrogens:ve,visualQuality:ce,ignoreLight:se,materialStyle:ae,clipObjects:ge}=this.state.options,nt={ignoreHydrogens:"all"!==ve,ignoreHydrogensVariant:"only-polar"===ve?"non-polar":"all",quality:ce,ignoreLight:se,material:ae,clip:ge};return this.plugin.dataTransaction((0,e.A)(function*(){for(const je of ie)yield re.plugin.builders.structure.representation.addRepresentation(je.cell,{type:re.plugin.representation.structure.registry.get(ue),typeParams:nt})}),{canUndo:"Add Representation"})}tryFindComponent(ie,ue){var re=this;if(0!==ie.components.length)return this.plugin.runTask(c.YZ.create("Find Component",function(){var ve=(0,e.A)(function*(ce){var se,ae;const ge=null===(se=ie.cell.obj)||void 0===se?void 0:se.data;if(!ge)return;const Ie=t.cv.unionStructure(yield ue.getSelection(re.plugin,ce,ge));for(const Le of ie.components){const nt=null===(ae=Le.cell.obj)||void 0===ae?void 0:ae.data;if(nt&&Le.cell.parent&&(0,A.IP)(Ie,nt))return Le.cell}});return function(ce){return ve.apply(this,arguments)}}()))}add(ie,ue){var re=this;return(0,e.A)(function*(){return re.plugin.dataTransaction((0,e.A)(function*(){const ve=ue||re.currentStructures;if(0===ve.length)return;const{hydrogens:ce,visualQuality:se,ignoreLight:ae,materialStyle:ge,clipObjects:Ie}=re.state.options,je={ignoreHydrogens:"all"!==ce,ignoreHydrogensVariant:"only-polar"===ce?"non-polar":"all",quality:se,ignoreLight:ae,material:ge,clip:Ie},Lt=i.kk.create22();for(const Je of ve){let en;ie.options.checkExisting&&(en=yield re.tryFindComponent(Je,ie.selection)),en||(en=yield re.plugin.builders.structure.tryCreateComponentFromSelection(Je.cell,ie.selection,Lt,{label:ie.options.label||(ie.selection===p.Ou.current?"Custom Selection":"")})),"none"!==ie.representation&&en&&(yield re.plugin.builders.structure.representation.addRepresentation(en,{type:re.plugin.representation.structure.registry.get(ie.representation),typeParams:je}))}}),{canUndo:"Add Selection"})})()}applyTheme(ie,ue){var re=this;return(0,e.A)(function*(){return re.plugin.dataTransaction(function(){var ve=(0,e.A)(function*(ce){const se=ue||re.currentStructures;if(0===se.length)return;const ae=function(){var ge=(0,e.A)(function*(Ie){return t.cv.toLociWithSourceUnits(yield ie.selection.getSelection(re.plugin,ce,Ie))});return function(Le){return ge.apply(this,arguments)}}();for(const ge of se)if("color"===ie.action.name){const Ie=ie.action.params;yield s(re.plugin,ge.components,Ie.color,ae,ie.representations)}else if("resetColor"===ie.action.name)yield s(re.plugin,ge.components,-1,ae,ie.representations);else if("transparency"===ie.action.name){const Ie=ie.action.params;yield H(re.plugin,ge.components,Ie.value,ae,ie.representations)}else if("emissive"===ie.action.name){const Ie=ie.action.params;yield we(re.plugin,ge.components,Ie.value,ae,ie.representations)}else if("material"===ie.action.name){const Ie=ie.action.params;yield ee(re.plugin,ge.components,Ie.material,ae,ie.representations)}else if("resetMaterial"===ie.action.name)yield ee(re.plugin,ge.components,void 0,ae,ie.representations);else if("clipping"===ie.action.name){const Ie=ie.action.params;yield w(re.plugin,ge.components,T.l.Groups.fromNames(Ie.excludeGroups),ae,ie.representations)}});return function(ce){return ve.apply(this,arguments)}}(),{canUndo:"Apply Theme"})})()}modifyComponent(ie,ue,re,ve){var ce,se,ae;const ge=null===(ce=ue.cell.obj)||void 0===ce?void 0:ce.data;if(!ge||("subtract"===ve||"intersect"===ve)&&!(0,A.HK)(ge,re))return;const Ie=null===(se=ue.structure.cell.obj)||void 0===se?void 0:se.data,Le="union"===ve?(0,A.l6)(Ie,[ge,re]):"intersect"===ve?(0,A.jU)(ge,re):(0,A.Kt)(ge,re);if(0===Le.elementCount)ie.delete(ue.cell.transform.ref);else{const je={type:{name:"bundle",params:t.iZ.Bundle.fromSubStructure(Ie,Le)},nullIfEmpty:!0,label:null===(ae=ue.cell.obj)||void 0===ae?void 0:ae.label};ie.to(ue.cell).update(je)}}updateLabel(ie,ue){var re,ve;const ce={type:null===(re=ie.cell.params)||void 0===re?void 0:re.values.type,nullIfEmpty:null===(ve=ie.cell.params)||void 0===ve?void 0:ve.values.nullIfEmpty,label:ue};this.dataState.build().to(ie.cell).update(ce).commit()}get dataState(){return this.plugin.state.data}clearComponents(ie){const ue=this.dataState.build();for(const re of ie)for(const ve of re.components)ue.delete(ve.cell.transform.ref);return ue.commit({canUndo:"Clear Selections"})}constructor(ie){super({options:b.t.getDefaultValues(be.OptionsParams)}),this.plugin=ie,this.events={optionsUpdated:this.ev()}}}!function(Te){function re(ce,se){var ae,ge;return null!==(ae=se?.cell.obj)&&void 0!==ae&&ae.data?ce.representation.structure.registry.getApplicableTypes(null===(ge=se.cell.obj)||void 0===ge?void 0:ge.data):ce.representation.structure.registry.types}function ve(ce,se,ae,ge){const Ie=[...ae,...re(ce,se)];return b.t.Select(Ie[0][0],Ie,{label:ge})}Te.OptionsParams={hydrogens:b.t.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:b.t.Select("auto",o.sF,{description:"Control the visual/rendering quality of representations"}),ignoreLight:b.t.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:q.i.getParam(),clipObjects:b.t.Group(Ce.B.Params),interactions:b.t.Group(r.r.defaultParams,{label:"Non-covalent Interactions"})},Te.getAddParams=function ie(ce,se){const{options:ae}=ce.query.structure.registry;return se={pivot:ce.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...se},{selection:b.t.Select(ae[1][0],ae,{isHidden:se?.hideSelection}),representation:ve(ce,se?.pivot,se?.allowNone?[["none","< Create Later >"]]:[]),options:b.t.Group({label:b.t.Text(""),checkExisting:b.t.Boolean(!!se?.checkExisting,{help:()=>({description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."})})})}},Te.getThemeParams=function ue(ce,se){const{options:ae}=ce.query.structure.registry;return{selection:b.t.Select(ae[1][0],ae,{isHidden:!1}),action:b.t.MappedStatic("color",{color:b.t.Group({color:b.t.Color(v.s.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:b.t.EmptyGroup({label:"Reset Color"}),transparency:b.t.Group({value:b.t.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),emissive:b.t.Group({value:b.t.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:b.t.Group({material:q.i.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:b.t.EmptyGroup({label:"Reset Material"}),clipping:b.t.Group({excludeGroups:b.t.MultiSelect([],b.t.objectToOptions(T.l.Groups.Names))},{isFlat:!0})}),representations:b.t.MultiSelect([],re(ce,se),{emptyValue:"All"})}},Te.getRepresentationTypes=re}(be||(be={}))},2277:(tn,Ue,n)=>{"use strict";n.d(Ue,{G:()=>k});var e=n(467),o=n(1827),r=n(6763),t=n(1832),A=n(9986),y=n(3182),c=n(381),i=n(1073),v=n(6230);function b(){return{trajectories:[],models:[],structures:[],refs:new Map}}function _(H){return{kind:"trajectory",cell:H,version:H.transform.version,models:[]}}function M(H,$){return{kind:"model",cell:H,version:H.transform.version,trajectory:$,structures:[]}}function I(H,$){return{kind:"model-properties",cell:H,version:H.transform.version,model:$}}function l(H,$){return{kind:"model-unitcell",cell:H,version:H.transform.version,model:$}}function m(H,$){return{kind:"structure",cell:H,version:H.transform.version,model:$,components:[]}}function u(H,$){return{kind:"structure-properties",cell:H,version:H.transform.version,structure:$}}function d(H,$){return{kind:"structure-transform",cell:H,version:H.transform.version,structure:$}}function s(H,$){return{kind:"structure-volume-streaming",cell:H,version:H.transform.version,structure:$}}function C(H){return H.transform.tags?[...H.transform.tags].sort().join():H.transform.ref}function h(H,$){return{kind:"structure-component",cell:H,version:H.transform.version,structure:$,key:C(H),representations:[]}}function a(H,$){return{kind:"structure-representation",cell:H,version:H.transform.version,component:$}}function S(H,$){return{kind:"generic-representation",cell:H,version:H.transform.version,parent:$}}function R(H,$,J,W,...te){const de=W(...te);J.push(de),H.hierarchy.refs.set($.transform.ref,de);const ye=H.oldHierarchy.refs.get($.transform.ref);return ye?ye.version!==$.transform.version&&(H.changed=!0):(H.added.add(de.cell.transform.ref),H.changed=!0),de}function f(H,$,J,...W){const te=J(...W);H.hierarchy.refs.set($.transform.ref,te);const de=H.oldHierarchy.refs.get($.transform.ref);return de?de.version!==$.transform.version&&(H.changed=!0):(H.added.add(te.cell.transform.ref),H.changed=!0),te}function p(H){return $=>H.is($.obj)}function E(H,$){return(J,W)=>!$(W)&&H.is(J.obj)}function T(H){return $=>$.transform.transformer===H}function L(){}const w=[[p(c.O.Molecule.Trajectory),(H,$)=>{H.currentTrajectory=R(H,$,H.hierarchy.trajectories,_,$)},H=>H.currentTrajectory=void 0],[E(c.O.Molecule.Model,H=>H.currentModel),(H,$)=>{H.currentModel=H.currentTrajectory?R(H,$,H.currentTrajectory.models,M,$,H.currentTrajectory):f(H,$,M,$),H.hierarchy.models.push(H.currentModel)},H=>H.currentModel=void 0],[T(i.f.Model.CustomModelProperties),(H,$)=>{if(!H.currentModel)return!1;H.currentModel.properties=f(H,$,I,$,H.currentModel)},L],[T(i.f.Representation.ModelUnitcell3D),(H,$)=>{if(!H.currentModel)return!1;H.currentModel.unitcell=f(H,$,l,$,H.currentModel)},L],[E(c.O.Molecule.Structure,H=>H.currentStructure),(H,$)=>{H.currentStructure=H.currentModel?R(H,$,H.currentModel.structures,m,$,H.currentModel):f(H,$,m,$),H.hierarchy.structures.push(H.currentStructure)},H=>H.currentStructure=void 0],[T(i.f.Model.CustomStructureProperties),(H,$)=>{if(!H.currentStructure)return!1;H.currentStructure.properties=f(H,$,u,$,H.currentStructure)},L],[T(i.f.Model.TransformStructureConformation),(H,$)=>{if(!H.currentStructure)return!1;H.currentStructure.transform=f(H,$,d,$,H.currentStructure)},L],[p(v.h),(H,$)=>(H.currentStructure&&(H.currentStructure.volumeStreaming=f(H,$,s,$,H.currentStructure)),!1),L],[(H,$)=>!($.currentComponent||!$.currentStructure||H.transform.transformer.definition.isDecorator)&&c.O.Molecule.Structure.is(H.obj),(H,$)=>{H.currentStructure&&(H.currentComponent=R(H,$,H.currentStructure.components,h,$,H.currentStructure))},H=>H.currentComponent=void 0],[(H,$)=>!H.state.isGhost&&!!$.currentComponent&&c.O.Molecule.Structure.Representation3D.is(H.obj),(H,$)=>(H.currentComponent&&R(H,$,H.currentComponent.representations,a,$,H.currentComponent),!1),L],[H=>!H.state.isGhost&&c.O.isRepresentation3D(H.obj),(H,$)=>{const J=H.currentComponent||H.currentStructure||H.currentModel;J&&(J.genericRepresentations||(J.genericRepresentations=[]),R(H,$,J.genericRepresentations,S,$,J))},L]];function Q(H){if(!H||!H?.parent||!H.parent.cells.has(H.transform.ref))return!1;const{obj:$}=H;return!(!$||$===t.BM.Null||"ok"!==H.status&&"error"!==H.status)}function G(H){const{cell:$}=H;Q($)||(this.changed=!0)}function V(H){U(this,this.tree.transforms.get(H))}function U(H,$){const{state:J}=H,W=J.state.cells.get($.ref);if(!Q(W))return;let te,de=!1;for(const[j,Z,q]of w)if(j(W,J)){if(!1===Z(J,W)){de=!0;break}te=q;break}if(de)return;const ye=H.tree.children.get($.ref);ye&&ye.size&&ye.forEach(V,H),te&&te(J)}class k extends y.N{get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups||(this._currentComponentGroups=k.getComponentGroups(this.selection.structures)),this._currentComponentGroups}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(const $ of this.selection.trajectories)this._currentSelectionSet.add($.cell.transform.ref);for(const $ of this.selection.models)this._currentSelectionSet.add($.cell.transform.ref);for(const $ of this.selection.structures)this._currentSelectionSet.add($.cell.transform.ref);return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){const $=this.plugin.managers.structure.hierarchy.current.structures,J=[];for(const W of $)this.plugin.managers.structure.selection.structureHasSelection(W)&&J.push(W);return J}findStructure($){if(!$)return;const J=this.plugin.helpers.substructureParent.get($);if(!J)return;const W=this.plugin.state.data.selectQ(te=>te.byValue(J).rootOfType(c.O.Molecule.Structure))[0];return W?this.behaviors.selection.value.structures.find(te=>te.cell===W):void 0}syncCurrent($,J){const W=this.seletionSet,te=[];for(const de of $){const ye=de.cell.transform.ref;(W.has(ye)||J.has(ye))&&te.push(de)}return 0===te.length?$.length>0?[$[0]]:[]:te}sync($){if(!$&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree)return void($&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection})));this.state.syncedTree=this.dataState.tree;const J=function O(H,$){const J=function D(H,$){return{state:H,oldHierarchy:$,hierarchy:b(),changed:!1,added:new Set}}(H,$||b());return function N(H,$){U({tree:H,state:$},H.root)}(H.tree,J),$&&$.refs.forEach(G,J),{hierarchy:J.hierarchy,added:J.added,changed:J.changed}}(this.plugin.state.data,this.current);if(!J.changed)return;const{hierarchy:W}=J,te=this.syncCurrent(W.trajectories,J.added),de=this.syncCurrent(W.models,J.added),ye=this.syncCurrent(W.structures,J.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=W,this.state.selection.trajectories=te,this.state.selection.models=de,this.state.selection.structures=ye,$?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:W,trajectories:te,models:de,structures:ye})):this.state.notified=!1}updateCurrent($,J){const W=this.current,te="add"===J?A.M.union(this.seletionSet,new Set($.map(Z=>Z.cell.transform.ref))):A.M.difference(this.seletionSet,new Set($.map(Z=>Z.cell.transform.ref))),de=[],ye=[],j=[];for(const Z of W.trajectories)te.has(Z.cell.transform.ref)&&de.push(Z);for(const Z of W.models)te.has(Z.cell.transform.ref)&&ye.push(Z);for(const Z of W.structures)te.has(Z.cell.transform.ref)&&j.push(Z);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=de,this.state.selection.models=ye,this.state.selection.structures=j,this.behaviors.selection.next({hierarchy:W,trajectories:de,models:ye,structures:j})}remove($,J){if(0===$.length)return;const W=this.plugin.state.data.build();for(const te of $)W.delete("string"==typeof te?te:te.cell.transform.ref);return W.commit({canUndo:!!J&&"Remove"})}toggleVisibility($,J){if(0===$.length)return;const W=void 0!==J?"show"!==J:!$[0].cell.state.isHidden;for(const te of $)(0,o.setSubtreeVisibility)(this.dataState,te.cell.transform.ref,W)}applyPreset($,J,W){var te=this;return this.plugin.dataTransaction((0,e.A)(function*(){for(const de of $)de.models.length>0&&(yield te.clearTrajectory(de)),yield te.plugin.builders.structure.hierarchy.applyPreset(de.cell,J,W)}))}updateStructure($,J){var W=this;return(0,e.A)(function*(){yield W.plugin.dataTransaction((0,e.A)(function*(){const te=t.uF.getDecoratorRoot(W.dataState.tree,$.cell.transform.ref),de=W.dataState.tree.children.get(te).toArray();yield W.remove(de,!1),yield W.plugin.state.updateTransform(W.plugin.state.data,$.cell.transform.ref,J,"Structure Type"),yield W.plugin.builders.structure.representation.applyPreset($.cell.transform.ref,"auto")}),{canUndo:"Structure Type"}),r.a.Camera.Reset(W.plugin)})()}clearTrajectory($){const J=this.dataState.build();for(const W of $.models)J.delete(W.cell);return J.commit()}constructor($){super(),this.plugin=$,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:b(),selection:{trajectories:[],models:[],structures:[]}},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})},this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.subscribe($.state.data.events.changed,J=>{J.inTransaction||$.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe($.behaviors.state.isAnimating,J=>{!J&&!$.behaviors.state.isUpdating.value&&this.sync(!0)})}}var H;(H=k||(k={})).getComponentGroups=function $(W){if(!W.length)return[];if(1===W.length)return W[0].components.map(ye=>[ye]);const te=[],de=new Map;for(const ye of W)for(const j of ye.components){const Z=j.key;if(!Z)continue;let q=de.get(Z);q||(q=[],de.set(Z,q),te.push(q)),q.push(j)}return te},H.getSelectedStructuresDescription=function J(W){var te,de,ye,j,Z,q,Y,ee,g;const{structures:_e}=W.managers.structure.hierarchy.selection;if(0===_e.length)return"";if(1===_e.length){const Be=_e[0],Ce=null===(te=Be.cell.obj)||void 0===te?void 0:te.data;if(!Ce)return(null===(de=Be.cell.obj)||void 0===de?void 0:de.label)||"Structure";const Re=Ce.models[0]||Ce.representativeModel||Ce.masterModel;if(!Re)return(null===(ye=Be.cell.obj)||void 0===ye?void 0:ye.label)||"Structure";const ke=Re.entryId;return null!==(Z=null===(j=Be.model)||void 0===j?void 0:j.trajectory)&&void 0!==Z&&Z.models&&1===Be.model.trajectory.models.length?ke:Be.model?`${null===(q=Be.model.cell.obj)||void 0===q?void 0:q.label} | ${ke}`:ke}const xe=_e[0],le=null===(Y=xe?.model)||void 0===Y?void 0:Y.trajectory;let Ae=!0;for(const Be of _e)if((null===(ee=Be?.model)||void 0===ee?void 0:ee.trajectory)!==le){Ae=!1;break}return Ae&&le?`${null===(g=le.cell.obj)||void 0===g?void 0:g.label} | ${_e.length} structures`:`${_e.length} structures`}},5995:(tn,Ue,n)=>{"use strict";n.d(Ue,{$T:()=>m,Gu:()=>I});var e=n(467),o=n(9136),r=n(1832),t=n(1073),A=n(6763),y=n(6115),c=n(381),i=n(3182),v=n(8277),O=n(6600),b=n(190);const _="measurement-group",M="measurement-order-label",I={distanceUnitLabel:v.t.Text("\u212b",{isEssential:!0}),textColor:O.w.textColor},l=v.t.getDefaultValues(I);class m extends i.e{stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){const s=r.QX.findTagInSubtree(this.plugin.state.data.tree,r.Cn.RootRef,_),C=this.plugin.state.data.build();return s?C.to(s):C.toRoot().group(t.f.Misc.CreateGroup,{label:"Measurements"},{tags:_})}setOptions(d){var s=this;return(0,e.A)(function*(){s.updateState({options:d})&&s.stateUpdated();const C=s.plugin.state.data.build();for(const h of s.state.distances)C.to(h).update(a=>{a.unitLabel=d.distanceUnitLabel,a.textColor=d.textColor});for(const h of s.state.labels)C.to(h).update(a=>{a.textColor=d.textColor});for(const h of s.state.angles)C.to(h).update(a=>{a.textColor=d.textColor});for(const h of s.state.dihedrals)C.to(h).update(a=>{a.textColor=d.textColor});0!==C.editInfo.count&&(yield A.a.State.Update(s.plugin,{state:s.plugin.state.data,tree:C,options:{doNotLogTiming:!0}}))})()}addDistance(d,s,C){var h=this;return(0,e.A)(function*(){const a=h.plugin.helpers.substructureParent.get(d.structure),S=h.plugin.helpers.substructureParent.get(s.structure);if(!a||!S)return;const D=[a.transform.ref];(0,y.Z2)(D,S.transform.ref);const f=h.getGroup().apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:a.transform.ref,expression:o.iZ.Loci.toExpression(d)},{key:"b",groupId:"b",ref:S.transform.ref,expression:o.iZ.Loci.toExpression(s)}],isTransitive:!0,label:"Distance"},{dependsOn:D,tags:C?.selectionTags}),p=f.apply(t.f.Representation.StructureSelectionsDistance3D,{customText:C?.customText||"",unitLabel:h.state.options.distanceUnitLabel,textColor:h.state.options.textColor,...C?.lineParams,...C?.labelParams,...C?.visualParams},{tags:C?.reprTags}),E=h.plugin.state.data;return yield A.a.State.Update(h.plugin,{state:E,tree:p,options:{doNotLogTiming:!0}}),{selection:f.selector,representation:p.selector}})()}addAngle(d,s,C,h){var a=this;return(0,e.A)(function*(){const S=a.plugin.helpers.substructureParent.get(d.structure),D=a.plugin.helpers.substructureParent.get(s.structure),R=a.plugin.helpers.substructureParent.get(C.structure);if(!S||!D||!R)return;const f=[S.transform.ref];(0,y.Z2)(f,D.transform.ref),(0,y.Z2)(f,R.transform.ref);const E=a.getGroup().apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:S.transform.ref,expression:o.iZ.Loci.toExpression(d)},{key:"b",ref:D.transform.ref,expression:o.iZ.Loci.toExpression(s)},{key:"c",ref:R.transform.ref,expression:o.iZ.Loci.toExpression(C)}],isTransitive:!0,label:"Angle"},{dependsOn:f,tags:h?.selectionTags}),T=E.apply(t.f.Representation.StructureSelectionsAngle3D,{customText:h?.customText||"",textColor:a.state.options.textColor,...h?.lineParams,...h?.labelParams,...h?.visualParams},{tags:h?.reprTags}),L=a.plugin.state.data;return yield A.a.State.Update(a.plugin,{state:L,tree:T,options:{doNotLogTiming:!0}}),{selection:E.selector,representation:T.selector}})()}addDihedral(d,s,C,h,a){var S=this;return(0,e.A)(function*(){const D=S.plugin.helpers.substructureParent.get(d.structure),R=S.plugin.helpers.substructureParent.get(s.structure),f=S.plugin.helpers.substructureParent.get(C.structure),p=S.plugin.helpers.substructureParent.get(h.structure);if(!(D&&R&&f&&p))return;const E=[D.transform.ref];(0,y.Z2)(E,R.transform.ref),(0,y.Z2)(E,f.transform.ref),(0,y.Z2)(E,p.transform.ref);const L=S.getGroup().apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:D.transform.ref,expression:o.iZ.Loci.toExpression(d)},{key:"b",ref:R.transform.ref,expression:o.iZ.Loci.toExpression(s)},{key:"c",ref:f.transform.ref,expression:o.iZ.Loci.toExpression(C)},{key:"d",ref:p.transform.ref,expression:o.iZ.Loci.toExpression(h)}],isTransitive:!0,label:"Dihedral"},{dependsOn:E,tags:a?.selectionTags}),w=L.apply(t.f.Representation.StructureSelectionsDihedral3D,{customText:a?.customText||"",textColor:S.state.options.textColor,...a?.lineParams,...a?.labelParams,...a?.visualParams},{tags:a?.reprTags}),Q=S.plugin.state.data;return yield A.a.State.Update(S.plugin,{state:Q,tree:w,options:{doNotLogTiming:!0}}),{selection:L.selector,representation:w.selector}})()}addLabel(d,s){var C=this;return(0,e.A)(function*(){const h=C.plugin.helpers.substructureParent.get(d.structure);if(!h)return;const a=[h.transform.ref],D=C.getGroup().apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:h.transform.ref,expression:o.iZ.Loci.toExpression(d)}],isTransitive:!0,label:"Label"},{dependsOn:a,tags:s?.selectionTags}),R=D.apply(t.f.Representation.StructureSelectionsLabel3D,{textColor:C.state.options.textColor,...s?.labelParams,...s?.visualParams},{tags:s?.reprTags}),f=C.plugin.state.data;return yield A.a.State.Update(C.plugin,{state:f,tree:R,options:{doNotLogTiming:!0}}),{selection:D.selector,representation:R.selector}})()}addOrientation(d){var s=this;return(0,e.A)(function*(){const C=[],h=[];for(let f=0,p=d.length;f<p;++f){const E=d[f],T=s.plugin.helpers.substructureParent.get(E.structure);T&&((0,y.Z2)(h,T.transform.ref),C.push({key:`l${f}`,ref:T.transform.ref,expression:o.iZ.Loci.toExpression(E)}))}if(0===C.length)return;const S=s.getGroup().apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:C,isTransitive:!0,label:"Orientation"},{dependsOn:h}),D=S.apply(t.f.Representation.StructureSelectionsOrientation3D),R=s.plugin.state.data;return yield A.a.State.Update(s.plugin,{state:R,tree:D,options:{doNotLogTiming:!0}}),{selection:S.selector,representation:D.selector}})()}addPlane(d){var s=this;return(0,e.A)(function*(){const C=[],h=[];for(let f=0,p=d.length;f<p;++f){const E=d[f],T=s.plugin.helpers.substructureParent.get(E.structure);T&&((0,y.Z2)(h,T.transform.ref),C.push({key:`l${f}`,ref:T.transform.ref,expression:o.iZ.Loci.toExpression(E)}))}if(0===C.length)return;const a=s.getGroup(),S=a.apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:C,isTransitive:!0,label:"Plane"},{dependsOn:h}),D=S.apply(t.f.Representation.StructureSelectionsPlane3D),R=s.plugin.state.data;return yield A.a.State.Update(s.plugin,{state:R,tree:a,options:{doNotLogTiming:!0}}),{selection:S.selector,representation:D.selector}})()}addOrderLabels(d){var s=this;return(0,e.A)(function*(){const C=s.getGroup(),h=s.plugin.state.data.select(r.QX.Generators.ofType(c.O.Molecule.Structure.Selections).withTag(M));for(const D of h)C.delete(D);let a=1;for(const D of d){const R=s.plugin.helpers.substructureParent.get(D.structure);if(!R)continue;const f=[R.transform.ref];C.apply(t.f.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:R.transform.ref,expression:o.iZ.Loci.toExpression(D)}],isTransitive:!0,label:"Order"},{dependsOn:f,tags:M}).apply(t.f.Representation.StructureSelectionsLabel3D,{textColor:b.Q1.fromRgb(255,255,255),borderColor:b.Q1.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:""+a++},{tags:M})}const S=s.plugin.state.data;return yield A.a.State.Update(s.plugin,{state:S,tree:C,options:{doNotLogTiming:!0}}),{representation:C.selector}})()}getTransforms(d){const s=this.plugin.state.data,C=r.QX.findTagInSubtree(s.tree,r.Cn.RootRef,_),h=C?s.select(r.QX.Generators.ofTransformer(d,C)):this._empty;return 0===h.length?this._empty:h}sync(){const d=[];for(const C of this.getTransforms(t.f.Representation.StructureSelectionsLabel3D)){const h=C.obj.tags;(!h||!h.includes(M))&&d.push(C)}this.updateState({labels:d,distances:this.getTransforms(t.f.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(t.f.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(t.f.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(t.f.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(t.f.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}constructor(d){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:l}),this.plugin=d,this.behaviors={state:this.ev.behavior(this.state)},this._empty=[],d.state.data.events.changed.subscribe(s=>{s.inTransaction||d.behaviors.state.isAnimating.value||this.sync()}),d.behaviors.state.isAnimating.subscribe(s=>{!s&&!d.behaviors.state.isUpdating.value&&this.sync()})}}},9012:(tn,Ue,n)=>{"use strict";n.d(Ue,{L:()=>a});var e=n(1827),o=n(3182),r=n(381),t=n(1832);function y(){return{volumes:[],lazyVolumes:[],refs:new Map}}function c(S){return{kind:"volume",cell:S,version:S.transform.version,representations:[]}}function i(S){return{kind:"lazy-volume",cell:S,version:S.transform.version}}function v(S,D){return{kind:"volume-representation",cell:S,version:S.transform.version,volume:D}}function b(S,D,R,f,...p){const E=f(...p);R.push(E),S.hierarchy.refs.set(D.transform.ref,E);const T=S.oldHierarchy.refs.get(D.transform.ref);return T?T.version!==D.transform.version&&(S.changed=!0):(S.added.add(E.cell.transform.ref),S.changed=!0),E}function M(){}const I=[[function _(S,D){return(R,f)=>!D(f)&&S.is(R.obj)}(r.O.Volume.Data,S=>S.currentVolume),(S,D)=>{S.currentVolume=b(S,D,S.hierarchy.volumes,c,D)},S=>S.currentVolume=void 0],[S=>r.O.Volume.Lazy.is(S.obj),(S,D)=>{b(S,D,S.hierarchy.lazyVolumes,i,D)},M],[(S,D)=>!S.state.isGhost&&!!D.currentVolume&&r.O.Volume.Representation3D.is(S.obj),(S,D)=>(S.currentVolume&&b(S,D,S.currentVolume.representations,v,D,S.currentVolume),!1),M]];function l(S){if(!S||!S?.parent||!S.parent.cells.has(S.transform.ref))return!1;const{obj:D}=S;return!(!D||D===t.BM.Null||"ok"!==S.status&&"error"!==S.status)}function m(S){const{cell:D}=S;l(D)||(this.changed=!0)}function u(S){d(this,this.tree.transforms.get(S))}function d(S,D){const{state:R}=S,f=R.state.cells.get(D.ref);if(!l(f))return;let p,E=!1;for(const[L,w,Q]of I)if(L(f,R)){if(!1===w(R,f)){E=!0;break}p=Q;break}if(E)return;const T=S.tree.children.get(D.ref);T&&T.size&&T.forEach(u,S),p&&p(R)}var C=n(3442),h=n(1073);class a extends o.N{get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(D){if(!D&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree)return void(D&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection})));this.state.syncedTree=this.dataState.tree;const R=function A(S,D){const R=function O(S,D){return{state:S,oldHierarchy:D,hierarchy:y(),changed:!1,added:new Set}}(S,D||y());return function s(S,D){d({tree:S,state:D},S.root)}(S.tree,R),D&&D.refs.forEach(m,R),{hierarchy:R.hierarchy,added:R.added,changed:R.changed}}(this.plugin.state.data,this.current);if(!R.changed)return;const{hierarchy:f}=R;this.state.hierarchy=f,this.state.selection=this.state.selection&&f.refs.has(this.state.selection.cell.transform.ref)?f.refs.get(this.state.selection.cell.transform.ref):f.volumes[0],D?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:f,volume:this.state.selection})):this.state.notified=!1}setCurrent(D){this.state.selection=D||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:D||this.state.hierarchy.volumes[0]})}remove(D,R){if(0===D.length)return;const f=this.plugin.state.data.build();for(const p of D)f.delete("string"==typeof p?p:p.cell.transform.ref);return f.commit({canUndo:!!R&&"Remove"})}toggleVisibility(D,R){if(0===D.length)return;const f=void 0!==R?"show"!==R:!D[0].cell.state.isHidden;for(const p of D)(0,e.setSubtreeVisibility)(this.dataState,p.cell.transform.ref,f)}addRepresentation(D,R){var f;return this.dataState.build().to(D.cell).apply(h.f.Representation.VolumeRepresentation3D,(0,C.aK)(this.plugin,null===(f=D.cell.obj)||void 0===f?void 0:f.data,{type:R})).commit({canUndo:"Add Representation"})}constructor(D){super(),this.plugin=D,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:y(),selection:void 0},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})},this.subscribe(D.state.data.events.changed,R=>{R.inTransaction||D.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(D.behaviors.state.isAnimating,R=>{!R&&!D.behaviors.state.isUpdating.value&&this.sync(!0)})}}(a||(a={})).getRepresentationTypes=function D(R,f){var p,E;return null!==(p=f?.cell.obj)&&void 0!==p&&p.data?R.representation.volume.registry.getApplicableTypes(null===(E=f.cell.obj)||void 0===E?void 0:E.data):R.representation.volume.registry.types}},381:(tn,Ue,n)=>{"use strict";n.d(Ue,{H:()=>r,O:()=>o});var o,r,t,e=n(1832);!function(t){function c(m){return t.Create({...m,typeClass:"Representation3D"})}t.Create=e.BM.factory(),t.isRepresentation3D=function A(m){return!!m&&"Representation3D"===m.type.typeClass},t.isBehavior=function y(m){return!!m&&"Behavior"===m.type.typeClass},t.CreateRepresentation3D=c,t.CreateBehavior=function i(m){return t.Create({...m,typeClass:"Behavior"})};class v extends(t.Create({name:"Root",typeClass:"Root"})){}t.Root=v;class O extends(t.Create({name:"Group",typeClass:"Group"})){}let b,_,M,I,l;t.Group=O,function(m){class u extends(t.Create({name:"String Data",typeClass:"Data"})){}m.String=u;class d extends(t.Create({name:"Binary Data",typeClass:"Data"})){}m.Binary=d;class s extends(t.Create({name:"Data Blob",typeClass:"Data"})){}m.Blob=s}(b=t.Data||(t.Data={})),function(m){class u extends(t.Create({name:"JSON Data",typeClass:"Data"})){}m.Json=u;class d extends(t.Create({name:"CIF File",typeClass:"Data"})){}m.Cif=d;class s extends(t.Create({name:"Cube File",typeClass:"Data"})){}m.Cube=s;class C extends(t.Create({name:"PSF File",typeClass:"Data"})){}m.Psf=C;class h extends(t.Create({name:"PRMTOP File",typeClass:"Data"})){}m.Prmtop=h;class a extends(t.Create({name:"TOP File",typeClass:"Data"})){}m.Top=a;class S extends(t.Create({name:"PLY File",typeClass:"Data"})){}m.Ply=S;class D extends(t.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"})){}m.Ccp4=D;class R extends(t.Create({name:"DSN6/BRIX File",typeClass:"Data"})){}m.Dsn6=R;class f extends(t.Create({name:"DX File",typeClass:"Data"})){}m.Dx=f;class p extends(t.Create({name:"Format Blob",typeClass:"Data"})){}m.Blob=p}(_=t.Format||(t.Format={})),function(m){class u extends(t.Create({name:"Coordinates",typeClass:"Object"})){}m.Coordinates=u;class d extends(t.Create({name:"Topology",typeClass:"Object"})){}m.Topology=d;class s extends(t.Create({name:"Model",typeClass:"Object"})){}m.Model=s;class C extends(t.Create({name:"Trajectory",typeClass:"Object"})){}m.Trajectory=C;class h extends(t.Create({name:"Structure",typeClass:"Object"})){}m.Structure=h,function(a){class S extends(c({name:"Structure 3D"})){}a.Representation3D=S;class D extends(t.Create({name:"Structure 3D State",typeClass:"Object"})){}a.Representation3DState=D;class R extends(t.Create({name:"Selections",typeClass:"Object"})){}a.Selections=R}(h=m.Structure||(m.Structure={}))}(M=t.Molecule||(t.Molecule={})),function(m){class u extends(t.Create({name:"Volume",typeClass:"Object"})){}m.Data=u;class d extends(t.Create({name:"Lazy Volume",typeClass:"Object"})){}m.Lazy=d;class s extends(c({name:"Volume 3D"})){}m.Representation3D=s}(I=t.Volume||(t.Volume={})),function(m){class u extends(t.Create({name:"Shape Provider",typeClass:"Object"})){}m.Provider=u;class d extends(c({name:"Shape 3D"})){}m.Representation3D=d}(l=t.Shape||(t.Shape={}))}(o||(o={})),(t=r||(r={})).CreateBuiltIn=e.xE.factory("ms-plugin"),t.BuiltIn=e.xE.builderFactory("ms-plugin")},1073:(tn,Ue,n)=>{"use strict";n.d(Ue,{f:()=>ye});var e={};n.r(e),n.d(e,{CreateGroup:()=>i});var o={};n.r(o),n.d(o,{AssignColorVolume:()=>J,VolumeFromCcp4:()=>V,VolumeFromCube:()=>N,VolumeFromDensityServerCif:()=>H,VolumeFromDsn6:()=>U,VolumeFromDx:()=>k,VolumeFromSegmentationCif:()=>$,VolumeTransform:()=>W});var r=n(6990),t=n(1832),A=n(9909),y=n(8277),c=n(381);const i=c.H.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:c.O.Group,params:{label:y.t.Text("Group"),description:y.t.Optional(y.t.Text(""))}})({apply:({params:j})=>new c.O.Group({},j),update:({oldParams:j,newParams:Z,b:q})=>(0,A.f8)(j,Z)?t.xE.UpdateResult.Unchanged:(q.label=Z.label,q.description=Z.description,t.xE.UpdateResult.Updated)});var S,j,v=n(1855),O=n(467),b=n(5165),_=n(4369),M=n(4824),I=n(5384),l=n(4490),m=n(5732),u=n(702),d=n(6115),s=n(1692);(j=S||(S={})).is=function Z(Y){return"ccp4"===Y?.kind},j.create=function q(Y){return{kind:"ccp4",name:Y.name,data:Y}};var f,D=n(4625);!function(j){j.is=function Z(Y){return"dsn6"===Y?.kind},j.create=function q(Y){return{kind:"dsn6",name:Y.name,data:Y}}}(f||(f={}));var T,p=n(3420);!function(j){j.is=function Z(Y){return"dx"===Y?.kind},j.create=function q(Y){return{kind:"dx",name:Y.name,data:Y}}}(T||(T={}));var G,L=n(6853),w=n(9359);!function(j){j.is=function Z(Y){return"segcif"===Y?.kind},j.create=function q(Y){return{kind:"segcif",name:Y._name,data:Y}}}(G||(G={}));const V=c.H.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:c.O.Format.Ccp4,to:c.O.Volume.Data,params:j=>({voxelSize:y.t.Vec3(_.eB.create(1,1,1)),offset:y.t.Vec3(_.eB.create(0,0,0)),entryId:y.t.Text("")})})({apply:({a:j,params:Z})=>M.YZ.create("Create volume from CCP4/MRC/MAP",function(){var q=(0,O.A)(function*(Y){const ee=yield function a(j,Z){return M.YZ.create("Create Volume",function(){var q=(0,O.A)(function*(Y){const{header:ee,values:g}=j,_e=_.eB.create(ee.xLength,ee.yLength,ee.zLength);Z&&Z.voxelSize&&_.eB.mul(_e,_e,Z.voxelSize);const xe=_.eB.create((0,l.pu)(ee.alpha),(0,l.pu)(ee.beta),(0,l.pu)(ee.gamma)),Ae=I.O8.create((ee.ISPG>65536?0:ee.ISPG)||"P 1",_e,xe),Be=_.eB.create(ee.MAPC-1,ee.MAPR-1,ee.MAPS-1),Ce=_.qY.convertToCanonicalAxisIndicesFastToSlow(Be),Re=[ee.NX,ee.NY,ee.NZ],ke=Ce([ee.NC,ee.NR,ee.NS]),we=function C(j){return 0===j.originX&&0===j.originY&&0===j.originZ?_.eB.create(j.NCSTART,j.NRSTART,j.NSSTART):_.eB.create(j.originX/(j.xLength/j.NX),j.originY/(j.yLength/j.NY),j.originZ/(j.zLength/j.NZ))}(ee);Z?.offset&&_.eB.add(we,we,Z.offset);const Oe=Ce(we),Se=_.eB.create(Oe[0]/Re[0],Oe[1]/Re[1],Oe[2]/Re[2]),Ve=_.eB.create(ke[0]/Re[0],ke[1]/Re[1],ke[2]/Re[2]),Ne=_.qY.Space(ke,_.qY.invertAxisOrder(Be),function h(j){const Z=(0,m.q7)(j);switch(Z){case u.RW.Float32:return Float32Array;case u.RW.Int8:return Int8Array;case u.RW.Int16:return Int16Array;case u.RW.Uint16:return Uint16Array}throw Error(`${Z} is not a supported value format.`)}(ee)),K=_.qY.create(Ne,_.qY.Data1(g)),ne=0===ee.AMIN&&0===ee.AMAX&&0===ee.AMEAN&&0===ee.ARMS;return{label:Z?.label,entryId:Z?.entryId,grid:{transform:{kind:"spacegroup",cell:Ae,fractionalBox:I.DJ.create(Se,_.eB.add(_.eB.zero(),Se,Ve))},cells:K,stats:{min:isNaN(ee.AMIN)||ne?(0,d.GP)(g):ee.AMIN,max:isNaN(ee.AMAX)||ne?(0,d._M)(g):ee.AMAX,mean:isNaN(ee.AMEAN)||ne?(0,d.VR)(g):ee.AMEAN,sigma:isNaN(ee.ARMS)||0===ee.ARMS?(0,d.C2)(g):ee.ARMS}},sourceData:S.create(j),customProperties:new s.v,_propertyData:Object.create(null)}});return function(Y){return q.apply(this,arguments)}}())}(j.data,{...Z,label:j.data.name||j.label}).runInContext(Y);return new c.O.Volume.Data(ee,{label:ee.label||"Volume",description:`Volume ${j.data.header.NX}\xd7${j.data.header.NX}\xd7${j.data.header.NX}`})});return function(Y){return q.apply(this,arguments)}}()),dispose({b:j}){j?.data.customProperties.dispose()}}),U=c.H.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:c.O.Format.Dsn6,to:c.O.Volume.Data,params:j=>({voxelSize:y.t.Vec3(_.eB.create(1,1,1)),entryId:y.t.Text("")})})({apply:({a:j,params:Z})=>M.YZ.create("Create volume from DSN6/BRIX",function(){var q=(0,O.A)(function*(Y){const ee=yield function R(j,Z){return M.YZ.create("Create Volume",function(){var q=(0,O.A)(function*(Y){const{header:ee,values:g}=j,_e=_.eB.create(ee.xlen,ee.ylen,ee.zlen);Z&&Z.voxelSize&&_.eB.mul(_e,_e,Z.voxelSize);const xe=_.eB.create((0,l.pu)(ee.alpha),(0,l.pu)(ee.beta),(0,l.pu)(ee.gamma)),le=I.O8.create("P 1",_e,xe),Ae=[ee.xRate,ee.yRate,ee.zRate],Be=[ee.xExtent,ee.yExtent,ee.zExtent],Ce=[ee.xStart,ee.yStart,ee.zStart],Re=_.eB.create(Ce[0]/Ae[0],Ce[1]/Ae[1],Ce[2]/Ae[2]),ke=_.eB.create(Be[0]/Ae[0],Be[1]/Ae[1],Be[2]/Ae[2]),we=_.qY.Space(Be,[0,1,2],Float32Array),Oe=_.qY.create(we,_.qY.Data1(g));return{label:Z?.label,entryId:Z?.entryId,grid:{transform:{kind:"spacegroup",cell:le,fractionalBox:I.DJ.create(Re,_.eB.add(_.eB.zero(),Re,ke))},cells:Oe,stats:{min:(0,d.GP)(g),max:(0,d._M)(g),mean:(0,d.VR)(g),sigma:void 0!==ee.sigma?ee.sigma:(0,d.C2)(g)}},sourceData:f.create(j),customProperties:new s.v,_propertyData:Object.create(null)}});return function(Y){return q.apply(this,arguments)}}())}(j.data,{...Z,label:j.data.name||j.label}).runInContext(Y);return new c.O.Volume.Data(ee,{label:ee.label||"Volume",description:`Volume ${j.data.header.xExtent}\xd7${j.data.header.yExtent}\xd7${j.data.header.zExtent}`})});return function(Y){return q.apply(this,arguments)}}()),dispose({b:j}){j?.data.customProperties.dispose()}}),N=c.H.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:c.O.Format.Cube,to:c.O.Volume.Data,params:j=>({dataIndex:j?y.t.Select(0,j.data.header.dataSetIds.map((q,Y)=>[Y,`${q}`])):y.t.Numeric(0),entryId:y.t.Text("")})})({apply:({a:j,params:Z})=>M.YZ.create("Create volume from Cube",function(){var q=(0,O.A)(function*(Y){const ee=yield(0,p.C)(j.data,{...Z,label:j.data.name||j.label}).runInContext(Y);return new c.O.Volume.Data(ee,{label:ee.label||"Volume",description:`Volume ${j.data.header.dim[0]}\xd7${j.data.header.dim[1]}\xd7${j.data.header.dim[2]}`})});return function(Y){return q.apply(this,arguments)}}()),dispose({b:j}){j?.data.customProperties.dispose()}}),k=c.H.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:c.O.Format.Dx,to:c.O.Volume.Data})({apply:({a:j})=>M.YZ.create("Parse DX",function(){var Z=(0,O.A)(function*(q){const Y=yield function E(j,Z){return M.YZ.create("Create Volume",(0,O.A)(function*(){const{header:q,values:Y}=j,ee=_.qY.Space(q.dim,[0,1,2],Float64Array),g=_.qY.create(ee,_.qY.Data1(Y)),_e=_.$I.fromTranslation((0,_.$I)(),q.min),xe=_.$I.fromScaling((0,_.$I)(),q.h);return _.$I.mul(_e,_e,xe),{label:Z?.label,entryId:Z?.entryId,grid:{transform:{kind:"matrix",matrix:_e},cells:g,stats:{min:(0,d.GP)(Y),max:(0,d._M)(Y),mean:(0,d.VR)(Y),sigma:(0,d.C2)(Y)}},sourceData:T.create(j),customProperties:new s.v,_propertyData:Object.create(null)}}))}(j.data,{label:j.data.name||j.label}).runInContext(q);return new c.O.Volume.Data(Y,{label:Y.label||"Volume",description:`Volume ${j.data.header.dim[0]}\xd7${j.data.header.dim[1]}\xd7${j.data.header.dim[2]}`})});return function(q){return Z.apply(this,arguments)}}()),dispose({b:j}){j?.data.customProperties.dispose()}}),H=c.H.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:c.O.Format.Cif,to:c.O.Volume.Data,params(j){if(!j)return{blockHeader:y.t.Optional(y.t.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:y.t.Text("")};const Z=j.data.blocks.slice(1);return{blockHeader:y.t.Optional(y.t.Select(Z[0]&&Z[0].header,Z.map(q=>[q.header,q.header]),{description:"Header of the block to parse"})),entryId:y.t.Text("")}}})({isApplicable:j=>j.data.blocks.length>0,apply:({a:j,params:Z})=>M.YZ.create("Parse density-server CIF",function(){var q=(0,O.A)(function*(Y){var ee;const g=Z.blockHeader||j.data.blocks[1].header,_e=j.data.blocks.find(ke=>ke.header===g);if(!_e)throw new Error(`Data block '${[g]}' not found.`);const xe=b.f$.schema.densityServer(_e),le=yield(0,D.G)(xe,{entryId:Z.entryId}).runInContext(Y),[Ae,Be,Ce]=le.grid.cells.space.dimensions,Re={label:null!==(ee=Z.entryId)&&void 0!==ee?ee:xe.volume_data_3d_info.name.value(0),description:`Volume ${Ae}\xd7${Be}\xd7${Ce}`};return new c.O.Volume.Data(le,Re)});return function(Y){return q.apply(this,arguments)}}()),dispose({b:j}){j?.data.customProperties.dispose()}}),$=c.H.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:c.O.Format.Cif,to:c.O.Volume.Data,params(j){const Z=j?.data.blocks.slice(1);return{blockHeader:y.t.Optional(Z?y.t.Select(Z[0]&&Z[0].header,Z.map(Y=>[Y.header,Y.header]),{description:"Header of the block to parse"}):y.t.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:y.t.ObjectList({id:y.t.Numeric(-1),label:y.t.Text("")},Y=>`${Y.id} = ${Y.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:y.t.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:j=>j.data.blocks.length>0,apply:({a:j,params:Z})=>M.YZ.create("Parse segmentation CIF",function(){var q=(0,O.A)(function*(Y){const ee=Z.blockHeader||j.data.blocks[1].header,g=j.data.blocks.find(ke=>ke.header===ee);if(!g)throw new Error(`Data block '${[ee]}' not found.`);const _e=b.f$.schema.segmentation(g),xe={};for(const ke of Z.segmentLabels)xe[ke.id]=ke.label;const le=yield function Q(j,Z){return M.YZ.create("Create Segmentation Volume",function(){var q=(0,O.A)(function*(Y){var ee;const{volume_data_3d_info:g,segmentation_data_3d:_e}=j,xe=I.O8.create(g.spacegroup_number.value(0),_.eB.ofArray(g.spacegroup_cell_size.value(0)),_.eB.scale((0,_.eB)(),_.eB.ofArray(g.spacegroup_cell_angles.value(0)),Math.PI/180)),le=g.axis_order.value(0),Ae=_.qY.convertToCanonicalAxisIndicesFastToSlow(le),Be=Ae(g.sample_count.value(0)),Ce=_.qY.Space(Be,_.qY.invertAxisOrder(le),Float32Array),Re=_.qY.create(Ce,_.qY.Data1(_e.values.toArray({array:Float32Array}))),ke=_.eB.ofArray(Ae(g.origin.value(0))),we=_.eB.ofArray(Ae(g.dimensions.value(0))),Oe={label:Z?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:xe,fractionalBox:I.DJ.create(ke,_.eB.add((0,_.eB)(),ke,we))},cells:Re,stats:{min:0,max:1,mean:0,sigma:1}},sourceData:G.create(j),customProperties:new s.v,_propertyData:{ownerId:Z?.ownerId}};L.f.PickingGranularity.set(Oe,"object");const Se=new Map,Ve=new Map,{segment_id:Ne,set_id:K}=j.segmentation_data_table;for(let Ie=0,Le=Ne.rowCount;Ie<Le;++Ie){const nt=Ne.value(Ie),je=K.value(Ie);0===je||0===nt||(Ve.has(je)||Ve.set(je,new Set),Ve.get(je).add(nt))}Ve.forEach((Ie,Le)=>{Ie.forEach(nt=>{Se.has(nt)||Se.set(nt,new Set),Se.get(nt).add(Le)})});const ne=[0,0,0],be=Re.space.getCoords,Te=Re.data,[ie,ue,re]=Oe.grid.cells.space.dimensions,ve=ie-1,ce=ue-1,se=re-1,ae={};Ve.forEach((Ie,Le)=>{ae[Le]=[ve,ce,se,-1,-1,-1]});for(let Ie=0,Le=Te.length;Ie<Le;++Ie){const nt=Te[Ie];if(0===nt)continue;be(Ie,ne);const je=ae[nt];ne[0]<je[0]&&(je[0]=ne[0]),ne[1]<je[1]&&(je[1]=ne[1]),ne[2]<je[2]&&(je[2]=ne[2]),ne[0]>je[3]&&(je[3]=ne[0]),ne[1]>je[4]&&(je[4]=ne[1]),ne[2]>je[5]&&(je[5]=ne[2])}const ge={};return Se.forEach((Ie,Le)=>{ge[Le]=I.DJ.create(_.eB.create(ve,ce,se),_.eB.create(-1,-1,-1))}),(0,w.IF)(ae,(Ie,Le)=>{Ve.get(parseInt(Le)).forEach(nt=>{const je=ge[nt];Ie[0]<je.min[0]&&(je.min[0]=Ie[0]),Ie[1]<je.min[1]&&(je.min[1]=Ie[1]),Ie[2]<je.min[2]&&(je.min[2]=Ie[2]),Ie[3]>je.max[0]&&(je.max[0]=Ie[3]),Ie[4]>je.max[1]&&(je.max[1]=Ie[4]),Ie[5]>je.max[2]&&(je.max[2]=Ie[5])})}),L.f.Segmentation.set(Oe,{segments:Se,sets:Ve,bounds:ge,labels:null!==(ee=Z?.segmentLabels)&&void 0!==ee?ee:{}}),Oe});return function(Y){return q.apply(this,arguments)}}())}(_e,{segmentLabels:xe,ownerId:Z.ownerId}).runInContext(Y),[Ae,Be,Ce]=le.grid.cells.space.dimensions,Re={label:_e.volume_data_3d_info.name.value(0),description:`Segmentation ${Ae}\xd7${Be}\xd7${Ce}`};return new c.O.Volume.Data(le,Re)});return function(Y){return q.apply(this,arguments)}}()),dispose({b:j}){j?.data.customProperties.dispose()}}),J=c.H.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:c.O.Volume.Data,to:c.O.Volume.Data,isDecorator:!0,params(j,Z){if(!j)return{ref:y.t.Text()};const q=Z.state.data.select(t.QX.Generators.root.subtree().ofType(c.O.Volume.Data).filter(Y=>{var ee;return!(!Y.obj||null!==(ee=Y.obj)&&void 0!==ee&&ee.data.colorVolume||Y.obj===j)}));return 0===q.length?{ref:y.t.Text("",{isHidden:!0})}:{ref:y.t.Select(q[0].transform.ref,q.map(Y=>[Y.transform.ref,Y.obj.label]))}}})({apply:({a:j,params:Z,dependencies:q})=>M.YZ.create("Assign Color Volume",function(){var Y=(0,O.A)(function*(ee){if(!q||!q[Z.ref])throw new Error("Dependency not available.");const _e={...j.data,colorVolume:q[Z.ref].data};return new c.O.Volume.Data(_e,{label:j.label,description:"Volume + Colors"})});return function(ee){return Y.apply(this,arguments)}}())}),W=c.H.BuiltIn({name:"volume-transform",display:{name:"Transform Volume"},isDecorator:!0,from:c.O.Volume.Data,to:c.O.Volume.Data,params:{transform:y.t.MappedStatic("matrix",{matrix:y.t.Group({data:y.t.Mat4(_.$I.identity()),transpose:y.t.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:({newParams:j})=>"matrix"!==j.transform.name,apply({a:j,params:Z}){const q=(0,_.$I)();let Y={...j.data.grid.transform};_.$I.copy(q,Z.transform.params.data),Z.transform.params.transpose&&_.$I.transpose(q,q);const ee="matrix"===j.data.grid.transform.kind?j.data.grid.transform.matrix:L.x.getGridToCartesianTransform(j.data.grid);Y={kind:"matrix",matrix:_.$I.mul((0,_.$I)(),q,ee)};const g={...j.data,grid:{...j.data.grid,transform:Y}};return new c.O.Volume.Data(g,{label:j.label,description:`${j.description} [Transformed]`})}}),ye={Data:r,Misc:e,Model:v,Volume:o,Representation:n(8010),Shape:n(9646)}},6990:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{Download:()=>Vt,DownloadBlob:()=>Wt,ImportJson:()=>Or,ImportString:()=>Ir,LazyVolume:()=>To,ParseBlob:()=>kt,ParseCcp4:()=>Pr,ParseCif:()=>Ot,ParseCube:()=>An,ParseDsn6:()=>or,ParseDx:()=>Nr,ParseJson:()=>Jr,ParsePly:()=>Dr,ParsePrmtop:()=>On,ParsePsf:()=>jn,ParseTop:()=>fr,RawData:()=>yn,ReadFile:()=>Zt});var e=n(467),o=n(5732),r=n(5165),t=n(4824),A=n(355),y=n(1009),c=n(1241);const i=512;function v(un){return{xStart:parseInt(un.substr(10,5)),yStart:parseInt(un.substr(15,5)),zStart:parseInt(un.substr(20,5)),xExtent:parseInt(un.substr(32,5)),yExtent:parseInt(un.substr(38,5)),zExtent:parseInt(un.substr(42,5)),xRate:parseInt(un.substr(52,5)),yRate:parseInt(un.substr(58,5)),zRate:parseInt(un.substr(62,5)),xlen:parseFloat(un.substr(73,10)),ylen:parseFloat(un.substr(83,10)),zlen:parseFloat(un.substr(93,10)),alpha:parseFloat(un.substr(103,10)),beta:parseFloat(un.substr(113,10)),gamma:parseFloat(un.substr(123,10)),divisor:parseFloat(un.substr(138,12)),summand:parseInt(un.substr(155,8)),sigma:parseFloat(un.substr(170,12))}}function O(un,ct){const dt=ct?cn=>un.readInt16LE(2*cn):cn=>un.readInt16BE(2*cn),Yt=1/dt(17);return{xStart:dt(0),yStart:dt(1),zStart:dt(2),xExtent:dt(3),yExtent:dt(4),zExtent:dt(5),xRate:dt(6),yRate:dt(7),zRate:dt(8),xlen:dt(9)*Yt,ylen:dt(10)*Yt,zlen:dt(11)*Yt,alpha:dt(12)*Yt,beta:dt(13)*Yt,gamma:dt(14)*Yt,divisor:dt(15)/100,summand:dt(16),sigma:void 0}}function b(un){const{xExtent:ct,yExtent:dt,zExtent:Yt}=un;return{xBlocks:Math.ceil(ct/8),yBlocks:Math.ceil(dt/8),zBlocks:Math.ceil(Yt/8)}}function M(){return(M=(0,e.A)(function*(un){const{buffer:ct}=yield un.readBuffer(0,i),dt=String.fromCharCode.apply(null,ct),Yt=dt.startsWith(":-)"),cn=Yt||100===ct.readInt16LE(36);return{header:Yt?v(dt):O(ct,cn),littleEndian:cn}})).apply(this,arguments)}function l(){return(l=(0,e.A)(function*(un,ct,dt,Yt){Yt||c.N.flipByteOrderInPlace2(ct.buffer);const{divisor:cn,summand:xn,xExtent:Rn,yExtent:er,zExtent:ir}=un,{xBlocks:Yn,yBlocks:br,zBlocks:vr}=b(un);let Hr=0;for(let Mr=0;Mr<vr;++Mr)for(let Fr=0;Fr<br;++Fr)for(let Sr=0;Sr<Yn;++Sr)for(let Ur=0;Ur<8;++Ur){const Ro=8*Mr+Ur;for(let ro=0;ro<8;++ro){const po=8*Fr+ro;for(let so=0;so<8;++so){const ho=8*Sr+so;if(!(ho<Rn&&po<er&&Ro<ir)){Hr+=8-so;break}dt[(ho*er+po)*ir+Ro]=(ct[Hr]-xn)/cn,++Hr}}}})).apply(this,arguments)}function d(){return d=(0,e.A)(function*(un,ct,dt){yield dt.update({message:"Parsing DSN6/BRIX file..."});const{header:Yt,littleEndian:cn}=yield function _(un){return M.apply(this,arguments)}(un),{buffer:xn}=yield un.readBuffer(i,ct-i),{valueCount:Rn}=function m(un){const{xExtent:ct,yExtent:dt,zExtent:Yt}=un,{xBlocks:cn,yBlocks:xn,zBlocks:Rn}=b(un),ir=8*cn*xn*8*Rn*8;return{count:ir,byteCount:1*ir,valueCount:ct*dt*Yt}}(Yt),er=new Float32Array(Rn);return yield function I(un,ct,dt,Yt){return l.apply(this,arguments)}(Yt,xn,er,cn),{header:Yt,values:er,name:un.name}}),d.apply(this,arguments)}const a=new Set(Object.keys({char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8}));function S(un){if(!a.has(un))throw new Error(`unknown ply type '${un}'`);return un}var R=n(5555),f=n(6651),p=n(3656);function Q(un){switch(un){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return f.VP.Schema.int;case"float":case"double":case"float32":case"float64":return f.VP.Schema.float}}function G(un,ct){const{elements:dt,tokenizer:Yt}=un,{count:cn,properties:xn}=ct,Rn=xn.length,er=[],ir=[],Yn=[],br=new Map;for(let vr=0,Hr=Rn;vr<Hr;++vr){const Mr=R.tM.create(Yt.data,2*cn);Yn.push(Mr)}for(let vr=0,Hr=cn;vr<Hr;++vr)for(let Mr=0,Fr=Rn;Mr<Fr;++Mr)R._F.skipWhitespace(Yt),R._F.markStart(Yt),R._F.eatValue(Yt),R.tM.addUnchecked(Yn[Mr],Yt.tokenStart,Yt.tokenEnd);for(let vr=0,Hr=Rn;vr<Hr;++vr){const{type:Mr,name:Fr}=xn[vr],Sr=(0,p.E7)(Yn[vr],Q(Mr));er.push(Fr),ir.push(Mr),br.set(Fr,Sr)}dt.push({kind:"table",rowCount:cn,propertyNames:er,propertyTypes:ir,getProperty:vr=>br.get(vr)})}function V(un,ct){const{elements:dt,tokenizer:Yt}=un,{count:cn,property:xn}=ct,Rn=R.tM.create(Yt.data,2*cn*3),er=new Uint32Array(cn+1);let ir=0;for(let vr=0,Hr=cn;vr<Hr;++vr){for(R._F.skipWhitespace(Yt),R._F.markStart(Yt);10!==R._F.skipWhitespace(Yt);)++ir,R._F.markStart(Yt),R._F.eatValue(Yt),R.tM.addToken(Rn,Yt);er[vr+1]=ir}const Yn={entries:[],count:0},br=(0,p.E7)(Rn,Q(xn.dataType));dt.push({kind:"list",rowCount:cn,name:xn.name,type:xn.dataType,value:vr=>{const Hr=er[vr]+1,Mr=br.value(Hr-1);for(let Fr=Hr,Sr=Hr+Mr;Fr<Sr;++Fr)Yn.entries[Fr-Hr]=br.value(Fr);return Yn.count=Mr,Yn}})}function N(){return(N=(0,e.A)(function*(un,ct){const dt=function E(un,ct){return{data:un,tokenizer:(0,R._F)(un),runtimeCtx:ct,comments:[],elementSpecs:[],elements:[]}}(un,ct);ct.update({message:"Parsing...",current:0,max:un.length}),function L(un){const{tokenizer:ct,comments:dt,elementSpecs:Yt}=un;!function T(un){const ct=un.data.indexOf("end_header",un.position);if(-1===ct)throw new Error("no 'end_header' record found");un.tokenStart=un.position,un.tokenEnd=ct,un.position=ct,R._F.eatLine(un)}(ct);const cn=R._F.getTokenString(ct).split(/\r?\n/);if("ply"!==cn[0])throw new Error("data not starting with 'ply'");if("format ascii 1.0"!==cn[1])throw new Error("format not 'ascii 1.0'");let xn,Rn,er;function ir(){if(void 0!==xn&&void 0!==Rn&&void 0!==er){let Yn=!1;for(let br=0,vr=er.length;br<vr;++br)if("list"===er[br].kind){Yn=!0;break}Yt.push(Yn?{kind:"list",name:xn,count:Rn,property:er[0]}:{kind:"table",name:xn,count:Rn,properties:er})}}for(let Yn=2,br=cn.length;Yn<br;++Yn){const vr=cn[Yn],Hr=vr.split(" ");if(vr.startsWith("comment"))dt.push(vr.substr(8));else if(vr.startsWith("element"))ir(),er=[],xn=Hr[1],Rn=parseInt(Hr[2]);else if(vr.startsWith("property")){if(void 0===er)throw new Error("properties outside of element");er.push("list"===Hr[1]?{kind:"list",countType:S(Hr[2]),dataType:S(Hr[3]),name:Hr[4]}:{kind:"column",type:S(Hr[1]),name:Hr[2]})}else vr.startsWith("end_header")?ir():console.warn("unknown header line")}}(dt),function w(un){const{elementSpecs:ct}=un;for(let dt=0,Yt=ct.length;dt<Yt;++dt){const cn=ct[dt];"table"===cn.kind?G(un,cn):"list"===cn.kind&&V(un,cn)}}(dt);const{elements:Yt,elementSpecs:cn,comments:xn}=dt,er=function D(un,ct,dt){const Yt=new Map;for(let cn=0,xn=ct.length;cn<xn;++cn)Yt.set(ct[cn],un[cn]);return{comments:dt,elementNames:ct,getElement:cn=>Yt.get(cn)}}(Yt,cn.map(ir=>ir.name),xn);return A.H.success(er)})).apply(this,arguments)}const{readLine:H,skipWhitespace:$,eatValue:J,eatLine:W,markStart:te}=R._F,de=/\s+/,ye=/(^\*|REMARK)*/;function Z(un,ct){return q.apply(this,arguments)}function q(){return(q=(0,e.A)(function*(un,ct){const{tokenizer:dt}=un,Yt=R.tM.create(dt.data,2*ct),cn=R.tM.create(dt.data,2*ct),xn=R.tM.create(dt.data,2*ct),Rn=R.tM.create(dt.data,2*ct),er=R.tM.create(dt.data,2*ct),ir=R.tM.create(dt.data,2*ct),Yn=R.tM.create(dt.data,2*ct),br=R.tM.create(dt.data,2*ct),{position:vr}=dt,Hr=H(dt).trim();dt.position=vr;const Mr=7===Hr.split(de).length,Fr=Mr?6:8,{length:Sr}=dt;let Ur=0;return yield(0,t.yB)(un.runtimeCtx,1e5,void 0,Ro=>{const ro=Math.min(ct-Ur,Ro);for(let po=0;po<ro;++po){for(let so=0;so<Fr;++so)if($(dt),te(dt),J(dt),Mr)switch(so){case 0:R.tM.addUnchecked(Yt,dt.tokenStart,dt.tokenEnd);break;case 1:R.tM.addUnchecked(xn,dt.tokenStart,dt.tokenEnd);break;case 2:R.tM.addUnchecked(er,dt.tokenStart,dt.tokenEnd);break;case 3:R.tM.addUnchecked(ir,dt.tokenStart,dt.tokenEnd);break;case 4:R.tM.addUnchecked(Yn,dt.tokenStart,dt.tokenEnd);break;case 5:R.tM.addUnchecked(br,dt.tokenStart,dt.tokenEnd)}else switch(so){case 0:R.tM.addUnchecked(Yt,dt.tokenStart,dt.tokenEnd);break;case 1:R.tM.addUnchecked(cn,dt.tokenStart,dt.tokenEnd);break;case 2:R.tM.addUnchecked(xn,dt.tokenStart,dt.tokenEnd);break;case 3:R.tM.addUnchecked(Rn,dt.tokenStart,dt.tokenEnd);break;case 4:R.tM.addUnchecked(er,dt.tokenStart,dt.tokenEnd);break;case 5:R.tM.addUnchecked(ir,dt.tokenStart,dt.tokenEnd);break;case 6:R.tM.addUnchecked(Yn,dt.tokenStart,dt.tokenEnd);break;case 7:R.tM.addUnchecked(br,dt.tokenStart,dt.tokenEnd)}W(dt),te(dt)}return Ur+=ro,ro},Ro=>Ro.update({message:"Parsing...",current:dt.position,max:Sr})),{count:ct,atomId:(0,p.do)(Yt)(f.VP.Schema.int),segmentName:Mr?(0,p.do)(xn)(f.VP.Schema.str):(0,p.do)(cn)(f.VP.Schema.str),residueId:(0,p.do)(xn)(f.VP.Schema.int),residueName:Mr?(0,p.do)(xn)(f.VP.Schema.str):(0,p.do)(Rn)(f.VP.Schema.str),atomName:(0,p.do)(er)(f.VP.Schema.str),atomType:(0,p.do)(ir)(f.VP.Schema.str),charge:(0,p.do)(Yn)(f.VP.Schema.float),mass:(0,p.do)(br)(f.VP.Schema.float)}})).apply(this,arguments)}function Y(un,ct){return ee.apply(this,arguments)}function ee(){return(ee=(0,e.A)(function*(un,ct){const{tokenizer:dt}=un,Yt=R.tM.create(dt.data,2*ct),cn=R.tM.create(dt.data,2*ct),{length:xn}=dt;let Rn=0;return yield(0,t.yB)(un.runtimeCtx,10,void 0,er=>{const ir=Math.min(ct-Rn,er);for(let Yn=0;Yn<ir;++Yn)for(let br=0;br<2;++br)switch($(dt),te(dt),J(dt),br){case 0:R.tM.addUnchecked(Yt,dt.tokenStart,dt.tokenEnd);break;case 1:R.tM.addUnchecked(cn,dt.tokenStart,dt.tokenEnd)}return Rn+=ir,ir},er=>er.update({message:"Parsing...",current:dt.position,max:xn})),{count:ct,atomIdA:(0,p.do)(Yt)(f.VP.Schema.int),atomIdB:(0,p.do)(cn)(f.VP.Schema.int)}})).apply(this,arguments)}function g(un,ct){const dt=[];for(let Yt=0;Yt<ct;++Yt){const cn=H(un.tokenizer);dt.push(cn.replace(ye,"").trim())}return dt}function xe(){return(xe=(0,e.A)(function*(un,ct){const dt=(0,R._F)(un),Yt=function j(un,ct){return{tokenizer:un,runtimeCtx:ct}}(dt,ct);let cn,xn,Rn;const er=H(Yt.tokenizer).trim();for(;dt.tokenEnd<dt.length;){const Yn=H(Yt.tokenizer).trim();if(Yn.includes("!NTITLE"))cn=g(Yt,parseInt(Yn.split(de)[0]));else if(Yn.includes("!NATOM")){const br=parseInt(Yn.split(de)[0]);xn=yield Z(Yt,br)}else{if(Yn.includes("!NBOND")){const br=parseInt(Yn.split(de)[0]);Rn=yield Y(Yt,br);break}Yn.includes("!NTHETA")||Yn.includes("!NPHI")||Yn.includes("!NIMPHI")||Yn.includes("!NDON")||Yn.includes("!NACC")||Yn.includes("!NNB")||Yn.includes("!NGRP NST2")||Yn.includes("!MOLNT")||Yn.includes("!NUMLP NUMLPH")||Yn.includes("!NCRTERM")}}return void 0===cn&&(cn=[]),void 0===xn?A.H.error("no atoms data"):void 0===Rn?A.H.error("no bonds data"):A.H.success({id:er,title:cn,atoms:xn,bonds:Rn})})).apply(this,arguments)}var Ae=n(1832),Be=n(3188),Ce=n(8277),Re=n(381),ke=n(1861),we=n(4369),Oe=n(2025);const Se=.529177210859;function ne(un,ct){return t.YZ.create("Parse Cube",function(){var dt=(0,e.A)(function*(Yt){yield Yt.update("Reading header...");const cn=(0,R._F)(un),{header:xn,atoms:Rn}=function Ve(un){const ct=R._F.readLines(un,6),dt=(ro,po)=>{const so=+ct[ro].trim().split(/\s+/g)[po];return Number.isNaN(so)?0:so},Yt=ro=>{const po=dt(ro+2,0),so=Se;return[Math.abs(po),we.eB.create(dt(ro+2,1)*so,dt(ro+2,2)*so,dt(ro+2,3)*so),po]},cn=ct[0].trim(),xn=ct[1].trim(),[Rn,er,ir]=Yt(0),[Yn,br]=Yt(1),[vr,Hr]=Yt(2),[Mr,Fr]=Yt(3),Sr=function Ne(un,ct,dt){const Yt=new Int32Array(ct),cn=new Float64Array(ct),xn=new Float32Array(ct),Rn=new Float32Array(ct),er=new Float32Array(ct);for(let ir=0;ir<ct;ir++){const Yn=R._F.readLine(un).trim().split(/\s+/g);Yt[ir]=+Yn[0],cn[ir]=+Yn[1],xn[ir]=+Yn[2]*dt,Rn[ir]=+Yn[3]*dt,er[ir]=+Yn[4]*dt}return{count:ct,number:f.VP.ofArray({array:Yt,schema:f.VP.Schema.int}),nuclearCharge:f.VP.ofArray({array:cn,schema:f.VP.Schema.float}),x:f.VP.ofArray({array:xn,schema:f.VP.Schema.float}),y:f.VP.ofArray({array:Rn,schema:f.VP.Schema.float}),z:f.VP.ofArray({array:er,schema:f.VP.Schema.float})}}(un,Rn,Se),Ur=[];if(ir>=0){let ro=dt(2,4);0===ro&&(ro=1);for(let po=0;po<ro;po++)Ur.push(po)}else{const ro=R._F.readLine(un).trim().split(/\s+/g);for(let po=0,so=+ro[0];po<so;po++)Ur.push(+ro[po+1])}return{header:{orbitals:ir<0,comment1:cn,comment2:xn,atomCount:Rn,origin:er,dim:we.eB.create(Yn,vr,Mr),basisX:br,basisY:Hr,basisZ:Fr,dataSetIds:Ur},atoms:Sr}}(cn),er=yield function K(un,ct,dt){const Yt=dt.dim[0]*dt.dim[1]*dt.dim[2]*dt.dataSetIds.length,xn=new Float64Array(Yt);let Rn=0;return(0,t.yB)(un,1e6,xn,(er,ir)=>{const Yn=Math.min(Yt,Rn+er);for(let br=Rn;br<Yn;br++)R._F.skipWhitespace(ct),ct.tokenStart=ct.position,R._F.eatValue(ct),ir[br]=(0,Oe.sS)(ct.data,ct.tokenStart,ct.tokenEnd);return Rn=Yn,Yn===Yt?0:1e6},(er,ir,Yn)=>er.update({current:Math.min(Yn,Yt),max:Yt}))}(Yt,cn,xn);return A.H.success({header:xn,atoms:Rn,values:er,name:ct})});return function(Yt){return dt.apply(this,arguments)}}())}var be=n(275);function Te(un){const ct={h:(0,we.eB)()};let dt=0,Yt=0;const cn=/\s+/g;for(;;){const xn=R._F.readLine(un);let Rn;if(xn.startsWith("object 1"))Rn=xn.split(cn),ct.dim=we.eB.create(parseInt(Rn[5]),parseInt(Rn[6]),parseInt(Rn[7]));else if(xn.startsWith("origin"))Rn=xn.split(cn),ct.min=we.eB.create(parseFloat(Rn[1]),parseFloat(Rn[2]),parseFloat(Rn[3]));else if(xn.startsWith("delta"))Rn=xn.split(cn),0===Yt?ct.h[0]=parseFloat(Rn[1]):1===Yt?ct.h[1]=parseFloat(Rn[2]):2===Yt&&(ct.h[2]=parseFloat(Rn[3])),Yt+=1;else if(xn.startsWith("object 3")){dt+=xn.length+1;break}dt+=xn.length+1}return{header:ct,headerByteCount:dt}}function re(){return(re=(0,e.A)(function*(un,ct,dt){yield un.update("Reading header...");const Yt=(0,R._F)(ct),{header:cn}=Te(Yt);yield un.update("Reading values...");const xn=yield function ie(un,ct,dt){const Yt=dt.dim[0]*dt.dim[1]*dt.dim[2],xn=new Float64Array(Yt);let Rn=0;return(0,t.yB)(un,1e6,xn,(er,ir)=>{const Yn=Math.min(Yt,Rn+er);for(let br=Rn;br<Yn;br++)R._F.skipWhitespace(ct),ct.tokenStart=ct.position,R._F.eatValue(ct),ir[br]=(0,Oe.sS)(ct.data,ct.tokenStart,ct.tokenEnd);return Rn=Yn,Yn===Yt?0:1e6},(er,ir,Yn)=>er.update({current:Math.min(Yn,Yt),max:Yt}))}(un,Yt,cn);return A.H.success({header:cn,values:xn,name:dt})})).apply(this,arguments)}function ce(){return(ce=(0,e.A)(function*(un,ct,dt){yield un.update("Reading header...");const Yt=(0,be.ss)(ct,0,1e3),cn=(0,R._F)(Yt),{header:xn,headerByteCount:Rn}=Te(cn);yield un.update("Reading values...");const er=xn.dim[0]*xn.dim[1]*xn.dim[2],ir=new DataView(ct.buffer,ct.byteOffset+Rn),Yn=new Float64Array(er);for(let br=0;br<er;br++)Yn[br]=ir.getFloat64(8*br,!0);return A.H.success({header:xn,values:Yn,name:dt})})).apply(this,arguments)}var ae=n(2745),ge=n(1372);const Le=Object.keys({NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""}),{readLine:nt,markLine:je,trim:Lt}=R._F;function en(un){const{tokenizer:ct}=un,dt=[];for(;ct.tokenEnd<ct.length&&"%"!==ct.data[ct.position];){const Yt=nt(ct).trim();Yt&&dt.push(Yt)}return dt}function Bt(un){const{tokenizer:ct}=un,dt=Object.create(null);Le.forEach(cn=>{dt[cn]=0});let Yt=0;for(;ct.tokenEnd<ct.length&&"%"!==ct.data[ct.position];){const cn=nt(ct),xn=Math.min(Yt+10,32);for(let Rn=0;Yt<xn;++Rn,++Yt)dt[Le[Yt]]=parseInt(cn.substring(8*Rn,8*Rn+8).trim())}return dt}function pn(un,ct,dt,Yt){const{tokenizer:cn}=un,xn=R.tM.create(cn.data,2*ct);let Rn=0;for(;cn.tokenEnd<cn.length&&"%"!==cn.data[cn.position];){cn.tokenStart=cn.position;const er=Math.min(Rn+dt,ct);for(let ir=0;Rn<er;++ir,++Rn){const Yn=cn.position;Lt(cn,cn.position,cn.position+Yt),R.tM.addUnchecked(xn,cn.tokenStart,cn.tokenEnd),cn.position=Yn+Yt}je(cn)}return xn}function mt(){return(mt=(0,e.A)(function*(un,ct){const dt=(0,R._F)(un),Yt=function Je(un,ct){return{tokenizer:un,runtimeCtx:ct}}(dt,ct),cn=Object.create(null);let xn=0;for(;dt.tokenEnd<dt.length;){dt.position-xn>1e5&&ct.shouldUpdate&&(xn=dt.position,yield ct.update({current:dt.position,max:dt.length}));const Rn=nt(Yt.tokenizer).trim();if(Rn.startsWith("%VERSION"))cn.version=Rn.substring(8).trim();else if(Rn.startsWith("%FLAG")){const er=Rn.substring(5).trim();if(!nt(Yt.tokenizer).trim().startsWith("%FORMAT"))throw new Error("expected %FORMAT");if("TITLE"===er)cn.title=en(Yt);else if("POINTERS"===er)cn.pointers=Bt(Yt);else if("ATOM_NAME"===er){const Yn=pn(Yt,cn.pointers.NATOM,20,4);cn.atomName=(0,p.do)(Yn)(f.VP.Schema.str)}else if("CHARGE"===er){const Yn=pn(Yt,cn.pointers.NATOM,5,16);cn.charge=(0,p.do)(Yn)(f.VP.Schema.float)}else if("MASS"===er){const Yn=pn(Yt,cn.pointers.NATOM,5,16);cn.mass=(0,p.do)(Yn)(f.VP.Schema.float)}else if("RESIDUE_LABEL"===er){const Yn=pn(Yt,cn.pointers.NRES,20,4);cn.residueLabel=(0,p.do)(Yn)(f.VP.Schema.str)}else if("RESIDUE_POINTER"===er){const Yn=pn(Yt,cn.pointers.NRES,10,8);cn.residuePointer=(0,p.do)(Yn)(f.VP.Schema.int)}else if("BONDS_INC_HYDROGEN"===er){const Yn=pn(Yt,3*cn.pointers.NBONH,10,8);cn.bondsIncHydrogen=(0,p.do)(Yn)(f.VP.Schema.int)}else if("BONDS_WITHOUT_HYDROGEN"===er){const Yn=pn(Yt,3*cn.pointers.NBONA,10,8);cn.bondsWithoutHydrogen=(0,p.do)(Yn)(f.VP.Schema.int)}else if("RADII"===er){const Yn=pn(Yt,cn.pointers.NATOM,5,16);cn.radii=(0,p.do)(Yn)(f.VP.Schema.float)}else for(;dt.tokenEnd<dt.length&&"%"!==dt.data[dt.position];)je(dt)}}return A.H.success(cn)})).apply(this,arguments)}const Me={nr:f.VP.Schema.Int(),type:f.VP.Schema.Str(),resnr:f.VP.Schema.Int(),residu:f.VP.Schema.Str(),atom:f.VP.Schema.Str(),cgnr:f.VP.Schema.Int(),charge:f.VP.Schema.Float(),mass:f.VP.Schema.Float()},Ke={ai:f.VP.Schema.Int(),aj:f.VP.Schema.Int()},ut={compound:f.VP.Schema.Str(),molCount:f.VP.Schema.Int()},{readLine:Kt,markLine:sn,skipWhitespace:gt,markStart:yt,eatValue:At,eatLine:Gt}=R._F,tt=/\[ (.+) \]/,Mt=/\s+/;function nn(un){const{tokenizer:ct}=un;let dt;for(;ct.tokenEnd<ct.length;){gt(ct);const Yt=ct.data[ct.position];if("["===Yt)break;if(";"!==Yt&&"*"!==Yt){if(void 0!==dt)throw new Error("more than one molName");dt=Kt(ct).split(Mt)[0]}else sn(ct)}if(void 0===dt)throw new Error("missing molName");return dt}function bn(un){const{tokenizer:ct}=un,dt=R.tM.create(ct.data,64),Yt=R.tM.create(ct.data,64),cn=R.tM.create(ct.data,64),xn=R.tM.create(ct.data,64),Rn=R.tM.create(ct.data,64),er=R.tM.create(ct.data,64),ir=R.tM.create(ct.data,64),Yn=R.tM.create(ct.data,64);for(;ct.tokenEnd<ct.length;){gt(ct);const br=ct.data[ct.position];if("["===br)break;if(";"!==br&&"*"!==br){for(let vr=0;vr<8;++vr)switch(gt(ct),yt(ct),At(ct),vr){case 0:R.tM.add(dt,ct.tokenStart,ct.tokenEnd);break;case 1:R.tM.add(Yt,ct.tokenStart,ct.tokenEnd);break;case 2:R.tM.add(cn,ct.tokenStart,ct.tokenEnd);break;case 3:R.tM.add(xn,ct.tokenStart,ct.tokenEnd);break;case 4:R.tM.add(Rn,ct.tokenStart,ct.tokenEnd);break;case 5:R.tM.add(er,ct.tokenStart,ct.tokenEnd);break;case 6:R.tM.add(ir,ct.tokenStart,ct.tokenEnd);break;case 7:R.tM.add(Yn,ct.tokenStart,ct.tokenEnd)}sn(ct)}else sn(ct)}return f.XI.ofColumns(Me,{nr:(0,p.do)(dt)(f.VP.Schema.int),type:(0,p.do)(Yt)(f.VP.Schema.str),resnr:(0,p.do)(cn)(f.VP.Schema.int),residu:(0,p.do)(xn)(f.VP.Schema.str),atom:(0,p.do)(Rn)(f.VP.Schema.str),cgnr:(0,p.do)(er)(f.VP.Schema.int),charge:(0,p.do)(ir)(f.VP.Schema.float),mass:(0,p.do)(Yn)(f.VP.Schema.float)})}function Dn(un){const{tokenizer:ct}=un,dt=R.tM.create(ct.data,64),Yt=R.tM.create(ct.data,64);for(;ct.tokenEnd<ct.length;){gt(ct);const cn=ct.data[ct.position];if("["===cn)break;if(";"!==cn&&"*"!==cn){for(let xn=0;xn<2;++xn)switch(gt(ct),yt(ct),At(ct),xn){case 0:R.tM.add(dt,ct.tokenStart,ct.tokenEnd);break;case 1:R.tM.add(Yt,ct.tokenStart,ct.tokenEnd)}sn(ct)}else sn(ct)}return f.XI.ofColumns(Ke,{ai:(0,p.do)(dt)(f.VP.Schema.int),aj:(0,p.do)(Yt)(f.VP.Schema.int)})}function jt(un){const{tokenizer:ct}=un;let dt;for(;ct.tokenEnd<ct.length;){gt(ct);const Yt=ct.data[ct.position];if("["===Yt)break;if(";"!==Yt&&"*"!==Yt){if(void 0!==dt)throw new Error("more than one system");dt=Kt(ct).trim()}else sn(ct)}if(void 0===dt)throw new Error("missing system");return dt}function It(un){const{tokenizer:ct}=un,dt=R.tM.create(ct.data,64),Yt=R.tM.create(ct.data,64);for(;ct.tokenEnd<ct.length&&(gt(ct),!(ct.position>=ct.length));){const cn=ct.data[ct.position];if("["===cn)break;if(";"!==cn&&"*"!==cn){for(let xn=0;xn<2;++xn)switch(gt(ct),yt(ct),At(ct),xn){case 0:R.tM.add(dt,ct.tokenStart,ct.tokenEnd);break;case 1:R.tM.add(Yt,ct.tokenStart,ct.tokenEnd)}Gt(ct),yt(ct)}else sn(ct)}return f.XI.ofColumns(ut,{compound:(0,p.do)(dt)(f.VP.Schema.str),molCount:(0,p.do)(Yt)(f.VP.Schema.int)})}function Ct(){return(Ct=(0,e.A)(function*(un,ct){const dt=(0,R._F)(un),Yt=function rn(un,ct){return{tokenizer:un,runtimeCtx:ct}}(dt,ct),cn=Object.create(null);let xn=0;cn.compounds={};let Rn={},er="";function ir(){er&&Rn.atoms&&(cn.compounds[er]=Rn,Rn={},er="")}for(;dt.tokenEnd<dt.length;){dt.position-xn>1e5&&ct.shouldUpdate&&(xn=dt.position,yield ct.update({current:dt.position,max:dt.length}));const Yn=Kt(Yt.tokenizer).trim();if(Yn&&"*"!==Yn[0]&&";"!==Yn[0]){if(Yn.startsWith("#include"))throw new Error("#include statements not allowed");if(Yn.startsWith("[")){const br=Yn.match(tt);if(null===br)throw new Error("expected field name");const vr=br[1];if("moleculetype"===vr)ir(),er=nn(Yt);else if("atoms"===vr)Rn.atoms=bn(Yt);else if("bonds"===vr)Rn.bonds=Dn(Yt);else if("system"===vr)cn.system=jt(Yt);else if("molecules"===vr)ir(),cn.molecules=It(Yt);else for(;dt.tokenEnd<dt.length&&"["!==dt.data[dt.position];)sn(dt)}}}return A.H.success(cn)})).apply(this,arguments)}const Vt=Re.H.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[Re.O.Root],to:[Re.O.Data.String,Re.O.Data.Binary],params:{url:Ce.t.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:Ce.t.Optional(Ce.t.Text("")),isBinary:Ce.t.Optional(Ce.t.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:({params:un,cache:ct},dt)=>t.YZ.create("Download",function(){var Yt=(0,e.A)(function*(cn){const xn=ke.V.getUrlAsset(dt.managers.asset,un.url),Rn=yield dt.managers.asset.resolve(xn,un.isBinary?"binary":"string").runInContext(cn);return ct.asset=Rn,un.isBinary?new Re.O.Data.Binary(Rn.data,{label:un.label?un.label:xn.url}):new Re.O.Data.String(Rn.data,{label:un.label?un.label:xn.url})});return function(cn){return Yt.apply(this,arguments)}}()),dispose({cache:un}){var ct;null===(ct=un?.asset)||void 0===ct||ct.dispose()},update:({oldParams:un,newParams:ct,b:dt})=>un.url!==ct.url||un.isBinary!==ct.isBinary?Ae.xE.UpdateResult.Recreate:un.label!==ct.label?(dt.label=ct.label||("string"==typeof ct.url?ct.url:ct.url.url),Ae.xE.UpdateResult.Updated):Ae.xE.UpdateResult.Unchanged}),Wt=Re.H.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:Re.O.Root,to:Re.O.Data.Blob,params:{sources:Ce.t.ObjectList({id:Ce.t.Text("",{label:"Unique ID"}),url:Ce.t.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:Ce.t.Optional(Ce.t.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:Ce.t.Optional(Ce.t.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},un=>`${un.id}: ${un.url}`),maxConcurrency:Ce.t.Optional(Ce.t.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:({params:un,cache:ct},dt)=>t.YZ.create("Download Blob",function(){var Yt=(0,e.A)(function*(cn){const xn=[],Rn=yield(0,Be.Ui)(cn,dt.managers.asset,un.sources,un.maxConcurrency||4),er=[];for(let ir=0;ir<Rn.length;ir++){const Yn=Rn[ir],br=un.sources[ir];"error"===Yn.kind?dt.log.warn(`Download ${Yn.id} (${br.url}) failed: ${Yn.error}`):(er.push(Yn.result),xn.push(br.isBinary?{id:Yn.id,kind:"binary",data:Yn.result.data}:{id:Yn.id,kind:"string",data:Yn.result.data}))}return ct.assets=er,new Re.O.Data.Blob(xn,{label:"Data Blob",description:`${xn.length} ${1===xn.length?"entry":"entries"}`})});return function(cn){return Yt.apply(this,arguments)}}()),dispose({cache:un},ct){const dt=un?.assets;if(dt)for(const Yt of dt)Yt.dispose()}}),yn=Re.H.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[Re.O.Root],to:[Re.O.Data.String,Re.O.Data.Binary],params:{data:Ce.t.Value("",{isHidden:!0}),label:Ce.t.Optional(Ce.t.Text(""))}})({apply:({params:un})=>t.YZ.create("Raw Data",(0,e.A)(function*(){return"string"==typeof un.data?new Re.O.Data.String(un.data,{label:un.label?un.label:"String"}):Array.isArray(un.data)||un.data instanceof ArrayBuffer?new Re.O.Data.Binary(new Uint8Array(un.data),{label:un.label?un.label:"Binary"}):un.data instanceof Uint8Array?new Re.O.Data.Binary(un.data,{label:un.label?un.label:"Binary"}):void(0,ge.dr)(un.data)})),update:({oldParams:un,newParams:ct,b:dt})=>un.data!==ct.data?Ae.xE.UpdateResult.Recreate:un.label!==ct.label?(dt.label=ct.label||dt.label,Ae.xE.UpdateResult.Updated):Ae.xE.UpdateResult.Unchanged,customSerialization:{toJSON(un){if("string"==typeof un.data||Array.isArray(un.data))return un;if(un.data instanceof ArrayBuffer){const ct=new Uint8Array(un.data),dt=new Array(ct.length);for(let Yt=0,cn=ct.length;Yt<cn;Yt++)dt[Yt]=ct[Yt];return{data:dt,label:un.label}}if(un.data instanceof Uint8Array){const ct=new Array(un.data.length);for(let dt=0,Yt=un.data.length;dt<Yt;dt++)ct[dt]=un.data[dt];return{data:ct,label:un.label}}},fromJSON:un=>un}}),Zt=Re.H.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:Re.O.Root,to:[Re.O.Data.String,Re.O.Data.Binary],params:{file:Ce.t.File(),label:Ce.t.Optional(Ce.t.Text("")),isBinary:Ce.t.Optional(Ce.t.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:({params:un,cache:ct},dt)=>t.YZ.create("Open File",function(){var Yt=(0,e.A)(function*(cn){if(null===un.file)return dt.log.error("No file(s) selected"),Ae.BM.Null;const xn=yield dt.managers.asset.resolve(un.file,un.isBinary?"binary":"string").runInContext(cn);return ct.asset=xn,un.isBinary?new Re.O.Data.Binary(xn.data,{label:un.label?un.label:un.file.name}):new Re.O.Data.String(xn.data,{label:un.label?un.label:un.file.name})});return function(cn){return Yt.apply(this,arguments)}}()),dispose({cache:un}){var ct;null===(ct=un?.asset)||void 0===ct||ct.dispose()},update({oldParams:un,newParams:ct,b:dt}){var Yt;return un.label!==ct.label?(dt.label=ct.label||(null===(Yt=un.file)||void 0===Yt?void 0:Yt.name)||"",Ae.xE.UpdateResult.Updated):Ae.xE.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user loaded files."})}),kt=Re.H.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:Re.O.Data.Blob,to:Re.O.Format.Blob,params:{formats:Ce.t.ObjectList({id:Ce.t.Text("",{label:"Unique ID"}),format:Ce.t.Select("cif",[["cif","cif"]])},un=>`${un.id}: ${un.format}`)}})({apply:({a:un,params:ct},dt)=>t.YZ.create("Parse Blob",function(){var Yt=(0,e.A)(function*(cn){const xn=new Map;for(const er of ct.formats)xn.set(er.id,er.format);const Rn=[];for(const er of un.data){if(!xn.has(er.id))continue;const ir=yield("string"===er.kind?r.f$.parse(er.data):r.f$.parseBinary(er.data)).runInContext(cn);if(ir.isError)throw new Error(`${er.id}: ${ir.message}`);Rn.push({id:er.id,kind:"cif",data:ir.result})}return new Re.O.Format.Blob(Rn,{label:"Format Blob",description:`${Rn.length} ${1===Rn.length?"entry":"entries"}`})});return function(cn){return Yt.apply(this,arguments)}}())}),Ot=Re.H.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[Re.O.Data.String,Re.O.Data.Binary],to:Re.O.Format.Cif})({apply:({a:un})=>t.YZ.create("Parse CIF",function(){var ct=(0,e.A)(function*(dt){const Yt=yield("string"==typeof un.data?r.f$.parse(un.data):r.f$.parseBinary(un.data)).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return 0===Yt.result.blocks.length?Ae.BM.Null:new Re.O.Format.Cif(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),An=Re.H.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:Re.O.Data.String,to:Re.O.Format.Cube})({apply:({a:un})=>t.YZ.create("Parse Cube",function(){var ct=(0,e.A)(function*(dt){const Yt=yield ne(un.data,un.label).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Cube(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),jn=Re.H.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[Re.O.Data.String],to:Re.O.Format.Psf})({apply:({a:un})=>t.YZ.create("Parse PSF",function(){var ct=(0,e.A)(function*(dt){const Yt=yield function le(un){return t.YZ.create("Parse PSF",function(){var ct=(0,e.A)(function*(dt){return yield function _e(un,ct){return xe.apply(this,arguments)}(un,dt)});return function(dt){return ct.apply(this,arguments)}}())}(un.data).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Psf(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),On=Re.H.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[Re.O.Data.String],to:Re.O.Format.Prmtop})({apply:({a:un})=>t.YZ.create("Parse PRMTOP",function(){var ct=(0,e.A)(function*(dt){const Yt=yield function _t(un){return t.YZ.create("Parse PRMTOP",function(){var ct=(0,e.A)(function*(dt){return yield function $e(un,ct){return mt.apply(this,arguments)}(un,dt)});return function(dt){return ct.apply(this,arguments)}}())}(un.data).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Prmtop(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),fr=Re.H.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[Re.O.Data.String],to:Re.O.Format.Top})({apply:({a:un})=>t.YZ.create("Parse TOP",function(){var ct=(0,e.A)(function*(dt){const Yt=yield function $t(un){return t.YZ.create("Parse TOP",function(){var ct=(0,e.A)(function*(dt){return yield function Dt(un,ct){return Ct.apply(this,arguments)}(un,dt)});return function(dt){return ct.apply(this,arguments)}}())}(un.data).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Top(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),Dr=Re.H.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[Re.O.Data.String],to:Re.O.Format.Ply})({apply:({a:un})=>t.YZ.create("Parse PLY",function(){var ct=(0,e.A)(function*(dt){const Yt=yield function k(un){return t.YZ.create("Parse PLY",function(){var ct=(0,e.A)(function*(dt){return yield function U(un,ct){return N.apply(this,arguments)}(un,dt)});return function(dt){return ct.apply(this,arguments)}}())}(un.data).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Ply(Yt.result,{label:Yt.result.comments[0]||"PLY Data"})});return function(dt){return ct.apply(this,arguments)}}())}),Pr=Re.H.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[Re.O.Data.Binary],to:Re.O.Format.Ccp4})({apply:({a:un})=>t.YZ.create("Parse CCP4/MRC/MAP",function(){var ct=(0,e.A)(function*(dt){const Yt=yield o.qg(un.data,un.label).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Ccp4(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),or=Re.H.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[Re.O.Data.Binary],to:Re.O.Format.Dsn6})({apply:({a:un})=>t.YZ.create("Parse DSN6/BRIX",function(){var ct=(0,e.A)(function*(dt){const Yt=yield function C(un,ct){return function s(un,ct){return t.YZ.create("Parse DSN6/BRIX",function(){var dt=(0,e.A)(function*(Yt){try{return A.H.success(yield function u(un,ct,dt){return d.apply(this,arguments)}(un,ct,Yt))}catch(cn){return A.H.error(cn)}});return function(Yt){return dt.apply(this,arguments)}}())}(y.L.fromBuffer(c.N.fromUint8Array(un),ct),un.length)}(un.data,un.label).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Dsn6(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),Nr=Re.H.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[Re.O.Data.Binary,Re.O.Data.String],to:Re.O.Format.Dx})({apply:({a:un})=>t.YZ.create("Parse DX",function(){var ct=(0,e.A)(function*(dt){const Yt=yield function se(un,ct){return t.YZ.create("Parse DX",dt=>"string"==typeof un?function ue(un,ct,dt){return re.apply(this,arguments)}(dt,un,ct):function ve(un,ct,dt){return ce.apply(this,arguments)}(dt,un,ct))}(un.data,un.label).runInContext(dt);if(Yt.isError)throw new Error(Yt.message);return new Re.O.Format.Dx(Yt.result)});return function(dt){return ct.apply(this,arguments)}}())}),Ir=Re.H.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:Re.O.Root,to:Re.O.Data.String,params:{data:Ce.t.Value(""),label:Ce.t.Optional(Ce.t.Text(""))}})({apply:({params:{data:un,label:ct}})=>new Re.O.Data.String(un,{label:ct||""}),update:({oldParams:un,newParams:ct,b:dt})=>un.data!==ct.data?Ae.xE.UpdateResult.Recreate:un.label!==ct.label?(dt.label=ct.label||"",Ae.xE.UpdateResult.Updated):Ae.xE.UpdateResult.Unchanged,isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported strings."})}),Or=Re.H.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:Re.O.Root,to:Re.O.Format.Json,params:{data:Ce.t.Value({}),label:Ce.t.Optional(Ce.t.Text(""))}})({apply:({params:{data:un,label:ct}})=>new Re.O.Format.Json(un,{label:ct||""}),update:({oldParams:un,newParams:ct,b:dt})=>un.data!==ct.data?Ae.xE.UpdateResult.Recreate:un.label!==ct.label?(dt.label=ct.label||"",Ae.xE.UpdateResult.Updated):Ae.xE.UpdateResult.Unchanged,isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported JSON."})}),Jr=Re.H.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[Re.O.Data.String],to:Re.O.Format.Json})({apply:({a:un})=>t.YZ.create("Parse JSON",function(){var ct=(0,e.A)(function*(dt){const Yt=yield new Response(un.data).json();return new Re.O.Format.Json(Yt)});return function(dt){return ct.apply(this,arguments)}}())}),To=Re.H.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:Re.O.Root,to:Re.O.Volume.Lazy,params:{url:Ce.t.Url(""),isBinary:Ce.t.Boolean(!1),format:Ce.t.Text("ccp4"),entryId:Ce.t.Value("",{isHidden:!0}),isovalues:Ce.t.ObjectList({type:Ce.t.Text("relative"),value:Ce.t.Numeric(0),color:Ce.t.Color(ae.s.black),alpha:Ce.t.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:Ce.t.Numeric(0)},un=>`${un.type} ${un.value}`)}})({apply:({params:ct})=>t.YZ.create("Lazy Volume",function(){var dt=(0,e.A)(function*(Yt){const cn=Array.isArray(ct.entryId)?ct.entryId.join(", "):ct.entryId;return new Re.O.Volume.Lazy(ct,{label:`${cn||ct.url}`,description:"Lazy Volume"})});return function(Yt){return dt.apply(this,arguments)}}())})},1855:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{CoordinatesFromDcd:()=>Ht,CoordinatesFromNctraj:()=>kn,CoordinatesFromTrr:()=>ar,CoordinatesFromXtc:()=>Gn,CustomModelProperties:()=>ds,CustomStructureProperties:()=>ze,ModelFromTrajectory:()=>ri,MultiStructureSelectionFromExpression:()=>Wr,ShapeFromPly:()=>Rt,StructureComplexElement:()=>Ki,StructureComplexElementTypes:()=>Di,StructureComponent:()=>Mi,StructureFromModel:()=>Lo,StructureFromTrajectory:()=>fo,StructureSelectionFromBundle:()=>zo,StructureSelectionFromExpression:()=>hr,StructureSelectionFromScript:()=>no,TopologyFromPrmtop:()=>sr,TopologyFromPsf:()=>ur,TopologyFromTop:()=>Jn,TrajectoryFromBlob:()=>at,TrajectoryFromCifCore:()=>mo,TrajectoryFromCube:()=>Rr,TrajectoryFromGRO:()=>Cn,TrajectoryFromMOL:()=>vn,TrajectoryFromMOL2:()=>pr,TrajectoryFromMmCif:()=>Nt,TrajectoryFromModelAndCoordinates:()=>et,TrajectoryFromPDB:()=>qt,TrajectoryFromSDF:()=>nr,TrajectoryFromXYZ:()=>Un,TransformStructureConformation:()=>_o});var e=n(467),o=n(355),r=n(4824),t=n(3897);var c=n(6651),i=n(5555),v=n(2025);function M(X,pe){return{tokenizer:X,header:{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]},numberOfAtoms:0,runtimeCtx:pe}}function I(X){const{tokenizer:pe,header:De}=X;let Ee=i._F.readLine(pe);0===Ee.trim().length&&(Ee=i._F.readLine(pe));const qe=Ee.lastIndexOf("t=");qe>=0?(De.timeInPs=parseFloat(Ee.substring(qe+2)),De.title=Ee.substring(0,qe).trim(),De.title&&","===De.title[De.title.length-1]&&(De.title=De.title.substring(0,De.title.length-1))):De.title=Ee}function l(X){const{tokenizer:pe}=X;i._F.markLine(pe);const De=i._F.getTokenString(pe);X.numberOfAtoms=parseInt(De)}function m(X){return u.apply(this,arguments)}function u(){return(u=(0,e.A)(function*(X){const{tokenizer:pe,numberOfAtoms:De}=X,Ee=yield i._F.readLinesAsync(pe,De,X.runtimeCtx,1e5),bt=pe.data.substring(Ee.indices[0],Ee.indices[1]).substring(20).match(/\.\d+/g),xt=6===bt.length;X.header.hasVelocities=xt,X.header.precision.position=bt[0].length-1,X.header.precision.velocity=xt?bt[3].length-1:0;const dn=X.header.precision.position+5,In=20+3*dn,Tn=X.header.precision.velocity+4,_n=function O(X){return function(pe,De,Ee){return function b(X,pe,De,Ee){const{data:qe,indices:bt,count:xt}=X,{valueType:hn}=Ee,dn="str"===hn?In=>{const Tn=bt[2*In]+pe,_n=bt[2*In+1];if(Tn>=_n)return"";let Wn=Tn+De;return Wn>_n&&(Wn=_n),(0,i.qk)(qe,Tn,Wn)}:"int"===hn?In=>{const Tn=bt[2*In]+pe;return Tn>bt[2*In+1]?0:(0,v.jj)(qe,Tn,Tn+De)}:In=>{const Tn=bt[2*In]+pe;return Tn>bt[2*In+1]?0:(0,v.Al)(qe,Tn,Tn+De)};return{schema:Ee,__array:void 0,isDefined:!0,rowCount:xt,value:dn,valueKind:In=>0,toArray:In=>c.iu.createAndFillArray(xt,dn,In),areValuesEqual:(In,Tn)=>dn(In)===dn(Tn)}}(X,pe,De,Ee)}}(Ee),Wn=c.VP.Undefined(X.numberOfAtoms,c.VP.Schema.float);return{count:X.numberOfAtoms,residueNumber:_n(0,5,c.VP.Schema.int),residueName:_n(5,5,c.VP.Schema.str),atomName:_n(10,5,c.VP.Schema.str),atomNumber:_n(15,5,c.VP.Schema.int),x:_n(20,dn,c.VP.Schema.float),y:_n(20+dn,dn,c.VP.Schema.float),z:_n(20+2*dn,dn,c.VP.Schema.float),vx:xt?_n(In,Tn,c.VP.Schema.float):Wn,vy:xt?_n(In+Tn,Tn,c.VP.Schema.float):Wn,vz:xt?_n(In+2*Tn,Tn,c.VP.Schema.float):Wn}})).apply(this,arguments)}function d(X){const{tokenizer:pe}=X,De=i._F.readLine(pe).trim().split(/\s+/g);X.header.box=[+De[0],+De[1],+De[2]]}function C(){return(C=(0,e.A)(function*(X,pe){const De=(0,i._F)(X);yield pe.update({message:"Parsing...",current:0,max:X.length});const Ee=[];for(;De.position<X.length;){const bt=M(De,pe);I(bt),l(bt);const xt=yield m(bt);d(bt),Ee.push({header:bt.header,atoms:xt})}return o.H.success({structures:Ee})})).apply(this,arguments)}var S=n(4369),D=n(190),R=n(573),f=n(9283),p=n(3558),E=n(8382),T=n(6115),L=n(8277),w=n(2745),Q=n(9359),G=n(7785),V=n(7187);function U(X){const pe=X&&X.getElement("vertex"),De=X&&X.getElement("material"),Ee={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},qe=[["",""]],bt=[["",""]];if(pe){for(let dn=0,In=pe.propertyNames.length;dn<In;++dn){const Tn=pe.propertyNames[dn],_n=pe.propertyTypes[dn];("uchar"===_n||"uint8"===_n||"ushort"===_n||"uint16"===_n||"uint"===_n||"uint32"===_n||"int"===_n)&&qe.push([Tn,Tn]),("uchar"===_n||"uint8"===_n)&&bt.push([Tn,Tn])}pe.propertyNames.includes("atomid")?Ee.group="atomid":pe.propertyNames.includes("material_index")&&(Ee.group="material_index"),pe.propertyNames.includes("red")&&(Ee.vRed="red"),pe.propertyNames.includes("green")&&(Ee.vGreen="green"),pe.propertyNames.includes("blue")&&(Ee.vBlue="blue")}const xt=[["",""]];if(De){for(let dn=0,In=De.propertyNames.length;dn<In;++dn){const Tn=De.propertyNames[dn],_n=De.propertyTypes[dn];("uchar"===_n||"uint8"===_n)&&xt.push([Tn,Tn])}De.propertyNames.includes("red")&&(Ee.mRed="red"),De.propertyNames.includes("green")&&(Ee.mGreen="green"),De.propertyNames.includes("blue")&&(Ee.mBlue="blue")}return{...f.e.Params,coloring:L.t.MappedStatic(Ee.vRed&&Ee.vGreen&&Ee.vBlue?"vertex":Ee.mRed&&Ee.mGreen&&Ee.mBlue?"material":"uniform",{vertex:L.t.Group({red:L.t.Select(Ee.vRed,bt,{label:"Red Property"}),green:L.t.Select(Ee.vGreen,bt,{label:"Green Property"}),blue:L.t.Select(Ee.vBlue,bt,{label:"Blue Property"})},{isFlat:!0}),material:L.t.Group({red:L.t.Select(Ee.mRed,xt,{label:"Red Property"}),green:L.t.Select(Ee.mGreen,xt,{label:"Green Property"}),blue:L.t.Select(Ee.mBlue,xt,{label:"Blue Property"})},{isFlat:!0}),uniform:L.t.Group({color:L.t.Color(w.s.grey),saturation:L.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:L.t.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:L.t.MappedStatic(Ee.group?"vertex":"none",{vertex:L.t.Group({group:L.t.Select(Ee.group,qe,{label:"Group Property"})},{isFlat:!0}),none:L.t.Group({})})}}const N=U();function k(X,pe,De,Ee,qe){const{vertices:bt,normals:xt,groups:hn}=De,dn=Ee.getProperty("x"),In=Ee.getProperty("y"),Tn=Ee.getProperty("z");if(!dn||!In||!Tn)throw new Error("missing coordinate properties");const _n=Ee.getProperty("nx"),Wn=Ee.getProperty("ny"),Xn=Ee.getProperty("nz"),Er=!!_n&&!!Wn&&!!Xn;for(let $n=X;$n<pe;++$n)E.Gm.add3(bt,dn.value($n),In.value($n),Tn.value($n)),Er&&E.Gm.add3(xt,_n.value($n),Wn.value($n),Xn.value($n)),E.Gm.add(hn,qe[$n])}function H(X,pe,De,Ee){const{indices:qe}=De;for(let bt=X;bt<pe;++bt){const{entries:xt,count:hn}=Ee.value(bt);3===hn?E.Gm.add3(qe,xt[0],xt[1],xt[2]):4===hn&&(E.Gm.add3(qe,xt[2],xt[1],xt[0]),E.Gm.add3(qe,xt[2],xt[0],xt[3]))}}function J(){return(J=(0,e.A)(function*(X,pe,De,Ee,qe){const bt=R.P.createState(pe.rowCount,pe.rowCount/4,qe),xt=pe.getProperty("x"),hn=pe.getProperty("y"),dn=pe.getProperty("z");if(!xt||!hn||!dn)throw new Error("missing coordinate properties");const In=pe.getProperty("nx"),Tn=pe.getProperty("ny"),_n=pe.getProperty("nz"),Wn=!!In&&!!Tn&&!!_n,Xn=1e5;for(let $n=0,mr=pe.rowCount;$n<mr;$n+=Xn)k($n,Math.min($n+Xn,mr),bt,pe,Ee),X.shouldUpdate&&(yield X.update({message:"adding ply mesh vertices",current:$n,max:mr}));for(let $n=0,mr=De.rowCount;$n<mr;$n+=Xn)H($n,Math.min($n+Xn,mr),bt,De),X.shouldUpdate&&(yield X.update({message:"adding ply mesh faces",current:$n,max:mr}));const Er=R.P.getMesh(bt);return Wn||f.e.computeNormals(Er),V.IQ.updateIfChanged(Er.varyingGroup,!0),Er})).apply(this,arguments)}const W=c.VP.Schema.int;function de(X,pe,De){const{coloring:Ee}=De,{rowCount:qe}=X;let bt,xt,hn;if("vertex"===Ee.name)bt=X.getProperty(Ee.params.red)||c.VP.ofConst(127,qe,W),xt=X.getProperty(Ee.params.green)||c.VP.ofConst(127,qe,W),hn=X.getProperty(Ee.params.blue)||c.VP.ofConst(127,qe,W);else if("material"===Ee.name)bt=pe&&pe.getProperty(Ee.params.red)||c.VP.ofConst(127,qe,W),xt=pe&&pe.getProperty(Ee.params.green)||c.VP.ofConst(127,qe,W),hn=pe&&pe.getProperty(Ee.params.blue)||c.VP.ofConst(127,qe,W);else{let dn=Ee.params.color;dn=D.Q1.saturate(dn,Ee.params.saturation),dn=D.Q1.lighten(dn,Ee.params.lightness);const[In,Tn,_n]=D.Q1.toRgb(dn);bt=c.VP.ofConst(In,qe,W),xt=c.VP.ofConst(Tn,qe,W),hn=c.VP.ofConst(_n,qe,W)}return{kind:Ee.name,red:bt,green:xt,blue:hn}}function ye(X,pe,De,Ee){const{kind:qe,red:bt,green:xt,blue:hn}=De,{ids:dn,map:In,label:Tn}=Ee,{source:_n,transforms:Wn}=X;return p.y.create("ply-mesh",_n,pe,Xn=>{const Er="material"===qe?Xn:In[Xn];return D.Q1.fromRgb(bt.value(Er),xt.value(Er),hn.value(Er))},()=>1,Xn=>`${Tn} ${dn[Xn]}`,Wn)}function j(){let X,pe,De,Ee,qe,bt;return function(){var hn=(0,e.A)(function*(dn,In,Tn,_n){const Wn=In.source.getElement("vertex");if(!Wn)throw new Error("missing vertex element");const Xn=In.source.getElement("face");if(!Xn)throw new Error("missing face element");const Er=In.source.getElement("material");let $n=!1,mr=!1;return(!X||X!=X)&&($n=!0),(!pe||!L.t.isParamEqual(N.grouping,pe.grouping,Tn.grouping))&&($n=!0),(!pe||!L.t.isParamEqual(N.coloring,pe.coloring,Tn.coloring))&&(mr=!0),$n?(qe=de(Wn,Er,Tn),bt=function te(X,pe){const{grouping:De}=pe,{rowCount:Ee}=X,qe="vertex"===De.name?X.getProperty(De.params.group):void 0,bt="vertex"===De.name?(0,G.Mk)(De.params.group):"Vertex",xt=qe?qe.toArray({array:Uint32Array}):(0,T.WE)(new Uint32Array(Ee)),hn=qe?(0,T._M)(xt):Ee-1,dn=new Uint32Array(hn+1);for(let In=0,Tn=xt.length;In<Tn;++In)dn[xt[In]]=In;return{ids:xt,map:dn,label:bt}}(Wn,Tn),Ee=yield function $(X,pe,De,Ee,qe){return J.apply(this,arguments)}(dn,Wn,Xn,bt.ids,_n&&_n.geometry),De=ye(In,Ee,qe,bt)):mr&&(qe=de(Wn,Er,Tn),De=ye(In,Ee,qe,bt)),X=In,pe=(0,Q.Go)(Tn),De});return function(In,Tn,_n,Wn){return hn.apply(this,arguments)}}()}var q=n(1071),Y=n(4490);function ee(){return ee.empty()}!function(X){function pe(qe,bt){return{size:qe,anglesInRadians:bt}}function De(){return pe((0,S.eB)(),(0,S.eB)())}X.create=pe,X.empty=De,X.fromBasis=function Ee(qe,bt,xt){const hn=S.eB.magnitude(qe),dn=S.eB.magnitude(bt),In=S.eB.magnitude(xt),Tn=Math.acos(S.eB.dot(bt,xt)/(dn*In)),_n=Math.acos(S.eB.dot(qe,xt)/(hn*In)),Wn=Math.acos(S.eB.dot(qe,bt)/(hn*dn));return hn<=0||dn<=0||In<=0||Tn>=Math.PI||_n>=Math.PI||Wn>=Math.PI?De():pe(S.eB.create(hn,dn,In),S.eB.create(Tn,_n,Wn))}}(ee||(ee={}));var g=n(2028);function le(X,pe,De,Ee){let qe=De,bt=Ee-1,xt=pe.charCodeAt(qe);for(;(32===xt||xt>=48&&xt<=57)&&qe<=bt;)xt=pe.charCodeAt(++qe);for(xt=pe.charCodeAt(bt);(32===xt||xt>=48&&xt<=57)&&bt>=qe;)xt=pe.charCodeAt(--bt);if(++bt,qe===bt||qe+1===bt)return i.tM.add(X,qe,bt);if(xt=pe.charCodeAt(qe),qe+2===bt){const hn=pe.charCodeAt(qe+1);if(!((78!==xt&&110!==xt||65!==hn&&97!==hn)&&(67!==xt&&99!==xt||76!==hn&&108!==hn)&&(70!==xt&&102!==xt||69!==hn&&101!==hn)&&(83!==xt&&115!==xt||73!==hn&&105!==hn)&&(66!==xt&&98!==xt||82!==hn&&114!==hn)&&(65!==xt&&97!==xt||83!==hn&&115!==hn)))return i.tM.add(X,qe,qe+2)}if(67===xt||99===xt||72===xt||104===xt||78===xt||110===xt||79===xt||111===xt||80===xt||112===xt||83===xt||115===xt)return i.tM.add(X,qe,qe+1);i.tM.add(X,qe,qe)}const Ae=new Set(["NA","CL","FE","SI","BR","AS","LI"]),Be=new Set(["C","H","N","O","P","S","F","B"]),Ce=/^[\s\d]+|[\s\d]+$/g;function Re(X,pe){const De=(X=X.replace(Ce,"").toUpperCase()).length;if(0===De||1===De||Ae.has(X))return X;if(3===De&&pe===X){if("SOD"===X)return"NA";if("POT"===X)return"K";if("CES"===X)return"CS";if("CAL"===X)return"CA";if("CLA"===X)return"CL"}return Be.has(X[0])?X[0]:""}var ke=n(2434),we=n(3671),Oe=n(1094);const Se="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Ne=(0,Oe.E)(function Ve(X){let De=X,Ee=0,qe=Se[De%26];for(;De>=26;)De=Math.floor(De/26),qe+=Se[De%26],Ee+=1;return Ee>=5&&console.warn("getChainId overflow"),qe});var ue,X,K=n(3573),ne=n(2449),be=n(2921),Te=n(7024);function ie(X,pe){const De=X.atomName,Ee=X.residueName,qe=new Array(X.count),bt=new Array(X.count),xt=new Uint32Array(X.count),hn=new Uint32Array(X.count),dn=new Array(X.count),In=new K.V,Tn=new we.N(X.residueNumber,X.atomName);let _n="",Wn=0,Xn="",Er=0,$n=0,mr=-1;for(let Xr=0,io=X.count;Xr<io;++Xr){const Mo=X.residueNumber.value(Xr);if(Mo!==mr){const Oo=X.residueName.value(Xr),ko=(0,ke.RN)(Tn.add(Oo,Xr).type,Oo);(ko!==$n||Mo!==mr+1&&!(99999===mr&&0===Mo))&&(Xn=Ne(Wn),Wn+=1,Er=0),_n=In.getEntityId(Oo,ko,Xn),Er+=1,mr=Mo,$n=ko}qe[Xr]=_n,bt[Xr]=Xn,xt[Xr]=Er,hn[Xr]=Xr,dn[Xr]=Re(X.atomName.value(Xr),X.residueName.value(Xr))}const gr=c.VP.ofStringArray(bt),Ar=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:gr,auth_atom_id:De,auth_comp_id:Ee,auth_seq_id:X.residueNumber,Cartn_x:c.VP.ofFloatArray(c.VP.mapToArray(X.x,Xr=>10*Xr,Float32Array)),Cartn_y:c.VP.ofFloatArray(c.VP.mapToArray(X.y,Xr=>10*Xr,Float32Array)),Cartn_z:c.VP.ofFloatArray(c.VP.mapToArray(X.z,Xr=>10*Xr,Float32Array)),id:c.VP.ofIntArray(hn),label_asym_id:gr,label_atom_id:De,label_comp_id:Ee,label_seq_id:c.VP.ofIntArray(xt),label_entity_id:c.VP.ofStringArray(qe),occupancy:c.VP.ofConst(1,X.count,c.VP.Schema.float),type_symbol:c.VP.ofStringArray(dn),pdbx_PDB_model_num:c.VP.ofConst(pe,X.count,c.VP.Schema.int)},X.count);return(0,ne.z)({entity:In.getEntityTable(),chem_comp:Tn.getChemCompTable(),atom_site:Ar})}(X=ue||(ue={})).is=function pe(Ee){return"gro"===Ee?.kind},X.fromGro=function De(Ee){return{kind:"gro",name:Ee.structures[0].header.title,data:Ee}};var ve=n(2524),ce=n(5165);function se(X,pe){const De=(bt,xt)=>(pe.substr(bt,xt)||"").trim(),Ee={entry_id:ce.RF.ofString(X),length_a:ce.RF.ofString(De(6,9)),length_b:ce.RF.ofString(De(15,9)),length_c:ce.RF.ofString(De(24,9)),angle_alpha:ce.RF.ofString(De(33,7)),angle_beta:ce.RF.ofString(De(40,7)),angle_gamma:ce.RF.ofString(De(47,7)),Z_PDB:ce.RF.ofString(De(66,4)),pdbx_unique_axis:ce.RF.ofString("?")},qe={entry_id:ce.RF.ofString(X),"space_group_name_H-M":ce.RF.ofString(De(55,11)),Int_Tables_number:ce.RF.ofString("?"),cell_setting:ce.RF.ofString("?"),space_group_name_Hall:ce.RF.ofString("?")};return[ce.xA.ofFields("cell",Ee),ce.xA.ofFields("symmetry",qe)]}function ae(X,pe){return{id:X,details:pe,groups:[]}}function ge(X,pe,De){const Ee=[];let qe,bt,xt,hn=1,dn=1;const In=$n=>X.data.substring(X.indices[2*$n],X.indices[2*$n+1]);for(let $n=pe;$n<De;$n++){let mr=In($n);if("BIOMOLECULE:"===mr.substr(11,12)){const gr=mr.substr(23).trim();let Ar=`Biomolecule ${gr}`;mr=In($n+1),"APPLY THE FOLLOWING TO CHAINS:"!==mr.substr(11,30)&&($n++,Ar=mr.substr(11).trim()),qe=ae(gr,Ar),Ee.push(qe)}else if("BIOMT"===mr.substr(13,5)){const gr=mr.split(/\s+/),Ar=parseInt(mr[18])-1;0===Ar&&(xt=S.$I.identity(),bt.operators.push({id:hn++,matrix:xt})),S.$I.setValue(xt,Ar,0,parseFloat(gr[4])),S.$I.setValue(xt,Ar,1,parseFloat(gr[5])),S.$I.setValue(xt,Ar,2,parseFloat(gr[6])),S.$I.setValue(xt,Ar,3,parseFloat(gr[7]))}else if("APPLY THE FOLLOWING TO CHAINS:"===mr.substr(11,30)||"                   AND CHAINS:"===mr.substr(11,30)){"APPLY"===mr.substr(11,5)&&(bt={chains:[],operators:[]},qe.groups.push(bt));const gr=mr.substr(41,30).split(",");for(let Ar=0,Xr=gr.length;Ar<Xr;++Ar){const io=gr[Ar].trim();io&&bt.chains.push(io)}}else if("APPLYING THE FOLLOWING TO CHAINS:"===mr.substr(11,33)){qe=ae(`${dn}`,`Biomolecule ${dn}`),Ee.push(qe),dn+=1,bt={chains:[],operators:[]},qe.groups.push(bt),$n++,mr=In($n);const gr=mr.substr(11,69).split(",");for(let Ar=0,Xr=gr.length;Ar<Xr;++Ar){const io=gr[Ar].trim();io&&bt.chains.push(io)}}}if(0===Ee.length)return[];const Tn={id:ce.RF.ofStrings(Ee.map($n=>$n.id)),details:ce.RF.ofStrings(Ee.map($n=>$n.details))},_n=[];for(const $n of Ee)for(const mr of $n.groups)_n.push({assembly_id:$n.id,oper_expression:mr.operators.map(gr=>gr.id).join(","),asym_id_list:mr.chains.join(",")});const Wn={assembly_id:ce.RF.ofStrings(_n.map($n=>$n.assembly_id)),oper_expression:ce.RF.ofStrings(_n.map($n=>$n.oper_expression)),asym_id_list:ce.RF.ofStrings(_n.map($n=>$n.asym_id_list))},Xn=[];for(const $n of Ee)for(const mr of $n.groups)for(const gr of mr.operators){const Ar={id:""+gr.id,type:"?",name:"?",symmetry_operation:"?"};for(let Xr=0;Xr<3;Xr++){for(let io=0;io<3;io++)Ar[`matrix[${Xr+1}][${io+1}]`]=""+S.$I.getValue(gr.matrix,Xr,io);Ar[`vector[${Xr+1}]`]=""+S.$I.getValue(gr.matrix,Xr,3)}Xn.push(Ar)}const Er={id:ce.RF.ofStrings(Xn.map($n=>$n.id)),type:ce.RF.ofStrings(Xn.map($n=>$n.type)),name:ce.RF.ofStrings(Xn.map($n=>$n.name)),symmetry_operation:ce.RF.ofStrings(Xn.map($n=>$n.symmetry_operation))};for(let $n=0;$n<3;$n++){for(let gr=0;gr<3;gr++){const Ar=`matrix[${$n+1}][${gr+1}]`;Er[Ar]=ce.RF.ofStrings(Xn.map(Xr=>Xr[Ar]))}const mr=`vector[${$n+1}]`;Er[mr]=ce.RF.ofStrings(Xn.map(gr=>gr[mr]))}return[ce.xA.ofFields("pdbx_struct_assembly",Tn),ce.xA.ofFields("pdbx_struct_assembly_gen",Wn),ce.xA.ofFields("pdbx_struct_oper_list",Er)]}function Ie(X,pe,De){const Ee=[];let qe;const bt=In=>X.data.substring(X.indices[2*In],X.indices[2*In+1]);for(let In=pe;In<De;In++){const Tn=bt(In),_n=Tn.split(/\s+/),Wn=parseInt(Tn[5])-1;0===Wn&&(qe=S.$I.identity(),Ee.push(qe)),S.$I.setValue(qe,Wn,0,parseFloat(_n[2])),S.$I.setValue(qe,Wn,1,parseFloat(_n[3])),S.$I.setValue(qe,Wn,2,parseFloat(_n[4])),S.$I.setValue(qe,Wn,3,parseFloat(_n[5]))}if(0===Ee.length)return[];const xt=[];let hn=1;for(const In of Ee){const Tn={id:"ncsop"+hn++,code:".",details:"."};for(let _n=0;_n<3;_n++){for(let Wn=0;Wn<3;Wn++)Tn[`matrix[${_n+1}][${Wn+1}]`]=""+S.$I.getValue(In,_n,Wn);Tn[`vector[${_n+1}]`]=""+S.$I.getValue(In,_n,3)}xt.push(Tn)}const dn={id:ce.RF.ofStrings(xt.map(In=>In.id)),code:ce.RF.ofStrings(xt.map(In=>In.code)),details:ce.RF.ofStrings(xt.map(In=>In.details))};for(let In=0;In<3;In++){for(let _n=0;_n<3;_n++){const Wn=`matrix[${In+1}][${_n+1}]`;dn[Wn]=ce.RF.ofStrings(xt.map(Xn=>Xn[Wn]))}const Tn=`vector[${In+1}]`;dn[Tn]=ce.RF.ofStrings(xt.map(_n=>_n[Tn]))}return[ce.xA.ofFields("struct_ncs_oper",dn)]}const Le={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function je(X,pe,De){const Ee=[],qe=Tn=>X.data.substring(X.indices[2*Tn],X.indices[2*Tn+1]);for(let Tn=pe;Tn<De;Tn++){const _n=qe(Tn);Ee.push({serNum:_n.substr(7,3).trim(),helixID:_n.substr(11,3).trim(),initResName:_n.substr(15,3).trim(),initChainID:_n.substr(19,1).trim(),initSeqNum:_n.substr(21,4).trim(),initICode:_n.substr(25,1).trim(),endResName:_n.substr(27,3).trim(),endChainID:_n.substr(31,3).trim(),endSeqNum:_n.substr(33,4).trim(),endICode:_n.substr(37,1).trim(),helixClass:_n.substr(38,2).trim(),comment:_n.substr(40,30).trim(),length:_n.substr(71,5).trim()})}const bt=ce.RF.ofStrings(Ee.map(Tn=>Tn.initChainID)),xt=ce.RF.ofStrings(Ee.map(Tn=>Tn.initResName)),hn=ce.RF.ofStrings(Ee.map(Tn=>Tn.endChainID)),dn=ce.RF.ofStrings(Ee.map(Tn=>Tn.endResName)),In={beg_label_asym_id:bt,beg_label_comp_id:xt,beg_label_seq_id:ce.RF.ofUndefined(Ee.length,c.VP.Schema.int),beg_auth_asym_id:bt,beg_auth_comp_id:xt,beg_auth_seq_id:ce.RF.ofStrings(Ee.map(Tn=>Tn.initSeqNum)),conf_type_id:ce.RF.ofStrings(Ee.map(Tn=>function nt(X){return Le[X]||"helx_p"}(Tn.helixClass))),details:ce.RF.ofStrings(Ee.map(Tn=>Tn.comment)),end_label_asym_id:hn,end_label_comp_id:dn,end_label_seq_id:ce.RF.ofUndefined(Ee.length,c.VP.Schema.int),end_auth_asym_id:hn,end_auth_comp_id:dn,end_auth_seq_id:ce.RF.ofStrings(Ee.map(Tn=>Tn.endSeqNum)),id:ce.RF.ofStrings(Ee.map(Tn=>Tn.serNum)),pdbx_beg_PDB_ins_code:ce.RF.ofStrings(Ee.map(Tn=>Tn.initICode)),pdbx_end_PDB_ins_code:ce.RF.ofStrings(Ee.map(Tn=>Tn.endICode)),pdbx_PDB_helix_class:ce.RF.ofStrings(Ee.map(Tn=>Tn.helixClass)),pdbx_PDB_helix_length:ce.RF.ofStrings(Ee.map(Tn=>Tn.length)),pdbx_PDB_helix_id:ce.RF.ofStrings(Ee.map(Tn=>Tn.helixID))};return ce.xA.ofFields("struct_conf",In)}function Lt(X,pe,De){const Ee=[],qe=Wn=>X.data.substring(X.indices[2*Wn],X.indices[2*Wn+1]);for(let Wn=pe;Wn<De;Wn++){const Xn=qe(Wn);Ee.push({strand:Xn.substr(7,3).trim(),sheetID:Xn.substr(11,3).trim(),numStrands:Xn.substr(14,2).trim(),initResName:Xn.substr(17,3).trim(),initChainID:Xn.substr(21,1).trim(),initSeqNum:Xn.substr(22,4).trim(),initICode:Xn.substr(26,1).trim(),endResName:Xn.substr(28,3).trim(),endChainID:Xn.substr(32,1).trim(),endSeqNum:Xn.substr(33,4).trim(),endICode:Xn.substr(37,1).trim(),sense:Xn.substr(38,2).trim(),curAtom:Xn.substr(41,4).trim(),curResName:Xn.substr(45,3).trim(),curChainId:Xn.substr(49,1).trim(),curResSeq:Xn.substr(50,4).trim(),curICode:Xn.substr(54,1).trim(),prevAtom:Xn.substr(56,4).trim(),prevResName:Xn.substr(60,3).trim(),prevChainId:Xn.substr(64,1).trim(),prevResSeq:Xn.substr(65,4).trim(),prevICode:Xn.substr(69,1).trim()})}const bt=ce.RF.ofStrings(Ee.map(Wn=>Wn.initChainID)),xt=ce.RF.ofStrings(Ee.map(Wn=>Wn.initResName)),hn=ce.RF.ofStrings(Ee.map(Wn=>Wn.initSeqNum)),dn=ce.RF.ofStrings(Ee.map(Wn=>Wn.endChainID)),In=ce.RF.ofStrings(Ee.map(Wn=>Wn.endResName)),Tn=ce.RF.ofStrings(Ee.map(Wn=>Wn.endSeqNum)),_n={beg_label_asym_id:bt,beg_label_comp_id:xt,beg_label_seq_id:hn,beg_auth_asym_id:bt,beg_auth_comp_id:xt,beg_auth_seq_id:hn,end_label_asym_id:dn,end_label_comp_id:dn,end_label_seq_id:Tn,end_auth_asym_id:dn,end_auth_comp_id:In,end_auth_seq_id:Tn,id:ce.RF.ofStrings(Ee.map(Wn=>Wn.strand)),sheet_id:ce.RF.ofStrings(Ee.map(Wn=>Wn.sheetID)),pdbx_beg_PDB_ins_code:ce.RF.ofStrings(Ee.map(Wn=>Wn.initICode)),pdbx_end_PDB_ins_code:ce.RF.ofStrings(Ee.map(Wn=>Wn.endICode))};return ce.xA.ofFields("struct_sheet_range",_n)}const Je={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function en(X,pe,De){const Ee=dn=>X.data.substring(X.indices[2*dn],X.indices[2*dn+1]);let qe,bt={chains:[],description:""};const xt=[];for(let dn=pe;dn<De;dn++){const Tn=Ee(dn).substr(10,70).trim(),_n=Tn.indexOf(":"),Wn=Tn.substring(0,_n);let Xn;Wn in Je?(qe=Wn,Xn=Tn.substring(_n+2)):Xn=Tn,Xn=Xn.replace(/;$/,""),"MOL_ID"===qe?(bt={chains:[],description:""},xt.push(bt)):"MOLECULE"===qe?(bt.description&&(bt.description+=" "),bt.description+=Xn):"CHAIN"===qe&&Array.prototype.push.apply(bt.chains,Xn.split(/\s*,\s*/))}const hn=[];for(const dn of xt)for(const In of dn.chains)hn.push({description:dn.description,chains:[In]});return hn}function Bt(X,pe,De){const Ee=bt=>X.data.substring(X.indices[2*bt],X.indices[2*bt+1]),qe=new Map;for(let bt=pe;bt<De;bt++){const xt=Ee(bt),hn=xt.substr(11,3).trim(),dn=xt.substr(15).trim();qe.has(hn)?qe.set(hn,`${qe.get(hn)} ${dn}`):qe.set(hn,dn)}return qe}var pn=n(3656);function _t(X,pe,De,Ee,qe,bt){const{data:xt}=De,hn=qe-Ee;i.tM.addToken(X.group_PDB,i._F.trim(De,Ee,Ee+6)),i._F.trim(De,Ee+6,Ee+11),X.id[X.index]=De.data.substring(De.tokenStart,De.tokenEnd),i.tM.addToken(X.auth_atom_id,i._F.trim(De,Ee+12,Ee+16)),32===xt.charCodeAt(Ee+16)?i.tM.add(X.label_alt_id,0,0):i.tM.add(X.label_alt_id,Ee+16,Ee+17),i.tM.addToken(X.auth_comp_id,i._F.trim(De,Ee+17,Ee+20)),i.tM.add(X.auth_asym_id,Ee+21,Ee+22),i.tM.addToken(X.auth_seq_id,i._F.trim(De,Ee+22,Ee+26)),32===xt.charCodeAt(Ee+26)?i.tM.add(X.pdbx_PDB_ins_code,0,0):i.tM.add(X.pdbx_PDB_ins_code,Ee+26,Ee+27),i.tM.addToken(X.Cartn_x,i._F.trim(De,Ee+30,Ee+38)),i.tM.addToken(X.Cartn_y,i._F.trim(De,Ee+38,Ee+46)),i.tM.addToken(X.Cartn_z,i._F.trim(De,Ee+46,Ee+54)),i.tM.addToken(X.occupancy,i._F.trim(De,Ee+54,Ee+60)),hn>=66?i.tM.addToken(X.B_iso_or_equiv,i._F.trim(De,Ee+60,Ee+66)):i.tM.add(X.B_iso_or_equiv,0,0),bt&&i.tM.addToken(X.partial_charge,i._F.trim(De,Ee+70,Ee+76)),hn>=78&&!bt?(i._F.trim(De,Ee+76,Ee+78),De.tokenStart<De.tokenEnd?i.tM.addToken(X.type_symbol,De):le(X.type_symbol,xt,Ee+12,Ee+16)):le(X.type_symbol,xt,Ee+12,Ee+16),X.pdbx_PDB_model_num[X.index]=pe,X.index++}function Ke(X){const pe=ce.RF.ofTokens(X.pdbx_auth_seq_id),De=ce.RF.ofTokens(X.pdbx_auth_comp_id),Ee=ce.RF.ofTokens(X.pdbx_auth_asym_id),qe=ce.RF.ofTokens(X.pdbx_auth_atom_id),bt={id:ce.RF.ofStrings(X.id),type_symbol:ce.RF.ofTokens(X.type_symbol),pdbx_label_atom_id:qe,pdbx_label_alt_id:ce.RF.ofTokens(X.pdbx_label_alt_id),pdbx_label_comp_id:De,pdbx_label_asym_id:Ee,pdbx_label_seq_id:pe,pdbx_PDB_ins_code:ce.RF.ofTokens(X.pdbx_PDB_ins_code),pdbx_auth_seq_id:pe,pdbx_auth_comp_id:De,pdbx_auth_asym_id:Ee,pdbx_auth_atom_id:qe};return bt["U[1][1]"]=ce.RF.ofNumbers(X["U[1][1]"]),bt["U[2][2]"]=ce.RF.ofNumbers(X["U[2][2]"]),bt["U[3][3]"]=ce.RF.ofNumbers(X["U[3][3]"]),bt["U[1][2]"]=ce.RF.ofNumbers(X["U[1][2]"]),bt["U[1][3]"]=ce.RF.ofNumbers(X["U[1][3]"]),bt["U[2][3]"]=ce.RF.ofNumbers(X["U[2][3]"]),bt}function ut(X,pe,De,Ee,qe){const{data:bt}=De,xt=qe-Ee;i._F.trim(De,Ee+6,Ee+11),X.id[X.index]=bt.substring(De.tokenStart,De.tokenEnd),i.tM.addToken(X.pdbx_auth_atom_id,i._F.trim(De,Ee+12,Ee+16)),32===bt.charCodeAt(Ee+16)?i.tM.add(X.pdbx_label_alt_id,0,0):i.tM.add(X.pdbx_label_alt_id,Ee+16,Ee+17),i.tM.addToken(X.pdbx_auth_comp_id,i._F.trim(De,Ee+17,Ee+20)),i.tM.add(X.pdbx_auth_asym_id,Ee+21,Ee+22),i.tM.addToken(X.pdbx_auth_seq_id,i._F.trim(De,Ee+22,Ee+26)),32===bt.charCodeAt(Ee+26)?i.tM.add(X.pdbx_PDB_ins_code,0,0):i.tM.add(X.pdbx_PDB_ins_code,Ee+26,Ee+27),X["U[1][1]"][X.index]=(0,v.jj)(bt,Ee+28,Ee+35)/1e4,X["U[2][2]"][X.index]=(0,v.jj)(bt,Ee+35,Ee+42)/1e4,X["U[3][3]"][X.index]=(0,v.jj)(bt,Ee+42,Ee+49)/1e4,X["U[1][2]"][X.index]=(0,v.jj)(bt,Ee+49,Ee+56)/1e4,X["U[1][3]"][X.index]=(0,v.jj)(bt,Ee+56,Ee+63)/1e4,X["U[2][3]"][X.index]=(0,v.jj)(bt,Ee+63,Ee+70)/1e4,xt>=78?(i._F.trim(De,Ee+76,Ee+78),De.tokenStart<De.tokenEnd?i.tM.addToken(X.type_symbol,De):le(X.type_symbol,bt,Ee+12,Ee+16)):le(X.type_symbol,bt,Ee+12,Ee+16),X.index++}var sn=n(2629);function gt(X,pe,De,Ee){const qe=X.substring(pe,De);Ee.id_code=qe.substring(62,66).trim()||void 0,Ee.dep_date=qe.substring(50,59).trim()||void 0,Ee.classification=qe.substring(10,50).trim()||void 0}function At(){return At=(0,e.A)(function*(X){const{lines:pe}=X,{data:De,indices:Ee}=pe,qe=(0,i._F)(De),bt=!!X.isPdbqt;let xt=0,hn=0;for(let yr=0,bo=pe.count;yr<bo;yr++){const $r=Ee[2*yr],_r=Ee[2*yr+1];switch(De[$r]){case"A":(0,G.LX)(De,$r,_r,"ATOM  ")?xt++:(0,G.LX)(De,$r,_r,"ANISOU")&&hn++;break;case"H":(0,G.LX)(De,$r,_r,"HETATM")&&xt++}}const dn={},In=function $e(X,pe){const Ee=()=>i.tM.create(X,2*pe);return{index:0,group_PDB:Ee(),id:[],auth_atom_id:Ee(),label_alt_id:Ee(),auth_comp_id:Ee(),auth_asym_id:Ee(),auth_seq_id:Ee(),pdbx_PDB_ins_code:Ee(),Cartn_x:Ee(),Cartn_y:Ee(),Cartn_z:Ee(),occupancy:Ee(),B_iso_or_equiv:Ee(),type_symbol:Ee(),pdbx_PDB_model_num:[],label_entity_id:[],partial_charge:Ee()}}(De,xt),Tn=function Me(X,pe){const Ee=()=>new Float32Array(pe),qe=()=>i.tM.create(X,2*pe);return{index:0,count:pe,id:[],type_symbol:qe(),pdbx_label_atom_id:qe(),pdbx_label_alt_id:qe(),pdbx_label_comp_id:qe(),pdbx_label_asym_id:qe(),pdbx_label_seq_id:qe(),pdbx_PDB_ins_code:qe(),"U[1][1]":Ee(),"U[2][2]":Ee(),"U[3][3]":Ee(),"U[1][2]":Ee(),"U[1][3]":Ee(),"U[2][3]":Ee(),pdbx_auth_seq_id:qe(),pdbx_auth_comp_id:qe(),pdbx_auth_asym_id:qe(),pdbx_auth_atom_id:qe()}}(De,hn),_n=new K.V,Wn=[],Xn=[];let mr,Er=0,$n="",gr=!1;const Ar=new Set;for(let yr=0,bo=pe.count;yr<bo;yr++){let $r=Ee[2*yr],_r=Ee[2*yr+1];switch(De[$r]){case"A":(0,G.LX)(De,$r,_r,"ATOM  ")?(Er||(Er++,$n=""+Er),_t(In,$n,qe,$r,_r,bt)):(0,G.LX)(De,$r,_r,"ANISOU")&&ut(Tn,0,qe,$r,_r);break;case"C":if((0,G.LX)(De,$r,_r,"CRYST1"))Wn.push(...se(X.id||"?",De.substring($r,_r)));else if((0,G.LX)(De,$r,_r,"CONECT")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"CONECT");)eo++;mr?sn.Bb&&console.log("only single CONECT block allowed, ignoring others"):mr=[yr,eo],yr=eo-1}else if((0,G.LX)(De,$r,_r,"COMPND")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"COMPND");)eo++;_n.setCompounds(en(pe,yr,eo)),yr=eo-1}break;case"H":if((0,G.LX)(De,$r,_r,"HEADER"))gt(De,$r,_r,dn);else if((0,G.LX)(De,$r,_r,"HETATM"))Er||(Er++,$n=""+Er),_t(In,$n,qe,$r,_r,bt);else if((0,G.LX)(De,$r,_r,"HELIX")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"HELIX");)eo++;Wn.push(je(pe,yr,eo)),yr=eo-1}else if((0,G.LX)(De,$r,_r,"HETNAM")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"HETNAM");)eo++;Xn.push(...Array.from(Bt(pe,yr,eo).entries())),yr=eo-1}break;case"M":if((0,G.LX)(De,$r,_r,"MODEL ")&&(Er++,$n=""+Er),(0,G.LX)(De,$r,_r,"MTRIX")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"MTRIX");)eo++;Wn.push(...Ie(pe,yr,eo)),yr=eo-1}break;case"O":break;case"R":if((0,G.LX)(De,$r,_r,"REMARK 350")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"REMARK 350");)eo++;Wn.push(...ge(pe,yr,eo)),yr=eo-1,gr=!0}break;case"S":if((0,G.LX)(De,$r,_r,"SHEET")){let eo=yr+1;for(;$r=Ee[2*eo],_r=Ee[2*eo+1],(0,G.LX)(De,$r,_r,"SHEET");)eo++;Wn.push(Lt(pe,yr,eo)),yr=eo-1}break;case"T":(0,G.LX)(De,$r,_r,"TER")&&Ar.add(In.index)}}if(dn.id_code){const yr={id:ce.RF.ofString(dn.id_code)};Wn.push(ce.xA.ofFields("entry",yr))}if(dn.classification){const yr={pdbx_keywords:ce.RF.ofString(dn.classification)};Wn.push(ce.xA.ofFields("struct_keywords",yr))}if(dn.dep_date){const yr={recvd_initial_deposition_date:ce.RF.ofString(dn.dep_date)};Wn.push(ce.xA.ofFields("pdbx_database_status",yr))}const Xr=c.VP.ofIntTokens(In.auth_seq_id),io=c.VP.ofStringTokens(In.auth_atom_id),Mo=c.VP.ofStringTokens(In.auth_comp_id),Oo=c.VP.ofStringTokens(In.auth_asym_id),ko=new we.N(Xr,io);ko.setNames(Xn),_n.setNames(Xn);for(let yr=0,bo=Mo.rowCount;yr<bo;++yr){const $r=Mo.value(yr),_r=(0,ke.RN)(ko.add($r,yr).type,$r);In.label_entity_id[yr]=_n.getEntityId($r,_r,Oo.value(yr))}const Xo=function mt(X,pe,De){const Ee=ce.RF.ofStrings(X.pdbx_PDB_model_num),qe=ce.RF.ofTokens(X.auth_asym_id),bt=ce.RF.ofTokens(X.auth_seq_id),xt=ce.RF.ofTokens(X.pdbx_PDB_ins_code),hn=ce.RF.ofTokens(X.auth_atom_id),dn=ce.RF.ofTokens(X.auth_comp_id),In=ce.RF.ofStrings(X.id);let Tn=Ee.str(0),_n=qe.str(0),Wn=bt.int(0),Xn=xt.str(0),Er=_n,$n=Wn;const mr=new Map,gr=new Map,Ar=[],Xr=[],io=[];let Mo=!1;for(let uo=0,yr=In.rowCount;uo<yr;++uo)if(""!==xt.str(uo)){Mo=!0;break}for(let uo=0,yr=In.rowCount;uo<yr;++uo){const bo=Ee.str(uo),$r=qe.str(uo),_r=bt.int(uo),eo=xt.str(uo);let Ho=hn.str(uo);if(bo!==Tn?(mr.clear(),gr.clear(),Tn=bo,_n=$r,Wn=_r,Xn=eo,Er=$r,$n=_r):_n!==$r?(gr.clear(),_n=$r,Wn=_r,Xn=eo,Er=$r,$n=_r):Wn!==_r?(gr.clear(),Wn===$n?$n=_r:$n+=1,Wn=_r,Xn=eo):Xn!==eo&&(gr.clear(),Xn=eo,$n+=1),mr.has($r)){if(pe.has(uo)&&!De.hasAssemblies){const wi=mr.get($r)+1;mr.set($r,wi),Er=`${$r}_${wi}`}}else mr.set($r,0);if(Ar[uo]=Er,gr.has(Ho)){const wi=gr.get(Ho)+1;gr.set(Ho,wi),Ho=`${Ho}_${wi}`}else gr.set(Ho,0);Xr[uo]=Ho,Mo&&(io[uo]=$n)}const Oo=c.VP.ofStringArray(Ar),ko=c.VP.ofStringArray(Xr),Xo=Mo?ce.RF.ofColumn(c.VP.ofIntArray(io)):ce.RF.ofUndefined(X.index,c.VP.Schema.int);return{auth_asym_id:qe,auth_atom_id:hn,auth_comp_id:dn,auth_seq_id:bt,B_iso_or_equiv:ce.RF.ofTokens(X.B_iso_or_equiv),Cartn_x:ce.RF.ofTokens(X.Cartn_x),Cartn_y:ce.RF.ofTokens(X.Cartn_y),Cartn_z:ce.RF.ofTokens(X.Cartn_z),group_PDB:ce.RF.ofTokens(X.group_PDB),id:In,label_alt_id:ce.RF.ofTokens(X.label_alt_id),label_asym_id:ce.RF.ofColumn(Oo),label_atom_id:ce.RF.ofColumn(ko),label_comp_id:dn,label_seq_id:Xo,label_entity_id:ce.RF.ofStrings(X.label_entity_id),occupancy:(0,pn.Yb)(X.occupancy)?ce.RF.ofUndefined(X.index,c.VP.Schema.float):ce.RF.ofTokens(X.occupancy),type_symbol:ce.RF.ofTokens(X.type_symbol),pdbx_PDB_ins_code:ce.RF.ofTokens(X.pdbx_PDB_ins_code),pdbx_PDB_model_num:Ee,partial_charge:ce.RF.ofTokens(X.partial_charge)}}(In,Ar,{hasAssemblies:gr});bt||delete Xo.partial_charge,mr&&Wn.push(function Kt(X,pe,De,Ee){const qe={};for(let ko=0,Xo=Ee.id.rowCount;ko<Xo;++ko)qe[Ee.id.str(ko)]=ko;const bt=ko=>X.data.substring(X.indices[2*ko],X.indices[2*ko+1]),xt=[],hn=[],dn=[],In=[],Tn=[],_n=[],Wn=[],Xn=[],Er=[],$n=[],mr=[],gr=[],Ar=[],Xr=[],io=[11,16,21,26];let Mo=1;for(let ko=pe;ko<De;ko++){const Xo=bt(ko),uo=qe[parseInt(Xo.substr(6,5))],yr={};if(void 0!==uo)for(let bo=0;bo<4;++bo){const $r=parseInt(Xo.substr(io[bo],5));if(Number.isNaN($r))continue;const _r=qe[$r];void 0!==_r&&(uo>_r||void 0===yr[_r]&&(xt.push(`covale${Mo}`),hn.push("covale"),dn.push(Ee.label_asym_id.str(uo)),In.push(Ee.label_seq_id.int(uo)),Tn.push(Ee.auth_seq_id.int(uo)),_n.push(Ee.label_atom_id.str(uo)),Wn.push(Ee.label_alt_id.str(uo)),Xn.push(Ee.pdbx_PDB_ins_code.str(uo)),Er.push(Ee.label_asym_id.str(_r)),$n.push(Ee.label_seq_id.int(_r)),mr.push(Ee.auth_seq_id.int(_r)),gr.push(Ee.label_atom_id.str(_r)),Ar.push(Ee.label_alt_id.str(_r)),Xr.push(Ee.pdbx_PDB_ins_code.str(_r)),Mo+=1))}}const Oo={id:ce.RF.ofStrings(xt),conn_type_id:ce.RF.ofStrings(hn),ptnr1_label_asym_id:ce.RF.ofStrings(dn),ptnr1_label_seq_id:ce.RF.ofNumbers(In),ptnr1_auth_seq_id:ce.RF.ofNumbers(Tn),ptnr1_label_atom_id:ce.RF.ofStrings(_n),pdbx_ptnr1_label_alt_id:ce.RF.ofStrings(Wn),pdbx_ptnr1_PDB_ins_code:ce.RF.ofStrings(Xn),ptnr2_label_asym_id:ce.RF.ofStrings(Er),ptnr2_label_seq_id:ce.RF.ofNumbers($n),ptnr2_auth_seq_id:ce.RF.ofNumbers(mr),ptnr2_label_atom_id:ce.RF.ofStrings(gr),pdbx_ptnr2_label_alt_id:ce.RF.ofStrings(Ar),pdbx_ptnr2_PDB_ins_code:ce.RF.ofStrings(Xr)};return ce.xA.ofFields("struct_conn",Oo)}(pe,mr[0],mr[1],Xo));const uo={entity:ce.xA.ofTable("entity",_n.getEntityTable()),chem_comp:ce.xA.ofTable("chem_comp",ko.getChemCompTable()),atom_site:ce.xA.ofFields("atom_site",Xo),atom_site_anisotrop:ce.xA.ofFields("atom_site_anisotrop",Ke(Tn))};for(const yr of Wn)uo[yr.name]=yr;return{header:X.id||"PDB",categoryNames:Object.keys(uo),categories:uo}}),At.apply(this,arguments)}var rn,Gt=n(4366);!function(X){X.is=function pe(Ee){return"pdb"===Ee?.kind},X.create=function De(Ee){return{kind:"pdb",name:Ee.id||"",data:Ee}}}(rn||(rn={}));var bn,Mt=n(3346);!function(X){X.is=function pe(Ee){return"psf"===Ee?.kind},X.fromPsf=function De(Ee){return{kind:"psf",name:Ee.id,data:Ee}}}(bn||(bn={}));var yn,jt=n(9136),It=n(9767),Dt=n(9498),Ct=n(1832),$t=n(9909),Vt=n(1295),Wt=n(7291);!function(X){function De(hn,dn){const In=Dt.e.is(dn)?dn:void 0,Tn=Dt.e.is(dn)?Dt.e.toExpression(dn):dn;return{script:In,expression:Tn,compiled:(0,Wt.wE)(Tn),originalStructure:hn,currentStructure:hn}}function Ee(hn,dn){return hn.compiled(new jt.cY(dn))}X.isUnchanged=function pe(hn,dn,In){return hn.currentStructure===In&&(Dt.e.is(dn)?!!hn.script&&Dt.e.areEqual(hn.script,dn):hn.expression===dn)},X.create=De,X.run=Ee,X.createAndRun=function qe(hn,dn){const In=De(hn,dn);return{entry:In,selection:Ee(In,hn)}},X.updateStructure=function bt(hn,dn){return hn.currentStructure=dn,hn.compiled(new jt.cY(dn))},X.updateStructureObject=function xt(hn,dn,In){const Tn=jt.cv.unionStructure(dn);hn.label=`${In||"Selection"}`,hn.description=jt.oE.elementDescription(Tn),hn.data=Tn}}(yn||(yn={}));var Zt=n(381),kt=n(9096),Ot=n(1372);function Dr(X){switch(X){case 7:return-3;case 6:return-2;case 5:return-1;case 0:case 4:return 0;case 3:return 1;case 2:return 2;case 1:return 3;default:return console.error(`Value ${X} is outside the 0-7 range, defaulting to 0.`),0}}function Pr(X,pe){const De=i.tM.create(X.data,2*pe),Ee=i.tM.create(X.data,2*pe),qe=i.tM.create(X.data,2*pe),bt=i.tM.create(X.data,2*pe),xt=i.tM.create(X.data,2*pe);for(let hn=0;hn<pe;++hn){i._F.markLine(X);const{tokenStart:dn,position:In}=X;i._F.trim(X,dn,dn+10),i.tM.addUnchecked(De,X.tokenStart,X.tokenEnd),i._F.trim(X,dn+10,dn+20),i.tM.addUnchecked(Ee,X.tokenStart,X.tokenEnd),i._F.trim(X,dn+20,dn+30),i.tM.addUnchecked(qe,X.tokenStart,X.tokenEnd),i._F.trim(X,dn+31,dn+34),i.tM.addUnchecked(bt,X.tokenStart,X.tokenEnd),i._F.trim(X,dn+36,dn+39),i.tM.addUnchecked(xt,X.tokenStart,X.tokenEnd),X.position=In}return{count:pe,x:(0,pn.do)(De)(c.VP.Schema.float),y:(0,pn.do)(Ee)(c.VP.Schema.float),z:(0,pn.do)(qe)(c.VP.Schema.float),type_symbol:(0,pn.do)(bt)(c.VP.Schema.str),formal_charge:(0,pn.do)(xt)(c.VP.Schema.int)}}function or(X,pe){const De=i.tM.create(X.data,2*pe),Ee=i.tM.create(X.data,2*pe),qe=i.tM.create(X.data,2*pe);for(let bt=0;bt<pe;++bt){i._F.markLine(X);const{tokenStart:xt,position:hn}=X;i._F.trim(X,xt,xt+3),i.tM.addUnchecked(De,X.tokenStart,X.tokenEnd),i._F.trim(X,xt+3,xt+6),i.tM.addUnchecked(Ee,X.tokenStart,X.tokenEnd),i._F.trim(X,xt+6,xt+9),i.tM.addUnchecked(qe,X.tokenStart,X.tokenEnd),X.position=hn}return{count:pe,atomIdxA:(0,pn.do)(De)(c.VP.Schema.int),atomIdxB:(0,pn.do)(Ee)(c.VP.Schema.int),order:(0,pn.do)(qe)(c.VP.Schema.int)}}function Nr(X,pe,De){i._F.trim(X,pe+6,pe+9);const Ee=parseInt(i._F.getTokenString(X));for(let qe=0;qe<Ee;++qe){const bt=9+8*qe;i._F.trim(X,pe+bt,pe+bt+4);const xt=i._F.getTokenString(X);De.atomIdx.push(+xt),i._F.trim(X,pe+bt+4,pe+bt+8);const hn=i._F.getTokenString(X);De.charge.push(+hn)}i._F.eatLine(X)}function Ir(X){const Ee={atomIdx:[],charge:[]};for(;X.position<X.length;){const{position:bt}=X;i._F.trim(X,bt+3,bt+6);const xt=i._F.getTokenString(X);if("END"===xt)break;"CHG"===(i._F.eatLine(X),xt)&&Nr(X,bt,Ee)}return{atomIdx:c.VP.ofIntArray(Ee.atomIdx),charge:c.VP.ofIntArray(Ee.charge)}}var dt,To=n(8334);function un(X,pe,De){return ct.apply(this,arguments)}function ct(){return ct=(0,e.A)(function*(X,pe,De){const{atoms:Ee,bonds:qe,formalCharges:bt}=X,xt=c.VP.ofConst("MOL",X.atoms.count,c.VP.Schema.str),hn=c.VP.ofConst("A",X.atoms.count,c.VP.Schema.str),dn=c.VP.asArrayColumn(Ee.type_symbol),In=c.VP.ofConst(1,Ee.count,c.VP.Schema.int),Tn=new Int32Array(X.atoms.count);if(bt.atomIdx.rowCount>0)for(let mr=0;mr<bt.atomIdx.rowCount;mr++)Tn[bt.atomIdx.value(mr)-1]=bt.charge.value(mr);else for(let mr=0;mr<X.atoms.count;mr++)Tn[mr]=Dr(Ee.formal_charge.value(mr));const _n=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:hn,auth_atom_id:dn,auth_comp_id:xt,auth_seq_id:In,Cartn_x:c.VP.asArrayColumn(Ee.x,Float32Array),Cartn_y:c.VP.asArrayColumn(Ee.y,Float32Array),Cartn_z:c.VP.asArrayColumn(Ee.z,Float32Array),id:c.VP.range(0,Ee.count-1),label_asym_id:hn,label_atom_id:dn,label_comp_id:xt,label_seq_id:In,label_entity_id:c.VP.ofConst("1",Ee.count,c.VP.Schema.str),occupancy:c.VP.ofConst(1,Ee.count,c.VP.Schema.float),type_symbol:dn,pdbx_PDB_model_num:c.VP.ofConst(1,Ee.count,c.VP.Schema.int),pdbx_formal_charge:c.VP.ofIntArray(Tn)},Ee.count),Wn=new K.V;Wn.setNames([["MOL","Unknown Entity"]]),Wn.getEntityId("MOL",0,"A");const Xn=new we.N(In,dn);Xn.setNames([["MOL","Unknown Molecule"]]),Xn.add("MOL",0);const Er=(0,ne.z)({entity:Wn.getEntityTable(),chem_comp:Xn.getChemCompTable(),atom_site:_n}),$n=yield(0,be.X)(Er,pe??dt.create(X),De);if($n.frameCount>0){const mr=c.VP.ofIntArray(c.VP.mapToArray(qe.atomIdxA,io=>io-1,Int32Array)),gr=c.VP.ofIntArray(c.VP.mapToArray(qe.atomIdxB,io=>io-1,Int32Array)),Ar=c.VP.asArrayColumn(qe.order,Int32Array),Xr=To.z.fromData({pairs:{indexA:mr,indexB:gr,order:Ar},count:Ee.count},{maxDistance:1/0});To.z.Provider.set($n.representative,Xr)}return $n}),ct.apply(this,arguments)}!function(X){X.is=function pe(Ee){return"mol"===Ee?.kind},X.create=function De(Ee){return{kind:"mol",name:Ee.title,data:Ee}}}(dt||(dt={}));var Mr,Ro,cn=n(5384),xn=n(9651),Rn=n(8593);function br(){return br=(0,e.A)(function*(X,pe,De){var Ee;const qe=X.atom_site._rowCount,bt=c.VP.ofConst("MOL",qe,c.VP.Schema.str),xt=c.VP.ofConst("A",qe,c.VP.Schema.str),hn=c.VP.ofConst(1,qe,c.VP.Schema.int),dn=function ir(X){const{cell:pe,space_group:De}=X,Ee=function er(X){const pe=X.it_number.value(0),De=X["name_h-m_full"].value(0).replace("-"," ");return X.it_number.isDefined?pe:De}(De),qe=cn.O8.create(Ee,S.eB.create(pe.length_a.value(0),pe.length_b.value(0),pe.length_c.value(0)),S.eB.scale((0,S.eB)(),S.eB.create(pe.angle_alpha.value(0),pe.angle_beta.value(0),pe.angle_gamma.value(0)),Math.PI/180));return{spacegroup:cn.is.create(qe),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}(X),In=dn.spacegroup.cell.fromFractional,{fract_x:Tn,fract_y:_n,fract_z:Wn}=X.atom_site,Xn=new Float32Array(qe),Er=new Float32Array(qe),$n=new Float32Array(qe),mr=(0,S.eB)();for(let bo=0;bo<qe;++bo)S.eB.set(mr,Tn.value(bo),_n.value(bo),Wn.value(bo)),S.eB.transformMat4(mr,mr,In),Xn[bo]=mr[0],Er[bo]=mr[1],$n[bo]=mr[2];const{type_symbol:gr,label:Ar}=X.atom_site;let Xr,io;if(gr.isDefined){const bo=new Array(qe),$r=new Int8Array(qe);for(let _r=0;_r<qe;++_r){const eo=gr.value(_r),Ho=eo.length;"+"===eo[Ho-1]?(bo[_r]=eo.substring(0,Ho-2),$r[_r]=parseInt(eo[Ho-2])):"+"===eo[Ho-2]?(bo[_r]=eo.substring(0,Ho-2),$r[_r]=parseInt(eo[Ho-1])):"-"===eo[Ho-1]?(bo[_r]=eo.substring(0,Ho-2),$r[_r]=-parseInt(eo[Ho-2])):"-"===eo[Ho-2]?(bo[_r]=eo.substring(0,Ho-2),$r[_r]=-parseInt(eo[Ho-1])):(bo[_r]=eo,$r[_r]=0)}Xr=c.VP.ofStringArray(bo),io=c.VP.ofIntArray($r)}else{const bo=new Array(qe);for(let $r=0;$r<qe;++$r)bo[$r]=Re(Ar.value($r),"");Xr=c.VP.ofStringArray(bo),io=c.VP.Undefined(qe,c.VP.Schema.int)}const Mo=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:xt,auth_atom_id:Ar,auth_comp_id:bt,auth_seq_id:hn,Cartn_x:c.VP.ofFloatArray(Xn),Cartn_y:c.VP.ofFloatArray(Er),Cartn_z:c.VP.ofFloatArray($n),id:c.VP.range(0,qe-1),label_asym_id:xt,label_atom_id:Ar,label_comp_id:bt,label_seq_id:hn,label_entity_id:c.VP.ofConst("1",qe,c.VP.Schema.str),occupancy:X.atom_site.occupancy.isDefined?X.atom_site.occupancy:c.VP.ofConst(1,qe,c.VP.Schema.float),type_symbol:Xr,pdbx_formal_charge:io,pdbx_PDB_model_num:c.VP.ofConst(1,qe,c.VP.Schema.int),B_iso_or_equiv:X.atom_site.u_iso_or_equiv},qe),Oo=X.chemical.name_common.value(0)||X.chemical.name_systematic.value(0)||X.chemical_formula.sum.value(0),ko=new K.V;ko.setNames([["MOL",Oo||"Unknown Entity"]]),ko.getEntityId("MOL",0,"A");const Xo=new we.N(hn,X.atom_site.type_symbol);Xo.setNames([["MOL",Oo||"Unknown Molecule"]]),Xo.add("MOL",0);const uo=(0,ne.z)({entity:ko.getEntityTable(),chem_comp:Xo.getChemCompTable(),atom_site:Mo}),yr=yield(0,be.X)(uo,pe,De);if(yr.frameCount>0){const bo=yr.representative;xn.i.Provider.set(bo,dn);const $r=X.geom_bond._rowCount;if($r>0){const _r={},{label:eo}=X.atom_site;for(let Es=0,ma=eo.rowCount;Es<ma;++Es)_r[eo.value(Es)]=Es;const Ho=null===(Ee=pe.data.frame.categories.ccdc_geom_bond_type)||void 0===Ee?void 0:Ee.getField(""),wi=[],ui=[],Ss=[],Os=[],ys=[],Zs=new Set;let bs=0;const{atom_site_label_1:Fu,atom_site_label_2:Nu,valence:Kc,distance:Uu}=X.geom_bond;for(let Es=0;Es<$r;++Es){const ma=_r[Fu.value(Es)],Ya=_r[Nu.value(Es)],Zc=ma<Ya?(0,E.m1)(ma,Ya):(0,E.m1)(Ya,ma);if(!Zs.has(Zc)){if(Zs.add(Zc),wi[bs]=ma,ui[bs]=Ya,Os[bs]=Uu.value(Es)||-1,Ho){const Pa=Ho.str(Es);"D"===Pa?(Ss[bs]=2,ys[bs]=1):"A"===Pa?(Ss[bs]=1,ys[bs]=17):(Ss[bs]=1,ys[bs]=1)}else ys[bs]=1,Ss[bs]=Kc.isDefined?Kc.value(Es):1;bs+=1}}To.z.Provider.set(bo,To.z.fromData({pairs:{indexA:c.VP.ofIntArray(wi),indexB:c.VP.ofIntArray(ui),order:c.VP.ofIntArray(Ss),distance:c.VP.ofFloatArray(Os),flag:c.VP.ofIntArray(ys)},count:qe}))}}return yr}),br.apply(this,arguments)}function Ur(){return Ur=(0,e.A)(function*(X,pe){const{atoms:De}=X,Ee=c.VP.ofConst("MOL",X.atoms.count,c.VP.Schema.str),qe=c.VP.ofConst("A",X.atoms.count,c.VP.Schema.str),bt=c.VP.ofArray({array:c.VP.mapToArray(De.number,_n=>(0,ke.FW)(_n)),schema:c.VP.Schema.Aliased(c.VP.Schema.str)}),xt=c.VP.ofConst(1,De.count,c.VP.Schema.int),hn=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:qe,auth_atom_id:bt,auth_comp_id:Ee,auth_seq_id:xt,Cartn_x:c.VP.asArrayColumn(De.x,Float32Array),Cartn_y:c.VP.asArrayColumn(De.y,Float32Array),Cartn_z:c.VP.asArrayColumn(De.z,Float32Array),id:c.VP.range(0,De.count-1),label_asym_id:qe,label_atom_id:bt,label_comp_id:Ee,label_seq_id:xt,label_entity_id:c.VP.ofConst("1",De.count,c.VP.Schema.str),occupancy:c.VP.ofConst(1,De.count,c.VP.Schema.float),type_symbol:bt,pdbx_PDB_model_num:c.VP.ofConst(1,De.count,c.VP.Schema.int)},De.count),dn=new K.V;dn.setNames([["MOL","Unknown Entity"]]),dn.getEntityId("MOL",0,"A");const In=new we.N(xt,bt);In.setNames([["MOL","Unknown Molecule"]]),In.add("MOL",0);const Tn=(0,ne.z)({entity:dn.getEntityTable(),chem_comp:In.getChemCompTable(),atom_site:hn});return yield(0,be.X)(Tn,Ro.create(X),pe)}),Ur.apply(this,arguments)}Rn._.Provider.formatRegistry.add("cifCore",function vr(X){if(!Mr.is(X.sourceData))return;const{atom_site:pe,atom_site_aniso:De}=X.sourceData.data.db;return{data:c.XI.ofPartialColumns(Rn._.Schema,{U:De.u},De._rowCount),elementToAnsiotrop:Rn._.getElementToAnsiotropFromLabel(pe.label,De.label)}},function Hr(X){return!!Mr.is(X.sourceData)&&X.sourceData.data.db.atom_site_aniso.u.isDefined}),function(X){X.is=function pe(Ee){return"cifCore"===Ee?.kind},X.fromFrame=function De(Ee,qe){return qe||(qe=ce.f$.schema.cifCore(Ee)),{kind:"cifCore",name:qe.database_code.depnum_ccdc_archive.value(0)||qe.database_code.depnum_ccdc_fiz.value(0)||qe.database_code.icsd.value(0)||qe.database_code.mdf.value(0)||qe.database_code.nbs.value(0)||qe.database_code.csd.value(0)||qe.database_code.cod.value(0)||qe._name,data:{db:qe,frame:Ee}}}}(Mr||(Mr={})),function(X){X.is=function pe(Ee){return"cube"===Ee?.kind},X.create=function De(Ee){return{kind:"cube",name:Ee.header.comment1,data:Ee}}}(Ro||(Ro={}));const{skipWhitespace:po,eatValue:so,markLine:ho,getTokenString:Bo,readLine:Go}=i._F;function We(X,pe){return{tokenizer:X,molecule:{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""},runtimeCtx:pe}}const Pt=/\s+/g;function Sn(X){const{tokenizer:pe,molecule:De}=X;for(;"@<TRIPOS>MOLECULE"!==Bo(pe)&&pe.position<pe.data.length;)ho(pe);ho(pe),De.mol_name=Bo(pe),ho(pe);const Ee=Bo(pe).trim().split(Pt);De.num_atoms=parseInt(Ee[0]),De.num_bonds=parseInt(Ee[1]),De.num_subst=parseInt(Ee[2]),De.num_feat=parseInt(Ee[3]),De.num_sets=parseInt(Ee[4]),ho(pe);const qe=Bo(pe);if(qe.startsWith("@<TRIPOS>"))return;De.mol_type=qe,ho(pe);const bt=Bo(pe);if(bt.startsWith("@<TRIPOS>"))return;De.charge_type=bt,ho(pe);const xt=Bo(pe);if(xt.startsWith("@<TRIPOS>"))return;De.status_bits=xt,ho(pe);const hn=Bo(pe);hn.startsWith("@<TRIPOS>")||(De.mol_comment=hn)}function Nn(X){return Kn.apply(this,arguments)}function Kn(){return Kn=(0,e.A)(function*(X){const{tokenizer:pe,molecule:De}=X;for(;"@<TRIPOS>ATOM"!==Bo(pe)&&pe.position<pe.data.length;)ho(pe);const Ee=pe.position,qe=pe.lineNumber,hn=Go(pe).trim().split(/\s+/g).length,dn=i.tM.create(pe.data,2*De.num_atoms),In=i.tM.create(pe.data,2*De.num_atoms),Tn=i.tM.create(pe.data,2*De.num_atoms),_n=i.tM.create(pe.data,2*De.num_atoms),Wn=i.tM.create(pe.data,2*De.num_atoms),Xn=i.tM.create(pe.data,2*De.num_atoms),Er=i.tM.create(pe.data,2*De.num_atoms),$n=i.tM.create(pe.data,2*De.num_atoms),mr=i.tM.create(pe.data,2*De.num_atoms),gr=i.tM.create(pe.data,2*De.num_atoms),Ar=c.VP.Undefined(De.num_atoms,c.VP.Schema.float),Xr=c.VP.Undefined(De.num_atoms,c.VP.Schema.int),io=c.VP.Undefined(De.num_atoms,c.VP.Schema.str);pe.position=Ee,pe.lineNumber=qe;const{length:Mo}=pe;let Oo=0;return yield(0,r.yB)(X.runtimeCtx,1e5,void 0,Xo=>{const uo=Math.min(De.num_atoms-Oo,Xo);for(let yr=0;yr<uo;yr++)for(let bo=0;bo<hn;bo++)switch(po(pe),pe.tokenStart=pe.position,so(pe),bo){case 0:i.tM.addUnchecked(dn,pe.tokenStart,pe.tokenEnd);break;case 1:i.tM.addUnchecked(In,pe.tokenStart,pe.tokenEnd);break;case 2:i.tM.addUnchecked(Tn,pe.tokenStart,pe.tokenEnd);break;case 3:i.tM.addUnchecked(_n,pe.tokenStart,pe.tokenEnd);break;case 4:i.tM.addUnchecked(Wn,pe.tokenStart,pe.tokenEnd);break;case 5:i.tM.addUnchecked(Xn,pe.tokenStart,pe.tokenEnd);break;case 6:i.tM.addUnchecked(Er,pe.tokenStart,pe.tokenEnd);break;case 7:i.tM.addUnchecked($n,pe.tokenStart,pe.tokenEnd);break;case 8:i.tM.addUnchecked(mr,pe.tokenStart,pe.tokenEnd);break;case 9:i.tM.addUnchecked(gr,pe.tokenStart,pe.tokenEnd)}return Oo+=uo,uo},Xo=>Xo.update({message:"Parsing...",current:pe.position,max:Mo})),{count:De.num_atoms,atom_id:(0,pn.do)(dn)(c.VP.Schema.int),atom_name:(0,pn.do)(In)(c.VP.Schema.str),x:(0,pn.do)(Tn)(c.VP.Schema.float),y:(0,pn.do)(_n)(c.VP.Schema.float),z:(0,pn.do)(Wn)(c.VP.Schema.float),atom_type:hn>5?(0,pn.do)(Xn)(c.VP.Schema.str):io,subst_id:hn>6?(0,pn.do)(Er)(c.VP.Schema.int):Xr,subst_name:hn>7?(0,pn.do)($n)(c.VP.Schema.str):io,charge:hn>8?(0,pn.do)(mr)(c.VP.Schema.float):Ar,status_bit:hn>9?(0,pn.do)(gr)(c.VP.Schema.str):io}}),Kn.apply(this,arguments)}function dr(X){return xr.apply(this,arguments)}function xr(){return xr=(0,e.A)(function*(X){const{tokenizer:pe,molecule:De}=X;for(;"@<TRIPOS>BOND"!==Bo(pe)&&pe.position<pe.data.length;)ho(pe);const Ee=pe.position,qe=pe.lineNumber,hn=Go(pe).trim().split(/\s+/g).length,dn=i.tM.create(pe.data,2*De.num_bonds),In=i.tM.create(pe.data,2*De.num_bonds),Tn=i.tM.create(pe.data,2*De.num_bonds),_n=i.tM.create(pe.data,2*De.num_bonds),Wn=i.tM.create(pe.data,2*De.num_bonds);pe.position=Ee,pe.lineNumber=qe;const{length:Xn}=pe;let Er=0;return yield(0,r.yB)(X.runtimeCtx,1e5,void 0,mr=>{const gr=Math.min(De.num_bonds-Er,mr);for(let Ar=0;Ar<gr;Ar++)for(let Xr=0;Xr<hn;Xr++)switch(po(pe),pe.tokenStart=pe.position,so(pe),Xr){case 0:i.tM.addUnchecked(dn,pe.tokenStart,pe.tokenEnd);break;case 1:i.tM.addUnchecked(In,pe.tokenStart,pe.tokenEnd);break;case 2:i.tM.addUnchecked(Tn,pe.tokenStart,pe.tokenEnd);break;case 3:i.tM.addUnchecked(_n,pe.tokenStart,pe.tokenEnd);break;default:i.tM.addUnchecked(Wn,pe.tokenStart,pe.tokenEnd)}return Er+=gr,gr},mr=>mr.update({message:"Parsing...",current:pe.position,max:Xn})),{count:De.num_bonds,bond_id:(0,pn.do)(dn)(c.VP.Schema.int),origin_atom_id:(0,pn.do)(In)(c.VP.Schema.int),target_atom_id:(0,pn.do)(Tn)(c.VP.Schema.int),bond_type:(0,pn.do)(_n)(c.VP.Schema.str),status_bits:hn>4?(0,pn.do)(Wn)(c.VP.Schema.str):c.VP.Undefined(De.num_bonds,c.VP.Schema.str)}}),xr.apply(this,arguments)}function Ft(X){const{tokenizer:pe}=X;for(;pe.position<pe.data.length;){const Ee=Bo(pe);if("@<TRIPOS>MOLECULE"===Ee)return;if("@<TRIPOS>CRYSIN"===Ee)break;ho(pe)}if(pe.position>=pe.data.length)return;ho(pe);const De=Bo(pe).trim().split(Pt);return{a:parseFloat(De[0]),b:parseFloat(De[1]),c:parseFloat(De[2]),alpha:parseFloat(De[3]),beta:parseFloat(De[4]),gamma:parseFloat(De[5]),spaceGroup:parseInt(De[6],10),setting:parseInt(De[7],10)}}function ht(){return ht=(0,e.A)(function*(X,pe,De){const Ee=(0,i._F)(pe);X.update({message:"Parsing...",current:0,max:pe.length});const qe=[];for(;Ee.position<pe.length;){const xt=We(Ee,X);Sn(xt);const hn=yield Nn(xt),dn=yield dr(xt),In=Ft(xt);for(qe.push({molecule:xt.molecule,atoms:hn,bonds:dn,crysin:In}),po(Ee);"@<TRIPOS>MOLECULE"!==Bo(Ee)&&Ee.position<Ee.data.length;)ho(Ee)}return o.H.success({name:De,structures:qe})}),ht.apply(this,arguments)}function fn(){return fn=(0,e.A)(function*(X,pe){const De=[];for(let Ee=0,qe=X.structures.length;Ee<qe;++Ee){const{molecule:bt,atoms:xt,bonds:hn,crysin:dn}=X.structures[Ee],In=c.VP.ofConst("A",xt.count,c.VP.Schema.str),Tn=new Array(xt.count);let _n=!1;for(let gr=0;gr<xt.count;++gr)if(xt.atom_type.value(gr).includes(".")){_n=!0;break}for(let gr=0;gr<xt.count;++gr)Tn[gr]=_n?xt.atom_type.value(gr).split(".")[0].toUpperCase():Re(xt.atom_name.value(gr),xt.subst_name.value(gr));const Wn=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:In,auth_atom_id:c.VP.asArrayColumn(xt.atom_name),auth_comp_id:xt.subst_name,auth_seq_id:xt.subst_id,Cartn_x:c.VP.asArrayColumn(xt.x,Float32Array),Cartn_y:c.VP.asArrayColumn(xt.y,Float32Array),Cartn_z:c.VP.asArrayColumn(xt.z,Float32Array),id:c.VP.asArrayColumn(xt.atom_id),label_asym_id:In,label_atom_id:c.VP.asArrayColumn(xt.atom_name),label_comp_id:xt.subst_name,label_seq_id:xt.subst_id,label_entity_id:c.VP.ofConst("1",xt.count,c.VP.Schema.str),occupancy:c.VP.ofConst(1,xt.count,c.VP.Schema.float),type_symbol:c.VP.ofStringArray(Tn),pdbx_PDB_model_num:c.VP.ofConst(Ee,xt.count,c.VP.Schema.int)},xt.count),Xn=new K.V;Xn.setNames([["MOL",bt.mol_name||"Unknown Entity"]]),Xn.getEntityId("MOL",0,"A");const Er=new we.N(xt.subst_id,xt.atom_name);for(let gr=0,Ar=xt.subst_name.rowCount;gr<Ar;++gr)Er.add(xt.subst_name.value(gr),gr);const $n=(0,ne.z)({entity:Xn.getEntityTable(),chem_comp:Er.getChemCompTable(),atom_site:Wn}),mr=yield(0,be.X)($n,En.create(X),pe);if(mr.frameCount>0){const gr=c.VP.ofIntArray(c.VP.mapToArray(hn.origin_atom_id,Xo=>Xo-1,Int32Array)),Ar=c.VP.ofIntArray(c.VP.mapToArray(hn.target_atom_id,Xo=>Xo-1,Int32Array)),Xr=hn.bond_id,io=c.VP.ofIntArray(c.VP.mapToArray(hn.bond_type,Xo=>{switch(Xo){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(Xo)}},Int8Array)),Mo=c.VP.ofIntArray(c.VP.mapToArray(hn.bond_type,Xo=>{switch(Xo){case"ar":case"am":return 17;case"du":case"nc":return 0;default:return 1}},Int8Array)),Oo=To.z.fromData({pairs:{key:Xr,indexA:gr,indexB:Ar,order:io,flag:Mo},count:xt.count},{maxDistance:dn?-1:1/0}),ko=mr.representative;if(To.z.Provider.set(ko,Oo),Gt.j.Provider.set(ko,{data:xt.charge,type:bt.charge_type}),dn){const Xo=on(dn);Xo&&xn.i.Provider.set(ko,Xo)}De.push(ko)}}return new jt.P4(De)}),fn.apply(this,arguments)}function on(X){if(1!==X.setting)return;const pe=cn.O8.create(X.spaceGroup,S.eB.create(X.a,X.b,X.c),S.eB.scale((0,S.eB)(),S.eB.create(X.alpha,X.beta,X.gamma),Math.PI/180));return{spacegroup:cn.is.create(pe),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var En;!function(X){X.is=function pe(Ee){return"mol2"===Ee?.kind},X.create=function De(Ee){return{kind:"mol2",name:Ee.name,data:Ee}}}(En||(En={}));const Fe=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),He=9;var Ye,rr;function ot(){throw new Error("(xdrfile error) Undefined error.")}function St(){return St=(0,e.A)(function*(X,pe){const De=new DataView(pe.buffer,pe.byteOffset),Ee={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},qe=Ee.frames,bt=Ee.boxes,xt=Ee.times,hn=[0,0,0,0,0,0],dn=[0,0,0],In=[0,0,0],Tn=[0,0,0],_n=[.1,.1,.1],Wn=[.1,.1,.1];let Xn=0;const Er=Ye.buf;for(;;){let $n;const mr=De.getInt32(Xn+4);Xn+=12,xt.push(De.getFloat32(Xn)),Xn+=4;const gr=new Float32Array(9);for(let Ar=0;Ar<9;++Ar)gr[Ar]=10*De.getFloat32(Xn),Xn+=4;if(bt.push(gr),mr<=9){$n={count:mr/3,x:new Float32Array(mr/3),y:new Float32Array(mr/3),z:new Float32Array(mr/3)};for(let Ar=0;Ar<mr/3;++Ar)$n.x[Ar]=De.getFloat32(Xn),$n.y[Ar]=De.getFloat32(Xn),$n.z[Ar]=De.getFloat32(Xn),Xn+=4}else{Er[0]=Er[1]=Er[2]=0,dn[0]=dn[1]=dn[2]=0,Tn[0]=Tn[1]=Tn[2]=0,In[0]=In[1]=In[2]=0,_n[0]=_n[1]=_n[2]=0,Wn[0]=Wn[1]=Wn[2]=0,$n={count:mr,x:new Float32Array(mr),y:new Float32Array(mr),z:new Float32Array(mr)};let Ar=0;const Xr=De.getInt32(Xn);Xn+=4;const io=De.getFloat32(Xn);let Mo;Xn+=4,hn[0]=De.getInt32(Xn),hn[1]=De.getInt32(Xn+4),hn[2]=De.getInt32(Xn+8),hn[3]=De.getInt32(Xn+12),hn[4]=De.getInt32(Xn+16),hn[5]=De.getInt32(Xn+20),dn[0]=hn[3]-hn[0]+1,dn[1]=hn[4]-hn[1]+1,dn[2]=hn[5]-hn[2]+1,Xn+=24,(dn[0]|dn[1]|dn[2])>16777215?(In[0]=Ye.sizeOfInt(dn[0]),In[1]=Ye.sizeOfInt(dn[1]),In[2]=Ye.sizeOfInt(dn[2]),Mo=0):Mo=Ye.sizeOfInts(3,dn);let Oo=De.getInt32(Xn);Xn+=4;let ko=Oo-1;ko=He>ko?He:ko;let Xo=Fe[ko]/2|0,uo=Fe[Oo]/2|0;Tn[0]=Tn[1]=Tn[2]=Fe[Oo];const yr=4*Math.ceil(De.getInt32(Xn)/4);Xn+=4;const bo=1/io;let $r=0,_r=0;for(_n[0]=_n[1]=_n[2]=0;_r<Xr;){0===Mo?(_n[0]=Ye.decodeBits(pe,Xn,In[0]),_n[1]=Ye.decodeBits(pe,Xn,In[1]),_n[2]=Ye.decodeBits(pe,Xn,In[2])):Ye.decodeInts(pe,Xn,Mo,dn,_n),_r++,_n[0]+=hn[0],_n[1]+=hn[1],_n[2]+=hn[2],Wn[0]=_n[0],Wn[1]=_n[1],Wn[2]=_n[2];let Ho=0;if(1===Ye.decodeBits(pe,Xn,1)&&($r=Ye.decodeBits(pe,Xn,5),Ho=$r%3,$r-=Ho,Ho--),$r>0){_n[0]=_n[1]=_n[2]=0;for(let wi=0;wi<$r;wi+=3){if(Ye.decodeInts(pe,Xn,Oo,Tn,_n),_r++,_n[0]+=Wn[0]-uo,_n[1]+=Wn[1]-uo,_n[2]+=Wn[2]-uo,0===wi){let ui=_n[0];_n[0]=Wn[0],Wn[0]=ui,ui=_n[1],_n[1]=Wn[1],Wn[1]=ui,ui=_n[2],_n[2]=Wn[2],Wn[2]=ui,$n.x[Ar]=Wn[0]*bo,$n.y[Ar]=Wn[1]*bo,$n.z[Ar]=Wn[2]*bo,Ar++}else Wn[0]=_n[0],Wn[1]=_n[1],Wn[2]=_n[2];$n.x[Ar]=_n[0]*bo,$n.y[Ar]=_n[1]*bo,$n.z[Ar]=_n[2]*bo,Ar++}}else $n.x[Ar]=_n[0]*bo,$n.y[Ar]=_n[1]*bo,$n.z[Ar]=_n[2]*bo,Ar++;Oo+=Ho,Ho<0?(uo=Xo,Xo=Oo>He?Fe[Oo-1]/2|0:0):Ho>0&&(Xo=uo,uo=Fe[Oo]/2|0),Tn[0]=Tn[1]=Tn[2]=Fe[Oo],(0===Tn[0]||0===Tn[1]||0===Tn[2])&&ot()}Xn+=yr}for(let Ar=0;Ar<mr;Ar++)$n.x[Ar]*=10,$n.y[Ar]*=10,$n.z[Ar]*=10;if(qe.push($n),X.shouldUpdate&&(yield X.update({current:Xn,max:pe.length})),Xn>=pe.length)break}return xt.length>=1&&(Ee.timeOffset=xt[0]),xt.length>=2&&(Ee.deltaTime=xt[1]-xt[0]),Ee}),St.apply(this,arguments)}function zt(X){let pe=X.position>=X.data.length-1?0:+i._F.readLine(X);isNaN(pe)&&(pe=0);const De=i._F.readLine(X),Ee=new Float64Array(pe),qe=new Float64Array(pe),bt=new Float64Array(pe),xt=new Array(pe);for(let hn=0;hn<pe;++hn){const In=i._F.readLineTrim(X).split(/\s+/g);xt[hn]=In[0],Ee[hn]=+In[1],qe[hn]=+In[2],bt[hn]=+In[3]}return{count:pe,comment:De,x:c.VP.ofFloatArray(Ee),y:c.VP.ofFloatArray(qe),z:c.VP.ofFloatArray(bt),type_symbol:c.VP.ofStringArray(xt)}}function Ao(X){i._F.skipWhitespace(X),i._F.eatValue(X)}function yo(X,pe){const{position:De}=X;i._F.skipWhitespace(X),i._F.eatValue(X),i._F.trim(X,De,X.position),i.tM.addUnchecked(pe,X.tokenStart,X.tokenEnd)}!function(X){X.sizeOfInt=function pe(Tn){let _n=1,Wn=0;for(;Tn>=_n&&Wn<32;)Wn++,_n<<=1;return Wn};const De=new Uint8Array(32);X.sizeOfInts=function Ee(Tn,_n){let Wn=1,Xn=0;De[0]=1;for(let $n=0;$n<Tn;$n++){let mr,gr=0;for(mr=0;mr<Wn;mr++)gr+=De[mr]*_n[$n],De[mr]=255&gr,gr>>=8;for(;0!==gr;)De[mr++]=255&gr,gr>>=8;Wn=mr}let Er=1;for(Wn--;De[Wn]>=Er;)Xn++,Er*=2;return Xn+8*Wn};const qe=new ArrayBuffer(24);X.buf=new Int32Array(qe);const bt=new Uint32Array(qe);function xt(Tn,_n,Wn){let Xn=Wn;const Er=(1<<Xn)-1;let $n=bt[1],mr=bt[2],gr=X.buf[0],Ar=0;for(;Xn>=8;)mr=mr<<8|Tn[_n+gr++],Ar|=mr>>$n<<Xn-8,Xn-=8;return Xn>0&&($n<Xn&&($n+=8,mr=mr<<8|Tn[_n+gr++]),$n-=Xn,Ar|=mr>>$n&(1<<Xn)-1),Ar&=Er,X.buf[0]=gr,X.buf[1]=$n,X.buf[2]=mr,Ar}function hn(Tn,_n){let Wn=bt[2];const Xn=X.buf[0];return Wn=Wn<<8|Tn[_n+Xn],X.buf[0]=Xn+1,X.buf[2]=Wn,Wn>>bt[1]&255}X.decodeBits=xt;const dn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];X.decodeInts=function In(Tn,_n,Wn,Xn,Er){let $n=Wn,mr=0;for(dn[0]=0,dn[1]=0,dn[2]=0,dn[3]=0;$n>8;)dn[mr++]=hn(Tn,_n),$n-=8;$n>0&&(dn[mr++]=xt(Tn,_n,$n));for(let gr=2;gr>0;gr--){let Ar=0;const Xr=Xn[gr];for(let io=mr-1;io>=0;io--){Ar=Ar<<8|dn[io];const Mo=Ar/Xr|0;dn[io]=Mo,Ar-=Mo*Xr}Er[gr]=Ar}Er[0]=dn[0]|dn[1]<<8|dn[2]<<16|dn[3]<<24}}(Ye||(Ye={})),function(X){X.is=function pe(Ee){return"xyz"===Ee?.kind},X.create=function De(Ee){return{kind:"xyz",name:"xyz",data:Ee}}}(rr||(rr={}));const vo="$$$$";function lo(X){const pe=i._F.readLine(X).trim(),De=i._F.readLine(X).trim(),Ee=i._F.readLine(X).trim(),qe=i._F.readLine(X),bt=function tr(X){return X.trim().endsWith("V3000")}(qe),{atomCount:xt,bondCount:hn}=bt?function Tr(X){const pe=i.tM.create(X.data,1),De=i.tM.create(X.data,1);return i._F.eatLine(X),Ao(X),Ao(X),Ao(X),yo(X,pe),yo(X,De),i._F.eatLine(X),{atomCount:(0,pn.do)(pe)(c.VP.Schema.int).value(0),bondCount:(0,pn.do)(De)(c.VP.Schema.int).value(0)}}(X):function Do(X){return{atomCount:+X.substr(0,3),bondCount:+X.substr(3,3)}}(qe);if(Number.isNaN(xt)||Number.isNaN(hn)){for(;X.position<X.length&&!i._F.readLine(X).startsWith(vo););return}const dn={atomIdx:c.VP.ofConst(0,xt,c.VP.Schema.int),charge:c.VP.ofConst(0,xt,c.VP.Schema.int)},In=bt?function oo(X,pe){const De=i.tM.create(X.data,2*pe),Ee=i.tM.create(X.data,2*pe),qe=i.tM.create(X.data,2*pe),bt=i.tM.create(X.data,2*pe);for(let xt=0;xt<pe;++xt){i._F.markLine(X),Ao(X),Ao(X),Ao(X);const{position:hn}=X;yo(X,bt),yo(X,De),yo(X,Ee),yo(X,qe),X.position=hn}return i._F.eatLine(X),i._F.eatLine(X),{count:pe,x:(0,pn.do)(De)(c.VP.Schema.float),y:(0,pn.do)(Ee)(c.VP.Schema.float),z:(0,pn.do)(qe)(c.VP.Schema.float),type_symbol:(0,pn.do)(bt)(c.VP.Schema.str),formal_charge:c.VP.ofConst(0,pe,c.VP.Schema.int)}}(X,xt):Pr(X,xt),Tn=bt?function Gr(X,pe){const De=i.tM.create(X.data,2*pe),Ee=i.tM.create(X.data,2*pe),qe=i.tM.create(X.data,2*pe);for(let bt=0;bt<pe;++bt){i._F.markLine(X),Ao(X),Ao(X),Ao(X);const{position:xt}=X;yo(X,qe),yo(X,De),yo(X,Ee),X.position=xt}return i._F.eatLine(X),i._F.eatLine(X),{count:pe,atomIdxA:(0,pn.do)(De)(c.VP.Schema.float),atomIdxB:(0,pn.do)(Ee)(c.VP.Schema.float),order:(0,pn.do)(qe)(c.VP.Schema.float)}}(X,hn):or(X,hn),_n=bt?dn:Ir(X),Wn=function Kr(X){const pe=i.tM.create(X.data,32),De=i.tM.create(X.data,32);for(;X.position<X.length;){const Ee=i._F.readLine(X);if(Ee.startsWith(vo))break;if(Ee&&Ee.startsWith("> ")){i.tM.add(pe,X.tokenStart+2,X.tokenEnd),i._F.markLine(X);const qe=X.tokenStart;let bt=X.tokenEnd,xt=!1;for(;X.position<X.length;){const hn=i._F.readLine(X);if(!hn||hn.startsWith(vo)||hn.startsWith("> ")){i.tM.add(De,qe,bt),xt=!0;break}bt=X.tokenEnd}xt||i.tM.add(De,qe,bt)}}return{dataHeader:(0,pn.do)(pe)(c.VP.Schema.str),data:(0,pn.do)(De)(c.VP.Schema.str)}}(X);return{molFile:{title:pe,program:De,comment:Ee,atoms:In,bonds:Tn,formalCharges:_n},dataItems:Wn}}var Po;function Yr(X){return r.YZ.create("Parse SDF",pe=>un(X.molFile,Po.create(X),pe))}function Co(){return Co=(0,e.A)(function*(X){const pe=new DataView(X.buffer),De={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},Ee=De.frames,qe=De.boxes,bt=De.times;let xt=0;for(;;){xt+=8;const hn=pe.getInt32(xt);xt+=4,xt+=hn;const dn=pe.getInt32(xt+8),In=pe.getInt32(xt+12),Tn=pe.getInt32(xt+16),_n=pe.getInt32(xt+28),Wn=pe.getInt32(xt+32),Xn=pe.getInt32(xt+36),Er=pe.getInt32(xt+40);xt+=52;const $n=dn/9,mr=3*Er;if(bt.push(8===$n?pe.getFloat64(xt):pe.getFloat32(xt)),xt+=2*$n,dn){const gr=new Float32Array(9);if(8===$n)for(let Ar=0;Ar<9;++Ar)gr[Ar]=10*pe.getFloat64(xt),xt+=8;else for(let Ar=0;Ar<9;++Ar)gr[Ar]=10*pe.getFloat32(xt),xt+=4;qe.push(gr)}if(xt+=In,xt+=Tn,_n){const gr=new Float32Array(Er),Ar=new Float32Array(Er),Xr=new Float32Array(Er);if(8===$n)for(let io=0;io<Er;++io)gr[io]=10*pe.getFloat64(xt),Ar[io]=10*pe.getFloat64(xt+8),Xr[io]=10*pe.getFloat64(xt+16),xt+=24;else{const io=new Uint32Array(X.buffer,xt,mr);for(let Oo=0;Oo<mr;++Oo){const ko=io[Oo];io[Oo]=(255&ko)<<24|(65280&ko)<<8|ko>>8&65280|ko>>24&255}const Mo=new Float32Array(X.buffer,xt,mr);for(let Oo=0;Oo<Er;++Oo)gr[Oo]=10*Mo[3*Oo],Ar[Oo]=10*Mo[3*Oo+1],Xr[Oo]=10*Mo[3*Oo+2],xt+=12}Ee.push({count:Er,x:gr,y:Ar,z:Xr})}if(xt+=Wn,xt+=Xn,xt>=X.byteLength)break}return bt.length>=1&&(De.timeOffset=bt[0]),bt.length>=2&&(De.deltaTime=bt[1]-bt[0]),De}),Co.apply(this,arguments)}!function(X){X.is=function pe(Ee){return"sdf"===Ee?.kind},X.create=function De(Ee){return{kind:"sdf",name:Ee.molFile.title,data:Ee}}}(Po||(Po={}));const Yo=[];class ci{constructor(pe,De={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let Ee=!1;void 0===pe&&(pe=8192),"number"==typeof pe?pe=new ArrayBuffer(pe):Ee=!0;const qe=De.offset?De.offset>>>0:0,bt=pe.byteLength-qe;let xt=qe;pe instanceof ArrayBuffer||(pe.byteLength!==pe.buffer.byteLength&&(xt=pe.byteOffset+qe),pe=pe.buffer),this._lastWrittenByte=Ee?bt:0,this.buffer=pe,this.length=bt,this.byteLength=bt,this.byteOffset=xt,this._data=new DataView(this.buffer,xt,bt)}available(pe=1){return this.offset+pe<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(pe){return void 0===pe&&(pe=1),this.offset+=pe,this}seek(pe){return this.offset=pe,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const pe=this._marks.pop();if(void 0===pe)throw new Error("Mark stack empty");return this.seek(pe),this}rewind(){return this.offset=0,this}ensureAvailable(pe){if(void 0===pe&&(pe=1),!this.available(pe)){const Ee=2*(this.offset+pe),qe=new Uint8Array(Ee);qe.set(new Uint8Array(this.buffer)),this.buffer=qe.buffer,this.length=this.byteLength=Ee,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(pe){void 0===pe&&(pe=1);const De=new Uint8Array(pe);for(let Ee=0;Ee<pe;Ee++)De[Ee]=this.readByte();return De}readInt16(){const pe=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,pe}readUint16(){const pe=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,pe}readInt32(){const pe=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,pe}readUint32(){const pe=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,pe}readFloat32(){const pe=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,pe}readFloat64(){const pe=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,pe}readChar(){return String.fromCharCode(this.readInt8())}readChars(pe=1){Yo.length=pe;for(let De=0;De<pe;De++)Yo[De]=this.readChar();return Yo.join("")}writeBoolean(pe=!1){return this.writeUint8(pe?255:0),this}writeInt8(pe){return this.ensureAvailable(1),this._data.setInt8(this.offset++,pe),this._updateLastWrittenByte(),this}writeUint8(pe){return this.ensureAvailable(1),this._data.setUint8(this.offset++,pe),this._updateLastWrittenByte(),this}writeByte(pe){return this.writeUint8(pe)}writeBytes(pe){this.ensureAvailable(pe.length);for(let De=0;De<pe.length;De++)this._data.setUint8(this.offset++,pe[De]);return this._updateLastWrittenByte(),this}writeInt16(pe){return this.ensureAvailable(2),this._data.setInt16(this.offset,pe,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(pe){return this.ensureAvailable(2),this._data.setUint16(this.offset,pe,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(pe){return this.ensureAvailable(4),this._data.setInt32(this.offset,pe,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(pe){return this.ensureAvailable(4),this._data.setUint32(this.offset,pe,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(pe){return this.ensureAvailable(4),this._data.setFloat32(this.offset,pe,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(pe){return this.ensureAvailable(8),this._data.setFloat64(this.offset,pe,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(pe){return this.writeUint8(pe.charCodeAt(0))}writeChars(pe){for(let De=0;De<pe.length;De++)this.writeUint8(pe.charCodeAt(De));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}function Jo(X,pe){if(X)throw new TypeError("Not a valid NetCDF v3.x file: "+pe)}function Fi(X){X.offset%4!=0&&X.skip(4-X.offset%4)}function hi(X){const pe=X.readUint32(),De=X.readChars(pe);return Fi(X),De}const No={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function Ci(X){switch(Number(X)){case No.BYTE:return"byte";case No.CHAR:return"char";case No.SHORT:return"short";case No.INT:return"int";case No.FLOAT:return"float";case No.DOUBLE:return"double";default:return"undefined"}}function mi(X){switch(Number(X)){case No.BYTE:case No.CHAR:return 1;case No.SHORT:return 2;case No.INT:case No.FLOAT:return 4;case No.DOUBLE:return 8;default:return-1}}function qi(X){switch(String(X)){case"byte":return No.BYTE;case"char":return No.CHAR;case"short":return No.SHORT;case"int":return No.INT;case"float":return No.FLOAT;case"double":return No.DOUBLE;default:return-1}}function Oi(X,pe){if(1!==X){const De=new Array(X);for(let Ee=0;Ee<X;Ee++)De[Ee]=pe();return De}return pe()}function ti(X,pe,De){switch(pe){case No.BYTE:return X.readBytes(De);case No.CHAR:return function es(X){return 0===X.charCodeAt(X.length-1)?X.substring(0,X.length-1):X}(X.readChars(De));case No.SHORT:return Oi(De,X.readInt16.bind(X));case No.INT:return Oi(De,X.readInt32.bind(X));case No.FLOAT:return Oi(De,X.readFloat32.bind(X));case No.DOUBLE:return Oi(De,X.readFloat64.bind(X));default:return void Jo(!0,"non valid type "+pe)}}const ni=0,Ri=12;function qr(X){let pe;const De=X.readUint32();if(De===ni)return Jo(X.readUint32()!==ni,"wrong empty tag for list of attributes"),[];{Jo(De!==Ri,"wrong tag for list of attributes");const Ee=X.readUint32();pe=new Array(Ee);for(let qe=0;qe<Ee;qe++){const bt=hi(X),xt=X.readUint32();Jo(xt<1||xt>6,"non valid type "+xt);const hn=X.readUint32(),dn=ti(X,xt,hn);Fi(X),pe[qe]={name:bt,type:Ci(xt),value:dn}}}return pe}class zr{constructor(pe){const De=new ci(pe);De.setBigEndian(),Jo("CDF"!==De.readChars(3),"should start with CDF");const Ee=De.readByte();Jo(Ee>2,"unknown version"),this.header=function Qi(X,pe){const De={recordDimension:{length:X.readUint32()}};De.version=pe;const Ee=function Hn(X){let pe,De,Ee;const qe=X.readUint32();if(qe===ni)return Jo(X.readUint32()!==ni,"wrong empty tag for list of dimensions"),[];{Jo(10!==qe,"wrong tag for list of dimensions");const bt=X.readUint32();pe=new Array(bt);for(let xt=0;xt<bt;xt++){const hn=hi(X),dn=X.readUint32();0===dn&&(De=xt,Ee=hn),pe[xt]={name:hn,size:dn}}return{dimensions:pe,recordId:De,recordName:Ee}}}(X);De.recordDimension.id=Ee.recordId,De.recordDimension.name=Ee.recordName,De.dimensions=Ee.dimensions,De.globalAttributes=qr(X);const qe=function co(X,pe,De){const Ee=X.readUint32();let bt,qe=0;if(Ee===ni)return Jo(X.readUint32()!==ni,"wrong empty tag for list of variables"),[];{Jo(11!==Ee,"wrong tag for list of variables");const xt=X.readUint32();bt=new Array(xt);for(let hn=0;hn<xt;hn++){const dn=hi(X),In=X.readUint32(),Tn=new Array(In);for(let $n=0;$n<In;$n++)Tn[$n]=X.readUint32();const _n=qr(X),Wn=X.readUint32();Jo(Wn<1&&Wn>6,"non valid type "+Wn);const Xn=X.readUint32();let Er=X.readUint32();2===De&&(Jo(Er>0,"offsets larger than 4GB not supported"),Er=X.readUint32()),Tn[0]===pe&&(qe+=Xn),bt[hn]={name:dn,dimensions:Tn,attributes:_n,type:Ci(Wn),size:Xn,offset:Er,record:Tn[0]===pe}}}return{variables:bt,recordStep:qe}}(X,Ee.recordId,pe);return De.variables=qe.variables,De.recordDimension.recordStep=qe.recordStep,De}(De,Ee),this.buffer=De}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(pe){return this.header.variables&&-1!==this.header.variables.findIndex(De=>De.name===pe)}getDataVariable(pe){var De;let Ee;if(Ee="string"==typeof pe?null===(De=this.header.variables)||void 0===De?void 0:De.find(qe=>qe.name===pe):pe,void 0===Ee)throw new Error("variable not found");return this.buffer.seek(Ee.offset),Ee.record?function Pi(X,pe,De){const Ee=qi(pe.type),qe=pe.size?pe.size/mi(Ee):1,bt=De.length,xt=new Array(bt),hn=De.recordStep;for(let dn=0;dn<bt;dn++){const In=X.offset;xt[dn]=ti(X,Ee,qe),X.seek(In+hn)}return xt}(this.buffer,Ee,this.header.recordDimension):function Si(X,pe){const De=qi(pe.type),Ee=pe.size/mi(De),qe=new Array(Ee);for(let bt=0;bt<Ee;bt++)qe[bt]=ti(X,De,1);return qe}(this.buffer,Ee)}}function kr(){return kr=(0,e.A)(function*(X){const pe=new zr(X),De={coordinates:[],time:[],timeOffset:0,deltaTime:1};for(const Ee of pe.getDataVariable("coordinates"))De.coordinates.push(Ee);if(pe.hasDataVariable("velocities")){const Ee=[];for(const qe of pe.getDataVariable("velocities"))Ee.push(qe);De.velocities=Ee}if(pe.hasDataVariable("forces")){const Ee=[];for(const qe of pe.getDataVariable("forces"))Ee.push(qe);De.forces=Ee}if(pe.hasDataVariable("cell_lengths")){const Ee=[];for(const qe of pe.getDataVariable("cell_lengths"))Ee.push(qe);De.cell_lengths=Ee}if(pe.hasDataVariable("cell_angles")){const Ee=[];for(const qe of pe.getDataVariable("cell_angles"))Ee.push(qe);De.cell_angles=Ee}if(pe.hasDataVariable("time")){const Ee=[];for(const qe of pe.getDataVariable("time"))Ee.push(qe);De.time=Ee}return De.time&&(De.time.length>=1&&(De.timeOffset=De.time[0]),De.time.length>=2&&(De.deltaTime=De.time[1]-De.time[0])),De}),kr.apply(this,arguments)}var Bi,Ei;!function(X){X.is=function pe(Ee){return"prmtop"===Ee?.kind},X.fromPrmtop=function De(Ee){return{kind:"prmtop",name:Ee.title.join(" ")||"PRMTOP",data:Ee}}}(Bi||(Bi={})),function(X){X.is=function pe(Ee){return"top"===Ee?.kind},X.fromTop=function De(Ee){return{kind:"top",name:Ee.system||"TOP",data:Ee}}}(Ei||(Ei={}));const Ht=Zt.H.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[Zt.O.Data.Binary],to:Zt.O.Molecule.Coordinates})({apply:({a:X})=>r.YZ.create("Parse DCD",function(){var pe=(0,e.A)(function*(De){const Ee=yield function y(X){return r.YZ.create("Parse DCD",function(){var pe=(0,e.A)(function*(De){try{const Ee=function A(X){const pe=new DataView(X.buffer),De=Object.create(null),Ee=[];let qe=0;const bt=new Int32Array(X.buffer,0,23),xt=bt[0]!==pe.getInt32(0);if(84!==bt[0]){const $n=X.byteLength;for(let mr=0;mr<$n;mr+=4)pe.setFloat32(mr,pe.getFloat32(mr),!0)}if(84!==bt[0])throw new Error("dcd bad format, header block start");if("CORD"!==String.fromCharCode(pe.getUint8(4),pe.getUint8(5),pe.getUint8(6),pe.getUint8(7)))throw new Error("dcd bad format, format string");let dn=!1,In=!1,Tn=!1;if(0!==bt[22]&&(dn=!0,0!==bt[12]&&(In=!0),1===bt[13]&&(Tn=!0)),De.NSET=bt[2],De.ISTART=bt[3],De.NSAVC=bt[4],De.NAMNF=bt[10],De.DELTA=dn?pe.getFloat32(44,xt):pe.getFloat64(44,xt),84!==bt[22])throw new Error("dcd bad format, header block end");qe=qe+84+8;const _n=pe.getInt32(qe,xt),Wn=qe+1;if((_n-4)%80!=0)throw new Error("dcd bad format, title block start");if(De.TITLE=(0,t.$q)(X.subarray(Wn,_n)),pe.getInt32(Wn+_n+4-1,xt)!==_n)throw new Error("dcd bad format, title block end");if(qe=qe+_n+8,4!==pe.getInt32(qe,xt))throw new Error("dcd bad format, natom block start");if(De.NATOM=pe.getInt32(qe+4,xt),4!==pe.getInt32(qe+8,xt))throw new Error("dcd bad format, natom block end");if(qe=qe+4+8,De.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");const Xn=De.NATOM,Er=4*Xn;for(let $n=0,mr=De.NSET;$n<mr;++$n){const gr=Object.create(null);gr.elementCount=Xn,In&&(qe+=4,gr.cell=[pe.getFloat64(qe,xt),pe.getFloat64(qe+1,xt),pe.getFloat64(qe+16,xt),pe.getFloat64(qe+24,xt),pe.getFloat64(qe+32,xt),pe.getFloat64(qe+40,xt)],qe+=48,qe+=4);for(let Ar=0;Ar<3;++Ar){if(pe.getInt32(qe,xt)!==Er)throw new Error(`dcd bad format, coord block start: ${$n}, ${Ar}`);qe+=4;const Xr=new Float32Array(X.buffer,qe,Xn);if(0===Ar?gr.x=Xr:1===Ar?gr.y=Xr:gr.z=Xr,qe+=Er,pe.getInt32(qe,xt)!==Er)throw new Error(`dcd bad format, coord block end: ${$n}, ${Ar}`);qe+=4}Tn&&(qe+=4+pe.getInt32(qe,xt)+4),Ee.push(gr)}return{header:De,frames:Ee}}(X);return o.H.success(Ee)}catch(Ee){return o.H.error(Ee)}});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function xe(X){return r.YZ.create("Parse DCD",function(){var pe=(0,e.A)(function*(De){yield De.update("Converting to coordinates");const{header:Ee}=X,qe=Ee.DELTA?(0,q.g)(20.45482949774598*Ee.DELTA,"ps"):(0,q.g)(1,"step"),bt=(0,q.g)(Ee.ISTART>=1?(Ee.ISTART-1)*qe.value:0,qe.unit),xt=[];for(let hn=0,dn=X.frames.length;hn<dn;++hn){const In=X.frames[hn],Tn={elementCount:In.elementCount,time:(0,q.g)(bt.value+qe.value*hn,qe.unit),x:In.x,y:In.y,z:In.z,xyzOrdering:{isIdentity:!0}};if(In.cell){const _n=In.cell;Tn.cell=_n[1]>=-1&&_n[1]<=1&&_n[3]>=-1&&_n[3]<=1&&_n[4]>=-1&&_n[4]<=1?ee.create(S.eB.create(_n[0],_n[2],_n[5]),S.eB.create((0,Y.pu)(90-90*Math.asin(_n[1])/Y.fC),(0,Y.pu)(90-90*Math.asin(_n[3])/Y.fC),(0,Y.pu)(90-90*Math.asin(_n[4])/Y.fC))):_n[0]<0||_n[1]<0||_n[2]<0||_n[3]<0||_n[4]<0||_n[5]<0||_n[3]>180||_n[4]>180||_n[5]>180?ee.fromBasis(S.eB.create(_n[0],_n[1],_n[3]),S.eB.create(_n[1],_n[2],_n[4]),S.eB.create(_n[3],_n[4],_n[5])):ee.create(S.eB.create(_n[0],_n[2],_n[5]),S.eB.create((0,Y.pu)((0,g.T)(_n[1],0,g.p)?90:_n[1]),(0,Y.pu)((0,g.T)(_n[3],0,g.p)?90:_n[3]),(0,Y.pu)((0,g.T)(_n[4],0,g.p)?90:_n[4])))}xt.push(Tn)}return q.E.create(xt,qe,bt)});return function(De){return pe.apply(this,arguments)}}())}(Ee.result).runInContext(De);return new Zt.O.Molecule.Coordinates(qe,{label:X.label,description:"Coordinates"})});return function(De){return pe.apply(this,arguments)}}())}),Gn=Zt.H.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[Zt.O.Data.Binary],to:Zt.O.Molecule.Coordinates})({apply:({a:X})=>r.YZ.create("Parse XTC",function(){var pe=(0,e.A)(function*(De){const Ee=yield function vt(X){return r.YZ.create("Parse XTC",function(){var pe=(0,e.A)(function*(De){try{De.update({canAbort:!0,message:"Parsing trajectory..."});const Ee=yield function rt(X,pe){return St.apply(this,arguments)}(De,X);return o.H.success(Ee)}catch(Ee){return o.H.error(""+Ee)}});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function mn(X){return r.YZ.create("Parse XTC",function(){var pe=(0,e.A)(function*(De){yield De.update("Converting to coordinates");const Ee=(0,q.g)(X.deltaTime,"step"),qe=(0,q.g)(X.timeOffset,Ee.unit),bt=[];for(let xt=0,hn=X.frames.length;xt<hn;++xt){const dn=X.boxes[xt],In=S.eB.fromArray((0,S.eB)(),dn,0),Tn=S.eB.fromArray((0,S.eB)(),dn,3),_n=S.eB.fromArray((0,S.eB)(),dn,6);bt.push({elementCount:X.frames[xt].count,cell:ee.fromBasis(In,Tn,_n),x:X.frames[xt].x,y:X.frames[xt].y,z:X.frames[xt].z,xyzOrdering:{isIdentity:!0},time:(0,q.g)(qe.value+Ee.value*xt,Ee.unit)})}return q.E.create(bt,Ee,qe)});return function(De){return pe.apply(this,arguments)}}())}(Ee.result).runInContext(De);return new Zt.O.Molecule.Coordinates(qe,{label:X.label,description:"Coordinates"})});return function(De){return pe.apply(this,arguments)}}())}),ar=Zt.H.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[Zt.O.Data.Binary],to:Zt.O.Molecule.Coordinates})({apply:({a:X})=>r.YZ.create("Parse TRR",function(){var pe=(0,e.A)(function*(De){const Ee=yield function Eo(X){return r.YZ.create("Parse TRR",function(){var pe=(0,e.A)(function*(De){try{De.update({canAbort:!0,message:"Parsing trajectory..."});const Ee=yield function jr(X){return Co.apply(this,arguments)}(X);return o.H.success(Ee)}catch(Ee){return o.H.error(""+Ee)}});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function Fo(X){return r.YZ.create("Parse TRR",function(){var pe=(0,e.A)(function*(De){yield De.update("Converting to coordinates");const Ee=(0,q.g)(X.deltaTime,"step"),qe=(0,q.g)(X.timeOffset,Ee.unit),bt=[];for(let xt=0,hn=X.frames.length;xt<hn;++xt){const dn=X.boxes[xt],In=S.eB.fromArray((0,S.eB)(),dn,0),Tn=S.eB.fromArray((0,S.eB)(),dn,3),_n=S.eB.fromArray((0,S.eB)(),dn,6);bt.push({elementCount:X.frames[xt].count,cell:ee.fromBasis(In,Tn,_n),x:X.frames[xt].x,y:X.frames[xt].y,z:X.frames[xt].z,xyzOrdering:{isIdentity:!0},time:(0,q.g)(qe.value+Ee.value*xt,Ee.unit)})}return q.E.create(bt,Ee,qe)});return function(De){return pe.apply(this,arguments)}}())}(Ee.result).runInContext(De);return new Zt.O.Molecule.Coordinates(qe,{label:X.label,description:"Coordinates"})});return function(De){return pe.apply(this,arguments)}}())}),kn=Zt.H.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[Zt.O.Data.Binary],to:Zt.O.Molecule.Coordinates})({apply:({a:X})=>r.YZ.create("Parse NCTRAJ",function(){var pe=(0,e.A)(function*(De){const Ee=yield function Qr(X){return r.YZ.create("Parse NCTRAJ",function(){var pe=(0,e.A)(function*(De){try{De.update({canAbort:!0,message:"Parsing trajectory..."});const Ee=yield function lr(X){return kr.apply(this,arguments)}(X);return o.H.success(Ee)}catch(Ee){return o.H.error(""+Ee)}});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function vi(X){return r.YZ.create("Parse NCTRAJ",function(){var pe=(0,e.A)(function*(De){yield De.update("Converting to coordinates");const Ee=(0,q.g)(X.deltaTime,"step"),qe=(0,q.g)(X.timeOffset,Ee.unit),bt=[];for(let xt=0,hn=X.coordinates.length;xt<hn;++xt){const dn=X.coordinates[xt],In=dn.length/3,Tn=new Float32Array(In),_n=new Float32Array(In),Wn=new Float32Array(In);for(let Er=0,$n=dn.length;Er<$n;Er+=3)Tn[Er/3]=dn[Er],_n[Er/3]=dn[Er+1],Wn[Er/3]=dn[Er+2];const Xn={elementCount:In,x:Tn,y:_n,z:Wn,xyzOrdering:{isIdentity:!0},time:(0,q.g)(qe.value+Ee.value*xt,Ee.unit)};if(X.cell_lengths){const Er=X.cell_lengths[xt],$n=S.eB.scale((0,S.eB)(),S.eB.unitX,Er[0]),mr=S.eB.scale((0,S.eB)(),S.eB.unitY,Er[1]),gr=S.eB.scale((0,S.eB)(),S.eB.unitZ,Er[2]);Xn.cell=ee.fromBasis($n,mr,gr)}bt.push(Xn)}return q.E.create(bt,Ee,qe)});return function(De){return pe.apply(this,arguments)}}())}(Ee.result).runInContext(De);return new Zt.O.Molecule.Coordinates(qe,{label:X.label,description:"Coordinates"})});return function(De){return pe.apply(this,arguments)}}())}),ur=Zt.H.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[Zt.O.Format.Psf],to:Zt.O.Molecule.Topology})({apply:({a:X})=>r.YZ.create("Create Topology",function(){var pe=(0,e.A)(function*(De){const Ee=yield function Dn(X){return r.YZ.create("Parse PSF",function(){var pe=(0,e.A)(function*(De){const Ee=bn.fromPsf(X),qe=function nn(X){const pe=new Array(X.count),De=new Array(X.count),Ee=new Uint32Array(X.count),qe=new Uint32Array(X.count),bt=new Array(X.count),xt=new K.V,hn=new we.N(X.residueId,X.atomName);let dn="",In=0,Tn="",_n=0,Wn=X.segmentName.value(0),Xn=!1,Er=0,$n=-1;for(let gr=0,Ar=X.count;gr<Ar;++gr){const Xr=X.residueId.value(gr),io=X.segmentName.value(gr);if(Wn!==io?(Tn=Ne(In),In+=1,_n=0,Xn=!0,Wn=io):Xn=!1,Xn||Xr!==$n){const Mo=X.residueName.value(gr),Oo=(0,ke.RN)(hn.add(Mo,gr).type,Mo);!Xn&&(Oo!==Er||Xr!==$n+1)&&(Tn=Ne(In),In+=1,_n=0),dn=xt.getEntityId(Mo,Oo,Tn),_n+=1,$n=Xr,Er=Oo}pe[gr]=dn,De[gr]=Tn,Ee[gr]=_n,qe[gr]=gr,bt[gr]=Re(X.atomName.value(gr),X.residueName.value(gr))}const mr=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:X.segmentName,auth_atom_id:X.atomName,auth_comp_id:X.residueName,auth_seq_id:X.residueId,id:c.VP.ofIntArray(qe),label_asym_id:c.VP.ofStringArray(De),label_atom_id:X.atomName,label_comp_id:X.residueName,label_seq_id:c.VP.ofIntArray(Ee),label_entity_id:c.VP.ofStringArray(pe),occupancy:c.VP.ofConst(1,X.count,c.VP.Schema.float),type_symbol:c.VP.ofStringArray(bt),pdbx_PDB_model_num:c.VP.ofConst(1,X.count,c.VP.Schema.int)},X.count);return(0,ne.z)({entity:xt.getEntityTable(),chem_comp:hn.getChemCompTable(),atom_site:mr})}(X.atoms),{atomIdA:bt,atomIdB:xt}=X.bonds,hn={indexA:c.VP.ofLambda({value:dn=>bt.value(dn)-1,rowCount:bt.rowCount,schema:bt.schema}),indexB:c.VP.ofLambda({value:dn=>xt.value(dn)-1,rowCount:xt.rowCount,schema:xt.schema}),order:c.VP.ofConst(1,X.bonds.count,c.VP.Schema.int)};return Mt.c.create(X.id,qe,hn,Ee)});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);return new Zt.O.Molecule.Topology(Ee,{label:Ee.label||X.label,description:"Topology"})});return function(De){return pe.apply(this,arguments)}}())}),sr=Zt.H.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[Zt.O.Format.Prmtop],to:Zt.O.Molecule.Topology})({apply:({a:X})=>r.YZ.create("Create Topology",function(){var pe=(0,e.A)(function*(De){const Ee=yield function Li(X){return r.YZ.create("Parse PRMTOP",function(){var pe=(0,e.A)(function*(De){const Ee=Bi.fromPrmtop(X),qe=function Ti(X){const{pointers:pe,residuePointer:De,residueLabel:Ee,atomName:qe}=X,bt=pe.NATOM,xt=pe.NRES,hn=new Uint32Array(bt),dn=[],In=(_r,eo,Ho)=>{const wi=Ee.value(_r);for(let ui=eo,Ss=Ho;ui<Ss;++ui)hn[ui]=_r+1,dn[ui]=wi};for(let _r=0,eo=xt-1;_r<eo;++_r)In(_r,De.value(_r)-1,De.value(_r+1)-1);In(xt-1,De.value(xt-1)-1,bt);const Tn=c.VP.ofIntArray(hn),_n=c.VP.ofStringArray(dn),Wn=new Array(bt),Xn=new Array(bt),Er=new Uint32Array(bt),$n=new Uint32Array(bt),mr=new K.V,gr=new we.N(Tn,qe);let Ar="",Xr=0,io="",Mo=0,Oo=0,ko=-1;for(let _r=0,eo=bt;_r<eo;++_r){const Ho=Tn.value(_r);if(Ho!==ko){const wi=_n.value(_r),ui=(0,ke.RN)(gr.add(wi,_r).type,wi);ui!==Oo&&(io=Ne(Xr),Xr+=1,Mo=0),Ar=mr.getEntityId(wi,ui,io),Mo+=1,ko=Ho,Oo=ui}Wn[_r]=Ar,Xn[_r]=io,Er[_r]=Mo,$n[_r]=_r}const Xo=c.VP.ofIntArray($n),uo=c.VP.ofStringArray(Xn),yr=new Array(bt);for(let _r=0;_r<bt;++_r)yr[_r]=Re(qe.value(_r),_n.value(_r));const bo=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:uo,auth_atom_id:c.VP.asArrayColumn(qe),auth_comp_id:_n,auth_seq_id:Tn,id:c.VP.asArrayColumn(Xo),label_asym_id:uo,label_atom_id:c.VP.asArrayColumn(qe),label_comp_id:_n,label_seq_id:c.VP.ofIntArray(Er),label_entity_id:c.VP.ofStringArray(Wn),occupancy:c.VP.ofConst(1,bt,c.VP.Schema.float),type_symbol:c.VP.ofStringArray(yr),pdbx_PDB_model_num:c.VP.ofConst(1,bt,c.VP.Schema.int)},bt);return(0,ne.z)({entity:mr.getEntityTable(),chem_comp:gr.getChemCompTable(),atom_site:bo})}(X),{pointers:{NBONH:bt,NBONA:xt},bondsIncHydrogen:hn,bondsWithoutHydrogen:dn}=X,In=bt+xt,Tn={indexA:c.VP.ofLambda({value:_n=>_n<bt?hn.value(3*_n)/3:dn.value(3*(_n-bt))/3,rowCount:In,schema:c.VP.Schema.int}),indexB:c.VP.ofLambda({value:_n=>_n<bt?hn.value(3*_n+1)/3:dn.value(3*(_n-bt)+1)/3,rowCount:In,schema:c.VP.Schema.int}),order:c.VP.ofConst(1,In,c.VP.Schema.int)};return Mt.c.create(X.title.join(" ")||"PRMTOP",qe,Tn,Ee)});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);return new Zt.O.Molecule.Topology(Ee,{label:Ee.label||X.label,description:"Topology"})});return function(De){return pe.apply(this,arguments)}}())}),Jn=Zt.H.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[Zt.O.Format.Top],to:Zt.O.Molecule.Topology})({apply:({a:X})=>r.YZ.create("Create Topology",function(){var pe=(0,e.A)(function*(De){const Ee=yield function ln(X){return r.YZ.create("Parse TOP",function(){var pe=(0,e.A)(function*(De){const Ee=Ei.fromTop(X),qe=function bi(X){const{molecules:pe,compounds:De}=X,Ee={};let qe=0;for(let _r=0,eo=pe._rowCount;_r<eo;++_r){const Ho=pe.compound.value(_r),wi=pe.molCount.value(_r),{atoms:ui}=De[Ho];c.VP.asArrayColumn(ui.atom),c.VP.asArrayColumn(ui.resnr),c.VP.asArrayColumn(ui.residu),qe+=wi*ui._rowCount;let Ss=ui.resnr.value(0);Ee[Ho]=!0;for(let Os=1,ys=ui._rowCount;Os<ys;++Os){const Zs=ui.resnr.value(Os);if(Zs!==Ss){Ee[Ho]=!1;break}Ss=Zs}}const bt=new Array(qe),xt=new Uint32Array(qe),hn=new Array(qe);let dn=0;for(let _r=0,eo=pe._rowCount;_r<eo;++_r){const Ho=pe.compound.value(_r),wi=pe.molCount.value(_r),{atoms:ui}=De[Ho],Ss=Ee[Ho];for(let Os=0;Os<wi;++Os)for(let ys=0,Zs=ui._rowCount;ys<Zs;++ys)bt[dn]=ui.atom.value(ys),xt[dn]=ui.resnr.value(ys),hn[dn]=ui.residu.value(ys),Ss&&(xt[dn]+=Os),dn+=1}const In=c.VP.ofStringArray(bt),Tn=c.VP.ofIntArray(xt),_n=c.VP.ofStringArray(hn),Wn=new Array(qe),Xn=new Array(qe),Er=new Uint32Array(qe),$n=new Uint32Array(qe),mr=new K.V,gr=new we.N(Tn,In);let Ar="",Xr=0,io="",Mo=0,Oo=0,ko=-1;for(let _r=0,eo=qe;_r<eo;++_r){const Ho=Tn.value(_r);if(Ho!==ko){const wi=_n.value(_r),ui=(0,ke.RN)(gr.add(wi,_r).type,wi);ui!==Oo&&(io=Ne(Xr),Xr+=1,Mo=0),Ar=mr.getEntityId(wi,ui,io),Mo+=1,ko=Ho,Oo=ui}Wn[_r]=Ar,Xn[_r]=io,Er[_r]=Mo,$n[_r]=_r}const Xo=c.VP.ofIntArray($n),uo=c.VP.ofStringArray(Xn),yr=new Array(qe);for(let _r=0;_r<qe;++_r)yr[_r]=Re(In.value(_r),_n.value(_r));const bo=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:uo,auth_atom_id:c.VP.asArrayColumn(In),auth_comp_id:_n,auth_seq_id:Tn,id:c.VP.asArrayColumn(Xo),label_asym_id:uo,label_atom_id:c.VP.asArrayColumn(In),label_comp_id:_n,label_seq_id:c.VP.ofIntArray(Er),label_entity_id:c.VP.ofStringArray(Wn),occupancy:c.VP.ofConst(1,qe,c.VP.Schema.float),type_symbol:c.VP.ofStringArray(yr),pdbx_PDB_model_num:c.VP.ofConst(1,qe,c.VP.Schema.int)},qe);return(0,ne.z)({entity:mr.getEntityTable(),chem_comp:gr.getChemCompTable(),atom_site:bo})}(X),bt=function Vi(X){const{molecules:pe,compounds:De}=X,Ee=[],qe=[];let bt=0;for(let xt=0,hn=pe._rowCount;xt<hn;++xt){const dn=pe.compound.value(xt),In=pe.molCount.value(xt),{atoms:Tn,bonds:_n}=De[dn];if(_n)for(let Wn=0;Wn<In;++Wn){for(let Xn=0,Er=_n._rowCount;Xn<Er;++Xn)Ee.push(_n.ai.value(Xn)-1+bt),qe.push(_n.aj.value(Xn)-1+bt);bt+=Tn._rowCount}else if("TIP3"===dn)for(let Wn=0;Wn<In;++Wn)Ee.push(0+bt),qe.push(1+bt),Ee.push(0+bt),qe.push(2+bt),bt+=Tn._rowCount;else bt+=In*Tn._rowCount}return{indexA:c.VP.ofIntArray(Ee),indexB:c.VP.ofIntArray(qe),order:c.VP.ofConst(1,Ee.length,c.VP.Schema.int)}}(X);return Mt.c.create(X.system||"TOP",qe,bt,Ee)});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);return new Zt.O.Molecule.Topology(Ee,{label:Ee.label||X.label,description:"Topology"})});return function(De){return pe.apply(this,arguments)}}())});function st(){return st=(0,e.A)(function*(X,pe,De){if(pe.type===Zt.O.Molecule.Topology.type){const Ee=pe.data;return yield jt.Kx.trajectoryFromTopologyAndCoordinates(Ee,De).runInContext(X)}if(pe.type===Zt.O.Molecule.Model.type)return jt.Kx.trajectoryFromModelAndCoordinates(pe.data,De);throw new Error("no model/topology found")}),st.apply(this,arguments)}const et=Zt.H.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:Zt.O.Root,to:Zt.O.Molecule.Trajectory,params:{modelRef:L.t.Text("",{isHidden:!0}),coordinatesRef:L.t.Text("",{isHidden:!0})}})({apply:({params:X,dependencies:pe})=>r.YZ.create("Create trajectory from model/topology and coordinates",function(){var De=(0,e.A)(function*(Ee){const qe=pe[X.coordinatesRef].data,bt=yield function Br(X,pe,De){return st.apply(this,arguments)}(Ee,pe[X.modelRef],qe);return new Zt.O.Molecule.Trajectory(bt,{label:"Trajectory",description:`${bt.frameCount} model${1===bt.frameCount?"":"s"}`})});return function(Ee){return De.apply(this,arguments)}}())}),at=Zt.H.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:Zt.O.Format.Blob,to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse Format Blob",function(){var pe=(0,e.A)(function*(De){const Ee=[];for(const bt of X.data){if("cif"!==bt.kind)continue;const xt=bt.data.blocks[0],hn=yield(0,ve.OQ)(xt).runInContext(De);if(0===hn.frameCount)throw new Error("No models found.");for(let dn=0;dn<hn.frameCount;dn++){const In=yield r.YZ.resolveInContext(hn.getFrameAtIndex(dn),De);Ee.push(In)}}for(let bt=0;bt<Ee.length;bt++)jt.Kx.TrajectoryInfo.set(Ee[bt],{index:bt,size:Ee.length});const qe={label:"Trajectory",description:`${Ee.length} model${1===Ee.length?"":"s"}`};return new Zt.O.Molecule.Trajectory(new jt.P4(Ee),qe)});return function(De){return pe.apply(this,arguments)}}())});function Et(X){return{label:`${X.representative.entry}`,description:`${X.frameCount} model${1===X.frameCount?"":"s"}`}}const Nt=Zt.H.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:Zt.O.Format.Cif,to:Zt.O.Molecule.Trajectory,params(X){if(!X)return{loadAllBlocks:L.t.Optional(L.t.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:L.t.Optional(L.t.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:Ee=>!0===Ee.loadAllBlocks})),blockIndex:L.t.Optional(L.t.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:Ee=>!0===Ee.loadAllBlocks||Ee.blockHeader}))};const{blocks:pe}=X.data,De=pe.map(Ee=>[Ee.header,Ee.header]);return De.push(["","[Use Block Index]"]),{loadAllBlocks:L.t.Optional(L.t.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:L.t.Optional(L.t.Select(pe[0]&&pe[0].header,De,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:Ee=>!0===Ee.loadAllBlocks})),blockIndex:L.t.Optional(L.t.Numeric(0,{min:0,step:1,max:pe.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:Ee=>!0===Ee.loadAllBlocks||Ee.blockHeader}))}}})({isApplicable:X=>X.data.blocks.length>0,apply:({a:X,params:pe})=>r.YZ.create("Parse mmCIF",function(){var De=(0,e.A)(function*(Ee){var qe;let bt;if(pe.loadAllBlocks){const hn=[];for(const dn of X.data.blocks){Ee.shouldUpdate&&(yield Ee.update(`Parsing ${dn.header}...`));const In=yield(0,ve.OQ)(dn).runInContext(Ee);for(let Tn=0;Tn<In.frameCount;Tn++)hn.push(yield r.YZ.resolveInContext(In.getFrameAtIndex(Tn),Ee))}bt=new jt.P4(hn)}else{const hn=pe.blockHeader||X.data.blocks[null!==(qe=pe.blockIndex)&&void 0!==qe?qe:0].header,dn=X.data.blocks.find(Tn=>Tn.header===hn);if(!dn)throw new Error(`Data block '${[hn]}' not found.`);bt=!dn.categoryNames.includes("chem_comp_atom")||dn.categoryNames.includes("atom_site")||dn.categoryNames.includes("ihm_sphere_obj_site")||dn.categoryNames.includes("ihm_gaussian_obj_site")?yield(0,ve.OQ)(dn,X.data).runInContext(Ee):yield(0,ve.YG)(dn).runInContext(Ee)}if(0===bt.frameCount)throw new Error("No models found.");const xt=Et(bt);return new Zt.O.Molecule.Trajectory(bt,xt)});return function(Ee){return De.apply(this,arguments)}}())}),qt=Zt.H.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[Zt.O.Data.String],to:Zt.O.Molecule.Trajectory,params:{isPdbqt:L.t.Boolean(!1)}})({apply:({a:X,params:pe})=>r.YZ.create("Parse PDB",function(){var De=(0,e.A)(function*(Ee){const qe=yield function a(X,pe,De=!1){return r.YZ.create("Parse PDB",function(){var Ee=(0,e.A)(function*(qe){return o.H.success({lines:yield i._F.readAllLinesAsync(X,qe),id:pe,isPdbqt:De})});return function(qe){return Ee.apply(this,arguments)}}())}(X.data,X.label,pe.isPdbqt).runInContext(Ee);if(qe.isError)throw new Error(qe.message);const bt=yield function tt(X){return r.YZ.create("Parse PDB",function(){var pe=(0,e.A)(function*(De){var Ee;yield De.update("Converting to mmCIF");const qe=yield function yt(X){return At.apply(this,arguments)}(X),bt=ve.K4.fromFrame(qe,void 0,rn.create(X)),xt=(0,ne.z)(bt.data.db,!0),hn=yield(0,be.X)(xt,bt,De),dn=null===(Ee=qe.categories.atom_site)||void 0===Ee?void 0:Ee.getField("partial_charge");if(dn&&1===hn.frameCount){const In=hn.representative,Tn=In.atomicHierarchy.atomSourceIndex,Wn=c.VP.isIdentity(Tn)?void 0:Tn.toArray({array:Int32Array}),Xn=dn.toFloatArray(),Er=c.VP.ofFloatArray(Wn?c.VP.mapToArray(Tn,$n=>Xn[$n],Float32Array):Xn);Gt.j.Provider.set(In,{data:Er,type:"GASTEIGER"})}return hn});return function(De){return pe.apply(this,arguments)}}())}(qe.result).runInContext(Ee),xt=Et(bt);return new Zt.O.Molecule.Trajectory(bt,xt)});return function(Ee){return De.apply(this,arguments)}}())}),Cn=Zt.H.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[Zt.O.Data.String],to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse GRO",function(){var pe=(0,e.A)(function*(De){const Ee=yield function h(X){return r.YZ.create("Parse GRO",function(){var pe=(0,e.A)(function*(De){return yield function s(X,pe){return C.apply(this,arguments)}(X,De)});return function(De){return pe.apply(this,arguments)}}())}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function re(X){return r.YZ.create("Parse GRO",function(){var pe=(0,e.A)(function*(De){const Ee=ue.fromGro(X),qe=[];for(let bt=0,xt=X.structures.length;bt<xt;++bt){const hn=ie(X.structures[bt].atoms,bt+1),dn=yield(0,be.X)(hn,Ee,De);1===dn.frameCount&&qe.push(dn.representative)}return new Te.P(qe)});return function(De){return pe.apply(this,arguments)}}())}(Ee.result).runInContext(De),bt=Et(qe);return new Zt.O.Molecule.Trajectory(qe,bt)});return function(De){return pe.apply(this,arguments)}}())}),Un=Zt.H.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[Zt.O.Data.String],to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse XYZ",function(){var pe=(0,e.A)(function*(De){const Ee=yield function Vn(X){return r.YZ.create("Parse Mol",(0,e.A)(function*(){return function an(X){const pe=(0,i._F)(X),De=[];for(;;){const qe=zt(pe);if(0===qe.count)break;De.push(qe)}return o.H.success({molecules:De})}(X)}))}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function Vr(X){return r.YZ.create("Parse XYZ",pe=>function Fn(X,pe){const{molecules:De}=X;let Ee=0;for(const Xr of De)Ee+=Xr.count;const qe=new Array(Ee),bt=new Int32Array(Ee),xt=new Float32Array(Ee),hn=new Float32Array(Ee),dn=new Float32Array(Ee),In=new Int32Array(Ee);let Tn=0;for(let Xr=0;Xr<De.length;Xr++){const io=De[Xr];for(let Mo=0;Mo<io.count;Mo++)qe[Tn]=io.type_symbol.value(Mo),xt[Tn]=io.x.value(Mo),hn[Tn]=io.y.value(Mo),dn[Tn]=io.z.value(Mo),bt[Tn]=Mo,In[Tn]=Xr,Tn++}const _n=c.VP.ofConst("MOL",Ee,c.VP.Schema.str),Wn=c.VP.ofConst("A",Ee,c.VP.Schema.str),Xn=c.VP.ofConst(1,Ee,c.VP.Schema.int),Er=c.VP.ofStringArray(qe),$n=c.XI.ofPartialColumns(ne.e.atom_site,{auth_asym_id:Wn,auth_atom_id:Er,auth_comp_id:_n,auth_seq_id:Xn,Cartn_x:c.VP.ofFloatArray(xt),Cartn_y:c.VP.ofFloatArray(hn),Cartn_z:c.VP.ofFloatArray(dn),id:c.VP.ofIntArray(bt),label_asym_id:Wn,label_atom_id:Er,label_comp_id:_n,label_seq_id:Xn,label_entity_id:c.VP.ofConst("1",Ee,c.VP.Schema.str),occupancy:c.VP.ofConst(1,Ee,c.VP.Schema.float),type_symbol:Er,pdbx_PDB_model_num:c.VP.ofIntArray(In)},Ee),mr=new K.V;mr.setNames([["MOL","Unknown Entity"]]),mr.getEntityId("MOL",0,"A");const gr=new we.N(Xn,Er);gr.setNames([["MOL","Unknown Molecule"]]),gr.add("MOL",0);const Ar=(0,ne.z)({entity:mr.getEntityTable(),chem_comp:gr.getChemCompTable(),atom_site:$n});return(0,be.X)(Ar,rr.create(X),pe)}(X,pe))}(Ee.result).runInContext(De),bt=Et(qe);return new Zt.O.Molecule.Trajectory(qe,bt)});return function(De){return pe.apply(this,arguments)}}())}),vn=Zt.H.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[Zt.O.Data.String],to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse MOL",function(){var pe=(0,e.A)(function*(De){const Ee=yield function Jr(X){return r.YZ.create("Parse Mol",(0,e.A)(function*(){return function Or(X){const pe=(0,i._F)(X),De=i._F.readLine(pe).trim(),Ee=i._F.readLine(pe).trim(),qe=i._F.readLine(pe).trim(),bt=i._F.readLine(pe),xt=+bt.substr(0,3),hn=+bt.substr(3,3),dn=Pr(pe,xt),In=or(pe,hn),Tn=Ir(pe);return o.H.success({title:De,program:Ee,comment:qe,atoms:dn,bonds:In,formalCharges:Tn})}(X)}))}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function Yt(X){return r.YZ.create("Parse MOL",pe=>un(X,void 0,pe))}(Ee.result).runInContext(De),bt=Et(qe);return new Zt.O.Molecule.Trajectory(qe,bt)});return function(De){return pe.apply(this,arguments)}}())}),nr=Zt.H.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[Zt.O.Data.String],to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse SDF",function(){var pe=(0,e.A)(function*(De){const Ee=yield function ao(X){return r.YZ.create("Parse Sdf",(0,e.A)(function*(){return function So(X){const pe=(0,i._F)(X),De=[];for(;pe.position<pe.length;){const Ee=lo(pe);Ee&&De.push(Ee)}return o.H.success({compounds:De})}(X)}))}(X.data).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=[];for(const hn of Ee.result.compounds){const dn=yield Yr(hn).runInContext(De);for(let In=0;In<dn.frameCount;In++)qe.push(yield r.YZ.resolveInContext(dn.getFrameAtIndex(In),De))}const bt=new jt.P4(qe),xt=Et(bt);return new Zt.O.Molecule.Trajectory(bt,xt)});return function(De){return pe.apply(this,arguments)}}())}),pr=Zt.H.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[Zt.O.Data.String],to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse MOL2",function(){var pe=(0,e.A)(function*(De){const Ee=yield function pt(X,pe){return r.YZ.create("Parse MOL2",function(){var De=(0,e.A)(function*(Ee){return yield function Qt(X,pe,De){return ht.apply(this,arguments)}(Ee,X,pe)});return function(Ee){return De.apply(this,arguments)}}())}(X.data,X.label).runInContext(De);if(Ee.isError)throw new Error(Ee.message);const qe=yield function Tt(X){return r.YZ.create("Parse MOL2",pe=>function Xt(X,pe){return fn.apply(this,arguments)}(X,pe))}(Ee.result).runInContext(De),bt=Et(qe);return new Zt.O.Molecule.Trajectory(qe,bt)});return function(De){return pe.apply(this,arguments)}}())}),Rr=Zt.H.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:Zt.O.Format.Cube,to:Zt.O.Molecule.Trajectory})({apply:({a:X})=>r.YZ.create("Parse MOL",function(){var pe=(0,e.A)(function*(De){const Ee=yield function ro(X){return r.YZ.create("Parse Cube",pe=>function Sr(X,pe){return Ur.apply(this,arguments)}(X,pe))}(X.data).runInContext(De),qe=Et(Ee);return new Zt.O.Molecule.Trajectory(Ee,qe)});return function(De){return pe.apply(this,arguments)}}())}),mo=Zt.H.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:Zt.O.Format.Cif,to:Zt.O.Molecule.Trajectory,params(X){if(!X)return{blockHeader:L.t.Optional(L.t.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};const{blocks:pe}=X.data;return{blockHeader:L.t.Optional(L.t.Select(pe[0]&&pe[0].header,pe.map(De=>[De.header,De.header]),{description:"Header of the block to parse"}))}}})({apply:({a:X,params:pe})=>r.YZ.create("Parse CIF Core",function(){var De=(0,e.A)(function*(Ee){const qe=pe.blockHeader||X.data.blocks[0].header,bt=X.data.blocks.find(dn=>dn.header===qe);if(!bt)throw new Error(`Data block '${[qe]}' not found.`);const xt=yield function Fr(X){const pe=Mr.fromFrame(X);return r.YZ.create("Parse CIF Core",De=>function Yn(X,pe,De){return br.apply(this,arguments)}(pe.data.db,pe,De))}(bt).runInContext(Ee);if(0===xt.frameCount)throw new Error("No models found.");const hn=Et(xt);return new Zt.O.Molecule.Trajectory(xt,hn)});return function(Ee){return De.apply(this,arguments)}}())}),Uo=X=>X+1,qo=X=>X-1,ri=Zt.H.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:Zt.O.Molecule.Trajectory,to:Zt.O.Molecule.Model,params:X=>X?{modelIndex:L.t.Converted(Uo,qo,L.t.Numeric(1,{min:1,max:X.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:L.t.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}})({isApplicable:X=>X.data.frameCount>0,apply:({a:X,params:pe})=>r.YZ.create("Model from Trajectory",function(){var De=(0,e.A)(function*(Ee){let qe=pe.modelIndex%X.data.frameCount;qe<0&&(qe+=X.data.frameCount);const bt=yield r.YZ.resolveInContext(X.data.getFrameAtIndex(qe),Ee);return new Zt.O.Molecule.Model(bt,{label:`Model ${qe+1}`,description:1===X.data.frameCount?void 0:`of ${X.data.frameCount}`})});return function(Ee){return De.apply(this,arguments)}}()),interpolate:(X,pe,De)=>({modelIndex:De>=1?pe.modelIndex:X.modelIndex+Math.floor((pe.modelIndex-X.modelIndex+1)*De)}),dispose({b:X}){X?.data.customProperties.dispose()}}),fo=Zt.H.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:Zt.O.Molecule.Trajectory,to:Zt.O.Molecule.Structure})({apply:({a:X})=>r.YZ.create("Build Structure",function(){var pe=(0,e.A)(function*(De){const Ee=yield jt.oE.ofTrajectory(X.data,De),qe={label:"Ensemble",description:jt.oE.elementDescription(Ee)};return new Zt.O.Molecule.Structure(Ee,qe)});return function(De){return pe.apply(this,arguments)}}()),dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),Lo=Zt.H.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:Zt.O.Molecule.Model,to:Zt.O.Molecule.Structure,params:X=>Vt.z.getParams(X&&X.data)})({canAutoUpdate:({oldParams:X,newParams:pe})=>Vt.z.canAutoUpdate(X.type,pe.type),apply:({a:X,params:pe},De)=>r.YZ.create("Build Structure",function(){var Ee=(0,e.A)(function*(qe){return Vt.z.create(De,qe,X.data,pe&&pe.type)});return function(qe){return Ee.apply(this,arguments)}}()),update:({a:X,b:pe,oldParams:De,newParams:Ee})=>(0,$t.bD)(De,Ee)?pe.data.model===X.data?Ct.xE.UpdateResult.Unchanged:jt.Kx.areHierarchiesEqual(X.data,pe.data.model)?(pe.data=pe.data.remapModel(X.data),Ct.xE.UpdateResult.Updated):Ct.xE.UpdateResult.Recreate:Ct.xE.UpdateResult.Recreate,dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),Ni=(0,S.eB)(),rs=(0,S.$I)(),Gi=(0,S.$I)(),_o=Zt.H.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:{transform:L.t.MappedStatic("components",{components:L.t.Group({axis:L.t.Vec3(S.eB.create(1,0,0)),angle:L.t.Numeric(0,{min:-180,max:180,step:.1}),translation:L.t.Vec3(S.eB.create(0,0,0))},{isFlat:!0}),matrix:L.t.Group({data:L.t.Mat4(S.$I.identity()),transpose:L.t.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:({newParams:X})=>"matrix"!==X.transform.name,apply({a:X,params:pe}){const De=(0,S.$I)();if("components"===pe.transform.name){const{axis:qe,angle:bt,translation:xt}=pe.transform.params,hn=X.data.boundary.sphere.center;S.$I.fromTranslation(rs,S.eB.negate(Ni,hn)),S.$I.fromTranslation(Gi,S.eB.add(Ni,hn,xt));const dn=S.$I.fromRotation((0,S.$I)(),Math.PI/180*bt,S.eB.normalize((0,S.eB)(),qe));S.$I.mul3(De,Gi,dn,rs)}else"matrix"===pe.transform.name&&(S.$I.copy(De,pe.transform.params.data),pe.transform.params.transpose&&S.$I.transpose(De,De));const Ee=jt.oE.transform(X.data,De);return new Zt.O.Molecule.Structure(Ee,{label:X.label,description:`${X.description} [Transformed]`})},dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),hr=Zt.H.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:()=>({expression:L.t.Value(It.J.struct.generator.all,{isHidden:!0}),label:L.t.Optional(L.t.Text("",{isHidden:!0}))})})({apply({a:X,params:pe,cache:De}){const{selection:Ee,entry:qe}=yn.createAndRun(X.data,pe.expression);if(De.entry=qe,jt.cv.isEmpty(Ee))return Ct.BM.Null;const bt=jt.cv.unionStructure(Ee),xt={label:`${pe.label||"Selection"}`,description:jt.oE.elementDescription(bt)};return new Zt.O.Molecule.Structure(bt,xt)},update:({a:X,b:pe,oldParams:De,newParams:Ee,cache:qe})=>{if(De.expression!==Ee.expression)return Ct.xE.UpdateResult.Recreate;const bt=qe.entry;if(bt.currentStructure===X.data)return Ct.xE.UpdateResult.Unchanged;const xt=yn.updateStructure(bt,X.data);return jt.cv.isEmpty(xt)?Ct.xE.UpdateResult.Null:(yn.updateStructureObject(pe,xt,Ee.label),Ct.xE.UpdateResult.Updated)},dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),Wr=Zt.H.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:Zt.O.Root,to:Zt.O.Molecule.Structure.Selections,params:()=>({selections:L.t.ObjectList({key:L.t.Text(void 0,{description:"A unique key."}),ref:L.t.Text(),groupId:L.t.Optional(L.t.Text()),expression:L.t.Value(It.J.struct.generator.empty)},X=>X.ref,{isHidden:!0}),isTransitive:L.t.Optional(L.t.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:L.t.Optional(L.t.Text("",{isHidden:!0}))})})({apply({params:X,cache:pe,dependencies:De}){const Ee=new Map,qe=[];let bt=0;for(const hn of X.selections){const{selection:dn,entry:In}=yn.createAndRun(De[hn.ref].data,hn.expression);Ee.set(hn.key,In);const Tn=jt.cv.toLociWithSourceUnits(dn);qe.push({key:hn.key,loci:Tn,groupId:hn.groupId}),bt+=jt.iZ.Loci.size(Tn)}return pe.entries=Ee,new Zt.O.Molecule.Structure.Selections(qe,{label:`${X.label||"Multi-selection"}`,description:`${X.selections.length} source(s), ${bt} element(s) total`})},update:({b:X,oldParams:pe,newParams:De,cache:Ee,dependencies:qe})=>{if(!!pe.isTransitive!=!!De.isTransitive)return Ct.xE.UpdateResult.Recreate;const bt=Ee.entries,xt=new Map,hn=new Map;for(const _n of X.data)hn.set(_n.key,_n);let dn=!1,In=0;const Tn=[];for(const _n of De.selections){const Wn=qe[_n.ref].data;let Xn=!1;if(bt.has(_n.key)){const Er=bt.get(_n.key);if(yn.isUnchanged(Er,_n.expression,Wn)&&hn.has(_n.key)){const $n=hn.get(_n.key);$n.groupId!==_n.groupId&&($n.groupId=_n.groupId,dn=!0),xt.set(_n.key,Er),Tn.push($n),In+=jt.iZ.Loci.size($n.loci);continue}if(Er.expression!==_n.expression)Xn=!0;else{let $n=!1;if(De.isTransitive)if(jt.oE.areUnitIdsAndIndicesEqual(Er.originalStructure,Wn)){const mr=yn.run(Er,Er.originalStructure);Er.currentStructure=Wn,xt.set(_n.key,Er);const gr=jt.iZ.Loci.remap(jt.cv.toLociWithSourceUnits(mr),Wn);Tn.push({key:_n.key,loci:gr,groupId:_n.groupId}),In+=jt.iZ.Loci.size(gr),dn=!0}else $n=!0;else $n=!0;if($n){dn=!0;const mr=yn.updateStructure(Er,Wn);xt.set(_n.key,Er);const gr=jt.cv.toLociWithSourceUnits(mr);Tn.push({key:_n.key,loci:gr,groupId:_n.groupId}),In+=jt.iZ.Loci.size(gr)}}}else Xn=!0;if(Xn){dn=!0;const{selection:Er,entry:$n}=yn.createAndRun(Wn,_n.expression);xt.set(_n.key,$n);const mr=jt.cv.toLociWithSourceUnits(Er);Tn.push({key:_n.key,loci:mr}),In+=jt.iZ.Loci.size(mr)}}return dn?(Ee.entries=xt,X.data=Tn,X.label=`${De.label||"Multi-selection"}`,X.description=`${Tn.length} source(s), ${In} element(s) total`,Ct.xE.UpdateResult.Updated):Ct.xE.UpdateResult.Unchanged}}),no=Zt.H.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:()=>({script:L.t.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:L.t.Optional(L.t.Text(""))})})({apply({a:X,params:pe,cache:De}){const{selection:Ee,entry:qe}=yn.createAndRun(X.data,pe.script);De.entry=qe;const bt=jt.cv.unionStructure(Ee),xt={label:`${pe.label||"Selection"}`,description:jt.oE.elementDescription(bt)};return new Zt.O.Molecule.Structure(bt,xt)},update:({a:X,b:pe,oldParams:De,newParams:Ee,cache:qe})=>{if(!Dt.e.areEqual(De.script,Ee.script))return Ct.xE.UpdateResult.Recreate;const bt=qe.entry;if(bt.currentStructure===X.data)return Ct.xE.UpdateResult.Unchanged;const xt=yn.updateStructure(bt,X.data);return yn.updateStructureObject(pe,xt,Ee.label),Ct.xE.UpdateResult.Updated},dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),zo=Zt.H.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:()=>({bundle:L.t.Value(jt.iZ.Bundle.Empty,{isHidden:!0}),label:L.t.Optional(L.t.Text("",{isHidden:!0}))})})({apply({a:X,params:pe,cache:De}){if(pe.bundle.hash!==X.data.hashCode)return Ct.BM.Null;De.source=X.data;const Ee=jt.iZ.Bundle.toStructure(pe.bundle,X.data);if(0===Ee.elementCount)return Ct.BM.Null;const qe={label:`${pe.label||"Selection"}`,description:jt.oE.elementDescription(Ee)};return new Zt.O.Molecule.Structure(Ee,qe)},update:({a:X,b:pe,oldParams:De,newParams:Ee,cache:qe})=>{if(!jt.iZ.Bundle.areEqual(De.bundle,Ee.bundle))return Ct.xE.UpdateResult.Recreate;if(Ee.bundle.hash!==X.data.hashCode)return Ct.xE.UpdateResult.Null;if(qe.source===X.data)return Ct.xE.UpdateResult.Unchanged;qe.source=X.data;const bt=jt.iZ.Bundle.toStructure(Ee.bundle,X.data);return 0===bt.elementCount?Ct.xE.UpdateResult.Null:(pe.label=`${Ee.label||"Selection"}`,pe.description=jt.oE.elementDescription(bt),pe.data=bt,Ct.xE.UpdateResult.Updated)},dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),Di={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},zi=L.t.objectToOptions(Di),Ki=Zt.H.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:{type:L.t.Select("atomic-sequence",zi,{isHidden:!0})}})({apply({a:X,params:pe}){let De,Ee;switch(pe.type){case"polymer":De=kt.Ou.polymer.query,Ee="Polymer";break;case"protein":De=kt.Ou.protein.query,Ee="Protein";break;case"nucleic":De=kt.Ou.nucleic.query,Ee="Nucleic";break;case"water":De=jt.RT.internal.water(),Ee="Water";break;case"branched":De=kt.Ou.branchedPlusConnected.query,Ee="Branched";break;case"ligand":De=kt.Ou.ligandPlusConnected.query,Ee="Ligand";break;case"non-standard":De=kt.Ou.nonStandardPolymer.query,Ee="Non-standard";break;case"coarse":De=kt.Ou.coarse.query,Ee="Coarse";break;case"atomic-sequence":De=jt.RT.internal.atomicSequence(),Ee="Sequence";break;case"atomic-het":De=jt.RT.internal.atomicHet(),Ee="HET Groups/Ligands";break;case"spheres":De=jt.RT.internal.spheres(),Ee="Coarse Spheres";break;default:(0,Ot.dr)(pe.type)}const qe=De(new jt.cY(X.data)),bt=jt.cv.unionStructure(qe);return 0===bt.elementCount?Ct.BM.Null:new Zt.O.Molecule.Structure(bt,{label:Ee,description:jt.oE.elementDescription(bt)})},dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),Mi=Zt.H.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:()=>({type:L.t.MappedStatic("static",{static:L.t.Text("polymer"),expression:L.t.Value(It.J.struct.generator.all),bundle:L.t.Value(jt.iZ.Bundle.Empty),script:L.t.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:L.t.Optional(L.t.Boolean(!0,{isHidden:!0})),label:L.t.Text("",{isHidden:!0})})})({apply:({a:X,params:pe,cache:De})=>function On(X,pe,De){De.source=X;let qe,Ee=jt.oE.Empty;switch(pe.type.name){case"static":{let xt;switch(pe.type.params){case"all":xt=kt.Ou.all.query,qe="All";break;case"polymer":xt=kt.Ou.polymer.query,qe="Polymer";break;case"protein":xt=kt.Ou.protein.query,qe="Protein";break;case"nucleic":xt=kt.Ou.nucleic.query,qe="Nucleic";break;case"water":xt=jt.RT.internal.water(),qe="Water";break;case"ion":xt=kt.Ou.ion.query,qe="Ion";break;case"lipid":xt=kt.Ou.lipid.query,qe="Lipid";break;case"branched":xt=kt.Ou.branchedPlusConnected.query,qe="Branched";break;case"ligand":xt=kt.Ou.ligandPlusConnected.query,qe="Ligand";break;case"non-standard":xt=kt.Ou.nonStandardPolymer.query,qe="Non-standard";break;case"coarse":xt=kt.Ou.coarse.query,qe="Coarse";break;default:(0,Ot.dr)(pe.type)}const hn=xt(new jt.cY(X));Ee=jt.cv.unionStructure(hn);break}case"script":case"expression":{const{selection:xt,entry:hn}=yn.createAndRun(X,pe.type.params);De.entry=hn,Ee=jt.cv.unionStructure(xt);break}case"bundle":if(pe.type.params.hash!==X.hashCode)break;Ee=jt.iZ.Bundle.toStructure(pe.type.params,X)}if(pe.nullIfEmpty&&0===Ee.elementCount)return Ct.BM.Null;const bt={label:`${pe.label||qe||"Component"}`,description:jt.oE.elementDescription(Ee)};return new Zt.O.Molecule.Structure(Ee,bt)}(X.data,pe,De),update:({a:X,b:pe,oldParams:De,newParams:Ee,cache:qe})=>function fr(X,pe,De,Ee,qe){if(De.type.name!==Ee.type.name)return Ct.xE.UpdateResult.Recreate;let bt=!1;switch(Ee.type.name){case"static":return De.type.params===Ee.type.params&&jt.oE.areEquivalent(X,qe.source)?pe.data.model===X.model?Ct.xE.UpdateResult.Unchanged:jt.Kx.areHierarchiesEqual(X.model,pe.data.model)?(pe.data=pe.data.remapModel(X.model),Ct.xE.UpdateResult.Updated):Ct.xE.UpdateResult.Recreate:Ct.xE.UpdateResult.Recreate;case"script":if(!Dt.e.areEqual(De.type.params,Ee.type.params))return Ct.xE.UpdateResult.Recreate;case"expression":{if(De.type.params!==Ee.type.params)return Ct.xE.UpdateResult.Recreate;if(X===qe.source)break;const hn=yn.updateStructure(qe.entry,X);qe.source=X,pe.data=jt.cv.unionStructure(hn),yn.updateStructureObject(pe,hn,Ee.label),bt=!0;break}case"bundle":if(X===qe.source&&jt.iZ.Bundle.areEqual(De.type.params,Ee.type.params))break;qe.source=X,Ee.type.params.hash!==X.hashCode?(bt=0!==pe.data.elementCount,pe.data=0===pe.data.elementCount?pe.data:jt.oE.Empty):(bt=!0,pe.data=jt.iZ.Bundle.toStructure(Ee.type.params,X))}if(bt){if(Ee.nullIfEmpty&&0===pe.data.elementCount)return Ct.xE.UpdateResult.Null;pe.description=jt.oE.elementDescription(pe.data)}return De.label!==Ee.label&&(bt=!0,pe.label=`${Ee.label||pe.label}`),bt?Ct.xE.UpdateResult.Updated:Ct.xE.UpdateResult.Unchanged}(X.data,pe,De,Ee,qe),dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}}),ds=Zt.H.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:Zt.O.Molecule.Model,to:Zt.O.Molecule.Model,params:(X,pe)=>pe.customModelProperties.getParams(X?.data)})({apply:({a:X,params:pe},De)=>r.YZ.create("Custom Props",function(){var Ee=(0,e.A)(function*(qe){return yield he(X.data,De,qe,pe),new Zt.O.Molecule.Model(X.data,{label:X.label,description:X.description})});return function(qe){return Ee.apply(this,arguments)}}()),update:({a:X,b:pe,oldParams:De,newParams:Ee},qe)=>r.YZ.create("Custom Props",function(){var bt=(0,e.A)(function*(xt){pe.data=X.data,pe.label=X.label,pe.description=X.description;for(const hn of De.autoAttach){const dn=qe.customModelProperties.get(hn);dn&&X.data.customProperties.reference(dn.descriptor,!1)}return yield he(X.data,qe,xt,Ee),Ct.xE.UpdateResult.Updated});return function(xt){return bt.apply(this,arguments)}}()),dispose({b:X}){X?.data.customProperties.dispose()}});function he(X,pe,De,Ee){return fe.apply(this,arguments)}function fe(){return fe=(0,e.A)(function*(X,pe,De,Ee){const qe={runtime:De,assetManager:pe.managers.asset},{autoAttach:bt,properties:xt}=Ee;for(const hn of Object.keys(xt)){const dn=pe.customModelProperties.get(hn),In=xt[hn];if(bt.includes(hn)||dn.isHidden)try{yield dn.attach(qe,X,In,!0)}catch(Tn){pe.log.warn(`Error attaching model prop '${hn}': ${Tn}`)}else dn.set(X,In)}}),fe.apply(this,arguments)}const ze=Zt.H.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:Zt.O.Molecule.Structure,to:Zt.O.Molecule.Structure,params:(X,pe)=>pe.customStructureProperties.getParams(X?.data.root)})({apply:({a:X,params:pe},De)=>r.YZ.create("Custom Props",function(){var Ee=(0,e.A)(function*(qe){return yield Ze(X.data.root,De,qe,pe),new Zt.O.Molecule.Structure(X.data,{label:X.label,description:X.description})});return function(qe){return Ee.apply(this,arguments)}}()),update:({a:X,b:pe,oldParams:De,newParams:Ee},qe)=>X.data!==pe.data?Ct.xE.UpdateResult.Recreate:r.YZ.create("Custom Props",function(){var bt=(0,e.A)(function*(xt){pe.data=X.data,pe.label=X.label,pe.description=X.description;for(const hn of De.autoAttach){const dn=qe.customStructureProperties.get(hn);dn&&X.data.customPropertyDescriptors.reference(dn.descriptor,!1)}return yield Ze(X.data.root,qe,xt,Ee),Ct.xE.UpdateResult.Updated});return function(xt){return bt.apply(this,arguments)}}()),dispose({b:X}){X?.data.customPropertyDescriptors.dispose()}});function Ze(X,pe,De,Ee){return it.apply(this,arguments)}function it(){return it=(0,e.A)(function*(X,pe,De,Ee){const qe={runtime:De,assetManager:pe.managers.asset},{autoAttach:bt,properties:xt}=Ee;for(const hn of Object.keys(xt)){const dn=pe.customStructureProperties.get(hn),In=xt[hn];if(bt.includes(hn)||dn.isHidden)try{yield dn.attach(qe,X,In,!0)}catch(Tn){pe.log.warn(`Error attaching structure prop '${hn}': ${Tn}`)}else dn.set(X,In)}}),it.apply(this,arguments)}const Rt=Zt.H.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:Zt.O.Format.Ply,to:Zt.O.Shape.Provider,params:X=>({transforms:L.t.Optional(L.t.Value([],{isHidden:!0})),label:L.t.Optional(L.t.Text("",{isHidden:!0}))})})({apply:({a:X,params:pe})=>r.YZ.create("Create shape from PLY",function(){var De=(0,e.A)(function*(Ee){const qe=yield function Z(X,pe){return r.YZ.create("Shape Provider",function(){var De=(0,e.A)(function*(Ee){return{label:"Mesh",data:{source:X,transforms:pe?.transforms},params:U(X),getShape:j(),geometryUtils:f.e.Utils}});return function(Ee){return De.apply(this,arguments)}}())}(X.data,pe).runInContext(Ee);return new Zt.O.Shape.Provider(qe,{label:pe.label||"Shape"})});return function(Ee){return De.apply(this,arguments)}}())})},8010:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{ClippingStructureRepresentation3DFromBundle:()=>Li,ClippingStructureRepresentation3DFromScript:()=>Bi,EmissiveStructureRepresentation3DFromBundle:()=>Qr,EmissiveStructureRepresentation3DFromScript:()=>kr,ExplodeStructureRepresentation3D:()=>Qi,ModelUnitcell3D:()=>Ht,OverpaintStructureRepresentation3DFromBundle:()=>co,OverpaintStructureRepresentation3DFromScript:()=>qr,ShapeRepresentation3D:()=>ln,SpinStructureRepresentation3D:()=>Hn,StructureBoundingBox3D:()=>Gn,StructureRepresentation3D:()=>Wi,StructureSelectionsAngle3D:()=>kn,StructureSelectionsDihedral3D:()=>ur,StructureSelectionsDistance3D:()=>ar,StructureSelectionsLabel3D:()=>sr,StructureSelectionsOrientation3D:()=>Jn,StructureSelectionsPlane3D:()=>Br,SubstanceStructureRepresentation3DFromBundle:()=>Ti,SubstanceStructureRepresentation3DFromScript:()=>vi,ThemeStrengthRepresentation3D:()=>bi,TransparencyStructureRepresentation3DFromBundle:()=>lr,TransparencyStructureRepresentation3DFromScript:()=>zr,UnwindStructureAssemblyRepresentation3D:()=>Ri,VolumeRepresentation3D:()=>Ei,VolumeRepresentation3DHelpers:()=>Vi});var e=n(467),o=n(9136),r=n(6853),t=n(1832),A=n(4824),y=n(1930),c=n(8277),i=n(381),v=n(2745),O=n(542),b=n(2443),_=n(3558),M=n(1413),I=n(8353),l=n(5589),m=n(8013),u=n(6825),d=n(9909),s=n(2712),C=n(7684),h=n(3246),a=n(3543),S=n(5117),D=n(2629);function R(st,et,at={}){let Et=0;const Nt=new M.B,qt=b.YL.createState(),Cn=(0,I.Q0)(),Un=[];let vn,nr,pr=-1;const Rr=y.S.createEmpty();let qo,ri,mo=c.t.getDefaultValues(et.Params);at.modifyState&&b.YL.updateState(qt,at.modifyState(qt));const fo=l.rj.create();function Gi(_o,hr){return(0,h.xc)(_o)||_.y.isLoci(_o)&&_o.shape===nr?hr(a.IX.ofBounds(0,mo.instanceGranularity?nr.transforms.length:nr.groupCount*nr.transforms.length)):mo.instanceGranularity?function rs(_o,hr,Wr){let no=!1;if(!_.$.isLoci(_o)||_.$.isLociEmpty(_o)||_o.shape!==hr)return!1;for(const zo of _o.groups)Wr(a.IX.ofSingleton(zo.instance))&&(no=!0);return no}(_o,nr,hr):function f(st,et,at){if(!_.$.isLoci(st)||st.shape!==et)return!1;let Et=!1;const{groupCount:Nt}=et,{groups:qt}=st;for(const{ids:Cn,instance:Un}of qt)if(a.IX.is(Cn)){const vn=Un*Nt+a.IX.start(Cn),nr=Un*Nt+a.IX.end(Cn);at(a.IX.ofBounds(vn,nr))&&(Et=!0)}else for(let vn=0,nr=Cn.length;vn<nr;vn++)at(a.IX.ofSingleton(Un*Nt+Cn[vn]))&&(Et=!0);return Et}(_o,nr,hr)}return{label:"Shape geometry",get groupCount(){return qo?qo.count:0},get props(){return mo},get params(){},get state(){return qt},get theme(){return Rr},renderObjects:Un,get geometryVersion(){return pr},updated:Nt,createOrUpdate:function Ni(_o={},hr){return at.modifyProps&&(_o=at.modifyProps(_o)),A.YZ.create("ShapeRepresentation.create",function(){var Wr=(0,e.A)(function*(no){const zo=Object.assign(mo,_o),Di=hr?yield st(no,hr,zo,nr):void 0;if(function Lo(_o={},hr){l.rj.reset(fo),(hr||nr)&&(hr&&!nr?fo.createNew=!0:hr&&nr&&hr.id===nr.id||(hr&&nr&&hr.id!==nr.id?(fo.updateTransform=!0,fo.createGeometry=!0):hr&&console.warn("unexpected state")),_o.instanceGranularity!==mo.instanceGranularity&&(fo.updateTransform=!0),fo.updateTransform&&(fo.updateColor=!0,fo.updateSize=!0,fo.updateMatrix=!0),fo.createGeometry&&(fo.updateColor=!0,fo.updateSize=!0))}(_o,Di),Di&&(nr=Di,Object.assign(Rr,_.y.getTheme(nr))),fo.createNew){Un.length=0,qo=_.y.groupIterator(nr);const zi=_.y.createTransform(nr.transforms,nr.geometry.boundingSphere,zo.cellSize,zo.batchSize),Ki=et.createValues(nr.geometry,zi,qo,Rr,zo),Mi=et.createRenderableState(zo);at.modifyState&&Object.assign(Mi,at.modifyState(Mi)),b.YL.updateState(qt,Mi),vn=(0,I.o)(nr.geometry.kind,Ki,Mi,Cn),vn&&Un.push(vn),ri=et.createPositionIterator(nr.geometry,vn.values)}else{if(!vn)throw new Error("expected renderObject to be available");if(fo.updateTransform){qo=_.y.groupIterator(nr);const{instanceCount:zi,groupCount:Ki}=qo;_o.instanceGranularity?(0,m.Km)(zi,"instance",vn.values):(0,m.Km)(zi*Ki,"groupInstance",vn.values)}fo.updateMatrix&&(_.y.createTransform(nr.transforms,nr.geometry.boundingSphere,zo.cellSize,zo.batchSize,vn.values),"lodLevels"in vn.values&&d.IQ.update(vn.values.lodLevels,vn.values.lodLevels.ref.value)),fo.createGeometry&&(d.IQ.updateIfChanged(vn.values.drawCount,O.V.getDrawCount(nr.geometry)),d.IQ.updateIfChanged(vn.values.uVertexCount,O.V.getVertexCount(nr.geometry)),d.IQ.updateIfChanged(vn.values.uGroupCount,O.V.getGroupCount(nr.geometry))),(fo.updateTransform||fo.createGeometry)&&(et.updateBoundingSphere(vn.values,nr.geometry),ri=et.createPositionIterator(nr.geometry,vn.values)),fo.updateColor&&(0,s.D1)(qo,ri,Rr.color,vn.values),fo.updateSize&&"uSize"in vn.values&&(0,C.v3)(qo,Rr.size,vn.values),et.updateValues(vn.values,zo),et.updateRenderableState(vn.state,zo)}mo=zo,(fo.createGeometry||fo.createNew)&&(pr+=1),Nt.next(Et++)});return function(no){return Wr.apply(this,arguments)}}())},getLoci(_o){const{objectId:hr,groupId:Wr,instanceId:no}=_o;return vn&&vn.id===hr?_.$.Loci(nr,[{ids:a.CD.ofSingleton(Wr),instance:no}]):h.BL},getAllLoci:()=>[_.y.Loci(nr)],eachLocation:_o=>{for(qo.reset();qo.hasNext;){const{location:hr,isSecondary:Wr}=qo.move();_o(hr,Wr)}},mark(_o,hr){if(!u.sY.is(qt.markerActions,hr))return!1;if(_.$.isLoci(_o)||_.y.isLoci(_o)){if(_o.shape!==nr)return!1}else if(!(0,h.xc)(_o))return!1;return S.b.mark(vn,_o,hr,Gi)},setState(_o){at.modifyState&&(_o=at.modifyState(_o)),vn&&(void 0!==_o.visible&&S.b.setVisibility(vn,_o.visible),void 0!==_o.alphaFactor&&S.b.setAlphaFactor(vn,_o.alphaFactor),void 0!==_o.pickable&&S.b.setPickable(vn,_o.pickable),void 0!==_o.colorOnly&&S.b.setColorOnly(vn,_o.colorOnly),void 0!==_o.overpaint&&S.b.setOverpaint(vn,_o.overpaint,Gi,!0),void 0!==_o.transparency&&S.b.setTransparency(vn,_o.transparency,Gi,!0),void 0!==_o.substance&&S.b.setSubstance(vn,_o.substance,Gi,!0),void 0!==_o.transform&&S.b.setTransform(vn,_o.transform)),b.YL.updateState(qt,_o)},setTheme(_o){D.Bb&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy(){Un.length=0,vn&&(vn.state.disposed=!0,vn=void 0)}}}var p=n(4369),E=n(3596);const T=(0,p.$I)();class L{constructor(et){this.structure=et,this.groupUnitTransforms=[],this.unitOffsetMap=a.Yz.Mutable(),this.groupIndexMap=a.Yz.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(16*et.units.length),this.size=et.units.length,this.reset();let at=0;for(let Et=0,Nt=et.unitSymmetryGroups.length;Et<Nt;++Et){const qt=et.unitSymmetryGroups[Et];this.groupIndexMap.set(qt.hashCode,Et);const Cn=this.unitTransforms.subarray(at,at+16*qt.units.length);this.groupUnitTransforms.push(Cn);for(let Un=0,vn=qt.units.length;Un<vn;++Un)this.unitOffsetMap.set(qt.units[Un].id,at+16*Un);at+=16*qt.units.length}}reset(){this.version=0,(0,E.ES)(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(void 0===this._isIdentity){this._isIdentity=!0;for(let et=0,at=16*this.size;et<at;et+=16)if(p.$I.fromArray(T,this.unitTransforms,et),!p.$I.isIdentity(T)){this._isIdentity=!1;break}}return this._isIdentity}setTransform(et,at){this.version=(this.version+1)%2147483647,p.$I.toArray(et,this.unitTransforms,this.unitOffsetMap.get(at.id)),this._isIdentity=void 0}getTransform(et,at){return p.$I.fromArray(et,this.unitTransforms,this.unitOffsetMap.get(at.id))}getSymmetryGroupTransforms(et){return this.groupUnitTransforms[this.groupIndexMap.get(et.hashCode)]}}var w=n(5384);const Q=(0,p.$I)();function G(st,et,at){for(let Et=0,Nt=st.units.length;Et<Nt;Et++){const qt=st.units[Et];w.JX.lerpFromIdentity(Q,qt.conformation.operator,at),et.setTransform(Q,qt)}}const V=(0,p.eB)(),U=(0,p.eB)(),N=(0,p.$I)();function k(st,et,at,Et){const Nt=Et.radius*at;for(let qt=0,Cn=st.units.length;qt<Cn;qt++){const Un=st.units[qt];p.eB.transformMat4(V,Un.lookup3d.boundary.sphere.center,Un.conformation.operator.matrix),p.eB.sub(U,V,Et.center),p.eB.setMagnitude(U,U,Nt),p.$I.fromTranslation(N,U),et.setTransform(N,Un)}}const H={axis:c.t.MappedStatic("custom",{structure:c.t.Group({principalAxis:c.t.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:c.t.Group({vector:c.t.Vec3(p.eB.create(0,0,1))})}),origin:c.t.MappedStatic("structure",{structure:c.t.Group({}),custom:c.t.Group({vector:c.t.Vec3(p.eB.create(0,0,0))})})};function $(st,et){let at,Et;return at="custom"===et.axis.name?et.axis.params.vector:o.oE.getPrincipalAxes(st).momentsAxes[et.axis.params.principalAxis],Et="custom"===et.origin.name?et.origin.params.vector:o.oE.getPrincipalAxes(st).momentsAxes.origin,{axis:at,origin:Et}}const J=(0,p.$I)(),W=(0,p.$I)(),te=(0,p.$I)();function de(st,et,at,Et,Nt){for(let qt=0,Cn=st.units.length;qt<Cn;qt++){const Un=st.units[qt];p.eB.negate(U,Nt),p.$I.fromTranslation(N,U),p.$I.fromRotation(J,Math.PI*at*2,Et),p.$I.fromTranslation(W,Nt),p.$I.mul(te,J,N),p.$I.mul(te,W,te),et.setTransform(te,Un)}}var ye=n(190),j=n(261),Z=n(1965),q=n(5019),Y=n(9498),ee=n(9283),g=n(573),_e=n(3280),xe=n(8937);const le=p.$I.fromTranslation((0,p.$I)(),p.eB.create(.5,.5,.5)),Ae=(0,xe.b0)((0,xe.so)((0,_e.UC)()),le),Be=(0,p.eB)(),Ce=(0,p.$I)(),we={...ee.e.Params,cellColor:c.t.Color(v.s.orange),cellScale:c.t.Numeric(2,{min:.1,max:5,step:.1}),ref:c.t.Select("model",c.t.objectToOptions({origin:"Origin",model:"Model"}),{isEssential:!0}),attachment:c.t.Select("corner",c.t.objectToOptions({corner:"Corner",center:"Center"}),{isEssential:!0})},Oe={mesh:(st,et)=>R(Ne,ee.e.Utils)},Se={...we};function Ne(st,et,at,Et){const Nt=function Ve(st,et,at){const Et=g.P.createState(256,128,at),{fromFractional:Nt}=st.symmetry.spacegroup.cell;p.eB.copy(Be,st.ref),"center"===et.attachment?(p.eB.trunc(Be,Be),p.eB.subScalar(Be,Be,.5)):p.eB.floor(Be,Be),p.$I.fromTranslation(Ce,Be);const qt=(0,xe.b0)((0,xe.so)(Ae),Ce),Cn=Math.cbrt(st.symmetry.spacegroup.cell.volume)/300*et.cellScale;Et.currentGroup=1,g.P.addCage(Et,Nt,qt,Cn,2,20);const Un=w.f8.fromDimensionsAndTransform((0,w.f8)(),p.eB.unit,Nt);p.eB.transformMat4(Be,Be,Nt),w.f8.translate(Un,Un,Be),w.f8.expand(Un,Un,Cn);const vn=g.P.getMesh(Et);return vn.setBoundingSphere(Un),vn}(et,at,Et&&Et.geometry),qt=o.vw.getUnitcellLabel(et.symmetry);return _.y.create(qt,et,Nt,()=>at.cellColor,()=>1,()=>qt)}function K(st,et,at){const Et=(0,p.eB)();return"model"===at.ref&&p.eB.transformMat4(Et,o.Kx.getCenter(st),et.spacegroup.cell.toFractional),{symmetry:et,ref:Et}}var be=n(5315),Te=n(4255),ie=n(5821),ue=n(7377),re=n(3917),ve=n(6600);const ce={unitLabel:c.t.Text("\u212b",{isEssential:!0})},se={...be.q.Params,...ce,lineSizeAttenuation:c.t.Boolean(!0),linesColor:c.t.Color(v.s.lightgreen,{isEssential:!0}),linesSize:c.t.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:c.t.Numeric(.2,{min:.01,max:.2,step:.01})},ae={...ve.$,...ce},ge={lines:(st,et)=>R(en,be.q.Utils,{modifyState:at=>({...at,markerActions:u.sY.Highlighting})}),text:(st,et)=>R(pn,Te.E.Utils,{modifyState:at=>({...at,markerActions:u.xi.None})})},Ie={...se,...ae,visuals:c.t.MultiSelect(["lines","text"],c.t.objectToOptions(ge))};function nt(st,et){const{sphereA:at,sphereB:Et,center:Nt}=et,[qt,Cn]=st.loci;return h.QN.getBoundingSphere(qt,at),h.QN.getBoundingSphere(Cn,Et),p.eB.add(Nt,at.center,Et.center),p.eB.scale(Nt,Nt,.5),et.distance=p.eB.distance(at.center,Et.center),et}const je=function Le(){return{sphereA:(0,w.f8)(),sphereB:(0,w.f8)(),center:(0,p.eB)(),distance:0}}();function Lt(st,et){return 1===st.pairs.length?`Distance ${(0,re.W8)(st.pairs[0],{unitLabel:et,measureOnly:!0})}`:`${st.pairs.length} Distances`}function en(st,et,at,Et){const Nt=function Je(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.pairs.length;Nt<qt;++Nt)nt(st.pairs[Nt],je),Et.addFixedLengthDashes(je.sphereA.center,je.sphereB.center,et.dashLength,Nt);return Et.getLines()}(et,at,Et&&Et.geometry),qt=Lt(et,at.unitLabel);return _.y.create(qt,et,Nt,()=>at.linesColor,()=>at.linesSize,Un=>(0,re.W8)(et.pairs[Un],at))}function pn(st,et,at,Et){const Nt=function Bt(st,et,at){const Et=ue.t.create(et,128,64,at);for(let Nt=0,qt=st.pairs.length;Nt<qt;++Nt){nt(st.pairs[Nt],je);const{center:Cn,distance:Un,sphereA:vn,sphereB:nr}=je,pr=et.customText||`${Un.toFixed(2)} ${et.unitLabel}`,mo=Math.max(2,vn.radius,nr.radius)/2;Et.add(pr,Cn[0],Cn[1],Cn[2],1,mo,Nt)}return Et.getText()}(et,at,Et&&Et.geometry),qt=Lt(et,at.unitLabel);return _.y.create(qt,et,Nt,()=>at.textColor,()=>at.textSize,Un=>(0,re.W8)(et.pairs[Un],at))}function mt(st){return{pairs:[{loci:[st[0].loci,st[1].loci]}]}}function _t(st){return{triples:[{loci:[st[0].loci,st[1].loci,st[2].loci]}]}}function Me(st){return{quads:[{loci:[st[0].loci,st[1].loci,st[2].loci,st[3].loci]}]}}function Ke(st){return{infos:[{loci:st[0].loci}]}}function ut(st){return{locis:st.map(et=>et.loci)}}function Kt(st){return{locis:st.map(et=>et.loci)}}const sn={...ve.$},gt={text:(st,et)=>R(Mt,Te.E.Utils)},yt={...sn,scaleByRadius:c.t.Boolean(!0),visuals:c.t.MultiSelect(["text"],c.t.objectToOptions(gt)),snapshotKey:c.t.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),tooltip:c.t.Text("",{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:"Tooltip",description:"Tooltip text to be displayed when hovering over the label"})},At=(0,w.f8)();function Gt(st,et=!1){return st.label||(0,re.YQ)(st.loci,{hidePrefix:!0,htmlStyling:!1,condensed:et})}function Mt(st,et,at,Et){var Nt,qt;const Cn=function tt(st,et,at){const Et=ue.t.create(et,128,64,at),Nt=et.customText.trim();for(let qt=0,Cn=st.infos.length;qt<Cn;++qt){const Un=st.infos[qt],vn=h.QN.getBoundingSphere(Un.loci,At);if(!vn)continue;const{center:nr,radius:pr}=vn,Rr=Nt||Gt(Un,!0);Et.add(Rr,nr[0],nr[1],nr[2],et.scaleByRadius?pr/.9:0,et.scaleByRadius?Math.max(1,pr):1,qt)}return Et.getText()}(et,at,Et&&Et.geometry),Un=function rn(st){return 1===st.infos.length?Gt(st.infos[0]):`${st.infos.length} Labels`}(et),vn=null!==(qt=null===(Nt=at.tooltip)||void 0===Nt?void 0:Nt.trim())&&void 0!==qt?qt:"",nr=at.customText.trim();let pr;return pr=vn?Rr=>vn:nr?Rr=>nr:Rr=>Gt(et.infos[Rr]),_.y.create(Un,et,Cn,()=>at.textColor,()=>at.textSize,pr)}const bn=(0,p.eB)(),Dn=p.$I.identity(),jt=new Float32Array(18),It=new Uint8Array([0,1,2,3,4,5]);n(2802),n(4439),p.eB.zero(),p.eB.zero();const kt=(0,p.eB)(),Ot=(0,p.eB)(),An=(0,p.eB)(),jn=(0,p.eB)(),On=p.$I.identity(),fr=new Float32Array(24),Dr=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);var or=n(4777);const Nr={color:c.t.Color(v.s.orange),scaleFactor:c.t.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:c.t.Numeric(2,{min:.1,max:10,step:.1})},Ir={...ee.e.Params,...Nr},Or={...ee.e.Params,...Nr},Jr={...ee.e.Params,...Nr},To={axes:(st,et)=>R(Yt,ee.e.Utils),box:(st,et)=>R(Rn,ee.e.Utils),ellipsoid:(st,et)=>R(Yn,ee.e.Utils)},un={...Ir,...Or,...Jr,visuals:c.t.MultiSelect(["box"],c.t.objectToOptions(To))};function Yt(st,et,at,Et){const Nt=function dt(st,et,at){const Et=g.P.createState(256,128,at),Nt=o.iZ.Loci.getPrincipalAxesMany(st.locis);return w.n.scale(Nt.momentsAxes,Nt.momentsAxes,et.scaleFactor),Et.currentGroup=0,function Dt(st,et,at,Et,Nt){const{origin:qt,dirA:Cn,dirB:Un,dirC:vn}=et;p.eB.add(bn,qt,Cn),p.eB.toArray(p.eB.add(bn,qt,Cn),jt,0),p.eB.toArray(p.eB.sub(bn,qt,Cn),jt,3),p.eB.toArray(p.eB.add(bn,qt,Un),jt,6),p.eB.toArray(p.eB.sub(bn,qt,Un),jt,9),p.eB.toArray(p.eB.add(bn,qt,vn),jt,12),p.eB.toArray(p.eB.sub(bn,qt,vn),jt,15);const nr=(0,xe.L3)(jt,It),pr=w.n.volume(et),Rr=Math.cbrt(pr)/300*at;g.P.addCage(st,Dn,nr,Rr,Et,Nt)}(Et,Nt.momentsAxes,et.radiusScale,2,20),g.P.getMesh(Et)}(et,at,Et&&Et.geometry),qt=function ct(st){return`Principal Axes of ${(0,re.k7)(st,{countsOnly:!0})}`}(et.locis);return _.y.create(qt,et,Nt,()=>at.color,()=>1,()=>qt)}function Rn(st,et,at,Et){const Nt=function xn(st,et,at){const Et=g.P.createState(256,128,at),Nt=o.iZ.Loci.getPrincipalAxesMany(st.locis);return w.n.scale(Nt.boxAxes,Nt.boxAxes,et.scaleFactor),Et.currentGroup=0,function Pr(st,et,at,Et,Nt){const{origin:qt,dirA:Cn,dirB:Un,dirC:vn}=et,nr=p.eB.negate(Ot,Cn),pr=p.eB.negate(An,Un),Rr=p.eB.negate(jn,vn);let mo=0;const Uo=function(Lo,Ni,rs){p.eB.copy(kt,qt),p.eB.add(kt,kt,Lo),p.eB.add(kt,kt,Ni),p.eB.add(kt,kt,rs),p.eB.toArray(kt,fr,mo),mo+=3};Uo(Cn,Un,vn),Uo(Cn,Un,Rr),Uo(Cn,pr,Rr),Uo(Cn,pr,vn),Uo(nr,pr,Rr),Uo(nr,pr,vn),Uo(nr,Un,vn),Uo(nr,Un,Rr);const qo=(0,xe.L3)(fr,Dr),ri=w.n.volume(et),fo=Math.cbrt(ri)/300*at;g.P.addCage(st,On,qo,fo,Et,Nt)}(Et,Nt.boxAxes,et.radiusScale,2,20),g.P.getMesh(Et)}(et,at,Et&&Et.geometry),qt=function cn(st){return`Oriented Box of ${(0,re.k7)(st,{countsOnly:!0})}`}(et.locis);return _.y.create(qt,et,Nt,()=>at.color,()=>1,()=>qt)}function Yn(st,et,at,Et){const Nt=function ir(st,et,at){const Et=g.P.createState(256,128,at),qt=o.iZ.Loci.getPrincipalAxesMany(st.locis).boxAxes,{origin:Cn,dirA:Un,dirB:vn}=qt,nr=w.n.size((0,p.eB)(),qt);p.eB.scale(nr,nr,.5*et.scaleFactor);const pr=p.eB.create(nr[2],nr[1],nr[0]);return Et.currentGroup=0,(0,or.P)(Et,Cn,Un,vn,pr,2),g.P.getMesh(Et)}(et,at,Et&&Et.geometry),qt=function er(st){return`Oriented Ellipsoid of ${(0,re.k7)(st,{countsOnly:!0})}`}(et.locis);return _.y.create(qt,et,Nt,()=>at.color,()=>1,()=>qt)}var vr=n(4490);const Hr={radius:1,segments:36,thetaStart:0,thetaLength:2*Math.PI};function Mr(st){const{radius:et,segments:at,thetaStart:Et,thetaLength:Nt}={...Hr,...st},qt=Nt===2*Math.PI,Cn=qt?at+1:at+2,Un=new Float32Array(3*Cn),vn=new Float32Array(3*Cn),nr=new Uint32Array(3*at);Un[0]=0,Un[1]=0,Un[2]=0,vn[0]=0,vn[1]=1,vn[2]=0;for(let pr=0,Rr=3;pr<at;++pr,Rr+=3){const mo=Et+pr/at*Nt;Un[Rr]=et*Math.sin(mo),Un[Rr+1]=0,Un[Rr+2]=et*Math.cos(mo),vn[Rr]=0,vn[Rr+1]=1,vn[Rr+2]=0}for(let pr=1,Rr=0;pr<at;++pr,Rr+=3)nr[Rr]=pr,nr[Rr+1]=pr+1,nr[Rr+2]=0;if(qt){const pr=3*(at-1);nr[pr]=at,nr[pr+1]=1,nr[pr+2]=0}else{const pr=Et+Nt,Rr=3*(at+1);Un[Rr]=et*Math.sin(pr),Un[Rr+1]=0,Un[Rr+2]=et*Math.cos(pr),vn[Rr]=0,vn[Rr+1]=1,vn[Rr+2]=0;const mo=3*(at-1);nr[mo]=at,nr[mo+1]=at+1,nr[mo+2]=0}return{vertices:Un,normals:vn,indices:nr}}var Fr=n(6928);const Sr={color:c.t.Color(v.s.lightgreen),arcScale:c.t.Numeric(.7,{min:.01,max:1,step:.01})},Ur={...be.q.Params,...Sr,lineSizeAttenuation:c.t.Boolean(!0),linesSize:c.t.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:c.t.Numeric(.04,{min:.01,max:.2,step:.01})},Ro={...Ur},ro={...Ur},po={...ee.e.Params,...Sr,ignoreLight:c.t.Boolean(!0),sectorOpacity:c.t.Numeric(.75,{min:0,max:1,step:.01})},so={vectors:(st,et)=>R(dr,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),arc:(st,et)=>R(Ft,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),sector:(st,et)=>R(ht,ee.e.Utils,{modifyProps:at=>({...at,alpha:at.sectorOpacity}),modifyState:at=>({...at,markerActions:u.sY.Highlighting})}),text:(st,et)=>R(Xt,Te.E.Utils,{modifyState:at=>({...at,markerActions:u.xi.None})})},ho={...Ro,...ro,...po,...ve.$,visuals:c.t.MultiSelect(["vectors","sector","text"],c.t.objectToOptions(so))},Go=(0,p.eB)(),Wo=(0,p.$I)();function We(st,et,at){const{sphereA:Et,sphereB:Nt,sphereC:qt}=et,{arcDirA:Cn,arcDirC:Un,arcNormal:vn}=et,[nr,pr,Rr]=st.loci;h.QN.getBoundingSphere(nr,Et),h.QN.getBoundingSphere(pr,Nt),h.QN.getBoundingSphere(Rr,qt),p.eB.sub(Cn,Et.center,Nt.center),p.eB.sub(Un,qt.center,Nt.center),p.eB.cross(vn,Cn,Un);const Uo=Math.min(p.eB.magnitude(Cn),p.eB.magnitude(Un))*at;return et.radius=Uo,et.angle=p.eB.angle(Cn,Un),et}function Pt(st,et){const{radius:at,angle:Et}=st,Nt=et?(0,vr.N7)(Et,at)/et:32;p.$I.targetTo(Wo,st.sphereB.center,st.sphereA.center,st.arcNormal),p.$I.setTranslation(Wo,st.sphereB.center),p.$I.mul(Wo,Wo,p.$I.rotY180);const qt=Mr({radius:at,thetaLength:Et,segments:Nt});return(0,Fr._2)(qt,Wo)}const Sn=function Bo(){return{sphereA:(0,w.f8)(),sphereB:(0,w.f8)(),sphereC:(0,w.f8)(),arcDirA:(0,p.eB)(),arcDirC:(0,p.eB)(),arcNormal:(0,p.eB)(),radius:0,angle:0}}();function Nn(st){return 1===st.triples.length?`Angle ${(0,re.k0)(st.triples[0],{measureOnly:!0})}`:`${st.triples.length} Angles`}function dr(st,et,at,Et){const Nt=function Kn(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.triples.length;Nt<qt;++Nt)We(st.triples[Nt],Sn,et.arcScale),Et.addFixedLengthDashes(Sn.sphereB.center,Sn.sphereA.center,et.dashLength,Nt),Et.addFixedLengthDashes(Sn.sphereB.center,Sn.sphereC.center,et.dashLength,Nt);return Et.getLines()}(et,at,Et&&Et.geometry),qt=Nn(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function Ft(st,et,at,Et){const Nt=function xr(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.triples.length;Nt<qt;++Nt){We(st.triples[Nt],Sn,et.arcScale);const Cn=Pt(Sn,et.dashLength),{indices:Un,vertices:vn}=Cn;for(let nr=0,pr=Un.length;nr<pr;nr+=3){if(nr%2==1)continue;const Rr=3*Un[nr],mo=3*Un[nr+1];Et.add(vn[Rr],vn[Rr+1],vn[Rr+2],vn[mo],vn[mo+1],vn[mo+2],Nt)}}return Et.getLines()}(et,at,Et&&Et.geometry),qt=Nn(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function ht(st,et,at,Et){const Nt=function Qt(st,et,at){const Et=g.P.createState(128,64,at);for(let Nt=0,qt=st.triples.length;Nt<qt;++Nt){We(st.triples[Nt],Sn,et.arcScale);const Cn=Pt(Sn);Et.currentGroup=Nt,g.P.addPrimitive(Et,p.$I.id,Cn),g.P.addPrimitiveFlipped(Et,p.$I.id,Cn)}return g.P.getMesh(Et)}(et,at,Et&&Et.geometry),qt=Nn(et);return _.y.create(qt,et,Nt,()=>at.color,()=>1,Un=>(0,re.k0)(et.triples[Un]))}function Xt(st,et,at,Et){const Nt=function pt(st,et,at){const Et=ue.t.create(et,128,64,at);for(let Nt=0,qt=st.triples.length;Nt<qt;++Nt){We(st.triples[Nt],Sn,et.arcScale),p.eB.add(Go,Sn.arcDirA,Sn.arcDirC),p.eB.setMagnitude(Go,Go,Sn.radius),p.eB.add(Go,Sn.sphereB.center,Go);const Cn=(0,vr.H)(Sn.angle).toFixed(2),Un=et.customText||`${Cn}\xb0`,nr=Math.max(2,Sn.sphereA.radius,Sn.sphereB.radius,Sn.sphereC.radius)/2;Et.add(Un,Go[0],Go[1],Go[2],.1,nr,Nt)}return Et.getText()}(et,at,Et&&Et.geometry),qt=Nn(et);return _.y.create(qt,et,Nt,()=>at.textColor,()=>at.textSize,Un=>(0,re.k0)(et.triples[Un]))}const on={color:c.t.Color(v.s.lightgreen),arcScale:c.t.Numeric(.7,{min:.01,max:1,step:.01})},En={...be.q.Params,...on,lineSizeAttenuation:c.t.Boolean(!0),linesSize:c.t.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:c.t.Numeric(.04,{min:.01,max:.2,step:.01})},Tt={...En},Fe={...En},He={...En},Ye={...En},ot={...ee.e.Params,...on,ignoreLight:c.t.Boolean(!0),sectorOpacity:c.t.Numeric(.75,{min:0,max:1,step:.01})},rt={vectors:(st,et)=>R(tr,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),extenders:(st,et)=>R(vo,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),connector:(st,et)=>R(oo,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),arms:(st,et)=>R(Ao,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),arc:(st,et)=>R(Do,be.q.Utils,{modifyState:at=>({...at,pickable:!1})}),sector:(st,et)=>R(So,ee.e.Utils,{modifyProps:at=>({...at,alpha:at.sectorOpacity}),modifyState:at=>({...at,markerActions:u.sY.Highlighting})}),text:(st,et)=>R(Po,Te.E.Utils,{modifyState:at=>({...at,markerActions:u.xi.None})})},St={...Tt,...Fe,...He,...Ye,...ot,...ve.$,visuals:c.t.MultiSelect(["extenders","arms","sector","text"],c.t.objectToOptions(rt))},mn=(0,p.eB)(),zt=(0,p.$I)();function an(st,et,at){const{sphereA:Et,sphereB:Nt,sphereC:qt,sphereD:Cn,dirBA:Un,dirCD:vn,projA:nr,projD:pr}=et,{arcPointA:Rr,arcPointD:mo,arcDirA:Uo,arcDirD:qo,arcCenter:ri,arcNormal:fo}=et,[Lo,Ni,rs,Gi]=st.loci;h.QN.getBoundingSphere(Lo,Et),h.QN.getBoundingSphere(Ni,Nt),h.QN.getBoundingSphere(rs,qt),h.QN.getBoundingSphere(Gi,Cn),p.eB.add(ri,Nt.center,qt.center),p.eB.scale(ri,ri,.5),p.eB.sub(Un,Et.center,Nt.center),p.eB.sub(vn,Cn.center,qt.center),p.eB.add(Rr,ri,Un),p.eB.add(mo,ri,vn),p.eB.sub(fo,qt.center,Nt.center),p.eB.orthogonalize(Uo,fo,Un),p.eB.orthogonalize(qo,fo,vn),p.eB.projectPointOnVector(nr,Rr,Uo,ri),p.eB.projectPointOnVector(pr,mo,qo,ri);const hr=Math.min(p.eB.distance(nr,ri),p.eB.distance(pr,ri))*at;p.eB.setMagnitude(Uo,Uo,hr),p.eB.setMagnitude(qo,qo,hr),p.eB.add(Rr,ri,Uo),p.eB.add(mo,ri,qo),et.radius=hr,et.angle=p.eB.dihedralAngle(Et.center,Nt.center,qt.center,Cn.center),p.eB.matchDirection(mn,fo,p.eB.sub(mn,Rr,Et.center));const Wr=p.eB.angle(Un,mn),no=hr/Math.cos(Wr-vr.fC);p.eB.add(nr,Nt.center,p.eB.setMagnitude(mn,Un,no)),p.eB.matchDirection(mn,fo,p.eB.sub(mn,mo,Cn.center));const zo=p.eB.angle(vn,mn),Di=hr/Math.cos(zo-vr.fC);return p.eB.add(pr,qt.center,p.eB.setMagnitude(mn,vn,Di)),et}function Vn(st,et){const{radius:at,angle:Et}=st,Nt=et?(0,vr.N7)(Et,at)/et:32;p.$I.targetTo(zt,st.arcCenter,Et<0?st.arcPointD:st.arcPointA,st.arcNormal),p.$I.setTranslation(zt,st.arcCenter),p.$I.mul(zt,zt,p.$I.rotY180);const qt=Mr({radius:at,thetaLength:Math.abs(Et),segments:Nt});return(0,Fr._2)(qt,zt)}const Fn=function vt(){return{sphereA:(0,w.f8)(),sphereB:(0,w.f8)(),sphereC:(0,w.f8)(),sphereD:(0,w.f8)(),dirBA:(0,p.eB)(),dirCD:(0,p.eB)(),projA:(0,p.eB)(),projD:(0,p.eB)(),arcPointA:(0,p.eB)(),arcPointD:(0,p.eB)(),arcDirA:(0,p.eB)(),arcDirD:(0,p.eB)(),arcCenter:(0,p.eB)(),arcNormal:(0,p.eB)(),radius:0,angle:0}}();function rr(st){return 1===st.quads.length?`Dihedral ${(0,re.kd)(st.quads[0],{measureOnly:!0})}`:`${st.quads.length} Dihedrals`}function tr(st,et,at,Et){const Nt=function Vr(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt)an(st.quads[Nt],Fn,et.arcScale),Et.addFixedLengthDashes(Fn.arcCenter,Fn.arcPointA,et.dashLength,Nt),Et.addFixedLengthDashes(Fn.arcCenter,Fn.arcPointD,et.dashLength,Nt);return Et.getLines()}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function oo(st,et,at,Et){const Nt=function Tr(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt)an(st.quads[Nt],Fn,et.arcScale),Et.addFixedLengthDashes(Fn.sphereB.center,Fn.sphereC.center,et.dashLength,Nt);return Et.getLines()}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function Ao(st,et,at,Et){const Nt=function Gr(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt)an(st.quads[Nt],Fn,et.arcScale),Et.addFixedLengthDashes(Fn.sphereB.center,Fn.sphereA.center,et.dashLength,Nt),Et.addFixedLengthDashes(Fn.sphereC.center,Fn.sphereD.center,et.dashLength,Nt);return Et.getLines()}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function vo(st,et,at,Et){const Nt=function yo(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt)an(st.quads[Nt],Fn,et.arcScale),Et.addFixedLengthDashes(Fn.arcPointA,Fn.projA,et.dashLength,Nt),Et.addFixedLengthDashes(Fn.arcPointD,Fn.projD,et.dashLength,Nt);return Et.getLines()}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function Do(st,et,at,Et){const Nt=function Kr(st,et,at){const Et=ie.d.create(128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt){an(st.quads[Nt],Fn,et.arcScale);const Cn=Vn(Fn,et.dashLength),{indices:Un,vertices:vn}=Cn;for(let nr=0,pr=Un.length;nr<pr;nr+=3){if(nr%2==1)continue;const Rr=3*Un[nr],mo=3*Un[nr+1];Et.add(vn[Rr],vn[Rr+1],vn[Rr+2],vn[mo],vn[mo+1],vn[mo+2],Nt)}}return Et.getLines()}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.color,()=>at.linesSize,()=>"")}function So(st,et,at,Et){const Nt=function lo(st,et,at){const Et=g.P.createState(128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt){an(st.quads[Nt],Fn,et.arcScale);const Cn=Vn(Fn);Et.currentGroup=Nt,g.P.addPrimitive(Et,p.$I.id,Cn),g.P.addPrimitiveFlipped(Et,p.$I.id,Cn)}return g.P.getMesh(Et)}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.color,()=>1,Un=>(0,re.kd)(et.quads[Un]))}function Po(st,et,at,Et){const Nt=function ao(st,et,at){const Et=ue.t.create(et,128,64,at);for(let Nt=0,qt=st.quads.length;Nt<qt;++Nt){an(st.quads[Nt],Fn,et.arcScale),p.eB.add(mn,Fn.arcDirA,Fn.arcDirD),p.eB.setMagnitude(mn,mn,Fn.radius),p.eB.add(mn,Fn.arcCenter,mn);let Cn=(0,vr.H)(Fn.angle).toFixed(2);"-0.00"===Cn&&(Cn="0.00");const Un=et.customText||`${Cn}\xb0`,nr=Math.max(2,Fn.sphereA.radius,Fn.sphereB.radius,Fn.sphereC.radius,Fn.sphereD.radius)/2;Et.add(Un,mn[0],mn[1],mn[2],.1,nr,Nt)}return Et.getText()}(et,at,Et&&Et.geometry),qt=rr(et);return _.y.create(qt,et,Nt,()=>at.textColor,()=>at.textSize,Un=>(0,re.kd)(et.quads[Un]))}var jr=n(9651),Co=n(7981),Eo=n(1372),Fo=n(9646);const ei={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};new Uint32Array([0,1,2,3,3,1,2,0]);const Fi={...ee.e.Params,color:c.t.Color(v.s.orange),scaleFactor:c.t.Numeric(1,{min:.1,max:10,step:.1})},hi={plane:(st,et)=>R(ti,ee.e.Utils)},No={...Fi,visuals:c.t.MultiSelect(["plane"],c.t.objectToOptions(hi))},mi=(0,p.$I)(),qi=(0,p.eB)();function ti(st,et,at,Et){const Nt=function Oi(st,et,at){const Et=g.P.createState(256,128,at),qt=o.iZ.Loci.getPrincipalAxesMany(st.locis).boxAxes,Cn=function ci(){return ei}();return p.eB.add(qi,qt.origin,qt.dirC),p.$I.targetTo(mi,qi,qt.origin,qt.dirB),p.$I.scale(mi,mi,w.n.size(qi,qt)),p.$I.scaleUniformly(mi,mi,et.scaleFactor),p.$I.setTranslation(mi,qt.origin),Et.currentGroup=0,g.P.addPrimitive(Et,mi,Cn),g.P.addPrimitiveFlipped(Et,mi,Cn),g.P.getMesh(Et)}(et,at,Et&&Et.geometry),qt=function Ci(st){return`Best Fit Plane of ${(0,re.k7)(st,{countsOnly:!0})}`}(et.locis);return _.y.create(qt,et,Nt,()=>at.color,()=>1,()=>qt)}var Si=n(9213),Pi=n(6765),ni=n(127),gi=n(3488);const Wi=i.H.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:i.O.Molecule.Structure,to:i.O.Molecule.Structure.Representation3D,params:(st,et)=>{const{registry:at,themes:Et}=et.representation.structure,Nt=at.get(at.default.name);if(!st){const Un={help:vn=>{const{name:nr,params:pr}=vn,mo=Et.colorThemeRegistry.get(nr).factory({},pr);return{description:mo.description,legend:mo.legend}}};return{type:c.t.Mapped(at.default.name,at.types,vn=>c.t.Group(at.get(vn).getParams(Et,o.oE.Empty))),colorTheme:c.t.Mapped(Nt.defaultColorTheme.name,Et.colorThemeRegistry.types,vn=>c.t.Group(Et.colorThemeRegistry.get(vn).getParams({structure:o.oE.Empty})),Un),sizeTheme:c.t.Mapped(Nt.defaultSizeTheme.name,Et.sizeThemeRegistry.types,vn=>c.t.Group(Et.sizeThemeRegistry.get(vn).getParams({structure:o.oE.Empty})))}}const qt={structure:st.data},Cn={help:Un=>{const{name:vn,params:nr}=Un,Rr=Et.colorThemeRegistry.get(vn).factory(qt,nr);return{description:Rr.description,legend:Rr.legend}}};return{type:c.t.Mapped(at.default.name,at.getApplicableTypes(st.data),Un=>c.t.Group(at.get(Un).getParams(Et,st.data))),colorTheme:c.t.Mapped(Nt.defaultColorTheme.name,Et.colorThemeRegistry.getApplicableTypes(qt),Un=>c.t.Group(Et.colorThemeRegistry.get(Un).getParams(qt)),Cn),sizeTheme:c.t.Mapped(Nt.defaultSizeTheme.name,Et.sizeThemeRegistry.getApplicableTypes(qt),Un=>c.t.Group(Et.sizeThemeRegistry.get(Un).getParams(qt)))}}})({canAutoUpdate:({a:st,oldParams:et,newParams:at})=>st.data.elementCount<1e4||et.type.name===at.type.name&&"custom"!==at.type.params.quality,apply:({a:st,params:et},Et)=>A.YZ.create("Structure Representation",function(){var Nt=(0,e.A)(function*(qt){var Cn,Un;const vn={runtime:qt,assetManager:Et.managers.asset},nr=Et.representation.structure.registry.get(et.type.name),pr=(null===(Cn=nr.getData)||void 0===Cn?void 0:Cn.call(nr,st.data,et.type.params))||st.data;nr.ensureCustomProperties&&(yield nr.ensureCustomProperties.attach(vn,pr));const Rr=nr.factory({webgl:null===(Un=Et.canvas3d)||void 0===Un?void 0:Un.webgl,...Et.representation.structure.themes},nr.getParams);yield y.S.ensureDependencies(vn,Et.representation.structure.themes,{structure:pr},et),Rr.setTheme(y.S.create(Et.representation.structure.themes,{structure:pr},et));const mo=et.type.params||{};return yield Rr.createOrUpdate(mo,pr).runInContext(qt),new i.O.Molecule.Structure.Representation3D({repr:Rr,sourceData:st.data},{label:nr.label})});return function(qt){return Nt.apply(this,arguments)}}()),update:({a:st,b:et,oldParams:at,newParams:Et},qt)=>A.YZ.create("Structure Representation",function(){var Cn=(0,e.A)(function*(Un){var vn,nr;if(Et.type.name!==at.type.name)return t.xE.UpdateResult.Recreate;const pr=qt.representation.structure.registry.get(Et.type.name);if(null!==(vn=pr.mustRecreate)&&void 0!==vn&&vn.call(pr,at.type.params,Et.type.params))return t.xE.UpdateResult.Recreate;const Rr=(null===(nr=pr.getData)||void 0===nr?void 0:nr.call(pr,st.data,Et.type.params))||st.data,mo={runtime:Un,assetManager:qt.managers.asset};pr.ensureCustomProperties&&(yield pr.ensureCustomProperties.attach(mo,Rr)),y.S.releaseDependencies(qt.representation.structure.themes,{structure:et.data.sourceData},at),yield y.S.ensureDependencies(mo,qt.representation.structure.themes,{structure:Rr},Et),et.data.repr.setTheme(y.S.create(qt.representation.structure.themes,{structure:Rr},Et));const Uo={...et.data.repr.props,...Et.type.params};return yield et.data.repr.createOrUpdate(Uo,Rr).runInContext(Un),et.data.sourceData=st.data,t.xE.UpdateResult.Updated});return function(Un){return Cn.apply(this,arguments)}}()),dispose({b:st,params:et},at){if(!st||!et)return;const Et=st.data.sourceData,Nt=at.representation.structure.registry.get(et.type.name);Nt.ensureCustomProperties&&Nt.ensureCustomProperties.detach(Et),y.S.releaseDependencies(at.representation.structure.themes,{structure:Et},et)},interpolate(st,et,at){if("uniform"!==st.colorTheme.name||"uniform"!==et.colorTheme.name)return at<=.5?st:et;const qt=ye.Q1.interpolate(st.colorTheme.params.value,et.colorTheme.params.value,at);return{type:at<=.5?st.type:et.type,colorTheme:{name:"uniform",params:{value:qt}},sizeTheme:at<=.5?st.sizeTheme:et.sizeTheme}}}),Ri=i.H.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:{t:c.t.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=new L(at);return G(at,Et,et.t),new i.O.Molecule.Structure.Representation3DState({state:{unitTransforms:Et},initialState:{unitTransforms:new L(at)},info:at,repr:st.data.repr},{label:`Unwind T = ${et.t.toFixed(2)}`})},update({a:st,b:et,newParams:at,oldParams:Et}){const Nt=et.data.info;return st.data.sourceData!==Nt||st.data.repr!==et.data.repr?t.xE.UpdateResult.Recreate:Et.t===at.t?t.xE.UpdateResult.Unchanged:(G(Nt,et.data.state.unitTransforms,at.t),et.label=`Unwind T = ${at.t.toFixed(2)}`,et.data.repr=st.data.repr,t.xE.UpdateResult.Updated)}}),Qi=i.H.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:{t:c.t.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=new L(at);return k(at,Et,et.t,at.root.boundary.sphere),new i.O.Molecule.Structure.Representation3DState({state:{unitTransforms:Et},initialState:{unitTransforms:new L(at)},info:at,repr:st.data.repr},{label:`Explode T = ${et.t.toFixed(2)}`})},update({a:st,b:et,newParams:at,oldParams:Et}){const Nt=st.data.sourceData;return et.data.info!==Nt||st.data.repr!==et.data.repr?t.xE.UpdateResult.Recreate:Et.t===at.t?t.xE.UpdateResult.Unchanged:(k(Nt,et.data.state.unitTransforms,at.t,Nt.root.boundary.sphere),et.label=`Explode T = ${at.t.toFixed(2)}`,et.data.repr=st.data.repr,t.xE.UpdateResult.Updated)}}),Hn=i.H.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:{t:c.t.Numeric(0,{min:0,max:1,step:.01}),...H}})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=new L(at),{axis:Nt,origin:qt}=$(at.root,et);return de(at,Et,et.t,Nt,qt),new i.O.Molecule.Structure.Representation3DState({state:{unitTransforms:Et},initialState:{unitTransforms:new L(at)},info:at,repr:st.data.repr},{label:`Spin T = ${et.t.toFixed(2)}`})},update({a:st,b:et,newParams:at,oldParams:Et}){const Nt=st.data.sourceData;if(et.data.info!==Nt||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;if(Et.t===at.t&&Et.axis===at.axis&&Et.origin===at.origin)return t.xE.UpdateResult.Unchanged;const qt=et.data.state.unitTransforms,{axis:Cn,origin:Un}=$(Nt.root,at);return de(Nt,qt,at.t,Cn,Un),et.label=`Spin T = ${at.t.toFixed(2)}`,et.data.repr=st.data.repr,t.xE.UpdateResult.Updated}}),qr=i.H.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({script:c.t.Script((0,Y.e)("(sel.atom.all)","mol-script")),color:c.t.Color(v.s.blueviolet),clear:c.t.Boolean(!1)},st=>`${st.clear?"Clear":ye.Q1.toRgbString(st.color)}`,{defaultValue:[{script:(0,Y.e)("(sel.atom.all)","mol-script"),color:v.s.blueviolet,clear:!1}]})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=j.l.ofScript(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{overpaint:Nt},initialState:{overpaint:j.l.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Overpaint (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.overpaint,vn=j.l.ofScript(at.layers,qt);return j.l.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.overpaint=vn,et.data.repr=st.data.repr,et.label=`Overpaint (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),co=i.H.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({bundle:c.t.Value(o.iZ.Bundle.Empty),color:c.t.Color(v.s.blueviolet),clear:c.t.Boolean(!1)},st=>`${st.clear?"Clear":ye.Q1.toRgbString(st.color)}`,{defaultValue:[{bundle:o.iZ.Bundle.Empty,color:v.s.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=j.l.ofBundle(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{overpaint:Nt},initialState:{overpaint:j.l.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Overpaint (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.overpaint,vn=j.l.ofBundle(at.layers,qt);return j.l.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.overpaint=vn,et.data.repr=st.data.repr,et.label=`Overpaint (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),zr=i.H.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({script:c.t.Script((0,Y.e)("(sel.atom.all)","mol-script")),value:c.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},st=>`Transparency (${st.value})`,{defaultValue:[{script:(0,Y.e)("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=Z.x.ofScript(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{transparency:Nt},initialState:{transparency:Z.x.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Transparency (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.transparency,vn=Z.x.ofScript(at.layers,qt);return Z.x.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.transparency=vn,et.data.repr=st.data.repr,et.label=`Transparency (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),lr=i.H.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({bundle:c.t.Value(o.iZ.Bundle.Empty),value:c.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},st=>`Transparency (${st.value})`,{defaultValue:[{bundle:o.iZ.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=Z.x.ofBundle(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{transparency:Nt},initialState:{transparency:Z.x.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Transparency (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.transparency,vn=Z.x.ofBundle(at.layers,qt);return Z.x.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.transparency=vn,et.data.repr=st.data.repr,et.label=`Transparency (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),kr=i.H.BuiltIn({name:"emissive-structure-representation-3d-from-script",display:"Emissive 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({script:c.t.Script((0,Y.e)("(sel.atom.all)","mol-script")),value:c.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},st=>`Emissive (${st.value})`,{defaultValue:[{script:(0,Y.e)("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=gi.a.ofScript(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{emissive:Nt},initialState:{emissive:gi.a.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Emissive (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.emissive,vn=gi.a.ofScript(at.layers,qt);return gi.a.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.emissive=vn,et.data.repr=st.data.repr,et.label=`Emissive (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),Qr=i.H.BuiltIn({name:"emissive-structure-representation-3d-from-bundle",display:"Emissive 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({bundle:c.t.Value(o.iZ.Bundle.Empty),value:c.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},st=>`Emissive (${st.value})`,{defaultValue:[{bundle:o.iZ.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=gi.a.ofBundle(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{emissive:Nt},initialState:{emissive:gi.a.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Emissive (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.emissive,vn=gi.a.ofBundle(at.layers,qt);return gi.a.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.emissive=vn,et.data.repr=st.data.repr,et.label=`Emissive (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),vi=i.H.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({script:c.t.Script((0,Y.e)("(sel.atom.all)","mol-script")),material:Pi.i.getParam(),clear:c.t.Boolean(!1)},st=>`${st.clear?"Clear":Pi.i.toString(st.material)}`,{defaultValue:[{script:(0,Y.e)("(sel.atom.all)","mol-script"),material:(0,Pi.i)({roughness:1}),clear:!1}]})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=Si.l.ofScript(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{substance:Nt},initialState:{substance:Si.l.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Substance (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.substance,vn=Si.l.ofScript(at.layers,qt);return Si.l.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.substance=vn,et.data.repr=st.data.repr,et.label=`Substance (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),Ti=i.H.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({bundle:c.t.Value(o.iZ.Bundle.Empty),material:Pi.i.getParam(),clear:c.t.Boolean(!1)},st=>`${st.clear?"Clear":Pi.i.toString(st.material)}`,{defaultValue:[{bundle:o.iZ.Bundle.Empty,material:(0,Pi.i)({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=st.data.repr.geometryVersion,Nt=Si.l.ofBundle(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{substance:Nt},initialState:{substance:Si.l.Empty},info:{structure:at,geometryVersion:Et},repr:st.data.repr},{label:`Substance (${Nt.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info,qt=st.data.sourceData;if(qt!==Nt.structure||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const Cn=st.data.repr.geometryVersion;if(Cn!==Nt.geometryVersion&&(0,q.jH)(st.data.repr.props))return t.xE.UpdateResult.Recreate;const Un=et.data.state.substance,vn=Si.l.ofBundle(at.layers,qt);return Si.l.areEqual(Un,vn)?t.xE.UpdateResult.Unchanged:(Nt.geometryVersion=Cn,et.data.state.substance=vn,et.data.repr=st.data.repr,et.label=`Substance (${vn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),Bi=i.H.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({script:c.t.Script((0,Y.e)("(sel.atom.all)","mol-script")),groups:c.t.Converted(st=>Co.l.Groups.toNames(st),st=>Co.l.Groups.fromNames(st),c.t.MultiSelect((0,Eo.mX)(Co.l.Groups.Names),c.t.objectToOptions(Co.l.Groups.Names)))},st=>`${Co.l.Groups.toNames(st.groups).length} group(s)`,{defaultValue:[{script:(0,Y.e)("(sel.atom.all)","mol-script"),groups:Co.l.Groups.Flag.None}]})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=Co.l.ofScript(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{clipping:Et},initialState:{clipping:Co.l.Empty},info:at,repr:st.data.repr},{label:`Clipping (${Et.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info;if(st.data.sourceData!==Nt||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const qt=et.data.state.clipping,Cn=Co.l.ofScript(at.layers,Nt);return Co.l.areEqual(qt,Cn)?t.xE.UpdateResult.Unchanged:(et.data.state.clipping=Cn,et.data.repr=st.data.repr,et.label=`Clipping (${Cn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),Li=i.H.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({layers:c.t.ObjectList({bundle:c.t.Value(o.iZ.Bundle.Empty),groups:c.t.Converted(st=>Co.l.Groups.toNames(st),st=>Co.l.Groups.fromNames(st),c.t.MultiSelect((0,Eo.mX)(Co.l.Groups.Names),c.t.objectToOptions(Co.l.Groups.Names)))},st=>`${Co.l.Groups.toNames(st.groups).length} group(s)`,{defaultValue:[{bundle:o.iZ.Bundle.Empty,groups:Co.l.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:st,params:et}){const at=st.data.sourceData,Et=Co.l.ofBundle(et.layers,at);return new i.O.Molecule.Structure.Representation3DState({state:{clipping:Et},initialState:{clipping:Co.l.Empty},info:at,repr:st.data.repr},{label:`Clipping (${Et.layers.length} Layers)`})},update({a:st,b:et,newParams:at}){const Nt=et.data.info;if(st.data.sourceData!==Nt||st.data.repr!==et.data.repr)return t.xE.UpdateResult.Recreate;const qt=et.data.state.clipping,Cn=Co.l.ofBundle(at.layers,Nt);return Co.l.areEqual(qt,Cn)?t.xE.UpdateResult.Unchanged:(et.data.state.clipping=Cn,et.data.repr=st.data.repr,et.label=`Clipping (${Cn.layers.length} Layers)`,t.xE.UpdateResult.Updated)}}),bi=i.H.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:i.O.Molecule.Structure.Representation3D,to:i.O.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:c.t.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:c.t.Numeric(1,{min:0,max:1,step:.01}),emissiveStrength:c.t.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:c.t.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate:()=>!0,apply:({a:st,params:et})=>new i.O.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:et.overpaintStrength,transparency:et.transparencyStrength,emissive:et.emissiveStrength,substance:et.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1}},info:{},repr:st.data.repr},{label:"Theme Strength",description:`${et.overpaintStrength.toFixed(2)}, ${et.transparencyStrength.toFixed(2)}, ${et.emissiveStrength.toFixed(2)}, ${et.substanceStrength.toFixed(2)}`}),update({a:st,b:et,newParams:at}){var Nt,qt,Cn,Un;return at.overpaintStrength===(null===(Nt=et.data.state.themeStrength)||void 0===Nt?void 0:Nt.overpaint)&&at.transparencyStrength===(null===(qt=et.data.state.themeStrength)||void 0===qt?void 0:qt.transparency)&&at.emissiveStrength===(null===(Cn=et.data.state.themeStrength)||void 0===Cn?void 0:Cn.emissive)&&at.substanceStrength===(null===(Un=et.data.state.themeStrength)||void 0===Un?void 0:Un.substance)?t.xE.UpdateResult.Unchanged:(et.data.state.themeStrength={overpaint:at.overpaintStrength,transparency:at.transparencyStrength,emissive:at.emissiveStrength,substance:at.substanceStrength},et.data.repr=st.data.repr,et.label="Theme Strength",et.description=`${at.overpaintStrength.toFixed(2)}, ${at.transparencyStrength.toFixed(2)}, ${at.emissiveStrength.toFixed(2)}, ${at.substanceStrength.toFixed(2)}`,t.xE.UpdateResult.Updated)},interpolate:(st,et,at)=>({overpaintStrength:(0,ni.Cc)(st.overpaintStrength,et.overpaintStrength,at),transparencyStrength:(0,ni.Cc)(st.transparencyStrength,et.transparencyStrength,at),emissiveStrength:(0,ni.Cc)(st.emissiveStrength,et.emissiveStrength,at),substanceStrength:(0,ni.Cc)(st.substanceStrength,et.substanceStrength,at)})});var Vi,st;(st=Vi||(Vi={})).getDefaultParams=function et(Nt,qt,Cn,Un,vn,nr,pr,Rr){const mo=Nt.representation.volume.registry.get(qt),Uo=Nt.representation.volume.themes.colorThemeRegistry.get(vn||mo.defaultColorTheme.name),qo=Nt.representation.volume.themes.sizeThemeRegistry.get(pr||mo.defaultSizeTheme.name),ri=c.t.getDefaultValues(mo.getParams(Nt.representation.volume.themes,Cn));return{type:{name:qt,params:Un?{...ri,...Un}:ri},colorTheme:{name:Uo.name,params:nr?{...Uo.defaultValues,...nr}:Uo.defaultValues},sizeTheme:{name:qo.name,params:Rr?{...qo.defaultValues,...Rr}:qo.defaultValues}}},st.getDefaultParamsStatic=function at(Nt,qt,Cn,Un,vn,nr,pr){const Rr=Nt.representation.volume.registry.get(qt),mo=Nt.representation.volume.themes.colorThemeRegistry.get(Un||Rr.defaultColorTheme.name),Uo=Nt.representation.volume.themes.sizeThemeRegistry.get(nr||Rr.defaultSizeTheme.name);return{type:{name:qt,params:Cn?{...Rr.defaultValues,...Cn}:Rr.defaultValues},colorTheme:{name:Rr.defaultColorTheme.name,params:vn?{...mo.defaultValues,...vn}:mo.defaultValues},sizeTheme:{name:Rr.defaultSizeTheme.name,params:pr?{...Uo.defaultValues,...pr}:Uo.defaultValues}}},st.getDescription=function Et(Nt){var qt,Cn,Un,vn;return Nt.isoValue?r.f.IsoValue.toString(Nt.isoValue):null!==(Cn=null===(qt=Nt.renderMode)||void 0===qt?void 0:qt.params)&&void 0!==Cn&&Cn.isoValue?r.f.IsoValue.toString(null===(vn=null===(Un=Nt.renderMode)||void 0===Un?void 0:Un.params)||void 0===vn?void 0:vn.isoValue):void 0};const Ei=i.H.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:i.O.Volume.Data,to:i.O.Volume.Representation3D,params:(st,et)=>{const{registry:at,themes:Et}=et.representation.volume,Nt=at.get(at.default.name);if(!st)return{type:c.t.Mapped(at.default.name,at.types,Cn=>c.t.Group(at.get(Cn).getParams(Et,r.f.One))),colorTheme:c.t.Mapped(Nt.defaultColorTheme.name,Et.colorThemeRegistry.types,Cn=>c.t.Group(Et.colorThemeRegistry.get(Cn).getParams({volume:r.f.One}))),sizeTheme:c.t.Mapped(Nt.defaultSizeTheme.name,Et.sizeThemeRegistry.types,Cn=>c.t.Group(Et.sizeThemeRegistry.get(Cn).getParams({volume:r.f.One})))};const qt={volume:st.data};return{type:c.t.Mapped(at.default.name,at.types,Cn=>c.t.Group(at.get(Cn).getParams(Et,st.data))),colorTheme:c.t.Mapped(Nt.defaultColorTheme.name,Et.colorThemeRegistry.getApplicableTypes(qt),Cn=>c.t.Group(Et.colorThemeRegistry.get(Cn).getParams(qt))),sizeTheme:c.t.Mapped(Nt.defaultSizeTheme.name,Et.sizeThemeRegistry.getApplicableTypes(qt),Cn=>c.t.Group(Et.sizeThemeRegistry.get(Cn).getParams(qt)))}}})({canAutoUpdate:({oldParams:st,newParams:et})=>st.type.name===et.type.name,apply:({a:st,params:et},at)=>A.YZ.create("Volume Representation",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn={runtime:Nt,assetManager:at.managers.asset},Un=at.representation.volume.registry.get(et.type.name);Un.ensureCustomProperties&&(yield Un.ensureCustomProperties.attach(Cn,st.data));const vn=Un.factory({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.volume.themes},Un.getParams);vn.setTheme(y.S.create(at.representation.volume.themes,{volume:st.data},et));const nr=et.type.params||{};return yield vn.createOrUpdate(nr,st.data).runInContext(Nt),new i.O.Volume.Representation3D({repr:vn,sourceData:st.data},{label:Un.label,description:Vi.getDescription(nr)})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,oldParams:at,newParams:Et},Nt)=>A.YZ.create("Volume Representation",function(){var qt=(0,e.A)(function*(Cn){var Un;if(Et.type.name!==at.type.name)return null===(Un=Nt.representation.volume.registry.get(at.type.name).ensureCustomProperties)||void 0===Un||Un.detach(st.data),t.xE.UpdateResult.Recreate;const vn={...et.data.repr.props,...Et.type.params};return et.data.repr.setTheme(y.S.create(Nt.representation.volume.themes,{volume:st.data},Et)),yield et.data.repr.createOrUpdate(vn,st.data).runInContext(Cn),et.data.sourceData=st.data,et.description=Vi.getDescription(vn),t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),ln=i.H.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:i.O.Shape.Provider,to:i.O.Shape.Representation3D,params:(st,et)=>st?st.data.params:q.iy.Params})({canAutoUpdate:()=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Shape Representation",function(){var Et=(0,e.A)(function*(Nt){const qt={...c.t.getDefaultValues(st.data.params),...et},Cn=R(st.data.getShape,st.data.geometryUtils);return yield Cn.createOrUpdate(qt,st.data.data).runInContext(Nt),new i.O.Shape.Representation3D({repr:Cn,sourceData:st.data},{label:st.data.label})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Shape Representation",function(){var qt=(0,e.A)(function*(Cn){const Un={...et.data.repr.props,...Et};return yield et.data.repr.createOrUpdate(Un,st.data.data).runInContext(Cn),et.data.sourceData=st.data,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),Ht=i.H.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:i.O.Molecule.Model,to:i.O.Shape.Representation3D,params:()=>({...Se})})({isApplicable:st=>!!jr.i.Provider.get(st.data),canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Model Unit Cell",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn=jr.i.Provider.get(st.data);if(!Cn)return t.BM.Null;const Un=K(st.data,Cn,et),vn=function ne(st,et){return b.YL.createMulti("Unit Cell",st,et,b.YL.StateBuilder,Oe)}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>Se);return yield vn.createOrUpdate(et,Un).runInContext(Nt),new i.O.Shape.Representation3D({repr:vn,sourceData:Un},{label:"Unit Cell",description:Cn.spacegroup.name})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:at})=>A.YZ.create("Model Unit Cell",function(){var Et=(0,e.A)(function*(Nt){const qt=jr.i.Provider.get(st.data);if(!qt)return t.xE.UpdateResult.Null;const Cn={...et.data.repr.props,...at},Un=K(st.data,qt,Cn);return yield et.data.repr.createOrUpdate(Cn,Un).runInContext(Nt),et.data.sourceData=Un,t.xE.UpdateResult.Updated});return function(Nt){return Et.apply(this,arguments)}}())}),Gn=i.H.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:i.O.Molecule.Structure,to:i.O.Shape.Representation3D,params:{radius:c.t.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:c.t.Color(v.s.red,{isEssential:!0}),...ee.e.Params}})({canAutoUpdate:()=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Bounding Box",function(){var Et=(0,e.A)(function*(Nt){const qt=R((Cn,Un,vn,nr)=>{const pr=(0,Fo.getBoxMesh)(Un.box,Un.radius,nr?.geometry);return _.y.create("Bouding Box",Un,pr,()=>Un.color,()=>1,()=>"Bounding Box")},ee.e.Utils);return yield qt.createOrUpdate(et,{box:st.data.boundary.box,radius:et.radius,color:et.color}).runInContext(Nt),new i.O.Shape.Representation3D({repr:qt,sourceData:st.data},{label:"Bounding Box"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Bounding Box",function(){var qt=(0,e.A)(function*(Cn){return yield et.data.repr.createOrUpdate(Et,{box:st.data.boundary.box,radius:Et.radius,color:Et.color}).runInContext(Cn),et.data.sourceData=st.data,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),ar=i.H.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:i.O.Molecule.Structure.Selections,to:i.O.Shape.Representation3D,params:()=>({...Ie})})({canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Structure Distance",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn=mt(st.data),Un=function $e(st,et){return b.YL.createMulti("Distance",st,et,b.YL.StateBuilder,ge)}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>Ie);return yield Un.createOrUpdate(et,Cn).runInContext(Nt),new i.O.Shape.Representation3D({repr:Un,sourceData:Cn},{label:"Distance"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Structure Distance",function(){var qt=(0,e.A)(function*(Cn){const Un={...et.data.repr.props,...Et},vn=mt(st.data);return yield et.data.repr.createOrUpdate(Un,vn).runInContext(Cn),et.data.sourceData=vn,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),kn=i.H.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:i.O.Molecule.Structure.Selections,to:i.O.Shape.Representation3D,params:()=>({...ho})})({canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Structure Angle",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn=_t(st.data),Un=function fn(st,et){return b.YL.createMulti("Angle",st,et,b.YL.StateBuilder,so)}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>ho);return yield Un.createOrUpdate(et,Cn).runInContext(Nt),new i.O.Shape.Representation3D({repr:Un,sourceData:Cn},{label:"Angle"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Structure Angle",function(){var qt=(0,e.A)(function*(Cn){const Un={...et.data.repr.props,...Et},vn=_t(st.data);return yield et.data.repr.createOrUpdate(Un,vn).runInContext(Cn),et.data.sourceData=vn,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),ur=i.H.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:i.O.Molecule.Structure.Selections,to:i.O.Shape.Representation3D,params:()=>({...St})})({canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Structure Dihedral",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn=Me(st.data),Un=function Yr(st,et){return b.YL.createMulti("Dihedral",st,et,b.YL.StateBuilder,rt)}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>St);return yield Un.createOrUpdate(et,Cn).runInContext(Nt),new i.O.Shape.Representation3D({repr:Un,sourceData:Cn},{label:"Dihedral"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Structure Dihedral",function(){var qt=(0,e.A)(function*(Cn){const Un={...et.data.repr.props,...Et},vn=Me(st.data);return yield et.data.repr.createOrUpdate(Un,vn).runInContext(Cn),et.data.sourceData=vn,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),sr=i.H.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:i.O.Molecule.Structure.Selections,to:i.O.Shape.Representation3D,params:()=>({...yt})})({canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Structure Label",function(){var Et=(0,e.A)(function*(Nt){var qt,Cn,Un;const vn=Ke(st.data),nr=function nn(st,et){return b.YL.createMulti("Label",st,et,b.YL.StateBuilder,gt)}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>yt);yield nr.createOrUpdate(et,vn).runInContext(Nt);const pr=!!(null!==(Cn=et.snapshotKey)&&void 0!==Cn&&Cn.trim()||null!==(Un=et.tooltip)&&void 0!==Un&&Un.trim());return nr.setState({pickable:pr,markerActions:pr?u.sY.Highlighting:u.xi.None}),new i.O.Shape.Representation3D({repr:nr,sourceData:vn},{label:"Label"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Structure Label",function(){var qt=(0,e.A)(function*(Cn){var Un,vn;const nr={...et.data.repr.props,...Et},pr=Ke(st.data);yield et.data.repr.createOrUpdate(nr,pr).runInContext(Cn),et.data.sourceData=pr;const Rr=!!(null!==(Un=Et.snapshotKey)&&void 0!==Un&&Un.trim()||null!==(vn=Et.tooltip)&&void 0!==vn&&vn.trim());return et.data.repr.setState({pickable:Rr,markerActions:Rr?u.sY.Highlighting:u.xi.None}),t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),Jn=i.H.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:i.O.Molecule.Structure.Selections,to:i.O.Shape.Representation3D,params:()=>({...un})})({canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Structure Orientation",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn=ut(st.data),Un=function br(st,et){const at=b.YL.createMulti("Orientation",st,et,b.YL.StateBuilder,To);return at.setState({markerActions:u.sY.Highlighting}),at}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>un);return yield Un.createOrUpdate(et,Cn).runInContext(Nt),new i.O.Shape.Representation3D({repr:Un,sourceData:Cn},{label:"Orientation"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Structure Orientation",function(){var qt=(0,e.A)(function*(Cn){const Un={...et.data.repr.props,...Et},vn=ut(st.data);return yield et.data.repr.createOrUpdate(Un,vn).runInContext(Cn),et.data.sourceData=vn,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())}),Br=i.H.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:i.O.Molecule.Structure.Selections,to:i.O.Shape.Representation3D,params:()=>({...No})})({canAutoUpdate:({})=>!0,apply:({a:st,params:et},at)=>A.YZ.create("Structure Plane",function(){var Et=(0,e.A)(function*(Nt){var qt;const Cn=Kt(st.data),Un=function es(st,et){const at=b.YL.createMulti("Plane",st,et,b.YL.StateBuilder,hi);return at.setState({markerActions:u.sY.Highlighting}),at}({webgl:null===(qt=at.canvas3d)||void 0===qt?void 0:qt.webgl,...at.representation.structure.themes},()=>No);return yield Un.createOrUpdate(et,Cn).runInContext(Nt),new i.O.Shape.Representation3D({repr:Un,sourceData:Cn},{label:"Plane"})});return function(Nt){return Et.apply(this,arguments)}}()),update:({a:st,b:et,newParams:Et},Nt)=>A.YZ.create("Structure Plane",function(){var qt=(0,e.A)(function*(Cn){const Un={...et.data.repr.props,...Et},vn=Kt(st.data);return yield et.data.repr.createOrUpdate(Un,vn).runInContext(Cn),et.data.sourceData=vn,t.xE.UpdateResult.Updated});return function(Cn){return qt.apply(this,arguments)}}())})},9646:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{BoxShape3D:()=>_,getBoxMesh:()=>M});var e=n(467),o=n(9283),r=n(573),t=n(3280),A=n(5384),y=n(4369),c=n(3558),i=n(4824),v=n(2745),O=n(8277),b=n(381);const _=b.H.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:b.O.Root,to:b.O.Shape.Provider,params:{bottomLeft:O.t.Vec3((0,y.eB)()),topRight:O.t.Vec3(y.eB.create(1,1,1)),radius:O.t.Numeric(.15,{min:.01,max:4,step:.01}),color:O.t.Color(v.s.red)}})({canAutoUpdate:()=>!0,apply:({params:I})=>i.YZ.create("Shape Representation",function(){var l=(0,e.A)(function*(m){return new b.O.Shape.Provider({label:"Box",data:I,params:o.e.Params,getShape:(u,d)=>{const s=M(A.DJ.create(I.bottomLeft,I.topRight),I.radius);return c.y.create("Box",d,s,()=>d.color,()=>1,()=>"Box")},geometryUtils:o.e.Utils},{label:"Box"})});return function(m){return l.apply(this,arguments)}}())});function M(I,l,m){const u=y.eB.sub((0,y.eB)(),I.max,I.min),d=y.$I.fromTranslation((0,y.$I)(),y.eB.create(.5,.5,.5)),s=y.$I.fromScaling((0,y.$I)(),u),C=y.$I.fromTranslation((0,y.$I)(),I.min),h=y.$I.mul3((0,y.$I)(),C,s,d),a=r.P.createState(256,128,m);a.currentGroup=1,r.P.addCage(a,h,(0,t.UC)(),l,2,20);const S=r.P.getMesh(a),D=y.eB.scaleAndAdd((0,y.eB)(),I.min,u,.5),R=y.eB.distance(I.min,D);return S.setBoundingSphere(A.f8.create(D,R)),S}},1133:(tn,Ue,n)=>{"use strict";n.d(Ue,{VK:()=>i,aU:()=>A,dL:()=>y,jB:()=>c});var e=n(9619),o=n(1395),r=n(3584),t=n(9611);const A=o.createContext(void 0);let y=(()=>{class v extends o.Component{subscribe(b,_){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(b.subscribe(_))}componentWillUnmount(){if(this.subs){for(const b of this.subs)b.unsubscribe();this.subs=void 0}}constructor(b,_){super(b),this.subs=void 0,this.plugin=_,this.init&&this.init()}}return v.contextType=A,v})(),c=(()=>{class v extends o.PureComponent{subscribe(b,_){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(b.subscribe(_))}componentWillUnmount(){if(this.subs){for(const b of this.subs)b.unsubscribe();this.subs=void 0}}constructor(b,_){super(b,_),this.subs=void 0,this.plugin=_,this.init&&this.init()}}return v.contextType=A,v})();class i extends y{componentDidUpdate(O){void 0!==this.props.initiallyCollapsed&&O.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){var O;return this.state.isHidden?null:(0,e.jsxs)("div",{className:this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",children:[(0,e.jsx)("div",{className:"msp-transform-header",children:(0,e.jsxs)(r.$n,{icon:this.state.brand?void 0:this.state.isCollapsed?t.Cp:t.DM,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse"),children:[(0,e.jsx)(t.In,{svg:null===(O=this.state.brand)||void 0===O?void 0:O.svg,inline:!0}),this.state.header,(0,e.jsx)("small",{style:{margin:"0 6px"},children:this.state.isCollapsed?"":this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(O,b){super(O,b),this.toggleCollapsed=()=>{this.setState({isCollapsed:!this.state.isCollapsed})};const _=this.defaultState();void 0!==O.initiallyCollapsed&&(_.isCollapsed=O.initiallyCollapsed),void 0!==O.header&&(_.header=O.header),this.state=_}}},8791:(tn,Ue,n)=>{"use strict";n.d(Ue,{W:()=>A});var e=n(9619),o=n(1395),r=n(3584),t=n(9611);class A extends o.PureComponent{constructor(){super(...arguments),this.hide=()=>this.props.onSelect(void 0)}render(){const M=this.props,I=(0,e.jsx)(y,{items:M.items,onSelect:M.onSelect,current:M.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent});return(0,e.jsxs)("div",{className:"msp-action-menu-options"+(M.header?"":" msp-action-menu-options-no-header"),children:[M.header&&(0,e.jsx)(r.tW,{header:M.header,title:M.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:t.X6,children:I}),!M.header&&I]})}}!function(_){function l(h,a){const{label:S,value:D,category:R,selected:f,icon:p,addOn:E,description:T}=a||{};let L;const w=[];for(let Q=0;Q<h.length;Q++){const G=h[Q];if(a?.filter&&!a.filter(G))continue;const V=R?.(G),U=S?S(G):""+G,N=D?D(G):G,k=T?T(G):"string"==typeof G?G:void 0;let H;V?(L||(L=new Map),H=L.get(V),H||(H=[_.Header(V,{description:V})],L.set(V,H),w.push(H))):H=w;const $=E?.(G);H.push({kind:"item",label:U,value:N,icon:p?p(G):void 0,selected:f?f(G):void 0,addOn:$,description:k})}return w}_.Header=function M(h,a){return a?{kind:"header",label:h,...a}:{kind:"header",label:h}},_.Item=function I(h,a,S){return{kind:"item",label:h,value:a,...S}},_.createItems=l;const m={value:h=>h[0],label:h=>h[1],category:h=>h[2]};_.createItemsFromSelectOptions=function u(h,a){return l(h,a?{...m,...a}:m)},_.hasSelectedItem=function d(h){if(O(h))return!1;if(v(h))return!!h.selected;for(const a of h)if(d(a))return!0;return!1},_.findItem=function s(h,a){if(!O(h)){if(v(h))return h.value===a?h:void 0;for(const S of h){const D=s(S,a);if(D)return D}}},_.getFirstItem=function C(h){if(!O(h)){if(v(h))return h;for(const a of h){const S=C(a);if(S)return S}}}}(A||(A={}));class y extends o.PureComponent{constructor(){super(...arguments),this.state=y.createState(this.props),this.toggleExpanded=M=>{this.setState({isExpanded:!this.state.isExpanded}),M.currentTarget.blur()},this.selectAll=()=>{const M=b(this.props.items,[]).filter(I=>!I.selected);this.props.onSelect(M)},this.selectNone=()=>{const M=b(this.props.items,[]).filter(I=>!!I.selected);this.props.onSelect(M)}}static createState(M,I){const l=i(M.items)&&O(M.items[0])?M.items[0]:void 0,m=!l?.isIndependent&&(M.multiselect?A.hasSelectedItem(M.items):!!M.current&&!!A.findItem(M.items,M.current.value)||A.hasSelectedItem(M.items));return{header:l,hasCurrent:m,isExpanded:m||(I??!!l?.initiallyExpanded)}}componentDidUpdate(M){if(this.props.items!==M.items||this.props.current!==M.current){const I=i(this.props.items)&&i(M.items)&&O(this.props.items[0])&&O(M.items[0])&&this.props.items[0].label===M.items[0].label?this.state.isExpanded:void 0;this.setState(y.createState(this.props,I))}}get multiselectHeader(){const{header:M,hasCurrent:I}=this.state;return(0,e.jsxs)("div",{className:"msp-flex-row msp-control-group-header",children:[(0,e.jsx)(r.$n,{icon:this.state.isExpanded?t.DM:t.Cp,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}.${M?.description?` ${M?.description}`:""}`,children:I?(0,e.jsx)("b",{children:M?.label}):M?.label}),(0,e.jsx)(r.$n,{icon:t.Xq,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"},children:"All"}),(0,e.jsx)(r.$n,{icon:t.X6,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"},children:"None"})]})}get basicHeader(){const{header:M,hasCurrent:I}=this.state;return(0,e.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,e.jsx)(r.$n,{noOverflow:!0,icon:this.state.isExpanded?t.DM:t.Cp,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}. ${M?.description?M?.description:""}`,children:I?(0,e.jsx)("b",{children:M?.label}):M?.label})})}render(){const{items:M,onSelect:I,current:l}=this.props;if(O(M))return null;if(v(M))return(0,e.jsx)(c,{item:M,onSelect:I,current:l,multiselect:this.props.multiselect});const{header:m}=this.state;return(0,e.jsxs)(e.Fragment,{children:[m&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,e.jsx)("div",{className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset",children:(!m||this.state.isExpanded)&&M.map((u,d)=>O(u)?null:v(u)?(0,e.jsx)(c,{item:u,onSelect:I,current:l,multiselect:this.props.multiselect},d):(0,e.jsx)(y,{items:u,onSelect:I,current:l,multiselect:this.props.multiselect,noAccent:!0},d))})]})}}const c=({item:_,onSelect:M,current:I,multiselect:l})=>(0,e.jsxs)(r.$n,{icon:_.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:d=>M(l?[_]:_,d),disabled:_.disabled,style:_.addOn?{position:"relative"}:void 0,title:_.description,children:[I===_||_.selected?(0,e.jsx)("b",{children:_.label}):_.label,_.addOn]});function i(_){return!!_&&Array.isArray(_)}function v(_){return _&&"item"===_.kind}function O(_){return _&&"header"===_.kind}function b(_,M){if(O(_))return M;if(v(_))return M.push(_),M;for(const I of _)b(I,M);return M}},22:(tn,Ue,n)=>{"use strict";n.d(Ue,{y$:()=>O,WC:()=>_,cq:()=>i});var e=n(9619),o=n(190),r=n(7785),t=n(1395),A=n(3584);const c=(0,n(3057).qM)([["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]]);class i extends t.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0},this.toggleExpanded=I=>{this.setState({isExpanded:!this.state.isExpanded}),I.currentTarget.blur()},this.onClickSwatch=I=>{const l=o.Q1.fromHexString(I.currentTarget.getAttribute("data-color")||"0");l!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(l))},this.onR=I=>{const[,l,m]=o.Q1.toRgb(this.props.value),u=o.Q1.fromRgb(I,l,m);u!==this.props.value&&this.update(u)},this.onG=I=>{const[l,,m]=o.Q1.toRgb(this.props.value),u=o.Q1.fromRgb(l,I,m);u!==this.props.value&&this.update(u)},this.onB=I=>{const[l,m]=o.Q1.toRgb(this.props.value),u=o.Q1.fromRgb(l,m,I);u!==this.props.value&&this.update(u)},this.onRGB=I=>{const l=o.Q1.fromHexStyle(I.currentTarget.value||"0");l!==this.props.value&&this.update(l)},this.onLighten=()=>{this.update(o.Q1.lighten(this.props.value,.1))},this.onDarken=()=>{this.update(o.Q1.darken(this.props.value,.1))}}update(I){this.props.onChange({param:this.props.param,name:this.props.name,value:I})}swatch(){return(0,e.jsx)("div",{className:"msp-combined-color-swatch",children:c.map(I=>(0,e.jsx)(A.$n,{inline:!0,"data-color":I[1],onClick:this.onClickSwatch,style:{background:o.Q1.toStyle(I[1])}},I[1]))})}render(){const I=this.props.param.label||(0,r.Hh)(this.props.name),[l,m,u]=o.Q1.toRgb(this.props.value),d=(0,e.jsxs)(e.Fragment,{children:[this.swatch(),(0,e.jsx)(A.eJ,{label:"RGB",className:"msp-control-label-short",control:(0,e.jsxs)("div",{style:{display:"flex",textAlignLast:"center",left:"80px"},children:[(0,e.jsx)(A.ks,{onChange:this.onR,numeric:!0,value:l,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,e.jsx)(A.ks,{onChange:this.onG,numeric:!0,value:m,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,e.jsx)(A.ks,{onChange:this.onB,numeric:!0,value:u,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,e.jsx)("input",{onInput:this.onRGB,type:"color",value:o.Q1.toHexStyle(this.props.value),style:{order:4,flex:"1 1 auto",minWidth:"32px",width:"32px",height:"32px",padding:"0 2px 0 2px",background:"none",border:"none",cursor:"pointer"}})]})}),(0,e.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,e.jsx)(A.$n,{onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Lighten"}),(0,e.jsx)(A.$n,{onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Darken"})]})]});return this.props.hideNameRow?d:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.eJ,{title:this.props.param.description,label:I,control:(0,e.jsx)(A.$n,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:o.Q1.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:d})]})}}let v;function O(){return v||(v=(0,e.jsx)(e.Fragment,{children:c.map(M=>(0,e.jsx)("option",{value:M[1],style:{background:`${o.Q1.toStyle(M[1])}`},children:(0,r.Mk)(M[0])},M[1]))}),v)}const b=function(){const M=new Map;for(const I of c)M.set(I[1],I[0]);return M}();function _(M){return b.has(M)?null:(0,e.jsx)("option",{value:M,style:{background:`${o.Q1.toStyle(M)}`},children:o.Q1.toRgbString(M)},o.Q1.toHexString(M))}},3584:(tn,Ue,n)=>{"use strict";n.d(Ue,{$n:()=>O,K0:()=>b,U2:()=>i,X3:()=>v,Yj:()=>M,eJ:()=>I,ff:()=>_,ks:()=>c,tW:()=>A});var e=n(9619),o=n(1395),r=n(190),t=n(9611);class A extends o.Component{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initialExpanded},this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let m=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(m+=" "+this.props.childrenClassName),(0,e.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0},children:[(0,e.jsx)("div",{className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,e.jsxs)(O,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,e.jsx)(t.In,{svg:this.state.isExpanded?t.Cp:t.DM}),this.props.topRightIcon&&(0,e.jsx)(t.In,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}}),(0,e.jsx)("b",{children:this.props.header})]})}),this.state.isExpanded&&(0,e.jsx)("div",{className:m,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"},children:this.props.children})]})}}function y(l){return l}class c extends o.PureComponent{constructor(){super(...arguments),this.input=o.createRef(),this.delayHandle=void 0,this.pendingValue=void 0,this.state={originalValue:"",value:""},this.onBlur=()=>{this.setState({value:""+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()},this.raiseOnChange=()=>{void 0!==this.pendingValue&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)},this.onChange=m=>{const u=m.target.value;if(this.props.isValid&&!this.props.isValid(u)||this.props.numeric&&Number.isNaN(+u))return this.clearTimeout(),void this.setState({value:u});if(this.props.numeric)this.setState({value:u},()=>this.triggerChanged(u,+u));else{const s=(this.props.toValue||y)(u),C=(this.props.fromValue||y)(s);this.setState({value:C},()=>this.triggerChanged(C,s))}},this.onKeyUp=m=>{(27===m.charCode||27===m.keyCode||"Escape"===m.key)&&this.props.blurOnEscape&&this.input.current&&this.input.current.blur()},this.onKeyPress=m=>{(13===m.keyCode||13===m.charCode||"Enter"===m.key)&&(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),m.stopPropagation()}}get isPending(){return typeof this.delayHandle<"u"}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(m,u){this.clearTimeout(),m!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=u,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(u))}static getDerivedStateFromProps(m,u){const d=m.fromValue?m.fromValue(m.value):m.value;return d===u.originalValue?null:{originalValue:d,value:d}}render(){return(0,e.jsx)("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}}class i extends o.Component{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){const{label:m,pivot:u,controls:d}=this.props;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I,{label:(0,e.jsxs)(e.Fragment,{children:[m,(0,e.jsx)("button",{className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,e.jsx)(t.In,{svg:this.state.isExpanded?t.$j:t.CR,style:{display:"inline-block"}})})]}),control:u,children:this.props.colorStripe&&(0,e.jsx)("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:r.Q1.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:d})]})}}function v(l){return(0,e.jsxs)("div",{className:"msp-section-header"+(l.accent?" msp-transform-header-brand-"+l.accent:""),children:[l.icon&&(0,e.jsx)(t.In,{svg:l.icon}),l.title," ",(0,e.jsx)("small",{children:l.desc})]})}function O(l){let u,m="msp-btn";return l.inline||(m+=" msp-btn-block"),l.noOverflow&&(m+=" msp-no-overflow"),l.flex&&(m+=" msp-flex-item"),("on"===l.commit||l.commit)&&(m+=" msp-btn-commit msp-btn-commit-on"),"off"===l.commit&&(m+=" msp-btn-commit msp-btn-commit-off"),l.children||(m+=" msp-btn-childless"),l.className&&(m+=" "+l.className),l.flex&&("number"==typeof l.flex?u={flex:`0 0 ${l.flex}px`,padding:0,maxWidth:`${l.flex}px`}:"string"==typeof l.flex&&(u={flex:`0 0 ${l.flex}`,padding:0,maxWidth:l.flex})),l.style&&(u?Object.assign(u,l.style):u=l.style),(0,e.jsxs)("button",{onClick:l.onClick,title:l.title,disabled:l.disabled,style:u,className:m,"data-id":l["data-id"],"data-color":l["data-color"],onContextMenu:l.onContextMenu,onMouseEnter:l.onMouseEnter,onMouseLeave:l.onMouseLeave,children:[l.icon&&(0,e.jsx)(t.In,{svg:l.icon}),l.children]})}function b(l){let u,m=`msp-btn msp-btn-icon${l.small?"-small":""}${l.className?" "+l.className:""}`;return typeof l.toggleState<"u"&&(m+=" msp-btn-link-toggle-"+(l.toggleState?"on":"off")),l.transparent&&(m+=" msp-transparent-bg"),l.flex&&(u="boolean"==typeof l.flex?{flex:"0 0 32px",padding:0}:"number"==typeof l.flex?{flex:`0 0 ${l.flex}px`,padding:0,maxWidth:`${l.flex}px`}:{flex:`0 0 ${l.flex}`,padding:0,maxWidth:l.flex}),l.style&&(u?Object.assign(u,l.style):u=l.style),(0,e.jsxs)("button",{className:m,onClick:l.onClick,title:l.title,disabled:l.disabled,"data-id":l["data-id"],style:u,children:[l.svg&&(0,e.jsx)(t.In,{svg:l.svg}),l.extraContent]})}class _ extends o.PureComponent{constructor(){super(...arguments),this.onClick=m=>{m.currentTarget.blur(),this.props.toggle()}}render(){const m=this.props,u=m.label;return(0,e.jsx)(O,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:m.disabled,style:m.style,className:m.isSelected?`${m.className||""} msp-control-current`:m.className,children:u&&this.props.isSelected?(0,e.jsx)("b",{children:u}):u})}}class M extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"msp-control-group-header",style:{marginTop:void 0!==this.props.marginTop?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin},children:(0,e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,e.jsx)(t.In,{svg:this.state.isExpanded?t.DM:t.Cp}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,e.jsx)("div",{className:this.props.accent?"msp-accent-offset":"msp-control-offset",children:this.props.children}))]})}}function I(l){let m="msp-control-row";return l.className&&(m+=" "+l.className),(0,e.jsxs)("div",{className:m,children:[(0,e.jsx)("span",{className:"msp-control-row-label",title:l.title,children:l.label}),(0,e.jsx)("div",{className:"msp-control-row-ctrl",children:l.control}),l.children]})}},9611:(tn,Ue,n)=>{"use strict";n.d(Ue,{$8:()=>ho,$j:()=>Dr,B7:()=>_,Bw:()=>Me,C$:()=>Ce,CQ:()=>ie,CR:()=>V,Cp:()=>J,DM:()=>H,E2:()=>yt,FJ:()=>nt,FP:()=>ye,Fi:()=>Z,Hk:()=>br,ID:()=>Q,In:()=>o,L3:()=>or,M6:()=>An,Mm:()=>ae,NT:()=>Rn,OY:()=>ke,QM:()=>y,RZ:()=>Ae,Rf:()=>Ur,Rm:()=>I,U3:()=>Gt,VH:()=>Ve,X6:()=>re,XD:()=>Oe,XI:()=>ce,Xq:()=>be,_c:()=>E,c3:()=>m,cv:()=>Ct,d6:()=>Vt,e:()=>Ir,fL:()=>Lt,fe:()=>g,fl:()=>xe,ij:()=>On,je:()=>dt,l8:()=>en,lj:()=>Bo,mf:()=>pn,ml:()=>tt,p8:()=>te,qF:()=>Hr,qp:()=>N,sM:()=>Y,sd:()=>kt,sx:()=>O,sy:()=>ir,tk:()=>i,vC:()=>K,xY:()=>cn,xf:()=>yn,y5:()=>Ie,yF:()=>L,yG:()=>po,yf:()=>nn,z7:()=>so,zs:()=>Fr});var e=n(9619);function o(Go){return Go.svg?(0,e.jsx)("span",{className:"msp-icon msp-material-icon"+(Go.inline?" msp-icon-inline":""),title:Go.title,style:Go.style,children:(0,e.jsx)(Go.svg,{})}):null}const r=(0,e.jsx)("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"}),t=(0,e.jsx)("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"}),A=(0,e.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,e.jsxs)("defs",{children:[r,t]}),(0,e.jsxs)("g",{children:[(0,e.jsx)("use",{href:"#circle-left",className:"msp-shape-filled"}),(0,e.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"}),(0,e.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"})]})]});function y(){return A}const c=(0,e.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,e.jsxs)("defs",{children:[r,t,(0,e.jsxs)("mask",{id:"mask-left",children:[(0,e.jsx)("use",{href:"#circle-left",fill:"white",stroke:"white"}),(0,e.jsx)("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"})]})]}),(0,e.jsxs)("g",{children:[(0,e.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"}),(0,e.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function i(){return c}const v=(0,e.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,e.jsxs)("defs",{children:[r,t,(0,e.jsx)("clipPath",{id:"clip-left",children:(0,e.jsx)("use",{href:"#circle-right"})})]}),(0,e.jsxs)("g",{children:[(0,e.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"}),(0,e.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,e.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function O(){return v}const b=(0,e.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,e.jsxs)("defs",{children:[r,t]}),(0,e.jsxs)("g",{children:[(0,e.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,e.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"})]})]});function _(){return b}const M=(0,e.jsx)("svg",{width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px",children:(0,e.jsx)("g",{children:(0,e.jsx)("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"})})});function I(){return M}const l=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"})});function m(){return l}(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"})}),(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"})});const h=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})});(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})}),(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{fill:"currentColor",d:"M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z"})});const p=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"})});function E(){return p}const T=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"})});function L(){return T}const w=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"})});function Q(){return w}const G=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})});function V(){return G}const U=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})});function N(){return U}const k=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M7 10l5 5 5-5z"})});function H(){return k}const $=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M10 17l5-5-5-5v10z"})});function J(){return $}const W=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})});function te(){return W}const de=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})});function ye(){return de}const j=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"})});function Z(){return j}const q=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"})});function Y(){return q}const ee=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"})});function g(){return ee}const _e=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"})});function xe(){return _e}const le=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})});function Ae(){return le}const Be=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"})});function Ce(){return Be}const Re=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"})});function ke(){return Re}const we=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})});function Oe(){return we}const Se=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})});function Ve(){return Se}const Ne=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"})});function K(){return Ne}const ne=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})});function be(){return ne}const Te=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function ie(){return Te}const ue=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function re(){return ue}const ve=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"})});function ce(){return ve}const se=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})});function ae(){return se}const ge=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"})});function Ie(){return ge}const Le=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"})});function nt(){return Le}const je=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"})});function Lt(){return je}const Je=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})});function en(){return Je}const Bt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"})});function pn(){return Bt}(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})});const _t=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})});function Me(){return _t}(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"})});const Kt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"})}),gt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})});function yt(){return gt}const At=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})});function Gt(){return At}const rn=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"})});function tt(){return rn}const Mt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"})});function nn(){return Mt}(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"})});const jt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"})}),Dt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})});function Ct(){return Dt}const $t=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})});function Vt(){return $t}const Wt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})});function yn(){return Wt}const Zt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"})});function kt(){return Zt}const Ot=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M8 5v14l11-7z"})});function An(){return Ot}const jn=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})});function On(){return jn}const fr=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M19 13H5v-2h14v2z"})});function Dr(){return fr}const Pr=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})});function or(){return Pr}const Nr=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,e.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"})});function Ir(){return Nr}const Or=(0,e.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,e.jsx)("circle",{cx:"7",cy:"14",r:"3"}),(0,e.jsx)("circle",{cx:"11",cy:"6",r:"3"}),(0,e.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"})]});(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})});const ct=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})});function dt(){return ct}const Yt=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M6 6h12v12H6z"})});function cn(){return Yt}const xn=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"})});function Rn(){return xn}const er=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"})});function ir(){return er}const Yn=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})});function br(){return Yn}const vr=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})});function Hr(){return vr}const Mr=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})});function Fr(){return Mr}const Sr=(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})});function Ur(){return Sr}(0,e.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{d:"M 9.64 7.64 c 0.23 -0.5 0.36 -1.05 0.36 -1.64 c 0 -2.21 -1.79 -4 -4 -4 S 2 3.79 2 6 s 1.79 4 4 4 c 0.59 0 1.14 -0.13 1.64 -0.36 L 10 12 l -2.36 2.36 C 7.14 14.13 6.59 14 6 14 c -2.21 0 -4 1.79 -4 4 s 1.79 4 4 4 s 4 -1.79 4 -4 c 0 -0.59 -0.13 -1.14 -0.36 -1.64 L 12 14 l 7 7 h 3 v -1 L 9.64 7.64 Z M 6 8 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 0 12 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 6 -7.5 c -0.28 0 -0.5 -0.22 -0.5 -0.5 s 0.22 -0.5 0.5 -0.5 s 0.5 0.22 0.5 0.5 s -0.22 0.5 -0.5 0.5 Z M 19 3 l -6 6 l 2 2 l 7 -7 V 3 Z"})});const po=function a(){return h},so=function Jr(){return Or},ho=function It(){return jt},Bo=function sn(){return Kt}},7561:(tn,Ue,n)=>{"use strict";n.d(Ue,{jH:()=>T,y1:()=>R,dr:()=>f,UT:()=>$,Z4:()=>w});var e=n(9619),o=n(1395),r=n(4369),t=n(9498),A=n(1861),y=n(190),c=n(1907),i=n(1094),v=n(229),O=n(8277),b=n(7785),_=n(1133),M=n(8791),I=n(22),l=n(3584),m=n(9611);class d extends o.PureComponent{render(){const{legend:re}=this.props,ve=re.colors.map(ce=>Array.isArray(ce)?`${y.Q1.toStyle(ce[0])} ${100*ce[1]}%`:y.Q1.toStyle(ce)).join(", ");return(0,e.jsx)("div",{className:"msp-scale-legend",children:(0,e.jsxs)("div",{style:{background:`linear-gradient(to right, ${ve})`},children:[(0,e.jsx)("span",{style:{float:"left"},children:re.minLabel}),(0,e.jsx)("span",{style:{float:"right"},children:re.maxLabel})]})})}}class s extends o.PureComponent{render(){const{legend:re}=this.props;return(0,e.jsx)("div",{className:"msp-table-legend",children:re.table.map((ve,ce)=>{const[se,ae]=ve;return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"msp-table-legend-color",style:{backgroundColor:y.Q1.toStyle(ae)}}),(0,e.jsx)("div",{className:"msp-table-legend-text",children:se})]},ce)})})}}class C extends o.Component{constructor(re){super(re),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0});const re=r.ZY.create(this.props.nX,this.props.nY);this.props.onmouseover(re)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,e.jsx)("circle",{r:"10",id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},`${this.props.id}circle`)]}}var h=n(6853),a=n(6115);class S extends o.Component{constructor(re){super(re),this.handleKeyDown=ve=>{},this.handleKeyUp=ve=>{},this.handleClick=ve=>ce=>{},this.handleMouseDown=ve=>ce=>{if(0===ve||ve===this.state.points.length-1||this.state.canSelectMultiple)return;const se=this.normalizePoint(r.ZY.create(this.state.points[ve][0],this.state.points[ve][1]));this.ghostPoints.push(document.createElementNS(this.namespace,"circle")),this.ghostPoints[0].setAttribute("r","10"),this.ghostPoints[0].setAttribute("fill","orange"),this.ghostPoints[0].setAttribute("cx",`${se[0]}`),this.ghostPoints[0].setAttribute("cy",`${se[1]}`),this.ghostPoints[0].setAttribute("style","display: none"),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=se[0],this.updatedY=se[1],this.selected=[ve]},this.deletePoint=ve=>ce=>{if(0===ve||ve===this.state.points.length-1)return;const se=this.state.points.filter((ae,ge)=>ge!==ve);se.sort((ae,ge)=>ae[0]===ge[0]?0===ae[0]?ae[1]-ge[1]:1===ae[1]?ge[1]-ae[1]:ae[1]-ge[1]:ae[0]-ge[0]),this.setState({points:se}),this.change(se),ce.stopPropagation()},this.myRef=o.createRef(),this.state={points:[r.ZY.create(0,0),r.ZY.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace="http://www.w3.org/2000/svg";for(const ve of this.props.data)this.state.points.push(ve);this.state.points.sort((ve,ce)=>ve[0]===ce[0]?0===ve[0]?ve[1]-ce[1]:1===ve[1]?ce[1]-ve[1]:ve[1]-ce[1]:ve[0]-ce[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){const re=this.renderPoints(),ve=this.renderLines(),ce=this.renderHistogram();return[(0,e.jsx)("div",{children:(0,e.jsxs)("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,e.jsxs)("g",{stroke:"black",fill:"black",children:[ce,ve,re]}),(0,e.jsx)("g",{className:"ghost-points",stroke:"black",fill:"black"})]})},"LineGraph"),(0,e.jsx)("div",{id:"modal-root"},"modal")]}componentDidMount(){this.gElement=document.getElementsByClassName("ghost-points")[0]}change(re){const ve=re.slice();ve.shift(),ve.pop(),this.props.onChange(ve)}handleDrag(re){if(void 0===this.selected)return;const ve=this.myRef.createSVGPoint();let ce;const se=this.padding/2;ve.x=re.clientX,ve.y=re.clientY;const ae=ve.matrixTransform(this.myRef.getScreenCTM().inverse());ce=r.ZY.create(ae.x,ae.y),ce=(ae.x<se||ae.x>this.width+se)&&(ae.y>this.height+se||ae.y<se)?r.ZY.create(this.updatedX,this.updatedY):ae.x<se?r.ZY.create(se,ae.y):ae.x>this.width+se?r.ZY.create(this.width+se,ae.y):r.ZY.create(ae.x,ae.y>this.height+se?this.height+se:ae.y<se?se:ae.y),this.updatedX=ce[0],this.updatedY=ce[1];const ge=this.unNormalizePoint(ce);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",`${ce[0]}`),this.ghostPoints[0].setAttribute("cy",`${ce[1]}`),this.props.onDrag(ge)}handleMultipleDrag(){}handlePointUpdate(re){const ve=this.selected;if(this.state.canSelectMultiple)return;if(void 0===ve||0===ve[0]||ve[0]===this.state.points.length-1)return void this.setState({copyPoint:void 0});this.selected=void 0;const ce=this.unNormalizePoint(r.ZY.create(this.updatedX,this.updatedY)),se=this.state.points.filter((ae,ge)=>ge!==ve[0]);se.push(ce),se.sort((ae,ge)=>ae[0]===ge[0]?0===ae[0]?ae[1]-ge[1]:1===ae[1]?ge[1]-ae[1]:ae[1]-ge[1]:ae[0]-ge[0]),this.setState({points:se}),this.change(se),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}handleDoubleClick(re){const ve=this.myRef.createSVGPoint();ve.x=re.clientX,ve.y=re.clientY;const ce=ve.matrixTransform(this.myRef.getScreenCTM().inverse()),se=this.state.points,ae=this.padding/2;if(ce.x<ae||ce.x>this.width+ae||ce.y>this.height+ae||ce.y<this.padding/2)return;const ge=this.unNormalizePoint(r.ZY.create(ce.x,ce.y));se.push(ge),se.sort((Ie,Le)=>Ie[0]===Le[0]?0===Ie[0]?Ie[1]-Le[1]:1===Ie[1]?Le[1]-Ie[1]:Ie[1]-Le[1]:Ie[0]-Le[0]),this.setState({points:se}),this.change(se)}handleLeave(){void 0!==this.selected&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}normalizePoint(re){const ve=this.padding/2;return r.ZY.create(re[0]*(this.width+ve-ve)+ve,this.height+this.padding-(re[1]*(this.height+ve-ve)+ve))}unNormalizePoint(re){const ve=this.padding/2;return r.ZY.create((re[0]-ve)/(this.width+ve-ve),(this.height+this.padding-re[1]-ve)/(this.height+ve-ve))}refCallBack(re){re&&(this.myRef=re)}renderHistogram(){if(!this.props.volume)return null;const re=h.x.getHistogram(this.props.volume.grid,40),ve=[],ce=re.counts.length,se=this.width/ce,ae=this.padding/2,ge=(0,a._M)(re.counts)||1;for(let Ie=0;Ie<ce;Ie++){const Le=this.width*Ie/(ce-1)+ae;ve.push((0,e.jsx)("line",{x1:Le,x2:Le,y1:this.height+ae,y2:this.height*(1-re.counts[Ie]/ge)+ae,stroke:"#ded9ca",strokeWidth:se},`histogram${Ie}`))}return ve}renderPoints(){const re=[];let ve;for(let ce=0;ce<this.state.points.length;ce++)0!==ce&&ce!==this.state.points.length-1&&(ve=this.normalizePoint(this.state.points[ce]),re.push((0,e.jsx)(C,{id:ce,x:ve[0],y:ve[1],nX:this.state.points[ce][0],nY:this.state.points[ce][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(ce),onclick:this.handleClick(ce)},ce)));return re}renderLines(){const re=[],ve=[];let ce,se,ae,ge,Ie;const Le=this.padding/2;for(const Lt of this.state.points)ce=this.width+Le,se=this.height+this.padding,ae=Lt[0]*(ce-Le)+Le,ge=Lt[1]*(se-Le)+Le,Ie=this.height+this.padding-ge,re.push(r.ZY.create(ae,Ie));const nt=re,je=nt.length;for(let Lt=0;Lt<je-1;Lt++)ve.push((0,e.jsx)("line",{x1:nt[Lt][0],x2:nt[Lt+1][0],y1:nt[Lt][1],y2:nt[Lt+1][1],stroke:"#cec9ba",strokeWidth:"5"},`lineOf${Lt}`));return ve}}var D=n(7788);class R extends o.PureComponent{constructor(){super(...arguments),this.onChange=re=>{var ve,ce;if(null===(ce=(ve=this.props).onChange)||void 0===ce||ce.call(ve,re,this.props.values),this.props.onChangeValues){const se={...this.props.values,[re.name]:re.value};this.props.onChangeValues(se,this.props.values)}},this.paramGroups=(0,i._)(re=>function p(ue){function re(ge,Ie,Le){const nt=E(Ie);if(nt)if(Ie.category){Le.map||(Le.map=new Map);let je=Le.map.get(Ie.category);je||(je=[],Le.map.set(Ie.category,je),Le.params.push(je)),je.push([ge,Ie,nt])}else Le.params[0].push([ge,Ie,nt])}function ve(ge,Ie){const Le=ge[0],nt=Ie[0];return Le&&Le[1].category?nt&&nt[1].category&&Le[1].category<nt[1].category?-1:1:-1}const ce=Object.keys(ue),se={params:[[]],map:void 0},ae={params:[[]],map:void 0};for(const ge of ce){const Ie=ue[ge];Ie.isHidden||re(ge,Ie,Ie.isEssential?se:ae)}return se.params.sort(ve),ae.params.sort(ve),{essentials:se.params,advanced:ae.params}}(re))}renderGroup(re){var ve;if(0===re.length)return null;const ce=this.props.values;let ae,se=null;for(const[ge,Ie,Le]of re)null!==(ve=Ie.hideIf)&&void 0!==ve&&ve.call(Ie,ce)||(se||(se=[]),ae=Ie.category,se.push((0,e.jsx)(Le,{param:Ie,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:ge,value:ce[ge]},ge)));return se?ae?[(0,e.jsx)(l.Yj,{header:ae,children:se},ae)]:se:null}renderPart(re){let ve=null;for(const ce of re){const se=this.renderGroup(ce);if(se){ve||(ve=[]);for(const ae of se)ve.push(ae)}}return ve}render(){const re=this.paramGroups(this.props.params),ve=this.renderPart(re.essentials),ce=this.renderPart(re.advanced);return ve&&ce?(0,e.jsxs)(e.Fragment,{children:[ve,(0,e.jsx)(l.Yj,{header:"Advanced Options",children:ce})]}):ve||ce}}class f extends _.dL{constructor(){super(...arguments),this.state={isDisabled:!1},this.setSettings=(re,ve)=>{const ce={...ve,[re.name]:re.value},se=this.props.mapping.update(ce,this.plugin);this.props.mapping.apply(se,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,re=>{this.setState({isDisabled:re})})}render(){const re=this.props.mapping.getTarget(this.plugin),ve=this.props.mapping.getValues(re,this.plugin),ce=this.props.mapping.params(this.plugin);return(0,e.jsx)(R,{params:ce,values:ve,onChange:this.setSettings,isDisabled:this.state.isDisabled})}}function E(ue){switch(ue.type){case"value":case"data-ref":return;case"boolean":return G;case"number":return typeof ue.min<"u"&&typeof ue.max<"u"?N:U;case"converted":return Te;case"conditioned":return be;case"multi-select":return Oe;case"color":return I.cq;case"color-list":return ue.offsets?Ae:le;case"vec3":return Be;case"mat4":return Ce;case"url":return Re;case"file":return ke;case"file-list":return we;case"select":return J;case"value-ref":return W;case"text":return k;case"interval":return typeof ue.min<"u"&&typeof ue.max<"u"?de:te;case"group":return Se;case"mapped":return Ve;case"line-graph":return V;case"script":return ie;case"object-list":return ne;default:return void console.warn(`${ue} has no associated UI component`)}}class T extends o.PureComponent{render(){const{legend:re,description:ve}=this.props,ce=re&&function u(ue){switch(ue.kind){case"scale-legend":return d;case"table-legend":return s;default:return void console.warn(`${ue} has no associated UI component`)}}(re);return(0,e.jsx)("div",{className:"msp-help-text",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"msp-help-description",children:[(0,e.jsx)(m.In,{svg:m.ml,inline:!0}),ve]}),ce&&(0,e.jsx)("div",{className:"msp-help-legend",children:(0,e.jsx)(ce,{legend:re})})]})})}}function L(ue){const{props:re,state:ve,control:ce,toggleHelp:se,addOn:ae}=ue,ge=[];re.param.shortLabel&&ge.push("msp-control-label-short"),re.param.twoColumns&&ge.push("msp-control-col-2"),re.param.multiline&&ge.push("msp-control-twoline");const Ie=ge.join(" "),Le=re.param.label||(0,b.Hh)(re.name),nt=re.param.help?re.param.help(re.value):{description:re.param.description,legend:re.param.legend},je=nt.description||nt.legend,Lt=Le+(je?". Click for help.":"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{className:Ie,title:Lt,label:(0,e.jsxs)(e.Fragment,{children:[Le,je&&(0,e.jsx)(w,{show:ve.showHelp,toggle:se,title:Lt})]}),control:ce}),je&&ve.showHelp&&(0,e.jsx)("div",{className:"msp-control-offset",children:(0,e.jsx)(T,{legend:nt.legend,description:nt.description})}),ae]})}function w({show:ue,toggle:re,title:ve}){return(0,e.jsx)("button",{className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:re,title:ve||(ue?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,e.jsx)(m.In,{svg:m.ml})})}class Q extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(re){this.props.onChange({param:this.props.param,name:this.props.name,value:re})}renderAddOn(){return null}render(){return L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}class G extends Q{constructor(){super(...arguments),this.onClick=re=>{this.update(!this.props.value),re.currentTarget.blur()}}renderControl(){return(0,e.jsxs)("button",{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,e.jsx)(m.In,{svg:this.props.value?m.Xq:m.CQ}),this.props.value?"On":"Off"]})}}class V extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`},this.onHover=re=>{this.setState({isOverPoint:!this.state.isOverPoint}),this.setState(re?{message:this.pointToLabel(re)}:{message:`${this.props.value.length} points`})},this.onDrag=re=>{this.setState({message:this.pointToLabel(re)})},this.onChange=re=>{this.props.onChange({name:this.props.name,param:this.props.param,value:re})},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}pointToLabel(re){var ve,ce;if(!re)return"";const se=null===(ce=(ve=this.props.param).getVolume)||void 0===ce?void 0:ce.call(ve);if(se){const{min:ae,max:ge,mean:Ie,sigma:Le}=se.grid.stats,nt=ae+(ge-ae)*re[0],je=(nt-Ie)/Le;return`(${nt.toFixed(2)} | ${je.toFixed(2)}\u03c3, ${re[1].toFixed(2)})`}return`(${re[0].toFixed(2)}, ${re[1].toFixed(2)})`}render(){var re,ve;const ce=this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{label:ce,control:(0,e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,e.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none",marginTop:1},children:(0,e.jsx)(S,{data:this.props.value,volume:null===(ve=(re=this.props.param).getVolume)||void 0===ve?void 0:ve.call(re),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}}class U extends o.PureComponent{constructor(){super(...arguments),this.state={value:"0"},this.update=re=>{const ve=(0,v.XV)(this.props.param.step||.01);re=parseFloat(re.toFixed(ve)),this.props.onChange({param:this.props.param,name:this.props.name,value:re})}}render(){const re=this.props.param.label||(0,b.Hh)(this.props.name),ve=this.props.param.label||(0,b.Hh)(this.props.name),ce=(0,v.XV)(this.props.param.step||.01);return(0,e.jsx)(l.eJ,{title:this.props.param.description,label:ve,control:(0,e.jsx)(l.ks,{numeric:!0,value:parseFloat(this.props.value.toFixed(ce)),onEnter:this.props.onEnter,placeholder:re,isDisabled:this.props.isDisabled,onChange:this.update})})}}class N extends Q{constructor(){super(...arguments),this.onChange=re=>{this.update(re)}}renderControl(){return(0,e.jsx)(D.Ap,{value:typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}}class k extends Q{constructor(){super(...arguments),this.updateValue=re=>{re!==this.props.value&&this.update(re)}}renderControl(){const re=this.props.param.placeholder||this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsx)(H,{props:this.props,placeholder:re,update:this.updateValue})}}function H({props:ue,placeholder:re,update:ve}){const[ce,se]=o.useState(ue.value);return o.useEffect(()=>se(ue.value),[ue.value]),ue.param.multiline?(0,e.jsx)("div",{className:"msp-control-text-area-wrapper",children:(0,e.jsx)("textarea",{value:ue.param.disableInteractiveUpdates?ce||"":ue.value,placeholder:re,onChange:ae=>{ue.param.disableInteractiveUpdates?se(ae.target.value):ve(ae.target.value)},onBlur:ae=>{ue.param.disableInteractiveUpdates&&ve(ae.target.value)},onKeyDown:ae=>{"Enter"===ae.key&&(ae.shiftKey||ae.ctrlKey||ae.metaKey)&&ae.currentTarget.blur()},disabled:ue.isDisabled})}):(0,e.jsx)("input",{type:"text",value:ue.param.disableInteractiveUpdates?ce||"":ue.value,placeholder:re,onChange:ae=>{ue.param.disableInteractiveUpdates?se(ae.target.value):ve(ae.target.value)},onBlur:ae=>{ue.param.disableInteractiveUpdates&&ve(ae.target.value)},disabled:ue.isDisabled,onKeyDown:ae=>{"Enter"===ae.key&&(ue.onEnter?(ae.stopPropagation(),ue.onEnter()):"Enter"===ae.key&&(ae.shiftKey||ae.ctrlKey||ae.metaKey)?ae.currentTarget.blur():ue.param.disableInteractiveUpdates&&ve(ce))}})}class $ extends o.PureComponent{constructor(){super(...arguments),this.onChange=re=>{this.update("number"==typeof this.props.param.defaultValue?parseInt(re.target.value,10):re.target.value)}}update(re){this.props.onChange({param:this.props.param,name:this.props.name,value:re})}render(){const re=void 0!==this.props.value&&!this.props.param.options.some(ve=>ve[0]===this.props.value);return(0,e.jsxs)("select",{className:"msp-form-control",title:this.props.title,value:void 0!==this.props.value?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled,children:[re&&(0,e.jsx)("option",{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([ve,ce])=>(0,e.jsx)("option",{value:ve,children:ce},ve))]})}}class J extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=re=>{re&&re.value!==this.props.value?this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:re.value})}):this.setState({showOptions:!1})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.cycle=()=>{const{options:re}=this.props.param,ve=re.findIndex(se=>se[0]===this.props.value);this.props.onChange({param:this.props.param,name:this.props.name,value:re[ve===re.length-1?0:ve+1][0]})},this.items=(0,i._)(re=>M.W.createItemsFromSelectOptions(re.options)),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){var re;const ve=this.items(this.props.param),ce=void 0!==this.props.value?M.W.findItem(ve,this.props.value):void 0,se=ce?ce.label:typeof this.props.value>"u"?`${(null===(re=M.W.getFirstItem(ve))||void 0===re?void 0:re.label)||""} [Default]`:`[Invalid] ${this.props.value}`;return(0,e.jsx)(l.ff,{disabled:this.props.isDisabled,style:{textAlign:this.props.param.cycle?"center":"left",overflow:"hidden",textOverflow:"ellipsis"},label:se,title:se,icon:this.props.param.cycle?"on"===this.props.value?m.Xq:"off"===this.props.value?m.CQ:void 0:void 0,toggle:this.props.param.cycle?this.cycle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;const re=this.items(this.props.param),ve=M.W.findItem(re,this.props.value);return(0,e.jsx)(M.W,{items:re,current:ve,onSelect:this.onSelect})}render(){return L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}let W=(()=>{class ue extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=ve=>{ve&&ve.value!==this.props.value?this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:ve.value}})}):this.setState({showOptions:!1})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return M.W.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){var ve;const se=this.props.value.ref?M.W.findItem(this.items,this.props.value.ref):void 0,ae=se?se.label:`[Ref] ${null!==(ve=this.props.value.ref)&&void 0!==ve?ve:""}`;return(0,e.jsx)(l.ff,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:ae,title:ae,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;const ve=this.items,ce=M.W.findItem(ve,this.props.value.ref);return(0,e.jsx)(M.W,{items:ve,current:ce,onSelect:this.onSelect})}render(){return L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}return ue.contextType=_.aU,ue})();class te extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:O.t.Numeric(0,{step:this.props.param.step},{label:"Min"}),1:O.t.Numeric(0,{step:this.props.param.step},{label:"Max"})},this.componentChange=({name:re,value:ve})=>{const ce=[...this.props.value];ce[+re]=ve,this.change(ce)},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}render(){const re=this.props.value,ve=this.props.param.label||(0,b.Hh)(this.props.name),ce=(0,v.XV)(this.props.param.step||.01),se=`[${re[0].toFixed(ce)}, ${re[1].toFixed(ce)}]`;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{label:ve,control:(0,e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:se})}),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:(0,e.jsx)(R,{params:this.components,values:re,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}}class de extends Q{constructor(){super(...arguments),this.onChange=re=>{this.update(re)}}renderControl(){return(0,e.jsx)(D.Mm,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}}function j(ue,re=!1){return Array.isArray(ue)?re?`${y.Q1.toStyle(ue[0])} ${(100*ue[1]).toFixed(2)}%`:y.Q1.toStyle(ue[0]):y.Q1.toStyle(ue)}const Z=(0,i.E)(ue=>`linear-gradient(to right, ${ue.map(ve=>j(ve,!0)).join(", ")})`),q=(0,i.E)(ue=>{const re=ue.length,ve=[`${j(ue[0])} ${1/re*100}%`];for(let ce=1,se=re-1;ce<se;++ce)ve.push(`${j(ue[ce])} ${ce/re*100}%`,`${j(ue[ce])} ${(ce+1)/re*100}%`);return ve.push(`${j(ue[re-1])} ${(re-1)/re*100}%`),`linear-gradient(to right, ${ve.join(", ")})`});function Y(ue,re="0"){return{background:ee(ue.colors,"set"===ue.kind),position:"absolute",bottom:"0",height:"4px",right:re,left:"0"}}function ee(ue,re){return re?q(ue):Z(ue)}let _e;function xe(){return _e||(_e=function g(){const ue=re=>{const ve=(0,c.JA)(re[0]);return(0,e.jsx)("div",{style:Y({kind:"qualitative"!==ve.type?"interpolate":"set",colors:ve.list})})};return{ColorPresets:{all:M.W.createItemsFromSelectOptions(c.CL,{addOn:ue}),scale:M.W.createItemsFromSelectOptions(c.Qx,{addOn:ue}),set:M.W.createItemsFromSelectOptions(c.cG,{addOn:ue})},ColorsParam:O.t.ObjectList({color:O.t.Color(0)},({color:re})=>y.Q1.toHexString(re).toUpperCase()),OffsetColorsParam:O.t.ObjectList({color:O.t.Color(0),offset:O.t.Numeric(0,{min:0,max:1,step:.01})},({color:re,offset:ve})=>`${y.Q1.toHexString(re).toUpperCase()} [${ve.toFixed(2)}]`),IsInterpolatedParam:O.t.Boolean(!1,{label:"Interpolated"})}}(),_e)}class le extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:"edit"===this.state.show?void 0:"edit"}),this.togglePresets=()=>this.setState({show:"presets"===this.state.show?void 0:"presets"}),this.selectPreset=re=>{if(!re)return;this.setState({show:void 0});const ve=(0,c.JA)(re.value);this.update({kind:"qualitative"!==ve.type?"interpolate":"set",colors:ve.list})},this.colorsChanged=({value:re})=>{this.update({kind:this.props.value.kind,colors:re.map(ve=>ve.color)})},this.isInterpolatedChanged=({value:re})=>{this.update({kind:re?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(re){this.props.onChange({param:this.props.param,name:this.props.name,value:re})}renderControl(){const{value:re}=this.props;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[1===re.colors.length?"1 color":`${re.colors.length} colors`,(0,e.jsx)("div",{style:Y(re,"33px")})]}),(0,e.jsx)(l.K0,{svg:m.sM,onClick:this.togglePresets,toggleState:"presets"===this.state.show,title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;const{ColorPresets:re,ColorsParam:ve,IsInterpolatedParam:ce}=xe();if("presets"===this.state.show)return(0,e.jsx)(M.W,{items:re[this.props.param.presetKind],onSelect:this.selectPreset});const ae=this.props.value.colors.map(ge=>({color:ge}));return(0,e.jsxs)("div",{className:"msp-control-offset",children:[(0,e.jsx)(ne,{name:"colors",param:ve,value:ae,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,e.jsx)(G,{name:"isInterpolated",param:ce,value:"interpolate"===this.props.value.kind,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}}class Ae extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:"edit"===this.state.show?void 0:"edit"}),this.togglePresets=()=>this.setState({show:"presets"===this.state.show?void 0:"presets"}),this.selectPreset=re=>{if(!re)return;this.setState({show:void 0});const ve=(0,c.JA)(re.value);this.update({kind:"qualitative"!==ve.type?"interpolate":"set",colors:ve.list})},this.colorsChanged=({value:re})=>{const ve=re.map(ce=>[ce.color,ce.offset]);ve.sort((ce,se)=>ce[1]-se[1]),this.update({kind:this.props.value.kind,colors:ve})},this.isInterpolatedChanged=({value:re})=>{this.update({kind:re?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(re){this.props.onChange({param:this.props.param,name:this.props.name,value:re})}renderControl(){const{value:re}=this.props;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[1===re.colors.length?"1 color":`${re.colors.length} colors`,(0,e.jsx)("div",{style:Y(re,"33px")})]}),(0,e.jsx)(l.K0,{svg:m.sM,onClick:this.togglePresets,toggleState:"presets"===this.state.show,title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;const{ColorPresets:re,OffsetColorsParam:ve,IsInterpolatedParam:ce}=xe();if("presets"===this.state.show)return(0,e.jsx)(M.W,{items:re[this.props.param.presetKind],onSelect:this.selectPreset});const ae=this.props.value.colors,ge=ae.map((Ie,Le)=>Array.isArray(Ie)?{color:Ie[0],offset:Ie[1]}:{color:Ie,offset:Le/ae.length});return ge.sort((Ie,Le)=>Ie.offset-Le.offset),(0,e.jsxs)("div",{className:"msp-control-offset",children:[(0,e.jsx)(ne,{name:"colors",param:ve,value:ge,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,e.jsx)(G,{name:"isInterpolated",param:ce,value:"interpolate"===this.props.value.kind,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}}class Be extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:O.t.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||"X"}),1:O.t.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||"Y"}),2:O.t.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||"Z"})},this.componentChange=({name:re,value:ve})=>{const ce=r.eB.copy(r.eB.zero(),this.props.value);ce[+re]=ve,this.change(ce)},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}render(){const re=this.props.value,ve=this.props.param.label||(0,b.Hh)(this.props.name),ce=(0,v.XV)(this.props.param.step||.01),se=`[${re[0].toFixed(ce)}, ${re[1].toFixed(ce)}, ${re[2].toFixed(ce)}]`;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{label:ve,control:(0,e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:se})}),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:(0,e.jsx)(R,{params:this.components,values:re,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}}class Ce extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={json:O.t.Text(JSON.stringify((0,r.$I)()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},this.componentChange=({name:re,value:ve})=>{const ce=r.$I.copy((0,r.$I)(),this.props.value);"json"===re?r.$I.copy(ce,JSON.parse(ve)):ce[+re]=ve,this.change(ce)},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}changeValue(re){return ve=>{const ce=r.$I.copy((0,r.$I)(),this.props.value);ce[re]=ve,this.change(ce)}}get grid(){const re=this.props.value,ve=[];for(let ce=0;ce<4;ce++){const se=[];for(let ae=0;ae<4;ae++)se.push((0,e.jsx)(l.ks,{numeric:!0,delayMs:50,value:r.$I.getValue(re,ce,ae),onChange:this.changeValue(4*ae+ce),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},ae));ve.push((0,e.jsx)("div",{className:"msp-flex-row",children:se},ce))}return(0,e.jsx)("div",{className:"msp-parameter-matrix",children:ve})}render(){const re={json:JSON.stringify(this.props.value)},ve=this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{label:ve,control:(0,e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:"4\xd74 Matrix"})}),this.state.isExpanded&&(0,e.jsxs)("div",{className:"msp-control-offset",children:[this.grid,(0,e.jsx)(R,{params:this.components,values:re,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}}class Re extends Q{constructor(){super(...arguments),this.onChange=re=>{const ve=re.target.value;ve!==A.V.getUrl(this.props.value||"")&&this.update(A.V.Url(ve))},this.onKeyPress=re=>{(13===re.keyCode||13===re.charCode||"Enter"===re.key)&&this.props.onEnter&&this.props.onEnter(),re.stopPropagation()}}renderControl(){const re=this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsx)("input",{type:"text",value:A.V.getUrl(this.props.value||""),placeholder:re,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}}class ke extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFile=re=>{this.change(re.target.files[0])},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:A.V.File(re)})}renderControl(){const re=this.props.value;return(0,e.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[re?re.name:"Select a file..."," ",(0,e.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}}class we extends o.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFileList=re=>{this.change(re.target.files)},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(re){const ve=[];if(re)for(let ce=0,se=re.length;ce<se;++ce)ve.push(A.V.File(re[ce]));this.props.onChange({name:this.props.name,param:this.props.param,value:ve})}renderControl(){const re=this.props.value,ve=[];if(re)for(const se of re)ve.push(se.name);return(0,e.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[0===ve.length?"Select files...":1===ve.length?ve[0]:`${ve.length} files selected`," ",(0,e.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?L({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}}class Oe extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}toggle(re){return ve=>{this.props.value.indexOf(re)<0?this.change(this.props.value.concat(re)):this.change(this.props.value.filter(ce=>ce!==re)),ve.currentTarget.blur()}}render(){const re=this.props.value,ve=this.props.param.emptyValue,ce=this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{label:ce,control:(0,e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:0===re.length&&ve?ve:`${re.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:this.props.param.options.map(([se,ae])=>{const ge=re.indexOf(se)>=0;return(0,e.jsx)(l.$n,{onClick:this.toggle(se),disabled:this.props.isDisabled,style:{marginTop:"1px"},children:(0,e.jsx)("span",{style:{float:ge?"left":"right"},children:ge?`\u2713 ${ae}`:`${ae} \u2717`})},se)})})]})}}class Se extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1},this.onChangeParam=re=>{this.change({...this.props.value,[re.name]:re.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets}),this.presetItems=(0,i._)(re=>{var ve;return M.W.createItemsFromSelectOptions(null!==(ve=re.presets)&&void 0!==ve?ve:[])}),this.onSelectPreset=re=>{this.setState({showPresets:!1}),this.change(re?.value)}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}pivotedPresets(){if(!this.props.param.presets)return null;const re=this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,e.jsx)("div",{className:"msp-control-group-header",children:(0,e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,e.jsx)(m.In,{svg:m.sM}),re," Presets"]})}),this.state.showPresets&&(0,e.jsx)(M.W,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"msp-control-group-presets-wrapper",children:(0,e.jsx)("div",{className:"msp-control-group-header",children:(0,e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,e.jsx)(m.In,{svg:m.sM}),"Presets"]})})}),this.state.showPresets&&(0,e.jsx)(M.W,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){const re=this.props.param.pivot,ve=this.props.param.params,ce=ve[re],se=E(ce),ae=(0,e.jsx)(se,{name:re,param:ce,value:this.props.value[re],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});if(!this.state.isExpanded)return(0,e.jsxs)("div",{className:"msp-mapped-parameter-group",children:[ae,(0,e.jsx)(l.K0,{svg:m.cv,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"})]});const ge=Object.create(null);for(const Ie of Object.keys(ve))Ie!==re&&(ge[Ie]=ve[Ie]);return(0,e.jsxs)("div",{className:"msp-mapped-parameter-group",children:[ae,(0,e.jsx)(l.K0,{svg:m.cv,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"}),(0,e.jsxs)("div",{className:"msp-control-offset",children:[this.pivotedPresets(),(0,e.jsx)(R,{params:ge,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){const re=this.props.param.params;if(0===Object.keys(re).length)return null;if(this.props.param.pivot)return this.pivoted();const ve=this.props.param.label||(0,b.Hh)(this.props.name),ce=(0,e.jsx)(R,{params:re,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.inMapped?(0,e.jsx)("div",{className:"msp-control-offset",children:ce}):this.props.param.isFlat?ce:(0,e.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative"},children:[(0,e.jsx)("div",{className:"msp-control-group-header",children:(0,e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,children:[(0,e.jsx)(m.In,{svg:this.state.isExpanded?m.DM:m.Cp}),ve]})}),this.presets(),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:ce})]})}}class Ve extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.valuesCache={},this.onChangeName=re=>{this.change({name:re.value,params:this.getValues(re.value)})},this.onChangeParam=re=>{this.setValues(this.props.value.name,re.value),this.change({name:this.props.value.name,params:re.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(re,ve){this.valuesCache[re]=ve}getValues(re){return re in this.valuesCache?this.valuesCache[re]:this.props.param.map(re).defaultValue}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}areParamsEmpty(re){for(const ve of Object.keys(re))if(!re[ve].isHidden)return!1;return!0}render(){const re=this.props.value||this.props.param.defaultValue,ve=this.props.param.map(re.name),ce=this.props.param.label||(0,b.Hh)(this.props.name),se=E(ve),ae=this.props.param.help,ge=ae?{...this.props.param.select,help:Le=>ae({name:Le,params:this.getValues(Le)})}:this.props.param.select,Ie=(0,e.jsx)(J,{param:ge,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:ce,value:re.name});return se?"group"!==ve.type||ve.isFlat?(0,e.jsxs)(e.Fragment,{children:[Ie,(0,e.jsx)(se,{param:ve,value:re.params,name:re.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):this.areParamsEmpty(ve.params)?Ie:(0,e.jsxs)("div",{className:"msp-mapped-parameter-group",children:[Ie,(0,e.jsx)(l.K0,{svg:m.cv,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${ce} Properties`}),this.state.isExpanded&&(0,e.jsx)(Se,{inMapped:!0,param:ve,value:re.params,name:re.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):Ie}}class Ne extends o.PureComponent{constructor(){super(...arguments),this.state={current:this.props.value},this.onChangeParam=re=>{this.setState({current:{...this.state.current,[re.name]:re.value}})},this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(re){(this.props.params!==re.params||this.props.value!==re.value)&&this.setState({current:this.props.value})}render(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,e.jsx)("button",{className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?"Update":"Add"})]})}}class K extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.update=re=>{this.props.actions.update(re,this.props.index)},this.moveUp=()=>{this.props.actions.move(this.props.index,-1)},this.moveDown=()=>{this.props.actions.move(this.props.index,1)},this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}render(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"msp-param-object-list-item",children:[(0,e.jsxs)("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded,children:[(0,e.jsx)("span",{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(l.K0,{svg:m.qp,title:"Move Up",onClick:this.moveUp,small:!0}),(0,e.jsx)(l.K0,{svg:m.p8,title:"Move Down",onClick:this.moveDown,small:!0}),(0,e.jsx)(l.K0,{svg:m.mf,title:"Remove",onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,e.jsx)("div",{className:"msp-control-offset",children:(0,e.jsx)(Ne,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}}class ne extends o.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.add=re=>{this.change([...this.props.value,re])},this.actions={update:(re,ve)=>{const ce=this.props.value.slice(0);ce[ve]=re,this.change(ce)},move:(re,ve)=>{let ce=this.props.value;if(1===ce.length)return;let se=(re+ve)%ce.length;se<0&&(se+=ce.length),ce=ce.slice(0);const ae=ce[re];ce[re]=ce[se],ce[se]=ae,this.change(ce)},remove:re=>{const ve=this.props.value,ce=[];for(let se=0;se<ve.length;se++)re!==se&&ce.push(ve[se]);this.change(ce)}},this.toggleExpanded=re=>{this.setState({isExpanded:!this.state.isExpanded}),re.currentTarget.blur()}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}render(){const re=this.props.value,ve=this.props.param.label||(0,b.Hh)(this.props.name);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.eJ,{label:ve,control:(0,e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${re.length} item${1!==re.length?"s":""}`})}),this.state.isExpanded&&(0,e.jsxs)("div",{className:"msp-control-offset",children:[this.props.value.map((se,ae)=>(0,e.jsx)(K,{param:this.props.param,value:se,index:ae,actions:this.actions,isDisabled:this.props.isDisabled},ae)),(0,e.jsx)(l.tW,{header:"New Item",children:(0,e.jsx)(Ne,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}}class be extends o.PureComponent{constructor(){super(...arguments),this.onChangeCondition=re=>{this.change(this.props.param.conditionedValue(this.props.value,re.value))},this.onChangeParam=re=>{this.change(re.value)}}change(re){this.props.onChange({name:this.props.name,param:this.props.param,value:re})}render(){const re=this.props.value,ve=this.props.param.conditionForValue(re),ce=this.props.param.conditionParams[ve],se=this.props.param.label||(0,b.Hh)(this.props.name),ae=E(ce),ge=(0,e.jsx)(J,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${se} Kind`,value:ve});return ae?(0,e.jsxs)(e.Fragment,{children:[ge,(0,e.jsx)(ae,{param:ce,value:re,name:se,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):ge}}class Te extends o.PureComponent{constructor(){super(...arguments),this.onChange=re=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(re.value)})}}render(){const re=this.props.param.fromValue(this.props.value),ve=E(this.props.param.converted);return ve?(0,e.jsx)(ve,{param:this.props.param.converted,value:re,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}}class ie extends o.PureComponent{constructor(){super(...arguments),this.onChange=({name:re,value:ve})=>{ve!==this.props.value[re]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[re]:ve}})}}render(){const re={defaultValue:this.props.value.language,options:O.t.objectToOptions(t.e.Info),type:"select"},ve=(0,e.jsx)(J,{param:re,isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:"language",value:this.props.value.language}),se=(0,e.jsx)(k,{param:{defaultValue:this.props.value.language,type:"text"},isDisabled:this.props.isDisabled,onChange:this.onChange,name:"expression",value:this.props.value.expression});return(0,e.jsxs)(e.Fragment,{children:[ve,"mol-script"!==this.props.value.language&&(0,e.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,e.jsx)(m.In,{svg:m.Rf})," Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended."]}),se]})}}},7788:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ap:()=>A,Mm:()=>y});var e=n(9619),o=n(1395),r=n(3584),t=n(9909);class A extends o.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:0},this.begin=()=>{this.setState({isChanging:!0})},this.end=m=>{this.setState({isChanging:!1}),this.props.onChange(m)},this.updateCurrent=m=>{var u,d;this.setState({current:m}),null===(d=(u=this.props).onChangeImmediate)||void 0===d||d.call(u,m)},this.updateManually=m=>{this.setState({isChanging:!0});let u=m;1===this.props.step&&(u=Math.round(u)),u<this.props.min&&(u=this.props.min),u>this.props.max&&(u=this.props.max),this.setState({current:u,isChanging:!0})},this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)}}static getDerivedStateFromProps(m,u){return u.isChanging||m.value===u.current?null:{current:m.value}}render(){let m=this.props.step;return void 0===m&&(m=1),(0,e.jsxs)("div",{className:"msp-slider",children:[(0,e.jsx)("div",{children:(0,e.jsx)(I,{min:this.props.min,max:this.props.max,step:m,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,e.jsx)("div",{children:(0,e.jsx)(r.ks,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}}class y extends o.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:[0,1]},this.begin=()=>{this.setState({isChanging:!0})},this.end=m=>{this.setState({isChanging:!1}),this.props.onChange(m)},this.updateCurrent=m=>{this.setState({current:m})},this.updateMax=m=>{let u=m;1===this.props.step&&(u=Math.round(u)),u<this.state.current[0]?u=this.state.current[0]:u<this.props.min&&(u=this.props.min),u>this.props.max&&(u=this.props.max),this.props.onChange([this.state.current[0],u])},this.updateMin=m=>{let u=m;1===this.props.step&&(u=Math.round(u)),u<this.props.min&&(u=this.props.min),u>this.state.current[1]?u=this.state.current[1]:u>this.props.max&&(u=this.props.max),this.props.onChange([u,this.state.current[1]])}}static getDerivedStateFromProps(m,u){return u.isChanging||m.value[0]===u.current[0]&&m.value[1]===u.current[1]?null:{current:m.value}}render(){let m=this.props.step;return void 0===m&&(m=1),(0,e.jsxs)("div",{className:"msp-slider2",children:[(0,e.jsx)("div",{children:(0,e.jsx)(r.ks,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,e.jsx)("div",{children:(0,e.jsx)(I,{min:this.props.min,max:this.props.max,step:m,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,e.jsx)("div",{children:(0,e.jsx)(r.ks,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}}function c(l){const m=[],u={}.hasOwnProperty;for(let d=0;d<arguments.length;d++){const s=arguments[d];if(!s)continue;const C=typeof s;if("string"===C||"number"===C)m.push(s);else if(Array.isArray(s))m.push(c.apply(null,s));else if("object"===C)for(const h in s)u.call(s,h)&&s[h]&&m.push(h)}return m.join(" ")}function i(l){return l.touches.length>1||"touchend"===l.type.toLowerCase()&&l.touches.length>0}function v(l,m){return l?m.touches[0].clientY:m.touches[0].pageX}function O(l,m){return l?m.clientY:m.pageX}function b(l,m){const u=m.getBoundingClientRect();return l?u.top+.5*u.height:u.left+.5*u.width}function _(l){l.stopPropagation(),l.preventDefault()}class I extends o.Component{constructor(m){super(m),this.sliderElement=o.createRef(),this.handleElements=[],this.dragOffset=0,this.startPosition=0,this.startValue=0,this._getPointsCache=void 0,this.onMouseDown=R=>{if(0!==R.button)return;let f=O(this.props.vertical,R);if(this.isEventFromHandle(R)){const p=b(this.props.vertical,R.target);this.dragOffset=f-p,f=p}else this.dragOffset=0;this.onStart(f),this.addDocumentEvents("mouse"),_(R)},this.onTouchMove=R=>{if(i(R))return void this.end("touch");const f=v(this.props.vertical,R);this.onMove(R,f-this.dragOffset)},this.onTouchStart=R=>{if(i(R))return;let f=v(this.props.vertical,R);if(this.isEventFromHandle(R)){const p=b(this.props.vertical,R.target);this.dragOffset=f-p,f=p}else this.dragOffset=0;this.onStart(f),this.addDocumentEvents("touch"),_(R)},this.eventHandlers={touchmove:R=>this.onTouchMove(R),touchend:R=>this.end("touch"),mousemove:R=>this.onMouseMove(R),mouseup:R=>this.end("mouse")},this.calcOffset=R=>{const{min:f,max:p}=this.props;return(R-f)/(p-f)*100};const{range:u,min:d,max:s}=m,C=u?Array.apply(null,Array(+u+1)).map(()=>d):d,a=void 0!==m.value?m.value:"defaultValue"in m?m.defaultValue:C,S=(u?a:[d,a]).map(R=>this.trimAlignValue(R));let D;D=u&&S[0]===S[S.length-1]&&S[0]===s?0:S.length-1,this.state={handle:null,recent:D,bounds:S}}componentDidUpdate(m){if(!("value"in this.props||"min"in this.props||"max"in this.props))return;const{bounds:u}=this.state;if(m.range){const s=(this.props.value||u).map(C=>this.trimAlignValue(C,this.props));if(s.every((C,h)=>C===u[h]))return;this.setState({bounds:s}),u.some(C=>this.isValueOutOfBounds(C,this.props))&&this.props.onChange(s)}else{const s=this.trimAlignValue(void 0!==this.props.value?this.props.value:u[1],this.props);if(s===u[1]&&u[0]===m.min)return;this.setState({bounds:[m.min,s]}),this.isValueOutOfBounds(u[1],this.props)&&this.props.onChange(s)}}onChange(m){const u=this.props;"value"in u?void 0!==m.handle&&this.setState({handle:m.handle}):this.setState(m);const s={...this.state,...m};u.onChange(u.range?s.bounds:s.bounds[1])}onMouseMove(m){const u=O(this.props.vertical,m);this.onMove(m,u-this.dragOffset)}onMove(m,u){_(m);const d=this.props,s=this.state;let C=u-this.startPosition;C=this.props.vertical?-C:C;const h=C/this.getSliderLength()*(d.max-d.min),a=this.trimAlignValue(this.startValue+h);if(a===s.bounds[s.handle])return;const D=[...s.bounds];D[s.handle]=a;let R=s.handle;d.pushable?this.pushSurroundingHandles(D,R,s.bounds[R]):d.allowCross&&(D.sort((f,p)=>f-p),R=D.indexOf(a)),this.onChange({handle:R,bounds:D})}onStart(m){this.props.onBeforeChange(this.getValue());const d=this.calcValueByPos(m);this.startValue=d,this.startPosition=m;const s=this.state,{bounds:C}=s;let h=1;if(this.props.range){let D=0;for(let f=1;f<C.length-1;++f)d>C[f]&&(D=f);Math.abs(C[D+1]-d)<Math.abs(C[D]-d)&&(D+=1),h=D;const R=C[D+1]===C[D];R&&(h=s.recent),R&&d!==C[D+1]&&(h=d<C[D+1]?D:D+1)}if(this.setState({handle:h,recent:h}),d===s.bounds[h])return;const S=[...s.bounds];S[h]=d,this.onChange({bounds:S})}getPoints(){const{marks:m,step:u,min:d,max:s}=this.props,C=this._getPointsCache;if(!C||C.marks!==m||C.step!==u){const h={...m};if(null!==u)for(let S=d;S<=s;S+=u)h[S]=S;const a=Object.keys(h).map(parseFloat);a.sort((S,D)=>S-D),this._getPointsCache={marks:m,step:u,points:a}}return this._getPointsCache.points}getPrecision(m){const u=m.toString();let d=0;return u.indexOf(".")>=0&&(d=u.length-u.indexOf(".")-1),d}getSliderLength(){const m=this.sliderElement.current;return m?this.props.vertical?m.clientHeight:m.clientWidth:0}getSliderStart(){const u=this.sliderElement.current.getBoundingClientRect();return this.props.vertical?u.top:u.left}getValue(){const{bounds:m}=this.state;return this.props.range?m:m[1]}addDocumentEvents(m){"touch"===m?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):"mouse"===m&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))}calcValue(m){const{vertical:u,min:d,max:s}=this.props,C=Math.abs(m/this.getSliderLength());return u?(1-C)*(s-d)+d:C*(s-d)+d}calcValueByPos(m){const u=m-this.getSliderStart();return this.trimAlignValue(this.calcValue(u))}end(m){this.removeEvents(m),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(m){for(const u of this.handleElements)if(u.current===m.target)return!0;return!1}isValueOutOfBounds(m,u){return m<u.min||m>u.max}pushHandle(m,u,d,s){const C=m[u];let h=m[u];for(;d*(h-C)<s;){if(!this.pushHandleOnePoint(m,u,d))return m[u]=C,!1;h=m[u]}return!0}pushHandleOnePoint(m,u,d){const s=this.getPoints(),h=s.indexOf(m[u])+d;if(h>=s.length||h<0)return!1;const a=u+d,S=s[h],{pushable:D}=this.props;return!!this.pushHandle(m,a,d,+D-d*(m[a]-S))&&(m[u]=S,!0)}pushSurroundingHandles(m,u,d){const{pushable:s}=this.props,C=m[u];let h=0;if(m[u+1]-C<+s?h=1:C-m[u-1]<+s&&(h=-1),0===h)return;const a=u+h;this.pushHandle(m,a,h,+s-h*(m[a]-C))||(m[u]=d)}removeEvents(m){"touch"===m?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):"mouse"===m&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))}trimAlignValue(m,u){const{handle:d,bounds:s}=this.state||{},{marks:C,step:h,min:a,max:S,allowCross:D}={...this.props,...u||{}};let R=m;R<=a&&(R=a),R>=S&&(R=S),!D&&null!=d&&d>0&&R<=s[d-1]&&(R=s[d-1]),!D&&null!=d&&d<s.length-1&&R>=s[d+1]&&(R=s[d+1]);const f=Object.keys(C).map(parseFloat);if(null!==h){const T=Math.round((R-a)/h)*h+a;f.push(T)}const p=f.map(T=>Math.abs(R-T)),E=f[p.indexOf(Math.min.apply(Math,p))];return null!==h?parseFloat(E.toFixed(this.getPrecision(h))):E}render(){const{handle:m,bounds:u}=this.state,{className:d,prefixCls:s,disabled:C,vertical:h,range:a,step:S,marks:D,tipFormatter:R}=this.props,f=this.props.handle,p=u.map(this.calcOffset),E=`${s}-handle`,T=u.map((V,U)=>c({[E]:!0,[`${E}-${U+1}`]:!0,[`${E}-lower`]:0===U,[`${E}-upper`]:U===u.length-1})),w={prefixCls:s,noTip:null===S||null===R,tipFormatter:R,vertical:h};if(this.handleElements.length!==u.length){this.handleElements=[];for(let V=0;V<u.length;V++)this.handleElements.push(o.createRef())}const Q=u.map((V,U)=>o.cloneElement(f,{...w,className:T[U],value:V,offset:p[U],dragging:m===U,index:U,key:U,ref:this.handleElements[U]}));a||Q.shift();const G=c({[s]:!0,[`${s}-with-marks`]:Object.keys(D).length,[`${s}-disabled`]:C,[`${s}-vertical`]:this.props.vertical,[d]:!!d});return(0,e.jsxs)("div",{ref:this.sliderElement,className:G,onTouchStart:C?t.lQ:this.onTouchStart,onMouseDown:C?t.lQ:this.onMouseDown,children:[(0,e.jsx)("div",{className:`${s}-rail`}),Q]})}}I.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:(0,e.jsx)(class M extends o.Component{render(){const{className:m,tipFormatter:u,vertical:d,offset:s,value:C,index:h}=this.props;return(0,e.jsx)("div",{className:m,style:d?{bottom:`${s}%`}:{left:`${s}%`},title:u(C,h)})}},{className:"",vertical:!1,offset:0,tipFormatter:l=>l,value:0,index:0}),onBeforeChange:t.lQ,onChange:t.lQ,onAfterChange:t.lQ,tipFormatter:(l,m)=>l,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1}},4987:(tn,Ue,n)=>{"use strict";n.d(Ue,{U0:()=>dr,AF:()=>y.A,Zw:()=>xr});var e={};n.r(e),n.d(e,{SyncRepresentationToCanvas:()=>O,SyncStructureRepresentation3DState:()=>b,UpdateRepresentationVisibility:()=>_,registerDefault:()=>v});var o={};n.r(o),n.d(o,{Focus:()=>d,OrientAxes:()=>s,Reset:()=>m,ResetAxes:()=>C,SetSnapshot:()=>u,registerDefault:()=>l});var r={};n.r(r),n.d(r,{Canvas3DSetSettings:()=>S,registerDefault:()=>a});var t={};n.r(t),n.d(t,{CameraAxisHelper:()=>J,CameraControls:()=>de,DefaultClickResetCameraOnEmpty:()=>U,DefaultClickResetCameraOnEmptySelectMode:()=>N,DefaultFocusLociBindings:()=>k,FocusLoci:()=>$});var A={};n.r(A),n.d(A,{AccessibleSurfaceArea:()=>Me,BestDatabaseSequenceMapping:()=>kt,CrossLinkRestraint:()=>Nn,Interactions:()=>rn,SecondaryStructure:()=>Mt,StructureInfo:()=>Z,ValenceModel:()=>Dn});var y=n(1164),c=n(1827),i=n(381);function v(Ft){O(Ft),b(Ft),_(Ft)}function O(Ft){const Qt=Ft.state.data.events;Qt.object.created.subscribe(ht=>{var pt;i.O.isRepresentation3D(ht.obj)&&(M(ht.state.cells.get(ht.ref),ht.obj.data.repr),ht.obj.data.repr.setState({syncManually:!0}),null===(pt=Ft.canvas3d)||void 0===pt||pt.add(ht.obj.data.repr))}),Qt.object.updated.subscribe(ht=>{var pt,Xt;ht.oldObj&&i.O.isRepresentation3D(ht.oldObj)&&(null===(pt=Ft.canvas3d)||void 0===pt||pt.remove(ht.oldObj.data.repr),ht.oldObj.data.repr.destroy()),i.O.isRepresentation3D(ht.obj)&&(M(ht.state.cells.get(ht.ref),ht.obj.data.repr),"recreate"===ht.action&&ht.obj.data.repr.setState({syncManually:!0}),null===(Xt=Ft.canvas3d)||void 0===Xt||Xt.add(ht.obj.data.repr))}),Qt.object.removed.subscribe(ht=>{var pt;i.O.isRepresentation3D(ht.obj)&&(null===(pt=Ft.canvas3d)||void 0===pt||pt.remove(ht.obj.data.repr),ht.obj.data.repr.destroy())})}function b(Ft){const Qt=Ft.state.data.events;Qt.object.created.subscribe(ht=>{var pt;if(!i.O.Molecule.Structure.Representation3DState.is(ht.obj))return;const Xt=ht.obj.data;Xt.repr.setState(Xt.state),null===(pt=Ft.canvas3d)||void 0===pt||pt.update(Xt.repr)}),Qt.object.updated.subscribe(ht=>{var pt;if(!i.O.Molecule.Structure.Representation3DState.is(ht.obj))return;const Xt=ht.obj.data;Xt.repr.setState(Xt.state),null===(pt=Ft.canvas3d)||void 0===pt||pt.update(Xt.repr)}),Qt.object.removed.subscribe(ht=>{var pt;if(!i.O.Molecule.Structure.Representation3DState.is(ht.obj))return;const Xt=ht.obj.data;Xt.repr.setState(Xt.initialState),null===(pt=Ft.canvas3d)||void 0===pt||pt.update(Xt.repr)})}function _(Ft){Ft.state.data.events.cell.stateUpdated.subscribe(Qt=>{var ht;const pt=Qt.state.cells.get(Qt.ref);i.O.isRepresentation3D(pt.obj)&&M(pt,pt.obj.data.repr)&&(null===(ht=Ft.canvas3d)||void 0===ht||ht.syncVisibility())})}function M(Ft,Qt){return Qt.state.visible===!!Ft.state.isHidden&&(Qt.setState({visible:!Ft.state.isHidden}),!0)}var I=n(6763);function l(Ft){m(Ft),d(Ft),u(Ft),s(Ft),C(Ft)}function m(Ft){I.a.Camera.Reset.subscribe(Ft,Qt=>{Ft.managers.camera.reset(Qt?.snapshot,Qt?.durationMs)})}function u(Ft){I.a.Camera.SetSnapshot.subscribe(Ft,({snapshot:Qt,durationMs:ht})=>{Ft.managers.camera.setSnapshot(Qt,ht)})}function d(Ft){I.a.Camera.Focus.subscribe(Ft,({center:Qt,radius:ht,durationMs:pt})=>{Ft.managers.camera.focusSphere({center:Qt,radius:ht},{durationMs:pt}),Ft.events.canvas3d.settingsUpdated.next(void 0)})}function s(Ft){I.a.Camera.OrientAxes.subscribe(Ft,({structures:Qt,durationMs:ht})=>{Ft.managers.camera.orientAxes(Qt,ht)})}function C(Ft){I.a.Camera.ResetAxes.subscribe(Ft,({durationMs:Qt})=>{Ft.managers.camera.resetAxes(Qt)})}var h=n(3177);function a(Ft){S(Ft)}function S(Ft){I.a.Canvas3D.ResetSettings.subscribe(Ft,()=>{var Qt;null===(Qt=Ft.canvas3d)||void 0===Qt||Qt.setProps(h.FN),Ft.events.canvas3d.settingsUpdated.next(void 0)}),I.a.Canvas3D.SetSettings.subscribe(Ft,Qt=>{var ht;Ft.canvas3d&&(null===(ht=Ft.canvas3d)||void 0===ht||ht.setProps(Qt.settings),Ft.events.canvas3d.settingsUpdated.next(void 0))})}var D=n(1937),R=n(3246),f=n(8277),p=n(4080),E=n(4123),T=n(7028),L=n(4369);const w=p.qt,Q=p.Fs,G=E.O.Trigger,V=E.O.TriggerKey,U=(0,E.O)([G(w.Flag.Primary,Q.create()),G(w.Flag.Secondary,Q.create()),G(w.Flag.Primary,Q.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),N=(0,E.O)([G(w.Flag.Secondary,Q.create()),G(w.Flag.Primary,Q.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),k={clickCenterFocus:(0,E.O)([G(w.Flag.Primary,Q.create()),G(w.Flag.Secondary,Q.create()),G(w.Flag.Primary,Q.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:(0,E.O)([G(w.Flag.Secondary,Q.create()),G(w.Flag.Primary,Q.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickResetCameraOnEmpty:U,clickResetCameraOnEmptySelectMode:N},H={minRadius:f.t.Numeric(8,{min:1,max:50,step:1}),extraRadius:f.t.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:f.t.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:f.t.Value(k,{isHidden:!0})},$=y.A.create({name:"camera-focus-loci",category:"interaction",ctor:class extends y.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:Ft,button:Qt,modifiers:ht})=>{var pt,Xt;if(!this.ctx.canvas3d)return;const fn=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,on=this.ctx.selectionMode?null!==(pt=this.params.bindings.clickResetCameraOnEmptySelectMode)&&void 0!==pt?pt:N:null!==(Xt=this.params.bindings.clickResetCameraOnEmpty)&&void 0!==Xt?Xt:U;if(R.QN.isEmpty(Ft.loci)&&E.O.match(on,Qt,ht))I.a.Camera.Reset(this.ctx,{});else if(E.O.match(fn,Qt,ht)){const En=R.QN.normalize(Ft.loci,this.ctx.managers.interactivity.props.granularity);this.ctx.managers.camera.focusLoci(En,this.params)}})}},params:()=>H,display:{name:"Camera Focus Loci on Canvas"}}),J=y.A.create({name:"camera-axis-helper",category:"interaction",ctor:class extends y.A.Handler{register(){let Ft=T.Nz.None,Qt=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:ht})=>{if(!this.ctx.canvas3d||!(0,T.E2)(ht.loci))return;const pt=ht.loci.elements[0].groupId;if(pt===T.Nz.None)return Ft=T.Nz.None,void(Qt=0);const{camera:Xt}=this.ctx.canvas3d;let fn,on;if(pt>=T.Nz.X&&pt<=T.Nz.Z){Ft=T.Nz.None,Qt=0;const En=L.eB.sub((0,L.eB)(),Xt.target,Xt.position),Tt=L.eB.cross((0,L.eB)(),En,Xt.up);on=(0,L.eB)(),on[pt-1]=1,fn=L.eB.cross((0,L.eB)(),on,Tt),0===L.eB.magnitude(fn)&&(fn=En)}else Ft===pt?Qt=(Qt+1)%2:(Ft=pt,Qt=0),pt===T.Nz.XY?(on=Qt?L.eB.unitX:L.eB.unitY,fn=L.eB.negUnitZ):pt===T.Nz.XZ?(on=Qt?L.eB.unitX:L.eB.unitZ,fn=L.eB.negUnitY):(on=Qt?L.eB.unitY:L.eB.unitZ,fn=L.eB.negUnitX);this.ctx.canvas3d.requestCameraReset({snapshot:(En,Tt)=>Tt.getInvariantFocus(En.boundingSphereVisible.center,En.boundingSphereVisible.radius,on,fn)})})}},params:()=>({}),display:{name:"Camera Axis Helper"}}),W={keySpinAnimation:(0,E.O)([V("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:(0,E.O)([V("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:(0,E.O)([V("Space",Q.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:(0,E.O)([V("T")],"Reset View","Press ${triggers}")},te={bindings:f.t.Value(W,{isHidden:!0})},de=y.A.create({name:"camera-controls",category:"interaction",ctor:class extends y.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:Ft,key:Qt,modifiers:ht})=>{var pt;if(!this.ctx.canvas3d)return;const Xt={...W,...this.params.bindings},fn=this.ctx.canvas3d.props.trackball;if(E.O.matchKey(Xt.keySpinAnimation,Ft,ht,Qt)){const on="spin"!==fn.animate.name?"spin":"off";this.ctx.canvas3d.setProps("off"===on?{trackball:{animate:{name:on,params:{}}}}:{trackball:{animate:{name:on,params:{speed:1}}}})}if(E.O.matchKey(Xt.keyRockAnimation,Ft,ht,Qt)){const on="rock"!==fn.animate.name?"rock":"off";this.ctx.canvas3d.setProps("off"===on?{trackball:{animate:{name:on,params:{}}}}:{trackball:{animate:{name:on,params:{speed:.3,angle:10}}}})}if(E.O.matchKey(Xt.keyToggleFlyMode,Ft,ht,Qt)){const on=!fn.flyMode;this.ctx.canvas3d.setProps({trackball:{flyMode:on}}),null!==(pt=this.ctx.canvas3dContext)&&void 0!==pt&&pt.canvas&&(this.ctx.canvas3dContext.canvas.style.cursor=on?"crosshair":"unset")}E.O.matchKey(Xt.keyResetView,Ft,ht,Qt)&&I.a.Camera.Reset(this.ctx,{})})}},params:()=>te,display:{name:"Camera Controls on Canvas"}});var ye=n(9136),j=n(1832);const Z=y.A.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:class extends y.A.Handler{get maxModelIndex(){var Ft,Qt;let ht=-1;const pt=this.ctx.state.data.select(j.QX.Generators.rootsOfType(i.O.Molecule.Model));for(const Xt of pt){const fn=(null===(Ft=Xt.obj)||void 0===Ft?void 0:Ft.data)&&ye.Kx.Index.get(null===(Qt=Xt.obj)||void 0===Qt?void 0:Qt.data).value;void 0!==fn&&fn>ht&&(ht=fn)}return ht}get maxStructureIndex(){var Ft,Qt;let ht=-1;const pt=this.ctx.state.data.select(j.QX.Generators.rootsOfType(i.O.Molecule.Structure));for(const Xt of pt){const fn=(null===(Ft=Xt.obj)||void 0===Ft?void 0:Ft.data)&&ye.oE.Index.get(null===(Qt=Xt.obj)||void 0===Qt?void 0:Qt.data).value;void 0!==fn&&fn>ht&&(ht=fn)}return ht}get asymIdOffset(){var Ft;let Qt=0,ht=0;const pt=this.ctx.state.data.select(j.QX.Generators.rootsOfType(i.O.Molecule.Model));for(const Xt of pt){const fn=null===(Ft=Xt.obj)||void 0===Ft?void 0:Ft.data;if(fn){const on=ye.Kx.AsymIdCount.get(fn),En=ye.Kx.AsymIdOffset.get(fn).value;void 0!==on&&void 0!==En&&(Qt=Math.max(Qt,En.auth+on.auth),ht=Math.max(ht,En.label+on.label))}}return{auth:Qt,label:ht}}setModelMaxIndex(){var Ft;const Qt=this.maxModelIndex,ht=this.ctx.state.data.select(j.QX.Generators.rootsOfType(i.O.Molecule.Model));for(const pt of ht){const Xt=null===(Ft=pt.obj)||void 0===Ft?void 0:Ft.data;Xt&&ye.Kx.MaxIndex.get(Xt).value!==Qt&&ye.Kx.MaxIndex.set(Xt,{value:Qt},Qt)}}setStructureMaxIndex(){var Ft;const Qt=this.maxModelIndex,ht=this.ctx.state.data.select(j.QX.Generators.rootsOfType(i.O.Molecule.Structure));for(const pt of ht){const Xt=null===(Ft=pt.obj)||void 0===Ft?void 0:Ft.data;Xt&&ye.oE.MaxIndex.get(Xt).value!==Qt&&ye.oE.MaxIndex.set(Xt,{value:Qt},Qt)}}handleModel(Ft,Qt){if(void 0===ye.Kx.Index.get(Ft).value){const pt=(Qt&&ye.Kx.Index.get(Qt).value)??this.maxModelIndex+1;ye.Kx.Index.set(Ft,{value:pt},pt)}if(void 0===ye.Kx.AsymIdOffset.get(Ft).value){const pt=(Qt&&ye.Kx.AsymIdOffset.get(Qt).value)??{...this.asymIdOffset};ye.Kx.AsymIdOffset.set(Ft,{value:pt},pt)}}handleStructure(Ft,Qt){if(void 0!==Ft.parent||void 0!==ye.oE.Index.get(Ft).value)return;const pt=(Qt&&ye.oE.Index.get(Qt).value)??this.maxStructureIndex+1;ye.oE.Index.set(Ft,{value:pt},pt)}handle(Ft,Qt,ht){i.O.Molecule.Structure.is(Qt)?!this.ctx.state.data.tree.transforms.get(Ft).transformer.definition.isDecorator&&void 0===Qt.data.parent&&this.handleStructure(Qt.data,ht?.data):i.O.Molecule.Model.is(Qt)&&(this.ctx.state.data.tree.transforms.get(Ft).transformer.definition.isDecorator||this.handleModel(Qt.data,ht?.data))}register(){this.ctx.customModelProperties.register(ye.Kx.AsymIdOffset,!0),this.ctx.customModelProperties.register(ye.Kx.Index,!0),this.ctx.customModelProperties.register(ye.Kx.MaxIndex,!0),this.ctx.customStructureProperties.register(ye.oE.Index,!0),this.ctx.customStructureProperties.register(ye.oE.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,Ft=>{this.handle(Ft.ref,Ft.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,Ft=>{this.handle(Ft.ref,Ft.obj,Ft.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(ye.Kx.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(ye.Kx.Index.descriptor.name),this.ctx.customModelProperties.unregister(ye.Kx.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(ye.oE.Index.descriptor.name),this.ctx.customStructureProperties.unregister(ye.oE.MaxIndex.descriptor.name)}}});var q=n(467),Y=n(4824);const ee=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],g={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165};var xe=n(6066),le=n(2434),Ae=n(2008),Be=n(8672),Ce=n(2789);function ke(Ft,Qt,ht){switch(Qt){case"O":return 5;case"S":return 6;case"N":return"NZ"===Ft?4:3;case"C":switch(Ft){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(ht){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return"CD"===Ft?1:2}}}return Oe(Qt)}function we(Ft,Qt,ht){switch(Qt){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return Oe(Qt)}function Oe(Ft){const Qt=(0,Ae.sO)(Ft);let ht=ee.indexOf(Qt);return-1===ht&&(ht=ee.length,ee[ht]=Qt),ht}function Ne(){return(Ne=(0,q.A)(function*(Ft,Qt){const{atomRadiusType:ht}=Qt;for(let pt=0;pt<ht.length;pt+=5e3)Ft.shouldUpdate&&(yield Ft.update({message:"Computing per residue surface accessibility...",current:pt,max:ht.length})),K(Qt,pt,Math.min(pt+5e3,ht.length))})).apply(this,arguments)}function K(Ft,Qt,ht){const{structure:pt,atomRadiusType:Xt,serialResidueIndex:fn,area:on,spherePoints:En,scalingConstant:Tt,maxLookupRadius:Fe,probeSize:He}=Ft,{lookup3d:Ye,serialMapping:ot,unitIndexMap:rt,units:St}=pt,{cumulativeUnitElementCount:vt,elementIndices:mn,unitIndices:zt}=ot;for(let an=Qt;an<ht;++an){const Vn=ee[Xt[an]];if(Vn===ee[0])continue;const Fn=St[zt[an]],rr=mn[an],Vr=Fn.conformation.x(rr),tr=Fn.conformation.y(rr),Tr=Fn.conformation.z(rr),{count:oo,units:Gr,indices:Ao,squaredDistances:yo}=Ye.find(Vr,tr,Tr,Fe),vo=He+Vn,Kr=He+vo,Do=[];for(let So=0;So<oo;++So){const ao=Gr[So],Po=vt[rt.get(ao.id)]+Ao[So],jr=ee[Xt[Po]];if(Fn===ao&&rr===mn[Po]||jr===ee[0])continue;const Co=He+jr;if(yo[So]<(Kr+jr)*(Kr+jr)){const Eo=mn[Po];Do[Do.length]=[yo[So],(yo[So]+vo*vo-Co*Co)/(2*vo),ao.conformation.x(Eo)-Vr,ao.conformation.y(Eo)-tr,ao.conformation.z(Eo)-Tr]}}Do.sort((So,ao)=>So[0]-ao[0]);let lo=0;e:for(let So=0;So<En.length;++So){const[ao,Po,Yr]=En[So];for(let jr=0;jr<Do.length;++jr){const[,Co,Eo,Fo,ei]=Do[jr];if(ao*Eo+Po*Fo+Yr*ei>Co)continue e}++lo}on[fn[an]]+=Tt*lo*vo*vo}}var ne=n(3543);const be={numberOfSpherePoints:f.t.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:f.t.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:f.t.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:f.t.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};var Te;!function(Ft){function pt(){return pt=(0,q.A)(function*(He,Ye,ot){const rt=function Xt(He,Ye){const{elementCount:ot,atomicResidueCount:rt}=He,{probeSize:St,nonPolymer:vt,traceOnly:mn,numberOfSpherePoints:zt}=Ye;return{structure:He,probeSize:St,nonPolymer:vt,traceOnly:mn,spherePoints:fn(zt),scalingConstant:4*Math.PI/zt,maxLookupRadius:2*Ye.probeSize+2*ee[2],atomRadiusType:new Int8Array(ot),serialResidueIndex:new Int32Array(ot),area:new Float32Array(rt)}}(Ye,ot);(function Re(Ft){const{key:Qt}=Be.StructureProperties.residue,{type_symbol:ht,label_atom_id:pt,label_comp_id:Xt}=Be.StructureProperties.atom,{structure:fn,atomRadiusType:on,serialResidueIndex:En}=Ft,Tt=Be.iZ.Location.create(fn);let Fe=0,He=0,Ye=-1;Tt.structure=fn;for(let ot=0,rt=0,St=fn.units.length;ot<St;++ot){const vt=fn.units[ot],{elements:mn}=vt;Tt.unit=vt,Fe=-1;for(let zt=0,an=mn.length;zt<an;++zt){const Vn=mn[zt],Fn=rt+zt;Tt.element=Vn,He=Qt(Tt),Fe!==He&&++Ye,Fe=He;const rr=ht(Tt),Vr=(0,xe.Yd)(rr);if((0,xe.v3)(Vr)){on[Fn]=0,En[Fn]=-1;continue}const tr=pt(Tt),Tr=(0,Ce.Ju)(vt,Vn);if(2===Tr||!Ft.nonPolymer&&!(0,le.z7)(Tr)){on[Fn]=0,En[Fn]=-1;continue}const oo=Xt(Tt);!Ft.traceOnly||("CA"===tr||"BB"===tr)&&g[oo]?(on[Fn]=(0,le.OV)(Tr)?we(0,rr):5===Tr?ke(tr,rr,oo):Oe(rr),En[Fn]=Ye):(on[Fn]=0,En[Fn]=Ye)}rt+=mn.length}})(rt),yield function Ve(Ft,Qt){return Ne.apply(this,arguments)}(He,rt);const{area:St,serialResidueIndex:vt}=rt;return{area:St,serialResidueIndex:vt}}),pt.apply(this,arguments)}function fn(He){const Ye=[],ot=Math.PI*(3-Math.sqrt(5)),rt=2/He;for(let St=0;St<He;++St){const vt=St*rt-1+rt/2,mn=Math.sqrt(1-vt*vt),zt=St*ot;Ye[Ye.length]=L.eB.create(Math.cos(zt)*mn,vt,Math.sin(zt)*mn)}return Ye}function on(He,Ye){return Ye/(g[He]||121)}function En(He,Ye){const{area:ot,serialResidueIndex:rt}=Ye,St=rt[ne.SortedArray.indexOf(ne.SortedArray.ofSortedArray(He.structure.root.serialMapping.elementIndices),He.element)];return-1===St?-1:ot[St]}function Tt(He,Ye){const ot=En(He,Ye);return-1===ot?-1:on(ye.StructureProperties.atom.label_comp_id(He),ot)}Ft.compute=function Qt(He,Ye={}){const ot={...f.t.getDefaultValues(be),...Ye};return Y.YZ.create("Compute Accessible Surface Area",function(){var rt=(0,q.A)(function*(St){return yield function ht(He,Ye,ot){return pt.apply(this,arguments)}(St,He,ot)});return function(St){return rt.apply(this,arguments)}}())},Ft.Flag={NA:0,Buried:1,Accessible:2},Ft.normalize=on,Ft.getValue=En,Ft.getNormalizedValue=Tt,Ft.getFlag=function Fe(He,Ye){const ot=Tt(He,Ye);return-1===ot?0:ot<.16?1:2}}(Te||(Te={}));var ie=n(5439),ue=n(7291),re=n(3170),ve=n(6430),ce=n(1692);const se={...be},ae={isBuried:ue.Bg.Dynamic((0,re.vy)("computed","accessible-surface-area.is-buried",ve.Z.Bool),Ft=>{if(!ye.Nf.isAtomic(Ft.element.unit))return!1;const Qt=ge.get(Ft.element.structure).value;return!!Qt&&1===Te.getFlag(Ft.element,Qt)}),isAccessible:ue.Bg.Dynamic((0,re.vy)("computed","accessible-surface-area.is-accessible",ve.Z.Bool),Ft=>{if(!ye.Nf.isAtomic(Ft.element.unit))return!1;const Qt=ge.get(Ft.element.structure).value;return!!Qt&&2===Te.getFlag(Ft.element,Qt)})},ge=ie.S.createProvider({label:"Accessible Surface Area",descriptor:(0,ce.e)({name:"molstar_accessible_surface_area",symbols:ae}),type:"root",defaultParams:se,getParams:Ft=>se,isApplicable:Ft=>!0,obtain:(Ft=(0,q.A)(function*(Qt,ht,pt){const Xt={...f.t.getDefaultValues(se),...pt};return{value:yield Te.compute(ht,Xt).runInContext(Qt.runtime)}}),function(ht,pt,Xt){return Ft.apply(this,arguments)})});var Ft,Ie=n(190),Le=n(274),nt=n(8382);const je=(0,Ie.Q1)(16448250),Je={list:f.t.ColorList("rainbow",{presetKind:"scale"})},pn={name:"accessible-surface-area",label:"Accessible Surface Area",category:Le.J.Category.Residue,factory:function Bt(Ft,Qt){let ht;const pt=Ie.wC.create({listOrName:Qt.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),Xt=Ft.structure&&ge.get(Ft.structure),fn=Xt?(0,nt.vb)(Xt.id,Xt.version):-1;if(Xt?.value&&Ft.structure){const on=ye.iZ.Location.create(Ft.structure),En=Xt.value,Tt=Fe=>{const He=Te.getNormalizedValue(Fe,En);return-1===He?je:pt.color(He)};ht=Fe=>ye.iZ.Location.is(Fe)&&ye.Nf.isAtomic(Fe.unit)?Tt(Fe):ye.gn.isLocation(Fe)?(on.unit=Fe.aUnit,on.element=Fe.aUnit.elements[Fe.aIndex],Tt(on)):je}else ht=()=>je;return{factory:Bt,granularity:"group",preferSmoothing:!0,color:ht,props:Qt,contextHash:fn,description:"Assigns a color based on the relative accessible surface area of a residue.",legend:pt?pt.legend:void 0}},getParams:function en(Ft){return Je},defaultValues:f.t.getDefaultValues(Je),isApplicable:Ft=>!!Ft.structure,ensureCustomProperties:{attach:(Ft,Qt)=>Qt.structure?ge.attach(Ft,Qt.structure,void 0,!0):Promise.resolve(),detach:Ft=>Ft.structure&&ge.ref(Ft.structure,!1)}};var $e=n(6115),mt=n(9096),_t=n(9767);const Me=y.A.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:class extends y.A.Handler{constructor(){super(...arguments),this.provider=ge,this.labelProvider={label:Ft=>{if(this.params.showTooltip)return function Ke(Ft){if("element-loci"===Ft.kind){if(0===Ft.elements.length)return;const Qt=ge.get(Ft.structure).value;if(!Qt||Ft.structure.customPropertyDescriptors.hasReference(ge.descriptor))return;const{getSerialIndex:ht}=Ft.structure.root.serialMapping,{area:pt,serialResidueIndex:Xt}=Qt,fn=new Set;let on=0;for(const{indices:Tt,unit:Fe}of Ft.elements){const{elements:He}=Fe;ne.CD.forEach(Tt,Ye=>{const ot=Xt[ht(Fe,He[Ye])];-1!==ot&&!fn.has(ot)&&(on+=pt[ot],fn.add(ot))})}return 0===fn.size?void 0:`Accessible Surface Area <small>(${fn.size} ${fn.size>1?"Residues sum":"Residue"})</small>: ${on.toFixed(2)} \u212b<sup>2</sup>`}if("structure-loci"===Ft.kind){const Qt=ge.get(Ft.structure).value;return!Qt||Ft.structure.customPropertyDescriptors.hasReference(ge.descriptor)?void 0:`Accessible Surface Area <small>(Whole Structure)</small>: ${(0,$e.jJ)(Qt.area).toFixed(2)} \u212b<sup>2</sup>`}}(Ft)}}}update(Ft){const Qt=this.params.autoAttach!==Ft.autoAttach||this.params.showTooltip!==Ft.showTooltip;return this.params.autoAttach=Ft.autoAttach,this.params.showTooltip=Ft.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),Qt}register(){ue.oY.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(pn),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(ut),this.ctx.query.structure.registry.add(Kt)}unregister(){ue.oY.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(pn),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(ut),this.ctx.query.structure.registry.remove(Kt)}},params:()=>({autoAttach:f.t.Boolean(!1),showTooltip:f.t.Boolean(!0)})}),ut=(0,mt.ET)("Buried Protein Residues",_t.J.struct.modifier.union([_t.J.struct.modifier.wholeResidues([_t.J.struct.modifier.union([_t.J.struct.generator.atomGroups({"chain-test":_t.J.core.rel.eq([_t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":ae.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:mt.g7.Residue,ensureCustomProperties:(Ft,Qt)=>ge.attach(Ft,Qt)}),Kt=(0,mt.ET)("Accessible Protein Residues",_t.J.struct.modifier.union([_t.J.struct.modifier.wholeResidues([_t.J.struct.modifier.union([_t.J.struct.generator.atomGroups({"chain-test":_t.J.core.rel.eq([_t.J.ammp("objectPrimitive"),"atomistic"]),"residue-test":ae.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:mt.g7.Residue,ensureCustomProperties:(Ft,Qt)=>ge.attach(Ft,Qt)});var sn=n(6713),gt=n(1541),yt=n(9469),At=n(9778),Gt=n(2361);const rn=y.A.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:class extends y.A.Handler{constructor(){super(...arguments),this.provider=sn.r,this.labelProvider={label:Ft=>{if(this.params.showTooltip&&"element-loci"===Ft.kind){if(0===Ft.elements.length)return;const Qt=[],ht=this.getStructures(Ft.structure);for(const pt of ht){const Xt=this.provider.get(pt).value;if(!Xt)continue;const fn=gt.i.Loci.remap(Ft,pt);if(1!==fn.elements.length)continue;const on=fn.elements[0];if(1!==ne.CD.size(on.indices))continue;const En=Xt.unitsFeatures.get(on.unit.id);if(!En)continue;const Tt=[],Fe=[],He=[],Ye=ne.CD.start(on.indices),{types:ot,groups:rt,elementsIndex:{indices:St,offsets:vt}}=En;for(let mn=vt[Ye],zt=vt[Ye+1];mn<zt;++mn){const an=St[mn],Vn=ot[an],Fn=rt[an];Vn&&Tt.push((0,yt.XH)(Vn)),Fn&&Fe.push((0,yt.y9)(Fn))}Tt.length&&He.push(`<small>Types</small> ${Tt.join(", ")}`),Fe.length&&He.push(`<small>Groups</small> ${Fe.join(", ")}`),He.length&&Qt.push(`Interaction Feature: ${He.join(" | ")}`)}return Qt.length?Qt.join("<br/>"):void 0}}}}getStructures(Ft){const Qt=[],ht=this.ctx.helpers.substructureParent.get(Ft);if(ht){const Xt=this.ctx.state.data.select(j.QX.Generators.ofType(i.O.Molecule.Structure,ht.transform.ref));for(const fn of Xt)fn.obj&&(0,$e.Z2)(Qt,fn.obj.data)}return Qt}update(Ft){const Qt=this.params.autoAttach!==Ft.autoAttach||this.params.showTooltip!==Ft.showTooltip;return this.params.autoAttach=Ft.autoAttach,this.params.showTooltip=Ft.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),Qt}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(At.YU),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(Gt.MH)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(At.YU),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(Gt.MH)}},params:()=>({autoAttach:f.t.Boolean(!1),showTooltip:f.t.Boolean(!0)})});var tt=n(8699);const Mt=y.A.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:class extends y.A.Handler{constructor(){super(...arguments),this.provider=tt.v}update(Ft){const Qt=this.params.autoAttach!==Ft.autoAttach;return this.params.autoAttach=Ft.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),Qt}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:f.t.Boolean(!1)})});var nn=n(9311),bn=n(3024);const Dn=y.A.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:class extends y.A.Handler{constructor(){super(...arguments),this.provider=nn.F,this.labelProvider={label:Ft=>{if(this.params.showTooltip&&"element-loci"===Ft.kind){if(0===Ft.elements.length)return;const Qt=[],ht=this.getStructures(Ft.structure);for(const pt of ht){const Xt=this.provider.get(pt).value;if(!Xt)continue;const fn=ye.iZ.Loci.remap(Ft,pt);if(1!==fn.elements.length)continue;const on=fn.elements[0];if(1!==ne.CD.size(on.indices))continue;const En=Xt.get(on.unit.id);if(!En)continue;const Tt=ne.CD.start(on.indices),Ye=En.implicitH[Tt],ot=En.totalH[Tt];Qt.push(`Valence Model: <small>Charge</small> ${En.charge[Tt]} | <small>Ideal Geometry</small> ${(0,bn.Fc)(En.idealGeometry[Tt])} | <small>Implicit H</small> ${Ye} | <small>Total H</small> ${ot}`)}return Qt.length?Qt.join("<br/>"):void 0}}}}getStructures(Ft){const Qt=[],ht=this.ctx.helpers.substructureParent.get(Ft);if(ht){const Xt=this.ctx.state.data.select(j.QX.Generators.ofType(i.O.Molecule.Structure,ht.transform.ref));for(const fn of Xt)fn.obj&&(0,$e.Z2)(Qt,fn.obj.data)}return Qt}update(Ft){const Qt=this.params.autoAttach!==Ft.autoAttach||this.params.showTooltip!==Ft.showTooltip;return this.params.autoAttach=Ft.autoAttach,this.params.showTooltip=Ft.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),Qt}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:f.t.Boolean(!1),showTooltip:f.t.Boolean(!0)})});var jt=n(6220),It=n(7809);const Dt=(0,Ie.Q1)(16448250),$t=new Map,Vt={...(0,It.U)({type:"colors",colorList:"set-1"})},Zt={name:"sifts-mapping",label:"SIFTS Mapping",category:Le.J.Category.Residue,factory:function yn(Ft,Qt){let ht;if(Ft.structure){for(const En of Ft.structure.models){const Tt=jt.W.Provider.get(En).value;if(Tt)for(const Fe of Tt.accession)!Fe||$t.has(Fe)||$t.set(Fe,$t.size)}const pt=ye.iZ.Location.create(Ft.structure),Xt=(0,It.S)($t.size+1,Qt,{valueLabel:En=>`${En}`}),fn=new Map,on=En=>{const Tt=jt.W.getKey(En);if(!Tt)return Dt;if(fn.has(Tt))return fn.get(Tt);const Fe=Xt.color($t.get(Tt));return fn.set(Tt,Fe),Fe};ht=En=>ye.iZ.Location.is(En)&&ye.Nf.isAtomic(En.unit)?on(En):ye.gn.isLocation(En)?(pt.unit=En.aUnit,pt.element=En.aUnit.elements[En.aIndex],on(pt)):Dt}else ht=()=>Dt;return{factory:yn,granularity:"group",preferSmoothing:!0,color:ht,props:Qt,description:"Assigns a color based on SIFTS mapping."}},getParams:function Wt(Ft){return Vt},defaultValues:f.t.getDefaultValues(Vt),isApplicable:Ft=>{var Qt;return!(null===(Qt=Ft.structure)||void 0===Qt||!Qt.models.some(ht=>jt.W.Provider.isApplicable(ht)))},ensureCustomProperties:{attach:function(){var Ft=(0,q.A)(function*(Qt,ht){if(ht.structure)for(const pt of ht.structure.models)yield jt.W.Provider.attach(Qt,pt,void 0,!0)});return function(ht,pt){return Ft.apply(this,arguments)}}(),detach:Ft=>{if(Ft.structure)for(const Qt of Ft.structure.models)jt.W.Provider.ref(Qt,!1)}}},kt=y.A.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:class extends y.A.Handler{constructor(){super(...arguments),this.provider=jt.W.Provider,this.labelProvider={label:Ft=>{if(this.params.showTooltip)return function Ot(Ft){if("element-loci"===Ft.kind){if(0===Ft.elements.length)return;const Qt=Ft.elements[0],ht=Qt.unit,pt=ye.iZ.Location.create(Ft.structure,ht,ht.elements[ne.CD.getAt(Qt.indices,0)]);return jt.W.getLabel(pt)}}(Ft)}}}update(Ft){const Qt=this.params.autoAttach!==Ft.autoAttach||this.params.showTooltip!==Ft.showTooltip;return this.params.autoAttach=Ft.autoAttach,this.params.showTooltip=Ft.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),Qt}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Zt),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Zt),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:f.t.Boolean(!0),showTooltip:f.t.Boolean(!0)})});var jn,An=n(9207);!function(Ft){Ft.Descriptor={name:"ihm_cross_link_restraint"},Ft.Provider=An.q.create(Ft.Descriptor),Ft.fromTable=function Qt(ht,pt){const Xt={entity_id:ht.entity_id_1,asym_id:ht.asym_id_1,seq_id:ht.seq_id_1,atom_id:ht.atom_id_1},fn={entity_id:ht.entity_id_2,asym_id:ht.asym_id_2,seq_id:ht.seq_id_2,atom_id:ht.atom_id_2};function on(rt,St,vt){const mn=rt.get(St);mn?mn.push(vt):rt.set(St,[vt])}function En(rt,St){const vt=St.entity_id.value(rt),mn=St.asym_id.value(rt),zt=St.seq_id.value(rt);if("by-atom"===ht.model_granularity.value(rt)){const an=pt.atomicHierarchy.index.findAtom({auth_seq_id:zt,label_asym_id:mn,label_atom_id:St.atom_id.value(rt),label_entity_id:vt});an>=0&&on(Fe,an,rt)}else if(pt.coarseHierarchy.isDefined){const an=pt.coarseHierarchy.spheres.findSequenceKey(vt,mn,zt);if(an>=0)on(He,an,rt);else{const Vn=pt.coarseHierarchy.gaussians.findSequenceKey(vt,mn,zt);Vn>=0&&on(Ye,Vn,rt)}}}const Fe=new Map,He=new Map,Ye=new Map,ot=[];for(let rt=0;rt<ht._rowCount;++rt)En(rt,Xt),En(rt,fn);return{getIndicesByElement:(rt,St)=>{const mn=function Tt(rt){switch(rt){case 0:return Fe;case 1:return He;case 2:return Ye}}(St).get(rt);return void 0!==mn?mn:ot},data:ht}}}(jn||(jn={}));var On=n(2524),fr=n(2443),Dr=n(9283),Pr=n(1888),or=n(377),Nr=n(3892),Ir=n(1758);const Or=[];function Jr(Ft,Qt,ht,pt){return`${Ft}|${Qt.id}|${ht}|${pt.id}`}class To{getPairIndices(Qt,ht,pt,Xt){const fn=Jr(Qt,ht,pt,Xt);return this.pairKeyIndices.get(fn)||Or}getPairs(Qt,ht,pt,Xt){return this.getPairIndices(Qt,ht,pt,Xt).map(on=>this.pairs[on])}constructor(Qt){this.pairs=Qt;const ht=new Map;this.pairs.forEach((pt,Xt)=>{const fn=Jr(pt.indexA,pt.unitA,pt.indexB,pt.unitB),on=ht.get(fn);on?on.push(Xt):ht.set(fn,[Xt])}),this.count=Qt.length,this.pairKeyIndices=ht}}var un=n(364),ct=n(6290),dt=n(3917);const Yt=ie.S.createProvider({label:"Cross Link Restraint",descriptor:(0,ce.e)({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:Ft=>({}),isApplicable:Ft=>Ft.models.some(Qt=>!!jn.Provider.get(Qt)),obtain:function(){var Ft=(0,q.A)(function*(Qt,ht,pt){return{value:Yn(ht)}});return function(ht,pt,Xt){return Ft.apply(this,arguments)}}()});var cn;function xn(Ft,Qt,ht){const{elements:pt}=Qt,Xt=pt.length,fn=Qt.kind;for(let on=0;on<Xt;on++)ht.getIndicesByElement(pt[on],fn).forEach(Tt=>Ft.set(Tt,on))}function Rn(Ft,Qt,ht){if(Qt.model!==ht.model||"mmCIF"!==Qt.model.sourceData.kind)return;const pt=jn.Provider.get(Qt.model);if(!pt)return;const Xt=new Map,fn=new Map;xn(Xt,Qt,pt),xn(fn,ht,pt),Xt.forEach((on,En)=>{const Tt=fn.get(En);void 0!==Tt&&Ft.push(ir(Qt,on,ht,Tt,pt,En),ir(ht,Tt,Qt,on,pt,En))})}function er(Ft,Qt){if("mmCIF"!==Qt.model.sourceData.kind)return;const ht=jn.Provider.get(Qt.model);if(!ht)return;const{elements:pt}=Qt,Xt=pt.length,fn=Qt.kind,on=new Map;for(let En=0;En<Xt;En++)ht.getIndicesByElement(pt[En],fn).forEach(Fe=>{const He=on.get(Fe);He?He.push(En):on.set(Fe,[En])});on.forEach((En,Tt)=>{if(En.length<2)return;const[Fe,He]=En;Ft.push(ir(Qt,Fe,Qt,He,ht,Tt),ir(Qt,He,Qt,Fe,ht,Tt))})}function ir(Ft,Qt,ht,pt,Xt,fn){return{unitA:Ft,indexA:Qt,unitB:ht,indexB:pt,restraintType:Xt.data.restraint_type.value(fn),distanceThreshold:Xt.data.distance_threshold.value(fn),psi:Xt.data.psi.value(fn),sigma1:Xt.data.sigma_1.value(fn),sigma2:Xt.data.sigma_2.value(fn)}}function Yn(Ft){const Qt=[];if(!Ft.models.some(pt=>jn.Provider.get(pt)))return new To(Qt);const ht=Ft.units.length;for(let pt=0;pt<ht;++pt){const Xt=Ft.units[pt];er(Qt,Xt);for(let fn=pt+1;fn<ht;++fn){const on=Ft.units[fn];Xt.model===on.model&&Rn(Qt,Xt,on)}}return new To(Qt)}!function(Ft){let Qt;(Qt=Ft.Tag||(Ft.Tag={})).CrossLinkRestraint="cross-link-restraint",Ft.isApplicable=function ht(vt){return vt.models.some(mn=>!!jn.Provider.get(mn))};const pt=(0,L.eB)(),Xt=(0,L.eB)();function fn(vt){return vt.unitA.conformation.position(vt.unitA.elements[vt.indexA],pt),vt.unitB.conformation.position(vt.unitB.elements[vt.indexB],Xt),L.eB.distance(pt,Xt)}function Fe(vt,mn){const zt=vt.pairs[mn];return`Cross Link Restraint | Type: ${zt.restraintType} | Threshold: ${zt.distanceThreshold} \u212b | Psi: ${zt.psi} | Sigma 1: ${zt.sigma1} | Sigma 2: ${zt.sigma2} | Distance: ${fn(zt).toFixed(2)} \u212b`}function rt(vt,mn,zt){return ct.p.fromPairProvider(mn.length,(an,Vn,Fn)=>{const rr=vt.pairs[mn[an]];rr.unitA.conformation.position(rr.unitA.elements[rr.indexA],Vn),rr.unitB.conformation.position(rr.unitB.elements[rr.indexB],Fn)},zt)}function St(vt,mn,zt){const an=zt[0];if(void 0===an)return"";const Vn=mn.pairs[an];return[Fe(mn,an),(0,dt.CR)(ye.gn.Location(vt,Vn.unitA,Vn.indexA,vt,Vn.unitB,Vn.indexB))].join("</br>")}Ft.distance=fn,Ft.Location=function on(vt,mn,zt){return(0,un.cG)("cross-link-restraints",{structure:mn,crossLinkRestraints:vt},zt)},Ft.isLocation=function En(vt){return!!vt&&"data-location"===vt.kind&&"cross-link-restraints"===vt.tag},Ft.areLocationsEqual=function Tt(vt,mn){return vt.data.structure===mn.data.structure&&vt.data.crossLinkRestraints===mn.data.crossLinkRestraints&&vt.element===mn.element},Ft.locationLabel=function He(vt){return Fe(vt.data.crossLinkRestraints,vt.element)},Ft.Loci=function Ye(vt,mn,zt){return(0,R.g9)("cross-link-restraints",{structure:vt,crossLinkRestraints:mn},zt,an=>rt(mn,zt,an),()=>St(vt,mn,zt))},Ft.isLoci=function ot(vt){return!!vt&&"data-loci"===vt.kind&&"interactions"===vt.tag},Ft.getBoundingSphere=rt,Ft.getLabel=St}(cn||(cn={}));var br=n(5384);function vr(Ft,Qt,ht,pt,Xt){const fn=Yt.get(Qt).value;if(!fn.count)return Dr.e.createEmpty(Xt);const{sizeFactor:on}=pt,En=ye.iZ.Location.create(Qt),Tt={linkCount:fn.count,position:(Ye,ot,rt)=>{const St=fn.pairs[rt],vt=St.unitA,mn=St.unitB;vt.conformation.position(vt.elements[St.indexA],Ye),mn.conformation.position(mn.elements[St.indexB],ot)},radius:Ye=>{const ot=fn.pairs[Ye];return En.unit=ot.unitA,En.element=ot.unitA.elements[ot.indexA],ht.size.size(En)*on}},{mesh:Fe,boundingSphere:He}=(0,or.C1)(Ft,Tt,pt,Xt);if(He)Fe.setBoundingSphere(He);else if(Fe.triangleCount>0){const Ye=br.f8.expand((0,br.f8)(),Qt.boundary.sphere,1*on);Fe.setBoundingSphere(Ye)}return Fe}const Hr={...Nr.EN,...or.Lr,sizeFactor:f.t.Numeric(.5,{min:0,max:10,step:.1})};function Mr(Ft){return(0,Nr.wA)({defaultProps:f.t.getDefaultValues(Hr),createGeometry:vr,createLocationIterator:Fr,getLoci:Sr,eachLocation:Ur,setUpdateState:(Qt,ht,pt)=>{Qt.createGeometry=ht.sizeFactor!==pt.sizeFactor||ht.radialSegments!==pt.radialSegments||ht.linkCap!==pt.linkCap}},Ft)}function Fr(Ft){const Qt=Yt.get(Ft).value,{pairs:ht}=Qt,pt=ht.length,fn=cn.Location(Qt,Ft);return(0,Pr.iQ)(pt,1,1,En=>(fn.element=En,fn),!0)}function Sr(Ft,Qt,ht){const{objectId:pt,groupId:Xt}=Ft;if(ht===pt){const fn=Yt.get(Qt).value;if(fn.pairs[Xt])return cn.Loci(Qt,fn,[Xt])}return R.BL}function Ur(Ft,Qt,ht){let pt=!1;if(cn.isLoci(Ft)){if(!ye.oE.areEquivalent(Ft.data.structure,Qt))return!1;const Xt=Yt.get(Qt).value;if(Ft.data.crossLinkRestraints!==Xt)return!1;for(const fn of Ft.elements)ht(ne.IX.ofSingleton(fn))&&(pt=!0)}return pt}const Ro={"cross-link-restraint":(Ft,Qt)=>(0,Ir.Kp)("Cross-link restraint",Ft,Qt,Mr)},ro={...Hr},ho=(0,Ir.GT)({name:cn.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:function so(Ft,Qt){return fr.YL.createMulti("CrossLinkRestraint",Ft,Qt,Ir.J1,Ro)},getParams:function po(Ft,Qt){return f.t.clone(ro)},defaultValues:f.t.getDefaultValues(ro),defaultColorTheme:{name:cn.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:Ft=>cn.isApplicable(Ft),ensureCustomProperties:{attach:(Ft,Qt)=>Yt.attach(Ft,Qt,void 0,!0),detach:Ft=>Yt.ref(Ft,!1)}}),Bo=(0,Ie.Q1)(13421772),Wo={domain:f.t.Interval([.5,1.5],{step:.01}),list:f.t.ColorList("red-grey",{presetKind:"scale"})},Sn={name:"cross-link",label:"Cross Link",category:Le.J.Category.Misc,factory:function Pt(Ft,Qt){let ht,pt;const Xt=Ft.structure&&Yt.get(Ft.structure).value;if(Xt){pt=Ie.wC.create({domain:Qt.domain,listOrName:Qt.list.colors});const fn=pt.color;ht=on=>{if(cn.isLocation(on)){const En=Xt.pairs[on.element];if(En)return fn(cn.distance(En)/En.distanceThreshold)}return Bo}}else ht=()=>Bo;return{factory:Pt,granularity:"group",color:ht,props:Qt,description:"Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",legend:pt?pt.legend:void 0}},getParams:function We(Ft){return Wo},defaultValues:f.t.getDefaultValues(Wo),isApplicable:Ft=>!!Ft.structure&&cn.isApplicable(Ft.structure),ensureCustomProperties:{attach:(Ft,Qt)=>Qt.structure?Yt.attach(Ft,Qt.structure,void 0,!0):Promise.resolve(),detach:Ft=>Ft.structure&&Yt.ref(Ft.structure,!1)}},Nn=y.A.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:class extends y.A.Handler{constructor(){super(...arguments),this.provider=jn.Provider}register(){this.provider.formatRegistry.add("mmCIF",Kn),this.ctx.representation.structure.themes.colorThemeRegistry.add(Sn),this.ctx.representation.structure.registry.add(ho)}unregister(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Sn),this.ctx.representation.structure.registry.remove(ho)}}});function Kn(Ft){if(!On.K4.is(Ft.sourceData))return;const{ihm_cross_link_restraint:Qt}=Ft.sourceData.data.db;return 0!==Qt._rowCount?jn.fromTable(Qt,Ft):void 0}const dr={State:c,Representation:e,Camera:o,Misc:r},xr={Representation:D,Camera:t,CustomProps:A}},1164:(tn,Ue,n)=>{"use strict";n.d(Ue,{A:()=>c});var c,e=n(467),o=n(381),r=n(1832),t=n(4824),A=n(8277),y=n(9909);!function(i){class v extends(o.O.Create({name:"Root",typeClass:"Root"})){}i.Root=v;class O extends(o.O.Create({name:"Category",typeClass:"Object"})){}i.Category=O;class b extends(o.O.CreateBehavior({name:"Behavior"})){}i.Behavior=b,i.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},i.CreateCategory=o.H.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:v,to:O,params:{label:A.t.Text("",{isHidden:!0})}})({apply:({params:d})=>new O({},{label:d.label})});const _=new Map;i.getCategoryId=function M(d){return _.get(d.id)},i.create=function I(d){const s=o.H.CreateBuiltIn({name:d.name,display:d.display,from:[v],to:[b],params:d.params,apply({params:C},h){const a=d.label?d.label(C):{label:d.display.name,description:d.display.description};return new b(new d.ctor(h,C),a)},update:({b:C,newParams:h})=>t.YZ.create("Update Behavior",(0,e.A)(function*(){return C.data.update&&(yield C.data.update(h))?r.xE.UpdateResult.Updated:r.xE.UpdateResult.Unchanged})),canAutoUpdate:d.canAutoUpdate});return _.set(s.id,d.category),s},i.simpleCommandHandler=function l(d,s){return class{register(){this.sub=d.subscribe(this.ctx,C=>s(C,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}constructor(C){this.ctx=C,this.sub=void 0}}},i.Handler=class m{subscribeCommand(s,C){this.subs.push(s.subscribe(this.ctx,C))}subscribeObservable(s,C){this.subs.push(s.subscribe(C))}track(s){this.subs.push(s)}dispose(){for(const s of this.subs)s.unsubscribe();this.subs=[]}update(s){return!(0,y.f8)(s,this.params)&&(this.params=s,!0)}constructor(s,C){this.ctx=s,this.params=C,this.subs=[]}},i.WithSubscribers=class u{subscribeCommand(s,C){this.subs.push(s.subscribe(this.plugin,C))}subscribeObservable(s,C){const h=s.subscribe(C);return this.subs.push(h),{unsubscribe:()=>{const a=this.subs.indexOf(h);a>=0&&(this.subs.splice(a,1),h.unsubscribe())}}}dispose(){for(const s of this.subs)s.unsubscribe();this.subs=[]}constructor(s,C){this.plugin=s,this.params=C,this.subs=[]}}}(c||(c={}))},1937:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{DefaultFocusLociBindings:()=>S,DefaultLociLabelProvider:()=>a,DefaultSelectLociBindings:()=>s,FocusLoci:()=>R,HighlightLoci:()=>d,SelectLoci:()=>h});var e=n(6825),o=n(381),r=n(3917),t=n(1164),A=n(6323),y=n(1832),c=n(4080),i=n(4123),v=n(8277),O=n(3246),b=n(9136),_=n(6115);const M=c.qt,I=c.Fs,l=i.O.Trigger,m={hoverHighlightOnly:(0,i.O)([l(M.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:(0,i.O)([l(M.Flag.None,I.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},u={bindings:v.t.Value(m,{isHidden:!0}),ignore:v.t.Value([],{isHidden:!0}),preferAtoms:v.t.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:v.t.Boolean(!0)},d=t.A.create({name:"representation-highlight-loci",category:"interaction",ctor:class extends t.A.Handler{constructor(){super(...arguments),this.lociMarkProvider=(f,p)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark(f,p)}}getLoci(f){return this.params.preferAtoms&&b.gn.isLoci(f)&&2===f.bonds.length?b.gn.toFirstStructureElementLoci(f):f}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:f,buttons:p,modifiers:E})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;const T=this.getLoci(f.loci);if(this.params.ignore.includes(T.kind))return void this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:f.repr,loci:O.BL});let L=!1;i.O.match(this.params.bindings.hoverHighlightOnly,p,E)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:T}),L=!0),i.O.match(this.params.bindings.hoverHighlightOnlyExtend,p,E)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:T}),L=!0),L||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:f.repr,loci:O.BL})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>u,display:{name:"Highlight Loci on Canvas"}}),s={clickSelect:i.O.Empty,clickToggleExtend:(0,i.O)([l(M.Flag.Primary,I.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickSelectOnly:i.O.Empty,clickToggle:(0,i.O)([l(M.Flag.Primary,I.create())],"Toggle selection","Click on element using ${triggers}"),clickDeselect:i.O.Empty,clickDeselectAllOnEmpty:(0,i.O)([l(M.Flag.Primary,I.create())],"Deselect all","Click on nothing using ${triggers}")},C={bindings:v.t.Value(s,{isHidden:!0}),ignore:v.t.Value([],{isHidden:!0}),preferAtoms:v.t.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:v.t.Boolean(!0)},h=t.A.create({name:"representation-select-loci",category:"interaction",ctor:class extends t.A.Handler{getLoci(f){return this.params.preferAtoms&&b.gn.isLoci(f)&&2===f.bonds.length?b.gn.toFirstStructureElementLoci(f):f}applySelectMark(f,p){const E=this.ctx.state.data.cells.get(f);if(E&&o.O.isRepresentation3D(E.obj)){this.spine.current=E;const T=this.spine.getRootOfType(o.O.Molecule.Structure);if(T){p&&this.lociMarkProvider({loci:b.oE.Loci(T.data)},e.xi.Deselect);const L=this.ctx.managers.structure.selection.getLoci(T.data);this.lociMarkProvider({loci:L},e.xi.Select)}}}register(){const p=T=>!O.QN.isEmpty(T),E=[["clickSelect",T=>this.ctx.managers.interactivity.lociSelects.select(T),p],["clickToggle",T=>this.ctx.managers.interactivity.lociSelects.toggle(T),p],["clickToggleExtend",T=>this.ctx.managers.interactivity.lociSelects.toggleExtend(T),p],["clickSelectOnly",T=>this.ctx.managers.interactivity.lociSelects.selectOnly(T),p],["clickDeselect",T=>this.ctx.managers.interactivity.lociSelects.deselect(T),p],["clickDeselectAllOnEmpty",()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),T=>O.QN.isEmpty(T)]];E.sort((T,L)=>{const w=this.params.bindings[T[0]],Q=this.params.bindings[L[0]],G=0===w.triggers.length?0:(0,_._M)(w.triggers.map(U=>I.size(U.modifiers)));return(0===Q.triggers.length?0:(0,_._M)(Q.triggers.map(U=>I.size(U.modifiers))))-G}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:T,button:L,modifiers:w})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return;const Q=this.getLoci(T.loci);if(!this.params.ignore.includes(Q.kind))for(const[G,V,U]of E)if(i.O.match(this.params.bindings[G],L,w)&&(!U||U(Q))){V({repr:T.repr,loci:Q});break}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:T})=>this.applySelectMark(T)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:T,obj:L,oldObj:w,oldData:Q,action:G})=>{const V=this.ctx.state.data.cells.get(T);if(V&&o.O.Molecule.Structure.is(V.obj)){const U=L.data,N="recreate"===G?w?.data:"in-place"===G?Q:void 0;if(N&&b.oE.areEquivalent(U,N)&&b.oE.areHierarchiesEqual(U,N))return;const k=this.ctx.state.data.select(y.QX.children(T).ofType(o.O.Molecule.Structure.Representation3D));for(const H of k)this.applySelectMark(H.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}constructor(f,p){super(f,p),this.lociMarkProvider=(E,T)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark({loci:E.loci},T)},this.spine=new A.P.Impl(f.state.data.cells)}},params:()=>C,display:{name:"Select Loci on Canvas"}}),a=t.A.create({name:"default-loci-label-provider",category:"interaction",ctor:class{register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}constructor(f){this.ctx=f,this.f={label:p=>{const E=[];if(b.iZ.Loci.is(p)){const T=new Set;for(const{unit:L}of p.elements){const w=b.iZ.Location.create(p.structure,L,L.elements[0]),Q=b.StructureProperties.entity.pdbx_description(w).join(", ");T.add(Q)}1===T.size&&T.forEach(L=>E.push(L))}return E.push((0,r.YQ)(p)),E.filter(T=>!!T).join("</br>")},group:p=>p.toString().replace(/Model [0-9]+/g,"Models"),priority:100}}},display:{name:"Provide Default Loci Label"}}),S={clickFocus:(0,i.O)([l(M.Flag.Primary,I.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:(0,i.O)([l(M.Flag.Primary,I.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:(0,i.O)([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:(0,i.O)([],"Representation Focus Add","Click element using ${triggers}")},D={bindings:v.t.Value(S,{isHidden:!0})},R=t.A.create({name:"representation-focus-loci",category:"interaction",ctor:class extends t.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:f,button:p,modifiers:E})=>{var T,L,w,Q,G;const{clickFocus:V,clickFocusAdd:U,clickFocusSelectMode:N,clickFocusAddSelectMode:k}=this.params.bindings,$=i.O.match(this.ctx.selectionMode?N:V,p,E),J=null!==(Q=null===(w=null===(L=null===(T=f.repr)||void 0===T?void 0:T.props)||void 0===L?void 0:L.snapshotKey)||void 0===w?void 0:w.trim())&&void 0!==Q?Q:"";if(!this.ctx.selectionMode&&$&&J)return void this.ctx.managers.snapshot.applyKey(J);const{granularity:W}=this.ctx.managers.interactivity.props;if("residue"!==W&&"element"!==W)return;const de=i.O.match(this.ctx.selectionMode?k:U,p,E);if(!$&&!de)return;const ye=O.QN.normalize(f.loci,"residue"),j=this.ctx.managers.structure.focus.current;if(j&&O.QN.areEqual(j.loci,ye))this.ctx.managers.structure.focus.clear();else if($)this.ctx.managers.structure.focus.setFromLoci(ye);else{this.ctx.managers.structure.focus.addFromLoci(ye);const Z=null===(G=this.ctx.managers.structure.focus.current)||void 0===G?void 0:G.loci;Z&&this.ctx.managers.camera.focusLoci(Z)}})}},params:()=>D,display:{name:"Representation Focus Loci on Canvas"}})},445:(tn,Ue,n)=>{"use strict";n.d(Ue,{b:()=>C});var e=n(467),o=n(2361),r=n(9778),t=n(9136),A=n(1893),y=n(1073),c=n(4987),i=n(9767),v=n(1832),O=n(2832),b=n(8277),_=n(6763),M=n(6765),I=n(9390);const m=["target","surroundings","interactions"];var u=function(h){return h.TargetSel="structure-focus-target-sel",h.TargetRepr="structure-focus-target-repr",h.SurrSel="structure-focus-surr-sel",h.SurrRepr="structure-focus-surr-repr",h.SurrNciRepr="structure-focus-surr-nci-repr",h}(u||{});const d=new Set([u.TargetSel,u.TargetRepr,u.SurrSel,u.SurrRepr,u.SurrNciRepr]),C=c.AF.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:class s extends c.AF.WithSubscribers{constructor(){super(...arguments),this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} \xc5)`}getReprParams(a){return{...a,type:{name:a.type.name,params:{...a.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip}}}}ensureShape(a){var S;const D=this.plugin.state.data,R=D.tree,f=D.build(),p=v.QX.findUniqueTagsInSubtree(R,a.transform.ref,d);p[u.TargetSel]||(p[u.TargetSel]=f.to(a).apply(y.f.Model.StructureSelectionFromBundle,{bundle:t.iZ.Bundle.Empty,label:"[Focus] Target"},{tags:u.TargetSel}).ref),p[u.SurrSel]||(p[u.SurrSel]=f.to(a).apply(y.f.Model.StructureSelectionFromExpression,{expression:i.J.struct.generator.empty(),label:this.surrLabel},{tags:u.SurrSel}).ref);const E=this.params.components;return E.indexOf("target")>=0&&!p[u.TargetRepr]&&(p[u.TargetRepr]=f.to(p[u.TargetSel]).apply(y.f.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:u.TargetRepr}).ref),E.indexOf("surroundings")>=0&&!p[u.SurrRepr]&&(p[u.SurrRepr]=f.to(p[u.SurrSel]).apply(y.f.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:u.SurrRepr}).ref),E.indexOf("interactions")>=0&&!p[u.SurrNciRepr]&&a.obj&&o.MH.isApplicable(null===(S=a.obj)||void 0===S?void 0:S.data)&&(p[u.SurrNciRepr]=f.to(p[u.SurrSel]).apply(y.f.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:u.SurrNciRepr}).ref),{state:D,builder:f,refs:p}}clear(a){const S=this.plugin.state.data;this.currentSource=void 0;const D=S.select(v.QX.Generators.byRef(a).subtree().withTag(u.TargetSel)),R=S.select(v.QX.Generators.byRef(a).subtree().withTag(u.SurrSel));if(0===D.length&&0===R.length)return;const f=S.build(),p=t.iZ.Bundle.Empty;for(const T of D)f.to(T).update(y.f.Model.StructureSelectionFromBundle,L=>({...L,bundle:p}));const E=i.J.struct.generator.empty();for(const T of R)f.to(T).update(y.f.Model.StructureSelectionFromExpression,L=>({...L,expression:E}));return _.a.State.Update(this.plugin,{state:S,tree:f,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}focus(a){var S=this;return(0,e.A)(function*(){const D=S.plugin.helpers.substructureParent.get(a.structure);if(!D||!D.obj)return;S.currentSource=a;const R=t.iZ.Loci.remap(a,D.obj.data),f=t.iZ.Loci.extendToWholeResidues(R),p=t.iZ.Bundle.fromLoci(f),E=t.iZ.Bundle.toExpression(p);let T=i.J.struct.modifier.includeSurroundings({0:E,radius:S.params.expandRadius,"as-whole-residues":!0});S.params.excludeTargetFromSurroundings&&(T=i.J.struct.modifier.exceptBy({0:T,by:E}));const{state:L,builder:w,refs:Q}=S.ensureShape(D);w.to(Q[u.TargetSel]).update(y.f.Model.StructureSelectionFromBundle,G=>({...G,bundle:p})),w.to(Q[u.SurrSel]).update(y.f.Model.StructureSelectionFromExpression,G=>({...G,expression:T,label:S.surrLabel})),yield _.a.State.Update(S.plugin,{state:L,tree:w,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})})()}register(a){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,S=>{S?this.focus(S.loci):this.clear(v.Cn.RootRef)})}update(a){var S=this;return(0,e.A)(function*(){const D=S.params;if(S.params=a,D.excludeTargetFromSurroundings!==a.excludeTargetFromSurroundings)return S.currentSource&&S.focus(S.currentSource),!0;const R=S.plugin.state.data,f=R.build(),p=v.QX.Generators.root.subtree(),E=S.params.components;let T=E.indexOf("target")>=0;for(const L of R.select(p.withTag(u.TargetRepr)))T?f.to(L).update(S.getReprParams(S.params.targetParams)):f.delete(L.transform.ref);T=E.indexOf("surroundings")>=0;for(const L of R.select(p.withTag(u.SurrRepr)))T?f.to(L).update(S.getReprParams(S.params.surroundingsParams)):f.delete(L.transform.ref);T=E.indexOf("interactions")>=0;for(const L of R.select(p.withTag(u.SurrNciRepr)))T?f.to(L).update(S.getReprParams(S.params.nciParams)):f.delete(L.transform.ref);return yield _.a.State.Update(S.plugin,{state:R,tree:f,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),a.expandRadius!==D.expandRadius&&S.currentSource&&S.focus(S.currentSource),!0})()}},params:(h,a)=>(h=>{const a=y.f.Representation.StructureRepresentation3D.definition.params(void 0,h);return{expandRadius:b.t.Numeric(5,{min:1,max:10,step:1}),targetParams:b.t.Group(a,{label:"Target",customDefault:(0,A.pQ)(h,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:b.t.Group(a,{label:"Surroundings",customDefault:(0,A.pQ)(h,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:b.t.Group(a,{label:"Non-covalent Int.",customDefault:(0,A.pQ)(h,void 0,{type:o.MH,color:r.YU,size:O.F.BuiltIn.uniform})}),components:b.t.MultiSelect(m,b.t.arrayToOptions(m)),excludeTargetFromSurroundings:b.t.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:b.t.Boolean(!1),ignoreHydrogensVariant:b.t.Select("all",b.t.arrayToOptions(["all","non-polar"])),ignoreLight:b.t.Boolean(!1),material:M.i.getParam(),clip:b.t.Group(I.B.Params)}})(a)})},6230:(tn,Ue,n)=>{"use strict";n.d(Ue,{h:()=>R});var O,f,e=n(467),o=n(8277),r=n(381),t=n(6853),A=n(5384),y=n(4369),c=n(190),i=n(1164),v=n(9677);(f=O||(O={})).create=function E(Q){return{entries:(0,v.wl)(),capacity:Math.max(1,Q)}},f.get=function T(Q,G){for(let V=Q.entries.first;V;V=V.next)if(V.value.key===G)return Q.entries.remove(V),Q.entries.addLast(V.value),V.value.data},f.set=function L(Q,G,V){let U;if(Q.entries.count>=Q.capacity){const N=Q.entries.first;U=N.value.data,Q.entries.remove(N)}return Q.entries.addLast(function p(Q,G){return{key:Q,data:G}}(G,V)),U},f.remove=function w(Q,G){for(let V=Q.entries.first;V;V=V.next)if(V.value.key===G){Q.entries.remove(V);break}};var b=n(5091),_=n(5165),M=n(4625),I=n(6763),l=n(1832),m=n(9136),u=n(3246),d=n(1861),s=n(4811),C=n(3386),h=n(6354),a=n(3294),S=n(5964);class D{constructor(p=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=p}enqueue(p){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:p},this.counter++,this.run()}run(){var p=this;return(0,e.A)(function*(){if(p.isRunning)return;const E=p.queue.pop();if(E){p.isRunning=!0;try{p.log&&console.log("SingleAsyncQueue run",E.id),yield E.func(),p.log&&console.log("SingleAsyncQueue complete",E.id)}finally{p.isRunning=!1,p.run()}}})()}}class R extends(r.O.CreateBehavior({name:"Volume Streaming"})){}!function(f){function p(V,U,N,k,H={}){var $,J,W,te;return o.t.Group({isoValue:t.f.createIsoValueParam(null!==($=H.isoValue)&&void 0!==$?$:N,k),color:o.t.Color(null!==(J=H.color)&&void 0!==J?J:U),wireframe:o.t.Boolean(null!==(W=H.wireframe)&&void 0!==W&&W),opacity:o.t.Numeric(null!==(te=H.opacity)&&void 0!==te?te:.3,{min:0,max:1,step:.01})},{label:V,isExpanded:!0})}f.RootTag="volume-streaming-info";const E={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function L(V){const{entryData:U,defaultView:N,structure:k,channelParams:H={}}=V,$=U||{kind:"em",header:{sampling:[E],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:t.f.IsoValue.relative(0)},J=k&&k.boundary.box||(0,A.DJ)();return{view:o.t.MappedStatic(N||("em"===$.kind?"auto":"selection-box"),{off:o.t.Group({}),box:o.t.Group({bottomLeft:o.t.Vec3(J.min),topRight:o.t.Vec3(J.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":o.t.Group({radius:o.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),bottomLeft:o.t.Vec3(y.eB.create(0,0,0),{},{isHidden:!0}),topRight:o.t.Vec3(y.eB.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":o.t.Group({radius:o.t.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:w($.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:o.t.Vec3(y.eB.create(0,0,0),{},{isHidden:!0}),topRight:o.t.Vec3(y.eB.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:o.t.Group({}),auto:o.t.Group({radius:o.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),selectionDetailLevel:w($.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:o.t.Boolean(!1,{isHidden:!0}),bottomLeft:o.t.Vec3(J.min,{},{isHidden:!0}),topRight:o.t.Vec3(J.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:f.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:w($.header.availablePrecisions,3),channels:o.t.Group("em"===$.kind?{em:p("EM",(0,c.Q1)(6524815),$.emDefaultContourLevel||t.f.IsoValue.relative(1),$.header.sampling[0].valuesInfo[0],H.em)}:{"2fo-fc":p("2Fo-Fc",(0,c.Q1)(3367602),t.f.IsoValue.relative(1.5),$.header.sampling[0].valuesInfo[0],H["2fo-fc"]),"fo-fc(+ve)":p("Fo-Fc(+ve)",(0,c.Q1)(3390259),t.f.IsoValue.relative(3),$.header.sampling[0].valuesInfo[1],H["fo-fc(+ve)"]),"fo-fc(-ve)":p("Fo-Fc(-ve)",(0,c.Q1)(12268339),t.f.IsoValue.relative(-3),$.header.sampling[0].valuesInfo[1],H["fo-fc(-ve)"])},{isFlat:!0})}}function w(V,U,N){return o.t.Select(Math.min(U,V.length-1),V.map((k,H)=>[H,`${H+1} [ ${0|Math.pow(k.maxVoxels,1/3)}^3 cells ]`]),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).",...N})}function Q(V){return{entry:{name:V.entry.name,params:{detailLevel:V.entry.params.detailLevel,channels:V.entry.params.channels,view:{name:V.entry.params.view.name,params:{...V.entry.params.view.params}}}}}}f.createParams=function T(V={}){const{data:U,defaultView:N,channelParams:k}=V,H=new Map;U&&U.entries.forEach(W=>H.set(W.dataId,W));const $=U?U.entries.map(W=>[W.dataId,W.dataId]):[];return{entry:o.t.Mapped(U?U.entries[0].dataId:"",$,W=>o.t.Group(L({entryData:H.get(W),defaultView:N,structure:U&&U.structure,channelParams:k})))}},f.createEntryParams=L,f.copyParams=Q,f.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],f.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]],f.Behavior=class G extends i.A.WithSubscribers{get info(){return this.infoMap.get(this.params.entry.name)}queryData(U){var N=this;return(0,e.A)(function*(){let k=(0,b.r)(N.data.serverUrl,`${N.info.kind}/${N.info.dataId.toLowerCase()}`);if(U){const{min:ye,max:j}=U;k+=`/box/${ye.map(Z=>Math.round(1e3*Z)/1e3).join(",")}/${j.map(Z=>Math.round(1e3*Z)/1e3).join(",")}`}else k+="/cell";let H=N.params.entry.params.detailLevel;"auto"===N.params.entry.params.view.name&&N.params.entry.params.view.params.isSelection&&(H=N.params.entry.params.view.params.selectionDetailLevel),"camera-target"===N.params.entry.params.view.name&&U&&(H=N.decideDetail(U,N.params.entry.params.view.params.dynamicDetailLevel)),k+=`?detail=${H}`;const $=O.get(N.cache,k);if($)return $.data;const J=d.V.getUrlAsset(N.plugin.managers.asset,k),W=yield N.plugin.runTask(N.plugin.managers.asset.resolve(J,"binary")),te=yield N.parseCif(W.data);if(!te)return;const de=O.set(N.cache,k,{data:te,asset:W});return de&&de.asset.dispose(),te})()}parseCif(U){var N=this;return(0,e.A)(function*(){const k=yield N.plugin.runTask(_.f$.parseBinary(U));if(k.isError)return void N.plugin.log.error("VolumeStreaming, parsing CIF: "+k.toString());if(k.result.blocks.length<2)return void N.plugin.log.error("VolumeStreaming: Invalid data.");const H={};for(let $=1;$<k.result.blocks.length;$++){const J=k.result.blocks[$],W=_.f$.schema.densityServer(J),te=yield N.plugin.runTask((0,M.G)(W));H[J.header]=te}return H})()}updateParams(U,N=!1){var k=this;return(0,e.A)(function*(){const H=Q(k.params),$=H.entry.params.view.name;"off"!==$&&"cell"!==$&&(H.entry.params.view.params.bottomLeft=U?.min||y.eB.zero(),H.entry.params.view.params.topRight=U?.max||y.eB.zero()),"auto"===$&&(H.entry.params.view.params.isSelection=N);const J=k.plugin.state.data,W=J.build().to(k.ref).update(H);yield I.a.State.Update(k.plugin,{state:J,tree:W,options:{doNotUpdateCurrent:!0}})})()}getStructureRoot(){return this.plugin.state.data.select(l.QX.Generators.byRef(this.ref).rootOfType(r.O.Molecule.Structure))[0]}register(U){this.ref=U,this.subscribeObservable(this.plugin.state.events.object.removed,N=>{!r.O.Molecule.Structure.is(N.obj)||!m.iZ.Loci.is(this.lastLoci)||this.lastLoci.structure===N.obj.data&&(this.lastLoci=u.BL)}),this.subscribeObservable(this.plugin.state.events.object.updated,N=>{!r.O.Molecule.Structure.is(N.oldObj)||!m.iZ.Loci.is(this.lastLoci)||this.lastLoci.structure===N.oldObj.data&&(this.lastLoci=u.BL)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,N=>{if(!this.plugin.state.data.tree.children.has(this.ref))return;const k=N?N.loci:u.BL;switch(this.params.entry.params.view.name){case"auto":this.updateAuto(k);break;case"selection-box":this.updateSelectionBox(k);break;default:this.lastLoci=k}})}unregister(){let U=this.cache.entries.first;for(;U;)U.value.data.asset.dispose(),U=U.next}isCameraTargetSame(U,N){if(!U||!N)return!1;const k=y.eB.equals(U.target,N.target),H=y.eB.squaredDistance(U.target,U.position),$=y.eB.squaredDistance(N.target,N.position),J=Math.abs(H-$)/H<.001;return k&&J}cameraTargetDistance(U){return y.eB.distance(U.target,U.position)}getBoxFromLoci(U){var N,k,H;if(u.QN.isEmpty(U)||(0,u.$M)(U))return(0,A.DJ)();const $=this.plugin.helpers.substructureParent.get(U.structure,!0);if(!$)return(0,A.DJ)();const J=this.getStructureRoot();if(!J||(null===(N=J.obj)||void 0===N?void 0:N.data)!==(null===(k=$.obj)||void 0===k?void 0:k.data))return(0,A.DJ)();const W=s.T.get(null===(H=J.obj)||void 0===H?void 0:H.data.models[0]);W&&y.$I.invert(this._invTransform,W);const te=m.iZ.Loci.extendToWholeResidues(U),de=m.iZ.Loci.getBoundary(te,W&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return 1===m.iZ.Loci.size(te)&&A.DJ.expand(de,de,y.eB.create(1,1,1)),de}updateAuto(U){var N=this;this.updateQueue.enqueue((0,e.A)(function*(){N.lastLoci=U,(0,u.$M)(U)?yield N.updateParams("x-ray"===N.info.kind?N.data.structure.boundary.box:void 0,!1):yield N.updateParams(N.getBoxFromLoci(U),!0)}))}updateSelectionBox(U){var N=this;this.updateQueue.enqueue((0,e.A)(function*(){N.lastLoci=u.QN.areEqual(N.lastLoci,U)?u.BL:U;const k=N.getBoxFromLoci(N.lastLoci);yield N.updateParams(k)}))}updateCameraTarget(U){var N=this;this.updateQueue.enqueue((0,e.A)(function*(){var k,H,$;const J=null===(k=N.plugin.canvas3d)||void 0===k?void 0:k.props.camera.manualReset;try{J||null===(H=N.plugin.canvas3d)||void 0===H||H.setProps({camera:{manualReset:!0}});const W=N.boxFromCameraTarget(U,!0);yield N.updateParams(W)}finally{J||null===($=N.plugin.canvas3d)||void 0===$||$.setProps({camera:{manualReset:J}})}}))}boxFromCameraTarget(U,N){var k;const H=U.target,$=this.cameraTargetDistance(U);let W=Math.tan(.5*U.fov)*$;const te=null===(k=this.plugin.canvas3d)||void 0===k?void 0:k.camera.viewport;let ye,j,Z;if(te&&te.width>te.height&&(W*=te.width/te.height),W*="camera-target"===this.params.entry.params.view.name?this.params.entry.params.view.params.radius:.5,N){const q=y.eB.zero();A.DJ.size(q,this.data.structure.boundary.box),ye=Math.min(W,.5*q[0]),j=Math.min(W,.5*q[1]),Z=Math.min(W,.5*q[2])}else ye=j=Z=W;return A.DJ.create(y.eB.create(H[0]-ye,H[1]-j,H[2]-Z),y.eB.create(H[0]+ye,H[1]+j,H[2]+Z))}decideDetail(U,N){const k="x-ray"===this.info.kind?A.DJ.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((te,de)=>te*de,1);let $=A.DJ.volume(U)/k;const J=this.info.header.availablePrecisions.length-1;let W=N;for(;$<=.5&&W<J;)$*=2,W+=1;return W}update(U){var N=this;return(0,e.A)(function*(){const k="selection-box"===U.entry.params.view.name&&N.params&&N.params.entry&&N.params.entry.params&&N.params.entry.params.view&&"selection-box"!==N.params.entry.params.view.name;N.params=U;let H,$=!1;switch("camera-target"!==U.entry.params.view.name&&N.cameraTargetSubscription&&(N.cameraTargetSubscription.unsubscribe(),N.cameraTargetSubscription=void 0),U.entry.params.view.name){case"off":$=!0;break;case"box":H=A.DJ.create(U.entry.params.view.params.bottomLeft,U.entry.params.view.params.topRight),$=A.DJ.volume(H)<1e-4;break;case"selection-box":{H=k?N.getBoxFromLoci(N.lastLoci)||(0,A.DJ)():A.DJ.create(y.eB.clone(U.entry.params.view.params.bottomLeft),y.eB.clone(U.entry.params.view.params.topRight));const te=U.entry.params.view.params.radius;$=A.DJ.volume(H)<1e-4,A.DJ.expand(H,H,y.eB.create(te,te,te));break}case"camera-target":N.cameraTargetSubscription||(N.cameraTargetSubscription=N.subscribeObservable(N.cameraTargetObservable,te=>N.updateCameraTarget(te))),H=N.boxFromCameraTarget(N.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":H="x-ray"===N.info.kind?N.data.structure.boundary.box:void 0;break;case"auto":if(H=U.entry.params.view.params.isSelection||"x-ray"===N.info.kind?A.DJ.create(y.eB.clone(U.entry.params.view.params.bottomLeft),y.eB.clone(U.entry.params.view.params.topRight)):void 0,H&&($=A.DJ.volume(H)<1e-4,U.entry.params.view.params.isSelection)){const te=U.entry.params.view.params.radius;A.DJ.expand(H,H,y.eB.create(te,te,te))}}const J=$?{}:yield N.queryData(H);if(!J)return!1;const W=U.entry.params.channels;return"x-ray"===N.info.kind?(N.channels["2fo-fc"]=N.createChannel(J["2FO-FC"]||t.f.One,W["2fo-fc"],N.info.header.sampling[0].valuesInfo[0]),N.channels["fo-fc(+ve)"]=N.createChannel(J["FO-FC"]||t.f.One,W["fo-fc(+ve)"],N.info.header.sampling[0].valuesInfo[1]),N.channels["fo-fc(-ve)"]=N.createChannel(J["FO-FC"]||t.f.One,W["fo-fc(-ve)"],N.info.header.sampling[0].valuesInfo[1])):N.channels.em=N.createChannel(J.EM||t.f.One,W.em,N.info.header.sampling[0].valuesInfo[0]),!0})()}createChannel(U,N,k){return{data:U,color:N.color,wireframe:N.wireframe,opacity:N.opacity,isoValue:"relative"===N.isoValue.kind?N.isoValue:t.f.IsoValue.toRelative(N.isoValue,k)}}getDescription(){return"selection-box"===this.params.entry.params.view.name?"Selection":"camera-target"===this.params.entry.params.view.name?"Camera":"box"===this.params.entry.params.view.name?"Static Box":"cell"===this.params.entry.params.view.name?"Cell":""}constructor(U,N){super(U,{}),this.plugin=U,this.data=N,this.cache=O.create(25),this.params={},this.lastLoci=u.BL,this.ref="",this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe((0,C.c)(500,void 0,{leading:!0,trailing:!0}),(0,h.T)(()=>{var k;return null===(k=this.plugin.canvas3d)||void 0===k?void 0:k.camera.getSnapshot()}),(0,a.F)((k,H)=>this.isCameraTargetSame(k,H)),(0,S.p)(k=>void 0!==k)),this.cameraTargetSubscription=void 0,this.channels={},this._invTransform=(0,y.$I)(),this.infoMap=new Map,this.data.entries.forEach(k=>this.infoMap.set(k.dataId,k)),this.updateQueue=new D}}}(R||(R={}))},958:(tn,Ue,n)=>{"use strict";n.d(Ue,{Cd:()=>a,N$:()=>R,p3:()=>h});var t,e=n(467),o=n(381);class r extends(o.O.Create({name:"Volume Streaming",typeClass:"Object"})){}!function(E){let T;var L;(L=T=E.ValueType||(E.ValueType={})).Float32="float32",L.Int8="int8"}(t||(t={}));var A=n(8277),y=n(4824),c=n(5091),i=n(6853),v=n(1832),O=n(6570),b=n(6230),_=n(8010),M=n(3866),I=n(1930),l=n(5384),m=n(4369),u=n(237),d=n(9136),s=n(4811);function C(E,T,L,w){E.push({source:"em"===T?{name:"em",params:{isoValue:i.f.IsoValue.absolute(w||0)}}:{name:"x-ray",params:{}},dataId:L})}const h=v.KW.build({display:{name:"Volume Streaming"},from:o.O.Molecule.Structure,params(E,T){const L=(0,O.AR)(E&&E.data),w=(0,O.rO)(L,E&&E.data);return{method:A.t.Select(L,[["em","EM"],["x-ray","X-Ray"]]),entries:A.t.ObjectList({id:A.t.Text(w[0]||"")},({id:Q})=>Q,{defaultValue:w.map(Q=>({id:Q}))}),defaultView:A.t.Select("em"===L?"auto":"selection-box",b.h.ViewTypeOptions),options:A.t.Group({serverUrl:A.t.Text(T.config.get(u.AB.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:A.t.Text("",{isHidden:!0}),emContourProvider:A.t.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:A.t.Value({},{isHidden:!0})})}},isApplicable:(E,T,L)=>{const w=L.config.get(u.AB.VolumeStreaming.CanStream);return w?w(E.data,L):1===E.data.models.length&&d.Kx.probablyHasDensityMap(E.data.models[0])}})(({ref:E,state:T,params:L},w)=>y.YZ.create("Volume Streaming",function(){var Q=(0,e.A)(function*(G){const V=[];for(let J=0,W=L.entries.length;J<W;++J){const te=L.entries[J].id.toLowerCase();let de;if("em"===L.method){if(!te.toUpperCase().startsWith("EMD")){yield G.update("Getting EMDB info...");const ye=yield(0,O.t9)(w,G,te);for(let j=0,Z=ye.length;j<Z;++j){const q=ye[j];let Y;try{Y=yield(0,O.lL)(L.options.emContourProvider,w,G,q)}catch(ee){console.info(`Could not get map info for ${q}: ${ee}`);continue}C(V,L.method,q,Y||0)}continue}try{de=yield(0,O.lL)(L.options.emContourProvider,w,G,te)}catch(ye){console.info(`Could not get map info for ${te}: ${ye}`);continue}}C(V,L.method,te,de||0)}const U=T.build().to(E).applyOrUpdateTagged(b.h.RootTag,D,{serverUrl:L.options.serverUrl,entries:V});yield U.commit();const N=U.selector;if(!N.isOk)return;const k=T.tree.children.get(N.ref);k?.size>0&&(yield w.managers.structure.hierarchy.remove(k?.toArray()));const H=N.cell.obj,$=T.build().to(U.ref).apply(R,A.t.getDefaultValues(b.h.createParams({data:H.data,defaultView:L.defaultView,channelParams:L.options.channelParams})),{ref:L.options.behaviorRef?L.options.behaviorRef:void 0});"em"===L.method?$.apply(f,{channel:"em"},{state:{isGhost:!0},tags:"em"}):($.apply(f,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),$.apply(f,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),$.apply(f,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),yield T.updateTree($).runInContext(G)});return function(G){return Q.apply(this,arguments)}}())),a=v.KW.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:b.h,isApplicable:E=>"selection-box"===E.data.params.entry.params.view.name})(({a:E,ref:T,state:L},w)=>{const Q=E.data.params;if("selection-box"!==Q.entry.params.view.name)return;const G=l.DJ.create(m.eB.clone(Q.entry.params.view.params.bottomLeft),m.eB.clone(Q.entry.params.view.params.topRight)),V=Q.entry.params.view.params.radius;l.DJ.expand(G,G,m.eB.create(V,V,V));const U={...Q,entry:{name:Q.entry.name,params:{...Q.entry.params,view:{name:"box",params:{bottomLeft:G.min,topRight:G.max}}}}};return L.updateTree(L.build().to(T).update(U))}),S={dataId:A.t.Text(""),source:A.t.MappedStatic("x-ray",{em:A.t.Group({isoValue:i.f.createIsoValueParam(i.f.IsoValue.relative(1))}),"x-ray":A.t.Group({})})},D=o.H.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:o.O.Molecule.Structure,to:r,params:E=>({serverUrl:A.t.Text("https://ds.litemol.org"),entries:A.t.ObjectList(S,({dataId:T})=>T,{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})})})({apply:({a:E,params:T},L)=>y.YZ.create("",function(){var w=(0,e.A)(function*(Q){const G=[];for(let U=0,N=T.entries.length;U<N;++U){const k=T.entries[U],H=k.dataId,$="em"===k.source.name?k.source.params.isoValue:i.f.IsoValue.relative(1);yield Q.update("Getting server header...");const J=yield L.fetch({url:(0,c.r)(T.serverUrl,`${k.source.name}/${H.toLocaleLowerCase()}`),type:"json"}).runInContext(Q);G.push({dataId:H,kind:k.source.name,header:J,emDefaultContourLevel:$})}return new r({serverUrl:T.serverUrl,entries:G,structure:E.data},{label:"Volume Server",description:`${G.map(U=>U.dataId).join(", ")}`})});return function(Q){return w.apply(this,arguments)}}())}),R=o.H.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:r,to:b.h,params:E=>b.h.createParams({data:E&&E.data})})({canAutoUpdate:({oldParams:E,newParams:T})=>E.entry.params.view===T.entry.params.view||"selection-box"===T.entry.params.view.name||"camera-target"===T.entry.params.view.name||"off"===T.entry.params.view.name,apply:({a:E,params:T},L)=>y.YZ.create("Volume streaming",function(){var w=(0,e.A)(function*(Q){const G=new b.h.Behavior(L,E.data);return yield G.update(T),new b.h(G,{label:"Volume Streaming",description:G.getDescription()})});return function(Q){return w.apply(this,arguments)}}()),update:({b:T,oldParams:L,newParams:w})=>y.YZ.create("Update Volume Streaming",function(){var Q=(0,e.A)(function*(G){if(L.entry.name!==w.entry.name&&"em"in w.entry.params.channels){const{emDefaultContourLevel:U}=T.data.infoMap.get(w.entry.name);U&&(w.entry.params.channels.em.isoValue=U)}const V=(yield T.data.update(w))?v.xE.UpdateResult.Updated:v.xE.UpdateResult.Unchanged;return T.description=T.data.getDescription(),V});return function(G){return Q.apply(this,arguments)}}())}),f=o.H.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:b.h,to:o.O.Volume.Representation3D,params:{channel:A.t.Select("em",b.h.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:E,params:T,spine:L},w)=>y.YZ.create("Volume Representation",function(){var Q=(0,e.A)(function*(G){var V,U;const N=E.data.channels[T.channel];if(!N)return v.BM.Null;const k=p(E.data,T.channel),H=M.H.BuiltIn.isosurface,$=k.type.params||{},J=H.factory({webgl:null===(V=w.canvas3d)||void 0===V?void 0:V.webgl,...w.representation.volume.themes},H.getParams);J.setTheme(I.S.create(w.representation.volume.themes,{volume:N.data},k));const W=null===(U=L.getAncestorOfType(o.O.Molecule.Structure))||void 0===U?void 0:U.data,te=0===W?.models.length?void 0:s.T.get(W?.models[0]);return yield J.createOrUpdate($,N.data).runInContext(G),te&&J.setState({transform:te}),new o.O.Volume.Representation3D({repr:J,sourceData:N.data},{label:`${Math.round(100*N.isoValue.relativeValue)/100} \u03c3 [${T.channel}]`})});return function(G){return Q.apply(this,arguments)}}()),update:({a:E,b:T,newParams:L},Q)=>y.YZ.create("Volume Representation",function(){var G=(0,e.A)(function*(V){const U=E.data.channels[L.channel];if(!U)return v.xE.UpdateResult.Unchanged;const N=T.data.repr.state.visible,k=p(E.data,L.channel),H={...T.data.repr.props,...k.type.params};return T.data.repr.setTheme(I.S.create(Q.representation.volume.themes,{volume:U.data},k)),yield T.data.repr.createOrUpdate(H,U.data).runInContext(V),T.data.repr.setState({visible:N}),T.data.sourceData=U.data,v.xE.UpdateResult.Updated});return function(V){return G.apply(this,arguments)}}())});function p(E,T){const L=E.channels[T];return _.VolumeRepresentation3DHelpers.getDefaultParamsStatic(E.plugin,"isosurface",{isoValue:L.isoValue,alpha:L.opacity,visuals:L.wireframe?["wireframe"]:["solid"]},"uniform",{value:L.color})}},6570:(tn,Ue,n)=>{"use strict";n.d(Ue,{$A:()=>b,AR:()=>A,lL:()=>v,rO:()=>i,t9:()=>u});var e=n(467),o=n(9136),r=n(2524),t=n(237);function A(s,C="x-ray"){if(!s)return C;const h=s.models[0];return r.K4.is(h.sourceData)?o.Kx.hasEmMap(h)?"em":o.Kx.hasXrayMap(h)?"x-ray":o.Kx.isFromEm(h)?"em":o.Kx.isFromXray(h)?"x-ray":C:C}function i(s,C){if(!C||!C.models.length)return[];const h=C.models[0];switch(s){case"em":return function y(s){const C=[];if(!r.K4.is(s.sourceData))return[s.entryId];const{db_id:h,db_name:a,content_type:S}=s.sourceData.data.db.pdbx_database_related;if(!a.isDefined)return[s.entryId];for(let D=0,R=a.rowCount;D<R;++D)"EMDB"===a.value(D).toUpperCase()&&"associated EM volume"===S.value(D)&&C.push(h.value(D));return C}(h);case"x-ray":return function c(s){return[s.entryId]}(h)}}function v(s,C,h,a){return O.apply(this,arguments)}function O(){return O=(0,e.A)(function*(s,C,h,a){switch(s){case"emdb":return b(C,h,a);case"pdbe":return function M(s,C,h){return I.apply(this,arguments)}(C,h,a)}}),O.apply(this,arguments)}function b(s,C,h){return _.apply(this,arguments)}function _(){return(_=(0,e.A)(function*(s,C,h){const a=s.config.get(t.AB.VolumeStreaming.EmdbHeaderServer),R=(yield s.fetch({url:`${a}/${h.toUpperCase()}/header/${h.toLowerCase()}.xml`,type:"xml"}).runInContext(C)).getElementsByTagName("map")[0].getElementsByTagName("contour");let f=R[0];for(let E=1;E<R.length;E++)if("true"===R[E].getAttribute("primary")){f=R[E];break}return parseFloat(f.getElementsByTagName("level")[0].textContent)})).apply(this,arguments)}function I(){return I=(0,e.A)(function*(s,C,h){var a,S,D,R;h=h.toUpperCase();const f=yield s.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${h}`,type:"json"}).runInContext(C),p=null===(S=null===(a=f?.map)||void 0===a?void 0:a.contour_list)||void 0===S?void 0:S.contour;return p&&0!==p.length?null!==(R=null===(D=p.find(E=>E.primary))||void 0===D?void 0:D.level)&&void 0!==R?R:p[0].level:function l(s,C,h){return m.apply(this,arguments)}(s,C,h)}),I.apply(this,arguments)}function m(){return(m=(0,e.A)(function*(s,C,h){var a,S,D;h=h.toUpperCase();const R=yield s.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${h}`,type:"json"}).runInContext(C),f=R?.[h];let p;return void 0!==(null===(D=null===(S=null===(a=f?.[0])||void 0===a?void 0:a.map)||void 0===S?void 0:S.contour_level)||void 0===D?void 0:D.value)&&(p=+f[0].map.contour_level.value),p})).apply(this,arguments)}function u(s,C,h){return d.apply(this,arguments)}function d(){return(d=(0,e.A)(function*(s,C,h){var a;const S=yield s.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${h}`,type:"json"}).runInContext(C),D=S?.[h],R=[];if(null===(a=D?.[0])||void 0===a||!a.related_structures)throw new Error(`No related EMDB entry found for '${h}'.`);{const f=D[0].related_structures.filter(p=>"EMDB"===p.resource&&"associated EM volume"===p.relationship);if(!f.length)throw new Error(`No related EMDB entry found for '${h}'.`);R.push(...f.map(p=>p.accession))}return R})).apply(this,arguments)}},1827:(tn,Ue,n)=>{"use strict";n.r(Ue),n.d(Ue,{ApplyAction:()=>m,ClearHighlights:()=>S,Highlight:()=>a,RemoveObject:()=>u,SetCurrentObject:()=>I,Snapshots:()=>D,SyncBehaviors:()=>M,ToggleExpanded:()=>d,ToggleVisibility:()=>s,Update:()=>l,registerDefault:()=>_,setSubtreeVisibility:()=>C});var e=n(467),o=n(9136),r=n(856),t=n(381),A=n(1832),i=n(2732),v=n(5091),O=n(6763),b=n(237);function _(R){M(R),I(R),l(R),m(R),u(R),d(R),s(R),a(R),S(R),D(R)}function M(R){R.state.events.object.created.subscribe(f=>{t.O.isBehavior(f.obj)&&f.obj.data.register(f.ref)}),R.state.events.object.removed.subscribe(f=>{var p,E,T,L;t.O.isBehavior(f.obj)&&(null===(E=(p=f.obj.data).unregister)||void 0===E||E.call(p),null===(L=(T=f.obj.data).dispose)||void 0===L||L.call(T))}),R.state.events.object.updated.subscribe(f=>{var p,E,T,L;"recreate"===f.action&&(f.oldObj&&t.O.isBehavior(f.oldObj)&&(null===(E=(p=f.oldObj.data).unregister)||void 0===E||E.call(p),null===(L=(T=f.oldObj.data).dispose)||void 0===L||L.call(T)),f.obj&&t.O.isBehavior(f.obj)&&f.obj.data.register(f.ref))})}function I(R){O.a.State.SetCurrentObject.subscribe(R,({state:f,ref:p})=>f.setCurrent(p))}function l(R){O.a.State.Update.subscribe(R,({state:f,tree:p,options:E})=>R.runTask(f.updateTree(p,E)))}function m(R){O.a.State.ApplyAction.subscribe(R,({state:f,action:p,ref:E})=>R.runTask(f.applyAction(p.action,p.params,E)))}function u(R){function f(p,E){const T=p.build().delete(E);return R.runTask(p.updateTree(T))}O.a.State.RemoveObject.subscribe(R,({state:p,ref:E,removeParentGhosts:T})=>{if(!T)return f(p,E);{const L=p.tree;let w=L.transforms.get(E);if(w.parent===E)return f(p,E);for(;;){const Q=L.children.get(w.parent);if(w.parent===w.ref||Q.size>1)return f(p,w.ref);const G=L.transforms.get(w.parent);if(!G.state.isGhost)return f(p,w.ref);w=G}}})}function d(R){O.a.State.ToggleExpanded.subscribe(R,({state:f,ref:p})=>f.updateCellState(p,({isCollapsed:E})=>({isCollapsed:!E})))}function s(R){O.a.State.ToggleVisibility.subscribe(R,({state:f,ref:p})=>C(f,p,!f.cells.get(p).state.isHidden))}function C(R,f,p){A.uF.doPreOrder(R.tree,R.transforms.get(f),{state:R,value:p},h)}function h(R,f,p){p.state.updateCellState(R.ref,{isHidden:p.value})}function a(R){O.a.Interactivity.Object.Highlight.subscribe(R,({state:f,ref:p})=>{if(!R.canvas3d||R.isBusy)return;R.managers.interactivity.lociHighlights.clearHighlights();const E="string"==typeof p?[p]:p;for(const T of E){const L=f.cells.get(T);if(L)if(t.O.Molecule.Structure.is(L.obj))R.managers.interactivity.lociHighlights.highlight({loci:o.oE.Loci(L.obj.data)},!1);else if(L&&t.O.isRepresentation3D(L.obj)){const{repr:w}=L.obj.data;for(const Q of w.getAllLoci())R.managers.interactivity.lociHighlights.highlight({loci:Q,repr:w},!1)}else if(t.O.Molecule.Structure.Selections.is(L.obj))for(const w of L.obj.data)R.managers.interactivity.lociHighlights.highlight({loci:w.loci},!1)}})}function S(R){O.a.Interactivity.ClearHighlights.subscribe(R,()=>{R.managers.interactivity.lociHighlights.clearHighlights()})}function D(R){R.config.set(b.AB.State.CurrentServer,R.config.get(b.AB.State.DefaultServer)),O.a.State.Snapshots.Clear.subscribe(R,()=>{R.managers.snapshot.clear()}),O.a.State.Snapshots.Remove.subscribe(R,({id:f})=>{R.managers.snapshot.remove(f)}),O.a.State.Snapshots.Add.subscribe(R,function(){var f=(0,e.A)(function*({key:p,name:E,description:T,params:L}){var w;const Q=R.state.getSnapshot(L),G=(null!==(w=L?.image)&&void 0!==w?w:R.state.snapshotParams.value.image)?yield r.g.getCanvasImageAsset(R,`${Q.id}-image.png`):void 0,V=r.g.Entry(Q,{key:p,name:E,description:T,image:G});R.managers.snapshot.add(V)});return function(p){return f.apply(this,arguments)}}()),O.a.State.Snapshots.Replace.subscribe(R,function(){var f=(0,e.A)(function*({id:p,params:E}){var T;const L=R.state.getSnapshot(E),w=(null!==(T=E?.image)&&void 0!==T?T:R.state.snapshotParams.value.image)?yield r.g.getCanvasImageAsset(R,`${L.id}-image.png`):void 0;R.managers.snapshot.replace(p,R.state.getSnapshot(E),{image:w})});return function(p){return f.apply(this,arguments)}}()),O.a.State.Snapshots.Move.subscribe(R,({id:f,dir:p})=>{R.managers.snapshot.move(f,p)}),O.a.State.Snapshots.Apply.subscribe(R,({id:f})=>{const p=R.managers.snapshot.setCurrent(f);if(p)return R.state.setSnapshot(p)}),O.a.State.Snapshots.Upload.subscribe(R,function(){var f=(0,e.A)(function*({name:p,description:E,playOnLoad:T,serverUrl:L}){return fetch((0,v.r)(L,`set?name=${encodeURIComponent(p||"")}&description=${encodeURIComponent(E||"")}`),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(yield R.managers.snapshot.getStateSnapshot({name:p,description:E,playOnLoad:T}))})});return function(p){return f.apply(this,arguments)}}()),O.a.State.Snapshots.Fetch.subscribe(R,function(){var f=(0,e.A)(function*({url:p}){const E=yield R.runTask(R.fetch({url:p,type:"json"}));yield R.managers.snapshot.setStateSnapshot(E.data)});return function(p){return f.apply(this,arguments)}}()),O.a.State.Snapshots.DownloadToFile.subscribe(R,function(){var f=(0,e.A)(function*({name:p,type:E,params:T}){const L=`mol-star_state_${p||function c(){const R=new Date;return R.getFullYear()+"-"+(R.getMonth()+1)+"-"+R.getDate()+"-"+R.getHours()+"-"+R.getMinutes()+"-"+R.getSeconds()}()}.${"json"===E?"molj":"molx"}`,w=yield R.managers.snapshot.serialize({type:E,params:T});(0,i.R)(w,`${L}`)});return function(p){return f.apply(this,arguments)}}()),O.a.State.Snapshots.OpenFile.subscribe(R,({file:f})=>R.managers.snapshot.open(f)),O.a.State.Snapshots.OpenUrl.subscribe(R,function(){var f=(0,e.A)(function*({url:p,type:E}){const T=yield R.runTask(R.fetch({url:p,type:"binary"}));return R.managers.snapshot.open(new File([T],`state.${E}`))});return function(p){return f.apply(this,arguments)}}())}},6852:(tn,Ue,n)=>{"use strict";n.d(Ue,{K:()=>t,j:()=>r});var e=n(467),o=n(9909);function r(){const A=(y,c)=>y.commands.dispatch(A,c||{});return A.subscribe=(y,c)=>y.commands.subscribe(A,c),A.id=o.kk.create22(),A}class t{constructor(){this.subs=new Map,this.disposing=!1}subscribe(y,c){let i=this.subs.get(y.id);return i||(i=[],this.subs.set(y.id,i)),i.push(c),{unsubscribe:()=>{const v=this.subs.get(y.id);if(!v)return;const O=v.indexOf(c);if(!(O<0)){for(let b=O+1;b<v.length;b++)v[b-1]=v[b];v.pop()}}}}dispatch(y,c){return new Promise((i,v)=>{this.disposing?v("disposed"):this.subs.get(y.id)?this.resolve({cmd:y,params:c,resolve:i,reject:v}):i()})}dispose(){this.subs.clear()}resolve(y){var c=this;return(0,e.A)(function*(){const i=c.subs.get(y.cmd.id);if(i)try{for(const v of i)yield v(y.params);y.resolve()}catch(v){y.reject(v)}else y.resolve()})()}}},6763:(tn,Ue,n)=>{"use strict";n.d(Ue,{a:()=>o});var e=n(6852);const o={State:{SetCurrentObject:(0,e.j)(),ApplyAction:(0,e.j)(),Update:(0,e.j)(),RemoveObject:(0,e.j)(),ToggleExpanded:(0,e.j)(),ToggleVisibility:(0,e.j)(),Snapshots:{Add:(0,e.j)(),Replace:(0,e.j)(),Move:(0,e.j)(),Remove:(0,e.j)(),Apply:(0,e.j)(),Clear:(0,e.j)(),Upload:(0,e.j)(),Fetch:(0,e.j)(),DownloadToFile:(0,e.j)(),OpenFile:(0,e.j)(),OpenUrl:(0,e.j)()}},Interactivity:{Object:{Highlight:(0,e.j)()},Structure:{Highlight:(0,e.j)(),Select:(0,e.j)()},ClearHighlights:(0,e.j)()},Layout:{Update:(0,e.j)()},Toast:{Show:(0,e.j)(),Hide:(0,e.j)()},Camera:{Reset:(0,e.j)(),SetSnapshot:(0,e.j)(),Focus:(0,e.j)(),OrientAxes:(0,e.j)(),ResetAxes:(0,e.j)()},Canvas3D:{SetSettings:(0,e.j)(),ResetSettings:(0,e.j)()}}},237:(tn,Ue,n)=>{"use strict";n.d(Ue,{AB:()=>A,tf:()=>y});var e=n(9136);const o={get preferWebGl1(){if(typeof navigator>"u"||typeof window>"u")return!1;if(["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(b=>navigator.userAgent.indexOf(b)>0))return!0;const i=/iPad|iPhone|iPod/.test(navigator.userAgent),v=navigator.userAgent.includes("Macintosh"),O=navigator.maxTouchPoints>=4;return!window.MSStream&&(i||v&&O)}};class r{toString(){return this.key}valueOf(){return this.key}constructor(i,v){this.key=i,this.defaultValue=v}}function t(c,i){return new r(c,i)}const A={item:t,General:{IsBusyTimeoutMs:t("plugin-config.is-busy-timeout",750),DisableAntialiasing:t("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:t("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:t("plugin-config.pixel-scale",1),PickScale:t("plugin-config.pick-scale",.25),Transparency:t("plugin-config.transparency","wboit"),PreferWebGl1:t("plugin-config.prefer-webgl1",o.preferWebGl1),AllowMajorPerformanceCaveat:t("plugin-config.allow-major-performance-caveat",!1),PowerPreference:t("plugin-config.power-preference","high-performance")},State:{DefaultServer:t("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:t("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:t("history-capacity.server",5)},VolumeStreaming:{Enabled:t("volume-streaming.enabled",!0),DefaultServer:t("volume-streaming.server","https://ds.litemol.org"),CanStream:t("volume-streaming.can-stream",(c,i)=>1===c.models.length&&e.Kx.probablyHasDensityMap(c.models[0])),EmdbHeaderServer:t("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:t("viewer.show-expand-button",!0),ShowControls:t("viewer.show-controls-button",!0),ShowSettings:t("viewer.show-settings-button",!0),ShowSelectionMode:t("viewer.show-selection-model-button",!0),ShowAnimation:t("viewer.show-animation-button",!0),ShowTrajectoryControls:t("viewer.show-trajectory-controls",!0)},Download:{DefaultPdbProvider:t("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:t("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:t("structure.size-thresholds",e.oE.DefaultSizeThresholds),DefaultRepresentationPreset:t("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:t("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:t("structure.saccharide-comp-id-map-type","default")},Background:{Styles:t("background.styles",[])}};class y{get(i){return this._config.has(i)?this._config.get(i):i.defaultValue}set(i,v){this._config.set(i,v)}delete(i){this._config.delete(i)}constructor(i){this._config=new Map,i&&i.forEach(([v,O])=>this._config.set(v,O))}}},2768:(tn,Ue,n)=>{"use strict";n.d(Ue,{p:()=>M});var I,e=n(467),o=n(1832),r=n(381),t=n(4987),A=n(3177),y=n(6763),c=n(8277),i=n(9909),v=n(1025),O=n(7786),b=n(3182),_=n(237);class M extends b.N{get animation(){return this.plugin.managers.animation}getSnapshot(l){var m,u,d;const s={...this.snapshotParams.value,...l};return{id:i.kk.create22(),data:s.data?this.data.getSnapshot():void 0,behaviour:s.behavior?this.behaviors.getSnapshot():void 0,animation:s.animation?this.animation.getSnapshot():void 0,startAnimation:s.startAnimation?!!s.startAnimation:void 0,camera:s.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:s.cameraTransition.name,transitionDurationInMs:"animate"===(null===(m=s?.cameraTransition)||void 0===m?void 0:m.name)?s.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:s.canvas3dContext?{props:null===(u=this.plugin.canvas3dContext)||void 0===u?void 0:u.props}:void 0,canvas3d:s.canvas3d?{props:null===(d=this.plugin.canvas3d)||void 0===d?void 0:d.props}:void 0,interactivity:s.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:s.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:s.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:s?.durationInMs}}setSnapshot(l){var m=this;return(0,e.A)(function*(){var u,d,s,C,h;if(yield m.animation.stop(),!(null===(u=l.structureComponentManager)||void 0===u)&&u.options&&m.plugin.managers.structure.component._setSnapshotState(null===(d=l.structureComponentManager)||void 0===d?void 0:d.options),l.behaviour&&(yield m.plugin.runTask(m.behaviors.setSnapshot(l.behaviour))),l.data&&(yield m.plugin.runTask(m.data.setSnapshot(l.data))),null!==(s=l.canvas3d)&&void 0!==s&&s.props){const a=c.t.normalizeParams(A._i,l.canvas3d.props,"children");yield y.a.Canvas3D.SetSettings(m.plugin,{settings:a})}if(null!==(C=l.canvas3dContext)&&void 0!==C&&C.props){const a=c.t.normalizeParams(A.H7.Params,l.canvas3dContext.props,"children");null===(h=m.plugin.canvas3dContext)||void 0===h||h.setProps(a)}l.interactivity&&l.interactivity.props&&m.plugin.managers.interactivity.setProps(l.interactivity.props),l.structureFocus&&m.plugin.managers.structure.focus.setSnapshot(l.structureFocus),l.structureSelection&&m.plugin.managers.structure.selection.setSnapshot(l.structureSelection),l.animation&&m.animation.setSnapshot(l.animation),l.camera&&y.a.Camera.Reset(m.plugin,{snapshot:l.camera.current,durationMs:"animate"===l.camera.transitionStyle?l.camera.transitionDurationInMs:void 0}),l.startAnimation&&m.animation.start()})()}updateTransform(l,m,u,d){const s=l.build().to(m).update(u);return y.a.State.Update(this.plugin,{state:l,tree:s,options:{canUndo:d}})}hasBehavior(l){return this.behaviors.tree.transforms.has(l.id)}updateBehavior(l,m){const u=this.behaviors.build();if(this.behaviors.tree.transforms.has(l.id))u.to(l.id).update(m);else{const d=l.createDefaultParams(void 0,this.plugin);u.to(t.AF.getCategoryId(l)).apply(l,(0,v.jM)(d,m),{ref:l.id})}return this.plugin.runTask(this.behaviors.updateTree(u))}dispose(){this.behaviors.cells.forEach(l=>{var m,u,d,s;t.AF.Behavior.is(l.obj)&&(null===(u=(m=l.obj.data).unregister)||void 0===u||u.call(m),null===(s=(d=l.obj.data).dispose)||void 0===s||s.call(d))}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}constructor(l){super(),this.plugin=l,this.data=o.Uw.create(new r.O.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(_.AB.State.HistoryCapacity)}),this.behaviors=o.Uw.create(new t.AF.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}}),this.events={cell:{stateUpdated:(0,O.h)(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:(0,O.h)(this.data.events.cell.created,this.behaviors.events.cell.created),removed:(0,O.h)(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:(0,O.h)(this.data.events.object.created,this.behaviors.events.object.created),removed:(0,O.h)(this.data.events.object.removed,this.behaviors.events.object.removed),updated:(0,O.h)(this.data.events.object.updated,this.behaviors.events.object.updated)}},this.snapshotParams=this.ev.behavior(M.DefaultSnapshotParams),this.setSnapshotParams=m=>{this.snapshotParams.next({...M.DefaultSnapshotParams,...m})}}}(I=M||(M={})).SnapshotParams={durationInMs:c.t.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:c.t.Boolean(!0),behavior:c.t.Boolean(!1),structureSelection:c.t.Boolean(!1),componentManager:c.t.Boolean(!0),animation:c.t.Boolean(!0),startAnimation:c.t.Boolean(!1),canvas3d:c.t.Boolean(!0),canvas3dContext:c.t.Boolean(!0),interactivity:c.t.Boolean(!0),camera:c.t.Boolean(!0),cameraTransition:c.t.MappedStatic("animate",{animate:c.t.Group({durationInMs:c.t.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:c.t.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:c.t.Boolean(!1)},I.DefaultSnapshotParams=c.t.getDefaultValues(I.SnapshotParams)},6101:(tn,Ue,n)=>{"use strict";n.d(Ue,{j:()=>e,s:()=>o});var e="4.3.0",o=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1716707835175)},2443:(tn,Ue,n)=>{"use strict";n.d(Ue,{YL:()=>R,lN:()=>D});var h,e=n(467),o=n(8277),r=n(274),t=n(2832),A=n(1930),y=n(1413),c=n(4824),i=n(6825),v=n(3246),O=n(261),b=n(1965),_=n(4369),M=n(5589),I=n(5019),l=n(5117),m=n(7981),u=n(9986),d=n(8382),s=n(9213),C=n(3488);(h||(h={})).getDetaultParams=function p(E,T,L){return o.t.getDefaultValues(E.getParams(T,L))};const a={name:"",label:"",description:"",factory:()=>R.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:r.J.EmptyProvider,defaultSizeTheme:t.F.EmptyProvider,isApplicable:()=>!0};function S(f){return f.map(p=>[p.name,p.provider.label])}class D{get default(){return this._list[0]}get types(){return S(this._list)}constructor(){this._list=[],this._map=new Map,this._name=new Map}add(p){if(this._map.has(p.name))throw new Error(`${p.name} already registered.`);this._list.push({name:p.name,provider:p}),this._map.set(p.name,p),this._name.set(p,p.name)}getName(p){if(!this._name.has(p))throw new Error(`'${p.label}' is not a registered represenatation provider.`);return this._name.get(p)}remove(p){const E=p.name;this._list.splice(this._list.findIndex(L=>L.name===E),1);const T=this._map.get(E);T&&(this._map.delete(E),this._name.delete(T))}get(p){return this._map.get(p)||a}get list(){return this._list}getApplicableList(p){return this._list.filter(E=>E.provider.isApplicable(p))}getApplicableTypes(p){return S(this.getApplicableList(p))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}}var R;!function(f){let p;var G;function E(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:_.$I.identity(),overpaint:O.l.Empty,transparency:b.x.Empty,emissive:C.a.Empty,substance:s.l.Empty,clipping:m.l.Empty,themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1},markerActions:i.sY.All}}function T(G,V){void 0!==V.visible&&(G.visible=V.visible),void 0!==V.alphaFactor&&(G.alphaFactor=V.alphaFactor),void 0!==V.pickable&&(G.pickable=V.pickable),void 0!==V.colorOnly&&(G.colorOnly=V.colorOnly),void 0!==V.overpaint&&(G.overpaint=V.overpaint),void 0!==V.transparency&&(G.transparency=V.transparency),void 0!==V.emissive&&(G.emissive=V.emissive),void 0!==V.substance&&(G.substance=V.substance),void 0!==V.clipping&&(G.clipping=V.clipping),void 0!==V.themeStrength&&(G.themeStrength=V.themeStrength),void 0!==V.syncManually&&(G.syncManually=V.syncManually),void 0!==V.transform&&_.$I.copy(G.transform,V.transform),void 0!==V.markerActions&&(G.markerActions=V.markerActions)}(G=p=f.Loci||(f.Loci={})).areEqual=function V(N,k){return N.repr===k.repr&&v.QN.areEqual(N.loci,k.loci)},G.isEmpty=function U(N){return v.QN.isEmpty(N.loci)},G.Empty={loci:v.BL},f.createState=E,f.updateState=T,f.StateBuilder={create:E,update:T},f.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new y.B,state:E(),theme:A.S.createEmpty(),createOrUpdate:()=>c.YZ.constant("",void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>v.BL,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}};class L{constructor(){this.curr=new Set,this.next=new Set,this._version=-1}get version(){return this._version}add(V,U){this.next.add((0,d.m1)(V,U))}snapshot(){u.M.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}f.GeometryState=L,f.createMulti=function w(G,V,U,N,k){let H=0;const $=new y.B,J=new L,W=N.create();let de,ye,j,te=A.S.createEmpty();const Z={},q=Object.keys(k).map((Y,ee)=>{Z[ee]=Y;const g=k[Y](V,U);return g.setState(W),g});return{label:G,updated:$,get groupCount(){let Y=0;if(ye){const{visuals:ee}=ye;for(let g=0,_e=q.length;g<_e;++g)(!ee||ee.includes(Z[g]))&&(Y+=q[g].groupCount)}return Y},get renderObjects(){const Y=[];if(ye){const{visuals:ee}=ye;for(let g=0,_e=q.length;g<_e;++g)(!ee||ee.includes(Z[g]))&&Y.push(...q[g].renderObjects)}return Y},get geometryVersion(){return J.version},get props(){return ye},get params(){return de},createOrUpdate:(Y={},ee)=>{ee&&ee!==j&&(de=U(V,ee),j=ee,ye||(ye=o.t.getDefaultValues(de)));const g=(0,M.m$)(Object.assign({},ye,Y),j);Object.assign(ye,Y,g);const{visuals:_e}=ye;return c.YZ.create(`Creating or updating '${G}' representation`,function(){var xe=(0,e.A)(function*(le){for(let Ae=0,Be=q.length;Ae<Be;++Ae)(!_e||_e.includes(Z[Ae]))&&(yield q[Ae].createOrUpdate(ye,j).runInContext(le)),J.add(Ae,q[Ae].geometryVersion);J.snapshot(),$.next(H++)});return function(le){return xe.apply(this,arguments)}}())},get state(){return W},get theme(){return te},getLoci:Y=>{const{visuals:ee}=ye;for(let g=0,_e=q.length;g<_e;++g)if(!ee||ee.includes(Z[g])){const xe=q[g].getLoci(Y);if(!(0,v.$M)(xe))return xe}return v.BL},getAllLoci:()=>{const Y=[],{visuals:ee}=ye;for(let g=0,_e=q.length;g<_e;++g)(!ee||ee.includes(Z[g]))&&Y.push(...q[g].getAllLoci());return Y},eachLocation:Y=>{const{visuals:ee}=ye;for(let g=0,_e=q.length;g<_e;++g)(!ee||ee.includes(Z[g]))&&q[g].eachLocation(Y)},mark:(Y,ee)=>{let g=!1;for(let _e=0,xe=q.length;_e<xe;++_e)g=q[_e].mark(Y,ee)||g;return g},setState:Y=>{N.update(W,Y);for(let ee=0,g=q.length;ee<g;++ee)q[ee].setState(Y)},setTheme:Y=>{te=Y;for(let ee=0,g=q.length;ee<g;++ee)q[ee].setTheme(Y)},destroy(){for(let Y=0,ee=q.length;Y<ee;++Y)q[Y].destroy()}}},f.fromRenderObject=function Q(G,V){let U=0;const N=new y.B,k=new L,H=f.createState(),$=A.S.createEmpty(),J=o.t.clone(I.iy.Params),W=o.t.getDefaultValues(I.iy.Params);return{label:G,updated:N,get groupCount(){return V.values.uGroupCount.ref.value},get renderObjects(){return[V]},get geometryVersion(){return k.version},get props(){return W},get params(){return J},createOrUpdate:(te={})=>{const de=(0,M.m$)(Object.assign({},W,te));return Object.assign(W,te,de),c.YZ.create(`Updating '${G}' representation`,function(){var ye=(0,e.A)(function*(j){k.add(0,V.id),k.snapshot(),N.next(U++)});return function(j){return ye.apply(this,arguments)}}())},get state(){return H},get theme(){return $},getLoci:()=>v.BL,getAllLoci:()=>[],eachLocation:()=>{},mark:(te,de)=>!1,setState:te=>{void 0!==te.visible&&l.b.setVisibility(V,te.visible),void 0!==te.alphaFactor&&l.b.setAlphaFactor(V,te.alphaFactor),void 0!==te.pickable&&l.b.setPickable(V,te.pickable),void 0!==te.colorOnly&&l.b.setColorOnly(V,te.colorOnly),void 0!==te.themeStrength&&l.b.setThemeStrength(V,te.themeStrength),void 0!==te.transform&&l.b.setTransform(V,te.transform),f.updateState(H,te)},setTheme:()=>{},destroy(){}}}}(R||(R={}))},6600:(tn,Ue,n)=>{"use strict";n.d(Ue,{$:()=>A,w:()=>t});var e=n(8277),o=n(2745),r=n(4255);const t={customText:e.t.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:e.t.Color(o.s.black,{isEssential:!0}),textSize:e.t.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},A={...r.E.Params,...t,borderWidth:e.t.Numeric(.2,{min:0,max:.5,step:.01})}},1137:(tn,Ue,n)=>{"use strict";n.d(Ue,{K:()=>u});var e=n(467),o=n(8277),r=n(1758),t=n(2443),A=n(9136),y=n(1413),c=n(8353),i=n(1930),v=n(4824),O=n(3246),b=n(6825),_=n(261),M=n(7981),I=n(1965),l=n(9213),m=n(3488);function u(d,s,C,h){let a=0;const{webgl:S}=s,D=new y.B,R=new t.YL.GeometryState,f=(0,c.Q0)(),p=[],E=r.J1.create();let T,L,w,Q,G=i.S.createEmpty();function $(te){if(r.J1.update(E,te),void 0!==te.visible&&T&&T.setVisibility(te.visible&&(null===E.unitTransforms||E.unitTransforms.isIdentity)),void 0!==te.alphaFactor&&T&&T.setAlphaFactor(te.alphaFactor),void 0!==te.pickable&&T&&T.setPickable(te.pickable),void 0!==te.overpaint&&T){const de=_.l.remap(te.overpaint,L);T.setOverpaint(de,S)}if(void 0!==te.transparency&&T){const de=I.x.remap(te.transparency,L);T.setTransparency(de,S)}if(void 0!==te.emissive&&T){const de=m.a.remap(te.emissive,L);T.setEmissive(de,S)}if(void 0!==te.substance&&T){const de=l.l.remap(te.substance,L);T.setSubstance(de,S)}if(void 0!==te.clipping&&T){const de=M.l.remap(te.clipping,L);T.setClipping(de)}void 0!==te.themeStrength&&T&&T.setThemeStrength(te.themeStrength),void 0!==te.transform&&T&&T.setTransform(te.transform),void 0!==te.unitTransforms&&T&&T.setVisibility(E.visible&&(null===te.unitTransforms||te.unitTransforms.isIdentity))}return{label:d,get groupCount(){return T?T.groupCount:0},get props(){return Q},get params(){return w},get state(){return E},get theme(){return G},get geometryVersion(){return R.version},renderObjects:p,updated:D,createOrUpdate:function V(te={},de){return de&&de!==L&&(w=C(s,de),L=de,Q||(Q=o.t.getDefaultValues(w))),Q=Object.assign({},Q,te),v.YZ.create("Creating or updating ComplexRepresentation",function(){var ye=(0,e.A)(function*(j){var Z;let q=!1;T?null!==(Z=T.mustRecreate)&&void 0!==Z&&Z.call(T,L,Q,S)&&(T.destroy(),T=h(f,L,Q,S),q=!0):(T=h(f,L,Q,S),q=!0);const Y=T.createOrUpdate({webgl:S,runtime:j},G,Q,de);Y&&(yield Y),q&&$(E),p.length=0,T&&T.renderObject&&(p.push(T.renderObject),R.add(T.renderObject.id,T.geometryVersion)),R.snapshot(),a+=1,D.next(a)});return function(j){return ye.apply(this,arguments)}}())},setState:$,setTheme:function J(te){G=te},getLoci:function U(te){return T?T.getLoci(te):O.BL},getAllLoci:function N(){var te;return[A.oE.Loci(null!==(te=L.child)&&void 0!==te?te:L)]},eachLocation:function k(te){T?.eachLocation(te)},mark:function H(te,de){if(!L||!b.sY.is(E.markerActions,de))return!1;if(A.oE.isLoci(te)||A.iZ.Loci.is(te)||A.gn.isLoci(te)){if(!A.oE.areRootsEquivalent(te.structure,L))return!1;te=O.QN.remap(te,L),(A.oE.isLoci(te)||A.iZ.Loci.is(te)&&A.iZ.Loci.isWholeStructure(te))&&(te=O.FE)}else if(!(0,O.xc)(te)&&!(0,O.e4)(te))return!1;return!O.QN.isEmpty(te)&&!!T&&T.mark(te,de)},destroy:function W(){T&&T.destroy()}}}},3892:(tn,Ue,n)=>{"use strict";n.d(Ue,{EN:()=>E,Go:()=>k,Hj:()=>J,I:()=>H,KE:()=>Q,T9:()=>L,UM:()=>G,YD:()=>V,Yl:()=>$,hJ:()=>W,ip:()=>N,wA:()=>T,yd:()=>U,zo:()=>w});var e=n(5117),o=n(9136),r=n(542),t=n(1930),A=n(3596),y=n(8353),c=n(3246),i=n(3543),v=n(5589),O=n(274),b=n(9909),_=n(7684),M=n(2712),I=n(6825),l=n(9283),m=n(283),u=n(5315),d=n(4255),s=n(2832),C=n(9928),h=n(8013),a=n(5201),S=n(799),D=n(1372),R=n(8231);function p(te,de){const{defaultProps:ye,createGeometry:j,createLocationIterator:Z,getLoci:q,eachLocation:Y,setUpdateState:ee,mustRecreate:g,processValues:_e,dispose:xe}=te,{updateValues:le,updateBoundingSphere:Ae,updateRenderableState:Be,createPositionIterator:Ce}=te.geometryUtils,Re=v.rj.create(),ke={loci:c.BL,action:I.xi.None,status:-1};let we,Oe,Se,Ve,ne,be,ie,ue,Ne=Object.assign({},ye),K=t.S.createEmpty(),Te=-1;function ve(Ie){if(Re.createNew){if(ie=Z(Ve,Oe),!Ie)throw new Error("expected geometry to be given");we=function f(te,de,ye,j,Z,q){const{createValues:Y,createRenderableState:ee}=r.V.getUtils(de),_e=Y(de,(0,A.Zk)(),ye,j,Z),xe=ee(Z);return(0,y.o)(de.kind,_e,xe,q)}(0,Ie,ie,Se,Oe,de),ue=Ce(Ie,we.values)}else{if(!we)throw new Error("expected renderObject to be available");if(Re.updateTransform){ie=Z(Ve,Oe);const{instanceCount:Le,groupCount:nt}=ie;Oe.instanceGranularity?(0,h.Km)(Le,"instance",we.values):(0,h.Km)(Le*nt,"groupInstance",we.values)}if(Re.createGeometry){if(!Ie)throw new Error("expected geometry to be given");b.IQ.updateIfChanged(we.values.drawCount,r.V.getDrawCount(Ie)),b.IQ.updateIfChanged(we.values.uVertexCount,r.V.getVertexCount(Ie)),b.IQ.updateIfChanged(we.values.uGroupCount,r.V.getGroupCount(Ie))}(Re.updateTransform||Re.createGeometry)&&(Ae(we.values,Ie||be),ue=Ce(be,we.values)),Re.updateSize&&"uSize"in we.values&&(0,_.v3)(ie,Se.size,we.values),Re.updateColor&&(0,M.D1)(ie,ue,Se.color,we.values),le(we.values,Oe),Be(we.state,Oe)}Ne=Oe,K=Se,ne=Ve,Ie&&(be=Ie,Te+=1)}function ae(Ie,Le,nt){return function ce(Ie){return!!((0,c.xc)(Ie)||o.oE.isLoci(Ie)&&o.oE.areRootsEquivalent(Ie.structure,ne)||o.iZ.Loci.is(Ie)&&o.oE.areRootsEquivalent(Ie.structure,ne)&&o.iZ.Loci.isWholeStructure(Ie))}(Ie)?Le(i.IX.ofBounds(0,Ne.instanceGranularity?ie.instanceCount:ie.groupCount*ie.instanceCount)):Ne.instanceGranularity?function se(Ie,Le,nt){let je=!1;return!(!o.iZ.Loci.is(Ie)&&!o.gn.isLoci(Ie)||!o.oE.areEquivalent(Ie.structure,Le))&&(nt(i.IX.ofSingleton(0))&&(je=!0),je)}(Ie,ne,Le):Y(Ie,ne,Le,nt)}function ge(Ie){we&&_e?.(we.values,be,Ne,K,Ie.webgl)}return{get groupCount(){return ie?ie.count:0},get renderObject(){return ie&&ie.count?we:void 0},get geometryVersion(){return Te},createOrUpdate(Ie,Le,nt={},je){if(function re(Ie,Le,nt){if(!nt&&!ne)throw new Error("missing structure");if(Oe=Object.assign({},Ne,Le),Se=Ie,Ve=nt,v.rj.reset(Re),!we||!ne)return Re.createNew=!0,void(Re.createGeometry=!0);ee(Re,Oe,Ne,Se,K,Ve,ne),o.oE.areEquivalent(Ve,ne)||(Re.createGeometry=!0),o.oE.areHierarchiesEqual(Ve,ne)||(Re.updateTransform=!0,Re.createGeometry=!0),O.J.areEqual(Ie.color,K.color)||(Re.updateColor=!0),(0,b.bD)(Oe.unitKinds,Ne.unitKinds)||(Re.createGeometry=!0),ne.child!==Ve.child&&(Re.createGeometry=!0),Oe.instanceGranularity!==Ne.instanceGranularity&&(Re.updateTransform=!0),Re.updateSize&&!("uSize"in we.values)&&(Re.createGeometry=!0),Re.createGeometry&&(Re.updateColor=!0,Re.updateSize=!0)}(Le,nt,je||ne),Re.createGeometry){const Lt=j(Ie,Ve,Se,Oe,be);if((0,D.$X)(Lt))return Lt.then(Je=>{ve(Je),ge(Ie)});ve(Lt)}else ve();ge(Ie)},getLoci:Ie=>we?q(Ie,ne,we.id):c.BL,eachLocation(Ie){for(ie.reset();ie.hasNext;){const{location:Le,isSecondary:nt}=ie.move();Ie(Le,nt)}},mark:(Ie,Le)=>e.b.mark(we,Ie,Le,ae,ke),setVisibility(Ie){e.b.setVisibility(we,Ie)},setAlphaFactor(Ie){e.b.setAlphaFactor(we,Ie)},setPickable(Ie){e.b.setPickable(we,Ie)},setColorOnly(Ie){e.b.setColorOnly(we,Ie)},setTransform(Ie,Le){e.b.setTransform(we,Ie,Le)},setOverpaint(Ie,Le){e.b.setOverpaint(we,Ie,ae,!0,{geometry:be,props:Ne,webgl:Le})},setTransparency(Ie,Le){e.b.setTransparency(we,Ie,ae,!0,{geometry:be,props:Ne,webgl:Le})},setEmissive(Ie,Le){e.b.setEmissive(we,Ie,ae,!0,{geometry:be,props:Ne,webgl:Le})},setSubstance(Ie,Le){e.b.setSubstance(we,Ie,ae,!0,{geometry:be,props:Ne,webgl:Le})},setClipping(Ie){e.b.setClipping(we,Ie,ae,!0)},setThemeStrength(Ie){e.b.setThemeStrength(we,Ie)},destroy(){xe?.(be),we&&(we.state.disposed=!0,we=void 0)},mustRecreate:g}}const E={...a.nF,...a.a2};function T(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.createGeometry=!0)},geometryUtils:l.e.Utils},de)}const L={...a.Op,...a.a2};function w(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.updateSize=!0)},geometryUtils:R.v.Utils},de)}const Q={...a.DG,...a.a2};function G(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.updateSize=!0)},geometryUtils:m.S.Utils},de)}const V={...a.Rb,...a.a2};function U(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.updateSize=!0)},geometryUtils:u.q.Utils},de)}const N={...a.xl,...a.a2};function k(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.updateSize=!0),j.background!==Z.background&&(ye.createGeometry=!0),j.backgroundMargin!==Z.backgroundMargin&&(ye.createGeometry=!0),j.tether!==Z.tether&&(ye.createGeometry=!0),j.tetherLength!==Z.tetherLength&&(ye.createGeometry=!0),j.tetherBaseWidth!==Z.tetherBaseWidth&&(ye.createGeometry=!0),j.attachment!==Z.attachment&&(ye.createGeometry=!0),j.fontFamily!==Z.fontFamily&&(ye.createGeometry=!0),j.fontQuality!==Z.fontQuality&&(ye.createGeometry=!0),j.fontStyle!==Z.fontStyle&&(ye.createGeometry=!0),j.fontVariant!==Z.fontVariant&&(ye.createGeometry=!0),j.fontWeight!==Z.fontWeight&&(ye.createGeometry=!0)},geometryUtils:d.E.Utils},de)}const H={...a.Vv,...a.a2};function $(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.createGeometry=!0)},geometryUtils:C.E.Utils},de)}const J={...a.MQ,...a.a2};function W(te,de){return p({...te,setUpdateState:(ye,j,Z,q,Y,ee,g)=>{te.setUpdateState(ye,j,Z,q,Y,ee,g),s.F.areEqual(q.size,Y.size)||(ye.createGeometry=!0)},geometryUtils:S.X.Utils},de)}},5201:(tn,Ue,n)=>{"use strict";n.d(Ue,{DG:()=>l,MQ:()=>C,Op:()=>I,R8:()=>b,Rb:()=>u,Vv:()=>s,a2:()=>_,fy:()=>m,nF:()=>M,xl:()=>d});var e=n(9928),o=n(5315),r=n(9283),t=n(5299),A=n(8231),y=n(283),c=n(4255),i=n(799),v=n(8277),O=n(2556);function b(h){return v.t.MultiSelect(h,O.hi,{description:"For which kinds of units/chains to show the representation visuals."})}const _={unitKinds:b(["atomic","spheres"]),includeParent:v.t.Boolean(!1,{isHidden:!0})},M={...r.e.Params},I={...A.v.Params},l={...y.S.Params},m={...t.O.Params},u={...o.q.Params},d={...c.E.Params},s={...e.E.Params},C={...i.X.Params}},1758:(tn,Ue,n)=>{"use strict";n.d(Ue,{GT:()=>c,J1:()=>y,Kp:()=>o.K,TP:()=>t.T});var e=n(2443),o=n(1137),t=(n(3892),n(8688));n(2741);const y={create:()=>({...e.YL.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(i,v)=>{e.YL.updateState(i,v),void 0!==v.unitTransforms&&(i.unitTransforms=v.unitTransforms)}};function c(i){return i}},8688:(tn,Ue,n)=>{"use strict";n.d(Ue,{T:()=>s});var e=n(467),o=n(8277),r=n(1758),t=n(2443),A=n(9136),y=n(1413),c=n(8353),i=n(1930),v=n(4824),O=n(3246),b=n(6825),_=n(261),M=n(1965),I=n(4369),l=n(3543),m=n(7981),u=n(9213),d=n(3488);function s(C,h,a,S){let D=0;const{webgl:R}=h,f=new y.B,p=(0,c.Q0)(),E=[],T=new t.YL.GeometryState,L=r.J1.create();let Q,G,V,U,w=new Map,N=i.S.createEmpty();function te(Z,q,Y){const{visible:ee,alphaFactor:g,pickable:_e,overpaint:xe,transparency:le,emissive:Ae,substance:Be,clipping:Ce,themeStrength:Re,transform:ke,unitTransforms:we}=Y;void 0!==ee&&Z.setVisibility(ee),void 0!==g&&Z.setAlphaFactor(g),void 0!==_e&&Z.setPickable(_e),void 0!==xe&&Z.setOverpaint(xe,R),void 0!==le&&Z.setTransparency(le,R),void 0!==Ae&&Z.setEmissive(Ae,R),void 0!==Be&&Z.setSubstance(Be,R),void 0!==Ce&&Z.setClipping(Ce),void 0!==Re&&Z.setThemeStrength(Re),void 0!==ke&&(ke!==L.transform||!I.$I.areEqual(ke,L.transform,I.p8))&&Z.setTransform(ke),void 0!==we&&(we?Z.setTransform(void 0,we.getSymmetryGroupTransforms(q)):we!==L.unitTransforms&&Z.setTransform(void 0,null))}return{label:C,get groupCount(){let Z=0;return w.forEach(({visual:q})=>{q.renderObject&&(Z+=q.groupCount)}),Z},get geometryVersion(){return T.version},get props(){return U},get params(){return V},get state(){return L},get theme(){return N},renderObjects:E,updated:f,createOrUpdate:function k(Z={},q){return q&&q!==Q&&(V=a(h,q),U||(U=o.t.getDefaultValues(V))),U=Object.assign({},U,Z),v.YZ.create("Creating or updating UnitsRepresentation",function(){var Y=(0,e.A)(function*(ee){var g,_e,xe;if(!Q&&!q)throw new Error("missing structure");if(q&&!Q){G=q.unitSymmetryGroups;for(let le=0;le<G.length;le++){const Ae=G[le],Be=S(p,q,U,R),Ce=Be.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Ae,structure:q});Ce&&(yield Ce),te(Be,Ae,L),w.set(Ae.hashCode,{visual:Be,group:Ae}),ee.shouldUpdate&&(yield ee.update({message:"Creating or updating UnitsVisual",current:le,max:G.length}))}}else if(!q||A.oE.areUnitIdsAndIndicesEqual(q,Q)&&q.child===Q.child)if(q&&q!==Q&&A.oE.areUnitIdsAndIndicesEqual(q,Q)){G=q.unitSymmetryGroups;for(let le=0;le<G.length;le++){const Ae=G[le],Be=w.get(Ae.hashCode);if(!Be)throw new Error(`expected to find visual for hashCode ${Ae.hashCode}`);{let{visual:Ce}=Be;if(null!==(_e=Ce.mustRecreate)&&void 0!==_e&&_e.call(Ce,{group:Ae,structure:q},U,h.webgl)){Ce.destroy(),Ce=S(p,q,U,h.webgl),Be.visual=Ce;const Re=Ce.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Ae,structure:q});Re&&(yield Re),te(Ce,Ae,L)}else{const Re=Ce.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Ae,structure:q});Re&&(yield Re)}Be.group=Ae}ee.shouldUpdate&&(yield ee.update({message:"Creating or updating UnitsVisual",current:le,max:G.length}))}}else{const le=[];w.forEach(Ae=>le.push(Ae));for(let Ae=0,Be=le.length;Ae<Be;++Ae){let{visual:Ce,group:Re}=le[Ae];if(null!==(xe=Ce.mustRecreate)&&void 0!==xe&&xe.call(Ce,{group:Re,structure:Q},U,h.webgl)){Ce.destroy(),Ce=S(p,Q,U,R),le[Ae].visual=Ce;const ke=Ce.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Re,structure:Q});ke&&(yield ke),te(Ce,Re,L)}else{const ke=Ce.createOrUpdate({webgl:R,runtime:ee},N,U);ke&&(yield ke)}ee.shouldUpdate&&(yield ee.update({message:"Creating or updating UnitsVisual",current:Ae,max:Be}))}}else{G=q.unitSymmetryGroups;const le=w;w=new Map;for(let Ae=0;Ae<G.length;Ae++){const Be=G[Ae],Ce=le.get(Be.hashCode);if(Ce){let{visual:Re}=Ce;if(null!==(g=Re.mustRecreate)&&void 0!==g&&g.call(Re,{group:Be,structure:q},U,R)){Re.destroy(),Re=S(p,q,U,R);const ke=Re.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Be,structure:q});ke&&(yield ke),te(Re,Be,L)}else{const ke=Re.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Be,structure:q});ke&&(yield ke)}if(w.set(Be.hashCode,{visual:Re,group:Be}),le.delete(Be.hashCode),Re.renderObject){const ke=Re.renderObject.values.tMarker.ref.value.array;(0,b.BH)(ke,l.IX.ofBounds(0,ke.length),b.xi.RemoveHighlight)}}else{const Re=S(p,q,U,R),ke=Re.createOrUpdate({webgl:R,runtime:ee},N,U,{group:Be,structure:q});ke&&(yield ke),te(Re,Be,L),w.set(Be.hashCode,{visual:Re,group:Be})}ee.shouldUpdate&&(yield ee.update({message:"Creating or updating UnitsVisual",current:Ae,max:G.length}))}le.forEach(({visual:Ae})=>{Ae.destroy()})}E.length=0,w.forEach(({visual:le})=>{le.renderObject&&(E.push(le.renderObject),T.add(le.renderObject.id,le.geometryVersion))}),T.snapshot(),q&&(Q=q),f.next(D++)});return function(ee){return Y.apply(this,arguments)}}())},setState:function de(Z){const{visible:q,alphaFactor:Y,pickable:ee,overpaint:g,transparency:_e,emissive:xe,substance:le,clipping:Ae,themeStrength:Be,transform:Ce,unitTransforms:Re,syncManually:ke,markerActions:we}=Z,Oe={};void 0!==q&&(Oe.visible=q),void 0!==Y&&(Oe.alphaFactor=Y),void 0!==ee&&(Oe.pickable=ee),void 0!==g&&Q&&(Oe.overpaint=_.l.remap(g,Q)),void 0!==_e&&Q&&(Oe.transparency=M.x.remap(_e,Q)),void 0!==xe&&Q&&(Oe.emissive=d.a.remap(xe,Q)),void 0!==le&&Q&&(Oe.substance=u.l.remap(le,Q)),void 0!==Ae&&Q&&(Oe.clipping=m.l.remap(Ae,Q)),void 0!==Be&&(Oe.themeStrength=Be),void 0!==Ce&&!I.$I.areEqual(Ce,L.transform,I.p8)&&(Oe.transform=Ce),(Re!==L.unitTransforms||Re?.version!==L.unitTransformsVersion)&&(Oe.unitTransforms=Re,L.unitTransformsVersion=Re?Re?.version:-1),void 0!==ke&&(Oe.syncManually=ke),void 0!==we&&(Oe.markerActions=we),w.forEach(({visual:Se,group:Ve})=>te(Se,Ve,Oe)),r.J1.update(L,Oe)},setTheme:function ye(Z){N=Z},getLoci:function H(Z){let q=O.BL;return w.forEach(({visual:Y})=>{const ee=Y.getLoci(Z);(0,O.$M)(ee)||(q=ee)}),q},getAllLoci:function J(){var Z;return[A.oE.Loci(null!==(Z=Q.child)&&void 0!==Z?Z:Q)]},eachLocation:function $(Z){w.forEach(({visual:q})=>{q.eachLocation(Z)})},mark:function W(Z,q){if(!Q||!b.sY.is(L.markerActions,q))return!1;if(A.oE.isLoci(Z)||A.iZ.Loci.is(Z)||A.gn.isLoci(Z)){if(!A.oE.areRootsEquivalent(Z.structure,Q))return!1;Z=O.QN.remap(Z,Q),(A.oE.isLoci(Z)||A.iZ.Loci.is(Z)&&A.iZ.Loci.isWholeStructure(Z))&&(Z=O.FE)}else if(!(0,O.xc)(Z)&&!(0,O.e4)(Z))return!1;if(O.QN.isEmpty(Z))return!1;let Y=!1;return w.forEach(({visual:ee})=>{Y=ee.mark(Z,q)||Y}),Y},destroy:function j(){w.forEach(({visual:Z})=>Z.destroy()),w.clear()}}}},2741:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ny:()=>W,O$:()=>ye,PJ:()=>U,Pi:()=>te,Pv:()=>L,Te:()=>T,Vb:()=>V,fm:()=>N,ii:()=>de,lm:()=>G,qg:()=>w,uF:()=>Q,zK:()=>H,zj:()=>k});var e=n(9136),o=n(5117),r=n(542),t=n(1930),A=n(2556),y=n(8353),c=n(3246),i=n(3543),v=n(5589),O=n(274),b=n(8013),_=n(6825),M=n(9909),I=n(7684),l=n(2712),m=n(9283),u=n(2832),d=n(8231),s=n(283),C=n(5299),h=n(5315),S=(n(4255),n(9928)),D=n(799),R=n(5201),f=n(1372);function E(j,Z){const{defaultProps:q,createGeometry:Y,createLocationIterator:ee,getLoci:g,eachLocation:_e,setUpdateState:xe,mustRecreate:le,processValues:Ae,dispose:Be}=j,{createEmpty:Ce,updateValues:Re,updateBoundingSphere:ke,updateRenderableState:we,createPositionIterator:Oe}=j.geometryUtils,Se=v.rj.create(),Ve={loci:c.BL,action:_.xi.None,status:-1};let Ne,be,Te,ie,ue,re,ce,se,K=Object.assign({},q),ne=t.S.createEmpty(),ve=-1;function ge(Je){if(Se.createNew){if(ce=ee(be,K),!Je)throw new Error("expected geometry to be given");Ne=function p(j,Z,q,Y,ee,g){const{createValues:_e,createRenderableState:xe}=r.V.getUtils(Z),Ae=_e(Z,(0,A.yS)(j,ee.includeParent,Z.boundingSphere,ee.cellSize,ee.batchSize),q,Y,ee),Be=xe(ee);return(0,y.o)(Z.kind,Ae,Be,g)}(be,Je,ce,ne,K,Z),se=Oe(Je,Ne.values)}else{if(!Ne)throw new Error("expected renderObject to be available");if(Se.updateTransform){ce=ee(be,K);const{instanceCount:en,groupCount:Bt}=ce;K.instanceGranularity?(0,b.Km)(en,"instance",Ne.values):(0,b.Km)(en*Bt,"groupInstance",Ne.values)}if(Se.updateMatrix&&((0,A.yS)(be,K.includeParent,Ne.values.invariantBoundingSphere.ref.value,K.cellSize,K.batchSize,Ne.values),"lodLevels"in Ne.values&&M.IQ.update(Ne.values.lodLevels,Ne.values.lodLevels.ref.value)),Se.createGeometry){if(!Je)throw new Error("expected geometry to be given");M.IQ.updateIfChanged(Ne.values.drawCount,r.V.getDrawCount(Je)),M.IQ.updateIfChanged(Ne.values.uVertexCount,r.V.getVertexCount(Je)),M.IQ.updateIfChanged(Ne.values.uGroupCount,r.V.getGroupCount(Je))}(Se.updateTransform||Se.createGeometry)&&(ke(Ne.values,Je||re),se=Oe(Je||re,Ne.values)),Se.updateSize&&"uSize"in Ne.values&&(0,I.v3)(ce,ne.size,Ne.values),Se.updateColor&&(0,l.D1)(ce,se,ne.color,Ne.values),Re(Ne.values,K),we(Ne.state,K)}Te=K,ie=ne,ue=be,Je&&(re=Je,ve+=1)}function je(Je,en,Bt){return function Le(Je){return!!((0,c.xc)(Je)||e.oE.isLoci(Je)&&e.oE.areRootsEquivalent(Je.structure,ue.structure)||e.iZ.Loci.is(Je)&&e.oE.areRootsEquivalent(Je.structure,ue.structure)&&e.iZ.Loci.isWholeStructure(Je))}(Je)?en(i.IX.ofBounds(0,Te.instanceGranularity?ce.instanceCount:ce.groupCount*ce.instanceCount)):Te.instanceGranularity?function nt(Je,en,Bt){let pn=!1;if(e.gn.isLoci(Je)){const{structure:$e,group:mt}=en;if(!e.oE.areEquivalent(Je.structure,$e))return!1;for(const _t of Je.bonds){if(_t.aUnit!==_t.bUnit)continue;const Me=mt.unitIndexMap.get(_t.aUnit.id);void 0!==Me&&Bt(i.IX.ofSingleton(Me))&&(pn=!0)}}else if(e.iZ.Loci.is(Je)){const{structure:$e,group:mt}=en;if(!e.oE.areEquivalent(Je.structure,$e))return!1;for(const _t of Je.elements){const Me=mt.unitIndexMap.get(_t.unit.id);void 0!==Me&&Bt(i.IX.ofSingleton(Me))&&(pn=!0)}}return pn}(Je,ue,en):_e(Je,ue,en,Bt)}function Lt(Je){Ne&&Ae?.(Ne.values,re,Te,ie,Je.webgl)}return{get groupCount(){return ce?ce.count:0},get renderObject(){return ce&&ce.count?Ne:void 0},get geometryVersion(){return ve},createOrUpdate(Je,en,Bt,pn){if(function ae(Je,en,Bt){if(!Bt&&!ue)throw new Error("missing structureGroup");if(K=en,ne=Je,be=Bt,v.rj.reset(Se),!Ne||!ue)return Se.createNew=!0,void(Se.createGeometry=!0);xe(Se,K,Te,ne,ie,be,ue),e.oE.areHierarchiesEqual(ue.structure,be.structure)||(Se.updateTransform=!0,Se.updateColor=!0,Se.updateSize=!0),O.J.areEqual(ne.color,ie.color)||(Se.updateColor=!0),ue.structure.child!==be.structure.child&&(Se.createGeometry=!0),(K.instanceGranularity!==Te.instanceGranularity||K.cellSize!==Te.cellSize||K.batchSize!==Te.batchSize)&&(Se.updateTransform=!0),(0,M.bD)(K.unitKinds,Te.unitKinds)||(Se.createGeometry=!0),be.group.transformHash!==ue.group.transformHash&&(be.group.units.length!==ue.group.units.length||Se.updateColor?Se.updateTransform=!0:Se.updateMatrix=!0);const pn=be.group.units[0],$e=ue.group.units[0];e.Nf.areOperatorsEqual(pn,$e)||(Se.updateTransform=!0),e.Nf.areConformationsEqual(pn,$e)||(Se.createGeometry=!0),Se.updateTransform&&(Se.updateMatrix=!0),Se.updateSize&&!("uSize"in Ne.values)&&(Se.createGeometry=!0),(Se.createGeometry||Se.updateTransform)&&(ue.structure.hashCode!==be.structure.hashCode&&(Se.updateColor=!0,Se.updateSize=!0),(ne.color.granularity.startsWith("vertex")||Ne.values.dColorType.ref.value.startsWith("vertex")||ne.color.granularity.startsWith("volume")||Ne.values.dColorType.ref.value.startsWith("volume"))&&(Se.updateColor=!0))}(en,Bt,pn||ue),Se.createGeometry){const $e=function Ie(Je,en,Bt,pn,$e,mt){return(0,A.AR)($e.unitKinds,en)?Y(Je,en,Bt,pn,$e,mt):Ce(mt)}(Je,be.group.units[0],be.structure,ne,K,re);if((0,f.$X)($e))return $e.then(mt=>{ge(mt),Lt(Je)});ge($e)}else ge();Lt(Je)},getLoci:Je=>Ne?g(Je,ue,Ne.id):c.BL,eachLocation(Je){for(ce.reset();ce.hasNext;){const{location:en,isSecondary:Bt}=ce.move();Je(en,Bt)}},mark(Je,en){let Bt=!0;if(e.iZ.Loci.is(Je)){Bt=!1;const{invariantId:pn}=ue.group.units[0];for(const $e of Je.elements)if($e.unit.invariantId===pn){Bt=!0;break}}return!!Bt&&o.b.mark(Ne,Je,en,je,Ve)},setVisibility(Je){o.b.setVisibility(Ne,Je)},setAlphaFactor(Je){o.b.setAlphaFactor(Ne,Je)},setPickable(Je){o.b.setPickable(Ne,Je)},setColorOnly(Je){o.b.setColorOnly(Ne,Je)},setTransform(Je,en){o.b.setTransform(Ne,Je,en)},setOverpaint(Je,en){o.b.setOverpaint(Ne,Je,je,!0,{geometry:re,props:Te,webgl:en})},setTransparency(Je,en){o.b.setTransparency(Ne,Je,je,!0,{geometry:re,props:Te,webgl:en})},setEmissive(Je,en){o.b.setEmissive(Ne,Je,je,!0,{geometry:re,props:Te,webgl:en})},setSubstance(Je,en){o.b.setSubstance(Ne,Je,je,!0,{geometry:re,props:Te,webgl:en})},setClipping(Je){o.b.setClipping(Ne,Je,je,!0)},setThemeStrength(Je){o.b.setThemeStrength(Ne,Je)},destroy(){Be?.(re),Ne&&(Ne.state.disposed=!0,Ne=void 0)},mustRecreate:le}}const T={...R.nF,...R.a2};function L(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.createGeometry=!0)},geometryUtils:m.e.Utils},Z)}const w={...R.Op,...R.a2};function Q(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.updateSize=!0)},geometryUtils:d.v.Utils},Z)}const G={...R.DG,...R.a2};function V(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.updateSize=!0)},geometryUtils:s.S.Utils},Z)}const U={...R.fy,...R.a2};function N(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.updateSize=!0)},geometryUtils:C.O.Utils},Z)}const k={...R.Rb,...R.a2};function H(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.updateSize=!0)},geometryUtils:h.q.Utils},Z)}const W={...R.Vv,...R.a2};function te(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.createGeometry=!0)},geometryUtils:S.E.Utils},Z)}const de={...R.MQ,...R.a2};function ye(j,Z){return E({...j,setUpdateState:(q,Y,ee,g,_e,xe,le)=>{j.setUpdateState(q,Y,ee,g,_e,xe,le),u.F.areEqual(g.size,_e.size)||(q.createGeometry=!0)},geometryUtils:D.X.Utils},Z)}},2556:(tn,Ue,n)=>{"use strict";n.d(Ue,{$J:()=>D,AR:()=>s,Dt:()=>h,FC:()=>a,LT:()=>T,R$:()=>G,UQ:()=>V,hi:()=>d,nR:()=>M,oc:()=>L,rS:()=>l,uh:()=>I,v3:()=>Q,yS:()=>m});var e=n(9136),o=n(4369),r=n(3596),t=n(3543),A=n(3246),y=n(2008),c=n(6115),i=n(8277),v=n(9535),O=n(5384),b=n(6948);const _=o.$I.toArray;function M(U,N,k){const{elements:H,model:$}=N;if(-1!==t.CD.indexOf(H,k)){const{index:J,offsets:W}=$.atomicHierarchy.residueAtomSegments,te=J[k],de=[];for(let j=W[te],Z=W[te+1];j<Z;++j){const q=t.CD.indexOf(H,j);-1!==q&&de.push(q)}const ye=t.CD.ofSortedArray(t.SortedArray.ofSortedArray(de));return e.iZ.Loci(U,[{unit:N,indices:ye}])}return A.BL}function I(U,N,k){const{elements:H,model:$}=N,{label_alt_id:J}=$.atomicHierarchy.atoms,W=J.value(k);if(-1!==t.CD.indexOf(H,k)){const{index:te}=$.atomicHierarchy.residueAtomSegments;return l(U,N,te[k],W)}return e.iZ.Loci(U,[])}function l(U,N,k,H){const{elements:$,model:J}=N,{label_alt_id:W}=J.atomicHierarchy.atoms,{offsets:te}=J.atomicHierarchy.residueAtomSegments,de=[];for(let j=te[k],Z=te[k+1];j<Z;++j){const q=t.CD.indexOf($,j);if(-1!==q){const Y=W.value(j);(H===Y||""===Y)&&de.push(q)}}const ye=t.CD.ofSortedArray(t.SortedArray.ofSortedArray(de));return e.iZ.Loci(U,[{unit:N,indices:ye}])}function m(U,N,k,H,$,J){const{child:W}=U.structure,te=N&&W?U.group.units.filter(Z=>W.unitMap.has(Z.id)):U.group.units,de=te.length,ye=16*de,j=J&&J.aTransform.ref.value.length>=ye?J.aTransform.ref.value:new Float32Array(ye);for(let Z=0;Z<de;Z++)_(te[Z].conformation.operator.matrix,j,16*Z);return(0,r.l1)(j,de,k,H,$,J)}const d=i.t.objectToOptions({atomic:{},spheres:{},gaussians:{}});function s(U,N){for(let k=0,H=U.length;k<H;++k)if(e.Nf.isAtomic(N)&&"atomic"===U[k]||e.Nf.isSpheres(N)&&"spheres"===U[k]||e.Nf.isGaussians(N)&&"gaussians"===U[k])return!0;return!1}const C=5e8;function h(U,N,k=C){const H=O.DJ.size((0,o.eB)(),U);o.eB.ceil(H,H),H.sort((te,de)=>de-te);const $=Math.floor(Math.cbrt(k)*Math.cbrt(k)),J=H[0]*H[1];return{area:J,areaCells:Math.ceil(J/(N*N)),maxAreaCells:$}}function a(U,N,k=C){const{area:H,areaCells:$,maxAreaCells:J}=h(U,N.resolution,k),W=$>J?Math.sqrt(H/J):N.resolution;return{...N,resolution:W}}const D={ignoreHydrogens:i.t.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:i.t.Select("all",i.t.arrayToOptions(["all","non-polar"])),traceOnly:i.t.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:i.t.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},f=(i.t.getDefaultValues(D),(0,o.eB)());function p(U,N,k,H){return o.eB.squaredDistance(o.eB.set(f,U,N,k),H)}function T(U,N,k,H){const{ignoreHydrogens:$,ignoreHydrogensVariant:J,traceOnly:W,includeParent:te}=H,de=te?U.root.unitMap.get(N.id):N,ye=te&&de!==N,{x:j,y:Z,z:q}=function S(U){switch(U.kind){case 0:return U.model.atomicConformation;case 1:return U.model.coarseConformation.spheres;case 2:return U.model.coarseConformation.gaussians}}(de),{elements:Y}=de,{center:ee,radius:g}=N.boundary.sphere,xe=(g+11)*(g+11);let le,Ae;if($||W||ye){const we=[],Oe=[];for(let Se=0,Ve=Y.length;Se<Ve;++Se){const Ne=Y[Se];$&&Q(U,de,Ne,J)||W&&!V(de,Ne)||ye&&p(j[Ne],Z[Ne],q[Ne],ee)>xe||(we.push(Ne),Oe.push(Se))}le=t.SortedArray.ofSortedArray(we),Ae=Oe}else le=Y,Ae=(0,c.WE)(new Int32Array(le.length));te&&de!==N&&function E(U,N,k){let H=0;const $=N.length;for(let J=0,W=k.length;J<W;++J){const te=t.SortedArray.indexOfInRange(N,k[J],H,$);-1===te?U[J]=-2:(U[J]=te,H=te)}}(Ae,N.elements,le);const Be={indices:le,x:j,y:Z,z:q,id:Ae},Ce=ye?(0,v.r)(Be):N.boundary,Re=e.iZ.Location.create(U,de);return{position:Be,boundary:Ce,radius:we=>(Re.element=we,k.size(Re))}}function L(U,N,k){const{ignoreHydrogens:H,ignoreHydrogensVariant:$,traceOnly:J,includeParent:W}=k,te=W&&!!U.parent,de=e.iZ.Location.create(U.root),{center:ye,radius:j}=U.boundary.sphere,q=(j+11)*(j+11);let Y,ee,g,_e,xe,le;if(H||J||te){const{getSerialIndex:Re}=U.serialMapping,ke=te?U.root.units:U.units,we=[],Oe=[],Se=[],Ve=[],Ne=[];for(let K=0,ne=ke.length;K<ne;++K){const be=ke[K],{elements:Te,conformation:ie}=be,ue=U.unitMap.get(be.id);de.unit=be;for(let re=0,ve=Te.length;re<ve;++re){const ce=Te[re];if(H&&Q(U,be,ce,$)||J&&!V(be,ce))continue;const se=ie.x(ce),ae=ie.y(ce),ge=ie.z(ce);te&&p(se,ae,ge,ye)>q||(we.push(se),Oe.push(ae),Se.push(ge),de.element=ce,Ve.push(N.size(de)),te?-1===(ue?t.SortedArray.indexOf(ue.elements,ce):-1)?Ne.push(-2):Ne.push(Re(ue,ce)):Ne.push(Re(be,ce)))}}Y=we,ee=Oe,g=Se,_e=Ve,xe=Ne,le=t.CD.ofRange(0,xe.length)}else{const{elementCount:Re}=U,ke=new Float32Array(Re),we=new Float32Array(Re),Oe=new Float32Array(Re),Se=new Float32Array(Re);for(let Ve=0,Ne=0,K=U.units.length;Ve<K;++Ve){const ne=U.units[Ve],{elements:be,conformation:Te}=ne;de.unit=ne;for(let ie=0,ue=be.length;ie<ue;++ie){const re=be[ie],ve=Ne+ie;ke[ve]=Te.x(re),we[ve]=Te.y(re),Oe[ve]=Te.z(re),de.element=re,Se[ve]=N.size(de)}Ne+=be.length}Y=ke,ee=we,g=Oe,_e=Se,xe=(0,c.WE)(new Uint32Array(Re)),le=t.CD.ofRange(0,xe.length)}const Ae={indices:le,x:Y,y:ee,z:g,id:xe};return{position:Ae,boundary:te?(0,v.r)(Ae):U.boundary,radius:Re=>_e[Re]}}const w=y.K9.H;function Q(U,N,k,H){if(e.Nf.isCoarse(N)||N.model.atomicHierarchy.derived.atom.atomicNumber[k]!==w)return!1;if("all"===H)return!0;const $=(0,b.GE)(U,N,t.SortedArray.indexOf(N.elements,k));return!!($&&"polar"===H||!$&&"non-polar"===H)}function G(U,N){return U[N]===w}function V(U,N){if(e.Nf.isCoarse(U))return!0;const k=U.model.atomicHierarchy.atoms.label_atom_id.value(N);return"CA"===k||"BB"===k||"P"===k}},377:(tn,Ue,n)=>{"use strict";n.d(Ue,{C1:()=>f,Lr:()=>_,T9:()=>I,Yz:()=>E,rm:()=>p});var e=n(4369),o=n(8277),r=n(9283),t=n(573),A=n(2802),y=n(5019),c=n(5315),i=n(5821),v=n(283),O=n(1989),b=n(8184);const _={linkScale:o.t.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:o.t.Numeric(1,{min:0,max:2,step:.01}),linkCap:o.t.Boolean(!1),aromaticScale:o.t.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:o.t.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:o.t.Numeric(2,{min:1,max:6,step:1}),dashCount:o.t.Numeric(4,{min:0,max:10,step:1}),dashScale:o.t.Numeric(.8,{min:0,max:2,step:.1}),dashCap:o.t.Boolean(!0),stubCap:o.t.Boolean(!0),radialSegments:o.t.Numeric(16,{min:2,max:56,step:2},y.iy.CustomQualityParamInfo),colorMode:o.t.Select("default",o.t.arrayToOptions(["default","interpolate"]),y.iy.ShadingCategory)},I=(o.t.getDefaultValues(_),{linkScale:o.t.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:o.t.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:o.t.Numeric(2,{min:1,max:6,step:1}),dashCount:o.t.Numeric(4,{min:0,max:10,step:1})}),m=(o.t.getDefaultValues(I),(0,e.eB)()),u=(0,e.eB)(),d=(0,e.eB)(),s=e.eB.create(0,1,0);function C(T,L,w,Q){e.eB.normalize(u,e.eB.sub(u,L,w)),null!==Q?e.eB.sub(d,L,Q):e.eB.copy(d,L),e.eB.normalize(d,d);let G=e.eB.dot(u,d);return 1-Math.abs(G)<1e-5&&(e.eB.set(d,1,0,0),G=e.eB.dot(u,d),1-Math.abs(G)<1e-5&&(e.eB.set(d,0,1,0),G=e.eB.dot(u,d))),e.eB.setMagnitude(u,u,G),e.eB.sub(d,d,u),e.eB.normalize(T,d)}const h=e.eB.scale,a=e.eB.add,S=e.eB.sub,D=e.eB.setMagnitude,R=e.eB.dot;function f(T,L,w,Q){const{linkCount:G,referencePosition:V,position:U,style:N,radius:k,ignore:H,stub:$}=L;if(!G)return{mesh:r.e.createEmpty(Q)};const{linkScale:J,linkSpacing:W,radialSegments:te,linkCap:de,aromaticScale:ye,aromaticSpacing:j,aromaticDashCount:Z,dashCount:q,dashScale:Y,dashCap:ee,stubCap:g}=w,_e=2*te*G*2,xe=t.P.createState(_e,_e/4,Q),le=(0,e.eB)(),Ae=(0,e.eB)(),Be=(0,e.eB)(),Ce=(0,e.eB)();let Re=0;const ke={radiusTop:1,radiusBottom:1,radialSegments:te,topCap:de,bottomCap:de};for(let Se=0,Ve=G;Se<Ve;++Se){if(H&&H(Se))continue;U(le,Ae,Se),a(Ce,Ce,le),a(Ce,Ce,Ae),Re+=2,S(m,Ae,le);const Ne=R(m,s)>0,K=k(Se),ne=N?N(Se):0,be=g&&!!$&&$(Se),[Te,ie]=Ne?[be,de]:[de,be];if(xe.currentGroup=Se,0===ne)ke.radiusTop=ke.radiusBottom=K,ke.topCap=Te,ke.bottomCap=ie,(0,A.y9)(xe,le,Ae,.5,ke);else if(1===ne)ke.radiusTop=ke.radiusBottom=K*Y,ke.topCap=ke.bottomCap=ee,(0,A.GH)(xe,le,Ae,.5,q,be,ke);else if(2===ne||3===ne||4===ne||5===ne||7===ne||8===ne){const ue=2===ne||3===ne?2:4===ne||5===ne?3:1.5,re=K*(J/(.5*ue)),ve=(K-re)*W;if(C(Be,le,Ae,V?V(Se):null),ke.topCap=Te,ke.bottomCap=ie,7===ne||8===ne){ke.radiusTop=ke.radiusBottom=K,(0,A.y9)(xe,le,Ae,.5,ke);const ce=K+ye*K+ye*K*j;D(m,S(m,Ae,le),.5*K),a(le,le,m),S(Ae,Ae,m),ke.radiusTop=ke.radiusBottom=K*ye,ke.topCap=ke.bottomCap=ee,D(Be,Be,ce),S(le,le,Be),S(Ae,Ae,Be),(0,A.GH)(xe,le,Ae,.5,Z,be,ke),8===ne&&(D(Be,Be,2*ce),a(le,le,Be),a(Ae,Ae,Be),(0,A.GH)(xe,le,Ae,.5,Z,be,ke))}else if(3===ne||5===ne){const ce=K+re+J*K*W;D(Be,Be,ce),ke.radiusTop=ke.radiusBottom=K,(0,A.y9)(xe,le,Ae,.5,ke),h(m,m,W*J*.2),a(le,le,m),S(Ae,Ae,m),ke.radiusTop=ke.radiusBottom=re,ke.topCap=Ne?be:ee,ke.bottomCap=Ne?ee:be,D(Be,Be,ce),S(le,le,Be),S(Ae,Ae,Be),(0,A.y9)(xe,le,Ae,.5,ke),3===ue&&(D(Be,Be,2*ce),a(le,le,Be),a(Ae,Ae,Be),(0,A.y9)(xe,le,Ae,.5,ke))}else D(Be,Be,ve),ke.radiusTop=ke.radiusBottom=re,3===ue&&(0,A.y9)(xe,le,Ae,.5,ke),(0,A.Jz)(xe,le,Ae,.5,Be,ke)}else 6===ne&&(h(m,m,.475),a(le,le,m),S(Ae,Ae,m),ke.radiusTop=ke.radiusBottom=K,ke.topCap=Te,ke.bottomCap=ie,(0,A.y9)(xe,le,Ae,.5,ke))}const we=Q?b.f.clone(Q.boundingSphere):void 0,Oe=t.P.getMesh(xe);return 0===Re?{mesh:Oe}:(e.eB.scale(Ce,Ce,1/Re),we&&e.eB.distance(Ce,we.center)/we.radius<.1?{mesh:Oe,boundingSphere:we}:{mesh:Oe})}function p(T,L,w,Q){const{linkCount:G,referencePosition:V,position:U,style:N,radius:k,ignore:H,stub:$}=L;if(!G)return{cylinders:v.S.createEmpty(Q)};const{linkScale:J,linkSpacing:W,linkCap:te,aromaticScale:de,aromaticSpacing:ye,aromaticDashCount:j,dashCount:Z,dashScale:q,dashCap:Y,stubCap:ee,colorMode:g}=w,_e="interpolate"===g,xe=!0===_e?3:2,le=2*G,Ae=O.h.create(le,le/4,Q),Be=(0,e.eB)(),Ce=(0,e.eB)(),Re=(0,e.eB)(),ke=(0,e.eB)(),we=(0,e.eB)();let Oe=0;for(let Ne=0,K=G;Ne<K;++Ne){if(H&&H(Ne))continue;U(Be,Ce,Ne),a(we,we,Be),a(we,we,Ce),Oe+=2;const ne=k(Ne),be=N?N(Ne):0,Te=ee&&!!$&&$(Ne);if(0===be)h(Re,a(Re,Be,Ce),.5),Ae.add(Be[0],Be[1],Be[2],Re[0],Re[1],Re[2],1,te,Te,xe,Ne);else if(1===be)h(Re,a(Re,Be,Ce),.5),Ae.addFixedCountDashes(Be,Re,Z,q,Y,Y,Te,_e,Ne);else if(2===be||3===be||4===be||5===be||7===be||8===be){const ie=2===be||3===be?2:4===be||5===be?3:1.5,ue=J/(.5*ie),re=(ne-ue*ne)*W;if(h(Re,a(Re,Be,Ce),.5),C(ke,Be,Ce,V?V(Ne):null),7===be||8===be){Ae.add(Be[0],Be[1],Be[2],Re[0],Re[1],Re[2],1,te,Te,xe,Ne);const ve=ne+de*ne+de*ne*ye;D(m,S(m,Ce,Be),.5*ne),a(Be,Be,m),D(ke,ke,ve),S(Be,Be,ke),S(Re,Re,ke),Ae.addFixedCountDashes(Be,Re,j,de,Y,Y,Te,_e,Ne),8===be&&(D(ke,ke,2*ve),a(Be,Be,ke),a(Re,Re,ke),Ae.addFixedCountDashes(Be,Re,j,de,Y,Y,Te,_e,Ne))}else 3===be||5===be?(D(ke,ke,ne+ue*ne+J*ne*W),Ae.add(Be[0],Be[1],Be[2],Re[0],Re[1],Re[2],1,te,Te,xe,Ne),D(m,S(m,Be,Re),ne/1.5),S(Be,Be,m),3===ie&&Ae.add(Be[0]+ke[0],Be[1]+ke[1],Be[2]+ke[2],Re[0]+ke[0],Re[1]+ke[1],Re[2]+ke[2],ue,te,Te,xe,Ne),Ae.add(Be[0]-ke[0],Be[1]-ke[1],Be[2]-ke[2],Re[0]-ke[0],Re[1]-ke[1],Re[2]-ke[2],ue,Y,Te,xe,Ne)):(D(ke,ke,re),3===ie&&Ae.add(Be[0],Be[1],Be[2],Re[0],Re[1],Re[2],ue,te,Te,xe,Ne),Ae.add(Be[0]+ke[0],Be[1]+ke[1],Be[2]+ke[2],Re[0]+ke[0],Re[1]+ke[1],Re[2]+ke[2],ue,te,Te,xe,Ne),Ae.add(Be[0]-ke[0],Be[1]-ke[1],Be[2]-ke[2],Re[0]-ke[0],Re[1]-ke[1],Re[2]-ke[2],ue,te,Te,xe,Ne))}else 6===be&&(h(m,S(m,Re,Be),.475),a(Be,Be,m),S(Re,Re,m),Ae.add(Be[0],Be[1],Be[2],Re[0],Re[1],Re[2],1,te,Te,xe,Ne))}const Se=Q?b.f.clone(Q.boundingSphere):void 0,Ve=Ae.getCylinders();return 0===Oe?{cylinders:Ve}:(e.eB.scale(we,we,1/Oe),Se&&e.eB.distance(we,Se.center)/Se.radius<.1?{cylinders:Ve,boundingSphere:Se}:{cylinders:Ve})}function E(T,L,w,Q){const{linkCount:G,referencePosition:V,position:U,style:N,ignore:k}=L;if(!G)return{lines:c.q.createEmpty(Q)};const{linkScale:H,linkSpacing:$,aromaticDashCount:J,dashCount:W}=w,te=2*G,de=i.d.create(te,te/4,Q),ye=(0,e.eB)(),j=(0,e.eB)(),Z=(0,e.eB)(),q=(0,e.eB)(),Y=(0,e.eB)();let ee=0;for(let Ae=0,Be=G;Ae<Be;++Ae){if(k&&k(Ae))continue;U(ye,j,Ae),a(Y,Y,ye),a(Y,Y,j),ee+=2;const Ce=N?N(Ae):0;if(0===Ce)h(Z,a(Z,ye,j),.5),de.add(ye[0],ye[1],ye[2],Z[0],Z[1],Z[2],Ae);else if(1===Ce)h(Z,a(Z,ye,j),.5),de.addFixedCountDashes(ye,Z,W,Ae);else if(2===Ce||3===Ce||4===Ce||5===Ce||7===Ce||8===Ce){const Re=2===Ce||3===Ce?2:4===Ce||5===Ce?3:1.5,we=(1-H/(.5*Re)*1)*$;if(h(Z,a(Z,ye,j),.5),C(q,ye,j,V?V(Ae):null),7===Ce||8===Ce){de.add(ye[0],ye[1],ye[2],Z[0],Z[1],Z[2],Ae);const Oe=4.5*we;D(m,S(m,j,ye),.5*Oe),a(ye,ye,m),D(q,q,Oe),S(ye,ye,q),S(Z,Z,q),de.addFixedCountDashes(ye,Z,J,Ae),8===Ce&&(D(q,q,2*Oe),a(ye,ye,q),a(Z,Z,q),de.addFixedCountDashes(ye,Z,J,Ae))}else 3===Ce||5===Ce?(D(q,q,3*we),de.add(ye[0],ye[1],ye[2],Z[0],Z[1],Z[2],Ae),h(m,S(m,ye,Z),$*H),S(ye,ye,m),3===Re&&de.add(ye[0]+q[0],ye[1]+q[1],ye[2]+q[2],Z[0]+q[0],Z[1]+q[1],Z[2]+q[2],Ae),de.add(ye[0]-q[0],ye[1]-q[1],ye[2]-q[2],Z[0]-q[0],Z[1]-q[1],Z[2]-q[2],Ae)):(D(q,q,1.5*we),3===Re&&de.add(ye[0],ye[1],ye[2],Z[0],Z[1],Z[2],Ae),de.add(ye[0]+q[0],ye[1]+q[1],ye[2]+q[2],Z[0]+q[0],Z[1]+q[1],Z[2]+q[2],Ae),de.add(ye[0]-q[0],ye[1]-q[1],ye[2]-q[2],Z[0]-q[0],Z[1]-q[1],Z[2]-q[2],Ae))}else 6===Ce&&(h(m,S(m,Z,ye),.475),a(ye,ye,m),S(Z,Z,m),de.add(ye[0],ye[1],ye[2],Z[0],Z[1],Z[2],Ae))}const xe=Q?b.f.clone(Q.boundingSphere):void 0,le=de.getLines();return 0===ee?{lines:le}:(e.eB.scale(Y,Y,1/ee),xe&&e.eB.distance(Y,xe.center)/xe.radius<.1?{lines:le,boundingSphere:xe}:{lines:le})}},5589:(tn,Ue,n)=>{"use strict";n.d(Ue,{V8:()=>i,m$:()=>O,rj:()=>y});var y,b,e=n(9909),o=n(9136),r=n(5384),t=n(9651),A=n(6853);(b=y||(y={})).create=function _(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}},b.reset=function M(I){I.updateTransform=!1,I.updateMatrix=!1,I.updateColor=!1,I.updateSize=!1,I.createGeometry=!1,I.createNew=!1};const c={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function i(b,_={}){const M={...c,..._};let I=b.elementCount*M.elementCountFactor;return(b.isCoarseGrained||b.isCoarse)&&(I*=M.coarseGrainedFactor),I>M.lowestElementCount?"lowest":I>M.lowerElementCount?"lower":I>M.lowElementCount?"low":I>M.mediumElementCount?"medium":I>M.highElementCount?"high":"higher"}function O(b,_){let M=(0,e.NT)(b.quality,"auto"),I=(0,e.NT)(b.detail,1),l=(0,e.NT)(b.radialSegments,12),m=(0,e.NT)(b.linearSegments,8),u=(0,e.NT)(b.resolution,2),d=(0,e.NT)(b.probePositions,12),s=(0,e.NT)(b.doubleSided,!0),C=0;if("auto"===M)if(_ instanceof o.oE)M=i(_.root),C=function v(b){if(1===b.root.models.length){const _=t.i.Provider.get(b.root.model);if(_&&"P 1"===_.spacegroup.name&&!r.O8.isZero(_.spacegroup.cell))return _.spacegroup.cell.volume}return r.DJ.volume(b.root.boundary.box)}(_);else if(A.f.is(_)){const[h,a,S]=_.grid.cells.space.dimensions;C=h*a*S,M=C<1e7?"medium":"low"}switch(M){case"highest":I=3,l=36,m=18,u=.1,d=72,s=!0;break;case"higher":I=3,l=28,m=14,u=.3,d=48,s=!0;break;case"high":I=2,l=20,m=10,u=.5,d=36,s=!0;break;case"medium":I=1,l=12,m=8,u=.8,d=24,s=!0;break;case"low":I=0,l=8,m=3,u=1.3,d=24,s=!1;break;case"lower":I=0,l=4,m=2,u=3,d=12,s=!1;break;case"lowest":I=0,l=2,m=1,u=8,d=12,s=!1}return u=Math.max(u,C/5e8),u=Math.min(u,20),"off"===b.transparentBackfaces&&(void 0!==b.alpha&&b.alpha<1||b.xrayShaded)&&(s=!1),{detail:I,radialSegments:l,linearSegments:m,resolution:u,probePositions:d,doubleSided:s}}},5117:(tn,Ue,n)=>{"use strict";n.d(Ue,{b:()=>u});var u,d,e=n(3246),o=n(6825),r=n(4369),t=n(3596),A=n(3784),y=n(9909),c=n(2075),i=n(3543),v=n(9197),O=n(5077),b=n(8013),_=n(5019),M=n(4992),I=n(6280),l=n(8307),m=n(6022);(d=u||(u={})).setVisibility=function s(w,Q){w&&(w.state.visible=Q)},d.setAlphaFactor=function C(w,Q){w&&(w.state.alphaFactor=Q)},d.setPickable=function h(w,Q){w&&(w.state.pickable=Q)},d.setColorOnly=function a(w,Q){w&&(w.state.colorOnly=Q)},d.mark=function S(w,Q,G,V,U){if(!w||(0,e.$M)(Q))return!1;const{tMarker:N,uMarker:k,markerAverage:H,markerStatus:$,uGroupCount:J,instanceCount:W,instanceGranularity:te}=w.values,de=te.ref.value?W.ref.value:J.ref.value*W.ref.value,{array:ye}=N.ref.value,j=$.ref.value;if(!(0,e.xc)(Q)){let ee=0;if(V(Q,g=>(ee+=i.IX.size(g),!0),!0),0===ee)return!1;ee===de&&(Q=e.FE)}let Z=!1,q=-1,Y=-1;if((0,e.xc)(Q)){const ee=(0,o.Ro)(G,j);-1!==ee.status?(Z=j!==ee.status,Z&&(0,o.uP)(ye,ee.status,de)):Z=(0,o.BH)(ye,i.IX.ofLength(de),G),q=ee.average,Y=ee.status}else Z=V(Q,ee=>(0,o.BH)(ye,ee,G),!0),Z&&(q=(0,o.HX)(G,j),U&&-1!==U.status&&-1===q&&o.sY.isReverse(U.action,G)&&e.QN.areEqual(Q,U.loci)&&(Y=U.status,q=0===Y?0:.5));return Z&&(-1===q&&(q=(0,b.Xl)(ye,de),0===q&&(Y=0)),U&&(U.action=G,U.loci=Q,U.status=j),y.IQ.updateIfChanged(k,Y),-1===Y&&y.IQ.update(N,N.ref.value),y.IQ.updateIfChanged(H,q),y.IQ.updateIfChanged($,Y)),Z},d.setOverpaint=function D(w,Q,G,V,U){if(!w)return;const{tOverpaint:N,dOverpaintType:k,dOverpaint:H,uGroupCount:$,instanceCount:J,instanceGranularity:W}=w.values,te=W.ref.value?J.ref.value:$.ref.value*J.ref.value,de=W.ref.value?"instance":"groupInstance";(0,c.zj)(Q.layers.length?te:0,de,w.values);const{array:ye}=N.ref.value;V&&(0,c.MD)(ye,0,te);for(let j=0,Z=Q.layers.length;j<Z;++j){const{loci:q,color:Y,clear:ee}=Q.layers[j];G(q,_e=>{const xe=i.IX.start(_e),le=i.IX.end(_e);return ee?(0,c.MD)(ye,xe,le):(0,c.qp)(ye,xe,le,Y)},!1)}if(y.IQ.update(N,N.ref.value),y.IQ.updateIfChanged(k,de),y.IQ.updateIfChanged(H,Q.layers.length>0),0!==Q.layers.length&&"instance"!==de&&U&&(0,_.jH)(U.props)){const{geometry:j,props:Z,webgl:q}=U;if("mesh"===j.kind){const{resolution:Y,overpaintTexture:ee}=j.meta,g=(0,_.Y0)(Z.smoothColors,!0,Y);g&&((0,M.WT)(w.values,g.resolution,g.stride,q,ee),j.meta.overpaintTexture=w.values.tOverpaintGrid.ref.value)}else if(q&&"texture-mesh"===j.kind){const{resolution:Y,overpaintTexture:ee}=j.meta,g=(0,_.Y0)(Z.smoothColors,!0,Y);g&&((0,I.FB)(w.values,g.resolution,g.stride,q,ee),j.meta.overpaintTexture=w.values.tOverpaintGrid.ref.value)}}},d.setTransparency=function R(w,Q,G,V,U){if(!w)return;const{tTransparency:N,dTransparencyType:k,transparencyAverage:H,dTransparency:$,uGroupCount:J,instanceCount:W,instanceGranularity:te}=w.values,de=te.ref.value?W.ref.value:J.ref.value*W.ref.value,ye=te.ref.value?"instance":"groupInstance";(0,v.Ti)(Q.layers.length?de:0,ye,w.values);const{array:j}=N.ref.value;V&&(0,v.m6)(j,0,de);for(let Z=0,q=Q.layers.length;Z<q;++Z){const{loci:Y,value:ee}=Q.layers[Z];G(Y,_e=>{const xe=i.IX.start(_e),le=i.IX.end(_e);return(0,v.UG)(j,xe,le,ee)},!1)}if(y.IQ.update(N,N.ref.value),y.IQ.updateIfChanged(H,(0,v.Gg)(j,de)),y.IQ.updateIfChanged(k,ye),y.IQ.updateIfChanged($,Q.layers.length>0),0!==Q.layers.length&&"instance"!==ye&&U&&(0,_.jH)(U.props)){const{geometry:Z,props:q,webgl:Y}=U;if("mesh"===Z.kind){const{resolution:ee,transparencyTexture:g}=Z.meta,_e=(0,_.Y0)(q.smoothColors,!0,ee);_e&&((0,M._j)(w.values,_e.resolution,_e.stride,Y,g),Z.meta.transparencyTexture=w.values.tTransparencyGrid.ref.value)}else if(Y&&"texture-mesh"===Z.kind){const{resolution:ee,transparencyTexture:g}=Z.meta,_e=(0,_.Y0)(q.smoothColors,!0,ee);_e&&((0,I.NQ)(w.values,_e.resolution,_e.stride,Y,g),Z.meta.transparencyTexture=w.values.tTransparencyGrid.ref.value)}}},d.setEmissive=function f(w,Q,G,V,U){if(!w)return;const{tEmissive:N,dEmissiveType:k,emissiveAverage:H,dEmissive:$,uGroupCount:J,instanceCount:W,instanceGranularity:te}=w.values,de=te.ref.value?W.ref.value:J.ref.value*W.ref.value,ye=te.ref.value?"instance":"groupInstance";(0,m.Sj)(Q.layers.length?de:0,ye,w.values);const{array:j}=N.ref.value;V&&(0,m.dQ)(j,0,de);for(let Z=0,q=Q.layers.length;Z<q;++Z){const{loci:Y,value:ee}=Q.layers[Z];G(Y,_e=>{const xe=i.IX.start(_e),le=i.IX.end(_e);return(0,m.Ns)(j,xe,le,ee)},!1)}if(y.IQ.update(N,N.ref.value),y.IQ.updateIfChanged(H,(0,m.bO)(j,de)),y.IQ.updateIfChanged(k,ye),y.IQ.updateIfChanged($,Q.layers.length>0),0!==Q.layers.length&&"instance"!==ye&&U&&(0,_.jH)(U.props)){const{geometry:Z,props:q,webgl:Y}=U;if("mesh"===Z.kind){const{resolution:ee,emissiveTexture:g}=Z.meta,_e=(0,_.Y0)(q.smoothColors,!0,ee);_e&&((0,M.bj)(w.values,_e.resolution,_e.stride,Y,g),Z.meta.emissiveTexture=w.values.tEmissiveGrid.ref.value)}else if(Y&&"texture-mesh"===Z.kind){const{resolution:ee,emissiveTexture:g}=Z.meta,_e=(0,_.Y0)(q.smoothColors,!0,ee);_e&&((0,I.ij)(w.values,_e.resolution,_e.stride,Y,g),Z.meta.emissiveTexture=w.values.tEmissiveGrid.ref.value)}}},d.setSubstance=function p(w,Q,G,V,U){if(!w)return;const{tSubstance:N,dSubstanceType:k,dSubstance:H,uGroupCount:$,instanceCount:J,instanceGranularity:W}=w.values,te=W.ref.value?J.ref.value:$.ref.value*J.ref.value,de=W.ref.value?"instance":"groupInstance";(0,l.fZ)(Q.layers.length?te:0,de,w.values);const{array:ye}=N.ref.value;V&&(0,l.C2)(ye,0,te);for(let j=0,Z=Q.layers.length;j<Z;++j){const{loci:q,material:Y,clear:ee}=Q.layers[j];G(q,_e=>{const xe=i.IX.start(_e),le=i.IX.end(_e);return ee?(0,l.C2)(ye,xe,le):(0,l.mx)(ye,xe,le,Y)},!1)}if(y.IQ.update(N,N.ref.value),y.IQ.updateIfChanged(k,de),y.IQ.updateIfChanged(H,Q.layers.length>0),0!==Q.layers.length&&"instance"!==de&&U&&(0,_.jH)(U.props)){const{geometry:j,props:Z,webgl:q}=U;if("mesh"===j.kind){const{resolution:Y,substanceTexture:ee}=j.meta,g=(0,_.Y0)(Z.smoothColors,!0,Y);g&&((0,M.Cn)(w.values,g.resolution,g.stride,q,ee),j.meta.substanceTexture=w.values.tSubstanceGrid.ref.value)}else if(q&&"texture-mesh"===j.kind){const{resolution:Y,substanceTexture:ee}=j.meta,g=(0,_.Y0)(Z.smoothColors,!0,Y);g&&((0,I.DG)(w.values,g.resolution,g.stride,q,ee),j.meta.substanceTexture=w.values.tSubstanceGrid.ref.value)}}},d.setClipping=function E(w,Q,G,V){if(!w)return;const{tClipping:U,dClippingType:N,dClipping:k,uGroupCount:H,instanceCount:$,instanceGranularity:J}=w.values,W=J.ref.value?$.ref.value:H.ref.value*$.ref.value,{layers:te}=Q,de=J.ref.value?"instance":"groupInstance";(0,O.$G)(te.length?W:0,de,w.values);const{array:ye}=U.ref.value;V&&(0,O.eO)(ye,0,W);for(let j=0,Z=Q.layers.length;j<Z;++j){const{loci:q,groups:Y}=Q.layers[j];G(q,g=>{const _e=i.IX.start(g),xe=i.IX.end(g);return(0,O.HB)(ye,_e,xe,Y)},!1)}y.IQ.update(U,U.ref.value),y.IQ.updateIfChanged(N,de),y.IQ.updateIfChanged(k,Q.layers.length>0)},d.setThemeStrength=function T(w,Q){w&&(y.IQ.updateIfChanged(w.values.uOverpaintStrength,Q.overpaint),y.IQ.updateIfChanged(w.values.uTransparencyStrength,Q.transparency),y.IQ.updateIfChanged(w.values.uEmissiveStrength,Q.emissive),y.IQ.updateIfChanged(w.values.uSubstanceStrength,Q.substance))},d.setTransform=function L(w,Q,G){if(!w||!Q&&!G)return;const{values:V}=w;Q&&(r.$I.copy(V.matrix.ref.value,Q),y.IQ.update(V.matrix,V.matrix.ref.value)),G?(V.extraTransform.ref.value.set(G),y.IQ.update(V.extraTransform,V.extraTransform.ref.value)):null===G&&((0,t.ES)(V.extraTransform.ref.value,V.instanceCount.ref.value),y.IQ.update(V.extraTransform,V.extraTransform.ref.value)),(0,t.CY)(V,V.invariantBoundingSphere.ref.value,V.instanceGrid.ref.value.cellSize,V.instanceGrid.ref.value.batchSize);const U=(0,A.Ax)(V.invariantBoundingSphere.ref.value,V.transform.ref.value,V.instanceCount.ref.value,0);y.IQ.update(V.boundingSphere,U)}},3866:(tn,Ue,n)=>{"use strict";n.d(Ue,{H:()=>un});var e=n(2443),o=n(467),r=n(8277),t=n(6853),A=n(9283),y=n(6165),c=n(5117),i=n(542),v=n(1930),O=n(3596),b=n(8353),_=n(3246),M=n(3543),I=n(5589),l=n(274),m=n(9909),u=n(7684),d=n(2712),s=n(4369),C=n(5019),h=n(1413),a=n(4824),S=n(1372),D=n(8013);function f(ct,dt){const{defaultProps:Yt,createGeometry:cn,createLocationIterator:xn,getLoci:Rn,eachLocation:er,setUpdateState:ir,mustRecreate:Yn,dispose:br}=ct,{updateValues:vr,updateBoundingSphere:Hr,updateRenderableState:Mr,createPositionIterator:Fr}=ct.geometryUtils,Sr=I.rj.create();let Ur,Ro,ro,po,so,Go,Wo,We,Sn,Nn,ho=Object.assign({},Yt),Bo=v.S.createEmpty(),Pt=-1;function dr(Qt){if(Sr.createNew){if(Sn=xn(po,so),!Qt)throw new Error("expected geometry to be given");Ur=function R(ct,dt,Yt,cn,xn,Rn){const{createValues:er,createRenderableState:ir}=i.V.getUtils(dt),br=er(dt,(0,O.Zk)(),Yt,cn,xn),vr=ir(xn);return(0,b.o)(dt.kind,br,vr,Rn)}(0,Qt,Sn,ro,Ro,dt),Nn=Fr(Qt,Ur.values)}else{if(!Ur)throw new Error("expected renderObject to be available");if(Sr.updateTransform){Sn=xn(po,so);const{instanceCount:ht,groupCount:pt}=Sn;Ro.instanceGranularity?(0,D.Km)(ht,"instance",Ur.values):(0,D.Km)(ht*pt,"groupInstance",Ur.values)}else Sn.reset();if(Sr.createGeometry){if(!Qt)throw new Error("expected geometry to be given");m.IQ.updateIfChanged(Ur.values.drawCount,i.V.getDrawCount(Qt)),m.IQ.updateIfChanged(Ur.values.uVertexCount,i.V.getVertexCount(Qt)),m.IQ.updateIfChanged(Ur.values.uGroupCount,i.V.getGroupCount(Qt))}(Sr.updateTransform||Sr.createGeometry)&&(Hr(Ur.values,Qt||We),Nn=Fr(Qt||We,Ur.values)),Sr.updateSize&&"uSize"in Ur.values&&(0,u.v3)(Sn,ro.size,Ur.values),Sr.updateColor&&(0,d.D1)(Sn,Nn,ro.color,Ur.values),vr(Ur.values,Ro),Mr(Ur.state,Ro)}ho=Ro,Bo=ro,Go=po,Wo=so,Qt&&(We=Qt,Pt+=1)}function Ft(Qt,ht){return(0,_.xc)(Qt)?ht(M.IX.ofBounds(0,ho.instanceGranularity?Sn.instanceCount:Sn.groupCount*Sn.instanceCount)):ho.instanceGranularity?function xr(Qt,ht,pt,Xt){let fn=!1;if(t.f.Cell.isLoci(Qt)){if(t.f.Cell.isLociEmpty(Qt)||!t.f.areEquivalent(Qt.volume,ht))return!1;Xt(M.IX.ofSingleton(0))&&(fn=!0)}else if(t.f.Segment.isLoci(Qt)){if(t.f.Segment.isLociEmpty(Qt)||!t.f.areEquivalent(Qt.volume,ht)||!M.SortedArray.has(Qt.segments,pt))return!1;Xt(M.IX.ofSingleton(0))&&(fn=!0)}return fn}(Qt,Go,Wo,ht):er(Qt,Go,Wo,ho,ht)}return{get groupCount(){return Sn?Sn.count:0},get renderObject(){return Ur},get geometryVersion(){return Pt},createOrUpdate:(Qt,ht,pt={},Xt)=>(0,o.A)(function*(){if(function Kn(Qt,ht,pt,Xt){if(!pt&&!Go)throw new Error("missing volume");Ro=Object.assign({},ho,ht),ro=Qt,po=pt,so=Xt,I.rj.reset(Sr),Ur?(!t.f.areEquivalent(po,Go)||so!==Wo)&&(Sr.createNew=!0):Sr.createNew=!0,Sr.createNew?Sr.createGeometry=!0:(ir(Sr,pt,Ro,ho,ro,Bo),l.J.areEqual(Qt.color,Bo.color)||(Sr.updateColor=!0),Sr.createGeometry&&(Sr.updateColor=!0),Ro.instanceGranularity!==ho.instanceGranularity&&(Sr.updateTransform=!0))}(ht,pt,Xt?.volume||Go,Xt?.key||Wo),Sr.createGeometry){const fn=cn(Qt,po,so,ro,Ro,We);return(0,S.$X)(fn)?fn.then(dr):dr(fn)}dr()})(),getLoci:Qt=>Ur?Rn(Qt,Go,Wo,ho,Ur.id):_.BL,eachLocation(Qt){for(Sn.reset();Sn.hasNext;){const{location:ht,isSecondary:pt}=Sn.move();Qt(ht,pt)}},mark:(Qt,ht)=>c.b.mark(Ur,Qt,ht,Ft),setVisibility(Qt){c.b.setVisibility(Ur,Qt)},setAlphaFactor(Qt){c.b.setAlphaFactor(Ur,Qt)},setPickable(Qt){c.b.setPickable(Ur,Qt)},setColorOnly(Qt){c.b.setColorOnly(Ur,Qt)},setTransform(Qt,ht){c.b.setTransform(Ur,Qt,ht)},setOverpaint:Qt=>c.b.setOverpaint(Ur,Qt,Ft,!0),setTransparency:Qt=>c.b.setTransparency(Ur,Qt,Ft,!0),setEmissive:Qt=>c.b.setEmissive(Ur,Qt,Ft,!0),setSubstance:Qt=>c.b.setSubstance(Ur,Qt,Ft,!0),setClipping:Qt=>c.b.setClipping(Ur,Qt,Ft,!0),setThemeStrength(Qt){c.b.setThemeStrength(Ur,Qt)},destroy(){br?.(We),Ur&&(Ur.state.disposed=!0,Ur=void 0)},mustRecreate:Yn}}function T(ct,dt,Yt,cn,xn,Rn=(()=>[-1])){let er=0;const{webgl:ir}=dt,Yn=new h.B,br=new e.YL.GeometryState,vr=(0,b.Q0)(),Hr=[],Mr=e.YL.createState(),Fr=new Map;let Sr,Ur,Ro,ro,po=v.S.createEmpty();function so(Nn,Kn){return ho.apply(this,arguments)}function ho(){return(ho=(0,o.A)(function*(Nn,Kn){var dr;let xr=Fr.get(Kn);return xr?!(null===(dr=xr.mustRecreate)||void 0===dr)&&dr.call(xr,{volume:Sr,key:Kn},ro,ir)&&(xr.destroy(),xr=cn(vr,Sr,Kn,ro,ir),Fr.set(Kn,xr)):(xr=cn(vr,Sr,Kn,ro,ir),Fr.set(Kn,xr)),xr.createOrUpdate({webgl:ir,runtime:Nn},po,ro,{volume:Sr,key:Kn})})).apply(this,arguments)}return{label:ct,get groupCount(){let Nn=0;return Fr.forEach(Kn=>{Kn.renderObject&&(Nn+=Kn.groupCount)}),Nn},get props(){return ro},get params(){return Ro},get state(){return Mr},get theme(){return po},get geometryVersion(){return br.version},renderObjects:Hr,updated:Yn,createOrUpdate:function Bo(Nn={},Kn){Kn&&Kn!==Sr&&(Ro=Yt(dt,Kn),Sr=Kn,ro||(ro=r.t.getDefaultValues(Ro)));const dr=(0,I.m$)(Object.assign({},ro,Nn),Sr);return Object.assign(ro,Nn,dr),Ur=Rn(ro),a.YZ.create("Creating or updating VolumeRepresentation",function(){var xr=(0,o.A)(function*(Ft){const Qt=new Set(Fr.keys());for(let ht=0,pt=Ur.length;ht<pt;++ht){const Xt=Ur[ht];Qt.delete(Xt);const fn=so(Ft,Xt);fn&&(yield fn)}Qt.forEach(ht=>{var pt;null===(pt=Fr.get(ht))||void 0===pt||pt.destroy(),Fr.delete(ht)}),Hr.length=0,Fr.forEach(ht=>{ht.renderObject&&(Hr.push(ht.renderObject),br.add(ht.renderObject.id,ht.geometryVersion))}),br.snapshot(),Yn.next(er++)});return function(Ft){return xr.apply(this,arguments)}}())},setState:function We(Nn){const{visible:Kn,alphaFactor:dr,pickable:xr,overpaint:Ft,transparency:Qt,emissive:ht,substance:pt,clipping:Xt,transform:fn,themeStrength:on,syncManually:En,markerActions:Tt}=Nn,Fe={};void 0!==Kn&&(Fe.visible=Kn),void 0!==dr&&(Fe.alphaFactor=dr),void 0!==xr&&(Fe.pickable=xr),void 0!==Ft&&(Fe.overpaint=Ft),void 0!==Qt&&(Fe.transparency=Qt),void 0!==ht&&(Fe.emissive=ht),void 0!==pt&&(Fe.substance=pt),void 0!==Xt&&(Fe.clipping=Xt),void 0!==on&&(Fe.themeStrength=on),void 0!==fn&&!s.$I.areEqual(fn,Mr.transform,s.p8)&&(Fe.transform=fn),void 0!==En&&(Fe.syncManually=En),void 0!==Tt&&(Fe.markerActions=Tt),Fr.forEach(He=>function Wo(Nn,Kn){void 0!==Kn.visible&&Nn&&Nn.setVisibility(Kn.visible),void 0!==Kn.alphaFactor&&Nn&&Nn.setAlphaFactor(Kn.alphaFactor),void 0!==Kn.pickable&&Nn&&Nn.setPickable(Kn.pickable),void 0!==Kn.overpaint&&Nn&&Nn.setOverpaint(Kn.overpaint),void 0!==Kn.transparency&&Nn&&Nn.setTransparency(Kn.transparency),void 0!==Kn.emissive&&Nn&&Nn.setEmissive(Kn.emissive),void 0!==Kn.substance&&Nn&&Nn.setSubstance(Kn.substance),void 0!==Kn.clipping&&Nn&&Nn.setClipping(Kn.clipping),void 0!==Kn.transform&&Nn&&Nn.setTransform(Kn.transform),void 0!==Kn.themeStrength&&Nn&&Nn.setThemeStrength(Kn.themeStrength)}(He,Fe)),e.YL.updateState(Mr,Nn)},setTheme:function Pt(Nn){po=Nn},getLoci:Nn=>{let Kn=_.BL;return Fr.forEach(dr=>{const xr=dr.getLoci(Nn);(0,_.$M)(xr)||(Kn=xr)}),Kn},getAllLoci:()=>[xn(Sr,ro)],eachLocation:Nn=>{Fr.forEach(Kn=>{Kn.eachLocation(Nn)})},mark:function Go(Nn,Kn){let dr=!1;return Fr.forEach(xr=>{dr=xr.mark(Nn,Kn)||dr}),dr},destroy:function Sn(){Fr.forEach(Nn=>Nn.destroy()),Fr.clear()}}}var L=n(1888),w=n(364),Q=n(5315),G=n(6115),V=n(4178),U=n(799),N=n(8187),k=n(1692),H=n(7187);const $={isoValue:t.f.IsoValueParam},W=1;function te(ct,dt){if(ct.grid.cells.data.length<Math.pow(10,3))return!1;const Yt=ct.grid.cells.space.dimensions,{powerOfTwoSize:cn}=(0,V.Ud)(Yt,W);return cn<=dt.maxTextureSize/2}function de(ct,dt,Yt,cn,xn){return cn.tryUseGpu&&xn&&function J(ct){return ct.extensions.colorBufferFloat&&ct.extensions.textureFloat&&ct.extensions.drawBuffers}(xn)&&te(dt,xn)?function Ae(ct){return f({defaultProps:r.t.getDefaultValues(ee),createGeometry:xe,createLocationIterator:dt=>(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>w.LU),getLoci:j,eachLocation:Z,setUpdateState:(dt,Yt,cn,xn)=>{t.f.IsoValue.areSame(cn.isoValue,xn.isoValue,Yt.grid.stats)||(dt.createGeometry=!0)},geometryUtils:U.X.Utils,mustRecreate:(dt,Yt,cn)=>!Yt.tryUseGpu||!cn||!te(dt.volume,cn),dispose:dt=>{dt.vertexTexture.ref.value.destroy(),dt.groupTexture.ref.value.destroy(),dt.normalTexture.ref.value.destroy(),dt.doubleBuffer.destroy()}},ct)}(ct):function g(ct){return f({defaultProps:r.t.getDefaultValues(ee),createGeometry:q,createLocationIterator:dt=>(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>w.LU),getLoci:j,eachLocation:Z,setUpdateState:(dt,Yt,cn,xn)=>{t.f.IsoValue.areSame(cn.isoValue,xn.isoValue,Yt.grid.stats)||(dt.createGeometry=!0)},geometryUtils:A.e.Utils,mustRecreate:(dt,Yt,cn)=>Yt.tryUseGpu&&!!cn&&te(dt.volume,cn)},ct)}(ct)}function ye(ct,dt){return t.f.Isosurface.Loci(ct,dt.isoValue)}function j(ct,dt,Yt,cn,xn){const{objectId:Rn,groupId:er}=ct;if(xn===Rn){const ir=t.f.PickingGranularity.get(dt);return"volume"===ir?t.f.Loci(dt):"object"===ir?t.f.Isosurface.Loci(dt,cn.isoValue):t.f.Cell.Loci(dt,M.IX.ofSingleton(er))}return _.BL}function Z(ct,dt,Yt,cn,xn){return(0,V.bk)(ct,dt,{isoValue:cn.isoValue},xn)}function q(ct,dt,Yt,cn,xn,Rn){return Y.apply(this,arguments)}function Y(){return(Y=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){ct.runtime.update({message:"Marching cubes..."});const er=(0,G.WE)(new Int32Array(dt.grid.cells.data.length)),ir=yield(0,y.O)({isoLevel:t.f.IsoValue.toAbsolute(xn.isoValue,dt.grid.stats).absoluteValue,scalarField:dt.grid.cells,idField:s.qY.create(dt.grid.cells.space,s.qY.Data1(er))},Rn).runAsChild(ct.runtime),Yn=t.x.getGridToCartesianTransform(dt.grid);return A.e.transform(ir,Yn),ct.webgl&&!ct.webgl.isWebGL2?(A.e.uniformTriangleGroup(ir,!1),H.IQ.updateIfChanged(ir.varyingGroup,!1)):H.IQ.updateIfChanged(ir.varyingGroup,!0),ir.setBoundingSphere(t.f.Isosurface.getBoundingSphere(dt,xn.isoValue)),ir})).apply(this,arguments)}const ee={...A.e.Params,...U.X.Params,...$,quality:{...A.e.Params.quality,isEssential:!1},tryUseGpu:r.t.Boolean(!0)};var _e;function xe(ct,dt,Yt,cn,xn,Rn){return le.apply(this,arguments)}function le(){return(le=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){if(!ct.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");if(dt.grid.cells.data.length<=1)return U.X.createEmpty(Rn);const{max:er,min:ir}=dt.grid.stats,Yn=er-ir,br=t.f.IsoValue.toAbsolute(xn.isoValue,dt.grid.stats).absoluteValue,vr=(br-ir)/Yn,{texture:Hr,gridDimension:Mr,gridTexDim:Fr,gridTexScale:Sr,transform:Ur}=_e.get(dt,ct.webgl),Ro=dt.grid.cells.space.axisOrderSlowToFast,ro=Rn?.doubleBuffer.get(),po=(0,N._)(ct.webgl,Hr,Mr,Fr,Sr,Ur,vr,br<0,!1,Ro,!0,ro?.vertex,ro?.group,ro?.normal),so=dt.grid.cells.data.length,ho=t.f.getBoundingSphere(dt),Bo=U.X.create(po.vertexCount,so,po.vertexTexture,po.groupTexture,po.normalTexture,ho,Rn);return Bo.meta.webgl=ct.webgl,Bo})).apply(this,arguments)}function Be(ct,dt,Yt,cn,xn,Rn){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){ct.runtime.update({message:"Marching cubes..."});const er=(0,G.WE)(new Int32Array(dt.grid.cells.data.length)),ir=yield(0,y.e)({isoLevel:t.f.IsoValue.toAbsolute(xn.isoValue,dt.grid.stats).absoluteValue,scalarField:dt.grid.cells,idField:s.qY.create(dt.grid.cells.space,s.qY.Data1(er))},Rn).runAsChild(ct.runtime),Yn=t.x.getGridToCartesianTransform(dt.grid);return Q.q.transform(ir,Yn),ir.setBoundingSphere(t.f.Isosurface.getBoundingSphere(dt,xn.isoValue)),ir})).apply(this,arguments)}!function(ct){const dt="volume-isosurface-texture";ct.descriptor=(0,k.e)({name:dt}),ct.get=function Yt(cn,xn){const{resources:Rn}=xn,er=t.x.getGridToCartesianTransform(cn.grid),ir=s.eB.clone(cn.grid.cells.space.dimensions),{width:Yn,height:br,powerOfTwoSize:vr}=(0,V.Ud)(ir,W),Hr=s.eB.create(Yn,br,0),Mr=s.ZY.create(Yn/vr,br/vr);if(vr>xn.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!cn._propertyData[dt]){cn._propertyData[dt]=Rn.texture("image-uint8","alpha","ubyte","linear");const Fr=cn._propertyData[dt];Fr.define(vr,vr),Fr.load((0,V.sz)(cn,"data",W),!0),cn.customProperties.add(ct.descriptor),cn.customProperties.assets(ct.descriptor,[{dispose:()=>Fr.destroy()}])}return ir[0]+=W,ir[1]+=W,{texture:cn._propertyData[dt],transform:er,gridDimension:ir,gridTexDim:Hr,gridTexScale:Mr}}}(_e||(_e={}));const Re={...Q.q.Params,...$,quality:{...Q.q.Params.quality,isEssential:!1},sizeFactor:r.t.Numeric(3,{min:0,max:10,step:.1})};function ke(ct){return f({defaultProps:r.t.getDefaultValues(Re),createGeometry:Be,createLocationIterator:dt=>(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>w.LU),getLoci:j,eachLocation:Z,setUpdateState:(dt,Yt,cn,xn)=>{t.f.IsoValue.areSame(cn.isoValue,xn.isoValue,Yt.grid.stats)||(dt.createGeometry=!0)},geometryUtils:Q.q.Utils},ct)}const we={solid:(ct,dt)=>T("Isosurface mesh",ct,dt,de,ye),wireframe:(ct,dt)=>T("Isosurface wireframe",ct,dt,ke,ye)},Oe={...ee,...Re,visuals:r.t.MultiSelect(["solid"],r.t.objectToOptions(we)),bumpFrequency:r.t.Numeric(1,{min:0,max:10,step:.1},C.iy.ShadingCategory)},Ne={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:function Ve(ct,dt){return e.YL.createMulti("Isosurface",ct,dt,e.YL.StateBuilder,we)},getParams:function Se(ct,dt){const Yt=r.t.clone(Oe);return Yt.isoValue=t.f.createIsoValueParam(t.f.IsoValue.relative(2),dt.grid.stats),Yt},defaultValues:r.t.getDefaultValues(Oe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:ct=>!t.f.isEmpty(ct)&&!t.f.Segmentation.get(ct)};var K=n(9359),ne=n(7135),be=n(4559),Te=n(190),ie=n(4951);function ue(ct,dt,Yt,cn,xn,Rn){return re.apply(this,arguments)}function re(){return(re=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){const{dimension:{name:er},isoValue:ir}=xn,{space:Yn,data:br}=dt.grid.cells,{min:vr,max:Hr}=dt.grid.stats,Mr=t.f.IsoValue.toAbsolute(ir,dt.grid.stats).absoluteValue,Fr="color"in cn.color?cn.color.color(w.LU,!1):(0,Te.Q1)(16777215),[Sr,Ur,Ro]=Te.Q1.toRgbNormalized(Fr),{width:ro,height:po,x:so,y:ho,z:Bo,x0:Go,y0:Wo,z0:We,nx:Pt,ny:Sn,nz:Nn}=ve(dt.grid,xn),Kn=new Float32Array("x"===er?[so,0,0,so,ho,0,so,0,Bo,so,ho,Bo]:"y"===er?[0,ho,0,so,ho,0,0,ho,Bo,so,ho,Bo]:[0,0,Bo,0,ho,Bo,so,0,Bo,so,ho,Bo]),dr=new Uint8Array(ro*po*4),xr=function ce(ct,dt){const{space:Yt}=ct.cells,{width:cn,height:xn,x0:Rn,y0:er,z0:ir,nx:Yn,ny:br,nz:vr}=ve(ct,dt),Hr=new Uint8Array(cn*xn*4);let Mr=0;for(let Fr=er;Fr<br;++Fr)for(let Sr=Rn;Sr<Yn;++Sr)for(let Ur=ir;Ur<vr;++Ur)(0,ie.Gu)(Yt.dataOffset(Sr,Fr,Ur),Hr,Mr),Mr+=4;return Hr}(dt.grid,xn);let Ft=0;for(let Xt=Wo;Xt<Sn;++Xt)for(let fn=Go;fn<Pt;++fn)for(let on=We;on<Nn;++on){const En=Yn.get(br,fn,Xt,on),Tt=(En-vr)/(Hr-vr);dr[Ft]=Sr*Tt*2*255,dr[Ft+1]=Ur*Tt*2*255,dr[Ft+2]=Ro*Tt*2*255,dr[Ft+3]=En>=Mr?255:0,Ft+=4}const Qt={width:ro,height:po,array:dr,flipY:!0},ht={width:ro,height:po,array:xr,flipY:!0},pt=t.x.getGridToCartesianTransform(dt.grid);return(0,be.pi)(pt,Kn,0,4),ne._V.create(Qt,Kn,ht,Rn)})).apply(this,arguments)}function ve(ct,dt){const{dimension:{name:Yt,params:cn}}=dt,{space:xn}=ct.cells;let Rn,er,ir,Yn,br,vr=0,Hr=0,Mr=0,[Fr,Sr,Ur]=xn.dimensions;return"x"===Yt?(ir=cn,Yn=Sr-1,br=Ur-1,Rn=Ur,er=Sr,vr=ir,Fr=vr+1):"y"===Yt?(ir=Fr-1,Yn=cn,br=Ur-1,Rn=Ur,er=Fr,Hr=Yn,Sr=Hr+1):(ir=Fr-1,Yn=Sr-1,br=cn,Rn=Fr,er=Sr,Mr=br,Ur=Mr+1),{width:Rn,height:er,x:ir,y:Yn,z:br,x0:vr,y0:Hr,z0:Mr,nx:Fr,ny:Sr,nz:Ur}}function ae(ct,dt){const Yt=function se(ct,dt){const{space:Yt}=ct.cells,{width:cn,height:xn,x0:Rn,y0:er,z0:ir,nx:Yn,ny:br,nz:vr}=ve(ct,dt),Hr=new Uint32Array(cn*xn);let Mr=0;for(let Fr=er;Fr<br;++Fr)for(let Sr=Rn;Sr<Yn;++Sr)for(let Ur=ir;Ur<vr;++Ur)Hr[Mr]=Yt.dataOffset(Sr,Fr,Ur),Mr+=1;return Hr}(ct.grid,dt);return t.f.Cell.Loci(ct,M.SortedArray.ofUnsortedArray(Yt))}function ge(ct,dt,Yt,cn,xn){const{objectId:Rn,groupId:er}=ct;if(xn===Rn){const ir=t.f.PickingGranularity.get(dt);return"volume"===ir?t.f.Loci(dt):"object"===ir?ae(dt,cn):t.f.Cell.Loci(dt,M.IX.ofSingleton(er))}return _.BL}function Ie(ct,dt,Yt,cn,xn){return(0,V.bk)(ct,dt,void 0,xn)}const Le={...ne._V.Params,quality:{...ne._V.Params.quality,isEssential:!1},dimension:r.t.MappedStatic("x",{x:r.t.Numeric(0,{min:0,max:0,step:1}),y:r.t.Numeric(0,{min:0,max:0,step:1}),z:r.t.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:t.f.IsoValueParam};function je(ct){return f({defaultProps:r.t.getDefaultValues(Le),createGeometry:ue,createLocationIterator:dt=>(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>w.LU),getLoci:ge,eachLocation:Ie,setUpdateState:(dt,Yt,cn,xn,Rn,er)=>{dt.createGeometry=cn.dimension.name!==xn.dimension.name||cn.dimension.params!==xn.dimension.params||!t.f.IsoValue.areSame(cn.isoValue,xn.isoValue,Yt.grid.stats)||!l.J.areEqual(Rn.color,er.color)},geometryUtils:{...ne._V.Utils,createRenderableState:dt=>{const Yt=ne._V.Utils.createRenderableState(dt);return Lt(Yt,dt),Yt},updateRenderableState:Lt}},ct)}function Lt(ct,dt){ne._V.Utils.updateRenderableState(ct,dt),ct.opaque=!1,ct.writeDepth=!0}const en={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:function Je(ct,dt){return T("Slice",ct,dt,je,ae)},getParams:function nt(ct,dt){const Yt=r.t.clone(Le),cn=dt.grid.cells.space.dimensions;return Yt.dimension=r.t.MappedStatic("x",{x:r.t.Numeric(0,{min:0,max:cn[0]-1,step:1}),y:r.t.Numeric(0,{min:0,max:cn[1]-1,step:1}),z:r.t.Numeric(0,{min:0,max:cn[2]-1,step:1})},{isEssential:!0}),Yt.isoValue=t.f.createIsoValueParam(t.f.IsoValue.absolute(dt.grid.stats.min),dt.grid.stats),Yt},defaultValues:r.t.getDefaultValues(Le),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:ct=>!t.f.isEmpty(ct)&&!t.f.Segmentation.get(ct)};var Bt=n(5384),pn=n(9928);function $e(ct,dt){const Yt=(0,Bt.DJ)();return Bt.DJ.add(Yt,ct),Bt.DJ.transform(Yt,Yt,dt),Yt}function _t(ct){if("matrix"===ct.transform.kind)return{unitToCartn:s.$I.mul((0,s.$I)(),ct.transform.matrix,s.$I.fromScaling((0,s.$I)(),ct.cells.space.dimensions)),cellDim:s.$I.getScaling((0,s.eB)(),ct.transform.matrix)};const dt=ct.transform.fractionalBox,Yt=Bt.DJ.size((0,s.eB)(),dt);return{unitToCartn:s.$I.mul3((0,s.$I)(),ct.transform.cell.fromFractional,s.$I.fromTranslation((0,s.$I)(),dt.min),s.$I.fromScaling((0,s.$I)(),Yt)),cellDim:s.eB.div((0,s.eB)(),ct.transform.cell.size,ct.cells.space.dimensions)}}function Ke(ct,dt,Yt,cn,xn,Rn){return ut.apply(this,arguments)}function ut(){return(ut=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){const{webgl:ir}=ct;if(void 0===ir)throw new Error("DirectVolumeVisual requires `webgl` in props");return ir.isWebGL2?function Me(ct,dt,Yt,cn){const xn=Yt.grid.cells.space.dimensions;if(Math.max(...xn)>dt.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");const Rn=(0,V.tO)(Yt),er=t.x.getGridToCartesianTransform(Yt.grid),ir=$e(xn,er),Yn=cn?cn.gridTexture.ref.value:dt.resources.texture("volume-uint8","rgba","ubyte","linear");Yn.load(Rn);const{unitToCartn:br,cellDim:vr}=_t(Yt.grid);return pn.E.create(ir,xn,er,br,vr,Yn,Yt.grid.stats,!1,Yt.grid.cells.space.axisOrderSlowToFast,cn)}(0,ir,dt,Rn):function mt(ct,dt,Yt,cn){const xn=Yt.grid.cells.space.dimensions,{width:Rn,height:er}=(0,V.Ud)(xn);if(Math.max(Rn,er)>dt.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");const ir=(0,V.sz)(Yt,"normals"),Yn=t.x.getGridToCartesianTransform(Yt.grid),br=$e(xn,Yn),vr=cn?cn.gridTexture.ref.value:dt.resources.texture("image-uint8","rgba","ubyte","linear");vr.load(ir);const{unitToCartn:Hr,cellDim:Mr}=_t(Yt.grid);return pn.E.create(br,xn,Yn,Hr,Mr,vr,Yt.grid.stats,!1,Yt.grid.cells.space.axisOrderSlowToFast,cn)}(0,ir,dt,Rn)})).apply(this,arguments)}function Kt(ct,dt){return t.f.Loci(ct)}function sn(ct,dt,Yt,cn,xn){const{objectId:Rn,groupId:er}=ct;return xn===Rn?t.f.Cell.Loci(dt,M.IX.ofSingleton(er)):_.BL}function gt(ct,dt,Yt,cn,xn){return(0,V.bk)(ct,dt,void 0,xn)}const yt={...pn.E.Params,quality:{...pn.E.Params.quality,isEssential:!1}};function Gt(ct){return f({defaultProps:r.t.getDefaultValues(yt),createGeometry:Ke,createLocationIterator:dt=>(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>w.LU),getLoci:sn,eachLocation:gt,setUpdateState:(dt,Yt,cn,xn)=>{},geometryUtils:pn.E.Utils,dispose:dt=>{dt.gridTexture.ref.value.destroy()}},ct)}const tt={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:function rn(ct,dt){return T("Direct Volume",ct,dt,Gt,Kt)},getParams:function At(ct,dt){const Yt=r.t.clone(yt);return Yt.controlPoints.getVolume=()=>dt,Yt},defaultValues:r.t.getDefaultValues(yt),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:ct=>!t.f.isEmpty(ct)&&!t.f.Segmentation.get(ct)};var Mt=n(6642);const nn={segments:r.t.Converted(ct=>ct.map(dt=>`${dt}`),ct=>ct.map(dt=>parseInt(dt)),r.t.MultiSelect(["0"],r.t.arrayToOptions(["0"]),{isEssential:!0}))},Dn=1;function jt(ct,dt){if(ct.grid.cells.data.length<Math.pow(10,3))return!1;const Yt=ct.grid.cells.space.dimensions,{powerOfTwoSize:cn}=(0,V.Ud)(Yt,Dn);return cn<=dt.maxTextureSize/2}const It=(0,s.$I)();function Dt(ct,dt){const Yt=t.x.getGridToCartesianTransform(ct),cn=s.$I.fromTranslation(It,dt.min);return s.$I.mul((0,s.$I)(),Yt,cn)}function Ct(ct,dt,Yt,cn,xn){return cn.tryUseGpu&&xn&&function bn(ct){return ct.extensions.colorBufferFloat&&ct.extensions.textureFloat&&ct.extensions.drawBuffers}(xn)&&jt(dt,xn)?function Pr(ct){return f({defaultProps:r.t.getDefaultValues(Ot),createGeometry:fr,createLocationIterator:(dt,Yt)=>{const cn=t.f.Segment.Location(dt,Yt);return(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>cn)},getLoci:Vt,eachLocation:Wt,setUpdateState:(dt,Yt,cn,xn)=>{},geometryUtils:U.X.Utils,mustRecreate:(dt,Yt,cn)=>!Yt.tryUseGpu||!cn||!jt(dt.volume,cn),dispose:dt=>{dt.vertexTexture.ref.value.destroy(),dt.groupTexture.ref.value.destroy(),dt.normalTexture.ref.value.destroy(),dt.doubleBuffer.destroy()}},ct)}(ct):function An(ct){return f({defaultProps:r.t.getDefaultValues(Ot),createGeometry:Zt,createLocationIterator:(dt,Yt)=>{const cn=t.f.Segment.Location(dt,Yt);return(0,L.iQ)(dt.grid.cells.data.length,1,1,()=>cn)},getLoci:Vt,eachLocation:Wt,setUpdateState:(dt,Yt,cn,xn)=>{},geometryUtils:A.e.Utils,mustRecreate:(dt,Yt,cn)=>Yt.tryUseGpu&&!!cn&&jt(dt.volume,cn)},ct)}(ct)}function $t(ct,dt){return t.f.Segment.Loci(ct,dt.segments)}function Vt(ct,dt,Yt,cn,xn){const{objectId:Rn,groupId:er}=ct;if(xn===Rn){const ir=t.f.PickingGranularity.get(dt);return"volume"===ir?t.f.Loci(dt):"object"===ir?t.f.Segment.Loci(dt,[Yt]):t.f.Cell.Loci(dt,M.IX.ofSingleton(er))}return _.BL}function Wt(ct,dt,Yt,cn,xn){const Rn=M.SortedArray.ofSingleton(Yt);return(0,V.bk)(ct,dt,{segments:Rn},xn)}function Zt(ct,dt,Yt,cn,xn,Rn){return kt.apply(this,arguments)}function kt(){return(kt=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){const er=t.f.Segmentation.get(dt);if(!er)throw new Error("missing volume segmentation");ct.runtime.update({message:"Marching cubes..."});const ir=Mt.D.clone(er.bounds[Yt]);Mt.D.expand(ir,ir,s.eB.create(2,2,2));const br=function yn(ct,dt,Yt){const cn=Yt.data,xn=Yt.space.dataOffset,Rn=Mt.D.size((0,s.eB)(),dt),[er,ir,Yn]=Rn,br=er-1,vr=ir-1,Hr=Yn-1,[Mr,Fr,Sr]=dt.min,[Ur,Ro,ro]=dt.max,po=[...Yt.space.axisOrderSlowToFast],so=s.qY.Space(Rn,po,Uint8Array),ho=s.qY.create(so,so.create()),Bo=ho.data,Go=so.set;for(let Wo=0;Wo<Yn;++Wo)for(let We=0;We<ir;++We)for(let Pt=0;Pt<er;++Pt){const Sn=ct.includes(cn[xn(Pt+Mr,We+Fr,Wo+Sr)])?255:0,Nn=ct.includes(cn[xn(Math.min(br+Ur,Pt+1+Mr),We+Fr,Wo+Sr)])?255:0,Kn=ct.includes(cn[xn(Math.max(0,Pt-1+Mr),We+Fr,Wo+Sr)])?255:0,dr=ct.includes(cn[xn(Pt+Mr,Math.min(vr+Ro,We+1+Fr),Wo+Sr)])?255:0,xr=ct.includes(cn[xn(Pt+Mr,Math.max(0,We-1+Fr),Wo+Sr)])?255:0,Ft=ct.includes(cn[xn(Pt+Mr,We+Fr,Math.min(Hr+ro,Wo+1+Sr))])?255:0,Qt=ct.includes(cn[xn(Pt+Mr,We+Fr,Math.max(0,Wo-1+Sr))])?255:0;Go(Bo,Pt,We,Wo,Math.round((Sn+Sn+Nn+Kn+dr+xr+Ft+Qt)/8))}return ho}(Array.from(er.segments.get(Yt).values()),ir,dt.grid.cells),vr=(0,G.WE)(new Int32Array(br.data.length)),Hr=yield(0,y.O)({isoLevel:128,scalarField:br,idField:s.qY.create(br.space,s.qY.Data1(vr))},Rn).runAsChild(ct.runtime),Mr=Dt(dt.grid,ir);return A.e.transform(Hr,Mr),ct.webgl&&!ct.webgl.isWebGL2?(A.e.uniformTriangleGroup(Hr,!1),H.IQ.updateIfChanged(Hr.varyingGroup,!1)):H.IQ.updateIfChanged(Hr.varyingGroup,!0),Hr.setBoundingSphere(t.f.Segment.getBoundingSphere(dt,[Yt])),Hr})).apply(this,arguments)}const Ot={...A.e.Params,...U.X.Params,...nn,quality:{...A.e.Params.quality,isEssential:!1},tryUseGpu:r.t.Boolean(!0)},jn="segment-texture";function fr(ct,dt,Yt,cn,xn,Rn){return Dr.apply(this,arguments)}function Dr(){return(Dr=(0,o.A)(function*(ct,dt,Yt,cn,xn,Rn){if(!ct.webgl)throw new Error("webgl context required to create volume segment texture-mesh");if(dt.grid.cells.data.length<=1)return U.X.createEmpty(Rn);const{texture:er,gridDimension:ir,gridTexDim:Yn,gridTexScale:br,transform:vr}=function On(ct,dt,Yt){const cn=t.f.Segmentation.get(ct);if(!cn)throw new Error("missing volume segmentation");const{resources:xn}=Yt,Rn=Mt.D.clone(cn.bounds[dt]);Mt.D.expand(Rn,Rn,s.eB.create(2,2,2));const er=Dt(ct.grid,Rn),ir=Mt.D.size((0,s.eB)(),Rn),{width:Yn,height:br,powerOfTwoSize:vr}=(0,V.Ud)(ir,Dn),Hr=s.eB.create(Yn,br,0),Mr=s.ZY.create(Yn/vr,br/vr);if(vr>Yt.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");Yt.namedTextures[jn]||(Yt.namedTextures[jn]=xn.texture("image-uint8","alpha","ubyte","linear"));const Fr=Yt.namedTextures[jn];Fr.define(vr,vr);const Sr=Array.from(cn.segments.get(dt).values());return Fr.load((0,V.td)(ct,Sr,Rn,Dn),!0),ir[0]+=Dn,ir[1]+=Dn,{texture:Fr,transform:er,gridDimension:ir,gridTexDim:Hr,gridTexScale:Mr}}(dt,Yt,ct.webgl),Hr=dt.grid.cells.space.axisOrderSlowToFast,Mr=Rn?.doubleBuffer.get(),Fr=(0,N._)(ct.webgl,er,ir,Yn,br,vr,.5,!1,!1,Hr,!0,Mr?.vertex,Mr?.group,Mr?.normal);return U.X.create(Fr.vertexCount,dt.grid.cells.data.length,Fr.vertexTexture,Fr.groupTexture,Fr.normalTexture,t.f.Segment.getBoundingSphere(dt,[Yt]),Rn)})).apply(this,arguments)}function or(ct){return M.SortedArray.ofUnsortedArray(ct.segments)}const Nr={segment:(ct,dt)=>T("Segment mesh",ct,dt,Ct,$t,or)},Ir={...Ot,visuals:r.t.MultiSelect(["segment"],r.t.objectToOptions(Nr)),bumpFrequency:r.t.Numeric(1,{min:0,max:10,step:.1},C.iy.ShadingCategory)},To={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:function Jr(ct,dt){return e.YL.createMulti("Segment",ct,dt,e.YL.StateBuilder,Nr)},getParams:function Or(ct,dt){const Yt=r.t.clone(Ir),cn=t.f.Segmentation.get(dt);if(cn){const xn=Array.from(cn.segments.keys());Yt.segments=r.t.Converted(Rn=>Rn.map(er=>`${er}`),Rn=>Rn.map(er=>parseInt(er)),r.t.MultiSelect(xn.map(Rn=>`${Rn}`),r.t.arrayToOptions(xn.map(Rn=>`${Rn}`)),{isEssential:!0}))}return Yt},defaultValues:r.t.getDefaultValues(Ir),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:ct=>!t.f.isEmpty(ct)&&!!t.f.Segmentation.get(ct)};class un extends e.lN{constructor(){super(),(0,K.IF)(un.BuiltIn,(dt,Yt)=>{if(dt.name!==Yt)throw new Error(`Fix BuiltInVolumeRepresentations to have matching names. ${dt.name} ${Yt}`);this.add(dt)})}}(un||(un={})).BuiltIn={isosurface:Ne,slice:en,"direct-volume":tt,segment:To}},4178:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ud:()=>l,bk:()=>I,sz:()=>m,tO:()=>u,td:()=>d});var e=n(6853),o=n(3543),r=n(2028),t=n(2086),A=n(4951),y=n(9986),c=n(5384);const i=t.e.set,v=t.e.normalize,O=t.e.sub,b=t.e.addScalar,_=t.e.scale,M=t.e.toArray;function I(s,C,h,a){let S=!1;if(e.f.isLoci(s)){if(!e.f.areEquivalent(s.volume,C))return!1;a(o.IX.ofLength(C.grid.cells.data.length))&&(S=!0)}else if(e.f.Isosurface.isLoci(s)){if(!e.f.areEquivalent(s.volume,C))return!1;if(h?.isoValue){if(!e.f.IsoValue.areSame(s.isoValue,h.isoValue,C.grid.stats))return!1;a(o.IX.ofLength(C.grid.cells.data.length))&&(S=!0)}else{const{stats:D,cells:{data:R}}=C.grid,f=D.sigma,p=e.f.IsoValue.toAbsolute(s.isoValue,D).absoluteValue;for(let E=0,T=R.length;E<T;++E)(0,r.T)(p,R[E],f)&&a(o.IX.ofSingleton(E))&&(S=!0)}}else if(e.f.Cell.isLoci(s)){if(!e.f.areEquivalent(s.volume,C))return!1;o.IX.is(s.indices)?a(s.indices)&&(S=!0):o.CD.forEach(s.indices,D=>{a(o.IX.ofSingleton(D))&&(S=!0)})}else if(e.f.Segment.isLoci(s)){if(!e.f.areEquivalent(s.volume,C))return!1;if(h?.segments){if(!o.SortedArray.areIntersecting(s.segments,h.segments))return!1;a(o.IX.ofLength(C.grid.cells.data.length))&&(S=!0)}else{const D=e.f.Segmentation.get(C);if(D){const R=new Set;for(let E=0,T=s.segments.length;E<T;++E)y.M.add(R,D.segments.get(s.segments[E]));const f=Array.from(R.values()),p=C.grid.cells.data;for(let E=0,T=p.length;E<T;++E)f.includes(p[E])&&a(o.IX.ofSingleton(E))&&(S=!0)}}}return S}function l(s,C=0){const a=Math.sqrt(s[0]*s[1]*s[2]),S=Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)));let D=s[0]+C,R=s[1]+C,f=1,p=D;return S<D*s[2]?(p=Math.floor(S/D),f=Math.ceil(s[2]/p),D*=p,R*=f):D*=s[2],{width:D,height:R,columns:p,rows:f,powerOfTwoSize:R<S?S:2*S}}function m(s,C,h=0){const{cells:{space:a,data:S},stats:{max:D,min:R}}=s.grid,f=a.dimensions,{dataOffset:p}=a,{width:E,height:T}=l(f,h),L="data"===C?1:4,w=new Uint8Array(E*T*L),Q={array:w,width:E,height:T},G=D-R,[V,U,N]=f,k=V+h,H=U+h,$=(0,t.e)(),J=(0,t.e)(),W=V-1,te=U-1,de=N-1;for(let ye=0;ye<N;++ye)for(let j=0;j<U;++j)for(let Z=0;Z<V;++Z){const q=Math.floor(ye*k%E/k),g=L*(Math.floor(ye*k/E)*H*E+j*E+(q*k+Z)),_e=p(Z,j,ye);"data"===C?w[g]=Math.round((S[_e]-R)/G*255):("groups"===C?(0,A.Gu)(_e,w,g):(i($,S[p(Math.max(0,Z-1),j,ye)],S[p(Z,Math.max(0,j-1),ye)],S[p(Z,j,Math.max(0,ye-1))]),i(J,S[p(Math.min(W,Z+1),j,ye)],S[p(Z,Math.min(te,j+1),ye)],S[p(Z,j,Math.min(de,ye+1))]),v($,O($,$,J)),b($,_($,$,.5),.5),M(_($,$,255),w,g)),w[g+3]=Math.round((S[_e]-R)/G*255))}return Q}function u(s){const{cells:{space:C,data:h},stats:{max:a,min:S}}=s.grid,[D,R,f]=C.dimensions,{dataOffset:p}=C,E=new Uint8Array(D*R*f*4),T={array:E,width:D,height:R,depth:f},L=a-S,w=(0,t.e)(),Q=(0,t.e)(),G=D-1,V=R-1,U=f-1;let N=0;for(let k=0;k<f;++k)for(let H=0;H<R;++H)for(let $=0;$<D;++$){const J=p($,H,k);i(w,h[p(Math.max(0,$-1),H,k)],h[p($,Math.max(0,H-1),k)],h[p($,H,Math.max(0,k-1))]),i(Q,h[p(Math.min(G,$+1),H,k)],h[p($,Math.min(V,H+1),k)],h[p($,H,Math.min(U,k+1))]),v(w,O(w,w,Q)),b(w,_(w,w,.5),.5),M(_(w,w,255),E,N),E[N+3]=Math.round((h[J]-S)/L*255),N+=4}return T}function d(s,C,h,a=0){const S=s.grid.cells.data,D=c.DJ.size((0,t.e)(),h),R=s.grid.cells.space.dataOffset,{width:f,height:p}=l(D,a),T=new Uint8Array(f*p*1),L={array:T,width:f,height:p},[w,Q,G]=D,V=w-1,U=Q-1,N=G-1,k=w+a,H=Q+a,[$,J,W]=h.min,[te,de,ye]=h.max;for(let j=0;j<G;++j)for(let Z=0;Z<Q;++Z)for(let q=0;q<w;++q){const Y=Math.floor(j*k%f/k),_e=1*(Math.floor(j*k/f)*H*f+Z*f+(Y*k+q)),xe=C.includes(S[R(q+$,Z+J,j+W)])?255:0,le=C.includes(S[R(Math.min(V+te,q+1+$),Z+J,j+W)])?255:0,Ae=C.includes(S[R(Math.max(0,q-1+$),Z+J,j+W)])?255:0,Be=C.includes(S[R(q+$,Math.min(U+de,Z+1+J),j+W)])?255:0,Ce=C.includes(S[R(q+$,Math.max(0,Z-1+J),j+W)])?255:0,Re=C.includes(S[R(q+$,Z+J,Math.min(N+ye,j+1+W))])?255:0,ke=C.includes(S[R(q+$,Z+J,Math.max(0,j-1+W))])?255:0;T[_e]=Math.round((xe+xe+le+Ae+Be+Ce+Re+ke)/8)}return L}},9767:(tn,Ue,n)=>{"use strict";n.d(Ue,{J:()=>o});var o,e=n(643);!function(r){r.core=e.AN.core,r.struct=e.AN.structureQuery,r.internal=e.AN.internal,r.atomName=function t(h){return r.struct.type.atomName([h])},r.es=function A(h){return r.struct.type.elementSymbol([h])},r.list=function y(...h){return r.core.type.list(h)},r.set=function c(...h){return r.core.type.set(h)},r.re=function i(h,a){return r.core.type.regex([h,a])},r.fn=function v(h){return r.core.ctrl.fn([h])},r.evaluate=function O(h){return r.core.ctrl.eval([h])};const b=r.struct.atomProperty.core,_=r.struct.atomProperty.macromolecular,M=r.struct.atomProperty.topology;function I(h){return b[h]()}function l(h){return M[h]()}function m(h){return _[h]()}r.acp=I,r.atp=l,r.ammp=m;const u=r.struct.atomSet.propertySet;r.acpSet=function d(h){return u([I(h)])},r.atpSet=function s(h){return u([l(h)])},r.ammpSet=function C(h){return u([m(h)])}}(o||(o={}))},9920:(tn,Ue,n)=>{"use strict";var e;n.d(Ue,{r:()=>e}),function(o){function i(O){return!!O&&!!O.head&&"object"==typeof O}function v(O){return!!O&&"string"==typeof O.name}o.Symbol=function r(O){return{name:O}},o.Apply=function t(O,b){return b?{head:O,args:b}:{head:O}},o.isArgumentsArray=function A(O){return!!O&&Array.isArray(O)},o.isArgumentsMap=function y(O){return!!O&&!Array.isArray(O)},o.isLiteral=function c(O){return!i(O)&&!v(O)},o.isApply=i,o.isSymbol=v}(e||(e={}))},685:(tn,Ue,n)=>{"use strict";n.d(Ue,{HR:()=>o,br:()=>t,ec:()=>r});var e=n(3170);function o(i,v,O){return(0,e.EX)("",i,v,O)}function r(i){y("","",i)}function t(i){const v=[];return c(i,v),v}function A(i){const v=/([a-z])([A-Z])([a-z]|$)/g;return i.replace(v,(O,b,_,M)=>`${b}-${_.toLocaleLowerCase()}${M}`).replace(v,(O,b,_,M)=>`${b}-${_.toLocaleLowerCase()}${M}`)}function y(i,v,O){if((0,e.Bm)(O))return O.info.namespace=i,O.info.name=O.info.name||A(v),void(O.id=`${O.info.namespace}.${O.info.name}`);const b=`${O["@namespace"]||A(v)}`,_=i?`${i}.${b}`:b;for(const M of Object.keys(O))"object"!=typeof O[M]&&!(0,e.Bm)(O[M])||y(_,M,O[M])}function c(i,v){if((0,e.Bm)(i))v.push(i);else for(const O of Object.keys(i))"object"!=typeof i[O]&&!(0,e.Bm)(i[O])||c(i[O],v)}},643:(tn,Ue,n)=>{"use strict";n.d(Ue,{AN:()=>i});var e=n(2513),o=n(6452),r=n(6430),t=n(3170),A=n(685);const c={"@header":"Internal Queries",generator:{"@header":"Generators",bundleElement:(0,A.HR)(t.d3.Dictionary({groupedUnits:(0,t.ef)(r.Z.Any),set:(0,t.ef)(r.Z.Any),ranges:(0,t.ef)(r.Z.Any)}),r.Z.Any),bundle:(0,A.HR)(t.d3.Dictionary({elements:(0,t.ef)(r.Z.Any)}),o.O.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:(0,A.HR)(t.d3.None,o.O.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")}},i={core:e.I8,structureQuery:o.q,internal:c};(0,A.ec)(i);const v=(0,A.br)(i);!function(){const b=Object.create(null);for(const _ of v)b[_.id]=_}()},2513:(tn,Ue,n)=>{"use strict";n.d(Ue,{I8:()=>d,Or:()=>t});var t,h,e=n(6430),o=n(3170),r=n(685);function A(h,a){return(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(h)}),h,a)}function y(h,a){return(0,r.HR)(o.d3.List(h,{nonEmpty:!0}),h,a)}function c(h,a,S){return(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(h),1:(0,o.ef)(h)}),a,S)}(h=t||(t={})).AnyVar=e.Z.Variable("a",e.Z.Any),h.AnyValueVar=e.Z.Variable("a",e.Z.Any),h.ConstrainedVar=e.Z.Variable("a",e.Z.Any,!0),h.Regex=e.Z.Value("Core","Regex"),h.Set=a=>e.Z.Container("Core","Set",a||h.AnyValueVar),h.List=a=>e.Z.Container("Core","List",a||h.AnyVar),h.Fn=(a,S)=>e.Z.Container("Core","Fn",a||h.AnyVar,S),h.Flags=(a,S)=>e.Z.Container("Core","Flags",a,S),h.BitFlags=h.Flags(e.Z.Num,"BitFlags"),o.d3.Dictionary({0:(0,o.ef)(e.Z.Num),1:(0,o.ef)(e.Z.Num)});const d={"@header":"Language Primitives",type:{"@header":"Types",bool:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.AnyValue)}),e.Z.Bool,"Convert a value to boolean."),num:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.AnyValue)}),e.Z.Num,"Convert a value to number."),str:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.AnyValue)}),e.Z.Str,"Convert a value to string."),regex:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.Str,{description:"Expression"}),1:(0,o.ef)(e.Z.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),t.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:(0,r.HR)(o.d3.List(t.AnyVar),t.List()),set:(0,r.HR)(o.d3.List(t.AnyValueVar),t.Set()),bitflags:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.Num)}),t.BitFlags,"Interpret a number as bitflags."),compositeKey:(0,r.HR)(o.d3.List(e.Z.AnyValue),e.Z.AnyValue)},logic:{"@header":"Logic",not:A(e.Z.Bool),and:y(e.Z.Bool),or:y(e.Z.Bool)},ctrl:{"@header":"Control",eval:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.Fn(t.AnyVar))}),t.AnyVar,"Evaluate a function."),fn:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.AnyVar)}),t.Fn(t.AnyVar),'Wrap an expression to a "lazy" function.'),if:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.Bool,{description:"Condition"}),1:(0,o.ef)(e.Z.Variable("a",e.Z.Any),{description:"If true"}),2:(0,o.ef)(e.Z.Variable("b",e.Z.Any),{description:"If false"})}),e.Z.Union([e.Z.Variable("a",e.Z.Any),e.Z.Variable("b",e.Z.Any)])),assoc:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.Str,{description:"Name"}),1:(0,o.ef)(e.Z.Variable("a",e.Z.Any),{description:"Value to assign"})}),e.Z.Variable("a",e.Z.Any))},rel:{"@header":"Relational",eq:c(e.Z.Variable("a",e.Z.AnyValue,!0),e.Z.Bool),neq:c(e.Z.Variable("a",e.Z.AnyValue,!0),e.Z.Bool),lt:c(e.Z.Num,e.Z.Bool),lte:c(e.Z.Num,e.Z.Bool),gr:c(e.Z.Num,e.Z.Bool),gre:c(e.Z.Num,e.Z.Bool),inRange:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.Num,{description:"Value to test"}),1:(0,o.ef)(e.Z.Num,{description:"Minimum value"}),2:(0,o.ef)(e.Z.Num,{description:"Maximum value"})}),e.Z.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},math:{"@header":"Math",add:y(e.Z.Num),sub:y(e.Z.Num),mult:y(e.Z.Num),div:c(e.Z.Num,e.Z.Num),pow:c(e.Z.Num,e.Z.Num),mod:c(e.Z.Num,e.Z.Num),min:y(e.Z.Num),max:y(e.Z.Num),cantorPairing:c(e.Z.Num,e.Z.Num),sortedCantorPairing:c(e.Z.Num,e.Z.Num),invertCantorPairing:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(e.Z.Num)}),t.List(e.Z.Num)),floor:A(e.Z.Num),ceil:A(e.Z.Num),roundInt:A(e.Z.Num),trunc:A(e.Z.Num),abs:A(e.Z.Num),sign:A(e.Z.Num),sqrt:A(e.Z.Num),cbrt:A(e.Z.Num),sin:A(e.Z.Num),cos:A(e.Z.Num),tan:A(e.Z.Num),asin:A(e.Z.Num),acos:A(e.Z.Num),atan:A(e.Z.Num),sinh:A(e.Z.Num),cosh:A(e.Z.Num),tanh:A(e.Z.Num),exp:A(e.Z.Num),log:A(e.Z.Num),log10:A(e.Z.Num),atan2:c(e.Z.Num,e.Z.Num)},str:{"@header":"Strings",concat:y(e.Z.Str),match:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.Regex),1:(0,o.ef)(e.Z.Str)}),e.Z.Bool)},list:{"@header":"Lists",getAt:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.List()),1:(0,o.ef)(e.Z.Num)}),t.AnyVar),equal:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.List()),1:(0,o.ef)(t.List())}),e.Z.Bool)},set:{"@header":"Sets",has:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.Set(t.ConstrainedVar)),1:(0,o.ef)(t.ConstrainedVar)}),e.Z.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.Set(t.ConstrainedVar)),1:(0,o.ef)(t.Set(t.ConstrainedVar))}),e.Z.Bool,"Check if the the 1st argument is a subset of the 2nd.")},flags:{"@header":"Flags",hasAny:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.Flags(t.ConstrainedVar)),1:(0,o.ef)(t.Flags(t.ConstrainedVar))}),e.Z.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:(0,r.HR)(o.d3.Dictionary({0:(0,o.ef)(t.Flags(t.ConstrainedVar)),1:(0,o.ef)(t.Flags(t.ConstrainedVar))}),e.Z.Bool,"Check if the the 1st argument has all 2nd one's flags.")}};(0,r.ec)(d);const s=(0,r.br)(d);!function(){const h=Object.create(null);for(const a of s)h[a.id]=a}()},6452:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>A,q:()=>u});var A,d,e=n(6430),o=n(2513),r=n(3170),t=n(685);function l(d,s){return(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),d,s)}function m(d,s){return(0,t.HR)(r.d3.None,d,s)}(d=A||(A={})).ElementSymbol=e.Z.Value("Structure","ElementSymbol"),d.AtomName=e.Z.Value("Structure","AtomName"),d.BondFlag=e.Z.OneOf("Structure","BondFlag",e.Z.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),d.BondFlags=o.Or.Flags(d.BondFlag,"BondFlags"),d.SecondaryStructureFlag=e.Z.OneOf("Structure","SecondaryStructureFlag",e.Z.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),d.SecondaryStructureFlags=o.Or.Flags(d.SecondaryStructureFlag,"SecondaryStructureFlag"),d.RingFingerprint=e.Z.Value("Structure","RingFingerprint"),d.EntityType=e.Z.OneOf("Structure","EntityType",e.Z.Str,["polymer","non-polymer","water","branched"]),d.EntitySubtype=e.Z.OneOf("Structure","EntitySubtype",e.Z.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),d.ObjectPrimitive=e.Z.OneOf("Structure","ObjectPrimitive",e.Z.Str,["atomistic","sphere","gaussian","other"]),d.ResidueId=e.Z.Value("Structure","ResidueId"),d.ElementSet=e.Z.Value("Structure","ElementSet"),d.ElementSelection=e.Z.Value("Structure","ElementSelection"),d.ElementReference=e.Z.Value("Structure","ElementReference"),d.ElementSelectionQuery=o.Or.Fn(d.ElementSelection,"ElementSelectionQuery");const u={"@header":"Structure Queries",type:{"@header":"Types",elementSymbol:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(e.Z.Str)}),A.ElementSymbol,"Create element symbol representation from a string value."),atomName:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(e.Z.AnyValue)}),A.AtomName,"Convert a value to an atom name."),entityType:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.EntityType)}),A.EntityType,`Create normalized representation of entity type: ${e.Z.oneOfValues(A.EntityType).join(", ")}.`),bondFlags:(0,t.HR)(r.d3.List(A.BondFlag),A.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${e.Z.oneOfValues(A.BondFlag).join(", ")}.`),ringFingerprint:(0,t.HR)(r.d3.List(A.ElementSymbol,{nonEmpty:!0}),A.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:(0,t.HR)(r.d3.List(A.SecondaryStructureFlag),A.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${e.Z.oneOfValues(A.SecondaryStructureFlag).join(", ")}.`),authResidueId:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(e.Z.Str,{description:"auth_asym_id"}),1:(0,r.ef)(e.Z.Num,{description:"auth_seq_id"}),2:(0,r.ef)(e.Z.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),A.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(e.Z.Str,{description:"label_entity_id"}),1:(0,r.ef)(e.Z.Str,{description:"label_asym_id"}),2:(0,r.ef)(e.Z.Num,{description:"label_seq_id"}),3:(0,r.ef)(e.Z.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),A.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')},slot:{"@header":"Iteration Slots",element:(0,t.HR)(r.d3.None,A.ElementReference,"A reference to the current element."),elementSetReduce:(0,t.HR)(r.d3.None,e.Z.Variable("a",e.Z.AnyValue,!0),"Current value of the element set reducer.")},generator:{"@header":"Generators",all:(0,t.HR)(r.d3.None,A.ElementSelectionQuery,"The entire structure."),atomGroups:(0,t.HR)(r.d3.Dictionary({"entity-test":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!0}),"group-by":(0,r.ef)(e.Z.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),A.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),A.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:(0,t.HR)(r.d3.Dictionary({fingerprint:(0,r.ef)(A.RingFingerprint,{isOptional:!0}),"only-aromatic":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!1})}),A.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),query:(0,r.ef)(A.ElementSelectionQuery),"in-complement":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!1})}),A.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:(0,t.HR)(r.d3.None,A.ElementSelectionQuery,"Nada.")},modifier:{"@header":"Selection Modifications",queryEach:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),query:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),by:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),by:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),by:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),"min-distance":(0,r.ef)(e.Z.Num,{isOptional:!0,defaultValue:0}),"max-distance":(0,r.ef)(e.Z.Num),"min-size":(0,r.ef)(e.Z.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":(0,r.ef)(e.Z.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),A.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),radius:(0,r.ef)(e.Z.Num),"atom-radius":(0,r.ef)(e.Z.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":(0,r.ef)(e.Z.Bool,{isOptional:!0})}),A.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),radius:(0,r.ef)(e.Z.Num),"include-water":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!0})}),A.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),"bond-test":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":(0,r.ef)(e.Z.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":(0,r.ef)(e.Z.Bool,{isOptional:!0})}),A.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),property:(0,r.ef)(e.Z.AnyValue)}),A.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},filter:{"@header":"Selection Filters",pick:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),test:(0,r.ef)(e.Z.Bool)}),A.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),source:(0,r.ef)(A.ElementSelectionQuery),property:(0,r.ef)(e.Z.Any)}),A.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),by:(0,r.ef)(A.ElementSelectionQuery)}),A.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),target:(0,r.ef)(A.ElementSelectionQuery),"min-radius":(0,r.ef)(e.Z.Num,{isOptional:!0,defaultValue:0}),"max-radius":(0,r.ef)(e.Z.Num),"atom-radius":(0,r.ef)(e.Z.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),A.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery),target:(0,r.ef)(A.ElementSelectionQuery),"bond-test":(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:(0,r.ef)(e.Z.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),A.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},combinator:{"@header":"Selection Combinators",intersect:(0,t.HR)(r.d3.List(A.ElementSelectionQuery),A.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:(0,t.HR)(r.d3.List(A.ElementSelectionQuery),A.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:(0,t.HR)(r.d3.Dictionary({matrix:(0,r.ef)(o.Or.List(o.Or.List(e.Z.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:(0,r.ef)(o.Or.List(A.ElementSelectionQuery),{description:"A list of held selections."})}),A.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},atomSet:{"@header":"Atom Sets",atomCount:(0,t.HR)(r.d3.None,e.Z.Num),countQuery:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementSelectionQuery)}),e.Z.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:(0,t.HR)(r.d3.Dictionary({initial:(0,r.ef)(e.Z.Variable("a",e.Z.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:(0,r.ef)(e.Z.Variable("a",e.Z.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),e.Z.Variable("a",e.Z.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(o.Or.ConstrainedVar)}),o.Or.Set(o.Or.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},atomProperty:{"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:l(A.ElementSymbol),vdw:l(e.Z.Num,"Van der Waals radius"),mass:l(e.Z.Num,"Atomic weight"),atomicNumber:l(e.Z.Num,"Atomic number"),x:l(e.Z.Num,"Cartesian X coordinate"),y:l(e.Z.Num,"Cartesian Y coordinate"),z:l(e.Z.Num,"Cartesian Z coordinate"),atomKey:l(e.Z.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:(0,t.HR)(r.d3.Dictionary({0:(0,r.ef)(A.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:(0,r.ef)(A.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),e.Z.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:l(e.Z.Num,"Index of the atom/element in the input file."),operatorName:l(e.Z.Str,"Name of the symmetry operator applied to this element."),operatorKey:l(e.Z.Num,"Key of the symmetry operator applied to this element."),modelIndex:l(e.Z.Num,"Index of the model in the input file."),modelLabel:l(e.Z.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:l(e.Z.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:l(A.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:l(A.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:l(e.Z.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:l(e.Z.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:l(e.Z.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:l(e.Z.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:l(e.Z.Num,"_atom_site.id"),label_atom_id:l(A.AtomName),label_alt_id:l(e.Z.Str),label_comp_id:l(e.Z.Str),label_asym_id:l(e.Z.Str),label_entity_id:l(e.Z.Str),label_seq_id:l(e.Z.Num),auth_atom_id:l(A.AtomName),auth_comp_id:l(e.Z.Str),auth_asym_id:l(e.Z.Str),auth_seq_id:l(e.Z.Num),pdbx_PDB_ins_code:l(e.Z.Str),pdbx_formal_charge:l(e.Z.Num),occupancy:l(e.Z.Num),B_iso_or_equiv:l(e.Z.Num),entityType:l(A.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:l(A.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:l(e.Z.Str,"The PRD ID of the entity."),entityDescription:l(o.Or.List(e.Z.Str)),objectPrimitive:l(A.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:l(e.Z.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:l(A.SecondaryStructureFlags),isModified:l(e.Z.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:l(e.Z.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:l(e.Z.Bool,"True if this is a non-standard residue."),chemCompType:l(e.Z.Str,"Type of the chemical component as defined in mmCIF.")}},bondProperty:{"@header":"Bond Properties",flags:m(A.BondFlags),order:m(e.Z.Num),key:m(e.Z.Num),length:m(e.Z.Num),atomA:m(A.ElementReference),atomB:m(A.ElementReference)}}},3170:(tn,Ue,n)=>{"use strict";n.d(Ue,{Bm:()=>y,EX:()=>t,d3:()=>r,ef:()=>o,vy:()=>A});var r,e=n(9920);function o(c,i){const{description:v,isOptional:O=!1,isRest:b=!1,defaultValue:_}=i||{};return{type:c,isOptional:O,isRest:b,defaultValue:_,description:v}}function t(c,i,v,O){const b=function(_){return e.r.Apply(e.r.Symbol(b.id),_)};return b.info={namespace:"",name:c,description:O},b.id="",b.args=i,b.type=v,b}function A(c,i,v,O){const b=function(_){return e.r.Apply(e.r.Symbol(b.id),_)};return b.info={namespace:c,name:i,description:O},b.id=`${c}.${i}`,b.args=r.None,b.type=v,b}function y(c){return"function"==typeof c&&!!c.info&&!!c.args&&"string"==typeof c.info.namespace&&!!c.type}!function(c){function i(O){return{kind:"dictionary",map:O,"@type":0}}c.None=i({}),c.Dictionary=i,c.List=function v(O,b){const{nonEmpty:_=!1}=b||{};return{kind:"list",type:O,nonEmpty:_,"@type":0}}}(r||(r={}))},6430:(tn,Ue,n)=>{"use strict";var e;n.d(Ue,{Z:()=>e}),function(o){function t(v,O,b){return{kind:"value",namespace:v,name:O,parent:b}}function c(v,O,b,_){const M=Object.create(null);for(const I of _)M[I]=!0;return{kind:"oneof",namespace:v,name:O,type:b,values:M}}o.Variable=function r(v,O,b){return{kind:"variable",name:v,type:O,isConstraint:b}},o.Value=t,o.Container=function A(v,O,b,_){return{kind:"container",namespace:v,name:O,child:b,alias:_}},o.Union=function y(v){return{kind:"union",types:v}},o.OneOf=c,o.Any={kind:"any"},o.AnyValue={kind:"any-value"},o.Num=t("","Number"),o.Str=t("","String"),o.Bool=c("","Bool",o.Str,["true","false"]),o.oneOfValues=function i({values:v}){return Object.keys(v).sort()}}(e||(e={}))},7232:(tn,Ue,n)=>{"use strict";n.d(Ue,{Bg:()=>v,TO:()=>i,oY:()=>t,wE:()=>M});var e=n(9920),o=n(9136);const t=new class r{constructor(){this.map=new Map}removeSymbol(l){this.map.delete(l.symbol.id)}addSymbol(l){this.map.has(l.symbol.id)&&console.warn(`Symbol '${l.symbol.id}' already added. Call removeSymbol/removeCustomProps re-adding the symbol.`),this.map.set(l.symbol.id,l)}addCustomProp(l){if(l.symbols)for(const m of Object.keys(l.symbols))this.addSymbol(l.symbols[m])}removeCustomProp(l){if(l.symbols)for(const m of Object.keys(l.symbols))this.removeSymbol(l.symbols[m])}getRuntime(l){return this.map.get(l)}};class A{constructor(l){this.table=l,this.constQueryContext=new o.cY(o.oE.Empty)}}var y,I,c,i,v;(I=y||(y={})).Const=function l(u){return{kind:"const",value:u}},I.Dynamic=function m(u){return{kind:"dynamic",runtime:u}},function(I){I.Const=function l(u){return{isConst:!0,fn:function(s){return u}}},I.Dynamic=function m(u){return{isConst:!1,fn:u}}}(c||(c={})),function(I){I.forEachEval=function l(m,u,d,s){if("number"==typeof m.length)for(let C=0,h=m.length;C<h;C++)d(m[C](u),C,s);else{let C=0;for(const h of Object.keys(m))d(m[h](u),C++,s)}return s}}(i||(i={})),function(I){I.Const=function l(u,d){return new O(u,d,!0)},I.Dynamic=function m(u,d){return new O(u,d,!1)}}(v||(v={}));class O{compile(l,m){let u,d=!1;if(m)if(e.r.isArgumentsArray(m)){u=[],d=!0;for(const s of m){const C=_(l,s);d=d&&C.isConst,u.push(C.fn)}}else{u=Object.create(null),d=!0;for(const s of Object.keys(m)){const C=_(l,m[s]);d=d&&C.isConst,u[s]=C.fn}}else u=void 0,d=!0;return this.isConst&&this.isConst&&d?c.Const(this.fn(l.constQueryContext,u)):c.Dynamic(function b(I,l){return function(u){return I(u,l)}}(this.fn,u))}constructor(l,m,u){this.symbol=l,this.fn=m,this.isConst=u}}function _(I,l){if(e.r.isLiteral(l))return c.Const(l);if(e.r.isSymbol(l)){const u=I.table.getRuntime(l.name);return u?u.compile(I):c.Const(l.name)}if(!e.r.isSymbol(l.head))throw new Error("Can only apply symbols.");const m=I.table.getRuntime(l.head.name);if(!m)throw new Error(`Symbol '${l.head.name}' is not implemented.`);return m.compile(I,l.args)}function M(I){return _(new A(t),I).fn}},7291:(tn,Ue,n)=>{"use strict";n.d(Ue,{oY:()=>e.oY,Bg:()=>e.Bg,wE:()=>e.wE});var e=n(7232),o=n(643),r=n(9136),t=n(2434),A=n(9986),y=n(7785),c=n(2008),i=n(8382),v=n(5988),O=n(6115);const b=e.Bg.Const,_=e.Bg.Dynamic,M=[b(o.AN.core.type.bool,function(s,C){return!!C[0](s)}),b(o.AN.core.type.num,function(s,C){return+C[0](s)}),b(o.AN.core.type.str,function(s,C){return""+C[0](s)}),b(o.AN.core.type.list,function(s,C){return e.TO.forEachEval(C,s,(h,a,S)=>S[a]=h,[])}),b(o.AN.core.type.set,function(s,C){return e.TO.forEachEval(C,s,function(a,S,D){return D.add(a)},new Set)}),b(o.AN.core.type.regex,function(s,C){return new RegExp(C[0](s),C[1]&&C[1](s)||"")}),b(o.AN.core.type.bitflags,function(s,C){return+C[0](s)}),b(o.AN.core.type.compositeKey,function(s,C){return e.TO.forEachEval(C,s,(h,a,S)=>S[a]=""+h,[]).join("-")}),b(o.AN.core.logic.not,(d,s)=>!s[0](d)),b(o.AN.core.logic.and,(d,s)=>{if("number"==typeof s.length){for(let C=0,h=s.length;C<h;C++)if(!s[C](d))return!1}else for(const C of Object.keys(s))if(!s[C](d))return!1;return!0}),b(o.AN.core.logic.or,(d,s)=>{if("number"==typeof s.length){for(let C=0,h=s.length;C<h;C++)if(s[C](d))return!0}else for(const C of Object.keys(s))if(s[C](d))return!0;return!1}),b(o.AN.core.rel.eq,(d,s)=>s[0](d)===s[1](d)),b(o.AN.core.rel.neq,(d,s)=>s[0](d)!==s[1](d)),b(o.AN.core.rel.lt,(d,s)=>s[0](d)<s[1](d)),b(o.AN.core.rel.lte,(d,s)=>s[0](d)<=s[1](d)),b(o.AN.core.rel.gr,(d,s)=>s[0](d)>s[1](d)),b(o.AN.core.rel.gre,(d,s)=>s[0](d)>=s[1](d)),b(o.AN.core.rel.inRange,(d,s)=>{const C=s[0](d);return C>=s[1](d)&&C<=s[2](d)}),b(o.AN.core.math.add,(d,s)=>{let C=0;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C+=s[h](d);else for(const h of Object.keys(s))C+=s[h](d);return C}),b(o.AN.core.math.sub,(d,s)=>{let C=0;if("number"==typeof s.length){if(1===s.length)return-s[0](d);C=s[0](d)||0;for(let h=1,a=s.length;h<a;h++)C-=s[h](d)}else{const h=Object.keys(s);if(1===h.length)return-s[h[0]](d);C=s[h[0]](d)||0;for(let a=1,S=h.length;a<S;a++)C-=s[h[a]](d)}return C}),b(o.AN.core.math.mult,(d,s)=>{let C=1;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C*=s[h](d);else for(const h of Object.keys(s))C*=s[h](d);return C}),b(o.AN.core.math.div,(d,s)=>s[0](d)/s[1](d)),b(o.AN.core.math.pow,(d,s)=>Math.pow(s[0](d),s[1](d))),b(o.AN.core.math.mod,(d,s)=>s[0](d)%s[1](d)),b(o.AN.core.math.min,(d,s)=>{let C=Number.POSITIVE_INFINITY;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C=Math.min(s[h](d),C);else for(const h of Object.keys(s))C=Math.min(s[h](d),C);return C}),b(o.AN.core.math.max,(d,s)=>{let C=Number.NEGATIVE_INFINITY;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C=Math.max(s[h](d),C);else for(const h of Object.keys(s))C=Math.max(s[h](d),C);return C}),b(o.AN.core.math.cantorPairing,(d,s)=>(0,i.m1)(s[0](d),s[1](d))),b(o.AN.core.math.sortedCantorPairing,(d,s)=>(0,i.bd)(s[0](d),s[1](d))),b(o.AN.core.math.invertCantorPairing,(d,s)=>(0,i.Ao)([0,0],s[0](d))),b(o.AN.core.math.floor,(d,s)=>Math.floor(s[0](d))),b(o.AN.core.math.ceil,(d,s)=>Math.ceil(s[0](d))),b(o.AN.core.math.roundInt,(d,s)=>Math.round(s[0](d))),b(o.AN.core.math.trunc,(d,s)=>Math.trunc(s[0](d))),b(o.AN.core.math.abs,(d,s)=>Math.abs(s[0](d))),b(o.AN.core.math.sign,(d,s)=>Math.sign(s[0](d))),b(o.AN.core.math.sqrt,(d,s)=>Math.sqrt(s[0](d))),b(o.AN.core.math.cbrt,(d,s)=>Math.cbrt(s[0](d))),b(o.AN.core.math.sin,(d,s)=>Math.sin(s[0](d))),b(o.AN.core.math.cos,(d,s)=>Math.cos(s[0](d))),b(o.AN.core.math.tan,(d,s)=>Math.tan(s[0](d))),b(o.AN.core.math.asin,(d,s)=>Math.asin(s[0](d))),b(o.AN.core.math.acos,(d,s)=>Math.acos(s[0](d))),b(o.AN.core.math.atan,(d,s)=>Math.atan(s[0](d))),b(o.AN.core.math.sinh,(d,s)=>Math.sinh(s[0](d))),b(o.AN.core.math.cosh,(d,s)=>Math.cosh(s[0](d))),b(o.AN.core.math.tanh,(d,s)=>Math.tanh(s[0](d))),b(o.AN.core.math.exp,(d,s)=>Math.exp(s[0](d))),b(o.AN.core.math.log,(d,s)=>Math.log(s[0](d))),b(o.AN.core.math.log10,(d,s)=>Math.log10(s[0](d))),b(o.AN.core.math.atan2,(d,s)=>Math.atan2(s[0](d),s[1](d))),b(o.AN.core.str.match,(d,s)=>s[0](d).test(s[1](d))),b(o.AN.core.str.concat,(d,s)=>{const C=[];if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C.push(s[h](d).toString());else for(const h of Object.keys(s))C.push(s[h](d).toString());return C.join("")}),b(o.AN.core.list.getAt,(d,s)=>s[0](d)[s[1](d)]),b(o.AN.core.list.equal,(d,s)=>(0,O.af)(s[0](d),s[1](d))),b(o.AN.core.set.has,function(s,C){return C[0](s).has(C[1](s))}),b(o.AN.core.set.isSubset,function(s,C){return A.M.isSuperset(C[1](s),C[0](s))}),b(o.AN.core.flags.hasAny,(d,s)=>{const C=s[1](d),h=s[0](d);return C?!!(h&C):!!h}),b(o.AN.core.flags.hasAll,(d,s)=>{const C=s[1](d),h=s[0](d);return C?(h&C)===C:!h}),b(o.AN.structureQuery.type.elementSymbol,(d,s)=>(0,t.F1)(s[0](d))),b(o.AN.structureQuery.type.atomName,(d,s)=>(0,y.r4)(s[0](d))),b(o.AN.structureQuery.type.bondFlags,(d,s)=>{let C=0;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C=l(C,s[h](d));else for(const h of Object.keys(s))C=l(C,s[h](d));return C}),b(o.AN.structureQuery.type.ringFingerprint,(d,s)=>r.X$.elementFingerprint(function u(d,s){const C=[];if(!s)return C;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C.push(s[h](d));else{const h=Object.keys(s);for(let a=1,S=h.length;a<S;a++)C.push(s[h[a]](d))}return C}(d,s))),b(o.AN.structureQuery.type.secondaryStructureFlags,(d,s)=>{let C=0;if("number"==typeof s.length)for(let h=0,a=s.length;h<a;h++)C=m(C,s[h](d));else for(const h of Object.keys(s))C=m(C,s[h](d));return C}),_(o.AN.structureQuery.filter.pick,(d,s)=>r.RT.filters.pick(s[0],s.test)(d)),_(o.AN.structureQuery.filter.first,(d,s)=>r.RT.filters.first(s[0])(d)),_(o.AN.structureQuery.filter.withSameAtomProperties,(d,s)=>r.RT.filters.withSameAtomProperties(s[0],s.source,s.property)(d)),_(o.AN.structureQuery.filter.intersectedBy,(d,s)=>r.RT.filters.areIntersectedBy(s[0],s.by)(d)),_(o.AN.structureQuery.filter.within,(d,s)=>{var C,h,a;return r.RT.filters.within({query:s[0],target:s.target,minRadius:null===(C=s["min-radius"])||void 0===C?void 0:C.call(s,d),maxRadius:null===(h=s["max-radius"])||void 0===h?void 0:h.call(s,d),elementRadius:s["atom-radius"],invert:null===(a=s.invert)||void 0===a?void 0:a.call(s,d)})(d)}),_(o.AN.structureQuery.filter.isConnectedTo,(d,s)=>{var C,h;return r.RT.filters.isConnectedTo({query:s[0],target:s.target,disjunct:null===(C=s.disjunct)||void 0===C?void 0:C.call(s,d),invert:null===(h=s.invert)||void 0===h?void 0:h.call(s,d),bondTest:s["bond-test"]})(d)}),_(o.AN.structureQuery.generator.atomGroups,function(s,C){return r.RT.generators.atoms({entityTest:C["entity-test"],chainTest:C["chain-test"],residueTest:C["residue-test"],atomTest:C["atom-test"],groupBy:C["group-by"]})(s)}),_(o.AN.structureQuery.generator.all,function(s){return r.RT.generators.all(s)}),_(o.AN.structureQuery.generator.empty,function(s){return r.RT.generators.none(s)}),_(o.AN.structureQuery.generator.bondedAtomicPairs,function(s,C){return r.RT.generators.bondedAtomicPairs(C&&C[0])(s)}),_(o.AN.structureQuery.generator.rings,function(s,C){var h,a;return r.RT.generators.rings(null===(h=C?.fingerprint)||void 0===h?void 0:h.call(C,s),null===(a=C?.["only-aromatic"])||void 0===a?void 0:a.call(C,s))(s)}),_(o.AN.structureQuery.generator.queryInSelection,function(s,C){var h;return r.RT.generators.querySelection(C[0],C.query,null===(h=C["in-complement"])||void 0===h?void 0:h.call(C,s))(s)}),_(o.AN.structureQuery.modifier.includeSurroundings,function(s,C){return r.RT.modifiers.includeSurroundings(C[0],{radius:C.radius(s),wholeResidues:!(!C["as-whole-residues"]||!C["as-whole-residues"](s)),elementRadius:C["atom-radius"]})(s)}),_(o.AN.structureQuery.modifier.surroundingLigands,function(s,C){return r.RT.modifiers.surroundingLigands({query:C[0],radius:C.radius(s),includeWater:!(!C["include-water"]||!C["include-water"](s))})(s)}),_(o.AN.structureQuery.modifier.wholeResidues,function(s,C){return r.RT.modifiers.wholeResidues(C[0])(s)}),_(o.AN.structureQuery.modifier.union,function(s,C){return r.RT.modifiers.union(C[0])(s)}),_(o.AN.structureQuery.modifier.expandProperty,function(s,C){return r.RT.modifiers.expandProperty(C[0],C.property)(s)}),_(o.AN.structureQuery.modifier.exceptBy,function(s,C){return r.RT.modifiers.exceptBy(C[0],C.by)(s)}),_(o.AN.structureQuery.modifier.includeConnected,function(s,C){var h,a;return r.RT.modifiers.includeConnected({query:C[0],bondTest:C["bond-test"],wholeResidues:!(!C["as-whole-residues"]||!C["as-whole-residues"](s)),layerCount:C["layer-count"]&&C["layer-count"](s)||1,fixedPoint:null!==(a=null===(h=C["fixed-point"])||void 0===h?void 0:h.call(C,s))&&void 0!==a&&a})(s)}),_(o.AN.structureQuery.modifier.intersectBy,function(s,C){return r.RT.modifiers.intersectBy(C[0],C.by)(s)}),_(o.AN.structureQuery.combinator.merge,(d,s)=>r.RT.combinators.merge(s)(d)),_(o.AN.structureQuery.atomProperty.core.elementSymbol,I(r.StructureProperties.atom.type_symbol)),_(o.AN.structureQuery.atomProperty.core.vdw,(d,s)=>(0,c.sO)(r.StructureProperties.atom.type_symbol(s&&s[0]&&s[0](d)||d.element))),_(o.AN.structureQuery.atomProperty.core.mass,(d,s)=>(0,c.A9)(r.StructureProperties.atom.type_symbol(s&&s[0]&&s[0](d)||d.element))),_(o.AN.structureQuery.atomProperty.core.atomicNumber,(d,s)=>(0,c.PR)(r.StructureProperties.atom.type_symbol(s&&s[0]&&s[0](d)||d.element))),_(o.AN.structureQuery.atomProperty.core.x,I(r.StructureProperties.atom.x)),_(o.AN.structureQuery.atomProperty.core.y,I(r.StructureProperties.atom.y)),_(o.AN.structureQuery.atomProperty.core.z,I(r.StructureProperties.atom.z)),_(o.AN.structureQuery.atomProperty.core.sourceIndex,I(r.StructureProperties.atom.sourceIndex)),_(o.AN.structureQuery.atomProperty.core.operatorName,I(r.StructureProperties.unit.operator_name)),_(o.AN.structureQuery.atomProperty.core.operatorKey,I(r.StructureProperties.unit.operator_key)),_(o.AN.structureQuery.atomProperty.core.modelIndex,I(r.StructureProperties.unit.model_index)),_(o.AN.structureQuery.atomProperty.core.modelLabel,I(r.StructureProperties.unit.model_label)),_(o.AN.structureQuery.atomProperty.core.atomKey,(d,s)=>{const C=s&&s[0]&&s[0](d)||d.element;return(0,i.m1)(C.unit.id,C.element)}),_(o.AN.structureQuery.atomProperty.macromolecular.residueKey,(d,s)=>r.iZ.residueIndex(s&&s[0]&&s[0](d)||d.element)),_(o.AN.structureQuery.atomProperty.macromolecular.chainKey,(d,s)=>r.iZ.chainIndex(s&&s[0]&&s[0](d)||d.element)),_(o.AN.structureQuery.atomProperty.macromolecular.entityKey,(d,s)=>r.iZ.entityIndex(s&&s[0]&&s[0](d)||d.element)),_(o.AN.structureQuery.atomProperty.macromolecular.id,I(r.StructureProperties.atom.id)),_(o.AN.structureQuery.atomProperty.macromolecular.isHet,(d,s)=>"ATOM"!==r.StructureProperties.residue.group_PDB(s&&s[0]&&s[0](d)||d.element)),_(o.AN.structureQuery.atomProperty.macromolecular.label_atom_id,I(r.StructureProperties.atom.label_atom_id)),_(o.AN.structureQuery.atomProperty.macromolecular.label_alt_id,I(r.StructureProperties.atom.label_alt_id)),_(o.AN.structureQuery.atomProperty.macromolecular.label_comp_id,I(r.StructureProperties.atom.label_comp_id)),_(o.AN.structureQuery.atomProperty.macromolecular.label_seq_id,I(r.StructureProperties.residue.label_seq_id)),_(o.AN.structureQuery.atomProperty.macromolecular.label_asym_id,I(r.StructureProperties.chain.label_asym_id)),_(o.AN.structureQuery.atomProperty.macromolecular.label_entity_id,I(r.StructureProperties.entity.id)),_(o.AN.structureQuery.atomProperty.macromolecular.auth_atom_id,I(r.StructureProperties.atom.auth_atom_id)),_(o.AN.structureQuery.atomProperty.macromolecular.auth_comp_id,I(r.StructureProperties.atom.auth_comp_id)),_(o.AN.structureQuery.atomProperty.macromolecular.auth_seq_id,I(r.StructureProperties.residue.auth_seq_id)),_(o.AN.structureQuery.atomProperty.macromolecular.auth_asym_id,I(r.StructureProperties.chain.auth_asym_id)),_(o.AN.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,I(r.StructureProperties.residue.pdbx_PDB_ins_code)),_(o.AN.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,I(r.StructureProperties.atom.pdbx_formal_charge)),_(o.AN.structureQuery.atomProperty.macromolecular.occupancy,I(r.StructureProperties.atom.occupancy)),_(o.AN.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,I(r.StructureProperties.atom.B_iso_or_equiv)),_(o.AN.structureQuery.atomProperty.macromolecular.entityType,I(r.StructureProperties.entity.type)),_(o.AN.structureQuery.atomProperty.macromolecular.entitySubtype,I(r.StructureProperties.entity.subtype)),_(o.AN.structureQuery.atomProperty.macromolecular.entityPrdId,I(r.StructureProperties.entity.prd_id)),_(o.AN.structureQuery.atomProperty.macromolecular.entityDescription,I(r.StructureProperties.entity.pdbx_description)),_(o.AN.structureQuery.atomProperty.macromolecular.objectPrimitive,I(r.StructureProperties.unit.object_primitive)),_(o.AN.structureQuery.atomProperty.macromolecular.isNonStandard,I(r.StructureProperties.residue.isNonStandard)),_(o.AN.structureQuery.atomProperty.macromolecular.secondaryStructureKey,I(r.StructureProperties.residue.secondary_structure_key)),_(o.AN.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,I(r.StructureProperties.residue.secondary_structure_type)),_(o.AN.structureQuery.atomProperty.macromolecular.chemCompType,I(r.StructureProperties.residue.chem_comp_type)),_(o.AN.structureQuery.atomSet.atomCount,function(s,C){return r.RT.atomset.atomCount(s)}),_(o.AN.structureQuery.atomSet.countQuery,function(s,C){return r.RT.atomset.countQuery(C[0])(s)}),_(o.AN.structureQuery.atomSet.propertySet,function(s,C){return r.RT.atomset.propertySet(C[0])(s)}),_(o.AN.structureQuery.bondProperty.order,(d,s)=>d.atomicBond.order),_(o.AN.structureQuery.bondProperty.flags,(d,s)=>d.atomicBond.type),_(o.AN.structureQuery.bondProperty.key,(d,s)=>d.atomicBond.key),_(o.AN.structureQuery.bondProperty.atomA,(d,s)=>d.atomicBond.a),_(o.AN.structureQuery.bondProperty.atomB,(d,s)=>d.atomicBond.b),_(o.AN.structureQuery.bondProperty.length,(d,s)=>d.atomicBond.length),_(o.AN.internal.generator.bundleElement,function(s,C){return(0,v.bundleElementImpl)(C.groupedUnits(s),C.ranges(s),C.set(s))}),_(o.AN.internal.generator.bundle,function(s,C){return(0,v.bundleGenerator)(C.elements(s))(s)}),_(o.AN.internal.generator.current,function(s,C){return s.tryGetCurrentSelection()})];function I(d){return(s,C)=>d(C&&C[0]&&C[0](s)||s.element)}function l(d,s){return d|(t.I$.isName(s)?t.I$.fromName(s):0)}function m(d,s){switch(s.toLowerCase()){case"helix":return 2|d;case"alpha":return 4098|d;case"pi":return 32770|d;case"310":return 2050|d;case"beta":return 4|d;case"strand":return 4194308|d;case"sheet":return 8388612|d;case"turn":return 16|d;case"bend":return 8|d;case"coil":return 536870912|d;default:return d}}!function(){for(const d of M)e.oY.addSymbol(d)}()},9498:(tn,Ue,n)=>{"use strict";n.d(Ue,{e:()=>Wo});var e=n(9677),o=n(9920),r=n(3170),t=n(643),A=n(6430),y=n(6452),c=n(9767);function i(We){return Object.keys(We).filter(Pt=>!isNaN(Pt)).map(Pt=>+Pt).sort((Pt,Sn)=>Pt-Sn).map(Pt=>We[Pt])}function v(We,Pt,Sn){return We&&void 0!==We[Pt]?We[Pt]:Sn}function _(We,...Pt){return{kind:"alias",aliases:Pt,symbol:We}}function M(We,Pt,...Sn){return We.info.namespace="molscript-macro",We.id=`molscript-macro.${We.info.name}`,{kind:"macro",symbol:We,translate:Pt,aliases:[We.info.name,...Sn]}}function I(We){return"alias"===We.kind||"macro"===We.kind}const l=[["Core symbols",_(t.AN.core.type.bool,"bool"),_(t.AN.core.type.num,"num"),_(t.AN.core.type.str,"str"),_(t.AN.core.type.regex,"regex"),_(t.AN.core.type.list,"list"),_(t.AN.core.type.set,"set"),_(t.AN.core.type.compositeKey,"composite-key"),_(t.AN.core.logic.not,"not"),_(t.AN.core.logic.and,"and"),_(t.AN.core.logic.or,"or"),_(t.AN.core.ctrl.if,"if"),_(t.AN.core.ctrl.fn,"fn"),_(t.AN.core.ctrl.eval,"eval"),_(t.AN.core.math.add,"add","+"),_(t.AN.core.math.sub,"sub","-"),_(t.AN.core.math.mult,"mult","*"),_(t.AN.core.math.div,"div","/"),_(t.AN.core.math.pow,"pow","**"),_(t.AN.core.math.mod,"mod"),_(t.AN.core.math.min,"min"),_(t.AN.core.math.max,"max"),_(t.AN.core.math.cantorPairing,"cantor-pairing"),_(t.AN.core.math.sortedCantorPairing,"sorted-cantor-pairing"),_(t.AN.core.math.invertCantorPairing,"invert-cantor-pairing"),_(t.AN.core.math.floor,"floor"),_(t.AN.core.math.ceil,"ceil"),_(t.AN.core.math.roundInt,"round"),_(t.AN.core.math.trunc,"trunc"),_(t.AN.core.math.abs,"abs"),_(t.AN.core.math.sign,"sign"),_(t.AN.core.math.sqrt,"sqrt"),_(t.AN.core.math.cbrt,"cbrt"),_(t.AN.core.math.sin,"sin"),_(t.AN.core.math.cos,"cos"),_(t.AN.core.math.tan,"tan"),_(t.AN.core.math.asin,"asin"),_(t.AN.core.math.acos,"acos"),_(t.AN.core.math.atan,"atan"),_(t.AN.core.math.sinh,"sinh"),_(t.AN.core.math.cosh,"cosh"),_(t.AN.core.math.tanh,"tanh"),_(t.AN.core.math.exp,"exp"),_(t.AN.core.math.log,"log"),_(t.AN.core.math.log10,"log10"),_(t.AN.core.math.atan2,"atan2"),_(t.AN.core.rel.eq,"eq","="),_(t.AN.core.rel.neq,"neq","!="),_(t.AN.core.rel.lt,"lt","<"),_(t.AN.core.rel.lte,"lte","<="),_(t.AN.core.rel.gr,"gr",">"),_(t.AN.core.rel.gre,"gre",">="),_(t.AN.core.rel.inRange,"in-range"),_(t.AN.core.str.concat,"concat"),_(t.AN.core.str.match,"regex.match"),_(t.AN.core.list.getAt,"list.get"),_(t.AN.core.set.has,"set.has"),_(t.AN.core.set.isSubset,"set.subset")],["Structure",["Types",_(t.AN.structureQuery.type.entityType,"ent-type"),_(t.AN.structureQuery.type.authResidueId,"auth-resid"),_(t.AN.structureQuery.type.labelResidueId,"label-resid"),_(t.AN.structureQuery.type.ringFingerprint,"ringfp"),_(t.AN.structureQuery.type.bondFlags,"bond-flags")],["Slots",_(t.AN.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",_(t.AN.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),_(t.AN.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),_(t.AN.structureQuery.generator.rings,"sel.atom.rings"),_(t.AN.structureQuery.generator.empty,"sel.atom.empty"),_(t.AN.structureQuery.generator.all,"sel.atom.all"),_(t.AN.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),M((0,r.EX)("sel.atom.atoms",r.d3.Dictionary({0:(0,r.ef)(A.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),y.O.ElementSelection,"A selection of singleton atom sets."),We=>c.J.struct.generator.atomGroups({"atom-test":v(We,0,!0)})),M((0,r.EX)("sel.atom.res",r.d3.Dictionary({0:(0,r.ef)(A.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),y.O.ElementSelection,"A selection of atom sets grouped by residue."),We=>c.J.struct.generator.atomGroups({"residue-test":v(We,0,!0),"group-by":c.J.ammp("residueKey")})),M((0,r.EX)("sel.atom.chains",r.d3.Dictionary({0:(0,r.ef)(A.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),y.O.ElementSelection,"A selection of atom sets grouped by chain."),We=>c.J.struct.generator.atomGroups({"chain-test":v(We,0,!0),"group-by":c.J.ammp("chainKey")}))],["Modifiers",_(t.AN.structureQuery.modifier.queryEach,"sel.atom.query-each"),_(t.AN.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),_(t.AN.structureQuery.modifier.exceptBy,"sel.atom.except-by"),_(t.AN.structureQuery.modifier.unionBy,"sel.atom.union-by"),_(t.AN.structureQuery.modifier.union,"sel.atom.union"),_(t.AN.structureQuery.modifier.cluster,"sel.atom.cluster"),_(t.AN.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),_(t.AN.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),_(t.AN.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),_(t.AN.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",_(t.AN.structureQuery.filter.pick,"sel.atom.pick"),_(t.AN.structureQuery.filter.first,"sel.atom.first"),_(t.AN.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),_(t.AN.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),_(t.AN.structureQuery.filter.within,"sel.atom.within"),_(t.AN.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",_(t.AN.structureQuery.combinator.intersect,"sel.atom.intersect"),_(t.AN.structureQuery.combinator.merge,"sel.atom.merge"),_(t.AN.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",_(t.AN.structureQuery.atomSet.atomCount,"atom.set.atom-count"),_(t.AN.structureQuery.atomSet.countQuery,"atom.set.count-query"),_(t.AN.structureQuery.atomSet.reduce,"atom.set.reduce"),_(t.AN.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",_(t.AN.structureQuery.atomProperty.core.elementSymbol,"atom.el"),_(t.AN.structureQuery.atomProperty.core.vdw,"atom.vdw"),_(t.AN.structureQuery.atomProperty.core.mass,"atom.mass"),_(t.AN.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),_(t.AN.structureQuery.atomProperty.core.x,"atom.x"),_(t.AN.structureQuery.atomProperty.core.y,"atom.y"),_(t.AN.structureQuery.atomProperty.core.z,"atom.z"),_(t.AN.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),_(t.AN.structureQuery.atomProperty.core.operatorName,"atom.op-name"),_(t.AN.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),_(t.AN.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),_(t.AN.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),_(t.AN.structureQuery.atomProperty.core.atomKey,"atom.key"),_(t.AN.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),_(t.AN.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),_(t.AN.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),_(t.AN.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),_(t.AN.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),_(t.AN.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),_(t.AN.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),_(t.AN.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),_(t.AN.structureQuery.atomProperty.macromolecular.id,"atom.id"),_(t.AN.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),_(t.AN.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),_(t.AN.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),_(t.AN.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),_(t.AN.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),_(t.AN.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),_(t.AN.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),_(t.AN.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),_(t.AN.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),_(t.AN.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),_(t.AN.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),_(t.AN.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),_(t.AN.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),_(t.AN.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),_(t.AN.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),_(t.AN.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),_(t.AN.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),_(t.AN.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),_(t.AN.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),_(t.AN.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),_(t.AN.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),_(t.AN.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),_(t.AN.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",_(t.AN.structureQuery.bondProperty.order,"bond.order"),_(t.AN.structureQuery.bondProperty.length,"bond.length"),_(t.AN.structureQuery.bondProperty.key,"bond.key"),_(t.AN.structureQuery.bondProperty.atomA,"bond.atom-a"),_(t.AN.structureQuery.bondProperty.atomB,"bond.atom-b"),M((0,r.EX)("bond.is",r.d3.List(y.O.BondFlag),A.Z.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${A.Z.oneOfValues(y.O.BondFlag).join(", ")}`),We=>c.J.core.flags.hasAny([c.J.struct.bondProperty.flags(),c.J.struct.type.bondFlags(i(We))]))]]],m=[];!function u(We){for(const Pt of We)I(Pt)?m.push(Pt):Pt instanceof Array&&u(Pt)}(l);const a=function(){const We=[],Pt=Object.create(null),Sn=e.th.create(),Nn=e.th.create();for(const Kn of m){for(const xr of Kn.aliases){if(We.push([xr,Kn]),Pt[xr])throw new Error(`Alias '${xr}' already in use.`);Pt[xr]=Kn}const dr=Kn.symbol.args;if("dictionary"===dr.kind)for(const xr of Object.keys(dr.map)){isNaN(xr)&&e.th.add(Sn,xr,xr);const Ft=dr.map[xr];"oneof"===Ft.type.kind&&A.Z.oneOfValues(Ft.type).forEach(Qt=>e.th.add(Nn,Qt,Qt))}else"oneof"===dr.type.kind&&A.Z.oneOfValues(dr.type).forEach(xr=>e.th.add(Nn,xr,xr))}return{symbolList:We,symbolMap:Pt,namedArgs:Sn.array,constants:Nn.array}}().symbolMap;function D(We){if(o.r.isLiteral(We))return We;if(o.r.isSymbol(We)){if(!a[We.name])return We;const xr=a[We.name];if("alias"===xr.kind)return o.r.Symbol(a[We.name].symbol.id);throw xr.translate([])}const Pt=o.r.isSymbol(We.head)&&!!a[We.head.name]&&"macro"===a[We.head.name].kind,Sn=Pt?We.head:D(We.head),Nn=Sn!==We.head;if(!We.args)return Pt?D(We.head):Nn?o.r.Apply(Sn):We;let dr,Kn=!1;if(o.r.isArgumentsArray(We.args)){dr=[];for(let xr=0,Ft=We.args.length;xr<Ft;xr++){const Qt=We.args[xr],ht=D(Qt);Qt!==ht&&(Kn=!0),dr[dr.length]=ht}if(Kn||(dr=We.args),!Pt&&!Nn&&!Kn)return We}else{dr={};for(const xr of Object.keys(We.args)){const Ft=We.args[xr],Qt=D(Ft);Ft!==Qt&&(Kn=!0),dr[xr]=Qt}if(!Pt&&!Nn&&!Kn)return We;Kn||(dr=We.args)}if(Pt){const xr=a[We.head.name];return"macro"!==xr.kind?o.r.Apply(Sn,dr):xr.translate(dr)}return o.r.Apply(Sn,dr)}function R(We){return D(We)}class f{constructor(Pt){this._=Pt}parse(Pt){const Sn=this.skip(f.eof)._(Pt,0);return Sn.status?{success:!0,value:Sn.value}:{success:!1,index:w(Pt,Sn.furthest),expected:Sn.expected}}tryParse(Pt){const Sn=this.parse(Pt);if(Sn.success)return Sn.value;{const Nn=function V(We,Pt){return`expected ${function Q(We){return 1===We.length?We[0]:"one of "+We.join(", ")}(Pt.expected)}${function G(We,Pt){const Sn=Pt.index,Nn=Sn.offset;if(Nn===We.length)return", got the end of the input";const dr=We.length-Nn>12?"...'":"'";return` at line ${Sn.line} column ${Sn.column}, got ${Nn>0?"'...":"'"}${We.slice(Nn,Nn+12)}${dr}`}(We,Pt)}`}(Pt,Sn);throw new Error(Nn)}}or(Pt){return f.alt(this,Pt)}trim(Pt){return this.wrap(Pt,Pt)}wrap(Pt,Sn){return p(1,"string"==typeof Pt?f.string(Pt):Pt,this,"string"==typeof Sn?f.string(Sn):Sn)}thru(Pt){return Pt(this)}then(Pt){return p(1,this,Pt)}many(){return new f((Pt,Sn)=>{const Nn=[];let Kn;for(;;){if(Kn=L(this._(Pt,Sn),Kn),!Kn.status)return L(E(Sn,Nn),Kn);if(Sn===Kn.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");Sn=Kn.index,Nn.push(Kn.value)}})}times(Pt,Sn){const Nn=typeof Sn>"u"?Pt:Sn;return new f((Kn,dr)=>{const xr=[];let Ft,Qt,ht;for(ht=0;ht<Pt;ht++){if(Ft=this._(Kn,dr),Qt=L(Ft,Qt),!Ft.status)return Qt;dr=Ft.index,xr.push(Ft.value)}for(;ht<Nn&&(Ft=this._(Kn,dr),Qt=L(Ft,Qt),Ft.status);ht+=1)dr=Ft.index,xr.push(Ft.value);return L(E(dr,xr),Qt)})}result(Pt){return this.map(()=>Pt)}atMost(Pt){return this.times(0,Pt)}atLeast(Pt){return f.seq(this.times(Pt),this.many()).map(Sn=>[...Sn[0],...Sn[1]])}map(Pt){return new f((Sn,Nn)=>{const Kn=this._(Sn,Nn);return Kn.status?L(E(Kn.index,Pt(Kn.value)),Kn):Kn})}skip(Pt){return p(0,this,Pt)}mark(){return f.seq(f.index,this,f.index).map(Pt=>({start:Pt[0],value:Pt[1],end:Pt[2]}))}node(Pt){return f.seq(f.index,this,f.index).map(Sn=>({name:Pt,start:Sn[0],value:Sn[1],end:Sn[2]}))}sepBy(Pt){return f.sepBy(this,Pt)}sepBy1(Pt){return f.sepBy1(this,Pt)}lookahead(Pt){return this.skip(f.lookahead(Pt))}notFollowedBy(Pt){return this.skip(f.notFollowedBy(Pt))}desc(Pt){return new f((Sn,Nn)=>{const Kn=this._(Sn,Nn);return Kn.status||(Kn.expected=[Pt]),Kn})}fallback(Pt){return this.or(f.succeed(Pt))}ap(Pt){return f.seq(Pt,this).map(([Sn,Nn])=>Sn(Nn))}chain(Pt){return new f((Sn,Nn)=>{const Kn=this._(Sn,Nn);return Kn.status?L(Pt(Kn.value)._(Sn,Kn.index),Kn):Kn})}}function p(We,...Pt){const Sn=Pt.length;return new f((Nn,Kn)=>{let dr,xr,Ft=Kn;for(let Qt=0;Qt<Sn;Qt++){if(dr=L(Pt[Qt]._(Nn,Ft),dr),!dr.status)return dr;We===Qt&&(xr=dr.value),Ft=dr.index}return L(E(Ft,xr),dr)})}function E(We,Pt){return{status:!0,index:We,value:Pt}}function T(We,Pt){return{status:!1,furthest:We,expected:[Pt]}}function L(We,Pt){if(!Pt||We.status||Pt.status||We.furthest>Pt.furthest)return We;const Sn=We.furthest===Pt.furthest?function U(We,Pt){const Sn=We.length,Nn=Pt.length;if(0===Sn)return Pt;if(0===Nn)return We;const Kn=new Set,dr=[];for(let xr=0;xr<Sn;xr++)Kn.has(We[xr])||(dr[dr.length]=We[xr],Kn.add(We[xr]));for(let xr=0;xr<Nn;xr++)Kn.has(Pt[xr])||(dr[dr.length]=Pt[xr],Kn.add(Pt[xr]));return dr.sort(),dr}(We.expected,Pt.expected):Pt.expected;return{status:We.status,furthest:Pt.furthest,expected:Sn}}function w(We,Pt){const Sn=We.slice(0,Pt).split("\n");return{offset:Pt,line:Sn.length,column:Sn[Sn.length-1].length+1}}!function(We){function Nn(...zt){const an=zt.length;return new We((Vn,Fn)=>{let rr;const Vr=new Array(an);let tr=Fn;for(let Tr=0;Tr<an;Tr++){if(rr=L(zt[Tr]._(Vn,tr),rr),!rr.status)return rr;Vr[Tr]=rr.value,tr=rr.index}return L(E(tr,Vr),rr)})}function Kn(...zt){return 0===zt.length?fn("zero alternates"):new We((Vn,Fn)=>{let rr;for(let Vr=0;Vr<zt.length;Vr++)if(rr=L(zt[Vr]._(Vn,Fn),rr),rr.status)return rr;return rr})}function xr(zt,an){return Nn(zt,an.then(zt).many()).map(Fn=>[Fn[0],...Fn[1]])}function Ft(zt){const an=`'${zt}'`;if(1===zt.length){const Vn=zt.charCodeAt(0);return new We((Fn,rr)=>Fn.charCodeAt(rr)===Vn?E(rr+1,zt):T(rr,an))}return new We((Vn,Fn)=>{const rr=Fn+zt.length;return Vn.slice(Fn,rr)===zt?E(rr,zt):T(Fn,an)})}function pt(zt,an=0){const Vn=function ht(zt){return RegExp("^(?:"+zt.source+")",function Qt(zt){const an=""+zt;return an.slice(an.lastIndexOf("/")+1)}(zt))}(zt),Fn=""+zt;return new We((rr,Vr)=>{const tr=Vn.exec(rr.slice(Vr));return tr?0<=an&&an<=tr.length?E(Vr+tr[0].length,tr[an]):T(Vr,`invalid match group (0 to ${tr.length}) in ${Fn}`):T(Vr,Fn)})}function Xt(zt){return new We((an,Vn)=>E(Vn,zt))}function fn(zt){return new We((an,Vn)=>T(Vn,zt))}function Tt(zt){return new We((an,Vn)=>{const Fn=an.charAt(Vn);return Vn<an.length&&zt(Fn)?E(Vn+1,Fn):T(Vn,"a character "+zt)})}function rt(zt){const an=new We((Vn,Fn)=>{const rr=zt()._;return an._=rr,rr(Vn,Fn)});return an}We.seqMap=function Pt(zt,an,Vn){const Fn=[].slice.call(arguments);if(0===Fn.length)throw new Error("seqMap needs at least one argument");const rr=Fn.pop();return function k(We){if("function"!=typeof We)throw new Error("not a function: "+We)}(rr),Nn.apply(null,Fn).map(function(Vr){return rr.apply(null,Vr)})},We.createLanguage=function Sn(zt){const an={};for(const Vn of Object.keys(zt))!function(Fn){an[Fn]=rt(()=>zt[Fn](an))}(Vn);return an},We.seq=Nn,We.alt=Kn,We.sepBy=function dr(zt,an){return xr(zt,an).or(Xt([]))},We.sepBy1=xr,We.string=Ft,We.regexp=pt,We.succeed=Xt,We.fail=fn,We.lookahead=function on(zt){if(function N(We){return We instanceof f}(zt))return new We((an,Vn)=>{const Fn=zt._(an,Vn);return Fn.status&&(Fn.index=Vn,Fn.value=null),Fn});if("string"==typeof zt)return on(Ft(zt));if(zt instanceof RegExp)return on(pt(zt));throw new Error("not a string, regexp, or parser: "+zt)},We.notFollowedBy=function En(zt){return new We((an,Vn)=>{const Fn=zt._(an,Vn);return Fn.status?T(Vn,'not "'+an.slice(Vn,Fn.index)+'"'):E(Vn,null)})},We.test=Tt,We.oneOf=function Fe(zt){return Tt(an=>zt.indexOf(an)>=0)},We.noneOf=function He(zt){return Tt(an=>zt.indexOf(an)<0)},We.range=function Ye(zt,an){return Tt(Vn=>zt<=Vn&&Vn<=an).desc(zt+"-"+an)},We.takeWhile=function ot(zt){return new We((an,Vn)=>{let Fn=Vn;for(;Fn<an.length&&zt(an.charAt(Fn));)Fn++;return E(Fn,an.slice(Vn,Fn))})},We.lazy=rt,We.empty=function St(){return fn("empty")},We.index=new We(function(zt,an){return E(an,w(zt,an))}),We.anyChar=new We((zt,an)=>an>=zt.length?T(an,"any character"):E(an+1,zt.charAt(an))),We.all=new We(function(zt,an){return E(zt.length,zt.slice(an))}),We.eof=new We(function(zt,an){return an<zt.length?T(an,"EOF"):E(an,null)}),We.digit=pt(/[0-9]/).desc("a digit"),We.digits=pt(/[0-9]*/).desc("optional digits"),We.letter=pt(/[a-z]/i).desc("a letter"),We.letters=pt(/[a-z]*/i).desc("optional letters"),We.optWhitespace=pt(/\s*/).desc("optional whitespace"),We.whitespace=pt(/\s+/).desc("whitespace"),We.cr=Ft("\r"),We.lf=Ft("\n"),We.crlf=Ft("\r\n"),We.newline=Kn(We.crlf,We.lf,We.cr).desc("newline"),We.end=Kn(We.newline,We.eof),We.of=function vt(zt){return Xt(zt)},We.regex=function mn(zt){return pt(zt)}}(f||(f={}));var J,H=n(1372);!function(We){let Pt;var rt;(rt=Pt||(Pt={})).str=function St(an){return{kind:"string",value:an}},rt.symb=function vt(an){return{kind:"symbol",value:an}},rt.list=function mn(an,Vn){return{kind:"list",bracket:an,nodes:Vn}},rt.comment=function zt(an){return{kind:"comment",value:an}};const Sn=f.regexp(/[\n\r\s]*/),Nn=f.lazy(()=>f.alt(Kn,Xt,dr,xr).trim(Sn)),Kn=f.takeWhile(rt=>"`"!==rt).trim("`").map(Pt.str),dr=f.regexp(/[^()\[\]{};`,\n\r\s]+/).map(Pt.symb),xr=f.regexp(/\s*;+([^\n\r]*)\n/,1).map(Pt.comment),Ft=Nn.many(),Qt=Ft.wrap("(",")").map(rt=>Pt.list("(",rt)),ht=Ft.wrap("[","]").map(rt=>Pt.list("[",rt)),pt=Ft.wrap("{","}").map(rt=>Pt.list("{",rt)),Xt=f.alt(Qt,ht,pt),fn=Nn.many();function En(rt){switch(rt.kind){case"string":return rt.value;case"symbol":{const St=rt.value;if(St.length>1)switch(St.charAt(0)){case".":return c.J.atomName(St.substr(1));case"_":return c.J.struct.type.elementSymbol([St.substr(1)])}return"true"===St||"false"!==St&&(function Ye(rt){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(rt)&&!isNaN(+rt)}(St)?+St:o.r.Symbol(St))}case"list":switch(rt.bracket){case"[":return c.J.core.type.list(He(rt.nodes).map(En));case"{":return c.J.core.type.set(He(rt.nodes).map(En));case"(":{if("comment"===rt.nodes[0].kind)throw new Error("Invalid expression");const St=En(rt.nodes[0]);return o.r.Apply(St,function Tt(rt){if(rt.length<=1)return;if(!function Fe(rt){for(let St=1,vt=rt.length;St<vt;St++){const mn=rt[St];if("symbol"===mn.kind&&mn.value.length>1&&":"===mn.value.charAt(0))return!0}return!1}(rt)){const zt=[];for(let an=1,Vn=rt.length;an<Vn;an++){const Fn=rt[an];"comment"!==Fn.kind&&(zt[zt.length]=En(Fn))}return zt}const St={};let vt=!0,mn=0;for(let zt=1,an=rt.length;zt<an;zt++){const Vn=rt[zt];if("comment"!==Vn.kind)if("symbol"===Vn.kind&&Vn.value.length>1&&":"===Vn.value.charAt(0)){const Fn=Vn.value.substr(1);for(++zt;zt<an&&"comment"===rt[zt].kind;)zt++;if(zt>=an)throw new Error(`There must be a value foolowed a named arg ':${Fn}'.`);if("comment"===rt[zt].kind)throw new Error("Invalid expression");St[Fn]=En(rt[zt]),isNaN(+Fn)&&(vt=!1)}else St[mn++]=En(Vn)}if(vt){const zt=Object.keys(St).map(Vn=>+Vn).sort((Vn,Fn)=>Vn-Fn);let an=!0;for(let Vn=0,Fn=zt.length;Vn<Fn;Vn++)if(zt[Vn]!==Vn){an=!1;break}if(an){const Vn=[];for(let Fn=0,rr=zt.length;Fn<rr;Fn++)Vn[Fn]=St[Fn];return Vn}}return St}(rt.nodes))}default:(0,H.dr)(rt.bracket)}default:(0,H.dr)(rt)}}function He(rt){let St=!1;for(let vt=0,mn=rt.length;vt<mn;vt++)if("comment"===rt[vt].kind){St=!0;break}return St?rt.filter(vt=>"comment"!==vt.kind):rt}We.parse=function ot(rt){const St=function on(rt){return fn.tryParse(rt)}(rt),vt=[];for(const mn of St)"comment"!==mn.kind&&(vt[vt.length]=En(mn));return vt}}(J||(J={}));var W=n(7785);const te=c.J;function de(We,Pt,Sn){const Nn=f.lazy(()=>f.seq(We,Nn).map(Kn=>Sn(...Kn)).or(Pt));return Nn}function ye(We,Pt,Sn){return f.seqMap(Pt,We.many(),(Nn,Kn)=>Kn.reduce((dr,xr)=>Sn(xr,dr),Nn))}function Z(We,Pt,Sn){return f.seqMap(Pt,f.seq(We,Pt).many(),(Nn,Kn)=>Kn.reduce((dr,xr)=>{const[Ft,Qt]=xr;return Sn(Ft,dr,Qt)},Nn))}function q(We,Pt){return We.reduce((Nn,Kn)=>{const dr=Kn.isUnsupported?xe(`operator '${Kn.name}' not supported`):Kn.map;return Kn.type(Kn.rule,Nn,dr)},Pt)}function Y(We,Pt=0){return f.optWhitespace.then(f.regexp(We,Pt).skip(f.optWhitespace))}function ee(We,Pt=0){return f.regexp(We,Pt).skip(f.optWhitespace)}function g(We,Pt=0){return f.optWhitespace.then(f.regexp(We,Pt))}function _e(We,Pt){const Sn=Pt?`${We}|${(0,W.Nt)(Pt)}`:We;return Y(RegExp(`(${Sn})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,"i"),2).map(parseFloat)}function xe(We){return function(){throw new Error(We)}}function le(We){return 1===We.length?We[0]:We.length>1?te.core.logic.and(We):void 0}function Be(We,Pt){if(!Pt||void 0===Pt.op||void 0===Pt.val)return Pt&&void 0!==Pt.flags?te.core.flags.hasAny([We,Pt.flags]):Pt&&void 0!==Pt.min&&void 0!==Pt.max?te.core.rel.inRange([We,Pt.min,Pt.max]):Array.isArray(Pt)?Pt.length>1?te.core.set.has([te.core.type.set(Pt),We]):te.core.rel.eq([We,Pt[0]]):te.core.rel.eq([We,Pt]);{const Sn=[We,Pt.val];switch(Pt.op){case"=":return te.core.rel.eq(Sn);case"!=":return te.core.rel.neq(Sn);case">":return te.core.rel.gr(Sn);case"<":return te.core.rel.lt(Sn);case">=":return te.core.rel.gre(Sn);case"<=":return te.core.rel.lte(Sn);default:throw new Error(`operator '${Pt.op}' not supported`)}}}function Ce(We){return te.struct.generator.queryInSelection({0:We,query:te.struct.generator.all(),"in-complement":!0})}function Re(We,Pt){return We.length<Pt.length?1:-1}function ke(We,Pt){const Sn=(Pt?[We].concat(Pt):[We]).sort(Re).map(W.Nt).join("|");return RegExp(`${Sn}`,"i")}function Oe(We){const Pt=[];return Object.keys(We).sort(Re).forEach(Sn=>{const Nn=We[Sn],Kn=xe(`property '${Sn}' not supported`),dr=f.regexp(Nn.regex).map(Qt=>(Nn.isUnsupported&&Kn(),Be(Nn.property,Nn.map(Qt)))),xr=f.regexp(ke(Sn,Nn.abbr)).trim(f.optWhitespace),Ft=Qt=>te.struct.generator.atomGroups({[Nn.level]:Qt});Pt.push(Nn.isNumeric?xr.then(f.seq(f.regexp(/>=|<=|=|!=|>|</).trim(f.optWhitespace),f.regexp(Nn.regex).map(Nn.map))).map(Qt=>(Nn.isUnsupported&&Kn(),Be(Nn.property,{op:Qt[0],val:Qt[1]}))).map(Ft):xr.then(dr).map(Ft))}),Pt}function Se(We){const Pt=[];return Object.keys(We).sort(Re).forEach(Sn=>{const Nn=We[Sn],Kn=Nn.map?Nn.map:xe(`keyword '${Sn}' not supported`),dr=f.regexp(ke(Sn,Nn.abbr)).map(Kn);Pt.push(dr)}),Pt}function Ne(We,Pt){const Sn=[];return Object.keys(We).sort(Re).forEach(Nn=>{const Kn=We[Nn],dr=xe(`property '${Nn}' not supported`),xr=f.regexp(ke(Nn,Kn.abbr)).lookahead(Pt).map(()=>(Kn.isUnsupported&&dr(),Kn.property));Sn.push(xr)}),Sn}function K(We,Pt,Sn,Nn){const Kn=[];for(const dr in We)Kn.push(dr),We[dr].abbr&&Kn.push(...We[dr].abbr);for(const dr in Pt)Kn.push(dr),Pt[dr].abbr&&Kn.push(...Pt[dr].abbr);return Sn.forEach(dr=>{Kn.push(dr.name),dr.abbr&&Kn.push(...dr.abbr)}),Kn}function ne(We){return te.core.type.set(We.map(te.atomName))}function be(We){return te.struct.generator.queryInSelection({0:We,query:te.struct.generator.all()})}function Te(We,Pt,Sn){switch(We.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return te.atomName(Pt);case"structure-query.atom-property.core.element-symbol":return te.es(Pt);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return Sn&&(Pt=[Sn[Pt.toUpperCase()]||"none"]),te.struct.type.secondaryStructureFlags([Pt]);default:return Pt}}const ue=["entityKey","label_entity_id","entityType"],re=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],ve=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"];function ce(We){if(We.head.name.startsWith("structure-query.atom-property.macromolecular.")){const Pt=We.head.name.substr(45);if(ue.includes(Pt))return"entity-test";if(re.includes(Pt))return"chain-test";if(ve.includes(Pt))return"residue-test"}return"atom-test"}const se=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function ge(We){return te.struct.generator.atomGroups({"residue-test":te.core.set.has([te.core.type.set(We),te.ammp("label_comp_id")])})}const Ie=c.J,Le=/[-+]?[0-9]*\.?[0-9]+/,nt=/[0-9]+/;function je(We){return We}const Lt={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function Je(We){if(We.head){if(We.head.name&&"core.type.regex"===We.head.name&&(We=We.args[0].replace(/^\^|\$$/g,"")),We=Lt[We.toString().toLowerCase()]||"none",-1!==["dna","rna","carbohydrate"].indexOf(We))throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return Ie.struct.type.secondaryStructureFlags([We])}}const en={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:je,level:"atom-test",property:Ie.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:je,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:nt,map:We=>parseInt(We),level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:nt,map:We=>parseInt(We),level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:We=>Ie.atomName(We),level:"atom-test",property:Ie.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:nt,map:We=>parseInt(We),level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:We=>Ie.atomName(We),level:"atom-test",property:Ie.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:nt,map:We=>parseInt(We),level:"atom-test",property:Ie.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:nt,map:We=>parseInt(We),level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:je,level:"chain-test",property:Ie.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:We=>Ie.es(We),level:"atom-test",property:Ie.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:We=>parseInt(We),level:"atom-test",property:Ie.acp("atomicNumber")},eta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},theta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:je,level:"residue-test",property:Ie.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:je,level:"residue-test",property:Ie.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:je,level:"atom-test",property:Ie.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:Le,map:We=>parseFloat(We),level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:We=>parseInt(We),level:"residue-test",property:Ie.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:je,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:je,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:Le,map:We=>parseFloat(We),level:"atom-test",property:Ie.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:je,level:"atom-test"}},Bt=c.J,pn=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:de,rule:f.alt(f.regex(/NOT/i).skip(f.whitespace),f.string("!").skip(f.optWhitespace)),map:(We,Pt)=>Ce(Pt)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:Z,rule:Y(/AND|&/i),map:(We,Pt,Sn)=>Bt.struct.modifier.intersectBy({0:Pt,by:Sn})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:Z,rule:Y(/OR|\||,/i),map:(We,Pt,Sn)=>Bt.struct.combinator.merge([Pt,Sn])}],$e=c.J,mt={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},_t_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],_t_protein=["C","N","CA"];function Me(){return $e.struct.combinator.merge([$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.set(...mt.nucleic),$e.ammp("label_comp_id")])}),$e.struct.filter.pick({0:$e.struct.generator.atomGroups({"group-by":$e.ammp("residueKey")}),test:$e.core.logic.and([$e.core.rel.eq([$e.struct.atomSet.atomCount(),1]),$e.core.rel.eq([$e.ammp("label_atom_id"),$e.atomName("P")])])}),$e.struct.filter.pick({0:$e.struct.generator.atomGroups({"group-by":$e.ammp("residueKey")}),test:$e.core.logic.or([$e.core.set.isSubset([ne(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),$e.ammpSet("label_atom_id")]),$e.core.set.isSubset([ne(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),$e.ammpSet("label_atom_id")])])})])}const Kt={all:{"@desc":"all atoms; same as *",abbr:["*"],map:()=>$e.struct.generator.all()},bonded:{"@desc":"covalently bonded",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.rel.gr([$e.struct.atomProperty.core.bondCount({flags:$e.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.rel.gr([$e.struct.atomProperty.core.bondCount({flags:$e.struct.type.bondFlags()}),0])})},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:()=>$e.struct.generator.empty()},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map($e.es)),$e.acp("elementSymbol")])})},metal:{"@desc":"!nonmetal",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.logic.not([$e.core.set.has([$e.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map($e.es)),$e.acp("elementSymbol")])])})},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.set(...["Li","Na","K","Rb","Cs","Fr"].map($e.es)),$e.acp("elementSymbol")])})},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.set(...["Be","Mg","Ca","Sr","Ba","Ra"].map($e.es)),$e.acp("elementSymbol")])})},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.set(...["He","Ne","Ar","Kr","Xe","Rn"].map($e.es)),$e.acp("elementSymbol")])})},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.set(...["B","Si","Ge","As","Sb","Te"].map($e.es)),$e.acp("elementSymbol")])})},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.logic.or([$e.core.rel.inRange([$e.acp("atomicNumber"),21,30]),$e.core.rel.inRange([$e.acp("atomicNumber"),39,48]),$e.core.rel.inRange([$e.acp("atomicNumber"),72,80]),$e.core.rel.inRange([$e.acp("atomicNumber"),104,112]),$e.core.set.has([$e.set(57,89),$e.acp("atomicNumber")])])})},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.rel.inRange([$e.acp("atomicNumber"),57,71])})},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.rel.inRange([$e.acp("atomicNumber"),89,103])})},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.rel.gr([$e.struct.atomProperty.core.bondCount({flags:$e.struct.type.bondFlags(["aromatic"])}),0])})},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":'any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, \', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.',map:()=>Me()},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:()=>$e.struct.modifier.intersectBy({0:Me(),by:$e.struct.combinator.merge([$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.set("A","G","I","DA","DG","DI","+A","+G","+I"),$e.ammp("label_comp_id")])}),$e.struct.filter.pick({0:$e.struct.generator.atomGroups({"group-by":$e.ammp("residueKey")}),test:$e.core.set.isSubset([ne(["N7","C8","N9"]),$e.ammpSet("label_atom_id")])})])})},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:()=>$e.struct.modifier.intersectBy({0:Me(),by:$e.struct.combinator.merge([$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.set("C","T","U","DC","DT","DU","+C","+T","+U"),$e.ammp("label_comp_id")])}),$e.struct.filter.pick({0:$e.struct.generator.atomGroups({"group-by":$e.ammp("residueKey")}),test:$e.core.logic.or([$e.core.set.has([$e.ammpSet("label_atom_id"),$e.atomName("O2*")]),$e.core.set.has([$e.ammpSet("label_atom_id"),$e.atomName("O2'")])])})])})},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:()=>$e.struct.modifier.intersectBy({0:Me(),by:$e.struct.combinator.merge([$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.set("DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"),$e.ammp("label_comp_id")])}),$e.struct.filter.pick({0:$e.struct.generator.atomGroups({"group-by":$e.ammp("residueKey")}),test:$e.core.logic.not([$e.core.logic.or([$e.core.set.has([$e.ammpSet("label_atom_id"),$e.atomName("O2*")]),$e.core.set.has([$e.ammpSet("label_atom_id"),$e.atomName("O2'")])])])})])})},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:()=>$e.struct.modifier.intersectBy({0:Me(),by:$e.struct.combinator.merge([$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.set("G","C","A","U","I","+U","+I"),$e.ammp("label_comp_id")])}),$e.struct.filter.pick({0:$e.struct.generator.atomGroups({"group-by":$e.ammp("residueKey")}),test:$e.core.logic.or([$e.core.set.has([$e.ammpSet("label_atom_id"),$e.atomName("O2*")]),$e.core.set.has([$e.ammpSet("label_atom_id"),$e.atomName("O2'")])])})])})},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:()=>function Ke(){return $e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.set(...mt.amino),$e.ammp("label_comp_id")])})}()},acidic:{"@desc":"ASP GLU",map:()=>ge(mt.acidic)},acyclic:{"@desc":"amino and not cyclic",map:()=>$e.struct.modifier.intersectBy({0:ge(mt.amino),by:Ce(ge(mt.cyclic))})},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:()=>ge(mt.aliphatic)},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:()=>ge(mt.amino)},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:()=>ge(mt.aromatic)},basic:{"@desc":"ARG HIS LYS",map:()=>ge(mt.basic)},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:()=>ge(mt.buried)},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:()=>ge(mt.acidic.concat(mt.basic))},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:()=>ge(mt.cyclic)},helix:{"@desc":"secondary structure-related.",map:()=>$e.struct.generator.atomGroups({"residue-test":$e.core.flags.hasAny([$e.struct.type.secondaryStructureFlags(["helix"]),$e.ammp("secondaryStructureFlags")])})},helixalpha:{"@desc":"secondary structure-related.",map:()=>$e.struct.generator.atomGroups({"residue-test":$e.core.flags.hasAny([$e.struct.type.secondaryStructureFlags(["alpha"]),$e.ammp("secondaryStructureFlags")])})},helix310:{"@desc":"secondary structure-related.",map:()=>$e.struct.generator.atomGroups({"residue-test":$e.core.flags.hasAny([$e.struct.type.secondaryStructureFlags(["3-10"]),$e.ammp("secondaryStructureFlags")])})},helixpi:{"@desc":"secondary structure-related.",map:()=>$e.struct.generator.atomGroups({"residue-test":$e.core.flags.hasAny([$e.struct.type.secondaryStructureFlags(["pi"]),$e.ammp("secondaryStructureFlags")])})},hetero:{"@desc":"PDB atoms designated as HETATM",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.ammp("isHet")})},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:()=>ge(mt.hydrophobic)},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:()=>ge(mt.large)},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:()=>ge(mt.medium)},negative:{"@desc":"same as acidic -- ASP GLU",map:()=>ge(mt.acidic)},neutral:{"@desc":"amino and not (acidic or basic)",map:()=>$e.struct.modifier.intersectBy({0:ge(mt.amino),by:Ce(ge(mt.acidic.concat(mt.basic)))})},polar:{"@desc":"amino and not hydrophobic",map:()=>$e.struct.modifier.intersectBy({0:ge(mt.amino),by:Ce(ge(mt.hydrophobic))})},positive:{"@desc":"same as basic -- ARG HIS LYS",map:()=>ge(mt.basic)},sheet:{"@desc":"secondary structure-related",map:()=>$e.struct.generator.atomGroups({"residue-test":$e.core.flags.hasAny([$e.struct.type.secondaryStructureFlags(["sheet"]),$e.ammp("secondaryStructureFlags")])})},small:{"@desc":"ALA GLY SER",map:()=>ge(mt.small)},surface:{"@desc":"amino and not buried",map:()=>$e.struct.modifier.intersectBy({0:ge(mt.amino),by:Ce(ge(mt.buried))})},turn:{"@desc":"secondary structure-related",map:()=>$e.struct.generator.atomGroups({"residue-test":$e.core.flags.hasAny([$e.struct.type.secondaryStructureFlags(["turn"]),$e.ammp("secondaryStructureFlags")])})},alpha:{"@desc":"(*.CA)",map:()=>$e.struct.generator.atomGroups({"atom-test":$e.core.rel.eq([$e.atomName("CA"),$e.ammp("label_atom_id")])})},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:()=>function ut(){return $e.struct.combinator.merge([$e.struct.modifier.intersectBy({0:$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.core.type.set(mt.amino),$e.ammp("label_comp_id")])}),by:$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.core.type.set(_t_protein),$e.ammp("label_atom_id")])})}),$e.struct.modifier.intersectBy({0:$e.struct.generator.atomGroups({"residue-test":$e.core.set.has([$e.core.type.set(mt.nucleic),$e.ammp("label_comp_id")])}),by:$e.struct.generator.atomGroups({"atom-test":$e.core.set.has([$e.core.type.set(_t_nucleic),$e.ammp("label_atom_id")])})})])}()},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}},sn=c.J,gt=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:Z,rule:f.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(We,Pt,Sn)=>{let Nn;if("structure"===Pt?Nn=sn.core.flags.hasAny([sn.ammp("secondaryStructureFlags"),Je(Sn)]):"structure"===Sn?Nn=sn.core.flags.hasAny([sn.ammp("secondaryStructureFlags"),Je(Pt)]):void 0!==Pt.head?"core.type.regex"===Pt.head.name&&(Nn=sn.core.str.match([Pt,sn.core.type.str([Sn])])):void 0!==Sn.head?"core.type.regex"===Sn.head.name&&(Nn=sn.core.str.match([Sn,sn.core.type.str([Pt])])):"LIKE"===We.toUpperCase()&&(Nn=sn.core.str.match(Pt.head?[sn.core.type.regex([`^${Sn}$`,"i"]),sn.core.type.str([Pt])]:[sn.core.type.regex([`^${Pt}$`,"i"]),sn.core.type.str([Sn])])),!Nn)switch(Pt.head&&(Sn=Te(Pt,Sn)),Sn.head&&(Pt=Te(Sn,Pt)),We){case"=":Nn=sn.core.rel.eq([Pt,Sn]);break;case"!=":Nn=sn.core.rel.neq([Pt,Sn]);break;case">":Nn=sn.core.rel.gr([Pt,Sn]);break;case"<":Nn=sn.core.rel.lt([Pt,Sn]);break;case">=":Nn=sn.core.rel.gre([Pt,Sn]);break;case"<=":Nn=sn.core.rel.lte([Pt,Sn]);break;default:throw new Error(`value operator '${We}' not supported`)}return sn.struct.generator.atomGroups({"atom-test":Nn})}}];function yt(We){const[Pt,Sn,Nn,Kn,dr,xr,Ft]=We[1],Qt={};dr&&(Qt["chain-test"]=sn.core.rel.eq([sn.ammp("auth_asym_id"),dr]));const ht=[];Pt&&ht.push(sn.core.rel.eq([sn.ammp("label_comp_id"),Pt])),Sn&&ht.push(sn.core.logic.and([sn.core.rel.gre([sn.ammp("auth_seq_id"),Sn[0]]),sn.core.rel.lte([sn.ammp("auth_seq_id"),Sn[1]])])),Nn&&ht.push(sn.core.rel.eq([sn.ammp("auth_seq_id"),Nn])),Kn&&ht.push(sn.core.rel.eq([sn.ammp("pdbx_PDB_ins_code"),Kn])),ht.length&&(Qt["residue-test"]=le(ht));const pt=[];return xr&&pt.push(sn.core.rel.eq([sn.ammp("auth_atom_id"),xr])),Ft&&pt.push(sn.core.rel.eq([sn.ammp("label_alt_id"),Ft])),pt.length&&(Qt["atom-test"]=le(pt)),sn.struct.generator.atomGroups(Qt)}const At=f.createLanguage({Integer:()=>f.regexp(/-?[0-9]+/).map(Number).desc("integer"),Parens:function(We){return f.alt(We.Parens,We.Operator,We.Expression).wrap(f.regexp(/\(\s*/),f.regexp(/\s*\)/))},Expression:function(We){return f.alt(We.Keywords,We.AtomExpression.map(yt),We.Within.map(Pt=>sn.struct.modifier.includeSurroundings({0:Pt[1],radius:Pt[0]})),We.ValueQuery,We.Element.map(Pt=>sn.struct.generator.atomGroups({"atom-test":sn.core.rel.eq([sn.acp("elementSymbol"),sn.struct.type.elementSymbol(Pt)])})),We.Resname.map(Pt=>sn.struct.generator.atomGroups({"residue-test":sn.core.rel.eq([sn.ammp("label_comp_id"),Pt])})))},Operator:function(We){return q(pn,f.alt(We.Parens,We.Expression))},AtomExpression:function(We){return f.seq(f.lookahead(We.AtomPrefix),f.seq(We.BracketedResname.or(f.of(null)),We.ResnoRange.or(f.of(null)),We.Resno.or(f.of(null)),We.Inscode.or(f.of(null)),We.Chainname.or(f.of(null)),We.Atomname.or(f.of(null)),We.Altloc.or(f.of(null)),We.Model.or(f.of(null)))).desc("expression")},AtomPrefix:()=>f.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix"),Chainname:()=>f.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname"),Model:()=>f.regexp(/\/([0-9]+)/,1).map(Number).desc("model"),Element:()=>f.regexp(/_([A-Za-z]{1,3})/,1).desc("element"),Atomname:()=>f.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(sn.atomName).desc("atomname"),Resname:()=>f.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname"),Resno:We=>We.Integer.desc("resno"),Altloc:()=>f.regexp(/%([a-zA-Z0-9])/,1).desc("altloc"),Inscode:()=>f.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode"),BracketedResname:()=>f.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname"),ResnoRange:We=>f.seq(We.Integer.skip(f.seq(f.optWhitespace,f.string("-"),f.optWhitespace)),We.Integer).desc("resno-range"),Within:We=>f.regexp(/within/i).skip(f.regexp(/\s*\(\s*/)).then(f.seq(We.Integer.skip(f.regexp(/\s*,\s*/)),We.Query)).skip(f.regexp(/\)/)),Keywords:()=>f.alt(...Se(Kt)).desc("keyword"),Query:function(We){return f.alt(We.Operator,We.Parens,We.Expression).trim(f.optWhitespace)},Number:function(){return f.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){const We=K(en,Kt,pn).sort(Re).map(W.Nt).join("|");return f.alt(f.regexp(new RegExp(`(?!(${We}))[A-Z0-9_]+`,"i")),f.regexp(/'((?:[^"\\]|\\.)*)'/,1),f.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(Pt=>sn.core.type.regex([`^${Pt}$`,"i"]))).desc("string")},Value:function(We){return f.alt(We.Number,We.String)},ValueParens:function(We){return f.alt(We.ValueParens,We.ValueOperator,We.ValueExpressions).wrap(f.string("("),f.string(")"))},ValuePropertyNames:function(){return f.alt(...Ne(en,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(We){return q(gt,f.alt(We.ValueParens,We.ValueExpressions))},ValueExpressions:function(We){return f.alt(We.Value,We.ValuePropertyNames)},ValueQuery:function(We){return f.alt(We.ValueOperator.map(Pt=>{if(Pt.head){if(Pt.head.name.startsWith("structure-query.generator"))return Pt}else if("string"==typeof Pt&&Pt.length<=4)return sn.struct.generator.atomGroups({"residue-test":sn.core.rel.eq([sn.ammp("label_comp_id"),Pt])});throw new Error(`values must be part of an comparison, value '${Pt}'`)}))}}),rn=c.J,tt=/[-+]?[0-9]*\.?[0-9]+/;function nn(We){return We.split("+").map(Pt=>Pt.replace(/^["']|["']$/g,""))}function bn(We){if(We.includes("-")&&We.includes("+")){const Pt=We.split("+").map(Nn=>Nn.replace(/^["']|["']$/g,"")),Sn=[];return Pt.forEach(Nn=>{if(Nn.includes("-")&&!Nn.startsWith("-")){const[Kn,dr]=Nn.split("-").map(xr=>parseInt(xr));for(let xr=Kn;xr<=dr;xr++)Sn.push(xr)}else if(Nn.includes("-")&&Nn.startsWith("-")&&Nn.match(/[0-9]+-[-0-9]+/)){const Kn=-parseInt(Nn.split("-")[1]);let dr;dr=Nn.includes("--")?-parseInt(Nn.split("-")[3]):parseInt(Nn.split("-")[2]);for(let xr=Kn;xr<=dr;xr++)Sn.push(xr)}else Nn.includes("-")&&Nn.startsWith("-")&&Nn.match(/[0-9]+-[-0-9]+/),Sn.push(parseInt(Nn))}),Sn}if(We.includes("-")&&!We.includes("+")){const Pt=[];if(We.startsWith("-"))if(We.startsWith("-")&&We.match(/[0-9]+-[-0-9]+/)){const Sn=-parseInt(We.split("-")[1]);let Nn;Nn=We.includes("--")?-parseInt(We.split("-")[3]):parseInt(We.split("-")[2]);for(let Kn=Sn;Kn<=Nn;Kn++)Pt.push(Kn)}else We.startsWith("-")&&We.match(/[0-9]+-[-0-9]+/),Pt.push(parseInt(We));else{const[Sn,Nn]=We.split("-").map(Kn=>parseInt(Kn));for(let Kn=Sn;Kn<=Nn;Kn++)Pt.push(Kn)}return Pt}return!We.includes("-")&&We.includes("+")?nn(We).map(Pt=>parseInt(Pt)):[parseInt(We)]}const jt={H:"helix",S:"beta",L:"none"},Dt={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:function Dn(We){return We.split("+").map(rn.struct.type.elementSymbol)},level:"atom-test",property:rn.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:function Mt(We){return We.split("+").map(rn.atomName)},level:"atom-test",property:rn.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:nn,level:"residue-test",property:rn.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:bn,level:"residue-test",property:rn.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:nn,level:"atom-test",property:rn.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:nn,level:"chain-test",property:rn.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:nn,level:"chain-test",property:rn.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:We=>parseInt(We),level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:We=>parseInt(We),level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:nn,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:bn,level:"atom-test",property:rn.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:bn,level:"atom-test",property:rn.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:function It(We){return{flags:rn.struct.type.secondaryStructureFlags(We.toUpperCase().split("+").map(Pt=>jt[Pt]||"none"))}},level:"residue-test",property:rn.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:tt,map:We=>parseFloat(We),level:"atom-test",property:rn.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:tt,map:We=>parseFloat(We),level:"atom-test",property:rn.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:tt,map:We=>parseFloat(We),level:"atom-test",property:rn.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:tt,map:We=>parseFloat(We),level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:We=>rn.es(We),level:"atom-test",property:rn.acp("elementSymbol")}},Ct=c.J,$t=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:de,rule:f.alt(f.regexp(/NOT/i).skip(f.whitespace),f.string("!").skip(f.optWhitespace)),map:(We,Pt)=>Ce(Pt)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:Z,rule:Y(/AND|&/i),map:(We,Pt,Sn)=>Ct.struct.modifier.intersectBy({0:Pt,by:Sn})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:Z,rule:Y(/OR|\|/i),map:(We,Pt,Sn)=>Ct.struct.combinator.merge([Pt,Sn])},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:Z,rule:Y(/IN/i),map:(We,Pt,Sn)=>Ct.struct.filter.withSameAtomProperties({0:Pt,source:Sn,property:Ct.core.type.compositeKey([Ct.ammp("label_atom_id"),Ct.ammp("label_seq_id"),Ct.ammp("label_comp_id"),Ct.ammp("auth_asym_id"),Ct.ammp("label_asym_id")])})},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:Z,rule:Y(/LIKE|l\./i),map:(We,Pt,Sn)=>Ct.struct.filter.withSameAtomProperties({0:Pt,source:Sn,property:Ct.core.type.compositeKey([Ct.ammp("label_atom_id"),Ct.ammp("label_seq_id")])})},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:ye,rule:g(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(We=>parseFloat(We)),map:(We,Pt)=>Ct.struct.filter.within({0:Ct.struct.generator.all(),target:Pt,"atom-radius":Ct.acp("vdw"),"max-radius":We,invert:!0})},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:ye,rule:g(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(We=>parseFloat(We)),map:(We,Pt)=>Ct.struct.modifier.exceptBy({0:Ct.struct.filter.within({0:Ct.struct.generator.all(),target:Pt,"max-radius":We}),by:Pt})},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:ye,rule:g(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(We=>parseFloat(We)),map:(We,Pt)=>Ct.struct.modifier.includeSurroundings({0:Pt,radius:We})},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:Z,rule:_e("WITHIN","w."),map:(We,Pt,Sn)=>Ct.struct.filter.within({0:Pt,target:Sn,"max-radius":We})},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:Z,rule:_e("NEAR_TO","nto."),map:(We,Pt,Sn)=>Ct.struct.modifier.exceptBy({0:Ct.struct.filter.within({0:Pt,target:Sn,"max-radius":We}),by:Sn})},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:Z,rule:_e("BEYOND","be."),map:(We,Pt,Sn)=>Ct.struct.modifier.exceptBy({0:Ct.struct.filter.within({0:Pt,target:Sn,"max-radius":We,invert:!0}),by:Sn})},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:de,rule:ee(/BYRESIDUE|byresi|byres|br\./i),map:(We,Pt)=>be(Ct.struct.modifier.expandProperty({0:Ct.struct.modifier.union({0:Pt}),property:Ct.ammp("residueKey")}))},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:de,rule:ee(/BYCALPHA|bca\./i),map:(We,Pt)=>Ct.struct.generator.queryInSelection({0:Ct.struct.modifier.expandProperty({0:Ct.struct.modifier.union({0:Pt}),property:Ct.ammp("residueKey")}),query:Ct.struct.generator.atomGroups({"atom-test":Ct.core.rel.eq([Ct.atomName("CA"),Ct.ammp("label_atom_id")])})})},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:de,rule:ee(/BYMOLECULE|bymol|bm\./i),map:(We,Pt)=>be(Ct.struct.modifier.expandProperty({0:Ct.struct.modifier.union({0:Pt}),property:Ct.atp("connectedComponentKey")}))},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:de,rule:ee(/BYFRAGMENT|byfrag|bf\./i),map:(We,Pt)=>[We,Pt]},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:de,rule:ee(/BYSEGMENT|bysegi|byseg|bs\./i),map:(We,Pt)=>be(Ct.struct.modifier.expandProperty({0:Ct.struct.modifier.union({0:Pt}),property:Ct.ammp("chainKey")}))},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:de,rule:ee(/BYOBJECT|byobj|bo\./i),map:(We,Pt)=>[We,Pt]},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:de,rule:ee(/BYCELL/i),map:(We,Pt)=>[We,Pt]},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:de,rule:ee(/BYRING/i),map:(We,Pt)=>be(Ct.struct.modifier.intersectBy({0:Ct.struct.filter.pick({0:Ct.struct.generator.rings(),test:Ct.core.logic.and([Ct.core.rel.lte([Ct.struct.atomSet.atomCount(),7]),Ct.core.rel.gr([Ct.struct.atomSet.countQuery([Pt]),1])])}),by:Pt}))},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:de,abbr:["nbr."],rule:ee(/NEIGHBOR|nbr\./i),map:(We,Pt)=>Ct.struct.modifier.exceptBy({0:be(Ct.struct.modifier.includeConnected({0:Ct.struct.modifier.union({0:Pt}),"bond-test":!0})),by:Pt})},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:de,rule:ee(/BOUND_TO|bto\./i),map:(We,Pt)=>be(Ct.struct.modifier.includeConnected({0:Ct.struct.modifier.union({0:Pt})}))},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:ye,rule:g(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(We=>parseInt(We)),map:(We,Pt)=>be(Ct.struct.modifier.includeConnected({0:Ct.struct.modifier.union({0:Pt}),"bond-test":!0,"layer-count":We}))}],Vt=c.J,Wt={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},yn_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],yn_protein=["C","N","CA","O"];function Zt(){return Vt.struct.combinator.merge([Vt.struct.modifier.intersectBy({0:Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.protein),Vt.ammp("label_comp_id")])}),by:Vt.struct.generator.atomGroups({"atom-test":Vt.core.set.has([Vt.core.type.set(yn_protein),Vt.ammp("label_atom_id")])})}),Vt.struct.modifier.intersectBy({0:Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.nucleic),Vt.ammp("label_comp_id")])}),by:Vt.struct.generator.atomGroups({"atom-test":Vt.core.set.has([Vt.core.type.set(yn_nucleic),Vt.ammp("label_atom_id")])})})])}const kt={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:()=>Vt.struct.generator.all()},none:{"@desc":"No atoms (empty selection)",map:()=>Vt.struct.generator.empty()},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:()=>Vt.struct.generator.atomGroups({"atom-test":Vt.core.rel.eq([Vt.acp("elementSymbol"),Vt.es("H")])})},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:()=>Vt.struct.generator.atomGroups({"atom-test":Vt.core.rel.eq([Vt.ammp("isHet"),!0])})},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:()=>Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.nucleic.concat(Wt.protein)),Vt.ammp("label_comp_id")])})},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:()=>Vt.struct.modifier.exceptBy({0:Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.nucleic.concat(Wt.protein)),Vt.ammp("label_comp_id")])}),by:Zt()})},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:()=>Vt.struct.generator.atomGroups({"atom-test":Vt.core.rel.gr([Vt.struct.atomProperty.core.bondCount({flags:Vt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:()=>be(Vt.struct.modifier.expandProperty({0:Vt.struct.modifier.union([Vt.struct.generator.queryInSelection({0:Vt.struct.generator.atomGroups({"residue-test":Vt.core.logic.not([Vt.core.set.has([Vt.core.type.set(Wt.nucleic.concat(Wt.protein)),Vt.ammp("label_comp_id")])])}),query:Vt.struct.generator.atomGroups({"atom-test":Vt.core.rel.eq([Vt.es("C"),Vt.acp("elementSymbol")])})})]),property:Vt.ammp("residueKey")}))},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:()=>be(Vt.struct.modifier.expandProperty({0:Vt.struct.modifier.union([Vt.struct.filter.pick({0:Vt.struct.generator.atomGroups({"residue-test":Vt.core.logic.not([Vt.core.set.has([Vt.core.type.set(Wt.nucleic.concat(Wt.protein).concat(Wt.solvent)),Vt.ammp("label_comp_id")])]),"group-by":Vt.ammp("residueKey")}),test:Vt.core.logic.not([Vt.core.set.has([Vt.struct.atomSet.propertySet([Vt.acp("elementSymbol")]),Vt.es("C")])])})]),property:Vt.ammp("residueKey")}))},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:()=>Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.solvent),Vt.ammp("label_comp_id")])})},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:()=>Vt.struct.combinator.merge([Vt.struct.generator.atomGroups({"atom-test":Vt.core.rel.eq([Vt.atomName("CA"),Vt.ammp("label_atom_id")]),"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.protein),Vt.ammp("label_comp_id")])}),Vt.struct.generator.atomGroups({"atom-test":Vt.core.set.has([ne(["C4*","C4'"]),Vt.ammp("label_atom_id")]),"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.nucleic),Vt.ammp("label_comp_id")])})])},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:()=>Zt()},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:()=>Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.protein),Vt.ammp("label_comp_id")])})},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:()=>Vt.struct.generator.atomGroups({"residue-test":Vt.core.set.has([Vt.core.type.set(Wt.nucleic),Vt.ammp("label_comp_id")])})}},Ot=c.J,An=function we(We){const Pt={};return Object.keys(We).sort(Re).forEach(Sn=>{const Nn=We[Sn],Kn=xe(`property '${Sn}' not supported`),dr=f.regexp(Nn.regex).map(xr=>(Nn.isUnsupported&&Kn(),Be(Nn.property,Nn.map(xr))));Nn.isNumeric||(Pt[Sn]=dr)}),Pt}(Dt),jn=f.string("/");function On(We){return We.or(f.of(null))}function fr(We){const Pt={},Sn={};for(const Nn in We){const Kn=Dt[Nn];if(!Kn)throw new Error(`property '${Nn}' not supported, value '${We[Nn]}'`);null!==We[Nn]&&(Sn[Kn.level]||(Sn[Kn.level]=[]),Sn[Kn.level].push(We[Nn]))}for(const Nn in Sn)Pt[Nn]=le(Sn[Nn]);return Ot.struct.generator.atomGroups(Pt)}const Dr=f.createLanguage({Parens:function(We){return f.alt(We.Parens,We.Operator,We.Expression).wrap(f.string("("),f.string(")"))},Expression:function(We){return f.alt(We.Keywords,We.AtomSelectionMacro.map(fr),We.NamedAtomProperties,We.Pepseq,We.Rep,We.Object)},AtomSelectionMacro:function(We){return f.alt(jn.then(f.alt(f.seq(On(We.ObjectProperty).skip(jn),On(An.segi).skip(jn),On(An.chain).skip(jn),On(An.resi).skip(jn),On(An.name)).map(Pt=>({object:Pt[0],segi:Pt[1],chain:Pt[2],resi:Pt[3],name:Pt[4]})),f.seq(On(We.ObjectProperty).skip(jn),On(An.segi).skip(jn),On(An.chain).skip(jn),On(An.resi)).map(Pt=>({object:Pt[0],segi:Pt[1],chain:Pt[2],resi:Pt[3]})),f.seq(On(We.ObjectProperty).skip(jn),On(An.segi).skip(jn),On(An.chain)).map(Pt=>({object:Pt[0],segi:Pt[1],chain:Pt[2]})),f.seq(On(We.ObjectProperty).skip(jn),On(An.segi)).map(Pt=>({object:Pt[0],segi:Pt[1]})),f.seq(On(We.ObjectProperty)).map(Pt=>({object:Pt[0]})))),f.alt(f.seq(On(We.ObjectProperty).skip(jn),On(An.segi).skip(jn),On(An.chain).skip(jn),On(An.resi).skip(jn),On(An.name)).map(Pt=>({object:Pt[0],segi:Pt[1],chain:Pt[2],resi:Pt[3],name:Pt[4]})),f.seq(On(An.segi).skip(jn),On(An.chain).skip(jn),On(An.resi).skip(jn),On(An.name)).map(Pt=>({segi:Pt[0],chain:Pt[1],resi:Pt[2],name:Pt[3]})),f.seq(On(An.chain).skip(jn),On(An.resi).skip(jn),On(An.name)).map(Pt=>({chain:Pt[0],resi:Pt[1],name:Pt[2]})),f.seq(On(An.resi).skip(jn),On(An.name)).map(Pt=>({resi:Pt[0],name:Pt[1]}))))},NamedAtomProperties:function(){return f.alt(...Oe(Dt))},Keywords:()=>f.alt(...Se(kt)),ObjectProperty:()=>{const We=K(Dt,kt,$t).sort(Re).map(W.Nt).join("|");return f.regexp(new RegExp(`(?!(${We}))[A-Z0-9_]+`,"i"))},Object:We=>We.ObjectProperty.notFollowedBy(jn).map(Pt=>{throw new Error(`property 'object' not supported, value '${Pt}'`)}),Pepseq:()=>f.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(xe("operator 'pepseq' not supported")),Rep:()=>f.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(xe("operator 'rep' not supported")),Operator:function(We){return q($t,f.alt(We.Parens,We.Expression,We.Operator))},Query:function(We){return f.alt(We.Operator,We.Parens,We.Expression).trim(f.optWhitespace)}}),or=c.J,Nr=/[-+]?[0-9]*\.?[0-9]+/,Ir=/[+]?[0-9]+/,Or=/[-+]?[0-9]+/;function Jr(We){return We}const To={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function un(We){return or.struct.type.secondaryStructureFlags([To[We.toUpperCase()]||"none"])}const ct={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:or.atomName,level:"atom-test",property:or.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:Jr,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:Ir,map:We=>parseInt(We)-1,level:"atom-test",property:or.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:Ir,map:We=>parseInt(We),level:"atom-test",property:or.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:Ir,map:We=>parseInt(We),level:"atom-test",property:or.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:We=>or.es(We),level:"atom-test",property:or.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:Jr,level:"atom-test",property:or.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:Jr,level:"residue-test",property:or.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:Or,map:We=>parseInt(We),level:"residue-test",property:or.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:Or,map:We=>parseInt(We),level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:Or,map:We=>parseInt(We),level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:Or,map:We=>parseInt(We),level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:Jr,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:Ir,map:We=>parseInt(We),level:"atom-test",property:or.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:Jr,level:"residue-test",property:or.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:Or,map:We=>parseInt(We),level:"residue-test",property:or.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:Jr,level:"residue-test",property:or.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test",property:or.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:Jr,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:un,level:"atom-test",property:or.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:Nr,map:We=>parseFloat(We),level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:Nr,map:We=>parseInt(We),level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:Nr,map:We=>parseInt(We),level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:Nr,map:We=>parseInt(We),level:"atom-test"}},dt=c.J,Yt=Object.keys(ct).sort(Re).filter(We=>!ct[We].isUnsupported).join("|"),cn=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:de,rule:f.regexp(/NOT/i).skip(f.whitespace),map:(We,Pt)=>Ce(Pt)},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:de,rule:ee(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(We=>parseFloat(We)),map:(We,Pt)=>dt.struct.modifier.includeSurroundings({0:Pt,radius:We})},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:de,rule:ee(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(We=>parseFloat(We)),map:(We,Pt)=>dt.struct.modifier.exceptBy({0:dt.struct.modifier.includeSurroundings({0:Pt,radius:We}),by:Pt})},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:de,rule:ee(new RegExp(`SAME\\s+(${Yt})\\s+AS`,"i"),1).map(We=>ct[We].property),map:(We,Pt)=>dt.struct.filter.withSameAtomProperties({0:dt.struct.generator.all(),source:Pt,property:We})},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:Z,rule:f.alt(Y(/AND/i),f.whitespace),map:(We,Pt,Sn)=>dt.struct.modifier.intersectBy({0:Pt,by:Sn})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:Z,rule:Y(/OR/i),map:(We,Pt,Sn)=>dt.struct.combinator.merge([Pt,Sn])}],xn=c.J;function Rn(){return xn.struct.filter.pick({0:xn.struct.generator.atomGroups({"group-by":xn.ammp("residueKey")}),test:xn.core.set.isSubset([ne(["C","N","CA","O"]),xn.ammpSet("label_atom_id")])})}function er(){return xn.struct.filter.pick({0:xn.struct.generator.atomGroups({"group-by":xn.ammp("residueKey")}),test:xn.core.logic.and([xn.core.set.isSubset([ne(["P"]),xn.ammpSet("label_atom_id")]),xn.core.logic.or([xn.core.set.isSubset([ne(["O3'","C3'","C4'","C5'","O5'"]),xn.ammpSet("label_atom_id")]),xn.core.set.isSubset([ne(["O3*","C3*","C4*","C5*","O5*"]),xn.ammpSet("label_atom_id")])])])})}function ir(){return xn.struct.combinator.merge([xn.struct.generator.queryInSelection({0:Rn(),query:xn.struct.generator.atomGroups({"atom-test":xn.core.set.has([ne(br.protein),xn.ammp("label_atom_id")])})}),xn.struct.generator.queryInSelection({0:er(),query:xn.struct.generator.atomGroups({"atom-test":xn.core.set.has([ne(br.nucleic),xn.ammp("label_atom_id")])})})])}function Yn(We){return xn.struct.generator.atomGroups({"residue-test":xn.core.flags.hasAll([xn.ammp("secondaryStructureFlags"),xn.struct.type.secondaryStructureFlags(We)])})}const br={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},vr={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},Hr={all:{"@desc":"everything",map:()=>xn.struct.generator.all()},none:{"@desc":"nothing",map:()=>xn.struct.generator.empty()},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>Rn()},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:()=>er()},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:()=>ir()},sidechain:{"@desc":"non-backbone atoms and bonds",map:()=>Ce(ir())},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:()=>ge(vr.water)},at:{"@desc":"residues named ADA A THY T",map:()=>ge(vr.at)},acidic:{"@desc":"residues named ASP GLU",map:()=>ge(vr.acidic)},acyclic:{"@desc":'"protein and not cyclic"',map:()=>xn.struct.modifier.intersectBy({0:Rn(),by:Ce(ge(vr.cyclic))})},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:()=>ge(vr.aliphatic)},alpha:{"@desc":"atom's residue is an alpha helix",map:()=>Yn(["alpha"])},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>Rn()},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:()=>ge(vr.aromatic)},basic:{"@desc":"residues named ARG HIS LYS",map:()=>ge(vr.basic)},bonded:{"@desc":"atoms for which numbonds > 0",map:()=>be(xn.struct.filter.pick({0:xn.struct.modifier.includeConnected({0:xn.struct.generator.all(),"bond-test":xn.core.flags.hasAny([xn.struct.bondProperty.flags(),xn.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:xn.core.rel.gr([xn.struct.atomSet.atomCount(),1])}))},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:()=>ge(vr.buried)},cg:{"@desc":"residues named CYT C GUA G",map:()=>ge(vr.cg)},charged:{"@desc":'"basic or acidic"',map:()=>ge(vr.basic.concat(vr.acidic))},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:()=>ge(vr.cyclic)},hetero:{"@desc":'"not (protein or nucleic)"',map:()=>Ce(xn.struct.combinator.merge([Rn(),er()]))},hydrogen:{"@desc":'name "[0-9]?H.*"',map:()=>xn.struct.generator.atomGroups({"atom-test":xn.core.str.match([xn.core.type.regex(["^[0-9]?[H].*$","i"]),xn.core.type.str([xn.ammp("label_atom_id")])])})},large:{"@desc":'"protein and not (small or medium)"',map:()=>xn.struct.modifier.intersectBy({0:Rn(),by:Ce(ge(vr.small.concat(vr.medium)))})},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:()=>ge(vr.medium)},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:()=>ge(vr.neutral)},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:()=>ge(vr.hydrophobic)},polar:{"@desc":'"protein and not hydrophobic"',map:()=>xn.struct.modifier.intersectBy({0:Rn(),by:Ce(ge(vr.hydrophobic))})},purine:{"@desc":"residues named ADE A GUA G",map:()=>ge(vr.purine)},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:()=>ge(vr.pyrimidine)},small:{"@desc":"residues named ALA GLY SER",map:()=>ge(vr.small)},surface:{"@desc":'"protein and not buried"',map:()=>xn.struct.modifier.intersectBy({0:Rn(),by:Ce(ge(vr.buried))})},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:()=>Yn(["alpha"])},pi_helix:{"@desc":"atom's residue is in a pi helix",map:()=>Yn(["pi"])},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:()=>Yn(["3-10"])},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:()=>Yn(["helix"])},extended_beta:{"@desc":"atom's residue is a beta sheet",map:()=>Yn(["sheet"])},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:()=>Yn(["strand"])},sheet:{"@desc":"atom's residue is a beta sheet",map:()=>Yn(["beta"])},turn:{"@desc":"atom's residue is in a turn conformation",map:()=>Yn(["turn"])},coil:{"@desc":"atom's residue is in a coil conformation",map:()=>xn.struct.modifier.intersectBy({0:Rn(),by:Yn(["none"])})}},Mr=c.J,Fr={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:We=>Mr.core.math.pow([We,2])},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:We=>Mr.core.math.sqrt([We])},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:We=>Mr.core.math.abs([We])},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:We=>Mr.core.math.floor([We])},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:We=>Mr.core.math.ceil([We])},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:We=>Mr.core.math.sin([We])},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:We=>Mr.core.math.cos([We])},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:We=>Mr.core.math.tan([We])},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:We=>Mr.core.math.atan([We])},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:We=>Mr.core.math.asin([We])},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:We=>Mr.core.math.acos([We])},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:We=>Mr.core.math.sinh([We])},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:We=>Mr.core.math.cosh([We])},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:We=>Mr.core.math.tanh([We])},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:We=>Mr.core.math.exp([We])},log:{"@desc":"natural log of x","@examples":["log(2)"],map:We=>Mr.core.math.log([We])},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:We=>Mr.core.math.log10([We])}},Sr=c.J,Ur=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:Z,rule:f.regexp(/\s*(\*|\/)\s*/,1),map:(We,Pt,Sn)=>{switch(We){case"*":return Sr.core.math.mult([Pt,Sn]);case"/":return Sr.core.math.div([Pt,Sn]);default:throw new Error(`value operator '${We}' not supported`)}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:Z,rule:f.regexp(/\s*(-|\+)\s*/,1),map:(We,Pt,Sn)=>{switch(We){case"-":return Sr.core.math.sub([Pt,Sn]);case"+":return Sr.core.math.add([Pt,Sn]);default:throw new Error(`value operator '${We}' not supported`)}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:Z,rule:f.alt(f.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),f.whitespace.result("=")),map:(We,Pt,Sn)=>{let Nn;if(void 0!==Pt.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===Pt.head.name&&(Nn=Sr.core.flags.hasAny([Pt,un(Sn)])),"core.type.regex"===Pt.head.name&&(Nn=Sr.core.str.match([Pt,Sr.core.type.str([Sn])]))):void 0!==Sn.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===Sn.head.name&&(Nn=Sr.core.flags.hasAny([Sn,un(Pt)])),"core.type.regex"===Sn.head.name&&(Nn=Sr.core.str.match([Sn,Sr.core.type.str([Pt])]))):"=~"===We&&(Nn=Sr.core.str.match(Pt.head?[Sr.core.type.regex([`^${Sn}$`,"i"]),Sr.core.type.str([Pt])]:[Sr.core.type.regex([`^${Pt}$`,"i"]),Sr.core.type.str([Sn])])),!Nn)switch(Pt.head&&(Sn=Te(Pt,Sn)),Sn.head&&(Pt=Te(Sn,Pt)),We){case"=":case"==":Nn=Sr.core.rel.eq([Pt,Sn]);break;case"!=":Nn=Sr.core.rel.neq([Pt,Sn]);break;case">":Nn=Sr.core.rel.gr([Pt,Sn]);break;case"<":Nn=Sr.core.rel.lt([Pt,Sn]);break;case">=":Nn=Sr.core.rel.gre([Pt,Sn]);break;case"<=":Nn=Sr.core.rel.lte([Pt,Sn]);break;default:throw new Error(`value operator '${We}' not supported`)}return Sr.struct.generator.atomGroups({"atom-test":Nn})}}],Ro=f.createLanguage({Parens:function(We){return f.alt(We.Parens,We.Operator,We.Expression).wrap(f.string("("),f.string(")"))},Expression:function(We){return f.alt(We.RangeListProperty,We.ValueQuery,We.Keywords)},NamedAtomProperties:function(){return f.alt(...Oe(ct))},Keywords:()=>f.alt(...Se(Hr)),ValueRange:function(We){return f.seq(We.Value.skip(f.regexp(/\s+TO\s+/i)),We.Value).map(Pt=>({range:Pt}))},RangeListProperty:function(We){return f.seq(f.alt(...Ne(ct,/\s/)).skip(f.whitespace),f.alt(We.ValueRange,We.Value).sepBy1(f.whitespace)).map(Pt=>{const[Sn,Nn]=Pt,Kn=[],dr=[];Nn.forEach(ht=>{ht.range?dr.push(Sr.core.rel.inRange([Sn,ht.range[0],ht.range[1]])):Kn.push(Te(Sn,ht,To))});const xr=function Ae(We){return 1===We.length?We[0]:We.length>1?te.core.logic.or(We):void 0}(dr),Ft=function ae(We,Pt){if(se.includes(We.head.name)){const Sn=Pt[0].head,Nn=[];return Pt.forEach(Kn=>Nn.push(...Kn.args[0])),te.core.flags.hasAny([We,{head:Sn,args:Nn}])}return 1===Pt.length?te.core.rel.eq([We,Pt[0]]):Pt.length>1?te.core.set.has([te.core.type.set(Pt),We]):void 0}(Sn,Kn);let Qt;return Qt=xr&&Ft?Sr.core.logic.or([xr,Ft]):xr||Ft,Sr.struct.generator.atomGroups({[ce(Sn)]:Qt})})},Operator:function(We){return q(cn,f.alt(We.Parens,We.Expression,We.ValueQuery))},Query:function(We){return f.alt(We.Operator,We.Parens,We.Expression).trim(f.optWhitespace)},Number:function(){return f.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){const We=K(ct,Hr,cn).sort(Re).map(W.Nt).join("|");return f.alt(f.regexp(new RegExp(`(?!(${We}))[A-Z0-9_]+`,"i")),f.regexp(/'((?:[^"\\]|\\.)*)'/,1),f.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(Pt=>Sr.core.type.regex([`^${Pt}$`,"i"]))).desc("string")},Value:function(We){return f.alt(We.Number,We.String)},ValueParens:function(We){return f.alt(We.ValueParens,We.ValueOperator,We.ValueExpressions).wrap(f.string("("),f.string(")"))},ValuePropertyNames:function(){return f.alt(...Ne(ct,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(We){return q(Ur,f.alt(We.ValueParens,We.ValueExpressions))},ValueExpressions:function(We){return f.alt(We.ValueFunctions,We.Value,We.ValuePropertyNames)},ValueFunctions:function(We){return f.alt(...function Ve(We,Pt){const Sn=[],Nn=f.regexp(/\(\s*/),Kn=f.regexp(/\s*\)/);return Object.keys(We).sort(Re).forEach(dr=>{const xr=We[dr],Ft=xr.map?xr.map:xe(`function '${dr}' not supported`),Qt=f.regexp(new RegExp(dr,"i")).skip(Nn).then(Pt).skip(Kn).map(Ft);Sn.push(Qt)}),Sn}(Fr,We.ValueOperator))},ValueQuery:function(We){return f.alt(We.ValueOperator.map(Pt=>{if(!Pt.head.name||!Pt.head.name.startsWith("structure-query.generator"))throw new Error(`values must be part of an comparison, value '${Pt}'`);return Pt}))}}),so={pymol:We=>Dr.Query.tryParse(We),vmd:We=>Ro.Query.tryParse(We),jmol:We=>At.Query.tryParse(We)};var Bo=n(9136),Go=n(7291);function Wo(We,Pt){return{expression:We,language:Pt}}!function(We){function Nn(Ft){switch(Ft.language){case"mol-script":const Qt=function $(We){return J.parse(We)}(Ft.expression);if(0===Qt.length)throw new Error("No query");return R(Qt[0]);case"pymol":case"jmol":case"vmd":return function ho(We,Pt){try{return so[We](Pt)}catch(Sn){throw console.error(Sn.message),Sn}}(Ft.language,Ft.expression);default:(0,H.dr)(Ft.language)}}function Kn(Ft){const Qt=Nn(Ft);return(0,Go.wE)(Qt)}We.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"},We.is=function Pt(Ft){return!!Ft&&"string"==typeof Ft.expression&&!!Ft.language},We.areEqual=function Sn(Ft,Qt){return Ft.language===Qt.language&&Ft.expression===Qt.expression},We.toExpression=Nn,We.toQuery=Kn,We.toLoci=function dr(Ft,Qt){const pt=Kn(Ft)(new Bo.cY(Qt));return Bo.cv.toLociWithSourceUnits(pt)},We.getStructureSelection=function xr(Ft,Qt,ht){const pt="function"==typeof Ft?Ft(c.J):Ft;return(0,Go.wE)(pt)(new Bo.cY(Qt,ht))}}(Wo||(Wo={}))},4829:(tn,Ue,n)=>{"use strict";n.d(Ue,{K:()=>r});var r,e=n(9909),o=n(8277);!function(t){function A(i){const v={create:O=>({action:v,params:O}),id:e.kk.create22(),definition:i,createDefaultParams:(O,b)=>i.params?o.t.getDefaultValues(i.params(O,b)):{}};return v}let c;t.create=A,t.fromTransformer=function y(i){const v=i.definition;return A({from:v.from,display:v.display,params:v.params,isApplicable:i.definition.isApplicable?(O,b,_)=>i.definition.isApplicable(O,_):void 0,run({cell:O,state:b,params:_}){const M=b.build().to(O.transform.ref).apply(i,_);return b.updateTree(M)}})},(c=t.Builder||(t.Builder={})).build=O=>function v(O){return b=>A({from:O.from instanceof Array?O.from:O.from?[O.from]:[],display:"string"==typeof O.display?{name:O.display}:O.display?O.display:{name:"Unnamed State Action"},params:"object"==typeof O.params?()=>O.params:O.params?O.params:void 0,isApplicable:O.isApplicable,..."function"==typeof b?{run:b}:b})}(O),t.build=c.build}(r||(r={}))},1832:(tn,Ue,n)=>{"use strict";n.d(Ue,{Uw:()=>V,KW:()=>Te.K,BM:()=>o,so:()=>y,QX:()=>h,Cn:()=>i.C,xE:()=>s.x,uF:()=>u});var o,r,ie,y,e=n(9909);!function(ie){function re(ce){var se;return(se=class{static is(ge){return!!ge&&ce===ge.type}constructor(ge,Ie){this.data=ge,this.id=e.kk.create22(),this.type=ce,this.label=Ie&&Ie.label||ce.name,this.description=Ie&&Ie.description}}).type=ce,se}ie.factory=function ue(){return ce=>re(ce)},ie.create=re,ie.hasTag=function ve(ce,se){if(!ce.tags)return!1;for(const ae of ce.tags)if(ae===se)return!0;return!1},ie.Null={id:e.kk.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}}(o||(o={})),(ie=r||(r={})).is=function ue(ve){return!!(ve&&ve.transform&&ve.parent&&ve.status)},ie.resolve=function re(ve,ce){const se="string"==typeof ce?ce:ie.is(ce)?ce.transform.ref:ce.ref;return ve.cells.get(se)};class A{get cell(){var ue;return null===(ue=this.state)||void 0===ue?void 0:ue.cells.get(this.ref)}get obj(){var ue,re;return null===(re=null===(ue=this.state)||void 0===ue?void 0:ue.cells.get(this.ref))||void 0===re?void 0:re.obj}get data(){var ue;return null===(ue=this.obj)||void 0===ue?void 0:ue.data}update(ue,re){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return re||(re=this.state.build()),(re||this.state.build()).to(this).update(ue),re}checkValid(){if(!this.state)throw new Error("Unassigned State.");const ue=this.cell;if(!ue)throw new Error("Not created at all. Did you await/then the corresponding state update?");if("ok"===ue.status)return!0;throw"error"===ue.status?new Error(ue.errorText):ue.obj===o.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")}get isOk(){const ue=this.cell;return ue&&"ok"===ue.status&&ue.obj!==o.Null}constructor(ue,re){this.ref=ue,this.state=re}}!function(ie){function re(ce,se){if(se)return r.is(se)?se:"string"==typeof se?ce.cells.get(se):se.cell}ie.resolveRef=function ue(ce){var se;if(ce)return"string"==typeof ce?ce:r.is(ce)?ce.transform.ref:null===(se=ce.cell)||void 0===se?void 0:se.transform.ref},ie.resolve=re,ie.resolveAndCheck=function ve(ce,se){const ae=re(ce,se);if(ae&&ae.obj&&"ok"===ae.status)return ae}}(y||(y={}));var u,c=n(39),i=n(2907),v=n(9359),O=n(6115);class b{get childMutations(){return this._childMutations||(this._childMutations=new Map),this._childMutations}get dependencyMutations(){return this._dependencyMutations||(this._dependencyMutations=new Map),this._dependencyMutations}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(i.C.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(ue,re){if(this.changeChildren(),this.childMutations.has(ue))this.childMutations.get(ue).add(re);else{const ve=this.children.get(ue).asMutable();ve.add(re),this.children.set(ue,ve),this.childMutations.set(ue,ve)}}removeChild(ue,re){if(this.changeChildren(),this.childMutations.has(ue))this.childMutations.get(ue).remove(re);else{const ve=this.children.get(ue).asMutable();ve.remove(re),this.children.set(ue,ve),this.childMutations.set(ue,ve)}}clearRoot(){const ue=i.C.RootRef;if(0===this.children.get(ue).size)return;this.changeChildren();const re=(0,c.CD)();this.children.set(ue,re),this.childMutations.set(ue,re)}mutateDependency(ue,re,ve){let ce=this.dependencyMutations.get(ue);if(!ce){const se=this.dependencies.get(ue);if(!se&&"remove"===ve)return;this.changeDependencies(),ce=se?se.asMutable():(0,c.CD)().asMutable(),this.dependencyMutations.set(ue,ce),this.dependencies.set(ue,ce)}"add"===ve?ce.add(re):ce.remove(re)}changeParent(ue,re){m(this.transforms,ue);const ve=this.transforms.get(ue);this.removeChild(ve.parent,ue),this.addChild(re,ue),this.changeNodes(),this.transforms.set(ue,i.C.withParent(ve,re))}add(ue){const re=ue.ref;this.transforms.has(ue.ref)&&this.transforms.get(ue.ref).parent!==ue.parent&&function I(ie){throw new Error(`Transform '${ie}' is already present in the tree.`)}(ue.ref);const ve=this.children.get(ue.parent);if(ve||function l(ie){throw new Error(`Parent '${ie}' must be present in the tree.`)}(ue.parent),ve.has(ue.ref)||this.addChild(ue.parent,ue.ref),this.children.has(ue.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(ue.ref,(0,c.CD)())),this.changeNodes(),this.transforms.set(re,ue),ue.dependsOn)for(const ce of ue.dependsOn)this.mutateDependency(ce,re,"add");return this}setParams(ue,re){m(this.transforms,ue);const ve=this.transforms.get(ue);return!(0,v.bN)(ve.params,re)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(ve.ref,i.C.withParams(ve,re)),!0)}setTags(ue,re){m(this.transforms,ue);const ve=this.transforms.get(ue),ce=i.C.withParams(ve,re);return!(0,O.af)(ve.tags,ce.tags)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(ve.ref,ce),!0)}assignState(ue,re){m(this.transforms,ue);const ve=this.transforms.get(ue);if(this._stateUpdates&&this._stateUpdates.has(ue))return i.C.assignState(ve.state,re),ve;{this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(ve.ref),this.changeNodes();const ce=i.C.withState(ve,re);return this.transforms.set(ue,ce),ce}}remove(ue){const re=this.transforms.get(ue);if(!re)return[];const ve=u.subtreePostOrder(this,re);if(ue===i.C.RootRef){if(ve.pop(),0===ve.length)return ve;this.clearRoot()}else{if(0===ve.length)return ve;this.removeChild(re.parent,re.ref)}this.changeNodes(),this.changeChildren();for(const se of ve)this.transforms.delete(se.ref),this.children.delete(se.ref),this._childMutations&&this._childMutations.delete(se.ref);const ce=[];for(const se of ve){if(se.dependsOn)for(const ae of se.dependsOn)this.transforms.has(ae)&&this.mutateDependency(ae,se.ref,"remove");if(this.dependencies.has(se.ref)){const ae=this.dependencies.get(se.ref).toArray();this.changeDependencies(),this.dependencies.delete(se.ref),this._dependencyMutations&&this._dependencyMutations.delete(se.ref);for(const ge of ae)if(this.transforms.has(ge))for(const Ie of this.remove(ge))ce[ce.length]=Ie}}for(const se of ce)ve[ve.length]=se;return ve}asImmutable(){return this.changedNodes||this.changedChildren||this._childMutations?(this._childMutations&&this._childMutations.forEach(_,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(M,this.dependencies),u.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies)):this.tree}constructor(ue){this.tree=ue,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}}function _(ie,ue){this.set(ue,ie.asImmutable())}function M(ie,ue){0===ie.size?this.delete(ue):this.set(ue,ie.asImmutable())}function m(ie,ue){if(!ie.has(ue))throw new Error(`Node '${ue}' is not present in the tree.`)}!function(ie){class ue{get root(){return this.transforms.get(i.C.RootRef)}asTransient(){return new b(this)}constructor(Me,Ke,ut){this.transforms=Me,this.children=Ke,this.dependencies=ut}}function ve(_t,Me,Ke){return new ue(_t,Me,Ke)}function ce(_t){se(this,this.tree.transforms.get(_t))}function se(_t,Me){const Ke=_t.tree.children.get(Me.ref);Ke&&Ke.size&&Ke.forEach(ce,_t),_t.f(Me,_t.tree,_t.state)}function ae(_t,Me,Ke,ut){const Kt={tree:_t,state:Ke,f:ut};return se(Kt,Me),Kt.state}function ge(_t){Ie(this,this.tree.transforms.get(_t))}function Ie(_t,Me){const Ke=_t.f(Me,_t.tree,_t.state);if("boolean"==typeof Ke&&!Ke)return;const ut=_t.tree.children.get(Me.ref);ut&&ut.size&&ut.forEach(ge,_t)}function Le(_t,Me,Ke,ut){const Kt={tree:_t,state:Ke,f:ut};return Ie(Kt,Me),Kt.state}function nt(_t,Me,Ke){Ke.push(_t)}function Lt(_t,Me,Ke){Ke.push(i.C.toJSON(_t))}function pn(_t,Me,Ke){if(Me===Ke)return!0;const Kt=_t.children.get(Me).values();for(;;){const sn=Kt.next();if(sn.done)return!1;if(pn(_t,sn.value,Ke))return!0}}ie.createEmpty=function re(_t){const Me=_t||i.C.createRoot();return ve((0,c.T5)([[Me.ref,Me]]),(0,c.T5)([[Me.ref,(0,c.CD)()]]),(0,c.T5)())},ie.create=ve,ie.doPostOrder=ae,ie.doPreOrder=Le,ie.subtreePostOrder=function je(_t,Me){return ae(_t,Me,[],nt)},ie.toJSON=function Je(_t){const Me=[];return Le(_t,_t.root,Me,Lt),{transforms:Me}},ie.fromJSON=function en(_t){const Me=(0,c.T5)().asMutable(),Ke=(0,c.T5)().asMutable(),ut=(0,c.T5)().asMutable();for(const sn of _t.transforms){const gt=i.C.fromJSON(sn);Me.set(gt.ref,gt),Ke.has(gt.ref)||Ke.set(gt.ref,(0,c.CD)().asMutable()),gt.ref!==gt.parent&&Ke.get(gt.parent).add(gt.ref)}const Kt=new Set;for(const sn of _t.transforms){const gt=sn.ref;if(Ke.set(gt,Ke.get(gt).asImmutable()),sn.dependsOn)for(const yt of sn.dependsOn)Kt.add(yt),ut.has(yt)?ut.get(yt).add(gt):ut.set(yt,(0,c.CD)([gt]).asMutable())}return Kt.forEach(sn=>{ut.set(sn,ut.get(sn).asImmutable())}),ve(Me.asImmutable(),Ke.asImmutable(),ut.asImmutable())},ie.dump=function Bt(_t){console.log({tr:_t.transforms.keySeq().toArray(),tr1:_t.transforms.valueSeq().toArray().map(Me=>Me.ref),ch:_t.children.keySeq().toArray()})},ie.subtreeHasRef=function $e(_t,Me,Ke){return!(!_t.transforms.has(Me)||!_t.transforms.has(Ke))&&pn(_t,Me,Ke)},ie.getDecoratorRoot=function mt(_t,Me){const Ke=_t.children.get(Me);if(1!==Ke.size)return Me;const ut=_t.transforms.get(Ke.first());return ut.transformer.definition.isDecorator?mt(_t,ut.ref):Me}}(u||(u={}));var h,d=n(467),s=n(8384),C=n(4824);!function(ie){function ue(Wt,yn){return re(Wt)(yn)}function re(Wt){const yn=Wt||Le.root;let Zt;return Zt=function ce(Wt){return void 0!==Wt.compile}(yn)?yn.compile():function ve(Wt){return void 0!==Wt.transform&&void 0!==Wt.status}(yn)?Le.byValue(yn).compile():function se(Wt){return"function"==typeof Wt}(yn)?yn:Le.byRef(yn).compile(),Zt}ie.select=ue,ie.compile=re;const ae={select(Wt){return ue(this,Wt||this.state)}};function ge(Wt,yn){ae[Wt]=function(...Zt){return yn.call(void 0,this,...Zt)}}function Ie(Wt){return Object.create(ae,{compile:{writable:!1,configurable:!1,value:Wt}})}let Le;function nt(Wt,yn){const Zt=re(Wt);return Ie(()=>kt=>{const Ot=[];for(const An of Zt(kt))for(const jn of yn(An,kt))Ot.push(jn);return Ot})}function je(Wt,yn){const Zt=re(Wt);return Ie(()=>kt=>{const Ot=[];for(const An of Zt(kt)){const jn=yn(An,kt);jn&&Ot.push(jn)}return Ot})}function Lt(Wt){const yn=re(Wt);return Ie(()=>Zt=>{const kt=new Set,Ot=[];for(const An of yn(Zt))An&&(kt.has(An.transform.ref)||(kt.add(An.transform.ref),Ot.push(An)));return Ot})}function Je(Wt){const yn=re(Wt);return Ie(()=>Zt=>{const kt=yn(Zt);return kt.length?[kt[0]]:[]})}function en(Wt,yn){return nt(Wt,Zt=>yn(Zt)?[Zt]:[])}function Bt(Wt,yn){return en(Wt,Zt=>Zt.status===yn)}function pn(Wt,yn){return en(Wt,Zt=>!!Zt.transform.tags&&Zt.transform.tags.indexOf(yn)>=0)}function $e(Wt){return nt(Wt,(yn,Zt)=>{const kt=[];return u.doPreOrder(Zt.tree,Zt.tree.transforms.get(yn.transform.ref),kt,(Ot,An,jn)=>{jn.push(Ot.ref)}),kt.map(Ot=>Zt.cells.get(Ot))})}function mt(Wt){return nt(Wt,(yn,Zt)=>{const kt=[];return Zt.tree.children.get(yn.transform.ref).forEach(Ot=>kt.push(Zt.cells.get(Ot))),kt})}function _t(Wt,yn){return en(Wt,Zt=>!!Zt.obj&&Zt.obj.type===yn.type)}function Me(Wt,yn){return Lt(je(Wt,(Zt,kt)=>Gt(kt.tree,kt.cells,Zt.transform.ref,yn)))}function Ke(Wt,yn){return Lt(je(Wt,(Zt,kt)=>Mt(kt.tree,kt.cells,Zt.transform.ref,yn)))}function ut(Wt,yn){return Lt(je(Wt,(Zt,kt)=>tt(kt.tree,kt.cells,Zt.transform.ref,yn)))}function Kt(Wt,yn){return en(Wt,Zt=>Zt.transform.transformer===yn)}function sn(Wt,yn){return Lt(je(Wt,(Zt,kt)=>rn(kt.tree,kt.cells,Zt.transform.ref,yn)))}function gt(Wt,yn){return Lt(je(Wt,(Zt,kt)=>nn(kt.tree,kt.cells,Zt.transform.ref,yn)))}function yt(Wt){return Lt(je(Wt,(yn,Zt)=>Zt.cells.get(Zt.tree.transforms.get(yn.transform.ref).parent)))}function At(Wt,yn,Zt,kt,Ot){let jn,An=Wt.transforms.get(Zt);for(;;){An=Wt.transforms.get(An.parent);const On=yn.get(An.ref);if(On.obj&&kt(On)&&(jn=On,Ot)||An.ref===i.C.RootRef)return jn}}function Gt(Wt,yn,Zt,kt){return At(Wt,yn,Zt,kt,!0)}function rn(Wt,yn,Zt,kt){return At(Wt,yn,Zt,kt,!1)}function tt(Wt,yn,Zt,kt){return Gt(Wt,yn,Zt,Array.isArray(kt)?Ot=>kt.indexOf(Ot.transform.transformer)>=0:Ot=>Ot.transform.transformer===kt)}function Mt(Wt,yn,Zt,kt){return Gt(Wt,yn,Zt,bn(kt))}function nn(Wt,yn,Zt,kt){return rn(Wt,yn,Zt,bn(kt))}function bn(Wt){return Array.isArray(Wt)?yn=>{for(const Zt of Wt)if(Zt.type===yn.obj.type)return!0}:yn=>yn.obj.type===Wt.type}function jt(Wt,yn,Zt){if(Wt.tags)for(const kt of Wt.tags)if(Zt.tags.has(kt)){Zt.refs[kt]=Wt.ref;break}return!0}function Dt(Wt,yn,Zt){return!(Wt.tags&&Wt.tags.indexOf(Zt.tag)>=0&&(Zt.ref=Wt.ref,1))}function $t(Wt,yn,Zt){if(Wt.tags){const kt=Zt.tags.size;let Ot=0;for(const An of Wt.tags)if(Zt.tags.has(An)&&(Ot++,Ot===kt)){Zt.refs.push(Wt);break}}else 0===Zt.tags.size&&Zt.refs.push(Wt)}(function(Wt){function On(or,Nr,Ir){const Or=Ir.cells.get(or.ref);return!Or||!Or.obj||Or.obj.type!==Ir.type||(Ir.roots.push(Or),!1)}function fr(or,Nr,Ir){const Or=Ir.cells.get(or.ref);return Or&&Or.obj&&Or.obj.type===Ir.type&&Ir.ret.push(Or),!0}function Dr(or,Nr,Ir){const Or=Ir.cells.get(or.ref);return Or&&Or.obj&&Or.transform.transformer===Ir.t&&Ir.ret.push(Or),!0}function Pr(or,Nr,Ir){const Or=Ir.cells.get(or.ref);return Or&&"error"===Or.status&&Or.transform.transformer===Ir.t&&Ir.ret.push(Or),!0}Wt.root=Ie(()=>or=>[or.cells.get(or.tree.root.ref)]),Wt.byRef=function yn(...or){return Ie(()=>Nr=>{const Ir=[];for(const Or of or){const Jr=Nr.cells.get(Or);Jr&&Ir.push(Jr)}return Ir})},Wt.byValue=function Zt(...or){return Ie(()=>Nr=>or)},Wt.rootsOfType=function kt(or,Nr=i.C.RootRef){return Ie(()=>Ir=>{const Or={roots:[],cells:Ir.cells,type:or.type};return u.doPreOrder(Ir.tree,Ir.tree.transforms.get(Nr),Or,On),Or.roots})},Wt.ofType=function Ot(or,Nr=i.C.RootRef){return Ie(()=>Ir=>{const Or={ret:[],cells:Ir.cells,type:or.type};return u.doPreOrder(Ir.tree,Ir.tree.transforms.get(Nr),Or,fr),Or.ret})},Wt.ofTransformer=function An(or,Nr=i.C.RootRef){return Ie(()=>Ir=>{const Or={ret:[],cells:Ir.cells,t:or};return u.doPreOrder(Ir.tree,Ir.tree.transforms.get(Nr),Or,Dr),Or.ret})},Wt.ofTransformerWithError=function jn(or,Nr=i.C.RootRef){return Ie(()=>Ir=>{const Or={ret:[],cells:Ir.cells,t:or};return u.doPreOrder(Ir.tree,Ir.tree.transforms.get(Nr),Or,Pr),Or.ret})}})(Le=ie.Generators||(ie.Generators={})),ge("flatMap",nt),ie.flatMap=nt,ge("mapObject",je),ie.mapObject=je,ge("unique",Lt),ie.unique=Lt,ge("first",Je),ie.first=Je,ge("filter",en),ie.filter=en,ge("withStatus",Bt),ie.withStatus=Bt,ge("withTag",pn),ie.withTag=pn,ge("subtree",$e),ie.subtree=$e,ge("children",mt),ie.children=mt,ge("ofType",_t),ie.ofType=_t,ge("ancestor",Me),ie.ancestor=Me,ge("ancestorOfType",Ke),ie.ancestorOfType=Ke,ge("ancestorWithTransformer",ut),ie.ancestorWithTransformer=ut,ge("withTransformer",Kt),ie.withTransformer=Kt,ge("root",sn),ie.root=sn,ge("rootOfType",gt),ie.rootOfType=gt,ge("parent",yt),ie.parent=yt,ie.findAncestor=Gt,ie.findRoot=rn,ie.findAncestorWithTransformer=tt,ie.findAncestorOfType=Mt,ie.findRootOfType=nn,ie.findUniqueTagsInSubtree=function Dn(Wt,yn,Zt){return u.doPreOrder(Wt,Wt.transforms.get(yn),{refs:{},tags:Zt},jt).refs},ie.findTagInSubtree=function It(Wt,yn,Zt){return u.doPreOrder(Wt,Wt.transforms.get(yn),{ref:void 0,tag:Zt},Dt).ref},ie.findWithAllTags=function Ct(Wt,yn,Zt){return u.doPreOrder(Wt,Wt.transforms.get(yn),{refs:[],tags:Zt},$t).refs},ie.tryFindDecorator=function Vt(Wt,yn,Zt){if(Wt.transforms.get(yn).transformer===Zt)return Wt.cells.get(yn);const Ot=Wt.tree.children.get(yn);if(1!==Ot.size)return;const An=Ot.first();return Wt.transforms.get(An).transformer.definition.isDecorator?Vt(Wt,An,Zt):void 0}}(h||(h={}));var D,a=n(8956),S=n(1025);function R(...ie){let ue;const re=[];for(const ve of ie)if(ve)if(ue||(ue=new Set),"string"==typeof ve){if(ue.has(ve))continue;ue.add(ve),re.push(ve)}else for(const ce of ve)ue.has(ce)||(ue.add(ce),re.push(ce));return re}!function(ie){function ue(ae){if(!ae.state||ae.state.tree===ae.editInfo.sourceTree)return ae.tree.asImmutable();const ge=ae.state.tree.asTransient();for(const Ie of ae.actions)switch(Ie.kind){case"add":ge.add(Ie.transform);break;case"update":ge.setParams(Ie.ref,Ie.params);break;case"delete":ge.remove(Ie.ref);break;case"insert":{const Le=ge.children.get(Ie.ref).toArray();ge.add(Ie.transform);for(const nt of Le)ge.changeParent(nt,Ie.transform.ref);break}}return ae.editInfo.sourceTree=ae.tree,ge.asImmutable()}ie.is=function re(ae){return!!ae&&"function"==typeof ae.getTree},ie.isTo=function ve(ae){return!!ae&&"function"==typeof ae.getTree&&"string"==typeof ae.ref},ie.Root=class ce{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(ge){const Ie="string"==typeof ge?ge:r.is(ge)?ge.transform.ref:ge.ref;return new se(this.state,Ie,this)}toRoot(){return new se(this.state,this.state.tree.root.ref,this)}delete(ge){const Ie=y.resolveRef(ge);return Ie&&this.state.tree.transforms.has(Ie)?(this.editInfo.count++,this.state.tree.remove(Ie),this.state.actions.push({kind:"delete",ref:Ie}),this):this}getTree(){return ue(this.state)}commit(ge){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,ge))}constructor(ge,Ie){this.state={state:Ie,tree:ge.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:ge,count:0,lastUpdate:void 0}}}};class se{get editInfo(){return this.state.editInfo}get selector(){return new A(this.ref,this.state.state)}getApplyRoot(){return u.getDecoratorRoot(this.state.tree,this.ref)}apply(ge,Ie,Le){if(ge.definition.isDecorator)return this.insert(ge,Ie,Le);const nt=this.getApplyRoot(),je=ge.apply(nt,Ie,Le);return this.state.tree.add(je),this.editInfo.count++,this.editInfo.lastUpdate=je.ref,this.state.actions.push({kind:"add",transform:je}),new se(this.state,je.ref,this.root)}applyOrUpdate(ge,Ie,Le,nt){if(this.state.tree.transforms.has(ge)){const je=this.to(ge);return Le&&je.update(Le),je}return this.apply(Ie,Le,{...nt,ref:ge})}applyOrUpdateTagged(ge,Ie,Le,nt){if(Ie.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");const je=this.getApplyRoot(),Lt=this.state.tree.children.get(je).values();for(;;){const en=Lt.next();if(en.done)break;const Bt=this.state.tree.transforms.get(en.value);if(Bt&&i.C.hasTags(Bt,ge)){const pn=this.to(en.value);return pn.updateTagged(Le,R(Bt.tags,ge,nt&&nt.tags)),pn}}const Je=Ie.apply(je,Le,{...nt,tags:R(ge,nt&&nt.tags)});return this.state.tree.add(Je),this.editInfo.count++,this.editInfo.lastUpdate=Je.ref,this.state.actions.push({kind:"add",transform:Je}),new se(this.state,Je.ref,this.root)}group(ge,Ie,Le){return this.apply(ge,Ie,Le)}insert(ge,Ie,Le){const nt=this.state.tree.children.get(this.ref).toArray(),je=ge.apply(this.ref,Ie,Le);this.state.tree.add(je);for(const Lt of nt)this.state.tree.changeParent(Lt,je.ref);return this.editInfo.count++,this.editInfo.lastUpdate=je.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:je}),new se(this.state,je.ref,this.root)}updateTagged(ge,Ie){(this.state.tree.setParams(this.ref,ge)||this.state.tree.setTags(this.ref,Ie))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:ge}))}update(ge,Ie){let Le;if(Ie){const nt=this.state.tree.transforms.get(this.ref);Le=(0,S.jM)(nt.params,Ie)}else Le="function"==typeof ge?(0,S.jM)(this.state.tree.transforms.get(this.ref).params,ge):ge;return this.state.tree.setParams(this.ref,Le)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:Le})),this.root}to(ge){return this.root.to(ge)}toRoot(){return this.root.toRoot()}delete(ge){return this.root.delete(ge)}getTree(){return ue(this.state)}commit(ge){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,ge))}constructor(ge,Ie,Le){if(this.state=ge,this.root=Le,this.ref=Ie,!this.state.tree.transforms.has(Ie))throw new Error(`Could not find node '${Ie}'.`)}}ie.To=se}(D||(D={}));class f{constructor(){this.ev=a.V.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}add(ue){const re=s.x.is(ue)?ue.toAction():ue;if(this.actions.has(re.id))return this;this.actions.set(re.id,re);for(const ve of re.definition.from)this.fromTypeIndex.has(ve.type)?this.fromTypeIndex.get(ve.type).push(re):this.fromTypeIndex.set(ve.type,[re]);return this.events.added.next(void 0),this}remove(ue){const re=s.x.is(ue)?ue.toAction().id:e.kk.is(ue)?ue:ue.id,ve=this.actions.get(re);if(!ve)return this;this.actions.delete(re);for(const ce of ve.definition.from){const se=this.fromTypeIndex.get(ce.type);se&&((0,O.K3)(se,ve),0===se.length&&this.fromTypeIndex.delete(ce.type))}return this.events.removed.next(void 0),this}fromCell(ue,re){const ve=ue.obj;if(!ve)return[];const ce=this.fromTypeIndex.get(ve.type);if(!ce)return[];let se=!1;for(const ge of ce)if(ge.definition.isApplicable){se=!0;break}if(!se)return ce;const ae=[];for(const ge of ce)ge.definition.isApplicable?ge.definition.isApplicable(ve,ue.transform,re)&&ae.push(ge):ae.push(ge);return ae}dispose(){this.ev.dispose()}}var p=n(2229),E=n(9854),T=n(8277),L=n(6323),w=n(1413);class Q{constructor(){this.queue=[],this.signal=new w.B}get length(){return this.queue.length}enqueue(ue){return this.queue.push(ue),1===this.queue.length||this.waitFor(ue)}handled(ue){(0,O.mO)(this.queue,ue),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(ue){const re=(0,O.mO)(this.queue,ue);return re&&this.signal.next({v:ue,stillPresent:!1}),re}waitFor(ue){return new Promise(re=>{const ve=this.signal.subscribe(({v:ce,stillPresent:se})=>{ce===ue&&(ve.unsubscribe(),re(se))})})}}var G=n(9677);class V{get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new D.Root(this.tree,this)}addHistory(ue,re){0!==this.historyCapacity&&(this.history.unshift([ue,re||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){0!==this.history.length&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){var ue=this;return C.YZ.create("Undo",function(){var re=(0,d.A)(function*(ve){const ce=ue.history.shift();if(ce){ue.events.historyUpdated.next({state:ue}),ue.undoingHistory=!0;try{yield ue.updateTree(ce[0],{canUndo:!1}).runInContext(ve)}finally{ue.undoingHistory=!1}}});return function(ve){return re.apply(this,arguments)}}())}getSnapshot(){return{tree:u.toJSON(this._tree)}}setSnapshot(ue){const re=u.fromJSON(ue.tree);return this.updateTree(re)}setCurrent(ue){this.behaviors.currentObject.next({state:this,ref:ue})}updateCellState(ue,re){const ve=this.cells.get(ue);if(!ve)return;const ce="function"==typeof re?re(ve.state):re;i.C.assignState(ve.state,ce)&&(ve.transform=this._tree.assignState(ve.transform.ref,ce),this.events.cell.stateUpdated.next({state:this,ref:ue,cell:ve}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(ue){return h.select(ue,this)}selectQ(ue){return h.select("string"==typeof ue?ue:ue(h.Generators),this)}applyAction(ue,re,ve=i.C.RootRef){return C.YZ.create("Apply Action",ce=>{const se=this.cells.get(ve);if(!se)throw new Error(`'${ve}' does not exist.`);if("ok"!==se.status)throw new Error(`Action cannot be applied to a cell with status '${se.status}'`);return Ve(ue.definition.run({ref:ve,cell:se,a:se.obj,params:re,state:this},this.globalContext),ce)})}transaction(ue,re){var ve=this;return C.YZ.create("State Transaction",function(){var ce=(0,d.A)(function*(se){const ae=ve.inTransaction,ge=ve._tree.asImmutable();let Ie=!1;try{ae||ve.behaviors.isUpdating.next(!0),ve.inTransaction=!0,ve.inTransactionError=!1,yield ue(se),ve.inTransactionError&&(Ie=!0,yield ve.updateTree(ge).runInContext(se))}catch(Le){if(Ie||(Ie=!0,yield ve.updateTree(ge).runInContext(se),ve.events.log.next(p.x.error("Error during state transaction, reverting"))),ae)throw ve.inTransactionError=!0,Le;if(re?.rethrowErrors)throw Le;console.error(Le)}finally{ae||(ve.inTransaction=!1,ve.events.changed.next({state:ve,inTransaction:!1}),ve.behaviors.isUpdating.next(!1),Ie||(re?.canUndo?ve.addHistory(ge,"string"==typeof re.canUndo?re.canUndo:void 0):ve.clearHistory()))}});return function(se){return ce.apply(this,arguments)}}())}get inUpdate(){return this._inUpdate}updateTree(ue,re){var ve=this;const ce={tree:ue,options:re};return C.YZ.create("Update Tree",function(){var se=(0,d.A)(function*(ae){if(!(yield ve.updateQueue.enqueue(ce)))return;ve._inUpdate=!0;const Ie=re?.canUndo?ve._tree.asImmutable():void 0;let Le=!1;ve.inTransaction||ve.behaviors.isUpdating.next(!0);try{if(D.is(ue)){if(ue.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");ue.editInfo.applied=!0}ve.reverted=!1;const nt=re&&(re.revertIfAborted||re.revertOnError)?yield ve._revertibleTreeUpdate(ae,ce,re):yield ve._updateTree(ae,ce);return Le=ve.reverted,nt.ctx.hadError&&(ve.inTransactionError=!0),nt.cell?new A(nt.cell.transform.ref,ve):void 0}finally{ve._inUpdate=!1,ve.updateQueue.handled(ce),ve.inTransaction||(ve.behaviors.isUpdating.next(!1),re?.canUndo?Le||ve.addHistory(Ie,"string"==typeof re.canUndo?re.canUndo:void 0):ve.undoingHistory||ve.clearHistory())}});return function(ae){return se.apply(this,arguments)}}(),()=>{this.updateQueue.remove(ce)})}_revertibleTreeUpdate(ue,re,ve){var ce=this;return(0,d.A)(function*(){const se=ce.tree,ae=yield ce._updateTree(ue,re);return(ae.ctx.hadError||ae.ctx.wasAborted)&&ve.revertOnError||ae.ctx.wasAborted&&ve.revertIfAborted?(ce.reverted=!0,yield ce._updateTree(ue,{tree:se,options:re.options})):ae})()}_updateTree(ue,re){var ve=this;return(0,d.A)(function*(){let ce=!1;const se=ve.updateTreeAndCreateCtx(re.tree,ue,re.options);try{return ce=yield function N(ie){return k.apply(this,arguments)}(se),D.isTo(re.tree)?{ctx:se,cell:ve.select(re.tree.ref)[0]}:{ctx:se}}finally{ve.spine.current=void 0,ce&&ve.events.changed.next({state:ve,inTransaction:ve.inTransaction})}})()}updateTreeAndCreateCtx(ue,re,ve){const ce=(D.is(ue)?ue.getTree():ue).asTransient(),se=this._tree;this._tree=ce;const ae=this.cells,ge={parent:this,editInfo:D.is(ue)?ue.editInfo:void 0,errorFree:this.errorFree,taskCtx:re,oldTree:se,tree:ce,cells:this.cells,spine:this.spine,results:[],options:{...U,...ve},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:Ie=>{var Le;return null===(Le=ae.get(Ie).obj)||void 0===Le?void 0:Le.data}};return this.errorFree=!0,ge}constructor(ue,re){this.errorFree=!0,this.ev=a.V.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:i.C.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new f,this.cells=new Map,this.spine=new L.P.Impl(this.cells),this.tryGetCellData=se=>{var ae,ge;const Ie=null===(ge=null===(ae=this.cells.get(se))||void 0===ae?void 0:ae.obj)||void 0===ge?void 0:ge.data;if(void 0===Ie)throw new Error(`Cell '${se}' data undefined.`);return Ie},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new Q,this._tree=u.createEmpty(i.C.createRoot(re&&re.rootState)).asTransient();const ce=this._tree.root;this.runTask=re.runTask,void 0!==re?.historyCapacity&&(this.historyCapacity=re.historyCapacity),this.cells.set(ce.ref,{parent:this,transform:ce,sourceRef:void 0,obj:ue,status:"ok",state:{...ce.state},errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:ce.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=re&&re.globalContext}}!function(ie){let re;ie.create=function ue(ve,ce){return new ie(ve,ce)},(re=ie.ObjectEvent||(ie.ObjectEvent={})).isCell=function ce(se,ae){return!!ae&&se.ref===ae.transform.ref&&se.state===ae.parent}}(V||(V={}));const U={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function k(){return k=(0,d.A)(function*(ie){let re,ce,ve=[];if(ie.editInfo&&1===ie.editInfo.count&&ie.editInfo.lastUpdate&&ie.editInfo.sourceTree===ie.oldTree)re=[],ce=[ie.editInfo.lastUpdate];else{re=function W(ie){const ue={newTree:ie.tree,cells:ie.cells,deletes:[]};return u.doPostOrder(ie.oldTree,ie.oldTree.root,ue,J),ue.deletes}(ie);const ge=ie.parent.current;let Ie=!1;for(const Le of re)if(Le===ge){Ie=!0;break}if(Ie){const Le=_e(ie.oldTree,ge,re,ie.cells);ie.parent.setCurrent(Le)}for(let Le=re.length-1;Le>=0;Le--){const nt=ie.cells.get(re[Le]);nt&&Oe(nt.transform,nt.obj,nt?.transform.params,nt.cache,ie.parent.globalContext)}for(const Le of re){const nt=ie.cells.get(Le);nt&&(nt.parent=void 0,q(nt));const je=nt&&nt.obj;ie.cells.delete(Le),ve.push(je)}ce=function H(ie,ue){const re={roots:[],cells:ie};return u.doPreOrder(ue,ue.root,re,$),re.roots}(ie.cells,ie.tree)}const se=function g(ie,ue){const re={ctx:ie,visited:new Set,added:[]};for(const ce of ue)u.doPreOrder(ie.tree,ie.tree.transforms.get(ce),re,Y);for(const ce of re.added)ee(ce,ie);let ve;return re.visited.forEach(ce=>{const se=ie.cells.get(ce);for(const ae of se.dependencies.dependentBy)re.visited.has(ae.transform.ref)||(ve||(ve=G.th.create()),G.th.add(ve,ae.transform.ref,ae))}),{added:re.added,dependent:ve?ve.array:void 0}}(ie,ce);for(const ge of se.added)ie.parent.events.cell.created.next({state:ie.parent,ref:ge.transform.ref,cell:ge});for(let ge=0;ge<re.length;ge++){const Ie=re[ge],Le=ie.oldTree.transforms.get(Ie).parent;ie.parent.events.object.removed.next({state:ie.parent,ref:Ie,obj:ve[ge]}),ie.parent.events.cell.removed.next({state:ie.parent,ref:Ie,parent:Le})}if(ve.length&&(ve=[]),se.dependent)for(const ge of se.dependent)ce.push(ge.transform.ref);!function Z(ie,ue){for(const re of ue)u.doPreOrder(ie.tree,ie.tree.transforms.get(re),ie,j)}(ie,ce);for(const ge of ce)yield Be(ie,ge);ie.editInfo||function de(ie){u.doPreOrder(ie.tree,ie.tree.root,ie,te)}(ie);let ae=ie.newCurrent;for(const ge of ie.results)"created"===ge.action?(ie.parent.events.object.created.next({state:ie.parent,ref:ge.ref,obj:ge.obj}),ie.newCurrent||!ie.tree.transforms.get(ge.ref).state.isGhost&&ge.obj!==o.Null&&(ae=ge.ref)):"updated"===ge.action?ie.parent.events.object.updated.next({state:ie.parent,ref:ge.ref,action:"in-place",obj:ge.obj,oldData:ge.oldData}):"replaced"===ge.action&&ie.parent.events.object.updated.next({state:ie.parent,ref:ge.ref,action:"recreate",obj:ge.obj,oldObj:ge.oldObj});if(ae)ie.options.doNotUpdateCurrent||ie.parent.setCurrent(ae);else{const ge=ie.parent.current,Ie=ie.cells.get(ge);Ie&&(Ie.obj===o.Null||"error"===Ie.status&&Ie.errorText===Ae)&&(ae=_e(ie.oldTree,ge,[],ie.cells),ie.parent.setCurrent(ae))}return re.length>0||ce.length>0||ie.changed}),k.apply(this,arguments)}function $(ie,ue,re){const ve=re.cells.get(ie.ref);return ve&&ve.transform.version===ie.version?!("error"===ve.status||ve&&ve.obj===o.Null):(re.roots.push(ie.ref),!1)}function J(ie,ue,re){!re.newTree.transforms.has(ie.ref)&&re.cells.has(ie.ref)&&re.deletes.push(ie.ref)}function te(ie,ue,re){const ve=re.cells.get(ie.ref);!ve||!i.C.syncState(ve.state,ie.state)||re.parent.events.cell.stateUpdated.next({state:re.parent,ref:ie.ref,cell:ve})}function ye(ie,ue,re,ve){const ce=ie.cells.get(ue),se=ce.status!==re;ce.status=re,ce.errorText=ve,se&&ie.parent.events.cell.stateUpdated.next({state:ie.parent,ref:ue,cell:ce})}function j(ie,ue,re){re.cells.get(ie.ref).transform=ie,ye(re,ie.ref,"pending")}function q(ie){for(const ue of ie.dependencies.dependsOn)(0,O.K3)(ue.dependencies.dependentBy,ie)}function Y(ie,ue,{ctx:re,added:ve,visited:ce}){if(ce.add(ie.ref),re.cells.has(ie.ref))return;const se={parent:re.parent,transform:ie,sourceRef:void 0,status:"pending",state:{...ie.state},errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};re.cells.set(ie.ref,se),ve.push(se)}function ee(ie,ue){if(ie.transform.dependsOn)for(const re of ie.transform.dependsOn){if(!ue.tree.transforms.get(re))throw new Error("Cannot depend on a non-existent transform.");const ce=ue.cells.get(re);(0,O.Z2)(ie.dependencies.dependsOn,ce),(0,O.Z2)(ce.dependencies.dependentBy,ie)}}function _e(ie,ue,re,ve){return xe(ie,ue,new Set(re),ve)}function xe(ie,ue,re,ve){if(ue===i.C.RootRef)return ue;const ce=ie.transforms.get(ue),se=ie.children.get(ce.parent).values();let ae,ge=!1;for(;;){const Ie=se.next();if(Ie.done)break;if(re.has(Ie.value))continue;const Le=ve.get(Ie.value);if(!Le||"error"===Le.status||Le.obj===o.Null)continue;const nt=ie.transforms.get(Ie.value);if(!nt.state.isGhost){if(Ie.value===ue){ge=!0,re.has(ue)||(ae=ue);continue}if(ge)return nt.ref;ae=nt.ref}}return ae||xe(ie,ce.parent,re,ve)}function le(ie,ue,re,ve){ve||(ie.hadError=!0,ie.parent.errorFree=!1);const ce=ie.cells.get(ue);if(re){ie.wasAborted=ie.wasAborted||C.YZ.isAbort(re);const ae=""+re;ye(ie,ue,"error",ae),ve||ie.parent.events.log.next({type:"error",timestamp:new Date,message:ae})}else ce.params=void 0;if(ce.obj){const ae=ce.obj;ce.obj=void 0,ce.cache=void 0,ie.parent.events.object.removed.next({state:ie.parent,ref:ue,obj:ae})}const se=ie.tree.children.get(ue).values();for(;;){const ae=se.next();if(ae.done)return;le(ie,ae.value,void 0,ve)}}const Ae="Parent is null";function Be(ie,ue){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,d.A)(function*(ie,ue){ye(ie,ue,"processing");let re=!1;try{const ce=(0,E.t)(),se=yield function ke(ie,ue){return we.apply(this,arguments)}(ie,ue),ae=(0,E.t)()-ce;"none"!==se.action&&(ie.changed=!0),ye(ie,ue,"ok"),ie.results.push(se),"created"===se.action?(re=se.obj===o.Null,!re&&!ie.options.doNotLogTiming&&ie.parent.events.log.next(p.x.info(`Created ${se.obj.label} in ${(0,E.H)(ae)}.`))):("updated"===se.action||"replaced"===se.action)&&(re=se.obj===o.Null,!re&&!ie.options.doNotLogTiming&&ie.parent.events.log.next(p.x.info(`Updated ${se.obj.label} in ${(0,E.H)(ae)}.`)))}catch(ce){return ie.changed=!0,ie.hadError||(ie.newCurrent=ue),le(ie,ue,ce,!1),void console.error(ce)}const ve=ie.tree.children.get(ue).values();for(;;){const ce=ve.next();if(ce.done)return;re?le(ie,ce.value,void 0,!0):yield Be(ie,ce.value)}}),Ce.apply(this,arguments)}function we(){return we=(0,d.A)(function*(ie,ue){var re;const{oldTree:ve,tree:ce}=ie,se=ie.cells.get(ue),ae=se.transform;if(se.transform.ref===i.C.RootRef)return{action:"none"};const ge=ie.cells.get(se.transform.parent);if(ge?.obj===o.Null)return se.sourceRef=ge.transform.ref,ve.transforms.has(ue)&&se.params?(Oe(ae,se.obj,se.params.values,se.cache,ie.parent.globalContext),se.params=void 0,se.obj=o.Null,{ref:ue,action:"updated",obj:se.obj}):(se.params=void 0,{ref:ue,action:"created",obj:o.Null});const Le=0===ae.transformer.definition.from.length?ge:h.findAncestorOfType(ce,ie.cells,ue,ae.transformer.definition.from);if(!Le)throw new Error(`No suitable parent found for '${ue}'`);ie.spine.current=se;const nt=Le.obj;se.sourceRef=Le.transform.ref;const je=function Re(ie,ue,re,ve){const ce=ue.transformer.definition.params,se=ce?ce(re,ie.parent.globalContext):{};if(ve.paramsNormalizedVersion!==ue.version)ue.params=T.t.normalizeParams(se,ue.params,"all"),ve.paramsNormalizedVersion=ue.version;else{const ae=T.t.getDefaultValues(se);ue.params=ue.params?(0,v.JW)(ue.params,ae):ae}return T.t.resolveRefs(se,ue.params,ie.getCellData),{definition:se,values:ue.params}}(ie,ae,nt,se);if(!ve.transforms.has(ue)||!se.params){se.params=je;const Lt=yield K(ie,se,ae.transformer,nt,je.values);return Se(Lt,ae),se.obj=Lt,{ref:ue,action:"created",obj:Lt}}{const Lt=se.params.values,Je=se.cache,en=null===(re=se.obj)||void 0===re?void 0:re.data,Bt=je.values;switch(se.params=je,se.obj&&se.obj!==o.Null?yield function ne(ie,ue,re,ve,ce,se,ae){return be.apply(this,arguments)}(ie,se,ae.transformer,nt,se.obj,Lt,Bt):s.x.UpdateResult.Recreate){case s.x.UpdateResult.Recreate:{const $e=se.obj;Oe(ae,$e,Lt,Je,ie.parent.globalContext);const mt=yield K(ie,se,ae.transformer,nt,Bt);return Se(mt,ae),se.obj=mt,{ref:ue,action:"replaced",oldObj:$e,obj:mt}}case s.x.UpdateResult.Updated:return Se(se.obj,ae),{ref:ue,action:"updated",oldData:en,obj:se.obj};case s.x.UpdateResult.Null:return Oe(ae,se.obj,Lt,Je,ie.parent.globalContext),se.obj=o.Null,{ref:ue,action:"updated",obj:se.obj};default:return{action:"none"}}}}),we.apply(this,arguments)}function Oe(ie,ue,re,ve,ce){var se,ae;null===(ae=(se=ie.transformer.definition).dispose)||void 0===ae||ae.call(se,{b:ue!==o.Null?ue:void 0,params:re,cache:ve},ce)}function Se(ie,ue){!ie||ie===o.Null||(ie.tags=ue.tags)}function Ve(ie,ue){return"function"==typeof ie.runInContext?ie.runInContext(ue):ie}function Ne(ie){if(0===ie.dependencies.dependsOn.length)return;const ue=Object.create(null);for(const re of ie.dependencies.dependsOn){if(!re.obj)throw new Error("Unresolved dependency.");ue[re.transform.ref]=re.obj}return ue}function K(ie,ue,re,ve,ce){return ue.cache||(ue.cache=Object.create(null)),Ve(re.definition.apply({a:ve,params:ce,cache:ue.cache,spine:ie.spine,dependencies:Ne(ue)},ie.parent.globalContext),ie.taskCtx)}function be(){return be=(0,d.A)(function*(ie,ue,re,ve,ce,se,ae){return re.definition.update?(ue.cache||(ue.cache=Object.create(null)),Ve(re.definition.update({a:ve,oldParams:se,b:ce,newParams:ae,cache:ue.cache,spine:ie.spine,dependencies:Ne(ue)},ie.parent.globalContext),ie.taskCtx)):s.x.UpdateResult.Recreate}),be.apply(this,arguments)}var Te=n(4829)},2907:(tn,Ue,n)=>{"use strict";n.d(Ue,{C:()=>r});var r,e=n(8384),o=n(9909);!function(t){function v(C,h,a,S){const D=S&&S.ref?S.ref:o.kk.create22();let R;return S&&S.tags&&(R="string"==typeof S.tags?[S.tags]:S.tags,0===R.length?R=void 0:R.sort()),{parent:C,transformer:h,state:S?.state||{},tags:R,ref:D,dependsOn:S&&S.dependsOn,params:a,version:o.kk.create22()}}function l(C,h){return!!C.tags&&C.tags.indexOf(h)>=0}function u(C){return C}t.RootRef="-=root=-",t.areStatesEqual=function A(C,h){return!!C.isHidden!=!!h.isHidden||!!C.isCollapsed!=!!h.isCollapsed||!!C.isGhost!=!!h.isGhost||!!C.isLocked!=!!h.isLocked},t.isStateChange=function y(C,h){return!!h&&(typeof h.isCollapsed<"u"&&C.isCollapsed!==h.isCollapsed||typeof h.isHidden<"u"&&C.isHidden!==h.isHidden||typeof h.isGhost<"u"&&C.isGhost!==h.isGhost||typeof h.isLocked<"u"&&C.isLocked!==h.isLocked)},t.assignState=function c(C,h){if(!h)return!1;let a=!1;for(const S of Object.keys(h)){const D=h[S];!!D!=!!C[S]&&(a=!0,C[S]=D)}return a},t.syncState=function i(C,h){if(!h)return!1;let a=!1;for(const S of Object.keys(h)){const D=h[S];!!D!=!!C[S]&&(a=!0,void 0!==D?C[S]=D:delete C[S])}for(const S of Object.keys(C)){const D=h[S];!!D!=!!C[S]&&(a=!0,void 0!==D?C[S]=D:delete C[S])}return a},t.create=v,t.withParams=function O(C,h){return{...C,params:h,version:o.kk.create22()}},t.withState=function b(C,h){return h?{...C,state:{...C.state,...h}}:C},t.withTags=function _(C,h){let a;return h&&(a="string"==typeof h?[h]:h,0===a.length?a=void 0:a.sort()),{...C,tags:a,version:o.kk.create22()}},t.withParent=function M(C,h){return{...C,parent:h,version:o.kk.create22()}},t.createRoot=function I(C){return v(t.RootRef,e.x.ROOT,{},{ref:t.RootRef,state:C})},t.hasTag=l,t.hasTags=function m(C,h){if(!C.tags)return"string"!=typeof h&&0===h.length;if("string"==typeof h)return l(C,h);for(const a of h)if(C.tags.indexOf(a)<0)return!1;return!0},t.toJSON=function d(C){const h=C.transformer.definition.customSerialization?C.transformer.definition.customSerialization.toJSON:u;let a;for(const S of Object.keys(C.state))C.state[S]&&(a||(a={}),a[S]=!0);return{parent:C.parent,transformer:C.transformer.id,params:C.params?h(C.params):void 0,state:a,tags:C.tags,ref:C.ref,dependsOn:C.dependsOn,version:C.version}},t.fromJSON=function s(C){const h=e.x.get(C.transformer);return{parent:C.parent,transformer:h,params:C.params?(h.definition.customSerialization?h.definition.customSerialization.fromJSON:u)(C.params):void 0,state:C.state||{},tags:C.tags,ref:C.ref,dependsOn:C.dependsOn,version:C.version}}}(r||(r={}))},8384:(tn,Ue,n)=>{"use strict";n.d(Ue,{x:()=>A});var A,e=n(2907),o=n(8277),r=n(4829),t=n(7785);!function(y){let v;var h;y.getParamDefinition=function c(h,a,S){return h.definition.params?h.definition.params(a,S):{}},y.is=function i(h){return!!h&&"function"==typeof h.toAction&&"function"==typeof h.apply},(h=v=y.UpdateResult||(y.UpdateResult={}))[h.Unchanged=0]="Unchanged",h[h.Updated=1]="Updated",h[h.Recreate=2]="Recreate",h[h.Null=3]="Null";const O=new Map,b=new Map;function m(h,a){const{name:S}=a,D=`${h}.${S}`;if(O.has(D))throw new Error(`A transform with id '${S}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`);const R={apply:(f,p,E)=>e.C.create(f,R,p,E),toAction:()=>r.K.fromTransformer(R),namespace:h,id:D,definition:a,createDefaultParams:(f,p)=>a.params?o.t.getDefaultValues(a.params(f,p)):{}};return O.set(D,R),function _(h){for(const a of h.definition.from)b.has(a.type)?b.get(a.type).push(h):b.set(a.type,[h])}(R),R}let s;y.getAll=function M(){return Array.from(O.values())},y.get=function I(h){const a=O.get(h);if(!a)throw new Error(`A transformer with signature '${h}' is not registered.`);return a},y.fromType=function l(h){return b.get(h)||[]},y.create=m,y.factory=function u(h){return a=>m(h,a)},y.builderFactory=function d(h){return s.build(h)},function(h){h.build=function S(D){return R=>function a(D,R){return f=>m(D,{name:R.name,from:R.from instanceof Array?R.from:[R.from],to:R.to instanceof Array?R.to:[R.to],display:"string"==typeof R.display?{name:R.display}:R.display?R.display:{name:(0,t.ZH)(R.name.replace(/[-]/g," "))},params:"object"==typeof R.params?()=>R.params:R.params?R.params:void 0,isDecorator:R.isDecorator,...f})}(D,R)}}(s=y.Builder||(y.Builder={})),y.build=function C(h){return s.build(h)},y.ROOT=m("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply(){throw new Error("should never be applied")},update:()=>v.Unchanged})}(A||(A={}))},6323:(tn,Ue,n)=>{"use strict";n.d(Ue,{P:()=>o});var o,r,e=n(2907);(r=o||(o={})).Impl=class t{get current(){return this._current}set current(i){this._current=i}getAncestorOfType(i){if(!this._current)return;let v=this._current;for(;;){if(v=this.cells.get(v.transform.parent),!v.obj)return;if(v.obj.type===i.type)return v.obj;if(v.transform.ref===e.C.RootRef)return}}getRootOfType(i){if(!this._current)return;let O,v=this._current;for(;;){if(!v.obj)return;if(v.obj.type===i.type&&(O=v),v.transform.ref===e.C.RootRef)return O?O.obj:void 0;v=this.cells.get(v.transform.parent)}}constructor(i){this.cells=i,this._current=void 0}},r.getDecoratorChain=function A(c,i){const v=c.cells;let O=v.get(i);const b=[O];for(;O?.transform.transformer.definition.isDecorator;)O=v.get(O.transform.parent),b.push(O);return b},r.getRootOfType=function y(c,i,v){let O,b=c.cells.get(v);if(b)for(;;){if(!b.obj)return;if(b.obj.type===i.type&&(O=b),b.transform.ref===e.C.RootRef)return O?O.obj:void 0;b=c.cells.get(b.transform.parent)}}},6241:(tn,Ue,n)=>{"use strict";n.d(Ue,{pm:()=>O,yR:()=>b,hM:()=>v,Vs:()=>_});var e=n(467),o=n(5398),r=n(9854),t=n(5385),A=n(2629);const c=typeof performance<"u"&&!!performance.mark&&performance.measure&&A.g$;var i;function v(R,f,p=250){const E=I(R,f,p);return s(R,new D(E,E.root))}function O(R,f,p=250){const E=I(R,f,p);return new D(E,E.root)}function b(R,f){return s(f,R)}function _(R,f,p){return R.runChild(f,p)}function M(R){return{taskId:R.id,taskName:R.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function I(R,f,p){const E={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:p,lastNotified:(0,r.t)(),observer:f,abortToken:E,taskId:R.id,root:{progress:M(R),children:[]},tryAbort:l(E)}}function l(R){return f=>{R.abortRequested=!0,R.reason=f||R.reason}}function m(R){return{progress:{...R.progress},children:R.children.map(m)}}function u(R){return R.progress.canAbort&&R.children.every(u)}function s(R,f){return C.apply(this,arguments)}function C(){return(C=(0,e.A)(function*(R,f){i.markStart(R),f.node.progress.startedTime=(0,r.t)();try{const p=yield R.f(f);return i.markEnd(R),i.measure(R),f.info.abortToken.abortRequested&&h(f.info),p}catch(p){throw o.Y.isAbort(p)&&(f.isAborted=!0,f.node.children.length>0&&(yield new Promise(E=>{f.onChildrenFinished=E})),R.onAbort&&R.onAbort()),p}})).apply(this,arguments)}function h(R){throw R.abortToken.treeAborted||(R.abortToken.treeAborted=!0,a(R.root),S(R,(0,r.t)())),o.Y.Aborted(R.abortToken.reason)}function a(R){const f=R.progress;f.isIndeterminate=!0,f.canAbort=!1,f.message="Aborting...";for(const p of R.children)a(p)}function S(R,f){R.lastNotified=f;const p=function d(R){return{root:m(R.root),canAbort:u(R.root),requestAbort:R.tryAbort}}(R);R.observer(p)}!function(R){function f(w){return`startTask${w.id}`}function p(w){return`endTask${w.id}`}R.markStart=function E(w){c&&performance.mark(f(w))},R.markEnd=function T(w){c&&performance.mark(p(w))},R.measure=function L(w){c&&performance.measure(`\u2733\ufe0f ${w.name}`,f(w),p(w))}}(i||(i={}));class D{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,h(this.info))}get shouldUpdate(){return this.checkAborted(),(0,r.t)()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(f){if(this.checkAborted(),!f)return;const p=this.node.progress;"string"==typeof f?(p.message=f,p.isIndeterminate=!0):(typeof f.canAbort<"u"&&(p.canAbort=f.canAbort),typeof f.message<"u"&&(p.message=f.message),typeof f.current<"u"&&(p.current=f.current),typeof f.max<"u"&&(p.max=f.max),p.isIndeterminate=typeof p.current>"u"||typeof p.max>"u",typeof f.isIndeterminate<"u"&&(p.isIndeterminate=f.isIndeterminate))}update(f,p){if(this.lastUpdatedTime=(0,r.t)(),this.updateProgress(f),!p)return S(this.info,this.lastUpdatedTime),this.checkAborted(),t._.immediatePromise()}runChild(f,p){var E=this;return(0,e.A)(function*(){E.updateProgress(p);const T={progress:M(f),children:[]},L=E.node.children;L.push(T);const w=new D(E.info,T);try{return yield s(f,w)}catch(Q){if(o.Y.isAbort(Q)&&E.isAborted)return;throw Q}finally{const Q=L.indexOf(T);if(Q>=0){for(let G=Q,V=L.length-1;G<V;G++)L[G]=L[G+1];L.pop()}0===L.length&&E.onChildrenFinished&&E.onChildrenFinished()}})()}constructor(f,p){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=p,this.info=f}}},6095:(tn,Ue,n)=>{"use strict";n.d(Ue,{f:()=>o});const o=new class e{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(t,A){}}},4824:(tn,Ue,n)=>{"use strict";n.d(Ue,{_F:()=>A._,YZ:()=>e.Y,yB:()=>v});var t,e=n(5398);n(6095),function(b){function _(I,l=""){const m=I.progress;if(!I.children.length)return m.isIndeterminate?`${l}${m.taskName}: ${m.message}`:`${l}${m.taskName}: [${m.current}/${m.max}] ${m.message}`;const u=l+"  |_ ",d=I.children.map(s=>_(s,u));return m.isIndeterminate?`${l}${m.taskName}: ${m.message}\n${d.join("\n")}`:`${l}${m.taskName}: [${m.current}/${m.max}] ${m.message}\n${d.join("\n")}`}b.format=function M(I){return _(I.root)}}(t||(t={}));var A=n(5385),c=n(467),i=n(9854);function v(b,_,M,I,l){return O.apply(this,arguments)}function O(){return(O=(0,c.A)(function*(b,_,M,I,l){let m=Math.max(_,0),u=0,d=0;if(b.isSynchronous)return I(Number.MAX_SAFE_INTEGER,M),M;let s=(0,i.t)(),C=0,h=0;for(;(C=I(m,M))>0;){u+=C;const a=(0,i.t)()-s;h+=a,d+=a,b.shouldUpdate&&(yield l(b,M,u),m=Math.round(h*u/d)+1,s=(0,i.t)(),h=0)}return b.shouldUpdate&&(yield l(b,M,u)),M})).apply(this,arguments)}},5398:(tn,Ue,n)=>{"use strict";n.d(Ue,{Y:()=>A});var A,e=n(467),o=n(6241),r=n(6095),t=n(7778);!function(y){class c{run(d,s=250){return d?(0,o.hM)(this,d,s):this.f(r.f)}runAsChild(d,s){return d.isSynchronous?this.f(r.f):(0,o.Vs)(d,this,s)}runInContext(d){return d.isSynchronous?this.f(r.f):(0,o.yR)(d,this)}constructor(d,s,C){this.name=d,this.f=s,this.onAbort=C,this.id=m()}}function i(u){return!!u&&"number"==typeof u.id&&"string"==typeof u.name&&!!u.run}function b(u,d,s){return new c(u,d,s)}y.is=i,y.isAbort=function v(u){return!!u&&!!u.isAborted},y.Aborted=function O(u){return{isAborted:!0,reason:u,toString:()=>"Aborted"+(u?": "+u:"")}},y.create=b,y.constant=function _(u,d){return b(u,function(){var s=(0,e.A)(function*(C){return d});return function(C){return s.apply(this,arguments)}}())},y.empty=function M(){return b("",function(){var u=(0,e.A)(function*(d){});return function(d){return u.apply(this,arguments)}}())},y.fail=function I(u,d){return b(u,function(){var s=(0,e.A)(function*(C){throw new Error(d)});return function(C){return s.apply(this,arguments)}}())},y.resolveInContext=function l(u,d){return i(u)?d?u.runInContext(d):u.run():u};const m=(0,t.q)(0,1073741823)}(A||(A={}))},5385:(tn,Ue,n)=>{"use strict";n.d(Ue,{_:()=>t});const o=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(A,...y)=>window.setImmediate(A,...y),clearImmediate:A=>window.clearImmediate(A)}:{setImmediate,clearImmediate}:function e(){const A=function(){const C=typeof window<"u"&&window,h=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return C||typeof global<"u"&&global||h}(),y={},c=typeof document<"u"?document:void 0;let v,i=1;function b(C){delete y[C]}function M(C){const h=y[C];b(C),function _(C){const h=C.callback,a=C.args;switch(a.length){case 0:h();break;case 1:h(a[0]);break;case 2:h(a[0],a[1]);break;case 3:h(a[0],a[1],a[2]);break;default:h.apply(void 0,a)}}(h)}return typeof process<"u"&&"[object process]"==={}.toString.call(process)?function I(){v=function(C){process.nextTick(function(){M(C)})}}():function l(){if(A&&A.postMessage&&!A.importScripts){let C=!0;const h=A.onmessage;return A.onmessage=function(){C=!1},A.postMessage("","*"),A.onmessage=h,C}}()?function m(){const C="setImmediate$"+Math.random()+"$",h=function(a){a.source===A&&"string"==typeof a.data&&0===a.data.indexOf(C)&&M(+a.data.slice(C.length))};window.addEventListener?window.addEventListener("message",h,!1):window.attachEvent("onmessage",h),v=function(a){window.postMessage(C+a,"*")}}():typeof MessageChannel<"u"?function u(){const C=new MessageChannel;C.port1.onmessage=function(h){M(h.data)},v=function(h){C.port2.postMessage(h)}}():c&&"onreadystatechange"in c.createElement("script")?function d(){const C=c.documentElement;v=function(h){let a=c.createElement("script");a.onreadystatechange=function(){M(h),a.onreadystatechange=null,C.removeChild(a),a=null},C.appendChild(a)}}():function s(){v=function(C){setTimeout(M,0,C)}}(),{setImmediate:function O(C,...h){return"function"!=typeof C&&(C=new Function(""+C)),y[i]={callback:C,args:h},v(i),i++},clearImmediate:b}}();function r(A){o.setImmediate(A)}const t={setImmediate:o.setImmediate,clearImmediate:o.clearImmediate,immediatePromise:()=>new Promise(r),delay:(A,y=void 0)=>new Promise(c=>setTimeout(c,A,y))}},7981:(tn,Ue,n)=>{"use strict";n.d(Ue,{l:()=>A});var e=n(3246),o=n(9136),r=n(9498),t=n(9455);function A(y,c){return{kind:y,layers:c}}!function(y){let c;function v(m){return 0===m.layers.length}y.Empty={kind:"empty-loci",layers:[]},function(m){let u;var S;function C(S){switch(S){case"one":return u.One;case"two":return u.Two;case"three":return u.Three;case"four":return u.Four;case"five":return u.Five;case"six":return u.Six}}m.is=t.N.has,(S=u=m.Flag||(m.Flag={}))[S.None=0]="None",S[S.One=1]="One",S[S.Two=2]="Two",S[S.Three=4]="Three",S[S.Four=8]="Four",S[S.Five=16]="Five",S[S.Six=32]="Six",m.create=function d(S){return t.N.create(S)},m.Names={one:u.One,two:u.Two,three:u.Three,four:u.Four,five:u.Five,six:u.Six},m.isName=function s(S){return S in m.Names},m.fromName=C,m.fromNames=function h(S){let D=u.None;for(let R=0,f=S.length;R<f;++R)D|=C(S[R]);return D},m.toNames=function a(S){const D=[];return m.is(S,u.One)&&D.push("one"),m.is(S,u.Two)&&D.push("two"),m.is(S,u.Three)&&D.push("three"),m.is(S,u.Four)&&D.push("four"),m.is(S,u.Five)&&D.push("five"),m.is(S,u.Six)&&D.push("six"),D}}(c=y.Groups||(y.Groups={})),y.areEqual=function i(m,u){if(m.layers.length!==u.layers.length)return!1;for(let d=0,s=m.layers.length;d<s;++d)if(m.layers[d].groups!==u.layers[d].groups||!e.QN.areEqual(m.layers[d].loci,u.layers[d].loci))return!1;return!0},y.isEmpty=v,y.remap=function O(m,u){if("element-loci"===m.kind){const d=[];for(const s of m.layers){let{loci:C,groups:h}=s;C=o.iZ.Loci.remap(C,u),o.iZ.Loci.isEmpty(C)||d.push({loci:C,groups:h})}return{kind:"element-loci",layers:d}}return m},y.merge=function b(m){if(v(m))return m;if("element-loci"===m.kind){const{structure:u}=m.layers[0].loci,d=new Map;let s=o.iZ.Loci.none(u);for(let h=0,a=m.layers.length;h<a;++h){let{loci:S,groups:D}=m.layers[a-h-1];S=o.iZ.Loci.subtract(S,s),s=o.iZ.Loci.union(S,s),o.iZ.Loci.isEmpty(S)||(d.has(D)&&(S=o.iZ.Loci.union(S,d.get(D))),d.set(D,S))}const C=[];return d.forEach((h,a)=>{C.push({loci:h,groups:a})}),{kind:"element-loci",layers:C}}return m},y.filter=function _(m,u){if(v(m))return m;if("element-loci"===m.kind){const{structure:d}=m.layers[0].loci,s=[];for(const C of m.layers){let{loci:h,groups:a}=C;const S=o.iZ.Loci.remap(h,u);h=o.iZ.Loci.remap(S,d),o.iZ.Loci.isEmpty(h)||s.push({loci:h,groups:a})}return{kind:"element-loci",layers:s}}return m},y.ofScript=function M(m,u){const d=[];for(let s=0,C=m.length;s<C;++s){const{script:h,groups:a}=m[s],S=r.e.toLoci(h,u);o.iZ.Loci.isEmpty(S)||d.push({loci:S,groups:a})}return{kind:"element-loci",layers:d}},y.ofBundle=function I(m,u){const d=[];for(let s=0,C=m.length;s<C;++s){const{bundle:h,groups:a}=m[s],S=o.iZ.Bundle.toLoci(h,u.root);d.push({loci:S,groups:a})}return{kind:"element-loci",layers:d}},y.toBundle=function l(m){const u=[];for(let d=0,s=m.layers.length;d<s;++d){const{loci:C,groups:h}=m.layers[d],a=o.iZ.Bundle.fromLoci(C);u.push({bundle:a,groups:h})}return{kind:"element-loci",layers:u}}}(A||(A={}))},274:(tn,Ue,n)=>{"use strict";n.d(Ue,{J:()=>Vi});var e=n(190),o=n(9136),r=n(442),t=n(8277),A=n(2293),y=n(9983);const c=(0,e.Q1)(13421772),v={},_={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:y.N.Residue,factory:function b(ln,Ht){let Gn;if(ln.structure){const{elements:ar,getElementIndices:kn}=ln.structure.carbohydrates,ur=(sr,Jn)=>{if(!o.Nf.isAtomic(sr))return c;const Br=kn(sr,Jn);return Br.length>0?ar[Br[0]].component.color:c};Gn=(sr,Jn)=>Jn?r.G7.Secondary:o.iZ.Location.is(sr)?ur(sr.unit,sr.element):o.gn.isLocation(sr)?ur(sr.aUnit,sr.aUnit.elements[sr.aIndex]):c}else Gn=()=>c;return{factory:b,granularity:"group",color:Gn,props:Ht,description:"Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",legend:(0,A.h)(r.dV)}},getParams:function O(ln){return v},defaultValues:t.t.getDefaultValues(v),isApplicable:ln=>!!ln.structure&&ln.structure.models.some(Ht=>o.Kx.hasCarbohydrate(Ht))};var M=n(9347),I=n(9909),l=n(1930),m=n(8742),u=n(3543),d=n(7809);const s=(0,e.Q1)(13421772),h={...(0,d.U)({type:"colors",colorList:"red-yellow-blue"})},D={name:"element-index",label:"Element Index",category:y.N.Atom,factory:function S(ln,Ht){let Gn,ar;if(ln.structure){const{units:kn}=ln.structure.root,ur=kn.length,sr=new Map,Jn=new Map;let Br=0;for(let et=0;et<ur;++et)sr.set(et,Br),Br+=kn[et].elements.length,Jn.set(kn[et].id,et);const st=(0,d.S)(Br,Ht);ar=st.legend,Gn=et=>{if(o.iZ.Location.is(et)){const at=Jn.get(et.unit.id),Et=u.CD.findPredecessorIndex(kn[at].elements,et.element);return st.color(sr.get(at)+Et)}if(o.gn.isLocation(et)){const at=Jn.get(et.aUnit.id),Et=u.CD.findPredecessorIndex(kn[at].elements,et.aUnit.elements[et.aIndex]);return st.color(sr.get(at)+Et)}return s}}else Gn=()=>s;return{factory:S,granularity:"groupInstance",preferSmoothing:!0,color:Gn,props:Ht,description:"Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",legend:ar}},getParams:function a(ln){return h},defaultValues:t.t.getDefaultValues(h),isApplicable:ln=>!!ln.structure};var R=n(3057),f=n(9359);function p(ln){const Ht={};return(0,f.IF)(ln,(Gn,ar)=>{Ht[ar]=t.t.Color(ln[ar])}),Ht}var E=n(8103);const L=(0,e.Q1)(16448250),w="Gives every chain a color based on its `label_entity_id` value.",Q={...(0,d.U)({type:"colors",colorList:"many-distinct"})};function V(ln,Ht){return`${ln}|${Ht}`}function N(ln){switch(ln.unit.kind){case 0:return o.StructureProperties.chain.label_entity_id(ln);case 1:case 2:return o.StructureProperties.coarse.entity_id(ln)}}function k(ln,Ht){let Gn,ar;if(ln.structure){const kn=o.iZ.Location.create(ln.structure.root),ur=function U(ln){const Ht=new Map;for(let Gn=0,ar=ln.models.length;Gn<ar;++Gn){const{label_entity_id:kn}=ln.models[Gn].atomicHierarchy.chains;for(let sr=0,Jn=kn.rowCount;sr<Jn;++sr){const Br=V(kn.value(sr),Gn);Ht.has(Br)||Ht.set(Br,Ht.size)}const{coarseHierarchy:ur}=ln.models[Gn];if(ur.isDefined){const{entity_id:sr}=ur.spheres;for(let Br=0,st=sr.rowCount;Br<st;++Br){const et=V(sr.value(Br),Gn);Ht.has(et)||Ht.set(et,Ht.size)}const{entity_id:Jn}=ur.gaussians;for(let Br=0,st=Jn.rowCount;Br<st;++Br){const et=V(Jn.value(Br),Gn);Ht.has(et)||Ht.set(et,Ht.size)}}}return Ht}(ln.structure.root),sr=Array.from(ur.keys()),Br=(0,d.S)(ur.size,Ht,{valueLabel:st=>sr[st]});ar=Br.legend,Gn=st=>{let et;if(o.iZ.Location.is(st)){const Nt=V(N(st),st.structure.models.indexOf(st.unit.model));et=ur.get(Nt)}else if(o.gn.isLocation(st)){kn.unit=st.aUnit,kn.element=st.aUnit.elements[st.aIndex];const Nt=V(N(kn),kn.structure.models.indexOf(kn.unit.model));et=ur.get(Nt)}return void 0===et?L:Br.color(et)}}else Gn=()=>L;return{factory:k,granularity:"group",color:Gn,props:Ht,description:w,legend:ar}}const H={name:"entity-id",label:"Entity Id",category:y.N.Chain,factory:k,getParams:function G(ln){return t.t.clone(Q)},defaultValues:t.t.getDefaultValues(Q),isApplicable:ln=>!!ln.structure};var $=n(1372),J=n(229),W=n(1907),te=n(2524);const de="dark-2",ye=(0,e.Q1)(16448250),j="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",Z={...(0,d.U)({type:"colors",colorList:de})};function Y(ln,Ht){return`${ln}|${Ht}`}function ee(ln,Ht,Gn,ar,kn,ur){return`${ln}|${Ht}|${Gn}|${ur||kn||ar}`}function g(ln,Ht,Gn,ar,kn,ur,sr,Jn){const{entity_id:Br,pdbx_src_id:st,pdbx_beg_seq_num:et,pdbx_end_seq_num:at}=kn;for(let Et=0,Nt=kn._rowCount;Et<Nt;++Et){const qt=Br.value(Et),Cn=Y(Gn,qt);let Un;if(ln.has(Cn))Un=ln.get(Cn);else{const qo=ar.entities.getEntityIndex(qt);Un=new Int16Array(ar.sequence.sequences[qo].sequence.length),ln.set(Cn,Un)}const vn=sr?sr.value(Et):"",nr=Jn?Jn.value(Et)[0]:"",pr=ee(Gn,qt,ur.value(Et),st.value(Et),vn,nr),Rr=0===et.valueKind(Et)?et.value(Et):1,mo=0===at.valueKind(Et)?at.value(Et):Un.length;let Uo;Ht.has(pr)?Uo=Ht.get(pr):(Uo=Ht.size+1,Ht.set(pr,Uo));for(let qo=Rr,ri=mo;qo<=ri;++qo)Un[qo-1]=Uo}}function _e(ln){const Ht=new Map,Gn=new Map;for(let ar=0,kn=ln.length;ar<kn;++ar){const ur=ln[ar];if(!te.K4.is(ur.sourceData))continue;const{entity_src_gen:sr,entity_src_nat:Jn,pdbx_entity_src_syn:Br}=ur.sourceData.data.db;g(Ht,Gn,ar,ur,sr,sr.pdbx_gene_src_scientific_name,sr.plasmid_name,sr.pdbx_gene_src_gene),g(Ht,Gn,ar,ur,Jn,Jn.pdbx_organism_scientific,Jn.pdbx_plasmid_name),g(Ht,Gn,ar,ur,Br,Br.organism_scientific)}return{seqToSrcByModelEntity:Ht,srcKeySerialMap:Gn}}function le(ln,Ht){let Gn,ar;if(ln.structure){const kn=o.iZ.Location.create(ln.structure),{models:ur}=ln.structure.root,{seqToSrcByModelEntity:sr,srcKeySerialMap:Jn}=_e(ur),Br=function xe(ln){let Ht=0;return Array.from(ln.keys()).map(Gn=>{const ar=Gn.split("|"),kn=ar[2];return`${(0,J.Fq)(ar[3])?"Unnamed "+ ++Ht:ar[3]}${kn?` (${kn})`:""}`})}(Jn),et=(0,d.S)(Jn.size,Ht,{valueLabel:Et=>Br[Et]});ar=et.legend;const at=Et=>{const Cn=Y(ur.indexOf(Et.unit.model),o.StructureProperties.entity.id(Et)),Un=sr.get(Cn);if(Un){const vn=Un[o.StructureProperties.residue.label_seq_id(Et)-1]-1;return-1===vn?ye:et.color(vn)}return ye};Gn=Et=>o.iZ.Location.is(Et)?at(Et):o.gn.isLocation(Et)?(kn.unit=Et.aUnit,kn.element=Et.aUnit.elements[Et.aIndex],at(kn)):ye}else Gn=()=>ye;return{factory:le,granularity:"group",color:Gn,props:Ht,description:j,legend:ar}}const Ae={name:"entity-source",label:"Entity Source",category:y.N.Chain,factory:le,getParams:function q(ln){const Ht=t.t.clone(Z);return ln.structure&&_e(ln.structure.root.models).srcKeySerialMap.size>W.VI[de].list.length&&(Ht.palette.defaultValue.name="colors",Ht.palette.defaultValue.params={...Ht.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,W.JA)(de).list}}),Ht},defaultValues:t.t.getDefaultValues(Z),isApplicable:ln=>!!ln.structure},Be=(0,e.Q1)(13421772),Ce="Gives every model a unique color based on its index.",Re={...(0,d.U)({type:"colors",colorList:"many-distinct"})};function we(ln,Ht){var Gn;let ar,kn;if(ln.structure){const ur=(null!==(Gn=o.Kx.MaxIndex.get(ln.structure.models[0]).value)&&void 0!==Gn?Gn:-1)+1,sr=(0,d.S)(ur,Ht);kn=sr.legend,ar=Jn=>o.iZ.Location.is(Jn)?sr.color(o.Kx.Index.get(Jn.unit.model).value||0):o.gn.isLocation(Jn)?sr.color(o.Kx.Index.get(Jn.aUnit.model).value||0):Be}else ar=()=>Be;return{factory:we,granularity:"instance",color:ar,props:Ht,description:Ce,legend:kn}}const Oe={name:"model-index",label:"Model Index",category:y.N.Chain,factory:we,getParams:function ke(ln){return t.t.clone(Re)},defaultValues:t.t.getDefaultValues(Re),isApplicable:ln=>!!ln.structure&&ln.structure.elementCount>0},Se=(0,e.Q1)(13421772),Ve="Gives every structure a unique color based on its index.",Ne={...(0,d.U)({type:"colors",colorList:"many-distinct"})};function ne(ln,Ht){var Gn;let ar,kn;if(ln.structure){const ur=(null!==(Gn=o.oE.MaxIndex.get(ln.structure).value)&&void 0!==Gn?Gn:-1)+1,sr=(0,d.S)(ur,Ht);kn=sr.legend,ar=Jn=>o.iZ.Location.is(Jn)?sr.color(o.oE.Index.get(Jn.structure).value||0):o.gn.isLocation(Jn)?sr.color(o.oE.Index.get(Jn.aStructure).value||0):Se}else ar=()=>Se;return{factory:ne,granularity:"instance",color:ar,props:Ht,description:Ve,legend:kn}}const be={name:"structure-index",label:"Structure Index",category:y.N.Chain,factory:ne,getParams:function K(ln){return t.t.clone(Ne)},defaultValues:t.t.getDefaultValues(Ne),isApplicable:ln=>!!ln.structure&&ln.structure.elementCount>0},Te="dark-2",ie=(0,e.Q1)(13421772),ue="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",re={...(0,d.U)({type:"colors",colorList:Te})};function ce(ln,Ht){let Gn,ar;if(ln.structure){const{units:kn}=ln.structure.root,ur=(0,d.S)(kn.length,Ht);ar=ur.legend;const sr=new Map;for(let Jn=0,Br=kn.length;Jn<Br;++Jn)sr.set(kn[Jn].id,ur.color(Jn));Gn=Jn=>o.iZ.Location.is(Jn)?sr.get(Jn.unit.id):o.gn.isLocation(Jn)?sr.get(Jn.aUnit.id):ie}else Gn=()=>ie;return{factory:ce,granularity:"instance",color:Gn,props:Ht,description:ue,legend:ar}}const se={name:"unit-index",label:"Chain Instance",category:y.N.Chain,factory:ce,getParams:function ve(ln){const Ht=t.t.clone(re);return ln.structure&&ln.structure.root.units.length>W.VI[Te].list.length&&(Ht.palette.defaultValue.name="colors",Ht.palette.defaultValue.params={...Ht.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,W.JA)(Te).list}}),Ht},defaultValues:t.t.getDefaultValues(re),isApplicable:ln=>!!ln.structure},ae=(0,e._j)({H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215}),ge=(0,e.Q1)(16777215),Le={carbonColor:t.t.MappedStatic("chain-id",{"chain-id":t.t.Group(m.t4),"unit-index":t.t.Group(re,{label:"Chain Instance"}),"entity-id":t.t.Group(Q),"entity-source":t.t.Group(Z),"operator-name":t.t.Group(E.qg),"model-index":t.t.Group(Re),"structure-index":t.t.Group(Ne),uniform:t.t.Group(M.vz),"element-symbol":t.t.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:t.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:t.t.Numeric(.2,{min:-6,max:6,step:.1}),colors:t.t.MappedStatic("default",{default:t.t.EmptyGroup(),custom:t.t.Group(p(ae))})};function Je(ln,Ht){var Gn;const ar=(0,R.Ak)("default"===Ht.colors.name?ae:Ht.colors.params,Ht.saturation,Ht.lightness),kn=null===(Gn=function Lt(ln,Ht){switch(Ht.name){case"chain-id":return(0,m.Zv)(ln,Ht.params);case"unit-index":return ce(ln,Ht.params);case"entity-id":return k(ln,Ht.params);case"entity-source":return le(ln,Ht.params);case"operator-name":return(0,E.ci)(ln,Ht.params);case"model-index":return we(ln,Ht.params);case"structure-index":return ne(ln,Ht.params);case"uniform":return(0,M.TA)(ln,Ht.params);case"element-symbol":return;default:(0,$.dr)(Ht)}}(ln,Ht.carbonColor))||void 0===Gn?void 0:Gn.color;function ur(Br,st){return kn&&"C"===Br?kn(st,!1):function je(ln,Ht){const Gn=ln[Ht];return void 0===Gn?ge:Gn}(ar,Br)}return{factory:Je,granularity:"operator-name"===Ht.carbonColor.name||"unit-index"===Ht.carbonColor.name?"groupInstance":"group",preferSmoothing:!0,color:function sr(Br){if(o.iZ.Location.is(Br)){if(o.Nf.isAtomic(Br.unit)){const{type_symbol:st}=Br.unit.model.atomicHierarchy.atoms;return ur(st.value(Br.element),Br)}}else if(o.gn.isLocation(Br)&&o.Nf.isAtomic(Br.aUnit)){const{type_symbol:st}=Br.aUnit.model.atomicHierarchy.atoms;return ur(st.value(Br.aUnit.elements[Br.aIndex]),Br)}return ge},props:Ht,description:"Assigns a color to every atom according to its chemical element.",legend:(0,A.h)(Object.keys(ar).map(Br=>[Br,ar[Br]]))}}const en={name:"element-symbol",label:"Element Symbol",category:y.N.Atom,factory:Je,getParams:function nt(ln){return t.t.clone(Le)},defaultValues:t.t.getDefaultValues(Le),isApplicable:ln=>!!ln.structure};var Bt=n(2789);const pn=(0,e._j)({water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655}),$e=(0,e.Q1)(16777113),_t={saturation:t.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:t.t.Numeric(0,{min:-6,max:6,step:.1}),colors:t.t.MappedStatic("default",{default:t.t.EmptyGroup(),custom:t.t.Group(p(pn))})};function Ke(ln,Ht,Gn){switch((0,Bt.Ju)(Ht,Gn)){case 2:return ln.water;case 3:return ln.ion;case 5:return ln.protein;case 6:return ln.RNA;case 7:return ln.DNA;case 8:return ln.PNA;case 9:return ln.saccharide}return $e}function ut(ln,Ht){const Gn=(0,R.Ak)("default"===Ht.colors.name?pn:Ht.colors.params,Ht.saturation,Ht.lightness);return{factory:ut,granularity:"group",color:function ar(kn){return o.iZ.Location.is(kn)?Ke(Gn,kn.unit,kn.element):o.gn.isLocation(kn)?Ke(Gn,kn.aUnit,kn.aUnit.elements[kn.aIndex]):$e},props:Ht,description:"Assigns a color based on the molecule type of a residue.",legend:(0,A.h)(Object.keys(Gn).map(kn=>[kn,Gn[kn]]).concat([["Other/unknown",$e]]))}}const Kt={name:"molecule-type",label:"Molecule Type",category:y.N.Residue,factory:ut,getParams:function Me(ln){return _t},defaultValues:t.t.getDefaultValues(_t),isApplicable:ln=>!!ln.structure},sn="dark-2",gt=(0,e.Q1)(16448250),At={...(0,d.U)({type:"colors",colorList:sn})};function rn(ln){switch(ln.kind){case 0:return o.StructureProperties.chain.label_asym_id;case 1:case 2:return o.StructureProperties.coarse.asym_id}}function tt(ln){const Ht=new Map;for(let Gn=0,ar=ln.unitSymmetryGroups.length;Gn<ar;++Gn){const kn=ln.unitSymmetryGroups[Gn].units[0],{model:ur}=kn;if(o.Nf.isAtomic(kn)){const{chainAtomSegments:sr,chains:Jn}=ur.atomicHierarchy,Br=u.hT.transientSegments(sr,kn.elements);for(;Br.hasNext;){const{index:st}=Br.move(),et=Jn.label_entity_id.value(st),at=ur.entities.getEntityIndex(et);if("polymer"===ur.entities.data.type.value(at)){const Et=Jn.label_asym_id.value(st);Ht.has(Et)||Ht.set(Et,Ht.size)}}}else if(o.Nf.isCoarse(kn)){const{chainElementSegments:sr,asym_id:Jn,entity_id:Br}=o.Nf.isSpheres(kn)?ur.coarseHierarchy.spheres:ur.coarseHierarchy.gaussians,st=u.hT.transientSegments(sr,kn.elements);for(;st.hasNext;){const{index:et}=st.move(),at=sr.offsets[et],Et=Br.value(at),Nt=ur.entities.getEntityIndex(Et);if("polymer"===ur.entities.data.type.value(Nt)){const qt=Jn.value(at);Ht.has(qt)||Ht.set(qt,Ht.size)}}}}return Ht}const nn={name:"polymer-id",label:"Polymer Chain Id",category:y.N.Chain,factory:function Mt(ln,Ht){let Gn,ar;if(ln.structure){const kn=o.iZ.Location.create(ln.structure),ur=tt(ln.structure.root),sr=Array.from(ur.keys()),Br=(0,d.S)(ur.size,Ht,{valueLabel:st=>sr[st]});ar=Br.legend,Gn=st=>{let et;if(o.iZ.Location.is(st)){const at=rn(st.unit);et=ur.get(at(st))}else if(o.gn.isLocation(st)){const at=rn(st.aUnit);kn.unit=st.aUnit,kn.element=st.aUnit.elements[st.aIndex],et=ur.get(at(kn))}return void 0===et?gt:Br.color(et)}}else Gn=()=>gt;return{factory:Mt,granularity:"group",color:Gn,props:Ht,description:"Gives every polymer chain a color based on its `asym_id` value.",legend:ar}},getParams:function Gt(ln){const Ht=t.t.clone(At);return ln.structure&&tt(ln.structure.root).size>W.VI[sn].list.length&&(Ht.palette.defaultValue.name="colors",Ht.palette.defaultValue.params={...Ht.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,W.JA)(sn).list}}),Ht},defaultValues:t.t.getDefaultValues(At),isApplicable:ln=>!!ln.structure},bn="dark-2",Dn=(0,e.Q1)(13421772),It={...(0,d.U)({type:"colors",colorList:bn})};function Ct(ln){let Ht=0;const{units:Gn}=ln;for(let ar=0,kn=Gn.length;ar<kn;++ar)Gn[ar].polymerElements.length>0&&++Ht;return Ht}const Vt={name:"polymer-index",label:"Polymer Chain Instance",category:y.N.Chain,factory:function $t(ln,Ht){let Gn,ar;if(ln.structure){const kn=(0,d.S)(Ct(ln.structure.root),Ht);ar=kn.legend;const{units:ur}=ln.structure.root,sr=new Map;for(let Jn=0,Br=0,st=ur.length;Jn<st;++Jn)ur[Jn].polymerElements.length>0&&(sr.set(ur[Jn].id,kn.color(Br)),++Br);Gn=Jn=>{let Br;return o.iZ.Location.is(Jn)?Br=sr.get(Jn.unit.id):o.gn.isLocation(Jn)&&(Br=sr.get(Jn.aUnit.id)),void 0!==Br?Br:Dn}}else Gn=()=>Dn;return{factory:$t,granularity:"instance",color:Gn,props:Ht,description:"Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",legend:ar}},getParams:function Dt(ln){const Ht=t.t.clone(It);return ln.structure&&Ct(ln.structure.root)>W.VI[bn].list.length&&(Ht.palette.defaultValue.name="colors",Ht.palette.defaultValue.params={...Ht.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,W.JA)(bn).list}}),Ht},defaultValues:t.t.getDefaultValues(It),isApplicable:ln=>!!ln.structure},Wt=(0,e._j)({ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945}),yn=(0,e.Q1)(16711935),kt={saturation:t.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:t.t.Numeric(1,{min:-6,max:6,step:.1}),colors:t.t.MappedStatic("default",{default:t.t.EmptyGroup(),custom:t.t.Group(p(Wt))})};function An(ln,Ht){return ln.model.atomicHierarchy.atoms.label_comp_id.value(Ht)}function jn(ln,Ht){const Gn=ln.coarseElements.seq_id_begin.value(Ht);if(Gn===ln.coarseElements.seq_id_end.value(Ht))return ln.model.sequence.byEntityKey[ln.coarseElements.entityKey[Ht]].sequence.compId.value(Gn-1)}function On(ln,Ht){const Gn=ln[Ht];return void 0===Gn?yn:Gn}function fr(ln,Ht){const Gn=(0,R.Ak)("default"===Ht.colors.name?Wt:Ht.colors.params,Ht.saturation,Ht.lightness);return{factory:fr,granularity:"group",preferSmoothing:!0,color:function ar(kn){if(o.iZ.Location.is(kn)){if(o.Nf.isAtomic(kn.unit)){const ur=An(kn.unit,kn.element);return On(Gn,ur)}{const ur=jn(kn.unit,kn.element);if(ur)return On(Gn,ur)}}else if(o.gn.isLocation(kn)){if(o.Nf.isAtomic(kn.aUnit)){const ur=An(kn.aUnit,kn.aUnit.elements[kn.aIndex]);return On(Gn,ur)}{const ur=jn(kn.aUnit,kn.aUnit.elements[kn.aIndex]);if(ur)return On(Gn,ur)}}return yn},props:Ht,description:"Assigns a color to every residue according to its name.",legend:(0,A.h)(Object.keys(Gn).map(kn=>[kn,Gn[kn]]).concat([["Unknown",yn]]))}}const Dr={name:"residue-name",label:"Residue Name",category:y.N.Residue,factory:fr,getParams:function Ot(ln){return kt},defaultValues:t.t.getDefaultValues(kt),isApplicable:ln=>!!ln.structure};var Pr=n(2434),or=n(8699),Nr=n(8382);const Ir=(0,e._j)({alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722}),Or=(0,e.Q1)(8421504),To={saturation:t.t.Numeric(-1,{min:-6,max:6,step:.1}),lightness:t.t.Numeric(0,{min:-6,max:6,step:.1}),colors:t.t.MappedStatic("default",{default:t.t.EmptyGroup(),custom:t.t.Group(p(Ir))})};function ct(ln,Ht,Gn,ar){let kn=Pr.gG.create(0);if(ar&&o.Nf.isAtomic(Ht)){const ur=ar.get(Ht.invariantId);ur&&(kn=ur.type[ur.getIndex(Ht.residueIndex[Gn])])}if(Pr.gG.is(kn,2))return Pr.gG.is(kn,2048)?ln.threeTenHelix:Pr.gG.is(kn,32768)?ln.piHelix:ln.alphaHelix;if(Pr.gG.is(kn,4))return ln.betaStrand;if(Pr.gG.is(kn,8))return ln.bend;if(Pr.gG.is(kn,16))return ln.turn;{const ur=(0,Bt.Ju)(Ht,Gn);if(7===ur)return ln.dna;if(6===ur)return ln.rna;if(9===ur)return ln.carbohydrate;if(5===ur)return ln.coil}return Or}function dt(ln,Ht){const Gn=ln.structure&&or.v.get(ln.structure),ar=Gn?(0,Nr.vb)(Gn.id,Gn.version):-1,kn=(0,R.Ak)("default"===Ht.colors.name?Ir:Ht.colors.params,Ht.saturation,Ht.lightness);return{factory:dt,granularity:"group",preferSmoothing:!0,color:function ur(sr){return o.iZ.Location.is(sr)?ct(kn,sr.unit,sr.element,Gn?.value):o.gn.isLocation(sr)?ct(kn,sr.aUnit,sr.aUnit.elements[sr.aIndex],Gn?.value):Or},props:Ht,contextHash:ar,description:"Assigns a color based on the type of secondary structure and basic molecule type.",legend:(0,A.h)(Object.keys(kn).map(sr=>[sr,kn[sr]]).concat([["Other",Or]]))}}const Yt={name:"secondary-structure",label:"Secondary Structure",category:y.N.Residue,factory:dt,getParams:function un(ln){return To},defaultValues:t.t.getDefaultValues(To),isApplicable:ln=>!!ln.structure,ensureCustomProperties:{attach:(ln,Ht)=>Ht.structure?or.v.attach(ln,Ht.structure,void 0,!0):Promise.resolve(),detach:ln=>ln.structure&&or.v.ref(ln.structure,!1)}},cn=(0,e.Q1)(13421772),Rn={list:t.t.ColorList("turbo",{presetKind:"scale"})};function ir(ln,Ht){const{model:Gn}=ln;switch(ln.kind){case 0:return Gn.atomicHierarchy.residues.label_seq_id.value(Gn.atomicHierarchy.residueAtomSegments.index[Ht]);case 1:return Math.round((Gn.coarseHierarchy.spheres.seq_id_begin.value(Ht)+Gn.coarseHierarchy.spheres.seq_id_end.value(Ht))/2);case 2:return Math.round((Gn.coarseHierarchy.gaussians.seq_id_begin.value(Ht)+Gn.coarseHierarchy.gaussians.seq_id_end.value(Ht))/2)}}function Yn(ln,Ht){const{model:Gn}=ln;let ar="";switch(ln.kind){case 0:ar=Gn.atomicHierarchy.chains.label_entity_id.value(Gn.atomicHierarchy.chainAtomSegments.index[Ht]);break;case 1:ar=Gn.coarseHierarchy.spheres.entity_id.value(Ht);break;case 2:ar=Gn.coarseHierarchy.gaussians.entity_id.value(Ht)}if(""===ar)return 0;const kn=Gn.entities.getEntityIndex(ar);if(-1===kn)return 0;const ur=Gn.sequence.byEntityKey[kn];return void 0===ur?0:ur.sequence.length}const vr={name:"sequence-id",label:"Sequence Id",category:y.N.Residue,factory:function br(ln,Ht){const Gn=e.wC.create({listOrName:Ht.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:br,granularity:"group",preferSmoothing:!0,color:kn=>{if(o.iZ.Location.is(kn)){const{unit:ur,element:sr}=kn,Jn=ir(ur,sr);if(Jn>0){const Br=Yn(ur,sr);if(Br)return Gn.setDomain(0,Br-1),Gn.color(Jn)}}else if(o.gn.isLocation(kn)){const{aUnit:ur,aIndex:sr}=kn,Jn=ir(ur,ur.elements[sr]);if(Jn>0){const Br=Yn(ur,ur.elements[sr]);if(Br)return Gn.setDomain(0,Br-1),Gn.color(Jn)}}return cn},props:Ht,description:"Gives every polymer residue a color based on its `seq_id` value.",legend:Gn?Gn.legend:void 0}},getParams:function er(ln){return Rn},defaultValues:t.t.getDefaultValues(Rn),isApplicable:ln=>!!ln.structure};var Hr=n(2476);const Mr=(0,e.Q1)(16777113),Sr={domain:t.t.Interval([0,100]),list:t.t.ColorList("red-white-blue",{presetKind:"scale"})};function Ro(ln,Ht){return o.Nf.isAtomic(ln)?ln.model.atomicConformation.B_iso_or_equiv.value(Ht):o.Nf.isSpheres(ln)?ln.model.coarseConformation.spheres.rmsf[Ht]:0}const po={name:"uncertainty",label:"Uncertainty/Disorder",category:y.N.Atom,factory:function ro(ln,Ht){const Gn=e.wC.create({reverse:!0,domain:Ht.domain,listOrName:Ht.list.colors});return{factory:ro,granularity:"group",preferSmoothing:!0,color:function ar(kn){return o.iZ.Location.is(kn)?Gn.color(Ro(kn.unit,kn.element)):o.gn.isLocation(kn)?Gn.color(Ro(kn.aUnit,kn.aUnit.elements[kn.aIndex])):Mr},props:Ht,description:"Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",legend:Gn?Gn.legend:void 0}},getParams:function Ur(ln){return Sr},defaultValues:t.t.getDefaultValues(Sr),isApplicable:ln=>!!ln.structure&&ln.structure.models.some(Ht=>Ht.atomicConformation.B_iso_or_equiv.isDefined||Ht.coarseHierarchy.isDefined)},so=(0,e.Q1)(15658734),Bo={style:t.t.MappedStatic("entity-id",{uniform:t.t.Group(M.vz),"chain-id":t.t.Group(m.t4),"entity-id":t.t.Group(Q),"entity-source":t.t.Group(Z),"molecule-type":t.t.Group(_t),"model-index":t.t.Group(Re),"structure-index":t.t.Group(Ne)}),carbonLightness:t.t.Numeric(.8,{min:-6,max:6,step:.1})},Pt={name:"illustrative",label:"Illustrative",category:y.N.Misc,factory:function We(ln,Ht){const{color:Gn,legend:ar}=function Wo(ln,Ht){switch(Ht.name){case"uniform":return(0,M.TA)(ln,Ht.params);case"chain-id":return(0,m.Zv)(ln,Ht.params);case"entity-id":return k(ln,Ht.params);case"entity-source":return le(ln,Ht.params);case"molecule-type":return ut(0,Ht.params);case"model-index":return we(ln,Ht.params);case"structure-index":return ne(ln,Ht.params);default:(0,$.dr)(Ht)}}(ln,Ht.style);function kn(sr,Jn){const Br=Gn(sr,!1);return"C"===Jn?e.Q1.lighten(Br,Ht.carbonLightness):Br}return{factory:We,granularity:"group",preferSmoothing:!0,color:function ur(sr){if(o.iZ.Location.is(sr)&&o.Nf.isAtomic(sr.unit)){const Jn=sr.unit.model.atomicHierarchy.atoms.type_symbol.value(sr.element);return kn(sr,Jn)}if(o.gn.isLocation(sr)&&o.Nf.isAtomic(sr.aUnit)){const Br=sr.aUnit.model.atomicHierarchy.atoms.type_symbol.value(sr.aUnit.elements[sr.aIndex]);return kn(sr,Br)}return so},props:Ht,description:"Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",legend:ar}},getParams:function Go(ln){return t.t.clone(Bo)},defaultValues:t.t.getDefaultValues(Bo),isApplicable:ln=>!!ln.structure},Nn={list:t.t.ColorList("red-yellow-green",{presetKind:"scale"}),scale:t.t.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])},dr={DGwif:0,DGwoct:1,"Oct-IF":2};function Ft(ln,Ht){return ln.model.atomicHierarchy.atoms.label_comp_id.value(Ht)}function Qt(ln,Ht){const Gn=ln.coarseElements.seq_id_begin.value(Ht);if(Gn===ln.coarseElements.seq_id_end.value(Ht))return ln.model.sequence.byEntityKey[ln.coarseElements.entityKey[Ht]].sequence.compId.value(Gn-1)}const pt={name:"hydrophobicity",label:"Hydrophobicity",category:y.N.Residue,factory:function ht(ln,Ht){const Gn=dr[Ht.scale];let ar=1/0,kn=-1/0;for(const Jn in Pr.Xk){const Br=Pr.Xk[Jn][Gn];ar=Math.min(ar,Br),kn=Math.max(kn,Br)}const ur=e.wC.create({listOrName:Ht.list.colors,domain:[kn,ar],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});return{factory:ht,granularity:"group",preferSmoothing:!0,color:function sr(Jn){let Br;return o.iZ.Location.is(Jn)?Br=o.Nf.isAtomic(Jn.unit)?Ft(Jn.unit,Jn.element):Qt(Jn.unit,Jn.element):o.gn.isLocation(Jn)&&(Br=o.Nf.isAtomic(Jn.aUnit)?Ft(Jn.aUnit,Jn.aUnit.elements[Jn.aIndex]):Qt(Jn.aUnit,Jn.aUnit.elements[Jn.aIndex])),ur.color(Br?function xr(ln,Ht){const Gn=Pr.Xk[ln];return void 0===Gn?0:Gn[Ht]}(Br,Gn):0)},props:Ht,description:'Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',legend:ur?ur.legend:void 0}},getParams:function Kn(ln){return Nn},defaultValues:t.t.getDefaultValues(Nn),isApplicable:ln=>!!ln.structure},Xt=(0,e.Q1)(13421772),on={...(0,d.U)({type:"colors",colorList:"purples"})},Fe={name:"trajectory-index",label:"Trajectory Index",category:y.N.Chain,factory:function Tt(ln,Ht){var Gn,ar;let kn,ur;if(ln.structure){const{models:sr}=ln.structure.root;let Jn=0;for(const et of sr)Jn=Math.max(Jn,(null===(Gn=o.Kx.TrajectoryInfo.get(et))||void 0===Gn?void 0:Gn.size)||0);const Br=(0,d.S)(Jn,Ht);ur=Br.legend;const st=new Map;for(let et=0,at=sr.length;et<at;++et){const Et=(null===(ar=o.Kx.TrajectoryInfo.get(sr[et]))||void 0===ar?void 0:ar.index)||0;st.set(Et,Br.color(Et))}kn=et=>o.iZ.Location.is(et)?st.get(o.Kx.TrajectoryInfo.get(et.unit.model).index):o.gn.isLocation(et)?st.get(o.Kx.TrajectoryInfo.get(et.aUnit.model).index):Xt}else kn=()=>Xt;return{factory:Tt,granularity:"instance",color:kn,props:Ht,description:"Gives every model (frame) a unique color based on the index in its trajectory.",legend:ur}},getParams:function En(ln){return t.t.clone(on)},defaultValues:t.t.getDefaultValues(on),isApplicable:ln=>!!ln.structure&&ln.structure.elementCount>0&&o.Kx.TrajectoryInfo.get(ln.structure.models[0]).size>1},He=(0,e.Q1)(13421772),ot={domain:t.t.Interval([0,1]),list:t.t.ColorList("purples",{presetKind:"scale"})};function St(ln,Ht){return o.Nf.isAtomic(ln)?ln.model.atomicConformation.occupancy.value(Ht):0}const mn={name:"occupancy",label:"Occupancy",category:y.N.Atom,factory:function vt(ln,Ht){const Gn=e.wC.create({reverse:!1,domain:Ht.domain,listOrName:Ht.list.colors});return{factory:vt,granularity:"group",preferSmoothing:!0,color:function ar(kn){return o.iZ.Location.is(kn)?Gn.color(St(kn.unit,kn.element)):o.gn.isLocation(kn)?Gn.color(St(kn.aUnit,kn.aUnit.elements[kn.aIndex])):He},props:Ht,description:"Assigns a color based on the occupancy of an atom.",legend:Gn?Gn.legend:void 0}},getParams:function rt(ln){return ot},defaultValues:t.t.getDefaultValues(ot),isApplicable:ln=>!!ln.structure&&ln.structure.models.some(Ht=>Ht.atomicConformation.occupancy.isDefined)};var zt=n(4369);const an="dark-2",Vn=(0,e.Q1)(13421772),rr={...(0,d.U)({type:"colors",colorList:an})},tr=1e4;function Tr(ln){return ln.map(Ht=>`${Ht+tr}`.padStart(5,"0")).join("")}function oo(ln){const Ht=(0,J.bL)(tr,0),Gn=parseInt(ln.substr(0,Ht)),ar=parseInt(ln.substr(Ht,Ht)),kn=parseInt(ln.substr(Ht+Ht,Ht));return zt.eB.create(Gn-tr,ar-tr,kn-tr)}function Gr(ln){return ln.map(Ht=>Ht+5).join("")}function Ao(ln){const Ht=new Map,Gn=new Set;for(let sr=0,Jn=ln.units.length;sr<Jn;++sr){const Br=Tr(ln.units[sr].conformation.operator.hkl);Gn.add(Br)}const ar=Array.from(Gn.values()).sort();return ar.forEach(sr=>Ht.set(sr,Ht.size)),{min:oo(ar[0]),max:oo(ar[ar.length-1]),map:Ht}}const vo={name:"operator-hkl",label:"Operator HKL",category:y.N.Symmetry,factory:function yo(ln,Ht){let Gn,ar;if(ln.structure){const{min:kn,max:ur,map:sr}=Ao(ln.structure.root),Jn=[];sr.forEach((et,at)=>{const Et=et%sr.size,Nt=Gr(oo(at));void 0===Jn[Et]?Jn[Et]=Nt:Jn[Et]+=`, ${Nt}`});const Br={minLabel:Gr(kn),maxLabel:Gr(ur),valueLabel:et=>Jn[et]},st=(0,d.S)(sr.size,Ht,Br);ar=st.legend,Gn=et=>{let at;if(o.iZ.Location.is(et)){const Et=Tr(et.unit.conformation.operator.hkl);at=sr.get(Et)}else if(o.gn.isLocation(et)){const Et=Tr(et.aUnit.conformation.operator.hkl);at=sr.get(Et)}return void 0===at?Vn:st.color(at)}}else Gn=()=>Vn;return{factory:yo,granularity:"instance",color:Gn,props:Ht,description:"Assigns a color based on the operator HKL value of a transformed chain.",legend:ar}},getParams:function Vr(ln){const Ht=t.t.clone(rr);return ln.structure&&Ao(ln.structure.root).map.size>W.VI[an].list.length&&(Ht.palette.defaultValue.name="colors",Ht.palette.defaultValue.params={...Ht.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,W.JA)(an).list}}),Ht},defaultValues:t.t.getDefaultValues(rr),isApplicable:ln=>!!ln.structure};var Kr=n(4366);const Do=(0,e.Q1)(16777113),So={domain:t.t.Interval([-1,1]),list:t.t.ColorList("red-white-blue",{presetKind:"scale"})};function Po(ln,Ht){var Gn;return null===(Gn=Kr.j.Provider.get(ln.model))||void 0===Gn?void 0:Gn.data.value(Ht)}const jr={name:"partial-charge",label:"Partial Charge",category:y.N.Atom,factory:function Yr(ln,Ht){const Gn=e.wC.create({domain:Ht.domain,listOrName:Ht.list.colors});return{factory:Yr,granularity:"group",preferSmoothing:!0,color:function ar(kn){if(o.iZ.Location.is(kn)){const ur=Po(kn.unit,kn.element);return void 0!==ur?Gn.color(ur):Do}if(o.gn.isLocation(kn)){const ur=Po(kn.aUnit,kn.aUnit.elements[kn.aIndex]);return void 0!==ur?Gn.color(ur):Do}return Do},props:Ht,description:"Assigns a color based on the partial charge of an atom.",legend:Gn?Gn.legend:void 0}},getParams:function ao(ln){return So},defaultValues:t.t.getDefaultValues(So),isApplicable:ln=>!!ln.structure&&ln.structure.models.some(Ht=>void 0!==Kr.j.Provider.get(Ht))},Eo=(0,e.Q1)(16448250),ei={...(0,d.U)({type:"colors",colorList:"many-distinct"})},Fi={name:"atom-id",label:"Atom Id",category:y.N.Atom,factory:function Jo(ln,Ht){let Gn,ar;if(ln.structure){const kn=o.iZ.Location.create(ln.structure.root),ur=function ci(ln){const Ht=new Map;for(const Gn of ln.models){const{label_atom_id:ar}=Gn.atomicHierarchy.atoms;for(let kn=0,ur=ar.rowCount;kn<ur;++kn){const sr=ar.value(kn);Ht.has(sr)||Ht.set(sr,Ht.size)}}return Ht}(ln.structure.root),sr=Array.from(ur.keys()),Br=(0,d.S)(ur.size,Ht,{valueLabel:st=>sr[st]});ar=Br.legend,Gn=st=>{let et;if(o.iZ.Location.is(st)){const at=o.StructureProperties.atom.label_atom_id(st);et=ur.get(at)}else if(o.gn.isLocation(st)){kn.unit=st.aUnit,kn.element=st.aUnit.elements[st.aIndex];const at=o.StructureProperties.atom.label_atom_id(kn);et=ur.get(at)}return void 0===et?Eo:Br.color(et)}}else Gn=()=>Eo;return{factory:Jo,granularity:"group",preferSmoothing:!0,color:Gn,props:Ht,description:"Gives every atom a color based on its `label_atom_id` value.",legend:ar}},getParams:function Yo(ln){return t.t.clone(ei)},defaultValues:t.t.getDefaultValues(ei),isApplicable:ln=>!!ln.structure};var hi=n(2745),No=n(3162);const mi={colorList:t.t.ColorList({kind:"interpolate",colors:[[hi.s.white,0],[hi.s.red,.25],[hi.s.white,.5],[hi.s.blue,.75],[hi.s.white,1]]},{offsets:!0,isEssential:!0})},ti={name:"volume-value",label:"Volume Value",category:y.N.Misc,factory:function Oi(ln,Ht){const Gn=e.wC.create({domain:[0,1],listOrName:Ht.colorList.colors}),ar=[];for(let ur=0;ur<256;++ur)ar[ur]=Gn.color(ur/255);return{factory:Oi,granularity:"direct",props:Ht,description:"Assign color based on the given value of a volume cell.",legend:Gn.legend,palette:{colors:ar,filter:"linear"}}},getParams:function qi(ln){return mi},defaultValues:t.t.getDefaultValues(mi),isApplicable:ln=>!!ln.volume&&!No.f.Segmentation.get(ln.volume)},es=(0,e.Q1)(13421772),Pi={...(0,d.U)({type:"colors",colorList:"many-distinct"})},Wi={name:"volume-segment",label:"Volume Segment",category:y.N.Misc,factory:function gi(ln,Ht){let Gn,ar;const kn=ln.volume&&No.f.Segmentation.get(ln.volume);if(kn){const ur=kn.segments.size,sr=Array.from(kn.segments.keys()),Jn=(0,d.S)(ur,Ht);ar=Jn.legend,Gn=Br=>No.f.Segment.isLocation(Br)?Jn.color(sr.indexOf(Br.segment)):es}else Gn=()=>es;return{factory:gi,granularity:"instance",color:Gn,props:Ht,description:"Gives every volume segment a unique color.",legend:ar}},getParams:function ni(ln){return t.t.clone(Pi)},defaultValues:t.t.getDefaultValues(Pi),isApplicable:ln=>!!ln.volume&&!!No.f.Segmentation.get(ln.volume)};var Ri=n(6853),Qi=n(1888),Hn=n(127);const co={volume:t.t.ValueRef(ln=>ln.state.data.selectQ(Gn=>Gn.root.subtree().filter(ar=>{var kn;return Ri.f.is(null===(kn=ar.obj)||void 0===kn?void 0:kn.data)})).map(Gn=>{var ar,kn;return[Gn.transform.ref,null!==(kn=null===(ar=Gn.obj)||void 0===ar?void 0:ar.label)&&void 0!==kn?kn:"<unknown>"]}),(ln,Ht)=>Ht(ln)),coloring:t.t.MappedStatic("absolute-value",{"absolute-value":t.t.Group({domain:t.t.MappedStatic("auto",{custom:t.t.Interval([-1,1]),auto:t.t.Group({symmetric:t.t.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:t.t.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":t.t.Group({domain:t.t.MappedStatic("auto",{custom:t.t.Interval([-1,1]),auto:t.t.Group({symmetric:t.t.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:t.t.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:t.t.Color((0,e.Q1)(13421772)),normalOffset:t.t.Numeric(0,{min:0,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."})},lr={name:"external-volume",label:"External Volume",category:y.N.Misc,factory:function zr(ln,Ht){let Gn,ar;try{Gn=Ht.volume.getValue()}catch{}if(Gn){const kn=Ht.coloring.params,{stats:ur}=Gn.grid,sr="custom"===kn.domain.name?kn.domain.params:[ur.min,ur.max],Jn="relative-value"===Ht.coloring.name;if("auto"===kn.domain.name&&Jn&&(sr[0]=(sr[0]-ur.mean)/ur.sigma,sr[1]=(sr[1]-ur.mean)/ur.sigma),"auto"===Ht.coloring.params.domain.name&&Ht.coloring.params.domain.params.symmetric){const vn=Math.max(Math.abs(sr[0]),Math.abs(sr[1]));sr[0]=-vn,sr[1]=vn}const Br=e.wC.create({domain:sr,listOrName:kn.list.colors}),st=Ri.x.getGridToCartesianTransform(Gn.grid);zt.$I.invert(st,st);const et=(0,zt.eB)(),{dimensions:at,get:Et}=Gn.grid.cells.space,Nt=Gn.grid.cells.data,[qt,Cn,Un]=at;ar=vn=>{if(!(0,Qi.ZC)(vn))return Ht.defaultColor;zt.eB.copy(et,vn.position),Ht.normalOffset>0&&zt.eB.scaleAndAdd(et,et,vn.normal,Ht.normalOffset),zt.eB.transformMat4(et,et,st);const nr=Math.floor(et[0]),pr=Math.floor(et[1]),Rr=Math.floor(et[2]);if(nr<0||nr>=qt||pr<0||pr>=Cn||Rr<0||Rr>=Un)return Ht.defaultColor;const mo=et[0]-nr,Uo=et[1]-pr,qo=et[2]-Rr,ri=Math.min(nr+1,qt-1),fo=Math.min(pr+1,Cn-1),Lo=Math.min(Rr+1,Un-1);let Ni=Et(Nt,nr,pr,Rr),rs=Et(Nt,ri,pr,Rr),Gi=Et(Nt,nr,fo,Rr),_o=Et(Nt,ri,fo,Rr);const hr=(0,Hn.Cc)((0,Hn.Cc)(Ni,rs,mo),(0,Hn.Cc)(Gi,_o,mo),Uo);Ni=Et(Nt,nr,pr,Lo),rs=Et(Nt,ri,pr,Lo),Gi=Et(Nt,nr,fo,Lo),_o=Et(Nt,ri,fo,Lo);const Wr=(0,Hn.Cc)((0,Hn.Cc)(Ni,rs,mo),(0,Hn.Cc)(Gi,_o,mo),Uo);let no=(0,Hn.Cc)(hr,Wr,qo);return Jn&&(no=(no-ur.mean)/ur.sigma),Br.color(no)}}else ar=()=>Ht.defaultColor;return{factory:zr,granularity:"vertex",preferSmoothing:!0,color:ar,props:Ht,description:"Assigns a color based on volume value at a given vertex."}},getParams:()=>co,defaultValues:t.t.getDefaultValues(co),isApplicable:ln=>!0},Qr={mainchain:t.t.MappedStatic("molecule-type",{uniform:t.t.Group(M.vz),"chain-id":t.t.Group(m.t4),"entity-id":t.t.Group(Q),"entity-source":t.t.Group(Z),"molecule-type":t.t.Group(_t),"model-index":t.t.Group(Re),"structure-index":t.t.Group(Ne),"secondary-structure":t.t.Group(To)}),sidechain:t.t.MappedStatic("residue-name",{uniform:t.t.Group(M.vz),"residue-name":t.t.Group(kt),"element-symbol":t.t.Group(Le)})},bi={name:"cartoon",label:"Cartoon",category:y.N.Misc,factory:function Li(ln,Ht){var Gn,ar;const kn=function Ti(ln,Ht){switch(Ht.name){case"uniform":return(0,M.TA)(ln,Ht.params);case"chain-id":return(0,m.Zv)(ln,Ht.params);case"entity-id":return k(ln,Ht.params);case"entity-source":return le(ln,Ht.params);case"molecule-type":return ut(0,Ht.params);case"model-index":return we(ln,Ht.params);case"structure-index":return ne(ln,Ht.params);case"secondary-structure":return dt(ln,Ht.params);default:(0,$.dr)(Ht)}}(ln,Ht.mainchain),ur=function Bi(ln,Ht){switch(Ht.name){case"uniform":return(0,M.TA)(ln,Ht.params);case"residue-name":return fr(0,Ht.params);case"element-symbol":return Je(ln,Ht.params);default:(0,$.dr)(Ht)}}(ln,Ht.sidechain);let Jn=kn.legend;return"table-legend"===(null===(Gn=kn.legend)||void 0===Gn?void 0:Gn.kind)&&"table-legend"===(null===(ar=ur.legend)||void 0===ar?void 0:ar.kind)&&(Jn={kind:"table-legend",table:[...kn.legend.table,...ur.legend.table]}),{factory:Li,granularity:"group",preferSmoothing:!1,color:function sr(Br,st){return st?kn.color(Br,!1):ur.color(Br,!1)},props:Ht,description:"Uses separate themes for coloring mainchain and sidechain visuals.",legend:Jn}},getParams:function vi(ln){return t.t.clone(Qr)},defaultValues:t.t.getDefaultValues(Qr),isApplicable:ln=>!!ln.structure};var Vi;!function(ln){ln.Category=y.N,ln.PaletteScale=16777215,ln.EmptyFactory=()=>ln.Empty;const Ht=(0,e.Q1)(13421772);ln.Empty={factory:ln.EmptyFactory,granularity:"uniform",color:()=>Ht,props:{}},ln.areEqual=function Gn(kn,ur){return kn.contextHash===ur.contextHash&&kn.factory===ur.factory&&(0,I.bD)(kn.props,ur.props)},ln.EmptyProvider={name:"",label:"",category:"",factory:ln.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0},ln.createRegistry=function ar(){return new l.D(ln.BuiltIn,ln.EmptyProvider)},ln.BuiltIn={"atom-id":Fi,"carbohydrate-symbol":_,cartoon:bi,"chain-id":m.oy,"element-index":D,"element-symbol":en,"entity-id":H,"entity-source":Ae,hydrophobicity:pt,illustrative:Pt,"model-index":Oe,"molecule-type":Kt,occupancy:mn,"operator-hkl":vo,"operator-name":E.PO,"partial-charge":jr,"polymer-id":nn,"polymer-index":Vt,"residue-name":Dr,"secondary-structure":Yt,"sequence-id":vr,"shape-group":Hr.AX,"structure-index":be,"trajectory-index":Fe,uncertainty:po,"unit-index":se,uniform:M.Wr,"volume-segment":Wi,"volume-value":ti,"external-volume":lr}}(Vi||(Vi={}))},9983:(tn,Ue,n)=>{"use strict";n.d(Ue,{N:()=>e});const e={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"}},8742:(tn,Ue,n)=>{"use strict";n.d(Ue,{Zv:()=>l,oy:()=>m,t4:()=>v});var e=n(9136),o=n(190),r=n(8277),t=n(7809),A=n(9983);const c=(0,o.Q1)(16448250),i="Gives every chain a color based on its `asym_id` value.",v={asymId:r.t.Select("auth",r.t.arrayToOptions(["auth","label"])),...(0,t.U)({type:"colors",colorList:"many-distinct"})};function _(u,d){const s=function b(u,d){switch(u.kind){case 0:return"auth"===d?e.StructureProperties.chain.auth_asym_id:e.StructureProperties.chain.label_asym_id;case 1:case 2:return e.StructureProperties.coarse.asym_id}}(u.unit,d)(u);return u.structure.root.models.length>1?M(u.unit.model,s):s}function M(u,d){return`${d}|${(e.Kx.Index.get(u).value||0)+1}`}function l(u,d){let s,C;if(u.structure){const h=e.iZ.Location.create(u.structure.root),a=function I(u,d){const s=new Map;for(const C of u.models){const h=e.Kx.AsymIdOffset.get(C).value,a=("auth"===d?h?.auth:h?.label)||0;let S=0;C.properties.structAsymMap.forEach(({auth_id:D},R)=>{const f="auth"===d?D:R,p=u.models.length>1?M(C,f):f;s.has(p)||(s.set(p,S+a),++S)})}return s}(u.structure.root,d.asymId),S=Array.from(a.keys()),R=(0,t.S)(a.size,d,{valueLabel:f=>S[f]});C=R.legend,s=f=>{let p;if(e.iZ.Location.is(f)){const E=_(f,d.asymId);p=a.get(E)}else if(e.gn.isLocation(f)){h.unit=f.aUnit,h.element=f.aUnit.elements[f.aIndex];const E=_(h,d.asymId);p=a.get(E)}return void 0===p?c:R.color(p)}}else s=()=>c;return{factory:l,granularity:"group",color:s,props:d,description:i,legend:C}}const m={name:"chain-id",label:"Chain Id",category:A.N.Chain,factory:l,getParams:function O(u){var d;const s=r.t.clone(v);return!(null===(d=u.structure)||void 0===d)&&d.models.some(C=>C.coarseHierarchy.isDefined)&&(s.asymId.defaultValue="label"),s},defaultValues:r.t.getDefaultValues(v),isApplicable:u=>!!u.structure}},8103:(tn,Ue,n)=>{"use strict";n.d(Ue,{PO:()=>M,ci:()=>_,qg:()=>v});var e=n(190),o=n(9136),r=n(8277),t=n(7809),A=n(9983);const c=(0,e.Q1)(13421772),i="Assigns a color based on the operator name of a transformed chain.",v={...(0,t.U)({type:"colors",colorList:"many-distinct"})};function _(I,l){let m,u;if(I.structure){const d=function b(I){const l=new Map;for(let m=0,u=I.units.length;m<u;++m){const d=I.units[m].conformation.operator.name;l.has(d)||l.set(d,l.size)}return l}(I.structure.root),s=Array.from(d.keys()),h=(0,t.S)(d.size,l,{valueLabel:a=>s[a]});u=h.legend,m=a=>{let S;return o.iZ.Location.is(a)?S=d.get(a.unit.conformation.operator.name):o.gn.isLocation(a)&&(S=d.get(a.aUnit.conformation.operator.name)),void 0===S?c:h.color(S)}}else m=()=>c;return{factory:_,granularity:"instance",color:m,props:l,description:i,legend:u}}const M={name:"operator-name",label:"Operator Name",category:A.N.Symmetry,factory:_,getParams:function O(I){return r.t.clone(v)},defaultValues:r.t.getDefaultValues(v),isApplicable:I=>!!I.structure}},2476:(tn,Ue,n)=>{"use strict";n.d(Ue,{AX:()=>O,h2:()=>v});var e=n(190),o=n(3558),r=n(8277),t=n(9983);const A=(0,e.Q1)(13421772),y="Assigns colors as defined by the shape object.",c={};function v(b,_){return{factory:v,granularity:"groupInstance",color:M=>o.$.isLocation(M)?M.shape.getColor(M.group,M.instance):A,props:_,description:y}}const O={name:"shape-group",label:"Shape Group",category:t.N.Misc,factory:v,getParams:function i(b){return c},defaultValues:r.t.getDefaultValues(c),isApplicable:b=>!!b.shape}},9347:(tn,Ue,n)=>{"use strict";n.d(Ue,{TA:()=>O,Wr:()=>b,vz:()=>i});var e=n(190),o=n(8277),r=n(2293),t=n(9909),A=n(9983);const y=(0,e.Q1)(13421772),c="Gives everything the same, uniform color.",i={value:o.t.Color(y),saturation:o.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:o.t.Numeric(0,{min:-6,max:6,step:.1})};function O(_,M){let I=(0,t.NT)(M.value,y);return I=e.Q1.saturate(I,M.saturation),I=e.Q1.lighten(I,M.lightness),{factory:O,granularity:"uniform",color:()=>I,props:M,description:c,legend:(0,r.h)([["uniform",I]])}}const b={name:"uniform",label:"Uniform",category:A.N.Misc,factory:O,getParams:function v(_){return i},defaultValues:o.t.getDefaultValues(i),isApplicable:_=>!0}},3488:(tn,Ue,n)=>{"use strict";n.d(Ue,{a:()=>t});var e=n(3246),o=n(9136),r=n(9498);function t(A,y){return{kind:A,layers:y}}!function(A){function c(I){return 0===I.layers.length}A.Empty={kind:"empty-loci",layers:[]},A.areEqual=function y(I,l){if(0===I.layers.length&&0===l.layers.length)return!0;if(I.layers.length!==l.layers.length)return!1;for(let m=0,u=I.layers.length;m<u;++m)if(I.layers[m].value!==l.layers[m].value||!e.QN.areEqual(I.layers[m].loci,l.layers[m].loci))return!1;return!0},A.isEmpty=c,A.remap=function i(I,l){if("element-loci"===I.kind){const m=[];for(const u of I.layers){let{loci:d,value:s}=u;d=o.iZ.Loci.remap(d,l),o.iZ.Loci.isEmpty(d)||m.push({loci:d,value:s})}return{kind:"element-loci",layers:m}}return I},A.merge=function v(I){if(c(I))return I;if("element-loci"===I.kind){const{structure:l}=I.layers[0].loci,m=new Map;let u=o.iZ.Loci.none(l);for(let s=0,C=I.layers.length;s<C;++s){let{loci:h,value:a}=I.layers[C-s-1];h=o.iZ.Loci.subtract(h,u),u=o.iZ.Loci.union(h,u),o.iZ.Loci.isEmpty(h)||(m.has(a)&&(h=o.iZ.Loci.union(h,m.get(a))),m.set(a,h))}const d=[];return m.forEach((s,C)=>{d.push({loci:s,value:C})}),{kind:"element-loci",layers:d}}return I},A.filter=function O(I,l){if(c(I))return I;if("element-loci"===I.kind){const{structure:m}=I.layers[0].loci,u=[];for(const d of I.layers){let{loci:s,value:C}=d;const h=o.iZ.Loci.remap(s,l);s=o.iZ.Loci.remap(h,m),o.iZ.Loci.isEmpty(s)||u.push({loci:s,value:C})}return{kind:"element-loci",layers:u}}return I},A.ofScript=function b(I,l){const m=[];for(let u=0,d=I.length;u<d;++u){const{script:s,value:C}=I[u],h=r.e.toLoci(s,l);o.iZ.Loci.isEmpty(h)||m.push({loci:h,value:C})}return{kind:"element-loci",layers:m}},A.ofBundle=function _(I,l){const m=[];for(let u=0,d=I.length;u<d;++u){const{bundle:s,value:C}=I[u],h=o.iZ.Bundle.toLoci(s,l.root);m.push({loci:h,value:C})}return{kind:"element-loci",layers:m}},A.toBundle=function M(I){const l=[];for(let m=0,u=I.layers.length;m<u;++m){const{loci:d,value:s}=I.layers[m],C=o.iZ.Bundle.fromLoci(d);l.push({bundle:C,value:s})}return{kind:"element-loci",layers:l}}}(t||(t={}))},3917:(tn,Ue,n)=>{"use strict";n.d(Ue,{BB:()=>s,CR:()=>m,W8:()=>S,YQ:()=>v,d_:()=>M,k0:()=>D,k7:()=>I,kd:()=>R});var e=n(9136),o=n(3246),r=n(3543),t=n(7785),A=n(4369),y=n(4490),c=n(6853);const i={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function v(f,p={}){var E;switch(f.kind){case"structure-loci":return f.structure.models.map(k=>k.entry).filter(k=>!!k).join(", ");case"element-loci":return M(e.iZ.Stats.ofLoci(f),p);case"bond-loci":const T=f.bonds[0];return T?m(T,p):"";case"shape-loci":return f.shape.name;case"group-loci":const L=f.groups[0];return L?f.shape.getLabel(r.CD.start(L.ids),L.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return f.getLabel();case"volume-loci":return f.volume.label||"Volume";case"isosurface-loci":return[`${f.volume.label||"Volume"}`,`Isosurface at ${c.f.IsoValue.toString(f.isoValue)}`].join(" | ");case"cell-loci":const w=r.CD.size(f.indices),Q=r.CD.start(f.indices),G=c.f.IsoValue.absolute(f.volume.grid.cells.data[Q]),V=c.f.IsoValue.toRelative(G,f.volume.grid.stats),U=[`${f.volume.label||"Volume"}`,1===w?`Cell #${Q}`:`${w} Cells`];return 1===w&&U.push(`${c.f.IsoValue.toString(G)} (${c.f.IsoValue.toString(V)})`),U.join(" | ");case"segment-loci":const N=null===(E=c.f.Segmentation.get(f.volume))||void 0===E?void 0:E.labels;if(N&&1===f.segments.length){const k=N[f.segments[0]];if(k)return k}return[`${f.volume.label||"Volume"}`,1===f.segments.length?`Segment ${f.segments[0]}`:`${f.segments.length} Segments`].join(" | ")}}function O(f,p){return 1===f?`1 ${p}`:`${f} ${p}s`}function b(f,p,E,T,L,w){return`${s(p,{granularity:E,hidePrefix:T,reverse:L,condensed:w})} <small>[+ ${O(f-1,`other ${(0,t.ZH)(E)}`)}]</small>`}function M(f,p={}){const E={...i,...p},T=function l(f,p=!1,E=!1,T=!1,L=!1){const{structureCount:w,chainCount:Q,residueCount:G,conformationCount:V,elementCount:U}=f;if(!p&&1===U&&0===G&&0===Q)return s(f.firstElementLoc,{hidePrefix:E,condensed:T,granularity:"element",reverse:L});if(!p&&0===U&&1===G&&0===Q)return s(f.firstResidueLoc,{hidePrefix:E,condensed:T,granularity:"residue",reverse:L});if(p||0!==U||0!==G||1!==Q){if(p){const N=[];return w>0&&N.push(O(w,"Structure")),Q>0&&N.push(O(Q,"Chain")),G>0&&N.push(O(G,"Residue")),V>0&&N.push(O(V,"Conformation")),U>0&&N.push(O(U,"Element")),N.join("<small> + </small>")}{const N=[];return w>0&&N.push(1===w?s(f.firstStructureLoc,{hidePrefix:E,condensed:T,granularity:"structure",reverse:L}):b(w,f.firstStructureLoc,"structure",E,L,T)),Q>0&&(N.push(1===Q?s(f.firstChainLoc,{condensed:T,granularity:"chain",hidePrefix:E,reverse:L}):b(Q,f.firstChainLoc,"chain",E,L,T)),E=!0),G>0&&(N.push(1===G?s(f.firstResidueLoc,{condensed:T,granularity:"residue",hidePrefix:E,reverse:L}):b(G,f.firstResidueLoc,"residue",E,L,T)),E=!0),V>0&&(N.push(1===V?s(f.firstConformationLoc,{condensed:T,granularity:"conformation",hidePrefix:E,reverse:L}):b(V,f.firstConformationLoc,"conformation",E,L,T)),E=!0),U>0&&N.push(1===U?s(f.firstElementLoc,{condensed:T,granularity:"element",hidePrefix:E,reverse:L}):b(U,f.firstElementLoc,"element",E,L,T)),N.join("<small> + </small>")}}{const{unit:N}=f.firstChainLoc,k=e.Nf.isAtomic(N)&&1===function _(f){const{elements:p,model:E}=f,{chainAtomSegments:T,residueAtomSegments:L}=E.atomicHierarchy;return L.index[T.offsets[T.index[p[p.length-1]]+1]-1]-L.index[T.offsets[T.index[p[0]]]]+1}(N)||e.Nf.Traits.is(N.traits,e.Nf.Trait.MultiChain)?"residue":"chain";return s(f.firstChainLoc,{hidePrefix:E,condensed:T,granularity:k,reverse:L})}}(f,E.countsOnly,E.hidePrefix,E.condensed,E.reverse);return E.htmlStyling?T:(0,t.Kq)(T)}function I(f,p={}){const E=e.iZ.Stats.create();for(const T of f)e.iZ.Stats.add(E,E,e.iZ.Stats.ofLoci(T));return M(E,p)}function m(f,p={}){return u({loci:[e.iZ.Loci(f.aStructure,[{unit:f.aUnit,indices:r.CD.ofSingleton(f.aIndex)}]),e.iZ.Loci(f.bStructure,[{unit:f.bUnit,indices:r.CD.ofSingleton(f.bIndex)}])]},p)}function u(f,p={}){const E={...i,...p},T=function d(f,p){const{granularity:E,hidePrefix:T,reverse:L,condensed:w}=p;let Q=!0;for(const G of f.loci)if(!e.iZ.Loci.is(G)||1!==e.iZ.Loci.size(G)){Q=!1;break}if(Q){const V=f.loci.map(N=>{const{unit:k,indices:H}=N.elements[0];return e.iZ.Location.create(N.structure,k,k.elements[r.CD.start(H)])}).map(N=>C(N,E,T,L||w));if(w)return V.map(N=>N[0].replace(/\[.*\]/g,"").trim()).filter(N=>!!N).join(" \u2014 ");let U=0;for(let N=0,k=Math.min(...V.map(H=>H.length))-1;N<k;++N){let H=!0;for(let $=1,J=V.length;$<J;++$)if(V[0][N]!==V[$][N]){H=!1;break}if(!H)break;U+=1}if(U>0){const N=[V[0].join(" | ")];for(let k=1,H=V.length;k<H;++k)N.push(V[k].slice(U).filter($=>!!$).join(" | "));return N.join(" \u2014 ")}return V.map(N=>N.filter(k=>!!k).join(" | ")).filter(N=>!!N).join("</br>")}return f.loci.map(V=>v(V,p)).filter(V=>!!V).join(w?" \u2014 ":"</br>")}(f,E);return E.htmlStyling?T:(0,t.Kq)(T)}function s(f,p={}){var E,T;const L={...i,...p},w=C(f,L.granularity,L.hidePrefix,L.reverse||L.condensed),Q=L.condensed?null!==(T=null===(E=w[0])||void 0===E?void 0:E.replace(/\[.*\]/g,"").trim())&&void 0!==T?T:"":w.filter(G=>!!G).join(" | ");return L.htmlStyling?Q:(0,t.Kq)(Q)}function C(f,p="element",E=!1,T=!1){const L=[];if(!E){let w=f.unit.model.entry;w.length>30&&(w=w.substr(0,27)+"\u2026"),L.push(`<small>${w}</small>`),"structure"!==p&&(L.push(`<small>Model ${f.unit.model.modelNum}</small>`),L.push(`<small>Instance ${f.unit.conformation.operator.name}</small>`))}return e.Nf.isAtomic(f.unit)?L.push(...function h(f,p,E=!1){const T=e.iZ.Location.residueIndex(f),L=e.StructureProperties.chain.label_asym_id(f),w=e.StructureProperties.chain.auth_asym_id(f),Q=0===f.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(T),G=e.StructureProperties.residue.label_seq_id(f),V=e.StructureProperties.residue.auth_seq_id(f),U=e.StructureProperties.residue.pdbx_PDB_ins_code(f),N=e.StructureProperties.atom.label_comp_id(f),k=e.StructureProperties.atom.label_atom_id(f),H=e.StructureProperties.atom.label_alt_id(f),$=e.StructureProperties.atom.occupancy(f),J=e.StructureProperties.residue.microheterogeneityCompIds(f),W="residue"===p&&J.length>1?`(${J.join("|")})`:N,te=[];switch(p){case"element":te.push(`<b>${k}</b>${H?`%${H}`:""}`);case"conformation":"conformation"===p&&H&&te.push(`<small>Conformation</small> <b>${H}</b>`);case"residue":const de=G!==V&&Q?G:V;te.push(`<b>${W} ${de}</b>${de!==V?` <small>[auth</small> <b>${V}</b><small>]</small>`:""}<b>${U||""}</b>`);case"chain":L===w?te.push(`<b>${L}</b>`):"chain"===p&&e.Nf.Traits.is(f.unit.traits,e.Nf.Trait.MultiChain)?te.push(`<small>[auth</small> <b>${w}</b><small>]</small>`):te.push(`<b>${L}</b> <small>[auth</small> <b>${w}</b><small>]</small>`)}return te.length>0&&1!==$&&!E&&(te[0]=`${te[0]} <small>[occupancy</small> <b>${Math.round(100*$)/100}</b><small>]</small>`),te.reverse()}(f,p,T)):e.Nf.isCoarse(f.unit)?L.push(...function a(f,p){const E=e.StructureProperties.coarse.asym_id(f),T=e.StructureProperties.coarse.seq_id_begin(f),L=e.StructureProperties.coarse.seq_id_end(f),w=[];switch(p){case"element":case"conformation":case"residue":if(T===L){const Q=e.StructureProperties.coarse.entityKey(f),V=f.unit.model.sequence.byEntityKey[Q].sequence.compId.value(T-1);w.push(`<b>${V} ${T}</b>`)}else w.push(`<b>${T}-${L}</b>`);case"chain":w.push(`<b>${E}</b>`)}return w.reverse()}(f,p)):L.push("Unknown"),T?L.reverse():L}function S(f,p={}){const E={...i,measureOnly:!1,unitLabel:"\u212b",...p},[T,L]=f.loci.map(G=>o.QN.getCenter(G)),w=`${A.eB.distance(T,L).toFixed(2)} ${E.unitLabel}`;if(E.measureOnly)return w;const Q=u(f,E);return E.condensed?`${w} | ${Q}`:`Distance ${w}</br>${Q}`}function D(f,p={}){const E={...i,measureOnly:!1,...p},[T,L,w]=f.loci.map(N=>o.QN.getCenter(N)),Q=A.eB.sub((0,A.eB)(),T,L),G=A.eB.sub((0,A.eB)(),w,L),V=`${(0,y.H)(A.eB.angle(Q,G)).toFixed(2)}\xb0`;if(E.measureOnly)return V;const U=u(f,E);return E.condensed?`${V} | ${U}`:`Angle ${V}</br>${U}`}function R(f,p={}){const E={...i,measureOnly:!1,...p},[T,L,w,Q]=f.loci.map(U=>o.QN.getCenter(U)),G=`${(0,y.H)(A.eB.dihedralAngle(T,L,w,Q)).toFixed(2)}\xb0`;if(E.measureOnly)return G;const V=u(f,E);return E.condensed?`${G} | ${V}`:`Dihedral ${G}</br>${V}`}},261:(tn,Ue,n)=>{"use strict";n.d(Ue,{l:()=>A});var e=n(3246),o=n(190),r=n(9136),t=n(9498);function A(y,c){return{kind:y,layers:c}}!function(y){function i(l){return 0===l.layers.length}y.Empty={kind:"empty-loci",layers:[]},y.areEqual=function c(l,m){if(0===l.layers.length&&0===m.layers.length)return!0;if(l.layers.length!==m.layers.length)return!1;for(let u=0,d=l.layers.length;u<d;++u)if(l.layers[u].clear!==m.layers[u].clear||l.layers[u].color!==m.layers[u].color||!e.QN.areEqual(l.layers[u].loci,m.layers[u].loci))return!1;return!0},y.isEmpty=i,y.remap=function v(l,m){if("element-loci"===l.kind){const u=[];for(const d of l.layers){let{loci:s,color:C,clear:h}=d;s=r.iZ.Loci.remap(s,m),r.iZ.Loci.isEmpty(s)||u.push({loci:s,color:C,clear:h})}return{kind:"element-loci",layers:u}}return l},y.merge=function O(l){if(i(l))return l;if("element-loci"===l.kind){const{structure:m}=l.layers[0].loci,u=new Map;let d=r.iZ.Loci.none(m);for(let C=0,h=l.layers.length;C<h;++C){let{loci:a,color:S,clear:D}=l.layers[h-C-1];if(a=r.iZ.Loci.subtract(a,d),d=r.iZ.Loci.union(a,d),!r.iZ.Loci.isEmpty(a)){const R=D?-1:S;u.has(R)&&(a=r.iZ.Loci.union(a,u.get(R))),u.set(R,a)}}const s=[];return u.forEach((C,h)=>{const a=-1===h,S=a?(0,o.Q1)(0):h;s.push({loci:C,color:S,clear:a})}),{kind:"element-loci",layers:s}}return l},y.filter=function b(l,m){if(i(l))return l;if("element-loci"===l.kind){const{structure:u}=l.layers[0].loci,d=[];for(const s of l.layers){let{loci:C,color:h,clear:a}=s;const S=r.iZ.Loci.remap(C,m);C=r.iZ.Loci.remap(S,u),r.iZ.Loci.isEmpty(C)||d.push({loci:C,color:h,clear:a})}return{kind:"element-loci",layers:d}}return l},y.ofScript=function _(l,m){const u=[];for(let d=0,s=l.length;d<s;++d){const{script:C,color:h,clear:a}=l[d],S=t.e.toLoci(C,m);r.iZ.Loci.isEmpty(S)||u.push({loci:S,color:h,clear:a})}return{kind:"element-loci",layers:u}},y.ofBundle=function M(l,m){const u=[];for(let d=0,s=l.length;d<s;++d){const{bundle:C,color:h,clear:a}=l[d],S=r.iZ.Bundle.toLoci(C,m.root);u.push({loci:S,color:h,clear:a})}return{kind:"element-loci",layers:u}},y.toBundle=function I(l){const m=[];for(let u=0,d=l.layers.length;u<d;++u){const{loci:s,color:C,clear:h}=l.layers[u],a=r.iZ.Bundle.fromLoci(s);m.push({bundle:a,color:C,clear:h})}return{kind:"element-loci",layers:m}}}(A||(A={}))},2832:(tn,Ue,n)=>{"use strict";n.d(Ue,{F:()=>h});var e=n(5013),o=n(1930),r=n(9136),t=n(2008),A=n(8277);const i={scale:A.t.Numeric(1,{min:.1,max:5,step:.1})};function O(a,S){return r.Nf.isAtomic(a)?(0,t.sO)(a.model.atomicHierarchy.atoms.type_symbol.value(S)):r.Nf.isSpheres(a)?a.model.coarseConformation.spheres.radius[S]:0}const _={name:"physical",label:"Physical",category:"",factory:function b(a,S){const D=void 0===S.scale?1:S.scale;return{factory:b,granularity:"group",size:function R(f){let p;return p=r.iZ.Location.is(f)?D*O(f.unit,f.element):r.gn.isLocation(f)?D*Math.min(O(f.aUnit,f.aUnit.elements[f.aIndex]),O(f.bUnit,f.bUnit.elements[f.bIndex])):1*D,p},props:S,description:"Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres."}},getParams:function v(a){return i},defaultValues:A.t.getDefaultValues(i),isApplicable:a=>!!a.structure};var M=n(9909),I=n(350);const m={bfactorFactor:A.t.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:A.t.Numeric(.05,{min:0,max:1,step:.01}),baseSize:A.t.Numeric(.2,{min:0,max:2,step:.1})};function d(a,S,D){return r.Nf.isAtomic(a)?a.model.atomicConformation.B_iso_or_equiv.value(S)*D.bfactorFactor:r.Nf.isSpheres(a)?a.model.coarseConformation.spheres.rmsf[S]*D.rmsfFactor:0}const C={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:function s(a,S){return{factory:s,granularity:"group",size:function D(R){let f=S.baseSize;return r.iZ.Location.is(R)?f+=d(R.unit,R.element,S):r.gn.isLocation(R)&&(f+=d(R.aUnit,R.aUnit.elements[R.aIndex],S)),f},props:S,description:"Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique."}},getParams:function u(a){return m},defaultValues:A.t.getDefaultValues(m),isApplicable:a=>!!a.structure&&a.structure.models.some(S=>S.atomicConformation.B_iso_or_equiv.isDefined||S.coarseHierarchy.isDefined)};var h,a;(a=h||(h={})).EmptyFactory=()=>a.Empty,a.Empty={factory:a.EmptyFactory,granularity:"uniform",size:()=>1,props:{}},a.areEqual=function S(R,f){return R.contextHash===f.contextHash&&R.factory===f.factory&&(0,M.bD)(R.props,f.props)},a.EmptyProvider={name:"",label:"",category:"",factory:a.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0},a.createRegistry=function D(){return new o.D(a.BuiltIn,a.EmptyProvider)},a.BuiltIn={physical:_,"shape-group":I.Ev,uncertainty:C,uniform:e.kk}},350:(tn,Ue,n)=>{"use strict";n.d(Ue,{$d:()=>c,Ev:()=>i});var e=n(3558),o=n(8277);const r=1,t="Assigns sizes as defined by the shape object.",A={};function c(v,O){return{factory:c,granularity:"groupInstance",size:b=>e.$.isLocation(b)?b.shape.getSize(b.group,b.instance):r,props:O,description:t}}const i={name:"shape-group",label:"Shape Group",category:"",factory:c,getParams:function y(v){return A},defaultValues:o.t.getDefaultValues(A),isApplicable:v=>!!v.shape}},5013:(tn,Ue,n)=>{"use strict";n.d(Ue,{kk:()=>y,ru:()=>A});var e=n(8277);const o="Gives everything the same, uniform size.",r={value:e.t.Numeric(1,{min:0,max:20,step:.1})};function A(c,i){const v=i.value;return{factory:A,granularity:"uniform",size:()=>v,props:i,description:o}}const y={name:"uniform",label:"Uniform",category:"",factory:A,getParams:function t(c){return r},defaultValues:e.t.getDefaultValues(r),isApplicable:c=>!0}},9213:(tn,Ue,n)=>{"use strict";n.d(Ue,{l:()=>y});var e=n(3246),o=n(9136),r=n(9498),t=n(6765),A=n(9359);function y(c,i){return{kind:c,layers:i}}!function(c){function v(m){return 0===m.layers.length}c.Empty={kind:"empty-loci",layers:[]},c.areEqual=function i(m,u){if(0===m.layers.length&&0===u.layers.length)return!0;if(m.layers.length!==u.layers.length)return!1;for(let d=0,s=m.layers.length;d<s;++d)if(m.layers[d].clear!==u.layers[d].clear||!(0,A.bN)(m.layers[d].material,u.layers[d].material)||!e.QN.areEqual(m.layers[d].loci,u.layers[d].loci))return!1;return!0},c.isEmpty=v,c.remap=function O(m,u){if("element-loci"===m.kind){const d=[];for(const s of m.layers){let{loci:C,material:h,clear:a}=s;C=o.iZ.Loci.remap(C,u),o.iZ.Loci.isEmpty(C)||d.push({loci:C,material:h,clear:a})}return{kind:"element-loci",layers:d}}return m},c.merge=function b(m){if(v(m))return m;if("element-loci"===m.kind){const{structure:u}=m.layers[0].loci;let d;const s=new Map;let C=o.iZ.Loci.none(u);for(let a=0,S=m.layers.length;a<S;++a){let{loci:D,material:R,clear:f}=m.layers[S-a-1];D=o.iZ.Loci.subtract(D,C),C=o.iZ.Loci.union(D,C),o.iZ.Loci.isEmpty(D)||(f?d=d?o.iZ.Loci.union(D,d):D:(s.has(R)&&(D=o.iZ.Loci.union(D,s.get(R))),s.set(R,D)))}const h=[];return d&&h.push({loci:d,material:(0,t.i)(),clear:!0}),s.forEach((a,S)=>{h.push({loci:a,material:S,clear:!1})}),{kind:"element-loci",layers:h}}return m},c.filter=function _(m,u){if(v(m))return m;if("element-loci"===m.kind){const{structure:d}=m.layers[0].loci,s=[];for(const C of m.layers){let{loci:h,material:a,clear:S}=C;const D=o.iZ.Loci.remap(h,u);h=o.iZ.Loci.remap(D,d),o.iZ.Loci.isEmpty(h)||s.push({loci:h,material:a,clear:S})}return{kind:"element-loci",layers:s}}return m},c.ofScript=function M(m,u){const d=[];for(let s=0,C=m.length;s<C;++s){const{script:h,material:a,clear:S}=m[s],D=r.e.toLoci(h,u);o.iZ.Loci.isEmpty(D)||d.push({loci:D,material:a,clear:S})}return{kind:"element-loci",layers:d}},c.ofBundle=function I(m,u){const d=[];for(let s=0,C=m.length;s<C;++s){const{bundle:h,material:a,clear:S}=m[s],D=o.iZ.Bundle.toLoci(h,u.root);d.push({loci:D,material:a,clear:S})}return{kind:"element-loci",layers:d}},c.toBundle=function l(m){const u=[];for(let d=0,s=m.layers.length;d<s;++d){const{loci:C,material:h,clear:a}=m.layers[d],S=o.iZ.Bundle.fromLoci(C);u.push({bundle:S,material:h,clear:a})}return{kind:"element-loci",layers:u}}}(y||(y={}))},1930:(tn,Ue,n)=>{"use strict";n.d(Ue,{D:()=>i,S:()=>y});var y,e=n(467),o=n(274),r=n(2832),t=n(8277),A=n(9359);function c(v){return v.map(O=>[O.name,O.provider.label,O.provider.category])}!function(v){function b(){return{color:o.J.Empty,size:r.F.Empty}}function M(){return(M=(0,e.A)(function*(l,m,u,d){var s,C;yield null===(s=m.colorThemeRegistry.get(d.colorTheme.name).ensureCustomProperties)||void 0===s?void 0:s.attach(l,u),yield null===(C=m.sizeThemeRegistry.get(d.sizeTheme.name).ensureCustomProperties)||void 0===C?void 0:C.attach(l,u)})).apply(this,arguments)}v.create=function O(l,m,u,d){d=d||b();const s=u.colorTheme,C=u.sizeTheme;return d.color=l.colorThemeRegistry.create(s.name,m,s.params),d.size=l.sizeThemeRegistry.create(C.name,m,C.params),d},v.createEmpty=b,v.ensureDependencies=function _(l,m,u,d){return M.apply(this,arguments)},v.releaseDependencies=function I(l,m,u){var d,s;null===(d=l.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)||void 0===d||d.detach(m),null===(s=l.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)||void 0===s||s.detach(m)}}(y||(y={}));class i{get default(){return this._list[0]}get list(){return this._list}get types(){return c(this._list)}constructor(O,b){this.emptyProvider=b,this._list=[],this._map=new Map,this._name=new Map,(0,A.IF)(O,(_,M)=>{if(_.name!==M)throw new Error(`Fix build in themes to have matching names. ${_.name} ${M}`);this.add(_)})}sort(){this._list.sort((O,b)=>O.provider.category===b.provider.category?O.provider.label<b.provider.label?-1:O.provider.label>b.provider.label?1:0:O.provider.category<b.provider.category?-1:1)}add(O){if(this._map.has(O.name))throw new Error(`${O.name} already registered.`);const b=O.name;this._list.push({name:b,provider:O}),this._map.set(b,O),this._name.set(O,b),this.sort()}remove(O){this._list.splice(this._list.findIndex(_=>_.name===O.name),1);const b=this._map.get(O.name);b&&(this._map.delete(O.name),this._name.delete(b))}has(O){return this._map.has(O.name)}get(O){return this._map.get(O)||this.emptyProvider}getName(O){if(!this._name.has(O))throw new Error(`'${O.label}' is not a registered theme provider.`);return this._name.get(O)}create(O,b,_={}){const M=this.get(O);return M.factory(b,{...t.t.getDefaultValues(M.getParams(b)),..._})}getApplicableList(O){return this._list.filter(b=>b.provider.isApplicable(O))}getApplicableTypes(O){return c(this.getApplicableList(O))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}}},1965:(tn,Ue,n)=>{"use strict";n.d(Ue,{x:()=>t});var e=n(3246),o=n(9136),r=n(9498);function t(A,y){return{kind:A,layers:y}}!function(A){function c(I){return 0===I.layers.length}A.Empty={kind:"empty-loci",layers:[]},A.areEqual=function y(I,l){if(0===I.layers.length&&0===l.layers.length)return!0;if(I.layers.length!==l.layers.length)return!1;for(let m=0,u=I.layers.length;m<u;++m)if(I.layers[m].value!==l.layers[m].value||!e.QN.areEqual(I.layers[m].loci,l.layers[m].loci))return!1;return!0},A.isEmpty=c,A.remap=function i(I,l){if("element-loci"===I.kind){const m=[];for(const u of I.layers){const d=o.iZ.Loci.remap(u.loci,l);o.iZ.Loci.isEmpty(d)||m.push({loci:d,value:u.value})}return{kind:"element-loci",layers:m}}return I},A.merge=function v(I){if(c(I))return I;if("element-loci"===I.kind){const{structure:l}=I.layers[0].loci,m=new Map;let u=o.iZ.Loci.none(l);for(let s=0,C=I.layers.length;s<C;++s){let{loci:h,value:a}=I.layers[C-s-1];h=o.iZ.Loci.subtract(h,u),u=o.iZ.Loci.union(h,u),o.iZ.Loci.isEmpty(h)||(m.has(a)&&(h=o.iZ.Loci.union(h,m.get(a))),m.set(a,h))}const d=[];return m.forEach((s,C)=>{d.push({loci:s,value:C})}),{kind:"element-loci",layers:d}}return I},A.filter=function O(I,l){if(c(I))return I;if("element-loci"===I.kind){const{structure:m}=I.layers[0].loci,u=[];for(const d of I.layers){let{loci:s,value:C}=d;const h=o.iZ.Loci.remap(s,l);s=o.iZ.Loci.remap(h,m),o.iZ.Loci.isEmpty(s)||u.push({loci:s,value:C})}return{kind:"element-loci",layers:u}}return I},A.ofScript=function b(I,l){const m=[];for(let u=0,d=I.length;u<d;++u){const{script:s,value:C}=I[u],h=r.e.toLoci(s,l);o.iZ.Loci.isEmpty(h)||m.push({loci:h,value:C})}return{kind:"element-loci",layers:m}},A.ofBundle=function _(I,l){const m=[];for(let u=0,d=I.length;u<d;++u){const{bundle:s,value:C}=I[u],h=o.iZ.Bundle.toLoci(s,l.root);m.push({loci:h,value:C})}return{kind:"element-loci",layers:m}},A.toBundle=function M(I){const l=[];for(let m=0,u=I.layers.length;m<u;++m){const{loci:d,value:s}=I.layers[m],C=o.iZ.Bundle.fromLoci(d);l.push({bundle:C,value:s})}return{kind:"element-loci",layers:l}}}(t||(t={}))},6115:(tn,Ue,n)=>{"use strict";function A(p){let E=-1/0;for(let T=0,L=p.length;T<L;++T)p[T]>E&&(E=p[T]);return E}function y(p){let E=1/0;for(let T=0,L=p.length;T<L;++T)p[T]<E&&(E=p[T]);return E}function c(p){let E=1/0,T=-1/0;for(let L=0,w=p.length;L<w;++L)p[L]<E&&(E=p[L]),p[L]>T&&(T=p[L]);return[E,T]}function i(p,E=1,T=0){const L=p.length;let w=0;for(let Q=T;Q<L;Q+=E)w+=p[Q];return w}function v(p,E=1,T=0){return i(p,E,T)/(p.length/E)}function O(p){const E=p.length;let T=0;for(let L=0;L<E;++L){const w=p[L];T+=w*w}return Math.sqrt(T/E)}function b(p,E){for(let T=0,L=E?Math.min(E,p.length):p.length;T<L;++T)p[T]=T;return p}function _(p,E){let T=0,L=!1;for(const w=p.length;T<w;T++)if(p[T]===E){L=!0;break}return!!L&&(M(p,T),!0)}function M(p,E){for(let T=E,L=p.length-1;T<L;T++)p[T]=p[T+1];p.pop()}function I(p,E){return!(p.indexOf(E)>=0||(p.push(E),0))}function l(p,E){const T=p.indexOf(E);if(T<0)return!1;for(let L=T,w=p.length-1;L<w;L++)p[L]=p[L+1];return p.pop(),!0}function u(p,E){let T=0;for(let L=0,w=p.length;L<w;++L)E.includes(p[L])&&(T+=1);return T}function d(p,E){if(!p||0===p.length)return!E||0===E.length;if(!E)return!1;const T=p.length;if(T!==E.length)return!1;for(let L=0;L<T;L++)if(p[L]!==E[L])return!1;return!0}function s(p){for(let E=0,T=p.length;E<T;E++)if(p[E]!==E)return!1;return!0}function C(p,E,T){for(let L=0,w=p.length;L<w;++L)if(p[L][0]===E)return void(p[L][1]=T);p.push([E,T])}n.d(Ue,{af:()=>d,u$:()=>u,qW:()=>s,$6:()=>C,_M:()=>A,VR:()=>v,GP:()=>y,em:()=>c,P6:()=>M,mO:()=>_,C2:()=>O,Z2:()=>I,K3:()=>l,jJ:()=>i,WE:()=>b}),n(9359)},1861:(tn,Ue,n)=>{"use strict";n.d(Ue,{E:()=>i,V:()=>c});var c,e=n(467),o=n(3559),r=n(8382),t=n(3188),A=n(4824),y=n(8484);!function(v){function O(u,d){return{kind:"url",id:o.k.create22(),url:u,...d}}v.Url=O,v.File=function b(u){return{kind:"file",id:o.k.create22(),name:u.name,file:u}},v.isUrl=function _(u){return"url"===u?.kind},v.isFile=function M(u){return"file"===u?.kind},v.Wrapper=function I(u,d,s){return{data:u,dispose:()=>{s.release(d)}}},v.getUrl=function l(u){return"string"==typeof u?u:u.url},v.getUrlAsset=function m(u,d,s){return"string"==typeof d?u.tryFindUrl(d,s)||O(d,{body:s}):d}}(c||(c={}));class i{constructor(){this._assets=new Map}get assets(){return(0,r.ZR)(this._assets.values())}tryFindUrl(O,b){const _=this.assets.values();for(;;){const M=_.next();if(M.done)return;const I=M.value.asset;if(c.isUrl(I)&&I.url===O&&(I.body||"")===(b||""))return I}}set(O,b){this._assets.set(O.id,{asset:O,file:b,refCount:0})}get(O){return this._assets.get(O.id)}delete(O){return this._assets.delete(O.id)}has(O){return this._assets.has(O.id)}resolve(O,b,_=!0){var M=this;return c.isUrl(O)?A.YZ.create(`Download ${O.title||O.url}`,function(){var I=(0,e.A)(function*(l){if(M._assets.has(O.id)){const d=M._assets.get(O.id);return d.refCount++,c.Wrapper(yield(0,t.dH)(d.file,b).runInContext(l),O,M)}if(!_)return c.Wrapper(yield(0,t.hW)({...O,type:b}).runInContext(l),O,M);const m=yield(0,t.hW)({...O,type:"binary"}).runInContext(l),u=new y.em([m],"raw-data");return M._assets.set(O.id,{asset:O,file:u,refCount:1}),c.Wrapper(yield(0,t.dH)(u,b).runInContext(l),O,M)});return function(l){return I.apply(this,arguments)}}()):A.YZ.create(`Read ${O.name}`,function(){var I=(0,e.A)(function*(l){if(M._assets.has(O.id)){const m=M._assets.get(O.id);return m.refCount++,c.Wrapper(yield(0,t.dH)(m.file,b).runInContext(l),O,M)}if(!(O.file instanceof y.em))throw new Error(`Cannot resolve file asset '${O.name}' (${O.id})`);return _&&M._assets.set(O.id,{asset:O,file:O.file,refCount:1}),c.Wrapper(yield(0,t.dH)(O.file,b).runInContext(l),O,M)});return function(l){return I.apply(this,arguments)}}())}release(O){const b=this._assets.get(O.id);b&&(b.refCount--,b.refCount<=0&&this._assets.delete(O.id))}clear(){this._assets.clear()}dispose(){this.clear()}}},4123:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>r});var e=n(4080),o=n(7785);function r(i,v="",O=""){return r.create(i,v,O)}!function(i){function I(d){return d.triggers.map(m.format).join(" or ")}function m(d,s){return m.create(d,s)}var d;i.create=function v(d,s="",C=""){return{triggers:d,action:s,description:C}},i.isBinding=function O(d){return!!d&&Array.isArray(d.triggers)&&"string"==typeof d.action},i.Empty={triggers:[],action:"",description:""},i.isEmpty=function b(d){return 0===d.triggers.length||d.triggers.every(s=>void 0===s.buttons&&void 0===s.modifiers&&!s.code)},i.match=function _(d,s,C){return d.triggers.some(h=>m.match(h,s,C))},i.matchKey=function M(d,s,C,h){return d.triggers.some(a=>m.matchKey(a,s,C,h))},i.formatTriggers=I,i.format=function l(d,s=""){const C=d.description||(0,o.Mk)(s);return(0,o.GW)(C,{triggers:"<i>"+I(d)+"</i>"})},i.Trigger=m,i.TriggerKey=function u(d,s){return m.create(void 0,s,d)},(d=m=i.Trigger||(i.Trigger={})).create=function s(S,D,R){return{buttons:S,modifiers:D,code:R}},d.Empty={},d.match=function C(S,D,R){const{buttons:f,modifiers:p}=S;return void 0!==f&&(f===D||e.qt.has(f,D))&&(!p||e.Fs.areEqual(p,R))},d.matchKey=function h(S,D,R,f){const{modifiers:p,code:E}=S;return void 0!==E&&(E===D||1===E.length&&4===D.length&&D.startsWith("Key")&&!!f&&1===f.length&&f.toUpperCase()===E.toUpperCase())&&(!p||e.Fs.areEqual(p,R))},d.format=function a(S){const D=[],R=function A(i,v){const O=[];return void 0!==i||v?0===i?O.push("mouse hover"):void 0!==i&&(t.has(i,t.Flag.Primary)&&O.push("left mouse button"),t.has(i,t.Flag.Secondary)&&O.push("right mouse button"),t.has(i,t.Flag.Auxilary)&&O.push("wheel/middle mouse button"),t.has(i,t.Flag.Forth)&&O.push("three fingers")):O.push("any mouse button"),O.join(" + ")}(S.buttons,S.code);R&&D.push(R);const f=function c(i){return i?.startsWith("Key")&&(i=i.substring(3)),i&&(0,o.Hh)(i).toLowerCase()}(S.code);f&&D.push(f);const p=function y(i,v){const O=[];return i?(i.alt&&O.push("alt key"),i.control&&O.push("control key"),i.meta&&O.push("meta/command key"),i.shift&&O.push("shift key"),v&&0===O.length&&O.push("no key")):v&&O.push("any key"),O.join(" + ")}(S.modifiers);return p&&D.push(p),D.join(" + ")}}(r||(r={}));const t=e.qt},9455:(tn,Ue,n)=>{"use strict";var e,o;n.d(Ue,{N:()=>e}),(o=e||(e={})).create=function r(y){return y},o.has=function t(y,c){return!!(y&c)},o.hasAll=function A(y,c){return!!c&&(y&c)===c}},9390:(tn,Ue,n)=>{"use strict";n.d(Ue,{B:()=>A});var e=n(4369),o=n(4490),r=n(8277),t=n(7785);function A(){}!function(y){y.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},y.Params={variant:r.t.Select("pixel",r.t.arrayToOptions(["instance","pixel"])),objects:r.t.ObjectList({type:r.t.Select("plane",r.t.objectToOptions(y.Type,I=>(0,t.Mk)(I))),invert:r.t.Boolean(!1),position:r.t.Vec3((0,e.eB)()),rotation:r.t.Group({axis:r.t.Vec3(e.eB.create(1,0,0)),angle:r.t.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:r.t.Vec3(e.eB.create(1,1,1))},I=>(0,t.Mk)(I.type))};const i=(0,e.k)(),v=(0,e.k)(),O=(0,e.eB)(),b=(0,e.eB)();y.getClip=function _(I,l){const m=I.objects.length,{type:u,invert:d,position:s,rotation:C,scale:h}=l?.objects||function c(I){return{count:0,type:new Array(I).fill(1),invert:new Array(I).fill(!1),position:new Array(3*I).fill(0),rotation:new Array(4*I).fill(0),scale:new Array(3*I).fill(1)}}(m);for(let a=0;a<m;++a){const S=I.objects[a];u[a]=y.Type[S.type],d[a]=S.invert,e.eB.toArray(S.position,s,3*a),e.k.toArray(e.k.setAxisAngle(i,S.rotation.axis,(0,o.pu)(S.rotation.angle)),C,4*a),e.eB.toArray(S.scale,h,3*a)}return{variant:I.variant,objects:{count:m,type:u,invert:d,position:s,rotation:C,scale:h}}},y.areEqual=function M(I,l){if(I.variant!==l.variant||I.objects.count!==l.objects.count)return!1;const m=I.objects,u=l.objects;for(let d=0,s=m.count;d<s;++d)if(m.invert[d]!==u.invert[d]||m.type[d]!==u.type[d]||(e.eB.fromArray(O,m.position,3*d),e.eB.fromArray(b,u.position,3*d),!e.eB.equals(O,b))||(e.eB.fromArray(O,m.scale,3*d),e.eB.fromArray(b,u.scale,3*d),!e.eB.equals(O,b))||(e.k.fromArray(i,m.rotation,4*d),e.k.fromArray(v,u.rotation,4*d),!e.k.equals(i,v)))return!1;return!0}}(A||(A={}))},3057:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ak:()=>c,Q1:()=>r,Q5:()=>t,_j:()=>y,qM:()=>i});var e=n(7551),o=n(9083);function r(v){return v}function t(v,O,b,_){return{label:v,description:b,list:_,type:O}}function y(v){return v}function c(v,O,b){const _={};for(const M in v){let I=v[M];I=r.saturate(I,O),I=r.darken(I,-b),_[M]=I}return _}function i(v){return v}!function(v){function d(W,te,de){return W<<16|te<<8|de}function s(W,te,de){return 255*W<<16|255*te<<8|255*de}function p(W){const te=W>>16&255;return te!==(W>>8&255)||te!==(255&W)}v.toStyle=function O(W){return`rgb(${W>>16&255}, ${W>>8&255}, ${255&W})`},v.toHexStyle=function b(W){return"#"+("000000"+W.toString(16)).slice(-6)},v.toHexString=function _(W){return"0x"+("000000"+W.toString(16)).slice(-6)},v.toRgbString=function M(W){return`RGB: ${v.toRgb(W).join(", ")}`},v.toRgb=function I(W){return[W>>16&255,W>>8&255,255&W]},v.toRgbNormalized=function l(W){return[(W>>16&255)/255,(W>>8&255)/255,(255&W)/255]},v.fromHexStyle=function m(W){return parseInt(W.replace("#","0x"))},v.fromHexString=function u(W){return parseInt(W)},v.fromRgb=d,v.fromNormalizedRgb=s,v.fromArray=function C(W,te){return d(W[te],W[te+1],W[te+2])},v.fromNormalizedArray=function h(W,te){return s(W[te],W[te+1],W[te+2])},v.toArray=function a(W,te,de){return te[de]=W>>16&255,te[de+1]=W>>8&255,te[de+2]=255&W,te},v.toArrayNormalized=function S(W,te,de){return te[de]=(W>>16&255)/255,te[de+1]=(W>>8&255)/255,te[de+2]=(255&W)/255,te},v.toVec3=function D(W,te){return W[0]=te>>16&255,W[1]=te>>8&255,W[2]=255&te,W},v.toVec3Normalized=function R(W,te){return W[0]=(te>>16&255)/255,W[1]=(te>>8&255)/255,W[2]=(255&te)/255,W},v.interpolate=function f(W,te,de){const ye=W>>16&255,j=W>>8&255,Z=255&W;return ye+((te>>16&255)-ye)*de<<16|j+((te>>8&255)-j)*de<<8|Z+((255&te)-Z)*de},v.hasHue=p;const E=[0,0,0];function T(W,te){return p(W)?(e.G.fromColor(E,W),e.G.toColor(e.G.saturate(E,E,te))):W}v.saturate=T,v.desaturate=function L(W,te){return T(W,-te)};const w=[0,0,0];function Q(W,te){return o.E.fromColor(w,W),o.E.toColor(o.E.darken(w,w,te))}function V(W){return W<=.03928?W/12.92:Math.pow((W+.055)/1.055,2.4)}function U(W){return.2126*V((W>>16&255)/255)+.7152*V((W>>8&255)/255)+.0722*V((255&W)/255)}function k(W){return W<.04045?.0773993808*W:Math.pow(.9478672986*W+.0521327014,2.4)}function $(W){return W<.0031308?12.92*W:1.055*Math.pow(W,.41666)-.055}v.darken=Q,v.lighten=function G(W,te){return Q(W,-te)},v.luminance=U,v.contrast=function N(W,te){const de=U(W),ye=U(te);return de>ye?(de+.05)/(ye+.05):(ye+.05)/(de+.05)},v.sRGBToLinear=function H(W){return s(k((W>>16&255)/255),k((W>>8&255)/255),k((255&W)/255))},v.linearToSRGB=function J(W){return s($((W>>16&255)/255),$((W>>8&255)/255),$((255&W)/255))}}(r||(r={}))},190:(tn,Ue,n)=>{"use strict";n.d(Ue,{Q1:()=>e.Q1,_j:()=>e._j,wC:()=>o.w});var e=n(3057),o=n(6412)},1907:(tn,Ue,n)=>{"use strict";n.d(Ue,{CL:()=>A,JA:()=>i,Qx:()=>y,VI:()=>r,cG:()=>c});var e=n(3057),o=n(7785);const r={"orange-red":(0,e.Q5)("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":(0,e.Q5)("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":(0,e.Q5)("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:(0,e.Q5)("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":(0,e.Q5)("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":(0,e.Q5)("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":(0,e.Q5)("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:(0,e.Q5)("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":(0,e.Q5)("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:(0,e.Q5)("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":(0,e.Q5)("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:(0,e.Q5)("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":(0,e.Q5)("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:(0,e.Q5)("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":(0,e.Q5)("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":(0,e.Q5)("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:(0,e.Q5)("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":(0,e.Q5)("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:(0,e.Q5)("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":(0,e.Q5)("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":(0,e.Q5)("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":(0,e.Q5)("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":(0,e.Q5)("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":(0,e.Q5)("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":(0,e.Q5)("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":(0,e.Q5)("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":(0,e.Q5)("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":(0,e.Q5)("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:(0,e.Q5)("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":(0,e.Q5)("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":(0,e.Q5)("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":(0,e.Q5)("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:(0,e.Q5)("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":(0,e.Q5)("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":(0,e.Q5)("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":(0,e.Q5)("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:(0,e.Q5)("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:(0,e.Q5)("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:(0,e.Q5)("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:(0,e.Q5)("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:(0,e.Q5)("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:(0,e.Q5)("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:(0,e.Q5)("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:(0,e.Q5)("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":(0,e.Q5)("Red-White-Blue","diverging","",[12526114,16777215,3367393])},A=Object.keys(r).map(v=>[v,r[v].label,(0,o.ZH)(r[v].type)]),y=A.filter(v=>"diverging"===r[v[0]].type||"sequential"===r[v[0]].type),c=A.filter(v=>"qualitative"===r[v[0]].type);function i(v){return v in r?r[v]:(console.warn(`unknown color list named '${v}'`),r["red-yellow-blue"])}},2745:(tn,Ue,n)=>{"use strict";n.d(Ue,{s:()=>o});const o=(0,n(3057)._j)({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});!function(){const t=new Map;Object.keys(o).forEach(A=>{t.set(o[A],A)})}()},7809:(tn,Ue,n)=>{"use strict";n.d(Ue,{S:()=>S,U:()=>C});var e=n(2293),o=n(8277),r=n(9083),t=n(7551),A=n(9359),y=n(9909),c=n(2745);const i={hue:o.t.Interval([1,360],{min:0,max:360,step:1}),chroma:o.t.Interval([40,70],{min:0,max:100,step:1}),luminance:o.t.Interval([15,85],{min:0,max:100,step:1}),sort:o.t.Select("contrast",o.t.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:o.t.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:o.t.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:o.t.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},v=2,O=[0,0,0],b=[0,0,0];function _(D,R){return r.E.toHcl(O,D),r.E.fromColor(b,r.E.toColor(D)),O[0]>=R.hue[0]&&O[0]<=R.hue[1]&&O[1]>=R.chroma[0]&&O[1]<=R.chroma[1]&&O[2]>=R.luminance[0]&&O[2]<=R.luminance[1]&&b[0]>=D[0]-v&&b[0]<=D[0]+v&&b[1]>=D[1]-v&&b[1]<=D[1]+v&&b[2]>=D[2]-v&&b[2]<=D[2]+v}function l(D,R){let f=1/0,p=0;for(let E=0;E<D.length;E++){const T=r.E.distance(R,D[E]);T<f&&(f=T,p=E)}return p}var u=n(1907),d=n(6412);const s={type:"generate",colorList:"red-yellow-blue"};function C(D={}){const R={...s,...D};return{palette:o.t.MappedStatic(R.type,{colors:o.t.Group({list:o.t.ColorList(R.colorList)},{isFlat:!0}),generate:o.t.Group({...i,maxCount:o.t.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}o.t.getDefaultValues(C());const a={valueLabel:D=>`${D+1}`,minLabel:"Start",maxLabel:"End"};function S(D,R,f={}){var p;let E,T;if("colors"===R.palette.name&&"interpolate"===R.palette.params.list.kind){const{list:L}=R.palette.params,w=[0,D-1],{minLabel:Q,maxLabel:G}={...a,...f};let V=L.colors;0===V.length&&(V=(0,u.JA)(s.colorList).list);const U=d.w.create({listOrName:V,domain:w,minLabel:Q,maxLabel:G});T=U.legend,E=U.color}else{let L;"colors"===R.palette.name?(L=R.palette.params.list.colors.map(V=>Array.isArray(V)?V[0]:V),0===L.length&&(L=(0,u.JA)("dark-2").list.map(V=>Array.isArray(V)?V[0]:V))):(D=Math.min(D,R.palette.params.maxCount),L=function m(D,R={}){const f={...o.t.getDefaultValues(i),...R};if(D<=0)return[];const p=function I(D,R){const f=new Map,p=Math.ceil(Math.cbrt(D)),E=(0,t.G)(),T=Math.max((R.hue[1]-R.hue[0])/p,1),L=Math.max((R.chroma[1]-R.chroma[0])/p,1),w=Math.max((R.luminance[1]-R.luminance[0])/p,1);for(let Q=R.hue[0]+T/2;Q<=R.hue[1];Q+=T)for(let G=R.chroma[0]+L/2;G<=R.chroma[1];G+=L)for(let V=R.luminance[0]+w/2;V<=R.luminance[1];V+=w){const U=r.E.fromHcl((0,r.E)(),t.G.set(E,Q,G,V));_(U,R)&&f.set(r.E.toColor(U),U)}return Array.from(f.values())}(Math.max(f.minSampleCount,D*f.sampleCountFactor),f);if(p.length<D)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(D).fill(c.s.lightgrey);const E=[],T=[],L=Math.floor(p.length/D);for(let Q=0;Q<p.length&&(E.push(p[Q]),T.push([]),!(E.length>=D));Q+=L);for(let Q=1;Q<=f.clusteringStepCount;++Q){const G=(0,A.Go)(T),V=(0,A.Go)(p);for(let N=0;N<E.length;++N){const k=l(V,E[N]);G[N].push(p[k]),V.splice(k,1)}for(let N=0;N<V.length;++N)G[l(E,p[N])].push(p[N]);const U=(0,A.Go)(E);for(let N=0;N<G.length;++N){const k=G[N],H=k.length;if(0===H)continue;let $=0,J=0,W=0;for(const j of k)$+=j[0],J+=j[1],W+=j[2];E[N]=[$/H,J/H,W/H]}if((0,y.bD)(U,E))break}return("contrast"===f.sort?function M(D){const R=D.slice(0),f=[R.shift()];for(;R.length>0;){const p=f[f.length-1];let E=0,T=Number.NEGATIVE_INFINITY;for(let L=0;L<R.length;++L){const w=r.E.distance(p,R[L]);w>T&&(T=w,E=L)}f.push(R.splice(E,1)[0])}return f}(E):E).map(Q=>r.E.toColor(Q))}(D,R.palette.params));const w=null!==(p=f.valueLabel)&&void 0!==p?p:a.valueLabel,Q=L.length,G=[];for(let V=0;V<D;++V){const U=V%Q;void 0===G[U]?G[U]=[w(V),L[U]]:G[U][0]+=`, ${w(V)}`}T=(0,e.h)(G),E=V=>L[V%Q]}return{color:E,legend:T}}},6412:(tn,Ue,n)=>{"use strict";n.d(Ue,{w:()=>i});var e=n(3057),o=n(1907),r=n(9909),t=n(2293),A=n(3543),y=n(127);const c={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""};var i;(i||(i={})).create=function O(b){const{domain:_,reverse:M,listOrName:I}={...c,...b},l="string"==typeof I?(0,o.JA)(I).list:I,m=M?l.slice().reverse():l,u=m.length-1;let d=0,s=0,C=0;function h(f,p){s=f,C=p,d=C-s||1}h(_[0],_[1]);const a=(0,r.NT)(b.minLabel,s.toString()),S=(0,r.NT)(b.maxLabel,C.toString());let D;if(m.every(f=>Array.isArray(f))){const f=[...m];f.sort((L,w)=>L[1]-w[1]);const p=f.map(L=>L[0]),E=A.SortedArray.ofSortedArray(f.map(L=>L[1])),T=p.length-1;D=L=>{const w=(0,y.qE)((L-s)/d,0,1),Q=A.SortedArray.findPredecessorIndex(E,w);if(0===Q)return p[s];if(Q>T)return p[T];const G=E[Q-1],U=(0,y.qE)((w-G)/(E[Q]-G),0,1);return e.Q1.interpolate(p[Q-1],p[Q],U)}}else D=f=>{const p=Math.min(m.length-1,Math.max(0,(f-s)/d*u)),E=Math.floor(p),T=m[E],L=m[Math.ceil(p)];return e.Q1.interpolate(T,L,p-E)};return{color:D,colorToArray:(f,p,E)=>{e.Q1.toArray(D(f),p,E)},normalizedColorToArray:(f,p,E)=>{e.Q1.toArrayNormalized(D(f),p,E)},setDomain:h,get legend(){return(0,t.A)(a,S,m)}}}},7551:(tn,Ue,n)=>{"use strict";n.d(Ue,{G:()=>r});var e=n(4490),o=n(9083);function r(){return r.zero()}!function(t){function A(){const a=[.1,0,0];return a[0]=0,a}t.zero=A,t.create=function y(a,S,D){const R=A();return R[0]=a,R[1]=S,R[2]=D,R},t.set=function c(a,S,D,R){return a[0]=S,a[1]=D,a[2]=R,a},t.hasHue=function i(a){return!isNaN(a[0])};const v=[0,0,0];t.fromColor=function O(a,S){return o.E.toHcl(a,o.E.fromColor(v,S))},t.fromLab=function b(a,S){return o.E.toHcl(a,S)};const _=[0,0,0];function I(a,S){let[D,R,f]=S;return isNaN(D)&&(D=0),D=(0,e.pu)(D),a[0]=f,a[1]=Math.cos(D)*R,a[2]=Math.sin(D)*R,a}function m(a,S,D){return a[0]=S[0],a[1]=Math.max(0,S[1]+h*D),a[2]=S[2],a}t.toColor=function M(a){return o.E.toColor(I(_,a))},t.toLab=I,t.copy=function l(a,S){return a[0]=S[0],a[1]=S[1],a[2]=S[2],a},t.saturate=m,t.desaturate=function u(a,S,D){return m(a,S,-D)};const d=[0,0,0];function s(a,S,D){return I(d,S),o.E.toHcl(a,o.E.darken(d,d,D))}t.darken=s,t.lighten=function C(a,S,D){return s(a,S,-D)};const h=18}(r||(r={}))},9083:(tn,Ue,n)=>{"use strict";n.d(Ue,{E:()=>A});var e=n(3057),o=n(7551),r=n(4490),t=n(127);function A(){return A.zero()}!function(y){function c(){const V=[.1,0,0];return V[0]=0,V}function I(V,U){const[N,k,H]=U,$=Math.sqrt(k*k+H*H);let J=((0,r.H)(Math.atan2(H,k))+360)%360;return 0===Math.round(1e4*$)&&(J=Number.NaN),V[0]=J,V[1]=$,V[2]=N,V}function m(V,U,N){return V[0]=U[0]-h*N,V[1]=U[1],V[2]=U[2],V}y.zero=c,y.create=function i(V,U,N){const k=c();return k[0]=V,k[1]=U,k[2]=N,k},y.set=function v(V,U,N,k){return V[0]=U,V[1]=N,V[2]=k,V},y.distance=function O(V,U){const N=U[0]-V[0],k=U[1]-V[1],H=U[2]-V[2];return Math.sqrt(N*N+k*k+H*H)},y.fromColor=function b(V,U){const[N,k,H]=e.Q1.toRgb(U),[$,J,W]=function G(V,U,N){return[Q((.4124564*(V=w(V))+.3575761*(U=w(U))+.1804375*(N=w(N)))/a),Q((.2126729*V+.7151522*U+.072175*N)/S),Q((.0193339*V+.119192*U+.9503041*N)/D)]}(N,k,H),te=116*J-16;return V[0]=te<0?0:te,V[1]=500*($-J),V[2]=200*(J-W),V},y.fromHcl=function _(V,U){return o.G.toLab(V,U)},y.toColor=function M(V){let U=(V[0]+16)/116,N=isNaN(V[1])?U:U+V[1]/500,k=isNaN(V[2])?U:U-V[2]/200;U=S*L(U),N=a*L(N),k=D*L(k);const H=T(3.2404542*N-1.5371385*U-.4985314*k),$=T(-.969266*N+1.8760108*U+.041556*k),J=T(.0556434*N-.2040259*U+1.0572252*k);return e.Q1.fromRgb(Math.round((0,t.qE)(H,0,255)),Math.round((0,t.qE)($,0,255)),Math.round((0,t.qE)(J,0,255)))},y.toHcl=I,y.copy=function l(V,U){return V[0]=U[0],V[1]=U[1],V[2]=U[2],V},y.darken=m,y.lighten=function u(V,U,N){return m(V,U,-N)};const d=[0,0,0];function s(V,U,N){return I(d,U),o.G.toLab(V,o.G.saturate(d,d,N))}y.saturate=s,y.desaturate=function C(V,U,N){return s(V,U,-N)};const h=18,a=.95047,S=1,D=1.08883,R=.137931034,f=.206896552,p=.12841855,E=.008856452;function T(V){return 255*(V<=.00304?12.92*V:1.055*Math.pow(V,1/2.4)-.055)}function L(V){return V>f?V*V*V:p*(V-R)}function w(V){return(V/=255)<=.04045?V/12.92:Math.pow((V+.055)/1.055,2.4)}function Q(V){return V>E?Math.pow(V,1/3):V/p+R}}(A||(A={}))},3188:(tn,Ue,n)=>{"use strict";n.d(Ue,{Ui:()=>w,dH:()=>O,hW:()=>b});var e=n(467),o=n(275),r=n(4824),t=n(1861),A=n(8484),y=n(6985),c=function(N){return N[N.None=0]="None",N[N.Gzip=1]="Gzip",N[N.Zip=2]="Zip",N}(c||{});function O(N,k){return function h(N,k){if(A.K0)return function a(N,k){return r.YZ.create("Read File",function(){var H=(0,e.A)(function*($){const J="zip"===k?c.None:l(N.name);let W;return yield $.update({message:"Opening file...",canAbort:!1}),W="binary"===k||"zip"===k||J!==c.None?yield N.arrayBuffer():yield N.text(),yield $.update({message:"Processing file...",canAbort:!1}),yield s($,W,k,J)});return function($){return H.apply(this,arguments)}}())}(N,k);let H;return r.YZ.create("Read File",function(){var $=(0,e.A)(function*(J){try{H=new FileReader;const W="zip"===k?c.None:l(N.name);"binary"===k||"zip"===k||W!==c.None?H.readAsArrayBuffer(N):H.readAsText(N),yield J.update({message:"Opening file...",canAbort:!0});const te=yield I(J,"Reading...",H);return yield J.update({message:"Processing file...",canAbort:!1}),yield s(J,te.result,k,W)}finally{H=void 0}});return function(J){return $.apply(this,arguments)}}(),()=>{H&&H.abort()})}(N,k)}function b(N){return"string"==typeof N?f(N,N,"string"):f(N.title,N.url,N.type||"string",N.body,N.headers)}function M(N){return N?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function I(N,k,H){return new Promise(($,J)=>{if(function _(N){if(!A.K0&&N instanceof FileReader)return N.readyState===FileReader.DONE;if(N instanceof A.En)return N.readyState===A.En.DONE;throw new Error("unknown data type")}(H)){const{error:te}=H;return void(null!=te?J(te??M(H instanceof A.En)):$(H))}let W=!1;H.onerror=te=>{if(W)return;const{error:de}=te.target;J(de??M(H instanceof A.En))},H.onprogress=te=>{if(N.shouldUpdate&&!W)try{N.update(te.lengthComputable?{message:k,isIndeterminate:!1,current:te.loaded,max:te.total}:{message:`${k} ${(te.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(de){W=!0,J(de)}},H.onload=te=>{$(H)}})}function l(N){return/\.gz$/i.test(N)?c.Gzip:/\.zip$/i.test(N)?c.Zip:c.None}const m=/^(__MACOSX|.DS_Store)/;function d(){return(d=(0,e.A)(function*(N,k,H){switch(H){case c.None:return k;case c.Gzip:return(0,y.Aq)(N,k);case c.Zip:const $=yield(0,y.$1)(N,k.buffer),J=Object.keys($).filter(W=>!m.test(W));if(1!==J.length)throw new Error("can only decompress zip files with a single entry");return $[J[0]]}})).apply(this,arguments)}function s(N,k,H,$){return C.apply(this,arguments)}function C(){return C=(0,e.A)(function*(N,k,H,$){let J=k instanceof ArrayBuffer?new Uint8Array(k):k;if(null===J)throw new Error("no data given");if($!==c.None){if(!(J instanceof Uint8Array))throw new Error("need Uint8Array for decompression");const W=yield function u(N,k,H){return d.apply(this,arguments)}(N,J,$);"string"===H?(yield N.update({message:"Decoding text..."}),J=(0,o.ss)(W,0,W.length)):J=W}if("binary"===H&&J instanceof Uint8Array)return J;if("zip"===H&&J instanceof Uint8Array)return yield(0,y.$1)(N,J.buffer);if("string"===H&&"string"==typeof J)return J;if("xml"===H&&"string"==typeof J)return(new DOMParser).parseFromString(J,"application/xml");if("json"===H&&"string"==typeof J)return JSON.parse(J);throw new Error(`could not get requested response data '${H}'`)}),C.apply(this,arguments)}let p,S=(()=>{class N{static get(){return this.pool.length?this.pool.pop():new A.En}static emptyFunc(){}static deposit(H){this.pool.length<this.poolSize&&(H.onabort=N.emptyFunc,H.onerror=N.emptyFunc,H.onload=N.emptyFunc,H.onprogress=N.emptyFunc,this.pool.push(H))}}return N.pool=[],N.poolSize=15,N})();function f(N,k,H,$,J){if(A.K0&&k.startsWith("file://"))return function L(N,k,H,$,J){if(!A.K0)throw new Error("This function should only be used when running in Node.js");if(!k.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");const W=k.substring(7),te=function E(){if(!p)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return p}().readFileSync(W);return O(new A.em([te],"raw-data"),H)}(0,k,H);let W;return r.YZ.create(N||"Download",function(){var te=(0,e.A)(function*(de){if(W=S.get(),W.open($?"post":"get",k,!0),J)for(const[Z,q]of J)W.setRequestHeader(Z,q);W.responseType=function R(N){switch(N){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":case"zip":return"arraybuffer"}}(H),W.send($),yield de.update({message:"Waiting for server...",canAbort:!0});const ye=yield I(de,"Downloading...",W);return W=void 0,yield de.update({message:"Parsing response...",canAbort:!1}),function D(N,k){if(N.status>=200&&N.status<400){const{response:H}=N;if(S.deposit(N),("binary"===k||"zip"===k)&&H instanceof ArrayBuffer)return new Uint8Array(H);if("string"===k&&"string"==typeof H)return H;if("xml"===k&&H instanceof XMLDocument)return H;if("json"===k&&"object"==typeof H)return H;throw new Error(`could not get requested response data '${k}'`)}throw S.deposit(N),new Error(`Download failed with status code ${N.status}`)}(ye,H)});return function(de){return te.apply(this,arguments)}}(),()=>{W&&(W.abort(),W=void 0)})}function w(N,k,H,$){return Q.apply(this,arguments)}function Q(){return(Q=(0,e.A)(function*(N,k,H,$){const J=H.length,W=new Array(H.length);yield N.update({message:"Downloading...",current:0,max:J});let te=[],de=[],ye=0;for(let Z=Math.min(J,$);ye<Z;ye++){const q=H[ye];te.push(V(ye,q.id,k.resolve(t.V.getUrlAsset(k,q.url),q.isBinary?"binary":"string").runAsChild(N))),de.push(ye)}let j=0;for(;te.length>0;){const Z=yield Promise.race(te),q=H[Z.index],Y=de.indexOf(Z.index);if(j++,"error"===Z.kind&&!q.canFail)throw new Error(`${q.url}: ${Z.error}`);if(N.shouldUpdate&&(yield N.update({message:"Downloading...",current:j,max:J})),W[Z.index]=Z,te=te.filter(G,Y),de=de.filter(G,Y),ye<J){const ee=H[ye],g=k.resolve(t.V.getUrlAsset(k,ee.url),ee.isBinary?"binary":"string").runAsChild(N);te.push(V(ye,ee.id,g)),de.push(ye),ye++}}return W})).apply(this,arguments)}function G(N,k){return this!==k}function V(N,k,H){return U.apply(this,arguments)}function U(){return(U=(0,e.A)(function*(N,k,H){try{return{kind:"ok",result:yield H,index:N,id:k}}catch($){return{kind:"error",error:$,index:N,id:k}}})).apply(this,arguments)}},2629:(tn,Ue,n)=>{"use strict";n.d(Ue,{Bb:()=>o,EF:()=>v,Zq:()=>e,fv:()=>i,g$:()=>r});let e=function(){try{return!0}catch{return!1}}(),o=function(){try{const _=process.env.DEBUG;return"*"===_||"molstar"===_}catch{return!1}}(),r=!1;const c=[];function i(b){c.includes(b)||c.push(b)}function v(b){const _=c.indexOf(b);-1!==_&&c.splice(_,1)}},2732:(tn,Ue,n)=>{"use strict";function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{const y=document.createEvent("MouseEvents");y.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(y)}}function r(t,A="download"){if(t)if("download"in HTMLAnchorElement.prototype){const y=document.createElement("a");y.download=A,y.rel="noopener","string"==typeof t?(y.href=t,o(y)):(y.href=URL.createObjectURL(t),setTimeout(()=>URL.revokeObjectURL(y.href),4e4),setTimeout(()=>o(y)))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,A);else{const y=window.navigator.userAgent,c=/Safari/i.test(y),i=/CriOS\/[\d]+/.test(y),v=O=>{!function e(t){window.open(t,"_blank")||(window.location.href=t)}(i?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((c||i)&&FileReader)if(t instanceof Blob){const O=new FileReader;O.onloadend=()=>v(O.result),O.readAsDataURL(t)}else v(t);else{const O=URL.createObjectURL("string"==typeof t?new Blob([t]):t);location.href=O,setTimeout(()=>URL.revokeObjectURL(O),4e4)}}}n.d(Ue,{R:()=>r})},8361:(tn,Ue,n)=>{"use strict";n.d(Ue,{h:()=>t});class e{constructor(y,c){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=y,this.value=c,this.prev=this,this.next=this}}const r=new class o{constructor(y){if(this._index=-1,this._items=[],this._len=0,y){let c=y,i=0;do{this._items[i++]=c,c=c.next}while(y!==c);this._len=i}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(y){this._index=-1,this._len=0;let c=y,i=0;do{this._items[i++]=c,c=c.next}while(y!==c);this._len=i}};class t{constructor(y){this._minNode=null,this._nodeCount=0,this._compare=y||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(y,c){if(!y)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:c},{key:y.key})>0)throw new Error("New key is larger than old key");y.key=c;const i=y.parent;i&&this._compare(y,i)<0&&(this._cut(y,i,this._minNode),this._cascadingCut(i,this._minNode)),this._compare(y,this._minNode)<0&&(this._minNode=y)}delete(y){const c=y.parent;c&&(this._cut(y,c,this._minNode),this._cascadingCut(c,this._minNode)),this._minNode=y,this.extractMinimum()}extractMinimum(){const y=this._minNode;if(y){if(y.child){let i=y.child;do{i.parent=null,i=i.next}while(i!==y.child)}let c=null;y.next!==y&&(c=y.next),this._removeNodeFromList(y),this._nodeCount--,this._minNode=this._mergeLists(c,y.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return y}findMinimum(){return this._minNode}insert(y,c){const i=new e(y,c);return this._minNode=this._mergeLists(this._minNode,i),this._nodeCount++,i}isEmpty(){return null===this._minNode}size(){return null===this._minNode?0:this._getNodeListSize(this._minNode)}union(y){this._minNode=this._mergeLists(this._minNode,y._minNode),this._nodeCount+=y._nodeCount}_defaultCompare(y,c){return y.key>c.key?1:y.key<c.key?-1:0}_cut(y,c,i){y.parent=null,c.degree--,c.child=y.next===y?null:y.next,this._removeNodeFromList(y);const v=this._mergeLists(i,y);return y.isMarked=!1,v}_cascadingCut(y,c){const i=y.parent;return i&&(y.isMarked?(c=this._cut(y,i,c),c=this._cascadingCut(i,c)):y.isMarked=!0),c}_consolidate(y){const c=[];for(r.reset(y);r.hasNext();){let v=r.next(),O=c[v.degree];for(;O;){if(this._compare(v,O)>0){const b=v;v=O,O=b}this._linkHeaps(O,v),c[v.degree]=null,v.degree++,O=c[v.degree]}c[v.degree]=v}let i=null;for(let v=0;v<c.length;v++){const O=c[v];O&&(O.next=O,O.prev=O,i=this._mergeLists(i,O))}return i}_removeNodeFromList(y){const c=y.prev,i=y.next;c.next=i,i.prev=c,y.next=y,y.prev=y}_linkHeaps(y,c){this._removeNodeFromList(y),c.child=this._mergeLists(y,c.child),y.parent=c,y.isMarked=!1}_mergeLists(y,c){if(!y)return c||null;if(!c)return y;const i=y.next;return y.next=c.next,y.next.prev=y,c.next=i,c.next.prev=c,this._compare(y,c)<0?y:c}_getNodeListSize(y){let c=0,i=y;do{c++,i.child&&(c+=this._getNodeListSize(i.child)),i=i.next}while(i!==y);return c}}},675:(tn,Ue,n)=>{"use strict";n.d(Ue,{o:()=>o});const e=["gz","zip"];function o(r){let t=r,A="";const y=t.lastIndexOf("?"),c=-1!==y?t.substring(y):"";t=t.substring(0,-1===y?t.length:y);const i=t.replace(/^.*[\\/]/,"");let v=i.substring(0,i.lastIndexOf("."));const O=i.split(".");let b=O.length>1?(O.pop()||"").toLowerCase():"";const _=t.match(/^(.+):\/\/(.+)$/);_&&(A=_[1].toLowerCase(),t=_[2]||"");const M=t.substring(0,t.lastIndexOf("/")+1);return e.includes(b)&&(b=(t.substr(0,t.length-b.length-1).split(".").pop()||"").toLowerCase(),v=v.substr(0,v.length-b.length-1)),{path:t,name:i,ext:b,base:v,dir:M,protocol:A,query:c}}},7778:(tn,Ue,n)=>{"use strict";function e(o=0,r=Number.MAX_SAFE_INTEGER){let t=o;return()=>{const A=t;return t=(t+1)%r,A}}n.d(Ue,{q:()=>e})},2775:(tn,Ue,n)=>{"use strict";var e,o;n.d(Ue,{N:()=>e}),(o=e||(e={})).create=function r(y,c,i){return{array:y,width:c,height:i}},o.flipY=function t(y){const{array:c,width:i,height:v}=y,b=i*(c.length/(i*v));for(let _=0,M=v/2;_<M;++_)for(let I=0,l=b;I<l;++I){const m=_*b+I,u=(v-_-1)*b+I,d=c[m];c[m]=c[u],c[u]=d}return y},o.divideByAlpha=function A(y){const{array:c}=y,i=c instanceof Uint8Array?255:1;for(let v=0,O=c.length;v<O;v+=4){const b=c[v+3]/i;c[v]/=b,c[v+1]/=b,c[v+2]/=b}return y}},9909:(tn,Ue,n)=>{"use strict";n.d(Ue,{NJ:()=>e.N,fe:()=>o.f,kk:()=>r.k,xv:()=>c.xv,IQ:()=>c.IQ,af:()=>O,bD:()=>_,NT:()=>m,fU:()=>R,lQ:()=>i,bN:()=>M,f8:()=>I});var y,e=n(9455),o=n(9115),r=n(3559);function t(E,T){return E-T}!function(E){class T{has(te){return!1}forEach(te,de){return de}constructor(){this.size=0}}class L{has(te){return te===this.idx}forEach(te,de){return te(this.idx,de),de}constructor(te){this.idx=te,this.size=1}}class w{has(te){return te<this.length&&!!this.mask[te]}_forEach(te,de){for(let ye=0;ye<this.length;ye++)this.mask[ye]&&te(ye,de)}forEach(te,de){return this._forEach(te,de),de}constructor(te,de){this.mask=te,this.size=de,this.length=te.length}}class Q{has(te){return!0}_forEach(te,de){for(let ye=0;ye<this.size;ye++)te(ye,de)}forEach(te,de){return this._forEach(te,de),de}constructor(te){this.size=te}}class G{has(te){return this.set.has(te)}_forEach(te,de){for(const ye of this.flatten())te(ye,de)}flatten(){if(this._flat)return this._flat;const te=new Int32Array(this.size);let de=0;return this.set.forEach(ye=>te[de++]=ye),function A(E){Array.prototype.sort.call(E,t)}(te),this._flat=te,this._flat}forEach(te,de){return this._forEach(te,de),de}constructor(te){this.set=te,this._flat=void 0,this.size=te.size}}function U(W){return new G(W)}function H(W,te){return new w(W,te)}E.always=function V(W){return new Q(W)},E.never=new T,E.ofSet=U,E.singleton=function N(W){return new L(W)},E.ofUniqueIndices=function k(W){const te=W.length;if(0===te)return new T;if(1===te)return new L(W[0]);let de=0;for(const Z of W)Z>de&&(de=Z);if(te===de)return new Q(te);if(te/de<1/12){const Z=new Set;for(const q of W)Z.add(q);return new G(Z)}const j=new Int8Array(de+1);for(const Z of W)j[Z]=1;return new w(j,W.length)},E.ofMask=H,E.hasAny=function $(W,te){for(const de of te)if(W.has(de))return!0;return!1},E.complement=function J(W,te){let de=0,ye=0;if(te.forEach(j=>{W.has(j)||(de++,j>ye&&(ye=j))}),de/ye<1/12){const j=new Set;return te.forEach(Z=>{W.has(Z)||j.add(Z)}),U(j)}{const j=new Uint8Array(ye+1);return te.forEach(Z=>{W.has(Z)||(j[Z]=1)}),H(j,de)}}}(y||(y={}));var c=n(7187);const i=function(){};function O(E,T){const L=E.length;if(L!==T.length)return!1;for(let w=0;w<L;w++)if(E[w]!==T[w])return!1;return!0}const b=Object.prototype.hasOwnProperty;function _(E,T){if(E===T)return!0;const L=Array.isArray(E),w=Array.isArray(T);if(L&&w){if(E.length!==T.length)return!1;for(let Q=0;Q<E.length;Q++)if(!_(E[Q],T[Q]))return!1;return!0}if(L!==w)return!1;if(E&&T&&"object"==typeof E&&"object"==typeof T){const Q=Object.keys(E);if(Q.length!==Object.keys(T).length)return!1;const G=E instanceof Date,V=T instanceof Date;if(G&&V)return E.getTime()===T.getTime();if(G!==V)return!1;const U=E instanceof RegExp,N=T instanceof RegExp;if(U&&N)return E.toString()===T.toString();if(U!==N)return!1;for(let k=0;k<Q.length;k++)if(!b.call(T,Q[k]))return!1;for(let k=0;k<Q.length;k++)if(!_(E[Q[k]],T[Q[k]]))return!1;return!0}return!1}function M(E,T){if(E===T)return!0;const L=Array.isArray(E),w=Array.isArray(T);return L&&w?function l(E,T){if(E===T)return!0;if(!E||!T||E.length!==T.length)return!1;for(let L=0,w=E.length;L<w;++L)if(E[L]!==T[L])return!1;return!0}(E,T):L===w&&!(!E||!T||"object"!=typeof E||"object"!=typeof T)&&I(E,T)}function I(E,T){if(E===T)return!0;if(!E||!T)return!1;const L=Object.keys(E);if(Object.keys(T).length!==L.length)return!1;for(const w of L)if(!b.call(E,w)||E[w]!==T[w])return!1;return!0}function m(E,T){return void 0!==E?E:T}function D(E){return(E<10?"0":"")+E}function R(E){const T=E.getHours(),L=E.getMinutes(),w=E.getSeconds();return`${T}:${D(L)}:${D(w)}`}},4080:(tn,Ue,n)=>{"use strict";n.d(Ue,{Fs:()=>v,RN:()=>c,Vl:()=>b,Y7:()=>A,bP:()=>l,qt:()=>O,vq:()=>y});var e=n(1413),o=n(7361),r=n(4369),t=n(9909);function A(u){if("object"==typeof u){if("buttons"in u)return u.buttons;if("which"in u){const d=u.which;if(2===d)return 4;if(3===d)return 2;if(d>0)return 1<<d-1}}return 0}function y(u){if("object"==typeof u&&"button"in u){const d=u.button;if(1===d)return 4;if(2===d)return 2;if(d>=0)return 1<<d}return 0}function c(u){return{alt:"altKey"in u&&u.altKey,shift:"shiftKey"in u&&u.shiftKey,control:"ctrlKey"in u&&u.ctrlKey,meta:"metaKey"in u&&u.metaKey}}const i={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(u,d)=>!0,pixelScale:1};var v,O;!function(u){function d(a,S){return a.shift===S.shift&&a.alt===S.alt&&a.control===S.control&&a.meta===S.meta}function h(a={}){return{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}u.None=h(),u.areEqual=d,u.areNone=function s(a){return d(a,u.None)},u.size=function C(a){if(!a)return 0;let S=0;return a.shift&&S++,a.alt&&S++,a.control&&S++,a.meta&&S++,S},u.create=h}(v||(v={})),function(u){let d;var s;u.has=t.NJ.has,u.create=t.NJ.create,(s=d=u.Flag||(u.Flag={}))[s.None=0]="None",s[s.Primary=1]="Primary",s[s.Secondary=2]="Secondary",s[s.Auxilary=4]="Auxilary",s[s.Forth=8]="Forth",s[s.Five=16]="Five"}(O||(O={}));const b={key:"",code:"",modifiers:v.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:t.lQ};var _=function(u){return u[u.Stopped=0]="Stopped",u[u.Started=1]="Started",u[u.Moving=2]="Moving",u}(_||{});function M(){return{drag:new e.B,interactionEnd:new e.B,click:new e.B,move:new e.B,wheel:new e.B,pinch:new e.B,gesture:new e.B,resize:new e.B,leave:new e.B,enter:new e.B,modifiers:new e.B,key:new e.B,keyUp:new e.B,keyDown:new e.B,lock:new e.B}}const I=["Backspace","Delete"];var l,u;(u=l||(l={})).create=function d(C={}){const{noScroll:h,noContextMenu:a}={...i,...C};return{noScroll:h,noContextMenu:a,pointerLock:!1,width:0,height:0,pixelRatio:1,...M(),setPixelScale:t.lQ,requestPointerLock:t.lQ,exitPointerLock:t.lQ,dispose:t.lQ}},u.fromElement=function s(C,h={}){let{noScroll:a,noContextMenu:D,noPinchZoom:R,noTextSelect:f,mask:p,pixelScale:E,preventGestures:T}={...i,...h},L=C.clientWidth*de(),w=C.clientHeight*de(),Q=!1,G=(0,o.LM)(),V=0,U=0;const N=(0,r.ZY)(),k=(0,r.ZY)(),H=(0,r.ZY)(),$=(0,r.ZY)(),J=(0,r.ZY)(),W={shift:!1,alt:!1,control:!1,meta:!1},te={x:-1,y:-1,pageX:-1,pageY:-1};function de(){return window.devicePixelRatio*E}function ye(){return{...W}}function j(Ot){return Ot.target===document.body||Ot.target===C}let xe,Z=_.Stopped,q=!1,Y=O.create(O.Flag.None),ee=O.Flag.None,g=!1,_e=!1;typeof window.ResizeObserver<"u"&&(xe=new window.ResizeObserver(It));const le=M(),{drag:Ae,interactionEnd:Be,wheel:Ce,pinch:Re,gesture:ke,click:we,move:Oe,leave:Se,enter:Ve,resize:Ne,modifiers:K,key:ne,keyUp:be,keyDown:Te,lock:ie}=le;function ve(){Q=C.ownerDocument.pointerLockElement===C,kt(Q),ie.next(Q)}function ce(){console.error("Unable to use Pointer Lock API"),Q=!1,kt(Q),ie.next(Q)}function se(Ot){p(Ot.clientX,Ot.clientY)&&D&&Ot.preventDefault()}function ae(Ot){W.alt=Ot.altKey,W.shift=Ot.shiftKey,W.control=Ot.ctrlKey,W.meta=Ot.metaKey}function ge(){(Y||W.shift||W.alt||W.meta||W.control)&&(Y=0,W.shift=W.alt=W.control=W.meta=!1)}function Ie(Ot){let An=!1;!W.alt&&Ot.altKey&&(An=!0,W.alt=!0),!W.shift&&Ot.shiftKey&&(An=!0,W.shift=!0),!W.control&&Ot.ctrlKey&&(An=!0,W.control=!0),!W.meta&&Ot.metaKey&&(An=!0,W.meta=!0),An&&g&&K.next(ye()),j(Ot)&&g&&Te.next({key:Ot.key,code:Ot.code,modifiers:ye(),...te,preventDefault:()=>Ot.preventDefault()})}function Le(Ot){let An=!1;W.alt&&!Ot.altKey&&(An=!0,W.alt=!1),W.shift&&!Ot.shiftKey&&(An=!0,W.shift=!1),W.control&&!Ot.ctrlKey&&(An=!0,W.control=!1),W.meta&&!Ot.metaKey&&(An=!0,W.meta=!1),An&&g&&K.next(ye()),I.includes(Ot.key)&&nt(Ot),j(Ot)&&g&&be.next({key:Ot.key,code:Ot.code,modifiers:ye(),...te,preventDefault:()=>Ot.preventDefault()})}function nt(Ot){!j(Ot)||!g||ne.next({key:Ot.key,code:Ot.code,modifiers:ye(),...te,preventDefault:()=>Ot.preventDefault()})}function je(Ot){const An=Ot.touches[0],jn=Ot.touches[1];return{clientX:(An.clientX+jn.clientX)/2,clientY:(An.clientY+jn.clientY)/2,pageX:(An.pageX+jn.pageX)/2,pageY:(An.pageY+jn.pageY)/2,target:Ot.target}}function Lt(Ot){const An=Ot.touches[0].pageX-Ot.touches[1].pageX,jn=Ot.touches[0].pageY-Ot.touches[1].pageY;return Math.sqrt(An*An+jn*jn)}!function ue(){C.addEventListener("contextmenu",se,!1),C.addEventListener("wheel",Gt,!1),C.addEventListener("mousedown",Ke,!1),window.addEventListener("mousemove",ut,!1),window.addEventListener("mouseup",Kt,!1),C.addEventListener("touchstart",mt,!1),C.addEventListener("touchmove",Me,!1),C.addEventListener("touchend",_t,!1),C.addEventListener("gesturechange",Dn,!1),C.addEventListener("gesturestart",nn,!1),C.addEventListener("gestureend",jt,!1),window.addEventListener("blur",ge),window.addEventListener("keyup",Le,!1),window.addEventListener("keydown",Ie,!1),window.addEventListener("keypress",nt,!1),document.addEventListener("pointerlockchange",ve,!1),document.addEventListener("pointerlockerror",ce,!1),null!=xe?xe.observe(C.parentElement):window.addEventListener("resize",It,!1)}();let en,Je=-1;const Bt=(0,r.ZY)(),pn=(0,r.ZY)();function mt(Ot){if(Ot.preventDefault(),en=void 0,Je=-1,1===Ot.touches.length)Je=0,r.ZY.set(Bt,Ot.touches[0].pageX,Ot.touches[0].pageY),en=Ot.touches[0],Y=ee=O.Flag.Primary,gt(Ot.touches[0]);else if(2===Ot.touches.length){Y=O.Flag.Secondary&O.Flag.Auxilary,ee=O.Flag.Secondary,gt(je(Ot));const An=Lt(Ot);V=An,Re.next({distance:An,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:Y,button:ee,modifiers:ye()})}else 3===Ot.touches.length&&(Y=ee=O.Flag.Forth,gt(je(Ot)))}function _t(Ot){if(sn(),en&&Je<=4){const An=en;if(!p(An.clientX,An.clientY))return;$t(pn,An);const{pageX:jn,pageY:On}=Vt(An),[fr,Dr]=pn;we.next({x:fr,y:Dr,pageX:jn,pageY:On,buttons:Y,button:ee,modifiers:ye()})}en=void 0}function Me(Ot){if(ee=O.Flag.None,R&&(Ot.preventDefault(),Ot.stopPropagation(),Ot.originalEvent&&(Ot.originalEvent.preventDefault(),Ot.originalEvent.stopPropagation())),en=void 0,1===Ot.touches.length)Y=O.Flag.Primary,en=Ot.touches[0],function $e(Ot){Je<0||(r.ZY.set(pn,Ot.touches[0].pageX,Ot.touches[0].pageY),Je+=r.ZY.distance(Bt,pn),r.ZY.copy(Bt,pn))}(Ot),At(Ot.touches[0]);else if(2===Ot.touches.length){const An=Lt(Ot),jn=V-An;if(Math.abs(jn)<4)Y=O.Flag.Secondary,At(je(Ot));else{Y=O.Flag.Auxilary,ae(Ot);const On=V/An;Re.next({delta:jn,fraction:On,fractionDelta:U-On,distance:An,isStart:!1,buttons:Y,button:ee,modifiers:ye()}),U=On}V=An}else 3===Ot.touches.length&&(Y=O.Flag.Forth,At(je(Ot)))}function Ke(Ot){ae(Ot),Y=A(Ot),ee=y(Ot),gt(Ot)}function ut(Ot){ae(Ot),Y=A(Ot),ee=O.Flag.None,At(Ot)}function Kt(Ot){ae(Ot),Y=A(Ot),ee=y(Ot),function yt(Ot){if(Z=_.Stopped,p(Ot.clientX,Ot.clientY)){if($t(H,Ot),!_e&&r.ZY.distance(H,N)<4){const{pageX:An,pageY:jn}=Vt(Ot),[On,fr]=H;we.next({x:On,y:fr,pageX:An,pageY:jn,buttons:Y,button:ee,modifiers:ye()})}_e=!1}}(Ot),sn()}function sn(){Be.next(void 0)}function gt(Ot){p(Ot.clientX,Ot.clientY)&&($t(k,Ot),r.ZY.copy(N,k),Dt(k)&&(Z=_.Started))}function At(Ot){var An;$t(H,Ot);const{pageX:jn,pageY:On}=Vt(Ot),[fr,Dr]=H,{movementX:Pr,movementY:or}=Ot,Nr=Dt(H)&&p(Ot.clientX,Ot.clientY);if(g&&!Nr?Se.next(void 0):!g&&Nr&&Ve.next(void 0),g=Nr,te.x=fr,te.y=Dr,te.pageX=jn,te.pageY=On,Oe.next({x:fr,y:Dr,pageX:jn,pageY:On,movementX:Pr,movementY:or,buttons:Y,button:ee,modifiers:ye(),inside:Nr,onElement:Ot.target===C}),Z===_.Stopped||(f&&(null===(An=Ot.preventDefault)||void 0===An||An.call(Ot)),r.ZY.div($,r.ZY.sub($,H,k),function Ct(Ot){return Ot[0]=C.clientWidth,Ot[1]=C.clientHeight,Ot}(J)),r.ZY.magnitude($)<r.p8))return;const Ir=Z===_.Started;if(Ir&&!p(Ot.clientX,Ot.clientY))return;r.ZY.distance(H,N)>=4&&(_e=!0);const[Or,Jr]=$;Ae.next({x:fr,y:Dr,dx:Or,dy:Jr,pageX:jn,pageY:On,buttons:Y,button:ee,modifiers:ye(),isStart:Ir}),r.ZY.copy(k,H),Z=_.Moving}function Gt(Ot){if(!p(Ot.clientX,Ot.clientY))return;$t(H,Ot);const{pageX:An,pageY:jn}=Vt(Ot),[On,fr]=H;a&&Ot.preventDefault();const Dr=function m(u){let h=0,a=0,S=0,D=0,R=0;return"detail"in u&&(a=u.detail),"wheelDelta"in u&&(a=-u.wheelDelta/120),"wheelDeltaY"in u&&(a=-u.wheelDeltaY/120),"wheelDeltaX"in u&&(h=-u.wheelDeltaX/120),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(h=a,a=0),S=10*h,D=10*a,"deltaY"in u&&(D=u.deltaY),"deltaX"in u&&(S=u.deltaX),"deltaZ"in u&&(R=u.deltaZ),(S||D||R)&&u.deltaMode&&(1===u.deltaMode?(S*=40,D*=40,R*=40):(S*=800,D*=800,R*=800)),S&&!h&&(h=S<1?-1:1),D&&!a&&(a=D<1?-1:1),{spinX:h,spinY:a,dx:S,dy:D,dz:R}}(Ot);Y=ee=O.Flag.Auxilary,(Dr.dx||Dr.dy||Dr.dz)&&Ce.next({x:On,y:fr,pageX:An,pageY:jn,...Dr,buttons:Y,button:ee,modifiers:ye()})}function rn(Ot){var An,jn;T&&(Ot.preventDefault(),null===(An=Ot.stopImmediatePropagation)||void 0===An||An.call(Ot),null===(jn=Ot.stopPropagation)||void 0===jn||jn.call(Ot))}let tt=0,Mt=0;function nn(Ot){rn(Ot),tt=Ot.scale,Mt=Ot.rotation,ke.next({scale:Ot.scale,rotation:Ot.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function bn(Ot,An){ke.next({scale:Ot.scale,rotation:Ot.rotation,deltaRotation:Mt-Ot.rotation,deltaScale:tt-Ot.scale,isEnd:An}),Mt=Ot.rotation,tt=Ot.scale}function Dn(Ot){rn(Ot),bn(Ot)}function jt(Ot){rn(Ot),bn(Ot,!0)}function It(){L=C.clientWidth*de(),w=C.clientHeight*de(),Ne.next({})}function Dt(Ot){if(C instanceof Window||C instanceof Document||C===document.body)return!0;{const An=C.getBoundingClientRect();return Ot[0]>=0&&Ot[1]>=0&&Ot[0]<An.width&&Ot[1]<An.height}}function $t(Ot,An){if(L=C.clientWidth*de(),w=C.clientHeight*de(),Q){const jn=de();Ot[0]=(G.x+G.width/2)/jn,Ot[1]=(w-(G.y+G.height/2))/jn}else{const jn=C.getBoundingClientRect();Ot[0]=(An.clientX||0)-jn.left,Ot[1]=(An.clientY||0)-jn.top}return Ot}function Vt(Ot){return Q?{pageX:Math.round(window.innerWidth/2)+G.x,pageY:Math.round(window.innerHeight/2)+G.y}:{pageX:Ot.pageX,pageY:Ot.pageY}}const Wt=30,yn=function Zt(){var Ot;const An=document.createElement("div"),fr="#000 30%, #0000 0 calc(100% - 30%), #000 0";return Object.assign(An.style,{width:`${Wt}px`,aspectRatio:1,background:`linear-gradient(0deg, ${fr}) 50%/10% 100% no-repeat, linear-gradient(90deg, ${fr}) 50%/100% 10% no-repeat, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),null===(Ot=C.parentElement)||void 0===Ot||Ot.appendChild(An),An}();function kt(Ot){if(yn.style.display=Ot?"block":"none",Ot){const An=de(),jn=(G.x+G.width/2)/An,On=(G.y+G.height/2)/An;yn.style.width=`${Wt}px`,yn.style.left=`calc(${jn}px - ${Wt/2}px)`,yn.style.bottom=`calc(${On}px - ${Wt/2}px)`}}return{get noScroll(){return a},set noScroll(Ot){a=Ot},get noContextMenu(){return D},set noContextMenu(Ot){D=Ot},get width(){return L},get height(){return w},get pixelRatio(){return de()},get pointerLock(){return Q},...le,setPixelScale:Ot=>{E=Ot,L=C.clientWidth*de(),w=C.clientHeight*de()},requestPointerLock:Ot=>{G=Ot,Q||C.requestPointerLock()},exitPointerLock:()=>{Q&&C.ownerDocument.exitPointerLock()},dispose:function re(){q||(q=!0,C.removeEventListener("contextmenu",se,!1),C.removeEventListener("wheel",Gt,!1),C.removeEventListener("mousedown",Ke,!1),window.removeEventListener("mousemove",ut,!1),window.removeEventListener("mouseup",Kt,!1),C.removeEventListener("touchstart",mt,!1),C.removeEventListener("touchmove",Me,!1),C.removeEventListener("touchend",_t,!1),C.removeEventListener("gesturechange",Dn,!1),C.removeEventListener("gesturestart",nn,!1),C.removeEventListener("gestureend",jt,!1),window.removeEventListener("blur",ge),window.removeEventListener("keyup",Le,!1),window.removeEventListener("keydown",Ie,!1),window.removeEventListener("keypress",nt,!1),document.removeEventListener("pointerlockchange",ve,!1),document.removeEventListener("pointerlockerror",ce,!1),yn.remove(),null!=xe?(xe.unobserve(C.parentElement),xe.disconnect()):window.removeEventListener("resize",It,!1))}}}},2293:(tn,Ue,n)=>{"use strict";function e(r){return{kind:"table-legend",table:r}}function o(r,t,A){return{kind:"scale-legend",minLabel:r,maxLabel:t,colors:A}}n.d(Ue,{A:()=>o,h:()=>e})},2229:(tn,Ue,n)=>{"use strict";var e,o;n.d(Ue,{x:()=>e}),(o=e||(e={})).message=function r(c){return{type:"message",timestamp:new Date,message:c}},o.error=function t(c){return{type:"error",timestamp:new Date,message:c}},o.warning=function A(c){return{type:"warning",timestamp:new Date,message:c}},o.info=function y(c){return{type:"info",timestamp:new Date,message:c}}},6825:(tn,Ue,n)=>{"use strict";n.d(Ue,{BH:()=>i,HX:()=>O,Ro:()=>v,ly:()=>c,sY:()=>A,uP:()=>y,xi:()=>t});var A,b,e=n(3543),o=n(9455),r=n(1372),t=function(b){return b[b.None=0]="None",b[b.Highlight=1]="Highlight",b[b.RemoveHighlight=2]="RemoveHighlight",b[b.Select=4]="Select",b[b.Deselect=8]="Deselect",b[b.Toggle=16]="Toggle",b[b.Clear=32]="Clear",b}(t||{});function y(b,_,M){b.fill(_,0,M)}function c(b,_,M){switch(M){case t.Highlight:b[_]|=1;break;case t.RemoveHighlight:b[_]&=-2;break;case t.Select:b[_]|=2;break;case t.Deselect:b[_]&=-3;break;case t.Toggle:b[_]^=2;break;case t.Clear:b[_]=0}}function i(b,_,M){if(M===t.None)return!1;if(e.IX.is(_)){const I=e.IX.start(_),l=e.IX.end(_),m=I+3>>2,u=m+(l-4*m>>2);if(u<=m){for(let S=I;S<l;++S)c(b,S,M);return!0}const d=new Uint32Array(b.buffer,0,b.buffer.byteLength>>2),s=I,C=Math.min(4*m,l),h=Math.max(I,4*u),a=l;switch(M){case t.Highlight:for(let S=m;S<u;++S)d[S]|=16843009;break;case t.RemoveHighlight:for(let S=m;S<u;++S)d[S]&=-16843010;break;case t.Select:for(let S=m;S<u;++S)d[S]|=33686018;break;case t.Deselect:for(let S=m;S<u;++S)d[S]&=-33686019;break;case t.Toggle:for(let S=m;S<u;++S)d[S]^=33686018;break;case t.Clear:for(let S=m;S<u;++S)d[S]=0;break;default:(0,r.dr)(M)}for(let S=s;S<C;++S)c(b,S,M);for(let S=h;S<a;++S)c(b,S,M)}else switch(M){case t.Highlight:for(let I=0,l=_.length;I<l;++I)b[_[I]]|=1;break;case t.RemoveHighlight:for(let I=0,l=_.length;I<l;++I)b[_[I]]&=-2;break;case t.Select:for(let I=0,l=_.length;I<l;++I)b[_[I]]|=2;break;case t.Deselect:for(let I=0,l=_.length;I<l;++I)b[_[I]]&=-3;break;case t.Toggle:for(let I=0,l=_.length;I<l;++I)b[_[I]]^=2;break;case t.Clear:for(let I=0,l=_.length;I<l;++I)b[_[I]]=0;break;default:(0,r.dr)(M)}return!0}function v(b,_){let M=-1,I=-1;switch(b){case t.Highlight:0===_||1===_?(M=1,I=1):2===_||3===_?(M=1,I=3):M=1;break;case t.RemoveHighlight:0===_||1===_?(M=0,I=0):(2===_||3===_)&&(M=1,I=2);break;case t.Select:1===_||3===_?(M=1,I=3):0===_||2===_?(M=1,I=2):M=1;break;case t.Deselect:1===_||3===_?(M=1,I=1):(0===_||2===_)&&(M=0,I=0);break;case t.Toggle:1===_?(M=1,I=3):2===_?(M=0,I=0):3===_?(M=1,I=1):0===_&&(M=1,I=2);break;case t.Clear:M=0,I=0}return{average:M,status:I}}function O(b,_){switch(b){case t.Highlight:return.5;case t.RemoveHighlight:return 0===_?0:2===_||3===_?.5:-1;case t.Select:return.5;case t.Deselect:return 1===_||3===_?.5:0===_?0:-1;case t.Toggle:return-1===_?-1:.5;case t.Clear:return-1===_?-1:0===_?0:.5;case t.None:return-1;default:(0,r.dr)(b)}}(b=A||(A={})).is=o.N.has,b.All=t.Highlight|t.RemoveHighlight|t.Select|t.Deselect|t.Toggle|t.Clear,b.Highlighting=t.Highlight|t.RemoveHighlight|t.Clear,b.Selecting=t.Select|t.Deselect|t.Toggle|t.Clear,b.isReverse=function _(M,I){return M===t.Highlight&&I===t.RemoveHighlight||M===t.RemoveHighlight&&I===t.Highlight||M===t.Select&&I===t.Deselect||M===t.Deselect&&I===t.Select||M===t.Toggle&&I===t.Toggle}},6765:(tn,Ue,n)=>{"use strict";n.d(Ue,{i:()=>o});var r,e=n(8277);function o(r){return{...o.Zero,...r}}(r=o||(o={})).Zero={metalness:0,roughness:0,bumpiness:0},r.toArray=function t(c,i,v){return i[v]=255*c.metalness,i[v+1]=255*c.roughness,i[v+2]=255*c.bumpiness,i},r.toString=function A({metalness:c,roughness:i,bumpiness:v}){return`M ${c.toFixed(2)} | R ${i.toFixed(2)} | B ${v.toFixed(2)}`},r.getParam=function y(c){return e.t.Group({metalness:e.t.Numeric(0,{min:0,max:1,step:.01}),roughness:e.t.Numeric(1,{min:0,max:1,step:.01}),bumpiness:e.t.Numeric(0,{min:0,max:1,step:.01})},{...c,presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]})}},1094:(tn,Ue,n)=>{"use strict";function e(r){let t,A;return(...y)=>{if(!t||t.length!==y.length)return t=y,A=r.apply(void 0,y),A;for(let c=0,i=y.length;c<i;c++)if(y[c]!==t[c])return t=y,A=r.apply(void 0,y),A;return A}}function o(r){const t=new Map;return A=>{if(t.has(A))return t.get(A);const y=r(A);return t.set(A,y),y}}n.d(Ue,{E:()=>o,_:()=>e})},8484:(tn,Ue,n)=>{"use strict";n.d(Ue,{En:()=>o,K0:()=>e,em:()=>r});const e=typeof process<"u"&&null!=process.versions&&null!=process.versions.node,o=function t(){return typeof XMLHttpRequest>"u"||e?n(2684):XMLHttpRequest}(),r=function A(){if(typeof File>"u"||e){class y{arrayBuffer(){return this.blob.arrayBuffer()}slice(i,v,O){return this.blob.slice(i,v,O)}stream(){return this.blob.stream()}text(){return this.blob.text()}constructor(i,v,O){var b;this.blob=new Blob(i,O),this.size=this.blob.size,this.type=this.blob.type,this.name=v,this.lastModified=null!==(b=O?.lastModified)&&void 0!==b?b:0,this.webkitRelativePath=""}}return y}return File}()},9854:(tn,Ue,n)=>{"use strict";n.d(Ue,{H:()=>o,t:()=>e});const e=function(){if(typeof window<"u"&&window.performance){const r=window.performance;return()=>r.now()}return typeof process<"u"&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?()=>{const r=process.hrtime();return 1e3*r[0]+r[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();function o(r,t=!0){if(isNaN(r))return"n/a";const A=Math.floor(r/36e5),y=Math.floor(r/6e4%60),c=Math.floor(r/1e3%60);let i=Math.floor(r%1e3).toString();for(;i.length<3;)i="0"+i;for(;!t&&i.length>1&&"0"===i[i.length-1];)i=i.substr(0,i.length-1);return A>0?`${A}h${y}m${c}.${i}s`:y>0?`${y}m${c}.${i}s`:c>0?`${c}.${i}s`:`${r.toFixed(0)}ms`}},4951:(tn,Ue,n)=>{"use strict";n.d(Ue,{FO:()=>v,Gu:()=>r,OK:()=>t});var e=n(127),o=n(4369);function r(O,b,_){return O=(0,e.qE)(Math.round(O),0,16777215)+1,b[_+2]=O%256,O=Math.floor(O/256),b[_+1]=O%256,O=Math.floor(O/256),b[_]=O%256,b}function t(O,b,_){return 256*Math.floor(O)*256+256*Math.floor(b)+Math.floor(_)-1}const A=255/256,y=o.eB.create(16777216,65536,256),c=o.Zb.create(A/y[0],A/y[1],A/y[2],A/1),i=(0,o.Zb)();function v(O,b,_,M){return o.Zb.set(i,O/255,b/255,_/255,M/255),o.Zb.dot(i,c)}},229:(tn,Ue,n)=>{"use strict";function e(i,v,O){let _,b=1;for(_=0;_<v;_++){const M=b*i;if(Math.abs(Math.round(M)-M)<=O)return _;b*=10}return-1}function o(i,v){return Math.abs(i)<v?0:Math.floor(Math.log10(Math.abs(i)))+1}function r(i,v,O){let b=1,_=0;for(let M=0,I=i.length;M<I;M++){if(b>=0){const m=e(i[M],v,O);m<0?b=-1:m>b&&(b=m)}const l=Math.abs(i[M]);if(l>O){const m=Math.floor(Math.log10(Math.abs(l)))+1;m>_&&(_=m)}}return{mantissaDigits:b,integerDigits:_}}function t(i){i=i.trim();const v=parseInt(i,10);return!isNaN(v)&&v.toString()===i}function A(i){if(!isFinite(i))return 0;let v=1,O=0;for(;Math.round(i*v)/v!==i;)v*=10,++O;return O}function y(i,v){return parseFloat(i.toPrecision(v))}n.d(Ue,{Fq:()=>t,In:()=>r,QX:()=>y,XV:()=>A,bL:()=>o})},9359:(tn,Ue,n)=>{"use strict";n.d(Ue,{Go:()=>c,IF:()=>O,JW:()=>o,Wv:()=>y,bN:()=>t});const e=Object.prototype.hasOwnProperty;function o(u,d){for(const s of Object.keys(d))e.call(d,s)&&typeof u[s]>"u"&&(u[s]=d[s]);return u}function r(u,d){let s=!1;for(const C of Object.keys(d))if(e.call(d,C)&&d[C]!==u[C]){s=!0;break}return s?Object.assign({},u,d):u}function t(u,d){if(!u)return!d;if(!d)return!1;const s=Object.keys(u);if(Object.keys(d).length!==s.length)return!1;for(const C of s)if(!e.call(u,C)||u[C]!==d[C])return!1;return!0}function y(u,d){let s=u;for(let C=0;C<d.length;C++)if(d[C]&&(s=r(u,d[C]),s!==u)){for(let h=C+1;h<d.length;h++)s=Object.assign(s,d[h]);break}return s}function c(u){if(null===u||"object"!=typeof u)return u;if(u instanceof Array){const d=[];for(let s=0,C=u.length;s<C;s++)d[s]=c(u[s]);return d}if("object"==typeof u&&!("prototype"in u)){const d={};for(const s in u)e.call(u,s)&&(d[s]=c(u[s]));return d}throw new Error(`Can't clone, type "${typeof u}" unsupported`)}function O(u,d){if(u)for(const s of Object.keys(u))d(u[s],s)}},8277:(tn,Ue,n)=>{"use strict";n.d(Ue,{t:()=>c});var c,e=n(9909),o=n(4369),r=n(9359),t=n(7785),A=n(1907),y=n(1861);!function(i){function v(Oe,Se){return Se&&(Se.label&&(Oe.label=Se.label),Se.description&&(Oe.description=Se.description),Se.legend&&(Oe.legend=Se.legend),Se.fieldLabels&&(Oe.fieldLabels=Se.fieldLabels),Se.isHidden&&(Oe.isHidden=Se.isHidden),Se.shortLabel&&(Oe.shortLabel=Se.shortLabel),Se.twoColumns&&(Oe.twoColumns=Se.twoColumns),Se.isEssential&&(Oe.isEssential=Se.isEssential),Se.category&&(Oe.category=Se.category),Se.hideIf&&(Oe.hideIf=Se.hideIf),Se.help&&(Oe.help=Se.help)),Oe}function _(Oe,Se,Ve){return v({type:"select",defaultValue:we(Oe,Se),options:Se,cycle:Ve?.cycle},Ve)}function S(Oe,Se){return Se&&(typeof Se.min<"u"&&(Oe.min=Se.min),typeof Se.max<"u"&&(Oe.max=Se.max),typeof Se.step<"u"&&(Oe.step=Se.step)),Oe}function p(Oe,Se){const Ve=v({type:"group",defaultValue:Se?.customDefault||J(Oe),params:Oe},Se);return Se?.presets&&(Ve.presets=Se.presets),Se?.isExpanded&&(Ve.isExpanded=Se.isExpanded),Se?.isFlat&&(Ve.isFlat=Se.isFlat),Se?.pivot&&(Ve.pivot=Se.pivot),Ve}function Q(){return J(this.element)}function G(){throw new Error("getValue not set. Fix runtime.")}function J(Oe){const Se={};for(const Ve of Object.keys(Oe))Oe[Ve].isOptional||(Se[Ve]=Oe[Ve].defaultValue);return Se}function W(Oe,Se,Ve){return()=>Oe(Se,Ve)}function te(Oe,Se,Ve){if(Se)if("value-ref"===Oe.type){Se.getValue=Se.ref?W(Oe.resolveRef,Se.ref,Ve):()=>{throw new Error("Unset ref in ValueRef value.")}}else if("data-ref"===Oe.type){Se.getValue=Se.ref?W(Ve,Se.ref,Ve):()=>{throw new Error("Unset ref in ValueRef value.")}}else if("group"===Oe.type)j(Oe.params,Se,Ve);else if("mapped"===Oe.type){const Ne=Se;te(Oe.map(Ne.name),Ne.params,Ve)}else if("object-list"===Oe.type){if(!ye(Oe.element))return;for(const Ne of Se)j(Oe.element,Ne,Ve)}}function de(Oe){if("value-ref"===Oe.type||"data-ref"===Oe.type)return!0;if("group"===Oe.type){if(ye(Oe.params))return!0}else if("mapped"===Oe.type){for(const[Se]of Oe.select.options)if(de(Oe.map(Se)))return!0}else if("object-list"===Oe.type)return ye(Oe.element);return!1}function ye(Oe){for(const Se of Object.keys(Oe))if(de(Oe[Se]))return!0;return!1}function j(Oe,Se,Ve){for(const Ne of Object.keys(Oe))te(Oe[Ne],Se?.[Ne],Ve)}function ee(Oe,Se,Ve){if(Se===Ve)return!0;if("object"!=typeof Se||"object"!=typeof Ve)return!1;for(const Ne of Object.keys(Oe))if(!g(Oe[Ne],Se[Ne],Ve[Ne]))return!1;return!0}function g(Oe,Se,Ve){if(Se===Ve)return!0;if("group"===Oe.type)return ee(Oe.params,Se,Ve);if("mapped"===Oe.type){const Ne=Se,K=Ve;return Ne.name===K.name&&g(Oe.map(Ne.name),Ne.params,K.params)}if("multi-select"===Oe.type){const Ne=Se,K=Ve;if(Ne.length!==K.length)return!1;if(Ne.length<10){for(let ne=0,be=Ne.length;ne<be;ne++)if(Ne[ne]!==K[ne]&&K.indexOf(Ne[ne])<0)return!1}else{const ne=new Set(K);for(let be=0,Te=Ne.length;be<Te;be++)if(Ne[be]!==K[be]&&!ne.has(Ne[be]))return!1}return!0}if("interval"===Oe.type)return Se[0]===Ve[0]&&Se[1]===Ve[1];if("line-graph"===Oe.type){const Ne=Se,K=Ve;if(Ne.length!==K.length)return!1;for(let ne=0,be=Ne.length;ne<be;ne++)if(!o.ZY.areEqual(Ne[ne],K[ne]))return!1;return!0}if("vec3"===Oe.type)return o.eB.equals(Se,Ve);if("mat4"===Oe.type)return o.$I.areEqual(Se,Ve,o.p8);if("script"===Oe.type)return Se.language===Ve.language&&Se.expression===Ve.expression;if("object-list"===Oe.type){const Ne=Se,K=Ve,ne=Ne.length;if(ne!==K.length)return!1;for(let be=0;be<ne;be++)if(!ee(Oe.element,Ne[be],K[be]))return!1;return!0}return"object"==typeof Se&&"object"==typeof Ve&&(0,e.f8)(Se,Ve)}function _e(Oe,Se,Ve){if(void 0===Se)return{...Ve};if(void 0===Ve)return{...Se};const Ne=Object.create(null);for(const K of Object.keys(Oe))Ne[K]=xe(Oe[K],Se[K],Ve[K]);return Ne}function xe(Oe,Se,Ve){if(void 0===Se)return"object"!=typeof Ve||Array.isArray(Ve)?Ve:{...Ve};if(void 0===Ve)return"object"!=typeof Se||Array.isArray(Se)?Se:{...Se};if("group"===Oe.type)return _e(Oe.params,Se,Ve);if("mapped"===Oe.type){const Ne=Se,K=Ve;if(Ne.name!==K.name)return{...K};const ne=Oe.map(K.name);return{name:K.name,params:xe(ne,Ne.params,K.params)}}return"value"===Oe.type?Ve:"object"==typeof Se&&"object"==typeof Ve?Array.isArray(Ve)?Ve:{...Se,...Ve}:Ve}function le(Oe,Se){for(const Ve of Oe.options)if(Ve[0]===Se)return!0;return!1}function Ae(Oe,Se,Ve){if(null==Se)return Ve?Oe.defaultValue:void 0;if("value"===Oe.type)return Se;if("group"===Oe.type){const Ne=Object.create(null);for(const K of Object.keys(Oe.params)){const ne=Oe.params[K];void 0===Se[K]?Ve&&(Ne[K]=ne.defaultValue):Ne[K]=Ae(ne,Se[K],Ve)}return Ne}if("mapped"===Oe.type){const Ne=Se;if("string"!=typeof Ne.name)return Oe.defaultValue;if(typeof Ne.params>"u")return Ve?Oe.defaultValue:void 0;if(!le(Oe.select,Ne.name))return Oe.defaultValue;const K=Oe.map(Ne.name);return{name:Ne.name,params:Ae(K,Ne.params,Ve)}}if("select"===Oe.type)return le(Oe,Se)?Se:Oe.defaultValue;if("multi-select"===Oe.type){if(!Array.isArray(Se))return Oe.defaultValue;const Ne=Se.filter(function(K){return le(this,K)},Oe);return Se.length>0&&0===Ne.length?Oe.defaultValue:Ne}return"object-list"===Oe.type?Array.isArray(Se)?Se.map(Ne=>Be(Oe.element,Ne,Ve?"all":"skip")):Oe.defaultValue:Se}function Be(Oe,Se,Ve){if("object"!=typeof Se||null===Se)return Ve?J(Oe):Se;const Ne=Object.create(null);for(const K of Object.keys(Oe)){const ne=Oe[K];void 0===Se[K]?"all"===Ve&&(Ne[K]=ne.defaultValue):Ne[K]=Ae(ne,Se[K],"skip"!==Ve)}return Ne}function we(Oe,Se){for(const Ve of Se)if(Ve[0]===Oe)return Oe;return Se.length>0?Se[0][0]:void 0}i.Essential={isEssential:!0},i.Optional=function O(Oe){const Se={...Oe};return Se.isOptional=!0,Se},i.Value=function b(Oe,Se){return v({type:"value",defaultValue:Oe},Se)},i.Select=_,i.MultiSelect=function M(Oe,Se,Ve){const Ne=v({type:"multi-select",defaultValue:Oe,options:Se},Ve);return Ve?.emptyValue&&(Ne.emptyValue=Ve.emptyValue),Ne},i.Boolean=function I(Oe,Se){return v({type:"boolean",defaultValue:Oe},Se)},i.Text=function l(Oe="",Se){return v({type:"text",defaultValue:Oe,multiline:Se?.multiline,placeholder:Se?.placeholder,disableInteractiveUpdates:Se?.disableInteractiveUpdates},Se)},i.Color=function m(Oe,Se){const Ve=v({type:"color",defaultValue:Oe},Se);return Se?.isExpanded&&(Ve.isExpanded=Se.isExpanded),Ve},i.ColorList=function u(Oe,Se){let Ve;if("string"==typeof Oe){const Ne=(0,A.JA)(Oe);Ve={kind:"qualitative"!==Ne.type?"interpolate":"set",colors:Ne.list}}else Ve=Oe;return v({type:"color-list",presetKind:Se?.presetKind||"all",defaultValue:Ve,offsets:!!Se?.offsets},Se)},i.Vec3=function d(Oe,Se,Ve){return v(S({type:"vec3",defaultValue:Oe},Se),Ve)},i.Mat4=function s(Oe,Se){return v({type:"mat4",defaultValue:Oe},Se)},i.Url=function C(Oe,Se){return v({type:"url",defaultValue:"string"==typeof Oe?y.V.Url(Oe):y.V.Url(Oe.url,{body:Oe.body})},Se)},i.File=function h(Oe){const Se=v({type:"file",defaultValue:null},Oe);return Oe?.accept&&(Se.accept=Oe.accept),Se},i.FileList=function a(Oe){const Se=v({type:"file-list",defaultValue:null},Oe);return Oe?.accept&&(Se.accept=Oe.accept),Se},i.Numeric=function D(Oe,Se,Ve){const Ne=v(S({type:"number",defaultValue:Oe},Se),Ve);return Ve?.immediateUpdate&&(Ne.immediateUpdate=!0),Ne},i.Interval=function R(Oe,Se,Ve){return v(S({type:"interval",defaultValue:Oe},Se),Ve)},i.LineGraph=function f(Oe,Se){const Ve=v({type:"line-graph",defaultValue:Oe},Se);return Se?.getVolume&&(Ve.getVolume=Se.getVolume),Ve},i.Group=p,i.EmptyGroup=function E(Oe){return p({},Oe)},i.Mapped=function T(Oe,Se,Ve,Ne){const K=we(Oe,Se);return v({type:"mapped",defaultValue:{name:K,params:Ve(K).defaultValue},select:_(K,Se,Ne),map:Ve},Ne)},i.MappedStatic=function L(Oe,Se,Ve){const Ne=Ve?.options?Ve.options:Object.keys(Se).map(ne=>[ne,Se[ne].label||(0,t.Mk)(ne)]),K=we(Oe,Ne);return v({type:"mapped",defaultValue:{name:K,params:Se[K].defaultValue},select:_(K,Ne,Ve),map:ne=>Se[ne]},Ve)},i.ObjectList=function w(Oe,Se,Ve){return v({type:"object-list",element:Oe,getLabel:Se,ctor:Q,defaultValue:Ve?.defaultValue||[]},Ve)},i.ValueRef=function V(Oe,Se,Ve){var Ne;return v({type:"value-ref",defaultValue:{ref:null!==(Ne=Ve?.defaultRef)&&void 0!==Ne?Ne:"",getValue:G},getOptions:Oe,resolveRef:Se},Ve)},i.DataRef=function U(Oe){var Se;return v({type:"data-ref",defaultValue:{ref:null!==(Se=Oe?.defaultRef)&&void 0!==Se?Se:"",getValue:G}},Oe)},i.Converted=function N(Oe,Se,Ve){return v({type:"converted",defaultValue:Se(Ve.defaultValue),converted:Ve,fromValue:Oe,toValue:Se},Ve)},i.Conditioned=function k(Oe,Se,Ve,Ne,K){const ne=Object.keys(Se).map(be=>[be,be]);return v({type:"conditioned",select:_(Ve(Oe),ne,K),defaultValue:Oe,conditionParams:Se,conditionForValue:Ve,conditionedValue:Ne},K)},i.Script=function H(Oe,Se){return v({type:"script",defaultValue:Oe},Se)},i.For=function $(Oe){return 0},i.getDefaultValues=J,i.resolveRefs=j,i.setDefaultValues=function Z(Oe,Se){for(const Ve of Object.keys(Oe))Oe[Ve].isOptional||(Oe[Ve].defaultValue=Se[Ve])},i.clone=function q(Oe){return(0,r.Go)(Oe)},i.validate=function Y(Oe,Se){},i.areEqual=ee,i.isParamEqual=g,i.merge=_e,i.mergeParam=xe,i.normalizeParams=Be,i.objectToOptions=function Ce(Oe,Se){const Ve=[];for(const Ne of Object.keys(Oe))if(Se){const K=Se(Ne,Oe[Ne]);Ve.push("string"==typeof K?[Ne,K]:[Ne,K[0],K[1]])}else Ve.push("string"==typeof Oe[Ne]?[Ne,Oe[Ne]]:[Ne,null===Se?Ne:(0,t.Mk)(Ne)]);return Ve},i.arrayToOptions=function Re(Oe,Se){const Ve=[];for(const Ne of Oe)Ve.push(Se?[Ne,Se(Ne)]:[Ne,null===Se?Ne:(0,t.Mk)(Ne)]);return Ve},i.optionLabel=function ke(Oe,Se){for(const Ve of Oe.options)if(Ve[0]===Se)return Ve[1];return""}}(c||(c={}))},8956:(tn,Ue,n)=>{"use strict";n.d(Ue,{V:()=>r});var r,e=n(1413),o=n(4412);(r||(r={})).create=function y(){const c=new t,i=()=>c.create();return i.dispose=()=>c.dispose(),i.behavior=v=>c.behavior(v),i};class t{constructor(){this._eventList=[],this._disposed=!1}create(){const y=new e.B;return this._eventList.push(y),y}behavior(y){const c=new o.t(y);return this._eventList.push(c),c}dispose(){if(!this._disposed){for(const y of this._eventList)y.complete();this._disposed=!0}}}},9986:(tn,Ue,n)=>{"use strict";var e,o;n.d(Ue,{M:()=>e}),(o=e||(e={})).toArray=function r(l){return Array.from(l.values())},o.isSuperset=function t(l,m){if(l===m)return!0;if(l.size<m.size)return!1;for(const u of m)if(!l.has(u))return!1;return!0},o.add=function A(l,...m){for(let u=0;u<m.length;u++)for(const d of m[u])l.add(d);return l},o.union=function y(l,m){const u=new Set(l);if(l===m)return u;for(const d of m)u.add(d);return u},o.unionMany=function c(...l){if(0===l.length)return new Set;const m=new Set(l[0]);for(let u=1,d=l.length;u<d;u++)for(const s of l[u])m.add(s);return m},o.unionManyArrays=function i(l){if(0===l.length)return new Set;const m=new Set(l[0]);for(let u=1;u<l.length;u++)for(const d of l[u])m.add(d);return m},o.intersection=function v(l,m){if(l===m)return new Set(l);const u=new Set;for(const d of m)l.has(d)&&u.add(d);return u},o.areIntersecting=function O(l,m){if(l===m)return l.size>0;l.size<m.size&&([l,m]=[m,l]);for(const u of m)if(l.has(u))return!0;return!1},o.intersectionSize=function b(l,m){if(l===m)return l.size;l.size<m.size&&([l,m]=[m,l]);let u=0;for(const d of m)l.has(d)&&(u+=1);return u},o.difference=function _(l,m){if(l===m)return new Set;const u=new Set(l);for(const d of m)u.delete(d);return u},o.differenceSize=function M(l,m){if(l===m)return 0;let u=l.size;for(const d of l)m.has(d)&&(u-=1);return u},o.areEqual=function I(l,m){if(l===m)return!0;if(l.size!==m.size)return!1;for(const u of m)if(!l.has(u))return!1;return!0}},9115:(tn,Ue,n)=>{"use strict";var e;n.d(Ue,{f:()=>e}),function(o){o.create=function r(a=512){return{current:[],offset:0,capacity:a,chunks:[]}},o.getString=function t(a){return a.chunks.length?(a.offset>0&&(a.chunks[a.chunks.length]=a.current.length===a.offset?a.current.join(""):a.current.slice(0,a.offset).join("")),a.chunks.join("")):a.current.length===a.offset?a.current.join(""):a.current.splice(0,a.offset).join("")},o.getSize=function A(a){let S=0;for(const D of a.chunks)S+=D.length;for(let D=0;D<a.offset;D++)S+=a.current[D].length;return S},o.getChunks=function y(a){return a.offset>0&&(a.chunks[a.chunks.length]=a.current.length===a.offset?a.current.join(""):a.current.slice(0,a.offset).join(""),a.offset=0),a.chunks};const c=[];function v(a,S){S>0&&_(a,c[S])}function _(a,S){a.offset===a.capacity&&(a.chunks[a.chunks.length]=a.current.join(""),a.offset=0),a.current[a.offset++]=S}!function(){let a="";for(let S=0;S<512;S++)c[S]=a,a+=" "}(),o.newline=function i(a){_(a,"\n")},o.whitespace=v,o.whitespace1=function O(a){_(a," ")},o.write=function b(a,S){S&&(a.offset===a.capacity&&(a.chunks[a.chunks.length]=a.current.join(""),a.offset=0),a.current[a.offset++]=S)},o.writeSafe=_,o.writePadLeft=function M(a,S,D){S?(v(a,D-S.length),_(a,S)):v(a,D)},o.writePadRight=function I(a,S,D){if(!S)return void v(a,D);const R=D-S.length;_(a,S),v(a,R)},o.writeInteger=function l(a,S){_(a,""+S)},o.writeIntegerAndSpace=function m(a,S){_(a,S+" ")},o.writeIntegerPadLeft=function u(a,S,D){const R=""+S;v(a,D-R.length),_(a,R)},o.writeIntegerPadRight=function d(a,S,D){const R=""+S,f=D-R.length;_(a,R),v(a,f)},o.writeFloat=function s(a,S,D){_(a,""+Math.round(D*S)/D)},o.writeFloatPadLeft=function C(a,S,D,R){const f=""+Math.round(D*S)/D;v(a,R-f.length),_(a,f)},o.writeFloatPadRight=function h(a,S,D,R){const f=""+Math.round(D*S)/D,p=R-f.length;_(a,f),v(a,p)}}(e||(e={}))},7785:(tn,Ue,n)=>{"use strict";function r(h,a=" "){return h.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${a}$2`)}function t(h){return i(r(h))}n.d(Ue,{GW:()=>l,Hh:()=>t,Kq:()=>s,LX:()=>I,Mk:()=>M,Nt:()=>C,ZH:()=>i,r4:()=>c});const y=h=>h.toUpperCase();function c(h){return h?"string"==typeof h?h.toUpperCase():`${h}`.toUpperCase():""}function i(h){return h.toLowerCase().replace(/^\w|\s\w/g,y)}function M(h){return i(r(function v(h){return h.replace(/_/g," ")}(function b(h){return h.replace(/-/g," ")}(h))))}function I(h,a,S,D){const R=D.length;if(R>S-a)return!1;for(let f=0;f<R;f++)if(h.charCodeAt(a+f)!==D.charCodeAt(f))return!1;return!0}function l(h,a){const S=Object.keys(a),D=Object.values(a);return new Function(...S,`return \`${h}\`;`)(...D)}function s(h){return h.replace(/<\/?[^>]+>/g,"")}function C(h){return h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},1372:(tn,Ue,n)=>{"use strict";function e(t){return Object.keys(t)}function o(t){throw new Error("unreachable")}function r(t){return"function"==typeof t?.then}n.d(Ue,{$X:()=>r,dr:()=>o,mX:()=>e})},5091:(tn,Ue,n)=>{"use strict";function o(r,t){return`${r}${"/"===r[r.length-1]||"/"===t[0]?"":"/"}${t}`}n.d(Ue,{r:()=>o})},3559:(tn,Ue,n)=>{"use strict";n.d(Ue,{k:()=>o});var o,e=n(9854);!function(r){const t=typeof btoa<"u"?btoa:v=>Buffer.from(v).toString("base64"),A=[];r.create22=function y(){let v=+new Date+(0,e.t)();for(let O=0;O<16;O++)A[O]=String.fromCharCode((v+255*Math.random())%255|0),v=Math.floor(v/255);return t(A.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},r.createv4=function c(){let v=+new Date+(0,e.t)();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){const _=(v+16*Math.random())%16|0;return v=Math.floor(v/16),("x"===b?_:3&_|8).toString(16)})},r.is=function i(v){return"string"==typeof v}}(o||(o={}))},7187:(tn,Ue,n)=>{"use strict";n.d(Ue,{IQ:()=>A,xv:()=>t});var o,y,e=n(7778);(y=o||(o={})).create=function c(v){return{ref:v}},y.set=function i(v,O){return v.ref=O,v};const r=(0,e.q)(0,2147483647);var t,A;!function(y){y.create=function c(v,O){return{id:r(),version:0,value:v,metadata:O}},y.withValue=function i(v,O){return{id:v.id,version:v.version+1,value:O,metadata:v.metadata}}}(t||(t={})),function(y){function i(b,_){return o.set(b,t.withValue(b.ref,_))}y.create=function c(b,_){return o.create(t.create(b,_))},y.update=i,y.set=function v(b,_){return o.set(b,_)},y.updateIfChanged=function O(b,_){return b.ref.value!==_?i(b,_):b}}(A||(A={}))},6985:(tn,Ue,n)=>{"use strict";n.d(Ue,{qQ:()=>ie,Aq:()=>Ve,$1:()=>Be});var e=n(467);function t(se,ae){return se[ae]|se[ae+1]<<8}function A(se,ae,ge){se[ae]=255&ge,se[ae+1]=ge>>8&255}function y(se,ae){return 16777216*se[ae+3]+(se[ae+2]<<16|se[ae+1]<<8|se[ae])}function c(se,ae,ge){se[ae]=255&ge,se[ae+1]=ge>>8&255,se[ae+2]=ge>>16&255,se[ae+3]=ge>>24&255}function v(se){return se.length<2?"0"+se:se}function _(se){const ae=se.length;let ge=0;for(let Ie=0;Ie<ae;Ie++){const Le=se.charCodeAt(Ie);if(4294967168&Le)if(4294965248&Le)if(4294901760&Le){if(4292870144&Le)throw new Error("e");ge+=4}else ge+=3;else ge+=2;else ge++}return ge}const M=function(){const se=new Uint32Array(256);for(let ae=0;ae<256;ae++){let ge=ae;for(let Ie=0;Ie<8;Ie++)1&ge?ge=3988292384^ge>>>1:ge>>>=1;se[ae]=ge}return se}();function l(se,ae,ge){return 4294967295^function I(se,ae,ge,Ie){for(let Le=0;Le<Ie;Le++)se=M[255&(se^ae[ge+Le])]^se>>>8;return se}(4294967295,se,ae,ge)}const u=function(){const se=Uint16Array,ae=Uint32Array;return{next_code:new se(16),bl_count:new se(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new se(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new ae(32),flmap:new se(512),fltree:[],fdmap:new se(32),fdtree:[],lmap:new se(32768),ltree:[],ttree:[],dmap:new se(32768),dtree:[],imap:new se(512),itree:[],rev15:new se(32768),lhst:new ae(286),dhst:new ae(30),ihst:new ae(19),lits:new ae(15e3),strt:new se(65536),prev:new se(32768)}}();function d(se,ae,ge){const Ie=se.length,Le=u.rev15;for(let nt=0;nt<Ie;nt+=2)if(0!==se[nt+1]){const Lt=se[nt+1],Je=nt>>1<<4|Lt,en=ae-Lt;let Bt=se[nt]<<en;const pn=Bt+(1<<en);for(;Bt!==pn;)ge[Le[Bt]>>>15-ae]=Je,Bt++}}function s(se,ae){const ge=se.length,Ie=u.bl_count;for(let je=0;je<=ae;je++)Ie[je]=0;for(let je=1;je<ge;je+=2)Ie[se[je]]++;const Le=u.next_code;let nt=0;Ie[0]=0;for(let je=1;je<=ae;je++)nt=nt+Ie[je-1]<<1,Le[je]=nt;for(let je=0;je<ge;je+=2){const Lt=se[je+1];0!==Lt&&(se[je]=Le[Lt],Le[Lt]++)}}function C(se,ae){const ge=u.rev15,Ie=15-ae;for(let Le=0;Le<se.length;Le+=2)se[Le]=ge[se[Le]<<ae-se[Le+1]]>>>Ie}function a(se,ae){const{data:ge,noBuf:Ie}=se;let{buf:Le,BFINAL:nt,off:je,pos:Lt}=se,Je=0;for(;0===nt&&Je<ae;){let en,Bt,pn=0,$e=0;nt=T(ge,Lt,1),Je+=1;const mt=T(ge,Lt+1,2);if(Lt+=3,0!==mt){if(Ie&&(Le=R(Le,je+(1<<17))),1===mt)en=u.flmap,Bt=u.fdmap,pn=511,$e=31;else{if(2!==mt)throw new Error(`unknown BTYPE ${mt}`);{const _t=E(ge,Lt,5)+257,Me=E(ge,Lt+5,5)+1,Ke=E(ge,Lt+10,4)+4;Lt+=14;for(let gt=0;gt<38;gt+=2)u.itree[gt]=0,u.itree[gt+1]=0;let ut=1;for(let gt=0;gt<Ke;gt++){const yt=E(ge,Lt+3*gt,3);u.itree[1+(u.ordr[gt]<<1)]=yt,yt>ut&&(ut=yt)}Lt+=3*Ke,s(u.itree,ut),d(u.itree,ut,u.imap),en=u.lmap,Bt=u.dmap,Lt=f(u.imap,(1<<ut)-1,_t+Me,ge,Lt,u.ttree);const Kt=p(u.ttree,0,_t,u.ltree);pn=(1<<Kt)-1;const sn=p(u.ttree,_t,Me,u.dtree);$e=(1<<sn)-1,s(u.ltree,Kt),d(u.ltree,Kt,en),s(u.dtree,sn),d(u.dtree,sn,Bt)}}for(;;){const _t=en[L(ge,Lt)&pn];Lt+=15&_t;const Me=_t>>>4;if(Me>>>8){if(256===Me)break;{let Ke=je+Me-254;if(Me>264){const yt=u.ldef[Me-257];Ke=je+(yt>>>3)+E(ge,Lt,7&yt),Lt+=7&yt}const ut=Bt[L(ge,Lt)&$e];Lt+=15&ut;const sn=u.ddef[ut>>>4],gt=(sn>>>4)+T(ge,Lt,15&sn);for(Lt+=15&sn,Ie&&(Le=R(Le,je+(1<<17)));je<Ke;)Le[je]=Le[je++-gt],Le[je]=Le[je++-gt],Le[je]=Le[je++-gt],Le[je]=Le[je++-gt];je=Ke}}else Le[je++]=Me}}else{7&Lt&&(Lt+=8-(7&Lt));const _t=4+(Lt>>>3),Me=ge[_t-4]|ge[_t-3]<<8;Ie&&(Le=R(Le,je+Me)),Le.set(new Uint8Array(ge.buffer,ge.byteOffset+_t,Me),je),Lt=_t+Me<<3,je+=Me}}se.buf=Le,se.BFINAL=nt,se.off=je,se.pos=Lt}function D(){return(D=(0,e.A)(function*(se,ae,ge){if(3===ae[0]&&0===ae[1])return ge||new Uint8Array(0);const Ie=function h(se,ae){const ge=void 0===ae;return void 0===ae&&(ae=new Uint8Array(se.length>>>2<<3)),{data:se,buf:ae,noBuf:ge,BFINAL:0,off:0,pos:0}}(ae,ge);for(;0===Ie.BFINAL;)se.shouldUpdate&&(yield se.update({message:"Inflating blocks...",current:Ie.pos,max:ae.length})),a(Ie,100);return Ie.buf.length===Ie.off?Ie.buf:Ie.buf.slice(0,Ie.off)})).apply(this,arguments)}function R(se,ae){const ge=se.length;if(ae<=ge)return se;const Ie=new Uint8Array(Math.max(ge<<1,ae));return Ie.set(se,0),Ie}function f(se,ae,ge,Ie,Le,nt){let je=0;for(;je<ge;){const Lt=se[L(Ie,Le)&ae];Le+=15&Lt;const Je=Lt>>>4;if(Je<=15)nt[je]=Je,je++;else{let en=0,Bt=0;16===Je?(Bt=3+E(Ie,Le,2),Le+=2,en=nt[je-1]):17===Je?(Bt=3+E(Ie,Le,3),Le+=3):18===Je&&(Bt=11+E(Ie,Le,7),Le+=7);const pn=je+Bt;for(;je<pn;)nt[je]=en,je++}}return Le}function p(se,ae,ge,Ie){let Le=0,nt=0;const je=Ie.length>>>1;for(;nt<ge;){const Lt=se[nt+ae];Ie[nt<<1]=0,Ie[1+(nt<<1)]=Lt,Lt>Le&&(Le=Lt),nt++}for(;nt<je;)Ie[nt<<1]=0,Ie[1+(nt<<1)]=0,nt++;return Le}function E(se,ae,ge){return(se[ae>>>3]|se[1+(ae>>>3)]<<8)>>>(7&ae)&(1<<ge)-1}function T(se,ae,ge){return(se[ae>>>3]|se[1+(ae>>>3)]<<8|se[2+(ae>>>3)]<<16)>>>(7&ae)&(1<<ge)-1}function L(se,ae){return(se[ae>>>3]|se[1+(ae>>>3)]<<8|se[2+(ae>>>3)]<<16)>>>(7&ae)}!function(){for(let ge=0;ge<32768;ge++){let Ie=ge;Ie=(2863311530&Ie)>>>1|(1431655765&Ie)<<1,Ie=(3435973836&Ie)>>>2|(858993459&Ie)<<2,Ie=(4042322160&Ie)>>>4|(252645135&Ie)<<4,Ie=(4278255360&Ie)>>>8|(16711935&Ie)<<8,u.rev15[ge]=(Ie>>>16|Ie<<16)>>>17}function ae(ge,Ie,Le){for(;0!=Ie--;)ge.push(0,Le)}for(let ge=0;ge<32;ge++)u.ldef[ge]=u.of0[ge]<<3|u.exb[ge],u.ddef[ge]=u.df0[ge]<<4|u.dxb[ge];ae(u.fltree,144,8),ae(u.fltree,112,9),ae(u.fltree,24,7),ae(u.fltree,8,8),s(u.fltree,9),d(u.fltree,9,u.flmap),C(u.fltree,9),ae(u.fdtree,32,5),s(u.fdtree,5),d(u.fdtree,5,u.fdmap),C(u.fdtree,5),ae(u.itree,19,0),ae(u.ltree,286,0),ae(u.dtree,30,0),ae(u.ttree,320,0)}();var w=n(1372);function Q(se,ae,ge){const Ie=[],Le=se.length,nt=ae.length;for(let _t=0;_t<nt;_t+=2)ae[_t]=0,ae[_t+1]=0;for(let _t=0;_t<Le;_t++)0!==se[_t]&&Ie.push({lit:_t,f:se[_t],d:void 0});const je=Ie.length,Lt=Ie.slice(0);if(0===je)return 0;if(1===je){const _t=Ie[0].lit,Me=0===_t?1:0;return ae[1+(_t<<1)]=1,ae[1+(Me<<1)]=1,1}Ie.sort(function(_t,Me){return _t.f-Me.f});let Je=Ie[0],en=Ie[1],Bt=0,pn=1,$e=2;for(Ie[0]={lit:-1,f:Je.f+en.f,l:Je,r:en,d:0};pn!==je-1;)Je=Bt!==pn&&($e===je||Ie[Bt].f<Ie[$e].f)?Ie[Bt++]:Ie[$e++],en=Bt!==pn&&($e===je||Ie[Bt].f<Ie[$e].f)?Ie[Bt++]:Ie[$e++],Ie[pn++]={lit:-1,f:Je.f+en.f,l:Je,r:en,d:void 0};let mt=G(Ie[pn-1],0);mt>ge&&(function V(se,ae,ge){let Ie=0,Le=0;const nt=1<<ge-ae;for(se.sort(function(je,Lt){return Lt.d===je.d?je.f-Lt.f:Lt.d-je.d}),Ie=0;Ie<se.length&&se[Ie].d>ae;Ie++){const je=se[Ie].d;se[Ie].d=ae,Le+=nt-(1<<ge-je)}for(Le>>>=ge-ae;Le>0;){const je=se[Ie].d;je<ae?(se[Ie].d++,Le-=1<<ae-je-1):Ie++}for(;Ie>=0;Ie--)se[Ie].d===ae&&Le<0&&(se[Ie].d--,Le++);0!==Le&&console.log("debt left")}(Lt,ge,mt),mt=ge);for(let _t=0;_t<je;_t++)ae[1+(Lt[_t].lit<<1)]=Lt[_t].d;return mt}function G(se,ae){return-1!==se.lit?(se.d=ae,ae):Math.max(G(se.l,ae+1),G(se.r,ae+1))}function N(se,ae){const{data:ge,dlen:Ie,out:Le,opt:nt}=se;let{i:je,pos:Lt,cvrd:Je,li:en,lc:Bt,bs:pn,ebits:$e,c:mt,nc:_t}=se;const{lits:Me,strt:Ke,prev:ut}=u,Kt=Math.min(je+ae,Ie);for(;je<Kt;je++){if(mt=_t,je+1<Ie-2){_t=te(ge,je+1);const sn=je+1&32767;ut[sn]=Ke[_t],Ke[_t]=sn}if(Je<=je){(en>14e3||Bt>26697)&&Ie-je>100&&(Je<je&&(Me[en]=je-Je,en+=2,Je=je),Lt=de(je===Ie-1||Je===Ie?1:0,Me,en,$e,ge,pn,je-pn,Le,Lt),en=Bt=$e=0,pn=je);let sn=0;if(je<Ie-2&&(sn=J(ge,je,ut,mt,Math.min(nt[2],Ie-je),nt[3])),0!==sn){const gt=sn>>>16,yt=65535&sn,At=ee(gt,u.of0);u.lhst[257+At]++;const Gt=ee(yt,u.df0);u.dhst[Gt]++,$e+=u.exb[At]+u.dxb[Gt],Me[en]=gt<<23|je-Je,Me[en+1]=yt<<16|At<<8|Gt,en+=2,Je=je+gt}else u.lhst[ge[je]]++;Bt++}}se.i=je,se.pos=Lt,se.cvrd=Je,se.li=en,se.lc=Bt,se.bs=pn,se.ebits=$e,se.c=mt,se.nc=_t}const k=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function $(){return($=(0,e.A)(function*(se,ae,ge,Ie,Le){const nt=function U(se,ae,ge,Ie){const{lits:Le,strt:nt,prev:je}=u;return{data:se,out:ae,opt:k[Ie],i:0,pos:ge<<3,cvrd:0,dlen:se.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:Le,strt:nt,prev:je}}(ae,ge,Ie,Le),{dlen:je}=nt;if(0===Le){let{i:_t,pos:Me}=nt;for(;_t<je;){const Ke=Math.min(65535,je-_t);_e(ge,Me,_t+Ke===je?1:0),Me=ye(ae,_t,Ke,ge,Me+8),_t+=Ke}return Me>>>3}for(je>2&&(nt.nc=te(ae,0),nt.strt[nt.nc]=0);nt.i<je;)se.shouldUpdate&&(yield se.update({message:"Deflating...",current:nt.i,max:je})),N(nt,1048576);let{li:Lt,cvrd:Je,pos:en}=nt;const{i:Bt,lits:pn,bs:$e,ebits:mt}=nt;for(($e!==Bt||0===ae.length)&&(Je<Bt&&(pn[Lt]=Bt-Je,Lt+=2,Je=Bt),en=de(1,pn,Lt,mt,ae,$e,Bt-$e,ge,en));7&en;)en++;return en>>>3})).apply(this,arguments)}function J(se,ae,ge,Ie,Le,nt){let je=32767&ae,Lt=ge[je],Je=je-Lt+32768&32767;if(Lt===je||Ie!==te(se,ae-Je))return 0;let en=0,Bt=0;const pn=Math.min(32767,ae);for(;Je<=pn&&0!=--nt&&Lt!==je;){if(0===en||se[ae+en]===se[ae+en-Je]){let $e=W(se,ae,Je);if($e>en){if(en=$e,Bt=Je,en>=Le)break;Je+2<$e&&($e=Je+2);let mt=0;for(let _t=0;_t<$e-2;_t++){const Me=ae-Je+_t+32768&32767,ut=Me-ge[Me]+32768&32767;ut>mt&&(mt=ut,Lt=Me)}}}je=Lt,Lt=ge[je],Je+=je-Lt+32768&32767}return en<<16|Bt}function W(se,ae,ge){if(se[ae]!==se[ae-ge]||se[ae+1]!==se[ae+1-ge]||se[ae+2]!==se[ae+2-ge])return 0;const Ie=ae,Le=Math.min(se.length,ae+258);for(ae+=3;ae<Le&&se[ae]===se[ae-ge];)ae++;return ae-Ie}function te(se,ae){return(se[ae]<<8|se[ae+1])+(se[ae+2]<<4)&65535}function de(se,ae,ge,Ie,Le,nt,je,Lt,Je){u.lhst[256]++;const[en,Bt,pn,$e,mt,_t,Me,Ke]=function j(){const se=Q(u.lhst,u.ltree,15),ae=Q(u.dhst,u.dtree,15),ge=[],Ie=Y(u.ltree,ge),Le=[],nt=Y(u.dtree,Le);for(let Je=0;Je<ge.length;Je+=2)u.ihst[ge[Je]]++;for(let Je=0;Je<Le.length;Je+=2)u.ihst[Le[Je]]++;const je=Q(u.ihst,u.itree,7);let Lt=19;for(;Lt>4&&0===u.itree[1+(u.ordr[Lt-1]<<1)];)Lt--;return[se,ae,je,Ie,nt,Lt,ge,Le]}(),ut=32+(Je+3&7?8-(Je+3&7):0)+(je<<3),Kt=Ie+Z(u.fltree,u.lhst)+Z(u.fdtree,u.dhst);let sn=Ie+Z(u.ltree,u.lhst)+Z(u.dtree,u.dhst);sn+=14+3*_t+Z(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(let yt=0;yt<286;yt++)u.lhst[yt]=0;for(let yt=0;yt<30;yt++)u.dhst[yt]=0;for(let yt=0;yt<19;yt++)u.ihst[yt]=0;const gt=ut<Kt&&ut<sn?0:Kt<sn?1:2;if(xe(Lt,Je,se),xe(Lt,Je+1,gt),Je+=3,0===gt){for(;7&Je;)Je++;Je=ye(Le,nt,je,Lt,Je)}else{let yt,At;if(1===gt)yt=u.fltree,At=u.fdtree;else if(2===gt){s(u.ltree,en),C(u.ltree,en),s(u.dtree,Bt),C(u.dtree,Bt),s(u.itree,pn),C(u.itree,pn),yt=u.ltree,At=u.dtree,_e(Lt,Je,$e-257),_e(Lt,Je+=5,mt-1),_e(Lt,Je+=5,_t-4),Je+=4;for(let rn=0;rn<_t;rn++)_e(Lt,Je+3*rn,u.itree[1+(u.ordr[rn]<<1)]);Je=q(Me,u.itree,Lt,Je+=3*_t),Je=q(Ke,u.itree,Lt,Je)}else(0,w.dr)(gt);let Gt=nt;for(let rn=0;rn<ge;rn+=2){const tt=ae[rn],Mt=tt>>>23,nn=Gt+(8388607&tt);for(;Gt<nn;)Je=g(Le[Gt++],yt,Lt,Je);if(0!==Mt){const bn=ae[rn+1],Dn=bn>>16,jt=bn>>8&255,It=255&bn;_e(Lt,Je=g(257+jt,yt,Lt,Je),Mt-u.of0[jt]),xe(Lt,Je=g(It,At,Lt,Je+=u.exb[jt]),Dn-u.df0[It]),Je+=u.dxb[It],Gt+=Mt}}Je=g(256,yt,Lt,Je)}return Je}function ye(se,ae,ge,Ie,Le){let nt=Le>>>3;return Ie[nt]=ge,Ie[nt+1]=ge>>>8,Ie[nt+2]=255-Ie[nt],Ie[nt+3]=255-Ie[nt+1],nt+=4,Ie.set(new Uint8Array(se.buffer,ae,ge),nt),Le+(ge+4<<3)}function Z(se,ae){let ge=0;for(let Ie=0;Ie<ae.length;Ie++)ge+=ae[Ie]*se[1+(Ie<<1)];return ge}function q(se,ae,ge,Ie){for(let Le=0;Le<se.length;Le+=2){const nt=se[Le],je=se[Le+1];Ie=g(nt,ae,ge,Ie);const Lt=16===nt?2:17===nt?3:7;nt>15&&(_e(ge,Ie,je),Ie+=Lt)}return Ie}function Y(se,ae){let ge=se.length;for(;2!==ge&&0===se[ge-1];)ge-=2;for(let Ie=0;Ie<ge;Ie+=2){const Le=se[Ie+1],nt=Ie+3<ge?se[Ie+3]:-1,je=Ie+5<ge?se[Ie+5]:-1,Lt=0===Ie?-1:se[Ie-1];if(0===Le&&nt===Le&&je===Le){let Je=Ie+5;for(;Je+2<ge&&se[Je+2]===Le;)Je+=2;const en=Math.min(Je+1-Ie>>>1,138);en<11?ae.push(17,en-3):ae.push(18,en-11),Ie+=2*en-2}else if(Le===Lt&&nt===Le&&je===Le){let Je=Ie+5;for(;Je+2<ge&&se[Je+2]===Le;)Je+=2;const en=Math.min(Je+1-Ie>>>1,6);ae.push(16,en-3),Ie+=2*en-2}else ae.push(Le,0)}return ge>>>1}function ee(se,ae){let ge=0;return ae[16|ge]<=se&&(ge|=16),ae[8|ge]<=se&&(ge|=8),ae[4|ge]<=se&&(ge|=4),ae[2|ge]<=se&&(ge|=2),ae[1|ge]<=se&&(ge|=1),ge}function g(se,ae,ge,Ie){return xe(ge,Ie,ae[se<<1]),Ie+ae[1+(se<<1)]}function _e(se,ae,ge){const Ie=ae>>>3;se[Ie]|=ge<<=7&ae,se[Ie+1]|=ge>>>8}function xe(se,ae,ge){const Ie=ae>>>3;se[Ie]|=ge<<=7&ae,se[Ie+1]|=ge>>>8,se[Ie+2]|=ge>>>16}var le=n(4824);function Be(se,ae){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,e.A)(function*(se,ae,ge=!1){const Ie=Object.create(null),Le=new Uint8Array(ae);if(19280!==t(Le,0))throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).');let nt=Le.length-4;for(;101010256!==y(Le,nt);)nt--;let je=nt;je+=4,je+=4;const Lt=t(Le,je);je+=2,je+=2,je+=4;const Je=y(Le,je);je+=4,je=Je;for(let en=0;en<Lt;en++){je+=4,je+=4,je+=4,je+=4,je+=4;const Bt=y(Le,je);je+=4;const pn=y(Le,je);je+=4;const $e=t(Le,je),mt=t(Le,je+2),_t=t(Le,je+4);je+=6,je+=8;const Me=y(Le,je);je+=4,je+=$e+mt+_t,yield Re(se,Le,Me,Ie,Bt,pn,ge)}return Ie})).apply(this,arguments)}function Re(se,ae,ge,Ie,Le,nt,je){return ke.apply(this,arguments)}function ke(){return(ke=(0,e.A)(function*(se,ae,ge,Ie,Le,nt,je){ge+=4,ge+=2;const Lt=t(ae,ge+=2);ge+=2,ge+=4,ge+=4;const Je=t(ae,ge+=8),en=t(ae,ge+=2),Bt=function O(se,ae,ge){let Le,Ie="";for(let nt=0;nt<ge;nt++)Ie+="%"+v(se[ae+nt].toString(16));try{Le=decodeURIComponent(Ie)}catch{return function i(se,ae,ge){let Ie="";for(let Le=0;Le<ge;Le++)Ie+=String.fromCharCode(se[ae+Le]);return Ie}(se,ae,ge)}return Le}(ae,ge+=2,Je);if(ge+=Je,ge+=en,je)return void(Ie[Bt]={size:nt,csize:Le});const pn=new Uint8Array(ae.buffer,ge);if(0===Lt)Ie[Bt]=new Uint8Array(pn.buffer.slice(ge,ge+Le));else{if(8!==Lt)throw new Error(`unknown compression method: ${Lt}`);{const $e=new Uint8Array(nt);yield we(se,pn,$e),Ie[Bt]=$e}}})).apply(this,arguments)}function we(se,ae,ge){return Oe.apply(this,arguments)}function Oe(){return Oe=(0,e.A)(function*(se,ae,ge){return function S(se,ae,ge){return D.apply(this,arguments)}(se,ae,ge)}),Oe.apply(this,arguments)}function Ve(se,ae,ge){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,e.A)(function*(se,ae,ge){const Ie=ae[3];let Le=10;if(4&Ie&&(Le+=t(ae,Le)),8&Ie){let Bt=Le;for(;0!==ae[Bt];)++Bt;Le=Bt+1}if(16&Ie){let Bt=Le;for(;0!==ae[Bt];)++Bt;Le=Bt+1}1&Ie&&(Le+=2);const nt=function r(se){return 0|se}(y(ae,ae.length-8)),je=y(ae,ae.length-4);void 0===ge&&(ge=new Uint8Array(je));const Lt=new Uint8Array(ae.buffer,ae.byteOffset+Le,ae.length-Le-8),Je=yield we(se,Lt,ge);return nt!==l(Je,0,Je.length)&&console.error("ungzip: checksums don't match"),Je})).apply(this,arguments)}function be(se,ae,ge){return Te.apply(this,arguments)}function Te(){return Te=(0,e.A)(function*(se,ae,ge){void 0===ge&&(ge={level:6});const Ie=new Uint8Array(50+Math.floor(1.1*ae.length)),Le=yield function H(se,ae,ge,Ie,Le){return $.apply(this,arguments)}(se,ae,Ie,0,ge.level);return new Uint8Array(Ie.buffer,0,Le)}),Te.apply(this,arguments)}function ie(se,ae=!1){return le.YZ.create("Zip",ge=>function ue(se,ae){return re.apply(this,arguments)}(ge,se,ae))}function re(){return(re=(0,e.A)(function*(se,ae,ge=!1){let Ie=0;const Le={};for(const pn in ae){const $e=!ve(pn)&&!ge,mt=ae[pn],_t=l(mt,0,mt.length);Le[pn]={cpr:$e,usize:mt.length,crc:_t,file:$e?yield be(se,mt):mt}}for(const pn in Le)Ie+=Le[pn].file.length+30+46+2*_(pn);Ie+=22;const nt=new Uint8Array(Ie);let je=0;const Lt=[];for(const pn in Le){const $e=Le[pn];Lt.push(je),je=ce(nt,je,pn,$e,0)}let Je=0;const en=je;for(const pn in Le){const $e=Le[pn];Lt.push(je),je=ce(nt,je,pn,$e,1,Lt[Je++])}const Bt=je-en;return c(nt,je,101010256),je+=4,je+=4,A(nt,je,Je),je+=2,A(nt,je,Je),je+=2,c(nt,je,Bt),je+=4,c(nt,je,en),je+=4,je+=2,nt.buffer})).apply(this,arguments)}function ve(se){const ae=se.split(".").pop().toLowerCase();return-1!=="png,jpg,jpeg,zip".indexOf(ae)}function ce(se,ae,ge,Ie,Le,nt=0){const je=Ie.file;c(se,ae,0===Le?67324752:33639248),ae+=4,1===Le&&(ae+=2),A(se,ae,20),A(se,ae+=2,0),A(se,ae+=2,Ie.cpr?8:0),c(se,ae+=2,0),c(se,ae+=4,Ie.crc),c(se,ae+=4,je.length),c(se,ae+=4,Ie.usize),A(se,ae+=4,_(ge)),A(se,ae+=2,0),ae+=2,1===Le&&(ae+=2,ae+=2,c(se,ae+=6,nt),ae+=4);const Lt=function b(se,ae,ge){const Ie=ge.length;let Le=0;for(let nt=0;nt<Ie;nt++){const je=ge.charCodeAt(nt);if(4294967168&je)if(4294965248&je)if(4294901760&je){if(4292870144&je)throw new Error("e");se[ae+Le]=240|je>>18,se[ae+Le+1]=128|je>>12&63,se[ae+Le+2]=128|je>>6&63,se[ae+Le+3]=128|63&je,Le+=4}else se[ae+Le]=224|je>>12,se[ae+Le+1]=128|je>>6&63,se[ae+Le+2]=128|63&je,Le+=3;else se[ae+Le]=192|je>>6,se[ae+Le+1]=128|63&je,Le+=2;else se[ae+Le]=je,Le++}return Le}(se,ae,ge);return ae+=Lt,0===Le&&(se.set(je,ae),ae+=je.length),ae}},2209:(tn,Ue,n)=>{"use strict";var e=n(1395),o=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,A=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y={key:!0,ref:!0,__self:!0,__source:!0};function c(i,v,O){var b,_={},M=null,I=null;for(b in void 0!==O&&(M=""+O),void 0!==v.key&&(M=""+v.key),void 0!==v.ref&&(I=v.ref),v)t.call(v,b)&&!y.hasOwnProperty(b)&&(_[b]=v[b]);if(i&&i.defaultProps)for(b in v=i.defaultProps)void 0===_[b]&&(_[b]=v[b]);return{$$typeof:o,type:i,key:M,ref:I,props:_,_owner:A.current}}Ue.Fragment=r,Ue.jsx=c,Ue.jsxs=c},330:(tn,Ue)=>{"use strict";var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),t=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),y=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),i=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),b=Symbol.iterator,M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,l={};function m(k,H,$){this.props=k,this.context=H,this.refs=l,this.updater=$||M}function u(){}function d(k,H,$){this.props=k,this.context=H,this.refs=l,this.updater=$||M}m.prototype.isReactComponent={},m.prototype.setState=function(k,H){if("object"!=typeof k&&"function"!=typeof k&&null!=k)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,H,"setState")},m.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")},u.prototype=m.prototype;var s=d.prototype=new u;s.constructor=d,I(s,m.prototype),s.isPureReactComponent=!0;var C=Array.isArray,h=Object.prototype.hasOwnProperty,a={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function D(k,H,$){var J,W={},te=null,de=null;if(null!=H)for(J in void 0!==H.ref&&(de=H.ref),void 0!==H.key&&(te=""+H.key),H)h.call(H,J)&&!S.hasOwnProperty(J)&&(W[J]=H[J]);var ye=arguments.length-2;if(1===ye)W.children=$;else if(1<ye){for(var j=Array(ye),Z=0;Z<ye;Z++)j[Z]=arguments[Z+2];W.children=j}if(k&&k.defaultProps)for(J in ye=k.defaultProps)void 0===W[J]&&(W[J]=ye[J]);return{$$typeof:n,type:k,key:te,ref:de,props:W,_owner:a.current}}function f(k){return"object"==typeof k&&null!==k&&k.$$typeof===n}var E=/\/+/g;function T(k,H){return"object"==typeof k&&null!==k&&null!=k.key?function p(k){var H={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function($){return H[$]})}(""+k.key):H.toString(36)}function L(k,H,$,J,W){var te=typeof k;("undefined"===te||"boolean"===te)&&(k=null);var de=!1;if(null===k)de=!0;else switch(te){case"string":case"number":de=!0;break;case"object":switch(k.$$typeof){case n:case e:de=!0}}if(de)return W=W(de=k),k=""===J?"."+T(de,0):J,C(W)?($="",null!=k&&($=k.replace(E,"$&/")+"/"),L(W,H,$,"",function(Z){return Z})):null!=W&&(f(W)&&(W=function R(k,H){return{$$typeof:n,type:k.type,key:H,ref:k.ref,props:k.props,_owner:k._owner}}(W,$+(!W.key||de&&de.key===W.key?"":(""+W.key).replace(E,"$&/")+"/")+k)),H.push(W)),1;if(de=0,J=""===J?".":J+":",C(k))for(var ye=0;ye<k.length;ye++){var j=J+T(te=k[ye],ye);de+=L(te,H,$,j,W)}else if(j=function _(k){return null===k||"object"!=typeof k?null:"function"==typeof(k=b&&k[b]||k["@@iterator"])?k:null}(k),"function"==typeof j)for(k=j.call(k),ye=0;!(te=k.next()).done;)de+=L(te=te.value,H,$,j=J+T(te,ye++),W);else if("object"===te)throw H=String(k),Error("Objects are not valid as a React child (found: "+("[object Object]"===H?"object with keys {"+Object.keys(k).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return de}function w(k,H,$){if(null==k)return k;var J=[],W=0;return L(k,J,"","",function(te){return H.call($,te,W++)}),J}function Q(k){if(-1===k._status){var H=k._result;(H=H()).then(function($){(0===k._status||-1===k._status)&&(k._status=1,k._result=$)},function($){(0===k._status||-1===k._status)&&(k._status=2,k._result=$)}),-1===k._status&&(k._status=0,k._result=H)}if(1===k._status)return k._result.default;throw k._result}var G={current:null},V={transition:null},U={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:V,ReactCurrentOwner:a};function N(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:w,forEach:function(k,H,$){w(k,function(){H.apply(this,arguments)},$)},count:function(k){var H=0;return w(k,function(){H++}),H},toArray:function(k){return w(k,function(H){return H})||[]},only:function(k){if(!f(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},Ue.Component=m,Ue.Fragment=o,Ue.Profiler=t,Ue.PureComponent=d,Ue.StrictMode=r,Ue.Suspense=i,Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U,Ue.act=N,Ue.cloneElement=function(k,H,$){if(null==k)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+k+".");var J=I({},k.props),W=k.key,te=k.ref,de=k._owner;if(null!=H){if(void 0!==H.ref&&(te=H.ref,de=a.current),void 0!==H.key&&(W=""+H.key),k.type&&k.type.defaultProps)var ye=k.type.defaultProps;for(j in H)h.call(H,j)&&!S.hasOwnProperty(j)&&(J[j]=void 0===H[j]&&void 0!==ye?ye[j]:H[j])}var j=arguments.length-2;if(1===j)J.children=$;else if(1<j){ye=Array(j);for(var Z=0;Z<j;Z++)ye[Z]=arguments[Z+2];J.children=ye}return{$$typeof:n,type:k.type,key:W,ref:te,props:J,_owner:de}},Ue.createContext=function(k){return(k={$$typeof:y,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:A,_context:k},k.Consumer=k},Ue.createElement=D,Ue.createFactory=function(k){var H=D.bind(null,k);return H.type=k,H},Ue.createRef=function(){return{current:null}},Ue.forwardRef=function(k){return{$$typeof:c,render:k}},Ue.isValidElement=f,Ue.lazy=function(k){return{$$typeof:O,_payload:{_status:-1,_result:k},_init:Q}},Ue.memo=function(k,H){return{$$typeof:v,type:k,compare:void 0===H?null:H}},Ue.startTransition=function(k){var H=V.transition;V.transition={};try{k()}finally{V.transition=H}},Ue.unstable_act=N,Ue.useCallback=function(k,H){return G.current.useCallback(k,H)},Ue.useContext=function(k){return G.current.useContext(k)},Ue.useDebugValue=function(){},Ue.useDeferredValue=function(k){return G.current.useDeferredValue(k)},Ue.useEffect=function(k,H){return G.current.useEffect(k,H)},Ue.useId=function(){return G.current.useId()},Ue.useImperativeHandle=function(k,H,$){return G.current.useImperativeHandle(k,H,$)},Ue.useInsertionEffect=function(k,H){return G.current.useInsertionEffect(k,H)},Ue.useLayoutEffect=function(k,H){return G.current.useLayoutEffect(k,H)},Ue.useMemo=function(k,H){return G.current.useMemo(k,H)},Ue.useReducer=function(k,H,$){return G.current.useReducer(k,H,$)},Ue.useRef=function(k){return G.current.useRef(k)},Ue.useState=function(k){return G.current.useState(k)},Ue.useSyncExternalStore=function(k,H,$){return G.current.useSyncExternalStore(k,H,$)},Ue.useTransition=function(){return G.current.useTransition()},Ue.version="18.3.1"},1395:(tn,Ue,n)=>{"use strict";tn.exports=n(330)},9619:(tn,Ue,n)=>{"use strict";tn.exports=n(2209)},2771:(tn,Ue,n)=>{"use strict";n.d(Ue,{m:()=>r});var e=n(1413),o=n(6129);class r extends e.B{constructor(A=1/0,y=1/0,c=o.U){super(),this._bufferSize=A,this._windowTime=y,this._timestampProvider=c,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=y===1/0,this._bufferSize=Math.max(1,A),this._windowTime=Math.max(1,y)}next(A){const{isStopped:y,_buffer:c,_infiniteTimeWindow:i,_timestampProvider:v,_windowTime:O}=this;y||(c.push(A),!i&&c.push(v.now()+O)),this._trimBuffer(),super.next(A)}_subscribe(A){this._throwIfClosed(),this._trimBuffer();const y=this._innerSubscribe(A),{_infiniteTimeWindow:c,_buffer:i}=this,v=i.slice();for(let O=0;O<v.length&&!A.closed;O+=c?1:2)A.next(v[O]);return this._checkFinalizedStatuses(A),y}_trimBuffer(){const{_bufferSize:A,_timestampProvider:y,_buffer:c,_infiniteTimeWindow:i}=this,v=(i?1:2)*A;if(A<1/0&&v<c.length&&c.splice(0,c.length-v),!i){const O=y.now();let b=0;for(let _=1;_<c.length&&c[_]<=O;_+=2)b=_;b&&c.splice(0,b+1)}}}},7786:(tn,Ue,n)=>{"use strict";n.d(Ue,{h:()=>y});var e=n(6365),o=n(8750),r=n(983),t=n(9326),A=n(6648);function y(...c){const i=(0,t.lI)(c),v=(0,t.R0)(c,1/0),O=c;return O.length?1===O.length?(0,o.Tg)(O[0]):(0,e.U)(v)((0,A.H)(O,i)):r.w}},1584:(tn,Ue,n)=>{"use strict";n.d(Ue,{O:()=>A});var e=n(1985),o=n(8839),r=n(9470);function A(y=0,c,i=o.b){let v=-1;return null!=c&&((0,r.m)(c)?i=c:v=c),new e.c(O=>{let b=function t(y){return y instanceof Date&&!isNaN(y)}(y)?+y-i.now():y;b<0&&(b=0);let _=0;return i.schedule(function(){O.closed||(O.next(_++),0<=v?this.schedule(void 0,v):O.complete())},b)})}},140:(tn,Ue,n)=>{"use strict";n.d(Ue,{v:()=>i});var e=n(1983),o=n(9974),r=n(2326),t=n(6450),A=n(1203),y=n(9326);function c(...v){const O=(0,y.ms)(v);return O?(0,A.F)(c(...v),(0,t.I)(O)):(0,o.N)((b,_)=>{(0,e.P)([b,...(0,r.K)(v)])(_)})}function i(...v){return c(...v)}},152:(tn,Ue,n)=>{"use strict";n.d(Ue,{B:()=>t});var e=n(8839),o=n(9974),r=n(4360);function t(A,y=e.E){return(0,o.N)((c,i)=>{let v=null,O=null,b=null;const _=()=>{if(v){v.unsubscribe(),v=null;const I=O;O=null,i.next(I)}};function M(){const I=b+A,l=y.now();if(l<I)return v=this.schedule(void 0,I-l),void i.add(v);_()}c.subscribe((0,r._)(i,I=>{O=I,b=y.now(),v||(v=y.schedule(M,A),i.add(v))},()=>{_(),i.complete()},void 0,()=>{O=v=null}))})}},3294:(tn,Ue,n)=>{"use strict";n.d(Ue,{F:()=>t});var e=n(3669),o=n(9974),r=n(4360);function t(y,c=e.D){return y=y??A,(0,o.N)((i,v)=>{let O,b=!0;i.subscribe((0,r._)(v,_=>{const M=c(_);(b||!y(O,M))&&(b=!1,O=M,v.next(_))}))})}function A(y,c){return y===c}},9568:(tn,Ue,n)=>{"use strict";n.d(Ue,{t:()=>i});var e=n(2771),o=n(8750),r=n(1413),t=n(7707),A=n(9974);function c(v,O,...b){if(!0===O)return void v();if(!1===O)return;const _=new t.Ms({next:()=>{_.unsubscribe(),v()}});return(0,o.Tg)(O(...b)).subscribe(_)}function i(v,O,b){let _,M=!1;return v&&"object"==typeof v?({bufferSize:_=1/0,windowTime:O=1/0,refCount:M=!1,scheduler:b}=v):_=v??1/0,function y(v={}){const{connector:O=(()=>new r.B),resetOnError:b=!0,resetOnComplete:_=!0,resetOnRefCountZero:M=!0}=v;return I=>{let l,m,u,d=0,s=!1,C=!1;const h=()=>{m?.unsubscribe(),m=void 0},a=()=>{h(),l=u=void 0,s=C=!1},S=()=>{const D=l;a(),D?.unsubscribe()};return(0,A.N)((D,R)=>{d++,!C&&!s&&h();const f=u=u??O();R.add(()=>{d--,0===d&&!C&&!s&&(m=c(S,M))}),f.subscribe(R),!l&&d>0&&(l=new t.Ms({next:p=>f.next(p),error:p=>{C=!0,h(),m=c(a,b,p),f.error(p)},complete:()=>{s=!0,h(),m=c(a,_),f.complete()}}),(0,o.Tg)(D).subscribe(l))})(I)}}({connector:()=>new e.m(_,O,b),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:M})}},3386:(tn,Ue,n)=>{"use strict";n.d(Ue,{c:()=>c});var e=n(8839),o=n(9974),r=n(4360),t=n(8750),y=n(1584);function c(i,v=e.E,O){const b=(0,y.O)(i,v);return function A(i,v){return(0,o.N)((O,b)=>{const{leading:_=!0,trailing:M=!1}=v??{};let I=!1,l=null,m=null,u=!1;const d=()=>{m?.unsubscribe(),m=null,M&&(h(),u&&b.complete())},s=()=>{m=null,u&&b.complete()},C=a=>m=(0,t.Tg)(i(a)).subscribe((0,r._)(b,d,s)),h=()=>{if(I){I=!1;const a=l;l=null,b.next(a),!u&&C(a)}};O.subscribe((0,r._)(b,a=>{I=!0,l=a,(!m||m.closed)&&(_?h():C(a))},()=>{u=!0,(!(M&&I&&m)||m.closed)&&b.complete()}))})}(()=>b,O)}},8839:(tn,Ue,n)=>{"use strict";n.d(Ue,{b:()=>O,E:()=>v});var e=n(8359);class o extends e.yU{constructor(_,M){super()}schedule(_,M=0){return this}}const r={setInterval(b,_,...M){const{delegate:I}=r;return I?.setInterval?I.setInterval(b,_,...M):setInterval(b,_,...M)},clearInterval(b){const{delegate:_}=r;return(_?.clearInterval||clearInterval)(b)},delegate:void 0};var t=n(7908),y=n(6129);class c{constructor(_,M=c.now){this.schedulerActionCtor=_,this.now=M}schedule(_,M=0,I){return new this.schedulerActionCtor(this,_).schedule(I,M)}}c.now=y.U.now;const v=new class i extends c{constructor(_,M=c.now){super(_,M),this.actions=[],this._active=!1}flush(_){const{actions:M}=this;if(this._active)return void M.push(_);let I;this._active=!0;do{if(I=_.execute(_.state,_.delay))break}while(_=M.shift());if(this._active=!1,I){for(;_=M.shift();)_.unsubscribe();throw I}}}(class A extends o{constructor(_,M){super(_,M),this.scheduler=_,this.work=M,this.pending=!1}schedule(_,M=0){var I;if(this.closed)return this;this.state=_;const l=this.id,m=this.scheduler;return null!=l&&(this.id=this.recycleAsyncId(m,l,M)),this.pending=!0,this.delay=M,this.id=null!==(I=this.id)&&void 0!==I?I:this.requestAsyncId(m,this.id,M),this}requestAsyncId(_,M,I=0){return r.setInterval(_.flush.bind(_,this),I)}recycleAsyncId(_,M,I=0){if(null!=I&&this.delay===I&&!1===this.pending)return M;null!=M&&r.clearInterval(M)}execute(_,M){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const I=this._execute(_,M);if(I)return I;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(_,M){let l,I=!1;try{this.work(_)}catch(m){I=!0,l=m||new Error("Scheduled action threw falsy error")}if(I)return this.unsubscribe(),l}unsubscribe(){if(!this.closed){const{id:_,scheduler:M}=this,{actions:I}=M;this.work=this.state=this.scheduler=null,this.pending=!1,(0,t.o)(I,this),null!=_&&(this.id=this.recycleAsyncId(M,_,null)),this.delay=null,super.unsubscribe()}}}),O=v},6129:(tn,Ue,n)=>{"use strict";n.d(Ue,{U:()=>e});const e={now:()=>(e.delegate||Date).now(),delegate:void 0}},2326:(tn,Ue,n)=>{"use strict";n.d(Ue,{K:()=>o});const{isArray:e}=Array;function o(r){return 1===r.length&&e(r[0])?r[0]:r}},2684:tn=>{tn.exports=XMLHttpRequest},1025:(tn,Ue,n)=>{"use strict";n.d(Ue,{ht:()=>Re,jM:()=>Be});var e=Symbol.for("immer-nothing"),o=Symbol.for("immer-draftable"),r=Symbol.for("immer-state");function A(K,...ne){throw new Error(`[Immer] minified error nr: ${K}. Full error at: https://bit.ly/3cXEKWf`)}var y=Object.getPrototypeOf;function c(K){return!!K&&!!K[r]}function i(K){return!!K&&(O(K)||Array.isArray(K)||!!K[o]||!!K.constructor?.[o]||d(K)||s(K))}var v=Object.prototype.constructor.toString();function O(K){if(!K||"object"!=typeof K)return!1;const ne=y(K);if(null===ne)return!0;const be=Object.hasOwnProperty.call(ne,"constructor")&&ne.constructor;return be===Object||"function"==typeof be&&Function.toString.call(be)===v}function _(K,ne){0===M(K)?Reflect.ownKeys(K).forEach(be=>{ne(be,K[be],K)}):K.forEach((be,Te)=>ne(Te,be,K))}function M(K){const ne=K[r];return ne?ne.type_:Array.isArray(K)?1:d(K)?2:s(K)?3:0}function I(K,ne){return 2===M(K)?K.has(ne):Object.prototype.hasOwnProperty.call(K,ne)}function m(K,ne,be){const Te=M(K);2===Te?K.set(ne,be):3===Te?K.add(be):K[ne]=be}function d(K){return K instanceof Map}function s(K){return K instanceof Set}function C(K){return K.copy_||K.base_}function h(K,ne){if(d(K))return new Map(K);if(s(K))return new Set(K);if(Array.isArray(K))return Array.prototype.slice.call(K);const be=O(K);if(!0===ne||"class_only"===ne&&!be){const Te=Object.getOwnPropertyDescriptors(K);delete Te[r];let ie=Reflect.ownKeys(Te);for(let ue=0;ue<ie.length;ue++){const re=ie[ue],ve=Te[re];!1===ve.writable&&(ve.writable=!0,ve.configurable=!0),(ve.get||ve.set)&&(Te[re]={configurable:!0,writable:!0,enumerable:ve.enumerable,value:K[re]})}return Object.create(y(K),Te)}{const Te=y(K);if(null!==Te&&be)return{...K};const ie=Object.create(Te);return Object.assign(ie,K)}}function a(K,ne=!1){return D(K)||c(K)||!i(K)||(M(K)>1&&(K.set=K.add=K.clear=K.delete=S),Object.freeze(K),ne&&Object.entries(K).forEach(([be,Te])=>a(Te,!0))),K}function S(){A(2)}function D(K){return Object.isFrozen(K)}var E,R={};function f(K){const ne=R[K];return ne||A(0),ne}function T(){return E}function w(K,ne){ne&&(f("Patches"),K.patches_=[],K.inversePatches_=[],K.patchListener_=ne)}function Q(K){G(K),K.drafts_.forEach(U),K.drafts_=null}function G(K){K===E&&(E=K.parent_)}function V(K){return E=function L(K,ne){return{drafts_:[],parent_:K,immer_:ne,canAutoFreeze_:!0,unfinalizedDrafts_:0}}(E,K)}function U(K){const ne=K[r];0===ne.type_||1===ne.type_?ne.revoke_():ne.revoked_=!0}function N(K,ne){ne.unfinalizedDrafts_=ne.drafts_.length;const be=ne.drafts_[0];return void 0!==K&&K!==be?(be[r].modified_&&(Q(ne),A(4)),i(K)&&(K=k(ne,K),ne.parent_||$(ne,K)),ne.patches_&&f("Patches").generateReplacementPatches_(be[r].base_,K,ne.patches_,ne.inversePatches_)):K=k(ne,be,[]),Q(ne),ne.patches_&&ne.patchListener_(ne.patches_,ne.inversePatches_),K!==e?K:void 0}function k(K,ne,be){if(D(ne))return ne;const Te=ne[r];if(!Te)return _(ne,(ie,ue)=>H(K,Te,ne,ie,ue,be)),ne;if(Te.scope_!==K)return ne;if(!Te.modified_)return $(K,Te.base_,!0),Te.base_;if(!Te.finalized_){Te.finalized_=!0,Te.scope_.unfinalizedDrafts_--;const ie=Te.copy_;let ue=ie,re=!1;3===Te.type_&&(ue=new Set(ie),ie.clear(),re=!0),_(ue,(ve,ce)=>H(K,Te,ie,ve,ce,be,re)),$(K,ie,!1),be&&K.patches_&&f("Patches").generatePatches_(Te,be,K.patches_,K.inversePatches_)}return Te.copy_}function H(K,ne,be,Te,ie,ue,re){if(c(ie)){const ce=k(K,ie,ue&&ne&&3!==ne.type_&&!I(ne.assigned_,Te)?ue.concat(Te):void 0);if(m(be,Te,ce),!c(ce))return;K.canAutoFreeze_=!1}else re&&be.add(ie);if(i(ie)&&!D(ie)){if(!K.immer_.autoFreeze_&&K.unfinalizedDrafts_<1)return;k(K,ie),(!ne||!ne.scope_.parent_)&&"symbol"!=typeof Te&&Object.prototype.propertyIsEnumerable.call(be,Te)&&$(K,ie)}}function $(K,ne,be=!1){!K.parent_&&K.immer_.autoFreeze_&&K.canAutoFreeze_&&a(ne,be)}var W={get(K,ne){if(ne===r)return K;const be=C(K);if(!I(be,ne))return function ye(K,ne,be){const Te=j(ne,be);return Te?"value"in Te?Te.value:Te.get?.call(K.draft_):void 0}(K,be,ne);const Te=be[ne];return K.finalized_||!i(Te)?Te:Te===de(K.base_,ne)?(q(K),K.copy_[ne]=ee(Te,K)):Te},has:(K,ne)=>ne in C(K),ownKeys:K=>Reflect.ownKeys(C(K)),set(K,ne,be){const Te=j(C(K),ne);if(Te?.set)return Te.set.call(K.draft_,be),!0;if(!K.modified_){const ie=de(C(K),ne),ue=ie?.[r];if(ue&&ue.base_===be)return K.copy_[ne]=be,K.assigned_[ne]=!1,!0;if(function u(K,ne){return K===ne?0!==K||1/K==1/ne:K!=K&&ne!=ne}(be,ie)&&(void 0!==be||I(K.base_,ne)))return!0;q(K),Z(K)}return K.copy_[ne]===be&&(void 0!==be||ne in K.copy_)||Number.isNaN(be)&&Number.isNaN(K.copy_[ne])||(K.copy_[ne]=be,K.assigned_[ne]=!0),!0},deleteProperty:(K,ne)=>(void 0!==de(K.base_,ne)||ne in K.base_?(K.assigned_[ne]=!1,q(K),Z(K)):delete K.assigned_[ne],K.copy_&&delete K.copy_[ne],!0),getOwnPropertyDescriptor(K,ne){const be=C(K),Te=Reflect.getOwnPropertyDescriptor(be,ne);return Te&&{writable:!0,configurable:1!==K.type_||"length"!==ne,enumerable:Te.enumerable,value:be[ne]}},defineProperty(){A(11)},getPrototypeOf:K=>y(K.base_),setPrototypeOf(){A(12)}},te={};function de(K,ne){const be=K[r];return(be?C(be):K)[ne]}function j(K,ne){if(!(ne in K))return;let be=y(K);for(;be;){const Te=Object.getOwnPropertyDescriptor(be,ne);if(Te)return Te;be=y(be)}}function Z(K){K.modified_||(K.modified_=!0,K.parent_&&Z(K.parent_))}function q(K){K.copy_||(K.copy_=h(K.base_,K.scope_.immer_.useStrictShallowCopy_))}function ee(K,ne){const be=d(K)?f("MapSet").proxyMap_(K,ne):s(K)?f("MapSet").proxySet_(K,ne):function J(K,ne){const be=Array.isArray(K),Te={type_:be?1:0,scope_:ne?ne.scope_:T(),modified_:!1,finalized_:!1,assigned_:{},parent_:ne,base_:K,draft_:null,copy_:null,revoke_:null,isManual_:!1};let ie=Te,ue=W;be&&(ie=[Te],ue=te);const{revoke:re,proxy:ve}=Proxy.revocable(ie,ue);return Te.draft_=ve,Te.revoke_=re,ve}(K,ne);return(ne?ne.scope_:T()).drafts_.push(be),be}function _e(K){if(!i(K)||D(K))return K;const ne=K[r];let be;if(ne){if(!ne.modified_)return ne.base_;ne.finalized_=!0,be=h(K,ne.scope_.immer_.useStrictShallowCopy_)}else be=h(K,!0);return _(be,(Te,ie)=>{m(be,Te,_e(ie))}),ne&&(ne.finalized_=!1),be}_(W,(K,ne)=>{te[K]=function(){return arguments[0]=arguments[0][0],ne.apply(this,arguments)}}),te.deleteProperty=function(K,ne){return te.set.call(this,K,ne,void 0)},te.set=function(K,ne,be){return W.set.call(this,K[0],ne,be,K[0])};var Ae=new class{constructor(K){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(ne,be,Te)=>{if("function"==typeof ne&&"function"!=typeof be){const ue=be;be=ne;const re=this;return function(ce=ue,...se){return re.produce(ce,ae=>be.call(this,ae,...se))}}let ie;if("function"!=typeof be&&A(6),void 0!==Te&&"function"!=typeof Te&&A(7),i(ne)){const ue=V(this),re=ee(ne,void 0);let ve=!0;try{ie=be(re),ve=!1}finally{ve?Q(ue):G(ue)}return w(ue,Te),N(ie,ue)}if(!ne||"object"!=typeof ne){if(ie=be(ne),void 0===ie&&(ie=ne),ie===e&&(ie=void 0),this.autoFreeze_&&a(ie,!0),Te){const ue=[],re=[];f("Patches").generateReplacementPatches_(ne,ie,ue,re),Te(ue,re)}return ie}A(1)},this.produceWithPatches=(ne,be)=>{if("function"==typeof ne)return(re,...ve)=>this.produceWithPatches(re,ce=>ne(ce,...ve));let Te,ie;return[this.produce(ne,be,(re,ve)=>{Te=re,ie=ve}),Te,ie]},"boolean"==typeof K?.autoFreeze&&this.setAutoFreeze(K.autoFreeze),"boolean"==typeof K?.useStrictShallowCopy&&this.setUseStrictShallowCopy(K.useStrictShallowCopy)}createDraft(K){i(K)||A(8),c(K)&&(K=function g(K){return c(K)||A(10),_e(K)}(K));const ne=V(this),be=ee(K,void 0);return be[r].isManual_=!0,G(ne),be}finishDraft(K,ne){const be=K&&K[r];(!be||!be.isManual_)&&A(9);const{scope_:Te}=be;return w(Te,ne),N(void 0,Te)}setAutoFreeze(K){this.autoFreeze_=K}setUseStrictShallowCopy(K){this.useStrictShallowCopy_=K}applyPatches(K,ne){let be;for(be=ne.length-1;be>=0;be--){const ie=ne[be];if(0===ie.path.length&&"replace"===ie.op){K=ie.value;break}}be>-1&&(ne=ne.slice(be+1));const Te=f("Patches").applyPatches_;return c(K)?Te(K,ne):this.produce(K,ie=>Te(ie,ne))}},Be=Ae.produce,Re=(Ae.produceWithPatches.bind(Ae),Ae.setAutoFreeze.bind(Ae));Ae.setUseStrictShallowCopy.bind(Ae),Ae.applyPatches.bind(Ae),Ae.createDraft.bind(Ae),Ae.finishDraft.bind(Ae)}}]);