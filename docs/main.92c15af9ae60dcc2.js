(self.webpackChunkdemo_showcase=self.webpackChunkdemo_showcase||[]).push([[179],{269:($y,_5,Or)=>{"use strict";var Jy={};Or.r(Jy),Or.d(Jy,{Download:()=>xY,DownloadBlob:()=>_Y,ImportJson:()=>ZEe,ImportString:()=>KEe,LazyVolume:()=>$Ee,ParseBlob:()=>UEe,ParseCcp4:()=>WEe,ParseCif:()=>VEe,ParseCube:()=>GEe,ParseDsn6:()=>YEe,ParseDx:()=>XEe,ParseJson:()=>QEe,ParsePly:()=>qEe,ParsePrmtop:()=>HEe,ParsePsf:()=>zEe,ParseTop:()=>jEe,RawData:()=>wY,ReadFile:()=>AY});var cE={};Or.r(cE),Or.d(cE,{CreateGroup:()=>JEe});var lE={};Or.r(lE),Or.d(lE,{atomicHet:()=>Nke,atomicSequence:()=>Fke,bundleElementImpl:()=>$Z,bundleGenerator:()=>JZ,defaultBondTest:()=>U4,spheres:()=>kke,water:()=>Bke});var dE={};Or.r(dE),Or.d(dE,{all:()=>rQ,atoms:()=>z4,bondedAtomicPairs:()=>Yke,chains:()=>Vke,none:()=>G4,querySelection:()=>Wke,residues:()=>Uke,rings:()=>qke});var fE={};Or.r(fE),Or.d(fE,{exceptBy:()=>KLe,expandProperty:()=>QLe,includeConnected:()=>$Le,includeSurroundings:()=>WLe,intersectBy:()=>XLe,querySelection:()=>YLe,surroundingLigands:()=>e5e,union:()=>ZLe,wholeResidues:()=>HLe});var pE={};Or.r(pE),Or.d(pE,{areIntersectedBy:()=>f5e,first:()=>c5e,getCurrentStructureProperties:()=>KA,isConnectedTo:()=>y5e,pick:()=>u5e,withSameAtomProperties:()=>d5e,within:()=>p5e});var mE={};Or.r(mE),Or.d(mE,{intersect:()=>S5e,merge:()=>b5e});var hE={};Or.r(hE),Or.d(hE,{atomCount:()=>C5e,countQuery:()=>x5e,propertySet:()=>_5e});var vE={};Or.r(vE),Or.d(vE,{CoordinatesFromDcd:()=>cze,CoordinatesFromNctraj:()=>fze,CoordinatesFromTrr:()=>dze,CoordinatesFromXtc:()=>lze,CustomModelProperties:()=>K$,CustomStructureProperties:()=>Q$,ModelFromTrajectory:()=>j$,MultiStructureSelectionFromExpression:()=>Oze,ShapeFromPly:()=>Uze,StructureComplexElement:()=>kze,StructureComplexElementTypes:()=>X$,StructureComponent:()=>Lze,StructureFromModel:()=>Pze,StructureFromTrajectory:()=>Ize,StructureSelectionFromBundle:()=>Bze,StructureSelectionFromExpression:()=>Rze,StructureSelectionFromScript:()=>Fze,TopologyFromPrmtop:()=>mze,TopologyFromPsf:()=>pze,TopologyFromTop:()=>hze,TrajectoryFromBlob:()=>gze,TrajectoryFromCifCore:()=>Tze,TrajectoryFromCube:()=>Aze,TrajectoryFromGRO:()=>Sze,TrajectoryFromMOL:()=>xze,TrajectoryFromMOL2:()=>wze,TrajectoryFromMmCif:()=>yze,TrajectoryFromModelAndCoordinates:()=>LB,TrajectoryFromPDB:()=>bze,TrajectoryFromSDF:()=>_ze,TrajectoryFromXYZ:()=>Cze,TransformStructureConformation:()=>Mze});var gE={};Or.r(gE),Or.d(gE,{AssignColorVolume:()=>$ze,VolumeFromCcp4:()=>Wze,VolumeFromCube:()=>Xze,VolumeFromDensityServerCif:()=>Zze,VolumeFromDsn6:()=>Yze,VolumeFromDx:()=>Kze,VolumeFromSegmentationCif:()=>Qze});var yE={};Or.r(yE),Or.d(yE,{BoxShape3D:()=>_qe,getBoxMesh:()=>TN});var bE={};Or.r(bE),Or.d(bE,{ClippingStructureRepresentation3DFromBundle:()=>Gqe,ClippingStructureRepresentation3DFromScript:()=>Vqe,ExplodeStructureRepresentation3D:()=>Rqe,ModelUnitcell3D:()=>qqe,OverpaintStructureRepresentation3DFromBundle:()=>Bqe,OverpaintStructureRepresentation3DFromScript:()=>Fqe,ShapeRepresentation3D:()=>jqe,SpinStructureRepresentation3D:()=>Oqe,StructureBoundingBox3D:()=>Wqe,StructureRepresentation3D:()=>BT,StructureSelectionsAngle3D:()=>Xqe,StructureSelectionsDihedral3D:()=>Kqe,StructureSelectionsDistance3D:()=>Yqe,StructureSelectionsLabel3D:()=>Zqe,StructureSelectionsOrientation3D:()=>Qqe,StructureSelectionsPlane3D:()=>$qe,SubstanceStructureRepresentation3DFromBundle:()=>Uqe,SubstanceStructureRepresentation3DFromScript:()=>Lqe,ThemeStrengthRepresentation3D:()=>zqe,TransparencyStructureRepresentation3DFromBundle:()=>kqe,TransparencyStructureRepresentation3DFromScript:()=>Nqe,UnwindStructureAssemblyRepresentation3D:()=>Mqe,VolumeRepresentation3D:()=>Hqe,VolumeRepresentation3DHelpers:()=>Bd});var SE={};Or.r(SE),Or.d(SE,{ApplyAction:()=>Ute,ClearHighlights:()=>jte,Highlight:()=>Hte,RemoveObject:()=>Vte,SetCurrentObject:()=>kte,Snapshots:()=>qte,SyncBehaviors:()=>Nte,ToggleExpanded:()=>Gte,ToggleVisibility:()=>zte,Update:()=>Lte,registerDefault:()=>pWe,setSubtreeVisibility:()=>Cy});var CE={};Or.r(CE),Or.d(CE,{SyncRepresentationToCanvas:()=>Wte,SyncStructureRepresentation3DState:()=>Yte,UpdateRepresentationVisibility:()=>Xte,registerDefault:()=>hWe});var xE={};Or.r(xE),Or.d(xE,{Focus:()=>Qte,OrientAxes:()=>$te,Reset:()=>Kte,ResetAxes:()=>Jte,SetSnapshot:()=>Zte,registerDefault:()=>vWe});var _E={};Or.r(_E),Or.d(_E,{Canvas3DSetSettings:()=>kre,registerDefault:()=>jXe});var wE={};Or.r(wE),Or.d(wE,{DefaultFocusLociBindings:()=>Ure,DefaultLociLabelProvider:()=>ZXe,DefaultSelectLociBindings:()=>Lre,FocusLoci:()=>$Xe,HighlightLoci:()=>YXe,SelectLoci:()=>KXe});var AE={};Or.r(AE),Or.d(AE,{CameraAxisHelper:()=>tKe,CameraControls:()=>nKe,DefaultClickResetCameraOnEmpty:()=>KN,DefaultClickResetCameraOnEmptySelectMode:()=>ZN,DefaultFocusLociBindings:()=>Vre,FocusLoci:()=>eKe});var TE={};Or.r(TE),Or.d(TE,{AccessibleSurfaceArea:()=>pKe,BestDatabaseSequenceMapping:()=>A$e,CrossLinkRestraint:()=>G$e,Interactions:()=>S$e,SecondaryStructure:()=>C$e,StructureInfo:()=>aKe,ValenceModel:()=>x$e});var DE={};Or.r(DE),Or.d(DE,{AddTrajectory:()=>wJe,DownloadStructure:()=>gJe,EnableModelCustomProps:()=>xJe,EnableStructureCustomProps:()=>_Je,LoadTrajectory:()=>AJe,PdbDownloadProvider:()=>yae,UpdateTrajectory:()=>CJe});var EE={};Or.r(EE),Or.d(EE,{AssignColorVolume:()=>bae,DownloadDensity:()=>TJe});var IE={};Or.r(IE),Or.d(IE,{DownloadFile:()=>DJe,OpenFiles:()=>Sae});let oo=null,bC=1;function li(e){const t=oo;return oo=e,t}function w5(e){if((!tb(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==bC)){if(!e.producerMustRecompute(e)&&!RE(e))return e.dirty=!1,void(e.lastCleanEpoch=bC);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=bC}}function RE(e){Xv(e);for(let t=0;t<e.producerNode.length;t++){const r=e.producerNode[t],n=e.producerLastReadVersion[t];if(n!==r.version||(w5(r),n!==r.version))return!0}return!1}function CC(e,t){if(function M5(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),Xv(e),1===e.liveConsumerNode.length)for(let n=0;n<e.producerNode.length;n++)CC(e.producerNode[n],e.producerIndexOfThis[n]);const r=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[r],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[r],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const n=e.liveConsumerIndexOfThis[t],a=e.liveConsumerNode[t];Xv(a),a.producerIndexOfThis[n]=t}}function tb(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Xv(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let R5=null;function Fa(e){return"function"==typeof e}function BE(e){const r=e(n=>{Error.call(n),n.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}const NE=BE(e=>function(r){e(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((n,a)=>`${a+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function xC(e,t){if(e){const r=e.indexOf(t);0<=r&&e.splice(r,1)}}class Xs{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const i of r)i.remove(this);else r.remove(this);const{initialTeardown:n}=this;if(Fa(n))try{n()}catch(i){t=i instanceof NE?i.errors:[i]}const{_finalizers:a}=this;if(a){this._finalizers=null;for(const i of a)try{k5(i)}catch(o){t=t??[],o instanceof NE?t=[...t,...o.errors]:t.push(o)}}if(t)throw new NE(t)}}add(t){var r;if(t&&t!==this)if(this.closed)k5(t);else{if(t instanceof Xs){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}}_hasParent(t){const{_parentage:r}=this;return r===t||Array.isArray(r)&&r.includes(t)}_addParent(t){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t}_removeParent(t){const{_parentage:r}=this;r===t?this._parentage=null:Array.isArray(r)&&xC(r,t)}remove(t){const{_finalizers:r}=this;r&&xC(r,t),t instanceof Xs&&t._removeParent(this)}}Xs.EMPTY=(()=>{const e=new Xs;return e.closed=!0,e})();const B5=Xs.EMPTY;function N5(e){return e instanceof Xs||e&&"closed"in e&&Fa(e.remove)&&Fa(e.add)&&Fa(e.unsubscribe)}function k5(e){Fa(e)?e():e.unsubscribe()}const eh={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},_C={setTimeout(e,t,...r){const{delegate:n}=_C;return n?.setTimeout?n.setTimeout(e,t,...r):setTimeout(e,t,...r)},clearTimeout(e){const{delegate:t}=_C;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function L5(e){_C.setTimeout(()=>{const{onUnhandledError:t}=eh;if(!t)throw e;t(e)})}function kE(){}const due=LE("C",void 0,void 0);function LE(e,t,r){return{kind:e,value:t,error:r}}let th=null;function wC(e){if(eh.useDeprecatedSynchronousErrorHandling){const t=!th;if(t&&(th={errorThrown:!1,error:null}),e(),t){const{errorThrown:r,error:n}=th;if(th=null,r)throw n}}else e()}class UE extends Xs{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,N5(t)&&t.add(this)):this.destination=yue}static create(t,r,n){return new rb(t,r,n)}next(t){this.isStopped?GE(function pue(e){return LE("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?GE(function fue(e){return LE("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?GE(due,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const hue=Function.prototype.bind;function VE(e,t){return hue.call(e,t)}class vue{constructor(t){this.partialObserver=t}next(t){const{partialObserver:r}=this;if(r.next)try{r.next(t)}catch(n){AC(n)}}error(t){const{partialObserver:r}=this;if(r.error)try{r.error(t)}catch(n){AC(n)}else AC(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(r){AC(r)}}}class rb extends UE{constructor(t,r,n){let a;if(super(),Fa(t)||!t)a={next:t??void 0,error:r??void 0,complete:n??void 0};else{let i;this&&eh.useDeprecatedNextContext?(i=Object.create(t),i.unsubscribe=()=>this.unsubscribe(),a={next:t.next&&VE(t.next,i),error:t.error&&VE(t.error,i),complete:t.complete&&VE(t.complete,i)}):a=t}this.destination=new vue(a)}}function AC(e){eh.useDeprecatedSynchronousErrorHandling?function mue(e){eh.useDeprecatedSynchronousErrorHandling&&th&&(th.errorThrown=!0,th.error=e)}(e):L5(e)}function GE(e,t){const{onStoppedNotification:r}=eh;r&&_C.setTimeout(()=>r(e,t))}const yue={closed:!0,next:kE,error:function gue(e){throw e},complete:kE},zE="function"==typeof Symbol&&Symbol.observable||"@@observable";function _p(e){return e}function U5(...e){return V5(e)}function V5(e){return 0===e.length?_p:1===e.length?e[0]:function(r){return e.reduce((n,a)=>a(n),r)}}let zi=(()=>{class e{constructor(r){r&&(this._subscribe=r)}lift(r){const n=new e;return n.source=this,n.operator=r,n}subscribe(r,n,a){const i=function Sue(e){return e&&e instanceof UE||function bue(e){return e&&Fa(e.next)&&Fa(e.error)&&Fa(e.complete)}(e)&&N5(e)}(r)?r:new rb(r,n,a);return wC(()=>{const{operator:o,source:s}=this;i.add(o?o.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(r){try{return this._subscribe(r)}catch(n){r.error(n)}}forEach(r,n){return new(n=G5(n))((a,i)=>{const o=new rb({next:s=>{try{r(s)}catch(u){i(u),o.unsubscribe()}},error:i,complete:a});this.subscribe(o)})}_subscribe(r){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(r)}[zE](){return this}pipe(...r){return V5(r)(this)}toPromise(r){return new(r=G5(r))((n,a)=>{let i;this.subscribe(o=>i=o,o=>a(o),()=>n(i))})}}return e.create=t=>new e(t),e})();function G5(e){var t;return null!==(t=e??eh.Promise)&&void 0!==t?t:Promise}const Cue=BE(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let bn=(()=>{class e extends zi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const n=new z5(this,this);return n.operator=r,n}_throwIfClosed(){if(this.closed)throw new Cue}next(r){wC(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(r)}})}error(r){wC(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:n}=this;for(;n.length;)n.shift().error(r)}})}complete(){wC(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:n,isStopped:a,observers:i}=this;return n||a?B5:(this.currentObservers=null,i.push(r),new Xs(()=>{this.currentObservers=null,xC(i,r)}))}_checkFinalizedStatuses(r){const{hasError:n,thrownError:a,isStopped:i}=this;n?r.error(a):i&&r.complete()}asObservable(){const r=new zi;return r.source=this,r}}return e.create=(t,r)=>new z5(t,r),e})();class z5 extends bn{constructor(t,r){super(),this.destination=t,this.source=r}next(t){var r,n;null===(n=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===n||n.call(r,t)}error(t){var r,n;null===(n=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===n||n.call(r,t)}complete(){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===r||r.call(t)}_subscribe(t){var r,n;return null!==(n=null===(r=this.source)||void 0===r?void 0:r.subscribe(t))&&void 0!==n?n:B5}}function H5(e){return Fa(e?.lift)}function di(e){return t=>{if(H5(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function fi(e,t,r,n,a){return new xue(e,t,r,n,a)}class xue extends UE{constructor(t,r,n,a,i,o){super(t),this.onFinalize=i,this.shouldUnsubscribe=o,this._next=r?function(s){try{r(s)}catch(u){t.error(u)}}:super._next,this._error=a?function(s){try{a(s)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(s){t.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:r}=this;super.unsubscribe(),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function $n(e,t){return di((r,n)=>{let a=0;r.subscribe(fi(n,i=>{n.next(e.call(t,i,a++))}))})}var HE=function(e,t){return(HE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])})(e,t)};function jt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}HE(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var R=function(){return R=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++)for(var i in r=arguments[n])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},R.apply(this,arguments)};function ue(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(d){o(d)}}function u(l){try{c(n.throw(l))}catch(d){o(d)}}function c(l){l.done?i(l.value):function a(i){return i instanceof r?i:new r(function(o){o(i)})}(l.value).then(s,u)}c((n=n.apply(e,t||[])).next())})}function ce(e,t){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return function u(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(r=0)),r;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,a=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(6===c[0]&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(l){c=[6,l],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function or(e,t,r){if(r||2===arguments.length)for(var i,n=0,a=t.length;n<a;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function wp(e){return this instanceof wp?(this.v=e,this):new wp(e)}function W5(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function qE(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(o){return new Promise(function(s,u){!function a(i,o,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},o)}(s,u,(o=e[i](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Y5=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function X5(e){return Fa(e?.then)}function K5(e){return Fa(e[zE])}function Z5(e){return Symbol.asyncIterator&&Fa(e?.[Symbol.asyncIterator])}function Q5(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const $5=function Gue(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function J5(e){return Fa(e?.[$5])}function eU(e){return function q5(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,n=r.apply(e,t||[]),i=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(f){n[f]&&(a[f]=function(p){return new Promise(function(m,h){i.push([f,p,m,h])>1||s(f,p)})})}function s(f,p){try{!function u(f){f.value instanceof wp?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}(n[f](p))}catch(m){d(i[0][3],m)}}function c(f){s("next",f)}function l(f){s("throw",f)}function d(f,p){f(p),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function*(){const r=e.getReader();try{for(;;){const{value:n,done:a}=yield wp(r.read());if(a)return yield wp(void 0);yield yield wp(n)}}finally{r.releaseLock()}})}function tU(e){return Fa(e?.getReader)}function _u(e){if(e instanceof zi)return e;if(null!=e){if(K5(e))return function zue(e){return new zi(t=>{const r=e[zE]();if(Fa(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Y5(e))return function Hue(e){return new zi(t=>{for(let r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}(e);if(X5(e))return function jue(e){return new zi(t=>{e.then(r=>{t.closed||(t.next(r),t.complete())},r=>t.error(r)).then(null,L5)})}(e);if(Z5(e))return rU(e);if(J5(e))return function que(e){return new zi(t=>{for(const r of e)if(t.next(r),t.closed)return;t.complete()})}(e);if(tU(e))return function Wue(e){return rU(eU(e))}(e)}throw Q5(e)}function rU(e){return new zi(t=>{(function Yue(e,t){var r,n,a,i;return ue(this,void 0,void 0,function*(){try{for(r=W5(e);!(n=yield r.next()).done;)if(t.next(n.value),t.closed)return}catch(o){a={error:o}}finally{try{n&&!n.done&&(i=r.return)&&(yield i.call(r))}finally{if(a)throw a.error}}t.complete()})})(e,t).catch(r=>t.error(r))})}function Xd(e,t,r,n=0,a=!1){const i=t.schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!a)return i}function bs(e,t,r=1/0){return Fa(t)?bs((n,a)=>$n((i,o)=>t(n,i,a,o))(_u(e(n,a))),r):("number"==typeof t&&(r=t),di((n,a)=>function Xue(e,t,r,n,a,i,o,s){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&t.complete()},p=h=>c<n?m(h):u.push(h),m=h=>{i&&t.next(h),c++;let v=!1;_u(r(h,l++)).subscribe(fi(t,g=>{a?.(g),i?p(g):t.next(g)},()=>{v=!0},void 0,()=>{if(v)try{for(c--;u.length&&c<n;){const g=u.shift();o?Xd(t,o,()=>m(g)):m(g)}f()}catch(g){t.error(g)}}))};return e.subscribe(fi(t,p,()=>{d=!0,f()})),()=>{s?.()}}(n,a,e,r)))}function TC(e=1/0){return bs(_p,e)}const kl=new zi(e=>e.complete());function nU(e){return e&&Fa(e.schedule)}function WE(e){return e[e.length-1]}function aU(e){return Fa(WE(e))?e.pop():void 0}function nb(e){return nU(WE(e))?e.pop():void 0}function iU(e,t=0){return di((r,n)=>{r.subscribe(fi(n,a=>Xd(n,e,()=>n.next(a),t),()=>Xd(n,e,()=>n.complete(),t),a=>Xd(n,e,()=>n.error(a),t)))})}function oU(e,t=0){return di((r,n)=>{n.add(e.schedule(()=>r.subscribe(n),t))})}function sU(e,t){if(!e)throw new Error("Iterable cannot be null");return new zi(r=>{Xd(r,t,()=>{const n=e[Symbol.asyncIterator]();Xd(r,t,()=>{n.next().then(a=>{a.done?r.complete():r.next(a.value)})},0,!0)})})}function So(e,t){return t?function rce(e,t){if(null!=e){if(K5(e))return function Que(e,t){return _u(e).pipe(oU(t),iU(t))}(e,t);if(Y5(e))return function Jue(e,t){return new zi(r=>{let n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}(e,t);if(X5(e))return function $ue(e,t){return _u(e).pipe(oU(t),iU(t))}(e,t);if(Z5(e))return sU(e,t);if(J5(e))return function ece(e,t){return new zi(r=>{let n;return Xd(r,t,()=>{n=e[$5](),Xd(r,t,()=>{let a,i;try{({value:a,done:i}=n.next())}catch(o){return void r.error(o)}i?r.complete():r.next(a)},0,!0)}),()=>Fa(n?.return)&&n.return()})}(e,t);if(tU(e))return function tce(e,t){return sU(eU(e),t)}(e,t)}throw Q5(e)}(e,t):_u(e)}function Ll(...e){const t=nb(e),r=function Zue(e,t){return"number"==typeof WE(e)?e.pop():t}(e,1/0),n=e;return n.length?1===n.length?_u(n[0]):TC(r)(So(n,t)):kl}class Ai extends bn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const r=super._subscribe(t);return!r.closed&&t.next(this._value),r}getValue(){const{hasError:t,thrownError:r,_value:n}=this;if(t)throw r;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}function Hr(...e){return So(e,nb(e))}function YE(e={}){const{connector:t=(()=>new bn),resetOnError:r=!0,resetOnComplete:n=!0,resetOnRefCountZero:a=!0}=e;return i=>{let o,s,u,c=0,l=!1,d=!1;const f=()=>{s?.unsubscribe(),s=void 0},p=()=>{f(),o=u=void 0,l=d=!1},m=()=>{const h=o;p(),h?.unsubscribe()};return di((h,v)=>{c++,!d&&!l&&f();const g=u=u??t();v.add(()=>{c--,0===c&&!d&&!l&&(s=XE(m,a))}),g.subscribe(v),!o&&c>0&&(o=new rb({next:y=>g.next(y),error:y=>{d=!0,f(),s=XE(p,r,y),g.error(y)},complete:()=>{l=!0,f(),s=XE(p,n),g.complete()}}),_u(h).subscribe(o))})(i)}}function XE(e,t,...r){if(!0===t)return void e();if(!1===t)return;const n=new rb({next:()=>{n.unsubscribe(),e()}});return _u(t(...r)).subscribe(n)}function nc(e,t){return di((r,n)=>{let a=null,i=0,o=!1;const s=()=>o&&!a&&n.complete();r.subscribe(fi(n,u=>{a?.unsubscribe();let c=0;const l=i++;_u(e(u,l)).subscribe(a=fi(n,d=>n.next(t?t(u,d,l,c++):d),()=>{a=null,s()}))},()=>{o=!0,s()}))})}function uU(e,t=_p){return e=e??nce,di((r,n)=>{let a,i=!0;r.subscribe(fi(n,o=>{const s=t(o);(i||!e(a,s))&&(i=!1,a=s,n.next(o))}))})}function nce(e,t){return e===t}function aa(e){for(let t in e)if(e[t]===aa)return t;throw Error("Could not find renamed property on target object.")}function Hi(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Hi).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function KE(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const ace=aa({__forward_ref__:aa});function ZE(e){return e.__forward_ref__=ZE,e.toString=function(){return Hi(this())},e}function Er(e){return EC(e)?e():e}function EC(e){return"function"==typeof e&&e.hasOwnProperty(ace)&&e.__forward_ref__===ZE}function QE(e){return e&&!!e.\u0275providers}class Ot extends Error{constructor(t,r){super(function Kv(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,r)),this.code=t}}const ab=aa({\u0275cmp:aa}),$E=aa({\u0275dir:aa}),JE=aa({\u0275pipe:aa}),lU=aa({\u0275mod:aa}),Kd=aa({\u0275fac:aa}),ib=aa({__NG_ELEMENT_ID__:aa}),dU=aa({__NG_ENV_ID__:aa});function kr(e){return"string"==typeof e?e:null==e?"":String(e)}function eI(e,t){throw new Ot(-201,!1)}function Ks(e,t){null==e&&function Ir(e,t,r,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${r} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function Ar(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function IC(e){return{providers:e.providers||[],imports:e.imports||[]}}function PC(e){return fU(e,RC)||fU(e,pU)}function fU(e,t){return e.hasOwnProperty(t)?e[t]:null}function MC(e){return e&&(e.hasOwnProperty(tI)||e.hasOwnProperty(pce))?e[tI]:null}const RC=aa({\u0275prov:aa}),tI=aa({\u0275inj:aa}),pU=aa({ngInjectableDef:aa}),pce=aa({ngInjectorDef:aa});var pn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(pn||{});let rI;function Zs(e){const t=rI;return rI=e,t}function hU(e,t,r){const n=PC(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:r&pn.Optional?null:void 0!==t?t:void eI(Hi(e))}const _a=globalThis;class sr{constructor(t,r){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=Ar({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const ob={},sI="__NG_DI_FLAG__",OC="ngTempTokenPath",vce=/\n/gm,gU="__source";let Zv;function Tp(e){const t=Zv;return Zv=e,t}function bce(e,t=pn.Default){if(void 0===Zv)throw new Ot(-203,!1);return null===Zv?hU(e,void 0,t):Zv.get(e,t&pn.Optional?null:void 0,t)}function an(e,t=pn.Default){return(function mU(){return rI}()||bce)(Er(e),t)}function Yt(e,t=pn.Default){return an(e,FC(t))}function FC(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function uI(e){const t=[];for(let r=0;r<e.length;r++){const n=Er(e[r]);if(Array.isArray(n)){if(0===n.length)throw new Ot(900,!1);let a,i=pn.Default;for(let o=0;o<n.length;o++){const s=n[o],u=Sce(s);"number"==typeof u?-1===u?a=s.token:i|=u:a=s}t.push(an(a,i))}else t.push(an(n))}return t}function Sce(e){return e[sI]}function Zd(e){return{toString:e}.toString()}var BC=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(BC||{}),$c=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}($c||{});const Ul={},Nn=[];function bU(e,t,r){let n=e.length;for(;;){const a=e.indexOf(t,r);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const i=t.length;if(a+i===n||e.charCodeAt(a+i)<=32)return a}r=a+1}}function cI(e,t,r){let n=0;for(;n<r.length;){const a=r[n];if("number"==typeof a){if(0!==a)break;n++;const i=r[n++],o=r[n++],s=r[n++];e.setAttribute(t,o,s,i)}else{const i=a,o=r[++n];CU(i)?e.setProperty(t,i,o):e.setAttribute(t,i,o),n++}}return n}function SU(e){return 3===e||4===e||6===e}function CU(e){return 64===e.charCodeAt(0)}function ub(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let r=-1;for(let n=0;n<t.length;n++){const a=t[n];"number"==typeof a?r=a:0===r||xU(e,r,a,null,-1===r||2===r?t[++n]:null)}}return e}function xU(e,t,r,n,a){let i=0,o=e.length;if(-1===t)o=-1;else for(;i<e.length;){const s=e[i++];if("number"==typeof s){if(s===t){o=-1;break}if(s>t){o=i-1;break}}}for(;i<e.length;){const s=e[i];if("number"==typeof s)break;if(s===r){if(null===n)return void(null!==a&&(e[i+1]=a));if(n===e[i+1])return void(e[i+2]=a)}i++,null!==n&&i++,null!==a&&i++}-1!==o&&(e.splice(o,0,t),i=o+1),e.splice(i++,0,r),null!==n&&e.splice(i++,0,n),null!==a&&e.splice(i++,0,a)}const _U="ng-template";function _ce(e,t,r){let n=0,a=!0;for(;n<e.length;){let i=e[n++];if("string"==typeof i&&a){const o=e[n++];if(r&&"class"===i&&-1!==bU(o.toLowerCase(),t,0))return!0}else{if(1===i){for(;n<e.length&&"string"==typeof(i=e[n++]);)if(i.toLowerCase()===t)return!0;return!1}"number"==typeof i&&(a=!1)}}return!1}function wU(e){return 4===e.type&&e.value!==_U}function wce(e,t,r){return t===(4!==e.type||r?e.value:_U)}function Ace(e,t,r){let n=4;const a=e.attrs||[],i=function Ece(e){for(let t=0;t<e.length;t++)if(SU(e[t]))return t;return e.length}(a);let o=!1;for(let s=0;s<t.length;s++){const u=t[s];if("number"!=typeof u){if(!o)if(4&n){if(n=2|1&n,""!==u&&!wce(e,u,r)||""===u&&1===t.length){if(Jc(n))return!1;o=!0}}else{const c=8&n?u:t[++s];if(8&n&&null!==e.attrs){if(!_ce(e.attrs,c,r)){if(Jc(n))return!1;o=!0}continue}const d=Tce(8&n?"class":u,a,wU(e),r);if(-1===d){if(Jc(n))return!1;o=!0;continue}if(""!==c){let f;f=d>i?"":a[d+1].toLowerCase();const p=8&n?f:null;if(p&&-1!==bU(p,c,0)||2&n&&c!==f){if(Jc(n))return!1;o=!0}}}}else{if(!o&&!Jc(n)&&!Jc(u))return!1;if(o&&Jc(u))continue;o=!1,n=u|1&n}}return Jc(n)||o}function Jc(e){return 0==(1&e)}function Tce(e,t,r,n){if(null===t)return-1;let a=0;if(n||!r){let i=!1;for(;a<t.length;){const o=t[a];if(o===e)return a;if(3===o||6===o)i=!0;else{if(1===o||2===o){let s=t[++a];for(;"string"==typeof s;)s=t[++a];continue}if(4===o)break;if(0===o){a+=4;continue}}a+=i?1:2}return-1}return function Ice(e,t){let r=e.indexOf(4);if(r>-1)for(r++;r<e.length;){const n=e[r];if("number"==typeof n)return-1;if(n===t)return r;r++}return-1}(t,e)}function AU(e,t,r=!1){for(let n=0;n<t.length;n++)if(Ace(e,t[n],r))return!0;return!1}function TU(e,t){return e?":not("+t.trim()+")":t}function Mce(e){let t=e[0],r=1,n=2,a="",i=!1;for(;r<e.length;){let o=e[r];if("string"==typeof o)if(2&n){const s=e[++r];a+="["+o+(s.length>0?'="'+s+'"':"")+"]"}else 8&n?a+="."+o:4&n&&(a+=" "+o);else""!==a&&!Jc(o)&&(t+=TU(i,a),a=""),n=o,i=i||!Jc(n);r++}return""!==a&&(t+=TU(i,a)),t}function NC(e){return Zd(()=>{const t=EU(e),r={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===BC.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||$c.Emulated,styles:e.styles||Nn,_:null,schemas:e.schemas||null,tView:null,id:""};IU(r);const n=e.dependencies;return r.directiveDefs=kC(n,!1),r.pipeDefs=kC(n,!0),r.id=function kce(e){let t=0;const r=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const a of r)t=Math.imul(31,t)+a.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(r),r})}function Fce(e){return cn(e)||so(e)}function Bce(e){return null!==e}function lI(e){return Zd(()=>({type:e.type,bootstrap:e.bootstrap||Nn,declarations:e.declarations||Nn,imports:e.imports||Nn,exports:e.exports||Nn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function DU(e,t){if(null==e)return Ul;const r={};for(const n in e)if(e.hasOwnProperty(n)){let a=e[n],i=a;Array.isArray(a)&&(i=a[1],a=a[0]),r[a]=n,t&&(t[a]=i)}return r}function Ss(e){return Zd(()=>{const t=EU(e);return IU(t),t})}function cn(e){return e[ab]||null}function so(e){return e[$E]||null}function ko(e){return e[JE]||null}function Xo(e,t){const r=e[lU]||null;if(!r&&!0===t)throw new Error(`Type ${Hi(e)} does not have '\u0275mod' property.`);return r}function EU(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Ul,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Nn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:DU(e.inputs,t),outputs:DU(e.outputs),debugInfo:null}}function IU(e){e.features?.forEach(t=>t(e))}function kC(e,t){if(!e)return null;const r=t?ko:Fce;return()=>("function"==typeof e?e():e).map(n=>r(n)).filter(Bce)}const pi=0,Ft=1,br=2,qa=3,el=4,Ko=5,Vl=6,Qv=7,va=8,Cs=9,$v=10,Lr=11,cb=12,PU=13,Jv=14,ni=15,lb=16,eg=17,Gl=18,db=19,MU=20,Ep=21,LC=22,rh=23,Ur=25,dI=1,zl=7,tg=9,Ti=10;var rg=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e[e.HasChildViewsToRefresh=4]="HasChildViewsToRefresh",e}(rg||{});function Lo(e){return Array.isArray(e)&&"object"==typeof e[dI]}function Co(e){return Array.isArray(e)&&!0===e[dI]}function fI(e){return 0!=(4&e.flags)}function nh(e){return e.componentOffset>-1}function tl(e){return!!e.template}function pI(e){return 0!=(512&e[br])}function ah(e,t){return e.hasOwnProperty(Kd)?e[Kd]:null}class Gce{constructor(t,r,n){this.previousValue=t,this.currentValue=r,this.firstChange=n}isFirstChange(){return this.firstChange}}function ih(){return BU}function BU(e){return e.type.prototype.ngOnChanges&&(e.setInput=Hce),zce}function zce(){const e=kU(this),t=e?.current;if(t){const r=e.previous;if(r===Ul)e.previous=t;else for(let n in t)r[n]=t[n];e.current=null,this.ngOnChanges(t)}}function Hce(e,t,r,n){const a=this.declaredInputs[r],i=kU(e)||function jce(e,t){return e[NU]=t}(e,{previous:Ul,current:null}),o=i.current||(i.current={}),s=i.previous,u=s[a];o[a]=new Gce(u&&u.currentValue,t,s===Ul),e[n]=t}ih.ngInherit=!0;const NU="__ngSimpleChanges__";function kU(e){return e[NU]||null}const Hl=function(e,t,r){};function wa(e){for(;Array.isArray(e);)e=e[pi];return e}function xs(e,t){return wa(t[e.index])}function mb(e,t){return e.data[t]}function Au(e,t){const r=t[e];return Lo(r)?r:r[pi]}function yI(e){return 128==(128&e[br])}function jl(e,t){return null==t?null:e[t]}function VU(e){e[eg]=0}function Kce(e){1024&e[br]||(e[br]|=1024,yI(e)&&GC(e))}function zU(e){return 9216&e[br]||e[rh]?.dirty}function HU(e){zU(e)&&GC(e)}function GC(e){let t=e[qa];for(;null!==t&&!(Co(t)&&t[br]&rg.HasChildViewsToRefresh||Lo(t)&&8192&t[br]);){if(Co(t))t[br]|=rg.HasChildViewsToRefresh;else if(t[br]|=8192,!yI(t))break;t=t[qa]}}const Mr={lFrame:JU(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function qU(){return Mr.bindingsEnabled}function ct(){return Mr.lFrame.lView}function wn(){return Mr.lFrame.tView}function la(){let e=WU();for(;null!==e&&64===e.type;)e=e.parent;return e}function WU(){return Mr.lFrame.currentTNode}function ql(e,t){const r=Mr.lFrame;r.currentTNode=e,r.isParent=t}function SI(){return Mr.lFrame.isParent}function Wl(){return Mr.lFrame.bindingIndex++}function ule(e,t){const r=Mr.lFrame;r.bindingIndex=r.bindingRootIndex=e,xI(t)}function xI(e){Mr.lFrame.currentDirectiveIndex=e}function ZU(){return Mr.lFrame.currentQueryIndex}function wI(e){Mr.lFrame.currentQueryIndex=e}function lle(e){const t=e[Ft];return 2===t.type?t.declTNode:1===t.type?e[Ko]:null}function QU(e,t,r){if(r&pn.SkipSelf){let a=t,i=e;for(;!(a=a.parent,null!==a||r&pn.Host||(a=lle(i),null===a||(i=i[Jv],10&a.type))););if(null===a)return!1;t=a,e=i}const n=Mr.lFrame=$U();return n.currentTNode=t,n.lView=e,!0}function AI(e){const t=$U(),r=e[Ft];Mr.lFrame=t,t.currentTNode=r.firstChild,t.lView=e,t.tView=r,t.contextLView=e,t.bindingIndex=r.bindingStartIndex,t.inI18n=!1}function $U(){const e=Mr.lFrame,t=null===e?null:e.child;return null===t?JU(e):t}function JU(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function e6(){const e=Mr.lFrame;return Mr.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const t6=e6;function TI(){const e=e6();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Zo(){return Mr.lFrame.selectedIndex}function oh(e){Mr.lFrame.selectedIndex=e}let n6=!0;function HC(){return n6}function Ip(e){n6=e}function jC(e,t){for(let r=t.directiveStart,n=t.directiveEnd;r<n;r++){const i=e.data[r].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;o&&(e.contentHooks??=[]).push(-r,o),s&&((e.contentHooks??=[]).push(r,s),(e.contentCheckHooks??=[]).push(r,s)),u&&(e.viewHooks??=[]).push(-r,u),c&&((e.viewHooks??=[]).push(r,c),(e.viewCheckHooks??=[]).push(r,c)),null!=l&&(e.destroyHooks??=[]).push(r,l)}}function qC(e,t,r){a6(e,t,3,r)}function WC(e,t,r,n){(3&e[br])===r&&a6(e,t,r,n)}function DI(e,t){let r=e[br];(3&r)===t&&(r&=16383,r+=1,e[br]=r)}function a6(e,t,r,n){const i=n??-1,o=t.length-1;let s=0;for(let u=void 0!==n?65535&e[eg]:0;u<o;u++)if("number"==typeof t[u+1]){if(s=t[u],null!=n&&s>=n)break}else t[u]<0&&(e[eg]+=65536),(s<i||-1==i)&&(gle(e,r,t,u),e[eg]=(4294901760&e[eg])+u+2),u++}function i6(e,t){Hl(4,e,t);const r=li(null);try{t.call(e)}finally{li(r),Hl(5,e,t)}}function gle(e,t,r,n){const a=r[n]<0,i=r[n+1],s=e[a?-r[n]:r[n]];a?e[br]>>14<e[eg]>>16&&(3&e[br])===t&&(e[br]+=16384,i6(s,i)):i6(s,i)}const ig=-1;class vb{constructor(t,r,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=n}}function II(e){return e!==ig}function gb(e){return 32767&e}function yb(e,t){let r=function xle(e){return e>>16}(e),n=t;for(;r>0;)n=n[Jv],r--;return n}let PI=!0;function YC(e){const t=PI;return PI=e,t}const o6=255,s6=5;let _le=0;const Yl={};function XC(e,t){const r=u6(e,t);if(-1!==r)return r;const n=t[Ft];n.firstCreatePass&&(e.injectorIndex=t.length,MI(n.data,e),MI(t,null),MI(n.blueprint,null));const a=KC(e,t),i=e.injectorIndex;if(II(a)){const o=gb(a),s=yb(a,t),u=s[Ft].data;for(let c=0;c<8;c++)t[i+c]=s[o+c]|u[o+c]}return t[i+8]=a,i}function MI(e,t){e.push(0,0,0,0,0,0,0,0,t)}function u6(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function KC(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let r=0,n=null,a=t;for(;null!==a;){if(n=h6(a),null===n)return ig;if(r++,a=a[Jv],-1!==n.injectorIndex)return n.injectorIndex|r<<16}return ig}function RI(e,t,r){!function wle(e,t,r){let n;"string"==typeof r?n=r.charCodeAt(0)||0:r.hasOwnProperty(ib)&&(n=r[ib]),null==n&&(n=r[ib]=_le++);const a=n&o6;t.data[e+(a>>s6)]|=1<<a}(e,t,r)}function c6(e,t,r){if(r&pn.Optional||void 0!==e)return e;eI()}function l6(e,t,r,n){if(r&pn.Optional&&void 0===n&&(n=null),!(r&(pn.Self|pn.Host))){const a=e[Cs],i=Zs(void 0);try{return a?a.get(t,n,r&pn.Optional):hU(t,n,r&pn.Optional)}finally{Zs(i)}}return c6(n,0,r)}function d6(e,t,r,n=pn.Default,a){if(null!==e){if(2048&t[br]&&!(n&pn.Self)){const o=function Ile(e,t,r,n,a){let i=e,o=t;for(;null!==i&&null!==o&&2048&o[br]&&!(512&o[br]);){const s=f6(i,o,r,n|pn.Self,Yl);if(s!==Yl)return s;let u=i.parent;if(!u){const c=o[MU];if(c){const l=c.get(r,Yl,n);if(l!==Yl)return l}u=h6(o),o=o[Jv]}i=u}return a}(e,t,r,n,Yl);if(o!==Yl)return o}const i=f6(e,t,r,n,Yl);if(i!==Yl)return i}return l6(t,r,n,a)}function f6(e,t,r,n,a){const i=function Dle(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ib)?e[ib]:void 0;return"number"==typeof t?t>=0?t&o6:Ele:t}(r);if("function"==typeof i){if(!QU(t,e,n))return n&pn.Host?c6(a,0,n):l6(t,r,n,a);try{let o;if(o=i(n),null!=o||n&pn.Optional)return o;eI()}finally{t6()}}else if("number"==typeof i){let o=null,s=u6(e,t),u=ig,c=n&pn.Host?t[ni][Ko]:null;for((-1===s||n&pn.SkipSelf)&&(u=-1===s?KC(e,t):t[s+8],u!==ig&&m6(n,!1)?(o=t[Ft],s=gb(u),t=yb(u,t)):s=-1);-1!==s;){const l=t[Ft];if(p6(i,s,l.data)){const d=Tle(s,t,r,o,n,c);if(d!==Yl)return d}u=t[s+8],u!==ig&&m6(n,t[Ft].data[s+8]===c)&&p6(i,s,t)?(o=l,s=gb(u),t=yb(u,t)):s=-1}}return a}function Tle(e,t,r,n,a,i){const o=t[Ft],s=o.data[e+8],l=ZC(s,o,r,null==n?nh(s)&&PI:n!=o&&0!=(3&s.type),a&pn.Host&&i===s);return null!==l?sh(t,o,l,s):Yl}function ZC(e,t,r,n,a){const i=e.providerIndexes,o=t.data,s=1048575&i,u=e.directiveStart,l=i>>20,f=a?s+l:e.directiveEnd;for(let p=n?s:s+l;p<f;p++){const m=o[p];if(p<u&&r===m||p>=u&&m.type===r)return p}if(a){const p=o[u];if(p&&tl(p)&&p.type===r)return u}return null}function sh(e,t,r,n){let a=e[r];const i=t.data;if(function yle(e){return e instanceof vb}(a)){const o=a;o.resolving&&function oce(e,t){const r=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Ot(-200,`Circular dependency in DI detected for ${e}${r}`)}(function jn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():kr(e)}(i[r]));const s=YC(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?Zs(o.injectImpl):null;QU(e,n,pn.Default);try{a=e[r]=o.factory(void 0,i,e,n),t.firstCreatePass&&r>=n.directiveStart&&function vle(e,t,r){const{ngOnChanges:n,ngOnInit:a,ngDoCheck:i}=t.type.prototype;if(n){const o=BU(t);(r.preOrderHooks??=[]).push(e,o),(r.preOrderCheckHooks??=[]).push(e,o)}a&&(r.preOrderHooks??=[]).push(0-e,a),i&&((r.preOrderHooks??=[]).push(e,i),(r.preOrderCheckHooks??=[]).push(e,i))}(r,i[r],t)}finally{null!==c&&Zs(c),YC(s),o.resolving=!1,t6()}}return a}function p6(e,t,r){return!!(r[t+(e>>s6)]&1<<e)}function m6(e,t){return!(e&pn.Self||e&pn.Host&&t)}class uo{constructor(t,r){this._tNode=t,this._lView=r}get(t,r,n){return d6(this._tNode,this._lView,t,FC(n),r)}}function Ele(){return new uo(la(),ct())}function OI(e){return Zd(()=>{const t=e.prototype.constructor,r=t[Kd]||FI(t),n=Object.prototype;let a=Object.getPrototypeOf(e.prototype).constructor;for(;a&&a!==n;){const i=a[Kd]||FI(a);if(i&&i!==r)return i;a=Object.getPrototypeOf(a)}return i=>new i})}function FI(e){return EC(e)?()=>{const t=FI(Er(e));return t&&t()}:ah(e)}function h6(e){const t=e[Ft],r=t.type;return 2===r?t.declTNode:1===r?e[Ko]:null}function pg(e,t){e.forEach(r=>Array.isArray(r)?pg(r,t):t(r))}function g6(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function $C(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const vg=new sr("ENVIRONMENT_INITIALIZER"),_6=new sr("INJECTOR",-1),zI=new sr("INJECTOR_DEF_TYPES");class tx{get(t,r=ob){if(r===ob){const n=new Error(`NullInjectorError: No provider for ${Hi(t)}!`);throw n.name="NullInjectorError",n}return r}}function HI(e){return{\u0275providers:e}}function Qle(...e){return{\u0275providers:w6(0,e),\u0275fromNgModule:!0}}function w6(e,...t){const r=[],n=new Set;let a;const i=o=>{r.push(o)};return pg(t,o=>{const s=o;rx(s,i,[],n)&&(a||=[],a.push(s))}),void 0!==a&&A6(a,i),r}function A6(e,t){for(let r=0;r<e.length;r++){const{ngModule:n,providers:a}=e[r];jI(a,i=>{t(i,n)})}}function rx(e,t,r,n){if(!(e=Er(e)))return!1;let a=null,i=MC(e);const o=!i&&cn(e);if(i||o){if(o&&!o.standalone)return!1;a=e}else{const u=e.ngModule;if(i=MC(u),!i)return!1;a=u}const s=n.has(a);if(o){if(s)return!1;if(n.add(a),o.dependencies){const u="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of u)rx(c,t,r,n)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;n.add(a);try{pg(i.imports,l=>{rx(l,t,r,n)&&(c||=[],c.push(l))})}finally{}void 0!==c&&A6(c,t)}if(!s){const c=ah(a)||(()=>new a);t({provide:a,useFactory:c,deps:Nn},a),t({provide:zI,useValue:a,multi:!0},a),t({provide:vg,useValue:()=>an(a),multi:!0},a)}const u=i.providers;if(null!=u&&!s){const c=e;jI(u,l=>{t(l,c)})}}}return a!==e&&void 0!==e.providers}function jI(e,t){for(let r of e)QE(r)&&(r=r.\u0275providers),Array.isArray(r)?jI(r,t):t(r)}const $le=aa({provide:String,useValue:aa});function qI(e){return null!==e&&"object"==typeof e&&$le in e}function uh(e){return"function"==typeof e}const WI=new sr("Set Injector scope."),nx={},ede={};let YI;function ax(){return void 0===YI&&(YI=new tx),YI}class rl{}class gg extends rl{get destroyed(){return this._destroyed}constructor(t,r,n,a){super(),this.parent=r,this.source=n,this.scopes=a,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,KI(t,o=>this.processProvider(o)),this.records.set(_6,yg(void 0,this)),a.has("environment")&&this.records.set(rl,yg(void 0,this));const i=this.records.get(WI);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(zI,Nn,pn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const r=Tp(this),n=Zs(void 0);try{return t()}finally{Tp(r),Zs(n)}}get(t,r=ob,n=pn.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(dU))return t[dU](this);n=FC(n);const i=Tp(this),o=Zs(void 0);try{if(!(n&pn.SkipSelf)){let u=this.records.get(t);if(void 0===u){const c=function ide(e){return"function"==typeof e||"object"==typeof e&&e instanceof sr}(t)&&PC(t);u=c&&this.injectableDefInScope(c)?yg(XI(t),nx):null,this.records.set(t,u)}if(null!=u)return this.hydrate(t,u)}return(n&pn.Self?ax():this.parent).get(t,r=n&pn.Optional&&r===ob?null:r)}catch(s){if("NullInjectorError"===s.name){if((s[OC]=s[OC]||[]).unshift(Hi(t)),i)throw s;return function Cce(e,t,r,n){const a=e[OC];throw t[gU]&&a.unshift(t[gU]),e.message=function xce(e,t,r,n=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let a=Hi(t);if(Array.isArray(t))a=t.map(Hi).join(" -> ");else if("object"==typeof t){let i=[];for(let o in t)if(t.hasOwnProperty(o)){let s=t[o];i.push(o+":"+("string"==typeof s?JSON.stringify(s):Hi(s)))}a=`{${i.join(", ")}}`}return`${r}${n?"("+n+")":""}[${a}]: ${e.replace(vce,"\n  ")}`}("\n"+e.message,a,r,n),e.ngTokenPath=a,e[OC]=null,e}(s,t,"R3InjectorError",this.source)}throw s}finally{Zs(o),Tp(i)}}resolveInjectorInitializers(){const t=Tp(this),r=Zs(void 0);try{const a=this.get(vg,Nn,pn.Self);for(const i of a)i()}finally{Tp(t),Zs(r)}}toString(){const t=[],r=this.records;for(const n of r.keys())t.push(Hi(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ot(205,!1)}processProvider(t){let r=uh(t=Er(t))?t:Er(t&&t.provide);const n=function rde(e){return qI(e)?yg(void 0,e.useValue):yg(function E6(e,t,r){let n;if(uh(e)){const a=Er(e);return ah(a)||XI(a)}if(qI(e))n=()=>Er(e.useValue);else if(function D6(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...uI(e.deps||[]));else if(function T6(e){return!(!e||!e.useExisting)}(e))n=()=>an(Er(e.useExisting));else{const a=Er(e&&(e.useClass||e.provide));if(!function nde(e){return!!e.deps}(e))return ah(a)||XI(a);n=()=>new a(...uI(e.deps))}return n}(e),nx)}(t);if(uh(t)||!0!==t.multi)this.records.get(r);else{let a=this.records.get(r);a||(a=yg(void 0,nx,!0),a.factory=()=>uI(a.multi),this.records.set(r,a)),r=t,a.multi.push(t)}this.records.set(r,n)}hydrate(t,r){return r.value===nx&&(r.value=ede,r.value=r.factory()),"object"==typeof r.value&&r.value&&function ade(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(r.value)&&this._ngOnDestroyHooks.add(r.value),r.value}injectableDefInScope(t){if(!t.providedIn)return!1;const r=Er(t.providedIn);return"string"==typeof r?"any"===r||this.scopes.has(r):this.injectorDefTypes.has(r)}removeOnDestroy(t){const r=this._onDestroyHooks.indexOf(t);-1!==r&&this._onDestroyHooks.splice(r,1)}}function XI(e){const t=PC(e),r=null!==t?t.factory:ah(e);if(null!==r)return r;if(e instanceof sr)throw new Ot(204,!1);if(e instanceof Function)return function tde(e){const t=e.length;if(t>0)throw function Sb(e,t){const r=[];for(let n=0;n<e;n++)r.push(t);return r}(t,"?"),new Ot(204,!1);const r=function fce(e){return e&&(e[RC]||e[pU])||null}(e);return null!==r?()=>r.factory(e):()=>new e}(e);throw new Ot(204,!1)}function yg(e,t,r=!1){return{factory:e,value:t,multi:r?[]:void 0}}function KI(e,t){for(const r of e)Array.isArray(r)?KI(r,t):r&&QE(r)?KI(r.\u0275providers,t):t(r)}function bg(e,t){e instanceof gg&&e.assertNotDestroyed();const n=Tp(e),a=Zs(void 0);try{return t()}finally{Tp(n),Zs(a)}}function R6(e,t=null,r=null,n){const a=O6(e,t,r,n);return a.resolveInjectorInitializers(),a}function O6(e,t=null,r=null,n,a=new Set){const i=[r||Nn,Qle(e)];return n=n||("object"==typeof e?void 0:Hi(e)),new gg(i,t||ax(),n||null,a)}let $I,ac=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=ob;static#t=this.NULL=new tx;static create(r,n){if(Array.isArray(r))return R6({name:""},n,r,"");{const a=r.name??"";return R6({name:a},r.parent,r.providers,a)}}static#r=this.\u0275prov=Ar({token:e,providedIn:"any",factory:()=>an(_6)});static#n=this.__NG_ELEMENT_ID__=-1}return e})();const JI=new sr("AppId",{providedIn:"root",factory:()=>mde}),mde="ng",B6=new sr("Platform Initializer"),Sg=new sr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),N6=new sr("CSP nonce",{providedIn:"root",factory:()=>function Mp(){if(void 0!==$I)return $I;if(typeof document<"u")return document;throw new Ot(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function Du(e){return e instanceof Function?e():e}function cx(e){return 128==(128&e.flags)}var Fp=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Fp||{});const a3=new Map;let Dde=0;const o3="__ngContext__";function Qo(e,t){Lo(t)?(e[o3]=t[db],function Ide(e){a3.set(e[db],e)}(t)):e[o3]=t}let s3;function u3(e,t){return s3(e,t)}function Tb(e){const t=e[qa];return Co(t)?t[qa]:t}function e8(e){return r8(e[cb])}function t8(e){return r8(e[el])}function r8(e){for(;null!==e&&!Co(e);)e=e[el];return e}function xg(e,t,r,n,a){if(null!=n){let i,o=!1;Co(n)?i=n:Lo(n)&&(o=!0,n=n[pi]);const s=wa(n);0===e&&null!==r?null==a?o8(t,r,s):ch(t,r,s,a||null,!0):1===e&&null!==r?ch(t,r,s,a||null,!0):2===e?function vx(e,t,r){const n=mx(e,t);n&&function Xde(e,t,r,n){e.removeChild(t,r,n)}(e,n,t,r)}(t,s,o):3===e&&t.destroyNode(s),null!=i&&function Qde(e,t,r,n,a){const i=r[zl];i!==wa(r)&&xg(t,e,n,i,a);for(let s=Ti;s<r.length;s++){const u=r[s];Ib(u[Ft],u,e,t,n,i)}}(t,e,i,r,a)}}function fx(e,t,r){return e.createElement(t,r)}function a8(e,t){const r=e[tg],n=r.indexOf(t);r.splice(n,1)}function Db(e,t){if(e.length<=Ti)return;const r=Ti+t,n=e[r];if(n){const a=n[lb];null!==a&&a!==e&&a8(a,n),t>0&&(e[r-1][el]=n[el]);const i=$C(e,Ti+t);!function Vde(e,t){Ib(e,t,t[Lr],2,null,null),t[pi]=null,t[Ko]=null}(n[Ft],n);const o=i[Gl];null!==o&&o.detachView(i[Ft]),n[qa]=null,n[el]=null,n[br]&=-129}return n}function px(e,t){if(!(256&t[br])){const r=t[Lr];t[rh]&&function I5(e){if(Xv(e),tb(e))for(let t=0;t<e.producerNode.length;t++)CC(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}(t[rh]),r.destroyNode&&Ib(e,t,r,3,null,null),function Hde(e){let t=e[cb];if(!t)return l3(e[Ft],e);for(;t;){let r=null;if(Lo(t))r=t[cb];else{const n=t[Ti];n&&(r=n)}if(!r){for(;t&&!t[el]&&t!==e;)Lo(t)&&l3(t[Ft],t),t=t[qa];null===t&&(t=e),Lo(t)&&l3(t[Ft],t),r=t&&t[el]}t=r}}(t)}}function l3(e,t){if(!(256&t[br])){t[br]&=-129,t[br]|=256,function Yde(e,t){let r;if(null!=e&&null!=(r=e.destroyHooks))for(let n=0;n<r.length;n+=2){const a=t[r[n]];if(!(a instanceof vb)){const i=r[n+1];if(Array.isArray(i))for(let o=0;o<i.length;o+=2){const s=a[i[o]],u=i[o+1];Hl(4,s,u);try{u.call(s)}finally{Hl(5,s,u)}}else{Hl(4,a,i);try{i.call(a)}finally{Hl(5,a,i)}}}}}(e,t),function Wde(e,t){const r=e.cleanup,n=t[Qv];if(null!==r)for(let i=0;i<r.length-1;i+=2)if("string"==typeof r[i]){const o=r[i+3];o>=0?n[o]():n[-o].unsubscribe(),i+=2}else r[i].call(n[r[i+1]]);null!==n&&(t[Qv]=null);const a=t[Ep];if(null!==a){t[Ep]=null;for(let i=0;i<a.length;i++)(0,a[i])()}}(e,t),1===t[Ft].type&&t[Lr].destroy();const r=t[lb];if(null!==r&&Co(t[qa])){r!==t[qa]&&a8(r,t);const n=t[Gl];null!==n&&n.detachView(e)}!function Pde(e){a3.delete(e[db])}(t)}}function d3(e,t,r){return function i8(e,t,r){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return r[pi];{const{componentOffset:a}=n;if(a>-1){const{encapsulation:i}=e.data[n.directiveStart+a];if(i===$c.None||i===$c.Emulated)return null}return xs(n,r)}}(e,t.parent,r)}function ch(e,t,r,n,a){e.insertBefore(t,r,n,a)}function o8(e,t,r){e.appendChild(t,r)}function s8(e,t,r,n,a){null!==n?ch(e,t,r,n,a):o8(e,t,r)}function mx(e,t){return e.parentNode(t)}let f3,l8=function c8(e,t,r){return 40&e.type?xs(e,r):null};function hx(e,t,r,n){const a=d3(e,n,t),i=t[Lr],s=function u8(e,t,r){return l8(e,t,r)}(n.parent||t[Ko],n,t);if(null!=a)if(Array.isArray(r))for(let u=0;u<r.length;u++)s8(i,a,r[u],s,!1);else s8(i,a,r,s,!1);void 0!==f3&&f3(i,n,t,r,a)}function Eb(e,t){if(null!==t){const r=t.type;if(3&r)return xs(t,e);if(4&r)return p3(-1,e[t.index]);if(8&r){const n=t.child;if(null!==n)return Eb(e,n);{const a=e[t.index];return Co(a)?p3(-1,a):wa(a)}}if(32&r)return u3(t,e)()||wa(e[t.index]);{const n=f8(e,t);return null!==n?Array.isArray(n)?n[0]:Eb(Tb(e[ni]),n):Eb(e,t.next)}}return null}function f8(e,t){return null!==t?e[ni][Ko].projection[t.projection]:null}function p3(e,t){const r=Ti+e+1;if(r<t.length){const n=t[r],a=n[Ft].firstChild;if(null!==a)return Eb(n,a)}return t[zl]}function m3(e,t,r,n,a,i,o){for(;null!=r;){const s=n[r.index],u=r.type;if(o&&0===t&&(s&&Qo(wa(s),n),r.flags|=2),32!=(32&r.flags))if(8&u)m3(e,t,r.child,n,a,i,!1),xg(t,e,a,s,i);else if(32&u){const c=u3(r,n);let l;for(;l=c();)xg(t,e,a,l,i);xg(t,e,a,s,i)}else 16&u?m8(e,t,n,r,a,i):xg(t,e,a,s,i);r=o?r.projectionNext:r.next}}function Ib(e,t,r,n,a,i){m3(r,n,e.firstChild,t,a,i,!1)}function m8(e,t,r,n,a,i){const o=r[ni],u=o[Ko].projection[n.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)xg(t,e,a,u[c],i);else{let c=u;const l=o[qa];cx(n)&&(c.flags|=128),m3(e,t,c,l,a,i,!0)}}function h8(e,t,r){""===r?e.removeAttribute(t,"class"):e.setAttribute(t,"class",r)}function v8(e,t,r){const{mergedAttrs:n,classes:a,styles:i}=r;null!==n&&cI(e,t,n),null!==a&&h8(e,t,a),null!==i&&function Jde(e,t,r){e.setAttribute(t,"style",r)}(e,t,i)}let P8=(e,t,r)=>null;function E3(e,t,r=!1){return P8(e,t,r)}class Ofe{}class O8{}class Bfe{resolveComponentFactory(t){throw function Ffe(e){const t=Error(`No component factory found for ${Hi(e)}.`);return t.ngComponent=e,t}(t)}}let Ax=(()=>{class e{static#e=this.NULL=new Bfe}return e})();function Nfe(){return Dg(la(),ct())}function Dg(e,t){return new Np(xs(e,t))}let Np=(()=>{class e{constructor(r){this.nativeElement=r}static#e=this.__NG_ELEMENT_ID__=Nfe}return e})();function kfe(e){return e instanceof Np?e.nativeElement:e}class B8{}let Ufe=(()=>{class e{static#e=this.\u0275prov=Ar({token:e,providedIn:"root",factory:()=>null})}return e})();class Dx{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Vfe=new Dx("17.0.5"),M3={};function Nb(e,t,r,n,a=!1){for(;null!==r;){const i=t[r.index];null!==i&&n.push(wa(i)),Co(i)&&H8(i,n);const o=r.type;if(8&o)Nb(e,t,r.child,n);else if(32&o){const s=u3(r,t);let u;for(;u=s();)n.push(u)}else if(16&o){const s=f8(t,r);if(Array.isArray(s))n.push(...s);else{const u=Tb(t[ni]);Nb(u[Ft],u,s,n,!0)}}r=a?r.projectionNext:r.next}return n}function H8(e,t){for(let r=Ti;r<e.length;r++){const n=e[r],a=n[Ft].firstChild;null!==a&&Nb(n[Ft],n,a,t)}e[zl]!==e[pi]&&t.push(e[zl])}let j8=[];const epe={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{GC(e.lView)},consumerOnSignalRead(){this.lView[rh]=this}};function O3(e){return e.ngOriginalError}class ef{constructor(){this._console=console}handleError(t){const r=this._findOriginalError(t);this._console.error("ERROR",t),r&&this._console.error("ORIGINAL ERROR",r)}_findOriginalError(t){let r=t&&O3(t);for(;r&&O3(r);)r=O3(r);return r||null}}const Y8=new sr("",{providedIn:"root",factory:()=>!1}),jr={};function F3(e){Q8(wn(),ct(),Zo()+e,!1)}function Q8(e,t,r,n){if(!n)if(3==(3&t[br])){const i=e.preOrderCheckHooks;null!==i&&qC(t,i,r)}else{const i=e.preOrderHooks;null!==i&&WC(t,i,0,r)}oh(r)}function Pr(e,t=pn.Default){const r=ct();return null===r?an(e,t):d6(la(),r,Er(e),t)}function Mx(e,t,r,n,a,i,o,s,u,c,l){const d=t.blueprint.slice();return d[pi]=a,d[br]=140|n,(null!==c||e&&2048&e[br])&&(d[br]|=2048),VU(d),d[qa]=d[Jv]=e,d[va]=r,d[$v]=o||e&&e[$v],d[Lr]=s||e&&e[Lr],d[Cs]=u||e&&e[Cs]||null,d[Ko]=i,d[db]=function Ede(){return Dde++}(),d[Vl]=l,d[MU]=c,d[ni]=2==t.type?e[ni]:d,d}function Eg(e,t,r,n,a){let i=e.data[t];if(null===i)i=function B3(e,t,r,n,a){const i=WU(),o=SI(),u=e.data[t]=function mpe(e,t,r,n,a,i){let o=t?t.injectorIndex:-1,s=0;return function ag(){return null!==Mr.skipHydrationRootTNode}()&&(s|=128),{type:r,index:n,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:s,providerIndexes:0,value:a,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?i:i&&i.parent,r,t,n,a);return null===e.firstChild&&(e.firstChild=u),null!==i&&(o?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u,u.prev=i)),u}(e,t,r,n,a),function sle(){return Mr.lFrame.inI18n}()&&(i.flags|=32);else if(64&i.type){i.type=r,i.value=n,i.attrs=a;const o=function hb(){const e=Mr.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();i.injectorIndex=null===o?-1:o.injectorIndex}return ql(i,!0),i}function kb(e,t,r,n){if(0===r)return-1;const a=t.length;for(let i=0;i<r;i++)t.push(n),e.blueprint.push(n),e.data.push(null);return a}function $8(e,t,r,n,a){const i=Zo(),o=2&n;try{oh(-1),o&&t.length>Ur&&Q8(e,t,Ur,!1),Hl(o?2:0,a),r(n,a)}finally{oh(i),Hl(o?3:1,a)}}function N3(e,t,r){if(fI(t)){const n=li(null);try{const i=t.directiveEnd;for(let o=t.directiveStart;o<i;o++){const s=e.data[o];s.contentQueries&&s.contentQueries(1,r[o],o)}}finally{li(n)}}}function J8(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=U3(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function U3(e,t,r,n,a,i,o,s,u,c,l){const d=Ur+n,f=d+a,p=function upe(e,t){const r=[];for(let n=0;n<t;n++)r.push(n<e?null:jr);return r}(d,f),m="function"==typeof c?c():c;return p[Ft]={type:e,blueprint:p,template:r,queries:null,viewQuery:s,declTNode:t,data:p.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:u,consts:m,incompleteFirstPass:!1,ssrId:l}}let eV=e=>null;function tV(e,t,r,n){for(let a in e)if(e.hasOwnProperty(a)){r=null===r?{}:r;const i=e[a];null===n?rV(r,t,a,i):n.hasOwnProperty(a)&&rV(r,t,n[a],i)}return r}function rV(e,t,r,n){e.hasOwnProperty(r)?e[r].push(t,n):e[r]=[t,n]}function nV(e,t,r,n,a,i){for(let c=0;c<n.length;c++)RI(XC(r,t),e,n[c].type);!function Tpe(e,t,r){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+r,e.providerIndexes=t}(r,e.data.length,n.length);for(let c=0;c<n.length;c++){const l=n[c];l.providersResolver&&l.providersResolver(l)}let o=!1,s=!1,u=kb(e,t,n.length,null);for(let c=0;c<n.length;c++){const l=n[c];r.mergedAttrs=ub(r.mergedAttrs,l.hostAttrs),Dpe(e,r,t,u,l),Ape(u,l,a),null!==l.contentQueries&&(r.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(r.flags|=64);const d=l.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((e.preOrderHooks??=[]).push(r.index),o=!0),!s&&(d.ngOnChanges||d.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(r.index),s=!0),u++}!function hpe(e,t,r){const a=t.directiveEnd,i=e.data,o=t.attrs,s=[];let u=null,c=null;for(let l=t.directiveStart;l<a;l++){const d=i[l],f=r?r.get(d):null,m=f?f.outputs:null;u=tV(d.inputs,l,u,f?f.inputs:null),c=tV(d.outputs,l,c,m);const h=null===u||null===o||wU(t)?null:Ppe(u,l,o);s.push(h)}null!==u&&(u.hasOwnProperty("class")&&(t.flags|=8),u.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=s,t.inputs=u,t.outputs=c}(e,r,i)}function aV(e,t,r){const n=r.directiveStart,a=r.directiveEnd,i=r.index,o=function cle(){return Mr.lFrame.currentDirectiveIndex}();try{oh(i);for(let s=n;s<a;s++){const u=e.data[s],c=t[s];xI(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&xpe(u,c)}}finally{oh(-1),xI(o)}}function xpe(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function G3(e,t,r){t.componentOffset=r,(e.components??=[]).push(t.index)}function Ape(e,t,r){if(r){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)r[t.exportAs[n]]=e;tl(t)&&(r[""]=e)}}function Dpe(e,t,r,n,a){e.data[n]=a;const i=a.factory||(a.factory=ah(a.type)),o=new vb(i,tl(a),Pr);e.blueprint[n]=o,r[n]=o,function bpe(e,t,r,n,a){const i=a.hostBindings;if(i){let o=e.hostBindingOpCodes;null===o&&(o=e.hostBindingOpCodes=[]);const s=~t.index;(function Spe(e){let t=e.length;for(;t>0;){const r=e[--t];if("number"==typeof r&&r<0)return r}return 0})(o)!=s&&o.push(s),o.push(r,n,i)}}(e,t,n,kb(e,r,a.hostVars,jr),a)}function Ipe(e,t,r,n,a,i){const o=i[t];if(null!==o)for(let s=0;s<o.length;)iV(n,r,o[s++],o[s++],o[s++])}function iV(e,t,r,n,a){const i=li(null);try{const o=e.inputTransforms;null!==o&&o.hasOwnProperty(n)&&(a=o[n].call(t,a)),null!==e.setInput?e.setInput(t,a,r,n):t[n]=a}finally{li(i)}}function Ppe(e,t,r){let n=null,a=0;for(;a<r.length;){const i=r[a];if(0!==i)if(5!==i){if("number"==typeof i)break;if(e.hasOwnProperty(i)){null===n&&(n=[]);const o=e[i];for(let s=0;s<o.length;s+=2)if(o[s]===t){n.push(i,o[s+1],r[a+1]);break}}a+=2}else a+=2;else a+=4}return n}function sV(e,t){const r=e.contentQueries;if(null!==r){const n=li(null);try{for(let a=0;a<r.length;a+=2){const o=r[a+1];if(-1!==o){const s=e.data[o];wI(r[a]),s.contentQueries(2,t[o],o)}}}finally{li(n)}}}function Rx(e,t){return e[cb]?e[PU][el]=t:e[cb]=t,e[PU]=t,t}function H3(e,t,r){wI(0);const n=li(null);try{t(e,r)}finally{li(n)}}function j3(e,t,r,n,a){for(let i=0;i<r.length;){const o=r[i++],s=r[i++];iV(e.data[o],t[o],n,s,a)}}function tf(e,t,r){const n=function pb(e,t){return wa(t[e])}(t,e);!function n8(e,t,r){e.setValue(t,r)}(e[Lr],n,r)}function q3(e,t=!0){const r=e[$v],n=r.rendererFactory,a=r.afterRenderEventManager;n.begin?.(),a?.begin();try{const o=e[Ft];dV(o,e,o.template,e[va]),function Rpe(e){let t=0;for(;zU(e);){if(100===t)throw new Ot(103,!1);t++,mV(e,1)}}(e)}catch(o){throw t&&function Ox(e,t){const r=e[Cs],n=r?r.get(ef,null):null;n&&n.handleError(t)}(e,o),o}finally{n.end?.(),r.inlineEffectRunner?.flush(),a?.end()}}function dV(e,t,r,n){const a=t[br];if(256==(256&a))return;t[$v].inlineEffectRunner?.flush(),AI(t);let o=null,s=null;(function Ope(e){return 2!==e.type})(e)&&(s=function Qfe(e){return e[rh]??function $fe(e){const t=j8.pop()??Object.create(epe);return t.lView=e,t}(e)}(t),o=function D5(e){return e&&(e.nextProducerIndex=0),li(e)}(s));try{VU(t),function XU(e){return Mr.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==r&&$8(e,t,r,2,n);const u=3==(3&a);if(u){const d=e.preOrderCheckHooks;null!==d&&qC(t,d,null)}else{const d=e.preOrderHooks;null!==d&&WC(t,d,0,null),DI(t,0)}if(function Fpe(e){for(let t=e8(e);null!==t;t=t8(t)){if(!(t[br]&rg.HasTransplantedViews))continue;const r=t[tg];for(let n=0;n<r.length;n++){Kce(r[n])}}}(t),fV(t,0),null!==e.contentQueries&&sV(e,t),u){const d=e.contentCheckHooks;null!==d&&qC(t,d)}else{const d=e.contentHooks;null!==d&&WC(t,d,1),DI(t,1)}!function spe(e,t){const r=e.hostBindingOpCodes;if(null!==r)try{for(let n=0;n<r.length;n++){const a=r[n];if(a<0)oh(~a);else{const i=a,o=r[++n],s=r[++n];ule(o,i),s(2,t[i])}}}finally{oh(-1)}}(e,t);const c=e.components;null!==c&&hV(t,c,0);const l=e.viewQuery;if(null!==l&&H3(2,l,n),u){const d=e.viewCheckHooks;null!==d&&qC(t,d)}else{const d=e.viewHooks;null!==d&&WC(t,d,2),DI(t,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[LC]){for(const d of t[LC])d();t[LC]=null}t[br]&=-73}catch(u){throw GC(t),u}finally{null!==s&&(function E5(e,t){if(li(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(tb(e))for(let r=e.nextProducerIndex;r<e.producerNode.length;r++)CC(e.producerNode[r],e.producerIndexOfThis[r]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}(s,o),function Jfe(e){e.lView[rh]!==e&&(e.lView=null,j8.push(e))}(s)),TI()}}function fV(e,t){for(let r=e8(e);null!==r;r=t8(r)){r[br]&=~rg.HasChildViewsToRefresh;for(let n=Ti;n<r.length;n++)pV(r[n],t)}}function Bpe(e,t,r){pV(Au(t,e),r)}function pV(e,t){yI(e)&&mV(e,t)}function mV(e,t){const n=e[Ft],a=e[br],i=e[rh];let o=!!(0===t&&16&a);if(o||=!!(64&a&&0===t),o||=!!(1024&a),o||=!(!i?.dirty||!RE(i)),i&&(i.dirty=!1),e[br]&=-9217,o)dV(n,e,n.template,e[va]);else if(8192&a){fV(e,1);const s=n.components;null!==s&&hV(e,s,1)}}function hV(e,t,r){for(let n=0;n<t.length;n++)Bpe(e,t[n],r)}function Lb(e){for(;e;){e[br]|=64;const t=Tb(e);if(pI(e)&&!t)return e;e=t}return null}class Ub{get rootNodes(){const t=this._lView,r=t[Ft];return Nb(r,t,r.firstChild,[])}constructor(t,r,n=!0){this._lView=t,this._cdRefInjectingView=r,this.notifyErrorHandler=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[va]}set context(t){this._lView[va]=t}get destroyed(){return 256==(256&this._lView[br])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[qa];if(Co(t)){const r=t[8],n=r?r.indexOf(this):-1;n>-1&&(Db(t,n),$C(r,n))}this._attachedToViewContainer=!1}px(this._lView[Ft],this._lView)}onDestroy(t){!function zC(e,t){if(256==(256&e[br]))throw new Ot(911,!1);null===e[Ep]&&(e[Ep]=[]),e[Ep].push(t)}(this._lView,t)}markForCheck(){Lb(this._cdRefInjectingView||this._lView)}detach(){this._lView[br]&=-129}reattach(){HU(this._lView),this._lView[br]|=128}detectChanges(){q3(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ot(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function zde(e,t){Ib(e,t,t[Lr],2,null,null)}(this._lView[Ft],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Ot(902,!1);this._appRef=t}}let Fx=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Npe}return e})();function Npe(e){return function kpe(e,t,r){if(nh(e)&&!r){const n=Au(e.index,t);return new Ub(n,n)}return 47&e.type?new Ub(t[ni],t):null}(la(),ct(),16==(16&e))}const vV=new Set;function Y3(e){return t=>{setTimeout(e,void 0,t)}}const Uo=class Ype extends bn{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,r,n){let a=t,i=r||(()=>null),o=n;if(t&&"object"==typeof t){const u=t;a=u.next?.bind(u),i=u.error?.bind(u),o=u.complete?.bind(u)}this.__isAsync&&(i=Y3(i),a&&(a=Y3(a)),o&&(o=Y3(o)));const s=super.subscribe({next:a,error:i,complete:o});return t instanceof Xs&&t.add(s),s}};function gV(...e){}class ga{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Uo(!1),this.onMicrotaskEmpty=new Uo(!1),this.onStable=new Uo(!1),this.onError=new Uo(!1),typeof Zone>"u")throw new Ot(908,!1);Zone.assertZonePatched();const a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!n&&r,a.shouldCoalesceRunChangeDetection=n,a.lastRequestAnimationFrameId=-1,a.nativeRequestAnimationFrame=function Xpe(){const e="function"==typeof _a.requestAnimationFrame;let t=_a[e?"requestAnimationFrame":"setTimeout"],r=_a[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&r){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:r}}().nativeRequestAnimationFrame,function Qpe(e){const t=()=>{!function Zpe(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(_a,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,K3(e),e.isCheckStableRunning=!0,X3(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),K3(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,n,a,i,o,s)=>{if(function Jpe(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(s))return r.invokeTask(a,i,o,s);try{return yV(e),r.invokeTask(a,i,o,s)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||e.shouldCoalesceRunChangeDetection)&&t(),bV(e)}},onInvoke:(r,n,a,i,o,s,u)=>{try{return yV(e),r.invoke(a,i,o,s,u)}finally{e.shouldCoalesceRunChangeDetection&&t(),bV(e)}},onHasTask:(r,n,a,i)=>{r.hasTask(a,i),n===a&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,K3(e),X3(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(r,n,a,i)=>(r.handleError(a,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(a)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ga.isInAngularZone())throw new Ot(909,!1)}static assertNotInAngularZone(){if(ga.isInAngularZone())throw new Ot(909,!1)}run(t,r,n){return this._inner.run(t,r,n)}runTask(t,r,n,a){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+a,t,Kpe,gV,gV);try{return i.runTask(o,r,n)}finally{i.cancelTask(o)}}runGuarded(t,r,n){return this._inner.runGuarded(t,r,n)}runOutsideAngular(t){return this._outer.run(t)}}const Kpe={};function X3(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function K3(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function yV(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function bV(e){e._nesting--,X3(e)}const SV=new sr("",{providedIn:"root",factory:CV});function CV(){const e=Yt(ga);let t=!0;return Ll(new zi(a=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{a.next(t),a.complete()})}),new zi(a=>{let i;e.runOutsideAngular(()=>{i=e.onStable.subscribe(()=>{ga.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,a.next(!0))})})});const o=e.onUnstable.subscribe(()=>{ga.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{a.next(!1)}))});return()=>{i.unsubscribe(),o.unsubscribe()}}).pipe(YE()))}let Bx=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null,this.internalCallbacks=[]}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth){for(const r of this.internalCallbacks)r();this.internalCallbacks.length=0,this.handler?.execute()}}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=Ar({token:e,providedIn:"root",factory:()=>new e})}return e})();function rme(e,t){const r=Au(t,e),n=r[Ft];!function nme(e,t){for(let r=t.length;r<e.blueprint.length;r++)t.push(e.blueprint[r])}(n,r);const a=r[pi];null!==a&&null===r[Vl]&&(r[Vl]=E3(a,r[Cs])),Z3(n,r,r[va])}function Z3(e,t,r){AI(t);try{const n=e.viewQuery;null!==n&&H3(1,n,r);const a=e.template;null!==a&&$8(e,t,a,1,r),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&sV(e,t),e.staticViewQueries&&H3(2,e.viewQuery,r);const i=e.components;null!==i&&function ame(e,t){for(let r=0;r<t.length;r++)rme(e,t[r])}(t,i)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[br]&=-5,TI()}}function Nx(e,t,r){let n=r?e.styles:null,a=r?e.classes:null,i=0;if(null!==t)for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?i=s:1==i?a=KE(a,s):2==i&&(n=KE(n,s+": "+t[++o]+";"))}r?e.styles=n:e.stylesWithoutHost=n,r?e.classes=a:e.classesWithoutHost=a}class TV extends Ax{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const r=cn(t);return new Vb(r,this.ngModule)}}function DV(e){const t=[];for(let r in e)e.hasOwnProperty(r)&&t.push({propName:e[r],templateName:r});return t}class ome{constructor(t,r){this.injector=t,this.parentInjector=r}get(t,r,n){n=FC(n);const a=this.injector.get(t,M3,n);return a!==M3||r===M3?a:this.parentInjector.get(t,r,n)}}class Vb extends O8{get inputs(){const t=this.componentDef,r=t.inputTransforms,n=DV(t.inputs);if(null!==r)for(const a of n)r.hasOwnProperty(a.propName)&&(a.transform=r[a.propName]);return n}get outputs(){return DV(this.componentDef.outputs)}constructor(t,r){super(),this.componentDef=t,this.ngModule=r,this.componentType=t.type,this.selector=function Rce(e){return e.map(Mce).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!r}create(t,r,n,a){let i=(a=a||this.ngModule)instanceof rl?a:a?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const o=i?new ome(t,i):t,s=o.get(B8,null);if(null===s)throw new Ot(407,!1);const l={rendererFactory:s,sanitizer:o.get(Ufe,null),inlineEffectRunner:null,afterRenderEventManager:o.get(Bx,null)},d=s.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",p=n?function cpe(e,t,r,n){const i=n.get(Y8,!1)||r===$c.ShadowDom,o=e.selectRootElement(t,i);return function lpe(e){eV(e)}(o),o}(d,n,this.componentDef.encapsulation,o):fx(d,f,function ime(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(f)),v=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let g=null;null!==p&&(g=E3(p,o,!0));const y=U3(0,null,null,1,0,null,null,null,null,null,null),S=Mx(null,y,null,v,null,null,l,d,o,null,g);let C,_;AI(S);try{const x=this.componentDef;let D,w=null;x.findHostDirectiveDefs?(D=[],w=new Map,x.findHostDirectiveDefs(x,D,w),D.push(x)):D=[x];const A=function ume(e,t){const r=e[Ft],n=Ur;return e[n]=t,Eg(r,n,2,"#host",null)}(S,p),E=function cme(e,t,r,n,a,i,o){const s=a[Ft];!function lme(e,t,r,n){for(const a of e)t.mergedAttrs=ub(t.mergedAttrs,a.hostAttrs);null!==t.mergedAttrs&&(Nx(t,t.mergedAttrs,!0),null!==r&&v8(n,r,t))}(n,e,t,o);let u=null;null!==t&&(u=E3(t,a[Cs]));const c=i.rendererFactory.createRenderer(t,r);let l=16;r.signals?l=4096:r.onPush&&(l=64);const d=Mx(a,J8(r),null,l,a[e.index],e,i,c,null,null,u);return s.firstCreatePass&&G3(s,e,n.length-1),Rx(a,d),a[e.index]=d}(A,p,x,D,S,l,d);_=mb(y,Ur),p&&function fme(e,t,r,n){if(n)cI(e,r,["ng-version",Vfe.full]);else{const{attrs:a,classes:i}=function Oce(e){const t=[],r=[];let n=1,a=2;for(;n<e.length;){let i=e[n];if("string"==typeof i)2===a?""!==i&&t.push(i,e[++n]):8===a&&r.push(i);else{if(!Jc(a))break;a=i}n++}return{attrs:t,classes:r}}(t.selectors[0]);a&&cI(e,r,a),i&&i.length>0&&h8(e,r,i.join(" "))}}(d,x,p,n),void 0!==r&&function pme(e,t,r){const n=e.projection=[];for(let a=0;a<t.length;a++){const i=r[a];n.push(null!=i?Array.from(i):null)}}(_,this.ngContentSelectors,r),C=function dme(e,t,r,n,a,i){const o=la(),s=a[Ft],u=xs(o,a);nV(s,a,o,r,null,n);for(let l=0;l<r.length;l++)Qo(sh(a,s,o.directiveStart+l,o),a);aV(s,a,o),u&&Qo(u,a);const c=sh(a,s,o.directiveStart+o.componentOffset,o);if(e[va]=a[va]=c,null!==i)for(const l of i)l(c,t);return N3(s,o,e),c}(E,x,D,w,S,[mme]),Z3(y,S,null)}finally{TI()}return new sme(this.componentType,C,Dg(_,S),S,_)}}class sme extends Ofe{constructor(t,r,n,a,i){super(),this.location=n,this._rootLView=a,this._tNode=i,this.previousInputValues=null,this.instance=r,this.hostView=this.changeDetectorRef=new Ub(a,void 0,!1),this.componentType=t}setInput(t,r){const n=this._tNode.inputs;let a;if(null!==n&&(a=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),r))return;const i=this._rootLView;j3(i[Ft],i,a,t,r),this.previousInputValues.set(t,r),Lb(Au(this._tNode.index,i))}}get injector(){return new uo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function mme(){const e=la();jC(ct()[Ft],e)}function ji(e,t,r){return!Object.is(e[t],r)&&(e[t]=r,!0)}function tP(e,t,r){const n=ct();return ji(n,Wl(),t)&&function Eu(e,t,r,n,a,i,o,s){const u=xs(t,r);let l,c=t.inputs;!s&&null!=c&&(l=c[n])?(j3(e,r,l,n,a),nh(t)&&function gpe(e,t){const r=Au(t,e);16&r[br]||(r[br]|=64)}(r,t.index)):3&t.type&&(n=function vpe(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),a=null!=o?o(a,t.value||"",n):a,i.setProperty(u,n,a))}(wn(),function Ba(){const e=Mr.lFrame;return mb(e.tView,e.selectedIndex)}(),n,e,t,n[Lr],r,!1),tP}function rP(e,t,r,n,a){const o=a?"class":"style";j3(e,r,t.inputs[o],o,n)}function Vg(e,t){return!t||cx(e)}function Yb(e,t,r,n=!0){const a=t[Ft];if(function jde(e,t,r,n){const a=Ti+n,i=r.length;n>0&&(r[a-1][el]=t),n<i-Ti?(t[el]=r[a],g6(r,Ti+n,t)):(r.push(t),t[el]=null),t[qa]=r;const o=t[lb];null!==o&&r!==o&&function qde(e,t){const r=e[tg];t[ni]!==t[qa][qa][ni]&&(e[br]|=rg.HasTransplantedViews),null===r?e[tg]=[t]:r.push(t)}(o,t);const s=t[Gl];null!==s&&s.insertView(e),HU(t),t[br]|=128}(a,t,e,r),n){const i=p3(r,e),o=t[Lr],s=mx(o,e[zl]);null!==s&&function Gde(e,t,r,n,a,i){n[pi]=a,n[Ko]=t,Ib(e,n,r,1,a,i)}(a,e[Ko],o,t,s,i)}}let il=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Ahe}return e})();function Ahe(){return vG(la(),ct())}const The=il,mG=class extends The{constructor(t,r,n){super(),this._lContainer=t,this._hostTNode=r,this._hostLView=n}get element(){return Dg(this._hostTNode,this._hostLView)}get injector(){return new uo(this._hostTNode,this._hostLView)}get parentInjector(){const t=KC(this._hostTNode,this._hostLView);if(II(t)){const r=yb(t,this._hostLView),n=gb(t);return new uo(r[Ft].data[n+8],r)}return new uo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const r=hG(this._lContainer);return null!==r&&r[t]||null}get length(){return this._lContainer.length-Ti}createEmbeddedView(t,r,n){let a,i;"number"==typeof n?a=n:null!=n&&(a=n.index,i=n.injector);const s=t.createEmbeddedViewImpl(r||{},i,null);return this.insertImpl(s,a,Vg(this._hostTNode,null)),s}createComponent(t,r,n,a,i){const o=t&&!function bb(e){return"function"==typeof e}(t);let s;if(o)s=r;else{const m=r||{};s=m.index,n=m.injector,a=m.projectableNodes,i=m.environmentInjector||m.ngModuleRef}const u=o?t:new Vb(cn(t)),c=n||this.parentInjector;if(!i&&null==u.ngModule){const h=(o?c:this.parentInjector).get(rl,null);h&&(i=h)}cn(u.componentType??{});const p=u.create(c,a,null,i);return this.insertImpl(p.hostView,s,Vg(this._hostTNode,null)),p}insert(t,r){return this.insertImpl(t,r,!0)}insertImpl(t,r,n){const a=t._lView;if(function Xce(e){return Co(e[qa])}(a)){const s=this.indexOf(t);if(-1!==s)this.detach(s);else{const u=a[qa],c=new mG(u,u[Ko],u[qa]);c.detach(c.indexOf(t))}}const i=this._adjustIndex(r),o=this._lContainer;return Yb(o,a,i,n),t.attachToViewContainerRef(),g6(fP(o),i,t),t}move(t,r){return this.insert(t,r)}indexOf(t){const r=hG(this._lContainer);return null!==r?r.indexOf(t):-1}remove(t){const r=this._adjustIndex(t,-1),n=Db(this._lContainer,r);n&&($C(fP(this._lContainer),r),px(n[Ft],n))}detach(t){const r=this._adjustIndex(t,-1),n=Db(this._lContainer,r);return n&&null!=$C(fP(this._lContainer),r)?new Ub(n):null}_adjustIndex(t,r=0){return t??this.length+r}};function hG(e){return e[8]}function fP(e){return e[8]||(e[8]=[])}function vG(e,t){let r;const n=t[e.index];return Co(n)?r=n:(r=function oV(e,t,r,n){return[e,!0,0,t,null,n,null,r,null,null]}(n,t,null,e),t[e.index]=r,Rx(t,r)),gG(r,t,e,n),new mG(r,e,t)}let gG=function bG(e,t,r,n){if(e[zl])return;let a;a=8&r.type?wa(n):function Dhe(e,t){const r=e[Lr],n=r.createComment(""),a=xs(t,e);return ch(r,mx(r,a),n,function Kde(e,t){return e.nextSibling(t)}(r,a),!1),n}(t,r),e[zl]=a};function Yg(e,t,r,n){const a=ct(),i=wn(),o=Ur+e,s=a[Lr],u=i.firstCreatePass?function Sve(e,t,r,n,a,i){const o=t.consts,u=Eg(t,e,2,n,jl(o,a));return function V3(e,t,r,n){if(qU()){const a=null===n?null:{"":-1},i=function _pe(e,t){const r=e.directiveRegistry;let n=null,a=null;if(r)for(let i=0;i<r.length;i++){const o=r[i];if(AU(t,o.selectors,!1))if(n||(n=[]),tl(o))if(null!==o.findHostDirectiveDefs){const s=[];a=a||new Map,o.findHostDirectiveDefs(o,s,a),n.unshift(...s,o),G3(e,t,s.length)}else n.unshift(o),G3(e,t,0);else a=a||new Map,o.findHostDirectiveDefs?.(o,n,a),n.push(o)}return null===n?null:[n,a]}(e,r);let o,s;null===i?o=s=null:[o,s]=i,null!==o&&nV(e,t,r,o,a,s),a&&function wpe(e,t,r){if(t){const n=e.localNames=[];for(let a=0;a<t.length;a+=2){const i=r[t[a+1]];if(null==i)throw new Ot(-301,!1);n.push(t[a],i)}}}(r,n,a)}r.mergedAttrs=ub(r.mergedAttrs,r.attrs)}(t,r,u,jl(o,i)),null!==u.attrs&&Nx(u,u.attrs,!1),null!==u.mergedAttrs&&Nx(u,u.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,u),u}(o,i,a,t,r,n):i.data[o],c=jG(i,a,u,s,t,e);a[o]=c;const l=function VC(e){return 1==(1&e.flags)}(u);return ql(u,!0),v8(s,c,u),32!=(32&u.flags)&&HC()&&hx(i,a,c,u),0===function Zce(){return Mr.lFrame.elementDepthCount}()&&Qo(c,a),function Qce(){Mr.lFrame.elementDepthCount++}(),l&&(function k3(e,t,r){qU()&&(function Cpe(e,t,r,n){const a=r.directiveStart,i=r.directiveEnd;nh(r)&&function Epe(e,t,r){const n=xs(t,e),a=J8(r);let o=16;r.signals?o=4096:r.onPush&&(o=64);const s=Rx(e,Mx(e,a,null,o,n,t,null,e[$v].rendererFactory.createRenderer(n,r),null,null,null));e[t.index]=s}(t,r,e.data[a+r.componentOffset]),e.firstCreatePass||XC(r,t),Qo(n,t);const o=r.initialInputs;for(let s=a;s<i;s++){const u=e.data[s],c=sh(t,e,s,r);Qo(c,t),null!==o&&Ipe(0,s-a,c,u,0,o),tl(u)&&(Au(r.index,t)[va]=sh(t,e,s,r))}}(e,t,r,xs(r,t)),64==(64&r.flags)&&aV(e,t,r))}(i,a,u),N3(i,u,a)),null!==n&&function L3(e,t,r=xs){const n=t.localNames;if(null!==n){let a=t.index+1;for(let i=0;i<n.length;i+=2){const o=n[i+1],s=-1===o?r(t,e):e[o];e[a++]=s}}}(a,u),Yg}function Xg(){let e=la();SI()?function CI(){Mr.lFrame.isParent=!1}():(e=e.parent,ql(e,!1));const t=e;(function Jce(e){return Mr.skipHydrationRootTNode===e})(t)&&function nle(){Mr.skipHydrationRootTNode=null}(),function $ce(){Mr.lFrame.elementDepthCount--}();const r=wn();return r.firstCreatePass&&(jC(r,e),fI(e)&&r.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Sle(e){return 0!=(8&e.flags)}(t)&&rP(r,t,ct(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Cle(e){return 0!=(16&e.flags)}(t)&&rP(r,t,ct(),t.stylesWithoutHost,!1),Xg}function $b(e,t,r,n){return Yg(e,t,r,n),Xg(),$b}let jG=(e,t,r,n,a,i)=>(Ip(!0),fx(n,a,function r6(){return Mr.lFrame.currentNamespace}()));const Zg="en-US";let QG=Zg;function e_(e){return!!e&&"function"==typeof e.then}function xz(e){return!!e&&"function"==typeof e.subscribe}let Wz=(e,t,r,n,a)=>(Ip(!0),function dx(e,t){return e.createText(t)}(t[Lr],n));function PP(e){return MP("",e,""),PP}function MP(e,t,r){const n=ct(),a=function Pg(e,t,r,n){return ji(e,Wl(),r)?t+kr(r)+n:jr}(n,e,t,r);return a!==jr&&tf(n,Zo(),a),MP}class vh{}class rH{}class NP extends vh{constructor(t,r,n){super(),this._parent=r,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new TV(this);const a=Xo(t);this._bootstrapComponents=Du(a.bootstrap),this._r3Injector=O6(t,r,[{provide:vh,useValue:this},{provide:Ax,useValue:this.componentFactoryResolver},...n],Hi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class kP extends rH{constructor(t){super(),this.moduleType=t}create(t){return new NP(this.moduleType,t,[])}}class nH extends vh{constructor(t){super(),this.componentFactoryResolver=new TV(this),this.instance=null;const r=new gg([...t.providers,{provide:vh,useValue:this},{provide:Ax,useValue:this.componentFactoryResolver}],t.parent||ax(),t.debugName,new Set(["environment"]));this.injector=r,t.runEnvironmentInitializers&&r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function aH(e,t,r=null){return new nH({providers:e,parent:t,debugName:r,runEnvironmentInitializers:!0}).injector}let Xge=(()=>{class e{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){const n=w6(0,r.type),a=n.length>0?aH([n],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,a)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(const r of this.cachedInjectors.values())null!==r&&r.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Ar({token:e,providedIn:"environment",factory:()=>new e(an(rl))})}return e})();function t_(e){(function lh(e){vV.has(e)||(vV.add(e),performance?.mark?.("mark_use_counter",{detail:{feature:e}}))})("NgStandalone"),e.getStandaloneInjector=t=>t.get(Xge).getOrCreateStandaloneInjector(e)}function x0e(){return this._results[Symbol.iterator]()}class UP{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new Uo)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const r=UP.prototype;r[Symbol.iterator]||(r[Symbol.iterator]=x0e)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,r){return this._results.reduce(t,r)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,r){this.dirty=!1;const n=function $s(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function Fle(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let a=e[n],i=t[n];if(r&&(a=r(a),i=r(i)),i!==a)return!1}return!0}(this._results,n,r))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let rf=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=A0e}return e})();const _0e=rf,w0e=class extends _0e{constructor(t,r,n){super(),this._declarationLView=t,this._declarationTContainer=r,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,r){return this.createEmbeddedViewImpl(t,r)}createEmbeddedViewImpl(t,r,n){const a=function Wb(e,t,r,n){const a=t.tView,s=Mx(e,a,r,4096&e[br]?4096:16,null,t,null,null,null,n?.injector??null,n?.dehydratedView??null);s[lb]=e[t.index];const c=e[Gl];return null!==c&&(s[Gl]=c.createEmbeddedView(a)),Z3(a,s,r),s}(this._declarationLView,this._declarationTContainer,t,{injector:r,dehydratedView:n});return new Ub(a)}};function A0e(){return a_(la(),ct())}function a_(e,t){return 4&e.type?new w0e(t,e,Dg(e,t)):null}class VP{constructor(t){this.queryList=t,this.matches=null}clone(){return new VP(this.queryList)}setDirty(){this.queryList.setDirty()}}class GP{constructor(t=[]){this.queries=t}createEmbeddedView(t){const r=t.queries;if(null!==r){const n=null!==t.contentQueries?t.contentQueries[0]:r.length,a=[];for(let i=0;i<n;i++){const o=r.getByIndex(i);a.push(this.queries[o.indexInDeclarationView].clone())}return new GP(a)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let r=0;r<this.queries.length;r++)null!==xH(t,r).matches&&this.queries[r].setDirty()}}class gH{constructor(t,r,n=null){this.predicate=t,this.flags=r,this.read=n}}class zP{constructor(t=[]){this.queries=t}elementStart(t,r){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,r)}elementEnd(t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementEnd(t)}embeddedTView(t){let r=null;for(let n=0;n<this.length;n++){const a=null!==r?r.length:0,i=this.getByIndex(n).embeddedTView(t,a);i&&(i.indexInDeclarationView=n,null!==r?r.push(i):r=[i])}return null!==r?new zP(r):null}template(t,r){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,r)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class HP{constructor(t,r=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=r}elementStart(t,r){this.isApplyingToNode(r)&&this.matchTNode(t,r)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,r){this.elementStart(t,r)}embeddedTView(t,r){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,r),new HP(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const r=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==r;)n=n.parent;return r===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,r){const n=this.metadata.predicate;if(Array.isArray(n))for(let a=0;a<n.length;a++){const i=n[a];this.matchTNodeWithReadOption(t,r,T0e(r,i)),this.matchTNodeWithReadOption(t,r,ZC(r,t,i,!1,!1))}else n===rf?4&r.type&&this.matchTNodeWithReadOption(t,r,-1):this.matchTNodeWithReadOption(t,r,ZC(r,t,n,!1,!1))}matchTNodeWithReadOption(t,r,n){if(null!==n){const a=this.metadata.read;if(null!==a)if(a===Np||a===il||a===rf&&4&r.type)this.addMatch(r.index,-2);else{const i=ZC(r,t,a,!1,!1);null!==i&&this.addMatch(r.index,i)}else this.addMatch(r.index,n)}}addMatch(t,r){null===this.matches?this.matches=[t,r]:this.matches.push(t,r)}}function T0e(e,t){const r=e.localNames;if(null!==r)for(let n=0;n<r.length;n+=2)if(r[n]===t)return r[n+1];return null}function E0e(e,t,r,n){return-1===r?function D0e(e,t){return 11&e.type?Dg(e,t):4&e.type?a_(e,t):null}(t,e):-2===r?function I0e(e,t,r){return r===Np?Dg(t,e):r===rf?a_(t,e):r===il?vG(t,e):void 0}(e,t,n):sh(e,e[Ft],r,t)}function yH(e,t,r,n){const a=t[Gl].queries[n];if(null===a.matches){const i=e.data,o=r.matches,s=[];for(let u=0;u<o.length;u+=2){const c=o[u];s.push(c<0?null:E0e(t,i[c],o[u+1],r.metadata.read))}a.matches=s}return a.matches}function jP(e,t,r,n){const a=e.queries.getByIndex(r),i=a.matches;if(null!==i){const o=yH(e,t,a,r);for(let s=0;s<i.length;s+=2){const u=i[s];if(u>0)n.push(o[s/2]);else{const c=i[s+1],l=t[-u];for(let d=Ti;d<l.length;d++){const f=l[d];f[lb]===f[qa]&&jP(f[Ft],f,c,n)}if(null!==l[tg]){const d=l[tg];for(let f=0;f<d.length;f++){const p=d[f];jP(p[Ft],p,c,n)}}}}}return n}function i_(e){const t=ct(),r=wn(),n=ZU();wI(n+1);const a=xH(r,n);if(e.dirty&&function Yce(e){return 4==(4&e[br])}(t)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{const i=a.crossesNgTemplate?jP(r,t,n,[]):yH(r,t,a,n);e.reset(i,kfe),e.notifyOnChanges()}return!0}return!1}function qP(e,t,r){const n=wn();n.firstCreatePass&&(function CH(e,t,r){null===e.queries&&(e.queries=new zP),e.queries.track(new HP(t,r))}(n,new gH(e,t,r),-1),2==(2&t)&&(n.staticViewQueries=!0)),function SH(e,t,r){const n=new UP(4==(4&r));(function ppe(e,t,r,n){const a=function uV(e){return e[Qv]||(e[Qv]=[])}(t);a.push(r),e.firstCreatePass&&function cV(e){return e.cleanup||(e.cleanup=[])}(e).push(n,a.length-1)})(e,t,n,n.destroy),null===t[Gl]&&(t[Gl]=new GP),t[Gl].queries.push(new VP(n))}(n,ct(),t)}function o_(){return function P0e(e,t){return e[Gl].queries[t].queryList}(ct(),ZU())}function xH(e,t){return e.queries.getByIndex(t)}const eye=new sr("Application Initializer");let ZP=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,n)=>{this.resolve=r,this.reject=n}),this.appInits=Yt(eye,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const r=[];for(const a of this.appInits){const i=a();if(e_(i))r.push(i);else if(xz(i)){const o=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});r.push(o)}}const n=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{n()}).catch(a=>{this.reject(a)}),0===r.length&&n(),this.initialized=!0}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),LH=(()=>{class e{log(r){console.log(r)}warn(r){console.warn(r)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const nf=new sr("LocaleId",{providedIn:"root",factory:()=>Yt(nf,pn.Optional|pn.SkipSelf)||function tye(){return typeof $localize<"u"&&$localize.locale||Zg}()});let VH=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ai(!1)}add(){this.hasPendingTasks.next(!0);const r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class sye{constructor(t,r){this.ngModuleFactory=t,this.componentFactories=r}}let uye=(()=>{class e{compileModuleSync(r){return new kP(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){const n=this.compileModuleSync(r),i=Du(Xo(r).declarations).reduce((o,s)=>{const u=cn(s);return u&&o.push(new Vb(u)),o},[]);return new sye(n,i)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const qH=new sr("");let Up=null;const tM=new sr("PlatformDestroyListeners"),rM=new sr("appBootstrapListener");function Lye(e){try{const{rootComponent:t,appProviders:r,platformProviders:n}=e,a=function kye(e=[]){if(Up)return Up;const t=function KH(e=[],t){return ac.create({name:t,providers:[{provide:WI,useValue:"platform"},{provide:tM,useValue:new Set([()=>Up=null])},...e]})}(e);return Up=t,function YH(){!function sue(e){R5=e}(()=>{throw new Ot(600,!1)})}(),function XH(e){e.get(B6,null)?.forEach(r=>r())}(t),t}(n),i=[Hye(),...r||[]],s=new nH({providers:i,parent:a,debugName:"",runEnvironmentInitializers:!1}).injector,u=s.get(ga);return u.run(()=>{s.resolveInjectorInitializers();const c=s.get(ef,null);let l;u.runOutsideAngular(()=>{l=u.onError.subscribe({next:p=>{c.handleError(p)}})});const d=()=>s.destroy(),f=a.get(tM);return f.add(d),s.onDestroy(()=>{l.unsubscribe(),f.delete(d)}),function $H(e,t,r){try{const n=r();return e_(n)?n.catch(a=>{throw t.runOutsideAngular(()=>e.handleError(a)),a}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(c,u,()=>{const p=s.get(ZP);return p.runInitializers(),p.donePromise.then(()=>{!function $G(e){Ks(e,"Expected localeId to be defined"),"string"==typeof e&&(QG=e.toLowerCase().replace(/_/g,"-"))}(s.get(nf,Zg)||Zg);const h=s.get(Jg);return void 0!==t&&h.bootstrap(t),h})})})}catch(t){return Promise.reject(t)}}let Jg=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Yt(t7),this.zoneIsStable=Yt(SV),this.componentTypes=[],this.components=[],this.isStable=Yt(VH).hasPendingTasks.pipe(nc(r=>r?Hr(!1):this.zoneIsStable),uU(),YE()),this._injector=Yt(rl)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,n){const a=r instanceof O8;if(!this._injector.get(ZP).done)throw!a&&function Dp(e){const t=cn(e)||so(e)||ko(e);return null!==t&&t.standalone}(r),new Ot(405,!1);let o;o=a?r:this._injector.get(Ax).resolveComponentFactory(r),this.componentTypes.push(o.componentType);const s=function Bye(e){return e.isBoundToModule}(o)?void 0:this._injector.get(vh),c=o.create(ac.NULL,[],n||o.selector,s),l=c.location.nativeElement,d=c.injector.get(qH,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),l_(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new Ot(101,!1);try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1}}attachView(r){const n=r;this._views.push(n),n.attachToAppRef(this)}detachView(r){const n=r;l_(this._views,n),n.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);const n=this._injector.get(rM,[]);[...this._bootstrapListeners,...n].forEach(a=>a(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>l_(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new Ot(406,!1);const r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function l_(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const t7=new sr("",{providedIn:"root",factory:()=>Yt(ef).handleError.bind(void 0)});function Gye(){const e=Yt(ga),t=Yt(ef);return r=>e.runOutsideAngular(()=>t.handleError(r))}let zye=(()=>{class e{constructor(){this.zone=Yt(ga),this.applicationRef=Yt(Jg)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function r7(e){return[{provide:ga,useFactory:e},{provide:vg,multi:!0,useFactory:()=>{const t=Yt(zye,{optional:!0});return()=>t.initialize()}},{provide:t7,useFactory:Gye},{provide:SV,useFactory:CV}]}function Hye(e){return HI([[],r7(()=>new ga(function QH(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}(e)))])}let mM=null;function t0(){return mM}class gbe{}const ol=new sr("DocumentToken");let A7=(()=>{class e{historyGo(r){throw new Error("Not implemented")}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>Yt(ybe),providedIn:"platform"})}return e})(),ybe=(()=>{class e extends A7{constructor(){super(),this._doc=Yt(ol),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return t0().getBaseHref(this._doc)}onPopState(r){const n=t0().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",r,!1),()=>n.removeEventListener("popstate",r)}onHashChange(r){const n=t0().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",r,!1),()=>n.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,n,a){this._history.pushState(r,n,a)}replaceState(r,n,a){this._history.replaceState(r,n,a)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function T7(e,t){if(0==e.length)return t;if(0==t.length)return e;let r=0;return e.endsWith("/")&&r++,t.startsWith("/")&&r++,2==r?e+t.substring(1):1==r?e+t:e+"/"+t}function D7(e){const t=e.match(/#|\?|$/),r=t&&t.index||e.length;return e.slice(0,r-("/"===e[r-1]?1:0))+e.slice(r)}function yh(e){return e&&"?"!==e[0]?"?"+e:e}let y_=(()=>{class e{historyGo(r){throw new Error("Not implemented")}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>Yt(Sbe),providedIn:"root"})}return e})();const bbe=new sr("appBaseHref");let Sbe=(()=>{class e extends y_{constructor(r,n){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??Yt(ol).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return T7(this._baseHref,r)}path(r=!1){const n=this._platformLocation.pathname+yh(this._platformLocation.search),a=this._platformLocation.hash;return a&&r?`${n}${a}`:n}pushState(r,n,a,i){const o=this.prepareExternalUrl(a+yh(i));this._platformLocation.pushState(r,n,o)}replaceState(r,n,a,i){const o=this.prepareExternalUrl(a+yh(i));this._platformLocation.replaceState(r,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}static#e=this.\u0275fac=function(n){return new(n||e)(an(A7),an(bbe,8))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),l1=(()=>{class e{constructor(r){this._subject=new Uo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;const n=this._locationStrategy.getBaseHref();this._basePath=function _be(e){if(new RegExp("^(https?:)?//").test(e)){const[,r]=e.split(/\/\/[^\/]+/);return r}return e}(D7(E7(n))),this._locationStrategy.onPopState(a=>{this._subject.emit({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,n=""){return this.path()==this.normalize(r+yh(n))}normalize(r){return e.stripTrailingSlash(function xbe(e,t){if(!e||!t.startsWith(e))return t;const r=t.substring(e.length);return""===r||["/",";","?","#"].includes(r[0])?r:t}(this._basePath,E7(r)))}prepareExternalUrl(r){return r&&"/"!==r[0]&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,n="",a=null){this._locationStrategy.pushState(a,"",r,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+yh(n)),a)}replaceState(r,n="",a=null){this._locationStrategy.replaceState(a,"",r,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+yh(n)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)})),()=>{const n=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(n,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",n){this._urlChangeListeners.forEach(a=>a(r,n))}subscribe(r,n,a){return this._subject.subscribe({next:r,error:n,complete:a})}static#e=this.normalizeQueryParams=yh;static#t=this.joinWithSlash=T7;static#r=this.stripTrailingSlash=D7;static#n=this.\u0275fac=function(n){return new(n||e)(an(y_))};static#a=this.\u0275prov=Ar({token:e,factory:()=>function Cbe(){return new l1(an(y_))}(),providedIn:"root"})}return e})();function E7(e){return e.replace(/\/index.html$/,"")}let U1e=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=lI({type:e});static#r=this.\u0275inj=IC({})}return e})();function j7(e){return"server"===e}class pSe extends gbe{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class MM extends pSe{static makeCurrent(){!function vbe(e){mM||(mM=e)}(new MM)}onAndCancel(t,r,n){return t.addEventListener(r,n),()=>{t.removeEventListener(r,n)}}dispatchEvent(t,r){t.dispatchEvent(r)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,r){return(r=r||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,r){return"window"===r?window:"document"===r?t:"body"===r?t.body:null}getBaseHref(t){const r=function mSe(){return m1=m1||document.querySelector("base"),m1?m1.getAttribute("href"):null}();return null==r?null:function hSe(e){return new URL(e,"http://a").pathname}(r)}resetBaseElement(){m1=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function s1e(e,t){t=encodeURIComponent(t);for(const r of e.split(";")){const n=r.indexOf("="),[a,i]=-1==n?[r,""]:[r.slice(0,n),r.slice(n+1)];if(a.trim()===t)return decodeURIComponent(i)}return null}(document.cookie,t)}}let m1=null,gSe=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac})}return e})();const RM=new sr("EventManagerPlugins");let X7=(()=>{class e{constructor(r,n){this._zone=n,this._eventNameToPlugin=new Map,r.forEach(a=>{a.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,n,a){return this._findPluginFor(n).addEventListener(r,n,a)}getZone(){return this._zone}_findPluginFor(r){let n=this._eventNameToPlugin.get(r);if(n)return n;if(n=this._plugins.find(i=>i.supports(r)),!n)throw new Ot(5101,!1);return this._eventNameToPlugin.set(r,n),n}static#e=this.\u0275fac=function(n){return new(n||e)(an(RM),an(ga))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac})}return e})();class K7{constructor(t){this._doc=t}}const OM="ng-app-id";let Z7=(()=>{class e{constructor(r,n,a,i={}){this.doc=r,this.appId=n,this.nonce=a,this.platformId=i,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=j7(i),this.resetHostNodes()}addStyles(r){for(const n of r)1===this.changeUsageCount(n,1)&&this.onStyleAdded(n)}removeStyles(r){for(const n of r)this.changeUsageCount(n,-1)<=0&&this.onStyleRemoved(n)}ngOnDestroy(){const r=this.styleNodesInDOM;r&&(r.forEach(n=>n.remove()),r.clear());for(const n of this.getAllStyles())this.onStyleRemoved(n);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(const n of this.getAllStyles())this.addStyleToHost(r,n)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(const n of this.hostNodes)this.addStyleToHost(n,r)}onStyleRemoved(r){const n=this.styleRef;n.get(r)?.elements?.forEach(a=>a.remove()),n.delete(r)}collectServerRenderedStyles(){const r=this.doc.head?.querySelectorAll(`style[${OM}="${this.appId}"]`);if(r?.length){const n=new Map;return r.forEach(a=>{null!=a.textContent&&n.set(a.textContent,a)}),n}return null}changeUsageCount(r,n){const a=this.styleRef;if(a.has(r)){const i=a.get(r);return i.usage+=n,i.usage}return a.set(r,{usage:n,elements:[]}),n}getStyleElement(r,n){const a=this.styleNodesInDOM,i=a?.get(n);if(i?.parentNode===r)return a.delete(n),i.removeAttribute(OM),i;{const o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=n,this.platformIsServer&&o.setAttribute(OM,this.appId),r.appendChild(o),o}}addStyleToHost(r,n){const a=this.getStyleElement(r,n),i=this.styleRef,o=i.get(n)?.elements;o?o.push(a):i.set(n,{elements:[a],usage:1})}resetHostNodes(){const r=this.hostNodes;r.clear(),r.add(this.doc.head)}static#e=this.\u0275fac=function(n){return new(n||e)(an(ol),an(JI),an(N6,8),an(Sg))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac})}return e})();const FM={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},BM=/%COMP%/g,CSe=new sr("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!0});function $7(e,t){return t.map(r=>r.replace(BM,e))}let J7=(()=>{class e{constructor(r,n,a,i,o,s,u,c=null){this.eventManager=r,this.sharedStylesHost=n,this.appId=a,this.removeStylesOnCompDestroy=i,this.doc=o,this.platformId=s,this.ngZone=u,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=j7(s),this.defaultRenderer=new NM(r,o,u,this.platformIsServer)}createRenderer(r,n){if(!r||!n)return this.defaultRenderer;this.platformIsServer&&n.encapsulation===$c.ShadowDom&&(n={...n,encapsulation:$c.Emulated});const a=this.getOrCreateRenderer(r,n);return a instanceof t9?a.applyToHost(r):a instanceof kM&&a.applyStyles(),a}getOrCreateRenderer(r,n){const a=this.rendererByCompId;let i=a.get(n.id);if(!i){const o=this.doc,s=this.ngZone,u=this.eventManager,c=this.sharedStylesHost,l=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(n.encapsulation){case $c.Emulated:i=new t9(u,c,n,this.appId,l,o,s,d);break;case $c.ShadowDom:return new ASe(u,c,r,n,o,s,this.nonce,d);default:i=new kM(u,c,n,l,o,s,d)}a.set(n.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(n){return new(n||e)(an(X7),an(Z7),an(JI),an(CSe),an(ol),an(Sg),an(ga),an(N6))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac})}return e})();class NM{constructor(t,r,n,a){this.eventManager=t,this.doc=r,this.ngZone=n,this.platformIsServer=a,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,r){return r?this.doc.createElementNS(FM[r]||r,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,r){(e9(t)?t.content:t).appendChild(r)}insertBefore(t,r,n){t&&(e9(t)?t.content:t).insertBefore(r,n)}removeChild(t,r){t&&t.removeChild(r)}selectRootElement(t,r){let n="string"==typeof t?this.doc.querySelector(t):t;if(!n)throw new Ot(-5104,!1);return r||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,r,n,a){if(a){r=a+":"+r;const i=FM[a];i?t.setAttributeNS(i,r,n):t.setAttribute(r,n)}else t.setAttribute(r,n)}removeAttribute(t,r,n){if(n){const a=FM[n];a?t.removeAttributeNS(a,r):t.removeAttribute(`${n}:${r}`)}else t.removeAttribute(r)}addClass(t,r){t.classList.add(r)}removeClass(t,r){t.classList.remove(r)}setStyle(t,r,n,a){a&(Fp.DashCase|Fp.Important)?t.style.setProperty(r,n,a&Fp.Important?"important":""):t.style[r]=n}removeStyle(t,r,n){n&Fp.DashCase?t.style.removeProperty(r):t.style[r]=""}setProperty(t,r,n){null!=t&&(t[r]=n)}setValue(t,r){t.nodeValue=r}listen(t,r,n){if("string"==typeof t&&!(t=t0().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${r}`);return this.eventManager.addEventListener(t,r,this.decoratePreventDefault(n))}decoratePreventDefault(t){return r=>{if("__ngUnwrap__"===r)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(r)):t(r))&&r.preventDefault()}}}function e9(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class ASe extends NM{constructor(t,r,n,a,i,o,s,u){super(t,i,o,u),this.sharedStylesHost=r,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=$7(a.id,a.styles);for(const l of c){const d=document.createElement("style");s&&d.setAttribute("nonce",s),d.textContent=l,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,r){return super.appendChild(this.nodeOrShadowRoot(t),r)}insertBefore(t,r,n){return super.insertBefore(this.nodeOrShadowRoot(t),r,n)}removeChild(t,r){return super.removeChild(this.nodeOrShadowRoot(t),r)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class kM extends NM{constructor(t,r,n,a,i,o,s,u){super(t,i,o,s),this.sharedStylesHost=r,this.removeStylesOnCompDestroy=a,this.styles=u?$7(u,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class t9 extends kM{constructor(t,r,n,a,i,o,s,u){const c=a+"-"+n.id;super(t,r,n,i,o,s,u,c),this.contentAttr=function xSe(e){return"_ngcontent-%COMP%".replace(BM,e)}(c),this.hostAttr=function _Se(e){return"_nghost-%COMP%".replace(BM,e)}(c)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,r){const n=super.createElement(t,r);return super.setAttribute(n,this.contentAttr,""),n}}let TSe=(()=>{class e extends K7{constructor(r){super(r)}supports(r){return!0}addEventListener(r,n,a){return r.addEventListener(n,a,!1),()=>this.removeEventListener(r,n,a)}removeEventListener(r,n,a){return r.removeEventListener(n,a)}static#e=this.\u0275fac=function(n){return new(n||e)(an(ol))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac})}return e})();const r9=["alt","control","meta","shift"],DSe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ESe={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let ISe=(()=>{class e extends K7{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,n,a){const i=e.parseEventName(n),o=e.eventCallback(i.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>t0().onAndCancel(r,i.domEventName,o))}static parseEventName(r){const n=r.toLowerCase().split("."),a=n.shift();if(0===n.length||"keydown"!==a&&"keyup"!==a)return null;const i=e._normalizeKey(n.pop());let o="",s=n.indexOf("code");if(s>-1&&(n.splice(s,1),o="code."),r9.forEach(c=>{const l=n.indexOf(c);l>-1&&(n.splice(l,1),o+=c+".")}),o+=i,0!=n.length||0===i.length)return null;const u={};return u.domEventName=a,u.fullKey=o,u}static matchEventFullKeyCode(r,n){let a=DSe[r.key]||r.key,i="";return n.indexOf("code.")>-1&&(a=r.code,i="code."),!(null==a||!a)&&(a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),r9.forEach(o=>{o!==a&&(0,ESe[o])(r)&&(i+=o+".")}),i+=a,i===n)}static eventCallback(r,n,a){return i=>{e.matchEventFullKeyCode(i,r)&&a.runGuarded(()=>n(i))}}static _normalizeKey(r){return"esc"===r?"escape":r}static#e=this.\u0275fac=function(n){return new(n||e)(an(ol))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac})}return e})();function n9(e){return{appProviders:[...NSe,...e?.providers??[]],platformProviders:FSe}}const FSe=[{provide:Sg,useValue:"browser"},{provide:B6,useValue:function MSe(){MM.makeCurrent()},multi:!0},{provide:ol,useFactory:function OSe(){return function pde(e){$I=e}(document),document},deps:[]}],NSe=[{provide:WI,useValue:"root"},{provide:ef,useFactory:function RSe(){return new ef},deps:[]},{provide:RM,useClass:TSe,multi:!0,deps:[ol,ga,Sg]},{provide:RM,useClass:ISe,multi:!0,deps:[ol]},J7,Z7,X7,{provide:B8,useExisting:J7},{provide:class j1e{},useClass:gSe,deps:[]},[]];let a9=(()=>{class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}static#e=this.\u0275fac=function(n){return new(n||e)(an(ol))};static#t=this.\u0275prov=Ar({token:e,factory:function(n){let a=null;return a=n?new n:function LSe(){return new a9(an(ol))}(),a},providedIn:"root"})}return e})();typeof window<"u"&&window;const M_=BE(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:jSe}=Array,{getPrototypeOf:qSe,prototype:WSe,keys:YSe}=Object;const{isArray:ZSe}=Array;function u9(e){return $n(t=>function QSe(e,t){return ZSe(t)?e(...t):e(t)}(e,t))}function c9(...e){const t=nb(e),r=aU(e),{args:n,keys:a}=function XSe(e){if(1===e.length){const t=e[0];if(jSe(t))return{args:t,keys:null};if(function KSe(e){return e&&"object"==typeof e&&qSe(e)===WSe}(t)){const r=YSe(t);return{args:r.map(n=>t[n]),keys:r}}}return{args:e,keys:null}}(e);if(0===n.length)return So([],t);const i=new zi(l9(n,t,a?o=>function $Se(e,t){return e.reduce((r,n,a)=>(r[n]=t[a],r),{})}(a,o):_p));return r?i.pipe(u9(r)):i}function l9(e,t,r=_p){return n=>{d9(t,()=>{const{length:a}=e,i=new Array(a);let o=a,s=a;for(let u=0;u<a;u++)d9(t,()=>{const c=So(e[u],t);let l=!1;c.subscribe(fi(n,d=>{i[u]=d,l||(l=!0,s--),s||n.next(r(i.slice()))},()=>{--o||n.complete()}))},n)},n)}}function d9(e,t,r){e?Xd(r,e,t):t()}function UM(...e){return function JSe(){return TC(1)}()(So(e,nb(e)))}function f9(e){return new zi(t=>{_u(e()).subscribe(t)})}function R_(e,t){const r=Fa(e)?e:()=>e,n=a=>a.error(r());return new zi(t?a=>t.schedule(n,0,a):n)}function VM(){return di((e,t)=>{let r=null;e._refCount++;const n=fi(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(r=null);const a=e._connection,i=r;r=null,a&&(!i||a===i)&&a.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(r=e.connect())})}class p9 extends zi{constructor(t,r){super(),this.source=t,this.subjectFactory=r,this._subject=null,this._refCount=0,this._connection=null,H5(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Xs;const r=this.getSubject();t.add(this.source.subscribe(fi(r,void 0,()=>{this._teardown(),r.complete()},n=>{this._teardown(),r.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Xs.EMPTY)}return t}refCount(){return VM()(this)}}function bh(e){return e<=0?()=>kl:di((t,r)=>{let n=0;t.subscribe(fi(r,a=>{++n<=e&&(r.next(a),e<=n&&r.complete())}))})}function uf(e,t){return di((r,n)=>{let a=0;r.subscribe(fi(n,i=>e.call(t,i,a++)&&n.next(i)))})}function O_(e){return di((t,r)=>{let n=!1;t.subscribe(fi(r,a=>{n=!0,r.next(a)},()=>{n||r.next(e),r.complete()}))})}function m9(e=t2e){return di((t,r)=>{let n=!1;t.subscribe(fi(r,a=>{n=!0,r.next(a)},()=>n?r.complete():r.error(e())))})}function t2e(){return new M_}function Sh(e,t){const r=arguments.length>=2;return n=>n.pipe(e?uf((a,i)=>e(a,i,n)):_p,bh(1),r?O_(t):m9(()=>new M_))}function F_(e,t){return Fa(t)?bs(e,t,1):bs(e,1)}function $o(e,t,r){const n=Fa(e)||t||r?{next:e,error:t,complete:r}:e;return n?di((a,i)=>{var o;null===(o=n.subscribe)||void 0===o||o.call(n);let s=!0;a.subscribe(fi(i,u=>{var c;null===(c=n.next)||void 0===c||c.call(n,u),i.next(u)},()=>{var u;s=!1,null===(u=n.complete)||void 0===u||u.call(n),i.complete()},u=>{var c;s=!1,null===(c=n.error)||void 0===c||c.call(n,u),i.error(u)},()=>{var u,c;s&&(null===(u=n.unsubscribe)||void 0===u||u.call(n)),null===(c=n.finalize)||void 0===c||c.call(n)}))}):_p}function n0(e){return di((t,r)=>{let i,n=null,a=!1;n=t.subscribe(fi(r,void 0,void 0,o=>{i=_u(e(o,n0(e)(t))),n?(n.unsubscribe(),n=null,i.subscribe(r)):a=!0})),a&&(n.unsubscribe(),n=null,i.subscribe(r))})}function GM(e){return e<=0?()=>kl:di((t,r)=>{let n=[];t.subscribe(fi(r,a=>{n.push(a),e<n.length&&n.shift()},()=>{for(const a of n)r.next(a);r.complete()},void 0,()=>{n=null}))})}function zM(e){return di((t,r)=>{try{t.subscribe(r)}finally{r.add(e)}})}const en="primary",h1=Symbol("RouteTitle");class s2e{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const r=this.params[t];return Array.isArray(r)?r[0]:r}return null}getAll(t){if(this.has(t)){const r=this.params[t];return Array.isArray(r)?r:[r]}return[]}get keys(){return Object.keys(this.params)}}function a0(e){return new s2e(e)}function u2e(e,t,r){const n=r.path.split("/");if(n.length>e.length||"full"===r.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const a={};for(let i=0;i<n.length;i++){const o=n[i],s=e[i];if(o.startsWith(":"))a[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,n.length),posParams:a}}function $l(e,t){const r=e?HM(e):void 0,n=t?HM(t):void 0;if(!r||!n||r.length!=n.length)return!1;let a;for(let i=0;i<r.length;i++)if(a=r[i],!h9(e[a],t[a]))return!1;return!0}function HM(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function h9(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const r=[...e].sort(),n=[...t].sort();return r.every((a,i)=>n[i]===a)}return e===t}function v9(e){return e.length>0?e[e.length-1]:null}function Gp(e){return function HSe(e){return!!e&&(e instanceof zi||Fa(e.lift)&&Fa(e.subscribe))}(e)?e:e_(e)?So(Promise.resolve(e)):Hr(e)}const l2e={exact:function b9(e,t,r){if(!Ch(e.segments,t.segments)||!B_(e.segments,t.segments,r)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!b9(e.children[n],t.children[n],r))return!1;return!0},subset:S9},g9={exact:function d2e(e,t){return $l(e,t)},subset:function f2e(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(r=>h9(e[r],t[r]))},ignored:()=>!0};function y9(e,t,r){return l2e[r.paths](e.root,t.root,r.matrixParams)&&g9[r.queryParams](e.queryParams,t.queryParams)&&!("exact"===r.fragment&&e.fragment!==t.fragment)}function S9(e,t,r){return C9(e,t,t.segments,r)}function C9(e,t,r,n){if(e.segments.length>r.length){const a=e.segments.slice(0,r.length);return!(!Ch(a,r)||t.hasChildren()||!B_(a,r,n))}if(e.segments.length===r.length){if(!Ch(e.segments,r)||!B_(e.segments,r,n))return!1;for(const a in t.children)if(!e.children[a]||!S9(e.children[a],t.children[a],n))return!1;return!0}{const a=r.slice(0,e.segments.length),i=r.slice(e.segments.length);return!!(Ch(e.segments,a)&&B_(e.segments,a,n)&&e.children[en])&&C9(e.children[en],t,i,n)}}function B_(e,t,r){return t.every((n,a)=>g9[r](e[a].parameters,n.parameters))}class o0{constructor(t=new da([],{}),r={},n=null){this.root=t,this.queryParams=r,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=a0(this.queryParams)),this._queryParamMap}toString(){return h2e.serialize(this)}}class da{constructor(t,r){this.segments=t,this.children=r,this.parent=null,Object.values(r).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return N_(this)}}class v1{constructor(t,r){this.path=t,this.parameters=r}get parameterMap(){return this._parameterMap||(this._parameterMap=a0(this.parameters)),this._parameterMap}toString(){return w9(this)}}function Ch(e,t){return e.length===t.length&&e.every((r,n)=>r.path===t[n].path)}let s0=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>new jM,providedIn:"root"})}return e})();class jM{parse(t){const r=new T2e(t);return new o0(r.parseRootSegment(),r.parseQueryParams(),r.parseFragment())}serialize(t){const r=`/${g1(t.root,!0)}`,n=function y2e(e){const t=Object.keys(e).map(r=>{const n=e[r];return Array.isArray(n)?n.map(a=>`${k_(r)}=${k_(a)}`).join("&"):`${k_(r)}=${k_(n)}`}).filter(r=>!!r);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${r}${n}${"string"==typeof t.fragment?`#${function v2e(e){return encodeURI(e)}(t.fragment)}`:""}`}}const h2e=new jM;function N_(e){return e.segments.map(t=>w9(t)).join("/")}function g1(e,t){if(!e.hasChildren())return N_(e);if(t){const r=e.children[en]?g1(e.children[en],!1):"",n=[];return Object.entries(e.children).forEach(([a,i])=>{a!==en&&n.push(`${a}:${g1(i,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=function m2e(e,t){let r=[];return Object.entries(e.children).forEach(([n,a])=>{n===en&&(r=r.concat(t(a,n)))}),Object.entries(e.children).forEach(([n,a])=>{n!==en&&(r=r.concat(t(a,n)))}),r}(e,(n,a)=>a===en?[g1(e.children[en],!1)]:[`${a}:${g1(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[en]?`${N_(e)}/${r[0]}`:`${N_(e)}/(${r.join("//")})`}}function x9(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function k_(e){return x9(e).replace(/%3B/gi,";")}function qM(e){return x9(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function L_(e){return decodeURIComponent(e)}function _9(e){return L_(e.replace(/\+/g,"%20"))}function w9(e){return`${qM(e.path)}${function g2e(e){return Object.keys(e).map(t=>`;${qM(t)}=${qM(e[t])}`).join("")}(e.parameters)}`}const b2e=/^[^\/()?;#]+/;function WM(e){const t=e.match(b2e);return t?t[0]:""}const S2e=/^[^\/()?;=#]+/,x2e=/^[^=?&#]+/,w2e=/^[^&#]+/;class T2e{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new da([],{}):new da([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let r={};this.peekStartsWith("/(")&&(this.capture("/"),r=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(r).length>0)&&(n[en]=new da(t,r)),n}parseSegment(){const t=WM(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Ot(4009,!1);return this.capture(t),new v1(L_(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const r=function C2e(e){const t=e.match(S2e);return t?t[0]:""}(this.remaining);if(!r)return;this.capture(r);let n="";if(this.consumeOptional("=")){const a=WM(this.remaining);a&&(n=a,this.capture(n))}t[L_(r)]=L_(n)}parseQueryParam(t){const r=function _2e(e){const t=e.match(x2e);return t?t[0]:""}(this.remaining);if(!r)return;this.capture(r);let n="";if(this.consumeOptional("=")){const o=function A2e(e){const t=e.match(w2e);return t?t[0]:""}(this.remaining);o&&(n=o,this.capture(n))}const a=_9(r),i=_9(n);if(t.hasOwnProperty(a)){let o=t[a];Array.isArray(o)||(o=[o],t[a]=o),o.push(i)}else t[a]=i}parseParens(t){const r={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=WM(this.remaining),a=this.remaining[n.length];if("/"!==a&&")"!==a&&";"!==a)throw new Ot(4010,!1);let i;n.indexOf(":")>-1?(i=n.slice(0,n.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=en);const o=this.parseChildren();r[i]=1===Object.keys(o).length?o[en]:new da([],o),this.consumeOptional("//")}return r}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Ot(4011,!1)}}function A9(e){return e.segments.length>0?new da([],{[en]:e}):e}function T9(e){const t={};for(const n of Object.keys(e.children)){const i=T9(e.children[n]);if(n===en&&0===i.segments.length&&i.hasChildren())for(const[o,s]of Object.entries(i.children))t[o]=s;else(i.segments.length>0||i.hasChildren())&&(t[n]=i)}return function D2e(e){if(1===e.numberOfChildren&&e.children[en]){const t=e.children[en];return new da(e.segments.concat(t.segments),t.children)}return e}(new da(e.segments,t))}function xh(e){return e instanceof o0}function D9(e){let t;const n=function r(i){const o={};for(const u of i.children){const c=r(u);o[u.outlet]=c}const s=new da(i.url,o);return i===e&&(t=s),s}(e.root),a=A9(n);return t??a}function E9(e,t,r,n){let a=e;for(;a.parent;)a=a.parent;if(0===t.length)return YM(a,a,a,r,n);const i=function I2e(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new P9(!0,0,e);let t=0,r=!1;const n=e.reduce((a,i,o)=>{if("object"==typeof i&&null!=i){if(i.outlets){const s={};return Object.entries(i.outlets).forEach(([u,c])=>{s[u]="string"==typeof c?c.split("/"):c}),[...a,{outlets:s}]}if(i.segmentPath)return[...a,i.segmentPath]}return"string"!=typeof i?[...a,i]:0===o?(i.split("/").forEach((s,u)=>{0==u&&"."===s||(0==u&&""===s?r=!0:".."===s?t++:""!=s&&a.push(s))}),a):[...a,i]},[]);return new P9(r,t,n)}(t);if(i.toRoot())return YM(a,a,new da([],{}),r,n);const o=function P2e(e,t,r){if(e.isAbsolute)return new V_(t,!0,0);if(!r)return new V_(t,!1,NaN);if(null===r.parent)return new V_(r,!0,0);const n=U_(e.commands[0])?0:1;return function M2e(e,t,r){let n=e,a=t,i=r;for(;i>a;){if(i-=a,n=n.parent,!n)throw new Ot(4005,!1);a=n.segments.length}return new V_(n,!1,a-i)}(r,r.segments.length-1+n,e.numberOfDoubleDots)}(i,a,e),s=o.processChildren?b1(o.segmentGroup,o.index,i.commands):M9(o.segmentGroup,o.index,i.commands);return YM(a,o.segmentGroup,s,r,n)}function U_(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function y1(e){return"object"==typeof e&&null!=e&&e.outlets}function YM(e,t,r,n,a){let o,i={};n&&Object.entries(n).forEach(([u,c])=>{i[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`}),o=e===t?r:I9(e,t,r);const s=A9(T9(o));return new o0(s,i,a)}function I9(e,t,r){const n={};return Object.entries(e.children).forEach(([a,i])=>{n[a]=i===t?r:I9(i,t,r)}),new da(e.segments,n)}class P9{constructor(t,r,n){if(this.isAbsolute=t,this.numberOfDoubleDots=r,this.commands=n,t&&n.length>0&&U_(n[0]))throw new Ot(4003,!1);const a=n.find(y1);if(a&&a!==v9(n))throw new Ot(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class V_{constructor(t,r,n){this.segmentGroup=t,this.processChildren=r,this.index=n}}function M9(e,t,r){if(e||(e=new da([],{})),0===e.segments.length&&e.hasChildren())return b1(e,t,r);const n=function O2e(e,t,r){let n=0,a=t;const i={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(n>=r.length)return i;const o=e.segments[a],s=r[n];if(y1(s))break;const u=`${s}`,c=n<r.length-1?r[n+1]:null;if(a>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!O9(u,c,o))return i;n+=2}else{if(!O9(u,{},o))return i;n++}a++}return{match:!0,pathIndex:a,commandIndex:n}}(e,t,r),a=r.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const i=new da(e.segments.slice(0,n.pathIndex),{});return i.children[en]=new da(e.segments.slice(n.pathIndex),e.children),b1(i,0,a)}return n.match&&0===a.length?new da(e.segments,{}):n.match&&!e.hasChildren()?XM(e,t,r):n.match?b1(e,0,a):XM(e,t,r)}function b1(e,t,r){if(0===r.length)return new da(e.segments,{});{const n=function R2e(e){return y1(e[0])?e[0].outlets:{[en]:e}}(r),a={};if(Object.keys(n).some(i=>i!==en)&&e.children[en]&&1===e.numberOfChildren&&0===e.children[en].segments.length){const i=b1(e.children[en],t,r);return new da(e.segments,i.children)}return Object.entries(n).forEach(([i,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(a[i]=M9(e.children[i],t,o))}),Object.entries(e.children).forEach(([i,o])=>{void 0===n[i]&&(a[i]=o)}),new da(e.segments,a)}}function XM(e,t,r){const n=e.segments.slice(0,t);let a=0;for(;a<r.length;){const i=r[a];if(y1(i)){const u=F2e(i.outlets);return new da(n,u)}if(0===a&&U_(r[0])){n.push(new v1(e.segments[t].path,R9(r[0]))),a++;continue}const o=y1(i)?i.outlets[en]:`${i}`,s=a<r.length-1?r[a+1]:null;o&&s&&U_(s)?(n.push(new v1(o,R9(s))),a+=2):(n.push(new v1(o,{})),a++)}return new da(n,{})}function F2e(e){const t={};return Object.entries(e).forEach(([r,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=XM(new da([],{}),0,n))}),t}function R9(e){const t={};return Object.entries(e).forEach(([r,n])=>t[r]=`${n}`),t}function O9(e,t,r){return e==r.path&&$l(t,r.parameters)}const S1="imperative";class Jl{constructor(t,r){this.id=t,this.url=r}}class KM extends Jl{constructor(t,r,n="imperative",a=null){super(t,r),this.type=0,this.navigationTrigger=n,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class _h extends Jl{constructor(t,r,n){super(t,r),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class u0 extends Jl{constructor(t,r,n,a){super(t,r),this.reason=n,this.code=a,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class C1 extends Jl{constructor(t,r,n,a){super(t,r),this.reason=n,this.code=a,this.type=16}}class G_ extends Jl{constructor(t,r,n,a){super(t,r),this.error=n,this.target=a,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class F9 extends Jl{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class B2e extends Jl{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class N2e extends Jl{constructor(t,r,n,a,i){super(t,r),this.urlAfterRedirects=n,this.state=a,this.shouldActivate=i,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class k2e extends Jl{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class L2e extends Jl{constructor(t,r,n,a){super(t,r),this.urlAfterRedirects=n,this.state=a,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class U2e{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class V2e{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class G2e{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class z2e{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class H2e{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class j2e{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZM{}class QM{constructor(t){this.url=t}}class q2e{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new x1,this.attachRef=null}}let x1=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,n){const a=this.getOrCreateContext(r);a.outlet=n,this.contexts.set(r,a)}onChildOutletDestroyed(r){const n=this.getContext(r);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let n=this.getContext(r);return n||(n=new q2e,this.contexts.set(r,n)),n}getContext(r){return this.contexts.get(r)||null}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class B9{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const r=this.pathFromRoot(t);return r.length>1?r[r.length-2]:null}children(t){const r=$M(t,this._root);return r?r.children.map(n=>n.value):[]}firstChild(t){const r=$M(t,this._root);return r&&r.children.length>0?r.children[0].value:null}siblings(t){const r=JM(t,this._root);return r.length<2?[]:r[r.length-2].children.map(a=>a.value).filter(a=>a!==t)}pathFromRoot(t){return JM(t,this._root).map(r=>r.value)}}function $M(e,t){if(e===t.value)return t;for(const r of t.children){const n=$M(e,r);if(n)return n}return null}function JM(e,t){if(e===t.value)return[t];for(const r of t.children){const n=JM(e,r);if(n.length)return n.unshift(t),n}return[]}class cl{constructor(t,r){this.value=t,this.children=r}toString(){return`TreeNode(${this.value})`}}function c0(e){const t={};return e&&e.children.forEach(r=>t[r.value.outlet]=r),t}class N9 extends B9{constructor(t,r){super(t),this.snapshot=r,rR(this,t)}toString(){return this.snapshot.toString()}}function k9(e,t){const r=function W2e(e,t){const o=new tR([],{},{},"",{},en,t,null,{});return new L9("",new cl(o,[]))}(0,t),n=new Ai([new v1("",{})]),a=new Ai({}),i=new Ai({}),o=new Ai({}),s=new Ai(""),u=new l0(n,a,o,s,i,en,t,r.root);return u.snapshot=r.root,new N9(new cl(u,[]),r)}class l0{constructor(t,r,n,a,i,o,s,u){this.urlSubject=t,this.paramsSubject=r,this.queryParamsSubject=n,this.fragmentSubject=a,this.dataSubject=i,this.outlet=o,this.component=s,this._futureSnapshot=u,this.title=this.dataSubject?.pipe($n(c=>c[h1]))??Hr(void 0),this.url=t,this.params=r,this.queryParams=n,this.fragment=a,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe($n(t=>a0(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe($n(t=>a0(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function eR(e,t,r="emptyOnly"){let n;const{routeConfig:a}=e;return n=null===t||"always"!==r&&""!==a?.path&&(t.component||t.routeConfig?.loadComponent)?{params:e.params,data:e.data,resolve:{...e.data,...e._resolvedData??{}}}:{params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.data,...a?.data,...e._resolvedData}},a&&V9(a)&&(n.resolve[h1]=a.title),n}class tR{get title(){return this.data?.[h1]}constructor(t,r,n,a,i,o,s,u,c){this.url=t,this.params=r,this.queryParams=n,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=a0(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=a0(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class L9 extends B9{constructor(t,r){super(r),this.url=t,rR(this,r)}toString(){return U9(this._root)}}function rR(e,t){t.value._routerState=e,t.children.forEach(r=>rR(e,r))}function U9(e){const t=e.children.length>0?` { ${e.children.map(U9).join(", ")} } `:"";return`${e.value}${t}`}function nR(e){if(e.snapshot){const t=e.snapshot,r=e._futureSnapshot;e.snapshot=r,$l(t.queryParams,r.queryParams)||e.queryParamsSubject.next(r.queryParams),t.fragment!==r.fragment&&e.fragmentSubject.next(r.fragment),$l(t.params,r.params)||e.paramsSubject.next(r.params),function c2e(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!$l(e[r],t[r]))return!1;return!0}(t.url,r.url)||e.urlSubject.next(r.url),$l(t.data,r.data)||e.dataSubject.next(r.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function aR(e,t){const r=$l(e.params,t.params)&&function p2e(e,t){return Ch(e,t)&&e.every((r,n)=>$l(r.parameters,t[n].parameters))}(e.url,t.url);return r&&!(!e.parent!=!t.parent)&&(!e.parent||aR(e.parent,t.parent))}function V9(e){return"string"==typeof e.title||null===e.title}let G9=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=en,this.activateEvents=new Uo,this.deactivateEvents=new Uo,this.attachEvents=new Uo,this.detachEvents=new Uo,this.parentContexts=Yt(x1),this.location=Yt(il),this.changeDetector=Yt(Fx),this.environmentInjector=Yt(rl),this.inputBinder=Yt(z_,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){const{firstChange:n,previousValue:a}=r.name;if(n)return;this.isTrackedInParentContexts(a)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(a)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ot(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ot(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ot(4012,!1);this.location.detach();const r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,n){this.activated=r,this._activatedRoute=n,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){const r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,n){if(this.isActivated)throw new Ot(4013,!1);this._activatedRoute=r;const a=this.location,o=r.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new Y2e(r,s,a.injector);this.activated=a.createComponent(o,{index:a.length,injector:u,environmentInjector:n??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275dir=Ss({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ih]})}return e})();class Y2e{constructor(t,r,n){this.route=t,this.childContexts=r,this.parent=n}get(t,r){return t===l0?this.route:t===x1?this.childContexts:this.parent.get(t,r)}}const z_=new sr("");function _1(e,t,r){if(r&&e.shouldReuseRoute(t.value,r.value.snapshot)){const n=r.value;n._futureSnapshot=t.value;const a=function K2e(e,t,r){return t.children.map(n=>{for(const a of r.children)if(e.shouldReuseRoute(n.value,a.value.snapshot))return _1(e,n,a);return _1(e,n)})}(e,t,r);return new cl(n,a)}{if(e.shouldAttach(t.value)){const i=e.retrieve(t.value);if(null!==i){const o=i.route;return o.value._futureSnapshot=t.value,o.children=t.children.map(s=>_1(e,s)),o}}const n=function Z2e(e){return new l0(new Ai(e.url),new Ai(e.params),new Ai(e.queryParams),new Ai(e.fragment),new Ai(e.data),e.outlet,e.component,e)}(t.value),a=t.children.map(i=>_1(e,i));return new cl(n,a)}}const iR="ngNavigationCancelingError";function H9(e,t){const{redirectTo:r,navigationBehaviorOptions:n}=xh(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,a=j9(!1,0,t);return a.url=r,a.navigationBehaviorOptions=n,a}function j9(e,t,r){const n=new Error("NavigationCancelingError: "+(e||""));return n[iR]=!0,n.cancellationCode=t,r&&(n.url=r),n}function q9(e){return e&&e[iR]}let W9=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=NC({type:e,selectors:[["ng-component"]],standalone:!0,features:[t_],decls:1,vars:0,template:function(n,a){1&n&&$b(0,"router-outlet")},dependencies:[G9],encapsulation:2})}return e})();function oR(e){const t=e.children&&e.children.map(oR),r=t?{...e,children:t}:{...e};return!r.component&&!r.loadComponent&&(t||r.loadChildren)&&r.outlet&&r.outlet!==en&&(r.component=W9),r}function ed(e){return e.outlet||en}function w1(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const r=t.routeConfig;if(r?._loadedInjector)return r._loadedInjector;if(r?._injector)return r._injector}return null}class aCe{constructor(t,r,n,a,i){this.routeReuseStrategy=t,this.futureState=r,this.currState=n,this.forwardEvent=a,this.inputBindingEnabled=i}activate(t){const r=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(r,n,t),nR(this.futureState.root),this.activateChildRoutes(r,n,t)}deactivateChildRoutes(t,r,n){const a=c0(r);t.children.forEach(i=>{const o=i.value.outlet;this.deactivateRoutes(i,a[o],n),delete a[o]}),Object.values(a).forEach(i=>{this.deactivateRouteAndItsChildren(i,n)})}deactivateRoutes(t,r,n){const a=t.value,i=r?r.value:null;if(a===i)if(a.component){const o=n.getContext(a.outlet);o&&this.deactivateChildRoutes(t,r,o.children)}else this.deactivateChildRoutes(t,r,n);else i&&this.deactivateRouteAndItsChildren(r,n)}deactivateRouteAndItsChildren(t,r){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,r):this.deactivateRouteAndOutlet(t,r)}detachAndStoreRouteSubtree(t,r){const n=r.getContext(t.value.outlet),a=n&&t.value.component?n.children:r,i=c0(t);for(const o of Object.keys(i))this.deactivateRouteAndItsChildren(i[o],a);if(n&&n.outlet){const o=n.outlet.detach(),s=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:o,route:t,contexts:s})}}deactivateRouteAndOutlet(t,r){const n=r.getContext(t.value.outlet),a=n&&t.value.component?n.children:r,i=c0(t);for(const o of Object.keys(i))this.deactivateRouteAndItsChildren(i[o],a);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,r,n){const a=c0(r);t.children.forEach(i=>{this.activateRoutes(i,a[i.value.outlet],n),this.forwardEvent(new j2e(i.value.snapshot))}),t.children.length&&this.forwardEvent(new z2e(t.value.snapshot))}activateRoutes(t,r,n){const a=t.value,i=r?r.value:null;if(nR(a),a===i)if(a.component){const o=n.getOrCreateContext(a.outlet);this.activateChildRoutes(t,r,o.children)}else this.activateChildRoutes(t,r,n);else if(a.component){const o=n.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const s=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),nR(s.route.value),this.activateChildRoutes(t,null,o.children)}else{const s=w1(a.snapshot);o.attachRef=null,o.route=a,o.injector=s,o.outlet&&o.outlet.activateWith(a,o.injector),this.activateChildRoutes(t,null,o.children)}}else this.activateChildRoutes(t,null,n)}}class Y9{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class H_{constructor(t,r){this.component=t,this.route=r}}function iCe(e,t,r){const n=e._root;return A1(n,t?t._root:null,r,[n.value])}function d0(e,t){const r=Symbol(),n=t.get(e,r);return n===r?"function"!=typeof e||function dce(e){return null!==PC(e)}(e)?t.get(e):e:n}function A1(e,t,r,n,a={canDeactivateChecks:[],canActivateChecks:[]}){const i=c0(t);return e.children.forEach(o=>{(function sCe(e,t,r,n,a={canDeactivateChecks:[],canActivateChecks:[]}){const i=e.value,o=t?t.value:null,s=r?r.getContext(e.value.outlet):null;if(o&&i.routeConfig===o.routeConfig){const u=function uCe(e,t,r){if("function"==typeof r)return r(e,t);switch(r){case"pathParamsChange":return!Ch(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Ch(e.url,t.url)||!$l(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!aR(e,t)||!$l(e.queryParams,t.queryParams);default:return!aR(e,t)}}(o,i,i.routeConfig.runGuardsAndResolvers);u?a.canActivateChecks.push(new Y9(n)):(i.data=o.data,i._resolvedData=o._resolvedData),A1(e,t,i.component?s?s.children:null:r,n,a),u&&s&&s.outlet&&s.outlet.isActivated&&a.canDeactivateChecks.push(new H_(s.outlet.component,o))}else o&&T1(t,s,a),a.canActivateChecks.push(new Y9(n)),A1(e,null,i.component?s?s.children:null:r,n,a)})(o,i[o.value.outlet],r,n.concat([o.value]),a),delete i[o.value.outlet]}),Object.entries(i).forEach(([o,s])=>T1(s,r.getContext(o),a)),a}function T1(e,t,r){const n=c0(e),a=e.value;Object.entries(n).forEach(([i,o])=>{T1(o,a.component?t?t.children.getContext(i):null:t,r)}),r.canDeactivateChecks.push(new H_(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}function D1(e){return"function"==typeof e}function X9(e){return e instanceof M_||"EmptyError"===e?.name}const j_=Symbol("INITIAL_VALUE");function f0(){return nc(e=>c9(e.map(t=>t.pipe(bh(1),function e2e(...e){const t=nb(e);return di((r,n)=>{(t?UM(e,r,t):UM(e,r)).subscribe(n)})}(j_)))).pipe($n(t=>{for(const r of t)if(!0!==r){if(r===j_)return j_;if(!1===r||r instanceof o0)return r}return!0}),uf(t=>t!==j_),bh(1)))}function K9(e){return U5($o(t=>{if(xh(t))throw H9(0,t)}),$n(t=>!0===t))}class sR{constructor(t){this.segmentGroup=t||null}}class uR extends Error{constructor(t){super(),this.urlTree=t}}function p0(e){return R_(new sR(e))}class ECe{constructor(t,r){this.urlSerializer=t,this.urlTree=r}noMatchError(t){return new Ot(4002,!1)}lineralizeSegments(t,r){let n=[],a=r.root;for(;;){if(n=n.concat(a.segments),0===a.numberOfChildren)return Hr(n);if(a.numberOfChildren>1||!a.children[en])return R_(new Ot(4e3,!1));a=a.children[en]}}applyRedirectCommands(t,r,n){const a=this.applyRedirectCreateUrlTree(r,this.urlSerializer.parse(r),t,n);if(r.startsWith("/"))throw new uR(a);return a}applyRedirectCreateUrlTree(t,r,n,a){const i=this.createSegmentGroup(t,r.root,n,a);return new o0(i,this.createQueryParams(r.queryParams,this.urlTree.queryParams),r.fragment)}createQueryParams(t,r){const n={};return Object.entries(t).forEach(([a,i])=>{if("string"==typeof i&&i.startsWith(":")){const s=i.substring(1);n[a]=r[s]}else n[a]=i}),n}createSegmentGroup(t,r,n,a){const i=this.createSegments(t,r.segments,n,a);let o={};return Object.entries(r.children).forEach(([s,u])=>{o[s]=this.createSegmentGroup(t,u,n,a)}),new da(i,o)}createSegments(t,r,n,a){return r.map(i=>i.path.startsWith(":")?this.findPosParam(t,i,a):this.findOrReturn(i,n))}findPosParam(t,r,n){const a=n[r.path.substring(1)];if(!a)throw new Ot(4001,!1);return a}findOrReturn(t,r){let n=0;for(const a of r){if(a.path===t.path)return r.splice(n),a;n++}return t}}const cR={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ICe(e,t,r,n,a){const i=lR(e,t,r);return i.matched?(n=function $2e(e,t){return e.providers&&!e._injector&&(e._injector=aH(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,n),function ACe(e,t,r,n){const a=t.canMatch;return a&&0!==a.length?Hr(a.map(o=>{const s=d0(o,e);return Gp(function mCe(e){return e&&D1(e.canMatch)}(s)?s.canMatch(t,r):bg(e,()=>s(t,r)))})).pipe(f0(),K9()):Hr(!0)}(n,t,r).pipe($n(o=>!0===o?i:{...cR}))):Hr(i)}function lR(e,t,r){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||r.length>0)?{...cR}:{matched:!0,consumedSegments:[],remainingSegments:r,parameters:{},positionalParamSegments:{}};const a=(t.matcher||u2e)(r,e,t);if(!a)return{...cR};const i={};Object.entries(a.posParams??{}).forEach(([s,u])=>{i[s]=u.path});const o=a.consumed.length>0?{...i,...a.consumed[a.consumed.length-1].parameters}:i;return{matched:!0,consumedSegments:a.consumed,remainingSegments:r.slice(a.consumed.length),parameters:o,positionalParamSegments:a.posParams??{}}}function Z9(e,t,r,n){return r.length>0&&function RCe(e,t,r){return r.some(n=>q_(e,t,n)&&ed(n)!==en)}(e,r,n)?{segmentGroup:new da(t,MCe(n,new da(r,e.children))),slicedSegments:[]}:0===r.length&&function OCe(e,t,r){return r.some(n=>q_(e,t,n))}(e,r,n)?{segmentGroup:new da(e.segments,PCe(e,0,r,n,e.children)),slicedSegments:r}:{segmentGroup:new da(e.segments,e.children),slicedSegments:r}}function PCe(e,t,r,n,a){const i={};for(const o of n)if(q_(e,r,o)&&!a[ed(o)]){const s=new da([],{});i[ed(o)]=s}return{...a,...i}}function MCe(e,t){const r={};r[en]=t;for(const n of e)if(""===n.path&&ed(n)!==en){const a=new da([],{});r[ed(n)]=a}return r}function q_(e,t,r){return(!(e.hasChildren()||t.length>0)||"full"!==r.pathMatch)&&""===r.path}class NCe{}class UCe{constructor(t,r,n,a,i,o,s){this.injector=t,this.configLoader=r,this.rootComponentType=n,this.config=a,this.urlTree=i,this.paramsInheritanceStrategy=o,this.urlSerializer=s,this.applyRedirects=new ECe(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new Ot(4002,!1)}recognize(){const t=Z9(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe($n(r=>{const n=new tR([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},en,this.rootComponentType,null,{}),a=new cl(n,r),i=new L9("",a),o=function E2e(e,t,r=null,n=null){return E9(D9(e),t,r,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(i._root,null),{state:i,tree:o}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,en).pipe(n0(n=>{if(n instanceof uR)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof sR?this.noMatchError(n):n}))}inheritParamsAndData(t,r){const n=t.value,a=eR(n,r,this.paramsInheritanceStrategy);n.params=Object.freeze(a.params),n.data=Object.freeze(a.data),t.children.forEach(i=>this.inheritParamsAndData(i,n))}processSegmentGroup(t,r,n,a){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,r,n):this.processSegment(t,r,n,n.segments,a,!0).pipe($n(i=>i instanceof cl?[i]:[]))}processChildren(t,r,n){const a=[];for(const i of Object.keys(n.children))"primary"===i?a.unshift(i):a.push(i);return So(a).pipe(F_(i=>{const o=n.children[i],s=function rCe(e,t){const r=e.filter(n=>ed(n)===t);return r.push(...e.filter(n=>ed(n)!==t)),r}(r,i);return this.processSegmentGroup(t,s,o,i)}),function n2e(e,t){return di(function r2e(e,t,r,n,a){return(i,o)=>{let s=r,u=t,c=0;i.subscribe(fi(o,l=>{const d=c++;u=s?e(u,l,d):(s=!0,l),n&&o.next(u)},a&&(()=>{s&&o.next(u),o.complete()})))}}(e,t,arguments.length>=2,!0))}((i,o)=>(i.push(...o),i)),O_(null),function a2e(e,t){const r=arguments.length>=2;return n=>n.pipe(e?uf((a,i)=>e(a,i,n)):_p,GM(1),r?O_(t):m9(()=>new M_))}(),bs(i=>{if(null===i)return p0(n);const o=Q9(i);return function VCe(e){e.sort((t,r)=>t.value.outlet===en?-1:r.value.outlet===en?1:t.value.outlet.localeCompare(r.value.outlet))}(o),Hr(o)}))}processSegment(t,r,n,a,i,o){return So(r).pipe(F_(s=>this.processSegmentAgainstRoute(s._injector??t,r,s,n,a,i,o).pipe(n0(u=>{if(u instanceof sR)return Hr(null);throw u}))),Sh(s=>!!s),n0(s=>{if(X9(s))return function BCe(e,t,r){return 0===t.length&&!e.children[r]}(n,a,i)?Hr(new NCe):p0(n);throw s}))}processSegmentAgainstRoute(t,r,n,a,i,o,s){return function FCe(e,t,r,n){return!!(ed(e)===n||n!==en&&q_(t,r,e))&&("**"===e.path||lR(t,e,r).matched)}(n,a,i,o)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,a,n,i,o):this.allowRedirects&&s?this.expandSegmentAgainstRouteUsingRedirect(t,a,r,n,i,o):p0(a):p0(a)}expandSegmentAgainstRouteUsingRedirect(t,r,n,a,i,o){const{matched:s,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}="**"===a.path?$9(i):lR(r,a,i);if(!s)return p0(r);a.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const d=this.applyRedirects.applyRedirectCommands(u,a.redirectTo,c);return this.applyRedirects.lineralizeSegments(a,d).pipe(bs(f=>this.processSegment(t,n,r,f.concat(l),o,!1)))}matchSegmentAgainstRoute(t,r,n,a,i){let o;return"**"===n.path?(o=Hr($9(a)),r.children={}):o=ICe(r,n,a,t),o.pipe(nc(s=>s.matched?this.getChildConfig(t=n._injector??t,n,a).pipe(nc(({routes:u})=>{const c=n._loadedInjector??t,{consumedSegments:l,remainingSegments:d,parameters:f}=s,p=new tR(l,f,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function zCe(e){return e.data||{}}(n),ed(n),n.component??n._loadedComponent??null,n,function HCe(e){return e.resolve||{}}(n)),{segmentGroup:m,slicedSegments:h}=Z9(r,l,d,u);if(0===h.length&&m.hasChildren())return this.processChildren(c,u,m).pipe($n(g=>null===g?null:new cl(p,g)));if(0===u.length&&0===h.length)return Hr(new cl(p,[]));const v=ed(n)===i;return this.processSegment(c,u,m,h,v?en:i,!0).pipe($n(g=>new cl(p,g instanceof cl?[g]:[])))})):p0(r)))}getChildConfig(t,r,n){return r.children?Hr({routes:r.children,injector:t}):r.loadChildren?void 0!==r._loadedRoutes?Hr({routes:r._loadedRoutes,injector:r._loadedInjector}):function wCe(e,t,r,n){const a=t.canLoad;return void 0===a||0===a.length?Hr(!0):Hr(a.map(o=>{const s=d0(o,e);return Gp(function lCe(e){return e&&D1(e.canLoad)}(s)?s.canLoad(t,r):bg(e,()=>s(t,r)))})).pipe(f0(),K9())}(t,r,n).pipe(bs(a=>a?this.configLoader.loadChildren(t,r).pipe($o(i=>{r._loadedRoutes=i.routes,r._loadedInjector=i.injector})):function DCe(e){return R_(j9(!1,3))}())):Hr({routes:[],injector:t})}}function GCe(e){const t=e.value.routeConfig;return t&&""===t.path}function Q9(e){const t=[],r=new Set;for(const n of e){if(!GCe(n)){t.push(n);continue}const a=t.find(i=>n.value.routeConfig===i.value.routeConfig);void 0!==a?(a.children.push(...n.children),r.add(a)):t.push(n)}for(const n of r){const a=Q9(n.children);t.push(new cl(n.value,a))}return t.filter(n=>!r.has(n))}function $9(e){return{matched:!0,parameters:e.length>0?v9(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}function J9(e){const t=e.children.map(r=>J9(r)).flat();return[e,...t]}function dR(e){return nc(t=>{const r=e(t);return r?So(r).pipe($n(()=>t)):Hr(t)})}let ej=(()=>{class e{buildTitle(r){let n,a=r.root;for(;void 0!==a;)n=this.getResolvedTitleForRoute(a)??n,a=a.children.find(i=>i.outlet===en);return n}getResolvedTitleForRoute(r){return r.data[h1]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>Yt(KCe),providedIn:"root"})}return e})(),KCe=(()=>{class e extends ej{constructor(r){super(),this.title=r}updateTitle(r){const n=this.buildTitle(r);void 0!==n&&this.title.setTitle(n)}static#e=this.\u0275fac=function(n){return new(n||e)(an(a9))};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const E1=new sr("",{providedIn:"root",factory:()=>({})}),W_=new sr("ROUTES");let tj=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Yt(uye)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return Hr(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);const n=Gp(r.loadComponent()).pipe($n(rj),$o(i=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=i}),zM(()=>{this.componentLoaders.delete(r)})),a=new p9(n,()=>new bn).pipe(VM());return this.componentLoaders.set(r,a),a}loadChildren(r,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Hr({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);const i=function ZCe(e,t,r,n){return Gp(e.loadChildren()).pipe($n(rj),bs(a=>a instanceof rH||Array.isArray(a)?Hr(a):So(t.compileModuleAsync(a))),$n(a=>{n&&n(e);let i,o,s=!1;return Array.isArray(a)?(o=a,!0):(i=a.create(r).injector,o=i.get(W_,[],{optional:!0,self:!0}).flat()),{routes:o.map(oR),injector:i}}))}(n,this.compiler,r,this.onLoadEndListener).pipe(zM(()=>{this.childrenLoaders.delete(n)})),o=new p9(i,()=>new bn).pipe(VM());return this.childrenLoaders.set(n,o),o}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function rj(e){return function QCe(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let fR=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>Yt($Ce),providedIn:"root"})}return e})(),$Ce=(()=>{class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,n){return r}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const nj=new sr("");let Y_=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new bn,this.transitionAbortSubject=new bn,this.configLoader=Yt(tj),this.environmentInjector=Yt(rl),this.urlSerializer=Yt(s0),this.rootContexts=Yt(x1),this.location=Yt(l1),this.inputBindingEnabled=null!==Yt(z_,{optional:!0}),this.titleStrategy=Yt(ej),this.options=Yt(E1,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Yt(fR),this.createViewTransition=Yt(nj,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Hr(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=a=>this.events.next(new V2e(a)),this.configLoader.onLoadStartListener=a=>this.events.next(new U2e(a))}complete(){this.transitions?.complete()}handleNavigationRequest(r){const n=++this.navigationId;this.transitions?.next({...this.transitions.value,...r,id:n})}setupNavigations(r,n,a){return this.transitions=new Ai({id:0,currentUrlTree:n,currentRawUrl:n,extractedUrl:this.urlHandlingStrategy.extract(n),urlAfterRedirects:this.urlHandlingStrategy.extract(n),rawUrl:n,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:S1,restoredState:null,currentSnapshot:a.snapshot,targetSnapshot:null,currentRouterState:a,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(uf(i=>0!==i.id),$n(i=>({...i,extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),nc(i=>{this.currentTransition=i;let o=!1,s=!1;return Hr(i).pipe($o(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),nc(u=>{const c=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!c&&"reload"!==(u.extras.onSameUrlNavigation??r.onSameUrlNavigation)){const d="";return this.events.next(new C1(u.id,this.urlSerializer.serialize(u.rawUrl),d,0)),u.resolve(null),kl}if(this.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return Hr(u).pipe(nc(d=>{const f=this.transitions?.getValue();return this.events.next(new KM(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?kl:Promise.resolve(d)}),function jCe(e,t,r,n,a,i){return bs(o=>function kCe(e,t,r,n,a,i,o="emptyOnly"){return new UCe(e,t,r,n,a,o,i).recognize()}(e,t,r,n,o.extractedUrl,a,i).pipe($n(({state:s,tree:u})=>({...o,targetSnapshot:s,urlAfterRedirects:u}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),$o(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:d.urlAfterRedirects};const f=new F9(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){const{id:d,extractedUrl:f,source:p,restoredState:m,extras:h}=u,v=new KM(d,this.urlSerializer.serialize(f),p,m);this.events.next(v);const g=k9(0,this.rootComponentType).snapshot;return this.currentTransition=i={...u,targetSnapshot:g,urlAfterRedirects:f,extras:{...h,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=f,Hr(i)}{const d="";return this.events.next(new C1(u.id,this.urlSerializer.serialize(u.extractedUrl),d,1)),u.resolve(null),kl}}),$o(u=>{const c=new B2e(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(c)}),$n(u=>(this.currentTransition=i={...u,guards:iCe(u.targetSnapshot,u.currentSnapshot,this.rootContexts)},i)),function vCe(e,t){return bs(r=>{const{targetSnapshot:n,currentSnapshot:a,guards:{canActivateChecks:i,canDeactivateChecks:o}}=r;return 0===o.length&&0===i.length?Hr({...r,guardsResult:!0}):function gCe(e,t,r,n){return So(e).pipe(bs(a=>function _Ce(e,t,r,n,a){const i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return i&&0!==i.length?Hr(i.map(s=>{const u=w1(t)??a,c=d0(s,u);return Gp(function pCe(e){return e&&D1(e.canDeactivate)}(c)?c.canDeactivate(e,t,r,n):bg(u,()=>c(e,t,r,n))).pipe(Sh())})).pipe(f0()):Hr(!0)}(a.component,a.route,r,t,n)),Sh(a=>!0!==a,!0))}(o,n,a,e).pipe(bs(s=>s&&function cCe(e){return"boolean"==typeof e}(s)?function yCe(e,t,r,n){return So(t).pipe(F_(a=>UM(function SCe(e,t){return null!==e&&t&&t(new G2e(e)),Hr(!0)}(a.route.parent,n),function bCe(e,t){return null!==e&&t&&t(new H2e(e)),Hr(!0)}(a.route,n),function xCe(e,t,r){const n=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(o=>function oCe(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(o)).filter(o=>null!==o).map(o=>f9(()=>Hr(o.guards.map(u=>{const c=w1(o.node)??r,l=d0(u,c);return Gp(function fCe(e){return e&&D1(e.canActivateChild)}(l)?l.canActivateChild(n,e):bg(c,()=>l(n,e))).pipe(Sh())})).pipe(f0())));return Hr(i).pipe(f0())}(e,a.path,r),function CCe(e,t,r){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return Hr(!0);const a=n.map(i=>f9(()=>{const o=w1(t)??r,s=d0(i,o);return Gp(function dCe(e){return e&&D1(e.canActivate)}(s)?s.canActivate(t,e):bg(o,()=>s(t,e))).pipe(Sh())}));return Hr(a).pipe(f0())}(e,a.route,r))),Sh(a=>!0!==a,!0))}(n,i,e,t):Hr(s)),$n(s=>({...r,guardsResult:s})))})}(this.environmentInjector,u=>this.events.next(u)),$o(u=>{if(i.guardsResult=u.guardsResult,xh(u.guardsResult))throw H9(0,u.guardsResult);const c=new N2e(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(c)}),uf(u=>!!u.guardsResult||(this.cancelNavigationTransition(u,"",3),!1)),dR(u=>{if(u.guards.canActivateChecks.length)return Hr(u).pipe($o(c=>{const l=new k2e(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),nc(c=>{let l=!1;return Hr(c).pipe(function qCe(e,t){return bs(r=>{const{targetSnapshot:n,guards:{canActivateChecks:a}}=r;if(!a.length)return Hr(r);const i=new Set(a.map(u=>u.route)),o=new Set;for(const u of i)if(!o.has(u))for(const c of J9(u))o.add(c);let s=0;return So(o).pipe(F_(u=>i.has(u)?function WCe(e,t,r,n){const a=e.routeConfig,i=e._resolve;return void 0!==a?.title&&!V9(a)&&(i[h1]=a.title),function YCe(e,t,r,n){const a=HM(e);if(0===a.length)return Hr({});const i={};return So(a).pipe(bs(o=>function XCe(e,t,r,n){const a=w1(t)??n,i=d0(e,a);return Gp(i.resolve?i.resolve(t,r):bg(a,()=>i(t,r)))}(e[o],t,r,n).pipe(Sh(),$o(s=>{i[o]=s}))),GM(1),function i2e(e){return $n(()=>e)}(i),n0(o=>X9(o)?kl:R_(o)))}(i,e,t,n).pipe($n(o=>(e._resolvedData=o,e.data=eR(e,e.parent,r).resolve,null)))}(u,n,e,t):(u.data=eR(u,u.parent,e).resolve,Hr(void 0))),$o(()=>s++),GM(1),bs(u=>s===o.size?Hr(r):kl))})}(this.paramsInheritanceStrategy,this.environmentInjector),$o({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(c,"",2)}}))}),$o(c=>{const l=new L2e(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}))}),dR(u=>{const c=l=>{const d=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(l.routeConfig).pipe($o(f=>{l.component=f}),$n(()=>{})));for(const f of l.children)d.push(...c(f));return d};return c9(c(u.targetSnapshot.root)).pipe(O_(),bh(1))}),dR(()=>this.afterPreactivation()),nc(()=>{const{currentSnapshot:u,targetSnapshot:c}=i,l=this.createViewTransition?.(this.environmentInjector,u.root,c.root);return l?So(l).pipe($n(()=>i)):Hr(i)}),$n(u=>{const c=function X2e(e,t,r){const n=_1(e,t._root,r?r._root:void 0);return new N9(n,t)}(r.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=i={...u,targetRouterState:c},this.currentNavigation.targetRouterState=c,i}),$o(()=>{this.events.next(new ZM)}),((e,t,r,n)=>$n(a=>(new aCe(t,a.targetRouterState,a.currentRouterState,r,n).activate(e),a)))(this.rootContexts,r.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),bh(1),$o({next:u=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new _h(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),this.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{o=!0}}),function o2e(e){return di((t,r)=>{_u(e).subscribe(fi(r,()=>r.complete(),kE)),!r.closed&&t.subscribe(r)})}(this.transitionAbortSubject.pipe($o(u=>{throw u}))),zM(()=>{o||s||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),n0(u=>{if(s=!0,q9(u))this.events.next(new u0(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode)),function Q2e(e){return q9(e)&&xh(e.url)}(u)?this.events.next(new QM(u.url)):i.resolve(!1);else{this.events.next(new G_(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0));try{i.resolve(r.errorHandler(u))}catch(c){i.reject(c)}}return kl}))}))}cancelNavigationTransition(r,n,a){const i=new u0(r.id,this.urlSerializer.serialize(r.extractedUrl),n,a);this.events.next(i),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function txe(e){return e!==S1}let rxe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>Yt(axe),providedIn:"root"})}return e})();class nxe{shouldDetach(t){return!1}store(t,r){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,r){return t.routeConfig===r.routeConfig}}let axe=(()=>{class e extends nxe{static#e=this.\u0275fac=(()=>{let r;return function(a){return(r||(r=OI(e)))(a||e)}})();static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),ij=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:()=>Yt(ixe),providedIn:"root"})}return e})(),ixe=(()=>{class e extends ij{constructor(){super(...arguments),this.location=Yt(l1),this.urlSerializer=Yt(s0),this.options=Yt(E1,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Yt(fR),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new o0,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=k9(0,null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(n=>{"popstate"===n.type&&r(n.url,n.state)})}handleRouterEvent(r,n){if(r instanceof KM)this.stateMemento=this.createStateMemento();else if(r instanceof C1)this.rawUrlTree=n.initialUrl;else if(r instanceof F9){if("eager"===this.urlUpdateStrategy&&!n.extras.skipLocationChange){const a=this.urlHandlingStrategy.merge(n.finalUrl,n.initialUrl);this.setBrowserUrl(a,n)}}else r instanceof ZM?(this.currentUrlTree=n.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(n.finalUrl,n.initialUrl),this.routerState=n.targetRouterState,"deferred"===this.urlUpdateStrategy&&(n.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,n))):r instanceof u0&&(3===r.code||2===r.code)?this.restoreHistory(n):r instanceof G_?this.restoreHistory(n,!0):r instanceof _h&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,n){const a=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(a)||n.extras.replaceUrl){const o={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId)};this.location.replaceState(a,"",o)}else{const i={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId+1)};this.location.go(a,"",i)}}restoreHistory(r,n=!1){if("computed"===this.canceledNavigationResolution){const i=this.currentPageId-this.browserPageId;0!==i?this.location.historyGo(i):this.currentUrlTree===r.finalUrl&&0===i&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,n){return"computed"===this.canceledNavigationResolution?{navigationId:r,\u0275routerPageId:n}:{navigationId:r}}static#e=this.\u0275fac=(()=>{let r;return function(a){return(r||(r=OI(e)))(a||e)}})();static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var I1=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(I1||{});function oxe(e){throw e}const sxe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},uxe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let cf=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Yt(LH),this.stateManager=Yt(ij),this.options=Yt(E1,{optional:!0})||{},this.pendingTasks=Yt(VH),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Yt(Y_),this.urlSerializer=Yt(s0),this.location=Yt(l1),this.urlHandlingStrategy=Yt(fR),this._events=new bn,this.errorHandler=this.options.errorHandler||oxe,this.navigated=!1,this.routeReuseStrategy=Yt(rxe),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Yt(W_,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Yt(z_,{optional:!0}),this.eventsSubscription=new Xs,this.isNgZoneEnabled=Yt(ga)instanceof ga&&ga.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const r=this.navigationTransitions.events.subscribe(n=>{try{const a=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(null!==a&&null!==i)if(this.stateManager.handleRouterEvent(n,i),n instanceof u0&&0!==n.code&&1!==n.code)this.navigated=!0;else if(n instanceof _h)this.navigated=!0;else if(n instanceof QM){const o=this.urlHandlingStrategy.merge(n.url,a.currentRawUrl),s={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||txe(a.source)};this.scheduleNavigation(o,S1,null,s,{resolve:a.resolve,reject:a.reject,promise:a.promise})}(function lxe(e){return!(e instanceof ZM||e instanceof QM)})(n)&&this._events.next(n)}catch(a){this.navigationTransitions.transitionAbortSubject.next(a)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),S1,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription||(this.nonRouterCurrentEntryChangeSubscription=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,n)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",n)},0)}))}navigateToSyncWithBrowser(r,n,a){const i={replaceUrl:!0},o=a?.navigationId?a:null;if(a){const u={...a};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(i.state=u)}const s=this.parseUrl(r);this.scheduleNavigation(s,n,o,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(oR),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,n={}){const{relativeTo:a,queryParams:i,fragment:o,queryParamsHandling:s,preserveFragment:u}=n,c=u?this.currentUrlTree.fragment:o;let d,l=null;switch(s){case"merge":l={...this.currentUrlTree.queryParams,...i};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}null!==l&&(l=this.removeEmptyProps(l));try{d=D9(a?a.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof r[0]||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return E9(d,r,l,c??null)}navigateByUrl(r,n={skipLocationChange:!1}){const a=xh(r)?r:this.parseUrl(r),i=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(i,S1,null,n)}navigate(r,n={skipLocationChange:!1}){return function cxe(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Ot(4008,!1)}(r),this.navigateByUrl(this.createUrlTree(r,n),n)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,n){let a;if(a=!0===n?{...sxe}:!1===n?{...uxe}:n,xh(r))return y9(this.currentUrlTree,r,a);const i=this.parseUrl(r);return y9(this.currentUrlTree,i,a)}removeEmptyProps(r){return Object.keys(r).reduce((n,a)=>{const i=r[a];return null!=i&&(n[a]=i),n},{})}scheduleNavigation(r,n,a,i,o){if(this.disposed)return Promise.resolve(!1);let s,u,c;o?(s=o.resolve,u=o.reject,c=o.promise):c=new Promise((d,f)=>{s=d,u=f});const l=this.pendingTasks.add();return function oj(e,t){e.events.pipe(uf(r=>r instanceof _h||r instanceof u0||r instanceof G_||r instanceof C1),$n(r=>r instanceof _h||r instanceof C1?I1.COMPLETE:r instanceof u0&&(0===r.code||1===r.code)?I1.REDIRECTING:I1.FAILED),uf(r=>r!==I1.REDIRECTING),bh(1)).subscribe(()=>{t()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(l))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=Ar({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const mR=new sr("");function uj(e){return e.routerState.root}function cj(){const e=Yt(ac);return t=>{const r=e.get(Jg);if(t!==r.components[0])return;const n=e.get(cf),a=e.get(lj);1===e.get(hR)&&n.initialNavigation(),e.get(dj,null,pn.Optional)?.setUpPreloading(),e.get(mR,null,pn.Optional)?.init(),n.resetRootComponentType(r.componentTypes[0]),a.closed||(a.next(),a.complete(),a.unsubscribe())}}const lj=new sr("",{factory:()=>new bn}),hR=new sr("",{providedIn:"root",factory:()=>1}),dj=new sr(""),bxe={providers:[function hxe(e,...t){return HI([{provide:W_,multi:!0,useValue:e},[],{provide:l0,useFactory:uj,deps:[cf]},{provide:rM,multi:!0,useFactory:cj},t.map(r=>r.\u0275providers)])}([])]};function pj(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,a)}function mj(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function o(u){pj(i,n,a,o,s,"next",u)}function s(u){pj(i,n,a,o,s,"throw",u)}o(void 0)})}}const vR={now:()=>(vR.delegate||Date).now(),delegate:void 0};class P1 extends bn{constructor(t=1/0,r=1/0,n=vR){super(),this._bufferSize=t,this._windowTime=r,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=r===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,r)}next(t){const{isStopped:r,_buffer:n,_infiniteTimeWindow:a,_timestampProvider:i,_windowTime:o}=this;r||(n.push(t),!a&&n.push(i.now()+o)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const r=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:a}=this,i=a.slice();for(let o=0;o<i.length&&!t.closed;o+=n?1:2)t.next(i[o]);return this._checkFinalizedStatuses(t),r}_trimBuffer(){const{_bufferSize:t,_timestampProvider:r,_buffer:n,_infiniteTimeWindow:a}=this,i=(a?1:2)*t;if(t<1/0&&i<n.length&&n.splice(0,n.length-i),!a){const o=r.now();let s=0;for(let u=1;u<n.length&&n[u]<=o;u+=2)s=u;s&&n.splice(0,s+1)}}}const{isArray:Cxe}=Array;function xxe(e){return 1===e.length&&Cxe(e[0])?e[0]:e}function hj(...e){const t=aU(e);return t?U5(hj(...e),u9(t)):di((r,n)=>{l9([r,...xxe(e)])(n)})}function vj(...e){return hj(...e)}var lf,e,Vo,tn;(e=lf||(lf={})).create=function t(n){return n},e.getDuration=function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=null===(o=(i=a.definition).getDuration)||void 0===o?void 0:o.call(i,a.params,n);return"fixed"===s?.kind?s.durationMs:void 0},function(e){e.create=function t(a){return a},e.has=function r(a,i){return 0!=(a&i)},e.hasAll=function n(a,i){return!!i&&(a&i)===i}}(Vo||(Vo={})),function(e){e.create=function t(C){return void 0===C&&(C=512),{current:[],offset:0,capacity:C,chunks:[]}},e.getString=function r(C){return C.chunks.length?(C.offset>0&&(C.chunks[C.chunks.length]=C.current.length===C.offset?C.current.join(""):C.current.slice(0,C.offset).join("")),C.chunks.join("")):C.current.length===C.offset?C.current.join(""):C.current.splice(0,C.offset).join("")},e.getSize=function n(C){for(var _=0,x=0,D=C.chunks;x<D.length;x++)_+=D[x].length;for(var A=0;A<C.offset;A++)_+=C.current[A].length;return _},e.getChunks=function a(C){return C.offset>0&&(C.chunks[C.chunks.length]=C.current.length===C.offset?C.current.join(""):C.current.slice(0,C.offset).join(""),C.offset=0),C.chunks};var i=[];function s(C,_){_>0&&l(C,i[_])}function l(C,_){C.offset===C.capacity&&(C.chunks[C.chunks.length]=C.current.join(""),C.offset=0),C.current[C.offset++]=_}!function(){for(var C="",_=0;_<512;_++)i[_]=C,C+=" "}(),e.newline=function o(C){l(C,"\n")},e.whitespace=s,e.whitespace1=function u(C){l(C," ")},e.write=function c(C,_){_&&(C.offset===C.capacity&&(C.chunks[C.chunks.length]=C.current.join(""),C.offset=0),C.current[C.offset++]=_)},e.writeSafe=l,e.writePadLeft=function d(C,_,x){_?(s(C,x-_.length),l(C,_)):s(C,x)},e.writePadRight=function f(C,_,x){if(_){var D=x-_.length;l(C,_),s(C,D)}else s(C,x)},e.writeInteger=function p(C,_){l(C,""+_)},e.writeIntegerAndSpace=function m(C,_){l(C,_+" ")},e.writeIntegerPadLeft=function h(C,_,x){var D=""+_;s(C,x-D.length),l(C,D)},e.writeIntegerPadRight=function v(C,_,x){var D=""+_,w=x-D.length;l(C,D),s(C,w)},e.writeFloat=function g(C,_,x){l(C,""+Math.round(x*_)/x)},e.writeFloatPadLeft=function y(C,_,x,D){var w=""+Math.round(x*_)/x;s(C,D-w.length),l(C,w)},e.writeFloatPadRight=function S(C,_,x,D){var w=""+Math.round(x*_)/x,A=D-w.length;l(C,w),s(C,A)}}(tn||(tn={}));var kn,gj,M1,ia=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}return typeof process<"u"&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function gR(e,t){if(void 0===t&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/36e5),n=Math.floor(e/6e4%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&"0"===i[i.length-1];)i=i.substr(0,i.length-1);return r>0?"".concat(r,"h").concat(n,"m").concat(a,".").concat(i,"s"):n>0?"".concat(n,"m").concat(a,".").concat(i,"s"):a>0?"".concat(a,".").concat(i,"s"):"".concat(e.toFixed(0),"ms")}function _xe(e,t){return e-t}function Jo(e,t){void 0===e&&(e=0),void 0===t&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}!function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];e.create22=function n(){for(var o=+new Date+ia(),s=0;s<16;s++)r[s]=String.fromCharCode((o+255*Math.random())%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},e.createv4=function a(){var o=+new Date+ia();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var c=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===u?c:3&c|8).toString(16)})},e.is=function i(o){return"string"==typeof o}}(kn||(kn={})),function(e){var t=function(){function p(){this.size=0}return p.prototype.has=function(m){return!1},p.prototype.forEach=function(m,h){return h},p}(),r=function(){function p(m){this.idx=m,this.size=1}return p.prototype.has=function(m){return m===this.idx},p.prototype.forEach=function(m,h){return m(this.idx,h),h},p}(),n=function(){function p(m,h){this.mask=m,this.size=h,this.length=m.length}return p.prototype.has=function(m){return m<this.length&&!!this.mask[m]},p.prototype._forEach=function(m,h){for(var v=0;v<this.length;v++)this.mask[v]&&m(v,h)},p.prototype.forEach=function(m,h){return this._forEach(m,h),h},p}(),a=function(){function p(m){this.size=m}return p.prototype.has=function(m){return!0},p.prototype._forEach=function(m,h){for(var v=0;v<this.size;v++)m(v,h)},p.prototype.forEach=function(m,h){return this._forEach(m,h),h},p}(),i=function(){function p(m){this.set=m,this._flat=void 0,this.size=m.size}return p.prototype.has=function(m){return this.set.has(m)},p.prototype._forEach=function(m,h){for(var v=0,g=this.flatten();v<g.length;v++)m(g[v],h)},p.prototype.flatten=function(){if(this._flat)return this._flat;var m=new Int32Array(this.size),h=0;return this.set.forEach(function(v){return m[h++]=v}),function wxe(e){Array.prototype.sort.call(e,_xe)}(m),this._flat=m,this._flat},p.prototype.forEach=function(m,h){return this._forEach(m,h),h},p}();function s(p){return new i(p)}function l(p,m){return new n(p,m)}e.always=function o(p){return new a(p)},e.never=new t,e.ofSet=s,e.singleton=function u(p){return new r(p)},e.ofUniqueIndices=function c(p){var m=p.length;if(0===m)return new t;if(1===m)return new r(p[0]);for(var h=0,v=0,g=p;v<g.length;v++)(y=g[v])>h&&(h=y);if(m===h)return new a(m);if(m/h<1/12){for(var C=new Set,_=0,x=p;_<x.length;_++)C.add(y=x[_]);return new i(C)}for(var D=new Int8Array(h+1),w=0,A=p;w<A.length;w++){var y;D[y=A[w]]=1}return new n(D,p.length)},e.ofMask=l,e.hasAny=function d(p,m){for(var h=0,v=m;h<v.length;h++)if(p.has(v[h]))return!0;return!1},e.complement=function f(p,m){var h=0,v=0;if(m.forEach(function(S){p.has(S)||(h++,S>v&&(v=S))}),h/v<1/12){var g=new Set;return m.forEach(function(S){p.has(S)||g.add(S)}),s(g)}var y=new Uint8Array(v+1);return m.forEach(function(S){p.has(S)||(y[S]=1)}),l(y,h)}}(gj||(gj={})),function(e){e.create=function t(n){return{ref:n}},e.set=function r(n,a){return n.ref=a,n}}(M1||(M1={}));var zp,O,Axe=Jo(0,2147483647);!function(e){e.create=function t(n,a){return{id:Axe(),version:0,value:n,metadata:a}},e.withValue=function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}}(zp||(zp={})),function(e){function r(i,o){return M1.set(i,zp.withValue(i.ref,o))}e.create=function t(i,o){return M1.create(zp.create(i,o))},e.update=r,e.set=function n(i,o){return M1.set(i,o)},e.updateIfChanged=function a(i,o){return i.ref.value!==o?r(i,o):i}}(O||(O={}));var m0=function(){};function Es(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var Jn,O1,X_=Object.prototype.hasOwnProperty;function rd(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!rd(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&"object"==typeof e&&"object"==typeof t){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,c=t instanceof RegExp;if(u&&c)return e.toString()===t.toString();if(u!==c)return!1;for(a=0;a<i.length;a++)if(!X_.call(t,i[a]))return!1;for(a=0;a<i.length;a++)if(!rd(e[i[a]],t[i[a]]))return!1;return!0}return!1}function R1(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?function Txe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}(e,t):r===n&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&K_(e,t)}function K_(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!X_.call(e,i)||e[i]!==t[i])return!1}return!0}function po(e,t){return void 0!==e?e:t}!function(e){function r(a){var i;return(i=function(){function o(s,u){this.data=s,this.id=kn.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}()).type=a,i}e.factory=function t(){return function(a){return r(a)}},e.create=r,e.hasTag=function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++)if(s[o]===i)return!0;return!1},e.Null={id:kn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}}(Jn||(Jn={})),function(e){e.is=function t(n){return!!(n&&n.transform&&n.parent&&n.status)},e.resolve=function r(n,a){var i="string"==typeof a?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}}(O1||(O1={})),function(){function e(t){this.state=t,this.version=""}e.prototype.setQuery=function(t){this.query=xr.compile(t)},e.prototype.update=function(){var t=this.state.select(this.query)[0],r=t?t.transform.version:void 0,n=this.cell!==t||this.version!==r;return this.cell=t,this.version=r||"",this.data=t&&t.obj?t.obj.data:void 0,n}}();var mo,Sj=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return null===(t=this.state)||void 0===t?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return null===(r=null===(t=this.state)||void 0===t?void 0:t.cells.get(this.ref))||void 0===r?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return null===(t=this.obj)||void 0===t?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if("ok"===t.status)return!0;throw"error"===t.status?new Error(t.errorText):t.obj===Jn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&"ok"===t.status&&t.obj!==Jn.Null},enumerable:!1,configurable:!0}),e}();!function(e){function r(a,i){if(i)return O1.is(i)?i:"string"==typeof i?a.cells.get(i):i.cell}e.resolveRef=function t(a){var i;if(a)return"string"==typeof a?a:O1.is(a)?a.transform.ref:null===(i=a.cell)||void 0===i?void 0:i.transform.ref},e.resolve=r,e.resolveAndCheck=function n(a,i){var o=r(a,i);if(o&&o.obj&&"ok"===o.status)return o}}(mo||(mo={}));var F1="delete",Na=5,cc=1<<Na,Is=cc-1,An={};function lc(e){e&&(e.value=!0)}function bR(){}function h0(e){return void 0===e.size&&(e.size=e.__iterate(Cj)),e.size}function Hp(e,t){if("number"!=typeof t){var r=t>>>0;if(""+r!==t||4294967295===r)return NaN;t=r}return t<0?h0(e)+t:t}function Cj(){return!0}function B1(e,t,r){return(0===e&&!_j(e)||void 0!==r&&e<=-r)&&(void 0===t||void 0!==r&&t>=r)}function v0(e,t){return xj(e,t,0)}function N1(e,t){return xj(e,t,t)}function xj(e,t,r){return void 0===e?r:_j(e)?t===1/0?t:0|Math.max(0,t+e):void 0===t||t===e?e:0|Math.min(t,e)}function _j(e){return e<0||0===e&&1/e==-1/0}var wj="@@__IMMUTABLE_ITERABLE__@@";function Ps(e){return!(!e||!e[wj])}var Aj="@@__IMMUTABLE_KEYED__@@";function Da(e){return!(!e||!e[Aj])}var Tj="@@__IMMUTABLE_INDEXED__@@";function es(e){return!(!e||!e[Tj])}function k1(e){return Da(e)||es(e)}var ai=function(t){return Ps(t)?t:Rs(t)},dc=function(e){function t(r){return Da(r)?r:jp(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ai),wh=function(e){function t(r){return es(r)?r:hc(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ai),g0=function(e){function t(r){return Ps(r)&&!k1(r)?r:S0(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ai);ai.Keyed=dc,ai.Indexed=wh,ai.Set=g0;var Dj="@@__IMMUTABLE_SEQ__@@";function Z_(e){return!(!e||!e[Dj])}var Ej="@@__IMMUTABLE_RECORD__@@";function Ah(e){return!(!e||!e[Ej])}function fc(e){return Ps(e)||Ah(e)}var y0="@@__IMMUTABLE_ORDERED__@@";function pc(e){return!(!e||!e[y0])}var L1=0,ll=1,mc=2,SR="function"==typeof Symbol&&Symbol.iterator,Ij="@@iterator",Q_=SR||Ij,Ln=function(t){this.next=t};function ka(e,t,r,n){var a=0===e?t:1===e?r:[t,r];return n?n.value=a:n={value:a,done:!1},n}function Ms(){return{value:void 0,done:!0}}function CR(e){return!!Array.isArray(e)||!!$_(e)}function Pj(e){return e&&"function"==typeof e.next}function xR(e){var t=$_(e);return t&&t.call(e)}function $_(e){var t=e&&(SR&&e[SR]||e[Ij]);if("function"==typeof t)return t}Ln.prototype.toString=function(){return"[Iterator]"},Ln.KEYS=L1,Ln.VALUES=ll,Ln.ENTRIES=mc,Ln.prototype.inspect=Ln.prototype.toSource=function(){return this.toString()},Ln.prototype[Q_]=function(){return this};var b0=Object.prototype.hasOwnProperty;function _R(e){return!(!Array.isArray(e)&&"string"!=typeof e)||e&&"object"==typeof e&&Number.isInteger(e.length)&&e.length>=0&&(0===e.length?1===Object.keys(e).length:e.hasOwnProperty(e.length-1))}var Rs=function(e){function t(r){return null==r?AR():fc(r)?r.toSeq():function Fxe(e){var t=DR(e);if(t)return function Mxe(e){var t=$_(e);return t&&t===e.entries}(e)?t.fromEntrySeq():function Rxe(e){var t=$_(e);return t&&t===e.keys}(e)?t.toSetSeq():t;if("object"==typeof e)return new wR(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,a){var i=this._cache;if(i){for(var o=i.length,s=0;s!==o;){var u=i[a?o-++s:s++];if(!1===n(u[1],u[0],this))break}return s}return this.__iterateUncached(n,a)},t.prototype.__iterator=function(n,a){var i=this._cache;if(i){var o=i.length,s=0;return new Ln(function(){if(s===o)return{value:void 0,done:!0};var u=i[a?o-++s:s++];return ka(n,u[0],u[1])})}return this.__iteratorUncached(n,a)},t}(ai),jp=function(e){function t(r){return null==r?AR().toKeyedSeq():Ps(r)?Da(r)?r.toSeq():r.fromEntrySeq():Ah(r)?r.toSeq():TR(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(Rs),hc=function(e){function t(r){return null==r?AR():Ps(r)?Da(r)?r.entrySeq():r.toIndexedSeq():Ah(r)?r.toSeq().entrySeq():Rj(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(Rs),S0=function(e){function t(r){return(Ps(r)&&!k1(r)?r:hc(r)).toSetSeq()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(Rs);Rs.isSeq=Z_,Rs.Keyed=jp,Rs.Set=S0,Rs.Indexed=hc,Rs.prototype[Dj]=!0;var Th=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n,a){return this.has(n)?this._array[Hp(this,n)]:a},t.prototype.__iterate=function(n,a){for(var i=this._array,o=i.length,s=0;s!==o;){var u=a?o-++s:s++;if(!1===n(i[u],u,this))break}return s},t.prototype.__iterator=function(n,a){var i=this._array,o=i.length,s=0;return new Ln(function(){if(s===o)return{value:void 0,done:!0};var u=a?o-++s:s++;return ka(n,u,i[u])})},t}(hc),wR=function(e){function t(r){var n=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n,a){return void 0===a||this.has(n)?this._object[n]:a},t.prototype.has=function(n){return b0.call(this._object,n)},t.prototype.__iterate=function(n,a){for(var i=this._object,o=this._keys,s=o.length,u=0;u!==s;){var c=o[a?s-++u:u++];if(!1===n(i[c],c,this))break}return u},t.prototype.__iterator=function(n,a){var i=this._object,o=this._keys,s=o.length,u=0;return new Ln(function(){if(u===s)return{value:void 0,done:!0};var c=o[a?s-++u:u++];return ka(n,c,i[c])})},t}(jp);wR.prototype[y0]=!0;var Mj,Oxe=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.__iterateUncached=function(n,a){if(a)return this.cacheResult().__iterate(n,a);var o=xR(this._collection),s=0;if(Pj(o))for(var u;!(u=o.next()).done&&!1!==n(u.value,s++,this););return s},t.prototype.__iteratorUncached=function(n,a){if(a)return this.cacheResult().__iterator(n,a);var o=xR(this._collection);if(!Pj(o))return new Ln(Ms);var s=0;return new Ln(function(){var u=o.next();return u.done?u:ka(n,s++,u.value)})},t}(hc);function AR(){return Mj||(Mj=new Th([]))}function TR(e){var t=DR(e);if(t)return t.fromEntrySeq();if("object"==typeof e)return new wR(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function Rj(e){var t=DR(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function DR(e){return _R(e)?new Th(e):CR(e)?new Oxe(e):void 0}var Oj="@@__IMMUTABLE_MAP__@@";function J_(e){return!(!e||!e[Oj])}function ER(e){return J_(e)&&pc(e)}function IR(e){return!(!e||"function"!=typeof e.equals||"function"!=typeof e.hashCode)}function xo(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!!(IR(e)&&IR(t)&&e.equals(t))}var U1="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(t,r){var n=65535&(t|=0),a=65535&(r|=0);return n*a+((t>>>16)*a+n*(r>>>16)<<16>>>0)|0};function ew(e){return e>>>1&1073741824|3221225471&e}var Bxe=Object.prototype.valueOf;function tu(e){if(null==e)return Fj(e);if("function"==typeof e.hashCode)return ew(e.hashCode(e));var t=function Gxe(e){return e.valueOf!==Bxe&&"function"==typeof e.valueOf?e.valueOf(e):e}(e);if(null==t)return Fj(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return function Nxe(e){if(e!=e||e===1/0)return 0;var t=0|e;for(t!==e&&(t^=4294967295*e);e>4294967295;)t^=e/=4294967295;return ew(t)}(t);case"string":return t.length>zxe?function kxe(e){var t=BR[e];return void 0===t&&(t=PR(e),FR===Hxe&&(FR=0,BR={}),FR++,BR[e]=t),t}(t):PR(t);case"object":case"function":return function Uxe(e){var t;if(MR&&void 0!==(t=RR.get(e))||void 0!==(t=e[Dh])||!Nj&&(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Dh])||(t=function Vxe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e),void 0!==t)))return t;if(t=kj(),MR)RR.set(e,t);else{if(void 0!==Bj&&!1===Bj(e))throw new Error("Non-extensible objects are not allowed as keys.");if(Nj)Object.defineProperty(e,Dh,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Dh]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Dh]=t}}return t}(t);case"symbol":return function Lxe(e){var t=Lj[e];return void 0!==t||(t=kj(),Lj[e]=t),t}(t);default:if("function"==typeof t.toString)return PR(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function Fj(e){return null===e?1108378658:1108378659}function PR(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return ew(t)}var Bj=Object.isExtensible,Nj=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function kj(){var e=++OR;return 1073741824&OR&&(OR=0),e}var RR,MR="function"==typeof WeakMap;MR&&(RR=new WeakMap);var Lj=Object.create(null),OR=0,Dh="__immutablehash__";"function"==typeof Symbol&&(Dh=Symbol(Dh));var zxe=16,Hxe=255,FR=0,BR={},tw=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n,a){return this._iter.get(n,a)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,a=NR(this,!0);return this._useKeys||(a.valueSeq=function(){return n._iter.toSeq().reverse()}),a},t.prototype.map=function(n,a){var i=this,o=Hj(this,n,a);return this._useKeys||(o.valueSeq=function(){return i._iter.toSeq().map(n,a)}),o},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o,s){return n(o,s,i)},a)},t.prototype.__iterator=function(n,a){return this._iter.__iterator(n,a)},t}(jp);tw.prototype[y0]=!0;var Uj=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this,o=0;return a&&h0(this),this._iter.__iterate(function(s){return n(s,a?i.size-++o:o++,i)},a)},t.prototype.__iterator=function(n,a){var i=this,o=this._iter.__iterator(ll,a),s=0;return a&&h0(this),new Ln(function(){var u=o.next();return u.done?u:ka(n,a?i.size-++s:s++,u.value,u)})},t}(hc),Vj=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(ll,a);return new Ln(function(){var o=i.next();return o.done?o:ka(n,o.value,o.value,o)})},t}(S0),Gj=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){if(o){Xj(o);var s=Ps(o);return n(s?o.get(1):o[1],s?o.get(0):o[0],i)}},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(ll,a);return new Ln(function(){for(;;){var o=i.next();if(o.done)return o;var s=o.value;if(s){Xj(s);var u=Ps(s);return ka(n,u?s.get(0):s[0],u?s.get(1):s[1],o)}}})},t}(jp);function zj(e){var t=nd(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=UR,t.__iterateUncached=function(r,n){var a=this;return e.__iterate(function(i,o){return!1!==r(o,i,a)},n)},t.__iteratorUncached=function(r,n){if(r===mc){var a=e.__iterator(r,n);return new Ln(function(){var i=a.next();if(!i.done){var o=i.value[0];i.value[0]=i.value[1],i.value[1]=o}return i})}return e.__iterator(r===ll?L1:ll,n)},t}function Hj(e,t,r){var n=nd(e);return n.size=e.size,n.has=function(a){return e.has(a)},n.get=function(a,i){var o=e.get(a,An);return o===An?i:t.call(r,o,a,e)},n.__iterateUncached=function(a,i){var o=this;return e.__iterate(function(s,u,c){return!1!==a(t.call(r,s,u,c),u,o)},i)},n.__iteratorUncached=function(a,i){var o=e.__iterator(mc,i);return new Ln(function(){var s=o.next();if(s.done)return s;var u=s.value,c=u[0];return ka(a,c,t.call(r,u[1],c,e),s)})},n}function NR(e,t){var r=this,n=nd(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var a=zj(e);return a.reverse=function(){return e.flip()},a}),n.get=function(a,i){return e.get(t?a:-1-a,i)},n.has=function(a){return e.has(t?a:-1-a)},n.includes=function(a){return e.includes(a)},n.cacheResult=UR,n.__iterate=function(a,i){var o=this,s=0;return i&&h0(e),e.__iterate(function(u,c){return a(u,t?c:i?o.size-++s:s++,o)},!i)},n.__iterator=function(a,i){var o=0;i&&h0(e);var s=e.__iterator(mc,!i);return new Ln(function(){var u=s.next();if(u.done)return u;var c=u.value;return ka(a,t?c[0]:i?r.size-++o:o++,c[1],u)})},n}function jj(e,t,r,n){var a=nd(e);return n&&(a.has=function(i){var o=e.get(i,An);return o!==An&&!!t.call(r,o,i,e)},a.get=function(i,o){var s=e.get(i,An);return s!==An&&t.call(r,s,i,e)?s:o}),a.__iterateUncached=function(i,o){var s=this,u=0;return e.__iterate(function(c,l,d){if(t.call(r,c,l,d))return u++,i(c,n?l:u-1,s)},o),u},a.__iteratorUncached=function(i,o){var s=e.__iterator(mc,o),u=0;return new Ln(function(){for(;;){var c=s.next();if(c.done)return c;var l=c.value,d=l[0],f=l[1];if(t.call(r,f,d,e))return ka(i,n?d:u++,f,c)}})},a}function kR(e,t,r,n){var a=e.size;if(B1(t,r,a))return e;var i=v0(t,a),o=N1(r,a);if(i!=i||o!=o)return kR(e.toSeq().cacheResult(),t,r,n);var u,s=o-i;s==s&&(u=s<0?0:s);var c=nd(e);return c.size=0===u?u:e.size&&u||void 0,!n&&Z_(e)&&u>=0&&(c.get=function(l,d){return(l=Hp(this,l))>=0&&l<u?e.get(l+i,d):d}),c.__iterateUncached=function(l,d){var f=this;if(0===u)return 0;if(d)return this.cacheResult().__iterate(l,d);var p=0,m=!0,h=0;return e.__iterate(function(v,g){if(!m||!(m=p++<i))return h++,!1!==l(v,n?g:h-1,f)&&h!==u}),h},c.__iteratorUncached=function(l,d){if(0!==u&&d)return this.cacheResult().__iterator(l,d);if(0===u)return new Ln(Ms);var f=e.__iterator(l,d),p=0,m=0;return new Ln(function(){for(;p++<i;)f.next();if(++m>u)return{value:void 0,done:!0};var h=f.next();return n||l===ll||h.done?h:ka(l,m-1,l===L1?void 0:h.value[1],h)})},c}function qj(e,t,r,n){var a=nd(e);return a.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var u=!0,c=0;return e.__iterate(function(l,d,f){if(!u||!(u=t.call(r,l,d,f)))return c++,i(l,n?d:c-1,s)}),c},a.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var u=e.__iterator(mc,o),c=!0,l=0;return new Ln(function(){var d,f,p;do{if((d=u.next()).done)return n||i===ll?d:ka(i,l++,i===L1?void 0:d.value[1],d);var m=d.value;f=m[0],p=m[1],c&&(c=t.call(r,p,f,s))}while(c);return i===mc?d:ka(i,f,p,d)})},a}function Wj(e,t,r){var n=nd(e);return n.__iterateUncached=function(a,i){if(i)return this.cacheResult().__iterate(a,i);var o=0,s=!1;return function u(c,l){c.__iterate(function(d,f){return(!t||l<t)&&Ps(d)?u(d,l+1):(o++,!1===a(d,r?f:o-1,n)&&(s=!0)),!s},i)}(e,0),o},n.__iteratorUncached=function(a,i){if(i)return this.cacheResult().__iterator(a,i);var o=e.__iterator(a,i),s=[],u=0;return new Ln(function(){for(;o;){var c=o.next();if(!1===c.done){var l=c.value;if(a===mc&&(l=l[1]),t&&!(s.length<t)||!Ps(l))return r?c:ka(a,u++,l,c);s.push(o),o=l.__iterator(a,i)}else o=s.pop()}return{value:void 0,done:!0}})},n}function C0(e,t,r){t||(t=Kj);var n=Da(e),a=0,i=e.toSeq().map(function(o,s){return[s,o,a++,r?r(o,s,e):o]}).valueSeq().toArray();return i.sort(function(o,s){return t(o[3],s[3])||o[2]-s[2]}).forEach(n?function(o,s){i[s].length=2}:function(o,s){i[s]=o[1]}),n?jp(i):es(e)?hc(i):S0(i)}function rw(e,t,r){if(t||(t=Kj),r){var n=e.toSeq().map(function(a,i){return[a,r(a,i,e)]}).reduce(function(a,i){return Yj(t,a[1],i[1])?i:a});return n&&n[0]}return e.reduce(function(a,i){return Yj(t,a,i)?i:a})}function Yj(e,t,r){var n=e(r,t);return 0===n&&r!==t&&(null==r||r!=r)||n>0}function nw(e,t,r,n){var a=nd(e),i=new Th(r).map(function(o){return o.size});return a.size=n?i.max():i.min(),a.__iterate=function(o,s){for(var c,u=this.__iterator(ll,s),l=0;!(c=u.next()).done&&!1!==o(c.value,l++,this););return l},a.__iteratorUncached=function(o,s){var u=r.map(function(d){return d=ai(d),xR(s?d.reverse():d)}),c=0,l=!1;return new Ln(function(){var d;return l||(d=u.map(function(f){return f.next()}),l=n?d.every(function(f){return f.done}):d.some(function(f){return f.done})),l?{value:void 0,done:!0}:ka(o,c++,t.apply(null,d.map(function(f){return f.value})))})},a}function ba(e,t){return e===t?e:Z_(e)?t:e.constructor(t)}function Xj(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function LR(e){return Da(e)?dc:es(e)?wh:g0}function nd(e){return Object.create((Da(e)?jp:es(e)?hc:S0).prototype)}function UR(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Rs.prototype.cacheResult.call(this)}function Kj(e,t){return void 0===e&&void 0===t?0:void 0===e?1:void 0===t?-1:e>t?1:e<t?-1:0}function ad(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),a=0;a<r;a++)n[a]=e[a+t];return n}function VR(e,t){if(!e)throw new Error(t)}function Pu(e){VR(e!==1/0,"Cannot perform this action with an infinite size.")}function Zj(e){if(_R(e)&&"string"!=typeof e)return e;if(pc(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}Uj.prototype.cacheResult=tw.prototype.cacheResult=Vj.prototype.cacheResult=Gj.prototype.cacheResult=UR;var Qxe=Object.prototype.toString;function qp(e){return"object"==typeof e&&(fc(e)||Array.isArray(e)||function GR(e){if(!e||"object"!=typeof e||"[object Object]"!==Qxe.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var r=t,n=Object.getPrototypeOf(t);null!==n;)r=n,n=Object.getPrototypeOf(r);return r===t}(e))}function V1(e){try{return"string"==typeof e?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function zR(e,t,r){return fc(e)?e.get(t,r):function Qj(e,t){return fc(e)?e.has(t):qp(e)&&b0.call(e,t)}(e,t)?"function"==typeof e.get?e.get(t):e[t]:r}function aw(e){if(Array.isArray(e))return ad(e);var t={};for(var r in e)b0.call(e,r)&&(t[r]=e[r]);return t}function Eh(e,t,r,n){n||(n=r,r=void 0);var a=eq(fc(e),e,Zj(t),0,r,n);return a===An?r:a}function eq(e,t,r,n,a,i){var o=t===An;if(n===r.length){var s=o?a:t,u=i(s);return u===s?t:u}if(!o&&!qp(t))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,n).map(V1)+"]: "+t);var c=r[n],l=o?An:zR(t,c,An),d=eq(l===An?e:fc(l),l,r,n+1,a,i);return d===l?t:d===An?function $j(e,t){if(!qp(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(fc(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!b0.call(e,t))return e;var r=aw(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}(t,c):function Jj(e,t,r){if(!qp(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(fc(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(b0.call(e,t)&&r===e[t])return e;var n=aw(e);return n[t]=r,n}(o?e?dl():{}:t,c,d)}function HR(e,t){return function tq(e,t,r){return Eh(e,t,An,function(){return r})}(this,e,t)}function jR(e){return function rq(e,t){return Eh(e,t,function(){return An})}(this,e)}function qR(e,t,r,n){return Eh(e,[t],r,n)}function WR(e,t,r){return 1===arguments.length?e(this):qR(this,e,t,r)}function YR(e,t,r){return Eh(this,e,t,r)}function nq(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return iq(this,e)}function aq(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if("function"!=typeof e)throw new TypeError("Invalid merger function: "+e);return iq(this,t,e)}function iq(e,t,r){for(var n=[],a=0;a<t.length;a++){var i=dc(t[a]);0!==i.size&&n.push(i)}return 0===n.length?e:0!==e.toSeq().size||e.__ownerID||1!==n.length?e.withMutations(function(o){for(var s=r?function(c,l){qR(o,l,An,function(d){return d===An?c:r(d,c,l)})}:function(c,l){o.set(l,c)},u=0;u<n.length;u++)n[u].forEach(s)}):e.constructor(n[0])}function G1(e,t,r){return z1(e,t,function r_e(e){return function t(r,n,a){return qp(r)&&qp(n)&&function n_e(e,t){var r=Rs(e),n=Rs(t);return es(r)===es(n)&&Da(r)===Da(n)}(r,n)?z1(r,[n],t):e?e(r,n,a):n}}(r))}function z1(e,t,r){if(!qp(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(fc(e))return"function"==typeof r&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),a=e,i=n?wh:dc,o=n?function(u){a===e&&(a=aw(a)),a.push(u)}:function(u,c){var l=b0.call(a,c),d=l&&r?r(a[c],u,c):u;(!l||d!==a[c])&&(a===e&&(a=aw(a)),a[c]=d)},s=0;s<t.length;s++)i(t[s]).forEach(o);return a}function oq(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return G1(this,e)}function sq(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return G1(this,t,e)}function XR(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Eh(this,e,dl(),function(n){return z1(n,t)})}function KR(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Eh(this,e,dl(),function(n){return G1(n,t)})}function H1(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function j1(){return this.__ownerID?this:this.__ensureOwner(new bR)}function q1(){return this.__ensureOwner()}function ZR(){return this.__altered}var Mu=function(e){function t(r){return null==r?dl():J_(r)&&!pc(r)?r:dl().withMutations(function(n){var a=e(r);Pu(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return dl().withMutations(function(i){for(var o=0;o<n.length;o+=2){if(o+1>=n.length)throw new Error("Missing value for key: "+n[o]);i.set(n[o],n[o+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,a){return this._root?this._root.get(0,void 0,n,a):a},t.prototype.set=function(n,a){return lq(this,n,a)},t.prototype.remove=function(n){return lq(this,n,An)},t.prototype.deleteAll=function(n){var a=ai(n);return 0===a.size?this:this.withMutations(function(i){a.forEach(function(o){return i.remove(o)})})},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):dl()},t.prototype.sort=function(n){return vc(C0(this,n))},t.prototype.sortBy=function(n,a){return vc(C0(this,a,n))},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){o.forEach(function(s,u){o.set(u,n.call(a,s,u,i))})})},t.prototype.__iterator=function(n,a){return new a_e(this,n,a)},t.prototype.__iterate=function(n,a){var i=this,o=0;return this._root&&this._root.iterate(function(s){return o++,n(s[1],s[0],i)},a),o},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?$R(this.size,this._root,n,this.__hash):0===this.size?dl():(this.__ownerID=n,this.__altered=!1,this)},t}(dc);Mu.isMap=J_;var La=Mu.prototype;La[Oj]=!0,La[F1]=La.remove,La.removeAll=La.deleteAll,La.setIn=HR,La.removeIn=La.deleteIn=jR,La.update=WR,La.updateIn=YR,La.merge=La.concat=nq,La.mergeWith=aq,La.mergeDeep=oq,La.mergeDeepWith=sq,La.mergeIn=XR,La.mergeDeepIn=KR,La.withMutations=H1,La.wasAltered=ZR,La.asImmutable=q1,La["@@transducer/init"]=La.asMutable=j1,La["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])},La["@@transducer/result"]=function(e){return e.asImmutable()};var W1=function(t,r){this.ownerID=t,this.entries=r};W1.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(xo(n,i[o][0]))return i[o][1];return a},W1.prototype.update=function(t,r,n,a,i,o,s){for(var u=i===An,c=this.entries,l=0,d=c.length;l<d&&!xo(a,c[l][0]);l++);var f=l<d;if(f?c[l][1]===i:u)return this;if(lc(s),(u||!f)&&lc(o),!u||1!==c.length){if(!f&&!u&&c.length>=l_e)return function i_e(e,t,r,n){e||(e=new bR);for(var a=new df(e,tu(r),[r,n]),i=0;i<t.length;i++){var o=t[i];a=a.update(e,0,void 0,o[0],o[1])}return a}(t,c,a,i);var p=t&&t===this.ownerID,m=p?c:ad(c);return f?u?l===d-1?m.pop():m[l]=m.pop():m[l]=[a,i]:m.push([a,i]),p?(this.entries=m,this):new W1(t,m)}};var x0=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};x0.prototype.get=function(t,r,n,a){void 0===r&&(r=tu(n));var i=1<<((0===t?r:r>>>t)&Is),o=this.bitmap;return o&i?this.nodes[fq(o&i-1)].get(t+Na,r,n,a):a},x0.prototype.update=function(t,r,n,a,i,o,s){void 0===n&&(n=tu(a));var u=(0===r?n:n>>>r)&Is,c=1<<u,l=this.bitmap,d=0!=(l&c);if(!d&&i===An)return this;var f=fq(l&c-1),p=this.nodes,m=d?p[f]:void 0,h=JR(m,t,r+Na,n,a,i,o,s);if(h===m)return this;if(!d&&h&&p.length>=d_e)return function s_e(e,t,r,n,a){for(var i=0,o=new Array(cc),s=0;0!==r;s++,r>>>=1)o[s]=1&r?t[i++]:void 0;return o[n]=a,new Y1(e,i+1,o)}(t,p,l,u,h);if(d&&!h&&2===p.length&&dq(p[1^f]))return p[1^f];if(d&&h&&1===p.length&&dq(h))return h;var v=t&&t===this.ownerID,g=d?h?l:l^c:l|c,y=d?h?pq(p,f,h,v):function c_e(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var a=new Array(n),i=0,o=0;o<n;o++)o===t&&(i=1),a[o]=e[o+i];return a}(p,f,v):function u_e(e,t,r,n){var a=e.length+1;if(n&&t+1===a)return e[t]=r,e;for(var i=new Array(a),o=0,s=0;s<a;s++)s===t?(i[s]=r,o=-1):i[s]=e[s+o];return i}(p,f,h,v);return v?(this.bitmap=g,this.nodes=y,this):new x0(t,g,y)};var Y1=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};Y1.prototype.get=function(t,r,n,a){void 0===r&&(r=tu(n));var o=this.nodes[(0===t?r:r>>>t)&Is];return o?o.get(t+Na,r,n,a):a},Y1.prototype.update=function(t,r,n,a,i,o,s){void 0===n&&(n=tu(a));var u=(0===r?n:n>>>r)&Is,l=this.nodes,d=l[u];if(i===An&&!d)return this;var f=JR(d,t,r+Na,n,a,i,o,s);if(f===d)return this;var p=this.count;if(d){if(!f&&--p<f_e)return function o_e(e,t,r,n){for(var a=0,i=0,o=new Array(r),s=0,u=1,c=t.length;s<c;s++,u<<=1){var l=t[s];void 0!==l&&s!==n&&(a|=u,o[i++]=l)}return new x0(e,a,o)}(t,l,p,u)}else p++;var m=t&&t===this.ownerID,h=pq(l,u,f,m);return m?(this.count=p,this.nodes=h,this):new Y1(t,p,h)};var _0=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};_0.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(xo(n,i[o][0]))return i[o][1];return a},_0.prototype.update=function(t,r,n,a,i,o,s){void 0===n&&(n=tu(a));var u=i===An;if(n!==this.keyHash)return u?this:(lc(s),lc(o),eO(this,t,r,n,[a,i]));for(var c=this.entries,l=0,d=c.length;l<d&&!xo(a,c[l][0]);l++);var f=l<d;if(f?c[l][1]===i:u)return this;if(lc(s),(u||!f)&&lc(o),u&&2===d)return new df(t,this.keyHash,c[1^l]);var p=t&&t===this.ownerID,m=p?c:ad(c);return f?u?l===d-1?m.pop():m[l]=m.pop():m[l]=[a,i]:m.push([a,i]),p?(this.entries=m,this):new _0(t,this.keyHash,m)};var df=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};df.prototype.get=function(t,r,n,a){return xo(n,this.entry[0])?this.entry[1]:a},df.prototype.update=function(t,r,n,a,i,o,s){var u=i===An,c=xo(a,this.entry[0]);return(c?i===this.entry[1]:u)?this:(lc(s),u?void lc(o):c?t&&t===this.ownerID?(this.entry[1]=i,this):new df(t,this.keyHash,[a,i]):(lc(o),eO(this,t,r,tu(a),[a,i])))},W1.prototype.iterate=_0.prototype.iterate=function(e,t){for(var r=this.entries,n=0,a=r.length-1;n<=a;n++)if(!1===e(r[t?a-n:n]))return!1},x0.prototype.iterate=Y1.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,a=r.length-1;n<=a;n++){var i=r[t?a-n:n];if(i&&!1===i.iterate(e,t))return!1}},df.prototype.iterate=function(e,t){return e(this.entry)};var cq,a_e=function(e){function t(r,n,a){this._type=n,this._reverse=a,this._stack=r._root&&uq(r._root)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.next=function(){for(var n=this._type,a=this._stack;a;){var i=a.node,o=a.index++,s=void 0;if(i.entry){if(0===o)return QR(n,i.entry)}else if(i.entries){if(o<=(s=i.entries.length-1))return QR(n,i.entries[this._reverse?s-o:o])}else if(o<=(s=i.nodes.length-1)){var u=i.nodes[this._reverse?s-o:o];if(u){if(u.entry)return QR(n,u.entry);a=this._stack=uq(u,a)}continue}a=this._stack=this._stack.__prev}return{value:void 0,done:!0}},t}(Ln);function QR(e,t){return ka(e,t[0],t[1])}function uq(e,t){return{node:e,index:0,__prev:t}}function $R(e,t,r,n){var a=Object.create(La);return a.size=e,a._root=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}function dl(){return cq||(cq=$R(0))}function lq(e,t,r){var n,a;if(e._root){var i={value:!1},o={value:!1};if(n=JR(e._root,e.__ownerID,0,void 0,t,r,i,o),!o.value)return e;a=e.size+(i.value?r===An?-1:1:0)}else{if(r===An)return e;a=1,n=new W1(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=a,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?$R(a,n):dl()}function JR(e,t,r,n,a,i,o,s){return e?e.update(t,r,n,a,i,o,s):i===An?e:(lc(s),lc(o),new df(t,n,[a,i]))}function dq(e){return e.constructor===df||e.constructor===_0}function eO(e,t,r,n,a){if(e.keyHash===n)return new _0(t,n,[e.entry,a]);var s,i=(0===r?e.keyHash:e.keyHash>>>r)&Is,o=(0===r?n:n>>>r)&Is,u=i===o?[eO(e,t,r+Na,n,a)]:(s=new df(t,n,a),i<o?[e,s]:[s,e]);return new x0(t,1<<i|1<<o,u)}function fq(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,127&(e+=e>>8)+(e>>16)}function pq(e,t,r,n){var a=n?e:ad(e);return a[t]=r,a}var l_e=cc/4,d_e=cc/2,f_e=cc/4,mq="@@__IMMUTABLE_LIST__@@";function tO(e){return!(!e||!e[mq])}var ff=function(e){function t(r){var n=iw();if(null==r)return n;if(tO(r))return r;var a=e(r),i=a.size;return 0===i?n:(Pu(i),i>0&&i<cc?K1(0,i,Na,null,new Wp(a.toArray())):n.withMutations(function(o){o.setSize(i),a.forEach(function(s,u){return o.set(u,s)})}))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,a){if((n=Hp(this,n))>=0&&n<this.size){var i=gq(this,n+=this._origin);return i&&i.array[n&Is]}return a},t.prototype.set=function(n,a){return function p_e(e,t,r){if((t=Hp(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function(o){t<0?Yp(o,t).set(0,r):Yp(o,0,t+1).set(t,r)});var n=e._tail,a=e._root,i={value:!1};return(t+=e._origin)>=Z1(e._capacity)?n=rO(n,e.__ownerID,0,t,r,i):a=rO(a,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=a,e._tail=n,e.__hash=void 0,e.__altered=!0,e):K1(e._origin,e._capacity,e._level,a,n):e}(this,n,a)},t.prototype.remove=function(n){return this.has(n)?0===n?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,a){return this.splice(n,0,a)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Na,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):iw()},t.prototype.push=function(){var n=arguments,a=this.size;return this.withMutations(function(i){Yp(i,0,a+n.length);for(var o=0;o<n.length;o++)i.set(a+o,n[o])})},t.prototype.pop=function(){return Yp(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(a){Yp(a,-n.length);for(var i=0;i<n.length;i++)a.set(i,n[i])})},t.prototype.shift=function(){return Yp(this,1)},t.prototype.concat=function(){for(var n=arguments,a=[],i=0;i<arguments.length;i++){var o=n[i],s=e("string"!=typeof o&&CR(o)?o:[o]);0!==s.size&&a.push(s)}return 0===a.length?this:0!==this.size||this.__ownerID||1!==a.length?this.withMutations(function(u){a.forEach(function(c){return c.forEach(function(l){return u.push(l)})})}):this.constructor(a[0])},t.prototype.setSize=function(n){return Yp(this,0,n)},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){for(var s=0;s<i.size;s++)o.set(s,n.call(a,o.get(s),s,i))})},t.prototype.slice=function(n,a){var i=this.size;return B1(n,a,i)?this:Yp(this,v0(n,i),N1(a,i))},t.prototype.__iterator=function(n,a){var i=a?this.size:0,o=hq(this,a);return new Ln(function(){var s=o();return s===X1?{value:void 0,done:!0}:ka(n,a?--i:i++,s)})},t.prototype.__iterate=function(n,a){for(var s,i=a?this.size:0,o=hq(this,a);(s=o())!==X1&&!1!==n(s,a?--i:i++,this););return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?K1(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):0===this.size?iw():(this.__ownerID=n,this.__altered=!1,this)},t}(wh);ff.isList=tO;var Yi=ff.prototype;Yi[mq]=!0,Yi[F1]=Yi.remove,Yi.merge=Yi.concat,Yi.setIn=HR,Yi.deleteIn=Yi.removeIn=jR,Yi.update=WR,Yi.updateIn=YR,Yi.mergeIn=XR,Yi.mergeDeepIn=KR,Yi.withMutations=H1,Yi.wasAltered=ZR,Yi.asImmutable=q1,Yi["@@transducer/init"]=Yi.asMutable=j1,Yi["@@transducer/step"]=function(e,t){return e.push(t)},Yi["@@transducer/result"]=function(e){return e.asImmutable()};var Wp=function(t,r){this.array=t,this.ownerID=r};Wp.prototype.removeBefore=function(t,r,n){if(n===r?1<<r:0===this.array.length)return this;var a=n>>>r&Is;if(a>=this.array.length)return new Wp([],t);var o,i=0===a;if(r>0){var s=this.array[a];if((o=s&&s.removeBefore(t,r-Na,n))===s&&i)return this}if(i&&!o)return this;var u=w0(this,t);if(!i)for(var c=0;c<a;c++)u.array[c]=void 0;return o&&(u.array[a]=o),u},Wp.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r:0)||0===this.array.length)return this;var i,a=n-1>>>r&Is;if(a>=this.array.length)return this;if(r>0){var o=this.array[a];if((i=o&&o.removeAfter(t,r-Na,n))===o&&a===this.array.length-1)return this}var s=w0(this,t);return s.array.splice(a+1),i&&(s.array[a]=i),s};var vq,X1={};function hq(e,t){var r=e._origin,n=e._capacity,a=Z1(n),i=e._tail;return function o(c,l,d){return 0===l?function s(c,l){var d=l===a?i&&i.array:c&&c.array,f=l>r?0:r-l,p=n-l;return p>cc&&(p=cc),function(){if(f===p)return X1;var m=t?--p:f++;return d&&d[m]}}(c,d):function u(c,l,d){var f,p=c&&c.array,m=d>r?0:r-d>>l,h=1+(n-d>>l);return h>cc&&(h=cc),function(){for(;;){if(f){var v=f();if(v!==X1)return v;f=null}if(m===h)return X1;var g=t?--h:m++;f=o(p&&p[g],l-Na,d+(g<<l))}}}(c,l,d)}(e._root,e._level,0)}function K1(e,t,r,n,a,i,o){var s=Object.create(Yi);return s.size=t-e,s._origin=e,s._capacity=t,s._level=r,s._root=n,s._tail=a,s.__ownerID=i,s.__hash=o,s.__altered=!1,s}function iw(){return vq||(vq=K1(0,0,Na))}function rO(e,t,r,n,a,i){var u,o=n>>>r&Is,s=e&&o<e.array.length;if(!s&&void 0===a)return e;if(r>0){var c=e&&e.array[o],l=rO(c,t,r-Na,n,a,i);return l===c?e:((u=w0(e,t)).array[o]=l,u)}return s&&e.array[o]===a?e:(i&&lc(i),u=w0(e,t),void 0===a&&o===u.array.length-1?u.array.pop():u.array[o]=a,u)}function w0(e,t){return t&&e&&t===e.ownerID?e:new Wp(e?e.array.slice():[],t)}function gq(e,t){if(t>=Z1(e._capacity))return e._tail;if(t<1<<e._level+Na){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&Is],n-=Na;return r}}function Yp(e,t,r){void 0!==t&&(t|=0),void 0!==r&&(r|=0);var n=e.__ownerID||new bR,a=e._origin,i=e._capacity,o=a+t,s=void 0===r?i:r<0?i+r:a+r;if(o===a&&s===i)return e;if(o>=s)return e.clear();for(var u=e._level,c=e._root,l=0;o+l<0;)c=new Wp(c&&c.array.length?[void 0,c]:[],n),l+=1<<(u+=Na);l&&(o+=l,a+=l,s+=l,i+=l);for(var d=Z1(i),f=Z1(s);f>=1<<u+Na;)c=new Wp(c&&c.array.length?[c]:[],n),u+=Na;var p=e._tail,m=f<d?gq(e,s-1):f>d?new Wp([],n):p;if(p&&f>d&&o<i&&p.array.length){for(var h=c=w0(c,n),v=u;v>Na;v-=Na){var g=d>>>v&Is;h=h.array[g]=w0(h.array[g],n)}h.array[d>>>Na&Is]=p}if(s<i&&(m=m&&m.removeAfter(n,0,s)),o>=f)o-=f,s-=f,u=Na,c=null,m=m&&m.removeBefore(n,0,o);else if(o>a||f<d){for(l=0;c;){var y=o>>>u&Is;if(y!==f>>>u&Is)break;y&&(l+=(1<<u)*y),u-=Na,c=c.array[y]}c&&o>a&&(c=c.removeBefore(n,u,o-l)),c&&f<d&&(c=c.removeAfter(n,u,f-l)),l&&(o-=l,s-=l)}return e.__ownerID?(e.size=s-o,e._origin=o,e._capacity=s,e._level=u,e._root=c,e._tail=m,e.__hash=void 0,e.__altered=!0,e):K1(o,s,u,c,m)}function Z1(e){return e<cc?0:e-1>>>Na<<Na}var yq,vc=function(e){function t(r){return null==r?Q1():ER(r)?r:Q1().withMutations(function(n){var a=dc(r);Pu(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,a){var i=this._map.get(n);return void 0!==i?this._list.get(i)[1]:a},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Q1()},t.prototype.set=function(n,a){return bq(this,n,a)},t.prototype.remove=function(n){return bq(this,n,An)},t.prototype.__iterate=function(n,a){var i=this;return this._list.__iterate(function(o){return o&&n(o[1],o[0],i)},a)},t.prototype.__iterator=function(n,a){return this._list.fromEntrySeq().__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?nO(a,i,n,this.__hash):0===this.size?Q1():(this.__ownerID=n,this.__altered=!1,this._map=a,this._list=i,this)},t}(Mu);function nO(e,t,r,n){var a=Object.create(vc.prototype);return a.size=e?e.size:0,a._map=e,a._list=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}function Q1(){return yq||(yq=nO(dl(),iw()))}function bq(e,t,r){var s,u,n=e._map,a=e._list,i=n.get(t),o=void 0!==i;if(r===An){if(!o)return e;a.size>=cc&&a.size>=2*n.size?(s=(u=a.filter(function(c,l){return void 0!==c&&i!==l})).toKeyedSeq().map(function(c){return c[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=u.__ownerID=e.__ownerID)):(s=n.remove(t),u=i===a.size-1?a.pop():a.set(i,void 0))}else if(o){if(r===a.get(i)[1])return e;s=n,u=a.set(i,[t,r])}else s=n.set(t,a.size),u=a.set(a.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=u,e.__hash=void 0,e.__altered=!0,e):nO(s,u)}vc.isOrderedMap=ER,vc.prototype[y0]=!0,vc.prototype[F1]=vc.prototype.remove;var Sq="@@__IMMUTABLE_STACK__@@";function ow(e){return!(!e||!e[Sq])}var sw=function(e){function t(r){return null==r?uw():ow(r)?r:uw().pushAll(r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,a){var i=this._head;for(n=Hp(this,n);i&&n--;)i=i.next;return i?i.value:a},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(0===arguments.length)return this;for(var a=this.size+arguments.length,i=this._head,o=arguments.length-1;o>=0;o--)i={value:n[o],next:i};return this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):$1(a,i)},t.prototype.pushAll=function(n){if(0===(n=e(n)).size)return this;if(0===this.size&&ow(n))return n;Pu(n.size);var a=this.size,i=this._head;return n.__iterate(function(o){a++,i={value:o,next:i}},!0),this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):$1(a,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):uw()},t.prototype.slice=function(n,a){if(B1(n,a,this.size))return this;var i=v0(n,this.size);if(N1(a,this.size)!==this.size)return e.prototype.slice.call(this,n,a);for(var s=this.size-i,u=this._head;i--;)u=u.next;return this.__ownerID?(this.size=s,this._head=u,this.__hash=void 0,this.__altered=!0,this):$1(s,u)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?$1(this.size,this._head,n,this.__hash):0===this.size?uw():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,a){var i=this;if(a)return new Th(this.toArray()).__iterate(function(u,c){return n(u,c,i)},a);for(var o=0,s=this._head;s&&!1!==n(s.value,o++,this);)s=s.next;return o},t.prototype.__iterator=function(n,a){if(a)return new Th(this.toArray()).__iterator(n,a);var i=0,o=this._head;return new Ln(function(){if(o){var s=o.value;return o=o.next,ka(n,i++,s)}return{value:void 0,done:!0}})},t}(wh);sw.isStack=ow;var Cq,Os=sw.prototype;function $1(e,t,r,n){var a=Object.create(Os);return a.size=e,a._head=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}function uw(){return Cq||(Cq=$1(0))}Os[Sq]=!0,Os.shift=Os.pop,Os.unshift=Os.push,Os.unshiftAll=Os.pushAll,Os.withMutations=H1,Os.wasAltered=ZR,Os.asImmutable=q1,Os["@@transducer/init"]=Os.asMutable=j1,Os["@@transducer/step"]=function(e,t){return e.unshift(t)},Os["@@transducer/result"]=function(e){return e.asImmutable()};var xq="@@__IMMUTABLE_SET__@@";function cw(e){return!(!e||!e[xq])}function aO(e){return cw(e)&&pc(e)}function iO(e,t){if(e===t)return!0;if(!Ps(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||Da(e)!==Da(t)||es(e)!==es(t)||pc(e)!==pc(t))return!1;if(0===e.size&&0===t.size)return!0;var r=!k1(e);if(pc(e)){var n=e.entries();return t.every(function(u,c){var l=n.next().value;return l&&xo(l[1],u)&&(r||xo(l[0],c))})&&n.next().done}var a=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{a=!0;var i=e;e=t,t=i}var o=!0,s=t.__iterate(function(u,c){if(r?!e.has(u):a?!xo(u,e.get(c,An)):!xo(e.get(c,An),u))return o=!1,!1});return o&&e.size===s}function Ih(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function lw(e){if(!e||"object"!=typeof e)return e;if(!Ps(e)){if(!qp(e))return e;e=Rs(e)}if(Da(e)){var t={};return e.__iterate(function(n,a){t[a]=lw(n)}),t}var r=[];return e.__iterate(function(n){r.push(lw(n))}),r}var J1=function(e){function t(r){return null==r?eS():cw(r)&&!pc(r)?r:eS().withMutations(function(n){var a=e(r);Pu(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(dc(n).keySeq())},t.intersect=function(n){return(n=ai(n).toArray()).length?Go.intersect.apply(t(n.pop()),n):eS()},t.union=function(n){return(n=ai(n).toArray()).length?Go.union.apply(t(n.pop()),n):eS()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return dw(this,this._map.set(n,n))},t.prototype.remove=function(n){return dw(this,this._map.remove(n))},t.prototype.clear=function(){return dw(this,this._map.clear())},t.prototype.map=function(n,a){var i=this,o=!1,s=dw(this,this._map.mapEntries(function(u){var c=u[1],l=n.call(a,c,c,i);return l!==c&&(o=!0),[l,l]},a));return o?s:this},t.prototype.union=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return 0===(n=n.filter(function(i){return 0!==i.size})).length?this:0!==this.size||this.__ownerID||1!==n.length?this.withMutations(function(i){for(var o=0;o<n.length;o++)"string"==typeof n[o]?i.add(n[o]):e(n[o]).forEach(function(s){return i.add(s)})}):this.constructor(n[0])},t.prototype.intersect=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(0===n.length)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.every(function(s){return s.includes(o)})||i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.subtract=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(0===n.length)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.some(function(s){return s.includes(o)})&&i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.sort=function(n){return gc(C0(this,n))},t.prototype.sortBy=function(n,a){return gc(C0(this,a,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,a){var i=this;return this._map.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){return this._map.__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n);return n?this.__make(a,n):0===this.size?this.__empty():(this.__ownerID=n,this._map=a,this)},t}(g0);J1.isSet=cw;var wq,Go=J1.prototype;function dw(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function _q(e,t){var r=Object.create(Go);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function eS(){return wq||(wq=_q(dl()))}Go[xq]=!0,Go[F1]=Go.remove,Go.merge=Go.concat=Go.union,Go.withMutations=H1,Go.asImmutable=q1,Go["@@transducer/init"]=Go.asMutable=j1,Go["@@transducer/step"]=function(e,t){return e.add(t)},Go["@@transducer/result"]=function(e){return e.asImmutable()},Go.__empty=eS,Go.__make=_q;var oO,Aq=function(e){function t(r,n,a){if(!(this instanceof t))return new t(r,n,a);if(VR(0!==a,"Cannot step a Range by 0"),r=r||0,void 0===n&&(n=1/0),a=void 0===a?1:Math.abs(a),n<r&&(a=-a),this._start=r,this._end=n,this._step=a,this.size=Math.max(0,Math.ceil((n-r)/a-1)+1),0===this.size){if(oO)return oO;oO=this}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},t.prototype.get=function(n,a){return this.has(n)?this._start+Hp(this,n)*this._step:a},t.prototype.includes=function(n){var a=(n-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},t.prototype.slice=function(n,a){return B1(n,a,this.size)?this:(n=v0(n,this.size),(a=N1(a,this.size))<=n?new t(0,0):new t(this.get(n,this._end),this.get(a,this._end),this._step))},t.prototype.indexOf=function(n){var a=n-this._start;if(a%this._step==0){var i=a/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,a){for(var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;u!==i&&!1!==n(s,a?i-++u:u++,this);)s+=a?-o:o;return u},t.prototype.__iterator=function(n,a){var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;return new Ln(function(){if(u===i)return{value:void 0,done:!0};var c=s;return s+=a?-o:o,ka(n,a?i-++u:u++,c)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:iO(this,n)},t}(hc);function sO(e,t,r){for(var n=Zj(t),a=0;a!==n.length;)if((e=zR(e,n[a++],An))===An)return r;return e}function Tq(e,t){return sO(this,e,t)}function Eq(){Pu(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}ai.isIterable=Ps,ai.isKeyed=Da,ai.isIndexed=es,ai.isAssociative=k1,ai.isOrdered=pc,ai.Iterator=Ln,Ih(ai,{toArray:function(){Pu(this.size);var t=new Array(this.size||0),r=Da(this),n=0;return this.__iterate(function(a,i){t[n++]=r?[i,a]:a}),t},toIndexedSeq:function(){return new Uj(this)},toJS:function(){return lw(this)},toKeyedSeq:function(){return new tw(this,!0)},toMap:function(){return Mu(this.toKeyedSeq())},toObject:Eq,toOrderedMap:function(){return vc(this.toKeyedSeq())},toOrderedSet:function(){return gc(Da(this)?this.valueSeq():this)},toSet:function(){return J1(Da(this)?this.valueSeq():this)},toSetSeq:function(){return new Vj(this)},toSeq:function(){return es(this)?this.toIndexedSeq():Da(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return sw(Da(this)?this.valueSeq():this)},toList:function(){return ff(Da(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return 0===this.size?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return ba(this,function Xxe(e,t){var r=Da(e),n=[e].concat(t).map(function(o){return Ps(o)?r&&(o=dc(o)):o=r?TR(o):Rj(Array.isArray(o)?o:[o]),o}).filter(function(o){return 0!==o.size});if(0===n.length)return e;if(1===n.length){var a=n[0];if(a===e||r&&Da(a)||es(e)&&es(a))return a}var i=new Th(n);return r?i=i.toKeyedSeq():es(e)||(i=i.toSetSeq()),(i=i.flatten(!0)).size=n.reduce(function(o,s){if(void 0!==o){var u=s.size;if(void 0!==u)return o+u}},0),i}(this,t))},includes:function(t){return this.some(function(r){return xo(r,t)})},entries:function(){return this.__iterator(mc)},every:function(t,r){Pu(this.size);var n=!0;return this.__iterate(function(a,i,o){if(!t.call(r,a,i,o))return n=!1,!1}),n},filter:function(t,r){return ba(this,jj(this,t,r,!0))},partition:function(t,r){return function Wxe(e,t,r){var n=Da(e),a=[[],[]];e.__iterate(function(o,s){a[t.call(r,o,s,e)?1:0].push(n?[s,o]:o)});var i=LR(e);return a.map(function(o){return ba(e,i(o))})}(this,t,r)},find:function(t,r,n){var a=this.findEntry(t,r);return a?a[1]:n},forEach:function(t,r){return Pu(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){Pu(this.size),t=void 0!==t?""+t:",";var r="",n=!0;return this.__iterate(function(a){n?n=!1:r+=t,r+=null!=a?a.toString():""}),r},keys:function(){return this.__iterator(L1)},map:function(t,r){return ba(this,Hj(this,t,r))},reduce:function(t,r,n){return Iq(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return Iq(this,t,r,n,arguments.length<2,!0)},reverse:function(){return ba(this,NR(this,!0))},slice:function(t,r){return ba(this,kR(this,t,r,!0))},some:function(t,r){Pu(this.size);var n=!1;return this.__iterate(function(a,i,o){if(t.call(r,a,i,o))return n=!0,!1}),n},sort:function(t){return ba(this,C0(this,t))},values:function(){return this.__iterator(ll)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(t,r){return h0(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return function jxe(e,t,r){var n=Mu().asMutable();return e.__iterate(function(a,i){n.update(t.call(r,a,i,e),0,function(o){return o+1})}),n.asImmutable()}(this,t,r)},equals:function(t){return iO(this,t)},entrySeq:function(){var t=this;if(t._cache)return new Th(t._cache);var r=t.toSeq().map(v_e).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(uO(t),r)},findEntry:function(t,r,n){var a=n;return this.__iterate(function(i,o,s){if(t.call(r,i,o,s))return a=[o,i],!1}),a},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(Cj,null,t)},flatMap:function(t,r){return ba(this,function Kxe(e,t,r){var n=LR(e);return e.toSeq().map(function(a,i){return n(t.call(r,a,i,e))}).flatten(!0)}(this,t,r))},flatten:function(t){return ba(this,Wj(this,t,!0))},fromEntrySeq:function(){return new Gj(this)},get:function(t,r){return this.find(function(n,a){return xo(a,t)},void 0,r)},getIn:Tq,groupBy:function(t,r){return function qxe(e,t,r){var n=Da(e),a=(pc(e)?vc():Mu()).asMutable();e.__iterate(function(o,s){a.update(t.call(r,o,s,e),function(u){return(u=u||[]).push(n?[s,o]:o),u})});var i=LR(e);return a.map(function(o){return ba(e,i(o))}).asImmutable()}(this,t,r)},has:function(t){return this.get(t,An)!==An},hasIn:function m_e(e){return function Dq(e,t){return sO(e,t,An)!==An}(this,e)},isSubset:function(t){return t="function"==typeof t.includes?t:ai(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return(t="function"==typeof t.isSubset?t:ai(t)).isSubset(this)},keyOf:function(t){return this.findKey(function(r){return xo(r,t)})},keySeq:function(){return this.toSeq().map(h_e).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return rw(this,t)},maxBy:function(t,r){return rw(this,r,t)},min:function(t){return rw(this,t?Pq(t):Rq)},minBy:function(t,r){return rw(this,r?Pq(r):Rq,t)},rest:function(){return this.slice(1)},skip:function(t){return 0===t?this:this.slice(Math.max(0,t))},skipLast:function(t){return 0===t?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return ba(this,qj(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(uO(t),r)},sortBy:function(t,r){return ba(this,C0(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return ba(this,function Yxe(e,t,r){var n=nd(e);return n.__iterateUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterate(a,i);var s=0;return e.__iterate(function(u,c,l){return t.call(r,u,c,l)&&++s&&a(u,c,o)}),s},n.__iteratorUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterator(a,i);var s=e.__iterator(mc,i),u=!0;return new Ln(function(){if(!u)return{value:void 0,done:!0};var c=s.next();if(c.done)return c;var l=c.value,d=l[0],f=l[1];return t.call(r,f,d,o)?a===mc?c:ka(a,d,f,c):(u=!1,{value:void 0,done:!0})})},n}(this,t,r))},takeUntil:function(t,r){return this.takeWhile(uO(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function g_e(e){if(e.size===1/0)return 0;var t=pc(e),r=Da(e),n=t?1:0;return function y_e(e,t){return t=U1(t,3432918353),t=U1(t<<15|t>>>-15,461845907),t=U1(t<<13|t>>>-13,5),t=U1((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=ew((t=U1(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(r?t?function(i,o){n=31*n+Oq(tu(i),tu(o))|0}:function(i,o){n=n+Oq(tu(i),tu(o))|0}:t?function(i){n=31*n+tu(i)|0}:function(i){n=n+tu(i)|0}),n)}(this))}});var ts=ai.prototype;ts[wj]=!0,ts[Q_]=ts.values,ts.toJSON=ts.toArray,ts.__toStringMapper=V1,ts.inspect=ts.toSource=function(){return this.toString()},ts.chain=ts.flatMap,ts.contains=ts.includes,Ih(dc,{flip:function(){return ba(this,zj(this))},mapEntries:function(t,r){var n=this,a=0;return ba(this,this.toSeq().map(function(i,o){return t.call(r,[o,i],a++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return ba(this,this.toSeq().flip().map(function(a,i){return t.call(r,a,i,n)}).flip())}});var tS=dc.prototype;tS[Aj]=!0,tS[Q_]=ts.entries,tS.toJSON=Eq,tS.__toStringMapper=function(e,t){return V1(t)+": "+V1(e)},Ih(wh,{toKeyedSeq:function(){return new tw(this,!1)},filter:function(t,r){return ba(this,jj(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return void 0===r?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return void 0===r?-1:r},reverse:function(){return ba(this,NR(this,!1))},slice:function(t,r){return ba(this,kR(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),0===n||2===n&&!r)return this;t=v0(t,t<0?this.count():this.size);var a=this.slice(0,t);return ba(this,1===n?a:a.concat(ad(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return ba(this,Wj(this,t,!1))},get:function(t,r){return(t=Hp(this,t))<0||this.size===1/0||void 0!==this.size&&t>this.size?r:this.find(function(n,a){return a===t},void 0,r)},has:function(t){return(t=Hp(this,t))>=0&&(void 0!==this.size?this.size===1/0||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return ba(this,function Zxe(e,t){var r=nd(e);return r.size=e.size&&2*e.size-1,r.__iterateUncached=function(n,a){var i=this,o=0;return e.__iterate(function(s){return(!o||!1!==n(t,o++,i))&&!1!==n(s,o++,i)},a),o},r.__iteratorUncached=function(n,a){var s,i=e.__iterator(ll,a),o=0;return new Ln(function(){return(!s||o%2)&&(s=i.next()).done?s:o%2?ka(n,o++,t):ka(n,o++,s.value,s)})},r}(this,t))},interleave:function(){var t=[this].concat(ad(arguments)),r=nw(this.toSeq(),hc.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),ba(this,n)},keySeq:function(){return Aq(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return ba(this,qj(this,t,r,!1))},zip:function(){return ba(this,nw(this,Mq,[this].concat(ad(arguments))))},zipAll:function(){return ba(this,nw(this,Mq,[this].concat(ad(arguments)),!0))},zipWith:function(t){var r=ad(arguments);return r[0]=this,ba(this,nw(this,t,r))}});var A0=wh.prototype;A0[Tj]=!0,A0[y0]=!0,Ih(g0,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var T0=g0.prototype;function Iq(e,t,r,n,a,i){return Pu(e.size),e.__iterate(function(o,s,u){a?(a=!1,r=o):r=t.call(n,r,o,s,u)},i),r}function h_e(e,t){return t}function v_e(e,t){return[t,e]}function uO(e){return function(){return!e.apply(this,arguments)}}function Pq(e){return function(){return-e.apply(this,arguments)}}function Mq(){return ad(arguments)}function Rq(e,t){return e<t?1:e>t?-1:0}function Oq(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}T0.has=ts.includes,T0.contains=T0.includes,T0.keys=T0.values,Ih(jp,tS),Ih(hc,A0),Ih(S0,T0);var gc=function(e){function t(r){return null==r?cO():aO(r)?r:cO().withMutations(function(n){var a=g0(r);Pu(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(dc(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(J1);gc.isOrderedSet=aO;var Bq,Ph=gc.prototype;function Fq(e,t){var r=Object.create(Ph);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function cO(){return Bq||(Bq=Fq(Q1()))}Ph[y0]=!0,Ph.zip=A0.zip,Ph.zipWith=A0.zipWith,Ph.zipAll=A0.zipAll,Ph.__empty=cO,Ph.__make=Fq;var ho=function(t,r){var n;!function S_e(e){if(Ah(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(fc(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(null===e||"object"!=typeof e)throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}(t);var a=function(s){var u=this;if(s instanceof a)return s;if(!(this instanceof a))return new a(s);if(!n){n=!0;var c=Object.keys(t),l=i._indices={};i._name=r,i._keys=c,i._defaultValues=t;for(var d=0;d<c.length;d++){var f=c[d];l[f]=d,i[f]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+dO(this)+' with property "'+f+'" since that property name is part of the Record API.'):C_e(i,f)}}return this.__ownerID=void 0,this._values=ff().withMutations(function(p){p.setSize(u._keys.length),dc(s).forEach(function(m,h){p.set(u._indices[h],m===u._defaultValues[h]?void 0:m)})}),this},i=a.prototype=Object.create(Ea);return i.constructor=a,r&&(a.displayName=r),a};ho.prototype.toString=function(){for(var n,t=dO(this)+" { ",r=this._keys,a=0,i=r.length;a!==i;a++)t+=(a?", ":"")+(n=r[a])+": "+V1(this.get(n));return t+" }"},ho.prototype.equals=function(t){return this===t||Ah(t)&&D0(this).equals(D0(t))},ho.prototype.hashCode=function(){return D0(this).hashCode()},ho.prototype.has=function(t){return this._indices.hasOwnProperty(t)},ho.prototype.get=function(t,r){if(!this.has(t))return r;var a=this._values.get(this._indices[t]);return void 0===a?this._defaultValues[t]:a},ho.prototype.set=function(t,r){if(this.has(t)){var n=this._values.set(this._indices[t],r===this._defaultValues[t]?void 0:r);if(n!==this._values&&!this.__ownerID)return lO(this,n)}return this},ho.prototype.remove=function(t){return this.set(t)},ho.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:lO(this,t)},ho.prototype.wasAltered=function(){return this._values.wasAltered()},ho.prototype.toSeq=function(){return D0(this)},ho.prototype.toJS=function(){return lw(this)},ho.prototype.entries=function(){return this.__iterator(mc)},ho.prototype.__iterator=function(t,r){return D0(this).__iterator(t,r)},ho.prototype.__iterate=function(t,r){return D0(this).__iterate(t,r)},ho.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._values.__ensureOwner(t);return t?lO(this,r,t):(this.__ownerID=t,this._values=r,this)},ho.isRecord=Ah,ho.getDescriptiveName=dO;var Ea=ho.prototype;function lO(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._values=t,n.__ownerID=r,n}function dO(e){return e.constructor.displayName||e.constructor.name||"Record"}function D0(e){return TR(e._keys.map(function(t){return[t,e.get(t)]}))}function C_e(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){VR(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}catch{}}Ea[Ej]=!0,Ea[F1]=Ea.remove,Ea.deleteIn=Ea.removeIn=jR,Ea.getIn=Tq,Ea.hasIn=ts.hasIn,Ea.merge=nq,Ea.mergeWith=aq,Ea.mergeIn=XR,Ea.mergeDeep=oq,Ea.mergeDeepWith=sq,Ea.mergeDeepIn=KR,Ea.setIn=HR,Ea.update=WR,Ea.updateIn=YR,Ea.withMutations=H1,Ea.asMutable=j1,Ea.asImmutable=q1,Ea[Q_]=Ea.entries,Ea.toJSON=Ea.toObject=ts.toObject,Ea.inspect=Ea.toSource=function(){return this.toString()};var mn=1e-6;function ea(e,t,r){return Math.abs(e-t)<=r}function Xi(e,t,r){return Math.max(t,Math.min(r,e))}function ta(e,t,r){return e+(t-e)*r}function fw(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a;return(2*t-2*r+o+s)*(a*u)+(-3*t+3*r-2*o-s)*u+o*a+t}function hO(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function kq(e,t,r){return(r=function mO(e){return Xi(e,0,1)}(function pO(e,t,r){return(e-t)/(r-t)}(r,e,t)))*r*(3-2*r)}var vO=isFinite;function b(){return b.zero()}!function(e){function t(){var oe=[.1,0,0];return oe[0]=0,oe}function l(oe,be,Ce){var Qe=t();return Qe[0]=oe,Qe[1]=be,Qe[2]=Ce,Qe}function p(oe,be){return oe[0]=be[0],oe[1]=be[1],oe[2]=be[2],oe}function m(oe,be,Ce){return oe[0]=be[0]+Ce[0],oe[1]=be[1]+Ce[1],oe[2]=be[2]+Ce[2],oe}function h(oe,be,Ce){return oe[0]=be[0]-Ce[0],oe[1]=be[1]-Ce[1],oe[2]=be[2]-Ce[2],oe}function y(oe,be,Ce){return oe[0]=be[0]*Ce,oe[1]=be[1]*Ce,oe[2]=be[2]*Ce,oe}function S(oe,be,Ce,Qe){return oe[0]=be[0]+Ce[0]*Qe,oe[1]=be[1]+Ce[1]*Qe,oe[2]=be[2]+Ce[2]*Qe,oe}function z(oe){var be=oe[0],Ce=oe[1],Qe=oe[2];return be*be+Ce*Ce+Qe*Qe}function J(oe,be){return oe[0]=-be[0],oe[1]=-be[1],oe[2]=-be[2],oe}function Z(oe,be){var Ce=be[0],Qe=be[1],Et=be[2],At=Ce*Ce+Qe*Qe+Et*Et;return At>0&&(At=1/Math.sqrt(At),oe[0]=be[0]*At,oe[1]=be[1]*At,oe[2]=be[2]*At),oe}function ne(oe,be){return oe[0]*be[0]+oe[1]*be[1]+oe[2]*be[2]}function Y(oe,be,Ce){var Qe=be[0],Et=be[1],At=be[2],Zt=Ce[0],Dr=Ce[1],tr=Ce[2];return oe[0]=Et*tr-At*Dr,oe[1]=At*Zt-Qe*tr,oe[2]=Qe*Dr-Et*Zt,oe}e.zero=t,e.clone=function r(oe){var be=t();return be[0]=oe[0],be[1]=oe[1],be[2]=oe[2],be},e.isFinite=function n(oe){return vO(oe[0])&&vO(oe[1])&&vO(oe[2])},e.hasNaN=function a(oe){return isNaN(oe[0])||isNaN(oe[1])||isNaN(oe[2])},e.setNaN=function i(oe){return oe[0]=NaN,oe[1]=NaN,oe[2]=NaN,oe},e.fromObj=function o(oe){return l(oe.x,oe.y,oe.z)},e.toObj=function s(oe){return{x:oe[0],y:oe[1],z:oe[2]}},e.fromArray=function u(oe,be,Ce){return oe[0]=be[Ce+0],oe[1]=be[Ce+1],oe[2]=be[Ce+2],oe},e.toArray=function c(oe,be,Ce){return be[Ce+0]=oe[0],be[Ce+1]=oe[1],be[Ce+2]=oe[2],be},e.create=l,e.ofArray=function d(oe){var be=t();return be[0]=oe[0],be[1]=oe[1],be[2]=oe[2],be},e.set=function f(oe,be,Ce,Qe){return oe[0]=be,oe[1]=Ce,oe[2]=Qe,oe},e.copy=p,e.add=m,e.sub=h,e.mul=function v(oe,be,Ce){return oe[0]=be[0]*Ce[0],oe[1]=be[1]*Ce[1],oe[2]=be[2]*Ce[2],oe},e.div=function g(oe,be,Ce){return oe[0]=be[0]/Ce[0],oe[1]=be[1]/Ce[1],oe[2]=be[2]/Ce[2],oe},e.scale=y,e.scaleAndAdd=S,e.scaleAndSub=function C(oe,be,Ce,Qe){return oe[0]=be[0]-Ce[0]*Qe,oe[1]=be[1]-Ce[1]*Qe,oe[2]=be[2]-Ce[2]*Qe,oe},e.addScalar=function _(oe,be,Ce){return oe[0]=be[0]+Ce,oe[1]=be[1]+Ce,oe[2]=be[2]+Ce,oe},e.subScalar=function x(oe,be,Ce){return oe[0]=be[0]-Ce,oe[1]=be[1]-Ce,oe[2]=be[2]-Ce,oe},e.round=function D(oe,be){return oe[0]=Math.round(be[0]),oe[1]=Math.round(be[1]),oe[2]=Math.round(be[2]),oe},e.ceil=function w(oe,be){return oe[0]=Math.ceil(be[0]),oe[1]=Math.ceil(be[1]),oe[2]=Math.ceil(be[2]),oe},e.floor=function A(oe,be){return oe[0]=Math.floor(be[0]),oe[1]=Math.floor(be[1]),oe[2]=Math.floor(be[2]),oe},e.trunc=function E(oe,be){return oe[0]=Math.trunc(be[0]),oe[1]=Math.trunc(be[1]),oe[2]=Math.trunc(be[2]),oe},e.abs=function I(oe,be){return oe[0]=Math.abs(be[0]),oe[1]=Math.abs(be[1]),oe[2]=Math.abs(be[2]),oe},e.min=function M(oe,be,Ce){return oe[0]=Math.min(be[0],Ce[0]),oe[1]=Math.min(be[1],Ce[1]),oe[2]=Math.min(be[2],Ce[2]),oe},e.max=function F(oe,be,Ce){return oe[0]=Math.max(be[0],Ce[0]),oe[1]=Math.max(be[1],Ce[1]),oe[2]=Math.max(be[2],Ce[2]),oe},e.clamp=function N(oe,be,Ce,Qe){return oe[0]=Math.max(Ce[0],Math.min(Qe[0],be[0])),oe[1]=Math.max(Ce[1],Math.min(Qe[1],be[1])),oe[2]=Math.max(Ce[2],Math.min(Qe[2],be[2])),oe},e.distance=function j(oe,be){var Ce=be[0]-oe[0],Qe=be[1]-oe[1],Et=be[2]-oe[2];return Math.sqrt(Ce*Ce+Qe*Qe+Et*Et)},e.squaredDistance=function U(oe,be){var Ce=be[0]-oe[0],Qe=be[1]-oe[1],Et=be[2]-oe[2];return Ce*Ce+Qe*Qe+Et*Et},e.magnitude=function H(oe){var be=oe[0],Ce=oe[1],Qe=oe[2];return Math.sqrt(be*be+Ce*Ce+Qe*Qe)},e.squaredMagnitude=z,e.setMagnitude=function G(oe,be,Ce){return y(oe,Z(oe,be),Ce)},e.negate=J,e.inverse=function X(oe,be){return oe[0]=1/be[0],oe[1]=1/be[1],oe[2]=1/be[2],oe},e.normalize=Z,e.dot=ne,e.cross=Y,e.lerp=function k(oe,be,Ce,Qe){var Et=be[0],At=be[1],Zt=be[2];return oe[0]=Et+Qe*(Ce[0]-Et),oe[1]=At+Qe*(Ce[1]-At),oe[2]=Zt+Qe*(Ce[2]-Zt),oe};var W=t();function le(oe,be){var Ce=Math.sqrt(z(oe)*z(be));if(0===Ce)return Math.PI/2;var Qe=ne(oe,be)/Ce;return Math.acos(Xi(Qe,-1,1))}e.slerp=function $(oe,be,Ce,Qe){var Et=Xi(ne(be,Ce),-1,1),At=Math.acos(Et)*Qe;return S(W,Ce,be,-Et),Z(W,W),m(oe,y(oe,be,Math.cos(At)),y(W,W,Math.sin(At)))},e.hermite=function K(oe,be,Ce,Qe,Et,At){var Zt=At*At,Dr=Zt*(2*At-3)+1,tr=Zt*(At-2)+At,fn=Zt*(At-1),Qn=Zt*(3-2*At);return oe[0]=be[0]*Dr+Ce[0]*tr+Qe[0]*fn+Et[0]*Qn,oe[1]=be[1]*Dr+Ce[1]*tr+Qe[1]*fn+Et[1]*Qn,oe[2]=be[2]*Dr+Ce[2]*tr+Qe[2]*fn+Et[2]*Qn,oe},e.bezier=function q(oe,be,Ce,Qe,Et,At){var Zt=1-At,Dr=Zt*Zt,tr=At*At,fn=Dr*Zt,Qn=3*At*Dr,ao=3*tr*Zt,ja=tr*At;return oe[0]=be[0]*fn+Ce[0]*Qn+Qe[0]*ao+Et[0]*ja,oe[1]=be[1]*fn+Ce[1]*Qn+Qe[1]*ao+Et[1]*ja,oe[2]=be[2]*fn+Ce[2]*Qn+Qe[2]*ao+Et[2]*ja,oe},e.quadraticBezier=function V(oe,be,Ce,Qe,Et){return oe[0]=hO(be[0],Ce[0],Qe[0],Et),oe[1]=hO(be[1],Ce[1],Qe[1],Et),oe[2]=hO(be[2],Ce[2],Qe[2],Et),oe},e.spline=function ee(oe,be,Ce,Qe,Et,At,Zt){return oe[0]=fw(be[0],Ce[0],Qe[0],Et[0],At,Zt),oe[1]=fw(be[1],Ce[1],Qe[1],Et[1],At,Zt),oe[2]=fw(be[2],Ce[2],Qe[2],Et[2],At,Zt),oe},e.random=function ae(oe,be){var Ce=2*Math.random()*Math.PI,Qe=2*Math.random()-1,Et=Math.sqrt(1-Qe*Qe)*be;return oe[0]=Math.cos(Ce)*Et,oe[1]=Math.sin(Ce)*Et,oe[2]=Qe*be,oe},e.transformMat4=function pe(oe,be,Ce){var Qe=be[0],Et=be[1],At=be[2],Zt=1/(Ce[3]*Qe+Ce[7]*Et+Ce[11]*At+Ce[15]||1);return oe[0]=(Ce[0]*Qe+Ce[4]*Et+Ce[8]*At+Ce[12])*Zt,oe[1]=(Ce[1]*Qe+Ce[5]*Et+Ce[9]*At+Ce[13])*Zt,oe[2]=(Ce[2]*Qe+Ce[6]*Et+Ce[10]*At+Ce[14])*Zt,oe},e.transformDirection=function me(oe,be,Ce){var Qe=be[0],Et=be[1],At=be[2];return oe[0]=Ce[0]*Qe+Ce[4]*Et+Ce[8]*At,oe[1]=Ce[1]*Qe+Ce[5]*Et+Ce[9]*At,oe[2]=Ce[2]*Qe+Ce[6]*Et+Ce[10]*At,Z(oe,oe)},e.transformMat4Offset=function de(oe,be,Ce,Qe,Et,At){var Zt=be[0+Et],Dr=be[1+Et],tr=be[2+Et],fn=1/(Ce[3+At]*Zt+Ce[7+At]*Dr+Ce[11+At]*tr+Ce[15+At]||1);return oe[0+Qe]=(Ce[0+At]*Zt+Ce[4+At]*Dr+Ce[8+At]*tr+Ce[12+At])*fn,oe[1+Qe]=(Ce[1+At]*Zt+Ce[5+At]*Dr+Ce[9+At]*tr+Ce[13+At])*fn,oe[2+Qe]=(Ce[2+At]*Zt+Ce[6+At]*Dr+Ce[10+At]*tr+Ce[14+At])*fn,oe},e.transformMat3=function re(oe,be,Ce){var Qe=be[0],Et=be[1],At=be[2];return oe[0]=Qe*Ce[0]+Et*Ce[3]+At*Ce[6],oe[1]=Qe*Ce[1]+Et*Ce[4]+At*Ce[7],oe[2]=Qe*Ce[2]+Et*Ce[5]+At*Ce[8],oe},e.transformQuat=function te(oe,be,Ce){var Qe=be[0],Et=be[1],At=be[2],Zt=Ce[0],Dr=Ce[1],tr=Ce[2],fn=Ce[3],Qn=fn*Qe+Dr*At-tr*Et,ao=fn*Et+tr*Qe-Zt*At,ja=fn*At+Zt*Et-Dr*Qe,Gi=-Zt*Qe-Dr*Et-tr*At;return oe[0]=Qn*fn+Gi*-Zt+ao*-tr-ja*-Dr,oe[1]=ao*fn+Gi*-Dr+ja*-Zt-Qn*-tr,oe[2]=ja*fn+Gi*-tr+Qn*-Dr-ao*-Zt,oe},e.angle=le;var ge=t(),xe=t(),Ge=t(),je=t(),L=t(),Q=t(),ye=t();e.dihedralAngle=function we(oe,be,Ce,Qe){h(ge,oe,be),h(xe,Ce,be),h(Ge,be,Ce),h(je,Qe,Ce),Y(L,ge,xe),Y(Q,Ge,je);var Et=le(L,Q);return Y(ye,L,Q),ne(xe,ye)>0?Et:-Et},e.directionFromSpherical=function De(oe,be,Ce,Qe){return e.set(oe,Qe*Math.cos(Ce)*Math.sin(be),Qe*Math.sin(Ce)*Math.sin(be),Qe*Math.cos(be))},e.exactEquals=function Oe(oe,be){return oe[0]===be[0]&&oe[1]===be[1]&&oe[2]===be[2]},e.equals=function Ne(oe,be){var Ce=oe[0],Qe=oe[1],Et=oe[2],At=be[0],Zt=be[1],Dr=be[2];return Math.abs(Ce-At)<=mn*Math.max(1,Math.abs(Ce),Math.abs(At))&&Math.abs(Qe-Zt)<=mn*Math.max(1,Math.abs(Qe),Math.abs(Zt))&&Math.abs(Et-Dr)<=mn*Math.max(1,Math.abs(Et),Math.abs(Dr))};var Ue=t();e.makeRotation=function $e(oe,be,Ce){var Qe=le(be,Ce);if(Math.abs(Qe)<1e-4)return he.setIdentity(oe);if(Math.abs(Qe-Math.PI)<mn)return he.fromScaling(oe,e.negUnit);var Et=Y(Ue,be,Ce);return he.fromRotation(oe,Qe,Et)},e.isZero=function Ie(oe){return 0===oe[0]&&0===oe[1]&&0===oe[2]},e.projectPointOnVector=function He(oe,be,Ce,Qe){return h(oe,be,Qe),m(oe,y(oe,Ce,ne(Ce,oe)/z(Ce)),Qe)};var Je=t();function ut(oe,be,Ce){return y(oe,Ce,ne(Ce,be)/z(Ce))}e.projectPointOnPlane=function mt(oe,be,Ce,Qe){return Z(Je,Ce),h(oe,be,Qe),h(oe,be,y(Je,Je,ne(oe,Je)))},e.projectOnVector=ut;var St=t();e.projectOnPlane=function wt(oe,be,Ce){return ut(St,be,Ce),h(oe,be,St)},e.orthogonalize=function Le(oe,be,Ce){return Z(oe,Y(oe,Y(oe,be,Ce),be))},e.matchDirection=function it(oe,be,Ce){return ne(be,Ce)>0?p(oe,be):J(oe,p(oe,be)),oe};var Ct=t(),bt=t();e.triangleNormal=function Mt(oe,be,Ce,Qe){return h(Ct,Ce,be),h(bt,Qe,be),Z(oe,Y(oe,Ct,bt))},e.toString=function Rt(oe,be){return"[".concat(oe[0].toPrecision(be)," ").concat(oe[1].toPrecision(be)," ").concat(oe[2].toPrecision(be),"]")},e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)}(b||(b={}));var Sr,rS=Math.PI/2,Lq=Math.PI/180;function Yr(e){return e*Lq}function Ru(e){return e/Lq}function nS(e){return 0!==e&&0==(e&e-1)}function Uq(e,t){return e*t}function he(){return he.zero()}function Qt(){return Qt.zero()}function Be(){return Be.zero()}function dr(){return dr.zero()}function pw(e){return Object.keys(e)}function Sn(e){throw new Error("unreachable")}function mw(e){return"function"==typeof e?.then}function hn(){return hn.zero()}!function(e){function t(){var L=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return L[0]=0,L}function r(){var L=t();return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}function n(L){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}function a(L){for(var Q=0;Q<16;Q++)L[Q]=0;return L}e.zero=t,e.identity=r,e.setIdentity=n,e.setZero=a,e.ofRows=function i(L){for(var Q=t(),ye=0;ye<4;ye++)for(var we=L[ye],De=0;De<4;De++)Q[4*De+ye]=we[De];return Q};var o=r();function c(L,Q,ye){for(var we=0;we<16;we++)if(Math.abs(L[we]-Q[we])>ye)return!1;return!0}function l(L,Q,ye,we){L[4*ye+Q]=we}function h(L,Q){return L[0]=Q[0],L[1]=Q[1],L[2]=Q[2],L[3]=Q[3],L[4]=Q[4],L[5]=Q[5],L[6]=Q[6],L[7]=Q[7],L[8]=Q[8],L[9]=Q[9],L[10]=Q[10],L[11]=Q[11],L[12]=Q[12],L[13]=Q[13],L[14]=Q[14],L[15]=Q[15],L}function S(L,Q){var ye=Q[0]+Q[5]+Q[10],we=0;return ye>0?(we=2*Math.sqrt(ye+1),L[3]=.25*we,L[0]=(Q[6]-Q[9])/we,L[1]=(Q[8]-Q[2])/we,L[2]=(Q[1]-Q[4])/we):Q[0]>Q[5]&&Q[0]>Q[10]?(we=2*Math.sqrt(1+Q[0]-Q[5]-Q[10]),L[3]=(Q[6]-Q[9])/we,L[0]=.25*we,L[1]=(Q[1]+Q[4])/we,L[2]=(Q[8]+Q[2])/we):Q[5]>Q[10]?(we=2*Math.sqrt(1+Q[5]-Q[0]-Q[10]),L[3]=(Q[8]-Q[2])/we,L[0]=(Q[1]+Q[4])/we,L[1]=.25*we,L[2]=(Q[6]+Q[9])/we):(we=2*Math.sqrt(1+Q[10]-Q[0]-Q[5]),L[3]=(Q[1]-Q[4])/we,L[0]=(Q[8]+Q[2])/we,L[1]=(Q[6]+Q[9])/we,L[2]=.25*we),L}function x(L,Q){var ye=Q[0],we=Q[1],De=Q[2],Oe=Q[3],Ne=Q[4],Ue=Q[5],$e=Q[6],Ie=Q[7],He=Q[8],Je=Q[9],mt=Q[10],ut=Q[11],St=Q[12],wt=Q[13],Le=Q[14],it=Q[15],Ct=ye*Ue-we*Ne,bt=ye*$e-De*Ne,Mt=ye*Ie-Oe*Ne,Rt=we*$e-De*Ue,oe=we*Ie-Oe*Ue,be=De*Ie-Oe*$e,Ce=He*wt-Je*St,Qe=He*Le-mt*St,Et=He*it-ut*St,At=Je*Le-mt*wt,Zt=Je*it-ut*wt,Dr=mt*it-ut*Le,tr=Ct*Dr-bt*Zt+Mt*At+Rt*Et-oe*Qe+be*Ce;return!!tr&&(L[0]=(Ue*Dr-$e*Zt+Ie*At)*(tr=1/tr),L[1]=(De*Zt-we*Dr-Oe*At)*tr,L[2]=(wt*be-Le*oe+it*Rt)*tr,L[3]=(mt*oe-Je*be-ut*Rt)*tr,L[4]=($e*Et-Ne*Dr-Ie*Qe)*tr,L[5]=(ye*Dr-De*Et+Oe*Qe)*tr,L[6]=(Le*Mt-St*be-it*bt)*tr,L[7]=(He*be-mt*Mt+ut*bt)*tr,L[8]=(Ne*Zt-Ue*Et+Ie*Ce)*tr,L[9]=(we*Et-ye*Zt-Oe*Ce)*tr,L[10]=(St*oe-wt*Mt+it*Ct)*tr,L[11]=(Je*Mt-He*oe-ut*Ct)*tr,L[12]=(Ue*Qe-Ne*At-$e*Ce)*tr,L[13]=(ye*At-we*Qe+De*Ce)*tr,L[14]=(wt*bt-St*Rt-Le*Ct)*tr,L[15]=(He*Rt-Je*bt+mt*Ct)*tr,!0)}function w(L,Q,ye){var we=Q[0],De=Q[1],Oe=Q[2],Ne=Q[3],Ue=Q[4],$e=Q[5],Ie=Q[6],He=Q[7],Je=Q[8],mt=Q[9],ut=Q[10],St=Q[11],wt=Q[12],Le=Q[13],it=Q[14],Ct=Q[15],bt=ye[0],Mt=ye[1],Rt=ye[2],oe=ye[3];return L[0]=bt*we+Mt*Ue+Rt*Je+oe*wt,L[1]=bt*De+Mt*$e+Rt*mt+oe*Le,L[2]=bt*Oe+Mt*Ie+Rt*ut+oe*it,L[3]=bt*Ne+Mt*He+Rt*St+oe*Ct,L[4]=(bt=ye[4])*we+(Mt=ye[5])*Ue+(Rt=ye[6])*Je+(oe=ye[7])*wt,L[5]=bt*De+Mt*$e+Rt*mt+oe*Le,L[6]=bt*Oe+Mt*Ie+Rt*ut+oe*it,L[7]=bt*Ne+Mt*He+Rt*St+oe*Ct,L[8]=(bt=ye[8])*we+(Mt=ye[9])*Ue+(Rt=ye[10])*Je+(oe=ye[11])*wt,L[9]=bt*De+Mt*$e+Rt*mt+oe*Le,L[10]=bt*Oe+Mt*Ie+Rt*ut+oe*it,L[11]=bt*Ne+Mt*He+Rt*St+oe*Ct,L[12]=(bt=ye[12])*we+(Mt=ye[13])*Ue+(Rt=ye[14])*Je+(oe=ye[15])*wt,L[13]=bt*De+Mt*$e+Rt*mt+oe*Le,L[14]=bt*Oe+Mt*Ie+Rt*ut+oe*it,L[15]=bt*Ne+Mt*He+Rt*St+oe*Ct,L}function U(L,Q,ye){var we=ye[0],De=ye[1],Oe=ye[2],Ne=Math.sqrt(we*we+De*De+Oe*Oe);if(Math.abs(Ne)<mn)return n(L);we*=Ne=1/Ne,De*=Ne,Oe*=Ne;var Ue=Math.sin(Q),$e=Math.cos(Q),Ie=1-$e;return L[0]=we*we*Ie+$e,L[1]=De*we*Ie+Oe*Ue,L[2]=Oe*we*Ie-De*Ue,L[3]=0,L[4]=we*De*Ie-Oe*Ue,L[5]=De*De*Ie+$e,L[6]=Oe*De*Ie+we*Ue,L[7]=0,L[8]=we*Oe*Ie+De*Ue,L[9]=De*Oe*Ie-we*Ue,L[10]=Oe*Oe*Ie+$e,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.isIdentity=function s(L,Q){return c(L,o,typeof Q>"u"?mn:Q)},e.hasNaN=function u(L){for(var Q=0;Q<16;Q++)if(isNaN(L[Q]))return!0;return!1},e.areEqual=c,e.setValue=l,e.getValue=function d(L,Q,ye){return L[4*ye+Q]},e.toArray=function f(L,Q,ye){return Q[ye+0]=L[0],Q[ye+1]=L[1],Q[ye+2]=L[2],Q[ye+3]=L[3],Q[ye+4]=L[4],Q[ye+5]=L[5],Q[ye+6]=L[6],Q[ye+7]=L[7],Q[ye+8]=L[8],Q[ye+9]=L[9],Q[ye+10]=L[10],Q[ye+11]=L[11],Q[ye+12]=L[12],Q[ye+13]=L[13],Q[ye+14]=L[14],Q[ye+15]=L[15],Q},e.fromArray=function p(L,Q,ye){return L[0]=Q[ye+0],L[1]=Q[ye+1],L[2]=Q[ye+2],L[3]=Q[ye+3],L[4]=Q[ye+4],L[5]=Q[ye+5],L[6]=Q[ye+6],L[7]=Q[ye+7],L[8]=Q[ye+8],L[9]=Q[ye+9],L[10]=Q[ye+10],L[11]=Q[ye+11],L[12]=Q[ye+12],L[13]=Q[ye+13],L[14]=Q[ye+14],L[15]=Q[ye+15],L},e.fromBasis=function m(L,Q,ye,we){return a(L),l(L,0,0,Q[0]),l(L,1,0,Q[1]),l(L,2,0,Q[2]),l(L,0,1,ye[0]),l(L,1,1,ye[1]),l(L,2,1,ye[2]),l(L,0,2,we[0]),l(L,1,2,we[1]),l(L,2,2,we[2]),l(L,3,3,1),L},e.copy=h,e.clone=function v(L){return h(t(),L)},e.getTranslation=function g(L,Q){return L[0]=Q[12],L[1]=Q[13],L[2]=Q[14],L},e.getScaling=function y(L,Q){var ye=Q[0],we=Q[1],De=Q[2],Oe=Q[4],Ne=Q[5],Ue=Q[6],$e=Q[8],Ie=Q[9],He=Q[10];return L[0]=Math.sqrt(ye*ye+we*we+De*De),L[1]=Math.sqrt(Oe*Oe+Ne*Ne+Ue*Ue),L[2]=Math.sqrt($e*$e+Ie*Ie+He*He),L},e.getRotation=S,e.extractRotation=function C(L,Q){var ye=1/Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]),we=1/Math.sqrt(Q[4]*Q[4]+Q[5]*Q[5]+Q[6]*Q[6]),De=1/Math.sqrt(Q[8]*Q[8]+Q[9]*Q[9]+Q[10]*Q[10]);return L[0]=Q[0]*ye,L[1]=Q[1]*ye,L[2]=Q[2]*ye,L[3]=0,L[4]=Q[4]*we,L[5]=Q[5]*we,L[6]=Q[6]*we,L[7]=0,L[8]=Q[8]*De,L[9]=Q[9]*De,L[10]=Q[10]*De,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L},e.transpose=function _(L,Q){if(L===Q){var ye=Q[1],we=Q[2],De=Q[3],Oe=Q[6],Ne=Q[7],Ue=Q[11];L[1]=Q[4],L[2]=Q[8],L[3]=Q[12],L[4]=ye,L[6]=Q[9],L[7]=Q[13],L[8]=we,L[9]=Oe,L[11]=Q[14],L[12]=De,L[13]=Ne,L[14]=Ue}else L[0]=Q[0],L[1]=Q[4],L[2]=Q[8],L[3]=Q[12],L[4]=Q[1],L[5]=Q[5],L[6]=Q[9],L[7]=Q[13],L[8]=Q[2],L[9]=Q[6],L[10]=Q[10],L[11]=Q[14],L[12]=Q[3],L[13]=Q[7],L[14]=Q[11],L[15]=Q[15];return L},e.tryInvert=x,e.invert=function D(L,Q){return x(L,Q)||console.warn("non-invertible matrix.",Q),L},e.mul=w,e.mulOffset=function A(L,Q,ye,we,De,Oe){var Ne=Q[0+De],Ue=Q[1+De],$e=Q[2+De],Ie=Q[3+De],He=Q[4+De],Je=Q[5+De],mt=Q[6+De],ut=Q[7+De],St=Q[8+De],wt=Q[9+De],Le=Q[10+De],it=Q[11+De],Ct=Q[12+De],bt=Q[13+De],Mt=Q[14+De],Rt=Q[15+De],oe=ye[0+Oe],be=ye[1+Oe],Ce=ye[2+Oe],Qe=ye[3+Oe];return L[0+we]=oe*Ne+be*He+Ce*St+Qe*Ct,L[1+we]=oe*Ue+be*Je+Ce*wt+Qe*bt,L[2+we]=oe*$e+be*mt+Ce*Le+Qe*Mt,L[3+we]=oe*Ie+be*ut+Ce*it+Qe*Rt,L[4+we]=(oe=ye[4+Oe])*Ne+(be=ye[5+Oe])*He+(Ce=ye[6+Oe])*St+(Qe=ye[7+Oe])*Ct,L[5+we]=oe*Ue+be*Je+Ce*wt+Qe*bt,L[6+we]=oe*$e+be*mt+Ce*Le+Qe*Mt,L[7+we]=oe*Ie+be*ut+Ce*it+Qe*Rt,L[8+we]=(oe=ye[8+Oe])*Ne+(be=ye[9+Oe])*He+(Ce=ye[10+Oe])*St+(Qe=ye[11+Oe])*Ct,L[9+we]=oe*Ue+be*Je+Ce*wt+Qe*bt,L[10+we]=oe*$e+be*mt+Ce*Le+Qe*Mt,L[11+we]=oe*Ie+be*ut+Ce*it+Qe*Rt,L[12+we]=(oe=ye[12+Oe])*Ne+(be=ye[13+Oe])*He+(Ce=ye[14+Oe])*St+(Qe=ye[15+Oe])*Ct,L[13+we]=oe*Ue+be*Je+Ce*wt+Qe*bt,L[14+we]=oe*$e+be*mt+Ce*Le+Qe*Mt,L[15+we]=oe*Ie+be*ut+Ce*it+Qe*Rt,L},e.mul3=function E(L,Q,ye,we){return w(L,w(L,Q,ye),we)},e.translate=function I(L,Q,ye){var Ne,Ue,$e,Ie,He,Je,mt,ut,St,wt,Le,it,we=ye[0],De=ye[1],Oe=ye[2];return Q===L?(L[12]=Q[0]*we+Q[4]*De+Q[8]*Oe+Q[12],L[13]=Q[1]*we+Q[5]*De+Q[9]*Oe+Q[13],L[14]=Q[2]*we+Q[6]*De+Q[10]*Oe+Q[14],L[15]=Q[3]*we+Q[7]*De+Q[11]*Oe+Q[15]):(Ue=Q[1],$e=Q[2],Ie=Q[3],He=Q[4],Je=Q[5],mt=Q[6],ut=Q[7],St=Q[8],wt=Q[9],Le=Q[10],it=Q[11],L[0]=Ne=Q[0],L[1]=Ue,L[2]=$e,L[3]=Ie,L[4]=He,L[5]=Je,L[6]=mt,L[7]=ut,L[8]=St,L[9]=wt,L[10]=Le,L[11]=it,L[12]=Ne*we+He*De+St*Oe+Q[12],L[13]=Ue*we+Je*De+wt*Oe+Q[13],L[14]=$e*we+mt*De+Le*Oe+Q[14],L[15]=Ie*we+ut*De+it*Oe+Q[15]),L},e.fromTranslation=function M(L,Q){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=Q[0],L[13]=Q[1],L[14]=Q[2],L[15]=1,L},e.setTranslation=function F(L,Q){return L[12]=Q[0],L[13]=Q[1],L[14]=Q[2],L},e.setAxes=function N(L,Q,ye,we){return L[0]=ye[0],L[4]=ye[1],L[8]=ye[2],L[1]=we[0],L[5]=we[1],L[9]=we[2],L[2]=Q[0],L[6]=Q[1],L[10]=Q[2],L},e.rotate=function j(L,Q,ye,we){var De=we[0],Oe=we[1],Ne=we[2],Ue=Math.sqrt(De*De+Oe*Oe+Ne*Ne);if(Math.abs(Ue)<mn)return r();De*=Ue=1/Ue,Oe*=Ue,Ne*=Ue;var $e=Math.sin(ye),Ie=Math.cos(ye),He=1-Ie,Je=Q[0],mt=Q[1],ut=Q[2],St=Q[3],wt=Q[4],Le=Q[5],it=Q[6],Ct=Q[7],bt=Q[8],Mt=Q[9],Rt=Q[10],oe=Q[11],be=De*De*He+Ie,Ce=Oe*De*He+Ne*$e,Qe=Ne*De*He-Oe*$e,Et=De*Oe*He-Ne*$e,At=Oe*Oe*He+Ie,Zt=Ne*Oe*He+De*$e,Dr=De*Ne*He+Oe*$e,tr=Oe*Ne*He-De*$e,fn=Ne*Ne*He+Ie;return L[0]=Je*be+wt*Ce+bt*Qe,L[1]=mt*be+Le*Ce+Mt*Qe,L[2]=ut*be+it*Ce+Rt*Qe,L[3]=St*be+Ct*Ce+oe*Qe,L[4]=Je*Et+wt*At+bt*Zt,L[5]=mt*Et+Le*At+Mt*Zt,L[6]=ut*Et+it*At+Rt*Zt,L[7]=St*Et+Ct*At+oe*Zt,L[8]=Je*Dr+wt*tr+bt*fn,L[9]=mt*Dr+Le*tr+Mt*fn,L[10]=ut*Dr+it*tr+Rt*fn,L[11]=St*Dr+Ct*tr+oe*fn,Q!==L&&(L[12]=Q[12],L[13]=Q[13],L[14]=Q[14],L[15]=Q[15]),L},e.fromRotation=U,e.scale=function H(L,Q,ye){var we=ye[0],De=ye[1],Oe=ye[2];return L[0]=Q[0]*we,L[1]=Q[1]*we,L[2]=Q[2]*we,L[3]=Q[3]*we,L[4]=Q[4]*De,L[5]=Q[5]*De,L[6]=Q[6]*De,L[7]=Q[7]*De,L[8]=Q[8]*Oe,L[9]=Q[9]*Oe,L[10]=Q[10]*Oe,L[11]=Q[11]*Oe,L[12]=Q[12],L[13]=Q[13],L[14]=Q[14],L[15]=Q[15],L},e.scaleUniformly=function z(L,Q,ye){return L[0]=Q[0]*ye,L[1]=Q[1]*ye,L[2]=Q[2]*ye,L[3]=Q[3]*ye,L[4]=Q[4]*ye,L[5]=Q[5]*ye,L[6]=Q[6]*ye,L[7]=Q[7]*ye,L[8]=Q[8]*ye,L[9]=Q[9]*ye,L[10]=Q[10]*ye,L[11]=Q[11]*ye,L[12]=Q[12],L[13]=Q[13],L[14]=Q[14],L[15]=Q[15],L},e.fromScaling=function G(L,Q){return L[0]=Q[0],L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=Q[1],L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=Q[2],L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L},e.fromUniformScaling=function J(L,Q){return L[0]=Q,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=Q,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=Q,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L},e.fromMat3=function X(L,Q){return L[0]=Q[0],L[1]=Q[1],L[2]=Q[2],L[4]=Q[3],L[5]=Q[4],L[6]=Q[5],L[8]=Q[6],L[9]=Q[7],L[10]=Q[8],L},e.compose=function Z(L,Q,ye,we){var De=ye[0],Oe=ye[1],Ne=ye[2],Ue=ye[3],$e=De+De,Ie=Oe+Oe,He=Ne+Ne,Je=De*$e,mt=De*Ie,ut=De*He,St=Oe*Ie,wt=Oe*He,Le=Ne*He,it=Ue*$e,Ct=Ue*Ie,bt=Ue*He,Mt=we[0],Rt=we[1],oe=we[2];return L[0]=(1-(St+Le))*Mt,L[1]=(mt+bt)*Mt,L[2]=(ut-Ct)*Mt,L[3]=0,L[4]=(mt-bt)*Rt,L[5]=(1-(Je+Le))*Rt,L[6]=(wt+it)*Rt,L[7]=0,L[8]=(ut+Ct)*oe,L[9]=(wt-it)*oe,L[10]=(1-(Je+St))*oe,L[11]=0,L[12]=Q[0],L[13]=Q[1],L[14]=Q[2],L[15]=1,L};var ne=[0,0,0],Y=t();function $(L){var Q=L[0],ye=L[1],we=L[2],De=L[3],Oe=L[4],Ne=L[5],Ue=L[6],$e=L[7],Ie=L[8],He=L[9],Je=L[10],mt=L[11],ut=L[12],St=L[13],wt=L[14],Le=L[15];return(Q*Ne-ye*Oe)*(Je*Le-mt*wt)-(Q*Ue-we*Oe)*(He*Le-mt*St)+(Q*$e-De*Oe)*(He*wt-Je*St)+(ye*Ue-we*Ne)*(Ie*Le-mt*ut)-(ye*$e-De*Ne)*(Ie*wt-Je*ut)+(we*$e-De*Ue)*(Ie*St-He*ut)}e.decompose=function k(L,Q,ye,we){var De=b.magnitude(b.set(ne,L[0],L[1],L[2])),Oe=b.magnitude(b.set(ne,L[4],L[5],L[6])),Ne=b.magnitude(b.set(ne,L[8],L[9],L[10]));$(L)<0&&(De=-De),Q[0]=L[12],Q[1]=L[13],Q[2]=L[14],h(Y,L);var $e=1/De,Ie=1/Oe,He=1/Ne;return Y[0]*=$e,Y[1]*=$e,Y[2]*=$e,Y[4]*=Ie,Y[5]*=Ie,Y[6]*=Ie,Y[8]*=He,Y[9]*=He,Y[10]*=He,S(ye,Y),we[0]=De,we[1]=Oe,we[2]=Ne,L},e.makeTable=function W(L){for(var Q="",ye=0;ye<4;ye++){for(var we=0;we<4;we++)Q+=L[4*we+ye].toString(),we<3&&(Q+=" ");ye<3&&(Q+="\n")}return Q},e.determinant=$,e.isRotationAndTranslation=function K(L,Q){return function q(L,Q){var ye=L[0],we=L[1],De=L[2],Oe=L[3],Ne=L[4],Ue=L[5],$e=L[6],Ie=L[7],He=L[8],Je=L[9],mt=L[10],ut=L[11];return!!(ea(L[15],1,Q)&&ea(Oe,0,Q)&&ea(Ie,0,Q)&&ea(ut,0,Q))&&!!ea(Math.abs(ye*(Ue*mt-$e*Je)-we*(Ne*mt-$e*He)+De*(Ne*Je-Ue*He)),1,Q)}(L,typeof Q<"u"?Q:mn)},e.isTranslationAndUniformScaling=function V(L,Q){return function ee(L,Q){var ye=L[0];return ea(L[1],0,Q)&&ea(L[2],0,Q)&&ea(L[3],0,Q)&&ea(L[4],0,Q)&&ea(L[5],ye,Q)&&ea(L[6],0,Q)&&ea(L[7],0,Q)&&ea(L[8],0,Q)&&ea(L[9],0,Q)&&ea(L[10],ye,Q)&&ea(L[11],0,Q)&&ea(L[15],1,Q)}(L,typeof Q<"u"?Q:mn)},e.fromQuat=function ae(L,Q){var ye=Q[0],we=Q[1],De=Q[2],Oe=Q[3],Ne=ye+ye,Ue=we+we,$e=De+De,Ie=ye*Ne,He=we*Ne,Je=we*Ue,mt=De*Ne,ut=De*Ue,St=De*$e,wt=Oe*Ne,Le=Oe*Ue,it=Oe*$e;return L[0]=1-Je-St,L[1]=He+it,L[2]=mt-Le,L[3]=0,L[4]=He-it,L[5]=1-Ie-St,L[6]=ut+wt,L[7]=0,L[8]=mt+Le,L[9]=ut-wt,L[10]=1-Ie-Je,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L},e.fromEuler=function pe(L,Q,ye){var we=Q[0],De=Q[1],Oe=Q[2],Ne=Math.cos(we),Ue=Math.sin(we),$e=Math.cos(De),Ie=Math.sin(De),He=Math.cos(Oe),Je=Math.sin(Oe);if("XYZ"===ye){var mt=Ne*He,ut=Ne*Je,St=Ue*He,wt=Ue*Je;L[0]=$e*He,L[4]=-$e*Je,L[8]=Ie,L[1]=ut+St*Ie,L[5]=mt-wt*Ie,L[9]=-Ue*$e,L[2]=wt-mt*Ie,L[6]=St+ut*Ie,L[10]=Ne*$e}else if("YXZ"===ye){var it=$e*Je,Ct=Ie*He;L[0]=(Le=$e*He)+(bt=Ie*Je)*Ue,L[4]=Ct*Ue-it,L[8]=Ne*Ie,L[1]=Ne*Je,L[5]=Ne*He,L[9]=-Ue,L[2]=it*Ue-Ct,L[6]=bt+Le*Ue,L[10]=Ne*$e}else if("ZXY"===ye){var Le,bt;it=$e*Je,Ct=Ie*He,L[0]=(Le=$e*He)-(bt=Ie*Je)*Ue,L[4]=-Ne*Je,L[8]=Ct+it*Ue,L[1]=it+Ct*Ue,L[5]=Ne*He,L[9]=bt-Le*Ue,L[2]=-Ne*Ie,L[6]=Ue,L[10]=Ne*$e}else if("ZYX"===ye)mt=Ne*He,ut=Ne*Je,St=Ue*He,wt=Ue*Je,L[0]=$e*He,L[4]=St*Ie-ut,L[8]=mt*Ie+wt,L[1]=$e*Je,L[5]=wt*Ie+mt,L[9]=ut*Ie-St,L[2]=-Ie,L[6]=Ue*$e,L[10]=Ne*$e;else if("YZX"===ye){var Mt=Ne*$e,Rt=Ne*Ie,oe=Ue*$e,be=Ue*Ie;L[0]=$e*He,L[4]=be-Mt*Je,L[8]=oe*Je+Rt,L[1]=Je,L[5]=Ne*He,L[9]=-Ue*He,L[2]=-Ie*He,L[6]=Rt*Je+oe,L[10]=Mt-be*Je}else"XZY"===ye&&(Mt=Ne*$e,Rt=Ne*Ie,oe=Ue*$e,be=Ue*Ie,L[0]=$e*He,L[4]=-Je,L[8]=Ie*He,L[1]=Mt*Je+be,L[5]=Ne*He,L[9]=Rt*Je-oe,L[2]=oe*Je-Rt,L[6]=Ue*He,L[10]=be*Je+Mt);return L[3]=0,L[7]=0,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L},e.perspective=function me(L,Q,ye,we,De,Oe,Ne){var $e=2*Oe/(we-De),Ie=(ye+Q)/(ye-Q),He=(we+De)/(we-De),Je=-(Ne+Oe)/(Ne-Oe),mt=-2*Ne*Oe/(Ne-Oe);return L[0]=2*Oe/(ye-Q),L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=$e,L[6]=0,L[7]=0,L[8]=Ie,L[9]=He,L[10]=Je,L[11]=-1,L[12]=0,L[13]=0,L[14]=mt,L[15]=0,L},e.ortho=function de(L,Q,ye,we,De,Oe,Ne){var Ue=1/(ye-Q),$e=1/(we-De),Ie=1/(Ne-Oe),He=(ye+Q)*Ue,Je=(we+De)*$e,mt=(Ne+Oe)*Ie;return L[0]=2*Ue,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=2*$e,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=-2*Ie,L[11]=0,L[12]=-He,L[13]=-Je,L[14]=-mt,L[15]=1,L},e.lookAt=function re(L,Q,ye,we){var De,Oe,Ne,Ue,$e,Ie,He,Je,mt,ut,St=Q[0],wt=Q[1],Le=Q[2],it=we[0],Ct=we[1],bt=we[2],Mt=ye[0],Rt=ye[1],oe=ye[2];return Math.abs(St-Mt)<mn&&Math.abs(wt-Rt)<mn&&Math.abs(Le-oe)<mn?n(L):(He=St-Mt,Je=wt-Rt,mt=Le-oe,De=Ct*(mt*=ut=1/Math.sqrt(He*He+Je*Je+mt*mt))-bt*(Je*=ut),Oe=bt*(He*=ut)-it*mt,Ne=it*Je-Ct*He,(ut=Math.sqrt(De*De+Oe*Oe+Ne*Ne))?(De*=ut=1/ut,Oe*=ut,Ne*=ut):(De=0,Oe=0,Ne=0),Ue=Je*Ne-mt*Oe,$e=mt*De-He*Ne,Ie=He*Oe-Je*De,(ut=Math.sqrt(Ue*Ue+$e*$e+Ie*Ie))?(Ue*=ut=1/ut,$e*=ut,Ie*=ut):(Ue=0,$e=0,Ie=0),L[0]=De,L[1]=Ue,L[2]=He,L[3]=0,L[4]=Oe,L[5]=$e,L[6]=Je,L[7]=0,L[8]=Ne,L[9]=Ie,L[10]=mt,L[11]=0,L[12]=-(De*St+Oe*wt+Ne*Le),L[13]=-(Ue*St+$e*wt+Ie*Le),L[14]=-(He*St+Je*wt+mt*Le),L[15]=1,L)},e.targetTo=function te(L,Q,ye,we){var De=Q[0],Oe=Q[1],Ne=Q[2],Ue=we[0],$e=we[1],Ie=we[2],He=De-ye[0],Je=Oe-ye[1],mt=Ne-ye[2],ut=He*He+Je*Je+mt*mt;ut>0&&(He*=ut=1/Math.sqrt(ut),Je*=ut,mt*=ut);var St=$e*mt-Ie*Je,wt=Ie*He-Ue*mt,Le=Ue*Je-$e*He;return(ut=St*St+wt*wt+Le*Le)>0&&(St*=ut=1/Math.sqrt(ut),wt*=ut,Le*=ut),L[0]=St,L[1]=wt,L[2]=Le,L[3]=0,L[4]=Je*Le-mt*wt,L[5]=mt*St-He*Le,L[6]=He*wt-Je*St,L[7]=0,L[8]=He,L[9]=Je,L[10]=mt,L[11]=0,L[12]=De,L[13]=Oe,L[14]=Ne,L[15]=1,L},e.fromPermutation=function le(L,Q){a(L);for(var ye=0;ye<4;ye++)l(L,ye,Q[ye],1);return L},e.getMaxScaleOnAxis=function ge(L){return Math.sqrt(Math.max(L[0]*L[0]+L[1]*L[1]+L[2]*L[2],L[4]*L[4]+L[5]*L[5]+L[6]*L[6],L[8]*L[8]+L[9]*L[9]+L[10]*L[10]))};var xe=[1,0,0],Ge=[0,1,0],je=[0,0,1];e.rotX90=U(t(),Yr(90),xe),e.rotX180=U(t(),Yr(180),xe),e.rotY90=U(t(),Yr(90),Ge),e.rotY180=U(t(),Yr(180),Ge),e.rotY270=U(t(),Yr(270),Ge),e.rotZ90=U(t(),Yr(90),je),e.rotZ180=U(t(),Yr(180),je),e.rotXY90=w(t(),e.rotX90,e.rotY90),e.rotZY90=w(t(),e.rotZ90,e.rotY90),e.rotZYZ90=w(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=w(t(),e.rotZ90,e.rotX180),e.rotY90Z180=w(t(),e.rotY90,e.rotZ180),e.id=r()}(he||(he={})),function(e){function t(){var k=[.1,0,0,0,0,0,0,0,0];return k[0]=0,k}function r(){var k=t();return k[0]=1,k[1]=0,k[2]=0,k[3]=0,k[4]=1,k[5]=0,k[6]=0,k[7]=0,k[8]=1,k}function s(k,W){return k[0]=W[0],k[1]=W[1],k[2]=W[2],k[3]=W[4],k[4]=W[5],k[5]=W[6],k[6]=W[8],k[7]=W[9],k[8]=W[10],k}e.zero=t,e.identity=r,e.setIdentity=function n(k){return k[0]=1,k[1]=0,k[2]=0,k[3]=0,k[4]=1,k[5]=0,k[6]=0,k[7]=0,k[8]=1,k},e.toArray=function a(k,W,$){return W[$+0]=k[0],W[$+1]=k[1],W[$+2]=k[2],W[$+3]=k[3],W[$+4]=k[4],W[$+5]=k[5],W[$+6]=k[6],W[$+7]=k[7],W[$+8]=k[8],W},e.fromArray=function i(k,W,$){return k[0]=W[$+0],k[1]=W[$+1],k[2]=W[$+2],k[3]=W[$+3],k[4]=W[$+4],k[5]=W[$+5],k[6]=W[$+6],k[7]=W[$+7],k[8]=W[$+8],k},e.fromColumns=function o(k,W,$,K){return k[0]=W[0],k[1]=W[1],k[2]=W[2],k[3]=$[0],k[4]=$[1],k[5]=$[2],k[6]=K[0],k[7]=K[1],k[8]=K[2],k},e.fromMat4=s,e.create=function u(k,W,$,K,q,V,ee,ae,pe){var me=t();return me[0]=k,me[1]=W,me[2]=$,me[3]=K,me[4]=q,me[5]=V,me[6]=ee,me[7]=ae,me[8]=pe,me};var c=r();function p(k,W,$){for(var K=0;K<9;K++)if(Math.abs(k[K]-W[K])>$)return!1;return!0}function v(k,W){return k[0]=W[0],k[1]=W[1],k[2]=W[2],k[3]=W[3],k[4]=W[4],k[5]=W[5],k[6]=W[6],k[7]=W[7],k[8]=W[8],k}function g(k,W){if(k===W){var $=W[1],K=W[2],q=W[5];k[1]=W[3],k[2]=W[6],k[3]=$,k[5]=W[7],k[6]=K,k[7]=q}else k[0]=W[0],k[1]=W[3],k[2]=W[6],k[3]=W[1],k[4]=W[4],k[5]=W[7],k[6]=W[2],k[7]=W[5],k[8]=W[8];return k}function y(k,W){var $=W[0],K=W[1],q=W[2],V=W[3],ee=W[4],ae=W[5],pe=W[6],me=W[7],de=W[8],re=de*ee-ae*me,te=-de*V+ae*pe,le=me*V-ee*pe,ge=$*re+K*te+q*le;return ge?(k[0]=re*(ge=1/ge),k[1]=(-de*K+q*me)*ge,k[2]=(ae*K-q*ee)*ge,k[3]=te*ge,k[4]=(de*$-q*pe)*ge,k[5]=(-ae*$+q*V)*ge,k[6]=le*ge,k[7]=(-me*$+K*pe)*ge,k[8]=(ee*$-K*V)*ge,k):(console.warn("non-invertible matrix.",W),k)}function _(k){var q=k[3],V=k[4],ee=k[5],ae=k[6],pe=k[7],me=k[8];return k[0]*(me*V-ee*pe)+k[1]*(-me*q+ee*ae)+k[2]*(pe*q-V*ae)}function x(k){return k[0]+k[4]+k[8]}function D(k,W,$){return k[0]=W[0]-$[0],k[1]=W[1]-$[1],k[2]=W[2]-$[2],k[3]=W[3]-$[3],k[4]=W[4]-$[4],k[5]=W[5]-$[5],k[6]=W[6]-$[6],k[7]=W[7]-$[7],k[8]=W[8]-$[8],k}function M(k,W,$){return k[0]=W[0]*$,k[1]=W[1]*$,k[2]=W[2]*$,k[3]=W[3]*$,k[4]=W[4]*$,k[5]=W[5]*$,k[6]=W[6]*$,k[7]=W[7]*$,k[8]=W[8]*$,k}e.isIdentity=function l(k,W){return p(k,c,typeof W>"u"?mn:W)},e.hasNaN=function d(k){for(var W=0;W<9;W++)if(isNaN(k[W]))return!0;return!1},e.clone=function f(k){return v(t(),k)},e.areEqual=p,e.setValue=function m(k,W,$,K){k[3*$+W]=K},e.getValue=function h(k,W,$){return k[3*$+W]},e.copy=v,e.transpose=g,e.invert=y,e.symmtricFromUpper=function S(k,W){return k===W?(k[3]=W[1],k[6]=W[2],k[7]=W[5]):(k[0]=W[0],k[1]=W[1],k[2]=W[2],k[3]=W[1],k[4]=W[4],k[5]=W[5],k[6]=W[2],k[7]=W[5],k[8]=W[8]),k},e.symmtricFromLower=function C(k,W){return k===W?(k[1]=W[3],k[2]=W[6],k[5]=W[7]):(k[0]=W[0],k[1]=W[3],k[2]=W[6],k[3]=W[3],k[4]=W[4],k[5]=W[7],k[6]=W[6],k[7]=W[7],k[8]=W[8]),k},e.determinant=_,e.trace=x,e.sub=D,e.add=function w(k,W,$){return k[0]=W[0]+$[0],k[1]=W[1]+$[1],k[2]=W[2]+$[2],k[3]=W[3]+$[3],k[4]=W[4]+$[4],k[5]=W[5]+$[5],k[6]=W[6]+$[6],k[7]=W[7]+$[7],k[8]=W[8]+$[8],k},e.mul=function A(k,W,$){var K=W[0],q=W[1],V=W[2],ee=W[3],ae=W[4],pe=W[5],me=W[6],de=W[7],re=W[8],te=$[0],le=$[1],ge=$[2],xe=$[3],Ge=$[4],je=$[5],L=$[6],Q=$[7],ye=$[8];return k[0]=te*K+le*ee+ge*me,k[1]=te*q+le*ae+ge*de,k[2]=te*V+le*pe+ge*re,k[3]=xe*K+Ge*ee+je*me,k[4]=xe*q+Ge*ae+je*de,k[5]=xe*V+Ge*pe+je*re,k[6]=L*K+Q*ee+ye*me,k[7]=L*q+Q*ae+ye*de,k[8]=L*V+Q*pe+ye*re,k},e.subScalar=function E(k,W,$){return k[0]=W[0]-$,k[1]=W[1]-$,k[2]=W[2]-$,k[3]=W[3]-$,k[4]=W[4]-$,k[5]=W[5]-$,k[6]=W[6]-$,k[7]=W[7]-$,k[8]=W[8]-$,k},e.addScalar=function I(k,W,$){return k[0]=W[0]+$,k[1]=W[1]+$,k[2]=W[2]+$,k[3]=W[3]+$,k[4]=W[4]+$,k[5]=W[5]+$,k[6]=W[6]+$,k[7]=W[7]+$,k[8]=W[8]+$,k},e.mulScalar=M;var F=Math.PI/3,N=t();e.symmetricEigenvalues=function j(k,W){var $=W[1]*W[1]+W[2]*W[2]+W[5]*W[5];if(0===$)k[0]=W[0],k[1]=W[4],k[2]=W[8];else{var K=x(W)/3,q=W[0]-K,V=W[4]-K,ee=W[8]-K,pe=Math.sqrt((q*q+V*V+ee*ee+2*$)/6);M(N,e.Identity,K),D(N,W,N),M(N,N,1/pe);var me=_(N)/2,de=me<=-1?F:me>=1?0:Math.acos(me)/3;k[0]=K+2*pe*Math.cos(de),k[2]=K+2*pe*Math.cos(de+2*F),k[1]=3*K-k[0]-k[2]}return k};var U=[.1,0,0],H=[.1,0,0],z=[.1,0,0],G=[.1,0,0],J=[.1,0,0],X=[.1,0,0];e.eigenvector=function Z(k,W,$){b.set(U,W[0]-$,W[1],W[2]),b.set(H,W[1],W[4]-$,W[5]),b.set(z,W[2],W[5],W[8]-$),b.cross(G,U,H),b.cross(J,U,z),b.cross(X,H,z);var K=b.dot(G,G),q=b.dot(J,J),V=b.dot(X,X),ee=K,ae=0;return q>ee&&(ee=q,ae=1),V>ee&&(ae=2),0===ae?b.scale(k,G,1/Math.sqrt(K)):1===ae?b.scale(k,J,1/Math.sqrt(q)):b.scale(k,X,1/Math.sqrt(V)),k},e.directionTransform=function ne(k,W){return s(k,W),y(k,k),g(k,k),k},e.Identity=r(),e.innerProduct=function Y(k,W){return k[0]*W[0]+k[1]*W[1]+k[2]*W[2]+k[3]*W[3]+k[4]*W[4]+k[5]*W[5]+k[6]*W[6]+k[7]*W[7]+k[8]*W[8]}}(Qt||(Qt={})),function(e){function t(){var w=[.1,0];return w[0]=0,w}e.zero=t,e.clone=function r(w){var A=t();return A[0]=w[0],A[1]=w[1],A},e.create=function n(w,A){var E=t();return E[0]=w,E[1]=A,E},e.hasNaN=function a(w){return isNaN(w[0])||isNaN(w[1])},e.toArray=function i(w,A,E){return A[E+0]=w[0],A[E+1]=w[1],A},e.fromArray=function o(w,A,E){return w[0]=A[E+0],w[1]=A[E+1],w},e.copy=function s(w,A){return w[0]=A[0],w[1]=A[1],w},e.set=function u(w,A,E){return w[0]=A,w[1]=E,w},e.add=function c(w,A,E){return w[0]=A[0]+E[0],w[1]=A[1]+E[1],w},e.sub=function l(w,A,E){return w[0]=A[0]-E[0],w[1]=A[1]-E[1],w},e.mul=function d(w,A,E){return w[0]=A[0]*E[0],w[1]=A[1]*E[1],w},e.div=function f(w,A,E){return w[0]=A[0]/E[0],w[1]=A[1]/E[1],w},e.scale=function p(w,A,E){return w[0]=A[0]*E,w[1]=A[1]*E,w},e.round=function m(w,A){return w[0]=Math.round(A[0]),w[1]=Math.round(A[1]),w},e.ceil=function h(w,A){return w[0]=Math.ceil(A[0]),w[1]=Math.ceil(A[1]),w},e.floor=function v(w,A){return w[0]=Math.floor(A[0]),w[1]=Math.floor(A[1]),w},e.distance=function g(w,A){var E=A[0]-w[0],I=A[1]-w[1];return Math.sqrt(E*E+I*I)},e.squaredDistance=function y(w,A){var E=A[0]-w[0],I=A[1]-w[1];return E*E+I*I},e.magnitude=function S(w){var A=w[0],E=w[1];return Math.sqrt(A*A+E*E)},e.squaredMagnitude=function C(w){var A=w[0],E=w[1];return A*A+E*E},e.inverse=function _(w,A){return w[0]=1/A[0],w[1]=1/A[1],w},e.areEqual=function x(w,A){return w[0]===A[0]&&w[1]===A[1]},e.toString=function D(w,A){return"[".concat(w[0].toPrecision(A)," ").concat(w[1].toPrecision(A),"}]")}}(Be||(Be={})),function(e){function t(){var M=[.1,0,0,0];return M[0]=0,M}function a(M,F){return M[0]=F.center[0],M[1]=F.center[1],M[2]=F.center[2],M[3]=F.radius,M}e.zero=t,e.clone=function r(M){var F=t();return F[0]=M[0],F[1]=M[1],F[2]=M[2],F[3]=M[3],F},e.create=function n(M,F,N,j){var U=t();return U[0]=M,U[1]=F,U[2]=N,U[3]=j,U},e.fromSphere=a,e.ofSphere=function i(M){return a(t(),M)},e.hasNaN=function o(M){return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])},e.toArray=function s(M,F,N){return F[N+0]=M[0],F[N+1]=M[1],F[N+2]=M[2],F[N+3]=M[3],F},e.fromArray=function u(M,F,N){return M[0]=F[N+0],M[1]=F[N+1],M[2]=F[N+2],M[3]=F[N+3],M},e.toVec3Array=function c(M,F,N){F[N+0]=M[0],F[N+1]=M[1],F[N+2]=M[2]},e.fromVec3Array=function l(M,F,N){return M[0]=F[N+0],M[1]=F[N+1],M[2]=F[N+2],M[3]=0,M},e.copy=function d(M,F){return M[0]=F[0],M[1]=F[1],M[2]=F[2],M[3]=F[3],M},e.set=function f(M,F,N,j,U){return M[0]=F,M[1]=N,M[2]=j,M[3]=U,M},e.add=function p(M,F,N){return M[0]=F[0]+N[0],M[1]=F[1]+N[1],M[2]=F[2]+N[2],M[3]=F[3]+N[3],M},e.distance=function m(M,F){var N=F[0]-M[0],j=F[1]-M[1],U=F[2]-M[2],H=F[3]-M[3];return Math.sqrt(N*N+j*j+U*U+H*H)},e.scale=function h(M,F,N){return M[0]=F[0]*N,M[1]=F[1]*N,M[2]=F[2]*N,M[4]=F[4]*N,M},e.round=function v(M,F){return M[0]=Math.round(F[0]),M[1]=Math.round(F[1]),M[2]=Math.round(F[2]),M[3]=Math.round(F[3]),M},e.ceil=function g(M,F){return M[0]=Math.ceil(F[0]),M[1]=Math.ceil(F[1]),M[2]=Math.ceil(F[2]),M[3]=Math.ceil(F[3]),M},e.floor=function y(M,F){return M[0]=Math.floor(F[0]),M[1]=Math.floor(F[1]),M[2]=Math.floor(F[2]),M[3]=Math.floor(F[3]),M},e.squaredDistance=function S(M,F){var N=F[0]-M[0],j=F[1]-M[1],U=F[2]-M[2],H=F[3]-M[3];return N*N+j*j+U*U+H*H},e.norm=function C(M){var F=M[0],N=M[1],j=M[2],U=M[3];return Math.sqrt(F*F+N*N+j*j+U*U)},e.squaredNorm=function _(M){var F=M[0],N=M[1],j=M[2],U=M[3];return F*F+N*N+j*j+U*U},e.transformMat4=function x(M,F,N){var j=F[0],U=F[1],H=F[2],z=F[3];return M[0]=N[0]*j+N[4]*U+N[8]*H+N[12]*z,M[1]=N[1]*j+N[5]*U+N[9]*H+N[13]*z,M[2]=N[2]*j+N[6]*U+N[10]*H+N[14]*z,M[3]=N[3]*j+N[7]*U+N[11]*H+N[15]*z,M},e.dot=function D(M,F){return M[0]*F[0]+M[1]*F[1]+M[2]*F[2]+M[3]*F[3]},e.inverse=function w(M,F){return M[0]=1/F[0],M[1]=1/F[1],M[2]=1/F[2],M[3]=1/F[3],M},e.exactEquals=function A(M,F){return M[0]===F[0]&&M[1]===F[1]&&M[2]===F[2]&&M[3]===F[3]},e.equals=function E(M,F){var N=M[0],j=M[1],U=M[2],H=M[3],z=F[0],G=F[1],J=F[2],X=F[3];return Math.abs(N-z)<=mn*Math.max(1,Math.abs(N),Math.abs(z))&&Math.abs(j-G)<=mn*Math.max(1,Math.abs(j),Math.abs(G))&&Math.abs(U-J)<=mn*Math.max(1,Math.abs(U),Math.abs(J))&&Math.abs(H-X)<=mn*Math.max(1,Math.abs(H),Math.abs(X))},e.toString=function I(M,F){return"[".concat(M[0].toPrecision(F)," ").concat(M[1].toPrecision(F)," ").concat(M[2].toPrecision(F),"  ").concat(M[3].toPrecision(F),"]")}}(dr||(dr={})),function(e){function t(){var Y=[.1,0,0,0];return Y[0]=0,Y}function r(){var Y=t();return Y[3]=1,Y}function o(Y,k,W){W*=.5;var $=Math.sin(W);return Y[0]=$*k[0],Y[1]=$*k[1],Y[2]=$*k[2],Y[3]=Math.cos(W),Y}function p(Y,k,W,$){var re,te,le,ge,xe,K=k[0],q=k[1],V=k[2],ee=k[3],ae=W[0],pe=W[1],me=W[2],de=W[3];return(te=K*ae+q*pe+V*me+ee*de)<0&&(te=-te,ae=-ae,pe=-pe,me=-me,de=-de),1-te>1e-6?(re=Math.acos(te),le=Math.sin(re),ge=Math.sin((1-$)*re)/le,xe=Math.sin($*re)/le):(ge=1-$,xe=$),Y[0]=ge*K+xe*ae,Y[1]=ge*q+xe*pe,Y[2]=ge*V+xe*me,Y[3]=ge*ee+xe*de,Y}function g(Y,k){var $,W=k[0]+k[4]+k[8];if(W>0)$=Math.sqrt(W+1),Y[3]=.5*$,Y[0]=(k[5]-k[7])*($=.5/$),Y[1]=(k[6]-k[2])*$,Y[2]=(k[1]-k[3])*$;else{var K=0;k[4]>k[0]&&(K=1),k[8]>k[3*K+K]&&(K=2);var q=(K+1)%3,V=(K+2)%3;$=Math.sqrt(k[3*K+K]-k[3*q+q]-k[3*V+V]+1),Y[K]=.5*$,Y[3]=(k[3*q+V]-k[3*V+q])*($=.5/$),Y[q]=(k[3*q+K]+k[3*K+q])*$,Y[V]=(k[3*V+K]+k[3*K+V])*$}return Y}e.zero=t,e.identity=r,e.setIdentity=function n(Y){Y[0]=0,Y[1]=0,Y[2]=0,Y[3]=1},e.hasNaN=function a(Y){return isNaN(Y[0])||isNaN(Y[1])||isNaN(Y[2])||isNaN(Y[3])},e.create=function i(Y,k,W,$){var K=r();return K[0]=Y,K[1]=k,K[2]=W,K[3]=$,K},e.setAxisAngle=o,e.getAxisAngle=function s(Y,k){var W=2*Math.acos(k[3]),$=Math.sin(W/2);return 0!==$?(Y[0]=k[0]/$,Y[1]=k[1]/$,Y[2]=k[2]/$):(Y[0]=1,Y[1]=0,Y[2]=0),W},e.multiply=function u(Y,k,W){var $=k[0],K=k[1],q=k[2],V=k[3],ee=W[0],ae=W[1],pe=W[2],me=W[3];return Y[0]=$*me+V*ee+K*pe-q*ae,Y[1]=K*me+V*ae+q*ee-$*pe,Y[2]=q*me+V*pe+$*ae-K*ee,Y[3]=V*me-$*ee-K*ae-q*pe,Y},e.rotateX=function c(Y,k,W){W*=.5;var $=k[0],K=k[1],q=k[2],V=k[3],ee=Math.sin(W),ae=Math.cos(W);return Y[0]=$*ae+V*ee,Y[1]=K*ae+q*ee,Y[2]=q*ae-K*ee,Y[3]=V*ae-$*ee,Y},e.rotateY=function l(Y,k,W){W*=.5;var $=k[0],K=k[1],q=k[2],V=k[3],ee=Math.sin(W),ae=Math.cos(W);return Y[0]=$*ae-q*ee,Y[1]=K*ae+V*ee,Y[2]=q*ae+$*ee,Y[3]=V*ae-K*ee,Y},e.rotateZ=function d(Y,k,W){W*=.5;var $=k[0],K=k[1],q=k[2],V=k[3],ee=Math.sin(W),ae=Math.cos(W);return Y[0]=$*ae+K*ee,Y[1]=K*ae-$*ee,Y[2]=q*ae+V*ee,Y[3]=V*ae-q*ee,Y},e.calculateW=function f(Y,k){var W=k[0],$=k[1],K=k[2];return Y[0]=W,Y[1]=$,Y[2]=K,Y[3]=Math.sqrt(Math.abs(1-W*W-$*$-K*K)),Y},e.slerp=p,e.invert=function m(Y,k){var W=k[0],$=k[1],K=k[2],q=k[3],V=W*W+$*$+K*K+q*q,ee=V?1/V:0;return Y[0]=-W*ee,Y[1]=-$*ee,Y[2]=-K*ee,Y[3]=q*ee,Y},e.conjugate=function h(Y,k){return Y[0]=-k[0],Y[1]=-k[1],Y[2]=-k[2],Y[3]=k[3],Y},e.dot=function v(Y,k){return Y[0]*k[0]+Y[1]*k[1]+Y[2]*k[2]+Y[3]*k[3]},e.fromMat3=g,e.fromEuler=function y(Y,k,W){var $=k[0],K=k[1],q=k[2],V=Math.cos($/2),ee=Math.cos(K/2),ae=Math.cos(q/2),pe=Math.sin($/2),me=Math.sin(K/2),de=Math.sin(q/2);switch(W){case"XYZ":Y[0]=pe*ee*ae+V*me*de,Y[1]=V*me*ae-pe*ee*de,Y[2]=V*ee*de+pe*me*ae,Y[3]=V*ee*ae-pe*me*de;break;case"YXZ":Y[0]=pe*ee*ae+V*me*de,Y[1]=V*me*ae-pe*ee*de,Y[2]=V*ee*de-pe*me*ae,Y[3]=V*ee*ae+pe*me*de;break;case"ZXY":Y[0]=pe*ee*ae-V*me*de,Y[1]=V*me*ae+pe*ee*de,Y[2]=V*ee*de+pe*me*ae,Y[3]=V*ee*ae-pe*me*de;break;case"ZYX":Y[0]=pe*ee*ae-V*me*de,Y[1]=V*me*ae+pe*ee*de,Y[2]=V*ee*de-pe*me*ae,Y[3]=V*ee*ae+pe*me*de;break;case"YZX":Y[0]=pe*ee*ae+V*me*de,Y[1]=V*me*ae+pe*ee*de,Y[2]=V*ee*de-pe*me*ae,Y[3]=V*ee*ae-pe*me*de;break;case"XZY":Y[0]=pe*ee*ae-V*me*de,Y[1]=V*me*ae-pe*ee*de,Y[2]=V*ee*de+pe*me*ae,Y[3]=V*ee*ae+pe*me*de;break;default:Sn()}return Y};var S=[0,0,0];function F(Y,k){var W=k[0],$=k[1],K=k[2],q=k[3],V=W*W+$*$+K*K+q*q;return V>0&&(V=1/Math.sqrt(V),Y[0]=W*V,Y[1]=$*V,Y[2]=K*V,Y[3]=q*V),Y}e.fromUnitVec3=function C(Y,k,W){var $=b.dot(k,W)+1;return $<mn?($=0,Math.abs(k[0])>Math.abs(k[2])?b.set(S,-k[1],k[0],0):b.set(S,0,-k[2],k[1])):b.cross(S,k,W),Y[0]=S[0],Y[1]=S[1],Y[2]=S[2],Y[3]=$,F(Y,Y),Y},e.clone=function _(Y){var k=t();return k[0]=Y[0],k[1]=Y[1],k[2]=Y[2],k[3]=Y[3],k},e.toArray=function x(Y,k,W){return k[W+0]=Y[0],k[W+1]=Y[1],k[W+2]=Y[2],k[W+3]=Y[3],k},e.fromArray=function D(Y,k,W){return Y[0]=k[W+0],Y[1]=k[W+1],Y[2]=k[W+2],Y[3]=k[W+3],Y},e.copy=function w(Y,k){return Y[0]=k[0],Y[1]=k[1],Y[2]=k[2],Y[3]=k[3],Y},e.set=function A(Y,k,W,$,K){return Y[0]=k,Y[1]=W,Y[2]=$,Y[3]=K,Y},e.exactEquals=function E(Y,k){return Y[0]===k[0]&&Y[1]===k[1]&&Y[2]===k[2]&&Y[3]===k[3]},e.equals=function I(Y,k){var W=Y[0],$=Y[1],K=Y[2],q=Y[3],V=k[0],ee=k[1],ae=k[2],pe=k[3];return Math.abs(W-V)<=mn*Math.max(1,Math.abs(W),Math.abs(V))&&Math.abs($-ee)<=mn*Math.max(1,Math.abs($),Math.abs(ee))&&Math.abs(K-ae)<=mn*Math.max(1,Math.abs(K),Math.abs(ae))&&Math.abs(q-pe)<=mn*Math.max(1,Math.abs(q),Math.abs(pe))},e.add=function M(Y,k,W){return Y[0]=k[0]+W[0],Y[1]=k[1]+W[1],Y[2]=k[2]+W[2],Y[3]=k[3]+W[3],Y},e.normalize=F;var N=[0,0,0],j=[1,0,0],U=[0,1,0];e.rotationTo=function H(Y,k,W){var $=b.dot(k,W);return $<-.999999?(b.cross(N,j,k),b.magnitude(N)<1e-6&&b.cross(N,U,k),b.normalize(N,N),o(Y,N,Math.PI),Y):$>.999999?(Y[0]=0,Y[1]=0,Y[2]=0,Y[3]=1,Y):(b.cross(N,k,W),Y[0]=N[0],Y[1]=N[1],Y[2]=N[2],Y[3]=1+$,F(Y,Y))};var z=t(),G=t();e.sqlerp=function J(Y,k,W,$,K,q){return p(z,k,K,q),p(G,W,$,q),p(Y,z,G,2*q*(1-q)),Y};var X=[0,0,0,0,0,0,0,0,0];e.setAxes=function Z(Y,k,W,$){return X[0]=W[0],X[3]=W[1],X[6]=W[2],X[1]=$[0],X[4]=$[1],X[7]=$[2],X[2]=-k[0],X[5]=-k[1],X[8]=-k[2],F(Y,g(Y,X))},e.toString=function ne(Y,k){return"[".concat(Y[0].toPrecision(k)," ").concat(Y[1].toPrecision(k)," ").concat(Y[2].toPrecision(k),"  ").concat(Y[3].toPrecision(k),"]")},e.Identity=r()}(hn||(hn={})),function(e){function n(_,x,D){var w=function t(_,x,D){for(var w=[],A=0;A<x.length;A++)w[A]=x[x.length-A-1];var E=[1];for(A=1;A<_.length;A++)E[A]=_[w[A-1]];return{dimensions:_,axisOrderFastToSlow:w,axisOrderSlowToFast:x,accessDimensions:E,defaultCtor:D||Float64Array}}(_,x,D),A=function p(_){var x=_.dimensions,D=_.axisOrderFastToSlow;switch(x.length){case 1:return{get:function(K,q){return K[q]},set:function(K,q,V){return K[q]=V},add:function(K,q,V){return K[q]+=V},dataOffset:function(K){return K},getCoords:function(K,q){return q[0]=K,q}};case 2:if(0===D[0]&&1===D[1]){var w=x[0];return{get:function(K,q,V){return K[V*w+q]},set:function(K,q,V,ee){return K[V*w+q]=ee},add:function(K,q,V,ee){return K[V*w+q]+=ee},dataOffset:function(K,q){return q*w+K},getCoords:function(K,q){return q[0]=K%w,q[1]=Math.floor(K/w),q}}}if(1===D[0]&&0===D[1]){var A=x[1];return{get:function(K,q,V){return K[q*A+V]},set:function(K,q,V,ee){return K[q*A+V]=ee},add:function(K,q,V,ee){return K[q*A+V]+=ee},dataOffset:function(K,q){return K*A+q},getCoords:function(K,q){return q[0]=Math.floor(K/A),q[1]=K%A,q}}}throw new Error("bad axis order");case 3:if(0===D[0]&&1===D[1]&&2===D[2]){var E=x[0],I=x[1],M=E*I;return{get:function(K,q,V,ee){return K[q+V*E+ee*M]},set:function(K,q,V,ee,ae){return K[q+V*E+ee*M]=ae},add:function(K,q,V,ee,ae){return K[q+V*E+ee*M]+=ae},dataOffset:function(K,q,V){return K+q*E+V*M},getCoords:function(K,q){var V=Math.floor(K/E);return q[0]=K%E,q[1]=V%I,q[2]=Math.floor(V/I),q}}}if(0===D[0]&&2===D[1]&&1===D[2]){var F=x[0],N=x[2],j=F*N;return{get:function(K,q,V,ee){return K[q+ee*F+V*j]},set:function(K,q,V,ee,ae){return K[q+ee*F+V*j]=ae},add:function(K,q,V,ee,ae){return K[q+ee*F+V*j]+=ae},dataOffset:function(K,q,V){return K+V*F+q*j},getCoords:function(K,q){var V=Math.floor(K/F);return q[0]=K%F,q[1]=Math.floor(V/N),q[2]=V%N,q}}}if(1===D[0]&&0===D[1]&&2===D[2]){var U=x[1],H=x[0],z=U*H;return{get:function(K,q,V,ee){return K[V+q*U+ee*z]},set:function(K,q,V,ee,ae){return K[V+q*U+ee*z]=ae},add:function(K,q,V,ee,ae){return K[V+q*U+ee*z]+=ae},dataOffset:function(K,q,V){return q+K*U+V*z},getCoords:function(K,q){var V=Math.floor(K/U);return q[0]=V%H,q[1]=K%U,q[2]=Math.floor(V/H),q}}}if(1===D[0]&&2===D[1]&&0===D[2]){var G=x[1],J=x[2],X=G*J;return{get:function(K,q,V,ee){return K[V+ee*G+q*X]},set:function(K,q,V,ee,ae){return K[V+ee*G+q*X]=ae},add:function(K,q,V,ee,ae){return K[V+ee*G+q*X]+=ae},dataOffset:function(K,q,V){return q+V*G+K*X},getCoords:function(K,q){var V=Math.floor(K/G);return q[0]=Math.floor(V/J),q[1]=K%G,q[2]=V%J,q}}}if(2===D[0]&&0===D[1]&&1===D[2]){var Z=x[2],ne=x[0],Y=Z*ne;return{get:function(K,q,V,ee){return K[ee+q*Z+V*Y]},set:function(K,q,V,ee,ae){return K[ee+q*Z+V*Y]=ae},add:function(K,q,V,ee,ae){return K[ee+q*Z+V*Y]+=ae},dataOffset:function(K,q,V){return V+K*Z+q*Y},getCoords:function(K,q){var V=Math.floor(K/Z);return q[0]=V%ne,q[1]=Math.floor(V/ne),q[2]=K%Z,q}}}if(2===D[0]&&1===D[1]&&0===D[2]){var k=x[2],W=x[1],$=k*W;return{get:function(K,q,V,ee){return K[ee+V*k+q*$]},set:function(K,q,V,ee,ae){return K[ee+V*k+q*$]=ae},add:function(K,q,V,ee,ae){return K[ee+V*k+q*$]+=ae},dataOffset:function(K,q,V){return V+q*k+K*$},getCoords:function(K,q){var V=Math.floor(K/k);return q[0]=Math.floor(V/W),q[1]=V%W,q[2]=K%k,q}}}throw new Error("bad axis order");default:return{get:function(K){for(var q=[],V=1;V<arguments.length;V++)q[V-1]=arguments[V];return K[h(_,q)]},set:function(K){for(var q=[],V=1;V<arguments.length;V++)q[V-1]=arguments[V];return K[h(_,q)]=q[q.length-1]},add:function(K){for(var q=[],V=1;V<arguments.length;V++)q[V-1]=arguments[V];return K[h(_,q)]+=q[q.length-1]},dataOffset:function(){for(var K=[],q=0;q<arguments.length;q++)K[q]=arguments[q];return h(_,K)},getCoords:function(K,q){return function v(_,x,D){for(var w=_.dimensions,A=_.axisOrderFastToSlow,E=w.length,I=x,M=0;M<E;M++){var F=w[A[M]];D[A[M]]=I%F,I=Math.floor(I/F)}return D[A[E+1]]=I,D}(_,K,q)}}}}(w),E=A.get,I=A.set,M=A.add,F=A.dataOffset,N=A.getCoords;return{rank:_.length,dimensions:_,axisOrderSlowToFast:x,create:m(w),get:E,set:I,add:M,dataOffset:F,getCoords:N}}function m(_){for(var x=_.dimensions,D=1,w=0,A=x.length;w<A;w++)D*=x[w];return function(E){return new(E||_.defaultCtor)(D)}}function h(_,x){for(var D=_.accessDimensions,w=_.axisOrderFastToSlow,A=D.length-1,E=D[A]*x[w[A]],I=A-1;I>=0;I--)E=(E+x[w[I]])*D[I];return E}function y(_,x){for(var D=[],w=0;w<_.length;w++)D[w]=_[x[w]];return D}e.create=function r(_,x){return{space:_,data:x}},e.Space=n,e.Data1=function a(_){return _},e.Vector=function i(_,x){return n([_],[0],x)},e.ColumnMajorMatrix=function o(_,x,D){return n([_,x],[1,0],D)},e.RowMajorMatrix=function s(_,x,D){return n([_,x],[0,1],D)},e.toMat4=function u(_,x,D){if(2!==x.rank)throw new Error("Invalid tensor rank");for(var w=Math.min(4,x.dimensions[0]),A=Math.min(4,x.dimensions[1]),E=0;E<w;E++)for(var I=0;I<A;I++)he.setValue(_,E,I,x.get(D,E,I));return _},e.toMat3=function c(_,x,D){if(2!==x.rank)throw new Error("Invalid tensor rank");for(var w=Math.min(3,x.dimensions[0]),A=Math.min(3,x.dimensions[1]),E=0;E<w;E++)for(var I=0;I<A;I++)Qt.setValue(_,E,I,x.get(D,E,I));return _},e.toVec3=function l(_,x,D){if(1!==x.rank)throw new Error("Invalid tensor rank");for(var w=Math.min(3,x.dimensions[0]),A=0;A<w;A++)_[A]=D[A];return _},e.toVec4=function d(_,x,D){if(1!==x.rank)throw new Error("Invalid tensor rank");for(var w=Math.min(4,x.dimensions[0]),A=0;A<w;A++)_[A]=D[A];return _},e.areEqualExact=function f(_,x){var D=_.length;if(D!==x.length)return!1;for(var w=0;w<D;w++)if(_[w]!==x[w])return!1;return!0},e.invertAxisOrder=function g(_){for(var x=[],D=0;D<_.length;D++)x[D]=_[_.length-D-1];return x},e.convertToCanonicalAxisIndicesFastToSlow=function S(_){for(var x=new Int32Array(_.length),D=0;D<_.length;D++)x[_[D]]=D;return function(w){return y(w,x)}},e.convertToCanonicalAxisIndicesSlowToFast=function C(_){for(var x=new Int32Array(_.length),D=0;D<_.length;D++)x[_[_.length-D-1]]=D;return function(w){return y(w,x)}}}(Sr||(Sr={}));var hw=Object.prototype.hasOwnProperty;function I_e(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(hw.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function gO(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!hw.call(e,i)||e[i]!==t[i])return!1}return!0}function fl(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=fl(e[r]);return t}if("object"==typeof e&&!("prototype"in e)){for(var a in t={},e)hw.call(e,a)&&(t[a]=fl(e[a]));return t}throw new Error("Can't clone, type \"".concat(typeof e,'" unsupported'))}function Fs(e,t){if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function Gq(e,t){return void 0===t&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1".concat(t,"$2"))}var O_e=function(e){return e.toUpperCase()};function Mh(e){return e.toLowerCase().replace(/^\w|\s\w/g,O_e)}function yc(e){return Mh(Gq(function zq(e){return e.replace(/_/g," ")}(function Hq(e){return e.replace(/-/g," ")}(e))))}function Wa(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function yO(e){return e.replace(/<\/?[^>]+>/g,"")}function aS(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ii(){return Ii.zero()}function pl(){return pl.zero()}function dt(e){return e}function Vr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function vw(e,t,r){var n={};for(var a in e){var i=e[a];i=dt.saturate(i,t),i=dt.darken(i,-r),n[a]=i}return n}!function(e){function t(){var M=[.1,0,0];return M[0]=0,M}function u(M,F){var N=F[0],j=F[1],U=F[2],H=Math.sqrt(j*j+U*U),z=(Ru(Math.atan2(U,j))+360)%360;return 0===Math.round(1e4*H)&&(z=Number.NaN),M[0]=z,M[1]=H,M[2]=N,M}function l(M,F,N){return M[0]=F[0]-h*N,M[1]=F[1],M[2]=F[2],M}e.zero=t,e.create=function r(M,F,N){var j=t();return j[0]=M,j[1]=F,j[2]=N,j},e.set=function n(M,F,N,j){return M[0]=F,M[1]=N,M[2]=j,M},e.distance=function a(M,F){var N=F[0]-M[0],j=F[1]-M[1],U=F[2]-M[2];return Math.sqrt(N*N+j*j+U*U)},e.fromColor=function i(M,F){var N=dt.toRgb(F),z=function I(M,F,N){return[E((.4124564*(M=A(M))+.3575761*(F=A(F))+.1804375*(N=A(N)))/v),E((.2126729*M+.7151522*F+.072175*N)/g),E((.0193339*M+.119192*F+.9503041*N)/y)]}(N[0],N[1],N[2]),G=z[0],J=z[1],X=z[2],Z=116*J-16;return M[0]=Z<0?0:Z,M[1]=500*(G-J),M[2]=200*(J-X),M},e.fromHcl=function o(M,F){return pl.toLab(M,F)},e.toColor=function s(M){var F=(M[0]+16)/116,N=isNaN(M[1])?F:F+M[1]/500,j=isNaN(M[2])?F:F-M[2]/200;F=g*w(F);var U=D(3.2404542*(N=v*w(N))-1.5371385*F-.4985314*(j=y*w(j))),H=D(-.969266*N+1.8760108*F+.041556*j),z=D(.0556434*N-.2040259*F+1.0572252*j);return dt.fromRgb(Math.round(Xi(U,0,255)),Math.round(Xi(H,0,255)),Math.round(Xi(z,0,255)))},e.toHcl=u,e.copy=function c(M,F){return M[0]=F[0],M[1]=F[1],M[2]=F[2],M},e.darken=l,e.lighten=function d(M,F,N){return l(M,F,-N)};var f=[0,0,0];function p(M,F,N){return u(f,F),pl.toLab(M,pl.saturate(f,f,N))}e.saturate=p,e.desaturate=function m(M,F,N){return p(M,F,-N)};var h=18,v=.95047,g=1,y=1.08883,S=.137931034,C=.206896552,_=.12841855,x=.008856452;function D(M){return 255*(M<=.00304?12.92*M:1.055*Math.pow(M,1/2.4)-.055)}function w(M){return M>C?M*M*M:_*(M-S)}function A(M){return(M/=255)<=.04045?M/12.92:Math.pow((M+.055)/1.055,2.4)}function E(M){return M>x?Math.pow(M,1/3):M/_+S}}(Ii||(Ii={})),function(e){function t(){var y=[.1,0,0];return y[0]=0,y}e.zero=t,e.create=function r(y,S,C){var _=t();return _[0]=y,_[1]=S,_[2]=C,_},e.set=function n(y,S,C,_){return y[0]=S,y[1]=C,y[2]=_,y},e.hasHue=function a(y){return!isNaN(y[0])};var i=[0,0,0];e.fromColor=function o(y,S){return Ii.toHcl(y,Ii.fromColor(i,S))},e.fromLab=function s(y,S){return Ii.toHcl(y,S)};var u=[0,0,0];function l(y,S){var C=S[0],_=S[1],x=S[2];return isNaN(C)&&(C=0),C=Yr(C),y[0]=x,y[1]=Math.cos(C)*_,y[2]=Math.sin(C)*_,y}function f(y,S,C){return y[0]=S[0],y[1]=Math.max(0,S[1]+g*C),y[2]=S[2],y}e.toColor=function c(y){return Ii.toColor(l(u,y))},e.toLab=l,e.copy=function d(y,S){return y[0]=S[0],y[1]=S[1],y[2]=S[2],y},e.saturate=f,e.desaturate=function p(y,S,C){return f(y,S,-C)};var m=[0,0,0];function h(y,S,C){return l(m,S),Ii.toHcl(y,Ii.darken(m,m,C))}e.darken=h,e.lighten=function v(y,S,C){return h(y,S,-C)};var g=18}(pl||(pl={})),function(e){function c(U,H,z){return U<<16|H<<8|z}function l(U,H,z){return 255*U<<16|255*H<<8|255*z}function y(U){var H=U>>16&255;return H!==(U>>8&255)||H!==(255&U)}e.toStyle=function t(U){return"rgb(".concat(U>>16&255,", ").concat(U>>8&255,", ").concat(255&U,")")},e.toHexStyle=function r(U){return"#"+("000000"+U.toString(16)).slice(-6)},e.toHexString=function n(U){return"0x"+("000000"+U.toString(16)).slice(-6)},e.toRgbString=function a(U){return"RGB: ".concat(e.toRgb(U).join(", "))},e.toRgb=function i(U){return[U>>16&255,U>>8&255,255&U]},e.toRgbNormalized=function o(U){return[(U>>16&255)/255,(U>>8&255)/255,(255&U)/255]},e.fromHexStyle=function s(U){return parseInt(U.replace("#","0x"))},e.fromHexString=function u(U){return parseInt(U)},e.fromRgb=c,e.fromNormalizedRgb=l,e.fromArray=function d(U,H){return c(U[H],U[H+1],U[H+2])},e.fromNormalizedArray=function f(U,H){return l(U[H],U[H+1],U[H+2])},e.toArray=function p(U,H,z){return H[z]=U>>16&255,H[z+1]=U>>8&255,H[z+2]=255&U,H},e.toArrayNormalized=function m(U,H,z){return H[z]=(U>>16&255)/255,H[z+1]=(U>>8&255)/255,H[z+2]=(255&U)/255,H},e.toVec3=function h(U,H){return U[0]=H>>16&255,U[1]=H>>8&255,U[2]=255&H,U},e.toVec3Normalized=function v(U,H){return U[0]=(H>>16&255)/255,U[1]=(H>>8&255)/255,U[2]=(255&H)/255,U},e.interpolate=function g(U,H,z){var G=U>>16&255,J=U>>8&255,X=255&U;return G+((H>>16&255)-G)*z<<16|J+((H>>8&255)-J)*z<<8|X+((255&H)-X)*z},e.hasHue=y;var S=[0,0,0];function C(U,H){return y(U)?(pl.fromColor(S,U),pl.toColor(pl.saturate(S,S,H))):U}e.saturate=C,e.desaturate=function _(U,H){return C(U,-H)};var x=[0,0,0];function D(U,H){return Ii.fromColor(x,U),Ii.toColor(Ii.darken(x,x,H))}function A(U){return U<=.03928?U/12.92:Math.pow((U+.055)/1.055,2.4)}function E(U){return.2126*A((U>>16&255)/255)+.7152*A((U>>8&255)/255)+.0722*A((255&U)/255)}function M(U){return U<.04045?.0773993808*U:Math.pow(.9478672986*U+.0521327014,2.4)}function N(U){return U<.0031308?12.92*U:1.055*Math.pow(U,.41666)-.055}e.darken=D,e.lighten=function w(U,H){return D(U,-H)},e.luminance=E,e.contrast=function I(U,H){var z=E(U),G=E(H);return z>G?(z+.05)/(G+.05):(G+.05)/(z+.05)},e.sRGBToLinear=function F(U){return l(M((U>>16&255)/255),M((U>>8&255)/255),M((255&U)/255))},e.linearToSRGB=function j(U){return l(N((U>>16&255)/255),N((U>>8&255)/255),N((255&U)/255))}}(dt||(dt={}));var qe,ru={"orange-red":Vr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":Vr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":Vr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:Vr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":Vr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":Vr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":Vr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:Vr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":Vr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:Vr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":Vr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:Vr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":Vr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:Vr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":Vr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":Vr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:Vr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":Vr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:Vr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":Vr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":Vr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":Vr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":Vr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":Vr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":Vr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":Vr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":Vr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":Vr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:Vr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":Vr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":Vr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":Vr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:Vr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":Vr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":Vr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":Vr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:Vr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:Vr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:Vr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:Vr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:Vr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:Vr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:Vr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:Vr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":Vr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},jq=Object.keys(ru).map(function(e){return[e,ru[e].label,Mh(ru[e].type)]});function pf(e){return e in ru?ru[e]:(console.warn("unknown color list named '".concat(e,"'")),ru["red-yellow-blue"])}function gw(e,t,r){return e[t]-e[r]}function Rh(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function qq(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function k_e(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,qq(i,n,t,r));n(i,u,t)>0;)--u;for(var c=t+1;c<=u;c++){var l=n(i,c,t);if(l>0){for(a(i,c,u),--u;n(i,u,t)>0;)--u;c--}else 0===l&&(a(i,c,s),s++)}for(c=t;c<s;c++)a(i,c,t+u-c);o[0]=u-s+t+1,o[1]=u}function L_e(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s-=1}function yw(e,t,r){for(var n=e.parts;t<r;){if(r-t<16)return void L_e(e,t,r);k_e(e,t,r);var a=n[0],i=n[1];a-t<r-i?(yw(e,t,a-1),t=i+1):(yw(e,i+1,r),r=a-1)}}function U_e(e,t,r,n){var a=r+1,i=n;Rh(e,r,qq(e,gw,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(Rh(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(Rh(e,s,a),++a)}for(s=r;s<a;s++)Rh(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function V_e(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i-=1;e[i+1]=a}}function bO(e,t,r,n){for(;r<n;){if(n-r<16)return void V_e(e,r,n);U_e(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(bO(e,t,r,a-1),r=i+1):(bO(e,t,i+1,n),n=a-1)}}function bc(e,t){return void 0===t&&(t=gw),function G_e(e,t,r,n){return void 0===n&&(n=gw),n===gw?bO(e,[0,0],t,r-1):yw({data:e,cmp:n,swap:Rh,parts:[0,0]},t,r-1),e}(e,0,e.length,t)}function Wq(e,t,r,n,a){return yw({data:e,cmp:n,swap:a,parts:[0,0]},t,r-1),e}function z_e(e,t,r){return e[t].key<e[r].key?-1:1}function SO(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return function H_e(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,c=n;c<a;c++){var l=t(e[c]);i.has(l)?(i.get(l).count++,s!==l&&(u=!1)):(i.set(l,d={key:l,count:1,offset:c}),o[o.length]=d),s=l}var f=new Int32Array(o.length+1);f[o.length]=a;var p=!0;if(r){c=1;for(var m=o.length;c<m;c++)if(o[c-1].key>o[c].key){p=!1;break}}if(u&&p){for(c=0;c<o.length;c++)f[c]=o[c].offset;return f}r&&!p&&Wq(o,0,o.length,z_e,Rh);var h=0;for(c=0;c<o.length;c++){var v=o[c];v.offset=h,h+=v.count}var g=new Int32Array(a-n);for(c=n;c<a;c++){var d;l=t(e[c]),g[(d=i.get(l)).offset++]=e[c]}for(c=0,m=g.length;c<m;c++)e[c+n]=g[c];for(f[0]=n,c=1;c<o.length;c++)f[c]=o[c-1].offset+n;return f}(e,t,!(!r||!r.sort),n,a)}jq.filter(function(e){return"diverging"===ru[e[0]].type||"sequential"===ru[e[0]].type}),jq.filter(function(e){return"qualitative"===ru[e[0]].type}),function(e){function r(f){var p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function l(f,p){var m=f.ctor,h=f.chunks,v=f.currentIndex;if(!h.length)return new m(0);if(1===h.length&&(p||v===f.allocatedSize))return h[0];for(var g=0,y=0,S=h.length-1;y<S;y++)g+=h[y].length;var C=new m(g+=f.currentIndex),_=0;if(C.buffer)for(y=0,S=h.length-1;y<S;y++)C.set(h[y],_),_+=h[y].length;else for(y=0,S=h.length-1;y<S;y++){for(var x=h[y],D=0,w=x.length;D<w;D++)C[_+D]=x[D];_+=x.length}var A=h[h.length-1];if(C.buffer&&v>=f.currentSize)C.set(A,_);else for(D=0,w=A.length;D<w;D++)C[_+D]=A[D];return C}e.is=function t(f){return f.creator&&f.chunkSize},e.add4=function n(f,p,m,h,v){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=m,g[y+2]=h,g[y+3]=v,f.currentIndex+=4,f.elementCount++},e.add3=function a(f,p,m,h){f.currentIndex>=f.currentSize&&r(f);var v=f.currentChunk,g=f.currentIndex;return v[g]=p,v[g+1]=m,v[g+2]=h,f.currentIndex+=3,f.elementCount++},e.add2=function i(f,p,m){f.currentIndex>=f.currentSize&&r(f);var h=f.currentChunk,v=f.currentIndex;return h[v]=p,h[v+1]=m,f.currentIndex+=2,f.elementCount++},e.add=function o(f,p){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++},e.addRepeat=function s(f,p,m){for(var h=0;h<p;h++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=m,f.elementCount++;return f.elementCount},e.addMany=function u(f,p){for(var m=f.elementSize,h=0,v=p.length;h<v;h+=m){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<m;y++)g[f.currentIndex++]=p[h+y];f.elementCount++}return f.elementCount},e.compact=function c(f,p){return void 0===p&&(p=!1),l(f,p)},e._compact=l,e.create=function d(f,p,m,h){var v={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(m)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof h>"u")return v;if("number"==typeof h)return v.currentChunk=new f(h*p),v.allocatedSize=h*p,v.currentSize=v.currentChunk.length,v.chunks[0]=v.currentChunk,v;var g=h;if(g.length%p!=0)throw new Error("initialChunk length must be a multiple of the element size.");return v.currentChunk=g,v.allocatedSize=g.length,v.currentSize=g.length,v.chunks[0]=g,v}}(qe||(qe={}));var ie,Xr,_O,j_e=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}return u=this.createGroup(t,r),this.byHash.set(n,[u]),u.value},e}();function Yq(e){var t=e^e>>4;return(t=(3735928559^t)+(t<<5))^t>>11}function Oh(e,t){var r=23;return r=31*(r=31*r+e|0)+t|0,(r=(3735928559^(r^=r>>4))+(r<<5))^r>>11}function CO(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}function Ou(e,t){return(e+t)*(e+t+1)/2+t}function iS(e,t){return e<t?Ou(e,t):Ou(t,e)}function Xq(e,t){var r=Math.floor((Math.sqrt(8*t+1)-1)/2),a=t-(r*r+r)/2;return e[0]=r-a,e[1]=a,e}function rs(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function E0(e,t){return{start:t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,end:t&&typeof t.end<"u"?Math.min(t.end,e):e}}function oS(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=E0(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function _o(e,t,r){var n=oS(e,r);return function X_e(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}(t,n.array,n.start)}function xO(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT}function bw(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=E0(a,t),u=s.start,c=s.end;return 0===u&&c===a?e:new r(n,i+o*u,Math.min(a,c-u))}function Fh(e,t,r){for(;t<r&&32===e.charCodeAt(t);)t++;return Xp(e,t,r)}function Xp(e,t,r){var n=t,a=0,i=1;for(45===e.charCodeAt(n)?(i=-1,++n):43===e.charCodeAt(n)&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function Kq(e,t,r,n){return 43===t.charCodeAt(r)&&r++,e*Math.pow(10,Xp(t,r,n))}function mf(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(45===e.charCodeAt(n)?(a=-1,++n):43===e.charCodeAt(n)&&++n;n<r;){var u=e.charCodeAt(n)-48;if(!(u>=0&&u<10)){if(-2===u){for(++n;n<r;){if(!((u=e.charCodeAt(n)-48)>=0&&u<10))return 53===u||21===u?Kq(a*(i+o/s),e,n+1,r):a*(i+o/s);o=10*o+u,s*=10,++n}return a*(i+o/s)}if(53===u||21===u)return Kq(a*i,e,n+1,r);break}i=10*i+u,++n}return a*i}function Qq(e,t,r,n){return{schema:r,__array:void 0,isDefined:0===n,rowCount:t,value:function(i){return e},valueKind:function(i){return n},toArray:function(i){for(var o=oS(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function Sw(e){var t=e.value,a=e.rowCount;return{schema:e.schema,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:e.valueKind||function(o){return 0},toArray:function(o){for(var s=oS(a,o),u=s.array,c=s.start,l=0,d=u.length;l<d;l++)u[l]=t(l+c);return u},areValuesEqual:e.areValuesEqual||function(o,s){return t(o)===t(s)}}}function hf(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.T,o="str"===r.valueType?"lowercase"===r.transform?function(u){var c=t[u];return"string"==typeof c?c.toLowerCase():"".concat(c??i).toLowerCase()}:"uppercase"===r.transform?function(u){var c=t[u];return"string"==typeof c?c.toUpperCase():"".concat(c??i).toUpperCase()}:function(u){var c=t[u];return"string"==typeof c?c:"".concat(c??i)}:function(u){return t[u]},s=xO(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:o,valueKind:n||function(u){return 0},toArray:"str"===r.valueType?"lowercase"===r.transform?function(u){for(var c=E0(a,u),l=c.start,d=c.end,f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,m=d-l;p<m;p++){var h=t[l+p];f[p]="string"==typeof h?h.toLowerCase():"".concat(h??i).toLowerCase()}return f}:"uppercase"===r.transform?function(u){for(var c=E0(a,u),l=c.start,d=c.end,f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,m=d-l;p<m;p++){var h=t[l+p];f[p]="string"==typeof h?h.toUpperCase():"".concat(h??i).toUpperCase()}return f}:function(u){for(var c=E0(a,u),l=c.start,d=c.end,f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,m=d-l;p<m;p++){var h=t[l+p];f[p]="string"==typeof h?h:"".concat(h??i)}return f}:s?function(u){return bw(t,u)}:function(u){var c=E0(a,u),l=c.start,d=c.end;if(0===l&&d===t.length)return t;for(var f=new(u&&typeof u.array<"u"?u.array:t.constructor)(d-l),p=0,m=d-l;p<m;p++)f[p]=t[l+p];return f},areValuesEqual:function(u,c){return t[u]===t[c]}}}function wO(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function Cw(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),a=r.value;if(r.done)break;t[t.length]=a}return t}function AO(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function pwe(e,t){for(var r=new(function mwe(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}function I0(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128)e[t++]=i>>>0&127|0;else if(i<2048)e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;else if(i<65536)e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;else{if(!(i<1114112))throw new Error("bad codepoint "+i);e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128}}}!function(e){var t;function n(E,I){return Qq(I.T,E,I,1)}function i(E){return Sw(E)}!function(E){function N(G,J){return void 0===J&&(J=E.float),{"@type":"tensor",T:G.create(),space:G,valueType:"tensor",baseType:J}}E.str={"@type":"str",T:"",valueType:"str"},E.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},E.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},E.int={"@type":"int",T:0,valueType:"int"},E.coord={"@type":"coord",T:0,valueType:"float"},E.float={"@type":"float",T:0,valueType:"float"},E.Str=function I(G){var J;return{"@type":"str",T:null!==(J=G?.defaultValue)&&void 0!==J?J:"",transform:G?.transform,valueType:"str"}},E.Int=function M(G){return void 0===G&&(G=0),{"@type":"int",T:G,valueType:"int"}},E.Float=function F(G){return void 0===G&&(G=0),{"@type":"float",T:G,valueType:"float"}},E.Tensor=N,E.Vector=function j(G,J){return void 0===J&&(J=E.float),N(Sr.Vector(G,"int"===J["@type"]?Int32Array:Float64Array),J)},E.Matrix=function U(G,J,X){return void 0===X&&(X=E.float),N(Sr.ColumnMajorMatrix(G,J,"int"===X["@type"]?Int32Array:Float64Array),X)},E.Aliased=function H(G){return G},E.List=function z(G,J,X){return void 0===X&&(X=[]),{"@type":"list",T:X,separator:G,itemParse:J,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function r(E){return!!E&&!!E.schema&&!!E.value},e.ValueKind={Present:0,NotPresent:1,Unknown:2},e.Undefined=n,e.ofConst=function a(E,I,M){return Qq(E,I,M,0)},e.ofLambda=i,e.range=function o(E,I){return i({value:function(M){return M+E},rowCount:Math.max(I-E+1,0),schema:t.int})},e.ofArray=function s(E){return hf(E)},e.ofIntArray=function u(E){return hf({array:E,schema:t.int})},e.ofFloatArray=function c(E){return hf({array:E,schema:t.float})},e.ofStringArray=function l(E){return hf({array:E,schema:t.str})},e.ofStringAliasArray=function d(E){return hf({array:E,schema:t.Aliased(t.str)})},e.ofStringListArray=function f(E,I){return void 0===I&&(I=","),hf({array:E,schema:t.List(I,function(M){return M})})},e.ofIntTokens=function p(E){var M=E.data,F=E.indices;return Sw({value:function(N){return Xp(M,F[2*N],F[2*N+1])||0},rowCount:E.count,schema:t.int})},e.ofFloatTokens=function m(E){var M=E.data,F=E.indices;return Sw({value:function(N){return mf(M,F[2*N],F[2*N+1])||0},rowCount:E.count,schema:t.float})},e.ofStringTokens=function h(E){var M=E.data,F=E.indices;return Sw({value:function(N){var j=M.substring(F[2*N],F[2*N+1]);return"."===j||"?"===j?"":j},rowCount:E.count,schema:t.str})},e.window=function v(E,I,M){return function J_e(e,t,r){return e.isDefined?0===t&&r===e.rowCount?e:e.__array&&xO(e.__array)?function ewe(e,t,r){var n=bw(e.__array,{start:t,end:r}),a=e.valueKind;return hf({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}(e,t,r):function twe(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=0===t?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:0===t?a:function(u){return a(u+t)},toArray:function(u){for(var c=oS(s,u).array,l=0,d=c.length;l<d;l++)c[l]=n(l+t);return c},areValuesEqual:0===t?i:function(u,c){return i(u+t,c+t)}}}(e,t,r):ie.Undefined(r-t,e.schema)}(E,I,M)},e.view=function g(E,I,M){return void 0===M&&(M=!0),function nwe(e,t,r){return 0===e.rowCount||r&&function rwe(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?function awe(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return hf({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}(e,t):function iwe(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:function(s){return r(t[s])},valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=oS(o,s).array,c=0,l=u.length;c<l;c++)u[c]=r(t[c]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}(e,t)}(E,I,M)},e.createFirstIndexMap=function y(E){return function Q_e(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}(E)},e.createIndexer=function S(E){return function $_e(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}(E)},e.mapToArray=function C(E,I,M){return function owe(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}(E,I,M||Array)},e.areEqual=function _(E,I){return function swe(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function uwe(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}(e,t):function cwe(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}(e,t))}(E,I)},e.indicesOf=function x(E,I){return function lwe(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}(E,I)},e.asArrayColumn=function D(E,I){return E.__array?E:E.isDefined?hf({array:E.toArray({array:I}),schema:E.schema,valueKind:E.valueKind}):n(E.rowCount,E.schema)},e.copyToArray=function w(E,I,M){if(void 0===M&&(M=0),E.isDefined){var F=E.__array;if(F)for(var N=0,j=F.length;N<j;N++)I[M+N]=F[N];else for(N=0,j=E.rowCount;N<j;N++)I[M+N]=E.value(N)}},e.isIdentity=function A(E){for(var I=0,M=E.rowCount;I<M;I++)if(I!==E.value(I))return!1;return!0}}(ie||(ie={})),function(e){function u(C,_,x){var D=Object.create(null),w=Object.keys(_);D._rowCount=x.length,D._columns=w,D._schema=_;for(var A=0,E=w;A<E.length;A++){var I=E[A];D[I]=ie.view(C[I],x)}return D}function h(C,_){for(var x=Object.create(null),D=C._columns,w=0;w<D.length;w++){var A=D[w];x[A]=C[A].value(_)}return x}e.is=function t(C){return C&&"number"==typeof C._rowCount&&!!C._columns&&!!C._schema},e.pickColumns=function r(C,_,x){void 0===x&&(x={});var D=Object.create(null),w=Object.keys(C);D._rowCount=_._rowCount,D._columns=w,D._schema=C;for(var A=0,E=w;A<E.length;A++){var I=E[A];if(_[I])D[I]=_[I];else{if(!x[I])throw Error("Cannot find column '".concat(I,"'."));D[I]=x[I]}}return D},e.ofColumns=function n(C,_){var x=Object.keys(_);return R({_rowCount:_[x[0]].rowCount,_columns:x,_schema:C},_)},e.ofPartialColumns=function a(C,_,x){var D=Object.create(null),w=Object.keys(C);D._rowCount=x,D._columns=w,D._schema=C;for(var A=0,E=w;A<E.length;A++){var I=E[A];D[I]=I in _?_[I]:ie.Undefined(x,C[I])}return D},e.ofUndefinedColumns=function i(C,_){var x=Object.create(null),D=Object.keys(C);x._rowCount=_,x._columns=D,x._schema=C;for(var w=0,A=D;w<A.length;w++){var E=A[w];x[E]=ie.Undefined(_,C[E])}return x},e.ofRows=function o(C,_){var x=Object.create(null),D=_.length,w=Object.keys(C);x._rowCount=D,x._columns=w,x._schema=C;for(var A=function(F){x[F]=ie.ofLambda({rowCount:D,schema:C[F],value:function(N){return _[N][F]},valueKind:function(N){return typeof _[N][F]>"u"?1:0}})},E=0,I=w;E<I.length;E++)A(I[E]);return x},e.ofArrays=function s(C,_){var x,D=Object.create(null),w=Object.keys(C);D._rowCount=0,D._columns=w,D._schema=C;for(var A=0,E=w;A<E.length;A++){var I=E[A];typeof _[I]<"u"?(D[I]=ie.ofArray({array:_[I],schema:C[I]}),D._rowCount=null===(x=_[I])||void 0===x?void 0:x.length):D[I]=ie.Undefined(D._rowCount,C[I])}return D},e.view=u,e.pick=function c(C,_,x){for(var D=[],w=0,A=C._rowCount;w<A;++w)x(w)&&D.push(w);return u(C,_,D)},e.window=function l(C,_,x,D){if(0===x&&D===C._rowCount)return C;var w=Object.create(null),A=Object.keys(_);w._rowCount=D-x,w._columns=A,w._schema=_;for(var E=0,I=A;E<I.length;E++){var M=I[E];w[M]=ie.window(C[M],x,D)}return w},e.concat=function d(C,_){var x=Object.create(null),D=Object.keys(_);x._rowCount=0;for(var w=0,A=C;w<A.length;w++)x._rowCount+=(E=A[w])._rowCount;for(var I={},M=0,F=D;M<F.length;M++)I[F[M]]=new Array(x._rowCount);x._columns=D,x._schema=_;for(var j=0,U=0,H=C;U<H.length;U++){for(var E=H[U],z=0,G=D;z<G.length;z++)ie.copyToArray(E[J=G[z]],I[J],j);j+=E._rowCount}for(var X=0,Z=D;X<Z.length;X++){var J;x[J=Z[X]]=ie.ofArray({array:I[J],schema:_[J]})}return x},e.columnToArray=function f(C,_,x){C[_]=ie.asArrayColumn(C[_],x)},e.sort=function p(C,_){for(var x=new Int32Array(C._rowCount),D=0,w=x.length;D<w;D++)x[D]=D;bc(x,function(N,j,U){return _(j,U)});var A=!0;for(D=0,w=x.length;D<w;D++)if(x[D]!==D){A=!1;break}if(A)return C;var E=Object.create(null);E._rowCount=C._rowCount,E._columns=C._columns,E._schema=C._schema;for(var I=0,M=C._columns;I<M.length;I++){var F=M[I];E[F]=ie.view(C[F],x,!1)}return E},e.areEqual=function m(C,_){if(C._rowCount!==_._rowCount||C._columns.length!==_._columns.length)return!1;for(var x=0,D=C._columns;x<D.length;x++)if(!_[w=D[x]])return!1;for(var A=0,E=C._columns;A<E.length;A++){var w;if(!ie.areEqual(C[w=E[A]],_[w]))return!1}return!0},e.getRow=h,e.pickRow=function v(C,_){for(var x=0,D=C._rowCount;x<D;++x)if(_(x))return h(C,x)},e.getRows=function g(C){for(var _=[],x=C._rowCount,D=0;D<x;D++)_[D]=h(C,D);return _},e.toArrays=function y(C){for(var _={},x=C._columns,D=0;D<x.length;D++){var w=x[D];_[w]=C[w].toArray()}return _},e.formatToString=function S(C){var _=tn.create(),x=C._columns,D=C._rowCount,w=1;tn.write(_,"|");for(var A=0;A<x.length;A++)tn.write(_,x[A]),tn.write(_,"|"),w+=x[A].length+1;tn.newline(_),tn.write(_,new Array(w+1).join("-")),tn.newline(_);for(var E=0;E<D;E++){for(tn.write(_,"|"),A=0;A<x.length;A++){var I=C[x[A]];0===I.valueKind(E)?(tn.write(_,I.value(E)),tn.write(_,"|")):tn.write(_,".|")}tn.newline(_)}return tn.getString(_)}}(Xr||(Xr={})),function(e){e.ofTables=function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var c=0,l=o;c<l.length;c++){var d=l[c];Xr.is(i[d])&&(s[d]=i[d],u[u.length]=d)}return s},e.getTablesAsRows=function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=Xr.getRows(n[s])}return a}}(_O||(_O={})),function(){function e(t){this.getKey=t,this.map=new Map,this.keys=[],this.groups=[]}e.prototype.add=function(t){var n,r=this.getKey(t);this.map.has(r)?(n=this.map.get(r))[n.length]=t:(this.map.set(r,n=[t]),this.keys[this.keys.length]=r,this.groups[this.groups.length]=n)},e.prototype.getGrouping=function(){return{keys:this.keys,groups:this.groups,map:this.map}}}();var hwe=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function $q(e){throw new Error(e)}var Jq=typeof TextDecoder<"u"?new TextDecoder:void 0;function TO(e,t,r){if(Jq){var n=t||r!==e.length?e.subarray(t,t+r):e;return Jq.decode(n)}return function vwe(e,t,r){for(var n=hwe,a=void 0,i=0,o=[],u=t,c=t+r;u<c;u++){var l=e[u];128&l?192==(224&l)?o[i++]=n[(15&l)<<6|63&e[++u]]:224==(240&l)?o[i++]=String.fromCharCode((15&l)<<12|(63&e[++u])<<6|(63&e[++u])<<0):240==(248&l)?o[i++]=String.fromCharCode((7&l)<<18|(63&e[++u])<<12|(63&e[++u])<<6|(63&e[++u])<<0):$q("Invalid byte "+l.toString(16)):o[i++]=n[l],512===i&&((a=a||[])[a.length]=o.join(""),i=0)}return a?(i>0&&(a[a.length]=o.slice(0,i).join("")),a.join("")):o.slice(0,i).join("")}(e,t,r)}function xw(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);a<128?t+=1:a<2048?t+=2:a<65536?t+=3:a<1114112?t+=4:$q("bad codepoint "+a)}return t}var DO=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,or([e],r,!1))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:function gwe(){var a,h,v,g,e=(h=typeof window<"u"&&window,v=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,g=typeof global<"u"&&global,h||g||v),t={},r=typeof document<"u"?document:void 0,n=1;function o(h){delete t[h]}function u(h){var v=t[h];o(h),function s(h){var v=h.callback,g=h.args;switch(g.length){case 0:v();break;case 1:v(g[0]);break;case 2:v(g[0],g[1]);break;case 3:v(g[0],g[1],g[2]);break;default:v.apply(void 0,g)}}(v)}return typeof process<"u"&&"[object process]"==={}.toString.call(process)?function c(){a=function(h){process.nextTick(function(){u(h)})}}():function l(){if(e&&e.postMessage&&!e.importScripts){var h=!0,v=e.onmessage;return e.onmessage=function(){h=!1},e.postMessage("","*"),e.onmessage=v,h}}()?function d(){var h="setImmediate$"+Math.random()+"$",v=function(g){g.source===e&&"string"==typeof g.data&&0===g.data.indexOf(h)&&u(+g.data.slice(h.length))};window.addEventListener?window.addEventListener("message",v,!1):window.attachEvent("onmessage",v),a=function(g){window.postMessage(h+g,"*")}}():typeof MessageChannel<"u"?function f(){var h=new MessageChannel;h.port1.onmessage=function(v){u(v.data)},a=function(v){h.port2.postMessage(v)}}():r&&"onreadystatechange"in r.createElement("script")?function p(){var h=r.documentElement;a=function(v){var g=r.createElement("script");g.onreadystatechange=function(){u(v),g.onreadystatechange=null,h.removeChild(g),g=null},h.appendChild(g)}}():function m(){a=function(h){setTimeout(u,0,h)}}(),{setImmediate:function i(h){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];return"function"!=typeof h&&(h=new Function(""+h)),t[n]={callback:h,args:v},a(n),n++},clearImmediate:o}}();function ywe(e){DO.setImmediate(e)}var lS,sS={setImmediate:DO.setImmediate,clearImmediate:DO.clearImmediate,immediatePromise:function(){return new Promise(ywe)},delay:function(e,t){return void 0===t&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},uS=function(){try{return!0}catch{return!1}}(),Cr=function(){try{var t=process.env.DEBUG;return"*"===t||"molstar"===t}catch{return!1}}(),xt=!1,cS=[],EO=typeof performance<"u"&&!!performance.mark&&performance.measure&&xt;function _we(e,t,r){void 0===r&&(r=250);var n=rW(e,t,r);return new uW(n,n.root)}function eW(e,t){return IO(t,e)}function tW(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function rW(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:ia(),observer:t,abortToken:n,taskId:e.id,root:{progress:tW(e),children:[]},tryAbort:Awe(n)}}function Awe(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function nW(e){return{progress:R({},e.progress),children:e.children.map(nW)}}function aW(e){return e.progress.canAbort&&e.children.every(aW)}function IO(e,t){return ue(this,void 0,void 0,function(){var r,n;return ce(this,function(a){switch(a.label){case 0:lS.markStart(e),t.node.progress.startedTime=ia(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),lS.markEnd(e),lS.measure(e),t.info.abortToken.abortRequested&&iW(t.info),[2,r];case 3:return n=a.sent(),Ve.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw n;case 7:return[2]}})})}function iW(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,oW(e.root),sW(e,ia())),Ve.Aborted(e.abortToken.reason)}function oW(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++)oW(n[r])}function sW(e,t){e.lastNotified=t;var r=function Twe(e){return{root:nW(e.root),canAbort:aW(e.root),requestAbort:e.tryAbort}}(e);e.observer(r)}!function(e){function t(o){return"startTask".concat(o.id)}function r(o){return"endTask".concat(o.id)}e.markStart=function n(o){EO&&performance.mark(t(o))},e.markEnd=function a(o){EO&&performance.mark(r(o))},e.measure=function i(o){EO&&performance.measure("\u2733\ufe0f ".concat(o.name),t(o),r(o))}}(lS||(lS={}));var Ve,cW,uW=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,iW(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),ia()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),t){var r=this.node.progress;"string"==typeof t?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=ia(),this.updateProgress(t),!r)return sW(this.info,this.lastUpdatedTime),this.checkAborted(),sS.immediatePromise()},e.prototype.runChild=function(t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ce(this,function(l){switch(l.label){case 0:this.updateProgress(r),n={progress:tW(t),children:[]},(a=this.node.children).push(n),i=new e(this.info,n),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,IO(t,i)];case 2:return[2,l.sent()];case 3:if(o=l.sent(),Ve.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if((s=a.indexOf(n))>=0){for(u=s,c=a.length-1;u<c;u++)a[u]=a[u+1];a.pop()}return 0===a.length&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),Dwe=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),_w=new Dwe;function vf(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=ia(),c=0,l=0,f.label=1;case 1:return(c=n(i,r))>0?(o+=c,d=ia()-u,l+=d,s+=d,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),i=Math.round(l*o/s)+1,u=ia(),l=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}!function(e){var t=function(){function d(f,p,m){this.name=f,this.f=p,this.onAbort=m,this.id=l()}return d.prototype.run=function(f,p){return void 0===p&&(p=250),f?function xwe(e,t,r){void 0===r&&(r=250);var n=rW(e,t,r);return IO(e,new uW(n,n.root))}(this,f,p):this.f(_w)},d.prototype.runAsChild=function(f,p){return f.isSynchronous?this.f(_w):function wwe(e,t,r){return e.runChild(t,r)}(f,this,p)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(_w):eW(f,this)},d}();function r(d){return!!d&&"number"==typeof d.id&&"string"==typeof d.name&&!!d.run}function i(d,f,p){return new t(d,f,p)}e.is=r,e.isAbort=function n(d){return!!d&&!!d.isAborted},e.Aborted=function a(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted".concat(d?": "+d:"")}}},e.create=i,e.constant=function o(d,f){var p=this;return i(d,function(m){return ue(p,void 0,void 0,function(){return ce(this,function(h){return[2,f]})})})},e.empty=function s(){var d=this;return i("",function(f){return ue(d,void 0,void 0,function(){return ce(this,function(p){return[2]})})})},e.fail=function u(d,f){var p=this;return i(d,function(m){return ue(p,void 0,void 0,function(){return ce(this,function(h){throw new Error(f)})})})},e.resolveInContext=function c(d,f){return r(d)?f?d.runInContext(f):d.run():d};var l=Jo(0,1073741823)}(Ve||(Ve={})),function(e){function t(n,a){void 0===a&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message);var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message,"\n").concat(s.join("\n")):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message,"\n").concat(s.join("\n"))}e.format=function r(n){return t(n.root)}}(cW||(cW={}));var P0=typeof process<"u"&&null!=process.versions&&null!=process.versions.node,dS=function Iwe(){return typeof XMLHttpRequest>"u"||P0?Or(744):XMLHttpRequest}(),PO=function Pwe(){return typeof File>"u"||P0?function(){function t(r,n,a){var i;this.blob=new Blob(r,a),this.size=this.blob.size,this.type=this.blob.type,this.name=n,this.lastModified=null!==(i=a?.lastModified)&&void 0!==i?i:0,this.webkitRelativePath=""}return t.prototype.arrayBuffer=function(){return this.blob.arrayBuffer()},t.prototype.slice=function(r,n,a){return this.blob.slice(r,n,a)},t.prototype.stream=function(){return this.blob.stream()},t.prototype.text=function(){return this.blob.text()},t}():File}();function Kp(e,t){return e[t]|e[t+1]<<8}function Bh(e,t,r){e[t]=255&r,e[t+1]=r>>8&255}function Nh(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])}function gf(e,t,r){e[t]=255&r,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function Owe(e){return e.length<2?"0"+e:e}function lW(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if(4294967168&a)if(4294965248&a)if(4294901760&a){if(4292870144&a)throw new Error("e");r+=4}else r+=3;else r+=2;else r++}return r}var Nwe=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}();function dW(e,t,r){return 4294967295^function kwe(e,t,r,n){for(var a=0;a<n;a++)e=Nwe[255&(e^t[r+a])]^e>>>8;return e}(4294967295,e,t,r)}var vt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();function fS(e,t,r){for(var n=e.length,a=vt.rev15,i=0;i<n;i+=2)if(0!==e[i+1])for(var s=e[i+1],u=i>>1<<4|s,c=t-s,l=e[i]<<c,d=l+(1<<c);l!==d;)r[a[l]>>>15-t]=u,l++}function Zp(e,t){for(var r=e.length,n=vt.bl_count,a=0;a<=t;a++)n[a]=0;for(a=1;a<r;a+=2)n[e[a]]++;var i=vt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)i[s]=o=o+n[s-1]<<1;for(var u=0;u<r;u+=2){var c=e[u+1];0!==c&&(e[u]=i[c],i[c]++)}}function pS(e,t){for(var r=vt.rev15,n=15-t,a=0;a<e.length;a+=2)e[a]=r[e[a]<<t-e[a+1]]>>>n}function Vwe(e,t,r){return ue(this,void 0,void 0,function(){var n;return ce(this,function(a){switch(a.label){case 0:if(3===t[0]&&0===t[1])return[2,r||new Uint8Array(0)];n=function Lwe(e,t){var r=void 0===t;return void 0===t&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}(t,r),a.label=1;case 1:return 0!==n.BFINAL?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return function Uwe(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;0===i&&u<t;){var c=void 0,l=void 0,d=0,f=0;i=RO(r,s,1),u+=1;var p=RO(r,s+1,2);if(s+=3,0!==p){if(n&&(a=MO(a,o+(1<<17))),1===p)c=vt.flmap,l=vt.fdmap,d=511,f=31;else{if(2!==p)throw new Error("unknown BTYPE ".concat(p));var v=Qp(r,s,5)+257,g=Qp(r,s+5,5)+1,y=Qp(r,s+10,4)+4;s+=14;for(var S=0;S<38;S+=2)vt.itree[S]=0,vt.itree[S+1]=0;var C=1;for(S=0;S<y;S++){var _=Qp(r,s+3*S,3);vt.itree[1+(vt.ordr[S]<<1)]=_,_>C&&(C=_)}s+=3*y,Zp(vt.itree,C),fS(vt.itree,C,vt.imap),c=vt.lmap,l=vt.dmap,s=Gwe(vt.imap,(1<<C)-1,v+g,r,s,vt.ttree);var x=fW(vt.ttree,0,v,vt.ltree);d=(1<<x)-1;var D=fW(vt.ttree,v,g,vt.dtree);f=(1<<D)-1,Zp(vt.ltree,x),fS(vt.ltree,x,c),Zp(vt.dtree,D),fS(vt.dtree,D,l)}for(;;){var w=c[OO(r,s)&d];s+=15&w;var A=w>>>4;if(A>>>8){if(256===A)break;var E=o+A-254;if(A>264){var I=vt.ldef[A-257];E=o+(I>>>3)+Qp(r,s,7&I),s+=7&I}var M=l[OO(r,s)&f],N=vt.ddef[M>>>4],j=(N>>>4)+RO(r,s+=15&M,15&N);for(s+=15&N,n&&(a=MO(a,o+(1<<17)));o<E;)a[o]=a[o++-j],a[o]=a[o++-j],a[o]=a[o++-j],a[o]=a[o++-j];o=E}else a[o++]=A}}else{7&s&&(s+=8-(7&s));var m=4+(s>>>3),h=r[m-4]|r[m-3]<<8;n&&(a=MO(a,o+h)),a.set(new Uint8Array(r.buffer,r.byteOffset+m,h),o),s=m+h<<3,o+=h}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function MO(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function Gwe(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[OO(n,a)&t];a+=15&s;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var c=0,l=0;16===u?(l=3+Qp(n,a,2),a+=2,c=i[o-1]):17===u?(l=3+Qp(n,a,3),a+=3):18===u&&(l=11+Qp(n,a,7),a+=7);for(var d=o+l;o<d;)i[o]=c,o++}}return a}function fW(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[1+(i<<1)]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[1+(i<<1)]=0,i++;return a}function Qp(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1}function RO(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1}function OO(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}function FO(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(o=0;o<a;o++)0!==e[o]&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(0===s)return 0;if(1===s){var c=n[0].lit,l=0===c?1:0;return t[1+(c<<1)]=1,t[1+(l<<1)]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],p=0,m=1,h=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};m!==s-1;)d=p!==m&&(h===s||n[p].f<n[h].f)?n[p++]:n[h++],f=p!==m&&(h===s||n[p].f<n[h].f)?n[p++]:n[h++],n[m++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var v=BO(n[m-1],0);for(v>r&&(function zwe(e,t,r){var n=0,a=0,i=1<<r-t;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a>>>=r-t;a>0;)(o=e[n].d)<t?(e[n].d++,a-=1<<t-o-1):n++;for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);0!==a&&console.log("debt left")}(u,r,v),v=r),o=0;o<s;o++)t[1+(u[o].lit<<1)]=u[o].d;return v}function BO(e,t){return-1!==e.lit?(e.d=t,t):Math.max(BO(e.l,t+1),BO(e.r,t+1))}!function(){for(var t=0;t<32768;t++){var r=t;vt.rev15[t]=((r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8)>>>16|r<<16)>>>17}function n(a,i,o){for(;0!=i--;)a.push(0,o)}for(t=0;t<32;t++)vt.ldef[t]=vt.of0[t]<<3|vt.exb[t],vt.ddef[t]=vt.df0[t]<<4|vt.dxb[t];n(vt.fltree,144,8),n(vt.fltree,112,9),n(vt.fltree,24,7),n(vt.fltree,8,8),Zp(vt.fltree,9),fS(vt.fltree,9,vt.flmap),pS(vt.fltree,9),n(vt.fdtree,32,5),Zp(vt.fdtree,5),fS(vt.fdtree,5,vt.fdmap),pS(vt.fdtree,5),n(vt.itree,19,0),n(vt.ltree,286,0),n(vt.dtree,30,0),n(vt.ttree,320,0)}();var qwe=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function Wwe(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:if(i=function Hwe(e,t,r,n){return{data:e,out:t,opt:qwe[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:vt.lits,strt:vt.strt,prev:vt.prev}}(t,r,n,a),o=i.dlen,0===a){for(s=i.i,u=i.pos;s<o;)c=Math.min(65535,o-s),kh(r,u,s+c===o?1:0),u=mW(t,s,c,r,u+8),s+=c;return[2,u>>>3]}o>2&&(i.nc=NO(t,0),i.strt[i.nc]=0),g.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return function jwe(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,c=e.li,l=e.lc,d=e.bs,f=e.ebits,p=e.c,m=e.nc,h=vt.lits,v=vt.strt,g=vt.prev,y=Math.min(o+t,n);o<y;o++){if(p=m,o+1<n-2){m=NO(r,o+1);var S=o+1&32767;g[S]=v[m],v[m]=S}if(u<=o){(c>14e3||l>26697)&&n-o>100&&(u<o&&(h[c]=o-u,c+=2,u=o),s=pW(o===n-1||u===n?1:0,h,c,f,r,d,o-d,a,s),c=l=f=0,d=o);var C=0;if(o<n-2&&(C=Ywe(r,o,g,p,Math.min(i[2],n-o),i[3])),0!==C){var _=C>>>16,x=65535&C,D=gW(_,vt.of0);vt.lhst[257+D]++;var w=gW(x,vt.df0);vt.dhst[w]++,f+=vt.exb[D]+vt.dxb[w],h[c]=_<<23|o-u,h[c+1]=x<<16|D<<8|w,c+=2,u=o+_}else vt.lhst[r[o]]++;l++}}e.i=o,e.pos=s,e.cvrd=u,e.li=c,e.lc=l,e.bs=d,e.ebits=f,e.c=p,e.nc=m}(i,1048576),[3,1];case 4:for(l=i.li,d=i.cvrd,f=i.pos,m=i.lits,v=i.ebits,((h=i.bs)!==(p=i.i)||0===t.length)&&(d<p&&(m[l]=p-d,l+=2,d=p),f=pW(1,m,l,v,t,h,p-h,r,f));7&f;)f++;return[2,f>>>3]}})})}function Ywe(e,t,r,n,a,i){var o=32767&t,s=r[o],u=o-s+32768&32767;if(s===o||n!==NO(e,t-u))return 0;for(var c=0,l=0,d=Math.min(32767,t);u<=d&&0!=--i&&s!==o;){if(0===c||e[t+c]===e[t+c-u]){var f=Xwe(e,t,u);if(f>c){if(l=u,(c=f)>=a)break;u+2<f&&(f=u+2);for(var p=0,m=0;m<f-2;m++){var h=t-u+m+32768&32767,g=h-r[h]+32768&32767;g>p&&(p=g,s=h)}}}u+=(o=s)-(s=r[o])+32768&32767}return c<<16|l}function Xwe(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function NO(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function pW(e,t,r,n,a,i,o,s,u){vt.lhst[256]++;var c=function Kwe(){for(var e=FO(vt.lhst,vt.ltree,15),t=FO(vt.dhst,vt.dtree,15),r=[],n=vW(vt.ltree,r),a=[],i=vW(vt.dtree,a),o=0;o<r.length;o+=2)vt.ihst[r[o]]++;for(o=0;o<a.length;o+=2)vt.ihst[a[o]]++;for(var s=FO(vt.ihst,vt.itree,7),u=19;u>4&&0===vt.itree[1+(vt.ordr[u-1]<<1)];)u--;return[e,t,s,n,i,u,r,a]}(),l=c[0],d=c[1],f=c[2],p=c[3],m=c[4],h=c[5],v=c[6],g=c[7],y=32+(u+3&7?8-(u+3&7):0)+(o<<3),S=n+mS(vt.fltree,vt.lhst)+mS(vt.fdtree,vt.dhst),C=n+mS(vt.ltree,vt.lhst)+mS(vt.dtree,vt.dhst);C+=14+3*h+mS(vt.itree,vt.ihst)+(2*vt.ihst[16]+3*vt.ihst[17]+7*vt.ihst[18]);for(var _=0;_<286;_++)vt.lhst[_]=0;for(_=0;_<30;_++)vt.dhst[_]=0;for(_=0;_<19;_++)vt.ihst[_]=0;var x=y<S&&y<C?0:S<C?1:2;if(ww(s,u,e),ww(s,u+1,x),u+=3,0===x){for(;7&u;)u++;u=mW(a,i,o,s,u)}else{var D=void 0,w=void 0;if(1===x)D=vt.fltree,w=vt.fdtree;else if(2===x){Zp(vt.ltree,l),pS(vt.ltree,l),Zp(vt.dtree,d),pS(vt.dtree,d),Zp(vt.itree,f),pS(vt.itree,f),D=vt.ltree,w=vt.dtree,kh(s,u,p-257),kh(s,u+=5,m-1),kh(s,u+=5,h-4),u+=4;for(var A=0;A<h;A++)kh(s,u+3*A,vt.itree[1+(vt.ordr[A]<<1)]);u=hW(v,vt.itree,s,u+=3*h),u=hW(g,vt.itree,s,u)}else Sn();for(var E=i,I=0;I<r;I+=2){for(var M=t[I],F=M>>>23,N=E+(8388607&M);E<N;)u=hS(a[E++],D,s,u);if(0!==F){var j=t[I+1],U=j>>16,H=j>>8&255,z=255&j;kh(s,u=hS(257+H,D,s,u),F-vt.of0[H]),ww(s,u=hS(z,w,s,u+=vt.exb[H]),U-vt.df0[z]),u+=vt.dxb[z],E+=F}}u=hS(256,D,s,u)}return u}function mW(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function mS(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[1+(n<<1)];return r}function hW(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=hS(i,t,r,n);var s=16===i?2:17===i?3:7;i>15&&(kh(r,n,o),n+=s)}return n}function vW(e,t){for(var r=e.length;2!==r&&0===e[r-1];)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=0===n?-1:e[n-1];if(0===a&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;(c=Math.min(u+1-n>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),n+=2*c-2}else if(a===s&&i===a&&o===a){for(u=n+5;u+2<r&&e[u+2]===a;)u+=2;var c=Math.min(u+1-n>>>1,6);t.push(16,c-3),n+=2*c-2}else t.push(a,0)}return r>>>1}function gW(e,t){var r=0;return t[16|r]<=e&&(r|=16),t[8|r]<=e&&(r|=8),t[4|r]<=e&&(r|=4),t[2|r]<=e&&(r|=2),t[1|r]<=e&&(r|=1),r}function hS(e,t,r,n){return ww(r,n,t[e<<1]),n+t[1+(e<<1)]}function kh(e,t,r){var n=t>>>3;e[n]|=r<<=7&t,e[n+1]|=r>>>8}function ww(e,t,r){var n=t>>>3;e[n]|=r<<=7&t,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function vS(e,t,r){return void 0===r&&(r=!1),ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h;return ce(this,function(v){switch(v.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;101010256!==Nh(a,i);)i--;o=i,o+=4,s=Kp(a,o+=4),o+=2,o+=2,u=Nh(a,o+=4),o+=4,o=u,c=0,v.label=1;case 1:return c<s?(o+=4,o+=4,o+=4,o+=4,l=Nh(a,o+=4),d=Nh(a,o+=4),f=Kp(a,o+=4),p=Kp(a,o+2),m=Kp(a,o+4),o+=6,h=Nh(a,o+=8),o+=4,o+=f+p+m,[4,Zwe(e,a,h,n,l,d,r)]):[3,4];case 2:v.sent(),v.label=3;case 3:return c++,[3,1];case 4:return[2,n]}})})}function Zwe(e,t,r,n,a,i,o){return ue(this,void 0,void 0,function(){var s,u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:return r+=4,r+=2,s=Kp(t,r+=2),r+=2,r+=4,r+=4,u=Kp(t,r+=8),c=Kp(t,r+=2),l=function Fwe(e,t,r){for(var a,n="",i=0;i<r;i++)n+="%"+Owe(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return function Rwe(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}(e,t,r)}return a}(t,r+=2,u),r+=u,r+=c,o?(n[l]={size:i,csize:a},[2]):(d=new Uint8Array(t.buffer,r),0!==s?[3,1]:(n[l]=new Uint8Array(d.buffer.slice(r,r+a)),[3,4]));case 1:return 8!==s?[3,3]:(f=new Uint8Array(i),[4,kO(e,d,f)]);case 2:return p.sent(),n[l]=f,[3,4];case 3:throw new Error("unknown compression method: ".concat(s));case 4:return[2]}})})}function kO(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(n){return[2,Vwe(e,t,r)]})})}function Qwe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:if(a=10,4&(n=t[3])&&(i=Kp(t,a),a+=i),8&n){for(o=a;0!==t[o];)++o;a=o+1}if(16&n){for(o=a;0!==t[o];)++o;a=o+1}return 1&n&&(a+=2),s=function Mwe(e){return e>>0}(Nh(t,t.length-8)),u=Nh(t,t.length-4),void 0===r&&(r=new Uint8Array(u)),c=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,kO(e,c,r)];case 1:return l=f.sent(),d=dW(l,0,l.length),s!==d&&console.error("ungzip: checksums don't match"),[2,l]}})})}function $we(e,t,r){return ue(this,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return void 0===r&&(r={level:6}),n=new Uint8Array(50+Math.floor(1.1*t.length)),[4,Wwe(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function Jwe(e,t){return void 0===t&&(t=!1),Ve.create("Zip",function(r){return function eAe(e,t,r){return void 0===r&&(r=!1),ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D;return ce(this,function(w){switch(w.label){case 0:for(s in n=0,a={},o=[],i=t)o.push(s);u=0,w.label=1;case 1:return u<o.length?(s=o[u])in i?(c=!function tAe(e){var t=e.split(".").pop().toLowerCase();return-1!=="png,jpg,jpeg,zip".indexOf(t)}(C=s)&&!r,d=dW(l=t[C],0,l.length),f=a,p=C,D={cpr:c,usize:l.length,crc:d},c?[4,$we(e,l)]:[3,3]):[3,5]:[3,6];case 2:return m=w.sent(),[3,4];case 3:m=l,w.label=4;case 4:f[p]=(D.file=m,D),w.label=5;case 5:return u++,[3,1];case 6:for(C in a)n+=a[C].file.length+30+46+2*lW(C);for(C in n+=22,h=new Uint8Array(n),v=0,g=[],a)_=a[C],g.push(v),v=yW(h,v,C,_,0);for(C in y=0,S=v,a)_=a[C],g.push(v),v=yW(h,v,C,_,1,g[y++]);return x=v-S,gf(h,v,101010256),v+=4,Bh(h,v+=4,y),Bh(h,v+=2,y),gf(h,v+=2,x),gf(h,v+=4,S),v+=4,v+=2,[2,h.buffer]}})})}(r,e,t)})}function yW(e,t,r,n,a,i){void 0===i&&(i=0);var o=n.file;gf(e,t,0===a?67324752:33639248),t+=4,1===a&&(t+=2),Bh(e,t,20),Bh(e,t+=2,0),Bh(e,t+=2,n.cpr?8:0),gf(e,t+=2,0),gf(e,t+=4,n.crc),gf(e,t+=4,o.length),gf(e,t+=4,n.usize),Bh(e,t+=4,lW(r)),Bh(e,t+=2,0),t+=2,1===a&&(t+=2,t+=2,gf(e,t+=6,i),t+=4);var s=function Bwe(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if(4294967168&o)if(4294965248&o)if(4294901760&o){if(4292870144&o)throw new Error("e");e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4}else e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else e[t+a]=o,a++}return a}(e,t,r);return t+=s,0===a&&(e.set(o,t),t+=o.length),t}var Sc=function(e){return e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip",e}(Sc||{});function yf(e,t){return function UO(e,t){var r=this;if(P0)return function iAe(e,t){var r=this;return Ve.create("Read File",function(n){return ue(r,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return a="zip"===t?Sc.None:CW(e.name),[4,n.update({message:"Opening file...",canAbort:!1})];case 1:return o.sent(),"binary"===t||"zip"===t||a!==Sc.None?[4,e.arrayBuffer()]:[3,3];case 2:return i=o.sent(),[3,5];case 3:return[4,e.text()];case 4:i=o.sent(),o.label=5;case 5:return[4,n.update({message:"Processing file...",canAbort:!1})];case 6:return o.sent(),[4,xW(n,i,t,a)];case 7:return[2,o.sent()]}})})})}(e,t);var n=void 0;return Ve.create("Read File",function(a){return ue(r,void 0,void 0,function(){var i,o;return ce(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i="zip"===t?Sc.None:CW(e.name),"binary"===t||"zip"===t||i!==Sc.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,SW(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,xW(a,o.result,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}(e,t)}function LO(e){return"string"==typeof e?_W(e,e,"string"):_W(e.title,e.url,e.type||"string",e.body,e.headers)}function bW(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function SW(e,t,r){return new Promise(function(n,a){if(function rAe(e){if(!P0&&e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof dS)return e.readyState===dS.DONE;throw new Error("unknown data type")}(r)){var i=r.error;null!=i?a(i??bW(r instanceof dS)):n(r)}else{var o=!1;r.onerror=function(s){o||a(s.target.error??bW(r instanceof dS))},r.onprogress=function(s){if(e.shouldUpdate&&!o)try{e.update(s.lengthComputable?{message:t,isIndeterminate:!1,current:s.loaded,max:s.total}:{message:"".concat(t," ").concat((s.loaded/1024/1024).toFixed(2)," MB"),isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}}})}function CW(e){return/\.gz$/i.test(e)?Sc.Gzip:/\.zip$/i.test(e)?Sc.Zip:Sc.None}var nAe=/^(__MACOSX|.DS_Store)/;function aAe(e,t,r){return ue(this,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:switch(r){case Sc.None:return[3,1];case Sc.Gzip:return[3,2];case Sc.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,Qwe(e,t)];case 3:return[4,vS(e,t.buffer)];case 4:if(a=o.sent(),1!==(i=Object.keys(a).filter(function(s){return!nAe.test(s)})).length)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function xW(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i;return ce(this,function(s){switch(s.label){case 0:if(null===(a=t instanceof ArrayBuffer?new Uint8Array(t):t))throw new Error("no data given");if(n===Sc.None)return[3,4];if(!(a instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,aAe(e,a,n)];case 1:return i=s.sent(),"string"!==r?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return s.sent(),a=TO(i,0,i.length),[3,4];case 3:a=i,s.label=4;case 4:return"binary"===r&&a instanceof Uint8Array?[2,a]:[3,5];case 5:return"zip"===r&&a instanceof Uint8Array?[4,vS(e,a.buffer)]:[3,7];case 6:return[2,s.sent()];case 7:if("string"===r&&"string"==typeof a)return[2,a];if("xml"===r&&"string"==typeof a)return[2,(new DOMParser).parseFromString(a,"application/xml")];if("json"===r&&"string"==typeof a)return[2,JSON.parse(a)];s.label=8;case 8:throw new Error("could not get requested response data '".concat(r,"'"))}})})}var VO=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new dS},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function _W(e,t,r,n,a){var i=this;if(P0&&t.startsWith("file://"))return function cAe(e,t,r,n,a){if(!P0)throw new Error("This function should only be used when running in Node.js");if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");var i=t.substring(7),o=function uAe(){if(!GO)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return GO}().readFileSync(i);return yf(new PO([o],"raw-data"),r)}(0,t,r);var o=void 0;return Ve.create(e||"Download",function(s){return ue(i,void 0,void 0,function(){var u,c,l,p,m;return ce(this,function(h){switch(h.label){case 0:if((o=VO.get()).open(n?"post":"get",t,!0),a)for(u=0,c=a;u<c.length;u++)o.setRequestHeader((l=c[u])[0],l[1]);return o.responseType=function sAe(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":case"zip":return"arraybuffer"}}(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return h.sent(),[4,SW(s,"Downloading...",o)];case 2:return p=h.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return h.sent(),m=function oAe(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(VO.deposit(e),("binary"===t||"zip"===t)&&r instanceof ArrayBuffer)return new Uint8Array(r);if("string"===t&&"string"==typeof r)return r;if("xml"===t&&r instanceof XMLDocument)return r;if("json"===t&&"object"==typeof r)return r;throw new Error("could not get requested response data '".concat(t,"'"))}throw VO.deposit(e),new Error("Download failed with status code ".concat(e.status))}(p,r),[2,m]}})})},function(){o&&(o.abort(),o=void 0)})}var dn,GO=void 0;function lAe(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,m,h;return ce(this,function(v){switch(v.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(v.sent(),o=[],s=[],u=0,c=Math.min(a,n);u<c;u++)o.push(AW(u,(m=r[u]).id,t.resolve(dn.getUrlAsset(t,m.url),m.isBinary?"binary":"string").runAsChild(e))),s.push(u);l=0,v.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=v.sent(),f=r[d.index],p=s.indexOf(d.index),l++,"error"===d.kind&&!f.canFail)throw new Error("".concat(f.url,": ").concat(d.error));return e.shouldUpdate?[4,e.update({message:"Downloading...",current:l,max:a})]:[3,5];case 4:v.sent(),v.label=5;case 5:return i[d.index]=d,o=o.filter(wW,p),s=s.filter(wW,p),u<a&&(h=t.resolve(dn.getUrlAsset(t,(m=r[u]).url),m.isBinary?"binary":"string").runAsChild(e),o.push(AW(u,m.id,h)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function wW(e,t){return this!==t}function AW(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return[2,{kind:"ok",result:i.sent(),index:e,id:t}];case 2:return[2,{kind:"error",error:i.sent(),index:e,id:t}];case 3:return[2]}})})}!function(e){function t(u,c){return R({kind:"url",id:kn.create22(),url:u},c)}e.Url=t,e.File=function r(u){return{kind:"file",id:kn.create22(),name:u.name,file:u}},e.isUrl=function n(u){return"url"===u?.kind},e.isFile=function a(u){return"file"===u?.kind},e.Wrapper=function i(u,c,l){return{data:u,dispose:function(){l.release(c)}}},e.getUrl=function o(u){return"string"==typeof u?u:u.url},e.getUrlAsset=function s(u,c,l){return"string"==typeof c?u.tryFindUrl(c,l)||t(c,{body:l}):c}}(dn||(dn={}));var T,Bs,rt,on,dAe=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return Cw(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(dn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.get=function(t){return this._assets.get(t.id)},e.prototype.delete=function(t){return this._assets.delete(t.id)},e.prototype.has=function(t){return this._assets.has(t.id)},e.prototype.resolve=function(t,r,n){var a=this;return void 0===n&&(n=!0),dn.isUrl(t)?Ve.create("Download ".concat(t.title||t.url),function(i){return ue(a,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return this._assets.has(t.id)?((o=this._assets.get(t.id)).refCount++,u=(s=dn).Wrapper,[4,yf(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[h.sent(),t,this])];case 2:return n?[3,4]:(l=(c=dn).Wrapper,[4,LO(R(R({},t),{type:r})).runInContext(i)]);case 3:return[2,l.apply(c,[h.sent(),t,this])];case 4:return[4,LO(R(R({},t),{type:"binary"})).runInContext(i)];case 5:return d=h.sent(),f=new PO([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),m=(p=dn).Wrapper,[4,yf(f,r).runInContext(i)];case 6:return[2,m.apply(p,[h.sent(),t,this])]}})})}):Ve.create("Read ".concat(t.name),function(i){return ue(a,void 0,void 0,function(){var o,s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?((o=this._assets.get(t.id)).refCount++,u=(s=dn).Wrapper,[4,yf(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof PO))throw new Error("Cannot resolve file asset '".concat(t.name,"' (").concat(t.id,")"));return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),l=(c=dn).Wrapper,[4,yf(t.file,r).runInContext(i)];case 3:return[2,l.apply(c,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e.prototype.clear=function(){this._assets.clear()},e.prototype.dispose=function(){this.clear()},e}();function id(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function Aw(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Fu(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function TW(e,t,r){void 0===t&&(t=1),void 0===r&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function Tw(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=0),TW(e,t,r)/(e.length/t)}function Dw(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function Bu(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function gS(e,t){for(var r=0,n=!1,a=e.length;r<a;r++)if(e[r]===t){n=!0;break}return!!n&&(yS(e,r),!0)}function yS(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function Ya(e,t){return!(e.indexOf(t)>=0||(e.push(t),0))}function Lh(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function Ew(e,t){for(var r=0,n=0,a=e.length;n<a;++n)t.includes(e[n])&&(r+=1);return r}function DW(e,t){if(!e||0===e.length)return!t||0===t.length;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Iw(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t)return void(e[n][1]=r);e.push([t,r])}!function(e){function t(re,te){return te&&(te.label&&(re.label=te.label),te.description&&(re.description=te.description),te.legend&&(re.legend=te.legend),te.fieldLabels&&(re.fieldLabels=te.fieldLabels),te.isHidden&&(re.isHidden=te.isHidden),te.shortLabel&&(re.shortLabel=te.shortLabel),te.twoColumns&&(re.twoColumns=te.twoColumns),te.isEssential&&(re.isEssential=te.isEssential),te.category&&(re.category=te.category),te.hideIf&&(re.hideIf=te.hideIf),te.help&&(re.help=te.help)),re}function a(re,te,le){return t({type:"select",defaultValue:de(re,te),options:te,cycle:le?.cycle},le)}function h(re,te){return te&&(typeof te.min<"u"&&(re.min=te.min),typeof te.max<"u"&&(re.max=te.max),typeof te.step<"u"&&(re.step=te.step)),re}function S(re,te){var le=t({type:"group",defaultValue:te?.customDefault||U(re),params:re},te);return te?.presets&&(le.presets=te.presets),te?.isExpanded&&(le.isExpanded=te.isExpanded),te?.isFlat&&(le.isFlat=te.isFlat),te?.pivot&&(le.pivot=te.pivot),le}function w(){return U(this.element)}function A(){throw new Error("getValue not set. Fix runtime.")}function U(re){for(var te={},le=0,ge=Object.keys(re);le<ge.length;le++){var xe=ge[le];re[xe].isOptional||(te[xe]=re[xe].defaultValue)}return te}function H(re,te,le){return function(){return re(te,le)}}function z(re,te,le){if(te)if("value-ref"===re.type)(ge=te).getValue=ge.ref?H(re.resolveRef,ge.ref,le):function(){throw new Error("Unset ref in ValueRef value.")};else if("data-ref"===re.type)(ge=te).getValue=ge.ref?H(le,ge.ref,le):function(){throw new Error("Unset ref in ValueRef value.")};else if("group"===re.type)X(re.params,te,le);else if("mapped"===re.type){var ge;z(re.map((ge=te).name),ge.params,le)}else if("object-list"===re.type){if(!J(re.element))return;for(var Ge=0,je=te;Ge<je.length;Ge++)X(re.element,je[Ge],le)}}function G(re){if("value-ref"===re.type||"data-ref"===re.type)return!0;if("group"===re.type){if(J(re.params))return!0}else if("mapped"===re.type){for(var te=0,le=re.select.options;te<le.length;te++)if(G(re.map(le[te][0])))return!0}else if("object-list"===re.type)return J(re.element);return!1}function J(re){for(var te=0,le=Object.keys(re);te<le.length;te++)if(G(re[le[te]]))return!0;return!1}function X(re,te,le){for(var ge=0,xe=Object.keys(re);ge<xe.length;ge++){var Ge=xe[ge];z(re[Ge],te?.[Ge],le)}}function k(re,te,le){if(te===le)return!0;if("object"!=typeof te||"object"!=typeof le)return!1;for(var ge=0,xe=Object.keys(re);ge<xe.length;ge++){var Ge=xe[ge];if(!W(re[Ge],te[Ge],le[Ge]))return!1}return!0}function W(re,te,le){if(te===le)return!0;if("group"===re.type)return k(re.params,te,le);if("mapped"===re.type)return(ge=te).name===(xe=le).name&&W(re.map(ge.name),ge.params,xe.params);if("multi-select"===re.type){if((ge=te).length!==(xe=le).length)return!1;if(ge.length<10){for(var je=0,L=ge.length;je<L;je++)if(ge[je]!==xe[je]&&xe.indexOf(ge[je])<0)return!1}else{var Q=new Set(xe);for(je=0,L=ge.length;je<L;je++)if(ge[je]!==xe[je]&&!Q.has(ge[je]))return!1}return!0}if("interval"===re.type)return te[0]===le[0]&&te[1]===le[1];if("line-graph"===re.type){if((ge=te).length!==(xe=le).length)return!1;for(je=0,L=ge.length;je<L;je++)if(!Be.areEqual(ge[je],xe[je]))return!1;return!0}if("vec3"===re.type)return b.equals(te,le);if("mat4"===re.type)return he.areEqual(te,le,mn);if("script"===re.type)return(ge=te).language===(xe=le).language&&ge.expression===xe.expression;if("object-list"===re.type){var ge,xe,ye=(ge=te).length;if(ye!==(xe=le).length)return!1;for(je=0;je<ye;je++)if(!k(re.element,ge[je],xe[je]))return!1;return!0}return"object"==typeof te&&"object"==typeof le&&K_(te,le)}function $(re,te,le){if(void 0===te)return R({},le);if(void 0===le)return R({},te);for(var ge=Object.create(null),xe=0,Ge=Object.keys(re);xe<Ge.length;xe++){var je=Ge[xe];ge[je]=K(re[je],te[je],le[je])}return ge}function K(re,te,le){if(void 0===te)return"object"!=typeof le||Array.isArray(le)?le:R({},le);if(void 0===le)return"object"!=typeof te||Array.isArray(te)?te:R({},te);if("group"===re.type)return $(re.params,te,le);if("mapped"===re.type){var ge=te,xe=le;if(ge.name!==xe.name)return R({},xe);var Ge=re.map(xe.name);return{name:xe.name,params:K(Ge,ge.params,xe.params)}}return"value"===re.type?le:"object"==typeof te&&"object"==typeof le?Array.isArray(le)?le:R(R({},te),le):le}function q(re,te){for(var le=0,ge=re.options;le<ge.length;le++)if(ge[le][0]===te)return!0;return!1}function V(re,te,le){if(null==te)return le?re.defaultValue:void 0;if("value"===re.type)return te;if("group"===re.type){for(var ge=Object.create(null),xe=0,Ge=Object.keys(re.params);xe<Ge.length;xe++){var je=Ge[xe],L=re.params[je];void 0===te[je]?le&&(ge[je]=L.defaultValue):ge[je]=V(L,te[je],le)}return ge}if("mapped"===re.type){var Q=te;return"string"!=typeof Q.name?re.defaultValue:typeof Q.params>"u"?le?re.defaultValue:void 0:q(re.select,Q.name)?(L=re.map(Q.name),{name:Q.name,params:V(L,Q.params,le)}):re.defaultValue}return"select"===re.type?q(re,te)?te:re.defaultValue:"multi-select"===re.type?Array.isArray(te)?(ge=te.filter(function(we){return q(this,we)},re),te.length>0&&0===ge.length?re.defaultValue:ge):re.defaultValue:"object-list"===re.type?Array.isArray(te)?te.map(function(ye){return ee(re.element,ye,le?"all":"skip")}):re.defaultValue:te}function ee(re,te,le){if("object"!=typeof te||null===te)return le?U(re):te;for(var ge=Object.create(null),xe=0,Ge=Object.keys(re);xe<Ge.length;xe++){var je=Ge[xe],L=re[je];void 0===te[je]?"all"===le&&(ge[je]=L.defaultValue):ge[je]=V(L,te[je],"skip"!==le)}return ge}function de(re,te){for(var le=0,ge=te;le<ge.length;le++)if(ge[le][0]===re)return re;return te.length>0?te[0][0]:void 0}e.Essential={isEssential:!0},e.Optional=function r(re){var te=R({},re);return te.isOptional=!0,te},e.Value=function n(re,te){return t({type:"value",defaultValue:re},te)},e.Select=a,e.MultiSelect=function i(re,te,le){var ge=t({type:"multi-select",defaultValue:re,options:te},le);return le?.emptyValue&&(ge.emptyValue=le.emptyValue),ge},e.Boolean=function o(re,te){return t({type:"boolean",defaultValue:re},te)},e.Text=function s(re,te){return void 0===re&&(re=""),t({type:"text",defaultValue:re},te)},e.Color=function u(re,te){var le=t({type:"color",defaultValue:re},te);return te?.isExpanded&&(le.isExpanded=te.isExpanded),le},e.ColorList=function c(re,te){var le;if("string"==typeof re){var ge=pf(re);le={kind:"qualitative"!==ge.type?"interpolate":"set",colors:ge.list}}else le=re;return t({type:"color-list",presetKind:te?.presetKind||"all",defaultValue:le,offsets:!!te?.offsets},te)},e.Vec3=function l(re,te,le){return t(h({type:"vec3",defaultValue:re},te),le)},e.Mat4=function d(re,te){return t({type:"mat4",defaultValue:re},te)},e.Url=function f(re,te){return t({type:"url",defaultValue:"string"==typeof re?dn.Url(re):dn.Url(re.url,{body:re.body})},te)},e.File=function p(re){var te=t({type:"file",defaultValue:null},re);return re?.accept&&(te.accept=re.accept),te},e.FileList=function m(re){var te=t({type:"file-list",defaultValue:null},re);return re?.accept&&(te.accept=re.accept),te},e.Numeric=function v(re,te,le){var ge=t(h({type:"number",defaultValue:re},te),le);return le?.immediateUpdate&&(ge.immediateUpdate=!0),ge},e.Interval=function g(re,te,le){return t(h({type:"interval",defaultValue:re},te),le)},e.LineGraph=function y(re,te){var le=t({type:"line-graph",defaultValue:re},te);return te?.getVolume&&(le.getVolume=te.getVolume),le},e.Group=S,e.EmptyGroup=function C(re){return S({},re)},e.Mapped=function _(re,te,le,ge){var xe=de(re,te);return t({type:"mapped",defaultValue:{name:xe,params:le(xe).defaultValue},select:a(xe,te,ge),map:le},ge)},e.MappedStatic=function x(re,te,le){var ge=le?.options?le.options:Object.keys(te).map(function(Ge){return[Ge,te[Ge].label||yc(Ge)]}),xe=de(re,ge);return t({type:"mapped",defaultValue:{name:xe,params:te[xe].defaultValue},select:a(xe,ge,le),map:function(Ge){return te[Ge]}},le)},e.ObjectList=function D(re,te,le){return t({type:"object-list",element:re,getLabel:te,ctor:w,defaultValue:le?.defaultValue||[]},le)},e.ValueRef=function E(re,te,le){var ge;return t({type:"value-ref",defaultValue:{ref:null!==(ge=le?.defaultRef)&&void 0!==ge?ge:"",getValue:A},getOptions:re,resolveRef:te},le)},e.DataRef=function I(re){var te;return t({type:"data-ref",defaultValue:{ref:null!==(te=re?.defaultRef)&&void 0!==te?te:"",getValue:A}},re)},e.Converted=function M(re,te,le){return t({type:"converted",defaultValue:te(le.defaultValue),converted:le,fromValue:re,toValue:te},le)},e.Conditioned=function F(re,te,le,ge,xe){var Ge=Object.keys(te).map(function(je){return[je,je]});return t({type:"conditioned",select:a(le(re),Ge,xe),defaultValue:re,conditionParams:te,conditionForValue:le,conditionedValue:ge},xe)},e.Script=function N(re,te){return t({type:"script",defaultValue:re},te)},e.For=function j(re){return 0},e.getDefaultValues=U,e.resolveRefs=X,e.setDefaultValues=function Z(re,te){for(var le=0,ge=Object.keys(re);le<ge.length;le++){var xe=ge[le];re[xe].isOptional||(re[xe].defaultValue=te[xe])}},e.clone=function ne(re){return fl(re)},e.validate=function Y(re,te){},e.areEqual=k,e.isParamEqual=W,e.merge=$,e.mergeParam=K,e.normalizeParams=ee,e.objectToOptions=function ae(re,te){for(var le=[],ge=0,xe=Object.keys(re);ge<xe.length;ge++){var Ge=xe[ge];if(te){var je=te(Ge,re[Ge]);le.push("string"==typeof je?[Ge,je]:[Ge,je[0],je[1]])}else le.push("string"==typeof re[Ge]?[Ge,re[Ge]]:[Ge,null===te?Ge:yc(Ge)])}return le},e.arrayToOptions=function pe(re,te){for(var le=[],ge=0,xe=re;ge<xe.length;ge++){var Ge=xe[ge];le.push(te?[Ge,te(Ge)]:[Ge,null===te?Ge:yc(Ge)])}return le},e.optionLabel=function me(re,te){for(var le=0,ge=re.options;le<ge.length;le++){var xe=ge[le];if(xe[0]===te)return xe[1]}return""}}(T||(T={})),function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:kn.create22(),definition:a,createDefaultParams:function(o,s){return a.params?T.getDefaultValues(a.params(o,s)):{}}};return i}var n;e.create=t,e.fromTransformer=function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,c=o.params,l=u.build().to(s.transform.ref).apply(a,c);return u.updateTree(l)}})},(n=e.Builder||(e.Builder={})).build=function(o){return function i(o){return function(s){return t(R({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:"string"==typeof o.display?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:"object"==typeof o.params?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},"function"==typeof s?{run:s}:s))}}(o)},e.build=n.build}(Bs||(Bs={})),function(e){var n,h;e.getParamDefinition=function t(h,v,g){return h.definition.params?h.definition.params(v,g):{}},e.is=function r(h){return!!h&&"function"==typeof h.toAction&&"function"==typeof h.apply},(h=n=e.UpdateResult||(e.UpdateResult={}))[h.Unchanged=0]="Unchanged",h[h.Updated=1]="Updated",h[h.Recreate=2]="Recreate",h[h.Null=3]="Null";var p,a=new Map,i=new Map;function l(h,v){var g=v.name,y="".concat(h,".").concat(g);if(a.has(y))throw new Error("A transform with id '".concat(g,"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed."));var S={apply:function(C,_,x){return on.create(C,S,_,x)},toAction:function(){return Bs.fromTransformer(S)},namespace:h,id:y,definition:v,createDefaultParams:function(C,_){return v.params?T.getDefaultValues(v.params(C,_)):{}}};return a.set(y,S),function o(h){for(var v=0,g=h.definition.from;v<g.length;v++){var y=g[v];i.has(y.type)?i.get(y.type).push(h):i.set(y.type,[h])}}(S),S}e.getAll=function s(){return Array.from(a.values())},e.get=function u(h){var v=a.get(h);if(!v)throw new Error("A transformer with signature '".concat(h,"' is not registered."));return v},e.fromType=function c(h){return i.get(h)||[]},e.create=l,e.factory=function d(h){return function(v){return l(h,v)}},e.builderFactory=function f(h){return p.build(h)},function(h){h.build=function g(y){return function(S){return function v(y,S){return function(C){return l(y,R({name:S.name,from:S.from instanceof Array?S.from:[S.from],to:S.to instanceof Array?S.to:[S.to],display:"string"==typeof S.display?{name:S.display}:S.display?S.display:{name:Mh(S.name.replace(/[-]/g," "))},params:"object"==typeof S.params?function(){return S.params}:S.params?S.params:void 0,isDecorator:S.isDecorator},C))}}(y,S)}}}(p=e.Builder||(e.Builder={})),e.build=function m(h){return p.build(h)},e.ROOT=l("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})}(rt||(rt={})),function(e){function i(v,g,y,S){var C=S&&S.ref?S.ref:kn.create22(),_=void 0;return S&&S.tags&&(0===(_="string"==typeof S.tags?[S.tags]:S.tags).length?_=void 0:_.sort()),{parent:v,transformer:g,state:S?.state||{},tags:_,ref:C,dependsOn:S&&S.dependsOn,params:y,version:kn.create22()}}function d(v,g){return!!v.tags&&v.tags.indexOf(g)>=0}function p(v){return v}e.RootRef="-=root=-",e.areStatesEqual=function t(v,g){return!!v.isHidden!=!!g.isHidden||!!v.isCollapsed!=!!g.isCollapsed||!!v.isGhost!=!!g.isGhost||!!v.isLocked!=!!g.isLocked},e.isStateChange=function r(v,g){return!!g&&(typeof g.isCollapsed<"u"&&v.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&v.isHidden!==g.isHidden||typeof g.isGhost<"u"&&v.isGhost!==g.isGhost||typeof g.isLocked<"u"&&v.isLocked!==g.isLocked)},e.assignState=function n(v,g){if(!g)return!1;for(var y=!1,S=0,C=Object.keys(g);S<C.length;S++){var _=C[S],x=g[_];!!x!=!!v[_]&&(y=!0,v[_]=x)}return y},e.syncState=function a(v,g){if(!g)return!1;for(var y=!1,S=0,C=Object.keys(g);S<C.length;S++)!!(x=g[_=C[S]])!=!!v[_]&&(y=!0,void 0!==x?v[_]=x:delete v[_]);for(var w=0,A=Object.keys(v);w<A.length;w++){var _,x;!!(x=g[_=A[w]])!=!!v[_]&&(y=!0,void 0!==x?v[_]=x:delete v[_])}return y},e.create=i,e.withParams=function o(v,g){return R(R({},v),{params:g,version:kn.create22()})},e.withState=function s(v,g){return g?R(R({},v),{state:R(R({},v.state),g)}):v},e.withTags=function u(v,g){var y=void 0;return g&&(0===(y="string"==typeof g?[g]:g).length?y=void 0:y.sort()),R(R({},v),{tags:y,version:kn.create22()})},e.withParent=function c(v,g){return R(R({},v),{parent:g,version:kn.create22()})},e.createRoot=function l(v){return i(e.RootRef,rt.ROOT,{},{ref:e.RootRef,state:v})},e.hasTag=d,e.hasTags=function f(v,g){if(!v.tags)return"string"!=typeof g&&0===g.length;if("string"==typeof g)return d(v,g);for(var y=0,S=g;y<S.length;y++)if(v.tags.indexOf(S[y])<0)return!1;return!0},e.toJSON=function m(v){for(var g=v.transformer.definition.customSerialization?v.transformer.definition.customSerialization.toJSON:p,y=void 0,S=0,C=Object.keys(v.state);S<C.length;S++){var _=C[S];v.state[_]&&(y||(y={}),y[_]=!0)}return{parent:v.parent,transformer:v.transformer.id,params:v.params?g(v.params):void 0,state:y,tags:v.tags,ref:v.ref,dependsOn:v.dependsOn,version:v.version}},e.fromJSON=function h(v){var g=rt.get(v.transformer);return{parent:v.parent,transformer:g,params:v.params?(g.definition.customSerialization?g.definition.customSerialization.fromJSON:p)(v.params):void 0,state:v.state||{},tags:v.tags,ref:v.ref,dependsOn:v.dependsOn,version:v.version}}}(on||(on={}));var ii,xr,bf,hAe=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations||(this._childMutations=new Map),this._childMutations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations||(this._dependencyMutations=new Map),this._dependencyMutations},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(on.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=on.RootRef;if(0!==this.children.get(t).size){this.changeChildren();var r=gc();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&"remove"===n)return;this.changeDependencies(),a=i?i.asMutable():gc().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}"add"===n?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){Pw(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,on.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;this.transforms.has(t.ref)&&this.transforms.get(t.ref).parent!==t.parent&&function yAe(e){throw new Error("Transform '".concat(e,"' is already present in the tree."))}(t.ref);var a=this.children.get(t.parent);if(a||function bAe(e){throw new Error("Parent '".concat(e,"' must be present in the tree."))}(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,gc())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++)this.mutateDependency(o[i],r,"add");return this},e.prototype.setParams=function(t,r){Pw(this.transforms,t);var n=this.transforms.get(t);return!gO(n.params,r)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,on.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){Pw(this.transforms,t);var n=this.transforms.get(t),a=on.withParams(n,r);return!DW(n.tags,a.tags)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){Pw(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return on.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=on.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=ii.subtreePostOrder(this,r);if(t===on.RootRef){if(n.pop(),0===n.length)return n;this.clearRoot()}else{if(0===n.length)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++)this.transforms.delete((o=i[a]).ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref);for(var s=[],u=0,c=n;u<c.length;u++){var o;if((o=c[u]).dependsOn)for(var l=0,d=o.dependsOn;l<d.length;l++){var f=d[l];this.transforms.has(f)&&this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var p=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var m=0,h=p;m<h.length;m++)if(this.transforms.has(v=h[m]))for(var g=0,y=this.remove(v);g<y.length;g++)s[s.length]=y[g]}}for(var C=0,_=s;C<_.length;C++){var v;n[n.length]=v=_[C]}return n},e.prototype.asImmutable=function(){return this.changedNodes||this.changedChildren||this._childMutations?(this._childMutations&&this._childMutations.forEach(vAe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(gAe,this.dependencies),ii.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies)):this.tree},e}();function vAe(e,t){this.set(t,e.asImmutable())}function gAe(e,t){0===e.size?this.delete(t):this.set(t,e.asImmutable())}function Pw(e,t){if(!e.has(t))throw new Error("Node '".concat(t,"' is not present in the tree."))}!function(e){var t=function(){function S(C,_,x){this.transforms=C,this.children=_,this.dependencies=x}return Object.defineProperty(S.prototype,"root",{get:function(){return this.transforms.get(on.RootRef)},enumerable:!1,configurable:!0}),S.prototype.asTransient=function(){return new hAe(this)},S}();function n(S,C,_){return new t(S,C,_)}function a(S){i(this,this.tree.transforms.get(S))}function i(S,C){var _=S.tree.children.get(C.ref);_&&_.size&&_.forEach(a,S),S.f(C,S.tree,S.state)}function o(S,C,_,x){var D={tree:S,state:_,f:x};return i(D,C),D.state}function s(S){u(this,this.tree.transforms.get(S))}function u(S,C){var _=S.f(C,S.tree,S.state);if("boolean"!=typeof _||_){var x=S.tree.children.get(C.ref);x&&x.size&&x.forEach(s,S)}}function c(S,C,_,x){var D={tree:S,state:_,f:x};return u(D,C),D.state}function l(S,C,_){_.push(S)}function f(S,C,_){_.push(on.toJSON(S))}function v(S,C,_){if(C===_)return!0;for(var D=S.children.get(C).values();;){var w=D.next();if(w.done)return!1;if(v(S,w.value,_))return!0}}e.createEmpty=function r(S){var C=S||on.createRoot();return n(Mu([[C.ref,C]]),Mu([[C.ref,gc()]]),Mu())},e.create=n,e.doPostOrder=o,e.doPreOrder=c,e.subtreePostOrder=function d(S,C){return o(S,C,[],l)},e.toJSON=function p(S){var C=[];return c(S,S.root,C,f),{transforms:C}},e.fromJSON=function m(S){for(var C=Mu().asMutable(),_=Mu().asMutable(),x=Mu().asMutable(),D=0,w=S.transforms;D<w.length;D++){var E=on.fromJSON(A=w[D]);C.set(E.ref,E),_.has(E.ref)||_.set(E.ref,gc().asMutable()),E.ref!==E.parent&&_.get(E.parent).add(E.ref)}for(var I=new Set,M=0,F=S.transforms;M<F.length;M++){var A,N=(A=F[M]).ref;if(_.set(N,_.get(N).asImmutable()),A.dependsOn)for(var j=0,U=A.dependsOn;j<U.length;j++){var H=U[j];I.add(H),x.has(H)?x.get(H).add(N):x.set(H,gc([N]).asMutable())}}return I.forEach(function(z){x.set(z,x.get(z).asImmutable())}),n(C.asImmutable(),_.asImmutable(),x.asImmutable())},e.dump=function h(S){console.log({tr:S.transforms.keySeq().toArray(),tr1:S.transforms.valueSeq().toArray().map(function(C){return C.ref}),ch:S.children.keySeq().toArray()})},e.subtreeHasRef=function g(S,C,_){return!(!S.transforms.has(C)||!S.transforms.has(_))&&v(S,C,_)},e.getDecoratorRoot=function y(S,C){var _=S.children.get(C);if(1!==_.size)return C;var x=S.transforms.get(_.first());return x.transformer.definition.isDecorator?y(S,x.ref):C}}(ii||(ii={})),function(e){function t(k,W){return r(k)(W)}function r(k){var $,W=k||c.root;return $=function a(k){return void 0!==k.compile}(W)?W.compile():function n(k){return void 0!==k.transform&&void 0!==k.status}(W)?c.byValue(W).compile():function i(k){return"function"==typeof k}(W)?W:c.byRef(W).compile(),$}e.select=t,e.compile=r;var c,o={select:function(k){return t(this,k||this.state)}};function s(k,W){o[k]=function(){for(var $=[],K=0;K<arguments.length;K++)$[K]=arguments[K];return W.call.apply(W,or([void 0,this],$,!1))}}function u(k){return Object.create(o,{compile:{writable:!1,configurable:!1,value:k}})}function l(k,W){var $=r(k);return u(function(){return function(K){for(var q=[],V=0,ee=$(K);V<ee.length;V++)for(var pe=0,me=W(ee[V],K);pe<me.length;pe++)q.push(me[pe]);return q}})}function d(k,W){var $=r(k);return u(function(){return function(K){for(var q=[],V=0,ee=$(K);V<ee.length;V++){var pe=W(ee[V],K);pe&&q.push(pe)}return q}})}function f(k){var W=r(k);return u(function(){return function($){for(var K=new Set,q=[],V=0,ee=W($);V<ee.length;V++){var ae=ee[V];ae&&(K.has(ae.transform.ref)||(K.add(ae.transform.ref),q.push(ae)))}return q}})}function p(k){var W=r(k);return u(function(){return function($){var K=W($);return K.length?[K[0]]:[]}})}function m(k,W){return l(k,function($){return W($)?[$]:[]})}function h(k,W){return m(k,function($){return $.status===W})}function v(k,W){return m(k,function($){return!!$.transform.tags&&$.transform.tags.indexOf(W)>=0})}function g(k){return l(k,function(W,$){var K=[];return ii.doPreOrder($.tree,$.tree.transforms.get(W.transform.ref),K,function(q,V,ee){ee.push(q.ref)}),K.map(function(q){return $.cells.get(q)})})}function y(k){return l(k,function(W,$){var K=[];return $.tree.children.get(W.transform.ref).forEach(function(q){return K.push($.cells.get(q))}),K})}function S(k,W){return m(k,function($){return!!$.obj&&$.obj.type===W.type})}function C(k,W){return f(d(k,function($,K){return M(K.tree,K.cells,$.transform.ref,W)}))}function _(k,W){return f(d(k,function($,K){return j(K.tree,K.cells,$.transform.ref,W)}))}function x(k,W){return f(d(k,function($,K){return N(K.tree,K.cells,$.transform.ref,W)}))}function D(k,W){return m(k,function($){return $.transform.transformer===W})}function w(k,W){return f(d(k,function($,K){return F(K.tree,K.cells,$.transform.ref,W)}))}function A(k,W){return f(d(k,function($,K){return U(K.tree,K.cells,$.transform.ref,W)}))}function E(k){return f(d(k,function(W,$){return $.cells.get($.tree.transforms.get(W.transform.ref).parent)}))}function I(k,W,$,K,q){for(var V=k.transforms.get($),ee=void 0;;){V=k.transforms.get(V.parent);var ae=W.get(V.ref);if(ae.obj&&K(ae)&&(ee=ae,q)||V.ref===on.RootRef)return ee}}function M(k,W,$,K){return I(k,W,$,K,!0)}function F(k,W,$,K){return I(k,W,$,K,!1)}function N(k,W,$,K){return M(k,W,$,Array.isArray(K)?function(q){return K.indexOf(q.transform.transformer)>=0}:function(q){return q.transform.transformer===K})}function j(k,W,$,K){return M(k,W,$,H(K))}function U(k,W,$,K){return F(k,W,$,H(K))}function H(k){return Array.isArray(k)?function(W){for(var $=0,K=k;$<K.length;$++)if(K[$].type===W.obj.type)return!0}:function(W){return W.obj.type===k.type}}function G(k,W,$){if(k.tags)for(var K=0,q=k.tags;K<q.length;K++){var V=q[K];if($.tags.has(V)){$.refs[V]=k.ref;break}}return!0}function X(k,W,$){return!(k.tags&&k.tags.indexOf($.tag)>=0&&($.ref=k.ref,1))}function ne(k,W,$){if(k.tags){for(var K=$.tags.size,q=0,V=0,ee=k.tags;V<ee.length;V++)if($.tags.has(ee[V])&&++q===K){$.refs.push(k);break}}else 0===$.tags.size&&$.refs.push(k)}(function(k){function ae(re,te,le){var ge=le.cells.get(re.ref);return!ge||!ge.obj||ge.obj.type!==le.type||(le.roots.push(ge),!1)}function pe(re,te,le){var ge=le.cells.get(re.ref);return ge&&ge.obj&&ge.obj.type===le.type&&le.ret.push(ge),!0}function me(re,te,le){var ge=le.cells.get(re.ref);return ge&&ge.obj&&ge.transform.transformer===le.t&&le.ret.push(ge),!0}function de(re,te,le){var ge=le.cells.get(re.ref);return ge&&"error"===ge.status&&ge.transform.transformer===le.t&&le.ret.push(ge),!0}k.root=u(function(){return function(re){return[re.cells.get(re.tree.root.ref)]}}),k.byRef=function W(){for(var re=[],te=0;te<arguments.length;te++)re[te]=arguments[te];return u(function(){return function(le){for(var ge=[],xe=0,Ge=re;xe<Ge.length;xe++){var L=le.cells.get(Ge[xe]);L&&ge.push(L)}return ge}})},k.byValue=function $(){for(var re=[],te=0;te<arguments.length;te++)re[te]=arguments[te];return u(function(){return function(le){return re}})},k.rootsOfType=function K(re,te){return void 0===te&&(te=on.RootRef),u(function(){return function(le){var ge={roots:[],cells:le.cells,type:re.type};return ii.doPreOrder(le.tree,le.tree.transforms.get(te),ge,ae),ge.roots}})},k.ofType=function q(re,te){return void 0===te&&(te=on.RootRef),u(function(){return function(le){var ge={ret:[],cells:le.cells,type:re.type};return ii.doPreOrder(le.tree,le.tree.transforms.get(te),ge,pe),ge.ret}})},k.ofTransformer=function V(re,te){return void 0===te&&(te=on.RootRef),u(function(){return function(le){var ge={ret:[],cells:le.cells,t:re};return ii.doPreOrder(le.tree,le.tree.transforms.get(te),ge,me),ge.ret}})},k.ofTransformerWithError=function ee(re,te){return void 0===te&&(te=on.RootRef),u(function(){return function(le){var ge={ret:[],cells:le.cells,t:re};return ii.doPreOrder(le.tree,le.tree.transforms.get(te),ge,de),ge.ret}})}})(c=e.Generators||(e.Generators={})),s("flatMap",l),e.flatMap=l,s("mapObject",d),e.mapObject=d,s("unique",f),e.unique=f,s("first",p),e.first=p,s("filter",m),e.filter=m,s("withStatus",h),e.withStatus=h,s("withTag",v),e.withTag=v,s("subtree",g),e.subtree=g,s("children",y),e.children=y,s("ofType",S),e.ofType=S,s("ancestor",C),e.ancestor=C,s("ancestorOfType",_),e.ancestorOfType=_,s("ancestorWithTransformer",x),e.ancestorWithTransformer=x,s("withTransformer",D),e.withTransformer=D,s("root",w),e.root=w,s("rootOfType",A),e.rootOfType=A,s("parent",E),e.parent=E,e.findAncestor=M,e.findRoot=F,e.findAncestorWithTransformer=N,e.findAncestorOfType=j,e.findRootOfType=U,e.findUniqueTagsInSubtree=function z(k,W,$){return ii.doPreOrder(k,k.transforms.get(W),{refs:{},tags:$},G).refs},e.findTagInSubtree=function J(k,W,$){return ii.doPreOrder(k,k.transforms.get(W),{ref:void 0,tag:$},X).ref},e.findWithAllTags=function Z(k,W,$){return ii.doPreOrder(k,k.transforms.get(W),{refs:[],tags:$},ne).refs},e.tryFindDecorator=function Y(k,W,$){if(k.transforms.get(W).transformer===$)return k.cells.get(W);var q=k.tree.children.get(W);if(1===q.size){var V=q.first();if(k.transforms.get(V).transformer.definition.isDecorator)return Y(k,V,$)}}}(xr||(xr={})),function(e){e.create=function t(){var r=new SAe,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}}(bf||(bf={}));var SAe=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new bn;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new Ai(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++)r[t].complete();this._disposed=!0}},e}();function vo(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Sf(e){return!!e&&!!e[Kr]}function od(e){var t;return!!e&&(function(r){if(!r||"object"!=typeof r)return!1;var n=Object.getPrototypeOf(r);if(null===n)return!0;var a=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return a===Object||"function"==typeof a&&Function.toString.call(a)===IAe}(e)||Array.isArray(e)||!!e[xS]||!(null===(t=e.constructor)||void 0===t||!t[xS])||Rw(e)||Ow(e))}function Cf(e,t,r){void 0===r&&(r=!1),0===$p(e)?(r?Object.keys:M0)(e).forEach(function(n){r&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function $p(e){var t=e[Kr];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Rw(e)?2:Ow(e)?3:0}function Jp(e,t){return 2===$p(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function EW(e,t,r){var n=$p(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function Rw(e){return DAe&&e instanceof Map}function Ow(e){return EAe&&e instanceof Set}function go(e){return e.o||e.t}function zO(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=NW(e);delete t[Kr];for(var r=M0(t),n=0;n<r.length;n++){var a=r[n],i=t[a];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function HO(e,t){return void 0===t&&(t=!1),jO(e)||Sf(e)||!od(e)||($p(e)>1&&(e.set=e.add=e.clear=e.delete=CAe),Object.freeze(e),t&&Cf(e,function(r,n){return HO(n,!0)},!0)),e}function CAe(){vo(2)}function jO(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function sd(e){var t=JO[e];return t||vo(18,e),t}function bS(){return CS}function WO(e,t){t&&(sd("Patches"),e.u=[],e.s=[],e.v=t)}function Fw(e){YO(e),e.p.forEach(xAe),e.p=null}function YO(e){e===CS&&(CS=e.l)}function PW(e){return CS={p:[],l:CS,h:e,m:!0,_:0}}function xAe(e){var t=e[Kr];0===t.i||1===t.i?t.j():t.g=!0}function XO(e,t){t._=t.p.length;var r=t.p[0],n=void 0!==e&&e!==r;return t.h.O||sd("ES5").S(t,e,n),n?(r[Kr].P&&(Fw(t),vo(4)),od(e)&&(e=Bw(t,e),t.l||Nw(t,e)),t.u&&sd("Patches").M(r[Kr].t,e,t.u,t.s)):e=Bw(t,r,[]),Fw(t),t.u&&t.v(t.u,t.s),e!==$O?e:void 0}function Bw(e,t,r){if(jO(t))return t;var n=t[Kr];if(!n)return Cf(t,function(s,u){return MW(e,n,t,s,u,r)},!0),t;if(n.A!==e)return t;if(!n.P)return Nw(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=4===n.i||5===n.i?n.o=zO(n.k):n.o,i=a,o=!1;3===n.i&&(i=new Set(a),a.clear(),o=!0),Cf(i,function(s,u){return MW(e,n,a,s,u,r,o)}),Nw(e,a,!1),r&&e.u&&sd("Patches").N(n,r,e.u,e.s)}return n.o}function MW(e,t,r,n,a,i,o){if(Sf(a)){var s=Bw(e,a,i&&t&&3!==t.i&&!Jp(t.R,n)?i.concat(n):void 0);if(EW(r,n,s),!Sf(s))return;e.m=!1}else o&&r.add(a);if(od(a)&&!jO(a)){if(!e.h.D&&e._<1)return;Bw(e,a),t&&t.A.l||Nw(e,a)}}function Nw(e,t,r){void 0===r&&(r=!1),!e.l&&e.h.D&&e.m&&HO(t,r)}function KO(e,t){var r=e[Kr];return(r?go(r):e)[t]}function RW(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function nu(e){e.P||(e.P=!0,e.l&&nu(e.l))}function ZO(e){e.o||(e.o=zO(e.t))}function SS(e,t,r){var n=Rw(t)?sd("MapSet").F(t,r):Ow(t)?sd("MapSet").T(t,r):e.O?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:bS(),P:!1,I:!1,R:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,c=_S;o&&(u=[s],c=wS);var l=Proxy.revocable(u,c),d=l.revoke,f=l.proxy;return s.k=f,s.j=d,f}(t,r):sd("ES5").J(t,r);return(r?r.A:bS()).p.push(n),n}function OW(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return zO(e)}var FW,CS,QO=typeof Symbol<"u"&&"symbol"==typeof Symbol("x"),DAe=typeof Map<"u",EAe=typeof Set<"u",BW=typeof Proxy<"u"&&void 0!==Proxy.revocable&&typeof Reflect<"u",$O=QO?Symbol.for("immer-nothing"):((FW={})["immer-nothing"]=!0,FW),xS=QO?Symbol.for("immer-draftable"):"__$immer_draftable",Kr=QO?Symbol.for("immer-state"):"__$immer_state",IAe=(typeof Symbol<"u"&&Symbol,""+Object.prototype.constructor),M0=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,NW=Object.getOwnPropertyDescriptors||function(e){var t={};return M0(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},JO={},_S={get:function(e,t){if(t===Kr)return e;var a,s,u,r=go(e);if(!Jp(r,t))return a=e,(u=RW(r,t))?"value"in u?u.value:null===(s=u.get)||void 0===s?void 0:s.call(a.k):void 0;var n=r[t];return e.I||!od(n)?n:n===KO(e.t,t)?(ZO(e),e.o[t]=SS(e.A.h,n,e)):n},has:function(e,t){return t in go(e)},ownKeys:function(e){return Reflect.ownKeys(go(e))},set:function(e,t,r){var n=RW(go(e),t);if(n?.set)return n.set.call(e.k,r),!0;if(!e.P){var a=KO(go(e),t),i=a?.[Kr];if(i&&i.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(function IW(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(r,a)&&(void 0!==r||Jp(e.t,t)))return!0;ZO(e),nu(e)}return e.o[t]===r&&(void 0!==r||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==KO(e.t,t)||t in e.t?(e.R[t]=!1,ZO(e),nu(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=go(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}},defineProperty:function(){vo(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){vo(12)}},wS={};Cf(_S,function(e,t){wS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),wS.deleteProperty=function(e,t){return wS.set.call(this,e,t,void 0)},wS.set=function(e,t,r){return _S.set.call(this,e[0],t,r,e[0])};var PAe=function(){function e(r){var n=this;this.O=BW,this.D=!0,this.produce=function(a,i,o){if("function"==typeof a&&"function"!=typeof i){var s=i;i=a;var u=n;return function(h){var v=this;void 0===h&&(h=s);for(var g=arguments.length,y=Array(g>1?g-1:0),S=1;S<g;S++)y[S-1]=arguments[S];return u.produce(h,function(C){var _;return(_=i).call.apply(_,[v,C].concat(y))})}}var c;if("function"!=typeof i&&vo(6),void 0!==o&&"function"!=typeof o&&vo(7),od(a)){var l=PW(n),d=SS(n,a,void 0),f=!0;try{c=i(d),f=!1}finally{f?Fw(l):YO(l)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(h){return WO(l,o),XO(h,l)},function(h){throw Fw(l),h}):(WO(l,o),XO(c,l))}if(!a||"object"!=typeof a){if(void 0===(c=i(a))&&(c=a),c===$O&&(c=void 0),n.D&&HO(c,!0),o){var p=[],m=[];sd("Patches").M(a,c,p,m),o(p,m)}return c}vo(21,a)},this.produceWithPatches=function(a,i){if("function"==typeof a)return function(c){for(var l=arguments.length,d=Array(l>1?l-1:0),f=1;f<l;f++)d[f-1]=arguments[f];return n.produceWithPatches(c,function(p){return a.apply(void 0,[p].concat(d))})};var o,s,u=n.produce(a,i,function(c,l){o=c,s=l});return typeof Promise<"u"&&u instanceof Promise?u.then(function(c){return[c,o,s]}):[u,o,s]},"boolean"==typeof r?.useProxies&&this.setUseProxies(r.useProxies),"boolean"==typeof r?.autoFreeze&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){od(r)||vo(8),Sf(r)&&(r=function _Ae(e){return Sf(e)||vo(22,e),function t(r){if(!od(r))return r;var n,a=r[Kr],i=$p(r);if(a){if(!a.P&&(a.i<4||!sd("ES5").K(a)))return a.t;a.I=!0,n=OW(r,i),a.I=!1}else n=OW(r,i);return Cf(n,function(o,s){a&&function Mw(e,t){return 2===$p(e)?e.get(t):e[t]}(a.t,o)===s||EW(n,o,t(s))}),3===i?new Set(n):n}(e)}(r));var n=PW(this),a=SS(this,r,void 0);return a[Kr].C=!0,YO(n),a},t.finishDraft=function(r,n){var i=(r&&r[Kr]).A;return WO(i,n),XO(void 0,i)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!BW&&vo(20),this.O=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(0===i.path.length&&"replace"===i.op){r=i.value;break}}a>-1&&(n=n.slice(a+1));var o=sd("Patches").$;return Sf(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),Nu=new PAe,AS=Nu.produce,MAe=(Nu.produceWithPatches.bind(Nu),Nu.setAutoFreeze.bind(Nu));Nu.setUseProxies.bind(Nu),Nu.applyPatches.bind(Nu),Nu.createDraft.bind(Nu),Nu.finishDraft.bind(Nu);const eF=AS;var Uh;function kW(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(o)if(r||(r=new Set),"string"==typeof o){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var c=u[s];r.has(c)||(r.add(c),n.push(c))}}return n}!function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,c=o.actions;u<c.length;u++){var l=c[u];switch(l.kind){case"add":s.add(l.transform);break;case"update":s.setParams(l.ref,l.params);break;case"delete":s.remove(l.ref);break;case"insert":var d=s.children.get(l.ref).toArray();s.add(l.transform);for(var f=0,p=d;f<p.length;f++)s.changeParent(p[f],l.transform.ref)}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}e.is=function r(o){return!!o&&"function"==typeof o.getTree},e.isTo=function n(o){return!!o&&"function"==typeof o.getTree&&"string"==typeof o.ref};var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u="string"==typeof s?s:O1.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=mo.resolveRef(s);return u&&this.state.tree.transforms.has(u)?(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this):this},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,c){if(this.state=s,this.root=c,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '".concat(u,"'."))}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new Sj(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return ii.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,c){if(s.definition.isDecorator)return this.insert(s,u,c);var l=this.getApplyRoot(),d=s.apply(l,u,c);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,c,l){if(this.state.tree.transforms.has(s)){var d=this.to(s);return c&&d.update(c),d}return this.apply(u,c,R(R({},l),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,c,l){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var p=f.next();if(p.done)break;var m=this.state.tree.transforms.get(p.value);if(m&&on.hasTags(m,s)){var h=this.to(p.value);return h.updateTagged(c,kW(m.tags,s,l&&l.tags)),h}}var v=u.apply(d,c,R(R({},l),{tags:kW(s,l&&l.tags)}));return this.state.tree.add(v),this.editInfo.count++,this.editInfo.lastUpdate=v.ref,this.state.actions.push({kind:"add",transform:v}),new o(this.state,v.ref,this.root)},o.prototype.group=function(s,u,c){return this.apply(s,u,c)},o.prototype.insert=function(s,u,c){var l=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,c);this.state.tree.add(d);for(var f=0,p=l;f<p.length;f++)this.state.tree.changeParent(p[f],d.ref);return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var c;if(u){var l=this.state.tree.transforms.get(this.ref);c=AS(l.params,u)}else c="function"==typeof s?AS(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,c)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:c})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i}(Uh||(Uh={}));var ud,Lw,RAe=function(){function e(){this.ev=bf.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=rt.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(void 0),this},e.prototype.remove=function(t){var r=rt.is(t)?t.toAction().id:kn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);s&&(Lh(s,n),0===s.length&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++)if((u=s[o]).definition.isApplicable){i=!0;break}if(!i)return a;for(var c=[],l=0,d=a;l<d.length;l++){var u;(u=d[l]).definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&c.push(u):c.push(u)}return c},e.prototype.dispose=function(){this.ev.dispose()},e}();!function(e){e.message=function t(i){return{type:"message",timestamp:new Date,message:i}},e.error=function r(i){return{type:"error",timestamp:new Date,message:i}},e.warning=function n(i){return{type:"warning",timestamp:new Date,message:i}},e.info=function a(i){return{type:"info",timestamp:new Date,message:i}}}(ud||(ud={})),function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(this._current)for(var o=this._current;;){if(!(o=this.cells.get(o.transform.parent)).obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===on.RootRef)return}},a.prototype.getRootOfType=function(i){if(this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===on.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t,e.getDecoratorChain=function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s?.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u},e.getRootOfType=function n(a,i,o){var s=void 0,u=a.cells.get(o);if(u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===on.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}}(Lw||(Lw={}));var OAe=function(){function e(){this.queue=[],this.signal=new bn}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),1===this.queue.length||this.waitFor(t)},e.prototype.handled=function(t){gS(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=gS(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var s=i.stillPresent;i.v===t&&(a.unsubscribe(),n(s))})})},e}(),FAe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function tF(e,t){return new FAe(e,t)}function rF(){return new BAe}function LW(e){return{previous:null,next:null,inList:!0,value:e}}var En,BAe=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=LW(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=LW(t);return null!==this.last&&(this.last.next=r),r.previous=this.last,this.last=r,null===this.first&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){t.inList&&(t.inList=!1,null!==t.previous?t.previous.next=t.next:null===t.previous&&(this.first=t.next),null!==t.next?t.next.previous=t.previous:null===t.next&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;null!==r;){if(r.value===t)return r;r=r.next}},e}();!function(e){e.create=function t(){return{keys:new Set,array:[]}},e.add=function r(a,i,o){var s=a.keys,u=a.array;return!s.has(i)&&(s.add(i),u[u.length]=o,!0)},e.has=function n(a,i){return a.keys.has(i)}}(En||(En={}));var Uw=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=bf.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:on.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new RAe,this.cells=new Map,this.spine=new Lw.Impl(this.cells),this.tryGetCellData=function(o){var s,u,c=null===(u=null===(s=n.cells.get(o))||void 0===s?void 0:s.obj)||void 0===u?void 0:u.data;if(void 0===c)throw new Error("Cell '".concat(o,"' data undefined."));return c},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new OAe,this._tree=ii.createEmpty(on.createRoot(r&&r.rootState)).asTransient();var i=this._tree.root;this.runTask=r.runTask,void 0!==r?.historyCapacity&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:R({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new Uh.Root(this.tree,this)},e.prototype.addHistory=function(t,r){0!==this.historyCapacity&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){0!==this.history.length&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return Ve.create("Undo",function(r){return ue(t,void 0,void 0,function(){var n;return ce(this,function(a){switch(a.label){case 0:if(!(n=this.history.shift()))return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:ii.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=ii.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(n){var a="function"==typeof r?r(n.state):r;on.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return xr.select(t,this)},e.prototype.selectQ=function(t){return xr.select("string"==typeof t?t:t(xr.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return void 0===n&&(n=on.RootRef),Ve.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'".concat(n,"' does not exist."));if("ok"!==o.status)throw new Error("Action cannot be applied to a cell with status '".concat(o.status,"'"));return iF(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return Ve.create("State Transaction",function(a){return ue(n,void 0,void 0,function(){var i,o,s,u;return ce(this,function(c){switch(c.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,c.label=1;case 1:return c.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return c.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:c.sent(),c.label=4;case 4:return[3,9];case 5:return u=c.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:c.sent(),this.events.log.next(ud.error("Error during state transaction, reverting")),c.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r?.rethrowErrors)throw u;return console.error(u),[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r?.canUndo?this.addHistory(o,"string"==typeof r.canUndo?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return Ve.create("Update Tree",function(i){return ue(n,void 0,void 0,function(){var s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(!d.sent())return[2];this._inUpdate=!0,s=r?.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),Uh.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return l=d.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:l=d.sent(),d.label=6;case 6:return u=this.reverted,(c=l).ctx.hadError&&(this.inTransactionError=!0),c.cell?[2,new Sj(c.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),r?.canUndo?u||this.addHistory(s,"string"==typeof r.canUndo?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ue(this,void 0,void 0,function(){var a,i;return ce(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return((i=s.sent()).ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return ue(this,void 0,void 0,function(){var n,a,i;return ce(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,kAe(a)];case 2:return n=o.sent(),Uh.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(Uh.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:Uh.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:R(R({},NAe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var c;return null===(c=o.get(u).obj)||void 0===c?void 0:c.data}};return this.errorFree=!0,s},e}();!function(e){e.create=function t(n,a){return new e(n,a)},(e.ObjectEvent||(e.ObjectEvent={})).isCell=function a(i,o){return!!o&&i.ref===o.transform.ref&&i.state===o.parent}}(Uw||(Uw={}));var NAe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function kAe(e){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,w,A,E,I,F,N;return ce(this,function(j){switch(j.label){case 0:if(n=[],e.editInfo&&1===e.editInfo.count&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree)r=[],a=[e.editInfo.lastUpdate];else{for(r=function GAe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return ii.doPostOrder(e.oldTree,e.oldTree.root,t,VAe),t.deletes}(e),F=e.parent.current,i=!1,o=0,s=r;o<s.length;o++)if((v=s[o])===F){i=!0;break}for(i&&(u=UW(e.oldTree,F,r,e.cells),e.parent.setCurrent(u)),h=r.length-1;h>=0;h--)(C=e.cells.get(r[h]))&&Gw(C.transform,C.obj,C?.transform.params,C.cache,e.parent.globalContext);for(c=0,l=r;c<l.length;c++)(C=e.cells.get(v=l[c]))&&(C.parent=void 0,WAe(C)),d=C&&C.obj,e.cells.delete(v),n.push(d);a=function LAe(e,t){var r={roots:[],cells:e};return ii.doPreOrder(t,t.root,r,UAe),r.roots}(e.cells,e.tree)}for(f=function KAe(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++)ii.doPreOrder(e.tree,e.tree.transforms.get(a[n]),r,YAe);for(var o=0,s=r.added;o<s.length;o++)XAe(s[o],e);var c;return r.visited.forEach(function(l){for(var f=0,p=e.cells.get(l).dependencies.dependentBy;f<p.length;f++){var m=p[f];r.visited.has(m.transform.ref)||(c||(c=En.create()),En.add(c,m.transform.ref,m))}}),{added:r.added,dependent:c?c.array:void 0}}(e,a),p=0,m=f.added;p<m.length;p++)e.parent.events.cell.created.next({state:e.parent,ref:(C=m[p]).transform.ref,cell:C});for(h=0;h<r.length;h++)g=e.oldTree.transforms.get(v=r[h]).parent,e.parent.events.object.removed.next({state:e.parent,ref:v,obj:n[h]}),e.parent.events.cell.removed.next({state:e.parent,ref:v,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,S=f.dependent;y<S.length;y++)a.push((C=S[y]).transform.ref);(function qAe(e,t){for(var r=0,n=t;r<n.length;r++)ii.doPreOrder(e.tree,e.tree.transforms.get(n[r]),e,jAe)})(e,a),_=0,x=a,j.label=1;case 1:return _<x.length?[4,GW(e,x[_])]:[3,4];case 2:j.sent(),j.label=3;case 3:return _++,[3,1];case 4:for(e.editInfo||function HAe(e){ii.doPreOrder(e.tree,e.tree.root,e,zAe)}(e),w=e.newCurrent,A=0,E=e.results;A<E.length;A++)"created"===(I=E[A]).action?(e.parent.events.object.created.next({state:e.parent,ref:I.ref,obj:I.obj}),e.newCurrent||!e.tree.transforms.get(I.ref).state.isGhost&&I.obj!==Jn.Null&&(w=I.ref)):"updated"===I.action?e.parent.events.object.updated.next({state:e.parent,ref:I.ref,action:"in-place",obj:I.obj,oldData:I.oldData}):"replaced"===I.action&&e.parent.events.object.updated.next({state:e.parent,ref:I.ref,action:"recreate",obj:I.obj,oldObj:I.oldObj});return w?e.options.doNotUpdateCurrent||e.parent.setCurrent(w):(N=e.cells.get(F=e.parent.current))&&(N.obj===Jn.Null||"error"===N.status&&N.errorText===ZAe)&&(w=UW(e.oldTree,F,[],e.cells),e.parent.setCurrent(w)),[2,r.length>0||a.length>0||e.changed]}})})}function UAe(e,t,r){var n=r.cells.get(e.ref);return n&&n.transform.version===e.version?!("error"===n.status||n&&n.obj===Jn.Null):(r.roots.push(e.ref),!1)}function VAe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function zAe(e,t,r){var n=r.cells.get(e.ref);!n||!on.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function Vw(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function jAe(e,t,r){r.cells.get(e.ref).transform=e,Vw(r,e.ref,"pending")}function WAe(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++)Lh(r[t].dependencies.dependentBy,e)}function YAe(e,t,r){var n=r.ctx,a=r.added;if(r.visited.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:R({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function XAe(e,t){if(e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r];if(!t.tree.transforms.get(a))throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);Ya(e.dependencies.dependsOn,o),Ya(o.dependencies.dependentBy,e)}}function UW(e,t,r,n){return VW(e,t,new Set(r),n)}function VW(e,t,r,n){if(t===on.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var c=n.get(u.value);if(c&&"error"!==c.status&&c.obj!==Jn.Null){var l=e.transforms.get(u.value);if(!l.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return l.ref;o=l.ref}}}}return o||VW(e,a.parent,r,n)}function nF(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Ve.isAbort(r);var i=""+r;Vw(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;nF(e,u.value,void 0,n)}}var ve,Bt,In,ml,zw,ZAe="Parent is null";function GW(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return ce(this,function(c){switch(c.label){case 0:Vw(e,t,"processing"),r=!1,c.label=1;case 1:return c.trys.push([1,3,,4]),n=ia(),[4,$Ae(e,t)];case 2:return a=c.sent(),i=ia()-n,"none"!==a.action&&(e.changed=!0),Vw(e,t,"ok"),e.results.push(a),"created"===a.action?!(r=a.obj===Jn.Null)&&!e.options.doNotLogTiming&&e.parent.events.log.next(ud.info("Created ".concat(a.obj.label," in ").concat(gR(i),"."))):("updated"===a.action||"replaced"===a.action)&&!(r=a.obj===Jn.Null)&&!e.options.doNotLogTiming&&e.parent.events.log.next(ud.info("Updated ".concat(a.obj.label," in ").concat(gR(i),"."))),[3,4];case 3:return o=c.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),nF(e,t,o,!1),console.error(o),[2];case 4:s=e.tree.children.get(t).values(),c.label=5;case 5:return(u=s.next()).done?[2]:r?(nF(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,GW(e,u.value)];case 7:c.sent(),c.label=8;case 8:return[3,5];case 9:return[2]}})})}function $Ae(e,t){var r;return ue(this,void 0,void 0,function(){var n,a,i,o,s,c,l,d,f,p,m,h,v,y,C,_;return ce(this,function(x){switch(x.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===on.RootRef)return[2,{action:"none"}];if(s=e.cells.get(i.transform.parent),s?.obj===Jn.Null)return i.sourceRef=s.transform.ref,n.transforms.has(t)&&i.params?(Gw(o,i.obj,p=i.params.values,m=i.cache,e.parent.globalContext),i.params=void 0,i.obj=Jn.Null,[2,{ref:t,action:"updated",obj:i.obj}]):(i.params=void 0,[2,{ref:t,action:"created",obj:Jn.Null}]);if(!(c=0===o.transformer.definition.from.length?s:xr.findAncestorOfType(a,e.cells,t,o.transformer.definition.from)))throw new Error("No suitable parent found for '".concat(t,"'"));return e.spine.current=i,l=c.obj,i.sourceRef=c.transform.ref,d=function QAe(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=T.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=T.getDefaultValues(i);t.params=t.params?function E_e(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];hw.call(t,a)&&typeof e[a]>"u"&&(e[a]=t[a])}return e}(t.params,o):o}return T.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}(e,o,l,i),n.transforms.has(t)&&i.params?[3,2]:(i.params=d,[4,HW(e,i,o.transformer,l,d.values)]);case 1:return aF(f=x.sent(),o),i.obj=f,[2,{ref:t,action:"created",obj:f}];case 2:return p=i.params.values,m=i.cache,h=null===(r=i.obj)||void 0===r?void 0:r.data,v=d.values,i.params=d,i.obj&&i.obj!==Jn.Null?[4,JAe(e,i,o.transformer,l,i.obj,p,v)]:[3,4];case 3:return y=x.sent(),[3,5];case 4:y=rt.UpdateResult.Recreate,x.label=5;case 5:switch(y){case rt.UpdateResult.Recreate:return[3,6];case rt.UpdateResult.Updated:return[3,8];case rt.UpdateResult.Null:return[3,9]}return[3,10];case 6:return Gw(o,C=i.obj,p,m,e.parent.globalContext),[4,HW(e,i,o.transformer,l,v)];case 7:return aF(_=x.sent(),o),i.obj=_,[2,{ref:t,action:"replaced",oldObj:C,obj:_}];case 8:return aF(i.obj,o),[2,{ref:t,action:"updated",oldData:h,obj:i.obj}];case 9:return Gw(o,i.obj,p,m,e.parent.globalContext),i.obj=Jn.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function Gw(e,t,r,n,a){var i,o;null===(o=(i=e.transformer.definition).dispose)||void 0===o||o.call(i,{b:t!==Jn.Null?t:void 0,params:r,cache:n},a)}function aF(e,t){!e||e===Jn.Null||(e.tags=t.tags)}function iF(e,t){return"function"==typeof e.runInContext?e.runInContext(t):e}function zW(e){if(0!==e.dependencies.dependsOn.length){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function HW(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),iF(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:zW(t)},e.parent.globalContext),e.taskCtx)}function JAe(e,t,r,n,a,i,o){return ue(this,void 0,void 0,function(){return ce(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,iF(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:zW(t)},e.parent.globalContext),e.taskCtx)]):[2,rt.UpdateResult.Recreate]})})}!function(e){function n(f){return e.Create(R(R({},f),{typeClass:"Representation3D"}))}e.Create=Jn.factory(),e.isRepresentation3D=function t(f){return!!f&&"Representation3D"===f.type.typeClass},e.isBehavior=function r(f){return!!f&&"Behavior"===f.type.typeClass},e.CreateRepresentation3D=n,e.CreateBehavior=function a(f){return e.Create(R(R({},f),{typeClass:"Behavior"}))};var i=function(f){function p(){return null!==f&&f.apply(this,arguments)||this}return jt(p,f),p}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(f){function p(){return null!==f&&f.apply(this,arguments)||this}return jt(p,f),p}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(f){var p=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return jt(g,v),g}(e.Create({name:"String Data",typeClass:"Data"}));f.String=p;var m=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return jt(g,v),g}(e.Create({name:"Binary Data",typeClass:"Data"}));f.Binary=m;var h=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return jt(g,v),g}(e.Create({name:"Data Blob",typeClass:"Data"}));f.Blob=h}(e.Data||(e.Data={})),function(f){var p=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"JSON Data",typeClass:"Data"}));f.Json=p;var m=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"CIF File",typeClass:"Data"}));f.Cif=m;var h=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"Cube File",typeClass:"Data"}));f.Cube=h;var v=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"PSF File",typeClass:"Data"}));f.Psf=v;var g=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"PRMTOP File",typeClass:"Data"}));f.Prmtop=g;var y=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"TOP File",typeClass:"Data"}));f.Top=y;var S=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"PLY File",typeClass:"Data"}));f.Ply=S;var C=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));f.Ccp4=C;var _=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));f.Dsn6=_;var x=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"DX File",typeClass:"Data"}));f.Dx=x;var D=function(w){function A(){return null!==w&&w.apply(this,arguments)||this}return jt(A,w),A}(e.Create({name:"Format Blob",typeClass:"Data"}));f.Blob=D}(e.Format||(e.Format={})),function(f){var p=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return jt(S,y),S}(e.Create({name:"Coordinates",typeClass:"Object"}));f.Coordinates=p;var m=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return jt(S,y),S}(e.Create({name:"Topology",typeClass:"Object"}));f.Topology=m;var h=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return jt(S,y),S}(e.Create({name:"Model",typeClass:"Object"}));f.Model=h;var v=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return jt(S,y),S}(e.Create({name:"Trajectory",typeClass:"Object"}));f.Trajectory=v;var g=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return jt(S,y),S}(e.Create({name:"Structure",typeClass:"Object"}));f.Structure=g,function(y){var S=function(x){function D(){return null!==x&&x.apply(this,arguments)||this}return jt(D,x),D}(n({name:"Structure 3D"}));y.Representation3D=S;var C=function(x){function D(){return null!==x&&x.apply(this,arguments)||this}return jt(D,x),D}(e.Create({name:"Structure 3D State",typeClass:"Object"}));y.Representation3DState=C;var _=function(x){function D(){return null!==x&&x.apply(this,arguments)||this}return jt(D,x),D}(e.Create({name:"Selections",typeClass:"Object"}));y.Selections=_}(g=f.Structure||(f.Structure={}))}(e.Molecule||(e.Molecule={})),function(f){var p=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return jt(g,v),g}(e.Create({name:"Volume",typeClass:"Object"}));f.Data=p;var m=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return jt(g,v),g}(e.Create({name:"Lazy Volume",typeClass:"Object"}));f.Lazy=m;var h=function(v){function g(){return null!==v&&v.apply(this,arguments)||this}return jt(g,v),g}(n({name:"Volume 3D"}));f.Representation3D=h}(e.Volume||(e.Volume={})),function(f){var p=function(h){function v(){return null!==h&&h.apply(this,arguments)||this}return jt(v,h),v}(e.Create({name:"Shape Provider",typeClass:"Object"}));f.Provider=p;var m=function(h){function v(){return null!==h&&h.apply(this,arguments)||this}return jt(v,h),v}(n({name:"Shape 3D"}));f.Representation3D=m}(e.Shape||(e.Shape={}))}(ve||(ve={})),function(e){e.CreateBuiltIn=rt.factory("ms-plugin"),e.BuiltIn=rt.builderFactory("ms-plugin")}(Bt||(Bt={})),function(e){e.error=function t(i,o){return void 0===o&&(o=-1),new n(i,o)},e.success=function r(i,o){return void 0===o&&(o=[]),new a(i,o)};var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line ".concat(this.line,"] ").concat(this.message):this.message},i}();e.Error=n;var a=function i(o,s){this.result=o,this.warnings=s,this.isError=!1};e.Success=a}(In||(In={})),function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(c){return u.getInt8(c)},readUInt8:function(c){return u.getUint8(c)},writeInt8:function(c,l){return u.setInt8(l,c)},writeUInt8:function(c,l){return u.setUint8(l,c)},readInt16LE:function(c){return u.getInt16(c,!0)},readInt32LE:function(c){return u.getInt32(c,!0)},readUInt16LE:function(c){return u.getUint16(c,!0)},readUInt32LE:function(c){return u.getUint32(c,!0)},readFloatLE:function(c){return u.getFloat32(c,!0)},readDoubleLE:function(c){return u.getFloat64(c,!0)},writeInt16LE:function(c,l){return u.setInt16(l,c,!0)},writeInt32LE:function(c,l){return u.setInt32(l,c,!0)},writeUInt16LE:function(c,l){return u.setUint16(l,c,!0)},writeUInt32LE:function(c,l){return u.setUint32(l,c,!0)},writeFloatLE:function(c,l){return u.setFloat32(l,c,!0)},writeDoubleLE:function(c,l){return u.setFloat64(l,c,!0)},readInt16BE:function(c){return u.getInt16(c,!1)},readInt32BE:function(c){return u.getInt32(c,!1)},readUInt16BE:function(c){return u.getUint16(c,!1)},readUInt32BE:function(c){return u.getUint32(c,!1)},readFloatBE:function(c){return u.getFloat32(c,!1)},readDoubleBE:function(c){return u.getFloat64(c,!1)},writeInt16BE:function(c,l){return u.setInt16(l,c,!1)},writeInt32BE:function(c,l){return u.setInt32(l,c,!1)},writeUInt16BE:function(c,l){return u.setUint16(l,c,!1)},writeUInt32BE:function(c,l){return u.setUint32(l,c,!1)},writeFloatBE:function(c,l){return u.setFloat32(l,c,!1)},writeDoubleBE:function(c,l){return u.setFloat64(l,c,!1)},copy:function(c,l,d,f){return l=po(l,0),d=po(d,0),f=po(f,s.length),c.set(s.subarray(d,f),l),f-d}})}function a(s,u,c,l,d){for(var f=0,p=c;f<p;f+=l)for(var m=0;m<l;m++)u[d+f+l-m-1]=s[d+f+m]}e.fromUint8Array=t,e.fromArrayBuffer=function r(s){return t(new Uint8Array(s))},e.fromBuffer=function n(s){return s},e.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],e.flipByteOrder=a,e.flipByteOrderInPlace2=function i(s,u,c){void 0===u&&(u=0);for(var l=new Int16Array(s,u,c),d=0,f=l.length;d<f;++d){var p=l[d];l[d]=(255&p)<<8|p>>8&255}},e.ensureLittleEndian=function o(s,u,c,l,d){e.IsNativeEndianLittle||!c||l<=1||a(s,u,c,l,d)}}(ml||(ml={})),function(e){e.fromBuffer=function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,c;if("number"==typeof i){o=po(o,i);var l=a;u=(d=Math.min(r.length,l+o))-l,c=ml.fromUint8Array(new Uint8Array(r.buffer,l,d-l))}else{o=po(o,i.length),l=a;var d=Math.min(r.length,l+o);i.set(r.subarray(l,d),s),u=d-l,c=i}return o!==u&&console.warn("byteCount ".concat(o," and bytesRead ").concat(u," differ")),Promise.resolve({bytesRead:u,buffer:c})},writeBuffer:function(a,i,o){return o=po(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=po(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:m0}}}(zw||(zw={}));var pt,Xe,Zr,Ki=function(e){return e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16",e}(Ki||{});function jW(e){return e===Ki.Float32?4:e===Ki.Int16||e===Ki.Uint16?2:1}function eTe(e,t,r,n){return void 0===r&&(r=0),e===Ki.Float32?new Float32Array(t,r,n):e===Ki.Int16?new Int16Array(t,r,n):e===Ki.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function rTe(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){return ce(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(void 0!==i&&i!==ml.IsNativeEndianLittle||!ml.IsNativeEndianLittle)&&ml.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function nTe(e){return ue(this,void 0,void 0,function(){var r,n,a,i,s,u;return ce(this,function(l){switch(l.label){case 0:return[4,e.readBuffer(0,1024)];case 1:if(r=l.sent().buffer,"MAP "!==(n=String.fromCharCode(r.readUInt8(208),r.readUInt8(209),r.readUInt8(210),r.readUInt8(211))))throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(212),r.readUInt8(213)],i=!1,68===a[0]&&65===a[1]?i=!0:17===a[0]&&17===a[1]?i=!1:r.readInt32LE(12)<=16&&(i=!0),u=i?function(d){return r.readFloatLE(4*d)}:function(d){return r.readFloatBE(4*d)},[2,{header:{NC:(s=i?function(d){return r.readInt32LE(4*d)}:function(d){return r.readInt32BE(4*d)})(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},littleEndian:i}]}})})}function qW(e){switch(e){case 0:return Ki.Int8;case 1:return Ki.Int16;case 2:return Ki.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '".concat(e,"'"))}function WW(e){return-128===e.userFlag1&&127===e.userFlag2}function YW(e){return WW(e)?Ki.Float32:qW(e.MODE)}function oTe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f;return ce(this,function(m){switch(m.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return m.sent(),[4,nTe(e)];case 2:return n=m.sent(),i=n.littleEndian,o=function iTe(e){return 1024+e.NSYMBT}(a=n.header),s=qW(a.MODE),u=YW(a),c=a.NC*a.NR*a.NS,l=jW(s),d=c*l,f=function tTe(e,t){var r=jW(t),n=new ArrayBuffer(r*e),a=ml.fromArrayBuffer(n),i=ml.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:eTe(t,i)}}(c,u),function aTe(e,t,r,n,a,i){ue(this,void 0,void 0,function(){var o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return WW(e)?[4,r.readBuffer(n,t.readBuffer,a,o=3*a)]:[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),c=.5*(e.AMIN+e.AMAX+(u=(e.AMAX-e.AMIN)/255)),l=0,d=a;l<d;++l)t.values[l]=u*s[l]+c;return[3,4];case 2:return[4,rTe(t,r,n,a,0,i)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}(a,f,e,o,d,i),[2,{header:a,values:f.values,name:e.name}]}})})}function uTe(e,t){return function sTe(e,t){var r=this;return Ve.create("Parse CCP4/MRC/MAP",function(n){return ue(r,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=In).success,[4,oTe(e,0,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,In.error(o)];case 3:return[2]}})})})}(zw.fromBuffer(ml.fromUint8Array(e),t))}function er(e){return function(t){return oF(e,t)}}function oF(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o="str"===i?function(s){return r.substring(n[2*s],n[2*s+1])}:"int"===i?function(s){return Xp(r,n[2*s],n[2*s+1])||0}:function(s){return mf(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return _o(a,o,s)},areValuesEqual:XW(e)}}function XW(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function cTe(e){for(var t=e.count,r=e.indices,n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function KW(e,t){return{name:t,blocks:e}}function sF(e,t,r,n){return void 0===n&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split(".");return t[i[0]].getField(i[1]||"")}}}function Zi(e,t,r,n){return{rowCount:t,name:e,fieldNames:or([],r,!0),getField:function(a){return n[a]}}}function lt(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function ZW(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position}function QW(e){return!(e.length-e.position<2||39!==e.data.charCodeAt(e.position+1)||39!==e.data.charCodeAt(e.position+2))}function wTe(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||46===e.data.charCodeAt(n+i)}function $W(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t;return t}function JW(e,t){return e.data.substring(e.tokenStart,t)}function uF(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function eY(e){var t=function bTe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:13!==t&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}(e);if(e.position>=e.length)e.tokenType=6;else{e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:(function yTe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(10===t||13===t)return;++e.position}})(e),e.tokenType=5;break;case 39:if(QW(e)){(function hTe(e){for(e.position+=3;e.position<e.length;){if(39===e.data.charCodeAt(e.position)&&QW(e))return e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,void(e.position+=3);++e.position}e.tokenEnd=e.position})(e),e.tokenType=3;break}case 34:(function mTe(e,t){var r,n;for(++e.position;e.position<e.length;)if((n=e.data.charCodeAt(e.position))===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;default:if(void 0===r)return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===n||13===n)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position})(e,r),e.tokenType=3;break;case 59:10===t||13===t?function vTe(e){for(var n,t=59,r=e.position+1;r<e.length;){if(59===(n=e.data.charCodeAt(r))&&(10===t||13===t)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);10===n||13===n;)r--,n=e.data.charCodeAt(r);return e.tokenEnd=r+1,void(e.isEscaped=!0)}(13===n||10===n&&13!==t)&&e.lineNumber++,t=n,++r}e.position=r}(e):ZW(e),e.tokenType=3;break;default:e.isImportGet?function gTe(e){for(;e.position<e.length;){if(93===e.data.charCodeAt(e.position))return++e.position,e.tokenEnd=e.position,void(e.isImportGet=!1);++e.position}}(e):ZW(e),e.isEscaped?e.tokenType=3:95===e.data.charCodeAt(e.tokenStart)?(e.inSaveFrame&&function _Te(e){return!(e.tokenEnd-e.tokenStart!=11||105!==e.data.charCodeAt(e.tokenStart+1)||109!==e.data.charCodeAt(e.tokenStart+2)||112!==e.data.charCodeAt(e.tokenStart+3)||111!==e.data.charCodeAt(e.tokenStart+4)||114!==e.data.charCodeAt(e.tokenStart+5)||116!==e.data.charCodeAt(e.tokenStart+6)||46!==e.data.charCodeAt(e.tokenStart+7)||103!==e.data.charCodeAt(e.tokenStart+8)||101!==e.data.charCodeAt(e.tokenStart+9)||116!==e.data.charCodeAt(e.tokenStart+10))}(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenType=e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?function STe(e){var t=e.data.charCodeAt(e.tokenStart);return!(68!==t&&100!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t)||(t=e.data.charCodeAt(e.tokenStart+2),84!==t&&116!==t)||(t=e.data.charCodeAt(e.tokenStart+3),65!==t&&97!==t))}(e)?0:function CTe(e){var t=e.data.charCodeAt(e.tokenStart);return!(83!==t&&115!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t)||(t=e.data.charCodeAt(e.tokenStart+2),86!==t&&118!==t)||(t=e.data.charCodeAt(e.tokenStart+3),69!==t&&101!==t))}(e)?1:function xTe(e){if(e.tokenEnd-e.tokenStart!=5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(76!==t&&108!==t||(t=e.data.charCodeAt(e.tokenStart+1),79!==t&&111!==t)||(t=e.data.charCodeAt(e.tokenStart+2),79!==t&&111!==t)||(t=e.data.charCodeAt(e.tokenStart+3),80!==t&&112!==t))}(e)?2:3:3}}}function em(e){for(eY(e);5===e.tokenType;)eY(e)}function Hw(){return{categoryNames:[],categoryData:Object.create(null)}}function cF(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=Zi(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function tY(e,t,r){return sF(e.categoryNames,cF(e.categoryNames,e.categoryData),t,r)}function lF(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function ITe(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;3===r.tokenType&&o<e;)Xe.add(n[i++%a],r.tokenStart,r.tokenEnd),em(r),o++;return t.tokenCount=i,o}function PTe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function MTe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:for(r=e.lineNumber,em(e),n=JW(e,$W(e)),a=function ATe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return!1;return!0}(e),i=[];4===e.tokenType;)i[i.length]=a?uF(e):uF(e).substring(n.length+1),em(e);for(o="_atom_site"===n?e.data.length/100|0:32,s=[],u=i.length,f=0;f<u;f++)s[f]=Xe.create(e.data,o);return[4,vf(e.runtimeCtx,1e6,c={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},ITe,PTe)];case 1:if(p.sent(),c.tokenCount%u!=0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line ".concat(r," is not a multiple of the number of columns.")}];if(l=c.tokenCount/u|0,a)for(f=0;f<u;f++)d={"":pt.ofTokens(s[f])},lF(t,i[f].substr(1),l,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[i[f]]=pt.ofTokens(s[f]);lF(t,n.substr(1),l,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function R0(e,t){return In.error(t,e)}function RTe(e){return In.success(e)}function OTe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:r=[],n=function TTe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}(e,t),a="",i=Hw(),o=[],s=Hw(),u=function lTe(e,t,r){return{categoryNames:e,header:r,categories:t}}(s.categoryNames,cF(s.categoryNames,s.categoryData),""),c="",t.update({message:"Parsing...",current:0,max:e.length}),em(n),f.label=1;case 1:return 6===n.tokenType?[3,7]:0!==(l=n.tokenType)?[3,2]:n.inSaveFrame?[2,R0(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(tY(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=Hw(),o=[],em(n),[3,6]);case 2:if(1!==l)return[3,3];if(n.tokenEnd-n.tokenStart==5)s.categoryNames.length>0&&(o[o.length]=function DTe(e,t){return sF(e.categoryNames,cF(e.categoryNames,e.categoryData),t)}(s,c)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,R0(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,c=e.substring(n.tokenStart+5,n.tokenEnd),s=Hw()}return em(n),[3,6];case 3:return 2!==l?[3,5]:[4,MTe(n,n.inSaveFrame?s:i)];case 4:return(d=f.sent()).hasError?[2,R0(d.errorLine,d.errorMessage)]:[3,6];case 5:if(4!==l)return console.log(n.tokenType,lt.getTokenString(n)),[2,R0(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];if(d=function ETe(e,t){for(var r=e.tokenStart,n=$W(e),a=JW(e,n),i=Object.create(null),o=[],s=!0;s;){if(4!==e.tokenType||!wTe(e,r,n)){s=!1;break}var u=uF(e).substring(a.length+1);if(em(e),3!==e.tokenType)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=pt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,em(e)}return lF(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}(n,n.inSaveFrame?s:i),d.hasError)return[2,R0(d.errorLine,d.errorMessage)];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,R0(n.lineNumber,"Unfinished save frame (".concat(u.header,")."))]:((i.categoryNames.length>0||o.length>0)&&r.push(tY(i,a,o)),[2,RTe(KW(r))])}})})}function rY(e){var t=this;return Ve.create("Parse CIF",function(r){return ue(t,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,OTe(e,r)];case 1:return[2,n.sent()]}})})})}!function(e){function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.empty=function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}},e.ofFields=r,e.ofTable=function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var c=u[s];o[c]=pt.ofColumn(i[c])}return r(a,o)}}(Zi||(Zi={})),function(e){function r(s){var u=s.length,c=function(p){var m=s[p];return m&&"."!==m&&"?"!==m?m:""},l=function(p){var m=s[p];return Xp(m,0,m.length)||0},d=function(p){var m=s[p];return mf(m,0,m.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:c,int:l,float:d,valueKind:function(p){var m=s[p],h=m.length;if(h>1)return 0;if(0===h)return 1;var v=m.charCodeAt(0);return 46===v?1:63===v?2:0},areValuesEqual:function(p,m){return s[p]===s[m]},toStringArray:function(p){return p?_o(u,c,p):s},toIntArray:function(p){return _o(u,l,p)},toFloatArray:function(p){return _o(u,d,p)}}}function i(s){var f,p,m,u=s.rowCount,c=s.valueKind,l=s.areValuesEqual,d=s.isDefined;switch(s.schema.valueType){case"float":case"int":f=function(v){return""+s.value(v)},p=s.value,m=s.value;break;case"str":f=s.value,p=function(v){var g=s.value(v);return Xp(g,0,g.length)||0},m=function(v){var g=s.value(v);return mf(g,0,g.length)||0};break;case"list":var h=s.schema.separator;f=function(v){return s.value(v).join(h)},p=function(v){return NaN},m=function(v){return NaN};break;default:throw new Error("unsupported valueType '".concat(s.schema.valueType,"'"))}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:p,float:m,valueKind:c,areValuesEqual:l,toStringArray:function(v){return _o(u,f,v)},toIntArray:function(v){return _o(u,p,v)},toFloatArray:function(v){return _o(u,m,v)}}}e.ofString=function t(s){return r([s])},e.ofStrings=r,e.ofNumbers=function n(s){var u=s.length,c=function(p){return""+s[p]},l=function(p){return s[p]},f=function(p){return!p||p.array&&s instanceof p.array?s:_o(u,l,p)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:c,int:l,float:l,valueKind:function(p){return 0},areValuesEqual:function(p,m){return s[p]===s[m]},toStringArray:function(p){return _o(u,c,p)},toIntArray:f,toFloatArray:f}},e.ofTokens=function a(s){var u=s.data,c=s.indices,l=s.count,d=function(h){var v=u.substring(c[2*h],c[2*h+1]);return"."===v||"?"===v?"":v},f=function(h){return Xp(u,c[2*h],c[2*h+1])||0},p=function(h){return mf(u,c[2*h],c[2*h+1])||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:d,int:f,float:p,valueKind:function(h){var v=c[2*h],g=c[2*h+1]-v;if(g>1)return 0;if(0===g)return 1;var y=u.charCodeAt(v);return 46===y?1:63===y?2:0},areValuesEqual:XW(s),toStringArray:function(h){return _o(l,d,h)},toIntArray:function(h){return _o(l,f,h)},toFloatArray:function(h){return _o(l,p,h)}}},e.ofColumn=i,e.ofUndefined=function o(s,u){return i(ie.Undefined(s,u))}}(pt||(pt={})),function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}function n(y){for(var S=y.data;y.position<y.length;)switch(S.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,10===S.charCodeAt(y.position)&&++y.position,!0;default:++y.position}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}function i(y){return y.tokenStart=y.position,n(y)}function u(y,S,C){for(var _=0,x=0;x<S;x++){if(!i(y))return _;Xe.addUnchecked(C,y.tokenStart,y.tokenEnd),_++}return _}function g(y,S,C){for(var _=y.data,x=S,D=C-1,w=_.charCodeAt(x);(9===w||32===w)&&x<=D;)w=_.charCodeAt(++x);for(w=_.charCodeAt(D);(9===w||32===w)&&D>=x;)w=_.charCodeAt(--D);return y.tokenStart=x,y.tokenEnd=D+1,y.position=C,y}e.getTokenString=t,e.reset=function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0},e.eatLine=n,e.markStart=function a(y){y.tokenStart=y.position},e.markLine=i,e.readLine=function o(y){return i(y),t(y)},e.readLineTrim=function s(y){i(y);var S=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=S,t(y)},e.markLines=function c(y,S){var C=Xe.create(y.data,2*S);return u(y,S,C),C},e.readLines=function l(y,S){for(var C=[],_=0;_<S;_++)C.push(e.readLine(y));return C},e.readLinesAsync=function d(y,S,C,_){return void 0===_&&(_=1e5),ue(this,void 0,void 0,function(){var x,D;return ce(this,function(w){switch(w.label){case 0:return x=Xe.create(y.data,2*S),D=0,[4,vf(C,_,y,function(A,E){var I=Math.min(S-D,A);return u(E,I,x),D+=I,I},function(A,E){return A.update({message:"Parsing...",current:E.position,max:E.length})})];case 1:return w.sent(),[2,x]}})})},e.readAllLines=function f(y){for(var S=e(y),C=Xe.create(S.data,Math.max(y.length/80,2));i(S);)Xe.add(C,S.tokenStart,S.tokenEnd);return C},e.readAllLinesAsync=function m(y,S,C){return void 0===C&&(C=1e5),ue(this,void 0,void 0,function(){var _,x;return ce(this,function(D){switch(D.label){case 0:return _=e(y),x=Xe.create(_.data,Math.max(y.length/80,2)),[4,vf(S,C,_,function(w,A){return function p(y,S,C){for(var _=0,x=0;x<S;x++){if(!i(y))return _;Xe.add(C,y.tokenStart,y.tokenEnd),_++}}(A,w,x),A.position<A.length?w:0},function(w,A){return w.update({message:"Parsing...",current:A.position,max:A.length})})];case 1:return D.sent(),[2,x]}})})},e.eatValue=function h(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:return void(y.tokenEnd=y.position);default:++y.position}y.tokenEnd=y.position},e.skipWhitespace=function v(y){for(var S=-1;y.position<y.length;){var C=y.data.charCodeAt(y.position);switch(C){case 9:case 32:S=C,++y.position;break;case 10:13!==S&&++y.lineNumber,S=C,++y.position;break;case 13:S=C,++y.position,++y.lineNumber;break;default:return S}}return S},e.trim=g}(lt||(lt={})),function(e){function r(o,s,u){var c=o;c.offset>c.indicesLenMinus2&&function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}(c),c.indices[c.offset++]=s,c.indices[c.offset++]=u,o.count++}e.add=r,e.addToken=function n(o,s){r(o,s.tokenStart,s.tokenEnd)},e.addUnchecked=function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++},e.create=function i(o,s){return{data:o,indicesLenMinus2:(s=Math.max(10,s))-2|0,count:0,offset:0,indices:new Uint32Array(s)}}}(Xe||(Xe={})),function(e){var i;(i=e.IntDataType||(e.IntDataType={}))[i.Int8=1]="Int8",i[i.Int16=2]="Int16",i[i.Int32=3]="Int32",i[i.Uint8=4]="Uint8",i[i.Uint16=5]="Uint16",i[i.Uint32=6]="Uint32",function(i){i[i.Float32=32]="Float32",i[i.Float64=33]="Float64"}(e.FloatDataType||(e.FloatDataType={})),e.getDataType=function n(i){return i instanceof Int8Array?e.IntDataType.Int8:i instanceof Int16Array?e.IntDataType.Int16:i instanceof Int32Array?e.IntDataType.Int32:i instanceof Uint8Array?e.IntDataType.Uint8:i instanceof Uint16Array?e.IntDataType.Uint16:i instanceof Uint32Array?e.IntDataType.Uint32:i instanceof Float32Array?e.FloatDataType.Float32:i instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32},e.isSignedIntegerDataType=function a(i){if(i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array)return!0;for(var o=0,s=i.length;o<s;o++)if(o<0)return!1;return!0}}(Zr||(Zr={}));var TS,pF,BTe=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],dF=28672;function jw(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=LTe(t,e.encoding[r]);return t}function LTe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case Zr.IntDataType.Uint8:return e;case Zr.IntDataType.Int8:return function UTe(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case Zr.IntDataType.Int16:return function VTe(e){return O0(e,2,Int16Array)}(e);case Zr.IntDataType.Uint16:return function GTe(e){return O0(e,2,Uint16Array)}(e);case Zr.IntDataType.Int32:return function zTe(e){return O0(e,4,Int32Array)}(e);case Zr.IntDataType.Uint32:return function HTe(e){return O0(e,4,Uint32Array)}(e);case Zr.FloatDataType.Float32:return function jTe(e){return O0(e,4,Float32Array)}(e);case Zr.FloatDataType.Float64:return function qTe(e){return O0(e,8,Float64Array)}(e);default:Sn()}case"FixedPoint":return function WTe(e,t){for(var r=e.length,n=aY(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}(e,t);case"IntervalQuantization":return function YTe(e,t){for(var r=e.length,n=aY(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}(e,t);case"RunLength":return function XTe(e,t){for(var r=nY(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}(e,t);case"Delta":return function KTe(e,t){var r=e.length,n=nY(t.srcType,r);if(!r)return e;n[0]=e[0]+(0|t.origin);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}(e,t);case"IntegerPacking":return function $Te(e,t){return e.length===t.srcSize?e:t.isUnsigned?function QTe(e,t){for(var r=1===t.byteCount?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,u=e[++i];a[o]=s+=u,i++,o++}return a}(e,t):function ZTe(e,t){for(var r=1===t.byteCount?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,c=e[o];c===r||c===n;)u+=c,c=e[++o];i[s]=u+=c,o++,s++}return i}(e,t)}(e,t);case"StringArray":return function JTe(e,t){var r=jw({encoding:t.offsetEncoding,data:t.offsets}),n=jw({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);var u=0,c=new Array(n.length);for(o=0,s=n.length;o<s;o++)c[u++]=i[n[o]+1];return c}(e,t)}}function nY(e,t){switch(e){case Zr.IntDataType.Int8:return new Int8Array(t);case Zr.IntDataType.Int16:return new Int16Array(t);case Zr.IntDataType.Int32:return new Int32Array(t);case Zr.IntDataType.Uint8:return new Uint8Array(t);case Zr.IntDataType.Uint16:return new Uint16Array(t);case Zr.IntDataType.Uint32:return new Uint32Array(t);default:Sn()}}function aY(e,t){switch(e){case Zr.FloatDataType.Float32:return new Float32Array(t);case Zr.FloatDataType.Float64:return new Float64Array(t);default:Sn()}}function O0(e,t,r){return new r(BTe?e.buffer:function NTe(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}(e,t))}function eDe(e,t,r){var a,n=1;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function iY(e,t){return parseFloat(e.toPrecision(t))}function fF(e){return TS.classify(e)}!function(e){function t(p,m){return p>=0?Math.ceil((p+1)/m):Math.ceil((p+1)/(-m-1))}function a(p,m,h){var g=p.limit16;m.pack8+=t(h,p.limit8),m.pack16+=t(h,g),m.count+=1}function i(p,m){p.pack8+=t(m,127),p.pack16+=t(m,32767),p.count+=1}function o(p){return 4*p.count<2*p.pack16?{length:4*p.count,elem:4}:2*p.pack16<p.pack8?{length:2*p.pack16,elem:2}:{length:p.pack8,elem:1}}function s(p,m){for(var h={pack8:0,pack16:0,count:0},v=0,g=p.length;v<g;v++)a(m,h,p[v]);return R(R({},o(h)),{kind:"pack"})}function u(p,m){for(var h={pack8:0,pack16:0,count:0},v=p[0],g=1,y=p.length;g<y;g++)i(h,p[g]-v),v=p[g];return R(R({},o(h)),{kind:"delta"})}function c(p,m){for(var h={pack8:0,pack16:0,count:0},v=1,g=1,y=p.length;g<y;g++)p[g-1]!==p[g]?(a(m,h,p[g-1]),a(m,h,v),v=1):v++;return a(m,h,p[p.length-1]),a(m,h,v),R(R({},o(h)),{kind:"rle"})}function l(p,m){for(var h={pack8:0,pack16:0,count:0},v=1,g=0,y=0,S=1,C=p.length;S<C;S++){var _=p[S]-g;y!==_?(i(h,y),i(h,v),v=1):v++,y=_,g=p[S]}return i(h,y),i(h,v),R(R({},o(h)),{kind:"delta-rle"})}function d(p){var m=function r(p){for(var m=!1,h=0,v=p.length;h<v;h++)if(p[h]<0){m=!0;break}return m?{signed:m,limit8:127,limit16:32767}:{signed:m,limit8:255,limit16:65535}}(p),h=[s(p,m),c(p,m),u(p),l(p)];return h.sort(function(v,g){return v.length-g.length}),h}e.getSize=d,e.classify=function f(p){if(p.length<2)return Fr.by(Fr.byteArray);switch(d(p)[0].kind){case"pack":return Fr.by(Fr.integerPacking);case"rle":return Fr.by(Fr.runLength).and(Fr.integerPacking);case"delta":return Fr.by(Fr.delta).and(Fr.integerPacking);case"delta-rle":return Fr.by(Fr.delta).and(Fr.runLength).and(Fr.integerPacking);default:Sn()}}}(TS||(TS={})),function(e){e.classify=function r(a){var o=function rDe(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=eDe(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var c=Math.floor(Math.log10(Math.abs(u)))+1;c>a&&(a=c)}}return{mantissaDigits:n,integerDigits:a}}(a,4,1e-6),s=o.mantissaDigits;if(s<0||s+o.integerDigits>10)return Fr.by(Fr.byteArray);if(0===s)return TS.classify(a);for(var c=function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}(s),l=new Int32Array(a.length),d=0,f=a.length;d<f;d++)l[d]=Math.round(c*a[d]);var m=TS.getSize(l)[0],h=Fr.by(Fr.fixedPoint(c));switch(m.kind){case"pack":return h.and(Fr.integerPacking);case"rle":return h.and(Fr.runLength).and(Fr.integerPacking);case"delta":return h.and(Fr.delta).and(Fr.integerPacking);case"delta-rle":return h.and(Fr.delta).and(Fr.runLength).and(Fr.integerPacking);default:Sn()}}}(pF||(pF={}));var tm,Fr,F0,oY=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var o=(0,a[n])(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++)r.push(u[s])}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}();function sY(e){return Ww({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function mF(e,t){for(var r={},n=0;n<t;n++)r[Ww(e)]=Ww(e);return r}function hF(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function qw(e,t){var r=TO(e.buffer,e.offset,t);return e.offset+=t,r}function vF(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=Ww(e);return r}function Ww(e){var r,n,t=e.buffer[e.offset];if(!(128&t))return e.offset++,t;if(128==(240&t))return n=15&t,e.offset++,mF(e,n);if(144==(240&t))return n=15&t,e.offset++,vF(e,n);if(160==(224&t))return n=31&t,e.offset++,qw(e,n);if(224==(224&t))return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,hF(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,hF(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,hF(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,qw(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,qw(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,qw(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,vF(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,vF(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,mF(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,mF(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function sDe(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(s)return r[o]||(r[o]=function iDe(e){var t=e.mask?jw(e.mask):void 0,r=jw(e.data),n=xO(r),a=n?t?function(c){return 0===t[c]?""+r[c]:""}:function(c){return""+r[c]}:t?function(c){return 0===t[c]?r[c]:""}:function(c){return r[c]},i=n?function(c){return r[c]}:function(c){var l=r[c];return Xp(l,0,l.length)},o=n?function(c){return r[c]}:function(c){var l=r[c];return mf(l,0,l.length)},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:t?function(c){return t[c]}:function(c){return 0},areValuesEqual:function(c,l){return r[c]===r[l]},toStringArray:function(c){return _o(u,a,c)},toIntArray:n?function(c){return bw(r,c)}:function(c){return _o(u,i,c)},toFloatArray:n?function(c){return bw(r,c)}:function(c){return _o(u,o,c)}}}(s)),r[o]}}}function uY(e){var t=this;return Ve.create("Parse BinaryCIF",function(r){return ue(t,void 0,void 0,function(){var n,a,i;return ce(this,function(o){n=[0,3];try{return a=sY(e),function oDe(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=KW(a.dataBlocks.map(function(s){for(var u=Object.create(null),c=0,l=s.categories;c<l.length;c++){var d=l[c];u[d.name.substr(1)]=sDe(d)}return sF(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,In.success(i)]):[2,In.error("Unsupported format version. Current ".concat(a.version,", required ").concat(n.join("."),"."))]}catch(s){return[2,In.error(""+s)]}return[2]})})})}function cd(e,t,r){return function mDe(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=gDe(o,e[o],t,r)}return _O.ofTables(t.header,e,n)}(e,t,r)}function cY(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}!function(e){function t(a){return new oY([a])}function n(a){switch(a.kind){case"ByteArray":return Fr.byteArray;case"FixedPoint":return Fr.fixedPoint(a.factor);case"IntervalQuantization":return Fr.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return Fr.runLength;case"Delta":return Fr.delta;case"IntegerPacking":return Fr.integerPacking;case"StringArray":return Fr.stringArray}}e.by=t,e.fromEncoding=function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}}(tm||(tm={})),function(e){var t,r;e.by=function n(x){return new oY([x])};var o=((t={})[Zr.IntDataType.Int16]=function(x,D,w){x.setInt16(2*D,w,!0)},t[Zr.IntDataType.Uint16]=function(x,D,w){x.setUint16(2*D,w,!0)},t[Zr.IntDataType.Int32]=function(x,D,w){x.setInt32(4*D,w,!0)},t[Zr.IntDataType.Uint32]=function(x,D,w){x.setUint32(4*D,w,!0)},t[Zr.FloatDataType.Float32]=function(x,D,w){x.setFloat32(4*D,w,!0)},t[Zr.FloatDataType.Float64]=function(x,D,w){x.setFloat64(8*D,w,!0)},t),s=((r={})[Zr.IntDataType.Int16]=2,r[Zr.IntDataType.Uint16]=2,r[Zr.IntDataType.Int32]=4,r[Zr.IntDataType.Uint32]=4,r[Zr.FloatDataType.Float32]=4,r[Zr.FloatDataType.Float64]=8,r);function u(x){var D=Zr.getDataType(x);if(D===Zr.IntDataType.Int8)return function i(x){return{encodings:[{kind:"ByteArray",type:Zr.IntDataType.Int8}],data:new Uint8Array(x.buffer,x.byteOffset)}}(x);if(D===Zr.IntDataType.Uint8)return function a(x){return{encodings:[{kind:"ByteArray",type:Zr.IntDataType.Uint8}],data:x}}(x);for(var w=new Uint8Array(x.length*s[D]),A=o[D],E=new DataView(w.buffer),I=0,M=x.length;I<M;I++)A(E,I,x[I]);return{encodings:[{kind:"ByteArray",type:D}],data:w}}function v(x,D){for(var w=0,A=0,E=x.length;A<E;A++)w+=x[A]/D|0;return w+x.length}function g(x,D){for(var w=-D-1,A=0,E=0,I=x.length;E<I;E++){var M=x[E];A+=M>=0?M/D|0:M/w|0}return A+x.length}e.byteArray=u,e.fixedPoint=function l(x){return function(D){return function c(x,D){for(var w=Zr.getDataType(x),A=new Int32Array(x.length),E=0,I=x.length;E<I;E++)A[E]=Math.round(x[E]*D);return{encodings:[{kind:"FixedPoint",factor:D,srcType:w}],data:A}}(D,x)}},e.intervalQuantizaiton=function f(x,D,w,A){return void 0===A&&(A=Int32Array),function(E){return function d(x,D,w,A,E){var I=Zr.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:D,max:w,numSteps:A,srcType:I}],data:new Int32Array(0)};if(w<D){var M=D;D=w,w=M}for(var F=(w-D)/(A-1),N=new E(x.length),j=0,U=x.length;j<U;j++){var H=x[j];N[j]=H<=D?0:H>=w?A-1:0|Math.round((H-D)/F)}return{encodings:[{kind:"IntervalQuantization",min:D,max:w,numSteps:A,srcType:I}],data:N}}(E,x,D,w,A)}},e.runLength=function p(x){var D=Zr.getDataType(x);if(void 0===D&&(x=new Int32Array(x),D=Zr.IntDataType.Int32),!x.length)return{encodings:[{kind:"RunLength",srcType:D,srcSize:0}],data:new Int32Array(0)};for(var w=2,A=1,E=x.length;A<E;A++)x[A-1]!==x[A]&&(w+=2);var I=new Int32Array(w),M=0,F=1;for(A=1,E=x.length;A<E;A++)x[A-1]!==x[A]?(I[M]=x[A-1],I[M+1]=F,F=1,M+=2):++F;return I[M]=x[x.length-1],I[M+1]=F,{encodings:[{kind:"RunLength",srcType:D,srcSize:x.length}],data:I}},e.delta=function m(x){if(!Zr.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var D=Zr.getDataType(x);if(void 0===D&&(x=new Int32Array(x),D=Zr.IntDataType.Int32),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:D}],data:new x.constructor(0)};var w=new x.constructor(x.length),A=x[0];w[0]=x[0];for(var E=1,I=x.length;E<I;E++)w[E]=x[E]-x[E-1];return w[0]=0,{encodings:[{kind:"Delta",origin:A,srcType:D}],data:w}},e.integerPacking=function C(x){var D=function y(x){var D=function h(x){for(var D=0,w=x.length;D<w;D++)if(x[D]<0)return!0;return!1}(x),w=D?g(x,127):v(x,255),A=D?g(x,32767):v(x,65535);return 4*x.length<2*A?{isSigned:D,size:x.length,bytesPerElement:4}:2*A<w?{isSigned:D,size:A,bytesPerElement:2}:{isSigned:D,size:w,bytesPerElement:1}}(x);return 4===D.bytesPerElement?u(x):function S(x,D){for(var w=D.isSigned?1===D.bytesPerElement?127:32767:1===D.bytesPerElement?255:65535,A=-w-1,E=x.length,I=D.isSigned?1===D.bytesPerElement?new Int8Array(D.size):new Int16Array(D.size):1===D.bytesPerElement?new Uint8Array(D.size):new Uint16Array(D.size),M=0,F=0;F<E;F++){var N=x[F];if(N>=0)for(;N>=w;)I[M]=w,++M,N-=w;else for(;N<=A;)I[M]=A,++M,N-=A;I[M]=N,++M}var j=u(I);return{encodings:[{kind:"IntegerPacking",byteCount:D.bytesPerElement,isUnsigned:!D.isSigned,srcSize:E},j.encodings[0]],data:j.data}}(x,D)},e.stringArray=function _(x){var D=Object.create(null),w=[],A=new Int32Array(x.length),E=qe.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));qe.add(E,0);for(var I=0,M=0,F=0,N=x;F<N.length;F++){var j=N[F];if(null!=j){var U=D[j];void 0===U&&(I+=j.length,w[U=w.length]=j,D[j]=U,qe.add(E,I)),A[M++]=U}else A[M++]=-1}var H=qe.compact(E),G=fF(H).encode(H),X=fF(A).encode(A);return{encodings:[{kind:"StringArray",dataEncoding:X.encoding,stringData:w.join(""),offsetEncoding:G.encoding,offsets:G.data}],data:X.data}}}(Fr||(Fr={})),function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t,e.equal=function r(a,i){return t(a)===t(i)},e.create=function n(a,i,o){void 0===o&&(o=!1);var s="".concat(a).concat(i?".".concat(i):"");return o?t(s):s}}(F0||(F0={}));var lY=function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(i[d])return i[d];var f=r[d];if("list"===f.valueType)i[d]=function fDe(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(c){return a(c.trim())}).filter(function(c){return!!c})}:function(u){return[]};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,c){return Es(o(u),o(c))},toArray:function(u){return _o(t.rowCount,o,u)}}}(f,t,d);else if("tensor"===f.valueType)i[d]=function pDe(e,t,r){var n=e.space,a=t.fieldNames.includes("".concat(r,"[0]"))||t.fieldNames.includes("".concat(r,"[0][0]"))||t.fieldNames.includes("".concat(r,"[0][0][0]")),i=a?0:1,o=t.fieldNames.includes("".concat(r,"_1"))||t.fieldNames.includes("".concat(r,"_11"))||t.fieldNames.includes("".concat(r,"_111"))?"underscore":"brackets",s=function dTe(e,t,r,n){var a=r?0:1;switch(t){case 1:return"brackets"===n?function(i){return"".concat(e,"[").concat(i+a,"]")}:function(i){return"".concat(e,"_").concat(i+a)};case 2:return"brackets"===n?function(i,o){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"]")}:function(i,o){return"".concat(e,"_").concat(i+a).concat(o+a)};case 3:return"brackets"===n?function(i,o,s){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"][").concat(s+a,"]")}:function(i,o,s){return"".concat(e,"_").concat(i+a).concat(o+a).concat(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(r,n.rank,a,o),u=t.getField(s(i,i,i))||ie.Undefined(t.rowCount,e),c=function(d){return function fTe(e,t,r,n){var a=t.create();if(1===t.rank)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(2===t.rank){i=t.dimensions[0];var u=t.dimensions[1];for(o=0;o<i;o++)for(var c=0;c<u;c++)s=e.getField(n(o,c)),t.set(a,o,c,s?s.float(r):0)}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");var l=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2];for(o=0;o<l;o++)for(c=0;c<d;c++)for(var p=0;p<f;p++)s=e.getField(n(o,c,p)),t.set(a,o,c,p,s?s.float(r):0)}return a}(t,n,d,s)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:c,valueKind:u.valueKind,areValuesEqual:function(d,f){return Sr.areEqualExact(c(d),c(f))},toArray:function(d){return _o(t.rowCount,c,d)}}}(f,t,d);else{var p=function lDe(e){switch(e.valueType){case"str":return function(t,r,n){return function dDe(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:"lowercase"===e.transform?function(a){return r(a).toLowerCase()}:"uppercase"===e.transform?function(a){return r(a).toUpperCase()}:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:"lowercase"===e.transform?function(a){return Array.from(n(a)).map(function(i){return i.toLowerCase()})}:"uppercase"===e.transform?function(a){return Array.from(n(a)).map(function(i){return i.toUpperCase()})}:n}}(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return cY(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return cY(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}(f),m=t.getField(d);i[d]=m?p(m,t,d):ie.Undefined(t.rowCount,f)}return i[d]},enumerable:!0,configurable:!1})},s=this,u=0,c=a;u<c.length;u++)o(c[u])};function vDe(e,t,r,n){var a=F0.create(t,e),i=F0.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var c=F0.canonical(s[o]);if(c in r)return r[c]}}function gDe(e,t,r,n){var a=r.categories[e];if(n){for(var i=function hDe(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i];t[F0.create(a,s,!0)]=e.categories[a].getField(s)}return t}(r),o=Object.create(null),s=[],u=0,c=0,l=Object.keys(t);c<l.length;c++){var d=l[c],f=vDe(d,e,i,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}a={rowCount:u,name:e,fieldNames:or([],s,!0),getField:function(p){return o[p]}}}return new lY(a||Zi.empty(e),t,!!a)}var xf=ie.Schema,se=xf.str,Ee=xf.int,hr=xf.float,gF=xf.coord,It=xf.Aliased,rm=xf.Matrix,Yw=xf.Vector,vn=xf.lstr,Vh=xf.List,Br={atom_site:{auth_asym_id:se,auth_atom_id:se,auth_comp_id:se,auth_seq_id:Ee,B_iso_or_equiv:hr,Cartn_x:gF,Cartn_y:gF,Cartn_z:gF,group_PDB:It(se),id:Ee,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_entity_id:se,label_seq_id:Ee,occupancy:hr,type_symbol:se,pdbx_PDB_ins_code:se,pdbx_PDB_model_num:Ee,pdbx_formal_charge:Ee,pdbx_label_index:Ee,pdbx_sifts_xref_db_name:se,pdbx_sifts_xref_db_acc:se,pdbx_sifts_xref_db_num:se,pdbx_sifts_xref_db_res:se,ihm_model_id:Ee},atom_site_anisotrop:{id:Ee,type_symbol:se,U:rm(3,3),U_esd:rm(3,3),pdbx_auth_seq_id:se,pdbx_auth_asym_id:se,pdbx_auth_atom_id:se,pdbx_auth_comp_id:se,pdbx_label_seq_id:Ee,pdbx_label_alt_id:se,pdbx_label_asym_id:se,pdbx_label_atom_id:se,pdbx_label_comp_id:se,pdbx_PDB_ins_code:se},atom_sites:{entry_id:se,fract_transf_matrix:rm(3,3),fract_transf_vector:Yw(3)},audit_author:{name:se,pdbx_ordinal:Ee,identifier_ORCID:se},audit_conform:{dict_location:se,dict_name:se,dict_version:se},cell:{angle_alpha:hr,angle_beta:hr,angle_gamma:hr,entry_id:se,length_a:hr,length_b:hr,length_c:hr,Z_PDB:Ee,pdbx_unique_axis:se},chem_comp:{formula:se,formula_weight:hr,id:se,mon_nstd_flag:It(vn),name:se,type:It(vn),pdbx_synonyms:Vh(";",function(e){return e})},chem_comp_bond:{atom_id_1:se,atom_id_2:se,comp_id:se,value_order:It(vn),pdbx_ordinal:Ee,pdbx_stereo_config:It(vn),pdbx_aromatic_flag:It(vn)},citation:{book_publisher:se,country:se,id:se,journal_abbrev:se,journal_id_ASTM:se,journal_id_CSD:se,journal_id_ISSN:se,journal_volume:se,page_first:se,page_last:se,title:se,year:Ee,pdbx_database_id_DOI:se,pdbx_database_id_PubMed:Ee},citation_author:{citation_id:se,name:se,ordinal:Ee},database_2:{database_id:It(vn),database_code:se},entity:{details:se,formula_weight:hr,id:se,src_method:It(vn),type:It(vn),pdbx_description:Vh(",",function(e){return e}),pdbx_number_of_molecules:Ee,pdbx_mutation:se,pdbx_fragment:se,pdbx_ec:Vh(",",function(e){return e})},entity_poly:{entity_id:se,nstd_linkage:It(vn),nstd_monomer:It(vn),type:It(se),pdbx_strand_id:Vh(",",function(e){return e}),pdbx_seq_one_letter_code:se,pdbx_seq_one_letter_code_can:se,pdbx_target_identifier:se},entity_poly_seq:{entity_id:se,hetero:It(vn),mon_id:se,num:Ee},entry:{id:se},exptl:{entry_id:se,method:It(se)},software:{classification:se,date:se,description:se,name:se,type:It(vn),version:se,pdbx_ordinal:Ee},struct:{entry_id:se,title:se,pdbx_descriptor:se},struct_asym:{details:se,entity_id:se,id:se,pdbx_modified:se,pdbx_blank_PDB_chainid_flag:It(se)},struct_conf:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:Ee,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:Ee,conf_type_id:It(vn),details:se,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:Ee,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:Ee,id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se,pdbx_PDB_helix_class:se,pdbx_PDB_helix_length:Ee,pdbx_PDB_helix_id:se},struct_conn:{conn_type_id:It(vn),details:se,id:se,ptnr1_label_asym_id:se,ptnr1_label_atom_id:se,ptnr1_label_comp_id:se,ptnr1_label_seq_id:Ee,ptnr1_auth_asym_id:se,ptnr1_auth_comp_id:se,ptnr1_auth_seq_id:Ee,ptnr1_symmetry:se,ptnr2_label_asym_id:se,ptnr2_label_atom_id:se,ptnr2_label_comp_id:se,ptnr2_label_seq_id:Ee,ptnr2_auth_asym_id:se,ptnr2_auth_comp_id:se,ptnr2_auth_seq_id:Ee,ptnr2_symmetry:se,pdbx_ptnr1_PDB_ins_code:se,pdbx_ptnr1_label_alt_id:se,pdbx_ptnr1_standard_comp_id:se,pdbx_ptnr2_PDB_ins_code:se,pdbx_ptnr2_label_alt_id:se,pdbx_ptnr3_PDB_ins_code:se,pdbx_ptnr3_label_alt_id:se,pdbx_ptnr3_label_asym_id:se,pdbx_ptnr3_label_atom_id:se,pdbx_ptnr3_label_comp_id:se,pdbx_ptnr3_label_seq_id:Ee,pdbx_PDB_id:se,pdbx_dist_value:hr,pdbx_value_order:It(vn)},struct_conn_type:{criteria:se,id:It(vn),reference:se},struct_keywords:{entry_id:se,text:Vh(",",function(e){return e}),pdbx_keywords:se},struct_ncs_oper:{code:It(se),details:se,id:Ee,matrix:rm(3,3),vector:Yw(3)},struct_sheet_range:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:Ee,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:Ee,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:Ee,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:Ee,id:se,sheet_id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se},struct_site:{details:se,id:se,pdbx_num_residues:Ee,pdbx_evidence_code:se,pdbx_auth_asym_id:se,pdbx_auth_comp_id:se,pdbx_auth_seq_id:se,pdbx_auth_ins_code:se},struct_site_gen:{details:se,id:se,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_seq_id:Ee,auth_asym_id:se,auth_comp_id:se,auth_seq_id:se,site_id:se,symmetry:se,pdbx_auth_ins_code:se,pdbx_num_res:Ee},symmetry:{entry_id:se,cell_setting:It(vn),Int_Tables_number:Ee,space_group_name_Hall:se,"space_group_name_H-M":se},pdbx_database_status:{status_code:It(se),status_code_sf:It(se),status_code_mr:It(se),entry_id:se,recvd_initial_deposition_date:se,SG_entry:It(vn),deposit_site:It(se),process_site:It(se),status_code_cs:It(se),methods_development_category:It(se),pdb_format_compatible:It(vn)},pdbx_nonpoly_scheme:{asym_id:se,entity_id:se,mon_id:se,pdb_strand_id:se,ndb_seq_num:se,pdb_seq_num:se,auth_seq_num:se,pdb_mon_id:se,auth_mon_id:se,pdb_ins_code:se},pdbx_database_related:{db_name:se,details:se,db_id:se,content_type:It(se)},pdbx_entity_nonpoly:{entity_id:se,comp_id:se,name:se},pdbx_chem_comp_synonyms:{name:se,comp_id:se,provenance:It(se)},pdbx_chem_comp_identifier:{comp_id:se,identifier:se,type:It(se),program:se,program_version:se},pdbx_unobs_or_zero_occ_residues:{id:Ee,polymer_flag:It(vn),occupancy_flag:It(Ee),PDB_model_num:Ee,auth_asym_id:se,auth_comp_id:se,auth_seq_id:se,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ee},pdbx_struct_mod_residue:{id:Ee,auth_asym_id:se,auth_comp_id:se,auth_seq_id:Ee,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ee,parent_comp_id:se,details:se},pdbx_struct_oper_list:{id:se,type:It(se),name:se,symmetry_operation:se,matrix:rm(3,3),vector:Yw(3)},pdbx_struct_assembly:{method_details:se,oligomeric_details:se,oligomeric_count:Ee,details:se,id:se},pdbx_struct_assembly_gen:{asym_id_list:Vh(",",function(e){return e}),assembly_id:se,oper_expression:se},pdbx_reference_entity_list:{prd_id:se,ref_entity_id:se,type:It(vn),details:se,component_id:Ee},pdbx_reference_entity_link:{link_id:Ee,prd_id:se,details:se,ref_entity_id_1:se,ref_entity_id_2:se,entity_seq_num_1:Ee,entity_seq_num_2:Ee,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:It(vn),component_1:Ee,component_2:Ee,link_class:It(se)},pdbx_reference_entity_poly_link:{link_id:Ee,prd_id:se,ref_entity_id:se,component_id:Ee,entity_seq_num_1:Ee,entity_seq_num_2:Ee,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:It(vn)},pdbx_molecule:{prd_id:se,instance_id:Ee,asym_id:se},pdbx_molecule_features:{prd_id:se,class:It(vn),type:It(vn),name:se,details:se},entity_src_nat:{entity_id:se,pdbx_organism_scientific:se,pdbx_plasmid_name:se,pdbx_src_id:Ee,pdbx_beg_seq_num:Ee,pdbx_end_seq_num:Ee},entity_src_gen:{entity_id:se,pdbx_gene_src_gene:Vh(",",function(e){return e}),pdbx_gene_src_scientific_name:se,plasmid_name:se,pdbx_src_id:Ee,pdbx_beg_seq_num:Ee,pdbx_end_seq_num:Ee},pdbx_entity_src_syn:{organism_scientific:se,entity_id:se,pdbx_src_id:Ee,pdbx_beg_seq_num:Ee,pdbx_end_seq_num:Ee},pdbx_entity_branch_descriptor:{entity_id:se,descriptor:se,type:It(vn),program:se,program_version:se,ordinal:Ee},pdbx_entity_instance_feature:{details:se,feature_type:It(se),auth_asym_id:se,asym_id:se,auth_seq_num:se,seq_num:Ee,comp_id:se,auth_comp_id:se,ordinal:Ee},pdbx_entity_branch_list:{entity_id:se,hetero:It(vn),comp_id:se,num:Ee},pdbx_entity_branch_link:{link_id:Ee,details:se,entity_id:se,entity_branch_list_num_1:Ee,entity_branch_list_num_2:Ee,comp_id_1:se,comp_id_2:se,atom_id_1:se,leaving_atom_id_1:se,atom_stereo_config_1:It(vn),atom_id_2:se,leaving_atom_id_2:se,atom_stereo_config_2:It(vn),value_order:It(vn)},pdbx_entity_branch:{entity_id:se,type:It(se)},pdbx_branch_scheme:{entity_id:se,hetero:It(vn),asym_id:se,mon_id:se,num:Ee,pdb_asym_id:se,pdb_seq_num:se,pdb_mon_id:se,auth_asym_id:se,auth_seq_num:se,auth_mon_id:se},pdbx_chem_comp_related:{comp_id:se,related_comp_id:se,relationship_type:It(se),details:se},ihm_starting_model_details:{starting_model_id:se,entity_id:se,entity_description:se,asym_id:se,entity_poly_segment_id:Ee,starting_model_source:It(se),starting_model_auth_asym_id:se,starting_model_sequence_offset:Ee,dataset_list_id:Ee},ihm_starting_comparative_models:{id:Ee,starting_model_id:se,starting_model_auth_asym_id:se,starting_model_seq_id_begin:Ee,starting_model_seq_id_end:Ee,template_auth_asym_id:se,template_seq_id_begin:Ee,template_seq_id_end:Ee,template_sequence_identity:hr,template_sequence_identity_denominator:It(Ee),template_dataset_list_id:Ee,alignment_file_id:Ee},ihm_starting_model_seq_dif:{id:Ee,entity_id:se,asym_id:se,seq_id:Ee,comp_id:se,starting_model_id:se,db_asym_id:se,db_seq_id:Ee,db_comp_id:se,details:se},ihm_model_representation:{id:Ee,name:se,details:se},ihm_model_representation_details:{id:Ee,representation_id:Ee,entity_poly_segment_id:Ee,entity_id:se,entity_description:se,entity_asym_id:se,model_object_primitive:It(se),starting_model_id:se,model_mode:It(se),model_granularity:It(se),model_object_count:Ee},ihm_struct_assembly_details:{id:Ee,assembly_id:Ee,parent_assembly_id:Ee,entity_description:se,entity_id:se,asym_id:se,entity_poly_segment_id:Ee},ihm_struct_assembly:{id:Ee,name:se,description:se},ihm_modeling_protocol:{id:Ee,num_steps:Ee,protocol_name:se},ihm_modeling_protocol_details:{id:Ee,protocol_id:Ee,step_id:Ee,struct_assembly_id:Ee,dataset_group_id:Ee,struct_assembly_description:se,step_name:se,step_method:se,num_models_begin:Ee,num_models_end:Ee,multi_scale_flag:It(vn),multi_state_flag:It(vn),ordered_flag:It(vn),script_file_id:Ee,software_id:Ee},ihm_multi_state_modeling:{state_id:Ee,state_group_id:Ee,population_fraction:hr,population_fraction_sd:hr,state_type:se,state_name:se,experiment_type:It(se),details:se},ihm_modeling_post_process:{id:Ee,protocol_id:Ee,analysis_id:Ee,step_id:Ee,type:It(se),feature:It(se),num_models_begin:Ee,num_models_end:Ee},ihm_ensemble_info:{ensemble_id:Ee,ensemble_name:se,post_process_id:Ee,model_group_id:Ee,ensemble_clustering_method:It(se),ensemble_clustering_feature:It(se),num_ensemble_models:Ee,num_ensemble_models_deposited:Ee,ensemble_precision_value:hr,ensemble_file_id:Ee},ihm_model_list:{model_id:Ee,model_name:se,assembly_id:Ee,protocol_id:Ee,representation_id:Ee},ihm_model_group:{id:Ee,name:se,details:se},ihm_model_group_link:{model_id:Ee,group_id:Ee},ihm_model_representative:{id:Ee,model_group_id:Ee,model_id:Ee,selection_criteria:It(se)},ihm_dataset_list:{id:Ee,data_type:It(se),database_hosted:It(vn)},ihm_dataset_group:{id:Ee,name:se,application:It(se),details:se},ihm_dataset_group_link:{dataset_list_id:Ee,group_id:Ee},ihm_related_datasets:{dataset_list_id_derived:Ee,dataset_list_id_primary:Ee},ihm_dataset_related_db_reference:{id:Ee,dataset_list_id:Ee,db_name:It(se),accession_code:se,version:se,details:se},ihm_external_reference_info:{reference_id:Ee,reference_provider:se,reference_type:It(se),reference:se,refers_to:It(se),associated_url:se},ihm_external_files:{id:Ee,reference_id:Ee,file_path:se,content_type:It(se),file_size_bytes:hr,details:se},ihm_dataset_external_reference:{id:Ee,dataset_list_id:Ee,file_id:Ee},ihm_localization_density_files:{id:Ee,file_id:Ee,ensemble_id:Ee,entity_id:se,entity_poly_segment_id:Ee,asym_id:se},ihm_predicted_contact_restraint:{id:Ee,group_id:Ee,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ee,seq_id_2:Ee,rep_atom_1:It(se),rep_atom_2:It(se),distance_lower_limit:hr,distance_upper_limit:hr,probability:hr,restraint_type:It(se),model_granularity:It(se),dataset_list_id:Ee,software_id:Ee},ihm_cross_link_list:{id:Ee,group_id:Ee,entity_description_1:se,entity_description_2:se,entity_id_1:se,entity_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ee,seq_id_2:Ee,linker_type:It(se),dataset_list_id:Ee},ihm_cross_link_restraint:{id:Ee,group_id:Ee,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ee,seq_id_2:Ee,atom_id_1:se,atom_id_2:se,restraint_type:It(se),conditional_crosslink_flag:It(se),model_granularity:It(se),distance_threshold:hr,psi:hr,sigma_1:hr,sigma_2:hr},ihm_cross_link_result_parameters:{id:Ee,restraint_id:Ee,model_id:Ee,psi:hr,sigma_1:hr,sigma_2:hr},ihm_2dem_class_average_restraint:{id:Ee,dataset_list_id:Ee,number_raw_micrographs:Ee,pixel_size_width:hr,pixel_size_height:hr,image_resolution:hr,image_segment_flag:It(vn),number_of_projections:Ee,struct_assembly_id:Ee,details:se},ihm_2dem_class_average_fitting:{id:Ee,restraint_id:Ee,model_id:Ee,cross_correlation_coefficient:hr,rot_matrix:rm(3,3),tr_vector:Yw(3)},ihm_3dem_restraint:{id:Ee,dataset_list_id:Ee,model_id:Ee,struct_assembly_id:Ee,fitting_method:se,number_of_gaussians:Ee,cross_correlation_coefficient:hr},ihm_sas_restraint:{id:Ee,dataset_list_id:Ee,model_id:Ee,struct_assembly_id:Ee,profile_segment_flag:It(vn),fitting_atom_type:se,fitting_method:se,fitting_state:It(se),radius_of_gyration:hr,chi_value:hr,details:se},ihm_starting_model_coord:{ordinal_id:Ee,starting_model_id:se,group_PDB:It(se),id:Ee,type_symbol:se,entity_id:se,atom_id:se,comp_id:se,seq_id:Ee,asym_id:se,Cartn_x:hr,Cartn_y:hr,Cartn_z:hr,B_iso_or_equiv:hr},ihm_sphere_obj_site:{id:Ee,entity_id:se,seq_id_begin:Ee,seq_id_end:Ee,asym_id:se,Cartn_x:hr,Cartn_y:hr,Cartn_z:hr,object_radius:hr,rmsf:hr,model_id:Ee},ihm_gaussian_obj_site:{id:Ee,entity_id:se,seq_id_begin:Ee,seq_id_end:Ee,asym_id:se,mean_Cartn_x:hr,mean_Cartn_y:hr,mean_Cartn_z:hr,weight:hr,covariance_matrix:rm(3,3),model_id:Ee},ihm_gaussian_obj_ensemble:{id:Ee,entity_id:se,seq_id_begin:Ee,seq_id_end:Ee,asym_id:se,mean_Cartn_x:hr,mean_Cartn_y:hr,mean_Cartn_z:hr,weight:hr,covariance_matrix:rm(3,3),ensemble_id:Ee},ihm_feature_list:{feature_id:Ee,feature_type:It(se),entity_type:It(se)},ihm_poly_residue_feature:{ordinal_id:Ee,feature_id:Ee,entity_id:se,asym_id:se,comp_id_begin:se,comp_id_end:se,seq_id_begin:Ee,seq_id_end:Ee},ihm_derived_distance_restraint:{id:Ee,group_id:Ee,feature_id_1:Ee,feature_id_2:Ee,group_conditionality:It(se),random_exclusion_fraction:hr,distance_upper_limit:hr,restraint_type:It(se),dataset_list_id:Ee},ma_model_list:{ordinal_id:Ee,model_id:Ee,model_group_id:Ee,model_name:se,model_group_name:se,model_type:It(se),data_id:Ee},ma_target_entity:{entity_id:se,data_id:Ee,origin:It(se)},ma_target_entity_instance:{asym_id:se,entity_id:se,details:se},ma_target_ref_db_details:{target_entity_id:se,db_name:It(se),db_code:se,db_accession:se,seq_db_isoform:se,seq_db_align_begin:se,seq_db_align_end:se,ncbi_taxonomy_id:se,organism_scientific:se},ma_data:{id:Ee,content_type:It(se),content_type_other_details:se,name:se},ma_software_group:{ordinal_id:Ee,group_id:Ee,software_id:Ee},ma_qa_metric:{id:Ee,name:se,type:It(se),mode:It(se),software_group_id:Ee},ma_qa_metric_global:{ordinal_id:Ee,model_id:Ee,metric_id:Ee,metric_value:hr},ma_qa_metric_local:{ordinal_id:Ee,model_id:Ee,label_asym_id:se,label_seq_id:Ee,label_comp_id:se,metric_id:Ee,metric_value:hr}},Gh=ie.Schema,Un=Gh.str,dY=Gh.List,ld=Gh.lstr,ku=Gh.Aliased,DS=Gh.int,B0=Gh.coord,bDe={chem_comp:{formula:Un,formula_weight:Gh.float,id:Un,mon_nstd_parent_comp_id:dY(",",function(e){return e}),name:Un,one_letter_code:Un,three_letter_code:Un,type:ku(ld),pdbx_synonyms:dY(";",function(e){return e}),pdbx_type:Un,pdbx_ambiguous_flag:Un,pdbx_replaced_by:Un,pdbx_replaces:Un,pdbx_formal_charge:DS,pdbx_model_coordinates_details:Un,pdbx_model_coordinates_db_code:Un,pdbx_ideal_coordinates_details:Un,pdbx_ideal_coordinates_missing_flag:ku(ld),pdbx_model_coordinates_missing_flag:ku(ld),pdbx_initial_date:Un,pdbx_modified_date:Un,pdbx_release_status:ku(Un),pdbx_processing_site:ku(Un)},chem_comp_atom:{alt_atom_id:Un,atom_id:Un,charge:DS,model_Cartn_x:B0,model_Cartn_y:B0,model_Cartn_z:B0,comp_id:Un,type_symbol:Un,pdbx_align:DS,pdbx_ordinal:DS,pdbx_model_Cartn_x_ideal:B0,pdbx_model_Cartn_y_ideal:B0,pdbx_model_Cartn_z_ideal:B0,pdbx_stereo_config:ku(ld),pdbx_aromatic_flag:ku(ld),pdbx_leaving_atom_flag:ku(ld)},chem_comp_bond:{atom_id_1:Un,atom_id_2:Un,comp_id:Un,value_order:ku(ld),pdbx_ordinal:DS,pdbx_stereo_config:ku(ld),pdbx_aromatic_flag:ku(ld)},pdbx_chem_comp_descriptor:{comp_id:Un,descriptor:Un,type:ku(ld),program:Un,program_version:Un},pdbx_chem_comp_identifier:{comp_id:Un,identifier:Un,type:ku(Un),program:Un,program_version:Un}},ES=ie.Schema,ur=ES.str,_f=ES.lstr,Ns=ES.Aliased,Cc=ES.int,CDe={pdbx_reference_molecule:{prd_id:ur,formula_weight:ES.float,formula:ur,type:Ns(_f),type_evidence_code:ur,class:Ns(_f),class_evidence_code:ur,name:ur,represent_as:Ns(_f),chem_comp_id:ur,compound_details:ur,description:ur,representative_PDB_id_code:ur,release_status:Ns(_f),replaces:ur,replaced_by:ur},pdbx_reference_entity_list:{prd_id:ur,ref_entity_id:ur,type:Ns(_f),details:ur,component_id:Cc},pdbx_reference_entity_nonpoly:{prd_id:ur,ref_entity_id:ur,name:ur,chem_comp_id:ur},pdbx_reference_entity_link:{link_id:Cc,prd_id:ur,details:ur,ref_entity_id_1:ur,ref_entity_id_2:ur,entity_seq_num_1:Cc,entity_seq_num_2:Cc,comp_id_1:ur,comp_id_2:ur,atom_id_1:ur,atom_id_2:ur,value_order:Ns(_f),component_1:Cc,component_2:Cc,link_class:Ns(ur)},pdbx_reference_entity_poly_link:{link_id:Cc,prd_id:ur,ref_entity_id:ur,component_id:Cc,entity_seq_num_1:Cc,entity_seq_num_2:Cc,comp_id_1:ur,comp_id_2:ur,atom_id_1:ur,atom_id_2:ur,value_order:Ns(_f)},pdbx_reference_entity_poly:{prd_id:ur,ref_entity_id:ur,type:Ns(ur),db_code:ur,db_name:ur},pdbx_reference_entity_poly_seq:{prd_id:ur,ref_entity_id:ur,mon_id:ur,parent_mon_id:ur,num:Cc,observed:Ns(_f),hetero:Ns(_f)},pdbx_reference_entity_sequence:{prd_id:ur,ref_entity_id:ur,type:Ns(ur),NRP_flag:Ns(ur),one_letter_codes:ur},pdbx_reference_entity_src_nat:{prd_id:ur,ref_entity_id:ur,ordinal:Cc,organism_scientific:ur,taxid:ur,db_code:ur,db_name:ur},pdbx_prd_audit:{prd_id:ur,date:ur,processing_site:Ns(ur),action_type:Ns(ur)}},fY=ie.Schema,hi=fY.str,MDe={datablock:{id:hi,description:hi},dictionary:{title:hi,datablock_id:hi,version:hi},dictionary_history:{version:hi,update:hi,revision:hi},sub_category:{id:hi,description:hi},category_group_list:{id:hi,parent_id:hi,description:hi},item_type_list:{code:hi,primitive_code:hi,construct:hi,detail:hi},item_units_list:{code:hi,detail:hi},item_units_conversion:{from_code:hi,to_code:hi,operator:hi,factor:fY.float}},IS=ie.Schema,dd=IS.str,Xw=IS.int,wf=IS.float,Kw=IS.Aliased,nm=IS.Vector,pY=(Kw(dd),Kw(dd),Kw(dd),Kw(dd),nm(3),nm(3),{volume_data_3d_info:{name:dd,axis_order:nm(3,Xw),origin:nm(3),dimensions:nm(3),sample_rate:Xw,sample_count:nm(3,Xw),spacegroup_number:Xw,spacegroup_cell_size:nm(3),spacegroup_cell_angles:nm(3),mean_source:wf,mean_sampled:wf,sigma_source:wf,sigma_sampled:wf,min_source:wf,min_sampled:wf,max_source:wf,max_sampled:wf},volume_data_3d:{values:wf}}),Zw=ie.Schema,Xa=Zw.float,yF=Zw.int,Yn=Zw.str,ODe={cell:{angle_alpha:Xa,angle_beta:Xa,angle_gamma:Xa,formula_units_z:yF,length_a:Xa,length_b:Xa,length_c:Xa,volume:Xa},chemical:{melting_point:Xa,name_common:Yn,name_systematic:Yn},chemical_formula:{moiety:Yn,sum:Yn,weight:Xa},space_group:{crystal_system:Yn,it_number:yF,"name_h-m_full":Yn},space_group_symop:{operation_xyz:Yn},geom_bond:{atom_site_label_1:Yn,atom_site_label_2:Yn,distance:Xa,publ_flag:Yn,site_symmetry_1:Yn,site_symmetry_2:Yn,valence:Xa},audit:{block_doi:Yn},database_code:{cod:Yn,csd:Yn,depnum_ccdc_archive:Yn,depnum_ccdc_fiz:Yn,icsd:Yn,mdf:Yn,nbs:Yn},atom_site:{adp_type:Yn,calc_flag:Yn,disorder_assembly:Yn,disorder_group:Yn,fract_x:Xa,fract_y:Xa,fract_z:Xa,label:Yn,occupancy:Xa,refinement_flags:Yn,site_symmetry_multiplicity:yF,type_symbol:Yn,u_iso_or_equiv:Xa},atom_site_aniso:{label:Yn,u_11:Xa,u:(0,Zw.Matrix)(3,3),u_12:Xa,u_13:Xa,u_22:Xa,u_23:Xa,u_33:Xa},atom_type:{description:Yn,symbol:Yn},atom_type_scat:{dispersion_imag:Xa,dispersion_real:Xa,source:Yn}},FDe={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},bF=ie.Schema.int,NDe={volume_data_3d_info:pY.volume_data_3d_info,segmentation_data_table:{set_id:bF,segment_id:bF},segmentation_data_3d:{values:bF}},hl={parse:function(e){return"string"==typeof e?rY(e):uY(e)},parseText:rY,parseBinary:uY,toDatabaseCollection:function uDe(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=cd(e,o,r)}return n},toDatabase:cd,schema:{mmCIF:function(e){return cd(Br,e)},CCD:function(e){return cd(bDe,e)},BIRD:function(e){return cd(CDe,e)},dic:function(e){return cd(MDe,e)},cifCore:function(e){return cd(ODe,e,FDe)},densityServer:function(e){return cd(pY,e)},segmentation:function(e){return cd(NDe,e)}}},SF=512;function mY(e){var r=e.yExtent,n=e.zExtent;return{xBlocks:Math.ceil(e.xExtent/8),yBlocks:Math.ceil(r/8),zBlocks:Math.ceil(n/8)}}function UDe(e){return ue(this,void 0,void 0,function(){var t,r,n,a,i;return ce(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,SF)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||100===t.readInt16LE(36),i=n?function kDe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}(r):function LDe(e,t){var r=t?function(a){return e.readInt16LE(2*a)}:function(a){return e.readInt16BE(2*a)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}(t,a),[2,{header:i,littleEndian:a}]}})})}function VDe(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x;return ce(this,function(w){for(n||ml.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,c=mY(e),l=c.xBlocks,d=c.yBlocks,f=c.zBlocks,p=0,m=0;m<f;++m)for(h=0;h<d;++h)for(v=0;v<l;++v)for(g=0;g<8;++g)for(y=8*m+g,S=0;S<8;++S)for(C=8*h+S,_=0;_<8;++_){if(!((x=8*v+_)<o&&C<s&&y<u)){p+=8-_;break}r[(x*s+C)*u+y]=(t[p]-i)/a,++p}return[2]})})}function zDe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(l){switch(l.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return l.sent(),[4,UDe(e)];case 2:return n=l.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(SF,t-SF)];case 3:return o=l.sent().buffer,s=function GDe(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=mY(e),c=8*a.xBlocks*a.yBlocks*8*a.zBlocks*8;return{count:c,byteCount:1*c,valueCount:t*r*n}}(a).valueCount,u=new Float32Array(s),[4,VDe(a,o,u,i)];case 4:return l.sent(),[2,{header:a,values:u,name:e.name}]}})})}function jDe(e,t){return function HDe(e,t){var r=this;return Ve.create("Parse DSN6/BRIX",function(n){return ue(r,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=In).success,[4,zDe(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,In.error(o)];case 3:return[2]}})})})}(zw.fromBuffer(ml.fromUint8Array(e),t),e.length)}var WDe=new Set(Object.keys({char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8}));function CF(e){if(!WDe.has(e))throw new Error("unknown ply type '".concat(e,"'"));return e}function hY(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ie.Schema.int;case"float":case"double":case"float32":case"float64":return ie.Schema.float}}function $De(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],c=[],l=new Map,d=0,f=o;d<f;++d){var p=Xe.create(n.data,2*a);c.push(p)}for(d=0,f=a;d<f;++d)for(var m=0,h=o;m<h;++m)lt.skipWhitespace(n),lt.markStart(n),lt.eatValue(n),Xe.addUnchecked(c[m],n.tokenStart,n.tokenEnd);for(d=0,f=o;d<f;++d){var v=i[d],g=v.type,y=v.name,S=oF(c[d],hY(g));s.push(y),u.push(g),l.set(y,S)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(C){return l.get(C)}})}function JDe(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=Xe.create(n.data,2*a*3),s=new Uint32Array(a+1),u=0,c=0,l=a;c<l;++c){for(lt.skipWhitespace(n),lt.markStart(n);10!==lt.skipWhitespace(n);)++u,lt.markStart(n),lt.eatValue(n),Xe.addToken(o,n);s[c+1]=u}var d={entries:[],count:0},f=oF(o,hY(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(p){for(var m=s[p]+1,h=f.value(m-1),v=m,g=m+h;v<g;++v)d.entries[v-m]=f.value(v);return d.count=h,d}})}function eEe(e,t){return ue(this,void 0,void 0,function(){var r,n,i,o,s;return ce(this,function(u){return r=function XDe(e,t){return{data:e,tokenizer:lt(e),runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}(e,t),t.update({message:"Parsing...",current:0,max:e.length}),function ZDe(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;!function KDe(e){var t=e.data.indexOf("end_header",e.position);if(-1===t)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,lt.eatLine(e)}(t);var i,o,s,a=lt.getTokenString(t).split(/\r?\n/);if("ply"!==a[0])throw new Error("data not starting with 'ply'");if("format ascii 1.0"!==a[1])throw new Error("format not 'ascii 1.0'");function u(){if(void 0!==i&&void 0!==o&&void 0!==s){for(var p=!1,m=0,h=s.length;m<h;++m)if("list"===s[m].kind){p=!0;break}n.push(p?{kind:"list",name:i,count:o,property:s[0]}:{kind:"table",name:i,count:o,properties:s})}}for(var c=2,l=a.length;c<l;++c){var d=a[c],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],i=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(void 0===s)throw new Error("properties outside of element");s.push("list"===f[1]?{kind:"list",countType:CF(f[2]),dataType:CF(f[3]),name:f[4]}:{kind:"column",type:CF(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}(r),function QDe(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];"table"===a.kind?$De(e,a):"list"===a.kind&&JDe(e,a)}}(r),n=r.elements,i=r.comments,o=r.elementSpecs.map(function(c){return c.name}),s=function YDe(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}(n,o,i),[2,In.success(s)]})})}function tEe(e){var t=this;return Ve.create("Parse PLY",function(r){return ue(t,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,eEe(e,r)];case 1:return[2,n.sent()]}})})})}var Qw=lt.readLine,vY=lt.skipWhitespace,gY=lt.eatValue,rEe=lt.eatLine,xF=lt.markStart,$w=/\s+/,nEe=/(^\*|REMARK)*/;function iEe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:return n=Xe.create((r=e.tokenizer).data,2*t),a=Xe.create(r.data,2*t),i=Xe.create(r.data,2*t),o=Xe.create(r.data,2*t),s=Xe.create(r.data,2*t),u=Xe.create(r.data,2*t),c=Xe.create(r.data,2*t),l=Xe.create(r.data,2*t),d=r.position,f=Qw(r).trim(),r.position=d,p=7===f.split($w).length,m=p?6:8,h=r.length,v=0,[4,vf(e.runtimeCtx,1e5,void 0,function(y){for(var S=Math.min(t-v,y),C=0;C<S;++C){for(var _=0;_<m;++_)if(vY(r),xF(r),gY(r),p)switch(_){case 0:Xe.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Xe.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:Xe.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:Xe.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:Xe.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 5:Xe.addUnchecked(l,r.tokenStart,r.tokenEnd)}else switch(_){case 0:Xe.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Xe.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:Xe.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:Xe.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:Xe.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:Xe.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:Xe.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 7:Xe.addUnchecked(l,r.tokenStart,r.tokenEnd)}rEe(r),xF(r)}return v+=S,S},function(y){return y.update({message:"Parsing...",current:r.position,max:h})})];case 1:return g.sent(),[2,{count:t,atomId:er(n)(ie.Schema.int),segmentName:p?er(i)(ie.Schema.str):er(a)(ie.Schema.str),residueId:er(i)(ie.Schema.int),residueName:p?er(i)(ie.Schema.str):er(o)(ie.Schema.str),atomName:er(s)(ie.Schema.str),atomType:er(u)(ie.Schema.str),charge:er(c)(ie.Schema.float),mass:er(l)(ie.Schema.float)}]}})})}function oEe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o;return ce(this,function(s){switch(s.label){case 0:return n=Xe.create((r=e.tokenizer).data,2*t),a=Xe.create(r.data,2*t),i=r.length,o=0,[4,vf(e.runtimeCtx,10,void 0,function(u){for(var c=Math.min(t-o,u),l=0;l<c;++l)for(var d=0;d<2;++d)switch(vY(r),xF(r),gY(r),d){case 0:Xe.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Xe.addUnchecked(a,r.tokenStart,r.tokenEnd)}return o+=c,c},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:er(n)(ie.Schema.int),atomIdB:er(a)(ie.Schema.int)}]}})})}function uEe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d;return ce(this,function(p){switch(p.label){case 0:r=lt(e),n=function aEe(e,t){return{tokenizer:e,runtimeCtx:t}}(r,t),a=void 0,i=void 0,o=void 0,s=Qw(n.tokenizer).trim(),p.label=1;case 1:return r.tokenEnd<r.length?(u=Qw(n.tokenizer).trim()).includes("!NTITLE")?(c=parseInt(u.split($w)[0]),a=function sEe(e,t){for(var r=[],n=0;n<t;++n){var a=Qw(e.tokenizer);r.push(a.replace(nEe,"").trim())}return r}(n,c),[3,7]):[3,2]:[3,8];case 2:return u.includes("!NATOM")?(l=parseInt(u.split($w)[0]),[4,iEe(n,l)]):[3,4];case 3:return i=p.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split($w)[0]),[4,oEe(n,d)]):[3,6];case 5:return o=p.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),p.label=7;case 7:return[3,1];case 8:return void 0===a&&(a=[]),void 0===i?[2,In.error("no atoms data")]:void 0===o?[2,In.error("no bonds data")]:[2,In.success({id:s,title:a,atoms:i,bonds:o})]}})})}function cEe(e){var t=this;return Ve.create("Parse PSF",function(r){return ue(t,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,uEe(e,r)];case 1:return[2,n.sent()]}})})})}var yY=.529177210859;function fEe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=1e6,i=new Float64Array(n),o=0;return vf(e,a,i,function(s,u){for(var c=Math.min(n,o+s),l=o;l<c;l++)lt.skipWhitespace(t),t.tokenStart=t.position,lt.eatValue(t),u[l]=mf(t.data,t.tokenStart,t.tokenEnd);return o=c,c===n?0:a},function(s,u,c){return s.update({current:Math.min(c,n),max:n})})}function pEe(e,t){var r=this;return Ve.create("Parse Cube",function(n){return ue(r,void 0,void 0,function(){var a,i,o,s,u;return ce(this,function(c){switch(c.label){case 0:return[4,n.update("Reading header...")];case 1:return c.sent(),a=lt(e),i=function lEe(e){var t=lt.readLines(e,6),r=function(E,I){var M=+t[E].trim().split(/\s+/g)[I];return Number.isNaN(M)?0:M},n=function(E){var I=r(E+2,0),M=yY;return[Math.abs(I),b.create(r(E+2,1)*M,r(E+2,2)*M,r(E+2,3)*M),I]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],c=o[2],l=n(1),d=l[0],f=l[1],p=n(2),m=p[0],h=p[1],v=n(3),g=v[0],y=v[1],S=function dEe(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var c=lt.readLine(e).trim().split(/\s+/g);n[u]=+c[0],a[u]=+c[1],i[u]=+c[2]*r,o[u]=+c[3]*r,s[u]=+c[4]*r}return{count:t,number:ie.ofArray({array:n,schema:ie.Schema.int}),nuclearCharge:ie.ofArray({array:a,schema:ie.Schema.float}),x:ie.ofArray({array:i,schema:ie.Schema.float}),y:ie.ofArray({array:o,schema:ie.Schema.float}),z:ie.ofArray({array:s,schema:ie.Schema.float})}}(e,s,yY),C=[];if(c>=0){var _=r(2,4);0===_&&(_=1);for(var x=0;x<_;x++)C.push(x)}else for(var D=lt.readLine(e).trim().split(/\s+/g),w=(x=0,+D[0]);x<w;x++)C.push(+D[x+1]);return{header:{orbitals:c<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:b.create(d,m,g),basisX:f,basisY:h,basisZ:y,dataSetIds:C},atoms:S}}(a),s=i.atoms,[4,fEe(n,a,o=i.header)];case 2:return u=c.sent(),[2,In.success({header:o,atoms:s,values:u,name:t})]}})})})}function bY(e){for(var t={h:b()},r=0,n=0,a=/\s+/g;;){var i=lt.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=b.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=b.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),0===n?t.h[0]=parseFloat(o[1]):1===n?t.h[1]=parseFloat(o[2]):2===n&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function mEe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=1e6,i=new Float64Array(n),o=0;return vf(e,a,i,function(s,u){for(var c=Math.min(n,o+s),l=o;l<c;l++)lt.skipWhitespace(t),t.tokenStart=t.position,lt.eatValue(t),u[l]=mf(t.data,t.tokenStart,t.tokenEnd);return o=c,c===n?0:a},function(s,u,c){return s.update({current:Math.min(c,n),max:n})})}function gEe(e,t){return Ve.create("Parse DX",function(r){return"string"==typeof e?function hEe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i;return ce(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=lt(t),a=bY(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,mEe(e,n,a)];case 3:return i=o.sent(),[2,In.success({header:a,values:i,name:r})]}})})}(r,e,t):function vEe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=TO(t,0,1e3),a=lt(n),i=bY(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],c=new DataView(t.buffer,t.byteOffset+s),l=new Float64Array(u),d=0;d<u;d++)l[d]=c.getFloat64(8*d,!0);return[2,In.success({header:o,values:l,name:r})]}})})}(r,e,t)})}var vr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},SY=(function(){var e=new Map;Object.keys(vr).forEach(function(t){e.set(vr[t],t)})}(),Object.keys({NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""})),Jw=lt.readLine,CY=lt.markLine,bEe=lt.trim;function am(e,t,r,n){for(var a=e.tokenizer,i=Xe.create(a.data,2*t),o=0;a.tokenEnd<a.length&&"%"!==a.data[a.position];){a.tokenStart=a.position;for(var s=Math.min(o+r,t);o<s;++o){var c=a.position;bEe(a,a.position,a.position+n),Xe.addUnchecked(i,a.tokenStart,a.tokenEnd),a.position=c+n}CY(a)}return i}function _Ee(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,c;return ce(this,function(l){switch(l.label){case 0:r=lt(e),n=function SEe(e,t){return{tokenizer:e,runtimeCtx:t}}(r,t),a=Object.create(null),i=0,l.label=1;case 1:return r.tokenEnd<r.length?r.position-i>1e5&&t.shouldUpdate?(i=r.position,[4,t.update({current:r.position,max:r.length})]):[3,3]:[3,4];case 2:l.sent(),l.label=3;case 3:if((o=Jw(n.tokenizer).trim()).startsWith("%VERSION"))a.version=o.substring(8).trim();else if(o.startsWith("%FLAG")){if(s=o.substring(5).trim(),!Jw(n.tokenizer).trim().startsWith("%FORMAT"))throw new Error("expected %FORMAT");if("TITLE"===s)a.title=function CEe(e){for(var t=e.tokenizer,r=[];t.tokenEnd<t.length&&"%"!==t.data[t.position];){var n=Jw(t).trim();n&&r.push(n)}return r}(n);else if("POINTERS"===s)a.pointers=function xEe(e){var t=e.tokenizer,r=Object.create(null);SY.forEach(function(s){r[s]=0});for(var n=0;t.tokenEnd<t.length&&"%"!==t.data[t.position];)for(var a=Jw(t),i=Math.min(n+10,32),o=0;n<i;++o,++n)r[SY[n]]=parseInt(a.substring(8*o,8*o+8).trim());return r}(n);else if("ATOM_NAME"===s)c=am(n,a.pointers.NATOM,20,4),a.atomName=er(c)(ie.Schema.str);else if("CHARGE"===s)c=am(n,a.pointers.NATOM,5,16),a.charge=er(c)(ie.Schema.float);else if("MASS"===s)c=am(n,a.pointers.NATOM,5,16),a.mass=er(c)(ie.Schema.float);else if("RESIDUE_LABEL"===s)c=am(n,a.pointers.NRES,20,4),a.residueLabel=er(c)(ie.Schema.str);else if("RESIDUE_POINTER"===s)c=am(n,a.pointers.NRES,10,8),a.residuePointer=er(c)(ie.Schema.int);else if("BONDS_INC_HYDROGEN"===s)c=am(n,3*a.pointers.NBONH,10,8),a.bondsIncHydrogen=er(c)(ie.Schema.int);else if("BONDS_WITHOUT_HYDROGEN"===s)c=am(n,3*a.pointers.NBONA,10,8),a.bondsWithoutHydrogen=er(c)(ie.Schema.int);else if("RADII"===s)c=am(n,a.pointers.NATOM,5,16),a.radii=er(c)(ie.Schema.float);else for(;r.tokenEnd<r.length&&"%"!==r.data[r.position];)CY(r)}return[3,1];case 4:return[2,In.success(a)]}})})}function wEe(e){var t=this;return Ve.create("Parse PRMTOP",function(r){return ue(t,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,_Ee(e,r)];case 1:return[2,n.sent()]}})})})}var AEe={nr:ie.Schema.Int(),type:ie.Schema.Str(),resnr:ie.Schema.Int(),residu:ie.Schema.Str(),atom:ie.Schema.Str(),cgnr:ie.Schema.Int(),charge:ie.Schema.Float(),mass:ie.Schema.Float()},TEe={ai:ie.Schema.Int(),aj:ie.Schema.Int()},DEe={compound:ie.Schema.Str(),molCount:ie.Schema.Int()},_F=lt.readLine,im=lt.markLine,om=lt.skipWhitespace,eA=lt.markStart,wF=lt.eatValue,EEe=lt.eatLine,PEe=/\[ (.+) \]/,MEe=/\s+/;function kEe(e,t){return ue(this,void 0,void 0,function(){function r(){u&&s.atoms&&(i.compounds[u]=s,s={},u="")}var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:n=lt(e),a=function IEe(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t),o=0,(i=Object.create(null)).compounds={},s={},u="",f.label=1;case 1:return n.tokenEnd<n.length?n.position-o>1e5&&t.shouldUpdate?(o=n.position,[4,t.update({current:n.position,max:n.length})]):[3,3]:[3,4];case 2:f.sent(),f.label=3;case 3:if(!(c=_F(a.tokenizer).trim())||"*"===c[0]||";"===c[0])return[3,1];if(c.startsWith("#include"))throw new Error("#include statements not allowed");if(c.startsWith("[")){if(null===(l=c.match(PEe)))throw new Error("expected field name");if("moleculetype"===(d=l[1]))r(),u=function REe(e){for(var t=e.tokenizer,r=void 0;t.tokenEnd<t.length;){om(t);var n=t.data[t.position];if("["===n)break;if(";"!==n&&"*"!==n){if(void 0!==r)throw new Error("more than one molName");r=_F(t).split(MEe)[0]}else im(t)}if(void 0===r)throw new Error("missing molName");return r}(a);else if("atoms"===d)s.atoms=function OEe(e){for(var t=e.tokenizer,r=Xe.create(t.data,64),n=Xe.create(t.data,64),a=Xe.create(t.data,64),i=Xe.create(t.data,64),o=Xe.create(t.data,64),s=Xe.create(t.data,64),u=Xe.create(t.data,64),c=Xe.create(t.data,64);t.tokenEnd<t.length;){om(t);var l=t.data[t.position];if("["===l)break;if(";"!==l&&"*"!==l){for(var d=0;d<8;++d)switch(om(t),eA(t),wF(t),d){case 0:Xe.add(r,t.tokenStart,t.tokenEnd);break;case 1:Xe.add(n,t.tokenStart,t.tokenEnd);break;case 2:Xe.add(a,t.tokenStart,t.tokenEnd);break;case 3:Xe.add(i,t.tokenStart,t.tokenEnd);break;case 4:Xe.add(o,t.tokenStart,t.tokenEnd);break;case 5:Xe.add(s,t.tokenStart,t.tokenEnd);break;case 6:Xe.add(u,t.tokenStart,t.tokenEnd);break;case 7:Xe.add(c,t.tokenStart,t.tokenEnd)}im(t)}else im(t)}return Xr.ofColumns(AEe,{nr:er(r)(ie.Schema.int),type:er(n)(ie.Schema.str),resnr:er(a)(ie.Schema.int),residu:er(i)(ie.Schema.str),atom:er(o)(ie.Schema.str),cgnr:er(s)(ie.Schema.int),charge:er(u)(ie.Schema.float),mass:er(c)(ie.Schema.float)})}(a);else if("bonds"===d)s.bonds=function FEe(e){for(var t=e.tokenizer,r=Xe.create(t.data,64),n=Xe.create(t.data,64);t.tokenEnd<t.length;){om(t);var a=t.data[t.position];if("["===a)break;if(";"!==a&&"*"!==a){for(var i=0;i<2;++i)switch(om(t),eA(t),wF(t),i){case 0:Xe.add(r,t.tokenStart,t.tokenEnd);break;case 1:Xe.add(n,t.tokenStart,t.tokenEnd)}im(t)}else im(t)}return Xr.ofColumns(TEe,{ai:er(r)(ie.Schema.int),aj:er(n)(ie.Schema.int)})}(a);else if("system"===d)i.system=function BEe(e){for(var t=e.tokenizer,r=void 0;t.tokenEnd<t.length;){om(t);var n=t.data[t.position];if("["===n)break;if(";"!==n&&"*"!==n){if(void 0!==r)throw new Error("more than one system");r=_F(t).trim()}else im(t)}if(void 0===r)throw new Error("missing system");return r}(a);else if("molecules"===d)r(),i.molecules=function NEe(e){for(var t=e.tokenizer,r=Xe.create(t.data,64),n=Xe.create(t.data,64);t.tokenEnd<t.length&&(om(t),!(t.position>=t.length));){var a=t.data[t.position];if("["===a)break;if(";"!==a&&"*"!==a){for(var i=0;i<2;++i)switch(om(t),eA(t),wF(t),i){case 0:Xe.add(r,t.tokenStart,t.tokenEnd);break;case 1:Xe.add(n,t.tokenStart,t.tokenEnd)}EEe(t),eA(t)}else im(t)}return Xr.ofColumns(DEe,{compound:er(r)(ie.Schema.str),molCount:er(n)(ie.Schema.int)})}(a);else for(;n.tokenEnd<n.length&&"["!==n.data[n.position];)im(n)}return[3,1];case 4:return[2,In.success(i)]}})})}function LEe(e){var t=this;return Ve.create("Parse TOP",function(r){return ue(t,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,kEe(e,r)];case 1:return[2,n.sent()]}})})})}var vi,xY=Bt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ve.Root],to:[ve.Data.String,ve.Data.Binary],params:{url:T.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:T.Optional(T.Text("")),isBinary:T.Optional(T.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Ve.create("Download",function(i){return ue(r,void 0,void 0,function(){var o,s;return ce(this,function(u){switch(u.label){case 0:return o=dn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new ve.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ve.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r=e.cache;null===(t=r?.asset)||void 0===t||t.dispose()},update:function(e){var t=e.oldParams,r=e.newParams;return t.url!==r.url||t.isBinary!==r.isBinary?rt.UpdateResult.Recreate:t.label!==r.label?(e.b.label=r.label||("string"==typeof r.url?r.url:r.url.url),rt.UpdateResult.Updated):rt.UpdateResult.Unchanged}}),_Y=Bt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ve.Root,to:ve.Data.Blob,params:{sources:T.ObjectList({id:T.Text("",{label:"Unique ID"}),url:T.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:T.Optional(T.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:T.Optional(T.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return"".concat(e.id,": ").concat(e.url)}),maxConcurrency:T.Optional(T.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Ve.create("Download Blob",function(i){return ue(r,void 0,void 0,function(){var o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return o=[],[4,lAe(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],c=0;c<s.length;c++)d=n.sources[c],"error"===(l=s[c]).kind?t.log.warn("Download ".concat(l.id," (").concat(d.url,") failed: ").concat(l.error)):(u.push(l.result),o.push(d.isBinary?{id:l.id,kind:"binary",data:l.result.data}:{id:l.id,kind:"string",data:l.result.data}));return a.assets=u,[2,new ve.Data.Blob(o,{label:"Data Blob",description:"".concat(o.length," ").concat(1===o.length?"entry":"entries")})]}})})})},dispose:function(e,t){var r=e.cache,n=r?.assets;if(n)for(var a=0,i=n;a<i.length;a++)i[a].dispose()}}),wY=Bt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ve.Root],to:[ve.Data.String,ve.Data.Binary],params:{data:T.Value("",{isHidden:!0}),label:T.Optional(T.Text(""))}})({apply:function(e){var t=this,r=e.params;return Ve.create("Raw Data",function(){return ue(t,void 0,void 0,function(){return ce(this,function(n){return"string"==typeof r.data?[2,new ve.Data.String(r.data,{label:r.label?r.label:"String"})]:Array.isArray(r.data)||r.data instanceof ArrayBuffer?[2,new ve.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})]:r.data instanceof Uint8Array?[2,new ve.Data.Binary(r.data,{label:r.label?r.label:"Binary"})]:(Sn(),[2])})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?rt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if("string"==typeof e.data||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}if(e.data instanceof Uint8Array){for(r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),AY=Bt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ve.Root,to:[ve.Data.String,ve.Data.Binary],params:{file:T.File(),label:T.Optional(T.Text("")),isBinary:T.Optional(T.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Ve.create("Open File",function(i){return ue(r,void 0,void 0,function(){var o;return ce(this,function(u){switch(u.label){case 0:return null===n.file?(t.log.error("No file(s) selected"),[2,Jn.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,[2,n.isBinary?new ve.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ve.Data.String(o.data,{label:n.label?n.label:n.file.name})]}})})})},dispose:function(e){var t,r=e.cache;null===(t=r?.asset)||void 0===t||t.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams;return r.label!==n.label?(e.b.label=n.label||(null===(t=r.file)||void 0===t?void 0:t.name)||"",rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),UEe=Bt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ve.Data.Blob,to:ve.Format.Blob,params:{formats:T.ObjectList({id:T.Text("",{label:"Unique ID"}),format:T.Select("cif",[["cif","cif"]])},function(e){return"".concat(e.id,": ").concat(e.format)})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Parse Blob",function(i){return ue(r,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)o.set((c=u[s]).id,c.format);l=[],d=0,f=n.data,h.label=1;case 1:return d<f.length?o.has((p=f[d]).id)?[4,("string"===p.kind?hl.parse(p.data):hl.parseBinary(p.data)).runInContext(i)]:[3,3]:[3,4];case 2:if((m=h.sent()).isError)throw new Error("".concat(p.id,": ").concat(m.message));l.push({id:p.id,kind:"cif",data:m.result}),h.label=3;case 3:return d++,[3,1];case 4:return[2,new ve.Format.Blob(l,{label:"Format Blob",description:"".concat(l.length," ").concat(1===l.length?"entry":"entries")})]}})})})}}),VEe=Bt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ve.Data.String,ve.Data.Binary],to:ve.Format.Cif})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse CIF",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,("string"==typeof r.data?hl.parse(r.data):hl.parseBinary(r.data)).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return 0===a.result.blocks.length?[2,Jn.Null]:[2,new ve.Format.Cif(a.result)]}})})})}}),GEe=Bt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ve.Data.String,to:ve.Format.Cube})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse Cube",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,pEe(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Cube(a.result)]}})})})}}),zEe=Bt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ve.Data.String],to:ve.Format.Psf})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse PSF",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,cEe(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Psf(a.result)]}})})})}}),HEe=Bt.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[ve.Data.String],to:ve.Format.Prmtop})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse PRMTOP",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,wEe(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Prmtop(a.result)]}})})})}}),jEe=Bt.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[ve.Data.String],to:ve.Format.Top})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse TOP",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,LEe(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Top(a.result)]}})})})}}),qEe=Bt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ve.Data.String],to:ve.Format.Ply})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse PLY",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,tEe(r.data).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),WEe=Bt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ve.Data.Binary],to:ve.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse CCP4/MRC/MAP",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,uTe(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Ccp4(a.result)]}})})})}}),YEe=Bt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ve.Data.Binary],to:ve.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DSN6/BRIX",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,jDe(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Dsn6(a.result)]}})})})}}),XEe=Bt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ve.Data.Binary,ve.Data.String],to:ve.Format.Dx})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DX",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,gEe(r.data,r.label).runInContext(n)];case 1:if((a=i.sent()).isError)throw new Error(a.message);return[2,new ve.Format.Dx(a.result)]}})})})}}),KEe=Bt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ve.Root,to:ve.Data.String,params:{data:T.Value(""),label:T.Optional(T.Text(""))}})({apply:function(e){var t=e.params;return new ve.Data.String(t.data,{label:t.label||""})},update:function(e){var t=e.oldParams,r=e.newParams;return t.data!==r.data?rt.UpdateResult.Recreate:t.label!==r.label?(e.b.label=r.label||"",rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),ZEe=Bt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ve.Root,to:ve.Format.Json,params:{data:T.Value({}),label:T.Optional(T.Text(""))}})({apply:function(e){var t=e.params;return new ve.Format.Json(t.data,{label:t.label||""})},update:function(e){var t=e.oldParams,r=e.newParams;return t.data!==r.data?rt.UpdateResult.Recreate:t.label!==r.label?(e.b.label=r.label||"",rt.UpdateResult.Updated):rt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),QEe=Bt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ve.Data.String],to:ve.Format.Json})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse JSON",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new ve.Format.Json(a)]}})})})}}),$Ee=Bt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ve.Root,to:ve.Volume.Lazy,params:{url:T.Url(""),isBinary:T.Boolean(!1),format:T.Text("ccp4"),entryId:T.Value("",{isHidden:!0}),isovalues:T.ObjectList({type:T.Text("relative"),value:T.Numeric(0),color:T.Color(vr.black),alpha:T.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:T.Numeric(0)},function(e){return"".concat(e.type," ").concat(e.value)})}})({apply:function(e){var t=this,n=e.params;return Ve.create("Lazy Volume",function(a){return ue(t,void 0,void 0,function(){var i;return ce(this,function(o){return i=Array.isArray(n.entryId)?n.entryId.join(", "):n.entryId,[2,new ve.Volume.Lazy(n,{label:"".concat(i||n.url),description:"Lazy Volume"})]})})})}}),JEe=Bt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ve.Group,params:{label:T.Text("Group"),description:T.Optional(T.Text(""))}})({apply:function(e){return new ve.Group({},e.params)},update:function(e){var r=e.newParams,n=e.b;return K_(e.oldParams,r)?rt.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,rt.UpdateResult.Updated)}});function tIe(e){var t=this;return Ve.create("Parse DCD",function(r){return ue(t,void 0,void 0,function(){var n;return ce(this,function(a){try{return n=function eIe(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(84!==i[0])for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(84!==i[0])throw new Error("dcd bad format, header block start");if("CORD"!==String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7)))throw new Error("dcd bad format, format string");var l=!1,d=!1,f=!1;if(0!==i[22]&&(l=!0,0!==i[12]&&(d=!0),1===i[13]&&(f=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],r.DELTA=l?t.getFloat32(44,o):t.getFloat64(44,o),84!==i[22])throw new Error("dcd bad format, header block end");var p=t.getInt32(a=a+84+8,o),m=a+1;if((p-4)%80!=0)throw new Error("dcd bad format, title block start");if(r.TITLE=function kTe(e){if(e.length>dF){for(var t=[],r=0;r<e.length;r+=dF)t.push(String.fromCharCode.apply(null,e.subarray(r,r+dF)));return t.join("")}return String.fromCharCode.apply(null,e)}(e.subarray(m,p)),t.getInt32(m+p+4-1,o)!==p)throw new Error("dcd bad format, title block end");if(4!==t.getInt32(a=a+p+8,o))throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),4!==t.getInt32(a+8,o))throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");var h=r.NATOM,v=4*h;for(u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=h,d&&(g.cell=[t.getFloat64(a+=4,o),t.getFloat64(a+1,o),t.getFloat64(a+16,o),t.getFloat64(a+24,o),t.getFloat64(a+32,o),t.getFloat64(a+40,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==v)throw new Error("dcd bad format, coord block start: ".concat(u,", ").concat(y));a+=4;var S=new Float32Array(e.buffer,a,h);if(0===y?g.x=S:1===y?g.y=S:g.z=S,t.getInt32(a+=v,o)!==v)throw new Error("dcd bad format, coord block end: ".concat(u,", ").concat(y));a+=4}f&&(a+=4+t.getInt32(a,o)+4),n.push(g)}return{header:r,frames:n}}(e),[2,In.success(n)]}catch(i){return[2,In.error(i)]}return[2]})})})}function uIe(e){return ue(this,void 0,void 0,function(){var t,n,a,i,o,u,c,l,d,f;return ce(this,function(m){switch(m.label){case 0:return[4,lt.readLinesAsync(t=e.tokenizer,e.numberOfAtoms,e.runtimeCtx,1e5)];case 1:return n=m.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),e.header.hasVelocities=o=6===i.length,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,c=20+3*(u=e.header.precision.position+5),l=e.header.precision.velocity+4,d=function rIe(e){return function(t,r,n){return function nIe(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u="str"===s?function(c){var l=i[2*c]+t,d=i[2*c+1];if(l>=d)return"";var f=l+r;return f>d&&(f=d),function pTe(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(9===i||32===i)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(9===i||32===i)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}(a,l,f)}:"int"===s?function(c){var l=i[2*c]+t;return l>i[2*c+1]?0:Fh(a,l,l+r)}:function(c){var l=i[2*c]+t;return l>i[2*c+1]?0:function K_e(e,t,r){for(;t<r&&32===e.charCodeAt(t);)t++;return mf(e,t,r)}(a,l,l+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(c){return 0},toArray:function(c){return _o(o,u,c)},areValuesEqual:function(c,l){return u(c)===u(l)}}}(e,t,r,n)}}(n),f=ie.Undefined(e.numberOfAtoms,ie.Schema.float),[2,{count:e.numberOfAtoms,residueNumber:d(0,5,ie.Schema.int),residueName:d(5,5,ie.Schema.str),atomName:d(10,5,ie.Schema.str),atomNumber:d(15,5,ie.Schema.int),x:d(20,u,ie.Schema.float),y:d(20+u,u,ie.Schema.float),z:d(20+2*u,u,ie.Schema.float),vx:o?d(c,l,ie.Schema.float):f,vy:o?d(c+l,l,ie.Schema.float):f,vz:o?d(c+2*l,l,ie.Schema.float):f}]}})})}function lIe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i;return ce(this,function(s){switch(s.label){case 0:return r=lt(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=function iIe(e,t){return{tokenizer:e,header:{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]},numberOfAtoms:0,runtimeCtx:t}}(r,t),function oIe(e){var t=e.tokenizer,r=e.header,n=lt.readLine(t);0===n.trim().length&&(n=lt.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&","===r.title[r.title.length-1]&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}(a),function sIe(e){var t=e.tokenizer;lt.markLine(t);var r=lt.getTokenString(t);e.numberOfAtoms=parseInt(r)}(a),[4,uIe(a)]):[3,4];case 3:return i=s.sent(),function cIe(e){var r=lt.readLine(e.tokenizer).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return[2,In.success({structures:n})]}})})}function dIe(e){var t=this;return Ve.create("Parse GRO",function(r){return ue(t,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,lIe(e,r)];case 1:return[2,n.sent()]}})})})}function fIe(e,t,r){var n=this;return void 0===r&&(r=!1),Ve.create("Parse PDB",function(a){return ue(n,void 0,void 0,function(){var i,o,s;return ce(this,function(u){switch(u.label){case 0:return o=(i=In).success,s={},[4,lt.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function sm(e){return{kind:"table-legend",table:e}}!function(e){e.Zero=0;var v,g,t=(v=new ArrayBuffer(8),g=new ArrayBuffer(8),{_int32:new Int32Array(v),_float64:new Float64Array(v),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;e.is=function o(v){return"number"==typeof v},e.create=function s(v,g){return r[0]=v,r[1]=g,n[0]},e.diff=function u(v){return n[0]=v,r[1]-r[0]},e.fst=function c(v){return n[0]=v,r[0]},e.snd=function l(v){return n[0]=v,r[1]},e.areEqual=function d(v,g){return n[0]=v,i[0]=g,r[0]===a[0]&&r[1]===a[1]},e.compare=function f(v,g){n[0]=v,i[0]=g;var y=r[0]-a[0];return 0!==y?y:r[1]-a[1]},e.compareInArray=function p(v,g,y){n[0]=v[g],i[0]=v[y];var S=r[0]-a[0];return 0!==S?S:r[1]-a[1]},e.hashCode=function m(v){return n[0]=v,Oh(r[0],r[1])},e.toString=function h(v){return n[0]=v,"(".concat(r[0],", ").concat(r[1],")")}}(vi||(vi={}));var TY=vi.Zero;function DY(e,t){return vi.create(e,t<e?e:t+1)}function AF(e,t){return vi.create(e,t<=e?e:t)}function mIe(e){return vi.create(0,e<0?0:e)}var hIe=vi.is,Af=vi.fst,um=vi.snd,tA=vi.fst;function rA(e){return vi.snd(e)-1}var zh=vi.diff,vIe=vi.hashCode,gIe=vi.toString;function yIe(e,t){return vi.fst(e)<=t&&t<vi.snd(e)}function bIe(e,t){var r=Af(e);return t>=r&&t<um(e)?t-r:-1}function SIe(e,t){return vi.fst(e)+t}var _e,CIe=vi.areEqual;function EY(e,t){var r=zh(e),n=zh(t);return 0===r&&0===n||r>0&&n>0&&rA(e)>=tA(t)&&tA(e)<=rA(t)}function xIe(e,t){return zh(e)?!zh(t)||Af(e)<=Af(t)&&um(e)>=um(t):0===zh(t)}function TF(e,t){var r=Af(e);if(t<=r)return 0;var n=um(e);return t>=n?n-r:t-r}function _Ie(e,t,r){var n=Af(r),a=Af(e);if(t<=n+a)return n;var i=um(r);return t>=i+a?i:t-a}function IY(e,t,r){return AF(TF(e,t),TF(e,r+1))}function wIe(e,t){return EY(e,t)?AF(Math.max(Af(e),Af(t)),Math.min(um(e),um(t))):TY}function AIe(e,t){return zh(IY(e,tA(t),rA(t)))}!function(e){e.Empty=TY,e.ofSingleton=function(t){return DY(t,t)},e.ofRange=DY,e.ofBounds=AF,e.ofLength=mIe,e.is=hIe,e.has=yIe,e.indexOf=bIe,e.getAt=SIe,e.start=Af,e.end=um,e.min=tA,e.max=rA,e.size=zh,e.hashCode=vIe,e.toString=gIe,e.areEqual=CIe,e.areIntersecting=EY,e.isSubInterval=xIe,e.findPredecessorIndex=TF,e.findPredecessorIndexInInterval=_Ie,e.findRange=IY,e.intersectionSize=AIe,e.intersect=wIe}(_e||(_e={}));var PS=[];function TIe(e){return[e]}function DIe(e){return e}function EIe(e){return bc(e),e}function PY(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function IIe(e){return e&&(Array.isArray(e)||!!e.buffer)}function MY(e){return e[e.length-1]-e[0]+1===e.length}function DF(e){return e[0]}function EF(e){return e[e.length-1]+1}function PIe(e){return e[0]}function MIe(e){return e[e.length-1]}function RY(e){return e.length}function RIe(e){var t=e.length;return t?t>2?function Y_e(e,t,r,n){var a=23;return a=31*(a=31*(a=31*(a=31*a+e|0)+t|0)+r|0)+n|0,(a=(3735928559^(a^=a>>4))+(a<<5))^a>>11}(t,e[0],e[t-1],e[t>>1]):function W_e(e,t,r){var n=23;return n=31*(n=31*(n=31*n+e|0)+t|0)+r|0,(n=(3735928559^(n^=n>>4))+(n<<5))^n>>11}(t,e[0],e[t-1]):0}function OIe(e){var t=e.length;return t>5?"[".concat(e[0],", ").concat(e[1],", ..., ").concat(e[t-1],"], length ").concat(t):"[".concat(e.join(", "),"]")}function OY(e,t){var r=e.length;return 0===r?-1:e[0]<=t&&t<=e[r-1]?NY(e,t,0,r):-1}function FIe(e,t,r){return FY(e,t,_e.start(r),_e.end(r))}function FY(e,t,r,n){return 0===e.length||n<=r?-1:e[r]<=t&&t<=e[n-1]?NY(e,t,r,n):-1}function BIe(e,t){return OY(e,t)>=0}function BY(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(MY(e))return!0;r--;for(var n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Hh(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:kY(e,t,0,r)}function NIe(e,t,r){var n=_e.start(r),a=_e.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?function LIe(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}(e,t,n+1,a):kY(e,t,n,a)}function kIe(e,t,r){return _e.ofBounds(Hh(e,t),Hh(e,r+1))}function NY(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else{if(!(t>u))return s;a=s+1}}return-1}function kY(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else{if(!(t>u))return s;a=s+1}}return a>i?i+1:e[a]>=t?a:a+1}function UIe(e,t){if(e===t)return!0;for(var r=jh(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else{if(!(s>u))return!0;a++}}return!1}function VIe(e,t){if(e===t)return!0;var r=t.length,n=jh(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var c=e[a],l=t[i];c<l?a++:c>l?i++:(a++,i++,u++)}return u===r}function LY(e,t){if(e===t)return e;var r=e.length,n=t.length;if(0===r)return t;if(0===n)return e;if(e[0]>t[0])return LY(t,e);var a=jh(e,t),i=a.startI,s=a.endI,u=a.endJ,c=IF(e,t,i,a.startJ,s,u);if(c===r&&c===n||c===n)return e;if(c===r)return t;var l=new Int32Array(r+n-c),d=0,f=0,p=0;for(d=0;d<i;d++)l[p++]=e[d];for(;f<u&&e[i]>t[f];)l[p++]=t[f++];for(;d<s&&f<u;){var m=e[d],h=t[f];m<h?(l[p++]=m,d++):m>h?(l[p++]=h,f++):(l[p++]=m,d++,f++)}for(;d<s;d++)l[p++]=e[d];for(;f<u;f++)l[p++]=t[f];for(;d<r;d++)l[p++]=e[d];for(;f<n;f++)l[p++]=t[f];return l}function GIe(e,t){if(e===t)return RY(e);var r=jh(e,t);return IF(e,t,r.startI,r.startJ,r.endI,r.endJ)}function IF(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var c=e[o],l=t[s];c<l?o++:c>l?s++:(o++,s++,u++)}return u}function zIe(e,t){if(e===t)return e;var r=jh(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=IF(e,t,n,a,i,o),u=e.length,c=t.length;if(!s)return PS;if(s===u&&s===c||s===c)return t;if(s===u)return e;for(var l=new Int32Array(s),d=0,f=n,p=a;f<i&&p<o;){var m=e[f],h=t[p];m<h?f++:(m>h||(l[d++]=m,f++),p++)}return l}function HIe(e,t){if(e===t)return PS;for(var r=e.length,n=jh(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,c=i,l=0;u<o&&c<s;)(d=e[u])<(f=t[c])?u++:d>f?c++:(u++,c++,l++);if(!l)return e;if(l>=r)return PS;for(var p=new Int32Array(r-l),m=0,h=0;h<a;h++)p[m++]=e[h];for(u=a,c=i;u<o&&c<s;){var d,f;(d=e[u])<(f=t[c])?(p[m++]=d,u++):(d>f||u++,c++)}for(;u<r;u++)p[m++]=e[u];return p}function jIe(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;var a=new Int32Array(t),i=0;for(r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function qIe(e,t){if(BY(e,t))return AO(0,e.length-1);for(var r=jh(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,c=0;s<i&&u<o;)(l=e[s])<(d=t[u])?s++:l>d?u++:(s++,u++,c++);if(!c)return PS;if(c===e.length)return AO(0,e.length-1);var p=new Int32Array(c),m=0;for(s=n,u=a;s<i&&u<o;){var l,d;(l=e[s])<(d=t[u])?s++:(l>d||(p[m++]=s,s++),u++)}return p}var Ye,Tf={startI:0,startJ:0,endI:0,endJ:0};function jh(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(Tf.startI=Hh(e,DF(t)),Tf.startJ=Hh(t,DF(e)),Tf.endI=Hh(e,EF(t)),Tf.endJ=Hh(t,EF(e))):(Tf.startI=0,Tf.startJ=0,Tf.endI=r,Tf.endJ=n),Tf}!function(e){e.Empty=PS,e.ofUnsortedArray=EIe,e.ofSingleton=TIe,e.ofSortedArray=DIe,e.ofRange=PY,e.ofBounds=function(t,r){return PY(t,r-1)},e.is=IIe,e.isRange=MY,e.has=BIe,e.indexOf=OY,e.indexOfInInterval=FIe,e.indexOfInRange=FY,e.start=DF,e.end=EF,e.min=PIe,e.max=MIe,e.size=RY,e.hashCode=RIe,e.toString=OIe,e.areEqual=BY,e.areIntersecting=UIe,e.isSubset=VIe,e.union=LY,e.intersect=zIe,e.subtract=HIe,e.findPredecessorIndex=Hh,e.findPredecessorIndexInInterval=NIe,e.findRange=kIe,e.intersectionSize=GIe,e.deduplicate=jIe,e.indicesOf=qIe}(Ye||(Ye={}));var ke,fd=_e.Empty,WIe=_e.ofSingleton,YIe=_e.ofRange,XIe=_e.ofBounds;function vl(e){return e.length?Ye.isRange(e)?_e.ofRange(e[0],e[e.length-1]):e:fd}function qh(e){return _e.is(e)?_e.size(e):Ye.size(e)}function KIe(e,t){return _e.is(e)?_e.has(e,t):Ye.has(e,t)}function ZIe(e,t){return _e.is(e)?_e.indexOf(e,t):Ye.indexOf(e,t)}function PF(e,t){return _e.is(e)?_e.getAt(e,t):e[t]}function N0(e){return _e.is(e)?_e.min(e):Ye.min(e)}function k0(e){return _e.is(e)?_e.max(e):Ye.max(e)}function QIe(e){return _e.is(e)?_e.start(e):Ye.start(e)}function $Ie(e){return _e.is(e)?_e.end(e):Ye.end(e)}function JIe(e){return _e.is(e)?_e.hashCode(e):Ye.hashCode(e)}function t3e(e,t){return _e.is(e)?_e.is(t)?_e.areEqual(e,t):UY(e,t):_e.is(t)?UY(t,e):Ye.areEqual(e,t)}function r3e(e,t){return _e.is(e)?_e.is(t)?_e.areIntersecting(e,t):VY(t,e):_e.is(t)?VY(e,t):Ye.areIntersecting(e,t)}function n3e(e,t){return _e.is(e)?_e.is(t)?_e.isSubInterval(e,t):function f3e(e,t){var r=_e.min(e),n=_e.max(e);if(n-r+1==0)return!1;var a=Ye.min(t),i=Ye.max(t);return a>=r&&i<=n}(e,t):_e.is(t)?function d3e(e,t){var r=_e.min(t),n=_e.max(t);if(n-r+1==0)return!0;var a=Ye.min(e),i=Ye.max(e);if(r<a||n>i)return!1;var o=Ye.findRange(e,r,n);return _e.size(o)===_e.size(t)}(e,t):Ye.isSubset(e,t)}function a3e(e,t){return _e.is(e)?_e.findPredecessorIndex(e,t):Ye.findPredecessorIndex(e,t)}function i3e(e,t,r){return _e.is(e)?_e.findPredecessorIndexInInterval(e,t,r):Ye.findPredecessorIndexInInterval(e,t,r)}function o3e(e,t,r){return _e.is(e)?_e.findRange(e,t,r):Ye.findRange(e,t,r)}function s3e(e,t){return _e.is(e)?_e.is(t)?_e.intersectionSize(e,t):zY(t,e):_e.is(t)?zY(e,t):Ye.intersectionSize(e,t)}function u3e(e,t){return _e.is(e)?_e.is(t)?function h3e(e,t){if(_e.areEqual(e,t))return e;var r=_e.size(e),n=_e.size(t);if(!n)return e;if(!r)return t;var o,s,u,c,a=_e.min(e),i=_e.min(t);if(function p3e(e,t){var r=qh(e),n=qh(t);return 0===r&&0===n||r>0&&n>0&&k0(e)>=N0(t)&&N0(e)<=k0(t)}(e,t))return _e.ofRange(Math.min(a,i),Math.max(_e.max(e),_e.max(t)));a<i?(o=r,s=a,u=n,c=i):(o=n,s=i,u=r,c=a);for(var l=new Int32Array(r+n),d=0;d<o;d++)l[d]=d+s;for(d=0;d<u;d++)l[d+o]=d+c;return vl(l)}(e,t):GY(t,e):_e.is(t)?GY(e,t):vl(Ye.union(e,t))}function c3e(e,t){return _e.is(e)?_e.is(t)?_e.intersect(e,t):HY(t,e):_e.is(t)?HY(e,t):vl(Ye.intersect(e,t))}function l3e(e,t){return _e.is(e)?_e.is(t)?function v3e(e,t){if(_e.areEqual(e,t))return fd;if(!_e.areIntersecting(e,t))return e;var r=_e.min(e),n=_e.max(e),a=_e.min(t),i=_e.max(t);if(n<r||i<a)return e;if(_e.isSubInterval(t,e))return fd;if(_e.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return _e.ofRange(i+1,i+s);if(s<=0)return _e.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),c=0,l=0;l<o;l++)u[c++]=r+l;for(l=1;l<=s;l++)u[c++]=i+l;return vl(u)}return r<a?_e.ofRange(r,a-1):_e.ofRange(i+1,n)}(e,t):function y3e(e,t){var r=_e.min(e),n=_e.max(e);if(n<r)return e;var a=n-r+1,i=Ye.findRange(t,r,n),o=_e.start(i),s=_e.end(i),u=s-o;if(0===u)return e;var c=a-u;if(c<=0)return fd;for(var l=new Int32Array(c),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],m=0,h=r;h<f;h++)l[m++]=h;for(h=f;h<=p;h++)Ye.indexOfInInterval(t,h,i)<0&&(l[m++]=h);for(h=p+1;h<=n;h++)l[m++]=h;return vl(l)}(e,t):_e.is(t)?function g3e(e,t){var r=_e.min(t),n=_e.max(t);if(n<r)return e;var a=Ye.findRange(e,r,n),i=_e.start(a),o=_e.end(a),s=e.length-(o-i);if(s<=0)return fd;if(s===e.length)return e;for(var u=new Int32Array(s),c=0,l=0;l<i;l++)u[c++]=e[l];l=o;for(var d=e.length;l<d;l++)u[c++]=e[l];return vl(u)}(e,t):vl(Ye.subtract(e,t))}function UY(e,t){return _e.size(e)===Ye.size(t)&&_e.start(e)===Ye.start(t)&&_e.end(e)===Ye.end(t)}function VY(e,t){return 0!==e.length&&0!==_e.size(Ye.findRange(e,_e.min(t),_e.max(t)))}function GY(e,t){var r=_e.size(t);if(!r)return e;if(function m3e(e,t){return qh(e)?!qh(t)||N0(e)<=N0(t)&&k0(e)>=k0(t):0===qh(t)}(t,e))return t;for(var n=_e.min(t),a=_e.max(t),i=Ye.findRange(e,n,a),o=_e.start(i),s=_e.end(i),u=new Int32Array(o+(e.length-s)+r),c=0,l=0;l<o;l++)u[c++]=e[l];for(l=n;l<=a;l++)u[c++]=l;l=s;for(var d=e.length;l<d;l++)u[c++]=e[l];return vl(u)}function zY(e,t){if(!_e.size(t))return 0;var r=Ye.findRange(e,_e.min(t),_e.max(t));return _e.end(r)-_e.start(r)}function HY(e,t){if(!_e.size(t))return fd;var r=Ye.findRange(e,_e.min(t),_e.max(t)),n=_e.start(r),a=_e.end(r),i=a-n;if(!i)return fd;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return vl(o)}function C3e(e,t,r){if(t===r)return e;var n=qh(e),a=t.length,i=r.length;if(0===n||0===a||0===i)return fd;for(var o=Ye.findPredecessorIndex(r,t[N0(e)]),s=Ye.findPredecessorIndex(r,t[k0(e)]+1),u=0,c=0,l=0,d=o;l<n&&d<s;)(f=t[PF(e,l)])<(p=r[d])?l++:(f>p||(u++,l++),d++);if(0===u)return fd;if(u===a&&u===i)return e;var m=new Int32Array(u);for(c=0,l=0,d=o;l<n&&d<s;){var f,p;(f=t[PF(e,l)])<(p=r[d])?l++:(f>p||(m[c++]=d,l++),d++)}return vl(m)}function jY(e){for(var t=Ye.ofSortedArray(e),r=Ye.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function x3e(e,t){for(var r=_e.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=_e.end(t)-r,jY(n)}function _3e(e){return e.count}function w3e(e,t){return e.index[t]}function A3e(e,t,r){var n=e.offsets,i=r>=ke.max(n)?-1:ke.findPredecessorIndex(n,r-1);return ke.findRange(t,ke.getAt(n,i),ke.getAt(n,i+1)-1)}!function(e){e.Empty=fd,e.ofSingleton=WIe,e.ofRange=YIe,e.ofBounds=XIe,e.ofSortedArray=vl,e.has=KIe,e.indexOf=ZIe,e.getAt=PF,e.min=N0,e.max=k0,e.start=QIe,e.end=$Ie,e.size=qh,e.hashCode=JIe,e.areEqual=t3e,e.areIntersecting=r3e,e.isSubset=n3e,e.union=u3e,e.intersect=c3e,e.indexedIntersect=C3e,e.subtract=l3e,e.findPredecessorIndex=a3e,e.findPredecessorIndexInInterval=i3e,e.findRange=o3e,e.intersectionSize=s3e,e.forEach=function t(s,u,c){return function b3e(e,t,r){if(_e.is(e))for(var n=_e.min(e),a=n,i=_e.max(e);a<=i;a++)t(a,a-n,r);else for(a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}(s,u,c)},e.forEachSegment=function r(s,u,c,l){return function S3e(e,t,r,n){if(_e.is(e))for(var a=0,i=_e.min(e),o=_e.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(a=0,i=0,o=e.length;i<o;i++){for(s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}(s,u,c,l)},e.isInterval=function n(s){return _e.is(s)},e.isSortedArray=function a(s){return!_e.is(s)},e.toArray=function i(s){var u=[];return e.forEach(s,function(c){return u.push(c)}),u},e.toString=function o(s){return function e3e(e){return _e.is(e)?_e.toString(e):Ye.toString(e)}(s)}}(ke||(ke={}));var pr,T3e=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=_e.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;){if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&_e.size(this.setRange)>0;break}this.updateSegmentRange()}return this.value},e.prototype.updateValue=function(){var r=ke.findPredecessorIndexInInterval(this.set,this.segments[this.segmentMin+1],this.setRange);return this.value.start=_e.start(this.setRange),this.value.end=r,this.setRange=_e.ofBounds(r,_e.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=_e.min(this.setRange),r=_e.max(this.setRange);r<t?this.hasNext=!1:(this.segmentMin=this.segmentMap[ke.getAt(this.set,t)],this.segmentMax=this.segmentMap[ke.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin)},e.prototype.setSegment=function(t){this.setRange=_e.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function D3e(e,t,r){var n=typeof r<"u"?_e.ofBounds(r.start,r.end):_e.ofBounds(0,ke.size(t));return new T3e(e.offsets,e.index,t,n)}!function(e){e.create=jY,e.ofOffsets=x3e,e.count=_3e,e.getSegment=w3e,e.projectValue=A3e,e.transientSegments=D3e}(pr||(pr={}));var xc,I3e=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var n=this.prev,a=this.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(this.head=i<0?o:i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}();!function(e){function r(){return new Map}e.Empty=new Map,e.keyArray=function t(o){return Cw(o.keys())},e.Mutable=r,e.asImmutable=function n(o){return o},e.copy=function a(o){for(var s=r(),u=o.keys();;){var c=u.next(),d=c.value;if(c.done)break;s.set(d,o.get(d))}return s},e.addFrom=function i(o,s){for(var u=s.keys();;){var c=u.next(),d=c.value;if(c.done)break;o.set(d,s.get(d))}return o}}(xc||(xc={}));var nA,P3e=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),qY=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),M3e=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),R3e=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),O3e=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}();!function(e){e.Empty=new qY(0,-1),e.Array=function t(s){return new P3e(s)},e.Value=function r(s){return new M3e(s)},e.Range=function n(s,u){return new qY(s,u)},e.map=function a(s,u){return new R3e(s,u)},e.filter=function i(s,u){return new O3e(s,u)},e.forEach=function o(s,u,c){for(;s.hasNext;)if(u(s.move(),c))return c;return c}}(nA||(nA={}));var _c,ra,F3e={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""};function L0(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}function B3e(e){return 0}function MF(e){return function(r){return e[r]}}function aA(e){return 0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]}function k3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],c=r[12];return aA(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+c}:function(d){var f=n[d],p=a[d],m=i[d];return(o*f+s*p+u*m+c)/(r[3]*f+r[7]*p+r[11]*m+r[15]||1)}}function L3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],c=r[13];return aA(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+c}:function(d){var f=n[d],p=a[d],m=i[d];return(o*f+s*p+u*m+c)/(r[3]*f+r[7]*p+r[11]*m+r[15]||1)}}function U3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],c=r[14];return aA(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+c}:function(d){var f=n[d],p=a[d],m=i[d];return(o*f+s*p+u*m+c)/(r[3]*f+r[7]*p+r[11]*m+r[15]||1)}}!function(e){e.create=function t(r){var n=R(R({},F3e),r),a=n.domain,i=n.reverse,o=n.listOrName,s="string"==typeof o?pf(o).list:o,u=i?s.slice().reverse():s,c=u.length-1,l=0,d=0,f=0;function p(x,D){l=(f=D)-(d=x)||1}p(a[0],a[1]);var v,m=po(r.minLabel,d.toString()),h=po(r.maxLabel,f.toString());if(u.every(function(x){return Array.isArray(x)})){var y=or([],u,!0);y.sort(function(x,D){return x[1]-D[1]});var S=y.map(function(x){return x[0]}),C=Ye.ofSortedArray(y.map(function(x){return x[1]})),_=S.length-1;v=function(x){var D=Xi((x-d)/l,0,1),w=Ye.findPredecessorIndex(C,D);if(0===w)return S[d];if(w>_)return S[_];var A=C[w-1],I=Xi((D-A)/(C[w]-A),0,1);return dt.interpolate(S[w-1],S[w],I)}}else v=function(x){var D=Math.min(u.length-1,Math.max(0,(x-d)/l*c)),w=Math.floor(D),A=u[w],E=u[Math.ceil(D)];return dt.interpolate(A,E,D-w)};return{color:v,colorToArray:function(x,D,w){dt.toArray(v(x),D,w)},normalizedColorToArray:function(x,D,w){dt.toArrayNormalized(v(x),D,w)},setDomain:p,get legend(){return function pIe(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}(m,h,u)}}}}(_c||(_c={})),function(e){function t(v,g,y){var S=y||{},C=S.assembly,_=S.ncsId,x=S.hkl,D=S.spgrOp,w=S.key,A=x?b.clone(x):b();D=D??-1,w=w??-1,_=_||-1;var E=he.isIdentity(g),I=function n(v,g){if(!v)return"";if(v.assembly)return function r(v){return!!v&&!!v.matrix&&!!v.inverse&&"string"==typeof v.name}(v)?v.suffix:g?"":"_".concat(v.assembly.operId);if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&-1!==v.spgrOp){var y=v.hkl,S=y[0],C=y[1],_=y[2];return"-".concat(v.spgrOp+1,"_").concat(5+S).concat(5+C).concat(5+_)}return-1!==v.ncsId?"_".concat(v.ncsId):""}(y,E);return E?{name:v,assembly:C,matrix:g,inverse:he.identity(),isIdentity:!0,hkl:A,spgrOp:D,ncsId:_,suffix:I,key:w}:(he.isRotationAndTranslation(g,e.RotationTranslationEpsilon)||console.warn("Symmetry operator (".concat(v,") should be a composition of rotation and translation.")),{name:v,assembly:C,matrix:g,inverse:he.invert(he(),g),isIdentity:!1,hkl:A,spgrOp:D,key:w,ncsId:_,suffix:I})}e.DefaultName="1_555",e.Default=t(e.DefaultName,he.identity()),e.RotationTranslationEpsilon=.005,e.create=t,e.checkIfRotationAndTranslation=function a(v,g){for(var y=he.identity(),S=0;S<3;S++)for(var C=0;C<3;C++)he.setValue(y,S,C,Qt.getValue(v,S,C));return he.setTranslation(y,g),he.isRotationAndTranslation(y,e.RotationTranslationEpsilon)},e.ofRotationAndOffset=function i(v,g,y,S){for(var C=he.identity(),_=0;_<3;_++)for(var x=0;x<3;x++)he.setValue(C,_,x,Qt.getValue(g,_,x));return he.setTranslation(C,y),t(v,C,{ncsId:S})};var o=hn.identity(),s=hn(),u=hn(),c=b();function h(v,g){return v.isIdentity?function V3e(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}(g):function G3e(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return aA(r)?function(s,u){var c=n[s],l=a[s],d=i[s];return u[0]=r[0]*c+r[4]*l+r[8]*d+r[12],u[1]=r[1]*c+r[5]*l+r[9]*d+r[13],u[2]=r[2]*c+r[6]*l+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],b.transformMat4(u,u,r),u}}(v,g)}e.lerpFromIdentity=function l(v,g,y){var S=g.inverse;if(g.isIdentity)return he.copy(v,S);var C=1-y;he.getRotation(s,S),hn.slerp(s,o,s,C);var _=hn.getAxisAngle(c,s);return he.fromRotation(v,_,c),he.setValue(v,0,3,C*he.getValue(S,0,3)),he.setValue(v,1,3,C*he.getValue(S,1,3)),he.setValue(v,2,3,C*he.getValue(S,2,3)),v},e.slerp=function d(v,g,y,S){if(Math.abs(S)<=1e-5)return he.copy(v,g);if(Math.abs(S-1)<=1e-5)return he.copy(v,y);he.getRotation(s,g),he.getRotation(u,y),hn.slerp(u,s,u,S);var C=hn.getAxisAngle(c,u);return he.fromRotation(v,C,c),he.setValue(v,0,3,ta(he.getValue(g,0,3),he.getValue(y,0,3),S)),he.setValue(v,1,3,ta(he.getValue(g,1,3),he.getValue(y,1,3),S)),he.setValue(v,2,3,ta(he.getValue(g,2,3),he.getValue(y,2,3),S)),v},e.compose=function f(v,g){var y=he.mul(he(),g.matrix,v.matrix);return t(g.name,y,g)},e.createMapping=function m(v,g,y){return void 0===y&&(y=B3e),function p(v,g,y){var S=h(e.Default,g),C=v.isIdentity?S:h(v,g),_=function N3e(e,t){return e.isIdentity?{x:MF(t.x),y:MF(t.y),z:MF(t.z)}:{x:k3e(e,t),y:L3e(e,t),z:U3e(e,t)}}(v,g);return{operator:v,coordinates:g,invariantPosition:S,position:C,x:_.x,y:_.y,z:_.z,r:y}}(v,g,y)},e.createCoordinateMapper=h}(ra||(ra={}));var RF=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],z3e=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],H3e=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],RS={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function q3e(e){if(e<146)return e+1;if(146===e)return 1146;if(e<149)return e+1-1;if(149===e)return 1148;if(e<157)return e+1-2;if(157===e)return 1155;if(e<163)return e+1-3;if(163===e)return 1160;if(e<165)return e+1-4;if(165===e)return 1161;if(e<171)return e+1-5;if(171===e)return 1166;if(e<173)return e+1-6;if(173===e)return 1167;if(e<237)return e+1-7;if(237===e)return 1003;if(238===e)return 1004;if(239===e)return 1005;if(240===e)return 2005;if(241===e)return 3005;if(242===e)return 4005;if(243===e)return 5005;if(244===e)return 1006;if(245===e)return 1007;if(246===e)return 1008;if(247===e)return 1009;if(248===e)return 1010;if(249===e)return 1011;if(250===e)return 1012;if(251===e)return 1013;if(252===e)return 1014;if(253===e)return 2014;if(254===e)return 3014;if(255===e)return 1015;if(256===e)return 1017;if(257===e)return 2017;if(258===e)return 1018;if(259===e)return 2018;if(260===e)return 3018;if(261===e)return 1020;if(262===e)return 1021;if(263===e)return 1022;if(264===e)return 1023;if(265===e)return 1059;if(266===e)return 1094;if(267===e)return 1197;throw new Error("unknown spacegroup index '".concat(e,"'"))}var ns,au,wc,Pi,WY=function(){for(var e=Object.create(null),t=0,r=Object.keys(RS);t<r.length;t++){var n=r[t];e[RS[n]]=n}return e}(),W3e=function(){for(var e=Object.create(null),t=0,r=Object.keys(RS);t<r.length;t++){var a=RS[r[t]];e[a]=q3e(a)}return e}();function wo(){return wo.empty()}function OF(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function X3e(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}!function(e){function r(n,a,i){var o=function Y3e(e){var t="number"==typeof e?function j3e(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}(e):RS[e];return typeof t>"u"||typeof WY[t]>"u"?-1:t}(n);if(o<0)return console.warn("Unknown spacegroup '".concat(n,"', returning a 'P 1' with cellsize [1, 1, 1]")),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],c=i[1],l=i[2],d=a[0],f=a[1],p=a[2],m=Math.cos(c),h=(Math.cos(u)-Math.cos(c)*Math.cos(l))/Math.sin(l),v=Math.sqrt(1-m*m-h*h),g=[d,0,0],y=[Math.cos(l)*f,Math.sin(l)*f,0],S=[m*p,h*p,v*p],C=he.ofRows([[g[0],y[0],S[0],0],[0,y[1],S[1],0],[0,0,S[2],0],[0,0,0,1]]);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:he.invert(he.zero(),C),fromFractional:C}}e.Zero=r("P 1",b.create(1,1,1),b.create(Math.PI/2,Math.PI/2,Math.PI/2)),e.isZero=function t(n){return!n||0===n.index&&1===n.size[0]&&1===n.size[1]&&1===n.size[1]},e.create=r}(ns||(ns={})),function(e){function t(v){var g=H3e[v.index].map(function(C){return function d(v){return he.ofRows([RF[v[0]],RF[v[1]],RF[v[2]],[0,0,0,1]])}(z3e[C])});return{name:WY[v.index],num:W3e[v.index],cell:v,operators:g}}e.ZeroP1=t(ns.Zero),e.create=t;var r=b(),n=he();function a(v,g,y,S,C,_){return b.set(r,y,S,C),he.fromTranslation(n,r),he.mul(_,he.mul(_,he.mul(_,v.cell.fromFractional,n),v.operators[g]),v.cell.toFractional)}e.setOperatorMatrix=a,e.getSymmetryOperator=function i(v,g,y,S,C){var _=a(v,g,y,S,C,he.zero());return ra.create("".concat(g+1,"_").concat(5+y).concat(5+S).concat(5+C),_,{hkl:b.create(y,S,C),spgrOp:g})};var o=b(),s=b(),u=b(),c=b();function p(v,g,y){var S=[];if(v>0?S.push("+X"):v<0&&S.push("-X"),g>0?S.push("+Y"):g<0&&S.push("-Y"),y>0?S.push("+Z"):y<0&&S.push("-Z"),1===S.length)return"+"===S[0].charAt(0)?S[0].substr(1):S[0];if(2===S.length){var C=S[0].charAt(0),_=S[1].charAt(0);if("+"===C)return"".concat(S[0].substr(1)).concat(S[1]);if("+"===_)return"".concat(S[1].substr(1)).concat(S[0])}throw new Error("unknown rotation '".concat(S,"', ").concat(v," ").concat(g," ").concat(y))}function m(v){switch(v){case.5:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function h(v,g){return""===g?v:v.length>2?"".concat(v,"+").concat(g):"-"===v.charAt(0)?"".concat(g).concat(v):"".concat(g,"+").concat(v)}e.getSymmetryOperatorRef=function l(v,g,y,S,C,_){var x=he.zero();b.set(r,y,S,C),b.floor(o,_),he.copy(x,v.operators[g]),b.floor(s,b.transformMat4(s,_,x)),he.getTranslation(c,x),b.sub(c,c,s),b.add(c,c,o),b.add(c,c,r),he.setTranslation(x,c),he.mul(x,v.cell.fromFractional,x),he.mul(x,x,v.cell.toFractional),b.sub(u,s,o);var D=y-u[0],w=S-u[1],A=C-u[2];return ra.create("".concat(g+1,"_").concat(5+D).concat(5+w).concat(5+A),x,{hkl:b.create(D,w,A),spgrOp:g})},e.getOperatorXyz=function f(v){return[h(p(v[0],v[4],v[8]),m(v[12])),h(p(v[1],v[5],v[9]),m(v[13])),h(p(v[2],v[6],v[10]),m(v[14]))].join(",")}}(au||(au={})),function(e){e.add=function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o},e.reset=function r(i){i.count=0},e.create=function n(){return{count:0,indices:[],squaredDistances:[]}},e.copy=function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}}(wc||(wc={})),function(e){function r(){return{origin:b(),dirA:b(),dirB:b(),dirC:b()}}function n(f,p){return b.copy(f.origin,p.origin),b.copy(f.dirA,p.dirA),b.copy(f.dirB,p.dirB),b.copy(f.dirC,p.dirC),f}function i(f,p){return b.set(f,2*b.magnitude(p.dirA),2*b.magnitude(p.dirB),2*b.magnitude(p.dirC))}e.create=function t(f,p,m,h){return{origin:f,dirA:p,dirB:m,dirC:h}},e.empty=r,e.copy=n,e.clone=function a(f){return n(r(),f)},e.size=i;var o=b();e.volume=function s(f){return i(o,f),o[0]*o[1]*o[2]},e.normalize=function u(f,p){return b.copy(f.origin,p.origin),b.normalize(f.dirA,p.dirA),b.normalize(f.dirB,p.dirB),b.normalize(f.dirC,p.dirC),f};var c=Qt();e.transform=function l(f,p,m){b.transformMat4(f.origin,p.origin,m);var h=Qt.directionTransform(c,m);return b.transformMat3(f.dirA,p.dirA,h),b.transformMat3(f.dirB,p.dirB,h),b.transformMat3(f.dirC,p.dirC,h),f},e.scale=function d(f,p,m){return b.scale(f.dirA,p.dirA,m),b.scale(f.dirB,p.dirB,m),b.scale(f.dirC,p.dirC,m),f}}(wo||(wo={})),function(e){e.create=function t(f,p,m){void 0===m&&(m=Float32Array);var h=f*p;return{data:new m(h),size:h,cols:f,rows:p}},e.get=function r(f,p,m){return f.data[f.rows*m+p]},e.set=function n(f,p,m,h){return f.data[f.rows*m+p]=h,f},e.add=function a(f,p,m,h){return f.data[f.rows*m+p]+=h,f},e.makeZero=function i(f){return f.data.fill(0),f},e.clone=function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}},e.fromArray=function s(f,p,m){return{data:f,size:p*m,cols:p,rows:m}},e.transpose=function u(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");for(var m=p.rows,h=p.cols,v=p.data,g=f.data,y=0,S=0,C=0;y<m;C+=1,S+=h,++y)for(var _=C,x=0;x<h;_+=m,x++)g[_]=v[S+x];return f},e.multiplyABt=function c(f,p,m){for(var h=p.cols,v=p.rows,g=m.rows,y=p.data,S=m.data,C=f.data,_=0,x=0,D=0;_<v;x+=h,_++)for(var w=0,A=0;A<g;D++,A++){for(var E=0,I=x,M=0;M<h;I++,w++,M++)E+=y[I]*S[w];C[D]=E}return f},e.meanRows=function l(f){for(var p=f.rows,m=f.cols,h=f.data,v=new Array(m),g=0;g<m;++g)v[g]=0;for(var y=0,S=0;y<p;++y)for(g=0;g<m;++g,++S)v[g]+=h[S];for(g=0;g<m;++g)v[g]/=p;return v},e.subRows=function d(f,p){for(var m=f.rows,h=f.cols,v=f.data,g=0,y=0;g<m;++g)for(var S=0;S<h;++S,++y)v[y]-=p[S];return f}}(Pi||(Pi={}));var gl;function Pe(){return Pe.zero()}function Nt(){return Nt.zero()}!function(e){function r(o){if(3===o.length)return wo.create(b.fromArray(b(),o,0),b.create(1,0,0),b.create(0,1,0),b.create(0,0,1));var s=Pi.fromArray(o,3,o.length/3),u=s.rows,c=u/3,l=Pi.create(3,3),d=Pi.create(1,3),f=Pi.create(3,3),p=Pi.create(3,3),m=Pi.meanRows(s),h=Pi.subRows(Pi.clone(s),m),v=Pi.transpose(Pi.create(u,3),h);Pi.multiplyABt(l,v,v),function $3e(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,c=s;u<c&&(a=1,i=u,u=c,c=i);var l=Pi.create(u,u),d=Pi.create(1,c),f=Pi.create(c,c);if(0===a)Pi.transpose(l,e);else{for(i=0;i<s*o;i++)l.data[i]=e.data[i];for(;i<c*u;i++)l.data[i]=0}if(function Q3e(e,t,r,n,a,i,o,s){for(var l=0,d=0,f=0,p=0,m=Math.max(i,30),h=0,v=0,g=0,y=0,S=0,C=0,_=0,x=0,D=0,w=0,A=0,E=0,I=0,F=0,N=0,j=0,U=4660,z=0,G=0,J=new Float64Array(o<<3);l<o;l++){for(f=0,A=0;f<i;f++)A+=(x=e[l*t+f])*x;if(J[l]=A,n){for(f=0;f<o;f++)n[l*a+f]=0;n[l*a+l]=1}}for(;p<m;p++){for(S=0,l=0;l<o-1;l++)for(d=l+1;d<o;d++){for(F=J[l],N=0,j=J[d],f=2,N+=e[h=l*t|0]*e[v=d*t|0],N+=e[h+1]*e[v+1];f<i;f++)N+=e[h+f]*e[v+f];if(!(Math.abs(N)<=2.384185792e-7*Math.sqrt(F*j))){for(I=X3e(N*=2,E=F-j),E<0?C=N/(I*(_=Math.sqrt(.5*(I-E)/I))*2):_=N/(I*(C=Math.sqrt((I+E)/(2*I)))*2),F=0,j=0,f=2,w=-_*e[h]+C*e[v],e[h]=D=C*e[h]+_*e[v],e[v]=w,F+=D*D,j+=w*w,w=-_*e[h+1]+C*e[v+1],e[h+1]=D=C*e[h+1]+_*e[v+1],e[v+1]=w,F+=D*D,j+=w*w;f<i;f++)w=-_*e[h+f]+C*e[v+f],e[h+f]=D=C*e[h+f]+_*e[v+f],e[v+f]=w,F+=D*D,j+=w*w;if(J[l]=F,J[d]=j,S=1,n)for(f=2,w=-_*n[g=l*a|0]+C*n[y=d*a|0],n[g]=D=C*n[g]+_*n[y],n[y]=w,w=-_*n[g+1]+C*n[y+1],n[g+1]=D=C*n[g+1]+_*n[y+1],n[y+1]=w;f<o;f++)w=-_*n[g+f]+C*n[y+f],n[g+f]=D=C*n[g+f]+_*n[y+f],n[y+f]=w}}if(0===S)break}for(l=0;l<o;l++){for(f=0,A=0;f<i;f++)A+=(x=e[l*t+f])*x;J[l]=Math.sqrt(A)}for(l=0;l<o-1;l++){for(d=l,f=l+1;f<o;f++)J[d]<J[f]&&(d=f);if(l!==d&&(OF(J,l,d,A),n)){for(f=0;f<i;f++)OF(e,l*t+f,d*t+f,x);for(f=0;f<o;f++)OF(n,l*a+f,d*a+f,x)}}for(l=0;l<o;l++)r[l]=J[l];if(n)for(l=0;l<s;l++){for(A=l<o?J[l]:0;A<=1e-37;){for(z=1/i,f=0;f<i;f++)e[l*t+f]=256&(U=214013*U+2531011)>>16?z:-z;for(p=0;p<2;p++)for(d=0;d<l;d++){for(A=0,f=0;f<i;f++)A+=e[l*t+f]*e[d*t+f];for(G=0,f=0;f<i;f++)e[l*t+f]=x=e[l*t+f]-A*e[d*t+f],G+=Math.abs(x);for(G=G?1/G:0,f=0;f<i;f++)e[l*t+f]*=G}for(A=0,f=0;f<i;f++)A+=(x=e[l*t+f])*x;A=Math.sqrt(A)}for(_=1/A,f=0;f<i;f++)e[l*t+f]*=_}}(l.data,u,d.data,f.data,c,u,c,u),t){for(i=0;i<c;i++)t.data[i]=d.data[i];for(;i<s;i++)t.data[i]=0}0===a?(r&&Pi.transpose(r,l),n&&Pi.transpose(n,f)):(r&&Pi.transpose(r,f),n&&Pi.transpose(n,l))}(l,d,f,p);var g=b.create(m[0],m[1],m[2]),y=b.create(f.data[0],f.data[3],f.data[6]),S=b.create(f.data[1],f.data[4],f.data[7]),C=b.create(f.data[2],f.data[5],f.data[8]);return b.scale(y,y,Math.sqrt(d.data[0]/c)),b.scale(S,S,Math.sqrt(d.data[1]/c)),b.scale(C,C,Math.sqrt(d.data[2]/c)),wo.create(g,y,S,C)}function n(o){var s=wo.clone(o);return b.magnitude(s.dirC)<mn&&b.cross(s.dirC,s.dirA,s.dirB),wo.normalize(s,s)}e.ofPositions=function t(o){var s=r(o);return{momentsAxes:s,boxAxes:i(o,s)}},e.calculateMomentsAxes=r,e.calculateNormalizedAxes=n;var a=b();function i(o,s){if(3===o.length)return wo.clone(s);for(var u=-1/0,c=-1/0,l=-1/0,d=-1/0,f=-1/0,p=-1/0,m=b(),h=b(),v=s.origin,g=n(s),y=0,S=o.length;y<S;y+=3){b.projectPointOnVector(m,b.fromArray(m,o,y),g.dirA,v);var C=b.dot(g.dirA,b.normalize(h,b.sub(h,m,v))),_=b.distance(m,v);C>0?_>u&&(u=_):_>c&&(c=_),b.projectPointOnVector(m,b.fromArray(m,o,y),g.dirB,v);var x=b.dot(g.dirB,b.normalize(h,b.sub(h,m,v))),D=b.distance(m,v);x>0?D>l&&(l=D):D>d&&(d=D),b.projectPointOnVector(m,b.fromArray(m,o,y),g.dirC,v);var w=b.dot(g.dirC,b.normalize(h,b.sub(h,m,v))),A=b.distance(m,v);w>0?A>f&&(f=A):A>p&&(p=A)}var E=b.setMagnitude(b(),g.dirA,(u+c)/2),I=b.setMagnitude(b(),g.dirB,(l+d)/2),M=b.setMagnitude(b(),g.dirC,(f+p)/2),F=b.isFinite(E),N=b.isFinite(I),j=b.isFinite(M),U=b(),H=function(z,G,J){b.copy(a,v),F&&b.scaleAndAdd(a,a,g.dirA,z),N&&b.scaleAndAdd(a,a,g.dirB,G),j&&b.scaleAndAdd(a,a,g.dirC,J),b.add(U,U,a)};return H(u,l,f),H(u,l,-p),H(u,-d,-p),H(u,-d,f),H(-c,-d,-p),H(-c,-d,f),H(-c,l,f),H(-c,l,-p),b.scale(U,U,1/8),wo.create(U,E,I,M)}e.calculateBoxAxes=i}(gl||(gl={})),function(e){function t(M){return void 0!==M.extrema}function r(M,F){return{center:M,radius:F}}function s(M,F){var N;return void 0!==M.extrema?(M.extrema.length=0,(N=M.extrema).push.apply(N,F)):M.extrema=F,M}e.hasExtrema=t,e.create=r,e.zero=function n(){return{center:b(),radius:0}},e.clone=function a(M){var F=r(b.clone(M.center),M.radius);return t(M)&&(F.extrema=M.extrema.map(function(N){return b.clone(N)})),F},e.set=function i(M,F,N){return b.copy(M.center,F),M.radius=N,M},e.copy=function o(M,F){return b.copy(M.center,F.center),M.radius=F.radius,t(F)&&s(M,F.extrema.map(function(N){return b.clone(N)})),M},e.setExtrema=s,e.computeBounding=function u(M){for(var F=M.x,N=M.y,j=M.z,U=M.indices,H=0,z=0,G=0,J=0,X=ke.size(U),Z=0;Z<X;Z++)H+=F[ne=ke.getAt(U,Z)],z+=N[ne],G+=j[ne];for(X>0&&(H/=X,z/=X,G/=X),Z=0;Z<X;Z++){var ne,Y=F[ne=ke.getAt(U,Z)]-H,k=N[ne]-z,W=j[ne]-G,$=Y*Y+k*k+W*W;$>J&&(J=$)}return{center:b.create(H,z,G),radius:Math.sqrt(J)}},e.transform=function c(M,F,N){return b.transformMat4(M.center,F.center,N),M.radius=F.radius*he.getMaxScaleOnAxis(N),t(F)&&s(M,F.extrema.map(function(j){return b.transformMat4(b(),j,N)})),M},e.translate=function l(M,F,N){return b.add(M.center,F.center,N),t(F)&&s(M,F.extrema.map(function(j){return b.add(b(),j,N)})),M},e.toArray=function d(M,F,N){return b.toArray(M.center,F,N),F[N+3]=M.radius,F},e.fromArray=function f(M,F,N){return b.fromArray(M.center,F,N),M.radius=F[N+3],M},e.fromBox3D=function p(M,F){return b.scale(M.center,b.add(M.center,F.max,F.min),.5),M.radius=b.distance(M.center,F.max),e.setExtrema(M,[b.create(F.min[0],F.min[1],F.min[2]),b.create(F.max[0],F.max[1],F.max[2]),b.create(F.max[0],F.min[1],F.min[2]),b.create(F.min[0],F.max[1],F.max[2]),b.create(F.min[0],F.min[1],F.max[2]),b.create(F.max[0],F.min[1],F.max[2]),b.create(F.max[0],F.max[1],F.min[2]),b.create(F.min[0],F.max[1],F.min[2])]),M},e.fromAxes3D=function m(M,F){return b.copy(M.center,F.origin),M.radius=Math.max(b.magnitude(F.dirA),b.magnitude(F.dirB),b.magnitude(F.dirC)),M};var h=b();e.fromDimensionsAndTransform=function v(M,F,N){var j=F[0],U=F[1],H=F[2],z=b.create(0,0,0);b.transformMat4(z,z,N);var G=b.create(j,U,H);b.transformMat4(G,G,N);var J=b.create(j,0,0);b.transformMat4(J,J,N);var X=b.create(0,U,H);b.transformMat4(X,X,N);var Z=b.create(0,0,H);b.transformMat4(Z,Z,N);var ne=b.create(j,0,H);b.transformMat4(ne,ne,N);var Y=b.create(j,U,0);b.transformMat4(Y,Y,N);var k=b.create(0,U,0);b.transformMat4(k,k,N),b.add(h,z,G),b.scale(h,h,.5);var W=Math.max(b.distance(z,G),b.distance(J,X));return e.set(M,h,W/2),e.setExtrema(M,[z,G,J,X,Z,ne,Y,k]),M};var g=b();e.addVec3=function y(M,F,N){return b.distance(F.center,N)<F.radius?e.copy(M,F):(b.sub(g,F.center,N),b.sub(g,F.center,g),b.setMagnitude(g,g,F.radius),b.scale(M.center,b.add(g,g,N),.5),M.radius=b.distance(M.center,N),M)},e.expandBySphere=function S(M,F,N){return b.copy(M.center,F.center),M.radius=Math.max(F.radius,b.distance(F.center,N.center)+N.radius),t(F)&&t(N)&&s(M,or(or([],F.extrema.map(function(j){return b.clone(j)}),!0),N.extrema.map(function(j){return b.clone(j)}),!0)),M};var C=b();e.expand=function _(M,F,N){var j,U;if(b.copy(M.center,F.center),M.radius=F.radius+N,F.radius<1e-12||(null!==(U=null===(j=F.extrema)||void 0===j?void 0:j.length)&&void 0!==U?U:0)<=1)return M.extrema=void 0,M;if(t(F)){for(var H=new Float32Array(3*F.extrema.length),z=0;z<F.extrema.length;z++)b.toArray(F.extrema[z],H,3*z);var G=gl.calculateMomentsAxes(H);wo.scale(G,wo.normalize(G,G),N),s(M,F.extrema.map(function(J){b.normalize(C,b.sub(C,J,F.center));var X=b.clone(J),Z=b.dot(C,G.dirA)<0?-1:1;b.scaleAndAdd(X,X,G.dirA,Z);var ne=b.dot(C,G.dirB)<0?-1:1;b.scaleAndAdd(X,X,G.dirB,ne);var Y=b.dot(C,G.dirC)<0?-1:1;return b.scaleAndAdd(X,X,G.dirC,Y),b.distance(M.center,X)>M.radius&&(F.extrema.length>=14&&b.normalize(C,b.sub(C,X,F.center)),b.scaleAndAdd(X,M.center,C,M.radius)),X}))}return M},e.exactEquals=function x(M,F){return M.radius===F.radius&&b.exactEquals(M.center,F.center)},e.equals=function D(M,F){var N=M.radius,j=F.radius;return Math.abs(N-j)<=mn*Math.max(1,Math.abs(N),Math.abs(j))&&b.equals(M.center,F.center)},e.includes=function w(M,F){if(t(F)){for(var N=0,j=F.extrema;N<j.length;N++)if(b.distance(M.center,j[N])>M.radius)return!1;return!0}return b.distance(M.center,F.center)+F.radius<=M.radius},e.overlaps=function A(M,F){return b.distance(M.center,F.center)<=M.radius+F.radius},e.distance=function E(M,F){return b.distance(M.center,F.center)-M.radius+F.radius},e.distanceToVec=function I(M,F){var j=M.radius;return b.distance(F,M.center)-j}}(Pe||(Pe={})),function(e){function r(){return{min:b(),max:b()}}function n(A,E){return b.copy(A.min,E.min),b.copy(A.max,E.max),A}e.create=function t(A,E){return{min:A,max:E}},e.zero=r,e.copy=n,e.clone=function a(A){return n(r(),A)};var i=b();function s(A,E){for(var I=0,M=E.length;I<M;I++)v(A,E[I]);return A}function u(A,E){return h(A),s(A,E),A}function f(A,E){return b.sub(A,E.max,E.min)}e.fromSphere3D=function o(A,E){return Pe.hasExtrema(E)&&E.extrema.length>=14?u(A,E.extrema):(b.set(i,E.radius,E.radius,E.radius),b.sub(A.min,E.center,i),b.add(A.max,E.center,i),A)},e.addVec3Array=s,e.fromVec3Array=u,e.addSphere3D=function c(A,E){return Pe.hasExtrema(E)&&E.extrema.length>=14?s(A,E.extrema):(v(A,b.subScalar(i,E.center,E.radius)),v(A,b.addScalar(i,E.center,E.radius)),A)},e.intersectsSphere3D=function l(A,E){return b.clamp(i,E.center,A.min,A.max),b.squaredDistance(i,E.center)<=E.radius*E.radius},e.computeBounding=function d(A){for(var E=b.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=b.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),M=A.x,F=A.y,N=A.z,j=A.indices,U=0,H=ke.size(j);U<H;U++){var z=ke.getAt(j,U);E[0]=Math.min(M[z],E[0]),E[1]=Math.min(F[z],E[1]),E[2]=Math.min(N[z],E[2]),I[0]=Math.max(M[z],I[0]),I[1]=Math.max(F[z],I[1]),I[2]=Math.max(N[z],I[2])}return{min:E,max:I}},e.size=f;var p=b();function h(A){return b.set(A.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.set(A.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),A}function v(A,E){return b.min(A.min,A.min,E),b.max(A.max,A.max,E),A}e.volume=function m(A){return f(p,A),p[0]*p[1]*p[2]},e.setEmpty=h,e.add=v,e.expand=function g(A,E,I){return b.sub(A.min,E.min,I),b.add(A.max,E.max,I),A},e.scale=function y(A,E,I){return b.scale(A.min,E.min,I),b.scale(A.max,E.max,I),A};var S=b();e.transform=function C(A,E,I){var M=E.min,F=M[0],N=M[1],j=M[2],U=E.max,H=U[0],z=U[1],G=U[2];return h(A),v(A,b.transformMat4(S,b.set(S,F,N,j),I)),v(A,b.transformMat4(S,b.set(S,F,N,G),I)),v(A,b.transformMat4(S,b.set(S,F,z,j),I)),v(A,b.transformMat4(S,b.set(S,F,z,G),I)),v(A,b.transformMat4(S,b.set(S,H,N,j),I)),v(A,b.transformMat4(S,b.set(S,H,N,G),I)),v(A,b.transformMat4(S,b.set(S,H,z,j),I)),v(A,b.transformMat4(S,b.set(S,H,z,G),I)),A},e.containsVec3=function _(A,E){return!(E[0]<A.min[0]||E[0]>A.max[0]||E[1]<A.min[1]||E[1]>A.max[1]||E[2]<A.min[2]||E[2]>A.max[2])},e.overlaps=function x(A,E){return!(A.max[0]<E.min[0]||A.min[0]>E.max[0]||A.max[1]<E.min[1]||A.min[1]>E.max[1]||A.max[2]<E.min[2]||A.min[2]>E.max[2])},e.containsSphere3D=function D(A,E){var I=E.center,M=E.radius;return!(I[0]-M<A.min[0]||I[0]+M>A.max[0]||I[1]-M<A.min[1]||I[1]+M>A.max[1]||I[2]-M<A.min[2]||I[2]+M>A.max[2])},e.nearestIntersectionWithRay=function w(A,E,I,M){var $,K,q,V,ee,ae,F=E.min,N=F[0],j=F[1],U=F[2],H=E.max,z=H[0],G=H[1],J=H[2],X=I[0],Z=I[1],ne=I[2],Y=1/M[0],k=1/M[1],W=1/M[2];return Y>=0?($=(N-X)*Y,K=(z-X)*Y):($=(z-X)*Y,K=(N-X)*Y),k>=0?(q=(j-Z)*k,V=(G-Z)*k):(q=(G-Z)*k,V=(j-Z)*k),W>=0?(ee=(U-ne)*W,ae=(J-ne)*W):(ee=(J-ne)*W,ae=(U-ne)*W),q>$&&($=q),V<K&&(K=V),ee>$&&($=ee),ae<K&&(K=ae),b.scale(A,M,$),b.set(A,A[0]+X,A[1]+Z,A[2]+ne)}}(Nt||(Nt={}));var J3e=function e(t,r){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=t,this.value=r,this.prev=this,this.next=this},ePe=function(){function e(t){if(this._index=-1,this._items=[],this._len=0,t){var r=t,n=0;do{this._items[n++]=r,r=r.next}while(t!==r);this._len=n}}return e.prototype.hasNext=function(){return this._index<this._len-1},e.prototype.next=function(){return this._items[++this._index]},e.prototype.reset=function(t){this._index=-1,this._len=0;var r=t,n=0;do{this._items[n++]=r,r=r.next}while(t!==r);this._len=n},e}(),FF=new ePe,YY=function(){function e(t){this._minNode=null,this._nodeCount=0,this._compare=t||this._defaultCompare}return e.prototype.clear=function(){this._minNode=null,this._nodeCount=0},e.prototype.decreaseKey=function(t,r){if(!t)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:r},{key:t.key})>0)throw new Error("New key is larger than old key");t.key=r;var n=t.parent;n&&this._compare(t,n)<0&&(this._cut(t,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(t,this._minNode)<0&&(this._minNode=t)},e.prototype.delete=function(t){var r=t.parent;r&&(this._cut(t,r,this._minNode),this._cascadingCut(r,this._minNode)),this._minNode=t,this.extractMinimum()},e.prototype.extractMinimum=function(){var t=this._minNode;if(t){if(t.child){var r=t.child;do{r.parent=null,r=r.next}while(r!==t.child)}var n=null;t.next!==t&&(n=t.next),this._removeNodeFromList(t),this._nodeCount--,this._minNode=this._mergeLists(n,t.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return t},e.prototype.findMinimum=function(){return this._minNode},e.prototype.insert=function(t,r){var n=new J3e(t,r);return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n},e.prototype.isEmpty=function(){return null===this._minNode},e.prototype.size=function(){return null===this._minNode?0:this._getNodeListSize(this._minNode)},e.prototype.union=function(t){this._minNode=this._mergeLists(this._minNode,t._minNode),this._nodeCount+=t._nodeCount},e.prototype._defaultCompare=function(t,r){return t.key>r.key?1:t.key<r.key?-1:0},e.prototype._cut=function(t,r,n){t.parent=null,r.degree--,r.child=t.next===t?null:t.next,this._removeNodeFromList(t);var a=this._mergeLists(n,t);return t.isMarked=!1,a},e.prototype._cascadingCut=function(t,r){var n=t.parent;return n&&(t.isMarked?(r=this._cut(t,n,r),r=this._cascadingCut(n,r)):t.isMarked=!0),r},e.prototype._consolidate=function(t){var r=[];for(FF.reset(t);FF.hasNext();){for(var n=FF.next(),a=r[n.degree];a;){if(this._compare(n,a)>0){var i=n;n=a,a=i}this._linkHeaps(a,n),r[n.degree]=null,n.degree++,a=r[n.degree]}r[n.degree]=n}for(var o=null,s=0;s<r.length;s++){var u=r[s];u&&(u.next=u,u.prev=u,o=this._mergeLists(o,u))}return o},e.prototype._removeNodeFromList=function(t){var r=t.prev,n=t.next;r.next=n,n.prev=r,t.next=t,t.prev=t},e.prototype._linkHeaps=function(t,r){this._removeNodeFromList(t),r.child=this._mergeLists(t,r.child),t.parent=r,t.isMarked=!1},e.prototype._mergeLists=function(t,r){if(!t)return r||null;if(!r)return t;var n=t.next;return t.next=r.next,t.next.prev=t,r.next=n,r.next.prev=r,this._compare(t,r)<0?t:r},e.prototype._getNodeListSize=function(t){var r=0,n=t;do{r++,n.child&&(r+=this._getNodeListSize(n.child)),n=n.next}while(n!==t);return r},e}();function Df(e,t,r){return new tPe(e,t,r)}var tPe=function(){function e(t,r,n){var a=function nPe(e,t,r){var o,s,n=Nt.expand(Nt(),t.box,b.create(.5,.5,.5)),a=e.indices,i=Nt.size(b(),n),u=ke.size(a),c="number"==typeof r?r:32,l=Array.isArray(r)&&r;if(l&&!b.isZero(l))s=[Math.ceil(i[0]/l[0]),Math.ceil(i[1]/l[1]),Math.ceil(i[2]/l[2])],o=l;else if(u>0){var d=Math.ceil(u/c),f=Math.pow(d/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];return function rPe(e){for(var r=e.size,a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,c=o.z,l=o.radius,d=o.indices,f=e.elementCount,p=e.delta,m=r[0]*a*i,h=e.expandedBox.min,v=h[0],g=h[1],y=h[2],S=0,C=0,_=new Uint32Array(m),x=new Int32Array(f),D=0;D<f;D++){var w=ke.getAt(d,D),M=(Math.floor((s[w]-v)/p[0])*a+Math.floor((u[w]-g)/p[1]))*i+Math.floor((c[w]-y)/p[2]);1===(_[M]+=1)&&(C+=1),x[D]=M}if(l)for(D=0;D<f;D++)l[w=ke.getAt(d,D)]>S&&(S=l[w]);for(var F=new Int32Array(C),N=(w=0,0);w<m;w++){var j=_[w];j>0&&(_[w]=N+1,F[N]=j,N+=1)}var U=new Uint32Array(C);for(w=1;w<C;++w)U[w]+=U[w-1]+F[w-1];var H=new Int32Array(C),z=new Int32Array(f);for(w=0;w<f;w++){var G=_[x[w]];if(G>0){var J=G-1;z[U[J]+H[J]]=w,H[J]+=1}}return{size:e.size,bucketArray:z,bucketCounts:F,bucketOffset:U,grid:_,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:S,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}({size:s,data:{x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o})}(t,r,n);this.ctx=function aPe(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=wc.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i??this.result;return XY(this.ctx,o),o},e.prototype.nearest=function(t,r,n,a,i,o){void 0===a&&(a=1),this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.k=a,this.ctx.stopIf=i;var s=o??this.result;return function uPe(e,t){var r=e.grid,n=r.min,a=r.expandedBox,i=r.boundingSphere.center,o=r.size,s=o[0],u=o[1],c=o[2],l=r.bucketOffset,d=r.bucketCounts,f=r.bucketArray,p=r.grid,m=r.data,h=m.x,v=m.y,g=m.z,y=m.indices,S=m.radius,C=r.delta,_=r.maxRadius,x=e.x,D=e.y,w=e.z,A=e.k,E=e.stopIf,I=ke.size(y);if(wc.reset(t),0===I||A<=0)return!1;var M,F,N,ne,j=!1,U=1,H=!0,z=0,G=iPe,J=oPe,X=0,Z=!0,Y=!1,k=sPe,W=_*_;G.length=0,k.length=0,OS.clear(),U0.clear(),b.set(cm,x,D,w),Nt.containsVec3(a,cm)?(M=Math.floor((x-n[0])/C[0]),F=Math.floor((D-n[1])/C[1]),N=Math.floor((w-n[2])/C[2])):(Nt.nearestIntersectionWithRay(cm,a,cm,b.normalize(KY,b.sub(KY,i,cm))),M=Math.max(0,Math.min(s-1,Math.floor((cm[0]-n[0])/C[0]))),F=Math.max(0,Math.min(u-1,Math.floor((cm[1]-n[1])/C[1]))),N=Math.max(0,Math.min(c-1,Math.floor((cm[2]-n[2])/C[2]))));var $=0!==_?Math.max(1,Math.min(s-1,Math.ceil(_/C[0]))):1,K=0!==_?Math.max(1,Math.min(u-1,Math.ceil(_/C[1]))):1,q=0!==_?Math.max(1,Math.min(c-1,Math.ceil(_/C[2]))):1;for(G.push(M,F,N,(M*u+F)*c+N);t.count<I;){for(var V=4*U,ee=0;ee<V;ee+=4)if(!OS.has(ne=G[ee+3])){OS.add(ne),Y=OS.size>=p.length;var ae=p[ne];if(0!==ae){for(var pe=X,me=ae-1,de=l[me],te=de+d[me],le=de;le<te;le++){var ge=f[le],xe=ke.getAt(y,ge),Ge=h[xe]-x,je=v[xe]-D,L=g[xe]-w,Q=Ge*Ge+je*je+L*L;if(0!==_){var ye=S[xe];Q-=ye*ye}Z&&Q>X&&(X=Q),U0.insert(Q,ge)}pe<X&&(Z=!1)}}for(J.length=0,z=0,BF.clear(),ee=0;ee<V;ee+=4){M=G[ee],F=G[ee+1],N=G[ee+2];for(var we=-$;we<=$;we++){var De=M+we;if(!(De<0||De>=s))for(var Oe=-K;Oe<=K;Oe++){var Ne=F+Oe;if(!(Ne<0||Ne>=u))for(var Ue=-q;Ue<=q;Ue++){var $e=N+Ue;if(!($e<0||$e>=c||(ne=(De*u+Ne)*c+$e,BF.has(ne)||(BF.add(ne),OS.has(ne))))){if(!H){var Ie=n[0]+De*C[0]-x,He=n[1]+Ne*C[1]-D,Je=n[2]+$e*C[2]-w;if(Ie*Ie+He*He+Je*Je-W>X){k.push(De,Ne,$e,ne);continue}}J.push(De,Ne,$e,ne),z++}}}}}if(H=!1,0===z){if(1===A){if(ut=U0.findMinimum())return wc.add(t,Le=ut.value,wt=ut.key),!0}else for(;!U0.isEmpty()&&(Y||U0.findMinimum().key<=X)&&t.count<A;){var wt,Le,ut=U0.extractMinimum();wc.add(t,Le=ut.value,wt=ut.key),E&&!j&&(j=E(Le,wt))}if(t.count>=A||j||t.count>=I)return t.count>0;if(H=!0,Z=!0,k.length>0){le=0;for(var it=k.length;le<it;le++)G.push(k[le]);k.length=0,U=G.length}}else{var Ct=G;G=J,J=Ct,U=z}}}(this.ctx,s),s},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,XY(this.ctx,this.result)},e}();function XY(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,c=r.bucketCounts,l=r.bucketArray,d=r.grid,f=r.data,p=f.x,m=f.y,h=f.z,v=f.indices,g=f.radius,y=r.delta,S=r.maxRadius,C=e.radius,_=e.isCheck,x=e.x,D=e.y,w=e.z,A=C+S,E=A*A;wc.reset(t);var I=Math.max(0,Math.floor((x-A-n[0])/y[0])),M=Math.max(0,Math.floor((D-A-n[1])/y[1])),F=Math.max(0,Math.floor((w-A-n[2])/y[2])),N=Math.min(i-1,Math.floor((x+A-n[0])/y[0])),j=Math.min(o-1,Math.floor((D+A-n[1])/y[1])),U=Math.min(s-1,Math.floor((w+A-n[2])/y[2]));if(I>N||M>j||F>U)return!1;for(var H=I;H<=N;H++)for(var z=M;z<=j;z++)for(var G=F;G<=U;G++){var J=d[(H*o+z)*s+G];if(0!==J)for(var X=J-1,Z=u[X],Y=Z+c[X],k=Z;k<Y;k++){var W=ke.getAt(v,l[k]),$=p[W]-x,K=m[W]-D,q=h[W]-w,V=$*$+K*K+q*q;if(V<=E){if(S>0&&Math.sqrt(V)-g[W]>C)continue;if(_)return!0;wc.add(t,l[k],V)}}}return t.count>0}var KY=b(),cm=b(),OS=new Set,BF=new Set,iPe=[.1],oPe=[.1],sPe=[.1],U0=new YY;var iu=b();function Wh(e,t,r,n){for(var a=0,i=3*n;a<i;a+=3)b.fromArray(iu,t,r+a),b.transformMat4(iu,iu,e),b.toArray(iu,t,r+a)}var iA=b(),V0=b(),oA=b(),Ka=b(),sA=b();function QY(e,t,r,n,a){for(var i=0,o=3*a;i<o;i+=3){var s=3*t[i],u=3*t[i+1],c=3*t[i+2];b.fromArray(iA,e,s),b.fromArray(V0,e,u),b.fromArray(oA,e,c),b.sub(Ka,oA,V0),b.sub(sA,iA,V0),b.cross(Ka,Ka,sA),r[s]+=Ka[0],r[s+1]+=Ka[1],r[s+2]+=Ka[2],r[u]+=Ka[0],r[u+1]+=Ka[1],r[u+2]+=Ka[2],r[c]+=Ka[0],r[c+1]+=Ka[1],r[c+2]+=Ka[2]}return function ZY(e,t){for(var r=0,n=3*t;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}(r,n)}function G0(e,t,r){void 0===r&&(r=1);for(var n=id(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];var c=0;for(s=0;s<t;s++)a[s]=c,c+=o[s];a[t]=c;var l=new Int32Array(c);for(s=0,u=t*r;s<u;s+=r){var d=e[s];l[a[d]+i[d]]=s,++i[d]}return{indices:l,offsets:a}}var dPe=b.add,fPe=b.squaredDistance,pPe=b.distance,Yh=function(){function e(){this.count=0,this.center=b(),this.radiusSq=0}return e.prototype.reset=function(){b.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){dPe(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){0!==this.count&&b.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=fPe(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=pPe(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=Pe()),b.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();!function(e){var t=new e,r=b(),n=b();e.fromArrays=function a(s,u){var c=s.x,l=s.y,d=s.z;t.reset();for(var f=c.length,p=0;p<f;p++)b.set(r,c[p],l[p],d[p]),t.includeStep(r);for(t.finishedIncludeStep(),p=0;p<f;p++)b.set(r,c[p],l[p],d[p]),t.radiusStep(r);return b.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u},e.fromProvider=function i(s,u,c){t.reset();for(var l=0;l<s;l++)u(l,r),t.includeStep(r);for(t.finishedIncludeStep(),l=0;l<s;l++)u(l,r),t.radiusStep(r);return b.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c},e.fromPairProvider=function o(s,u,c){t.reset();for(var l=0;l<s;l++)u(l,r,n),t.includeStep(r),t.includeStep(n);for(t.finishedIncludeStep(),l=0;l<s;l++)u(l,r,n),t.radiusStep(r),t.radiusStep(n);return b.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}}(Yh||(Yh={}));var $Y=b.dot,JY=b.copy,mPe=b.scaleAndSub,hPe=b.scaleAndAdd,Lu=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new Yh,this.dir=function vPe(e){var t;switch(e){case"6":t=or([],uA,!0);break;case"14":t=or(or([],uA,!0),NF,!0);break;case"26":t=or(or(or([],uA,!0),NF,!0),eX,!0);break;case"98":t=or(or(or(or(or(or([],uA,!0),NF,!0),eX,!0),gPe,!0),yPe,!0),bPe,!0)}return t.map(function(r){var n=b.create(r[0],r[1],r[2]);return b.normalize(n,n)})}(t),this.dirLength=this.dir.length,this.reset()}return e.prototype.computeExtrema=function(t,r){var n=$Y(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,JY(this.extrema[2*t],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,JY(this.extrema[2*t+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=this.dir[t],i=$Y(a,r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,mPe(this.extrema[2*t],r,a,n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,hPe(this.extrema[2*t+1],r,a,n))},e.prototype.includeSphere=function(t){if(Pe.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++)this.includePosition(n[r]);else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0;r<this.dirLength;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Pe.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++)this.radiusPosition(n[r]);else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Pe.setExtrema(this.centroidHelper.getSphere(t),this.extrema.slice())},e.prototype.getBox=function(t){return Nt.fromVec3Array(t||Nt(),this.extrema)},e.prototype.reset=function(){for(var t=0;t<this.dirLength;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[2*t]=b(),this.extrema[2*t+1]=b();this.centroidHelper.reset()},e}(),uA=[[1,0,0],[0,1,0],[0,0,1]],NF=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],eX=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],gPe=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],yPe=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],bPe=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],kF=b.fromArray,cA=b.transformMat4Offset;function gi(e,t,r,n){var a=function SPe(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r),a=(n+=(t-n%t)%t)>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}(e,t),i=a.length,o=a.width,s=a.height;return{array:n=n&&n.length>=i?n:new r(i),width:o,height:s}}var Ac=b(),_Pe=new Lu("14"),wPe=new Lu("98");function nX(e){return e>1e5?_Pe:wPe}function Ef(e,t,r){var n=3*r,a=nX(t);a.reset();for(var i=0,o=3*t;i<o;i+=n)kF(Ac,e,i),a.includePosition(Ac);for(a.finishedIncludeStep(),i=0,o=3*t;i<o;i+=n)kF(Ac,e,i),a.radiusPosition(Ac);var s=a.getSphere();if(t<=14){var u=[];for(i=0,o=3*t;i<o;i+=n)u.push(kF(b(),e,i));Pe.setExtrema(s,u)}return s}var LF=he();function Qi(e,t,r,n){if(1===r){he.fromArray(LF,t,n);var a=Pe.clone(e);return he.isIdentity(LF)?a:Pe.transform(a,a,LF)}var i=nX(r);i.reset();var o=e.center,s=e.radius,u=e.extrema;if(u&&r<=14){for(var c=0,l=r;c<l;++c)for(var d=0,f=u;d<f.length;d++)cA(Ac,f[d],t,0,0,16*c+n),i.includePosition(Ac);for(i.finishedIncludeStep(),c=0,l=r;c<l;++c)for(var m=0,h=u;m<h.length;m++)cA(Ac,h[m],t,0,0,16*c+n),i.radiusPosition(Ac)}else{for(c=0,l=r;c<l;++c)cA(Ac,o,t,0,0,16*c+n),i.includePositionRadius(Ac,s);for(i.finishedIncludeStep(),c=0,l=r;c<l;++c)cA(Ac,o,t,0,0,16*c+n),i.radiusPositionRadius(Ac,s)}return i.getSphere()}var zo=new Uint8Array(772);function aX(e,t){if(0===t)return 0;var r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,a=4*n,i=0;if(n<0)for(var o=0;o<t;++o)i+=e[o]&&1;else{for(o=0;o<n;++o){var s=r[o];i+=zo[65535&s]+zo[s>>16]}for(o=a;o<t;++o)i+=e[o]&&1}return i/t}function Ia(e,t,r){var n=gi(Math.max(1,e),1,Uint8Array,r&&r.tMarker.ref.value.array),a=aX(n.array,e),i=0===a?0:-1;return r?(O.updateIfChanged(r.uMarker,0),O.update(r.tMarker,n),O.update(r.uMarkerTexDim,Be.create(n.width,n.height)),O.updateIfChanged(r.markerAverage,a),O.updateIfChanged(r.markerStatus,i),O.updateIfChanged(r.dMarkerType,t),r):{uMarker:O.create(0),tMarker:O.create(n),uMarkerTexDim:O.create(Be.create(n.width,n.height)),markerAverage:O.create(a),markerStatus:O.create(i),dMarkerType:O.create(t)}}zo[1]=1,zo[2]=1,zo[3]=1,zo[256]=1,zo[512]=1,zo[768]=1,zo[257]=2,zo[513]=2,zo[769]=2,zo[258]=2,zo[514]=2,zo[770]=2,zo[259]=2,zo[515]=2,zo[771]=2,new Uint8Array(1);var Uu={kind:"null-location"};function oX(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function On(e,t,r,n,a,i){if(void 0===a&&(a=!1),void 0===i&&(i=function(){return!1}),e%r!=0)throw new Error("incompatible groupCount and stride");var o={location:Uu,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,c=0,l=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=c,o.instanceIndex=l,o.index=l*e+c,o.location=n(c,d?-1:l),o.isSecondary=i(c,d?-1:l),(c+=r)===e?(++l,u=!0,l<t&&(c=0)):u=!1,s=c<e),o},reset:function(){o.location=Uu,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,c=0,l=0,d=!1},skipInstance:function(){s&&o.instanceIndex===l&&(++l,c=0,s=l<t)},voidInstances:function(){d=!0}}}function lm(e){return{kind:"position-location",position:e?b.clone(e):b()}}var Xh,sX=Jo();function lA(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=function TPe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if($t(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}(e,t);throw new Error("Framebuffer status: ".concat(r))}}function uX(e){var t=e.createFramebuffer();if(null===t)throw new Error("Could not create WebGL framebuffer");return t}function cX(e){var t=function ZRe(e){if($t(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return null===t?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}(e);if(null===t)throw new Error('Could not find support for "instanced_arrays"');var r=function $Re(e){return $t(e)?{}:e.getExtension("OES_element_index_uint")}(e);if(null===r)throw new Error('Could not find support for "element_index_uint"');var n=function QRe(e){if($t(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return null===t?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}(e);if(null===n)throw new Error('Could not find support for "standard_derivatives"');var a=function eOe(e){return $t(e)?{}:e.getExtension("OES_texture_float")}(e);Cr&&null===a&&console.log('Could not find support for "texture_float"');var i=function tOe(e){return e.getExtension("OES_texture_float_linear")}(e);Cr&&null===i&&console.log('Could not find support for "texture_float_linear"');var o=function rOe(e){if($t(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return null===t?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}(e);Cr&&null===o&&console.log('Could not find support for "texture_half_float"');var s=function nOe(e){return e.getExtension("OES_texture_half_float_linear")}(e);Cr&&null===s&&console.log('Could not find support for "texture_half_float_linear"');var u=function dOe(e){if($t(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return null===t?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}(e);Cr&&null===u&&console.log('Could not find support for "depth_texture"');var c=function aOe(e){if($t(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return null===t?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}(e);Cr&&null===c&&console.log('Could not find support for "blend_minmax"');var l=function JRe(e){if($t(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return null===t?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}(e);Cr&&null===l&&console.log('Could not find support for "vertex_array_object"');var d=function iOe(e){return $t(e)?{}:e.getExtension("EXT_frag_depth")}(e);Cr&&null===d&&console.log('Could not find support for "frag_depth"');var f=function oOe(e){if($t(e))return null===e.getExtension("EXT_color_buffer_float")?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return null===t?(e.getExtension("OES_texture_float"),OX(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}(e);Cr&&null===f&&console.log('Could not find support for "color_buffer_float"');var p=function sOe(e){if($t(e))return null===e.getExtension("EXT_color_buffer_half_float")?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return null===t?(e.getExtension("OES_texture_half_float"),OX(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}(e);Cr&&null===p&&console.log('Could not find support for "color_buffer_half_float"');var m=function uOe(e){if($t(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return null===t?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}(e);Cr&&null===m&&console.log('Could not find support for "draw_buffers"');var h=function cOe(e){var t=e.getExtension("OES_draw_buffers_indexed");return null===t?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}(e);Cr&&null===h&&console.log('Could not find support for "draw_buffers_indexed"');var v=function lOe(e){return $t(e)?{}:e.getExtension("EXT_shader_texture_lod")}(e);Cr&&null===v&&console.log('Could not find support for "shader_texture_lod"');var g=function fOe(e){if($t(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return null===t?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}(e);Cr&&null===g&&console.log('Could not find support for "sRGB"');var y=function pOe(e){var t;return $t(e)?null===(t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"))?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}:null===(t=e.getExtension("EXT_disjoint_timer_query"))?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}(e);Cr&&null===y&&console.log('Could not find support for "disjoint_timer_query"');var S=function mOe(e){var t=e.getExtension("KHR_parallel_shader_compile");return null===t?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}(e);Cr&&null===S&&console.log('Could not find support for "parallel_shader_compile"');var C=function hOe(e){return $t(e)?{}:e.getExtension("OES_fbo_render_mipmap")}(e);Cr&&null===C&&console.log('Could not find support for "fbo_render_mipmap"');var _=function vOe(e){if($t(e)){var t=e.getExtension("WEBGL_provoking_vertex");if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}(e);Cr&&null===_&&console.log('Could not find support for "provoking_vertex"');var x=function gOe(e){if($t(e)){var t=e.getExtension("WEBGL_clip_cull_distance");if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}(e);Cr&&null===x&&console.log('Could not find support for "clip_cull_distance"');var D=function yOe(e){return $t(e)&&e.getExtension("EXT_conservative_depth")?{}:null}(e);Cr&&null===D&&console.log('Could not find support for "conservative_depth"');var w=function bOe(e){if($t(e)){var t=e.getExtension("WEBGL_stencil_texturing");if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}(e);Cr&&null===w&&console.log('Could not find support for "stencil_texturing"');var A=function SOe(e){var t=e.getExtension("EXT_clip_control");return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}(e);Cr&&null===A&&console.log('Could not find support for "clip_control"');var E=function COe(e){if(!$t(e))return!1;if(typeof navigator<"u"){var t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return!t||parseInt(t[1])>=85}return!1}(e);return{instancedArrays:t,standardDerivatives:n,elementIndexUint:r,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,depthTexture:u,blendMinMax:c,vertexArrayObject:l,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:m,drawBuffersIndexed:h,shaderTextureLod:v,sRGB:g,disjointTimerQuery:y,parallelShaderCompile:S,fboRenderMipmap:C,provokingVertex:_,clipCullDistance:x,conservativeDepth:D,stencilTexturing:w,clipControl:A,noNonInstancedActiveAttribs:E}}!function(e){e.create=function t(a,i,o){return{array:a,width:i,height:o}},e.flipY=function r(a){for(var i=a.array,o=a.width,s=a.height,c=o*(i.length/(o*s)),l=0,d=s/2;l<d;++l)for(var f=0,p=c;f<p;++f){var m=l*c+f,h=(s-l-1)*c+f,v=i[m];i[m]=i[h],i[h]=v}return a},e.divideByAlpha=function n(a){for(var i=a.array,o=i instanceof Uint8Array?255:1,s=0,u=i.length;s<u;s+=4){var c=i[s+3]/o;i[s]/=c,i[s+1]/=c,i[s+2]/=c}return a}}(Xh||(Xh={}));var lX=Jo(),wMe={apply_fog:"\nfloat preFogAlpha = gl_FragColor.a;\nif (uFog) {\n    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (!uTransparentBackground) {\n        if (gl_FragColor.a < 1.0) {\n            // transparent objects are blended with background color\n            gl_FragColor.a = fogAlpha;\n        } else {\n            // mix opaque objects with background color\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n        }\n    } else {\n        #if defined(dRenderVariant_colorDpoit)\n            if (gl_FragColor.a < 1.0) {\n                // transparent objects are blended with background color\n                gl_FragColor.a = fogAlpha;\n            } else {\n                // opaque objects need to be pre-multiplied alpha\n                gl_FragColor.rgb *= fogAlpha;\n                gl_FragColor.a = fogAlpha;\n            }\n        #else\n            // pre-multiplied alpha expected for transparent background\n            gl_FragColor.rgb *= fogAlpha;\n            gl_FragColor.a = fogAlpha;\n        #endif\n    }\n}\n",apply_interior_color:"\nif (interior) {\n    if (uInteriorColorFlag) {\n        gl_FragColor.rgb = uInteriorColor;\n    } else {\n        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;\n    }\n\n    #ifdef dTransparentBackfaces_opaque\n        gl_FragColor.a = 1.0;\n    #endif\n}\n",apply_light_color:"\n#ifdef dIgnoreLight\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;\n            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;\n        }\n    #endif\n\n    gl_FragColor = material;\n#else\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);\n        }\n    #endif\n\n    vec4 color = material;\n\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n    PhysicalMaterial physicalMaterial;\n    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);\n    #ifdef enabledFragDepth\n        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);\n    #else\n        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));\n        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);\n    #endif\n    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);\n    physicalMaterial.specularF90 = 1.0;\n\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = normalize(vViewPosition);\n\n    IncidentLight directLight;\n    #pragma unroll_loop_start\n    for (int i = 0; i < dLightCount; ++i) {\n        directLight.direction = uLightDirection[i];\n        directLight.color = uLightColor[i] * PI; // * PI for punctual light\n        RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);\n    }\n    #pragma unroll_loop_end\n\n    vec3 irradiance = uAmbientColor * PI; // * PI for punctual light\n    RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);\n\n    // indirect specular only metals\n    vec3 radiance = uAmbientColor * metalness;\n    vec3 iblIrradiance = uAmbientColor * metalness;\n    vec3 clearcoatRadiance = vec3(0.0);\n    RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background\n\n    gl_FragColor = vec4(outgoingLight, color.a);\n#endif\n\n#if defined(dXrayShaded_on)\n    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#elif defined(dXrayShaded_inverted)\n    gl_FragColor.a *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#endif\n\ngl_FragColor.rgb *= uExposure;\n",apply_marker_color:"\n\n#if defined(dColorMarker)\n    if (marker > 0.0) {\n        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering\n        } else {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering\n        }\n    } else if (uMarkerAverage > 0.0) {\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);\n        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering\n    }\n#endif\n",assign_clipping_varying:"\n#if dClipObjectCount != 0 && defined(dClipping)\n    #if defined(dClippingType_instance)\n        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;\n    #endif\n#endif\n",assign_color_varying:"\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_attribute)\n        vColor.rgb = aColor;\n    #elif defined(dColorType_instance)\n        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n    #elif defined(dColorType_group)\n        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n    #elif defined(dColorType_groupInstance)\n        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n    #elif defined(dColorType_vertex)\n        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_vertexInstance)\n        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_volume)\n        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #elif defined(dColorType_volumeInstance)\n        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #endif\n\n    #ifdef dUsePalette\n        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);\n        #elif defined(dOverpaintType_groupInstance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);\n        #elif defined(dOverpaintType_vertexInstance)\n            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);\n        #elif defined(dOverpaintType_volumeInstance)\n            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;\n            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);\n        #endif\n\n        // pre-mix to avoid darkening due to empty overpaint\n        #ifdef dColorType_uniform\n            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #else\n            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #endif\n        vOverpaint *= uOverpaintStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance)\n            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);\n        #elif defined(dSubstanceType_groupInstance)\n            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);\n        #elif defined(dSubstanceType_vertexInstance)\n            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);\n        #elif defined(dSubstanceType_volumeInstance)\n            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;\n            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);\n        #endif\n\n        // pre-mix to avoid artifacts due to empty substance\n        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);\n        vSubstance *= uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #ifdef requiredDrawBuffers\n        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        vInstance = vec4(packIntToRGB(aInstance), 1.0);\n        vGroup = vec4(packIntToRGB(group), 1.0);\n    #else\n        if (uPickType == 1) {\n            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        } else if (uPickType == 2) {\n            vColor = vec4(packIntToRGB(aInstance), 1.0);\n        } else {\n            vColor = vec4(packIntToRGB(group), 1.0);\n        }\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance)\n        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_groupInstance)\n        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_vertexInstance)\n        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_volumeInstance)\n        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;\n        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;\n    #endif\n    vTransparency *= uTransparencyStrength;\n#endif\n",assign_group:"\n#ifdef dGeometryType_textureMesh\n    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);\n#else\n    float group = aGroup;\n#endif\n",assign_marker_varying:"\n#if defined(dNeedsMarker)\n    #if defined(dMarkerType_instance)\n        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n    #endif\n#endif\n",assign_material_color:"\n#if defined(dNeedsMarker)\n    float marker = uMarker;\n    if (uMarker == -1.0) {\n        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    }\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dUsePalette)\n        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);\n    #elif defined(dColorType_uniform)\n        vec4 material = vec4(uColor, uAlpha);\n    #elif defined(dColorType_varying)\n        vec4 material = vec4(vColor.rgb, uAlpha);\n    #endif\n\n    // mix material with overpaint\n    #if defined(dOverpaint)\n        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);\n    #endif\n\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float bumpiness = uBumpiness;\n    #ifdef dSubstance\n        metalness = mix(metalness, vSubstance.r, vSubstance.a);\n        roughness = mix(roughness, vSubstance.g, vSubstance.a);\n        bumpiness = mix(bumpiness, vSubstance.b, vSubstance.a);\n    #endif\n#elif defined(dRenderVariant_depth)\n    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n        discard;\n    }\n\n    #ifndef dXrayShaded\n        #if defined(dTransparency)\n            float dta = 1.0 - vTransparency;\n            if (vTransparency < 0.2) dta = 1.0; // hard cutoff looks better\n\n            if (uRenderMask == MaskTransparent && uAlpha * dta == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha * dta < 1.0) {\n                discard;\n            }\n        #else\n            if (uRenderMask == MaskTransparent && uAlpha == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha < 1.0) {\n                discard;\n            }\n        #endif\n    #else\n        if (uRenderMask == MaskOpaque) {\n            discard;\n        }\n    #endif\n\n    vec4 material = packDepthToRGBA(fragmentDepth);\n#elif defined(dRenderVariant_marking)\n    vec4 material;\n    if(uMarkingType == 1) {\n        if (marker > 0.0)\n            discard;\n        #ifdef enabledFragDepth\n            material = packDepthToRGBA(gl_FragDepthEXT);\n        #else\n            material = packDepthToRGBA(gl_FragCoord.z);\n        #endif\n    } else {\n        if (marker == 0.0)\n            discard;\n        float depthTest = 1.0;\n        if (uMarkingDepthTest) {\n            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n        }\n        bool isHighlight = intMod(marker, 2.0) > 0.1;\n        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n        if (fogFactor == 1.0)\n            discard;\n        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);\n    }\n#endif\n\n// apply per-group transparency\n#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color))\n    float ta = 1.0 - vTransparency;\n    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better\n\n    #if defined(dRenderVariant_pick)\n        if (ta < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n    #elif defined(dRenderVariant_color)\n        material.a *= ta;\n\n        #if defined(dRenderVariant_colorBlended)\n            #if defined(dTransparentBackfaces_off)\n                if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0) ||\n                    (interior && material.a < 1.0)\n                ) {\n                    discard;\n                }\n            #elif defined(dTransparentBackfaces_on)\n                if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0)\n                ) {\n                    discard;\n                }\n            #elif defined(dTransparentBackfaces_opaque)\n                if (interior) {\n                    material.a = 1.0;\n                } else if (\n                    (uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0)\n                ) {\n                    discard;\n                }\n            #endif\n        #endif\n    #endif\n#endif\n",assign_position:"\nmat4 model = uModel * aTransform;\nmat4 modelView = uView * model;\n#ifdef dGeometryType_textureMesh\n    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;\n#else\n    vec3 position = aPosition;\n#endif\nvec4 position4 = vec4(position, 1.0);\n// for accessing tColorGrid in vert shader and for clipping in frag shader\nvModelPosition = (model * position4).xyz;\nvec4 mvPosition = modelView * position4;\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n",assign_size:"\n#if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);\n#elif defined(dSizeType_group)\n    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);\n#elif defined(dSizeType_groupInstance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size /= 100.0; // NOTE factor also set in TypeScript\n#endif\n\nsize *= uSizeFactor;\n",check_picking_alpha:"\nfloat viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\nfloat fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\nfloat alpha = (1.0 - fogFactor) * uAlpha;\n// if not opaque enough ignore so the element below can be picked\nif (uAlpha < uPickingAlphaThreshold || alpha < 0.1) {\n    #ifdef dTransparentBackfaces_opaque\n        if (!interior) discard;\n    #else\n        discard;\n    #endif\n}\n",clip_instance:"\n#if defined(dClipVariant_instance) && dClipObjectCount != 0\n    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);\n    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w)))\n        // move out of [ -w, +w ] to 'discard' in vert shader\n        gl_Position.z = 2.0 * gl_Position.w;\n#endif\n",clip_pixel:"\n#if defined(dClipVariant_pixel) && dClipObjectCount != 0\n    if (clipTest(vec4(vModelPosition, 0.0)))\n        discard;\n#endif\n",color_frag_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n#ifdef bumpEnabled\n    uniform float uBumpFrequency;\n    uniform float uBumpAmplitude;\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_varying)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        uniform sampler2D tPalette;\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        varying vec4 vOverpaint;\n    #endif\n\n    #ifdef dSubstance\n        varying vec4 vSubstance;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat in vec4 vObject;\n            flat in vec4 vInstance;\n            flat in vec4 vGroup;\n        #else\n            flat in vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    varying float vTransparency;\n#endif\n",color_vert_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_attribute)\n        varying vec4 vColor;\n        attribute vec3 aColor;\n    #elif defined(dColorType_texture)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform sampler2D tColor;\n    #elif defined(dColorType_grid)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform vec3 uColorGridDim;\n        uniform vec4 uColorGridTransform;\n        uniform sampler2D tColorGrid;\n    #elif defined(dColorType_direct)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform sampler2D tOverpaint;\n        #elif defined(dOverpaintType_volumeInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform vec3 uOverpaintGridDim;\n            uniform vec4 uOverpaintGridTransform;\n            uniform sampler2D tOverpaintGrid;\n        #endif\n        uniform float uOverpaintStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform sampler2D tSubstance;\n        #elif defined(dSubstanceType_volumeInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform vec3 uSubstanceGridDim;\n            uniform vec4 uSubstanceGridTransform;\n            uniform sampler2D tSubstanceGrid;\n        #endif\n        uniform float uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat out vec4 vObject;\n            flat out vec4 vInstance;\n            flat out vec4 vGroup;\n        #else\n            flat out vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform sampler2D tTransparency;\n    #elif defined(dTransparencyType_volumeInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform vec3 uTransparencyGridDim;\n        uniform vec4 uTransparencyGridTransform;\n        uniform sampler2D tTransparencyGrid;\n    #endif\n    uniform float uTransparencyStrength;\n#endif\n",common_clip:"\n#if dClipObjectCount != 0\n    vec3 quaternionTransform(const in vec4 q, const in vec3 v) {\n        vec3 t = 2.0 * cross(q.xyz, v);\n        return v + q.w * t + cross(q.xyz, t);\n    }\n\n    vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {\n        return vec4(normalize(normal), -dot(normal, inPoint));\n    }\n\n    float planeSD(const in vec4 plane, const in vec3 center) {\n        return -dot(plane.xyz, center - plane.xyz * -plane.w);\n    }\n\n    float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        return (\n            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0\n        ) * min(min(size.x, size.y), size.z);\n    }\n\n    float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;\n        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));\n    }\n\n    float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n    }\n\n    float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        float q = length(t.xy);\n        return dot(size.xy, vec2(q, t.z));\n    }\n\n    float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale) {\n        if (type == 1) {\n            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));\n            vec4 plane = computePlane(normal, position);\n            return planeSD(plane, center);\n        } else if (type == 2) {\n            return sphereSD(position, rotation, scale * 0.5, center);\n        } else if (type == 3) {\n            return cubeSD(position, rotation, scale * 0.5, center);\n        } else if (type == 4) {\n            return cylinderSD(position, rotation, scale * 0.5, center);\n        } else if (type == 5) {\n            return infiniteConeSD(position, rotation, scale * 0.5, center);\n        } else {\n            return 0.1;\n        }\n    }\n\n    #if __VERSION__ == 100\n        // 8-bit\n        int bitwiseAnd(in int a, in int b) {\n            int d = 128;\n            int result = 0;\n            for (int i = 0; i < 8; ++i) {\n                if (d <= 0) break;\n                if (a >= d && b >= d) result += d;\n                if (a >= d) a -= d;\n                if (b >= d) b -= d;\n                d /= 2;\n            }\n            return result;\n        }\n\n        bool hasBit(const in int mask, const in int bit) {\n            return bitwiseAnd(mask, bit) == 0;\n        }\n    #else\n        bool hasBit(const in int mask, const in int bit) {\n            return (mask & bit) == 0;\n        }\n    #endif\n\n    bool clipTest(const in vec4 sphere) {\n        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)\n        #if defined(dClipping)\n            int flag = int(floor(vClipping * 255.0 + 0.5));\n        #else\n            int flag = 0;\n        #endif\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dClipObjectCount; ++i) {\n            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {\n                // TODO take sphere radius into account?\n                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;\n                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {\n                    return true;\n                }\n            }\n        }\n        #pragma unroll_loop_end\n        return false;\n    }\n#endif\n",common_frag_params:'\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform int uPickType;\nuniform int uMarkingType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat in float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat in float vMarker;\n    #endif\n#endif\n\n#if defined(dRenderVariant_colorDpoit)\n    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript\n    uniform sampler2D tDpoitDepth;\n    uniform sampler2D tDpoitFrontColor;\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\nuniform vec2 uViewOffset;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform bool uTransparentBackground;\n\nuniform bool uDoubleSided;\nuniform float uInteriorDarkening;\nuniform bool uInteriorColorFlag;\nuniform vec3 uInteriorColor;\nbool interior;\n\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform mat4 uProjection;\n\nuniform int uRenderMask;\nuniform bool uMarkingDepthTest;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nfloat getDepthPacked(const in vec2 coords) {\n    return unpackRGBAToDepth(texture2D(tDepth, coords));\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\n// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\nvec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {\n    vec3 sigmaS = dFdx(position);\n    vec3 sigmaT = dFdy(position);\n\n    vec3 r1 = cross(sigmaT, normal);\n    vec3 r2 = cross(normal, sigmaS);\n    float det = dot(sigmaS, r1);\n\n    float bs = dFdx(height);\n    float bt = dFdy(height);\n\n    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);\n    return normalize(abs(det) * normal - scale * surfGrad);\n}\n\nfloat hash(in float h) {\n    return fract(sin(h) * 43758.5453123);\n}\n\nfloat noise(in vec3 x) {\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f * f * (3.0 - 2.0 * f);\n\n    float n = p.x + p.y * 157.0 + 113.0 * p.z;\n    return mix(\n        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\n            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\n        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\n            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);\n}\n\nfloat fbm(in vec3 p) {\n    float f = 0.0;\n    f += 0.5 * noise(p);\n    p *= 2.01;\n    f += 0.25 * noise(p);\n    p *= 2.02;\n    f += 0.125 * noise(p);\n\n    return f;\n}\n',common_vert_params:"\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\nuniform vec4 uInvariantBoundingSphere;\n\nuniform bool uDoubleSided;\nuniform int uPickType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        uniform vec2 uClippingTexDim;\n        uniform sampler2D tClipping;\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat out float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat out float vMarker;\n    #endif\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\n#if defined(noNonInstancedActiveAttribs)\n    // int() is needed for some Safari versions\n    // see https://bugs.webkit.org/show_bug.cgi?id=244152\n    #define VertexID int(gl_VertexID)\n#else\n    attribute float aVertex;\n    #define VertexID int(aVertex)\n#endif\n",common:"\n// TODO find a better place for these convenience defines\n\n#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)\n    #define dRenderVariant_color\n#endif\n\n#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)\n    #define dColorType_texture\n#endif\n\n#if defined(dColorType_volume) || defined(dColorType_volumeInstance)\n    #define dColorType_grid\n#endif\n\n#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)\n    #define dColorType_varying\n#endif\n\n#if (defined(dRenderVariant_color) && defined(dColorMarker)) || defined(dRenderVariant_marking)\n    #define dNeedsMarker\n#endif\n\n#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)\n    #define dXrayShaded\n#endif\n\n#define MaskAll 0\n#define MaskOpaque 1\n#define MaskTransparent 2\n\n//\n\n#define PI 3.14159265\n#define RECIPROCAL_PI 0.31830988618\n#define EPSILON 1e-6\n\n#define saturate(a) clamp(a, 0.0, 1.0)\n\n#if __VERSION__ == 100\n    #define round(x) floor((x) + 0.5)\n#endif\n\nfloat intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }\nvec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }\nfloat intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }\nint imod(const in int a, const in int b) { return a - b * (a / b); }\n\nfloat pow2(const in float x) { return x * x; }\n\nvec3 packIntToRGB(in float value) {\n    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\nfloat unpackRGBToInt(const in vec3 rgb) {\n    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;\n}\n\nvec2 packUnitIntervalToRG(const in float v) {\n    vec2 enc;\n    enc.xy = vec2(fract(v * 256.0), v);\n    enc.y -= enc.x * (1.0 / 256.0);\n    enc.xy *=  256.0 / 255.0;\n\n    return enc;\n}\n\nfloat unpackRGToUnitInterval(const in vec2 enc) {\n    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));\n}\n\nvec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {\n    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);\n    p = invProjection * p;\n    return p.xyz / p.w;\n}\n\nconst float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)\nconst vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);\n}\n\nfloat linearizeDepth(const in float depth, const in float near, const in float far) {\n    return (2.0 * near) / (far + near - depth * (far - near));\n}\n\nfloat perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {\n    return (near * far) / ((far - near) * invClipZ - far);\n}\n\nfloat orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {\n    return linearClipZ * (near - far) - near;\n}\n\nfloat depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {\n    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);\n}\n\n#if __VERSION__ == 100\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose2(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose3(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose4(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    // inverse\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    mat2 inverse2(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse3(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse4(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n\n    #define isNaN(x) ((x) != (x))\n    #define isInf(x) ((x) == (x) + 1.0)\n#else\n    #define transpose2(m) transpose(m)\n    #define transpose3(m) transpose(m)\n    #define transpose4(m) transpose(m)\n\n    #define inverse2(m) inverse(m)\n    #define inverse3(m) inverse(m)\n    #define inverse4(m) inverse(m)\n\n    #define isNaN isnan\n    #define isInf isinf\n#endif\n",float_to_rgba:"\n    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba\n    // MIT License, Copyright (c) 2020 Equinor\n\n    float shiftRight (float v, float amt) {\n    v = floor(v) + 0.5;\n    return floor(v / exp2(amt));\n    }\n    float shiftLeft (float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n    }\n    float maskLast (float v, float bits) {\n        return mod(v, shiftLeft(1.0, bits));\n    }\n    float extractBits (float num, float from, float to) {\n        from = floor(from + 0.5); to = floor(to + 0.5);\n        return maskLast(shiftRight(num, from), to - from);\n    }\n\n    vec4 floatToRgba(float texelFloat, bool littleEndian) {\n        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);\n        float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n        texelFloat = abs(texelFloat);\n        float exponent = floor(log2(texelFloat));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return (\n            littleEndian\n                ? vec4(byte4, byte3, byte2, byte1)\n                : vec4(byte1, byte2, byte3, byte4)\n        );\n    }\n",light_frag_params:"\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\nuniform vec3 uAmbientColor;\n\nstruct PhysicalMaterial {\n    vec3 diffuseColor;\n    float roughness;\n    vec3 specularColor;\n    float specularF90;\n};\n\nstruct IncidentLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n    vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n    vec3 position;\n    vec3 normal;\n    vec3 viewDir;\n};\n\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {\n    // Original approximation by Christophe Schlick '94\n    // float fresnel = pow( 1.0 - dotVH, 5.0 );\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\n    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);\n    return f0 * (1.0 - fresnel) + (f90 * fresnel);\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {\n    float a2 = pow2(alpha);\n    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\n    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\n    return 0.5 / max(gv + gl, EPSILON);\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\nfloat D_GGX(const in float alpha, const in float dotNH) {\n    float a2 = pow2(alpha);\n    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1\n    return RECIPROCAL_PI * a2 / pow2(denom);\n}\n\n// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\nvec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {\n    float alpha = pow2(roughness); // UE4's roughness\n    vec3 halfDir = normalize( lightDir + viewDir);\n    float dotNL = saturate(dot(normal, lightDir));\n    float dotNV = saturate(dot(normal, viewDir));\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotVH = saturate(dot(viewDir, halfDir));\n    vec3 F = F_Schlick(f0, f90, dotVH);\n    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return F * (V * D);\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via 'environmentBRDF' from \"Physically Based Shading on Mobile\"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n    float dotNV = saturate(dot(normal, viewDir));\n    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n    vec4 r = roughness * c0 + c1;\n    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;\n    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;\n    return fab;\n}\n\n// Fdez-Ag\xfcera's \"Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting\"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\n    vec2 fab = DFGApprox(normal, viewDir, roughness);\n    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n    float Ess = fab.x + fab.y;\n    float Ems = 1.0 - Ess;\n    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21\n    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\n    singleScatter += FssEss;\n    multiScatter += Fms * Ems;\n}\n\nvoid RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    float dotNL = saturate(dot(geometry.normal, directLight.direction));\n    vec3 irradiance = dotNL * directLight.color;\n    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\n    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    // Both indirect specular and indirect diffuse light accumulate here\n    vec3 singleScattering = vec3(0.0);\n    vec3 multiScattering = vec3(0.0);\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);\n    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));\n    reflectedLight.indirectSpecular += radiance * singleScattering;\n    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n",matrix_scale:"\nfloat matrixScale(in mat4 m){\n    vec4 r = m[0];\n    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);\n}\n",normal_frag_params:"\nvarying vec3 vNormal;\n",read_from_texture:"\nvec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\nvec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {\n    int x = imod(i, int(dim.x));\n    int y = i / int(dim.x);\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n",rgba_to_float:'\n    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float\n    // BSD 3-Clause License\n    //\n    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.\n    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n    //\n    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n    // OF THE POSSIBILITY OF SUCH DAMAGE.\n\n    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n        ivec4 bytes = ivec4(inputFloats * 255.0);\n        return (\n            littleEndian\n                ? bytes.abgr\n                : bytes\n        );\n    }\n\n    // Break the four bytes down into an array of 32 bits.\n    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n            float acc = float(bytes[channelIndex]);\n            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n                float powerOfTwo = exp2(float(indexInByte));\n                bool bit = acc >= powerOfTwo;\n                bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n                acc = mod(acc, powerOfTwo);\n            }\n        }\n    }\n\n    // Compute the exponent of the 32-bit float.\n    float getExponent(bool bits[32]) {\n        const int startIndex = 1;\n        const int bitStringLength = 8;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        float acc = 0.0;\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Compute the mantissa of the 32-bit float.\n    float getMantissa(bool bits[32], bool subnormal) {\n        const int startIndex = 9;\n        const int bitStringLength = 23;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        // Leading/implicit/hidden bit convention:\n        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n        float acc = float(!subnormal) * exp2(float(bitStringLength));\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Parse the float from its 32 bits.\n    float bitsToFloat(bool bits[32]) {\n        float signBit = float(bits[0]) * -2.0 + 1.0;\n        float exponent = getExponent(bits);\n        bool subnormal = abs(exponent - 0.0) < 0.01;\n        float mantissa = getMantissa(bits, subnormal);\n        float exponentBias = 127.0;\n        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n    }\n\n    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n        bool bits[32];\n        bytesToBits(rgbaBytes, bits);\n        return bitsToFloat(bits);\n    }\n',size_vert_params:"\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n#endif\n\nuniform float uSizeFactor;\n",texture3d_from_1d_trilinear:"\nvec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {\n    float gdYZ = gridDim.z * gridDim.y;\n    float gdZ = gridDim.z;\n    vec3 p0 = floor(pos * gridDim);\n    vec3 p1 = ceil(pos * gridDim);\n    vec3 pd = (pos * gridDim - p0) / (p1 - p0);\n    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s00 = mix(s000, s100, pd.x);\n    vec4 s01 = mix(s001, s101, pd.x);\n    vec4 s10 = mix(s010, s110, pd.x);\n    vec4 s11 = mix(s011, s111, pd.x);\n    vec4 s0 = mix(s00, s10, pd.y);\n    vec4 s1 = mix(s01, s11, pd.y);\n    return mix(s0, s1, pd.z);\n}\n",texture3d_from_2d_linear:"\nvec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice0 = floor(pos.z * gridDim.z);\n    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;\n    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));\n    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color0 = texture2D(tex, coord0);\n\n    float zSlice1 = zSlice0 + 1.0;\n    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;\n    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));\n    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color1 = texture2D(tex, coord1);\n\n    float delta0 = abs((pos.z * gridDim.z) - zSlice0);\n    return mix(color0, color1, delta0);\n}\n",texture3d_from_2d_nearest:"\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n",wboit_write:"\n#if defined(dRenderVariant_colorWboit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n            float alpha = gl_FragColor.a;\n            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);\n            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);\n            // extra alpha is to handle pre-multiplied alpha\n            #ifndef dGeometryType_directVolume\n                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);\n            #else\n                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);\n            #endif\n        } else {\n            discard;\n        }\n    }\n#endif\n",dpoit_write:"\n#if defined(dRenderVariant_colorDpoit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n\n            // adapted from https://github.com/tsherif/webgl2examples\n            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao\n\n            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;\n            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);\n\n            vec4 fragColor = gl_FragColor;\n\n            // depth value always increases\n            // so we can use MAX blend equation\n            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);\n\n            // front color always increases\n            // so we can use MAX blend equation\n            gl_FragColor = lastFrontColor;\n\n            // back color is separately blend afterwards each pass\n            gl_FragData[1] = vec4(0.0);\n\n            float nearestDepth = -lastDepth.x;\n            float furthestDepth = lastDepth.y;\n            float alphaMultiplier = 1.0 - lastFrontColor.a;\n\n            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {\n                // Skip this depth since it's been peeled.\n                return;\n            }\n\n            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {\n                // This needs to be peeled.\n                // The ones remaining after MAX blended for\n                // all need-to-peel will be peeled next pass.\n                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);\n                return;\n            }\n\n            // write to back and front color buffer\n            if (fragmentDepth == nearestDepth) {\n                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;\n                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);\n            } else {\n                gl_FragData[1] += fragColor;\n            }\n\n        } else {\n            discard;\n        }\n    }\n#endif\n"},AMe=/^(?!\/\/)\s*#include\s+(\S+)/gm,TMe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,DMe=/[ \t]*\/\/.*\n/g,EMe=/[ \t]*\/\*[\s\S]*?\*\//g,IMe=/\n{2,}/g;function dX(e){return e.replace(AMe,function(t,r){var n=wMe[r];if(!n)throw new Error("empty chunk, '".concat(r,"'"));return n}).trim().replace(DMe,"\n").replace(EMe,"\n").replace(IMe,"\n")}function MMe(e,t,r,n){for(var a="",i=parseInt(t);i<parseInt(r);++i)a+=n.replace(/\[\s*i\s*\]/g,"[".concat(i,"]")).replace(/UNROLLED_LOOP_INDEX/g,"".concat(i));return a}function fX(e,t){return function PMe(e){return e.replace(TMe,MMe)}(function RMe(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,"".concat(t.dLightCount.ref.value))),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,"".concat(t.dClipObjectCount.ref.value))),e}(e,t))}function Fn(e,t,r,n,a,i){return void 0===n&&(n={}),void 0===a&&(a={}),{id:lX(),name:e,vert:dX(t),frag:dX(r),extensions:n,outTypes:a,ignoreDefine:i}}function FS(e,t,r){var n;return t.startsWith("color")?"dLightCount"===e&&!(null===(n=r.dIgnoreLight)||void 0===n||!n.ref.value):["dColorType","dUsePalette","dLightCount","dXrayShaded","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker"].includes(e)}function dA(e,t,r){return"dLightCount"===e||FS(e,t,r)}var OMe=Fn("points","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvoid main(){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_size\n\n    #ifdef dPointSizeAttenuation\n        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;\n    #else\n        gl_PointSize = size * uPixelRatio;\n    #endif\n    gl_PointSize = max(1.0, gl_PointSize);\n\n    gl_Position = uProjection * mvPosition;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nconst vec2 center = vec2(0.5);\nconst float radius = 0.5;\n\nvoid main(){\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dPointStyle_circle)\n        float dist = distance(gl_PointCoord, center);\n        if (dist > radius) discard;\n    #elif defined(dPointStyle_fuzzy)\n        float dist = distance(gl_PointCoord, center);\n        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);\n        if (fuzzyAlpha < 0.0001) discard;\n    #endif\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #if defined(dPointStyle_fuzzy)\n            gl_FragColor.a *= fuzzyAlpha;\n        #endif\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},dA),FMe=Fn("spheres","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\nuniform mat4 uInvProjection;\nuniform float uIsOrtho;\n\nuniform vec2 uTexDim;\nuniform sampler2D tPositionGroup;\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#include matrix_scale\n\n/**\n * Bounding rectangle of a clipped, perspective-projected 3D Sphere.\n * Michael Mara, Morgan McGuire. 2013\n *\n * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018\n * https://github.com/zeux/niagara\n */\nvoid sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {\n    vec3 pr = p * r;\n    float pzr2 = p.z * p.z - r * r;\n\n    float vx = sqrt(p.x * p.x + pzr2);\n    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];\n    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];\n\n    float vy = sqrt(p.y * p.y + pzr2);\n    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];\n    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];\n\n    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;\n    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;\n    gl_Position.xy *= gl_Position.w;\n}\n\nvoid main(void){\n    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5\n    #if __VERSION__ == 100\n        int m = imod(VertexID, 6);\n    #else\n        int m = VertexID % 6;\n    #endif\n    if (m == 0) {\n        mapping = vec2(-1.0, 1.0);\n    } else if (m == 1 || m == 3) {\n        mapping = vec2(-1.0, -1.0);\n    } else if (m == 4) {\n        mapping = vec2(1.0, -1.0);\n    }\n\n    vec4 positionGroup = readFromTexture(tPositionGroup, VertexID / 6, uTexDim);\n    vec3 position = positionGroup.rgb;\n    float group = positionGroup.a;\n\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vRadius = size * matrixScale(uModelView);\n\n    vec4 position4 = vec4(position, 1.0);\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    #ifdef dApproximate\n        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n        mvCorner.xy += mapping * vRadius;\n        gl_Position = uProjection * mvCorner;\n    #else\n        if (uIsOrtho == 1.0) {\n            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n            mvCorner.xy += mapping * vRadius;\n            gl_Position = uProjection * mvCorner;\n        } else {\n            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n            sphereProjection(mvPosition.xyz, vRadius, mapping);\n        }\n    #endif\n\n    vec4 vPoint4 = uInvProjection * gl_Position;\n    vPoint = vPoint4.xyz / vPoint4.w;\n    vPointViewPosition = -mvPosition.xyz / mvPosition.w;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * vRadius; // avoid clipping\n        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;\n    }\n\n    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0\n        if (clipTest(vec4(vModelPosition.xyz, 0.0))) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    #else\n        #include clip_instance\n    #endif\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\nuniform mat4 uInvView;\nuniform float uAlphaThickness;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\nbool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){\n    vec3 cameraSpherePos = -vPointViewPosition;\n\n    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);\n    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);\n\n    float B = dot(rayDirection, cameraSphereDir);\n    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);\n\n    if (det < 0.0) return false;\n\n    float sqrtDet = sqrt(det);\n    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);\n    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);\n\n    cameraPos = rayDirection * negT + rayOrigin;\n    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n    fragmentDepth = calcDepth(cameraPos);\n\n    bool objectClipped = false;\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        if (clipTest(vec4(modelPos, 0.0))) {\n            objectClipped = true;\n            fragmentDepth = -1.0;\n        }\n    #endif\n\n    if (fragmentDepth > 0.0) {\n        cameraNormal = normalize(cameraPos - cameraSpherePos);\n        interior = false;\n        return true;\n    } else if (uDoubleSided || solidInterior) {\n        cameraPos = rayDirection * posT + rayOrigin;\n        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n        fragmentDepth = calcDepth(cameraPos);\n        cameraNormal = -normalize(cameraPos - cameraSpherePos);\n        interior = true;\n        if (fragmentDepth > 0.0) {\n            #ifdef dSolidInterior\n                if (!objectClipped) {\n                    fragmentDepth = 0.0 + (0.0000001 / vRadius);\n                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n                }\n            #endif\n            return true;\n        }\n    }\n\n    return false;\n}\n\nvoid main(void){\n    vec3 cameraNormal;\n    float fragmentDepth;\n\n    #ifdef dApproximate\n        vec3 pointDir = -vPointViewPosition - vPoint;\n        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;\n        vec3 vViewPosition = -vPointViewPosition;\n        fragmentDepth = gl_FragCoord.z;\n        #if !defined(dIgnoreLight) || defined(dXrayShaded)\n            pointDir.z -= cos(length(pointDir) / vRadius);\n            cameraNormal = -normalize(pointDir / vRadius);\n        #endif\n        interior = false;\n    #else\n        vec3 modelPos;\n        vec3 cameraPos;\n        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);\n        if (!hit) discard;\n\n        if (fragmentDepth < 0.0) discard;\n        if (fragmentDepth > 1.0) discard;\n\n        gl_FragDepthEXT = fragmentDepth;\n\n        vec3 vModelPosition = modelPos;\n        vec3 vViewPosition = cameraPos;\n    #endif\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        #include clip_pixel\n    #endif\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        vec3 normal = -cameraNormal;\n        #include apply_light_color\n\n        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {\n            gl_FragColor.a *= min(1.0, vRadius / uAlphaThickness);\n        }\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},FS),BMe=Fn("cylinders","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec3 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\nattribute float aScale;\nattribute float aCap;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform float uIsOrtho;\nuniform vec3 uCameraDir;\n\nvoid main() {\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelTransform = uModel * aTransform;\n\n    vTransform = aTransform;\n    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;\n    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;\n    vSize = size * aScale;\n    vCap = aCap;\n\n    vModelPosition = (vStart + vEnd) * 0.5;\n    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 dir = vEnd - vStart;\n    // ensure cylinder 'dir' is pointing towards the camera\n    if(dot(camDir, dir) < 0.0) {\n        dir = -dir;\n    }\n\n    vec3 left = cross(camDir, dir);\n    vec3 up = cross(left, dir);\n    left = vSize * normalize(left);\n    up = vSize * normalize(up);\n\n    // move vertex in object-space from center to corner\n    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;\n\n    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);\n    vViewPosition = mvPosition.xyz;\n    gl_Position = uProjection * mvPosition;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping\n        gl_Position.z = (uProjection * mvPosition).z;\n    }\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\nuniform mat4 uView;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform vec3 uCameraDir;\nuniform vec3 uCameraPosition;\nuniform mat4 uInvView;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\n// adapted from https://www.shadertoy.com/view/4lcSRn\n// The MIT License, Copyright 2016 Inigo Quilez\nbool CylinderImpostor(\n    in vec3 rayOrigin, in vec3 rayDir,\n    in vec3 start, in vec3 end, in float radius,\n    out vec3 cameraNormal, out bool interior,\n    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth\n){\n    vec3 ba = end - start;\n    vec3 oc = rayOrigin - start;\n\n    float baba = dot(ba, ba);\n    float bard = dot(ba, rayDir);\n    float baoc = dot(ba, oc);\n\n    float k2 = baba - bard * bard;\n    float k1 = baba * dot(oc, rayDir) - baoc * bard;\n    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;\n\n    float h = k1 * k1 - k2 * k0;\n    if (h < 0.0) return false;\n\n    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;\n    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;\n\n    #ifdef dSolidInterior\n        bool topInterior = !topCap;\n        bool bottomInterior = !bottomCap;\n        topCap = true;\n        bottomCap = true;\n    #else\n        bool topInterior = false;\n        bool bottomInterior = false;\n    #endif\n\n    bool clipped = false;\n    bool objectClipped = false;\n\n    // body outside\n    h = sqrt(h);\n    float t = (-k1 - h) / k2;\n    float y = baoc + t * bard;\n    if (y > 0.0 && y < baba) {\n        interior = false;\n        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;\n        modelPosition = rayOrigin + t * rayDir;\n        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n        fragmentDepth = calcDepth(viewPosition);\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            if (clipTest(vec4(modelPosition, 0.0))) {\n                objectClipped = true;\n                fragmentDepth = -1.0;\n                #ifdef dSolidInterior\n                    topCap = !topInterior;\n                    bottomCap = !bottomInterior;\n                #endif\n            }\n        #endif\n        if (fragmentDepth > 0.0) return true;\n        clipped = true;\n    }\n\n    if (!clipped) {\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = topInterior;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = bottomInterior;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    if (uDoubleSided || solidInterior) {\n        // body inside\n        h = -h;\n        t = (-k1 - h) / k2;\n        y = baoc + t * bard;\n        if (y > 0.0 && y < baba) {\n            interior = true;\n            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;\n            modelPosition = rayOrigin + t * rayDir;\n            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n            fragmentDepth = calcDepth(viewPosition);\n            if (fragmentDepth > 0.0) {\n                #ifdef dSolidInterior\n                    if (!objectClipped) {\n                        fragmentDepth = 0.0 + (0.0000002 / vSize);\n                        cameraNormal = -rayDir;\n                    }\n                #endif\n                return true;\n            }\n        }\n\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    return false;\n}\n\nvoid main() {\n    vec3 rayOrigin = vModelPosition;\n    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n\n    vec3 cameraNormal;\n    vec3 modelPosition;\n    vec3 viewPosition;\n    float fragmentDepth;\n    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);\n    if (!hit) discard;\n\n    if (fragmentDepth < 0.0) discard;\n    if (fragmentDepth > 1.0) discard;\n\n    gl_FragDepthEXT = fragmentDepth;\n\n    vec3 vViewPosition = viewPosition;\n    vec3 vModelPosition = modelPosition;\n\n    #include clip_pixel\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        mat3 normalMatrix = transpose3(inverse3(mat3(uView)));\n        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},FS),NMe=Fn("text","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute float aDepth;\nattribute vec2 aTexCoord;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nuniform float uOffsetX;\nuniform float uOffsetY;\nuniform float uOffsetZ;\n\nuniform float uIsOrtho;\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nvarying vec2 vTexCoord;\n\n#include matrix_scale\n\nvoid main(void){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vTexCoord = aTexCoord;\n\n    float scale = matrixScale(uModelView);\n\n    float offsetX = uOffsetX * scale;\n    float offsetY = uOffsetY * scale;\n    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;\n\n    vec4 position4 = vec4(aPosition, 1.0);\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // TODO\n    // #ifdef FIXED_SIZE\n    //     if (ortho) {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;\n    //     } else {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;\n    //     }\n    // #endif\n\n    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n\n    if (vTexCoord.x == 10.0) { // indicates background plane\n        // move a bit to the back, taking distance to camera into account to avoid z-fighting\n        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);\n    }\n\n    mvCorner.xy += aMapping * size * scale;\n    mvCorner.x += offsetX;\n    mvCorner.y += offsetY;\n\n    if (uIsOrtho == 1.0) {\n        mvCorner.z += offsetZ;\n    } else {\n        mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n    }\n\n    gl_Position = uProjection * mvCorner;\n\n    vViewPosition = -mvCorner.xyz;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nuniform sampler2D tFont;\n\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform vec3 uBackgroundColor;\nuniform float uBackgroundOpacity;\n\nvarying vec2 vTexCoord;\n\nconst float smoothness = 32.0;\nconst float gamma = 2.2;\n\nvoid main2(){\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid main(){\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    if (vTexCoord.x > 1.0) {\n        #if defined(dRenderVariant_color)\n            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);\n        #endif\n    } else {\n        // retrieve signed distance\n        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;\n\n        // perform adaptive anti-aliasing of the edges\n        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);\n        float a = smoothstep(0.5 - w, 0.5 + w, sdf);\n\n        // gamma correction for linear attenuation\n        a = pow(a, 1.0 / gamma);\n\n        if (a < 0.5) discard;\n\n        #if defined(dRenderVariant_color)\n            material.a *= a;\n\n            // add border\n            float t = 0.5 + uBorderWidth;\n            if (uBorderWidth > 0.0 && sdf < t) {\n                material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));\n            }\n        #endif\n    }\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},dA),kMe=Fn("lines","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec2 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n    // trim end segment so it terminates between the camera plane and the near plane\n    // conservative estimate of the near plane\n    float a = uProjection[2][2];  // 3rd entry in 3rd column\n    float b = uProjection[3][2];  // 3rd entry in 4th column\n    float nearEstimate = -0.5 * b / a;\n    float alpha = (nearEstimate - start.z) / (end.z - start.z);\n    end.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main(){\n    float aspect = uViewport.z / uViewport.w;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelView = uView * uModel * aTransform;\n\n    // camera space\n    vec4 start = modelView * vec4(aStart, 1.0);\n    vec4 end = modelView * vec4(aEnd, 1.0);\n\n    // assign position\n    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);\n    vec4 mvPosition = modelView * position4;\n    vViewPosition = mvPosition.xyz;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n    // perhaps there is a more elegant solution -- WestLangley\n    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column\n    if (perspective) {\n        if (start.z < 0.0 && end.z >= 0.0) {\n            trimSegment(start, end);\n        } else if (end.z < 0.0 && start.z >= 0.0) {\n            trimSegment(end, start);\n        }\n    }\n\n    // clip space\n    vec4 clipStart = uProjection * start;\n    vec4 clipEnd = uProjection * end;\n\n    // ndc space\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n    // direction\n    vec2 dir = ndcEnd - ndcStart;\n\n    // account for clip-space aspect ratio\n    dir.x *= aspect;\n    dir = normalize(dir);\n\n    // perpendicular to dir\n    vec2 offset = vec2(dir.y, - dir.x);\n\n    // undo aspect ratio adjustment\n    dir.x /= aspect;\n    offset.x /= aspect;\n\n    // sign flip\n    if (aMapping.x < 0.0) offset *= -1.0;\n\n    // calculate linewidth\n    float linewidth;\n    #ifdef dLineSizeAttenuation\n        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;\n    #else\n        linewidth = size * uPixelRatio;\n    #endif\n    linewidth = max(1.0, linewidth);\n\n    // adjust for linewidth\n    offset *= linewidth;\n\n    // adjust for clip-space to screen-space conversion\n    offset /= uViewport.w;\n\n    // select end\n    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;\n\n    // back to clip space\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position = clip;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nvoid main(){\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},dA),pX=Fn("mesh","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include common_clip\n#include texture3d_from_2d_linear\n\n#ifdef dGeometryType_textureMesh\n    uniform vec2 uGeoTexDim;\n    uniform sampler2D tPosition;\n    uniform sampler2D tGroup;\n    uniform sampler2D tNormal;\n#else\n    attribute vec3 aPosition;\n    attribute float aGroup;\n    attribute vec3 aNormal;\n#endif\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec3 vNormal;\n\nvoid main(){\n    #include assign_group\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_color_varying\n    #include clip_instance\n\n    #ifdef dGeometryType_textureMesh\n        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;\n    #else\n        vec3 normal = aNormal;\n    #endif\n    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));\n    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));\n    #if defined(dFlipSided)\n        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR\n            transformedNormal = -transformedNormal;\n        }\n    #endif\n    vNormal = transformedNormal;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include normal_frag_params\n#include common_clip\n\nvoid main() {\n    #include clip_pixel\n\n    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)\n    vec3 fdx = dFdx(vViewPosition);\n    vec3 fdy = dFdy(vViewPosition);\n    vec3 faceNormal = normalize(cross(fdx,fdy));\n    bool frontFacing = dot(vNormal, faceNormal) > 0.0;\n\n    #if defined(dFlipSided)\n        interior = frontFacing;\n    #else\n        interior = !frontFacing;\n    #endif\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        #if defined(dFlatShaded)\n            vec3 normal = -faceNormal;\n        #else\n            vec3 normal = -normalize(vNormal);\n            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;\n        #endif\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},FS),LMe=Fn("direct-volume","\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform mat4 uModelView;\nuniform mat4 uProjection;\nuniform vec4 uInvariantBoundingSphere;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform mat4 uTransform;\n\nuniform mat4 uUnitToCartn;\n\nvoid main() {\n    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);\n    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;\n\n    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;\n    vInstance = aInstance;\n    vBoundingSphere = vec4(\n        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,\n        uInvariantBoundingSphere.w\n    );\n    vTransform = aTransform;\n\n    gl_Position = uProjection * mvPosition;\n\n    // move z position to near clip plane (but not too close to get precision issues)\n    gl_Position.z = gl_Position.w - 0.01;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include light_frag_params\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n#endif\n#include common_clip\n\n#include read_from_texture\n#include texture3d_from_1d_trilinear\n#include texture3d_from_2d_nearest\n#include texture3d_from_2d_linear\n\nuniform mat4 uProjection, uTransform, uModelView, uModel, uView;\nuniform vec3 uCameraDir;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform mat4 uInvView;\nuniform vec3 uGridDim;\nuniform vec3 uBboxSize;\nuniform sampler2D tTransferTex;\nuniform float uTransferScale;\nuniform float uStepScale;\nuniform float uJumpLength;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n#endif\n\nuniform float uMetalness;\nuniform float uRoughness;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform bool uTransparentBackground;\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform int uRenderMask;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform vec3 uCellDim;\nuniform vec3 uCameraPosition;\nuniform mat4 uCartnToUnit;\n\n#if __VERSION__ != 100\n    // for webgl1 this is given as a 'define'\n    uniform int uMaxSteps;\n#endif\n\n#if defined(dGridTexType_2d)\n    precision highp sampler2D;\n    uniform sampler2D tGridTex;\n    uniform vec3 uGridTexDim;\n#elif defined(dGridTexType_3d)\n    precision highp sampler3D;\n    uniform sampler3D tGridTex;\n#endif\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_texture)\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#endif\n\n#ifdef dOverpaint\n    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n        uniform vec2 uOverpaintTexDim;\n        uniform sampler2D tOverpaint;\n    #endif\n#endif\n\n#ifdef dUsePalette\n    uniform sampler2D tPalette;\n#endif\n\n#if defined(dGridTexType_2d)\n    vec4 textureVal(vec3 pos) {\n        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n#elif defined(dGridTexType_3d)\n    vec4 textureVal(vec3 pos) {\n        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);\n    }\n#endif\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat transferFunction(float value) {\n    return texture2D(tTransferTex, vec2(value, 0.0)).a;\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nconst float gradOffset = 0.5;\n\nvec3 v3m4(vec3 p, mat4 m) {\n    return (m * vec4(p, 1.0)).xyz;\n}\n\nfloat preFogAlphaBlended = 0.0;\n\nvec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {\n    mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));\n    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);\n    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n        mat4 modelTransform = uModel * vTransform * uTransform;\n    #endif\n    mat4 modelViewTransform = uModelView * vTransform * uTransform;\n\n    vec3 scaleVol = vec3(1.0) / uGridDim;\n    vec3 pos = startLoc;\n    vec4 cell;\n    float prevValue = -1.0;\n    float value = 0.0;\n    vec4 src = vec4(0.0);\n    vec4 dst = vec4(0.0);\n    float fragmentDepth;\n\n    vec3 posMin = vec3(0.0);\n    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;\n\n    vec3 unitPos;\n\n    vec3 nextPos;\n    float nextValue;\n\n    vec4 material;\n    vec4 overpaint;\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n\n    vec3 gradient = vec3(1.0);\n    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);\n    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);\n    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);\n\n    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);\n    float maxDistSq = maxDist * maxDist;\n\n    for (int i = 0; i < uMaxSteps; ++i) {\n        // break when beyond bounding-sphere or far-plane\n        vec3 distVec = startLoc - pos;\n        if (dot(distVec, distVec) > maxDistSq) break;\n\n        unitPos = v3m4(pos, cartnToUnit);\n\n        // continue when outside of grid\n        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||\n            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z\n        ) {\n            prevValue = value;\n            pos += step;\n            continue;\n        }\n\n        cell = textureVal(unitPos);\n        value = cell.a; // current voxel value\n\n        if (uJumpLength > 0.0 && value < 0.01) {\n            nextPos = pos + rayDir * uJumpLength;\n            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;\n            if (nextValue < 0.01) {\n                prevValue = nextValue;\n                pos = nextPos;\n                continue;\n            }\n        }\n\n        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);\n        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))\n            break;\n\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);\n            if (clipTest(vec4(vModelPosition, 0.0))) {\n                prevValue = value;\n                pos += step;\n                continue;\n            }\n        #endif\n\n        vec3 vViewPosition = mvPosition.xyz;\n        material.a = transferFunction(value);\n\n        #ifdef dPackedGroup\n            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);\n        #else\n            vec3 g = floor(unitPos * uGridDim + 0.5);\n            // note that we swap x and z because the texture is flipped around y\n            #if defined(dAxisOrder_012)\n                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210\n            #elif defined(dAxisOrder_021)\n                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120\n            #elif defined(dAxisOrder_102)\n                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201\n            #elif defined(dAxisOrder_120)\n                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021\n            #elif defined(dAxisOrder_201)\n                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102\n            #elif defined(dAxisOrder_210)\n                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012\n            #endif\n        #endif\n\n        #if defined(dColorType_direct) && defined(dUsePalette)\n            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;\n        #elif defined(dColorType_uniform)\n            material.rgb = uColor;\n        #elif defined(dColorType_instance)\n            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;\n        #elif defined(dColorType_group)\n            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #elif defined(dColorType_groupInstance)\n            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #elif defined(dColorType_vertex)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;\n        #elif defined(dColorType_vertexInstance)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;\n        #endif\n\n        #ifdef dOverpaint\n            #if defined(dOverpaintType_groupInstance)\n                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);\n            #elif defined(dOverpaintType_vertexInstance)\n                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));\n            #endif\n\n            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);\n        #endif\n\n        #ifdef dIgnoreLight\n            gl_FragColor.rgb = material.rgb;\n        #else\n            if (material.a >= 0.01) {\n                #ifdef dPackedGroup\n                    // compute gradient by central differences\n                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;\n                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;\n                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;\n                #else\n                    gradient = cell.xyz * 2.0 - 1.0;\n                #endif\n                vec3 normal = -normalize(normalMatrix * normalize(gradient));\n                #include apply_light_color\n            } else {\n                gl_FragColor.rgb = material.rgb;\n            }\n        #endif\n\n        gl_FragColor.a = material.a * uAlpha * uTransferScale;\n\n        #if defined(dColorMarker)\n            float marker = uMarker;\n            if (uMarker == -1.0) {\n                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n            }\n        #endif\n        #include apply_marker_color\n\n        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;\n        fragmentDepth = calcDepth(mvPosition.xyz);\n        #include apply_fog\n\n        src = gl_FragColor;\n\n        if (!uTransparentBackground) {\n            // done in 'apply_fog' otherwise\n            src.rgb *= src.a;\n        }\n        dst = (1.0 - dst.a) * src + dst; // standard blending\n\n        // break if the color is opaque enough\n        if (dst.a > 0.95)\n            break;\n\n        pos += step;\n    }\n\n    return dst;\n}\n\n// TODO: support float texture for higher precision values???\n// TODO: support clipping exclusion texture support\n\nvoid main() {\n    if (gl_FrontFacing)\n        discard;\n\n    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 step = rayDir * uStepScale;\n\n    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;\n    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);\n    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);\n    gl_FragColor = raymarch(start, step, rayDir);\n\n    float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);\n    float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);\n    #include wboit_write\n}\n",{fragDepth:"optional",drawBuffers:"optional"},{},FS),UMe=Fn("image","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_vert_params\n\nattribute vec3 aPosition;\nattribute vec2 aUv;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\nvoid main() {\n    #include assign_position\n\n    vUv = aUv;\n    vInstance = aInstance;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_frag_params\n#include common_clip\n\nuniform vec2 uImageTexDim;\nuniform sampler2D tImageTex;\nuniform sampler2D tGroupTex;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\n#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)\n    #define dInterpolation_cubic\n#endif\n\n#if defined(dInterpolation_cubic)\n    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)\n        #if defined(dInterpolation_catmulrom)\n            const float B = 0.0;\n            const float C = 0.5;\n        #elif defined(dInterpolation_mitchell)\n            const float B = 0.333;\n            const float C = 0.333;\n        #endif\n\n        float cubicFilter(float x){\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f < 1.0) {\n                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +\n                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +\n                    (6.0 - 2.0 * B)) / 6.0;\n            }else if (f >= 1.0 && f < 2.0){\n                return ((-B - 6.0 * C) * ( f * f * f)\n                    + (6.0 * B + 30.0 * C) * (f * f) +\n                    (-(12.0 * B) - 48.0 * C) * f +\n                    8.0 * B + 24.0 * C) / 6.0;\n            }else{\n                return 0.0;\n            }\n        }\n    #elif defined(dInterpolation_bspline)\n        float cubicFilter(float x) {\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f >= 0.0 && f <= 1.0){\n                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);\n            } else if (f > 1.0 && f <= 2.0) {\n                return 1.0 / 6.0 * pow((2.0 - f), 3.0);\n            }\n            return 1.0;\n        }\n    #endif\n\n    vec4 biCubic(sampler2D tex, vec2 texCoord) {\n        vec2 texelSize = 1.0 / uImageTexDim;\n        texCoord -= texelSize / 2.0;\n        vec4 nSum = vec4(0.0);\n        float nDenom = 0.0;\n        vec2 cell = fract(texCoord * uImageTexDim);\n        for (float m = -1.0; m <= 2.0; ++m) {\n            for (float n = -1.0; n <= 2.0; ++n) {\n                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));\n                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);\n                nSum += vecData * c;\n                nDenom += c;\n            }\n        }\n        return nSum / nDenom;\n    }\n#endif\n\nvoid main() {\n    #include clip_pixel\n\n    #if defined(dInterpolation_cubic)\n        vec4 imageData = biCubic(tImageTex, vUv);\n    #else\n        vec4 imageData = texture2D(tImageTex, vUv);\n    #endif\n    imageData.a = clamp(imageData.a, 0.0, 1.0);\n    if (imageData.a > 0.9) imageData.a = 1.0;\n\n    float fragmentDepth = gl_FragCoord.z;\n\n    #if defined(dRenderVariant_pick)\n        if (imageData.a < 0.3)\n            discard;\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);\n            gl_FragData[2] = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            gl_FragData[3] = packDepthToRGBA(gl_FragCoord.z);\n        #else\n            gl_FragColor = vColor;\n            if (uPickType == 1) {\n                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            } else if (uPickType == 2) {\n                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);\n            } else {\n                gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            }\n        #endif\n    #elif defined(dRenderVariant_depth)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #elif defined(dRenderVariant_marking)\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n        if (uMarkingType == 1) {\n            if (marker > 0.0 || imageData.a < 0.05)\n                discard;\n            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n        } else {\n            if (marker == 0.0 || imageData.a < 0.05)\n                discard;\n            float depthTest = 1.0;\n            if (uMarkingDepthTest) {\n                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n            }\n            bool isHighlight = intMod(marker, 2.0) > 0.1;\n            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);\n        }\n    #elif defined(dRenderVariant_color)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = imageData;\n        gl_FragColor.a *= uAlpha;\n\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},dA);function mX(e,t){var r;if(void 0===e)return"";var n=(null===(r=e.dRenderVariant)||void 0===r?void 0:r.ref.value)||"",a=[];for(var i in e)if(!t?.(i,n,e)){var s=e[i].ref.value;void 0!==s&&("string"==typeof s?a.push("#define ".concat(i,"_").concat(s)):"number"==typeof s?a.push("#define ".concat(i," ").concat(s)):"boolean"==typeof s?s&&a.push("#define ".concat(i)):Sn())}return a.join("\n")+"\n"}var zMe="\n#define attribute in\n#define varying out\n#define texture2D texture\n",HMe="\n#define varying in\n#define texture2D texture\n#define textureCube texture\n#define texture2DLodEXT textureLod\n#define textureCubeLodEXT textureLod\n\n#define gl_FragColor out_FragData0\n#define gl_FragDepthEXT gl_FragDepth\n\n#define depthTextureSupport\n";function XMe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"iv2":case"iv2[]":return e.INT_VEC2;case"iv3":case"iv3[]":return e.INT_VEC3;case"iv4":case"iv4[]":return e.INT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '".concat(t,"'"))}}function ZMe(e,t,r){e.uniform1f(t,r)}function QMe(e,t,r){e.uniform1fv(t,r)}function $Me(e,t,r){e.uniform1i(t,r)}function JMe(e,t,r){e.uniform1iv(t,r)}function eRe(e,t,r){e.uniform2fv(t,r)}function tRe(e,t,r){e.uniform3fv(t,r)}function rRe(e,t,r){e.uniform4fv(t,r)}function nRe(e,t,r){e.uniform2iv(t,r)}function aRe(e,t,r){e.uniform3iv(t,r)}function iRe(e,t,r){e.uniform4iv(t,r)}function oRe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function sRe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function hX(e){switch(e){case"f":return ZMe;case"f[]":return QMe;case"i":case"t":case"b":return $Me;case"i[]":case"t[]":case"b[]":return JMe;case"v2":case"v2[]":return eRe;case"v3":case"v3[]":return tRe;case"v4":case"v4[]":return rRe;case"iv2":case"iv2[]":return nRe;case"iv3":case"iv3[]":return aRe;case"iv4":case"iv4[]":return iRe;case"m3":case"m3[]":return oRe;case"m4":case"m4[]":return sRe}}var lRe=Jo();function vX(e){var t=e.createBuffer();if(null===t)throw new Error("Could not create WebGL buffer");return t}function gX(e,t,r,n){var a=vX(e),i=function dRe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}(e,r),o=function pRe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":if($t(e))return e.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers")}}(e,n),s=function fRe(e,t){return t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int8Array?e.BYTE:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int16Array?e.SHORT:t instanceof Uint32Array?e.UNSIGNED_INT:t instanceof Int32Array?e.INT:t instanceof Float32Array?e.FLOAT:void Sn()}(e,t),u=t.BYTES_PER_ELEMENT,c=t.length;function l(f){e.bindBuffer(o,a),e.bufferData(o,f,i)}l(t);var d=!1;return{id:lRe(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:c,getBuffer:function(){return a},updateData:l,updateSubData:function(f,p,m){e.bindBuffer(o,a),m-p===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,p*u,f.subarray(p,p+m))},reset:function(){a=vX(e),l(t)},destroy:function(){d||(e.deleteBuffer(a),d=!0)}}}function mRe(e,t,r){if("float32"===t)switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}Sn()}var yRe=Jo();function UF(e){var t=e.createProgram();if(null===t)throw new Error("Could not create WebGL program");return t}function _Re(e,t,r,n,a){var p,m,i=a.defineValues,o=a.shaderCode,s=a.schema,u=UF(e),c=yRe(),l=function YMe(e,t,r,n){var a=mX(r,n.ignoreDefine),i=mX(r,n.ignoreDefine),o=$t(e)?function jMe(e,t){var r=["#version 300 es"];if(t.drawBuffers&&e.drawBuffers&&r.push("#define requiredDrawBuffers"),t.clipCullDistance)if(e.clipCullDistance)r.push("#extension GL_ANGLE_clip_cull_distance : enable"),r.push("#define enabledClipCullDistance");else if("required"===t.clipCullDistance)throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available");if(t.conservativeDepth)if(e.conservativeDepth)r.push("#extension GL_EXT_conservative_depth : enable"),r.push("#define enabledConservativeDepth");else if("required"===t.conservativeDepth)throw new Error("required 'GL_EXT_conservative_depth' extension not available");return e.noNonInstancedActiveAttribs&&r.push("#define noNonInstancedActiveAttribs"),r.push(zMe),r.join("\n")+"\n"}(t,n.extensions):function VMe(e,t){var r=[];if(t.drawBuffers)if(e.drawBuffers)r.push("#define requiredDrawBuffers");else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");return r.join("\n")+"\n"}(t,n.extensions),s=$t(e)?function qMe(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp ".concat(n[0]||"vec4"," out_FragData0;")];if(r.fragDepth&&t.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers&&t.drawBuffers){a.push("#define requiredDrawBuffers");for(var o=1,s=e.getParameter(e.MAX_DRAW_BUFFERS);o<s;++o)a.push("layout(location = ".concat(o,") out highp ").concat(n[o]||"vec4"," out_FragData").concat(o,";"))}return r.shaderTextureLod&&t.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push(HMe),a.join("\n")+"\n"}(e,t,n.extensions,n.outTypes):function GMe(e,t){var r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth)if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if("required"===t.fragDepth)throw new Error("required 'GL_EXT_frag_depth' extension not available");if(t.drawBuffers)if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");if(t.shaderTextureLod)if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if("required"===t.shaderTextureLod)throw new Error("required 'GL_EXT_shader_texture_lod' extension not available");return e.depthTexture&&r.push("#define depthTextureSupport"),r.join("\n")+"\n"}(t,n.extensions),u=$t(e)?function WMe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}(n.frag):n.frag;return{id:lX(),name:n.name,vert:"".concat(o).concat(a).concat(fX(n.vert,r)),frag:"".concat(s).concat(i).concat(fX(u,r)),extensions:n.extensions,outTypes:n.outTypes}}(e,r,i,o),d=n("vert",l.vert),f=n("frag",l.frag);function h(){d.attach(u),f.attach(u),e.linkProgram(u),Cr&&function xRe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error("Could not compile WebGL program. \n\n".concat(e.getProgramInfoLog(t)))}(e,u),p=function bRe(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if("attribute"===i.type){var o=e.getAttribLocation(t,a);n[a]=o}else"uniform"===i.type?(null===(o=e.getUniformLocation(t,a))&&function KMe(e){return e.endsWith("[]")}(i.kind)&&(o=e.getUniformLocation(t,a+"[0]")),n[a]=o):"texture"===i.type&&(o=e.getUniformLocation(t,a),n[a]=o)}),n}(e,u,s),m=function uRe(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];"uniform"===n.type?t[r]=hX(n.kind):"texture"===n.type&&(t[r]=hX("t"))}),t}(s),Cr&&(function SRe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||"gl_InstanceID"===o||"gl_VertexID"===o)continue;var u=r[o];if(void 0===u)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if("attribute"!==u.type)throw new Error("'".concat(o,"' must be of type 'attribute' but is '").concat(u.type,"'"));var c=mRe(e,u.kind,u.itemSize);if(c!==s)throw new Error("unexpected attribute type '".concat(c,"' for ").concat(o,", expected '").concat(s,"'"))}}}(e,u,s),function CRe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var c=r[o.replace(/[[0-9]+\]$/,"")];if(void 0===c)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if("uniform"===c.type){if(XMe(e,c.kind)!==s)throw new Error("unexpected uniform type for ".concat(o))}else{if("texture"!==c.type)throw new Error("'".concat(o,"' must be of type 'uniform' or 'texture' but is '").concat(c.type,"'"));if("image-float32"===c.kind||"image-uint8"===c.kind){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '".concat(o,"'"))}else if("volume-float32"===c.kind||"volume-uint8"===c.kind){if(!$t(e))throw new Error("WebGL2 is required to use SAMPLER_3D");if(s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '".concat(o,"'"))}}}}}(e,u,s))}h();var v=!1;return{id:c,use:function(){t.currentProgramId=c,e.useProgram(u)},setUniforms:function(g){for(var y=0,S=g.length;y<S;++y){var C=g[y],_=C[0],x=C[1];if(x){var D=p[_];null!==D&&m[_](e,D,x.ref.value)}}},bindAttributes:function(g){t.clearVertexAttribsState();for(var y=0,S=g.length;y<S;++y){var C=g[y],D=p[C[0]];-1!==D&&C[1].bind(D)}t.disableUnusedVertexAttribs()},bindTextures:function(g,y){for(var S=0,C=g.length;S<C;++S){var _=g[S],x=_[0],w=p[x];null!=w&&(_[1].bind(S+y),m[x](e,w,S+y))}},reset:function(){u=UF(e),h()},destroy:function(){v||(d.destroy(),f.destroy(),e.deleteProgram(u),v=!0)}}}var wRe=Jo();function fA(e,t){var r=t.type,n=t.source,a=e.createShader("vert"===r?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(null===a)throw new Error("Error creating ".concat(r," shader"));if(e.shaderSource(a,n),e.compileShader(a),Cr&&!1===e.getShaderParameter(a,e.COMPILE_STATUS))throw console.warn("'".concat(r,"' shader info log '").concat(e.getShaderInfoLog(a),"'\n").concat(function ARe(e){for(var t=e.split("\n"),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join("\n")}(n))),new Error("Error compiling ".concat(r," shader"));return a}function yX(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=function DRe(e,t){return void 0===t&&(t=0),{value:e,usageCount:t}}(t(a)),n.set(i,o)),o.usageCount+=1,function ERe(e){return{free:function(){e.usageCount-=1},value:e.value}}(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var IRe=Jo();function bX(e){var t=e.createRenderbuffer();if(null===t)throw new Error("Could not create WebGL renderbuffer");return t}var ORe=Jo();function SX(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function CX(e){var t=e.vertexArrayObject;if(null===t)throw new Error("VertexArrayObject not supported");return t}function xX(e){return R(R({},e.value),{destroy:function(){e.free()}})}function NRe(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function i(c,l){return a[c].add(l),r.resourceCounts[c]+=1,R(R({},l),{destroy:function(){l.destroy(),a[c].delete(l),r.resourceCounts[c]-=1}})}var o=yX(function(c){return JSON.stringify(c)},function(c){return i("shader",function TRe(e,t){var r=fA(e,t);return{id:wRe(),attach:function(n){e.attachShader(n,r)},reset:function(){r=fA(e,t)},destroy:function(){e.deleteShader(r)}}}(e,c))},function(c){c.destroy()});function s(c,l){return xX(o.get({type:c,source:l}))}var u=yX(function(c){var l,d=[c.shaderCode.id],f=(null===(l=c.defineValues.dRenderVariant)||void 0===l?void 0:l.ref.value)||"";return Object.keys(c.defineValues).forEach(function(p){var m,h;null!==(h=(m=c.shaderCode).ignoreDefine)&&void 0!==h&&h.call(m,p,f,c.defineValues)||d.push(CO(p),function BRe(e){return"boolean"==typeof e?e?1:0:"number"==typeof e?1e4*e:CO(e)}(c.defineValues[p].ref.value))}),rs(d).toString()},function(c){return i("program",_Re(e,t,n,s,c))},function(c){c.destroy()});return{attribute:function(c,l,d,f){return i("attribute",function hRe(e,t,r,n,a,i,o){void 0===o&&(o="dynamic");var s=r.instancedArrays,u=gX(e,n,o,"attribute"),c=u._bufferType,l=u._dataType,d=u._bpe;return R(R({},u),{bind:function(f){if(e.bindBuffer(c,u.getBuffer()),16===a)for(var p=0;p<4;++p)t.enableVertexAttrib(f+p),e.vertexAttribPointer(f+p,4,l,!1,16*d,4*p*d),s.vertexAttribDivisor(f+p,i);else t.enableVertexAttrib(f),e.vertexAttribPointer(f,a,l,!1,0,0),s.vertexAttribDivisor(f,i)}})}(e,t,n,c,l,d,f))},elements:function(c,l){return i("elements",function gRe(e,t,r){void 0===r&&(r="static");var n=gX(e,t,r,"elements");return R(R({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}(e,c,l))},framebuffer:function(){return i("framebuffer",function DPe(e){var t=uX(e),r=!1;return{id:sX(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=uX(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}(e))},program:function(c,l,d){return xX(u.get({defineValues:c,shaderCode:l,schema:d}))},renderbuffer:function(c,l,d,f){return i("renderbuffer",function RRe(e,t,r,n,a){var i=bX(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=function PRe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth24":if($t(e))return e.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if($t(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if($t(e))return e.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if($t(e))return e.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}(e,t),u=function MRe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}(e,r);function c(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}c();var l=!1;return{id:IRe(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),Cr&&lA(e)},detachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,null),Cr&&lA(e)},setSize:function(d,f){n=d,a=f,c()},reset:function(){i=bX(e),c()},destroy:function(){l||(e.deleteRenderbuffer(i),l=!0)}}}(e,c,l,d,f))},shader:s,texture:function(c,l,d,f){return i("texture",function MOe(e,t,r,n,a,i){var o=GF(),s=UX(e);if(r.endsWith("float32")&&"float"!==a||r.endsWith("float16")&&"fp16"!==a||r.endsWith("uint8")&&"ubyte"!==a||r.endsWith("int32")&&"int"!==a||r.endsWith("depth")&&"ushort"!==a&&"float"!==a)throw new Error("texture kind '".concat(r,"' and type '").concat(a,"' are incompatible"));if(!t.depthTexture&&"depth"===n)throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");var u=function AOe(e,t){switch(t){case"image-uint8":case"image-float32":case"image-float16":case"image-depth":return e.TEXTURE_2D}if($t(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":case"volume-float32":case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '".concat(t,"'"))}(e,r),c=NX(e,i),l=FX(e,n,a),d=function TOe(e,t,r){if($t(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rg":switch(r){case"ubyte":return e.RG;case"float":return e.RG32F;case"fp16":return e.RG16F;case"int":return e.RG32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return FX(e,t,r)}(e,n,a),f=function IOe(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if($t(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}(e,t,a);function p(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,c),e.texParameteri(u,e.TEXTURE_MIN_FILTER,c),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}p();var g,m=0,h=0,v=0,y=!1,S=!1;function C(w,A,E){if(0===w||0===A||$t(e)&&u===e.TEXTURE_3D&&0===E)throw new Error("empty textures are not allowed");if(m!==w||h!==A||v!==(E||0))if(m=w,h=A,v=E||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,m,h,0,l,f,null);else{if(!$t(e)||u!==e.TEXTURE_3D||void 0===v)throw new Error("unknown texture target");e.texImage3D(u,0,d,m,h,v,0,l,f,null)}}function _(w,A){if(void 0===A&&(A=!1),0===w.width||0===w.height||!kX(w)&&$t(e)&&LX(0,u,e)&&0===w.depth)throw new Error("empty textures are not allowed");if(e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),kX(w))m=w.width,h=w.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,l,f,w);else if(function POe(e,t,r){return t===r.TEXTURE_2D}(0,u,e)){var E=w.filter?NX(e,w.filter):c;e.texParameteri(u,e.TEXTURE_MAG_FILTER,E),e.texParameteri(u,e.TEXTURE_MIN_FILTER,E),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!w.flipY),A?e.texSubImage2D(u,0,0,0,w.width,w.height,l,f,w.array):e.texImage2D(u,0,d,m=w.width,h=w.height,0,l,f,w.array)}else{if(!$t(e)||!LX(0,u,e))throw new Error("unknown texture target");e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),A?e.texSubImage3D(u,0,0,0,0,w.width,w.height,w.depth,l,f,w.array):e.texImage3D(u,0,d,m=w.width,h=w.height,v=w.depth,0,l,f,w.array)}e.bindTexture(u,null),g=w}function x(){if(u!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(!($t(e)||nS(m)&&nS(h)))throw new Error("mipmap unsupported for non-power-of-two textures and webgl1");e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(u),e.bindTexture(u,null),y=!0}return C(1,1,$t(e)&&u===e.TEXTURE_3D?1:0),{id:o,target:u,format:l,internalFormat:d,type:f,filter:c,getWidth:function(){return m},getHeight:function(){return h},getDepth:function(){return v},getByteCount:function(){return BX(n,a,m,h,v)},define:C,load:_,mipmap:x,bind:function(w){e.activeTexture(e.TEXTURE0+w),e.bindTexture(u,s)},unbind:function(w){e.activeTexture(e.TEXTURE0+w),e.bindTexture(u,null)},attachFramebuffer:function D(w,A,E){if(w.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,mA(e,t,A),e.TEXTURE_2D,s,0);else{if(!$t(e)||u!==e.TEXTURE_3D)throw new Error("unknown/unsupported texture target");if(void 0===E)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,mA(e,t,A),s,0,E)}},detachFramebuffer:function(w,A){if(w.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,mA(e,t,A),e.TEXTURE_2D,null,0);else{if(!$t(e)||u!==e.TEXTURE_3D)throw new Error("unknown texture target");e.framebufferTextureLayer(e.FRAMEBUFFER,mA(e,t,A),null,0,0)}},reset:function(){s=UX(e),p();var w=[m,h,v];m=0,h=0,v=0,C(w[0],w[1],w[2]),g&&_(g),y&&x()},destroy:function(){S||(e.deleteTexture(s),S=!0)}}}(e,n,c,l,d,f))},cubeTexture:function(c,l,d){return i("cubeTexture",function OOe(e,t,r,n){var a=e.TEXTURE_CUBE_MAP,i=e.LINEAR,o=e.RGBA,s=e.RGBA,u=e.UNSIGNED_BYTE,c=0,l=e.createTexture();e.bindTexture(a,l);var d=0;Fs(t,function(p,m){if(p){var v=function ROe(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}(e,m),g=new Image;p instanceof File?g.src=URL.createObjectURL(p):mw(p)?p.then(function(y){g.src=URL.createObjectURL(y)}):g.src=p,g.addEventListener("load",function(){0===c&&(c=g.width),e.texImage2D(v,0,o,c,c,0,s,u,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(a,l),e.texImage2D(v,0,o,s,u,g),6===(d+=1)&&(f||(r?(e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(a)):e.texParameteri(a,e.TEXTURE_MIN_FILTER,i),e.texParameteri(a,e.TEXTURE_MAG_FILTER,i)),n?.(f))}),g.addEventListener("error",function(){n?.(!0)})}});var f=!1;return{id:GF(),target:a,format:s,internalFormat:o,type:u,filter:i,getWidth:function(){return c},getHeight:function(){return c},getDepth:function(){return 0},getByteCount:function(){return 6*BX("rgba","ubyte",c,c,0)*(r?2:1)},define:function(){},load:function(){},mipmap:function(){},bind:function(p){e.activeTexture(e.TEXTURE0+p),e.bindTexture(a,l)},unbind:function(p){e.activeTexture(e.TEXTURE0+p),e.bindTexture(a,null)},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){f||(e.deleteTexture(l),f=!0)}}}(e,c,l,d))},vertexArray:function(c,l,d){return i("vertexArray",function FRe(e,t,r,n,a){var i=ORe(),o=SX(t),s=CX(t);function u(){s.bindVertexArray(o),a&&a.bind(),r.bindAttributes(n),s.bindVertexArray(null)}u();var c=!1;return{id:i,bind:function(){s.bindVertexArray(o)},update:u,reset:function(){o=SX(t),s=CX(t),u()},destroy:function(){c||(a&&(s.bindVertexArray(o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(o),c=!0)}}}(e,n,c,l,d))},getByteCounts:function(){var c=0;a.texture.forEach(function(f){c+=f.getByteCount()}),a.cubeTexture.forEach(function(f){c+=f.getByteCount()});var l=0;a.attribute.forEach(function(f){l+=4*f.length});var d=0;return a.elements.forEach(function(f){d+=4*f.length}),{texture:c,attribute:l,elements:d}},reset:function(){a.attribute.forEach(function(c){return c.reset()}),a.elements.forEach(function(c){return c.reset()}),a.framebuffer.forEach(function(c){return c.reset()}),a.renderbuffer.forEach(function(c){return c.reset()}),a.shader.forEach(function(c){return c.reset()}),a.program.forEach(function(c){return c.reset()}),a.vertexArray.forEach(function(c){return c.reset()}),a.texture.forEach(function(c){return c.reset()})},destroy:function(){a.attribute.forEach(function(c){return c.destroy()}),a.elements.forEach(function(c){return c.destroy()}),a.framebuffer.forEach(function(c){return c.destroy()}),a.renderbuffer.forEach(function(c){return c.destroy()}),a.shader.forEach(function(c){return c.destroy()}),a.program.forEach(function(c){return c.destroy()}),a.vertexArray.forEach(function(c){return c.destroy()}),a.texture.forEach(function(c){return c.destroy()}),o.clear(),u.clear()}}}var _X=Jo(),wX=function(){function e(t){this.count=t,this.avgs=new Map}return e.prototype.add=function(t,r){var n=this.avgs.get(t)||r;return n=function URe(e,t,r){return(e-=e/r)+t/r}(n,r,this.count),this.avgs.set(t,n),n},e.prototype.get=function(t){return this.avgs.get(t)},e.prototype.stats=function(){return Object.fromEntries(this.avgs.entries())},e}();function AX(e){e.map(function(t){var r=function HRe(e){var t="".concat((e.gpuElapsed/1e3/1e3).toFixed(2)),r="".concat((e.gpuAvg/1e3/1e3).toFixed(2)),n="".concat(e.cpuElapsed.toFixed(2)),a="".concat(e.cpuAvg.toFixed(2));return"".concat(e.label," ").concat(t," ms (avg. ").concat(r," ms) | CPU: ").concat(n," ms (avg. ").concat(a," ms)")}(t);t.children.length||t.calls?(console.groupCollapsed(r),t.calls&&console.log(t.calls),AX(t.children),console.groupEnd()):console.log(r)})}function TX(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function DX(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '".concat(TX(e,t),"'"))}function pA(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var EX=new Uint8Array(4);function IX(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):sS.setImmediate(IX,e,t,r)}function PX(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?sS.setImmediate(IX,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,EX),t())}var MX=!1;function RX(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,EX)}function VF(e,t,r,n,a,i){if(Cr&&lA(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else{if(!(i instanceof Int32Array&&$t(e)))throw new Error("unsupported readPixels buffer type");e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i)}Cr&&DX(e)}function $t(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}var xOe="\nattribute vec4 aPosition;\n\nvoid main() {\n    gl_Position = aPosition;\n}",_Oe="\nprecision mediump float;\nuniform vec4 uColor;\nuniform sampler2D uTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;\n}",wOe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function OX(e,t){var r=fA(e,{type:"vert",source:xOe}),n=fA(e,{type:"frag",source:_Oe});if(!r||!n)return!1;var a=UF(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return Cr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,wOe,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),c=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,c);var l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return Cr&&console.log("error creating framebuffer for '".concat(t,"'")),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,l),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,.1,.05,1]),e.drawArrays(e.TRIANGLES,0,6);var p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),0!==p[0]||p[1]<248||p[2]<248||p[3]<254)return Cr&&console.log("not able to actually render to '".concat(t,"' texture")),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var m=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,m);var h=e.getError();if(h)return Cr&&console.log("error reading float pixels: '".concat(TX(e,h),"'")),!1}return!0}var GF=Jo();function FX(e,t,r){switch(t){case"alpha":return $t(e)&&"float"===r?e.RED:$t(e)&&"int"===r?e.RED_INTEGER:e.ALPHA;case"rgb":return $t(e)&&"int"===r?e.RGB_INTEGER:e.RGB;case"rg":if($t(e)&&"float"===r)return e.RG;if($t(e)&&"int"===r)return e.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return $t(e)&&"int"===r?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function BX(e,t,r,n,a){var i=function DOe(e){switch(e){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":case"depth":return 4}}(e)*function EOe(e){switch(e){case"ubyte":return 1;case"ushort":case"fp16":return 2;case"float":case"int":return 4}}(t);return i*r*n*(a||1)}function NX(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function mA(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function kX(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function LX(e,t,r){return t===r.TEXTURE_3D}function UX(e){var t=e.createTexture();if(null===t)throw new Error("Could not create WebGL texture");return t}function VX(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if("texture"===o.type){var s=r[i];if(s)if("texture"===o.kind)a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function GX(e,t,r){var n=new Image;n.onload=function(){r.load(n),O.update(t,r)},n.src=e}var zX=-1;function Ao(e){var t,r=null!==(t=e?.TEXTURE_2D)&&void 0!==t?t:3553;return{id:GF(),target:r,format:zX,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},mipmap:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:function(){throw new Error("cannot detach null-texture from a framebuffer")},reset:function(){},destroy:function(){}}}function Vu(e,t,r,n){var a=function BOe(e,t,r,n){switch(r.granularity){case"uniform":return function LOe(e,t,r){return function kOe(e,t){return t?(O.update(t.uColor,dt.toVec3Normalized(t.uColor.ref.value,e)),O.updateIfChanged(t.dColorType,"uniform"),t):{uColor:O.create(dt.toVec3Normalized(b(),e)),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(Ao()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Be.create(1,1)),uColorGridDim:O.create(b.create(1,1,1)),uColorGridTransform:O.create(dr.create(0,0,0,1)),dColorType:O.create("uniform"),dUsePalette:O.create(!1)}}(t(Uu,!1),r)}(0,r.color,n);case"instance":return e.nonInstanceable?HX(e,r.color,n):function UOe(e,t,r){var a=gi(Math.max(1,e.instanceCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),u=i.instanceIndex;dt.toArray(t(i.location,i.isSecondary),a.array,3*u),e.skipInstance()}return BS(a,"instance",r)}(e,r.color,n);case"group":return HX(e,r.color,n);case"groupInstance":return function VOe(e,t,r){var o=gi(Math.max(1,e.instanceCount*e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),l=s.index;dt.toArray(t(s.location,s.isSecondary),o.array,3*l)}return BS(o,"groupInstance",r)}(e,r.color,n);case"vertex":return function GOe(e,t,r){var a=e.stride,i=gi(Math.max(1,e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),c=o.groupIndex,l=t(o.location,o.isSecondary),d=0;d<a;++d)dt.toArray(l,i.array,3*(c+d));return BS(i,"vertex",r)}(t,r.color,n);case"vertexInstance":return function zOe(e,t,r){var i=e.stride,s=gi(Math.max(1,e.instanceCount*e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),d=u.index,f=t(u.location,u.isSecondary),p=0;p<i;++p)dt.toArray(f,s.array,3*(d+p));return BS(s,"vertexInstance",r)}(t,r.color,n);case"volume":return jX(r.grid,"volume",n);case"volumeInstance":return jX(r.grid,"volumeInstance",n);case"direct":return function HOe(e){return e?(O.updateIfChanged(e.dColorType,"direct"),e):{uColor:O.create(b()),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(Ao()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Be.create(1,1)),uColorGridDim:O.create(b.create(1,1,1)),uColorGridTransform:O.create(dr.create(0,0,0,1)),dColorType:O.create("direct"),dUsePalette:O.create(!1)}}(n)}}(e,t,r,n);return r.palette?(O.updateIfChanged(a.dUsePalette,!0),function NOe(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var c=dt.toRgb(s[o]),d=c[1],f=c[2];if(a[i++]!==c[0]||a[i++]!==d||a[i++]!==f){r=!1;break}}if(!r){for(var p=new Uint8Array(3*e.colors.length),m=0,h=0,v=e.colors;h<v.length;h++){var g=dt.toRgb(v[h]);d=g[1],f=g[2],p[m++]=g[0],p[m++]=d,p[m++]=f}O.update(t,{array:p,height:1,width:e.colors.length,filter:e.filter})}}(r.palette,a.tPalette)):O.updateIfChanged(a.dUsePalette,!1),a}function BS(e,t,r){return r?(O.update(r.tColor,e),O.update(r.uColorTexDim,Be.create(e.width,e.height)),O.updateIfChanged(r.dColorType,t),r):{uColor:O.create(b()),tColor:O.create(e),tColorGrid:O.create(Ao()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Be.create(e.width,e.height)),uColorGridDim:O.create(b.create(1,1,1)),uColorGridTransform:O.create(dr.create(0,0,0,1)),dColorType:O.create(t),dUsePalette:O.create(!1)}}function HX(e,t,r){var a=gi(Math.max(1,e.groupCount),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),u=i.groupIndex;dt.toArray(t(i.location,i.isSecondary),a.array,3*u)}return BS(a,"group",r)}function jX(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(O.update(r.tColorGrid,n),O.update(r.uColorTexDim,Be.create(o,s)),O.update(r.uColorGridDim,b.clone(a)),O.update(r.uColorGridTransform,dr.clone(i)),O.updateIfChanged(r.dColorType,t),r):{uColor:O.create(b()),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(n),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Be.create(o,s)),uColorGridDim:O.create(b.clone(a)),uColorGridTransform:O.create(dr.clone(i)),dColorType:O.create(t),dUsePalette:O.create(!1)}}var qX=Qt(),jOe=he();function zF(e,t,r){var n=function qOe(e,t){for(var r=0;r<t;r++)if(Qt.fromMat4(qX,he.fromArray(jOe,e,16*r)),Qt.determinant(qX)<0)return!0;return!1}(e,t);if(r){O.update(r.matrix,r.matrix.ref.value);var a=r.transform.ref.value.length>=16*t?r.transform.ref.value:new Float32Array(16*t);a.set(e),O.update(r.transform,a),O.updateIfChanged(r.uInstanceCount,t),O.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=16*t?r.aTransform.ref.value:new Float32Array(16*t);O.update(r.aTransform,i);var o=r.extraTransform.ref.value.length>=16*t?r.extraTransform.ref.value:new Float32Array(16*t);O.update(r.extraTransform,hA(o,t));var s=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);O.update(r.aInstance,Bu(s,t)),O.update(r.hasReflection,n)}else r={aTransform:O.create(new Float32Array(16*t)),matrix:O.create(he.identity()),transform:O.create(new Float32Array(e)),extraTransform:O.create(hA(new Float32Array(16*t),t)),uInstanceCount:O.create(t),instanceCount:O.create(t),aInstance:O.create(Bu(new Float32Array(t))),hasReflection:O.create(n)};return WX(r),r}var HF=new Float32Array(16);function jF(e){return zF(new Float32Array(HF),1,e)}function hA(e,t){for(var r=0;r<t;r++)e.set(HF,16*r);return e}function WX(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=16*o;he.mulOffset(t,i,a,s,s,s),he.mulOffset(t,n,t,s,0,s)}O.update(e.aTransform,t)}he.toArray(he.identity(),HF,0);var Xn={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"},YX=dt(13421772),WOe="Gives everything the same, uniform color.",z0={value:T.Color(YX),saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(0,{min:-6,max:6,step:.1})};function Kh(e,t){var r=po(t.value,YX);return r=dt.saturate(r,t.saturation),r=dt.lighten(r,t.lightness),{factory:Kh,granularity:"uniform",color:function(){return r},props:t,description:WOe,legend:sm([["uniform",r]])}}var XOe={name:"uniform",label:"Uniform",category:Xn.Misc,factory:Kh,getParams:function YOe(e){return z0},defaultValues:T.getDefaultValues(z0),isApplicable:function(e){return!0}},XX={value:T.Numeric(1,{min:0,max:20,step:.1})};function qF(e,t){var r=t.value;return{factory:qF,granularity:"uniform",size:function(){return r},props:t,description:"Gives everything the same, uniform size."}}var QOe={name:"uniform",label:"Uniform",category:"",factory:qF,getParams:function ZOe(e){return XX},defaultValues:T.getDefaultValues(XX),isApplicable:function(e){return!0}};function as(e){return R(R({},as.Zero),e)}function dm(){}!function(e){e.Zero={metalness:0,roughness:0,bumpiness:0},e.toArray=function t(a,i,o){return i[o]=255*a.metalness,i[o+1]=255*a.roughness,i[o+2]=255*a.bumpiness,i},e.toString=function r(a){var o=a.roughness,s=a.bumpiness;return"M ".concat(a.metalness.toFixed(2)," | R ").concat(o.toFixed(2)," | B ").concat(s.toFixed(2))},e.getParam=function n(a){return T.Group({metalness:T.Numeric(0,{min:0,max:1,step:.01}),roughness:T.Numeric(1,{min:0,max:1,step:.01}),bumpiness:T.Numeric(0,{min:0,max:1,step:.01})},R(R({},a),{presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]}))}}(as||(as={})),function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:T.Select("pixel",T.arrayToOptions(["instance","pixel"])),objects:T.ObjectList({type:T.Select("plane",T.objectToOptions(e.Type,function(u){return yc(u)})),invert:T.Boolean(!1),position:T.Vec3(b()),rotation:T.Group({axis:T.Vec3(b.create(1,0,0)),angle:T.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:T.Vec3(b.create(1,1,1))},function(u){return yc(u.type)})};var r=hn(),n=hn(),a=b(),i=b();e.getClip=function o(u,c){for(var l=u.objects.length,d=c?.objects||function t(u){return{count:0,type:new Array(u).fill(1),invert:new Array(u).fill(!1),position:new Array(3*u).fill(0),rotation:new Array(4*u).fill(0),scale:new Array(3*u).fill(1)}}(l),f=d.type,p=d.invert,m=d.position,h=d.rotation,v=d.scale,g=0;g<l;++g){var y=u.objects[g];f[g]=e.Type[y.type],p[g]=y.invert,b.toArray(y.position,m,3*g),hn.toArray(hn.setAxisAngle(r,y.rotation.axis,Yr(y.rotation.angle)),h,4*g),b.toArray(y.scale,v,3*g)}return{variant:u.variant,objects:{count:l,type:f,invert:p,position:m,rotation:h,scale:v}}},e.areEqual=function s(u,c){if(u.variant!==c.variant||u.objects.count!==c.objects.count)return!1;for(var l=u.objects,d=c.objects,f=0,p=l.count;f<p;++f)if(l.invert[f]!==d.invert[f]||l.type[f]!==d.type[f]||(b.fromArray(a,l.position,3*f),b.fromArray(i,d.position,3*f),!b.equals(a,i))||(b.fromArray(a,l.scale,3*f),b.fromArray(i,d.scale,3*f),!b.equals(a,i))||(hn.fromArray(r,l.rotation,4*f),hn.fromArray(n,d.rotation,4*f),!hn.equals(r,n)))return!1;return!0}}(dm||(dm={}));var st,JOe=Object.keys({custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}}),WF=T.arrayToOptions(JOe),KX={smoothColors:T.MappedStatic("auto",{auto:T.Group({}),on:T.Group({resolutionFactor:T.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:T.Numeric(3,{min:1,max:12,step:1})}),off:T.Group({})})};function If(e){return!!e.smoothColors}function Tc(e,t,r){if(("on"===e.name||"auto"===e.name&&t)&&r&&r<3){var n=3;return"on"===e.name?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-kq(0,1.1,r),(r=Math.max(.5,r))>1.2&&(n=2)),{resolution:r,stride:n}}}function ZX(e,t,r){return e.fill(0,4*t,4*r),!0}!function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&"custom"!==o.quality}},e.Params={alpha:T.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:T.Select("auto",WF,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:as.getParam(),clip:T.Group(dm.Params),instanceGranularity:T.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."})},e.createSimple=function t(o,s,u){return void 0===o&&(o=vr.grey),void 0===s&&(s=1),u||(u=jF()),{transform:u,locationIterator:On(1,u.instanceCount.ref.value,1,function(){return Uu},!1,function(){return!1}),theme:{color:Kh(0,{value:o,lightness:0,saturation:0}),size:qF(0,{value:s})}}},e.createValues=function r(o,s){var u=dm.getClip(o.clip);return{alpha:O.create(o.alpha),uAlpha:O.create(o.alpha),uVertexCount:O.create(s.vertexCount),uGroupCount:O.create(s.groupCount),drawCount:O.create(s.drawCount),uMetalness:O.create(o.material.metalness),uRoughness:O.create(o.material.roughness),uBumpiness:O.create(o.material.bumpiness),dLightCount:O.create(1),dColorMarker:O.create(!0),dClipObjectCount:O.create(u.objects.count),dClipVariant:O.create(u.variant),uClipObjectType:O.create(u.objects.type),uClipObjectInvert:O.create(u.objects.invert),uClipObjectPosition:O.create(u.objects.position),uClipObjectRotation:O.create(u.objects.rotation),uClipObjectScale:O.create(u.objects.scale),instanceGranularity:O.create(o.instanceGranularity)}},e.updateValues=function n(o,s){O.updateIfChanged(o.alpha,s.alpha),O.updateIfChanged(o.uMetalness,s.material.metalness),O.updateIfChanged(o.uRoughness,s.material.roughness),O.updateIfChanged(o.uBumpiness,s.material.bumpiness);var u=dm.getClip(s.clip);O.updateIfChanged(o.dClipObjectCount,u.objects.count),O.updateIfChanged(o.dClipVariant,u.variant),O.update(o.uClipObjectType,u.objects.type),O.update(o.uClipObjectInvert,u.objects.invert),O.update(o.uClipObjectPosition,u.objects.position),O.update(o.uClipObjectRotation,u.objects.rotation),O.update(o.uClipObjectScale,u.objects.scale),O.updateIfChanged(o.instanceGranularity,s.instanceGranularity)},e.createRenderableState=function a(o){void 0===o&&(o={});var s=void 0===o.alpha||1===o.alpha;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s}},e.updateRenderableState=function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}}(st||(st={}));var QX={array:new Uint8Array(4),width:1,height:1};function Pf(e){return e?(O.update(e.tOverpaint,QX),O.update(e.uOverpaintTexDim,Be.create(1,1)),e):{tOverpaint:O.create(QX),uOverpaintTexDim:O.create(Be.create(1,1)),dOverpaint:O.create(!1),tOverpaintGrid:O.create(Ao()),uOverpaintGridDim:O.create(b.create(1,1,1)),uOverpaintGridTransform:O.create(dr.create(0,0,0,1)),dOverpaintType:O.create("groupInstance"),uOverpaintStrength:O.create(1)}}function $X(e,t){if(0===t||e.length<t)return 0;for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}var JX={array:new Uint8Array(1),width:1,height:1};function Mf(e){return e?(O.update(e.tTransparency,JX),O.update(e.uTransparencyTexDim,Be.create(1,1)),e):{tTransparency:O.create(JX),uTransparencyTexDim:O.create(Be.create(1,1)),dTransparency:O.create(!1),transparencyAverage:O.create(0),tTransparencyGrid:O.create(Ao()),uTransparencyGridDim:O.create(b.create(1,1,1)),uTransparencyGridTransform:O.create(dr.create(0,0,0,1)),dTransparencyType:O.create("groupInstance"),uTransparencyStrength:O.create(1)}}var eK={array:new Uint8Array(1),width:1,height:1};function Rf(e){return e?(O.update(e.tClipping,eK),O.update(e.uClippingTexDim,Be.create(1,1)),O.updateIfChanged(e.dClipping,!1),e):{tClipping:O.create(eK),uClippingTexDim:O.create(Be.create(1,1)),dClipping:O.create(!1),dClippingType:O.create("groupInstance")}}function tK(e,t,r){return e.fill(0,4*t,4*r),!0}var Vt,rK={array:new Uint8Array(4),width:1,height:1};function Of(e){return e?(O.update(e.tSubstance,rK),O.update(e.uSubstanceTexDim,Be.create(1,1)),e):{tSubstance:O.create(rK),uSubstanceTexDim:O.create(Be.create(1,1)),dSubstance:O.create(!1),tSubstanceGrid:O.create(Ao()),uSubstanceGridDim:O.create(b.create(1,1,1)),uSubstanceGridTransform:O.create(dr.create(0,0,0,1)),dSubstanceType:O.create("groupInstance"),uSubstanceStrength:O.create(1)}}!function(e){function t(I,M,F,N,j,U,H){return H?function i(I,M,F,N,j,U,H){return H.vertexCount=j,H.triangleCount=U,O.update(H.vertexBuffer,I),O.update(H.indexBuffer,M),O.update(H.normalBuffer,F),O.update(H.groupBuffer,N),H}(I,M,F,N,j,U,H):function a(I,M,F,N,j,U){var z,H=Pe(),G=-1,J=-1,X={kind:"mesh",vertexCount:j,triangleCount:U,vertexBuffer:O.create(I),indexBuffer:O.create(M),normalBuffer:O.create(F),groupBuffer:O.create(N),varyingGroup:O.create(!1),get boundingSphere(){var Z=n(X);if(Z!==G){var ne=Ef(X.vertexBuffer.ref.value,X.vertexCount,1);Pe.copy(H,ne),G=Z}return H},get groupMapping(){return X.groupBuffer.ref.version!==J&&(z=G0(X.groupBuffer.ref.value,X.vertexCount),J=X.groupBuffer.ref.version),z},setBoundingSphere:function(Z){Pe.copy(H,Z),G=n(X)},meta:{}};return X}(I,M,F,N,j,U)}function r(I){return t(I?I.vertexBuffer.ref.value:new Float32Array(0),I?I.indexBuffer.ref.value:new Uint32Array(0),I?I.normalBuffer.ref.value:new Float32Array(0),I?I.groupBuffer.ref.value:new Float32Array(0),0,0,I)}function n(I){return rs([I.vertexCount,I.triangleCount,I.vertexBuffer.ref.version,I.indexBuffer.ref.version,I.normalBuffer.ref.version,I.groupBuffer.ref.version])}e.create=t,e.createEmpty=r,e.computeNormals=function o(I){var M=I.vertexCount,F=I.triangleCount,N=I.vertexBuffer.ref.value,j=I.indexBuffer.ref.value,U=I.normalBuffer.ref.value.length>=3*M?I.normalBuffer.ref.value:new Float32Array(3*M);U===I.normalBuffer.ref.value&&U.fill(0,0,3*M),QY(N,j,U,M,F),O.update(I.normalBuffer,U)},e.checkForDuplicateVertices=function s(I,M){void 0===M&&(M=3);for(var F=I.vertexBuffer.ref.value,N=new Map,U=0,H=b(),z=0,G=I.vertexCount;z<G;++z){b.fromArray(H,F,3*z);var J="".concat((Z=H)[0].toFixed(ne=M),"|").concat(Z[1].toFixed(ne),"|").concat(Z[2].toFixed(ne)),X=N.get(J);void 0!==X?(U+=1,N.set(J,X+1)):N.set(J,1)}var Z,ne;return U};var u=Qt();function f(I){for(var M=I.vertexCount,F=I.triangleCount,N=I.indexBuffer.ref.value,j=[],U=0;U<M;++U)j[U]=[];for(U=0;U<F;++U){var H=N[3*U],z=N[3*U+1],G=N[3*U+2];Ya(j[H],z),Ya(j[H],G),Ya(j[z],H),Ya(j[z],G),Ya(j[G],H),Ya(j[G],z)}return j}function p(I){for(var M=I.triangleCount,F=I.indexBuffer.ref.value,N=new Map,j=function(J,X){var Z=iS(J,X),ne=N.get(Z)||0;N.set(Z,ne+1)},U=0;U<M;++U){var H=F[3*U],z=F[3*U+1],G=F[3*U+2];j(H,z),j(H,G),j(z,G)}return N}function m(I){var M=new Set,F=[0,0];return I.forEach(function(N,j){1===N&&(Xq(F,j),M.add(F[0]),M.add(F[1]))}),M}function h(I,M,F){var N=new Map,j=function(U,H){N.has(U)?Ya(N.get(U),H):N.set(U,[H])};return M.forEach(function(U){for(var z=0,G=I[U];z<G.length;z++){var J=G[z];M.has(J)&&1===F.get(iS(U,J))&&j(U,J)}}),N}function g(I,M,F,N){for(var j,H=I.indexBuffer,G=I.triangleCount,J=I.vertexBuffer.ref.value,X=H.ref.value,Z=I.normalBuffer.ref.value,ne=qe.create(Uint32Array,3,1024,G),Y=0,k=0;k<G;++k)qe.add3(ne,X[3*k],X[3*k+1],X[3*k+2]),Y+=1;var W=b(),$=b(),K=b(),q=b(),V=b(),ee=b(),ae=b(),pe=b(),me=b(),de=b(),re=Yr(120),te=new Set,le=Array.from(F.keys()).filter(function(Ue){return F.get(Ue).length<2}).map(function(Ue){var $e=F.get(Ue);return b.fromArray(W,J,3*Ue),b.fromArray($,J,3*$e[0]),b.fromArray(K,J,3*$e[1]),b.sub(V,$,W),b.sub(ee,K,W),[Ue,b.angle(V,ee)]});le.sort(function(Ue,$e){return Ue[1]-$e[1]});for(var ge=0,xe=le;ge<xe.length;ge++){var Ge=xe[ge],je=Ge[0],L=Ge[1];if(!(te.has(je)||L>re)){var Q=F.get(je);if((!M[Q[0]].includes(Q[1])||null!==(j=F.get(Q[0]))&&void 0!==j&&j.includes(Q[1]))&&(b.fromArray(W,J,3*je),b.fromArray($,J,3*Q[0]),b.fromArray(K,J,3*Q[1]),b.sub(V,$,W),b.sub(ee,K,W),b.add(pe,V,ee),!(b.squaredDistance(W,$)>=N))){for(var ye=!1,we=0,De=M[je];we<De.length;we++){var Oe=De[we];if(!Q.includes(Oe)&&(b.fromArray(q,J,3*Oe),b.sub(ae,q,W),b.dot(pe,ae)<0)){ye=!0;break}}ye&&(b.fromArray(me,Z,3*je),b.triangleNormal(de,W,$,K),b.dot(de,me)>0?qe.add3(ne,je,Q[0],Q[1]):qe.add3(ne,Q[1],Q[0],je),te.add(je),te.add(Q[0]),te.add(Q[1]),Y+=1)}}}var Ne=qe.compact(ne);return I.triangleCount=Y,O.update(H,Ne),I}function C(I,M){var F=I.vertexCount,N=M.instanceCount.ref.value,j=lm(),U=j.position,H=I.vertexBuffer.ref.value,z=M.aTransform.ref.value;return On(F,N,1,function(J,X){return X<0?b.fromArray(U,H,3*J):b.transformMat4Offset(U,H,z,0,3*J,16*X),j})}function _(I,M,F,N,j){var U=F.instanceCount,H=F.groupCount,G=Vu(F,C(I,M),N.color),J=j.instanceGranularity?Ia(U,"instance"):Ia(U*H,"groupInstance"),X=Pf(),Z=Mf(),ne=Of(),Y=Rf(),k={drawCount:3*I.triangleCount,vertexCount:I.vertexCount,groupCount:H,instanceCount:U},W=Pe.clone(I.boundingSphere),$=Qi(W,M.aTransform.ref.value,U,0);return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("mesh"),aPosition:I.vertexBuffer,aNormal:I.normalBuffer,aGroup:I.groupBuffer,elements:I.indexBuffer,dVaryingGroup:I.varyingGroup,boundingSphere:O.create($),invariantBoundingSphere:O.create(W),uInvariantBoundingSphere:O.create(dr.ofSphere(W))},G),J),X),Z),ne),Y),M),st.createValues(j,k)),{uDoubleSided:O.create(j.doubleSided),dFlatShaded:O.create(j.flatShaded),dFlipSided:O.create(j.flipSided),dIgnoreLight:O.create(j.ignoreLight),dXrayShaded:O.create("inverted"===j.xrayShaded?"inverted":!0===j.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(j.transparentBackfaces),uBumpFrequency:O.create(j.bumpFrequency),uBumpAmplitude:O.create(j.bumpAmplitude),meta:O.create(I.meta)})}function E(I,M){st.updateRenderableState(I,M),I.opaque=I.opaque&&!M.xrayShaded,I.writeDepth=I.opaque}e.transform=function c(I,M){var F=I.vertexBuffer.ref.value;Wh(M,F,0,I.vertexCount),he.isTranslationAndUniformScaling(M)||function cPe(e,t,r,n){for(var a=0,i=3*n;a<i;a+=3)b.fromArray(iu,t,r+a),b.transformMat3(iu,iu,e),b.toArray(iu,t,r+a)}(Qt.directionTransform(u,M),I.normalBuffer.ref.value,0,I.vertexCount),O.update(I.vertexBuffer,F)},e.getOriginalData=function l(I){return("kind"in I?I.meta:I.meta.ref.value).originalData},e.uniformTriangleGroup=function d(I,M){void 0===M&&(M=!0);var F=I.indexBuffer,N=I.vertexBuffer,j=I.groupBuffer,U=I.normalBuffer,H=I.triangleCount,z=I.vertexCount,G=F.ref.value,J=N.ref.value,X=j.ref.value,Z=U.ref.value,ne=qe.create(Uint32Array,3,1024,H),Y=qe.create(Float32Array,3,1024,J);Y.currentIndex=3*z,Y.elementCount=z;var k=qe.create(Float32Array,3,1024,Z);k.currentIndex=3*z,k.elementCount=z;var W=qe.create(Float32Array,1,1024,X);W.currentIndex=z,W.elementCount=z;var $=b(),K=b(),q=b(),V=b(),ee=b(),ae=b();function pe(He){b.fromArray($,J,3*He),b.fromArray(V,Z,3*He),qe.add3(Y,$[0],$[1],$[2]),qe.add3(k,V[0],V[1],V[2])}function me(He,Je){b.fromArray($,J,3*He),b.fromArray(K,J,3*Je),b.scale($,b.add($,$,K),.5),b.fromArray(V,Z,3*He),b.fromArray(ee,Z,3*Je),b.scale(V,b.add(V,V,ee),.5),qe.add3(Y,$[0],$[1],$[2]),qe.add3(k,V[0],V[1],V[2])}function de(He,Je,mt){b.fromArray($,J,3*He),b.fromArray(K,J,3*Je),b.fromArray(q,J,3*mt),b.scale($,b.add($,b.add($,$,K),q),1/3),b.fromArray(V,Z,3*He),b.fromArray(ee,Z,3*Je),b.fromArray(ae,Z,3*mt),b.scale(V,b.add(V,b.add(V,V,ee),ae),1/3),qe.add3(Y,$[0],$[1],$[2]),qe.add3(k,V[0],V[1],V[2])}function re(He,Je,mt,ut,St){++le,pe(He),me(He,Je),me(He,mt),qe.add3(ne,te,te+1,te+2);for(var wt=0;wt<3;++wt)qe.add(W,ut);for(te+=3,le+=2,pe(Je),pe(mt),me(He,Je),me(He,mt),qe.add3(ne,te,te+1,te+3),qe.add3(ne,te,te+3,te+2),wt=0;wt<4;++wt)qe.add(W,St);te+=4}var te=z,le=0;if(M)for(var ge=0,xe=H;ge<xe;++ge){var we=X[L=G[3*ge+2]];if((Q=X[Ge=G[3*ge]])===(ye=X[je=G[3*ge+1]])&&Q===we)++le,qe.add3(ne,Ge,je,L);else if(Q===ye)re(L,Ge,je,we,Q);else if(Q===we)re(je,L,Ge,ye,we);else if(ye===we)re(Ge,je,L,Q,ye);else{le+=2,pe(Ge),me(Ge,je),me(Ge,L),de(Ge,je,L),qe.add3(ne,te,te+1,te+3),qe.add3(ne,te,te+3,te+2);for(var De=0;De<4;++De)qe.add(W,Q);for(te+=4,le+=2,pe(je),me(je,L),me(je,Ge),de(Ge,je,L),qe.add3(ne,te,te+1,te+3),qe.add3(ne,te,te+3,te+2),De=0;De<4;++De)qe.add(W,ye);for(te+=4,le+=2,pe(L),me(L,je),me(L,Ge),de(Ge,je,L),qe.add3(ne,te+3,te+1,te),qe.add3(ne,te+2,te+3,te),De=0;De<4;++De)qe.add(W,we);te+=4}}else for(ge=0,xe=H;ge<xe;++ge){var Ge,je,L,Q,ye;if(we=X[L=G[3*ge+2]],(Q=X[Ge=G[3*ge]])!==(ye=X[je=G[3*ge+1]])||Q!==we){++le,pe(Ge),pe(je),pe(L),qe.add3(ne,te,te+1,te+2);var Oe=ye===we?ye:Q;for(De=0;De<3;++De)qe.add(W,Oe);te+=3}else++le,qe.add3(ne,Ge,je,L)}var Ne=qe.compact(ne),Ue=qe.compact(Y),$e=qe.compact(k),Ie=qe.compact(W);return I.vertexCount=te,I.triangleCount=le,O.update(N,Ue),O.update(j,Ie),O.update(F,Ne),O.update(U,$e),I.meta.originalData={indexBuffer:G,vertexCount:z,triangleCount:H},I},e.smoothEdges=function S(I,M){!function v(I,M){for(var F=I.indexBuffer,N=I.triangleCount,j=F.ref.value,U=qe.create(Uint32Array,3,1024,N),H=0,z=0;z<N;++z){var G=j[3*z],J=j[3*z+1],X=j[3*z+2];2===M[G].length||2===M[J].length||2===M[X].length||(qe.add3(U,G,J,X),H+=1)}var Z=qe.compact(U);I.triangleCount=H,O.update(F,Z)}(I,f(I));for(var F=0;F<10;++F){var N=I.triangleCount,j=p(I),U=f(I);if(g(I,U,h(U,m(j),j),M.maxNewEdgeLength*M.maxNewEdgeLength),I.triangleCount===N)break}var G=p(I);return function y(I,M,F){for(var N=F.iterations,j=F.lambda,U=b(),H=b(),z=b(),G=b(),J=-j,X=new Float32Array(I.vertexBuffer.ref.value.length),Z=function(Y){var k=I.vertexBuffer.ref.value;X.set(k),M.forEach(function($,K){if(2===$.length){b.fromArray(U,k,3*K),b.fromArray(H,k,3*$[0]),b.fromArray(z,k,3*$[1]);var q=1/b.distance(U,H),V=1/b.distance(U,z);b.scale(H,H,q),b.scale(z,z,V),b.add(G,H,z),b.scale(G,G,1/(q+V)),b.sub(G,G,U),b.scale(G,G,Y),b.add(G,U,G),b.toArray(G,X,3*K)}});var W=I.vertexBuffer.ref.value;O.update(I.vertexBuffer,X),X=W},ne=0;ne<N;++ne)Z(j),Z(J)}(I,h(f(I),m(G),G),{iterations:M.iterations,lambda:.5}),I},e.Params=R(R({},st.Params),{doubleSided:T.Boolean(!1,st.CustomQualityParamInfo),flipSided:T.Boolean(!1,st.ShadingCategory),flatShaded:T.Boolean(!1,st.ShadingCategory),ignoreLight:T.Boolean(!1,st.ShadingCategory),xrayShaded:T.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],st.ShadingCategory),transparentBackfaces:T.Select("off",T.arrayToOptions(["off","on","opaque"]),st.ShadingCategory),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory),bumpAmplitude:T.Numeric(1,{min:0,max:5,step:.1},st.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:_,createValuesSimple:function x(I,M,F,N,j){var U=st.createSimple(F,N,j),H=R(R({},T.getDefaultValues(e.Params)),M);return _(I,U.transform,U.locationIterator,U.theme,H)},updateValues:function D(I,M){st.updateValues(I,M),O.updateIfChanged(I.uDoubleSided,M.doubleSided),O.updateIfChanged(I.dFlatShaded,M.flatShaded),O.updateIfChanged(I.dFlipSided,M.flipSided),O.updateIfChanged(I.dIgnoreLight,M.ignoreLight),O.updateIfChanged(I.dXrayShaded,"inverted"===M.xrayShaded?"inverted":!0===M.xrayShaded?"on":"off"),O.updateIfChanged(I.dTransparentBackfaces,M.transparentBackfaces),O.updateIfChanged(I.uBumpFrequency,M.bumpFrequency),O.updateIfChanged(I.uBumpAmplitude,M.bumpAmplitude)},updateBoundingSphere:function w(I,M){var F=Pe.clone(M.boundingSphere),N=Qi(F,I.aTransform.ref.value,I.instanceCount.ref.value,0);Pe.equals(N,I.boundingSphere.ref.value)||O.update(I.boundingSphere,N),Pe.equals(F,I.invariantBoundingSphere.ref.value)||(O.update(I.invariantBoundingSphere,F),O.update(I.uInvariantBoundingSphere,dr.fromSphere(I.uInvariantBoundingSphere.ref.value,F)))},createRenderableState:function A(I){var M=st.createRenderableState(I);return E(M,I),M},updateRenderableState:E,createPositionIterator:C}}(Vt||(Vt={}));var lFe={radius:1,detail:0};var nK=b(),aK=b(),iK=b();function vA(e,t){for(var r=t.length,n=H0(r/3),a=0;a<r;a+=3)b.fromArray(nK,e,3*t[a]),b.fromArray(aK,e,3*t[a+1]),b.fromArray(iK,e,3*t[a+2]),n.add(nK,aK,iK);return n.getPrimitive()}var gA=b();function H0(e,t){void 0===t&&(t=3*e);var r=new Float32Array(3*t),n=new Float32Array(3*t),a=new Uint32Array(3*e),i=0,o=0;return{add:function(s,u,c){b.toArray(s,r,i),b.toArray(u,r,i+3),b.toArray(c,r,i+6),b.triangleNormal(gA,s,u,c);for(var l=0;l<3;++l)b.toArray(gA,n,i+3*l),a[o+l]=i/3+l;i+=9,o+=3},addQuad:function(s,u,c,l){b.toArray(s,r,i),b.toArray(u,r,i+3),b.toArray(c,r,i+6),b.toArray(l,r,i+9),b.triangleNormal(gA,s,u,c);for(var d=0;d<4;++d)b.toArray(gA,n,i+3*d);var f=i/3;a[o]=f,a[o+1]=f+1,a[o+2]=f+2,a[o+3]=f+2,a[o+4]=f+3,a[o+5]=f,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var j0=b(),pFe=Qt();function YF(e,t){for(var r=e.vertices,n=e.normals,a=Qt.directionTransform(pFe,t),i=0,o=r.length;i<o;i+=3)b.transformMat4(j0,b.fromArray(j0,r,i),t),b.toArray(j0,r,i),b.transformMat3(j0,b.fromArray(j0,n,i),a),b.toArray(j0,n,i);return e}function NS(e,t){return{vertices:e,edges:t}}function oK(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var XF=b.zero();function sK(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)b.transformMat4(XF,b.fromArray(XF,r,n),t),b.toArray(XF,r,n);return e}var KF,Dc=(1+Math.sqrt(5))/2,uK=[-1,Dc,0,1,Dc,0,-1,-Dc,0,1,-Dc,0,0,-1,Dc,0,1,Dc,0,-1,-Dc,0,1,-Dc,Dc,0,-1,Dc,0,1,-Dc,0,-1,-Dc,0,1],mFe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];NS(uK,[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9]);var cK=function vFe(){return KF||(KF=vA(uK,mFe)),KF}(),yFe=cK.vertices,bFe=cK.indices;function kS(e){return 10*Math.pow(Math.pow(2,e),2)+2}var lK=new Map,CFe=he.identity();function dK(e){var t=lK.get(e);return void 0===t&&(t=function SFe(e){return function dFe(e,t,r){var n=R(R({},lFe),r),a=n.radius,i=n.detail,o=function fFe(){var e=[],t=[],r=new Map;function n(a){var i="".concat(a[0].toFixed(5),"|").concat(a[1].toFixed(5),"|").concat(a[2].toFixed(5)),o=r.get(i);return void 0===o&&(r.set(i,o=e.length/3),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}(),s=o.vertices,u=o.indices;(function l(f){for(var p=b(),m=b(),h=b(),v=0;v<t.length;v+=3)b.fromArray(p,e,3*t[v+0]),b.fromArray(m,e,3*t[v+1]),b.fromArray(h,e,3*t[v+2]),d(p,m,h,f)})(i),function lPe(e,t){for(var r=0,n=e.length;r<n;r+=3)b.fromArray(iu,e,r),b.normalize(iu,iu),b.scale(iu,iu,t),b.toArray(iu,e,r)}(s,a);var c=new Float32Array(s.length);return QY(s,u,c,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(c),indices:new Uint32Array(u)};function d(f,p,m,h){for(var v=Math.pow(2,h),g=[],y=0;y<=v;++y){g[y]=[];var S=b();b.lerp(S,f,m,y/v);var C=b();b.lerp(C,p,m,y/v);for(var _=v-y,x=0;x<=_;++x)if(0===x&&y===v)g[y][x]=S;else{var D=b();b.lerp(D,S,C,x/_),g[y][x]=D}}for(y=0;y<v;++y)for(x=0;x<2*(v-y)-1;++x){var w=Math.floor(x/2);x%2==0?o.add(g[y][w+1],g[y+1][w],g[y][w]):o.add(g[y][w+1],g[y+1][w+1],g[y+1][w])}}}(yFe,bFe,{detail:e,radius:1})}(e),lK.set(e,t)),t}function Mi(e,t,r,n){yt.addPrimitive(e,function xFe(e,t,r){return he.scaleUniformly(e,he.fromTranslation(e,t),r)}(CFe,t,r),dK(n))}var md={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:2*Math.PI};function hd(e,t,r){void 0===r&&(r=-1);for(var n=new Float32Array(3*e),a=-1===r?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(2*o+i)/e*Math.PI;n[3*o]=Math.cos(u)*a,n[3*o+1]=Math.sin(u)*a,n[3*o+2]=0}return n}var ZF,QF,$F,JF,e4,fK=b(),pK=b(),ou=b(),su=b(),vd=b(),q0=b(),wFe={height:1,topCap:!0,bottomCap:!0};function W0(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=R(R({},wFe),t),a=n.height,i=n.topCap,o=n.bottomCap,s=2*r,u=4*r,c=(i?1:0)+(o?1:0);3===r?(s+=c,u+=3*c):4===r?(s+=2*c,u+=4*c):(s+=c*r,u+=c*r*3);var l=H0(s,u),d=.5*a;b.set(fK,0,0,-d),b.set(pK,0,0,d);for(var f=0;f<r;++f){var p=(f+1)%r;b.set(ou,e[3*f],e[3*f+1],-d),b.set(su,e[3*p],e[3*p+1],-d),b.set(vd,e[3*p],e[3*p+1],d),b.set(q0,e[3*f],e[3*f+1],d),l.addQuad(ou,su,vd,q0)}if(3===r)i&&(b.set(ou,e[0],e[1],-d),b.set(su,e[3],e[4],-d),b.set(vd,e[6],e[7],-d),l.add(vd,su,ou)),o&&(b.set(ou,e[0],e[1],d),b.set(su,e[3],e[4],d),b.set(vd,e[6],e[7],d),l.add(ou,su,vd));else if(4===r)i&&(b.set(ou,e[0],e[1],-d),b.set(su,e[3],e[4],-d),b.set(vd,e[6],e[7],-d),b.set(q0,e[9],e[10],-d),l.addQuad(q0,vd,su,ou)),o&&(b.set(ou,e[0],e[1],d),b.set(su,e[3],e[4],d),b.set(vd,e[6],e[7],d),b.set(q0,e[9],e[10],d),l.addQuad(ou,su,vd,q0));else for(f=0;f<r;++f)p=(f+1)%r,i&&(b.set(ou,e[3*f],e[3*f+1],-d),b.set(su,e[3*p],e[3*p+1],-d),l.add(fK,su,ou)),o&&(b.set(ou,e[3*f],e[3*f+1],d),b.set(su,e[3*p],e[3*p+1],d),l.add(ou,su,pK));return l.getPrimitive()}var mK=new Map,hK=b.create(0,1,0),Ec=b(),yA=b(),vK=b(),gd=he(),gK=he(),yK=b(),yd=b(),i4=b();function LS(e,t,r,n,a){return b.setMagnitude(yA,r,n/2),b.add(vK,t,yA),a?b.matchDirection(i4,hK,yA):b.copy(i4,hK),b.set(yK,1,n,1),b.makeRotation(gK,i4,yA),he.scale(e,gK,yK),he.setTranslation(e,vK)}var bd=new Int32Array(9);function US(e){var t=function PFe(e){var t,r,n,a,i,o,s,u,c;return bd[0]=Math.round(1e3*(null!==(t=e.radiusTop)&&void 0!==t?t:md.radiusTop)),bd[1]=Math.round(1e3*(null!==(r=e.radiusBottom)&&void 0!==r?r:md.radiusBottom)),bd[2]=Math.round(1e3*(null!==(n=e.height)&&void 0!==n?n:md.height)),bd[3]=null!==(a=e.radialSegments)&&void 0!==a?a:md.radialSegments,bd[4]=null!==(i=e.heightSegments)&&void 0!==i?i:md.heightSegments,bd[5]=(null!==(o=e.topCap)&&void 0!==o?o:md.topCap)?1:0,bd[6]=(null!==(s=e.bottomCap)&&void 0!==s?s:md.bottomCap)?1:0,bd[7]=Math.round(1e3*(null!==(u=e.thetaStart)&&void 0!==u?u:md.thetaStart)),bd[8]=Math.round(1e3*(null!==(c=e.thetaLength)&&void 0!==c?c:md.thetaLength)),rs(bd)}(e),r=mK.get(t);return void 0===r&&(r=e.radialSegments&&e.radialSegments<=4?YF(W0(hd(Math.max(3,e.radialSegments),!0,e.radiusTop),e),he.rotX90):function _Fe(e){var t=R(R({},md),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,c=t.thetaStart,l=t.thetaLength,d=[],f=[],p=[],m=0,h=[],v=a/2;return function g(){for(var S=b.zero(),C=(n-r)/a,_=0;_<=o;++_){for(var x=[],D=_/o,w=D*(n-r)+r,A=0;A<=i;++A){var I=A/i*l+c,M=Math.sin(I),F=Math.cos(I);f.push(w*M,-D*a+v,w*F),b.normalize(S,b.set(S,M,C,F)),p.push.apply(p,S),x.push(m++)}h.push(x)}for(A=0;A<i;++A)for(_=0;_<o;++_){var j=h[_+1][A],U=h[_+1][A+1],H=h[_][A+1];d.push(h[_][A],j,H),d.push(j,U,H)}}(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function y(S){for(var C=!0===S?r:n,_=!0===S?1:-1,x=m,D=1;D<=i;++D)f.push(0,v*_,0),p.push(0,_,0),++m;var w=m;for(D=0;D<=i;++D){var E=D/i*l+c,I=Math.cos(E),M=Math.sin(E);f.push(C*M,v*_,C*I),p.push(0,_,0),++m}for(D=0;D<i;++D){var F=x+D,N=w+D;!0===S?d.push(N,N+1,F):d.push(N+1,N,F)}}}(e),mK.set(t,r)),r}function yo(e,t,r,n,a){var i=b.distance(t,r)*n;b.sub(Ec,r,t),LS(gd,t,Ec,i,!0),yt.addPrimitive(e,gd,US(a))}function MFe(e,t,r,n,a,i){var o=b.distance(t,r)*n,s=US(i);b.sub(Ec,r,t),b.add(yd,t,a),LS(gd,yd,Ec,o,!0),yt.addPrimitive(e,gd,s),b.sub(yd,t,a),LS(gd,yd,Ec,o,!0),yt.addPrimitive(e,gd,s)}function VS(e,t,r,n,a,i,o){var s=b.distance(t,r)*n,u=a%2!=0,c=Math.floor((a+1)/2),l=s/(a+.5),d=US(o);b.setMagnitude(Ec,b.sub(Ec,r,t),l),b.copy(yd,t);for(var f=0;f<c;++f)b.add(yd,yd,Ec),u&&f===c-1&&(!i&&o.topCap&&(o.topCap=!1,d=US(o)),l/=2),LS(gd,yd,Ec,l,!1),yt.addPrimitive(e,gd,d),b.add(yd,yd,Ec)}var yt,Za=b(),bK=Qt(),Ff=b(),Sd=b(),Zh=b(),bA=b(),Gu=b.fromArray,RFe=b.triangleNormal,SK=b.copy,SA=b.transformMat4,CK=b.transformMat3,xK=Qt.directionTransform,yl=qe.add3,o4=qe.add;function GS(e,t,r){return e=Xi(Math.round(e),0,16777215)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function s4(e,t,r){return 256*Math.floor(e)*256+256*Math.floor(t)+Math.floor(r)-1}!function(e){function r(l,d,f,p){var m=l.vertices,h=l.normals,v=l.indices,g=l.groups,y=l.currentGroup,S=m.elementCount;yl(m,d[0],d[1],d[2]),yl(m,f[0],f[1],f[2]),yl(m,p[0],p[1],p[2]),RFe(Za,d,f,p);for(var C=0;C<3;++C)yl(h,Za[0],Za[1],Za[2]),o4(g,y);yl(v,S,S+1,S+2)}function i(l,d,f){for(var p=f.vertices,m=f.normals,h=f.indices,v=l.vertices,g=l.normals,y=l.indices,S=l.groups,C=l.currentGroup,_=v.elementCount,x=xK(bK,d),D=0,w=p.length;D<w;D+=3)SA(Za,Gu(Za,p,D),d),yl(v,Za[0],Za[1],Za[2]),CK(Za,Gu(Za,m,D),x),yl(g,Za[0],Za[1],Za[2]),o4(S,C);for(D=0,w=h.length;D<w;D+=3)yl(y,h[D]+_,h[D+1]+_,h[D+2]+_)}e.createState=function t(l,d,f){return void 0===l&&(l=2048),void 0===d&&(d=1024),{currentGroup:-1,vertices:qe.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:l),normals:qe.create(Float32Array,3,d,f?f.normalBuffer.ref.value:l),indices:qe.create(Uint32Array,3,3*d,f?f.indexBuffer.ref.value:3*l),groups:qe.create(Float32Array,1,d,f?f.groupBuffer.ref.value:l),mesh:f}},e.addTriangle=r,e.addTriangleStrip=function n(l,d,f){Gu(Zh,d,3*f[0]),Gu(bA,d,3*f[1]);for(var p=2,m=f.length;p<m;p+=2)SK(Ff,Zh),SK(Sd,bA),Gu(Zh,d,3*f[p]),Gu(bA,d,3*f[p+1]),r(l,Ff,Sd,Zh),r(l,Sd,bA,Zh)},e.addTriangleFan=function a(l,d,f){Gu(Ff,d,3*f[0]);for(var p=2,m=f.length;p<m;++p)Gu(Sd,d,3*f[p-1]),Gu(Zh,d,3*f[p]),r(l,Ff,Zh,Sd)},e.addPrimitive=i,e.addPrimitiveFlipped=function o(l,d,f){for(var p=f.vertices,m=f.normals,h=f.indices,v=l.vertices,g=l.normals,y=l.indices,S=l.groups,C=l.currentGroup,_=v.elementCount,x=xK(bK,d),D=0,w=p.length;D<w;D+=3)SA(Za,Gu(Za,p,D),d),yl(v,Za[0],Za[1],Za[2]),CK(Za,Gu(Za,m,D),x),yl(g,-Za[0],-Za[1],-Za[2]),o4(S,C);for(D=0,w=h.length;D<w;D+=3)yl(y,h[D+2]+_,h[D+1]+_,h[D]+_)},e.addCage=function s(l,d,f,p,m,h){for(var v=f.vertices,g=f.edges,y={radiusTop:p,radiusBottom:p,radialSegments:h},S=0,C=g.length;S<C;S+=2)Gu(Ff,v,3*g[S]),Gu(Sd,v,3*g[S+1]),SA(Ff,Ff,d),SA(Sd,Sd,d),Mi(l,Ff,p,m),Mi(l,Sd,p,m),yo(l,Ff,Sd,1,y)},e.addMesh=function u(l,d,f){i(l,d,{vertices:f.vertexBuffer.ref.value.subarray(0,3*f.vertexCount),normals:f.normalBuffer.ref.value.subarray(0,3*f.vertexCount),indices:f.indexBuffer.ref.value.subarray(0,3*f.triangleCount)})},e.getMesh=function c(l){var f=l.normals,p=l.indices,m=l.groups,h=l.mesh,v=qe.compact(l.vertices,!0),g=qe.compact(p,!0),y=qe.compact(f,!0),S=qe.compact(m,!0);return Vt.create(v,g,y,S,l.vertices.elementCount,l.indices.elementCount,h)}}(yt||(yt={}));var CA=255/256,u4=b.create(16777216,65536,256),OFe=dr.create(CA/u4[0],CA/u4[1],CA/u4[2],CA/1),_K=dr();function Bf(e,t,r){switch(Oi.getGranularity(e,t.granularity)){case"uniform":return function LFe(e,t,r){return function kFe(e,t){return t?(O.update(t.uSize,e),O.updateIfChanged(t.dSizeType,"uniform"),t):R(R({uSize:O.create(e)},function NFe(){return{tSize:O.create(BFe),uSizeTexDim:O.create(Be.create(1,1))}}()),{dSizeType:O.create("uniform")})}(t(Uu),r)}(0,t.size,r);case"group":return function VFe(e,t,r){var a=gi(Math.max(1,e.groupCount),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();GS(t(i.location)*xA,a.array,3*i.groupIndex)}return c4(a,"group",r)}(e,t.size,r);case"groupInstance":return function GFe(e,t,r){var o=gi(Math.max(1,e.instanceCount*e.groupCount),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();GS(t(s.location)*xA,o.array,3*s.index)}return c4(o,"groupInstance",r)}(e,t.size,r);case"instance":return function UFe(e,t,r){var a=gi(Math.max(1,e.instanceCount),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();GS(t(i.location)*xA,a.array,3*i.instanceIndex),e.skipInstance()}return c4(a,"instance",r)}(e,t.size,r)}}var xA=100;function zS(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=s4(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/xA}}var fm,BFe={array:new Uint8Array(3),width:1,height:1};function c4(e,t,r){return r?(O.update(r.tSize,e),O.update(r.uSizeTexDim,Be.create(e.width,e.height)),O.updateIfChanged(r.dSizeType,t),r):{uSize:O.create(0),tSize:O.create(e),uSizeTexDim:O.create(Be.create(e.width,e.height)),dSizeType:O.create(t)}}function wK(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];for(AK(n,a,i,o,r),u=0;u<r;u++)e[u*t+s]=a[u]}for(u=0;u<r;u++){for(s=0;s<t;s++)n[s]=e[u*t+s];for(AK(n,a,i,o,t),s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function AK(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);r[++o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}!function(e){function t(m,h,v,g){return g?function i(m,h,v,g){return g.pointCount=v,O.update(g.centerBuffer,m),O.update(g.groupBuffer,h),g}(m,h,v,g):function a(m,h,v){var y,g=Pe(),S=-1,C=-1,_={kind:"points",pointCount:v,centerBuffer:O.create(m),groupBuffer:O.create(h),get boundingSphere(){var x=n(_);if(x!==S){var D=Ef(_.centerBuffer.ref.value,_.pointCount,1);Pe.copy(g,D),S=x}return g},get groupMapping(){return _.groupBuffer.ref.version!==C&&(y=G0(_.groupBuffer.ref.value,_.pointCount),C=_.groupBuffer.ref.version),y},setBoundingSphere:function(x){Pe.copy(g,x),S=n(_)}};return _}(m,h,v)}function r(m){return t(m?m.centerBuffer.ref.value:new Float32Array(0),m?m.groupBuffer.ref.value:new Float32Array(0),0,m)}function n(m){return rs([m.pointCount,m.centerBuffer.ref.version,m.groupBuffer.ref.version])}function s(m,h){var v=m.pointCount,g=h.instanceCount.ref.value,y=lm(),S=y.position,C=m.centerBuffer.ref.value,_=h.aTransform.ref.value;return On(v,g,1,function(D,w){return w<0?b.fromArray(S,C,3*D):b.transformMat4Offset(S,C,_,0,3*D,16*w),y})}function u(m,h,v,g,y){var S=v.instanceCount,C=v.groupCount,x=Vu(v,s(m,h),g.color),D=Bf(v,g.size),w=y.instanceGranularity?Ia(S,"instance"):Ia(S*C,"groupInstance"),A=Pf(),E=Mf(),I=Of(),M=Rf(),F={drawCount:m.pointCount,vertexCount:m.pointCount,groupCount:C,instanceCount:S},N=Pe.clone(m.boundingSphere),j=Qi(N,h.aTransform.ref.value,S,0);return R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("points"),aPosition:m.centerBuffer,aGroup:m.groupBuffer,boundingSphere:O.create(j),invariantBoundingSphere:O.create(N),uInvariantBoundingSphere:O.create(dr.ofSphere(N))},x),D),w),A),E),I),M),h),st.createValues(y,F)),{uSizeFactor:O.create(y.sizeFactor),dPointSizeAttenuation:O.create(y.pointSizeAttenuation),dPointStyle:O.create(y.pointStyle)})}function p(m,h){st.updateRenderableState(m,h),m.opaque=m.opaque&&"fuzzy"!==h.pointStyle,m.writeDepth=m.opaque}e.create=t,e.createEmpty=r,e.transform=function o(m,h){var v=m.centerBuffer.ref.value;Wh(h,v,0,m.pointCount),O.update(m.centerBuffer,v)},e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params=R(R({},st.Params),{sizeFactor:T.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:T.Boolean(!1),pointStyle:T.Select("square",T.objectToOptions(e.StyleTypes))}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:function c(m,h,v,g,y){var S=st.createSimple(v,g,y),C=R(R({},T.getDefaultValues(e.Params)),h);return u(m,S.transform,S.locationIterator,S.theme,C)},updateValues:function l(m,h){st.updateValues(m,h),O.updateIfChanged(m.uSizeFactor,h.sizeFactor),O.updateIfChanged(m.dPointSizeAttenuation,h.pointSizeAttenuation),O.updateIfChanged(m.dPointStyle,h.pointStyle)},updateBoundingSphere:function d(m,h){var v=Pe.clone(h.boundingSphere),g=Qi(v,m.aTransform.ref.value,m.instanceCount.ref.value,0);Pe.equals(g,m.boundingSphere.ref.value)||O.update(m.boundingSphere,g),Pe.equals(v,m.invariantBoundingSphere.ref.value)||(O.update(m.invariantBoundingSphere,v),O.update(m.uInvariantBoundingSphere,dr.fromSphere(m.uInvariantBoundingSphere.ref.value,v)))},createRenderableState:function f(m){var h=st.createRenderableState(m);return p(h,m),h},updateRenderableState:p,createPositionIterator:s}}(fm||(fm={}));var zu,l4={},TK={fontFamily:T.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:T.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:T.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:T.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:T.Select("normal",[["normal","Normal"],["bold","Bold"]])},HFe=function(){function e(t){void 0===t&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=R(R({},T.getDefaultValues(TK)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(.75*this.lineHeight),this.texture=gi(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d",{willReadFrequently:!0}),this.scratchContext.font="".concat(r.fontStyle," ").concat(r.fontVariant," ").concat(r.fontWeight," ").concat(n,"px ").concat(r.fontFamily),this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(void 0===this.mapped[t]){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),c=0;c<s;c++){var l=u.data[4*c+3]/255;this.gridOuter[c]=1===l?0:0===l?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-l),2),this.gridInner[c]=1===l?Number.MAX_SAFE_INTEGER:0===l?0:Math.pow(Math.max(0,l-.5),2)}for(wK(this.gridOuter,o,r,this.f,this.d,this.v,this.z),wK(this.gridInner,o,r,this.f,this.d,this.v,this.z),c=0;c<s;c++)a[c]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[c]-this.gridInner[c])/this.radius+this.cutoff))));this.scratchW=o,this.scratchH=r},e}();function DK(e,t,r,n){for(var a=0,i=0,o=0,s=4*r;o<s;++o){var u=2*o,c=Math.abs(e[u]);c>a&&(a=c);var l=Math.abs(e[u+1]);l>a&&(a=l);var d=Math.abs(t[o]);d>i&&(i=d)}return Math.max(i,n+n*a)}!function(e){function t(p,m,h,v,g,y,S,C,_){return _?function i(p,m,h,v,g,y,S,C,_){return _.charCount=C,O.update(_.fontTexture,p),O.update(_.centerBuffer,m),O.update(_.mappingBuffer,h),O.update(_.depthBuffer,v),O.update(_.indexBuffer,g),O.update(_.groupBuffer,y),O.update(_.tcoordBuffer,S),_}(p,m,h,v,g,y,S,C,_):function a(p,m,h,v,g,y,S,C){var x,_=Pe(),D=-1,w=-1,A={kind:"text",charCount:C,fontTexture:O.create(p),centerBuffer:O.create(m),mappingBuffer:O.create(h),depthBuffer:O.create(v),indexBuffer:O.create(g),groupBuffer:O.create(y),tcoordBuffer:O.create(S),get boundingSphere(){var E=n(A);if(E!==D){var I=Ef(A.centerBuffer.ref.value,4*A.charCount,4);Pe.copy(_,I),D=E}return _},get groupMapping(){return A.groupBuffer.ref.version!==w&&(x=G0(A.groupBuffer.ref.value,A.charCount,4),w=A.groupBuffer.ref.version),x},setBoundingSphere:function(E){Pe.copy(_,E),D=n(A)}};return A}(p,m,h,v,g,y,S,C)}function r(p){return t(p?p.fontTexture.ref.value:gi(0,1,Uint8Array),p?p.centerBuffer.ref.value:new Float32Array(0),p?p.mappingBuffer.ref.value:new Float32Array(0),p?p.depthBuffer.ref.value:new Float32Array(0),p?p.indexBuffer.ref.value:new Uint32Array(0),p?p.groupBuffer.ref.value:new Float32Array(0),p?p.tcoordBuffer.ref.value:new Float32Array(0),0,p)}function n(p){return rs([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function o(p,m){var h=4*p.charCount,v=m.instanceCount.ref.value,g=lm(),y=g.position,S=p.centerBuffer.ref.value,C=m.aTransform.ref.value;return On(h,v,4,function(x,D){return D<0?b.fromArray(y,S,3*x):b.transformMat4Offset(y,S,C,0,3*x,16*D),g})}function s(p,m,h,v,g){var y=h.instanceCount,S=h.groupCount,_=Vu(h,o(p,m),v.color),x=Bf(h,v.size),D=g.instanceGranularity?Ia(y,"instance"):Ia(y*S,"groupInstance"),w=Pf(),A=Mf(),E=Of(),I=Rf(),M={drawCount:2*p.charCount*3,vertexCount:4*p.charCount,groupCount:S,instanceCount:y},F=DK(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,zS(x)),N=Pe.expand(Pe(),p.boundingSphere,F),j=Qi(N,m.aTransform.ref.value,y,0);return R(R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("text"),aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:O.create(j),invariantBoundingSphere:O.create(N),uInvariantBoundingSphere:O.create(dr.ofSphere(N))},_),x),D),w),A),E),I),m),{aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:O.create(F)}),st.createValues(g,M)),{uSizeFactor:O.create(g.sizeFactor),uBorderWidth:O.create(Xi(g.borderWidth,0,.5)),uBorderColor:O.create(dt.toArrayNormalized(g.borderColor,b.zero(),0)),uOffsetX:O.create(g.offsetX),uOffsetY:O.create(g.offsetY),uOffsetZ:O.create(g.offsetZ),uBackgroundColor:O.create(dt.toArrayNormalized(g.backgroundColor,b.zero(),0)),uBackgroundOpacity:O.create(g.backgroundOpacity)})}function f(p,m){st.updateRenderableState(p,m),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}e.create=t,e.createEmpty=r,e.Params=R(R(R({},st.Params),TK),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),borderWidth:T.Numeric(0,{min:0,max:.5,step:.01}),borderColor:T.Color(vr.grey),offsetX:T.Numeric(0,{min:0,max:10,step:.1}),offsetY:T.Numeric(0,{min:0,max:10,step:.1}),offsetZ:T.Numeric(0,{min:0,max:10,step:.1}),background:T.Boolean(!1),backgroundMargin:T.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:T.Color(vr.grey),backgroundOpacity:T.Numeric(1,{min:0,max:1,step:.01}),tether:T.Boolean(!1),tetherLength:T.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:T.Numeric(.3,{min:0,max:1,step:.01}),attachment:T.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:function u(p,m,h,v,g){var y=st.createSimple(h,v,g),S=R(R({},T.getDefaultValues(e.Params)),m);return s(p,y.transform,y.locationIterator,y.theme,S)},updateValues:function c(p,m){st.updateValues(p,m),O.updateIfChanged(p.uSizeFactor,m.sizeFactor),O.updateIfChanged(p.uBorderWidth,m.borderWidth),dt.fromNormalizedArray(p.uBorderColor.ref.value,0)!==m.borderColor&&(dt.toArrayNormalized(m.borderColor,p.uBorderColor.ref.value,0),O.update(p.uBorderColor,p.uBorderColor.ref.value)),O.updateIfChanged(p.uOffsetX,m.offsetX),O.updateIfChanged(p.uOffsetY,m.offsetY),O.updateIfChanged(p.uOffsetZ,m.offsetZ),dt.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==m.backgroundColor&&(dt.toArrayNormalized(m.backgroundColor,p.uBackgroundColor.ref.value,0),O.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),O.updateIfChanged(p.uBackgroundOpacity,m.backgroundOpacity)},updateBoundingSphere:function l(p,m){var h=DK(p.aMapping.ref.value,p.aDepth.ref.value,m.charCount,zS(p)),v=Pe.expand(Pe(),m.boundingSphere,h),g=Qi(v,p.aTransform.ref.value,p.instanceCount.ref.value,0);Pe.equals(g,p.boundingSphere.ref.value)||O.update(p.boundingSphere,g),Pe.equals(v,p.invariantBoundingSphere.ref.value)||(O.update(p.invariantBoundingSphere,v),O.update(p.uInvariantBoundingSphere,dr.fromSphere(p.uInvariantBoundingSphere.ref.value,v))),O.update(p.padding,h)},createRenderableState:function d(p){var m=st.createRenderableState(p);return f(m,p),m},updateRenderableState:f,createPositionIterator:o}}(zu||(zu={}));var uu,na,ks=b(),bl=b(),HS=b(),EK=qe.add,_A=qe.add3;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(d,f,p,m,h,v,g){for(var y=0;y<4;++y)_A(o,d,f,p),_A(s,m,h,v),EK(i,g)},l=function(d,f,p,m){var h=b.distance(d,f),v=p%2!=0,g=Math.floor((p+1)/2),y=h/(p+.5);b.setMagnitude(HS,b.sub(HS,f,d),y),b.copy(ks,d);for(var S=0;S<g;++S)b.add(ks,ks,HS),v&&S===g-1?b.copy(bl,f):b.add(bl,ks,HS),u(ks[0],ks[1],ks[2],bl[0],bl[1],bl[2],m),b.add(ks,ks,HS)};return{add:u,addVec:function(d,f,p){for(var m=0;m<4;++m)_A(o,d[0],d[1],d[2]),_A(s,f[0],f[1],f[2]),EK(i,p)},addFixedCountDashes:l,addFixedLengthDashes:function(d,f,p,m){var h=b.distance(d,f);l(d,f,h/p,m)},addCage:function(d,f,p){for(var m=f.vertices,h=f.edges,v=0,g=h.length;v<g;v+=2)b.fromArray(ks,m,3*h[v]),b.fromArray(bl,m,3*h[v+1]),b.transformMat4(ks,ks,d),b.transformMat4(bl,bl,d),u(ks[0],ks[1],ks[2],bl[0],bl[1],bl[2],p)},getLines:function(){var d=i.elementCount/4,f=qe.compact(i,!0),p=qe.compact(o,!0),m=qe.compact(s,!0),h=a&&d<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(8*d),v=a&&d<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(6*d);return(!a||d>a.lineCount)&&function jFe(e,t,r){for(var n=0;n<e;++n){var a=8*n;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(n=0;n<e;++n){var i=4*n,o=6*n;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}(d,h,v),na.create(h,v,f,p,m,d,a)}}}}(uu||(uu={})),function(e){function t(p,m,h,v,g,y,S){return S?function o(p,m,h,v,g,y,S){return y>S.lineCount&&(O.update(S.mappingBuffer,p),O.update(S.indexBuffer,m)),S.lineCount=y,O.update(S.groupBuffer,h),O.update(S.startBuffer,v),O.update(S.endBuffer,g),S}(p,m,h,v,g,y,S):function i(p,m,h,v,g,y){var C,S=Pe(),_=-1,x=-1,D={kind:"lines",lineCount:y,mappingBuffer:O.create(p),indexBuffer:O.create(m),groupBuffer:O.create(h),startBuffer:O.create(v),endBuffer:O.create(g),get boundingSphere(){var w=a(D);if(w!==_){var A=Ef(D.startBuffer.ref.value,4*D.lineCount,4),E=Ef(D.endBuffer.ref.value,4*D.lineCount,4);Pe.expandBySphere(S,A,E),_=w}return S},get groupMapping(){return D.groupBuffer.ref.version!==x&&(C=G0(D.groupBuffer.ref.value,D.lineCount,4),x=D.groupBuffer.ref.version),C},setBoundingSphere:function(w){Pe.copy(S,w),_=a(D)}};return D}(p,m,h,v,g,y)}function r(p){return t(p?p.mappingBuffer.ref.value:new Float32Array(0),p?p.indexBuffer.ref.value:new Uint32Array(0),p?p.groupBuffer.ref.value:new Float32Array(0),p?p.startBuffer.ref.value:new Float32Array(0),p?p.endBuffer.ref.value:new Float32Array(0),0,p)}function a(p){return rs([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function u(p,m){var h=4*p.lineCount,v=m.instanceCount.ref.value,g=lm(),y=g.position,S=p.startBuffer.ref.value,C=p.endBuffer.ref.value,_=m.aTransform.ref.value;return On(h,v,2,function(D,w){var A=D%4==0?S:C;return w<0?b.fromArray(y,A,3*D):b.transformMat4Offset(y,A,_,0,3*D,16*w),g})}function c(p,m,h,v,g){var y=h.instanceCount,S=h.groupCount,_=Vu(h,u(p,m),v.color),x=Bf(h,v.size),D=g.instanceGranularity?Ia(y,"instance"):Ia(y*S,"groupInstance"),w=Pf(),A=Mf(),E=Of(),I=Rf(),M={drawCount:2*p.lineCount*3,vertexCount:4*p.lineCount,groupCount:S,instanceCount:y},F=Pe.clone(p.boundingSphere),N=Qi(F,m.aTransform.ref.value,y,0);return R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("lines"),aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:O.create(N),invariantBoundingSphere:O.create(F),uInvariantBoundingSphere:O.create(dr.ofSphere(F))},_),x),D),w),A),E),I),m),st.createValues(g,M)),{uSizeFactor:O.create(g.sizeFactor),dLineSizeAttenuation:O.create(g.lineSizeAttenuation),uDoubleSided:O.create(!0),dFlipSided:O.create(!1)})}e.create=t,e.createEmpty=r,e.fromMesh=function n(p,m){for(var h=p.vertexBuffer.ref.value,v=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,y=uu.create(3*p.triangleCount,p.triangleCount/10,m),S=0,C=3*p.triangleCount;S<C;S+=3){var _=v[S],x=v[S+1],D=v[S+2],w=h[3*_],A=h[3*_+1],E=h[3*_+2],I=h[3*x],M=h[3*x+1],F=h[3*x+2],N=h[3*D],j=h[3*D+1],U=h[3*D+2];y.add(w,A,E,I,M,F,g[_]),y.add(w,A,E,N,j,U,g[_]),y.add(I,M,F,N,j,U,g[x])}return y.getLines()},e.transform=function s(p,m){var h=p.startBuffer.ref.value;Wh(m,h,0,4*p.lineCount),O.update(p.startBuffer,h);var v=p.endBuffer.ref.value;Wh(m,v,0,4*p.lineCount),O.update(p.endBuffer,v)},e.Params=R(R({},st.Params),{sizeFactor:T.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:T.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:c,createValuesSimple:function l(p,m,h,v,g){var y=st.createSimple(h,v,g),S=R(R({},T.getDefaultValues(e.Params)),m);return c(p,y.transform,y.locationIterator,y.theme,S)},updateValues:function d(p,m){st.updateValues(p,m),O.updateIfChanged(p.uSizeFactor,m.sizeFactor),O.updateIfChanged(p.dLineSizeAttenuation,m.lineSizeAttenuation)},updateBoundingSphere:function f(p,m){var h=Pe.clone(m.boundingSphere),v=Qi(h,p.aTransform.ref.value,p.instanceCount.ref.value,0);Pe.equals(v,p.boundingSphere.ref.value)||O.update(p.boundingSphere,v),Pe.equals(h,p.invariantBoundingSphere.ref.value)||(O.update(p.invariantBoundingSphere,h),O.update(p.uInvariantBoundingSphere,dr.fromSphere(p.uInvariantBoundingSphere.ref.value,h)))},createRenderableState:st.createRenderableState,updateRenderableState:st.updateRenderableState,createPositionIterator:u}}(na||(na={}));var d4,p4,m4,Ri,Nf=b(),kf=b(),Lf=b(),Y0=b(),Qa=hd(4,!0);function IK(e){for(var n=H0(12,e?36:24),a=0;a<4;++a){var i=(a+1)%4;b.set(Nf,Qa[3*a],Qa[3*a+1],-.5),b.set(kf,Qa[3*i],Qa[3*i+1],-.5),b.set(Lf,Qa[3*i],Qa[3*i+1],.5),b.set(Y0,Qa[3*a],Qa[3*a+1],.5),e?n.add(Nf,kf,Lf):n.addQuad(Nf,kf,Lf,Y0)}return b.set(Nf,Qa[0],Qa[1],-.5),b.set(kf,Qa[3],Qa[4],-.5),b.set(Lf,Qa[6],Qa[7],-.5),b.set(Y0,Qa[9],Qa[10],-.5),e?n.add(Lf,kf,Nf):n.addQuad(Y0,Lf,kf,Nf),b.set(Nf,Qa[0],Qa[1],.5),b.set(kf,Qa[3],Qa[4],.5),b.set(Lf,Qa[6],Qa[7],.5),b.set(Y0,Qa[9],Qa[10],.5),e?n.add(Nf,kf,Lf):n.addQuad(Nf,kf,Lf,Y0),n.getPrimitive()}function f4(){return d4||(d4=IK(!1)),d4}function PK(){return m4||(m4=NS([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),m4}function MK(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function RK(e,t){for(var u,c,l,d,r=or(or([{x:0,alpha:0},{x:0,alpha:0}],e,!0),[{x:1,alpha:0},{x:1,alpha:0}],!1),a=t?t.ref.value.array:new Uint8Array(256),i=0,f=e.length+1,p=0;p<f;++p){u=r[p].alpha,c=r[p+1].alpha,l=r[p+2].alpha,d=r[p+3].alpha;for(var m=Math.round(256*(r[p+2].x-r[p+1].x)),h=0;h<m;++h)a[i]=Math.max(0,255*fw(u,c,l,d,h/m,.5)),++i}var g={array:a,width:256,height:1};return t?(O.update(t,g),t):O.create(g)}function OK(e,t,r,n){var a=(n-r)/t;0===a&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}function Hu(e){return e}!function(e){e.One={transform:{kind:"matrix",matrix:he.identity()},cells:Sr.create(Sr.Space([1,1,1],[0,1,2]),Sr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=he.zero(),r=he.zero();e.getGridToCartesianTransform=function n(u){if("matrix"===u.transform.kind)return he.copy(he(),u.transform.matrix);if("spacegroup"===u.transform.kind){var c=u.cells.space,l=he.fromScaling(t,b.div(b.zero(),Nt.size(b.zero(),u.transform.fractionalBox),b.ofArray(c.dimensions))),d=he.fromTranslation(r,u.transform.fractionalBox.min);return he.mul3(he.zero(),u.transform.cell.fromFractional,d,l)}return he.identity()},e.areEquivalent=function a(u,c){return u===c},e.isEmpty=function i(u){return 0===u.cells.data.length},e.getBoundingSphere=function o(u,c){c||(c=Pe());var l=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return Pe.fromDimensionsAndTransform(c,l,d)},e.getHistogram=function s(u,c){var l=u._historams;return l||(l=u._historams={}),l[c]||(l[c]=function WFe(e,t,r){if(r)return OK(e,t,r.min,r.max);var n=Fu(e);return OK(e,t,n[0],n[1])}(u.cells.data,c,{min:u.stats.min,max:u.stats.max})),l[c]}}(Ri||(Ri={})),function(e){e.getUUID=function t(r){return r.__key||(r.__key=kn.create22()),r.__key}}(Hu||(Hu={}));var wA,AA,nt,Sl=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;this._refs.set(t,Math.max(n+=r?1:-1,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++)i[a].dispose();r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++)n[r].dispose()})},e}();function YFe(e,t){var r=this;return Ve.create("Create Volume",function(){return ue(r,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S;return ce(this,function(C){if(a=e.values,i=Sr.Space((n=e.header).dim,[0,1,2],Float64Array),0===n.dataSetIds.length)o=a;else for(u=(s=n.dim)[0],c=s[1],l=s[2],d=(t?.dataIndex||0)+1,f=0,p=0,o=new Float64Array(u*c*l),m=0;m<u;m++)for(h=0;h<c;h++)for(v=0;v<l;v++)o[f++]=a[p],p+=d;return g=Sr.create(i,Sr.Data1(o)),y=he.fromTranslation(he(),n.origin),S=he.fromBasis(he(),n.basisX,n.basisY,n.basisZ),he.mul(y,y,S),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:Aw(o),max:id(o),mean:Tw(o),sigma:Dw(o)}},sourceData:wA.create(e),customProperties:new Sl,_propertyData:Object.create(null)}]})})})}function FK(e,t){var r=this;return Ve.create("Create Volume",function(n){return ue(r,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p;return ce(this,function(m){return i=e.volume_data_3d,o=ns.create((a=e.volume_data_3d_info).spacegroup_number.value(0),b.ofArray(a.spacegroup_cell_size.value(0)),b.scale(b.zero(),b.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Sr.convertToCanonicalAxisIndicesFastToSlow(s),c=u(a.sample_count.value(0)),l=Sr.Space(c,Sr.invertAxisOrder(s),Float32Array),d=Sr.create(l,Sr.Data1(i.values.toArray({array:Float32Array}))),f=b.ofArray(u(a.origin.value(0))),p=b.ofArray(u(a.dimensions.value(0))),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Nt.create(f,b.add(b.zero(),f,p))},cells:d,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:AA.create(e),customProperties:new Sl,_propertyData:Object.create(null)}]})})})}!function(e){e.is=function t(n){return"cube"===n?.kind},e.create=function r(n){return{kind:"cube",name:n.name,data:n}}}(wA||(wA={})),function(e){e.is=function t(n){return"dscif"===n?.kind},e.create=function r(n){return{kind:"dscif",name:n._name,data:n}}}(AA||(AA={})),function(e){var r;e.is=function t(g){var y,S,C,_;return(null===(_=null===(C=null===(S=null===(y=g?.grid)||void 0===y?void 0:y.cells)||void 0===S?void 0:S.space)||void 0===C?void 0:C.dimensions)||void 0===_?void 0:_.length)&&g?.sourceData&&g?.customProperties&&g?._propertyData},function(g){function D(E,I){return"absolute"===E.kind?E:{kind:"absolute",absoluteValue:g.calcAbsolute(I,E.relativeValue)}}g.areSame=function y(E,I,M){return ea(D(E,M).absoluteValue,D(I,M).absoluteValue,M.sigma/100)},g.absolute=function S(E){return{kind:"absolute",absoluteValue:E}},g.relative=function C(E){return{kind:"relative",relativeValue:E}},g.calcAbsolute=function _(E,I){return I*E.sigma+E.mean},g.calcRelative=function x(E,I){return 0===E.sigma?0:(I-E.mean)/E.sigma},g.toAbsolute=D,g.toRelative=function w(E,I){return"relative"===E.kind?E:{kind:"relative",relativeValue:g.calcRelative(I,E.absoluteValue)}},g.toString=function A(E){return"relative"===E.kind?"".concat(E.relativeValue.toFixed(2)," \u03c3"):"".concat(E.absoluteValue.toPrecision(4))}}(r=e.IsoValue||(e.IsoValue={})),e.adjustedIsoValue=function n(g,y,S){if("relative"===S)return r.relative(y);var C=r.absolute(y);if(AA.is(g.sourceData)){var _={min:g.sourceData.data.volume_data_3d_info.min_source.value(0),max:g.sourceData.data.volume_data_3d_info.max_source.value(0),mean:g.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:g.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(C,_)}return C};var a={min:-1,max:1,mean:0,sigma:.1};function i(g,y){var S=y||a,C=S.min,_=S.max,x=S.mean,D=S.sigma,w=(C-x)/D,A=(_-x)/D,E=g;return"absolute"===g.kind?g.absoluteValue<C?E=e.IsoValue.absolute(C):g.absoluteValue>_&&(E=e.IsoValue.absolute(_)):g.relativeValue<w?E=e.IsoValue.relative(w):g.relativeValue>A&&(E=e.IsoValue.relative(A)),T.Conditioned(E,{absolute:T.Converted(function(I){return e.IsoValue.toAbsolute(I,Ri.One.stats).absoluteValue},function(I){return e.IsoValue.absolute(I)},T.Numeric(x,{min:C,max:_,step:iY(D/100,2)},{immediateUpdate:!0})),relative:T.Converted(function(I){return e.IsoValue.toRelative(I,Ri.One.stats).relativeValue},function(I){return e.IsoValue.relative(I)},T.Numeric(Math.min(1,A),{min:w,max:A,step:iY(Math.round((_-C)/D)/100,2)},{immediateUpdate:!0}))},function(I){return"absolute"===I.kind?"absolute":"relative"},function(I,M){return"absolute"===M?e.IsoValue.toAbsolute(I,S):e.IsoValue.toRelative(I,S)},{isEssential:!0})}e.createIsoValueParam=i,e.IsoValueParam=i(e.IsoValue.relative(2)),e.One={label:"",grid:Ri.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Sl,_propertyData:Object.create(null)},e.areEquivalent=function o(g,y){return Ri.areEquivalent(g.grid,y.grid)},e.isEmpty=function s(g){return Ri.isEmpty(g.grid)},e.isOrbitals=function u(g){return!!wA.is(g.sourceData)&&g.sourceData.data.header.orbitals},e.Loci=function c(g){return{kind:"volume-loci",volume:g}},e.isLoci=function l(g){return!!g&&"volume-loci"===g.kind},e.areLociEqual=function d(g,y){return g.volume===y.volume},e.isLociEmpty=function f(g){return Ri.isEmpty(g.volume.grid)},e.getBoundingSphere=function p(g,y){return Ri.getBoundingSphere(g.grid,y)},function(g){g.Loci=function y(w,A){return{kind:"isosurface-loci",volume:w,isoValue:A}},g.isLoci=function S(w){return!!w&&"isosurface-loci"===w.kind},g.areLociEqual=function C(w,A){return w.volume===A.volume&&e.IsoValue.areSame(w.isoValue,A.isoValue,w.volume.grid.stats)},g.isLociEmpty=function _(w){return 0===w.volume.grid.cells.data.length};var x=Nt();g.getBoundingSphere=function D(w,A,E){for(var I=e.IsoValue.toAbsolute(A,w.grid.stats).absoluteValue,M=I<0,F=[0,0,0],N=w.grid.cells.space.getCoords,j=w.grid.cells.data,U=w.grid.cells.space.dimensions,J=U[0]-1,X=U[1]-1,Z=U[2]-1,ne=0,Y=0,k=0,W=0,$=j.length;W<$;++W)(M&&j[W]<=I||!M&&j[W]>=I)&&(N(W,F),F[0]<J&&(J=F[0]),F[1]<X&&(X=F[1]),F[2]<Z&&(Z=F[2]),F[0]>ne&&(ne=F[0]),F[1]>Y&&(Y=F[1]),F[2]>k&&(k=F[2]));b.set(x.min,J-1,X-1,Z-1),b.set(x.max,ne+1,Y+1,k+1);var K=Ri.getGridToCartesianTransform(w.grid);return Nt.transform(x,x,K),Pe.fromBox3D(E||Pe(),x)}}(e.Isosurface||(e.Isosurface={})),function(g){g.Loci=function y(A,E){return{kind:"cell-loci",volume:A,indices:E}},g.isLoci=function S(A){return!!A&&"cell-loci"===A.kind},g.areLociEqual=function C(A,E){return A.volume===E.volume&&ke.areEqual(A.indices,E.indices)},g.isLociEmpty=function _(A){return 0===ke.size(A.indices)};var x=new Lu("98"),D=b();g.getBoundingSphere=function w(A,E,I){x.reset();for(var M=Ri.getGridToCartesianTransform(A.grid),F=A.grid.cells.space.getCoords,N=0,j=ke.size(E);N<j;N++)F(ke.getAt(E,N),D),b.transformMat4(D,D,M),x.includePosition(D);for(x.finishedIncludeStep(),N=0,j=ke.size(E);N<j;N++)F(ke.getAt(E,N),D),b.transformMat4(D,D,M),x.radiusPosition(D);var H=x.getSphere(I);return Pe.expand(H,H,10*he.getMaxScaleOnAxis(M))}}(e.Cell||(e.Cell={})),function(g){g.Loci=function y(E,I){return{kind:"segment-loci",volume:E,segments:Ye.ofUnsortedArray(I)}},g.isLoci=function S(E){return!!E&&"segment-loci"===E.kind},g.areLociEqual=function C(E,I){return E.volume===I.volume&&Ye.areEqual(E.segments,I.segments)},g.isLociEmpty=function _(E){return 0===E.volume.grid.cells.data.length||0===E.segments.length};var x=Nt();g.getBoundingSphere=function D(E,I,M){var F=e.Segmentation.get(E);if(F){Nt.setEmpty(x);for(var N=0,j=I.length;N<j;++N){var U=F.bounds[I[N]];Nt.add(x,U.min),Nt.add(x,U.max)}var H=Ri.getGridToCartesianTransform(E.grid);return Nt.transform(x,x,H),Pe.fromBox3D(M||Pe(),x)}return e.getBoundingSphere(E,M)},g.Location=function w(E,I){return{kind:"segment-location",volume:E,segment:I}},g.isLocation=function A(E){return!!E&&"segment-location"===E.kind}}(e.Segment||(e.Segment={})),e.PickingGranularity={set:function(g,y){g._propertyData.__picking_granularity__=y},get:function(g){var y;return null!==(y=g._propertyData.__picking_granularity__)&&void 0!==y?y:"voxel"}},e.Segmentation={set:function(g,y){g._propertyData.__segmentation__=y},get:function(g){return g._propertyData.__segmentation__}}}(nt||(nt={}));var ju,Cd,is,h4=f4();function Tn(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Ae(e,t){return{type:"uniform",kind:e,variant:t}}function Xt(e,t,r,n,a){return{type:"texture",kind:e,format:t,dataType:r,filter:n,variant:a}}function X0(e){return{type:"elements",kind:e}}function Lt(e,t){return{type:"define",kind:e,options:t}}function oa(e){return{type:"value",kind:e}}!function(e){function t(v,g,y,S,C,_,x,D,w,A){return A?function a(v,g,y,S,C,_,x,D,w,A){var E=_.getWidth(),I=_.getHeight(),M=_.getDepth();return O.update(A.gridDimension,g),O.update(A.gridTexture,_),O.update(A.gridTextureDim,b.set(A.gridTextureDim.ref.value,E,I,M)),O.update(A.gridStats,dr.set(A.gridStats.ref.value,x.min,x.max,x.mean,x.sigma)),O.update(A.bboxMin,v.min),O.update(A.bboxMax,v.max),O.update(A.bboxSize,b.sub(A.bboxSize.ref.value,v.max,v.min)),O.update(A.transform,y),O.update(A.cellDim,C),O.update(A.unitToCartn,S),O.update(A.cartnToUnit,he.invert(he(),S)),O.updateIfChanged(A.packedGroup,D),O.updateIfChanged(A.axisOrder,b.fromArray(A.axisOrder.ref.value,w,0)),A}(v,g,y,S,C,_,x,D,w,A):function n(v,g,y,S,C,_,x,D,w){var A=Pe(),E=-1,I=_.getWidth(),M=_.getHeight(),F=_.getDepth(),N={kind:"direct-volume",gridDimension:O.create(g),gridTexture:O.create(_),gridTextureDim:O.create(b.create(I,M,F)),gridStats:O.create(dr.create(x.min,x.max,x.mean,x.sigma)),bboxMin:O.create(v.min),bboxMax:O.create(v.max),bboxSize:O.create(b.sub(b(),v.max,v.min)),transform:O.create(y),cellDim:O.create(C),unitToCartn:O.create(S),cartnToUnit:O.create(he.invert(he(),S)),get boundingSphere(){var j=r(N);if(j!==E){var U=function XFe(e,t){return Pe.fromDimensionsAndTransform(Pe(),e,t)}(N.gridDimension.ref.value,N.transform.ref.value);Pe.copy(A,U),E=j}return A},packedGroup:O.create(D),axisOrder:O.create(w),setBoundingSphere:function(j){Pe.copy(A,j),E=r(N)}};return N}(v,g,y,S,C,_,x,D,w)}function r(v){return rs([v.bboxSize.ref.version,v.gridDimension.ref.version,v.gridTexture.ref.version,v.transform.ref.version,v.gridStats.ref.version])}function i(v){return t(Nt(),b(),he.identity(),he.identity(),b(),Ao(),Ri.One.stats,!1,b.create(0,1,2),v)}function s(v,g){return Math.ceil(b.magnitude(v)*g)}function u(v,g){return Math.min.apply(Math,v)*(1/g)}function c(v){return 1/v}function l(v,g,y,S,C){var _=v.gridTexture,x=v.gridTextureDim,D=v.gridStats,w=v.bboxSize,A=v.bboxMin,E=v.bboxMax,I=v.gridDimension,M=v.transform,F=y.instanceCount,N=y.groupCount,U=Vu(y,e.Utils.createPositionIterator(v,g),S.color),H=C.instanceGranularity?Ia(F,"instance"):Ia(F*N,"groupInstance"),z=Pf(),G=Mf(),J=Of(),X=Rf(),Z=I.ref.value,W={drawCount:h4.indices.length,vertexCount:Z[0]*Z[1]*Z[2],groupCount:N,instanceCount:F},$=Pe.clone(v.boundingSphere),K=Qi($,g.aTransform.ref.value,F,0),V=RK(MK(C.controlPoints));return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("directVolume")},U),H),z),G),J),X),g),st.createValues(C,W)),{aPosition:O.create(h4.vertices),elements:O.create(h4.indices),boundingSphere:O.create(K),invariantBoundingSphere:O.create($),uInvariantBoundingSphere:O.create(dr.ofSphere($)),uBboxMin:A,uBboxMax:E,uBboxSize:w,uMaxSteps:O.create(s(I.ref.value,C.stepsPerCell)),uStepScale:O.create(u(v.cellDim.ref.value,C.stepsPerCell)),uJumpLength:O.create(C.jumpLength),uTransform:M,uGridDim:I,tTransferTex:V,uTransferScale:O.create(c(C.stepsPerCell)),dGridTexType:O.create(_.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:x,tGridTex:_,uGridStats:D,uCellDim:v.cellDim,uCartnToUnit:v.cartnToUnit,uUnitToCartn:v.unitToCartn,dPackedGroup:v.packedGroup,dAxisOrder:O.create(v.axisOrder.ref.value.join("")),dIgnoreLight:O.create(C.ignoreLight),dXrayShaded:O.create("inverted"===C.xrayShaded?"inverted":!0===C.xrayShaded?"on":"off")})}e.create=t,e.createEmpty=i,e.Params=R(R({},st.Params),{ignoreLight:T.Boolean(!1,st.ShadingCategory),xrayShaded:T.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],st.ShadingCategory),controlPoints:T.LineGraph([Be.create(.19,0),Be.create(.2,.05),Be.create(.25,.05),Be.create(.26,0),Be.create(.79,0),Be.create(.8,.05),Be.create(.85,.05),Be.create(.86,0)],{isEssential:!0}),stepsPerCell:T.Numeric(3,{min:1,max:10,step:1}),jumpLength:T.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:l,createValuesSimple:function d(v,g,y,S,C){var _=st.createSimple(y,S,C),x=R(R({},T.getDefaultValues(e.Params)),g);return l(v,_.transform,_.locationIterator,_.theme,x)},updateValues:function f(v,g){st.updateValues(v,g),O.updateIfChanged(v.dIgnoreLight,g.ignoreLight),O.updateIfChanged(v.dXrayShaded,"inverted"===g.xrayShaded?"inverted":!0===g.xrayShaded?"on":"off"),RK(MK(g.controlPoints),v.tTransferTex),O.updateIfChanged(v.uMaxSteps,s(v.uGridDim.ref.value,g.stepsPerCell)),O.updateIfChanged(v.uStepScale,u(v.uCellDim.ref.value,g.stepsPerCell)),O.updateIfChanged(v.uTransferScale,c(g.stepsPerCell)),O.updateIfChanged(v.uJumpLength,g.jumpLength)},updateBoundingSphere:function p(v,g){var y=Pe.clone(g.boundingSphere),S=Qi(y,v.aTransform.ref.value,v.instanceCount.ref.value,0);Pe.equals(S,v.boundingSphere.ref.value)||O.update(v.boundingSphere,S),Pe.equals(y,v.invariantBoundingSphere.ref.value)||(O.update(v.invariantBoundingSphere,y),O.update(v.uInvariantBoundingSphere,dr.fromSphere(v.uInvariantBoundingSphere.ref.value,y)))},createRenderableState:function m(v){var g=st.createRenderableState(v);return g.opaque=!1,g.writeDepth=!1,g},updateRenderableState:function h(v,g){st.updateRenderableState(v,g),v.opaque=!1,v.writeDepth=!1},createPositionIterator:function o(v,g){var y=v.transform.ref.value,S=v.gridDimension.ref.value,_=S[1],x=S[2],D=S[0]*_*x,w=g.instanceCount.ref.value,A=lm(),E=A.position,I=g.aTransform.ref.value;return On(D,w,1,function(F,N){var j=Math.floor(F/x);return E[0]=Math.floor(j/_),E[1]=j%_,E[2]=F%x,b.transformMat4(E,E,y),N>=0&&b.transformMat4Offset(E,E,I,0,0,16*N),A})}}}(ju||(ju={})),function(e){function t(m,h,v,g){return g?function i(m,h,v,g){return g.sphereCount=v,O.update(g.centerBuffer,m),O.update(g.groupBuffer,h),g.shaderData.update(),g}(m,h,v,g):function a(m,h,v){var y,g=Pe(),S=-1,C=-1,_=O.create(gi(1,4,Float32Array)),x=O.create(Be.create(0,0)),D={kind:"spheres",sphereCount:v,centerBuffer:O.create(m),groupBuffer:O.create(h),get boundingSphere(){var w=n(D);if(w!==S){var A=Ef(D.centerBuffer.ref.value,4*D.sphereCount,4);Pe.copy(g,A),S=w}return g},get groupMapping(){return D.groupBuffer.ref.version!==C&&(y=G0(D.groupBuffer.ref.value,D.sphereCount,4),C=D.groupBuffer.ref.version),y},setBoundingSphere:function(w){Pe.copy(g,w),S=n(D)},shaderData:{positionGroup:_,texDim:x,update:function(){var w=gi(D.sphereCount,4,Float32Array,_.ref.value.array);(function o(m,h,v,g){for(var y=m.array,S=0;S<g;++S)y[4*S+0]=h[3*S+0],y[4*S+1]=h[3*S+1],y[4*S+2]=h[3*S+2],y[4*S+3]=v[S]})(w,D.centerBuffer.ref.value,D.groupBuffer.ref.value,D.sphereCount),O.update(_,w),O.update(x,Be.set(x.ref.value,w.width,w.height))}}};return D}(m,h,v)}function r(m){return t(m?m.centerBuffer.ref.value:new Float32Array(0),m?m.groupBuffer.ref.value:new Float32Array(0),0,m)}function n(m){return rs([m.sphereCount,m.centerBuffer.ref.version,m.groupBuffer.ref.version])}function s(m,h){var v=m.sphereCount,g=h.instanceCount.ref.value,y=lm(),S=y.position,C=m.centerBuffer.ref.value,_=h.aTransform.ref.value;return On(v,g,1,function(D,w){return w<0?b.fromArray(S,C,3*D):b.transformMat4Offset(S,C,_,0,3*D,16*w),y})}function u(m,h,v,g,y){var S=v.instanceCount,C=v.groupCount,x=Vu(v,s(m,h),g.color),D=Bf(v,g.size),w=y.instanceGranularity?Ia(S,"instance"):Ia(S*C,"groupInstance"),A=Pf(),E=Mf(),I=Of(),M=Rf(),F={drawCount:2*m.sphereCount*3,vertexCount:6*m.sphereCount,groupCount:C,instanceCount:S},N=m.boundingSphere.radius?zS(D)*y.sizeFactor:0,j=Pe.expand(Pe(),m.boundingSphere,N),U=Qi(j,h.aTransform.ref.value,S,0);return m.shaderData.update(),R(R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("spheres"),uTexDim:m.shaderData.texDim,tPositionGroup:m.shaderData.positionGroup,boundingSphere:O.create(U),invariantBoundingSphere:O.create(j),uInvariantBoundingSphere:O.create(dr.ofSphere(j))},x),D),w),A),E),I),M),h),{padding:O.create(N)}),st.createValues(y,F)),{uSizeFactor:O.create(y.sizeFactor),uDoubleSided:O.create(y.doubleSided),dIgnoreLight:O.create(y.ignoreLight),dXrayShaded:O.create("inverted"===y.xrayShaded?"inverted":!0===y.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(y.transparentBackfaces),dSolidInterior:O.create(y.solidInterior),dClipPrimitive:O.create(y.clipPrimitive),dApproximate:O.create(y.approximate),uAlphaThickness:O.create(y.alphaThickness),uBumpFrequency:O.create(y.bumpFrequency),uBumpAmplitude:O.create(y.bumpAmplitude),centerBuffer:m.centerBuffer,groupBuffer:m.groupBuffer})}function p(m,h){st.updateRenderableState(m,h),m.opaque=m.opaque&&!h.xrayShaded,m.writeDepth=m.opaque}e.create=t,e.createEmpty=r,e.Params=R(R({},st.Params),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),doubleSided:T.Boolean(!1,st.CustomQualityParamInfo),ignoreLight:T.Boolean(!1,st.ShadingCategory),xrayShaded:T.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],st.ShadingCategory),transparentBackfaces:T.Select("off",T.arrayToOptions(["off","on","opaque"]),st.ShadingCategory),solidInterior:T.Boolean(!0,st.ShadingCategory),clipPrimitive:T.Boolean(!1,R(R({},st.ShadingCategory),{description:"Clip whole sphere instead of cutting it."})),approximate:T.Boolean(!1,R(R({},st.ShadingCategory),{description:"Faster rendering, but has artifacts."})),alphaThickness:T.Numeric(0,{min:0,max:20,step:1},R(R({},st.ShadingCategory),{description:"If not zero, adjusts alpha for radius."})),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory),bumpAmplitude:T.Numeric(1,{min:0,max:5,step:.1},st.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:function c(m,h,v,g,y){var S=st.createSimple(v,g,y),C=R(R({},T.getDefaultValues(e.Params)),h);return u(m,S.transform,S.locationIterator,S.theme,C)},updateValues:function l(m,h){st.updateValues(m,h),O.updateIfChanged(m.uSizeFactor,h.sizeFactor),O.updateIfChanged(m.uDoubleSided,h.doubleSided),O.updateIfChanged(m.dIgnoreLight,h.ignoreLight),O.updateIfChanged(m.dXrayShaded,"inverted"===h.xrayShaded?"inverted":!0===h.xrayShaded?"on":"off"),O.updateIfChanged(m.dTransparentBackfaces,h.transparentBackfaces),O.updateIfChanged(m.dSolidInterior,h.solidInterior),O.updateIfChanged(m.dClipPrimitive,h.clipPrimitive),O.updateIfChanged(m.dApproximate,h.approximate),O.updateIfChanged(m.uAlphaThickness,h.alphaThickness),O.updateIfChanged(m.uBumpFrequency,h.bumpFrequency),O.updateIfChanged(m.uBumpAmplitude,h.bumpAmplitude)},updateBoundingSphere:function d(m,h){var v=h.boundingSphere.radius?zS(m)*m.uSizeFactor.ref.value:0,g=Pe.expand(Pe(),h.boundingSphere,v),y=Qi(g,m.aTransform.ref.value,m.instanceCount.ref.value,0);Pe.equals(y,m.boundingSphere.ref.value)||O.update(m.boundingSphere,y),Pe.equals(g,m.invariantBoundingSphere.ref.value)||(O.update(m.invariantBoundingSphere,g),O.update(m.uInvariantBoundingSphere,dr.fromSphere(m.uInvariantBoundingSphere.ref.value,g))),O.update(m.padding,v)},createRenderableState:function f(m){var h=st.createRenderableState(m);return p(h,m),h},updateRenderableState:p,createPositionIterator:s}}(Cd||(Cd={})),function(e){var t=function(){function f(){this.index=0,this.textures=[]}return f.prototype.get=function(){return this.textures[this.index]},f.prototype.set=function(p,m,h){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:p,group:m,normal:h}),this.index=(this.index+1)%2},f.prototype.destroy=function(){for(var p=0,m=this.textures;p<m.length;p++){var h=m[p];h.vertex.destroy(),h.group.destroy(),h.normal.destroy()}},f}();function r(f,p,m,h,v,g,y){var S=m.getWidth(),C=m.getHeight();return y?(y.vertexCount=f,y.groupCount=p,O.update(y.geoTextureDim,Be.set(y.geoTextureDim.ref.value,S,C)),O.update(y.vertexTexture,m),O.update(y.groupTexture,h),O.update(y.normalTexture,v),y.doubleBuffer.set(m,h,v),Pe.copy(y.boundingSphere,g),y):{kind:"texture-mesh",vertexCount:f,groupCount:p,geoTextureDim:O.create(Be.create(S,C)),vertexTexture:O.create(m),groupTexture:O.create(h),normalTexture:O.create(v),varyingGroup:O.create(!1),doubleBuffer:new t,boundingSphere:Pe.clone(g),meta:{}}}function n(f){return r(0,0,f?f.vertexTexture.ref.value:Ao(),f?f.groupTexture.ref.value:Ao(),f?f.normalTexture.ref.value:Ao(),f?f.boundingSphere:Pe(),f)}e.DoubleBuffer=t,e.create=r,e.createEmpty=n,e.Params=R(R({},st.Params),{doubleSided:T.Boolean(!1,st.CustomQualityParamInfo),flipSided:T.Boolean(!1,st.ShadingCategory),flatShaded:T.Boolean(!1,st.ShadingCategory),ignoreLight:T.Boolean(!1,st.ShadingCategory),xrayShaded:T.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],st.ShadingCategory),transparentBackfaces:T.Select("off",T.arrayToOptions(["off","on","opaque"]),st.ShadingCategory),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory),bumpAmplitude:T.Numeric(1,{min:0,max:5,step:.1},st.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:o,createValuesSimple:function s(f,p,m,h,v){var g=st.createSimple(m,h,v),y=R(R({},T.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)},updateValues:function u(f,p){st.updateValues(f,p),O.updateIfChanged(f.uDoubleSided,p.doubleSided),O.updateIfChanged(f.dFlatShaded,p.flatShaded),O.updateIfChanged(f.dFlipSided,p.flipSided),O.updateIfChanged(f.dIgnoreLight,p.ignoreLight),O.updateIfChanged(f.dXrayShaded,"inverted"===p.xrayShaded?"inverted":!0===p.xrayShaded?"on":"off"),O.updateIfChanged(f.dTransparentBackfaces,p.transparentBackfaces),O.updateIfChanged(f.uBumpFrequency,p.bumpFrequency),O.updateIfChanged(f.uBumpAmplitude,p.bumpAmplitude)},updateBoundingSphere:function c(f,p){var m=Pe.clone(p.boundingSphere),h=Qi(m,f.aTransform.ref.value,f.instanceCount.ref.value,0);Pe.equals(h,f.boundingSphere.ref.value)||O.update(f.boundingSphere,h),Pe.equals(m,f.invariantBoundingSphere.ref.value)||(O.update(f.invariantBoundingSphere,m),O.update(f.uInvariantBoundingSphere,dr.fromSphere(f.uInvariantBoundingSphere.ref.value,m)))},createRenderableState:function l(f){var p=st.createRenderableState(f);return d(p,f),p},updateRenderableState:d,createPositionIterator:function i(f,p){var m=f.meta.webgl;if(!m)return On(1,1,1,function(){return Uu});m.namedFramebuffers[a]||(m.namedFramebuffers[a]=m.resources.framebuffer());var h=m.namedFramebuffers[a],v=f.geoTextureDim.ref.value,g=v[0],y=v[1],S=new Float32Array(g*y*4);h.bind(),f.vertexTexture.ref.value.attachFramebuffer(h,0),m.readPixels(0,0,g,y,S);var C=f.vertexCount,_=p.instanceCount.ref.value,x=lm(),D=x.position,w=S,A=p.aTransform.ref.value;return On(C,_,1,function(I,M){return M<0?b.fromArray(D,w,4*I):b.transformMat4Offset(D,w,A,0,4*I,16*M),x})}};var a="texture-mesh";function o(f,p,m,h,v){var g=m.instanceCount,y=m.groupCount,C=Vu(m,e.Utils.createPositionIterator(f,p),h.color),_=v.instanceGranularity?Ia(g,"instance"):Ia(g*y,"groupInstance"),x=Pf(),D=Mf(),w=Of(),A=Rf(),E={drawCount:f.vertexCount,vertexCount:f.vertexCount,groupCount:y,instanceCount:g},I=Pe.clone(f.boundingSphere),M=Qi(I,p.aTransform.ref.value,g,0);return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("textureMesh"),uGeoTexDim:f.geoTextureDim,tPosition:f.vertexTexture,tGroup:f.groupTexture,tNormal:f.normalTexture,dVaryingGroup:f.varyingGroup,boundingSphere:O.create(M),invariantBoundingSphere:O.create(I),uInvariantBoundingSphere:O.create(dr.ofSphere(I))},C),_),x),D),w),A),p),st.createValues(v,E)),{uDoubleSided:O.create(v.doubleSided),dFlatShaded:O.create(v.flatShaded),dFlipSided:O.create(v.flipSided),dIgnoreLight:O.create(v.ignoreLight),dXrayShaded:O.create("inverted"===v.xrayShaded?"inverted":!0===v.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(v.transparentBackfaces),uBumpFrequency:O.create(v.bumpFrequency),uBumpAmplitude:O.create(v.bumpAmplitude),meta:O.create(f.meta)})}function d(f,p){st.updateRenderableState(f,p),f.opaque=f.opaque&&!p.xrayShaded,f.writeDepth=f.opaque}}(is||(is={}));var Uf={uModel:Ae("m4"),uView:Ae("m4"),uInvView:Ae("m4"),uModelView:Ae("m4"),uInvModelView:Ae("m4"),uProjection:Ae("m4"),uInvProjection:Ae("m4"),uModelViewProjection:Ae("m4"),uInvModelViewProjection:Ae("m4"),uIsOrtho:Ae("f"),uPixelRatio:Ae("f"),uViewport:Ae("v4"),uViewOffset:Ae("v2"),uDrawingBufferSize:Ae("v2"),uCameraPosition:Ae("v3"),uCameraDir:Ae("v3"),uNear:Ae("f"),uFar:Ae("f"),uFog:Ae("b"),uFogNear:Ae("f"),uFogFar:Ae("f"),uFogColor:Ae("v3"),uTransparentBackground:Ae("b"),uLightDirection:Ae("v3[]"),uLightColor:Ae("v3[]"),uAmbientColor:Ae("v3"),uPickingAlphaThreshold:Ae("f"),uInteriorDarkening:Ae("f"),uInteriorColorFlag:Ae("b"),uInteriorColor:Ae("v3"),uHighlightColor:Ae("v3"),uSelectColor:Ae("v3"),uDimColor:Ae("v3"),uHighlightStrength:Ae("f"),uSelectStrength:Ae("f"),uDimStrength:Ae("f"),uMarkerPriority:Ae("i"),uMarkerAverage:Ae("f"),uXrayEdgeFalloff:Ae("f"),uExposure:Ae("f"),uRenderMask:Ae("i"),uMarkingDepthTest:Ae("b"),uMarkingType:Ae("i"),uPickType:Ae("i")},Vf={tDepth:Xt("texture","depth","ushort","nearest"),tDpoitDepth:Xt("texture","rg","float","nearest"),tDpoitFrontColor:Xt("texture","rgba","float","nearest"),tDpoitBackColor:Xt("texture","rgba","float","nearest")},Gf={uObjectId:Ae("i")},QFe={uColor:Ae("v3","material"),uColorTexDim:Ae("v2"),uColorGridDim:Ae("v3"),uColorGridTransform:Ae("v4"),tColor:Xt("image-uint8","rgb","ubyte","nearest"),tPalette:Xt("image-uint8","rgb","ubyte","nearest"),tColorGrid:Xt("texture","rgb","ubyte","linear"),dColorType:Lt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:Lt("boolean")},jS={uSize:Ae("f","material"),uSizeTexDim:Ae("v2"),tSize:Xt("image-uint8","rgb","ubyte","nearest"),dSizeType:Lt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ae("f","material")},$Fe={uMarker:Ae("f"),uMarkerTexDim:Ae("v2"),tMarker:Xt("image-uint8","alpha","ubyte","nearest"),markerAverage:oa("number"),markerStatus:oa("number"),dMarkerType:Lt("string",["instance","groupInstance"])},JFe={uOverpaintTexDim:Ae("v2"),tOverpaint:Xt("image-uint8","rgba","ubyte","nearest"),dOverpaint:Lt("boolean"),uOverpaintGridDim:Ae("v3"),uOverpaintGridTransform:Ae("v4"),tOverpaintGrid:Xt("texture","rgba","ubyte","linear"),dOverpaintType:Lt("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:Ae("f","material")},e4e={uTransparencyTexDim:Ae("v2"),tTransparency:Xt("image-uint8","alpha","ubyte","nearest"),dTransparency:Lt("boolean"),transparencyAverage:oa("number"),uTransparencyGridDim:Ae("v3"),uTransparencyGridTransform:Ae("v4"),tTransparencyGrid:Xt("texture","alpha","ubyte","linear"),dTransparencyType:Lt("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:Ae("f","material")},t4e={uSubstanceTexDim:Ae("v2"),tSubstance:Xt("image-uint8","rgba","ubyte","nearest"),dSubstance:Lt("boolean"),uSubstanceGridDim:Ae("v3"),uSubstanceGridTransform:Ae("v4"),tSubstanceGrid:Xt("texture","rgba","ubyte","linear"),dSubstanceType:Lt("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:Ae("f","material")},r4e={uClippingTexDim:Ae("v2"),tClipping:Xt("image-uint8","alpha","ubyte","nearest"),dClipping:Lt("boolean"),dClippingType:Lt("string",["instance","groupInstance"])},zf=R(R(R(R(R(R(R({dGeometryType:Lt("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"])},QFe),$Fe),JFe),e4e),t4e),r4e),{dLightCount:Lt("number"),dColorMarker:Lt("boolean"),dClipObjectCount:Lt("number"),dClipVariant:Lt("string",["instance","pixel"]),uClipObjectType:Ae("i[]","material"),uClipObjectInvert:Ae("b[]","material"),uClipObjectPosition:Ae("v3[]","material"),uClipObjectRotation:Ae("v4[]","material"),uClipObjectScale:Ae("v3[]","material"),aInstance:Tn("float32",1,1),aTransform:Tn("float32",16,1),uAlpha:Ae("f","material"),uMetalness:Ae("f","material"),uRoughness:Ae("f","material"),uBumpiness:Ae("f","material"),uVertexCount:Ae("i"),uInstanceCount:Ae("i"),uGroupCount:Ae("i"),uInvariantBoundingSphere:Ae("v4"),drawCount:oa("number"),instanceCount:oa("number"),alpha:oa("number"),matrix:oa("m4"),transform:oa("float32"),extraTransform:oa("float32"),hasReflection:oa("boolean"),instanceGranularity:oa("boolean"),boundingSphere:oa("sphere"),invariantBoundingSphere:oa("sphere")}),bo="\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nvoid main(void) {\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n",a4e=Jo(),TA=Object.keys({colorBlended:"",colorWboit:"",colorDpoit:"",pick:"",depth:"",marking:""}),DA=TA.filter(function(e){return!["colorWboit","colorDpoit"].includes(e)}),s4e=TA.filter(function(e){return!["colorBlended","colorDpoit"].includes(e)}),u4e=TA.filter(function(e){return!["colorWboit","colorBlended"].includes(e)}),l4e=Object.keys({compute:""});function BK(e,t,r,n,a){return r=R(R({},r),{dRenderVariant:O.create(t)}),void 0===a.dRenderVariant&&Object.defineProperty(a,"dRenderVariant",{value:Lt("string")}),e.resources.program(r,n,a)}function Hf(e,t,r,n,a,i,o){return NK(e,t,r,n,a,i,o)}function Ua(e,t,r,n,a,i){return void 0===i&&(i=-1),NK(e,t,r,n,a,i,l4e)}function NK(e,t,r,n,a,i,o){var s=a4e(),u=e.stats,c=e.state,l=e.resources,d=e.extensions,f=d.instancedArrays,p=d.vertexArrayObject;a.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs&&(a.aVertex=O.create(Bu(new Float32Array(a.uVertexCount.ref.value))),n.aVertex=Tn("float32",1,0));for(var h=function KFe(e,t){var r={},n={},a={},i={},o={},s={},u={};return Object.keys(e).forEach(function(c){var l=e[c];"attribute"===l.type&&(r[c]=t[c]),"define"===l.type&&(n[c]=t[c]),"texture"===l.type&&void 0!==t[c]&&("material"===l.variant?i[c]=t[c]:a[c]=t[c]),"uniform"===l.type&&void 0!==t[c]&&("material"===l.variant?s[c]=t[c]:"buffered"===l.variant?u[c]=t[c]:o[c]=t[c])}),{attributeValues:r,defineValues:n,textureValues:a,materialTextureValues:i,uniformValues:o,materialUniformValues:s,bufferedUniformValues:u}}(n,a),v=h.attributeValues,g=h.defineValues,y=h.textureValues,S=h.materialTextureValues,_=h.materialUniformValues,x=h.bufferedUniformValues,D=Object.entries(h.uniformValues),w=Object.entries(_),A=Object.entries(x),E=Object.entries(function cRe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=O.create(fl(e[r].ref.value))}),t}(x)),I=Object.entries(g),M=function ZFe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}(a),F=function i4e(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}(e,t),N={},j=0,U=o;j<U.length;j++)N[H=U[j]]=BK(e,H,g,r,n);var X,z=VX(e,n,y),G=VX(e,n,S),J=function vRe(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];"attribute"===i.type&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}(e,n,v),Z=a.elements;Z&&Z.ref.value&&(X=l.elements(Z.ref.value));for(var ne={},Y=0,k=o;Y<k.length;Y++){var H;ne[H=k[Y]]=p?l.vertexArray(N[H],J,X):null}var W=a.drawCount.ref.value,$=a.instanceCount.ref.value;u.drawCount+=W,u.instanceCount+=$,u.instancedDrawCount+=$*W;var K={attributes:!1,defines:!1,elements:!1,textures:!1},q=!1,V=-1;return{id:s,materialId:i,getProgram:function(ee){return N[ee]},render:function(ee,ae){if(0!==W&&0!==$){var pe=N[ee];if(pe.id===V&&c.currentRenderItemId===s)pe.setUniforms(D),pe.bindTextures(z,ae);else{var me=ne[ee];(pe.id!==c.currentProgramId||pe.id!==V||-1===i||i!==c.currentMaterialId)&&(pe.id!==c.currentProgramId&&pe.use(),pe.setUniforms(w),pe.bindTextures(G,ae+z.length),c.currentMaterialId=i,V=pe.id),pe.setUniforms(D),pe.setUniforms(E),pe.bindTextures(z,ae),me?(me.bind(),X&&X.bind()):(X&&X.bind(),pe.bindAttributes(J)),c.currentRenderItemId=s}if(Cr)try{lA(e.gl)}catch(de){throw new Error("Framebuffer error rendering item id ".concat(s,": '").concat(de,"'"))}if(X?f.drawElementsInstanced(F,W,X._dataType,0,$):f.drawArraysInstanced(F,0,W,$),xt&&(u.calls.drawInstanced+=1,u.calls.counts+=$),Cr)try{DX(e.gl)}catch(de){throw new Error("Draw error rendering item id ".concat(s,": '").concat(de,"'"))}}},update:function(){if(function f4e(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}(K),a.aVertex){var ee=a.uVertexCount.ref.value;a.aVertex.ref.value.length<ee&&O.update(a.aVertex,Bu(new Float32Array(ee)))}for(var ae=0,pe=I.length;ae<pe;++ae){var me=I[ae];(re=me[1]).ref.version!==M[de=me[0]]&&(K.defines=!0,M[de]=re.ref.version)}if(K.defines)for(var te=0,le=o;te<le.length;te++)N[de=le[te]].destroy(),N[de]=BK(e,de,g,r,n);for(a.drawCount.ref.version!==M.drawCount&&(u.drawCount+=a.drawCount.ref.value-W,u.instancedDrawCount+=$*a.drawCount.ref.value-$*W,W=a.drawCount.ref.value,M.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==M.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-$,u.instancedDrawCount+=a.instanceCount.ref.value*W-$*W,$=a.instanceCount.ref.value,M.instanceCount=a.instanceCount.ref.version),ae=0,pe=J.length;ae<pe;++ae){var ge=J[ae],xe=ge[1];if((re=v[de=ge[0]]).ref.version!==M[de]){if(xe.length>=re.ref.value.length)xe.updateSubData(re.ref.value,0,xe.length);else{xe.destroy();var Ge=n[de];J[ae][1]=l.attribute(re.ref.value,Ge.itemSize,Ge.divisor),K.attributes=!0}M[de]=re.ref.version}}if(X&&a.elements.ref.version!==M.elements&&(X.length>=a.elements.ref.value.length?X.updateSubData(a.elements.ref.value,0,X.length):(X.destroy(),X=l.elements(a.elements.ref.value),K.elements=!0),M.elements=a.elements.ref.version),K.attributes||K.defines||K.elements)for(var Q=0,ye=o;Q<ye.length;Q++){var we=ne[de=ye[Q]];we&&we.destroy(),ne[de]=p?l.vertexArray(N[de],J,X):null}for(ae=0,pe=z.length;ae<pe;++ae){var De=z[ae],Oe=De[1];(re=y[de=De[0]]).ref.version!==M[de]&&("texture"!==n[de].kind?(Oe.load(re.ref.value),K.textures=!0):z[ae][1]=re.ref.value,M[de]=re.ref.version)}for(ae=0,pe=G.length;ae<pe;++ae){var re,Ne=G[ae];Oe=Ne[1],(re=S[de=Ne[0]]).ref.version!==M[de]&&("texture"!==n[de].kind?(Oe.load(re.ref.value),K.textures=!0):G[ae][1]=re.ref.value,M[de]=re.ref.version)}for(ae=0,pe=A.length;ae<pe;++ae){var de,Ue=A[ae],$e=Ue[1];$e.ref.version!==M[de=Ue[0]]&&(O.update(E[ae][1],fl($e.ref.value)),M[de]=$e.ref.version)}},destroy:function(){if(!q){for(var ee=0,ae=o;ee<ae.length;ee++){var pe=ae[ee];N[pe].destroy();var me=ne[pe];me&&me.destroy()}z.forEach(function(de){"texture"!==n[de[0]].kind&&de[1].destroy()}),G.forEach(function(de){"texture"!==n[de[0]].kind&&de[1].destroy()}),J.forEach(function(de){return de[1].destroy()}),X&&X.destroy(),u.drawCount-=W,u.instanceCount-=$,u.instancedDrawCount-=$*W,q=!0}}}}var kK=Jo();function jf(e,t,r){return{id:kK(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&O.updateIfChanged(t.uAlpha,Xi(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function Va(e,t){return{id:kK(),values:t,render:function(){return e.render("compute",0)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var v4=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),yi={drawCount:oa("number"),instanceCount:oa("number"),aPosition:Tn("float32",2,0),uQuadScale:Ae("v2")},bi={drawCount:O.create(6),instanceCount:O.create(1),aPosition:O.create(v4),uQuadScale:O.create(Be.create(1,1))},p4e=R(R({},yi),{tColor:Xt("texture","rgba","ubyte","nearest"),uTexSize:Ae("v2")}),m4e=Fn("copy",bo,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords);\n}\n");function K0(e,t){var r=R(R({},bi),{tColor:O.create(t),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight()))}),n=R({},p4e);return Va(Ua(e,"triangles",m4e,n,r),r)}var qf,qu,Oi,LK=new Uint32Array([0,1,2,1,3,2]),v4e=new Float32Array([0,1,0,0,1,1,1,0]),UK={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},g4e=Object.keys(UK);!function(e){function t(f,p,m,h){return h?function a(f,p,m,h){var v=f.width,g=f.height;return O.update(h.imageTexture,f),O.update(h.imageTextureDim,Be.set(h.imageTextureDim.ref.value,v,g)),O.update(h.cornerBuffer,p),O.update(h.groupTexture,m),h}(f,p,m,h):function n(f,p,m){var h=Pe(),v=-1,g=f.width,y=f.height,S={kind:"image",imageTexture:O.create(f),imageTextureDim:O.create(Be.create(g,y)),cornerBuffer:O.create(p),groupTexture:O.create(m),get boundingSphere(){var C=function r(f){return rs([f.cornerBuffer.ref.version])}(S);if(C!==v){var _=function y4e(e){for(var t=b(),r=[],n=0,a=e.length;n<a;n+=3){var i=b.fromArray(b(),e,n);r.push(i),b.add(t,t,i)}b.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var c=b.distance(t,i=u[s]);c>o&&(o=c)}var l=Pe.create(t,o);return Pe.setExtrema(l,r),l}(S.cornerBuffer.ref.value);Pe.copy(h,_),v=C}return h}};return S}(f,p,m)}function i(f){return t(gi(0,4,Uint8Array),f?f.cornerBuffer.ref.value:new Float32Array(24),gi(0,4,Uint8Array),f)}function o(f,p,m,h,v){var g=m.instanceCount,y=m.groupCount,C=Vu(m,e.Utils.createPositionIterator(f,p),h.color),_=v.instanceGranularity?Ia(g,"instance"):Ia(g*y,"groupInstance"),x=Pf(),D=Mf(),w=Of(),A=Rf(),E={drawCount:LK.length,vertexCount:v4.length/3,groupCount:y,instanceCount:g},I=Pe.clone(f.boundingSphere),M=Qi(I,p.aTransform.ref.value,g,0);return R(R(R(R(R(R(R(R(R({dGeometryType:O.create("image")},C),_),x),D),w),A),p),st.createValues(v,E)),{aPosition:f.cornerBuffer,aUv:O.create(v4e),elements:O.create(LK),aGroup:O.create(Bu(new Float32Array(4))),boundingSphere:O.create(M),invariantBoundingSphere:O.create(I),uInvariantBoundingSphere:O.create(dr.ofSphere(I)),dInterpolation:O.create(v.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}e.create=t,e.createEmpty=i,e.Params=R(R({},st.Params),{interpolation:T.Select("bspline",T.objectToOptions(UK))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:function s(f,p,m,h,v){var g=st.createSimple(m,h,v),y=R(R({},T.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)},updateValues:function u(f,p){st.updateValues(f,p),O.updateIfChanged(f.dInterpolation,p.interpolation)},updateBoundingSphere:function c(f,p){var m=Pe.clone(p.boundingSphere),h=Qi(m,f.aTransform.ref.value,f.instanceCount.ref.value,0);Pe.equals(h,f.boundingSphere.ref.value)||O.update(f.boundingSphere,h),Pe.equals(m,f.invariantBoundingSphere.ref.value)||(O.update(f.invariantBoundingSphere,m),O.update(f.uInvariantBoundingSphere,dr.fromSphere(f.uInvariantBoundingSphere.ref.value,m)))},createRenderableState:function l(f){var p=st.createRenderableState(f);return p.opaque=!1,p},updateRenderableState:function d(f,p){st.updateRenderableState(f,p),f.opaque=!1},createPositionIterator:function(){return On(1,1,1,function(){return Uu})}}}(qf||(qf={})),function(e){function t(m,h,v,g,y,S,C,_,x){return x?function i(m,h,v,g,y,S,C,_,x){return _>x.cylinderCount&&(O.update(x.mappingBuffer,m),O.update(x.indexBuffer,h)),x.cylinderCount=_,O.update(x.groupBuffer,v),O.update(x.startBuffer,g),O.update(x.endBuffer,y),O.update(x.scaleBuffer,S),O.update(x.capBuffer,C),x}(m,h,v,g,y,S,C,_,x):function a(m,h,v,g,y,S,C,_){var D,x=Pe(),w=-1,A=-1,E={kind:"cylinders",cylinderCount:_,mappingBuffer:O.create(m),indexBuffer:O.create(h),groupBuffer:O.create(v),startBuffer:O.create(g),endBuffer:O.create(y),scaleBuffer:O.create(S),capBuffer:O.create(C),get boundingSphere(){var I=n(E);if(I!==w){var M=Ef(E.startBuffer.ref.value,6*E.cylinderCount,6),F=Ef(E.endBuffer.ref.value,6*E.cylinderCount,6);Pe.expandBySphere(x,M,F),w=I}return x},get groupMapping(){return E.groupBuffer.ref.version!==A&&(D=G0(E.groupBuffer.ref.value,E.cylinderCount,6),A=E.groupBuffer.ref.version),D},setBoundingSphere:function(I){Pe.copy(x,I),w=n(E)}};return E}(m,h,v,g,y,S,C,_)}function r(m){return t(m?m.mappingBuffer.ref.value:new Float32Array(0),m?m.indexBuffer.ref.value:new Uint32Array(0),m?m.groupBuffer.ref.value:new Float32Array(0),m?m.startBuffer.ref.value:new Float32Array(0),m?m.endBuffer.ref.value:new Float32Array(0),m?m.scaleBuffer.ref.value:new Float32Array(0),m?m.capBuffer.ref.value:new Float32Array(0),0,m)}function n(m){return rs([m.cylinderCount,m.mappingBuffer.ref.version,m.indexBuffer.ref.version,m.groupBuffer.ref.version,m.startBuffer.ref.version,m.endBuffer.ref.version,m.scaleBuffer.ref.version,m.capBuffer.ref.version])}function s(m,h){var v=6*m.cylinderCount,g=h.instanceCount.ref.value,y=lm(),S=y.position,C=m.startBuffer.ref.value,_=m.endBuffer.ref.value,x=h.aTransform.ref.value;return On(v,g,2,function(w,A){var E=w%6==0?C:_;return A<0?b.fromArray(S,E,3*w):b.transformMat4Offset(S,E,x,0,3*w,16*A),y})}function u(m,h,v,g,y){var S=v.instanceCount,C=v.groupCount,x=Vu(v,s(m,h),g.color),D=Bf(v,g.size),w=y.instanceGranularity?Ia(S,"instance"):Ia(S*C,"groupInstance"),A=Pf(),E=Mf(),I=Of(),M=Rf(),F={drawCount:4*m.cylinderCount*3,vertexCount:6*m.cylinderCount,groupCount:C,instanceCount:S},N=zS(D)*y.sizeFactor,j=Pe.clone(m.boundingSphere),U=Qi(j,h.aTransform.ref.value,S,0);return R(R(R(R(R(R(R(R(R(R(R({dGeometryType:O.create("cylinders"),aMapping:m.mappingBuffer,aGroup:m.groupBuffer,aStart:m.startBuffer,aEnd:m.endBuffer,aScale:m.scaleBuffer,aCap:m.capBuffer,elements:m.indexBuffer,boundingSphere:O.create(U),invariantBoundingSphere:O.create(j),uInvariantBoundingSphere:O.create(dr.ofSphere(j))},x),D),w),A),E),I),M),h),{padding:O.create(N)}),st.createValues(y,F)),{uSizeFactor:O.create(y.sizeFactor*y.sizeAspectRatio),uDoubleSided:O.create(y.doubleSided),dIgnoreLight:O.create(y.ignoreLight),dXrayShaded:O.create("inverted"===y.xrayShaded?"inverted":!0===y.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(y.transparentBackfaces),dSolidInterior:O.create(y.solidInterior),uBumpFrequency:O.create(y.bumpFrequency),uBumpAmplitude:O.create(y.bumpAmplitude)})}function p(m,h){st.updateRenderableState(m,h),m.opaque=m.opaque&&!h.xrayShaded,m.writeDepth=m.opaque}e.create=t,e.createEmpty=r,e.transform=function o(m,h){var v=m.startBuffer.ref.value;Wh(h,v,0,6*m.cylinderCount),O.update(m.startBuffer,v);var g=m.endBuffer.ref.value;Wh(h,g,0,6*m.cylinderCount),O.update(m.endBuffer,g)},e.Params=R(R({},st.Params),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:T.Numeric(1,{min:0,max:3,step:.01}),doubleSided:T.Boolean(!1,st.CustomQualityParamInfo),ignoreLight:T.Boolean(!1,st.ShadingCategory),xrayShaded:T.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],st.ShadingCategory),transparentBackfaces:T.Select("off",T.arrayToOptions(["off","on","opaque"]),st.ShadingCategory),solidInterior:T.Boolean(!0,st.ShadingCategory),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory),bumpAmplitude:T.Numeric(1,{min:0,max:5,step:.1},st.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:function c(m,h,v,g,y){var S=st.createSimple(v,g,y),C=R(R({},T.getDefaultValues(e.Params)),h);return u(m,S.transform,S.locationIterator,S.theme,C)},updateValues:function l(m,h){st.updateValues(m,h),O.updateIfChanged(m.uSizeFactor,h.sizeFactor*h.sizeAspectRatio),O.updateIfChanged(m.uDoubleSided,h.doubleSided),O.updateIfChanged(m.dIgnoreLight,h.ignoreLight),O.updateIfChanged(m.dXrayShaded,"inverted"===h.xrayShaded?"inverted":!0===h.xrayShaded?"on":"off"),O.updateIfChanged(m.dTransparentBackfaces,h.transparentBackfaces),O.updateIfChanged(m.dSolidInterior,h.solidInterior),O.updateIfChanged(m.uBumpFrequency,h.bumpFrequency),O.updateIfChanged(m.uBumpAmplitude,h.bumpAmplitude)},updateBoundingSphere:function d(m,h){var v=Pe.clone(h.boundingSphere),g=Qi(v,m.aTransform.ref.value,m.instanceCount.ref.value,0);Pe.equals(g,m.boundingSphere.ref.value)||O.update(m.boundingSphere,g),Pe.equals(v,m.invariantBoundingSphere.ref.value)||(O.update(m.invariantBoundingSphere,v),O.update(m.uInvariantBoundingSphere,dr.fromSphere(m.uInvariantBoundingSphere.ref.value,v)))},createRenderableState:function f(m){var h=st.createRenderableState(m);return p(h,m),h},updateRenderableState:p,createPositionIterator:s}}(qu||(qu={})),function(e){function t(o){switch(o.kind){case"mesh":return 3*o.triangleCount;case"points":return o.pointCount;case"spheres":return 2*o.sphereCount*3;case"cylinders":return 4*o.cylinderCount*3;case"text":return 2*o.charCount*3;case"lines":return 2*o.lineCount*3;case"direct-volume":return 36;case"image":return 6;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t,e.getVertexCount=function r(o){switch(o.kind){case"mesh":case"texture-mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return 6*o.sphereCount;case"cylinders":return 6*o.cylinderCount;case"text":return 4*o.charCount;case"lines":return 4*o.lineCount;case"direct-volume":var s=o.gridDimension.ref.value;return s[0]*s[1]*s[2];case"image":return 4}},e.getGroupCount=function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return 0===t(o)?0:id(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return id(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}},e.getUtils=function a(o){switch(o.kind){case"mesh":return Vt.Utils;case"points":return fm.Utils;case"spheres":return Cd.Utils;case"cylinders":return qu.Utils;case"text":return zu.Utils;case"lines":return na.Utils;case"direct-volume":return ju.Utils;case"image":return qf.Utils;case"texture-mesh":return is.Utils}},e.getGranularity=function i(o,s){return"instance"===s&&o.nonInstanceable?"group":s}}(Oi||(Oi={}));var VK={};function b4(e,t){return{factory:b4,granularity:"groupInstance",size:function(r){return Ho.isLocation(r)?r.shape.getSize(r.group,r.instance):1},props:t,description:"Assigns sizes as defined by the shape object."}}var x4e={name:"shape-group",label:"Shape Group",category:"",factory:b4,getParams:function C4e(e){return VK},defaultValues:T.getDefaultValues(VK),isApplicable:function(e){return!!e.shape}},_4e=dt(13421772),GK={};function S4(e,t){return{factory:S4,granularity:"groupInstance",color:function(r){return Ho.isLocation(r)?r.shape.getColor(r.group,r.instance):_4e},props:t,description:"Assigns colors as defined by the shape object."}}var qr,Ho,T4e={name:"shape-group",label:"Shape Group",category:Xn.Misc,factory:S4,getParams:function A4e(e){return GK},defaultValues:T.getDefaultValues(GK),isApplicable:function(e){return!!e.shape}},D4e=R(R({},zf),{aPosition:Tn("float32",3,0),elements:X0("uint32"),uBboxMin:Ae("v3"),uBboxMax:Ae("v3"),uBboxSize:Ae("v3"),uMaxSteps:Ae("i"),uStepScale:Ae("f"),uJumpLength:Ae("f"),uTransform:Ae("m4"),uGridDim:Ae("v3"),tTransferTex:Xt("image-uint8","alpha","ubyte","linear"),uTransferScale:Ae("f","material"),dGridTexType:Lt("string",["2d","3d"]),uGridTexDim:Ae("v3"),tGridTex:Xt("texture","rgba","ubyte","linear"),uGridStats:Ae("v4"),uCellDim:Ae("v3"),uCartnToUnit:Ae("m4"),uUnitToCartn:Ae("m4"),dPackedGroup:Lt("boolean"),dAxisOrder:Lt("string",["012","021","102","120","201","210"]),dIgnoreLight:Lt("boolean"),dXrayShaded:Lt("string",["off","on","inverted"])}),I4e=R(R({},zf),{aGroup:Tn("float32",1,0),aPosition:Tn("float32",3,0),aNormal:Tn("float32",3,0),elements:X0("uint32"),dVaryingGroup:Lt("boolean"),dFlatShaded:Lt("boolean"),uDoubleSided:Ae("b","material"),dFlipSided:Lt("boolean"),dIgnoreLight:Lt("boolean"),dXrayShaded:Lt("string",["off","on","inverted"]),dTransparentBackfaces:Lt("string",["off","on","opaque"]),uBumpFrequency:Ae("f","material"),uBumpAmplitude:Ae("f","material"),meta:oa("unknown")}),M4e=R(R(R({},zf),jS),{aGroup:Tn("float32",1,0),aPosition:Tn("float32",3,0),dPointSizeAttenuation:Lt("boolean"),dPointStyle:Lt("string",["square","circle","fuzzy"])}),O4e=R(R(R({},zf),jS),{aGroup:Tn("float32",1,0),aMapping:Tn("float32",2,0),aStart:Tn("float32",3,0),aEnd:Tn("float32",3,0),elements:X0("uint32"),dLineSizeAttenuation:Lt("boolean"),uDoubleSided:Ae("b","material"),dFlipSided:Lt("boolean")}),B4e=R(R(R({},zf),jS),{uTexDim:Ae("v2"),tPositionGroup:Xt("image-float32","rgba","float","nearest"),padding:oa("number"),uDoubleSided:Ae("b","material"),dIgnoreLight:Lt("boolean"),dXrayShaded:Lt("string",["off","on","inverted"]),dTransparentBackfaces:Lt("string",["off","on","opaque"]),dSolidInterior:Lt("boolean"),dClipPrimitive:Lt("boolean"),dApproximate:Lt("boolean"),uAlphaThickness:Ae("f"),uBumpFrequency:Ae("f","material"),uBumpAmplitude:Ae("f","material"),centerBuffer:oa("float32"),groupBuffer:oa("float32")}),k4e=R(R(R({},zf),jS),{aGroup:Tn("float32",1,0),aPosition:Tn("float32",3,0),aMapping:Tn("float32",2,0),aDepth:Tn("float32",1,0),elements:X0("uint32"),aTexCoord:Tn("float32",2,0),tFont:Xt("image-uint8","alpha","ubyte","linear"),padding:oa("number"),uBorderWidth:Ae("f","material"),uBorderColor:Ae("v3","material"),uOffsetX:Ae("f","material"),uOffsetY:Ae("f","material"),uOffsetZ:Ae("f","material"),uBackgroundColor:Ae("v3","material"),uBackgroundOpacity:Ae("f","material")}),U4e=R(R({},zf),{uGeoTexDim:Ae("v2","buffered"),tPosition:Xt("texture","rgb","float","nearest"),tGroup:Xt("texture","alpha","float","nearest"),tNormal:Xt("texture","rgb","float","nearest"),dVaryingGroup:Lt("boolean"),dFlatShaded:Lt("boolean"),uDoubleSided:Ae("b","material"),dFlipSided:Lt("boolean"),dIgnoreLight:Lt("boolean"),dXrayShaded:Lt("string",["off","on","inverted"]),dTransparentBackfaces:Lt("string",["off","on","opaque"]),uBumpFrequency:Ae("f","material"),uBumpAmplitude:Ae("f","material"),meta:oa("unknown")}),G4e=R(R({},zf),{aGroup:Tn("float32",1,0),aPosition:Tn("float32",3,0),aUv:Tn("float32",2,0),elements:X0("uint32"),uImageTexDim:Ae("v2"),tImageTex:Xt("image-uint8","rgba","ubyte","nearest"),tGroupTex:Xt("image-uint8","rgba","ubyte","nearest"),dInterpolation:Lt("string",g4e)}),H4e=R(R(R({},zf),jS),{aGroup:Tn("float32",1,0),aStart:Tn("float32",3,0),aEnd:Tn("float32",3,0),aMapping:Tn("float32",3,0),aScale:Tn("float32",1,0),aCap:Tn("float32",1,0),elements:X0("uint32"),padding:oa("number"),uDoubleSided:Ae("b","material"),dIgnoreLight:Lt("boolean"),dXrayShaded:Lt("string",["off","on","inverted"]),dTransparentBackfaces:Lt("string",["off","on","opaque"]),dSolidInterior:Lt("boolean"),uBumpFrequency:Ae("f","material"),uBumpAmplitude:Ae("f","material")}),q4e=Jo(0,2147483647),Wf=Jo(0,2147483647);function Q0(e,t,r,n){return{id:q4e(),type:e,values:t,state:r,materialId:n}}function zK(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o];("uchar"===(c=t.propertyTypes[o])||"uint8"===c||"ushort"===c||"uint16"===c||"uint"===c||"uint32"===c||"int"===c)&&a.push([u,u]),("uchar"===c||"uint8"===c)&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var l=[["",""]];if(r){for(o=0,s=r.propertyNames.length;o<s;++o){var c,d=r.propertyNames[o];("uchar"===(c=r.propertyTypes[o])||"uint8"===c)&&l.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return R(R({},Vt.Params),{coloring:T.MappedStatic(f,{vertex:T.Group({red:T.Select(n.vRed,i,{label:"Red Property"}),green:T.Select(n.vGreen,i,{label:"Green Property"}),blue:T.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:T.Group({red:T.Select(n.mRed,l,{label:"Red Property"}),green:T.Select(n.mGreen,l,{label:"Green Property"}),blue:T.Select(n.mBlue,l,{label:"Blue Property"})},{isFlat:!0}),uniform:T.Group({color:T.Color(vr.grey),saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:T.MappedStatic(n.group?"vertex":"none",{vertex:T.Group({group:T.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:T.Group({})})})}!function(e){function n(l){var d=l.transforms.length,f=Ho.Location(l);return On(l.groupCount,d,1,function(m,h){return f.group=m,f.instance=h,f})}e.create=function t(l,d,f,p,m,h,v){return{id:kn.create22(),name:l,sourceData:d,geometry:f,transforms:v||[he.identity()],get groupCount(){return Oi.getGroupCount(f)},getColor:p,getSize:m,getLabel:h}},e.getTheme=function r(l){return{color:S4(0,{}),size:b4(0,{})}},e.groupIterator=n,e.createTransform=function a(l,d){for(var f=d&&d.aTransform.ref.value.length>=16*l.length?d.aTransform.ref.value:new Float32Array(16*l.length),p=0,m=l.length;p<m;++p)he.toArray(l[p],f,16*p);return zF(f,l.length,d)},e.createRenderObject=function i(l,d){var f=e.getTheme(l),p=Oi.getUtils(l.geometry),m=Wf(),h=n(l),v=e.createTransform(l.transforms),g=p.createValues(l.geometry,v,h,f,d),y=p.createRenderableState(d);return Q0(l.geometry.kind,g,y,m)},e.Loci=function o(l){return{kind:"shape-loci",shape:l}},e.isLoci=function s(l){return!!l&&"shape-loci"===l.kind},e.areLociEqual=function u(l,d){return l.shape===d.shape},e.isLociEmpty=function c(l){return 0===l.shape.groupCount}}(qr||(qr={})),function(e){function s(p){for(var m=0,h=0,v=p.groups;h<v.length;h++)m+=ke.size(v[h].ids);return m}e.Location=function t(p,m,h){return void 0===m&&(m=0),void 0===h&&(h=0),{kind:"group-location",shape:p,group:m,instance:h}},e.isLocation=function r(p){return!!p&&"group-location"===p.kind},e.Loci=function n(p,m){return{kind:"group-loci",shape:p,groups:m}},e.isLoci=function a(p){return!!p&&"group-loci"===p.kind},e.areLociEqual=function i(p,m){if(p.shape!==m.shape||p.groups.length!==m.groups.length)return!1;for(var h=0,v=p.groups.length;h<v;++h){var g=p.groups[h],C=m.groups[h];if(g.instance!==C.instance||!ke.areEqual(g.ids,C.ids))return!1}return!0},e.isLociEmpty=function o(p){return 0===s(p)},e.size=s;var u=new Yh,c=b.zero();function l(p,m,h,v){for(var g=m.indices,y=m.offsets,S=function(A,E){ke.forEach(A,function(I){for(var M=y[I],F=y[I+1];M<F;++M)b.fromArray(c,h,3*g[M]),b.transformMat4(c,c,v[E]),u.includeStep(c)})},C=0,_=p;C<_.length;C++){var x=_[C];S(x.ids,x.instance)}}function d(p,m,h,v){for(var g=m.indices,y=m.offsets,S=function(A,E){ke.forEach(A,function(I){for(var M=y[I],F=y[I+1];M<F;++M)b.fromArray(c,h,3*g[M]),b.transformMat4(c,c,v[E]),u.radiusStep(c)})},C=0,_=p;C<_.length;C++){var x=_[C];S(x.ids,x.instance)}}e.getBoundingSphere=function f(p,m){m||(m=Pe()),u.reset();var h=0,v=p.shape,g=v.geometry,y=v.transforms;if("mesh"===g.kind||"points"===g.kind)l(p.groups,g.groupMapping,S="mesh"===g.kind?g.vertexBuffer.ref.value:g.centerBuffer.ref.value,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,S,y);else if("lines"===g.kind){var C=g.startBuffer.ref.value,_=g.endBuffer.ref.value;l(p.groups,g.groupMapping,C,y),l(p.groups,g.groupMapping,_,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,C,y),d(p.groups,g.groupMapping,_,y)}else{if("spheres"!==g.kind&&"text"!==g.kind)return Pe.copy(m,g.boundingSphere);var S;l(p.groups,g.groupMapping,S=g.centerBuffer.ref.value,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,S,y);for(var x=function(F,N){ke.forEach(F,function(j){var U=p.shape.getSize(j,N);h<U&&(h=U)})},D=0,w=p.groups;D<w.length;D++){var A=w[D];x(A.ids,A.instance)}}return b.copy(m.center,u.center),m.radius=Math.sqrt(u.radiusSq),Pe.expand(m,m,h),m}}(Ho||(Ho={}));var HK=zK();function K4e(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:if(i=yt.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");c=t.getProperty("nx"),l=t.getProperty("ny"),d=t.getProperty("nz"),f=!!c&&!!l&&!!d,p=1e5,m=0,h=t.rowCount,g.label=1;case 1:return m<h?(function Y4e(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),c=n.getProperty("y"),l=n.getProperty("z");if(!u||!c||!l)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),p=n.getProperty("nz"),m=!!d&&!!f&&!!p,h=e;h<t;++h)qe.add3(i,u.value(h),c.value(h),l.value(h)),m&&qe.add3(o,d.value(h),f.value(h),p.value(h)),qe.add(s,a[h])}(m,Math.min(m+p,h),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:m,max:h})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return m+=p,[3,1];case 4:m=0,h=r.rowCount,g.label=5;case 5:return m<h?(function X4e(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;3===u?qe.add3(a,s[0],s[1],s[2]):4===u&&(qe.add3(a,s[2],s[1],s[0]),qe.add3(a,s[2],s[0],s[3]))}}(m,Math.min(m+p,h),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:m,max:h})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return m+=p,[3,5];case 8:return v=yt.getMesh(i),f||Vt.computeNormals(v),O.updateIfChanged(v.varyingGroup,!0),[2,v]}})})}var Qh,Yf=ie.Schema.int;function jK(e,t,r){var i,o,s,n=r.coloring,a=e.rowCount;if("vertex"===n.name)i=e.getProperty(n.params.red)||ie.ofConst(127,a,Yf),o=e.getProperty(n.params.green)||ie.ofConst(127,a,Yf),s=e.getProperty(n.params.blue)||ie.ofConst(127,a,Yf);else if("material"===n.name)i=t&&t.getProperty(n.params.red)||ie.ofConst(127,a,Yf),o=t&&t.getProperty(n.params.green)||ie.ofConst(127,a,Yf),s=t&&t.getProperty(n.params.blue)||ie.ofConst(127,a,Yf);else{var u=n.params.color;u=dt.saturate(u,n.params.saturation),u=dt.lighten(u,n.params.lightness);var c=dt.toRgb(u),d=c[1],f=c[2];i=ie.ofConst(c[0],a,Yf),o=ie.ofConst(d,a,Yf),s=ie.ofConst(f,a,Yf)}return{kind:n.name,red:i,green:o,blue:s}}function qK(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,c=n.map,l=n.label;return qr.create("ply-mesh",e.source,t,function(p){var m="material"===a?p:c[p];return dt.fromRgb(i.value(m),o.value(m),s.value(m))},function(){return 1},function(p){return"".concat(l," ").concat(u[p])},e.transforms)}function Q4e(){var t,r,n,a,i,o,e=this;return function(u,c,l,d){return ue(e,void 0,void 0,function(){var f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:if(!(f=c.source.getElement("vertex")))throw new Error("missing vertex element");if(!(p=c.source.getElement("face")))throw new Error("missing face element");return m=c.source.getElement("material"),h=!1,v=!1,(!t||t!=t)&&(h=!0),(!r||!T.isParamEqual(HK.grouping,r.grouping,l.grouping))&&(h=!0),(!r||!T.isParamEqual(HK.coloring,r.coloring,l.coloring))&&(v=!0),h?(i=jK(f,m,l),o=function Z4e(e,t){for(var r=t.grouping,n=e.rowCount,a="vertex"===r.name?e.getProperty(r.params.group):void 0,i="vertex"===r.name?yc(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):Bu(new Uint32Array(n)),s=a?id(o):n-1,u=new Uint32Array(s+1),c=0,l=o.length;c<l;++c)u[o[c]]=c;return{ids:o,map:u,label:i}}(f,l),[4,K4e(u,f,p,o.ids,d&&d.geometry)]):[3,2];case 1:return a=g.sent(),n=qK(c,a,i,o),[3,3];case 2:v&&(i=jK(f,m,l),n=qK(c,a,i,o)),g.label=3;case 3:return t=c,r=fl(l),[2,n]}})})}}function $4e(e,t){var r=this;return Ve.create("Shape Provider",function(n){return ue(r,void 0,void 0,function(){return ce(this,function(a){return[2,{label:"Mesh",data:{source:e,transforms:t?.transforms},params:zK(e),getShape:Q4e(),geometryUtils:Vt.Utils}]})})})}function cu(e,t){return{value:e,unit:t}}function Xf(){return Xf.empty()}function eBe(e){var t=this;return Ve.create("Parse DCD",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),a=(n=e.header).DELTA?cu(20.45482949774598*n.DELTA,"ps"):cu(1,"step"),i=cu(n.ISTART>=1?(n.ISTART-1)*a.value:0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)l={elementCount:(c=e.frames[s]).elementCount,time:cu(i.value+a.value*s,a.unit),x:c.x,y:c.y,z:c.z,xyzOrdering:{isIdentity:!0}},c.cell&&(l.cell=(d=c.cell)[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?Xf.create(b.create(d[0],d[2],d[5]),b.create(Yr(90-90*Math.asin(d[1])/rS),Yr(90-90*Math.asin(d[3])/rS),Yr(90-90*Math.asin(d[4])/rS))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?Xf.fromBasis(b.create(d[0],d[1],d[3]),b.create(d[1],d[2],d[4]),b.create(d[3],d[4],d[5])):Xf.create(b.create(d[0],d[2],d[5]),b.create(Yr(ea(d[1],0,mn)?90:d[1]),Yr(ea(d[3],0,mn)?90:d[3]),Yr(ea(d[4],0,mn)?90:d[4])))),o.push(l);return[2,Qh.create(o,a,i)]}})})})}function EA(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(32===o||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(32===o||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(a===++i||a+1===i)return Xe.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if(!((78!==o&&110!==o||65!==s&&97!==s)&&(67!==o&&99!==o||76!==s&&108!==s)&&(70!==o&&102!==o||69!==s&&101!==s)&&(83!==o&&115!==o||73!==s&&105!==s)&&(66!==o&&98!==o||82!==s&&114!==s)&&(65!==o&&97!==o||83!==s&&115!==s)))return Xe.add(e,a,a+2)}if(67===o||99===o||72===o||104===o||78===o||110===o||79===o||111===o||80===o||112===o||83===o||115===o)return Xe.add(e,a,a+1);Xe.add(e,a,a)}!function(e){e.create=function t(u,c,l){var d=!!u[0].cell,f=!!u[0].velocities,p=!!u[0].forces;return{id:kn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:c,timeOffset:l}},e.getAtomicConformation=function r(u,c,l){var d,f,p=u.x,m=u.y,h=u.z;return u.xyzOrdering.frozen?l?u.xyzOrdering.isIdentity?(p=o(p,l),m=o(m,l),h=o(h,l)):Es(u.xyzOrdering.index,l)||(p=i(p,u.xyzOrdering.index,l),m=i(m,u.xyzOrdering.index,l),h=i(h,u.xyzOrdering.index,l)):u.xyzOrdering.isIdentity||(p=s(p,u.xyzOrdering.index),m=s(m,u.xyzOrdering.index),h=s(h,u.xyzOrdering.index)):l&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=l,a(p,l),a(m,l),a(h,l)):Es(u.xyzOrdering.index,l)||(p=i(p,u.xyzOrdering.index,l),m=i(m,u.xyzOrdering.index,l),h=i(h,u.xyzOrdering.index,l))),u.xyzOrdering.frozen=!0,{id:kn.create22(),atomId:c.atomId,occupancy:null!==(d=c.occupancy)&&void 0!==d?d:ie.ofConst(1,u.elementCount,ie.Schema.int),B_iso_or_equiv:null!==(f=c.B_iso_or_equiv)&&void 0!==f?f:ie.ofConst(0,u.elementCount,ie.Schema.float),xyzDefined:!0,x:p,y:m,z:h}};var n=[.123];function a(u,c){for(var l=n,d=0,f=u.length;d<f;d++)l[d]=u[c[d]];for(d=0,f=u.length;d<f;d++)u[d]=l[d]}function i(u,c,l){for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;f++)d[f]=u[c[l[f]]];return d}function o(u,c){for(var l=new Float32Array(u.length),d=0,f=u.length;d<f;d++)l[d]=u[c[d]];return l}function s(u,c){for(var l=new Float32Array(u.length),d=0,f=u.length;d<f;d++)l[c[d]]=u[d];return l}}(Qh||(Qh={})),function(e){function t(a,i){return{size:a,anglesInRadians:i}}function r(){return t(b(),b())}e.create=t,e.empty=r,e.fromBasis=function n(a,i,o){var s=b.magnitude(a),u=b.magnitude(i),c=b.magnitude(o),l=Math.acos(b.dot(i,o)/(u*c)),d=Math.acos(b.dot(a,o)/(s*c)),f=Math.acos(b.dot(a,i)/(s*u));return s<=0||u<=0||c<=0||l>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(b.create(s,u,c),b.create(l,d,f))}}(Xf||(Xf={}));var tBe=new Set(["NA","CL","FE","SI","BR","AS","LI"]),rBe=new Set(["C","H","N","O","P","S","F","B"]),nBe=/^[\s\d]+|[\s\d]+$/g;function $0(e,t){var r=(e=e.replace(nBe,"").toUpperCase()).length;if(0===r||1===r||tBe.has(e))return e;if(3===r&&t===e){if("SOD"===e)return"NA";if("POT"===e)return"K";if("CES"===e)return"CS";if("CAL"===e)return"CA";if("CLA"===e)return"CL"}return rBe.has(e[0])?e[0]:""}var lu,du,WK=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WOO","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6X","X6Y","XBP","XDP","XDX","XGP","XIL","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]),Pn=function(e){return e[e.FilledSphere=0]="FilledSphere",e[e.FilledCube=1]="FilledCube",e[e.CrossedCube=2]="CrossedCube",e[e.DividedDiamond=3]="DividedDiamond",e[e.FilledCone=4]="FilledCone",e[e.DevidedCone=5]="DevidedCone",e[e.FlatBox=6]="FlatBox",e[e.FilledStar=7]="FilledStar",e[e.FilledDiamond=8]="FilledDiamond",e[e.FlatDiamond=9]="FlatDiamond",e[e.FlatHexagon=10]="FlatHexagon",e[e.Pentagon=11]="Pentagon",e[e.DiamondPrism=12]="DiamondPrism",e[e.PentagonalPrism=13]="PentagonalPrism",e[e.HexagonalPrism=14]="HexagonalPrism",e[e.HeptagonalPrism=15]="HeptagonalPrism",e}(Pn||{}),_t=function(e){return e[e.Hexose=0]="Hexose",e[e.HexNAc=1]="HexNAc",e[e.Hexosamine=2]="Hexosamine",e[e.Hexuronate=3]="Hexuronate",e[e.Deoxyhexose=4]="Deoxyhexose",e[e.DeoxyhexNAc=5]="DeoxyhexNAc",e[e.DiDeoxyhexose=6]="DiDeoxyhexose",e[e.Pentose=7]="Pentose",e[e.Deoxynonulosonate=8]="Deoxynonulosonate",e[e.DiDeoxynonulosonate=9]="DiDeoxynonulosonate",e[e.Unknown=10]="Unknown",e[e.Assigned=11]="Assigned",e}(_t||{});(lu={})[_t.Hexose]="Hexose",lu[_t.HexNAc]="HexNAc",lu[_t.Hexosamine]="Hexosamine",lu[_t.Hexuronate]="Hexuronate",lu[_t.Deoxyhexose]="Deoxyhexose",lu[_t.DeoxyhexNAc]="DeoxyhexNAc",lu[_t.DiDeoxyhexose]="Di-deoxyhexose",lu[_t.Pentose]="Pentose",lu[_t.Deoxynonulosonate]="Deoxynonulosonate",lu[_t.DiDeoxynonulosonate]="Di-deoxynonulosonate",lu[_t.Unknown]="Unknown",lu[_t.Assigned]="Assigned";var iBe=((du={})[_t.Hexose]=Pn.FilledSphere,du[_t.HexNAc]=Pn.FilledCube,du[_t.Hexosamine]=Pn.CrossedCube,du[_t.Hexuronate]=Pn.DividedDiamond,du[_t.Deoxyhexose]=Pn.FilledCone,du[_t.DeoxyhexNAc]=Pn.DevidedCone,du[_t.DiDeoxyhexose]=Pn.FlatBox,du[_t.Pentose]=Pn.FilledStar,du[_t.Deoxynonulosonate]=Pn.FilledDiamond,du[_t.DiDeoxynonulosonate]=Pn.FlatDiamond,du[_t.Unknown]=Pn.FlatHexagon,du[_t.Assigned]=Pn.Pentagon,du);function oBe(e,t){return e===_t.Unknown?4===t?Pn.DiamondPrism:5===t?Pn.PentagonalPrism:6===t?Pn.HexagonalPrism:7===t?Pn.HeptagonalPrism:Pn.FlatHexagon:iBe[e]}var sa,C4={abbr:"Unk",name:"Unknown",color:15854817,type:_t.Unknown},J0=[{abbr:"Glc",name:"Glucose",color:37052,type:_t.Hexose},{abbr:"Man",name:"Mannose",color:42577,type:_t.Hexose},{abbr:"Gal",name:"Galactose",color:16765952,type:_t.Hexose},{abbr:"Gul",name:"Gulose",color:16021792,type:_t.Hexose},{abbr:"Alt",name:"Altrose",color:16162465,type:_t.Hexose},{abbr:"All",name:"Allose",color:10830745,type:_t.Hexose},{abbr:"Tal",name:"Talose",color:9424105,type:_t.Hexose},{abbr:"Ido",name:"Idose",color:10582605,type:_t.Hexose},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:37052,type:_t.HexNAc},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:42577,type:_t.HexNAc},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:16765952,type:_t.HexNAc},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:16021792,type:_t.HexNAc},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:16162465,type:_t.HexNAc},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:10830745,type:_t.HexNAc},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:9424105,type:_t.HexNAc},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:10582605,type:_t.HexNAc},{abbr:"GlcN",name:"Glucosamine",color:37052,type:_t.Hexosamine},{abbr:"ManN",name:"Mannosamine",color:42577,type:_t.Hexosamine},{abbr:"GalN",name:"Galactosamine",color:16765952,type:_t.Hexosamine},{abbr:"GulN",name:"Gulosamine",color:16021792,type:_t.Hexosamine},{abbr:"AltN",name:"Altrosamine",color:16162465,type:_t.Hexosamine},{abbr:"AllN",name:"Allosamine",color:10830745,type:_t.Hexosamine},{abbr:"TalN",name:"Talosamine",color:9424105,type:_t.Hexosamine},{abbr:"IdoN",name:"Idosamine",color:10582605,type:_t.Hexosamine},{abbr:"GlcA",name:"Glucuronic Acid",color:37052,type:_t.Hexuronate},{abbr:"ManA",name:"Mannuronic Acid",color:42577,type:_t.Hexuronate},{abbr:"GalA",name:"Galacturonic Acid",color:16765952,type:_t.Hexuronate},{abbr:"GulA",name:"Guluronic Acid",color:16021792,type:_t.Hexuronate},{abbr:"AltA",name:"Altruronic Acid",color:16162465,type:_t.Hexuronate},{abbr:"AllA",name:"Alluronic Acid",color:10830745,type:_t.Hexuronate},{abbr:"TalA",name:"Taluronic Acid",color:9424105,type:_t.Hexuronate},{abbr:"IdoA",name:"Iduronic Acid",color:10582605,type:_t.Hexuronate},{abbr:"Qui",name:"Quinovose",color:37052,type:_t.Deoxyhexose},{abbr:"Rha",name:"Rhamnose",color:42577,type:_t.Deoxyhexose},{abbr:"6dGul",name:"6-Deoxy Gulose",color:16021792,type:_t.Deoxyhexose},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:16162465,type:_t.Deoxyhexose},{abbr:"6dTal",name:"6-Deoxy Talose",color:9424105,type:_t.Deoxyhexose},{abbr:"Fuc",name:"Fucose",color:15539236,type:_t.Deoxyhexose},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:37052,type:_t.DeoxyhexNAc},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:42577,type:_t.DeoxyhexNAc},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:16162465,type:_t.DeoxyhexNAc},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:9424105,type:_t.DeoxyhexNAc},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:15539236,type:_t.DeoxyhexNAc},{abbr:"Oli",name:"Olivose",color:37052,type:_t.DiDeoxyhexose},{abbr:"Tyv",name:"Tyvelose",color:42577,type:_t.DiDeoxyhexose},{abbr:"Abe",name:"Abequose",color:16021792,type:_t.DiDeoxyhexose},{abbr:"Par",name:"Paratose",color:16162465,type:_t.DiDeoxyhexose},{abbr:"Dig",name:"Digitoxose",color:10830745,type:_t.DiDeoxyhexose},{abbr:"Col",name:"Colitose",color:9424105,type:_t.DiDeoxyhexose},{abbr:"Ara",name:"Arabinose",color:42577,type:_t.Pentose},{abbr:"Lyx",name:"Lyxose",color:16765952,type:_t.Pentose},{abbr:"Xyl",name:"Xylose",color:16021792,type:_t.Pentose},{abbr:"Rib",name:"Ribose",color:16162465,type:_t.Pentose},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:42577,type:_t.Deoxynonulosonate},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:10830745,type:_t.Deoxynonulosonate},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:9424105,type:_t.Deoxynonulosonate},{abbr:"Neu",name:"Neuraminic Acid",color:10582605,type:_t.Deoxynonulosonate},{abbr:"Sia",name:"Sialic acid",color:15539236,type:_t.Deoxynonulosonate},{abbr:"Pse",name:"Pseudaminic Acid",color:42577,type:_t.DiDeoxynonulosonate},{abbr:"Leg",name:"Legionaminic Acid",color:16765952,type:_t.DiDeoxynonulosonate},{abbr:"Aci",name:"Acinetaminic Acid",color:16162465,type:_t.DiDeoxynonulosonate},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:9424105,type:_t.DiDeoxynonulosonate},{abbr:"Bac",name:"Bacillosamine",color:37052,type:_t.Unknown},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:42577,type:_t.Unknown},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:16765952,type:_t.Unknown},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:16021792,type:_t.Unknown},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:16162465,type:_t.Unknown},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:10830745,type:_t.Unknown},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:9424105,type:_t.Unknown},{abbr:"Mur",name:"Muramic Acid",color:10582605,type:_t.Unknown},{abbr:"Api",name:"Apicose",color:42577,type:_t.Assigned},{abbr:"Fru",name:"Fructose",color:42577,type:_t.Assigned},{abbr:"Tag",name:"Tagatose",color:16765952,type:_t.Assigned},{abbr:"Sor",name:"Sorbose",color:16021792,type:_t.Assigned},{abbr:"Psi",name:"Psicose",color:16162465,type:_t.Assigned}],sBe=function(){for(var e=new Map,t=0,r=J0.length;t<r;++t){var n=J0[t];e.set(n.abbr,n)}return e}(),uBe=[["Glc-family",37052],["Man-family",42577],["Gal-family",16765952],["Gul-family",16021792],["Alt-family",16162465],["All-family",10830745],["Tal-family",9424105],["Ido-family",10582605],["Fuc-family",15539236],["Generic/Unknown/Secondary",15854817]],YK={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},XK={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},cBe={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"],Abe:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"],Bac:["0BC","3BC","0bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"]},KK=function(){for(var e=new Map,t=0,r=J0.length;t<r;++t){var n=J0[t],a=YK[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n);var s=XK[n.abbr];if(s)for(i=0,o=s.length;i<o;++i)e.set(s[i],n)}return WK.forEach(function(u){e.has(u)||e.set(u,C4)}),e}(),lBe=function(){for(var e=new Map,t=0,r=J0.length;t<r;++t){var n=J0[t],a=YK[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n);var s=XK[n.abbr];if(s)for(i=0,o=s.length;i<o;++i)e.set(s[i],n);var u=cBe[n.abbr];if(u)for(i=0,o=u.length;i<o;++i)e.has(u[i])||e.set(u[i],n)}return WK.forEach(function(c){e.has(c)||e.set(c,C4)}),e}(),Kf=KK;!function(e){e.toArray=function t(p){return Cw(p.values())},e.isSuperset=function r(p,m){if(p.size<m.size)return!1;var h=!0;return m.forEach(function(v){h&&!p.has(v)&&(h=!1)}),h},e.add=function n(p){for(var m=[],h=1;h<arguments.length;h++)m[h-1]=arguments[h];for(var v=0;v<m.length;v++)m[v].forEach(function(g){return p.add(g)});return p},e.union=function a(p,m){var h=new Set(p);return m.forEach(function(v){return h.add(v)}),h},e.unionMany=function i(){for(var p=[],m=0;m<arguments.length;m++)p[m]=arguments[m];if(0===p.length)return new Set;for(var h=new Set(p[0]),v=1,g=p.length;v<g;v++)p[v].forEach(function(y){return h.add(y)});return h},e.unionManyArrays=function o(p){if(0===p.length)return new Set;for(var m=new Set(p[0]),h=1;h<p.length;h++)for(var v=0,g=p[h];v<g.length;v++)m.add(g[v]);return m},e.intersection=function s(p,m){var h=new Set;return m.forEach(function(v){p.has(v)&&h.add(v)}),h},e.areIntersecting=function u(p,m){var h;p.size<m.size&&(p=(h=[m,p])[0],m=h[1]);var v=!1;return m.forEach(function(g){!v&&p.has(g)&&(v=!0)}),v},e.intersectionSize=function c(p,m){var h;p.size<m.size&&(p=(h=[m,p])[0],m=h[1]);var v=0;return m.forEach(function(g){p.has(g)&&(v+=1)}),v},e.difference=function l(p,m){var h=new Set(p);return m.forEach(function(v){return h.delete(v)}),h},e.differenceSize=function d(p,m){var h=p.size;return p.forEach(function(v){m.has(v)&&(h-=1)}),h},e.areEqual=function f(p,m){if(p.size!==m.size)return!1;var h=!0;return m.forEach(function(v){h&&!p.has(v)&&(h=!1)}),h}}(sa||(sa={}));var Zf,ZK=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),QK=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),fBe=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var c=0,l=t;c<l.length;c++){var d=l[c];e[i+u+d]=(i+u+d).toUpperCase()}}}return e}();function $h(e){return fBe[e]||e.toUpperCase()}var sn,Gr,$K=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],$h(e[1])]})),hBe=((Zf={})[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},Zf[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},Zf[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},Zf[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},Zf[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Zf[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Zf[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},Zf),Qf=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),IA=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),JK=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),eZ=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),vBe=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),gBe=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),yBe=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),tZ=new Set(["peptide linking","peptide-like"]),bBe=sa.unionMany(JK,eZ,tZ),rZ=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),nZ=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),aZ=sa.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),SBe=new Set(["non-polymer","other"]),CBe=new Set(["ion"]),xBe=new Set(["lipid"]),PA=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),x4=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),iZ=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),qS=sa.unionMany(x4,iZ),_Be=new Set(["NME","ACE","NH2","FOR","FMT"]),WS=new Set(["A","C","T","G","I","U","N"]),YS=new Set(["DA","DC","DT","DG","DI","DU","DN"]),_4=new Set(["APN","CPN","TPN","GPN"]),wBe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),ABe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),MA=sa.unionMany(WS,YS,_4),oZ=function(e){return wBe.has(e.toUpperCase())},sZ=function(e){return ABe.has(e.toUpperCase())},ey=sa.unionMany(qS,MA);function pm(e,t){return t=t.toUpperCase(),_4.has(t)?8:bBe.has(e)?5:nZ.has(e)?6:rZ.has(e)?7:aZ.has(e)?9:PA.has(t)?2:QK.has(t)?3:ZK.has(t)?4:SBe.has(e)?Kf.has(t)?9:qS.has(t)?5:WS.has(t)?6:YS.has(t)?7:1:0}function TBe(e,t){return 5===t?vBe.has(e)?2:gBe.has(e)?3:yBe.has(e)?0:1:6===t?4:7===t?5:8===t?6:0}function uZ(e){return e=e.toUpperCase(),qS.has(e)?"peptide linking":WS.has(e)?"rna linking":YS.has(e)?"dna linking":Kf.has(e)?"saccharide":"other"}function EBe(e){return e=e.toUpperCase(),PA.has(e)?"water":ey.has(e)?"polymer":Kf.has(e)?"branched":"non-polymer"}function IBe(e,t){return e=e.toUpperCase(),eZ.has(t)?"polypeptide(L)":JK.has(t)?"polypeptide(D)":nZ.has(t)?"polyribonucleotide":rZ.has(t)?"polydeoxyribonucleotide":aZ.has(t)||Kf.has(e)?"oligosaccharide":_4.has(e)?"peptide nucleic acid":x4.has(e)?"polypeptide(L)":iZ.has(e)?"polypeptide(D)":WS.has(e)?"polyribonucleotide":YS.has(e)?"polydeoxyribonucleotide":CBe.has(t)||QK.has(e)?"ion":xBe.has(t)||ZK.has(e)?"lipid":tZ.has(t)?"peptide-like":"other"}function RA(e){return xd(e)||cZ(e)}function xd(e){return 7===e||6===e||8===e}function cZ(e){return 5===e}!function(e){e.is=Vo.has,e.create=Vo.create,e.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}}(sn||(sn={})),function(e){function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.is=Vo.has,e.create=function t(s){return Vo.create(s)},e.isCovalent=function r(s){return 0!=(1&s)},e.isAll=function n(s){return s===Math.pow(2,6)-1},e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32},e.isName=function a(s){return s in e.Names},e.fromName=i,e.fromNames=function o(s){for(var u=0,c=0,l=s.length;c<l;++c)u|=i(s[c]);return u}}(Gr||(Gr={}));var w4={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]},PBe=(R(R({},Br.chem_comp_bond),{molstar_protonation_variant:ie.Schema.Str()}),R(R({},Br.chem_comp),{type:ie.Schema.Aliased(ie.Schema.str)}));function MBe(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=Xr.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=Xr.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}function lZ(e){for(var t=0,r=e.rowCount;t<r;t++)if(0===e.valueKind(t))return!0;return!1}function OA(e,t,r){(!e[t].isDefined||!lZ(e[t]))&&(e[t]=e[r]),(!e[r].isDefined||!lZ(e[r]))&&(e[r]=e[t])}var To={entry:Br.entry,struct:Br.struct,struct_asym:Br.struct_asym,ihm_model_list:Br.ihm_model_list,ihm_model_group:Br.ihm_model_group,ihm_model_group_link:Br.ihm_model_group_link,entity:Br.entity,entity_poly:Br.entity_poly,entity_poly_seq:Br.entity_poly_seq,pdbx_entity_branch:Br.pdbx_entity_branch,chem_comp:PBe,pdbx_chem_comp_identifier:Br.pdbx_chem_comp_identifier,atom_site:Br.atom_site,ihm_sphere_obj_site:Br.ihm_sphere_obj_site,ihm_gaussian_obj_site:Br.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:Br.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:Br.pdbx_molecule};function Ic(e,t){void 0===t&&(t=!1);for(var r=Object.create(null),n=0,a=Object.keys(To);n<a.length;n++){var i=a[n];r[i]=i in e?e[i]:Xr.ofUndefinedColumns(To[i],0)}return t&&(r.atom_site=function RBe(e){var t=Xr.ofColumns(e._schema,e);return OA(t,"label_atom_id","auth_atom_id"),OA(t,"label_comp_id","auth_comp_id"),OA(t,"label_seq_id","auth_seq_id"),OA(t,"label_asym_id","auth_asym_id"),t}(r.atom_site)),r}var OBe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],FBe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],BBe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],NBe=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),dZ=function(){var e=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(function(r){return e.set(r.id,r)}),e}(),fZ=function(){var e=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(function(r){return e.set(r.id,r)}),e}(),Cl=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(ey.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){if(this.seqId.value(t)!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!sa.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,OBe)?"peptide linking":this.hasAtomIds(t,FBe)?"rna linking":this.hasAtomIds(t,BBe)?"dna linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(dZ.has(t))this.set(dZ.get(t));else if(PA.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(NBe.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else if(Kf.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"saccharide"});else{var n=this.getAtomIds(r);if(1===n.size&&fZ.has(t))this.set(fZ.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Xr.ofPartialColumns(To.chem_comp,{id:ie.ofStringArray(this.ids),name:ie.ofStringArray(this.names),type:ie.ofStringAliasArray(this.types),mon_nstd_flag:ie.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function pZ(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}var fu,A4="ABCDEFGHIJKLMNOPQRSTUVWXYZ",XS=pZ(function kBe(e){for(var r=e,n=0,a=A4[r%26];r>=26;)r=Math.floor(r/26),a+=A4[r%26],n+=1;return n>=5&&console.warn("getChainId overflow"),a}),xl=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push("".concat(this.count)),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return 2===r?(void 0===this.waterId&&(this.set("water",a?.customName||"Water"),this.waterId="".concat(this.count)),this.waterId):RA(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",a?.customName||"Polymer ".concat(this.chainMap.size+1)),this.chainMap.set(n,"".concat(this.count))),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",a?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,"".concat(this.count))),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Xr.ofPartialColumns(To.entity,{id:ie.ofStringArray(this.ids),type:ie.ofStringAliasArray(this.types),pdbx_description:ie.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains;this.set("polymer",a.description);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],"".concat(this.count))}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function mZ(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,c=t.length;u<c;++u)for(var l=t[u],d=o[l],f=o[l+1];d<f;++d){var p=i[d];if(!a.has(p)){if(Ye.has(r,p))return!0;a.add(p),s[s.length]=p}}return n>1&&mZ(e,s,r,n-1,a)}!function(e){e.areEqual=function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var p=d.a,m=d.b,h=d.offset,v=f.a,g=f.b,y=f.offset,S=0,C=d.a.length;S<C;S++)if(p[S]!==v[S])return!1;for(S=0,C=d.b.length;S<C;S++)if(m[S]!==g[S])return!1;for(S=0,C=d.offset.length;S<C;S++)if(h[S]!==y[S])return!1;for(var _=0,x=Object.keys(d.edgeProps);_<x.length;_++){var D=x[_],w=d.edgeProps[D],A=f.edgeProps[D];if(!A)return!1;for(S=0,C=w.length;S<C;S++)if(w[S]!==A[S])return!1}return!0};var r=function(){function d(f,p,m,h,v,g){this.offset=f,this.a=p,this.b=m,this.edgeCount=h,this.props=g,this.vertexCount=f.length-1,this.edgeProps=v||{}}return d.prototype.getEdgeIndex=function(f,p){var m,h;f<p?(m=f,h=p):(m=p,h=f);for(var v=this.offset[m],g=this.offset[m+1];v<g;v++)if(this.b[v]===h)return v;return-1},d.prototype.getDirectedEdgeIndex=function(f,p){for(var m=this.offset[f],h=this.offset[f+1];m<h;m++)if(this.b[m]===p)return m;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,p,m,h,v){return new r(d,f,p,m,h,v)}e.create=n;var a=function(){function d(f,p,m){this.vertexCount=f,this.xs=p,this.ys=m,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var h=new Int32Array(this.vertexCount),v=0,g=this.xs.length;v<g;v++)h[this.xs[v]]++;for(v=0,g=this.ys.length;v<g;v++)h[this.ys[v]]++;var y=0;for(v=0;v<this.vertexCount;v++)this.offsets[v]=y,y+=h[v];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],m=this.offsets[f]+this.bucketFill[f];this.a[m]=f,this.b[m]=p,this.bucketFill[f]++;var h=this.offsets[p]+this.bucketFill[p];this.a[h]=p,this.b[h]=f,this.bucketFill[p]++,this.current++,this.curA=m,this.curB=h},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p,f[this.curB]=p},d.prototype.assignDirectedProperty=function(f,p,m,h){f[this.curA]=p,f[this.curB]=h,m[this.curB]=p,m[this.curA]=h},d}();e.EdgeBuilder=a;var i=function(){function d(f,p,m){this.vertexCount=f,this.xs=p,this.ys=m,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var h=new Int32Array(this.vertexCount),v=0,g=this.xs.length;v<g;v++)h[this.xs[v]]++;var y=0;for(v=0;v<this.vertexCount;v++)this.offsets[v]=y,y+=h[v];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],m=this.offsets[f]+this.bucketFill[f];this.a[m]=f,this.b[m]=p,this.bucketFill[f]++,this.current++,this.curA=m},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p},d}();e.DirectedEdgeBuilder=i;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,p){var m=f,h=p;f>p&&(m=p,h=f);var v=Ou(m,h);return!this.included.has(v)&&(this.included.add(v),this.xs[this.xs.length]=m,this.ys[this.ys.length]=h,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},d}();function s(d,f,p){var m=new e.EdgeBuilder(d,f,p);return m.addAllEdges(),m.createGraph({})}e.UniqueEdgeBuilder=o,e.fromVertexPairs=s,e.induceByVertices=function u(d,f,p){for(var m=d.b,h=d.offset,v=d.vertexCount,g=d.edgeProps,y=new Int32Array(v),S=0,C=f.length;S<C;S++)y[f[S]]=S+1;var _=0;for(S=0;S<v;S++)if(0!==y[S])for(var x=h[S],D=h[S+1];x<D;x++)m[x]>S&&0!==y[m[x]]&&_++;var w=new Int32Array(f.length+1),A=new Int32Array(2*_),E=new Int32Array(2*_),I=new Int32Array(2*_),M=0,F=0;for(S=0;S<v;S++)if(0!==y[S]){var N=y[S]-1;for(x=h[S],D=h[S+1];x<D;x++){var j=y[m[x]];0!==j&&(E[M]=N,I[M]=j-1,A[M]=x,M++)}w[++F]=M}for(var U={},H=0,z=Object.keys(g);H<z.length;H++){var G=z[H];U[G]=pwe(g[G],A)}return n(w,E,I,_,U,p)},e.connectedComponents=function c(d){var f=d.vertexCount;if(0===f)return{componentCount:0,componentIndex:new Int32Array(0)};if(0===d.edgeCount){for(var p=new Int32Array(f),m=0,h=f;m<h;m++)p[m]=m;return{componentCount:f,componentIndex:p}}var v=new Int32Array(f);for(m=0,h=f;m<h;m++)v[m]=-1;var g=0;v[0]=g;var y=d.offset,S=d.b,C=[0],_=function E3e(e){return new I3e(e)}(f);for(_.remove(0);C.length>0;){for(var x=C.pop(),D=v[x],w=y[x],A=y[x+1];w<A;w++){var E=S[w];_.has(E)&&(_.remove(E),C.push(E),v[E]=D)}0===C.length&&_.head>=0&&(C.push(_.head),v[_.head]=++g,_.remove(_.head))}return{componentCount:f,componentIndex:v}},e.areVertexSetsConnected=function l(d,f,p,m){if(Ye.areIntersecting(f,p))return!0;if(m<1)return!1;for(var h=new Set,v=0,g=f.length;v<g;++v)h.add(f[v]);return mZ(d,f,p,m,h)}}(fu||(fu={}));var _l,Do,VBe=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){if(!this.map.has(t.sourceData.kind))return!1;var r=this.applicable.get(t.sourceData.kind);return!r||r(t)},e}();function GBe(e,t,r,n){for(var a=new fu.EdgeBuilder(n,e,t),i=new Int32Array(a.slotCount),o=new Array(a.slotCount),s=new Array(a.slotCount),u=new Int8Array(a.slotCount),c=new Array(a.slotCount),l=new Array(a.slotCount),d=0,f=a.edgeCount;d<f;d++)a.addNextEdge(),a.assignProperty(i,r.key?r.key[d]:-1),a.assignDirectedProperty(o,r.operatorA?r.operatorA[d]:-1,s,r.operatorB?r.operatorB[d]:-1),a.assignProperty(u,r.order?r.order[d]:1),a.assignProperty(c,r.distance?r.distance[d]:-1),a.assignProperty(l,r.flag?r.flag[d]:1);return a.createGraph({key:i,operatorA:o,operatorB:s,order:u,distance:c,flag:l})}!function(e){e.create=function t(r,n){var a=r.name,i=new VBe;return{descriptor:r,formatRegistry:i,isApplicable:function(o){return i.isApplicable(o)},get:function(o){var s=n?.asDynamic?o._dynamicPropertyData:o._staticPropertyData;if(s[a])return s[a];if(!o.customProperties.has(r)){var u=i.get(o.sourceData.kind);if(u)return s[a]=u(o),o.customProperties.add(r),s[a]}},set:function(o,s){n?.asDynamic?o._dynamicPropertyData[a]=s:o._staticPropertyData[a]=s},delete:function(o){n?.asDynamic?delete o._dynamicPropertyData[a]:delete o._staticPropertyData[a]}}}}(_l||(_l={})),function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=_l.create(e.Descriptor,{asDynamic:!0}),e.DefaultProps={maxDistance:-1},e.fromData=function t(n,a){void 0===a&&(a={});var i=R(R({},e.DefaultProps),a),o=n.pairs,s=n.count;return{bonds:GBe(o.indexA.toArray(),o.indexB.toArray(),{key:o.key&&o.key.toArray(),operatorA:o.operatorA&&o.operatorA.toArray(),operatorB:o.operatorB&&o.operatorB.toArray(),order:o.order&&o.order.toArray(),distance:o.distance&&o.distance.toArray(),flag:o.flag&&o.flag.toArray()},s),maxDistance:i.maxDistance}},e.getEdgeIndexForOperators=function r(n,a,i,o,s){var u,c,l,d;a<i?(u=a,c=i,l=o,d=s):(u=i,c=a,l=s,d=o);for(var f=n.offset[u],p=n.offset[u+1];f<p;f++)if(n.b[f]===c&&n.edgeProps.operatorA[f]===l&&n.edgeProps.operatorB[f]===d)return f;return-1}}(Do||(Do={}));var KS,ZS,T4=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators||(this._operators=this.operatorsProvider()),this._operators},enumerable:!1,configurable:!0}),e}();!function(e){e.create=function t(r,n,a){return new e(r,n,a)}}(T4||(T4={})),function(e){e.Default={assemblies:[],spacegroup:au.ZeroP1,isNonStandardCrystalFrame:!1},e.findAssembly=function t(n,a){var i=a.toLocaleLowerCase(),o=Ja.Provider.get(n);return o?wO(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0},e.getUnitcellLabel=function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,c=i.anglesInRadians,l=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),p=Ru(c[0]).toFixed(2),m=Ru(c[1]).toFixed(2),h=Ru(c[2]).toFixed(2),v=[];return v.push("Unit Cell <b>".concat(o,"</b> #").concat(s)),v.push("".concat(l,"\xd7").concat(d,"\xd7").concat(f," \u212b")),v.push("\u03b1=".concat(p,"\xb0 \u03b2=").concat(m,"\xb0 \u03b3=").concat(h,"\xb0")),v.join(" | ")}}(KS||(KS={})),function(e){e.create=function t(r,n,a,i){return{id:kn.create22(),label:r,basic:n,sourceData:i,bonds:a}}}(ZS||(ZS={}));var QS,D4,at,Te,$i,Gt,zr,zBe={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},HBe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},jBe={A:"A",C:"C",G:"G",T:"T",U:"U"};function hZ(e){return zBe[e]||"X"}function vZ(e){return jBe[e]||"X"}function gZ(e){return HBe[e]||"X"}function ft(e,t){var r=t||{},n=r.description,i=r.isOptional,s=r.isRest,c=r.defaultValue;return{type:e,isOptional:void 0!==i&&i,isRest:void 0!==s&&s,defaultValue:void 0===c?void 0:c,description:void 0===n?void 0:n}}function $S(e,t,r,n){var a=function(i){return $i.Apply($i.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function yZ(e,t,r,n){var a=function(i){return $i.Apply($i.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id="".concat(e,".").concat(t),a.args=Gt.None,a.type=r,a}function FA(e){return"function"==typeof e&&!!e.info&&!!e.args&&"string"==typeof e.info.namespace&&!!e.type}function Kt(e,t,r){return $S("",e,t,r)}function bZ(e){xZ("","",e)}function SZ(e){var t=[];return _Z(e,t),t}function CZ(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)}).replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)})}function xZ(e,t,r){if(FA(r))return r.info.namespace=e,r.info.name=r.info.name||CZ(t),void(r.id="".concat(r.info.namespace,".").concat(r.info.name));for(var n="".concat(r["@namespace"]||CZ(t)),a=e?"".concat(e,".").concat(n):n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];"object"!=typeof r[s]&&!FA(r[s])||xZ(a,s,r[s])}}function _Z(e,t){if(FA(e))t.push(e);else for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];"object"!=typeof e[a]&&!FA(e[a])||_Z(e[a],t)}}function Fi(e,t){return Kt(Gt.Dictionary({0:ft(e)}),e,t)}function mm(e,t){return Kt(Gt.List(e,{nonEmpty:!0}),e,t)}function Pc(e,t,r){return Kt(Gt.Dictionary({0:ft(e),1:ft(e)}),t,r)}!function(e){var t,c;(c=t=e.Kind||(e.Kind={})).Protein="protein",c.RNA="RNA",c.DNA="DNA",c.Generic="generic",e.getSequenceString=function r(c){var l=c.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")},e.ofResidueNames=function i(c,l){if(0===l.rowCount)throw new Error("cannot be empty");var d=function n(c){for(var l=0,d=Math.min(c.rowCount,10);l<d;l++){var f=c.value(l)||"";if("X"!==hZ(f))return t.Protein;if("X"!==vZ(f))return t.RNA;if("X"!==gZ(f))return t.DNA}return t.Generic}(c);return new o(d,c,l)};var o=function(){function c(l,d,f){this.kind=l,this.microHet=new Map;for(var p=function a(c,l){var d;switch(c){case t.Protein:d=hZ;break;case t.DNA:d=gZ;break;case t.RNA:d=vZ;break;case t.Generic:d=function(){return"X"};break;default:Sn()}return l&&l.size>0?function(f){var p=d(f);return"X"===p&&l.has(f)?d(l.get(f)):p}:d}(l),m=[],h=[],v=[],g=new Map,y=0,S=new Map,C=0,_=f.rowCount;C<_;++C){var x=f.value(C);if(S.has(x))g.has(x)?g.get(x).push(d.value(C)):g.set(x,[h[S.get(x)],d.value(C)]);else{S.set(x,y);var D=d.value(C);h[y]=D,v[y]=x,m[y]=p(D),y+=1}}var w=[];for(C=0,_=y;C<_;++C){var A=g.get(v[C]);if(A){var E=A.map(function(F){var N=p(F);return"X"===N?F:N});w[C]="(".concat(E.join("|"),")")}else w[C]="X"===m[C]?h[C]:m[C]}this.length=y,this.code=ie.ofStringArray(m),this.compId=ie.ofStringArray(h),this.seqId=ie.ofIntArray(v),this.label=ie.ofStringArray(w),this.microHet=g,this.indexMap=S}return c.prototype.index=function(l){return this.indexMap.get(l)},c}();e.ofSequenceRanges=function s(c,l){return new u(t.Generic,c,l)};var u=function(){function c(l,d,f){this.kind=l,this.seqIdStart=d,this.seqIdEnd=f,this.microHet=new Map;for(var p=0,m=Number.MAX_SAFE_INTEGER,h=0,v=this.seqIdStart.rowCount;h<v;h++){var g=this.seqIdStart.value(h),y=this.seqIdEnd.value(h);g<m&&(m=g),p<y&&(p=y)}var S=p-m+1;this.code=ie.ofConst("X",S,ie.Schema.str),this.label=ie.ofConst("",S,ie.Schema.str),this.seqId=ie.ofLambda({value:function(C){return C+m+1},rowCount:S,schema:ie.Schema.int}),this.compId=ie.ofConst("",S,ie.Schema.str),this.length=S,this.minSeqId=m}return c.prototype.index=function(l){return l-this.minSeqId},c}()}(QS||(QS={})),function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var c=[],l={},d=0,f=s.length;d<f;++d)c.push.apply(c,s[d].sequences),Object.assign(l,s[d].byEntityKey);return{sequences:c,byEntityKey:l}}function a(s,u){var c=u.atoms.label_comp_id,l=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,m=d.offsets,h={},v=[];if(1===d.count&&0===m[0]&&0===m[1])return{byEntityKey:h,sequences:v};for(var g=0,y=u.chains._rowCount;g<y;g++){var S=u.index.getEntityFromChain(g);if(void 0===h[S]&&"polymer"===s.data.type.value(S)){var C=g;for(g++;g<y&&S===u.index.getEntityFromChain(g)&&"polymer"!==s.data.type.value(S);)g++;g--;for(var _=f.index[m[C]],x=f.index[m[g+1]-1]+1,D=ie.window(l,_,x),w=[],A=_;A<x;++A)w.push(c.value(f.offsets[A]));var E=ie.ofStringArray(w);h[S]={entityId:s.data.id.value(S),sequence:QS.ofResidueNames(E,D)},v.push(h[S])}}return{byEntityKey:h,sequences:v}}function i(s,u){return r(o(s,u.spheres),o(s,u.gaussians))}function o(s,u){var c=u.chainElementSegments,l=u.seq_id_begin,d=u.seq_id_end,f=c.count,p=c.offsets,m={},h=[];if(1===f&&0===p[0]&&0===p[1])return{byEntityKey:m,sequences:h};for(var v=0,g=f;v<g;v++){var y=u.getEntityFromChain(v);if(void 0===m[y]){var S=v;for(v++;v<g&&y===u.getEntityFromChain(v);)v++;v--;var C=p[S],_=p[v+1]-1,x=ie.window(l,C,_),D=ie.window(d,C,_);m[y]={entityId:s.data.id.value(y),sequence:QS.ofSequenceRanges(x,D)},h.push(m[y])}}return{byEntityKey:m,sequences:h}}e.fromHierarchy=function n(s,u,c){return r(a(s,u),c.isDefined?i(s,c):t)},e.fromAtomicHierarchy=a,e.fromCoarseHierarchy=i,e.fromCoarseElements=o}(D4||(D4={})),function(e){function t(p,m,h){return{kind:"element-location",structure:p,unit:m,element:h||0}}e.create=t,e.clone=function r(p){return t(p.structure,p.unit,p.element)},e.set=function n(p,m,h,v){return m&&(p.structure=m),h&&(p.unit=h),void 0!==v&&(p.element=v),p},e.copy=function a(p,m){return p.unit=m.unit,p.element=m.element,p},e.is=function i(p){return!!p&&"element-location"===p.kind},e.areEqual=function o(p,m){return p.unit===m.unit&&p.element===m.element};var s=b(),u=b();e.distance=function c(p,m){return p.unit.conformation.position(p.element,s),m.unit.conformation.position(m.element,u),b.distance(s,u)},e.position=function l(p,m){return m.unit.conformation.position(m.element,p)},e.residueIndex=function d(p){return p.unit.model.atomicHierarchy.residueAtomSegments.index[p.element]},e.chainIndex=function f(p){return p.unit.model.atomicHierarchy.chainAtomSegments.index[p.element]}}(at||(at={})),function(e){function r(s,u,c){return{kind:"value",namespace:s,name:u,parent:c}}function i(s,u,c,l){for(var d=Object.create(null),f=0,p=l;f<p.length;f++)d[p[f]]=!0;return{kind:"oneof",namespace:s,name:u,type:c,values:d}}e.Variable=function t(s,u,c){return{kind:"variable",name:s,type:u,isConstraint:c}},e.Value=r,e.Container=function n(s,u,c,l){return{kind:"container",namespace:s,name:u,child:c,alias:l}},e.Union=function a(s){return{kind:"union",types:s}},e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]),e.oneOfValues=function o(s){return Object.keys(s.values).sort()}}(Te||(Te={})),function(e){function o(u){return!!u&&!!u.head&&"object"==typeof u}function s(u){return!!u&&"string"==typeof u.name}e.Symbol=function t(u){return{name:u}},e.Apply=function r(u,c){return c?{head:u,args:c}:{head:u}},e.isArgumentsArray=function n(u){return!!u&&Array.isArray(u)},e.isArgumentsMap=function a(u){return!!u&&!Array.isArray(u)},e.isLiteral=function i(u){return!o(u)&&!s(u)},e.isApply=o,e.isSymbol=s}($i||($i={})),function(e){function t(n){return{kind:"dictionary",map:n,"@type":0}}e.None=t({}),e.Dictionary=t,e.List=function r(n,a){var i=(a||{}).nonEmpty;return{kind:"list",type:n,nonEmpty:void 0!==i&&i,"@type":0}}}(Gt||(Gt={})),function(e){e.AnyVar=Te.Variable("a",Te.Any),e.AnyValueVar=Te.Variable("a",Te.Any),e.ConstrainedVar=Te.Variable("a",Te.Any,!0),e.Regex=Te.Value("Core","Regex"),e.Set=function(t){return Te.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return Te.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return Te.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return Te.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(Te.Num,"BitFlags")}(zr||(zr={})),Gt.Dictionary({0:ft(Te.Num),1:ft(Te.Num)});var E4={"@header":"Language Primitives",type:{"@header":"Types",bool:Kt(Gt.Dictionary({0:ft(Te.AnyValue)}),Te.Bool,"Convert a value to boolean."),num:Kt(Gt.Dictionary({0:ft(Te.AnyValue)}),Te.Num,"Convert a value to number."),str:Kt(Gt.Dictionary({0:ft(Te.AnyValue)}),Te.Str,"Convert a value to string."),regex:Kt(Gt.Dictionary({0:ft(Te.Str,{description:"Expression"}),1:ft(Te.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),zr.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Kt(Gt.List(zr.AnyVar),zr.List()),set:Kt(Gt.List(zr.AnyValueVar),zr.Set()),bitflags:Kt(Gt.Dictionary({0:ft(Te.Num)}),zr.BitFlags,"Interpret a number as bitflags."),compositeKey:Kt(Gt.List(Te.AnyValue),Te.AnyValue)},logic:{"@header":"Logic",not:Fi(Te.Bool),and:mm(Te.Bool),or:mm(Te.Bool)},ctrl:{"@header":"Control",eval:Kt(Gt.Dictionary({0:ft(zr.Fn(zr.AnyVar))}),zr.AnyVar,"Evaluate a function."),fn:Kt(Gt.Dictionary({0:ft(zr.AnyVar)}),zr.Fn(zr.AnyVar),'Wrap an expression to a "lazy" function.'),if:Kt(Gt.Dictionary({0:ft(Te.Bool,{description:"Condition"}),1:ft(Te.Variable("a",Te.Any),{description:"If true"}),2:ft(Te.Variable("b",Te.Any),{description:"If false"})}),Te.Union([Te.Variable("a",Te.Any),Te.Variable("b",Te.Any)])),assoc:Kt(Gt.Dictionary({0:ft(Te.Str,{description:"Name"}),1:ft(Te.Variable("a",Te.Any),{description:"Value to assign"})}),Te.Variable("a",Te.Any))},rel:{"@header":"Relational",eq:Pc(Te.Variable("a",Te.AnyValue,!0),Te.Bool),neq:Pc(Te.Variable("a",Te.AnyValue,!0),Te.Bool),lt:Pc(Te.Num,Te.Bool),lte:Pc(Te.Num,Te.Bool),gr:Pc(Te.Num,Te.Bool),gre:Pc(Te.Num,Te.Bool),inRange:Kt(Gt.Dictionary({0:ft(Te.Num,{description:"Value to test"}),1:ft(Te.Num,{description:"Minimum value"}),2:ft(Te.Num,{description:"Maximum value"})}),Te.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},math:{"@header":"Math",add:mm(Te.Num),sub:mm(Te.Num),mult:mm(Te.Num),div:Pc(Te.Num,Te.Num),pow:Pc(Te.Num,Te.Num),mod:Pc(Te.Num,Te.Num),min:mm(Te.Num),max:mm(Te.Num),cantorPairing:Pc(Te.Num,Te.Num),sortedCantorPairing:Pc(Te.Num,Te.Num),invertCantorPairing:Kt(Gt.Dictionary({0:ft(Te.Num)}),zr.List(Te.Num)),floor:Fi(Te.Num),ceil:Fi(Te.Num),roundInt:Fi(Te.Num),trunc:Fi(Te.Num),abs:Fi(Te.Num),sign:Fi(Te.Num),sqrt:Fi(Te.Num),cbrt:Fi(Te.Num),sin:Fi(Te.Num),cos:Fi(Te.Num),tan:Fi(Te.Num),asin:Fi(Te.Num),acos:Fi(Te.Num),atan:Fi(Te.Num),sinh:Fi(Te.Num),cosh:Fi(Te.Num),tanh:Fi(Te.Num),exp:Fi(Te.Num),log:Fi(Te.Num),log10:Fi(Te.Num),atan2:Pc(Te.Num,Te.Num)},str:{"@header":"Strings",concat:mm(Te.Str),match:Kt(Gt.Dictionary({0:ft(zr.Regex),1:ft(Te.Str)}),Te.Bool)},list:{"@header":"Lists",getAt:Kt(Gt.Dictionary({0:ft(zr.List()),1:ft(Te.Num)}),zr.AnyVar),equal:Kt(Gt.Dictionary({0:ft(zr.List()),1:ft(zr.List())}),Te.Bool)},set:{"@header":"Sets",has:Kt(Gt.Dictionary({0:ft(zr.Set(zr.ConstrainedVar)),1:ft(zr.ConstrainedVar)}),Te.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Kt(Gt.Dictionary({0:ft(zr.Set(zr.ConstrainedVar)),1:ft(zr.Set(zr.ConstrainedVar))}),Te.Bool,"Check if the the 1st argument is a subset of the 2nd.")},flags:{"@header":"Flags",hasAny:Kt(Gt.Dictionary({0:ft(zr.Flags(zr.ConstrainedVar)),1:ft(zr.Flags(zr.ConstrainedVar))}),Te.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Kt(Gt.Dictionary({0:ft(zr.Flags(zr.ConstrainedVar)),1:ft(zr.Flags(zr.ConstrainedVar))}),Te.Bool,"Check if the the 1st argument has all 2nd one's flags.")}};bZ(E4);var Tt,eNe=SZ(E4);function Nr(e,t){return Kt(Gt.Dictionary({0:ft(Tt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function ty(e,t){return Kt(Gt.None,e,t)}!function(){for(var e=Object.create(null),t=0,r=eNe;t<r.length;t++){var n=r[t];e[n.id]=n}}(),function(e){e.ElementSymbol=Te.Value("Structure","ElementSymbol"),e.AtomName=Te.Value("Structure","AtomName"),e.BondFlag=Te.OneOf("Structure","BondFlag",Te.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=zr.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=Te.OneOf("Structure","SecondaryStructureFlag",Te.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=zr.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=Te.Value("Structure","RingFingerprint"),e.EntityType=Te.OneOf("Structure","EntityType",Te.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=Te.OneOf("Structure","EntitySubtype",Te.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=Te.OneOf("Structure","ObjectPrimitive",Te.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=Te.Value("Structure","ResidueId"),e.ElementSet=Te.Value("Structure","ElementSet"),e.ElementSelection=Te.Value("Structure","ElementSelection"),e.ElementReference=Te.Value("Structure","ElementReference"),e.ElementSelectionQuery=zr.Fn(e.ElementSelection,"ElementSelectionQuery")}(Tt||(Tt={}));var Se={core:E4,structureQuery:{"@header":"Structure Queries",type:{"@header":"Types",elementSymbol:Kt(Gt.Dictionary({0:ft(Te.Str)}),Tt.ElementSymbol,"Create element symbol representation from a string value."),atomName:Kt(Gt.Dictionary({0:ft(Te.AnyValue)}),Tt.AtomName,"Convert a value to an atom name."),entityType:Kt(Gt.Dictionary({0:ft(Tt.EntityType)}),Tt.EntityType,"Create normalized representation of entity type: ".concat(Te.oneOfValues(Tt.EntityType).join(", "),".")),bondFlags:Kt(Gt.List(Tt.BondFlag),Tt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: ".concat(Te.oneOfValues(Tt.BondFlag).join(", "),".")),ringFingerprint:Kt(Gt.List(Tt.ElementSymbol,{nonEmpty:!0}),Tt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Kt(Gt.List(Tt.SecondaryStructureFlag),Tt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: ".concat(Te.oneOfValues(Tt.SecondaryStructureFlag).join(", "),".")),authResidueId:Kt(Gt.Dictionary({0:ft(Te.Str,{description:"auth_asym_id"}),1:ft(Te.Num,{description:"auth_seq_id"}),2:ft(Te.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Tt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Kt(Gt.Dictionary({0:ft(Te.Str,{description:"label_entity_id"}),1:ft(Te.Str,{description:"label_asym_id"}),2:ft(Te.Num,{description:"label_seq_id"}),3:ft(Te.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Tt.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')},slot:{"@header":"Iteration Slots",element:Kt(Gt.None,Tt.ElementReference,"A reference to the current element."),elementSetReduce:Kt(Gt.None,Te.Variable("a",Te.AnyValue,!0),"Current value of the element set reducer.")},generator:{"@header":"Generators",all:Kt(Gt.None,Tt.ElementSelectionQuery,"The entire structure."),atomGroups:Kt(Gt.Dictionary({"entity-test":ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":ft(Te.Bool,{isOptional:!0,defaultValue:!0}),"group-by":ft(Te.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Tt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Kt(Gt.Dictionary({0:ft(Te.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Tt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Kt(Gt.Dictionary({fingerprint:ft(Tt.RingFingerprint,{isOptional:!0}),"only-aromatic":ft(Te.Bool,{isOptional:!0,defaultValue:!1})}),Tt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),query:ft(Tt.ElementSelectionQuery),"in-complement":ft(Te.Bool,{isOptional:!0,defaultValue:!1})}),Tt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Kt(Gt.None,Tt.ElementSelectionQuery,"Nada.")},modifier:{"@header":"Selection Modifications",queryEach:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),query:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),by:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),by:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),by:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),"min-distance":ft(Te.Num,{isOptional:!0,defaultValue:0}),"max-distance":ft(Te.Num),"min-size":ft(Te.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":ft(Te.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Tt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),radius:ft(Te.Num),"atom-radius":ft(Te.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":ft(Te.Bool,{isOptional:!0})}),Tt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),radius:ft(Te.Num),"include-water":ft(Te.Bool,{isOptional:!0,defaultValue:!0})}),Tt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),"bond-test":ft(Te.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":ft(Te.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":ft(Te.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":ft(Te.Bool,{isOptional:!0})}),Tt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),property:ft(Te.AnyValue)}),Tt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},filter:{"@header":"Selection Filters",pick:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),test:ft(Te.Bool)}),Tt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),source:ft(Tt.ElementSelectionQuery),property:ft(Te.Any)}),Tt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),by:ft(Tt.ElementSelectionQuery)}),Tt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),target:ft(Tt.ElementSelectionQuery),"min-radius":ft(Te.Num,{isOptional:!0,defaultValue:0}),"max-radius":ft(Te.Num),"atom-radius":ft(Te.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:ft(Te.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Tt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery),target:ft(Tt.ElementSelectionQuery),"bond-test":ft(Te.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:ft(Te.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Tt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},combinator:{"@header":"Selection Combinators",intersect:Kt(Gt.List(Tt.ElementSelectionQuery),Tt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Kt(Gt.List(Tt.ElementSelectionQuery),Tt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Kt(Gt.Dictionary({matrix:ft(zr.List(zr.List(Te.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:ft(zr.List(Tt.ElementSelectionQuery),{description:"A list of held selections."})}),Tt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},atomSet:{"@header":"Atom Sets",atomCount:Kt(Gt.None,Te.Num),countQuery:Kt(Gt.Dictionary({0:ft(Tt.ElementSelectionQuery)}),Te.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Kt(Gt.Dictionary({initial:ft(Te.Variable("a",Te.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:ft(Te.Variable("a",Te.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),Te.Variable("a",Te.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Kt(Gt.Dictionary({0:ft(zr.ConstrainedVar)}),zr.Set(zr.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},atomProperty:{"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Nr(Tt.ElementSymbol),vdw:Nr(Te.Num,"Van der Waals radius"),mass:Nr(Te.Num,"Atomic weight"),atomicNumber:Nr(Te.Num,"Atomic number"),x:Nr(Te.Num,"Cartesian X coordinate"),y:Nr(Te.Num,"Cartesian Y coordinate"),z:Nr(Te.Num,"Cartesian Z coordinate"),atomKey:Nr(Te.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Kt(Gt.Dictionary({0:ft(Tt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:ft(Tt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),Te.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Nr(Te.Num,"Index of the atom/element in the input file."),operatorName:Nr(Te.Str,"Name of the symmetry operator applied to this element."),operatorKey:Nr(Te.Num,"Key of the symmetry operator applied to this element."),modelIndex:Nr(Te.Num,"Index of the model in the input file."),modelLabel:Nr(Te.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Nr(Te.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Nr(Tt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Nr(Tt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Nr(Te.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Nr(Te.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Nr(Te.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Nr(Te.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Nr(Te.Num,"_atom_site.id"),label_atom_id:Nr(Tt.AtomName),label_alt_id:Nr(Te.Str),label_comp_id:Nr(Te.Str),label_asym_id:Nr(Te.Str),label_entity_id:Nr(Te.Str),label_seq_id:Nr(Te.Num),auth_atom_id:Nr(Tt.AtomName),auth_comp_id:Nr(Te.Str),auth_asym_id:Nr(Te.Str),auth_seq_id:Nr(Te.Num),pdbx_PDB_ins_code:Nr(Te.Str),pdbx_formal_charge:Nr(Te.Num),occupancy:Nr(Te.Num),B_iso_or_equiv:Nr(Te.Num),entityType:Nr(Tt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Nr(Tt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Nr(Te.Str,"The PRD ID of the entity."),entityDescription:Nr(zr.List(Te.Str)),objectPrimitive:Nr(Tt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Nr(Te.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Nr(Tt.SecondaryStructureFlags),isModified:Nr(Te.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Nr(Te.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Nr(Te.Bool,"True if this is a non-standard residue."),chemCompType:Nr(Te.Str,"Type of the chemical component as defined in mmCIF.")}},bondProperty:{"@header":"Bond Properties",flags:ty(Tt.BondFlags),order:ty(Te.Num),key:ty(Te.Num),length:ty(Te.Num),atomA:ty(Tt.ElementReference),atomB:ty(Tt.ElementReference)}},internal:{"@header":"Internal Queries",generator:{"@header":"Generators",bundleElement:Kt(Gt.Dictionary({groupedUnits:ft(Te.Any),set:ft(Te.Any),ranges:ft(Te.Any)}),Te.Any),bundle:Kt(Gt.Dictionary({elements:ft(Te.Any)}),Tt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Kt(Gt.None,Tt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")}}};bZ(Se);var fe,pNe=SZ(Se);!function(){for(var e=Object.create(null),t=0,r=pNe;t<r.length;t++){var n=r[t];e[n.id]=n}}(),function(e){e.core=Se.core,e.struct=Se.structureQuery,e.internal=Se.internal,e.atomName=function t(y){return e.struct.type.atomName([y])},e.es=function r(y){return e.struct.type.elementSymbol([y])},e.list=function n(){for(var y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];return e.core.type.list(y)},e.set=function a(){for(var y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];return e.core.type.set(y)},e.re=function i(y,S){return e.core.type.regex([y,S])},e.fn=function o(y){return e.core.ctrl.fn([y])},e.evaluate=function s(y){return e.core.ctrl.eval([y])};var u=e.struct.atomProperty.core,c=e.struct.atomProperty.macromolecular,l=e.struct.atomProperty.topology;function d(y){return u[y]()}function f(y){return l[y]()}function p(y){return c[y]()}e.acp=d,e.atp=f,e.ammp=p;var m=e.struct.atomSet.propertySet;e.acpSet=function h(y){return m([d(y)])},e.atpSet=function v(y){return m([f(y)])},e.ammpSet=function g(y){return m([p(y)])}}(fe||(fe={}));var Jh=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(c){var l=s.unitA,d=s.unitB,f=e.getEdgeKey(u,l,c.indexB,d);a.set(f,n.length);var p=e.getVertexKey(u,l),m=i.get(p);void 0===m?i.set(p,[n.length]):m.push(n.length),n.push(R(R({},c),{indexA:u,unitA:l,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):wZ},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return void 0!==o?o:-1},e.prototype.hasEdge=function(t,r,n,a){return-1!==this.getEdgeIndex(t,r,n,a)},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return-1!==i?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();!function(e){var t=function(){function o(s,u,c,l,d){this.unitA=s,this.unitB=u,this.edgeCount=c,this.connectedIndices=l,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):wZ},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}e.UnitPairEdges=t,e.getEdgeKey=function r(o,s,u,c){return"".concat(o,"|").concat(s,"|").concat(u,"|").concat(c)},e.getVertexKey=function n(o,s){return"".concat(o,"|").concat(s)};var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=En.create(),this.linkedB=En.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){0!==this.linkCount&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,c){a(this.mapAB,s,{indexB:u,props:c}),a(this.mapBA,u,{indexB:s,props:c}),En.add(this.linkedA,s,s),En.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i}(Jh||(Jh={}));var I4,wZ=[];!function(e){e.Empty=fu.create([],[],[],0,{flags:[],order:[],key:[]})}(I4||(I4={}));var JS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t.prototype.getBondFromLocation=function(r){return Fe.isAtomic(r.aUnit)&&Fe.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return Fe.isAtomic(r.aUnit)&&Fe.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(Jh);!function(e){var t=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return jt(n,r),n}(Jh.UnitPairEdges);e.UnitPairBonds=t}(JS||(JS={}));var AZ={forceCompute:!1,noCompute:!1,maxRadius:4},P4={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},hNe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},vNe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},TZ=2.001,e2=function(){for(var t=new Set,r=0,n=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"];r<n.length;r++)t.add(P4[n[r]]);return t}();function _d(e){var t=P4[e];return void 0===t?-1:t}function hm(e){if(e<0)return TZ;var t=hNe[e];return void 0===t?TZ:t}function BA(e,t,r,n){var a=function yNe(e,t){if(e<0||t<0)return-1;var r=vNe[function gNe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}(e,t)];return void 0===r?-1:r}(e,t);return a>0?a:t<0?r:(r+n)/1.95}var bNe=P4.H;function $f(e){return e===bNe}var SNe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function CNe(e,t,r){var n;return t=(n=t<r?[t,r]:[r,t])[0],r=n[1],qS.has(e)&&"C"===t&&"O"===r||MA.has(e)&&"OP1"===t&&"P"===r?2:SNe.get("".concat(e,"|").concat(t,"|").concat(r))||1}var M4,Wu,R4,xNe=new Map([["LYS|NZ|RET|C15",2]]);function DZ(e,t,r,n){var a,i;return e>r&&(e=(a=[r,e])[0],r=a[1],t=(i=[n,t])[0],n=i[1]),xNe.get("".concat(e,"|").concat(t,"|").concat(r,"|").concat(n))||1}function O4(e){return function(t,r){return r[e].value(t)}}function _Ne(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function F4(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,or([a[e].value(n)],t,!1))}}function t2(e){return function(t,r){return r[e].valueKind(t)}}function wNe(e,t){var r=[],a=t2(e);if(1===t.rank)for(var i=t.dimensions[0],o=0;o<i;o++){var s="".concat(e,"[").concat(o+1,"]");r.push({name:s,type:2,value:F4(e,o),valueKind:a})}else if(2===t.rank){i=t.dimensions[0];var u=t.dimensions[1];for(o=0;o<i;o++)for(var c=0;c<u;c++){var l="".concat(e,"[").concat(o+1,"][").concat(c+1,"]");r.push({name:l,type:2,value:F4(e,o,c),valueKind:a})}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");var d=t.dimensions[0],f=t.dimensions[1],p=t.dimensions[2];for(o=0;o<d;o++)for(c=0;c<f;c++)for(var m=0;m<p;m++){var h="".concat(e,"[").concat(o+1,"][").concat(c+1,"][").concat(m+1,"]");r.push({name:h,type:2,value:F4(e,o,c,m),valueKind:a})}}return r}function EZ(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];"int"===i.valueType?t.push({name:a,type:1,value:O4(a),valueKind:t2(a)}):"float"===i.valueType?t.push({name:a,type:2,value:O4(a),valueKind:t2(a)}):"str"===i.valueType?t.push({name:a,type:0,value:O4(a),valueKind:t2(a)}):"list"===i.valueType?t.push({name:a,type:0,value:_Ne(a),valueKind:t2(a)}):"tensor"===i.valueType?t.push.apply(t,wNe(a,i.space)):Sn()}return t}function ANe(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function B4(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function IZ(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});return n.length?{instance:r,rowCount:n.reduce(function(o,s){return o+s.rowCount},0),source:n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():nA.Range(0,o.rowCount-1)},rowCount:o.rowCount}})}:{instance:r,rowCount:0,source:[]}}!function(e){function r(s,u,c){return{name:s,type:1,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}e.str=function t(s,u,c){return{name:s,type:0,value:u,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}},e.int=r,e.float=function n(s,u,c){return{name:s,type:2,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount<"u"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}},e.index=function a(s){return r(s,function(u,c,l){return l+1},{typedArray:Int32Array,encoder:Fr.by(Fr.delta).and(Fr.runLength).and(Fr.integerPacking)})};var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,c,l){return this.fields.push(e.str(u,c,l)),this},s.prototype.int=function(u,c,l){return this.fields.push(e.int(u,c,l)),this},s.prototype.vec=function(u,c,l){for(var d=0;d<c.length;d++)this.fields.push(e.int("".concat(u,"[").concat(d+1,"]"),c[d],l));return this},s.prototype.float=function(u,c,l){return this.fields.push(e.float(u,c,l)),this},s.prototype.many=function(u){for(var c=0;c<u.length;c++)this.fields.push(u[c]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i,e.build=function o(){return new i}}(M4||(M4={})),function(e){e.Empty={fields:[],source:[]},e.filterOf=function t(n){for(var a=[],i=[],o=[],s=[],u=0,c=n.split(/[\r\n]+/);u<c.length;u++){var l=c[u];if(0!==(l=l.trim()).length){var d=/^!/.test(l);d&&(l=l.substr(1));var f=l.split(/\./),p=f[1],m=d?p?s:i:p?o:a;m[m.length]=l,p&&!a.includes(f[0])&&(a[a.length]=f[0])}}var h=o.map(function(v){return v.split(".")[0]});return{includeCategory:function(v){return!i.includes(v)&&(a.length<=0||-1!==a.indexOf(v))},includeField:function(v,g){var y=v+"."+g;return!s.includes(y)&&(!h.includes(v)||o.includes(y))}}},e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}},e.ofTable=function r(n,a){return a?{fields:EZ(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return nA.Array(a)}}]}:{fields:EZ(n._schema),source:[{data:n,rowCount:n._rowCount}]}}}(Wu||(Wu={})),function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(l){n.writeCategory({name:l,instance:function(){return Wu.ofTable(i[l])}})},s=0,u=i._tableNames;s<u.length;s++)o(u[s])}e.writeDatabase=t,e.writeDatabaseCollection=function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}}(R4||(R4={}));var TNe=function(){function e(){this.builder=tn.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=Wu.DefaultFilter,this.formatter=Wu.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||Wu.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||Wu.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,tn.write(this.builder,"data_".concat((t||"").replace(/[ \n\t]/g,"").toUpperCase(),"\n#\n"))},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(n?.ignoreFilter||this.filter.includeCategory(t.name)){var a=IZ(t,r),i=a.instance,o=a.rowCount,s=a.source;o&&(1===o?function DNe(e,t,r,n,a,i){var o=B4(t),s=r[0],u=s.data,c=o.reduce(function(v,g){return a.includeField(e.name,g.name)?Math.max(v,g.name.length):0},0);if(0!==c){c+=e.name.length+6;for(var d=s.keys().move(),f=MZ(e.name,t.fields,i),p=0;p<o.length;p++){var m=o[p];a.includeField(e.name,m.name)&&(tn.writePadRight(n,"_".concat(e.name,".").concat(m.name),c),PZ(n,u,d,m,f[p],0)||tn.newline(n))}tn.write(n,"#\n")}}(t,i,s,this.builder,this.filter,this.formatter):function ENe(e,t,r,n,a,i){var o=B4(t),s=a===Wu.DefaultFilter?o:o.filter(function(S){return a.includeField(e.name,S.name)}),u=s.length;if(0!==u){var c=MZ(e.name,s,i);RZ(n,"loop_");for(var l=0;l<u;l++)RZ(n,"_".concat(e.name,".").concat(s[l].name));for(var d=0,f=0;f<r.length;f++){var p=r[f],m=p.data;if(0!==p.rowCount)for(var h=p.keys();h.hasNext;){for(var v=h.move(),g=!1,y=0;y<u;y++)g=PZ(n,m,v,s[y],c[y],d);g||tn.newline(n),d++}}tn.write(n,"#\n")}}(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=tn.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return tn.getSize(this.builder)},e.prototype.getData=function(){return tn.getString(this.builder)},e}();function PZ(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(0!==s)1===s?function RNe(e){tn.writeSafe(e,". ")}(e):function ONe(e){tn.writeSafe(e,"? ")}(e);else{var u=n.value(r,t,i),c=n.type;if(0===c)return function INe(e){return"string"==typeof e&&e.indexOf("\n")>=0}(u)?(NA(e,u),!0):function FNe(e,t){if(!t)return tn.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++)switch(t.charCodeAt(s)){case 9:case 32:n=!0;break;case 10:return NA(e,t),!0;case 34:if(s&&s===u)break;if(i)return NA(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return NA(e,t),!0;i=!0,n=!0,a=1}return!n&&(35===r||36===r||59===r||91===r||93===r||95===r)&&(n=!0),n?(tn.writeSafe(e,a?'"':"'"),tn.writeSafe(e,t),tn.writeSafe(e,a?'" ':"' ")):(tn.writeSafe(e,t),tn.writeSafe(e," ")),!1}(e,u);1===c?function PNe(e,t){tn.writeInteger(e,t),tn.whitespace1(e)}(e,u):function MNe(e,t,r){tn.writeFloat(e,t,r),tn.whitespace1(e)}(e,u,a)}return!1}function MZ(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);n[n.length]=s&&typeof s.digitCount<"u"?2===o.type?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:2===o.type?Math.pow(10,ANe(o)):0}return n}function RZ(e,t){tn.write(e,t),tn.newline(e)}function NA(e,t){tn.writeSafe(e,"\n;"+t),tn.writeSafe(e,"\n;\n")}function BNe(e){var t=new ArrayBuffer(kA(e)),r=new DataView(t),n=new Uint8Array(t);return LA(e,r,n,0),n}function kA(e){var t=typeof e;if("string"===t){var r=xw(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null==e)return 1;if("object"===t){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=kA(e[o])}else{var s=Object.keys(e);for(a=s.length,o=0;o<a;o++){var u=s[o];i+=kA(u)+kA(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function LA(e,t,r,n){var a=typeof e;if("string"===a){var i=xw(e);if(i<32)return t.setUint8(n,160|i),I0(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),I0(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),I0(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),I0(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if("number"===a){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null==e)return t.setUint8(n,192),1;if("boolean"===a)return t.setUint8(n,e?195:194),1;if("object"===a){var u,c=0,l=Array.isArray(e),d=void 0;if((u=l?e.length:(d=Object.keys(e)).length)<16?(t.setUint8(n,u|(l?144:128)),c=1):u<65536?(t.setUint8(n,l?220:222),t.setUint16(n+1,u),c=3):u<4294967296&&(t.setUint8(n,l?221:223),t.setUint32(n+1,u),c=5),l)for(var f=0;f<u;f++)c+=LA(e[f],t,r,n+c);else{f=0;for(var p=d.length;f<p;f++){var m=d[f];c+=LA(m,t,r,n+c),c+=LA(e[m],t,r,n+c)}}return c}throw new Error("Unknown type "+a)}var Pa,ev,Yu,NNe=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=Wu.DefaultFilter,this.formatter=Wu.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:"0.3.0",dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||Wu.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||Wu.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(n?.ignoreFilter||this.filter.includeCategory(t.name)){var a=IZ(t,r),o=a.rowCount,s=a.source;if(o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=0,d=B4(a.instance);l<d.length;l++){var f=d[l];if(this.filter.includeField(t.name,f.name)){var p=this.formatter.getFormat(t.name,f.name);u.columns.push(GNe(t.name,f,s,o,p,this.binaryEncodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=BNe(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function GNe(e,t,r,n,a,i,o){var s=function zNe(e,t,r,n){for(var a=0===e.type,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,c=!0,l=0,d=0;d<n.length;d++)for(var f=n[d].data,p=n[d].keys();p.hasNext;){var m=p.move(),h=s?s(m,f):0;if(0!==h)o[l]=h,a&&(i[l]=""),c=!1;else{var v=u(m,f,l);"string"!=typeof v||v?o[l]=0:(o[l]=1,c=!1),i[l]=v}l++}return{array:i,allPresent:c,mask:o}}(t,function kNe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:0===e.type?Array:1===e.type?Int32Array:Float64Array}(t,a),n,r),u=s.array,c=s.allPresent,l=s.mask,d=function UNe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}(e,t,a,i);d||(d=o?function VNe(e,t){return 0===e?tm.by(Fr.stringArray):1===e?fF(t):function aDe(e){return pF.classify(e)}(t)}(t.type,u):function LNe(e){return tm.by(0===e?Fr.stringArray:Fr.byteArray)}(t.type));var f=d.encode(u),p=void 0;if(!c){var m=tm.by(Fr.runLength).and(Fr.byteArray).encode(l);p=m.data.length<l.length?m:tm.by(Fr.byteArray).encode(l)}return{name:t.name,data:f,mask:p}}!function(e){e.Encoder=R4,e.Category=Wu,e.Field=M4,e.Encoding=Fr,e.createEncoder=function t(u){var c=u||{},l=c.binary,f=c.encoderName;return void 0!==l&&l?new NNe(void 0===f?"mol*":f,u?u.binaryEncodingPovider:void 0,!!u&&!!u.binaryAutoClassifyEncoding):new TNe},e.fields=function r(){return e.Field.build()};var n=e.Encoding;function s(u){var c=u.precision;if(void 0!==c){var l=Math.pow(10,c),d=n.by(n.fixedPoint(l));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)},e.categoryInstance=function a(u,c){return{fields:u,source:[c]}},e.createEncodingProviderFromCifFrame=function i(u){return{get:function(c,l){var d=u.categories[c];if(d){var f=d.getField(l);return f&&f.binaryEncoding?tm.fromEncoding(f.binaryEncoding):void 0}}}},e.createEncodingProviderFromJsonConfig=function o(u){return{get:function(c,l){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===c&&f.columnName===l)return s(f)}}}}}(Pa||(Pa={})),function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return Pa.Category.Empty;var o=i.data;if(!o)return Pa.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,c=o._rowCount,l=[],d=0;d<c;d++)s.has(u.value(d))&&(l[l.length]=d);return Pa.Category.ofTable(o,l)}}]}},e.Provider=_l.create(e.Descriptor),e.chemCompBondFromTable=function t(a,i){return Xr.pick(i,Br.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})},e.getEntriesFromChemCompBond=function r(a){var i=new Map;function o(w){if(i.has(w))return i.get(w);var A=new n(w);return i.set(w,A),A}for(var s=a.comp_id,u=a.atom_id_1,c=a.atom_id_2,l=a.value_order,d=a.pdbx_aromatic_flag,f=a._rowCount,p=a.pdbx_ordinal,m=o(s.value(0)),h=0;h<f;h++){var v=s.value(h),g=u.value(h),y=c.value(h),S=l.value(h),C="y"===d.value(h),_=p.value(h);m.id!==v&&(m=o(v));var x=1,D=1;switch(C&&(x|=16),S.toLowerCase()){case"delo":x|=16;break;case"doub":D=2;break;case"trip":D=3;break;case"quad":D=4}m.add(g,y,D,x,_)}return i};var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,c,l){void 0===l&&(l=!0);var d=this.map.get(i);if(void 0!==d)void 0===d.get(o)&&d.set(o,{order:s,flags:u,key:c});else{var p=new Map;p.set(o,{order:s,flags:u,key:c}),this.map.set(i,p)}l&&this.add(o,i,s,u,c,!1)},a}();e.Entry=n}(ev||(ev={})),function(e){function r(i,o){for(var s=i.units,u=0,c=s.length;u<c;u++)if(Ye.indexOf(s[u].elements,o)>=0)return!0;return!1}e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||0===o.entries.length)return Pa.Category.Empty;for(var s=i.structures[0],u=[],c=0,l=o.entries;c<l.length;c++){var d=l[c];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return Pa.Category.ofTable(o.data,u)}}]}},e.Provider=_l.create(e.Descriptor),e.isExhaustive=function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95},e.getAtomIndexFromEntries=function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var c=u[s],l=c.partnerA.atomIndex,d=c.partnerB.atomIndex;o.has(l)?o.get(l).push(c):o.set(l,[c]),o.has(d)?o.get(d).push(c):o.set(d,[c])}return o},e.getEntriesFromStructConn=function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,c=i.pdbx_value_order,l={label_asym_id:i.ptnr1_label_asym_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},f=Array.from(o.entities.data.id.toArray()),p=function(x,D){if(0===D.label_asym_id.valueKind(x)){var w=D.label_asym_id.value(x),A=D.label_atom_id.value(x);if(A)for(var E=D.label_alt_id.value(x),I=0,M=f;I<M.length;I++){var N=o.atomicHierarchy.index.findResidue(M[I],w,D.auth_seq_id.value(x),D.ins_code.value(x));if(!(N<0)){var j=o.atomicHierarchy.index.findAtomOnResidue(N,A,E);if(!(j<0))return{residueIndex:N,atomIndex:j,symmetry:D.symmetry.value(x)}}}}},m=[],h=0;h<i._rowCount;h++){var v=p(h,l),g=p(h,d);if(void 0!==v&&void 0!==g){var y=s.value(h),C=0,_=1;switch(c.value(h)||""){case"sing":_=1;break;case"doub":_=2;break;case"trip":_=3;break;case"quad":_=4;break;default:_=DZ(i.ptnr1_label_comp_id.value(h),i.ptnr1_label_atom_id.value(h),i.ptnr2_label_comp_id.value(h),i.ptnr2_label_atom_id.value(h))}switch(y){case"covale":C=1;break;case"disulf":C=9;break;case"hydrog":C=4;break;case"metalc":C=2}m.push({rowIndex:h,flags:C,order:_,distance:u.value(h),partnerA:v,partnerB:g})}}return m}}(Yu||(Yu={}));var HNe=b.distance;function OZ(e,t,r,n,a,i,o){for(var s=new fu.EdgeBuilder(i,e,t),u=new Uint16Array(s.slotCount),c=new Int8Array(s.slotCount),l=new Uint32Array(s.slotCount),d=0,f=s.edgeCount;d<f;d++)s.addNextEdge(),s.assignProperty(u,n[d]),s.assignProperty(c,r[d]),s.assignProperty(l,a[d]);return s.createGraph({flags:u,order:c,key:l},{canRemap:o})}var FZ=b(),BZ=b();function jNe(e,t,r){return e.conformation.position(t,FZ),e.conformation.position(r,BZ),HNe(FZ,BZ)}var qNe=new Set;var KNe=b.distance,ZNe=b.set,QNe=b.squaredDistance,$Ne=b.transformMat4,NZ=b(),kZ=b();function LZ(e,t,r,n){return e.conformation.position(t,NZ),r.conformation.position(n,kZ),KNe(NZ,kZ)}var zt,JNe=he(),tv=b(),tke=R(R({},AZ),{ignoreWater:!0,ignoreIon:!0});function nke(e,t){var r=R(R({},tke),t);return function rke(e,t){var r=new Jh.Builder,n=e.models.some(function(i){return Do.Provider.get(i)}),a=e.models.some(function(i){return Yu.isExhaustive(i)});return t.noCompute||e.isCoarseGrained&&!n&&!a||Ze.eachUnitPair(e,function(i,o){!function eke(e,t,r,n){var a=r.maxRadius,i=e.elements,o=e.residueIndex,s=e.model.atomicConformation,u=s.x,c=s.y,l=s.z,d=t.elements,f=t.residueIndex,p=e.elements.length,m=e.model.atomicHierarchy.atoms,h=m.type_symbol,v=m.label_alt_id,g=m.label_atom_id,y=m.label_comp_id,S=t.model.atomicHierarchy.atoms,C=S.type_symbol,_=S.label_alt_id,x=S.label_atom_id,D=S.label_comp_id,w=e.model.atomicHierarchy.residues.auth_seq_id,A=t.model.atomicHierarchy.residues.auth_seq_id,E=e.model.atomicConformation.occupancy,I=t.model.atomicConformation.occupancy,M=E.isDefined&&I.isDefined,F=e.model===t.model&&Yu.Provider.get(e.model),N=!r.forceCompute&&e.model===t.model&&Do.Provider.get(e.model),j=e.model.atomicHierarchy.atomSourceIndex,U=(N?ar.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,H=e.model===t.model&&Yu.isExhaustive(e.model),z=he.mul(JNe,t.conformation.operator.inverse,e.conformation.operator.matrix),G=!he.isIdentity(z),J=t.boundary.sphere,X=J.center,Z=J.radius,ne=(Z+a)*(Z+a);n.startUnitPair(e.id,t.id);for(var Y=e.conformation.operator.key,k=t.conformation.operator.key,W=0;W<p;W++){var $=i[W];if(ZNe(tv,u[$],c[$],l[$]),G&&$Ne(tv,tv,z),!(QNe(tv,X)>ne)){if(!r.forceCompute&&N){for(var K=N.maxDistance,q=N.bonds,V=q.offset,ee=q.b,ae=q.edgeProps,pe=ae.order,me=ae.distance,de=ae.flag,re=ae.key,te=ae.operatorA,le=ae.operatorB,ge=j.value($),xe=_d(h.value($)),Ge=V[ge],je=V[ge+1];Ge<je;++Ge)if(!((Q=Ye.indexOf(t.elements,L=U[ee[Ge]]))<0)){var ye=te[Ge],we=le[Ge];if(!(ye>=0&&ye!==Y&&ye!==k||we>=0&&we!==k&&we!==Y)){var De=_d(h.value(L)),Oe=me[Ge],Ne=LZ(e,$,t,L),Ue=!1;Oe>=0?Ue=ea(Ne,Oe,.3):K>=0?Ue=Ne<K:(Ue=Ne<BA(xe,De,hm(xe),hm(De)),$f(xe)&&$f(De)&&(Ue=!1)),Ue&&n.add(W,Q,{order:pe[Ge],flag:de[Ge],key:re[Ge]})}}continue}var Ie=r.forceCompute?void 0:F&&F.byAtomIndex.get($);if(Ie&&Ie.length){for(var He=!1,Je=0,mt=Ie;Je<mt.length;Je++){var ut=mt[Je],St=ut.partnerA,Le=St.atomIndex===$?ut.partnerB:St;(Q=Ye.indexOf(t.elements,Le.atomIndex))<0||LZ(e,$,t,Le.atomIndex)>a||(n.add(W,Q,{order:ut.order,flag:ut.flags,key:ut.rowIndex}),He=!0)}if(He)continue}if(!H){var it=E.value($),bt=t.lookup3d.find(tv[0],tv[1],tv[2],a),Mt=bt.indices,Rt=bt.count,oe=bt.squaredDistances;if(0!==Rt)for(var be=_d(h.value($)),Ce=$f(be),Qe=hm(be),Et=v.value($),At=e2.has(be),Zt=g.value($),Dr=y.value(o[$]),tr=0;tr<Rt;tr++){var Q,L,fn=_.value(L=d[Q=Mt[tr]]);if(!(Et&&fn&&Et!==fn||M&&I.value(L)<1&&it<1&&w.value($)===A.value(L))){var Qn=$f(De=_d(C.value(L)));if(!Ce||!Qn){var ao=(At||e2.has(De))&&!(Ce||Qn);if(0!==(Ne=Math.sqrt(oe[tr]))&&Ne<=BA(be,De,Qe,hm(De))){var ja=x.value(L),Gi=D.value(f[L]);n.add(W,Q,{order:DZ(Dr,Gi,Zt,ja),flag:32|(ao?2:1),key:-1})}}}}}}}n.finishUnitPair()}(i,o,t,r)},{maxRadius:t.maxRadius,validUnit:function(i){return t.validUnit(i)},validUnitPair:function(i,o){return t.validUnitPair(e,i,o)}}),new JS(r.getMap())}(e,R(R({},r),{validUnit:t&&t.validUnit||function(n){return Fe.isAtomic(n)},validUnitPair:t&&t.validUnitPair||function(n,a,i){if(!Ze.validUnitPair(n,a,i))return!1;var s=a.model.atomicHierarchy.derived.residue.moleculeType,u=i.model.atomicHierarchy.derived.residue.moleculeType,c=!(Fe.isAtomic(a)&&2===s[a.residueIndex[a.elements[0]]]||Fe.isAtomic(i)&&2===u[i.residueIndex[i.elements[0]]]),l=!Fe.isAtomic(a)||3!==s[a.residueIndex[a.elements[0]]],d=!Fe.isAtomic(i)||3!==u[i.residueIndex[i.elements[0]]];return!(!c&&r.ignoreWater||!(l&&d||!r.ignoreIon))||function ake(e,t){if(e.model!==t.model||!Fe.isAtomic(e)||!Fe.isAtomic(t))return!1;var r=Yu.Provider.get(e.model);if(!r)return!1;for(var i=(e.elements.length<t.elements.length?e:t).elements,o=(e.elements.length>=t.elements.length?e:t).elements,s=Ye.indexOf,u=0,c=i.length;u<c;u++){var l=i[u],d=r.byAtomIndex.get(l);if(d?.length)for(var f=0,p=d;f<p.length;f++){var m=p[f];if(s(o,m.partnerA.atomIndex===l?m.partnerB.atomIndex:m.partnerA.atomIndex)>=0)return!0}}return!1}(a,i)}}))}function UZ(e){e.count=e.endVertex-e.startVertex;for(var t=e.isRingAtom,r=e.pred,n=e.color,a=e.depth,i=e.marked,o=0;o<e.count;o++)t[o]=0,r[o]=-1,i[o]=-1,n[o]=0,a[o]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function VZ(e){for(var t=e.depth,r=0;r<e.count;r++)t[r]=e.count+1}function GZ(e,t){var r=e.bonds.offset,n=e.startVertex+t,o=r[n+1]-r[n];return!(o<=1||e.isRingAtom[t]&&2===o)}function uke(e,t,r){if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var n=e.unit.elements,a=[],i=e.startVertex;i<e.endVertex;i++)Ya(a,o=e.altLoc.value(n[i]));Lh(a,"");var s=1;if(0===a.length)for(UZ(e),i=0;i<e.count;i++)GZ(e,i)&&(VZ(e),s=zZ(e,i,s));else for(var u=0;u<a.length;u++)for(UZ(e),e.hasAltLoc=!0,e.currentAltLoc=a[u],i=0;i<e.count;i++)if(GZ(e,i)){var o;(o=e.altLoc.value(n[e.startVertex+i]))&&o!==e.currentAltLoc||(VZ(e),s=zZ(e,i,s))}i=0;for(var c=e.currentRings.length;i<c;i++)e.rings.push(e.currentRings[i])}}function cke(e,t,r,n){if(r<t)return!1;for(var a=e.pred,i=e.color,o=e.left,s=e.right,u=++e.currentColor,c=t,l=0;l<5&&(i[c]=u,!((c=a[c])<0));l++);var d=0,f=0,p=!1,m=0;for(c=r,l=0;l<5;l++){if(i[c]===u){m=c,p=!0;break}if(s[f++]=c,(c=a[c])<0)break}if(!p)return!1;for(c=t,l=0;l<5&&(o[d++]=c,!(m===c||(c=a[c],c<0)));l++);var h=d+f;if(h<3)return!1;var v=new Int32Array(h),g=0;for(l=0;l<d;l++)v[g++]=e.startVertex+o[l],n[o[l]]=1;for(l=f-1;l>=0;l--)v[g++]=e.startVertex+s[l],n[s[l]]=1;bc(v);for(var y=0,S=e.currentRings.length;y<S;y++){var C=e.currentRings[y];if(v.length===C.length){if(Ye.areEqual(v,C))return!1}else if(v.length>C.length&&Ye.isSubset(v,C))return!1}return e.currentRings.push(Ye.ofSortedArray(v)),!0}function zZ(e,t,r){var n=e.bonds,a=e.startVertex,i=e.endVertex,o=e.isRingAtom,s=e.marked,u=e.queue,c=e.pred,l=e.depth,d=e.unit.elements,f=n.b,p=n.edgeProps.flags,m=n.offset;s[t]=r,l[t]=0,u[0]=t;for(var h=0,v=1;h<v;)for(var g=u[h++],y=l[g],S=a+g,_=m[S+1],x=m[S];x<_;x++){var D=f[x];if(!(D<a||D>=i)&&Gr.isCovalent(p[x])){if(e.hasAltLoc){var w=e.altLoc.value(d[D]);if(w&&e.currentAltLoc!==w)continue}var A=D-a;if(s[A]===r){if(c[A]!==g&&c[g]!==A&&cke(e,g,A,o))return r+1;continue}var E=Math.min(l[A],y+1);E>5||(l[A]=E,s[A]=r,u[v++]=A,c[A]=g)}}return r+1}function HZ(e){for(var t=e.length,r=new Int32Array(2*t),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(n=r[s-o-1];-1!==n&&(a=e[s%t])!==(i=e[(o+n+1)%t]);)a<i&&(o=s-n-1),n=r[n];-1===n&&(a=e[s%t])!==(i=e[(o+n+1)%t])?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1}return o}function jZ(e,t){var a,r=e.length,n=[];for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function N4(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=function fke(e,t){var n=e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return pm(n.type,r)}return 0}!function(e){function t(v,g,y,S,C,_){return{kind:"bond-location",aStructure:v,aUnit:g,aIndex:y,bStructure:S,bUnit:C,bIndex:_}}function n(v,g){return v.aStructure.label===g.aStructure.label&&v.bStructure.label===g.bStructure.label&&v.aIndex===g.aIndex&&v.bIndex===g.bIndex&&v.aUnit.id===g.aUnit.id&&v.bUnit.id===g.bUnit.id}function a(v,g){return{kind:"bond-loci",structure:v,bonds:g}}e.Location=t,e.isLocation=function r(v){return!!v&&"bond-location"===v.kind},e.areLocationsEqual=n,e.Loci=a,e.isLoci=function i(v){return!!v&&"bond-loci"===v.kind},e.areLociEqual=function o(v,g){if(v.structure!==g.structure||v.bonds.length!==g.bonds.length)return!1;for(var y=0,S=v.bonds.length;y<S;++y)if(!n(v.bonds[y],g.bonds[y]))return!1;return!0},e.isLociEmpty=function s(v){return 0===v.bonds.length},e.remapLoci=function u(v,g){if(g===v.structure)return v;var y=[];return v.bonds.forEach(function(S){var C=g.unitMap.get(S.aUnit.id);if(C){var _=g.unitMap.get(S.bUnit.id);if(_){var D=Ye.indexOf(C.elements,S.aUnit.elements[S.aIndex]);if(-1!==D){var A=Ye.indexOf(_.elements,S.bUnit.elements[S.bIndex]);-1!==A&&y.push(t(v.structure,C,D,v.structure,_,A))}}}}),a(g,y)},e.toStructureElementLoci=function c(v){for(var g=[],y=new Map,S=0,C=v.bonds;S<C.length;S++){var _=C[S],x=_.aIndex,D=_.aUnit,w=_.bIndex,A=_.bUnit;D===A?y.has(D.id)?y.get(D.id).push(x,w):y.set(D.id,[x,w]):(y.has(D.id)?y.get(D.id).push(x):y.set(D.id,[x]),y.has(A.id)?y.get(A.id).push(w):y.set(A.id,[w]))}return y.forEach(function(E,I){g.push({unit:v.structure.unitMap.get(I),indices:Ye.deduplicate(Ye.ofUnsortedArray(E))})}),Re(v.structure,g)},e.toFirstStructureElementLoci=function l(v){var g=v.bonds[0];return Re(v.structure,[{unit:g.aUnit,indices:ke.ofSingleton(g.aIndex)}])},e.getType=function d(v,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,S=y.getEdgeIndex(g.aIndex,g.bIndex);return Gr.create(S<0?0:y.edgeProps.flags[S])}var C=v.interUnitBonds.getBondFromLocation(g);return Gr.create(C?C.props.flag:0)},e.getOrder=function f(v,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,S=y.getEdgeIndex(g.aIndex,g.bIndex);return S<0?0:y.edgeProps.order[S]}var C=v.interUnitBonds.getBondFromLocation(g);return C?C.props.order:0},e.getIntraUnitBondCount=function p(v){for(var g=0,y=0,S=v.units.length;y<S;++y){var C=v.units[y];Fe.isAtomic(C)&&(g+=C.bonds.edgeCount)}return g};var m=function(){function v(){this.current={},this.hasNext=!1}return v.prototype.move=function(){return this.advance(),this.current},v.prototype.setElement=function(g,y,S){this.structure=g,this.unit=y,this.index=S,this.interBondIndices=g.interUnitBonds.getEdgeIndices(S,y.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=y.bonds.offset[S+1],this.intraBondIndex=y.bonds.offset[S],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},v.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else{if(!(this.interBondIndex<this.interBondCount))return void(this.hasNext=!1);var g=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},v}();e.ElementBondIterator=m,e.getBoundingSphere=function h(v,g){return Yh.fromPairProvider(v.bonds.length,function(y,S,C){var _=v.bonds[y],x=_.aUnit,w=_.bUnit,A=_.bIndex;x.conformation.position(x.elements[_.aIndex],S),w.conformation.position(w.elements[A],C)},g)}}(zt||(zt={}));var pke=new Set;function vm(e,t){var r=hBe[e];if(void 0!==r){var n=r[t];if(void 0!==n)return n}return pke}var qZ=b.zero();function WZ(e,t){for(var r=e.conformation.position,n=new Float32Array(3*t.length),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],qZ),b.toArray(qZ,n,3*i);return n}var Mc,Cn,UA=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index||(this._index=function dke(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var s=0,u=(o=e[a]).length;s<u;s++)r.has(c=o[s])?r.get(c).push(a):r.set(c,[a]);for(var l=0,d=t.length;l<d;l++)for(s=0,u=(o=e[a=t[l]]).length;s<u;s++)n.has(c=o[s])?n.get(c).push(a):n.set(c,[a]);var f=new fu.UniqueEdgeBuilder(e.length);for(a=0,i=e.length;a<i;a++){var o;for(s=0,u=(o=e[a]).length;s<u;s++){var c,p=r.get(c=o[s]);if(1!==p.length)for(var m=0,h=p.length;m<h;m++){var v=p[m];a>=v||f.addEdge(a,v)}}}var g=fu.connectedComponents(f.getGraph()),y=g.componentIndex,S=[];for(s=0;s<g.componentCount;s++)S[s]=[];for(a=0,i=e.length;a<i;a++)S[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:S}}(this.all,this.aromaticRings)),this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint||(this._byFingerprint=function mke(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var s=Mc.fingerprint(e,t[a]);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}(this.unit,this.all)),this._byFingerprint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings||(this._aromaticRings=function gke(e,t){for(var r=[],n=0,a=t.length;n<a;++n)Mc.isAromatic(e,t[n])&&r.push(n);return r}(this.unit,this.all)),this._aromaticRings},enumerable:!1,configurable:!0}),e}();function hke(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function vke(e,t,r){var n=e.byFingerprint.get(t);if(n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=hke(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}(function(e){function r(s){return function lke(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];var a=HZ(e),i=HZ(r),o=!1;for(n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?jZ(e,a):jZ(r,i)}(s)}e.fingerprint=function t(s,u){for(var c=s.elements,l=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,p=u.length;f<p;f++)d[d.length]=l.value(c[u[f]]);return r(d)},e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]);e.isAromatic=function i(s,u){var c=s.elements,l=s.bonds,d=l.b,f=l.offset,p=l.edgeProps.flags,m=s.model.atomicHierarchy.atoms,h=m.type_symbol;if("PRO"===m.label_comp_id.value(s.elements[u[0]]))return!1;for(var g=0,y=!1,S=0,C=u.length;S<C;++S){var _=u[S];!y&&n.has(h.value(c[_]))&&(y=!0);for(var x=f[_],D=f[_+1];x<D;++x)Gr.is(16,p[x])&&Ye.has(u,d[x])&&(g+=1)}if(g===2*u.length)return!0;if(!y||u.length<5||g>0)return!1;var w=gl.calculateMomentsAxes(WZ(s,u));return b.magnitude(w.dirC)<.05},e.getAltId=function o(s,u){for(var c=s.model.atomicHierarchy.atoms.label_alt_id,l=s.elements,d=0,f=u.length;d<f;++d){var m=c.value(l[u[d]]);if(m)return m}return""}})(Mc||(Mc={})),function(e){e.create=function t(n){var a=function ike(e){for(var t=function ske(e){for(var t=pr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}(e),r=function oke(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}(e,t),n=pr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();uke(r,a.start,a.end)}return r.rings}(n);return new e(a,n)},e.byFingerprintAndResidue=function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++)vke(n,a[o],i);return i}}(UA||(UA={})),function(e){function i(C){return C[C.length-1]}function s(C){return C.length/2}function u(C,_){return C[2*_]}function c(C,_){return C[2*_+1]+1}function l(C,_){return C[2*_]}function d(C,_){return C[2*_+1]}function v(C,_){return g(C,_,0)}function g(C,_,x){if(l(C,x)>ke.max(_)||i(C)<ke.min(_))return-1;for(var D=x,w=s(C);D<w;++D){var A=_e.ofRange(l(C,D),d(C,D));if(ke.areIntersecting(A,_))return D}return-1}e.ofSortedRanges=function t(C){return Ye.ofSortedArray(C)},e.start=function r(C){return C[0]},e.end=function n(C){return C[C.length-1]+1},e.min=function a(C){return C[0]},e.max=i,e.size=function o(C){for(var _=0,x=0,D=C.length;x<D;x+=2)_+=C[x+1]-C[x]+1;return _},e.count=s,e.startAt=u,e.endAt=c,e.minAt=l,e.maxAt=d,e.areEqual=function f(C,_){if(C.length!==_.length)return!1;for(var x=0,D=C.length;x<D;++x)if(C[x]!==_[x])return!1;return!0},e.forEach=function p(C,_){for(var x=0,D=0,w=C.length;D<w;D+=2)for(var A=C[D],E=C[D+1];A<=E;++A)_(A,x),++x},e.has=function m(C,_){return-1!==v(C,_)},e.hasFrom=function h(C,_,x){return-1!==g(C,_,x)},e.firstIntersectionIndex=v,e.firstIntersectionIndexFrom=g,e.transientSegments=function y(C,_){return new S(C,_)};var S=function(){function C(_,x){this.ranges=_,this.set=x,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=v(_,x),this.hasNext=-1!==this.curIndex}return C.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=ke.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=ke.findPredecessorIndex(this.set,c(this.ranges,this.curIndex))},C.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=-1!==this.curIndex),this.value},C}();e.Iterator=S}(Cn||(Cn={}));var YZ=b.zero();function XZ(e){var t=function wke(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(3*r.length),a=0,i=r.length;a<i;a++)t(r[a],YZ),b.toArray(YZ,n,3*a);return n}(e);return gl.ofPositions(t)}var KZ=b.set,Ake=new Lu("14"),Tke=new Lu("98");function k4(e){var t=Nt.computeBounding(e);return{box:t,sphere:Pe.fromBox3D(Pe(),t)}}var VA=b();function Jf(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=ke.size(i);if(o>25e4)return k4(e);var s=function Dke(e){return e>1e4?Ake:Tke}(o);s.reset();for(var u=0;u<o;u++){var c=ke.getAt(i,u);KZ(VA,t[c],r[c],n[c]),s.includePositionRadius(VA,a&&a[c]||0)}for(s.finishedIncludeStep(),u=0;u<o;u++)c=ke.getAt(i,u),KZ(VA,t[c],r[c],n[c]),s.radiusPositionRadius(VA,a&&a[c]||0);var l=s.getSphere();if(!a&&Pe.hasExtrema(l)&&o<=l.extrema.length){var d=[];for(u=0;u<o;u++)c=ke.getAt(i,u),d.push(b.create(t[c],r[c],n[c]));Pe.setExtrema(l,d)}return{box:s.getBox(),sphere:l}}var Fe,ry,Eke=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Ye.hashCode(t);if(this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],s=i[1];if(Ye.areEqual(t,i[0]))return s}},e.prototype.set=function(t,r){var n=Ye.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(Ye.areEqual(t,s[0]))return void(s[1]=r)}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}();function Pke(e){for(var t=e.bonds,r=t.b,a=t.offset,o=t.edgeProps.flags,s=e.rings.elementAromaticRingIndices,u=[],c=new Map,l=new Map,d=function(C,_,x){var D=u.length;u.push(Ye.ofUnsortedArray([C,_,x])),c.set(iS(C,_),x),l.has(C)?l.get(C).push(D):l.set(C,[D])},f=0;f<e.elements.length;f++)if(!(s.has(f)||a[f+1]-a[f]+1<2)){for(var m=[],h=a[f],v=a[f+1];h<v;h++)Gr.is(o[h],16)&&m.push(r[h]);if(m.length>=2){d(f,m[0],m[1]);for(var y=1,S=m.length;y<S;y++)d(f,m[y],m[0])}}return{getThirdElement:function(C,_){return c.get(iS(C,_))},getTripletIndices:function(C){return l.get(C)},triplets:u}}function ZZ(){return{result:ry.create(),closeUnitsResult:wc.create(),unitGroupResult:wc.create()}}!function(e){var z,f,p;function u(z){for(var G=[],J=0,X=z.length;J<X;J++)G.push(z[J].id);return rs(G)}function c(z){var G={};return{elements:z[0].elements,units:z,get unitIndexMap(){return G.unitIndexMap||(G.unitIndexMap=function s(z){for(var G=xc.Mutable(),J=0,X=z.length;J<X;J++)G.set(z[J].id,J);return G}(z)),G.unitIndexMap},hashCode:d(z[0]),transformHash:u(z)}}function d(z){return Oh(z.invariantId,Ye.hashCode(z.elements))}(z=e.Kinds||(e.Kinds={}))[z.Atomic=0]="Atomic",z[z.Spheres=1]="Spheres",z[z.Gaussians=2]="Gaussians",e.isAtomic=function r(z){return 0===z.kind},e.isCoarse=function n(z){return 1===z.kind||2===z.kind},e.isSpheres=function a(z){return 1===z.kind},e.isGaussians=function i(z){return 2===z.kind},e.create=function o(z,G,J,X,Z,ne,Y,k,W){switch(Z){case 0:return new g(z,G,J,X,ne,k,ra.createMapping(Y,ne.atomicConformation),W??{});case 1:return w(z,G,J,X,ne,1,k,ra.createMapping(Y,ne.coarseConformation.spheres,function h(z){var G=z.coarseConformation.spheres.radius;return function(J){return G[J]}}(ne)),W??{});case 2:return w(z,G,J,X,ne,2,k,ra.createMapping(Y,ne.coarseConformation.gaussians,function(G){return 0}),W??{})}},e.SymmetryGroup=c,function(z){z.areInvariantElementsEqual=function G(X,Z){return X.hashCode===Z.hashCode&&Ye.areEqual(X.elements,Z.elements)},z.getUnitSymmetryGroupsIndexMap=function J(X){for(var Z=xc.Mutable(),ne=0,Y=X.length;ne<Y;++ne)for(var k=X[ne],W=0,$=k.units.length;W<$;++W)Z.set(k.units[W].id,ne);return Z}}(c=e.SymmetryGroup||(e.SymmetryGroup={})),e.conformationId=function l(z){return e.isAtomic(z)?z.model.atomicConformation.id:z.model.coarseConformation.id},e.hashUnit=d,function(z){z[z.None=0]="None",z[z.MultiChain=1]="MultiChain",z[z.Partitioned=2]="Partitioned",z[z.FastBoundary=4]="FastBoundary"}(f=e.Trait||(e.Trait={})),function(z){z.is=Vo.has,z.create=Vo.create}(p=e.Traits||(e.Traits={}));var g=function(){function z(G,J,X,Z,ne,Y,k,W){this.kind=0,this.objectPrimitive="atomistic",this.id=G,this.invariantId=J,this.chainGroupId=X,this.traits=Z,this.model=ne,this.elements=Y,this.conformation=k,this.residueIndex=ne.atomicHierarchy.residueAtomSegments.index,this.chainIndex=ne.atomicHierarchy.chainAtomSegments.index,this.props=W}return z.prototype.getChild=function(G){return G.length===this.elements.length?this:new z(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,G,this.conformation,{})},z.prototype.applyOperator=function(G,J,X){void 0===X&&(X=!1);var Z=X?J:ra.compose(this.conformation.operator,J);return new z(G,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,ra.createMapping(Z,this.model.atomicConformation,this.conformation.r),this.props)},z.prototype.remapModel=function(G,J,X){var Z,ne;X||(X=R(R({},this.props),{bonds:!J||null!==(ne=null===(Z=this.props.bonds)||void 0===Z?void 0:Z.props)&&void 0!==ne&&ne.canRemap?M(this,this.props.bonds,G,J):void 0}),e.isSameConformation(this,G)||(X.boundary=void 0,X.lookup3d=void 0,X.principalAxes=void 0));var Y=this.conformation.operator,k=Ja.Provider.get(G);if(-1!==Y.spgrOp&&k&&k!==Ja.Provider.get(this.model)){var W=Y.hkl,$=W[0],K=W[1],q=W[2],V=k.spacegroup.cell.toFractional,ee=b.transformMat4(b(),ar.getCenter(G),V);Y=au.getSymmetryOperatorRef(k.spacegroup,Y.spgrOp,$,K,q,ee)}var ae=this.model.atomicConformation!==G.atomicConformation||Y!==this.conformation.operator?ra.createMapping(Y,G.atomicConformation):this.conformation;return new z(this.id,this.invariantId,this.chainGroupId,this.traits,G,this.elements,ae,X)},Object.defineProperty(z.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var G=this.model.atomicConformation,J=G.x,X=G.y,Z=G.z;return this.props.boundary=p.is(this.traits,f.FastBoundary)?k4({x:J,y:X,z:Z,indices:this.elements}):Jf({x:J,y:X,z:Z,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var G=this.model.atomicConformation;return this.props.lookup3d=Df({x:G.x,y:G.y,z:G.z,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"principalAxes",{get:function(){return this.props.principalAxes||(this.props.principalAxes=XZ(this)),this.props.principalAxes},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var G=Eke.get(this.model),J=G.get(this.elements);return J||(J=function XNe(e,t){var r=R(R({},AZ),t);return r.noCompute||ar.isCoarseGrained(e.model)&&!Do.Provider.get(e.model)&&!Yu.isExhaustive(e.model)?I4.Empty:!r.forceCompute&&Do.Provider.get(e.model)?function WNe(e){for(var t=Do.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.maxDistance,o=t.bonds,s=o.offset,u=o.b,c=o.edgeProps,l=c.order,d=c.distance,f=c.flag,p=c.key,m=c.operatorA,h=c.operatorB,v=e.model.atomicHierarchy.atomSourceIndex,g=ar.getInvertedAtomSourceIndex(e.model).invertedIndex,y=[],S=[],C=[],_=[],x=[],D=e.conformation.operator.key,w=0;w<a;w++)for(var A=r[w],E=_d(n.value(A)),I=$f(E),M=v.value(A),F=s[M],N=s[M+1];F<N;++F){var j=g[u[F]];if(!(A>=j)){var U=Ye.indexOf(e.elements,j);if(!(U<0)){var H=m[F],z=h[F];if(!(H>=0&&H!==D||z>=0&&z!==D)){var G=_d(n.value(j)),J=d[F],X=jNe(e,A,j),Z=!1;J>=0?Z=ea(X,J,.3):i>=0?Z=X<i:(Z=X<BA(E,G,hm(E),hm(G)),I&&$f(G)&&(Z=!1)),Z&&(y[y.length]=w,S[S.length]=U,_[_.length]=l[F],C[C.length]=f[F],x[x.length]=p[F])}}}}return OZ(y,S,_,C,x,a,!1)}(e):function YNe(e,t){for(var r=t.maxRadius,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,c=e.residueIndex,l=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,p=d.label_atom_id,m=d.label_alt_id,h=d.label_comp_id,v=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,S=e.lookup3d,C=Yu.Provider.get(e.model),_=ev.Provider.get(e.model),x=Yu.isExhaustive(e.model),D=[],w=[],A=[],E=[],I=[],M=-1,F=void 0,N=!0,j=!0,U=!0,H=qNe,z=0;z<s;z++){var G=u[z],J=f.value(G);N&&"H"!==J&&"O"!==J&&(N=!1);var X=t.forceCompute?void 0:C&&C.byAtomIndex.get(G),Z=!1;if(X)for(var ne=0,Y=X;ne<Y.length;ne++){var k=Y[ne],W=k.partnerA,$=k.partnerB;W.symmetry===$.symmetry&&((q=Ye.indexOf(e.elements,(W.atomIndex===G?$:W).atomIndex))<0||u[q]<G||(D[D.length]=z,w[w.length]=q,A[A.length]=k.flags,E[E.length]=k.order,I[I.length]=k.rowIndex,Z||H.clear(),Z=!0,H.add(q)))}if(!x){var V=c[G],ee=v.value(V),ae=h.value(G);if(!t.forceCompute&&V!==M)if(_&&_.entries.has(ae)){var pe=y[g.getEntityFromChain(l[G])];F=pe&&pe.sequence.microHet.has(ee)?void 0:_.entries.get(ae).map}else F=void 0;M=V;for(var me=_d(J),de=p.value(G),re=F?F.get(de):void 0,te=S.find(a[G],i[G],o[G],r),le=te.indices,ge=te.count,xe=te.squaredDistances,Ge=$f(me),je=hm(me),L=m.value(G),Q=e2.has(me),ye=0;ye<ge;ye++){var q=le[ye];if(!Z||!H.has(q)){var we=u[q];if(!(we<=G)){var De=m.value(we);if(!L||!De||L===De){var Oe=_d(f.value(we)),Ne=$f(Oe);if(!Ge||!Ne){var Ue=(Q||e2.has(Oe))&&!(Ge||Ne),$e=c[we];if(V===$e&&re){var Ie=re.get(p.value(we));if(Ie){D[D.length]=z,w[w.length]=q,E[E.length]=Ie.order;var He=Ie.flags;Ue&&(1|He&&(He^=1),He|=2),A[A.length]=He,I[I.length]=Ie.key}continue}var Je=Math.sqrt(xe[ye]);if(0!==Je&&Je<=BA(me,Oe,je,hm(Oe))){D[D.length]=z,w[w.length]=q,E[E.length]=CNe(ae,de,p.value(we)),A[A.length]=32|(Ue?2:1),I[I.length]=-1;var ut=v.value($e);ee===ut&&(j=!1),Math.abs(ee-ut)>1&&(U=!1)}}}}}}}}return OZ(D,w,E,A,I,s,N||j&&U)}(e,r)}(this),G.set(this.elements,J)),this.props.bonds=J,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"rings",{get:function(){return this.props.rings||(this.props.rings=UA.create(this)),this.props.rings},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"resonance",{get:function(){return this.props.resonance||(this.props.resonance=function Ike(e){return{delocalizedTriplets:Pke(e)}}(this)),this.props.resonance},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"polymerElements",{get:function(){return this.props.polymerElements||(this.props.polymerElements=function yke(e){for(var t=[],r=e.elements,a=e.model.atomicHierarchy.residueAtomSegments,i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=Cn.transientSegments(e.model.atomicRanges.polymerRanges,r),s=pr.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var c=s.move(),f=c.index;if(ke.areIntersecting(_e.ofRange(r[c.start],r[c.end-1]),r)){var p=i[f];t.push(-1===p?a.offsets[f]:p)}}}return Ye.ofSortedArray(t)}(this)),this.props.polymerElements},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"gapElements",{get:function(){return this.props.gapElements||(this.props.gapElements=function Ske(e){for(var t=[],r=e.elements,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=Cn.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),c=a[r[u.start]],l=a[r[u.end-1]],d=o[c],f=o[l];t.push(-1===d?i.offsets[c]:d),t.push(-1===f?i.offsets[l]:f)}return Ye.ofSortedArray(t)}(this)),this.props.gapElements},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements||(this.props.nucleotideElements=function xke(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,c=s.traceElementIndex,l=pr.transientSegments(a.chainAtomSegments,r),d=pr.transientSegments(o,r);l.hasNext;)for(d.setSegment(l.move());d.hasNext;){var f=d.move().index;if(xd(u[f])){var p=c[f];t.push(-1===p?o.offsets[f]:p)}}return Ye.ofSortedArray(t)}(this)),this.props.nucleotideElements},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"proteinElements",{get:function(){return this.props.proteinElements||(this.props.proteinElements=function _ke(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,c=s.traceElementIndex,l=pr.transientSegments(a.chainAtomSegments,r),d=pr.transientSegments(o,r);l.hasNext;)for(d.setSegment(l.move());d.hasNext;){var f=d.move().index;if(cZ(u[f])){var p=c[f];t.push(-1===p?o.offsets[f]:p)}}return Ye.ofSortedArray(t)}(this)),this.props.proteinElements},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"residueCount",{get:function(){if(void 0!==this.props.residueCount)return this.props.residueCount;for(var G=0,J=pr.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);J.hasNext;)J.move(),G+=1;return this.props.residueCount=G,this.props.residueCount},enumerable:!1,configurable:!0}),z.prototype.getResidueIndex=function(G){return this.residueIndex[this.elements[G]]},z}();e.Atomic=g;var S=function(){function z(G,J,X,Z,ne,Y,k,W,$){this.kind=Y,this.objectPrimitive=1===Y?"sphere":"gaussian",this.id=G,this.invariantId=J,this.chainGroupId=X,this.traits=Z,this.model=ne,this.elements=k,this.conformation=W,this.coarseElements=1===Y?ne.coarseHierarchy.spheres:ne.coarseHierarchy.gaussians,this.coarseConformation=1===Y?ne.coarseConformation.spheres:ne.coarseConformation.gaussians,this.props=$}return z.prototype.getChild=function(G){return G.length===this.elements.length?this:w(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,G,this.conformation,{})},z.prototype.applyOperator=function(G,J,X){void 0===X&&(X=!1);var Z=X?J:ra.compose(this.conformation.operator,J);return w(G,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,ra.createMapping(Z,this.getCoarseConformation(),this.conformation.r),this.props)},z.prototype.remapModel=function(G,J,X){var Z=this.getCoarseConformation(),ne=C(this.kind,G);X||(X=R({},this.props),e.isSameConformation(this,G)||(X.boundary=void 0,X.lookup3d=void 0,X.principalAxes=void 0));var Y=Z!==ne?ra.createMapping(this.conformation.operator,ne):this.conformation;return new z(this.id,this.invariantId,this.chainGroupId,this.traits,G,this.kind,this.elements,Y,X)},Object.defineProperty(z.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var G=this.getCoarseConformation(),J=G.x,X=G.y,Z=G.z;return this.props.boundary=p.is(this.traits,f.FastBoundary)?k4({x:J,y:X,z:Z,indices:this.elements}):Jf({x:J,y:X,z:Z,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var G=this.getCoarseConformation();return this.props.lookup3d=Df({x:G.x,y:G.y,z:G.z,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"principalAxes",{get:function(){return this.props.principalAxes||(this.props.principalAxes=XZ(this)),this.props.principalAxes},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"polymerElements",{get:function(){return this.props.polymerElements||(this.props.polymerElements=function bke(e){for(var t=[],r=e.elements,a=e.model.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Fe.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=Cn.transientSegments(s,r);u.hasNext;)for(var c=u.move(),d=c.end,f=c.start;f<d;++f)t.push(r[f]);return Ye.ofSortedArray(t)}(this)),this.props.polymerElements},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"gapElements",{get:function(){return this.props.gapElements||(this.props.gapElements=function Cke(e){for(var t=[],r=e.elements,a=e.model.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Fe.isSpheres(e)?i.gapRanges:o.gapRanges,u=Cn.transientSegments(s,r);u.hasNext;){var c=u.move();t.push(r[c.start],r[c.end-1])}return Ye.ofSortedArray(t)}(this)),this.props.gapElements},enumerable:!1,configurable:!0}),z.prototype.getCoarseConformation=function(){return C(this.kind,this.model)},z}();function C(z,G){return 1===z?G.coarseConformation.spheres:G.coarseConformation.gaussians}var x=function(z){function G(){return null!==z&&z.apply(this,arguments)||this}return jt(G,z),G}(S);e.Spheres=x;var D=function(z){function G(){return null!==z&&z.apply(this,arguments)||this}return jt(G,z),G}(S);function w(z,G,J,X,Z,ne,Y,k,W){return new S(z,G,J,X,Z,ne,Y,k,W)}function M(z,G,J,X){var Z;if(G){if(z.model.atomicConformation.id===J.atomicConformation.id)return G;var ne=Do.Provider.get(z.model);if(ne){var Y=Do.Provider.get(J);return Y&&ne!==Y?void 0:G}return null!==(Z=G.props)&&void 0!==Z&&Z.canRemap||!X||F(z,J)?G:void 0}}function F(z,G){var J=ar.CoordinatesHistory.get(ar.getRoot(G));if(J)return J.areEqual(z.elements,z.kind,G);for(var X=z.elements,Z=z.conformation.coordinates,ne=Z.x,Y=Z.y,k=Z.z,W=N(z.kind,G),$=W.x,K=W.y,q=W.z,V=0,ee=X.length;V<ee;V++){var ae=X[V];if(ne[ae]!==$[ae]||Y[ae]!==K[ae]||k[ae]!==q[ae])return!1}return!0}function N(z,G){return 0===z?G.atomicConformation:1===z?G.coarseConformation.spheres:G.coarseConformation.gaussians}function U(z,G){return 0===z?G.atomicHierarchy:1===z?G.coarseHierarchy.spheres:G.coarseHierarchy.gaussians}e.Gaussians=D,e.areSameChainOperatorGroup=function A(z,G){return z.chainGroupId===G.chainGroupId&&z.conformation.operator.name===G.conformation.operator.name},e.areOperatorsEqual=function E(z,G){return he.areEqual(z.conformation.operator.matrix,G.conformation.operator.matrix,1e-6)},e.areConformationsEqual=function I(z,G){return z===G||!!Ye.areEqual(z.elements,G.elements)&&F(z,G.model)},e.isSameConformation=F,e.getModelConformationOfKind=N,e.getConformation=function j(z){return N(z.kind,z.model)},e.getModelHierarchyOfKind=U,e.getHierarchy=function H(z){return U(z.kind,z.model)}}(Fe||(Fe={})),function(e){e.add=function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++},e.create=function r(){return{count:0,indices:[],units:[],squaredDistances:[]}},e.copy=function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}}(ry||(ry={}));var ht,rn,Mke=function(){function e(t){this.structure=t,this.pivot=b(),this.heap=new YY,this.findContext=ZZ();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),c=b(),l=0;l<a;l++){var d=r[l],f=d.boundary.sphere;b.transformMat4(c,f.center,d.conformation.operator.matrix),i[l]=c[0],o[l]=c[1],s[l]=c[2],u[l]=f.radius}var p={x:i,y:o,z:s,radius:u,indices:ke.ofBounds(0,a)};this.unitLookup=Df(p,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i??this.findContext)},e.prototype._find=function(t,r,n,a,i){wc.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(0===s.count)return i.result;for(var u=0,c=s.count;u<c;u++){var l=o[s.indices[u]];b.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);for(var f=l.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),p=0,m=f.count;p<m;p++)ry.add(i.result,l,f.indices[p],f.squaredDistances[p])}return i.result},e.prototype.nearest=function(t,r,n,a,i){return void 0===a&&(a=1),this._nearest(t,r,n,a,i??this.findContext)},e.prototype._nearest=function(t,r,n,a,i){var o=i.result,s=this.heap;wc.reset(o),s.clear();var u=this.structure.units,c=0,l=this.unitLookup.nearest(t,r,n,u.length,function(E){return(c+=u[E].elements.length)>=a},i.closeUnitsResult);if(0===l.count)return o;for(var d=0,f=-Number.MAX_VALUE,p=0,m=l.count;p<m&&!(d>=a&&f<l.squaredDistances[p]);p++){b.set(this.pivot,t,r,n),(v=u[l.indices[p]]).conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,v.conformation.operator.inverse);var y=v.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],a,void 0,i.unitGroupResult);if(0!==y.count){d+=y.count,f=Math.max(f,y.squaredDistances[y.count-1]);for(var S=0,C=y.count;S<C;S++)s.insert(y.squaredDistances[S],{index:y.indices[S],unit:v})}}if(1===a){if(_=s.findMinimum()){var D=_.value;ry.add(o,v=D.unit,D.index,_.key)}}else for(;!s.isEmpty()&&o.count<a;){var _,v,A=(_=s.extractMinimum()).value;ry.add(o,v=A.unit,A.index,_.key)}return o},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(0!==s.count)for(var u=0,c=s.count;u<c;u++){var l=o[s.indices[u]];b.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var f=l.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(0!==f.count){var p=l.elements;i.beginUnit(l.id);for(var m=0,h=f.count;m<h;m++)i.addElement(p[f.indices[m]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(0!==u.count)for(var c=at.create(this.structure),l=0,d=u.count;l<d;l++){var f=s[u.indices[l]];b.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var m=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(0!==m.count){var h=f.elements;c.unit=f,i.beginUnit(f.id);for(var v=0,g=m.count;v<g;v++)c.element=h[m.indices[v]],o(c)&&i.addElement(c.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var c=this.structure.units,l=this.unitLookup.find(t,r,n,o);if(0!==l.count)for(var d=at.create(this.structure),f=a+i+o,p=0,m=l.count;p<m;p++){var h=c[l.indices[p]];b.set(this.pivot,t,r,n),h.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,h.conformation.operator.inverse);var g=h.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(0!==g.count){var y=h.elements;d.unit=h,u.beginUnit(h.id);for(var S=0,C=g.count;S<C;S++){d.element=y[g.indices[S]];var _=s(d);Math.sqrt(g.squaredDistances[S])-a-_>o||u.addElement(y[g.indices[S]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(0===o.count)return!1;for(var s=0,u=o.count;s<u;s++){var c=i[o.indices[s]];if(b.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse),c.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function r2(e,t){if(0===t.length)return Ze.Empty;if(1===t.length)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var c=o[s];if(r.has(c.id)){if(n.has(c.id))continue;var l=Ye.union(r.get(c.id),c.elements);r.set(c.id,l),l.length===e.unitMap.get(c.id).elements.length&&n.add(c.id)}else r.set(c.id,c.elements),c.elements.length===e.unitMap.get(c.id).elements.length&&n.add(c.id)}var d=e.subsetBuilder(!0);return r.forEach(Rke,d),d.getStructure()}function Rke(e,t){this.setUnit(t,e)}function Oke(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Ye.areEqual(o.elements,s.elements))return!1}return!0}function GA(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(i.has(u.id)){var c=i.get(u.id);if(Ye.areIntersecting(u.elements,c.elements))return!0}}return!1}function QZ(e,t){if(e===t)return e;if(!GA(e,t))return Ze.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var c=a[s];if(i.has(c.id)){var l=i.get(c.id);if(Ye.areIntersecting(c.elements,l.elements)){var d=Ye.intersect(c.elements,l.elements);o[o.length]=c.getChild(d)}}}return Ze.create(o,{parent:e.parent||t.parent})}function L4(e,t){if(e===t)return Ze.Empty;if(!GA(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(n.has(s.id)){var u=n.get(s.id),c=Ye.subtract(s.elements,u.elements);c.length>0&&(a[a.length]=s.getChild(c))}else a[a.length]=s}return Ze.create(a,{parent:e.parent||t.parent})}function U4(e){return Gr.isCovalent(e.atomicBond.type)}function Fke(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(0===s.kind){n.unit=s;var u=s.elements;if(n.element=u[0],"polymer"===ot.entity.type(n)){for(var c=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),l=0;c.hasNext;)l++,c.move();l<8||a.push(s)}}}return ht.Singletons(r,Ze.create(a,{parent:r}))}}function Bke(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];0===s.kind&&(n.unit=s,n.element=s.elements[0],"water"===ot.entity.type(n)&&a.push(s))}return ht.Singletons(r,Ze.create(a,{parent:r}))}}function Nke(){return function(t){for(var r=t.inputStructure,n=at.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(0===s.kind){n.unit=s;var u=s.elements;if(n.element=u[0],"water"!==ot.entity.type(n)){if("polymer"===ot.entity.type(n)){for(var c=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),l=0;c.hasNext;)l++,c.move();if(l>=8)continue}a.push(s)}}}return ht.Singletons(r,Ze.create(a,{parent:r}))}}function kke(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];1===o.kind&&n.push(o)}return ht.Singletons(r,Ze.create(n,{parent:r}))}}function $Z(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function JZ(e){return function(r){return ht.Sequence(r.inputStructure,[rn.toStructure({hash:r.inputStructure.hashCode,elements:e},r.inputStructure)])}}!function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}function r(g,y){return{kind:"sequence",source:g,structures:y}}function n(g){return t(g,Ze.Empty)}function a(g){return"singletons"===g.kind}function i(g){return a(g)?0===g.structure.units.length:0===g.structures.length}function s(g){return i(g)?Ze.Empty:a(g)?g.structure:r2(g.source,g.structures)}function l(g,y,S){return 0===y.length?n(g):S?t(g,r2(g,y)):r(g,y)}e.Singletons=t,e.Sequence=r,e.Empty=n,e.isSingleton=a,e.isEmpty=i,e.structureCount=function o(g){return a(g)?g.structure.elementCount:g.structures.length},e.unionStructure=s,e.toLociWithCurrentUnits=function u(g){for(var y=[],S=g.source.unitMap,C=0,_=s(g).units;C<_.length;C++){var x=_[C];y[y.length]=x===S.get(x.id)?{unit:x,indices:ke.ofBounds(0,x.elements.length)}:{unit:x,indices:ke.ofSortedArray(Ye.indicesOf(S.get(x.id).elements,x.elements))}}return Re(g.source,y)},e.toLociWithSourceUnits=function c(g){for(var y=[],S=g.source.unitMap,C=0,_=s(g).units;C<_.length;C++){var x=_[C],D=S.get(x.id);y[y.length]=D===x?{unit:D,indices:ke.ofBounds(0,D.elements.length)}:{unit:D,indices:ke.ofSortedArray(Ye.indicesOf(D.elements,x.elements))}}return Re(g.source,y)};var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var S=y.elementCount;0!==S&&(this.structures[this.structures.length]=y,1!==S&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return l(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=tF(Ze.hashCode,Ze.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var S=y.elementCount;0===S||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,1!==S&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return l(this.structure,this.structures,this.allSingletons)},g}();e.LinearBuilder=function p(g){return new d(g)},e.UniqueBuilder=function m(g){return new f(g)},e.forEach=function h(g,y){var S=0;if(e.isSingleton(g))for(var C=0,_=g.structure.units;C<_.length;C++)for(var x=_[C],D=x.elements,w=0,A=D.length;w<A;w++)y(Ze.create([x.getChild(Ye.ofSingleton(D[w]))],{parent:g.source}),S++);else for(var I=0,M=g.structures;I<M.length;I++)y(M[I],S++)},e.withInputStructure=function v(g,y){return a(g)?t(y,g.structure):r(y,g.structures)}}(ht||(ht={})),function(e){function n(l){for(var d=[],f=0,p=l.elements;f<p.length;f++){var h=(m=p[f]).unit,v=m.indices;if(0!==ke.size(v)){var g=[],y=[];if(ke.isInterval(v))1===ke.size(v)?y.push(_e.min(v)):g.push(_e.min(v),_e.max(v));else for(var S=0,C=v.length;S<C;){var _=S;for(S++;S<C&&v[S-1]+1===v[S];)S++;var x=S;if(x-_>2)g.push(v[_],v[x-1]);else for(var D=_;D<x;D++)y[y.length]=v[D]}d.push({unit:h,set:Ye.ofSortedArray(y),ranges:Cn.ofSortedRanges(g)})}}for(var w=new Map,A=(S=0,d.length);S<A;++S){var m,I,E=Oh(rs((m=d[S]).ranges),rs(m.set));w.has(E)?(I=w.get(E).groupedUnits).has(m.unit.invariantId)?I.get(m.unit.invariantId).push(m.unit.id):I.set(m.unit.invariantId,[m.unit.id]):((I=new Map).set(m.unit.invariantId,[m.unit.id]),w.set(E,{groupedUnits:I,set:m.set,ranges:m.ranges}))}var M=[];return w.forEach(function(F){var N=[];F.groupedUnits.forEach(function(j){return N.push(Ye.ofUnsortedArray(j))}),N.sort(function(j,U){return j[0]-U[0]}),M.push({groupedUnits:N,set:F.set,ranges:F.ranges})}),{hash:l.structure.hashCode,elements:M}}function a(l,d){for(var f=[],p=0,m=l.length;p<m;++p){var h=l[p];d.unitMap.has(h)&&f.push(d.unitMap.get(h))}return f}function s(l){return fe.internal.generator.bundleElement({groupedUnits:fe.core.type.list(l.groupedUnits.map(function(d){return fe.core.type.list(d)})),ranges:fe.core.type.list(l.ranges),set:fe.core.type.list(l.set)})}e.Empty={hash:-1,elements:[]},e.fromSubStructure=function t(l,d){return n(ht.toLociWithSourceUnits(ht.Singletons(l,d)))},e.fromSelection=function r(l){return n(ht.toLociWithSourceUnits(l))},e.fromLoci=n,e.toLoci=function i(l,d){-1!==l.hash&&l.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");for(var f=[],p=0,m=l.elements;p<m.length;p++)for(var h=m[p],v=function(C){var _=a(C,d);if(0===_.length)return"continue";var x=void 0;if(0===h.ranges.length)x=h.set;else if(0===h.set.length)if(2===h.ranges.length)x=_e.ofRange(h.ranges[0],h.ranges[1]);else{var D=new Int32Array(Cn.size(h.ranges));Cn.forEach(h.ranges,function(F,N){return D[N]=F}),x=Ye.ofSortedArray(D)}else{var w=Cn.size(h.ranges),A=new Int32Array(h.set.length+w);Cn.forEach(h.ranges,function(F,N){return A[N]=F}),A.set(h.set,w),x=Ye.ofUnsortedArray(A)}for(var E=0,I=_;E<I.length;E++)f.push({unit:I[E],indices:x})},g=0,y=h.groupedUnits;g<y.length;g++)v(y[g]);return Re(d,f)},e.toStructure=function o(l,d){-1!==l.hash&&l.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");for(var f=[],p=0,m=l.elements;p<m.length;p++)for(var h=m[p],v=function(C){var _=a(C,d);if(0===_.length)return"continue";var x=_[0].elements,D=Cn.size(h.ranges),w=h.set.length,A=new Int32Array(w+D),E=void 0;if(0===D){for(var I=0,M=w;I<M;++I)A[I]=x[h.set[I]];E=Ye.ofSortedArray(A)}else if(0===w)Cn.forEach(h.ranges,function(U,H){return A[H]=x[U]}),E=Ye.ofSortedArray(A);else if(Ye.min(h.set)>Cn.max(h.ranges)){for(Cn.forEach(h.ranges,function(U,H){return A[H]=x[U]}),I=0,M=w;I<M;++I)A[I+D]=x[h.set[I]];E=Ye.ofSortedArray(A)}else if(Cn.min(h.ranges)>Ye.max(h.set)){for(I=0,M=w;I<M;++I)A[I]=x[h.set[I]];Cn.forEach(h.ranges,function(U,H){return A[H+w]=x[U]}),E=Ye.ofSortedArray(A)}else{for(Cn.forEach(h.ranges,function(U,H){return A[H]=x[U]}),I=0,M=w;I<M;++I)A[I+D]=x[h.set[I]];E=Ye.ofUnsortedArray(A)}for(var F=0,N=_;F<N.length;F++)f.push(N[F].getChild(E))},g=0,y=h.groupedUnits;g<y.length;g++)v(y[g]);return Ze.create(f,{parent:d})},e.toExpression=function u(l){return fe.internal.generator.bundle({elements:fe.core.type.list(l.elements.map(s))})},e.areEqual=function c(l,d){if(l.elements.length!==d.elements.length)return!1;for(var f=0,p=l.elements.length;f<p;++f){var m=l.elements[f],h=d.elements[f];if(m.groupedUnits.length!==h.groupedUnits.length)return!1;for(var v=0,g=h.groupedUnits.length;v<g;++v)if(!Ye.areEqual(m.groupedUnits[v],h.groupedUnits[v]))return!1;if(!Ye.areEqual(m.set,h.set)||!Cn.areEqual(m.ranges,h.ranges))return!1}return!0}}(rn||(rn={}));var tQ,Rc=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=ia(),this.element=at.create(void 0),this.currentStructure=void 0,this.atomicBond=new eQ,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=at.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new eQ,this.atomicBond},e.prototype.popCurrentBond=function(){this.atomicBond=this.currentAtomicBondStack.length>0?this.currentAtomicBondStack.pop():void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructure=this.currentStructureStack.length?this.currentStructureStack.pop():void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(0===this.inputStructureStack.length)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(0!==this.timeoutMs&&ia()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> ".concat(this.timeoutMs/1e3,"s)."))},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),eQ=function(){function e(){this.a=at.create(void 0),this.aIndex=0,this.b=at.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.key=-1,this.testFn=U4}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||U4},e.prototype.test=function(t,r){return!!this.testFn(t)||!!r&&(this.swap(),this.testFn(t))},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return at.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}();!function(e){e.run=function t(r,n,a){return r(new Rc(n,a))}}(tQ||(tQ={}));var V4=function(){function e(t){this.source=t,this.set=tF(Ze.hashCode,Ze.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){t.elementCount&&(1!==t.elementCount&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?ht.Singletons(this.source,r2(this.source,this.structures)):ht.Sequence(this.source,this.structures)},e}(),Lke=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=at.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return ht.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return ht.Sequence(this.source,t)},e.prototype.getSelection=function(){return 0===this.builders.length?ht.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),G4=function(e){return ht.Sequence(e.inputStructure,[])},rQ=function(e){return ht.Singletons(e.inputStructure,e.inputStructure)};function Uke(e){return z4(R(R({},e),{groupBy:function(t){return ot.residue.key(t.element)}}))}function Vke(e){return z4(R(R({},e),{groupBy:function(t){return ot.chain.key(t.element)}}))}function gm(e){return!0}function Gke(e){return 0}function z4(e){if(!e||!(e.atomTest||e.residueTest||e.chainTest||e.entityTest||e.unitTest||e.groupBy))return rQ;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return function zke(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var c=u[s];i.unit=c;var l=c.elements;o.beginUnit(c.id);for(var d=0,f=l.length;d<f;d++)i.element=l[d],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),ht.Singletons(n,o.getStructure())}}(e.atomTest);var t={unitTest:e.unitTest||gm,entityTest:e.entityTest||gm,chainTest:e.chainTest||gm,residueTest:e.residueTest||gm,atomTest:e.atomTest||gm,groupBy:e.groupBy||Gke};return e.groupBy?function jke(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var c=u.inputStructure,l=c.units,d=u.pushCurrentElement(),f=new Lke(c);d.structure=c;for(var p=0,m=l;p<m.length;p++){var h=m[p];if(d.unit=h,t(u)){var v=h.elements,g=h.model;if(0===h.kind)for(var y=pr.transientSegments(g.atomicHierarchy.chainAtomSegments,v),S=pr.transientSegments(g.atomicHierarchy.residueAtomSegments,v);y.hasNext;){var C=y.move();if(d.element=v[C.start],r(u)&&n(u))for(S.setSegment(C);S.hasNext;){var _=S.move();if(d.element=v[_.start],a(u))for(var x=_.start,D=_.end;x<D;x++)d.element=v[x],i(u)&&f.add(o(u),h.id,d.element)}}else for(y=pr.transientSegments(g.coarseHierarchy.spheres.chainElementSegments,v);y.hasNext;)if(C=y.move(),d.element=v[C.start],r(u)&&n(u))for(x=C.start,D=C.end;x<D;x++)d.element=v[x],a(u)&&f.add(o(u),h.id,d.element);u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}(t):function Hke(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,c=u.units,l=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=a===gm&&i===gm,p=i===gm;l.structure=u;for(var m=0,h=c;m<h.length;m++){var v=h[m];if(l.unit=v,t(s)){var g=v.elements,y=v.model;if(d.beginUnit(v.id),0===v.kind)for(var S=pr.transientSegments(v.model.atomicHierarchy.chainAtomSegments,g),C=pr.transientSegments(v.model.atomicHierarchy.residueAtomSegments,g);S.hasNext;){var _=S.move();if(l.element=g[_.start],r(s)&&n(s)){if(f){d.addElementRange(g,_.start,_.end);continue}for(C.setSegment(_);C.hasNext;){var x=C.move();if(l.element=g[x.start],a(s)){if(p){d.addElementRange(g,x.start,x.end);continue}for(var D=x.start,w=x.end;D<w;D++)l.element=g[D],i(s)&&d.addElement(l.element)}}}}else for(S=pr.transientSegments(y.coarseHierarchy.spheres.chainElementSegments,g);S.hasNext;)if(_=S.move(),l.element=g[_.start],r(s)&&n(s)){if(f){d.addElementRange(g,_.start,_.end);continue}for(D=_.start,w=_.end;D<w;D++)l.element=g[D],a(s)&&d.addElement(l.element)}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),ht.Singletons(u,d.getStructure())}}(t)}function H4(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return Ze.create([e.getChild(Ye.ofSortedArray(n))],{parent:r})}function qke(e,t){return function(n){var a=n.inputStructure.units,i=ht.LinearBuilder(n.inputStructure);if(e&&0!==e.length){for(var m=En.create(),h=0;h<e.length;h++)En.add(m,e[h],e[h]);for(var v=0,g=a;v<g.length;v++)if(Fe.isAtomic(u=g[v]))for(var y=u.rings,S=0,C=m.array;S<C.length;S++){var _=C[S];if(y.byFingerprint.has(_))for(var x=0,D=y.byFingerprint.get(_);x<D.length;x++)d=D[x],t&&!y.aromaticRings.includes(d)||i.add(H4(u,y.all[d],n.inputStructure))}}else for(var o=0,s=a;o<s.length;o++){var u;if(Fe.isAtomic(u=s[o]))if(t)for(var c=0,l=u.rings.aromaticRings;c<l.length;c++)i.add(H4(u,u.rings.all[d=l[c]],n.inputStructure));else for(var f=0,p=u.rings.all;f<p.length;f++){var d;i.add(H4(u,d=p[f],n.inputStructure))}}return i.getSelection()}}function Wke(e,t,r){return void 0===r&&(r=!1),function(a){var i=e(a);if(0===ht.structureCount(i))return i;var o=r?L4(a.inputStructure,ht.unionStructure(i)):ht.unionStructure(i);if(0===o.elementCount)return ht.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),ht.withInputStructure(s,a.inputStructure)}}function Yke(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=ht.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var c=u[s];if(0===c.kind){var l=c.bonds,d=l.offset,f=l.b,p=l.edgeProps,m=p.flags,h=p.order,v=p.key;o.a.unit=c,o.b.unit=c;for(var g=0,y=c.elements.length;g<y;g++){o.aIndex=g,o.a.element=c.elements[g];for(var S=d[g],C=d[g+1];S<C;S++)o.bIndex=f[S],o.b.element=c.elements[f[S]],o.type=m[S],o.order=h[S],o.key=v[S],o.test(r,!1)&&((_=n.subsetBuilder(!1)).beginUnit(c.id),_.addElement(o.a.element),_.addElement(o.b.element),_.commitUnit(),i.add(_.getStructure()))}}}for(var x=0,D=a.edges;x<D.length;x++){var _,w=D[x];o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitB),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.key=w.props.key,o.test(r,!1)&&((_=n.subsetBuilder(!1)).addToUnit(o.a.unit.id,o.a.element),_.addToUnit(o.b.unit.id,o.b.element),i.add(_.getStructure()))}return r.popCurrentBond(),i.getSelection()}}var j4,rv,zA=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=xc.Mutable(),this.parentId=-1,this.currentUnit=En.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)En.add(n,r,r)&&this.elementCount++;else{var a=En.create();En.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return!!n&&En.has(n,r)},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.unitMap.has(t)?this.unitMap.get(t):this.currentUnit.array.length>0?En.create():this.currentUnit},e.prototype.addElement=function(t){En.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){0===this.currentUnit.array.length||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return Ze.Empty;var t=[];bc(this.ids);for(var r=wd.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array;if(s.length!==o.elements.length){s.length>1&&bc(s);var c=o.getChild(Ye.ofSortedArray(s)),l=r.add(c.id,c);c!==l&&(c=l.applyOperator(c.id,c.conformation.operator,!0)),t[t.length]=c}else t[t.length]=o,r.add(o.id,o)}return Ze.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.elementCount},enumerable:!1,configurable:!0}),e}(),Xke={type_symbol:ie.Schema.Aliased(Br.atom_site.type_symbol),label_atom_id:Br.atom_site.label_atom_id,auth_atom_id:Br.atom_site.auth_atom_id,label_alt_id:Br.atom_site.label_alt_id,label_comp_id:Br.atom_site.label_comp_id,auth_comp_id:Br.atom_site.auth_comp_id,pdbx_formal_charge:Br.atom_site.pdbx_formal_charge},Kke={group_PDB:Br.atom_site.group_PDB,label_seq_id:Br.atom_site.label_seq_id,auth_seq_id:Br.atom_site.auth_seq_id,pdbx_PDB_ins_code:Br.atom_site.pdbx_PDB_ins_code},Zke={label_asym_id:Br.atom_site.label_asym_id,auth_asym_id:Br.atom_site.auth_asym_id,label_entity_id:Br.atom_site.label_entity_id};!function(e){e.EmptyResidueKey=function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}}(j4||(j4={})),function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainStartResidueIndex=t,e.chainEndResidueIndexExcl=r,e.chainResidueCount=function n(a,i){return r(a,i)-t(a,i)}}(rv||(rv={}));var HA={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},Qke={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},$ke={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},Jke=1.7,tLe=0;function n2(e){var t=HA[e];return void 0===t?Jke:Qke[t]}function a2(e){var t=HA[e];return void 0===t?tLe:t}function nQ(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var mr,aLe=9,jA=-27.888,iLe=-.5,aQ=-9.9;function oLe(e,t,r,n){var a=b.distance(e,n),i=b.distance(t,n),o=b.distance(t,r),s=b.distance(e,r),l=jA/a-jA/i+(jA/o-jA/s);return l<aQ?aQ:l}!function(e){e.is=Vo.has,e.create=Vo.create}(mr||(mr={}));var qA=function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n};function dLe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(0===t.type){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function fLe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&0===t.nextLadder&&(0===e.type?iQ(e,t):iQ(t,e))}function iQ(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function oQ(e){return mr.is(e,8)||mr.is(e,1)||mr.is(e,16)}var ep,nv,bLe={oldDefinition:T.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:T.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function SLe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,d,p,m,h,v,g,y,S,C,_,x;return ce(this,function(D){for(r=function yLe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),c=new Int32Array(a),l=0;l<a;++l){var d=n[r[l]];i[l]=d,o[l]=t.findAtomOnResidue(d,"C"),s[l]=t.findAtomOnResidue(d,"H"),u[l]=t.findAtomOnResidue(d,"O"),c[l]=t.findAtomOnResidue(d,"N")}return{residueIndices:Ye.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:c}}(e),a=function gLe(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,c=t.length;u<c;++u)s[u]=o[t[u]];var l={x:n,y:a,z:i,indices:Ye.ofSortedArray(s)};return Df(l,Jf(l))}(e,n=r.residueIndices),i=function sLe(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,c=e.conformation.invariantPosition,l=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],p=[],m=[],h=b(),v=b(),g=b(),y=b(),S=b(),C=b(),_=b(),x=0,D=n.length;x<D;++x){var w=x,A=n[x],E=s[w],I=a[w],M=l[A];if(-1!==E&&-1!==I&&-1===u.findAtomOnResidue(A,"OXT")){c(E,h),c(I,v),c(M,g);for(var F=r.find(g[0],g[1],g[2],aLe),N=F.indices,j=F.count,U=0;U<j;++U){var H=N[U];if(H!==w&&H-1!==w&&H+1!==w){var z=o[H];if(-1!==z){c(z,y);var G=i[H];if(-1===G){if(0===H)continue;var J=H-1,X=s[J],Z=a[J];if(-1===X||-1===Z)continue;c(X,_),c(Z,C),b.sub(S,C,_);var ne=b.distance(_,C);b.scaleAndAdd(S,y,S,1/ne)}else c(G,S);var Y=oLe(h,v,y,S);Y>iLe||(f[f.length]=w,p[p.length]=H,m[m.length]=Y)}}}}}return function uLe(e,t,r,n){for(var a=new fu.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}(d,f,p,m)}(e,r,a),o=n.length,s=new Uint32Array(o),u=function vLe(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,c=function(x,D){return-1===x?b.setNaN(D):i(x,D)},l=b(),d=b(),f=b(),p=b(),m=b(),h=b(),v=b(),g=b(),y=b();if(0===u)return{phi:new Float32Array(0),psi:new Float32Array(0)};var S=new Float32Array(u-1),C=new Float32Array(u-1);c(-1,l),c(-1,d),c(-1,f),c(r[0],p),c(s[a[0]],m),c(n[0],h),c(r[1],v),c(s[a[1]],g),c(n[1],y);for(var _=0;_<u-1;++_)-1===o.findAtomOnResidue(a[_],"OXT")&&(S[_]=Ru(b.dihedralAngle(l,h,m,p)),C[_]=Ru(b.dihedralAngle(h,m,p,y)),l=p,d=m,f=h,p=v,m=g,h=y,c(r[_+1],v),c(s[a[_+1]],g),c(n[_+1],y));return{phi:S,psi:C}}(e,r),function cLe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(-1!==r.getDirectedEdgeIndex(o,o+i+3))if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=64|a[i+3];else for(u=0;u<=i+3;++u)n[o+u]|=64|a[i+3]}(p={params:t,getResidueFlag:d=t.oldDefinition?_Le:ALe,getFlagName:t.oldOrdering?wLe:TLe,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:[],bridges:[]}),function lLe(e){for(var r=e.flags,n=e.proteinInfo.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],c=1,l=n-u;c<l;c++){var d=mr.create(r[c]),f=mr.create(r[c-1]),p=mr.create(r[c+1]);if(e.params.oldOrdering){if(3===u&&(mr.is(d,1)||mr.is(p,1))||5===u&&(mr.is(d,1)||mr.is(d,8)||mr.is(p,1)||mr.is(p,8)))continue}else if(4===u&&(mr.is(d,8)||mr.is(p,8))||5===u&&(mr.is(d,1)||mr.is(d,8)||mr.is(p,1)||mr.is(p,8)))continue;if(mr.is(d,a[u])&&mr.is(d,a[u-3])&&mr.is(f,a[u])&&mr.is(f,a[u-3]))if(e.params.oldDefinition)for(var m=0;m<u;m++)r[c+m]|=i[u];else for(m=-1;m<=u;m++)r[c+m]|=i[u]}}(p),function nLe(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,c=function(I,M){return-1===I?b.setNaN(M):a(I,M)},l=b(),d=b(),f=b(),p=b(),m=b(),h=b(),v=b();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var S=g+y-2;if(c(i[S],p),c(s[S+1],m),b.squaredDistance(p,m)>6.25)continue e}var w=i[o[g]],A=i[o[g+2]];c(i[o[g-2]],l),c(w,d),c(A,f),b.sub(h,l,d),b.sub(v,d,f);var E=Ru(b.angle(h,v));E&&E>70&&(r[g]|=32)}}(p),function mLe(e){for(var s,u,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,c=0,l=e.proteinInfo.residueIndices.length;c<l;++c)for(var d=i[c],f=i[c+1];d<f;d++){var p=o[d];c>p||((s=c+1)!==(u=p)&&-1!==r.getDirectedEdgeIndex(u,s+1)&&(n[s]|=2,n[u]|=2,a[a.length]=new qA(s,u,0)),(s=c)!==(u=p-1)&&-1!==r.getDirectedEdgeIndex(u-1,s)&&(n[s]|=2,n[u]|=2,a[a.length]=new qA(u,s,0)),(s=c)!==(u=p)&&-1!==r.getDirectedEdgeIndex(u,s)&&(n[s]|=2,n[u]|=2,a[a.length]=new qA(u,s,1)),(s=c+1)!==(u=p-1)&&-1!==r.getDirectedEdgeIndex(u-1,s+1)&&(n[s]|=2,n[u]|=2,a[a.length]=new qA(u,s,1)))}a.sort(function(m,h){return m.partner1>h.partner1?1:m.partner1<h.partner1?-1:0})}(p),function pLe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];dLe(s,a)&&(i=!0,s.firstEnd++,0===a.type?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var c=r[u],l=u;l<r.length;l++){var d=r[l];fLe(c,d)&&(c.nextLadder=l,d.previousLadder=u)}}(p),function hLe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var s=a.secondStart-(a.firstStart-i);a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!oQ(r[i])&&mr.is(r[i],4)&&(r[i]|=2),!oQ(r[s])&&mr.is(r[s],4)&&(r[s]|=2))}if(0!==a.nextLadder){var u=t[a.nextLadder];for(i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(0===a.type)for(i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}(p),m=function DLe(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=mr.create(e[n]);r[n]=t(i)}return r}(s,d),h=new Uint32Array(o),v=[],g=[],y=function(w){return Ye.indexOf(n,w)},S=0,C=n.length;S<C;++S)h[S]=_=m[S],x=d(s[S]),(0===g.length||x!==g[g.length-1].flags)&&(g[g.length]=CLe(xLe(_),s[S],d)),v[S]=g.length-1;return[2,nQ(h,v,g,y)]})})}function CLe(e,t,r){return"helix"===e?{kind:"helix",flags:r(t)}:"sheet"===e?{kind:"sheet",flags:r(t)}:"turn"===e||"bend"===e?{kind:"turn",flags:r(t)}:{kind:"none"}}function xLe(e){return e===sn.SecondaryStructureDssp.H||e===sn.SecondaryStructureDssp.G||e===sn.SecondaryStructureDssp.I?"helix":e===sn.SecondaryStructureDssp.B||e===sn.SecondaryStructureDssp.E?"sheet":e===sn.SecondaryStructureDssp.T?"turn":e===sn.SecondaryStructureDssp.S?"bend":"none"}function _Le(e){return mr.is(e,1)?sn.SecondaryStructureDssp.H:mr.is(e,4)?sn.SecondaryStructureDssp.E:mr.is(e,2)?sn.SecondaryStructureDssp.B:mr.is(e,8)?sn.SecondaryStructureDssp.G:mr.is(e,16)?sn.SecondaryStructureDssp.I:mr.is(e,64)?sn.SecondaryStructureDssp.T:mr.is(e,32)?sn.SecondaryStructureDssp.S:0}function wLe(e){return mr.is(e,1)?"H":mr.is(e,4)?"E":mr.is(e,2)?"B":mr.is(e,8)?"G":mr.is(e,16)?"I":mr.is(e,64)?"T":mr.is(e,32)?"S":"-"}function ALe(e){return mr.is(e,16)?sn.SecondaryStructureDssp.I:mr.is(e,1)?sn.SecondaryStructureDssp.H:mr.is(e,4)?sn.SecondaryStructureDssp.E:mr.is(e,2)?sn.SecondaryStructureDssp.B:mr.is(e,8)?sn.SecondaryStructureDssp.G:mr.is(e,64)?sn.SecondaryStructureDssp.T:mr.is(e,32)?sn.SecondaryStructureDssp.S:0}function TLe(e){return mr.is(e,16)?"I":mr.is(e,1)?"H":mr.is(e,4)?"E":mr.is(e,2)?"B":mr.is(e,8)?"G":mr.is(e,64)?"T":mr.is(e,32)?"S":"-"}function MLe(e,t,r,n,a,i){for(var o=e.residues,c=o.pdbx_PDB_ins_code,l=r.endSeqId,d=r.endInsCode,f=r.key,p=r.type,m="label"===t?o.label_seq_id:o.auth_seq_id,h=n;h<a;){var v=m.value(h);if(i.type[h]=p,i.key[h]=f,v>l||v===l&&c.value(h)===d)break;h++}}function sQ(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(ar.isFromPdbArchive(a)||ar.hasSecondaryStructure(a)){t="model";break}}}return{type:T.MappedStatic(t,{model:T.EmptyGroup({label:"Model"}),dssp:T.Group(bLe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}!function(e){function t(n){var a=this,i=n.descriptor.name,o="root"===n.type?"inheritedPropertyData":"currentPropertyData",s=function(c){return i in c[o]||(c[o][i]={props:R({},T.getDefaultValues(n.getParams(c))),data:zp.create(void 0)}),c[o][i]},u=function(c,l,d){var f=s(c);c[o][i]={props:l,data:zp.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(c){var l=T.clone(n.getParams(c));return T.setDefaultValues(l,s(c).props),l},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(c,l,d,f){return void 0===d&&(d={}),ue(a,void 0,void 0,function(){var p,m,h,v,g,y;return ce(this,function(S){switch(S.label){case 0:return f&&l.customPropertyDescriptors.reference(n.descriptor,!0),"root"===n.type&&(l=l.root),p=s(l.root).props,m=s(l),h=T.merge(n.defaultParams,p,d),m.data.value&&T.areEqual(n.defaultParams,m.props,h)?[2]:[4,n.obtain(c,l,h)];case 1:return v=S.sent(),g=v.value,y=v.assets,l.customPropertyDescriptors.add(n.descriptor),l.customPropertyDescriptors.assets(n.descriptor,y),u(l,h,g),[2]}})})},ref:function(c,l){return c.customPropertyDescriptors.reference(n.descriptor,l)},get:function(c){return s(c).data},set:function(c,l,d){void 0===l&&(l={}),"root"===n.type&&(c=c.root);var f=s(c),p=T.merge(n.defaultParams,f.props,l);T.areEqual(n.defaultParams,f.props,p)||(u(c,p,d),c.customPropertyDescriptors.assets(n.descriptor))},props:function(c){return s(c).props}}}e.createProvider=t,e.createSimple=function r(n,a,i){var o=this,s={value:T.Value(i,{isHidden:!0})};return t({label:yc(n),descriptor:Hu({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:T.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,c,l){return ue(o,void 0,void 0,function(){return ce(this,function(d){return[2,R(R({},T.getDefaultValues(s)),l)]})})}})}}(ep||(ep={})),function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=_l.create(e.Descriptor),e.fromStruct=function t(r,n,a){var i=new Map,o=[{kind:"none"}],s=function ELe(e,t){if(e._rowCount>0){if(0!==e.beg_label_seq_id.valueKind(0)||0!==e.end_label_seq_id.valueKind(0))return"auth"}else if(t&&(0!==t.beg_label_seq_id.valueKind(0)||0!==t.end_label_seq_id.valueKind(0)))return"auth";return"label"}(r,n);(function ILe(e,t,r,n){if(e._rowCount)for(var a=e.beg_label_asym_id,s=e.pdbx_beg_PDB_ins_code,l=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,p=e.details,m="label"===t?e.beg_label_seq_id:e.beg_auth_seq_id,h="label"===t?e.end_label_seq_id:e.end_auth_seq_id,v=0,g=e._rowCount;v<g;v++){var y=sn.create(0===d.valueKind(v)?sn.SecondaryStructurePdb[d.value(v)]:0===f.valueKind(v)?sn.SecondaryStructureMmcif[f.value(v)]:536870912),S={kind:"helix",flags:y,type_id:0===f.valueKind(v)?f.value(v):"helx_p",helix_class:d.value(v),details:0===p.valueKind(v)?p.value(v):void 0},C={startSeqId:m.value(v),startInsCode:s.value(v),endSeqId:h.value(v),endInsCode:l.value(v),type:y,key:n.length};n[n.length]=S;var _=a.value(v);if(r.has(_)){var x=r.get(_);x.has(C.startSeqId)?x.get(C.startSeqId).push(C):x.set(C.startSeqId,[C])}else r.set(_,new Map([[C.startSeqId,[C]]]))}})(r,s,i,o),function PLe(e,t,r,n,a){if(e._rowCount)for(var i=e.beg_label_asym_id,u=e.pdbx_beg_PDB_ins_code,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,p="label"===t?e.beg_label_seq_id:e.beg_auth_seq_id,m="label"===t?e.end_label_seq_id:e.end_auth_seq_id,h=new Map,v=n+1,g=0,y=e._rowCount;g<y;g++){var S=f.value(g),C=void 0;h.has(S)?C=h.get(S):(C=v++,h.set(S,C));var _=sn.create(8388612),x={kind:"sheet",flags:_,sheet_id:S,symmetry:void 0},D={startSeqId:p.value(g),startInsCode:u.value(g),endSeqId:m.value(g),endInsCode:d.value(g),type:_,key:a.length};a[a.length]=x;var w=i.value(g);if(r.has(w)){var A=r.get(w);A.has(D.startSeqId)?A.get(D.startSeqId).push(D):A.set(D.startSeqId,[D])}else r.set(w,new Map([[D.startSeqId,[D]]]))}}(n,s,i,r._rowCount,o);var u=a.residues._rowCount,l={type:new Int32Array(u),key:new Int32Array(u),elements:o};return i.size>0&&function RLe(e,t,r,n){for(var a=e.chainAtomSegments.count,i=e.chains.label_asym_id,o=e.residues,c=o.pdbx_PDB_ins_code,l="label"===t?o.label_seq_id:o.auth_seq_id,d=0;d<a;d++){var f=rv.chainStartResidueIndex(e,d),p=rv.chainEndResidueIndexExcl(e,d),m=i.value(d);if(r.has(m))for(var h=r.get(m),v=f;v<p;v++){var g=l.value(v);if(h.has(g))for(var S=0,C=h.get(g);S<C.length;S++){var _=C[S],x=c.value(v);_.startInsCode===x&&MLe(e,t,_,v,p,n)}}}}(a,s,i,l),nQ(l.type,l.key,l.elements,function(d){return d})}}(nv||(nv={}));var uQ=sQ(),Oc=ep.createProvider({label:"Secondary Structure",descriptor:Hu({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:uQ,getParams:sQ,isApplicable:function(e){return!0},obtain:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,i,o;return ce(this,function(s){switch(s.label){case 0:switch((n=R(R({},T.getDefaultValues(uQ)),r)).type.name){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,OLe(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,FLe(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function OLe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o;return ce(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?Fe.isAtomic(i=e.unitSymmetryGroups[n].units[0])&&!ar.isCoarseGrained(i.model)?[4,SLe(i,t)]:[3,3]:[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function FLe(e){return ue(this,void 0,void 0,function(){var t,r,n,a,i;return ce(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)Fe.isAtomic(a=e.unitSymmetryGroups[r].units[0])&&(i=nv.Provider.get(a.model))&&t.set(a.invariantId,i);return[2,t]})})}function Ma(){throw new Error("Property only available for atomic models.")}function tp(e){throw e?new Error("Property only available for coarse models (".concat(e,").")):new Error("Property only available for coarse models.")}var i2={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Ma()},occupancy:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Ma()},B_iso_or_equiv:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Ma()},sourceIndex:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Ma()},label_atom_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Ma()},auth_atom_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Ma()},label_alt_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Ma()},label_comp_id:WA,auth_comp_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Ma()},pdbx_formal_charge:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Ma()},vdw_radius:function(e){return Fe.isAtomic(e.unit)?n2(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Ma()}};function WA(e){return Fe.isAtomic(e.unit)||Ma(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function q4(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Ma()}function cQ(e){Fe.isAtomic(e.unit)||Ma();var t=e.unit.model.sequence.byEntityKey[Ls(e)];return t&&t.sequence.microHet.get(q4(e))||[WA(e)]}var kLe={key:function(e){return Fe.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Ma()},group_PDB:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Ma()},label_seq_id:q4,auth_seq_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Ma()},pdbx_PDB_ins_code:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Ma()},isNonStandard:function(e){return Fe.isAtomic(e.unit)?cQ(e).some(function(t){return"n"===e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]}):Ma()},hasMicroheterogeneity:function NLe(e){Fe.isAtomic(e.unit)||Ma();var t=e.unit.model.sequence.byEntityKey[Ls(e)];return t&&t.sequence.microHet.has(q4(e))},microheterogeneityCompIds:cQ,secondary_structure_type:function(e){var t;Fe.isAtomic(e.unit)||Ma();var r=null===(t=Oc.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId);return r?r.type[r.getIndex(e.unit.residueIndex[e.element])]:536870912},secondary_structure_key:function(e){var t;Fe.isAtomic(e.unit)||Ma();var r=null===(t=Oc.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId);return r?r.key[r.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:function(e){return Fe.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(WA(e)).type:Ma()}},LLe={key:function(e){return Fe.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Ma()},label_asym_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Ma()},auth_asym_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Ma()},label_entity_id:function(e){return Fe.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Ma()}},ULe={key:i2.key,entityKey:function(e){return Fe.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:tp()},x:i2.x,y:i2.y,z:i2.z,asym_id:function(e){return Fe.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):tp()},entity_id:function(e){return Fe.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):tp()},seq_id_begin:function(e){return Fe.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):tp()},seq_id_end:function(e){return Fe.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):tp()},sphere_radius:function(e){return Fe.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:tp("spheres")},sphere_rmsf:function(e){return Fe.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:tp("spheres")},gaussian_weight:function(e){return Fe.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:tp("gaussians")},gaussian_covariance_matrix:function(e){return Fe.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:tp("gaussians")}};function Ls(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var VLe={key:Ls,id:function(e){return e.unit.model.entities.data.id.value(Ls(e))},type:function(e){return e.unit.model.entities.data.type.value(Ls(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(Ls(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(Ls(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(Ls(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(Ls(e))},details:function(e){return e.unit.model.entities.data.details.value(Ls(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(Ls(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(Ls(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(Ls(e))},subtype:function(e){return e.unit.model.entities.subtype.value(Ls(e))},prd_id:function(e){var t,r;return null!==(r=null===(t=e.unit.model.entities.prd_id)||void 0===t?void 0:t.value(Ls(e)))&&void 0!==r?r:""}},GLe=[],zLe={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return Fe.Traits.is(e.unit.traits,Fe.Trait.MultiChain)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},operator_key:function(e){return e.unit.conformation.operator.key},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.id)||ra.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.operList)||GLe},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},ot={constant:{true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}},atom:i2,residue:kLe,chain:LLe,entity:VLe,unit:zLe,coarse:ULe},o2=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=null!==(r=t?.checkOperator)&&void 0!==r&&r}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||this.index.set(t.label_asym_id,r=new Map);var n=r.get(t.label_seq_id);return n||r.set(t.label_seq_id,n=[]),!this._find(t,n)&&(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=lQ(t);if(this.index.has(a)){var i=this.index.get(a),o=dQ(t);if(i.has(o))for(var s=i.get(o),u=fQ(t),c=pQ(t),l=mQ(t),d=null!==(r=hQ(t))&&void 0!==r?r:"1_555",f=0,p=s;f<p.length;f++){var m=p[f];if(m.label_comp_id===u&&m.label_alt_id===c&&m.ins_code===l&&(!this.checkOperator||(null!==(n=m.operator_name)&&void 0!==n?n:"1_555")===d))return m}}},e.getLabel=function(t,r){var n;return void 0===r&&(r=!1),"".concat(t.label_asym_id," ").concat(t.label_comp_id," ").concat(t.label_seq_id,":").concat(t.ins_code,":").concat(t.label_alt_id).concat(r?" "+(null!==(n=t.operator_name)&&void 0!==n?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:lQ(t),label_comp_id:fQ(t),label_seq_id:dQ(t),label_alt_id:pQ(t),ins_code:mQ(t),operator_name:null!==(r=hQ(t))&&void 0!==r?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(s.label_comp_id===t.label_comp_id&&s.label_alt_id===t.label_alt_id&&s.ins_code===t.ins_code&&(!this.checkOperator||(null!==(n=s.operator_name)&&void 0!==n?n:"1_555")===(null!==(a=t.operator_name)&&void 0!==a?a:"1_555")))return!0}return!1},e}(),lQ=ot.chain.label_asym_id,dQ=ot.residue.label_seq_id,fQ=ot.atom.label_comp_id,pQ=ot.atom.label_alt_id,mQ=ot.residue.pdbx_PDB_ins_code,hQ=ot.unit.operator_name;function ny(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(0===o.kind){var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,c=o.elements;n.beginUnit(o.id);for(var l=pr.transientSegments(s,c);l.hasNext;)for(var d=l.move().index,f=s.offsets[d],p=s.offsets[d+1];f<p;f++)Ye.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}else n.setUnit(o.id,o.elements)}return n.getStructure()}function HLe(e){return function(r){var n=e(r);if(ht.isSingleton(n))return ht.Singletons(r.inputStructure,ny(r,r.inputStructure,n.structure));for(var a=new V4(r.inputStructure),i=0,o=n.structures;i<o.length;i++)a.add(ny(r,r.inputStructure,o[i]));return a.getSelection()}}function W4(e,t,r,n){for(var a=new zA(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var c=u[s],l=c.conformation,d=l.x,f=l.y,p=l.z,m=c.elements,h=0,v=m.length;h<v;h++){var g=m[h];i.findIntoBuilder(d(g),f(g),p(g),o,a)}e.throwIfTimedOut()}return n.wholeResidues?ny(e,t,a.getStructure()):a.getStructure()}function vQ(e,t,r,n){var a=new zA(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,c=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var l=0,d=r.units;l<d.length;l++){var f=d[l];e.element.unit=f;for(var p=f.conformation,m=p.x,h=p.y,v=p.z,g=f.elements,y=0,S=g.length;y<S;y++){var C=g[y];e.element.element=C;var _=o(e);i.findIntoBuilderWithRadius(m(C),h(C),v(C),_,u,c,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?ny(e,t,a.getStructure()):a.getStructure()}function jLe(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function qLe(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){e.element.element=o[s];var l=t(e);l>r&&(r=l)}}return e.throwIfTimedOut(),r}function WLe(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=R(R({},t),{elementRadius:t.elementRadius,elementRadiusClosure:jLe(n,t.elementRadius),sourceMaxRadius:qLe(n,t.elementRadius)});if(ht.isSingleton(a)){var o=vQ(n,n.inputStructure,a.structure,i);return ht.Singletons(n.inputStructure,o)}for(var u=new V4(n.inputStructure),c=0,l=a.structures;c<l.length;c++)u.add(vQ(n,n.inputStructure,l[c],i));return u.getSelection()}if(ht.isSingleton(a))return o=W4(n,n.inputStructure,a.structure,t),ht.Singletons(n.inputStructure,o);u=new V4(n.inputStructure);for(var f=0,p=a.structures;f<p.length;f++)u.add(W4(n,n.inputStructure,p[f],t));return u.getSelection()}}function YLe(e,t){return function(n){var a=e(n);if(0===ht.structureCount(a))return a;var i=ht.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return ht.forEach(a,function(s,u){n.pushInputStructure(s),ht.forEach(t(n),o),n.popInputStructure(),u%10==0&&n.throwIfTimedOut()}),i.getSelection()}}function XLe(e,t){return function(n){var a=e(n);if(0===ht.structureCount(a))return a;var i=t(n);if(0===ht.structureCount(i))return ht.Empty(n.inputStructure);var o=ht.unionStructure(i),s=ht.UniqueBuilder(n.inputStructure);return ht.forEach(a,function(u,c){var l=QZ(o,u);0!==l.elementCount&&s.add(l),c%50==0&&n.throwIfTimedOut()}),s.getSelection()}}function KLe(e,t){return function(n){var a=e(n);if(0===ht.structureCount(a))return a;var i=t(n);if(0===ht.structureCount(i))return a;var o=ht.unionStructure(i),s=ht.UniqueBuilder(n.inputStructure);return ht.forEach(a,function(u,c){var l=L4(u,o);0!==l.elementCount&&s.add(l),c%50==0&&n.throwIfTimedOut()}),s.getSelection()}}function ZLe(e){return function(r){var n=ht.LinearBuilder(r.inputStructure);return n.add(ht.unionStructure(e(r))),n.getSelection()}}function QLe(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),ht.forEach(a,function(_,x){n.element.structure=_;for(var D=0,w=_.units;D<w.length;D++){var A=w[D];n.element.unit=A;for(var E=A.elements,I=0,M=E.length;I<M;I++){n.element.element=E[I];var F=t(n),N=void 0;i.has(F)?N=i.get(F):(N=En.create(),i.set(F,N)),En.add(N,x,x)}}o[x]=n.inputStructure.subsetBuilder(!0),x%10==0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var c=u[s];n.element.unit=c;for(var l=c.elements,d=0,f=l.length;d<f;d++){n.element.element=l[d];var p=t(n);if(i.has(p))for(var m=i.get(p).array,h=0,v=m.length;h<v;h++)o[m[h]].addToUnit(c.id,l[d])}}n.popCurrentElement();for(var g=ht.UniqueBuilder(n.inputStructure),y=0,S=o;y<S.length;y++)g.add(S[y].getStructure());return g.getSelection()}}function $Le(e){var t=e.query,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(e.layerCount,0);return function(u){var c=ht.UniqueBuilder(u.inputStructure),l=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),ht.forEach(l,function(d,f){var p=d;if(i)for(;;){var m=p.elementCount;if((p=gQ(u,n,p)).elementCount===m)break}else for(var h=0;h<o;h++)p=gQ(u,n,p);c.add(p),f%10==0&&u.throwIfTimedOut()}),u.popCurrentBond(),c.getSelection()}}function gQ(e,t,r){var n=function JLe(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new zA(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(0===u.kind){var d=r.unitMap.get(u.id),f=d.bonds,p=f.offset,m=f.b,h=f.edgeProps,v=h.flags,g=h.order,y=h.key;for(i.setStructure(r),i.a.unit=d,i.b.unit=d,c=0,l=u.elements.length;c<l;c++){a.addToUnit(u.id,u.elements[c]);for(var S=Ye.indexOf(d.elements,u.elements[c]),C=p[S],_=p[S+1];C<_;C++){var x=m[C];Ye.has(u.elements,D=d.elements[x])||a.has(u.id,D)||(i.aIndex=S,i.a.element=u.elements[c],i.bIndex=x,i.b.element=D,i.type=v[C],i.order=g[C],i.key=y[C],i.test(e,!0)&&a.addToUnit(u.id,D))}}for(var w=0,A=n.getConnectedUnits(d.id);w<A.length;w++)for(var E=A[w],I=t.unitMap.get(E.unitB),M=r.unitMap.get(E.unitB),F=0,N=E.connectedIndices;F<N.length;F++){var j=N[F];if(Ye.has(u.elements,d.elements[j]))for(var U=0,H=E.getEdges(j);U<H.length;U++){var z=H[U],D=M.elements[z.indexB];I&&Ye.has(I.elements,D)||a.has(E.unitB,D)||(i.a.unit=d,i.aIndex=j,i.a.element=d.elements[j],i.b.unit=M,i.bIndex=z.indexB,i.b.element=D,i.type=z.props.flag,i.order=z.props.order,i.key=z.props.key,i.test(e,!0)&&a.addToUnit(E.unitB,D))}}}else{a.beginUnit(u.id);for(var c=0,l=u.elements.length;c<l;c++)a.addElement(u.elements[c]);a.commitUnit()}}return a.getStructure()}(e,r);return t?ny(e,e.inputStructure,n):n}function e5e(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=ht.unionStructure(t(i)),s=ny(i,i.inputStructure,W4(i,i.inputStructure,o,{radius:r})),u=function n5e(e){var t=e.models[0],r=new Set;if(!Dn.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}(i.inputStructure),c=function a5e(e){var t,r,n=e.models[0],a=new i5e;if(!Dn.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,c=i.ptnr1_label_seq_id,l=i.ptnr1_symmetry,d=i.pdbx_ptnr1_label_alt_id,f=i.pdbx_ptnr1_PDB_ins_code,p=i.ptnr2_label_asym_id,m=i.ptnr2_label_comp_id,h=i.ptnr2_label_seq_id,v=i.ptnr2_symmetry,g=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,S=0;S<i._rowCount;S++){var C=o.value(S);if("covale"===C||"metalc"===C){var _={label_asym_id:s.value(S),label_comp_id:u.value(S),label_seq_id:c.value(S),label_alt_id:d.value(S),ins_code:f.value(S),operator_name:null!==(t=l.value(S))&&void 0!==t?t:"1_555"},x={label_asym_id:p.value(S),label_comp_id:m.value(S),label_seq_id:h.value(S),label_alt_id:g.value(S),ins_code:y.value(S),operator_name:null!==(r=v.value(S))&&void 0!==r?r:"1_555"};a.addEdge(_,x)}}return a}(i.inputStructure),l=at.create(s),d=new Map,f=new o2({checkOperator:!0}),p=0,m=s.units;p<m.length;p++)if(0===(h=m[p]).kind){l.unit=h;for(var g=pr.transientSegments(h.model.atomicHierarchy.chainAtomSegments,v=h.elements),y=pr.transientSegments(h.model.atomicHierarchy.residueAtomSegments,v);g.hasNext;){var S=g.move();l.element=v[S.start];var C=ot.chain.label_asym_id(l),_=ot.unit.operator_name(l);if(u.has(C))d.has(C)?Ya(d.get(C),_):d.set(C,[_]);else{var x=ot.entity.type(l);if("water"!==x&&"polymer"!==x)for(y.setSegment(S);y.hasNext;){var D=y.move();l.element=v[D.start],c.addComponent(o2.getEntryFromLocation(l),f)}}}i.throwIfTimedOut()}for(var w=i.inputStructure.subsetBuilder(!0),A=0,E=i.inputStructure.units;A<E.length;A++)if(0===(h=E[A]).kind){for(l.unit=h,g=pr.transientSegments(h.model.atomicHierarchy.chainAtomSegments,v=h.elements),y=pr.transientSegments(h.model.atomicHierarchy.residueAtomSegments,v),w.beginUnit(h.id);g.hasNext;)if(S=g.move(),l.element=v[S.start],C=ot.chain.label_asym_id(l),_=ot.unit.operator_name(l),d.has(C)&&d.get(C).indexOf(_)>=0)w.addElementRange(v,S.start,S.end);else if(f.hasLabelAsymId(C))for(y.setSegment(S);y.hasNext;)D=y.move(),l.element=v[D.start],f.has(l)&&w.addElementRange(v,D.start,D.end);w.commitUnit(),i.throwIfTimedOut()}var I=r2(i.inputStructure,[w.getStructure(),o]);if(n){for(var M=new zA(i.inputStructure),F=i.inputStructure.lookup3d,N=0,j=I.units;N<j.length;N++){for(var h,v,U=(h=j[N]).conformation,H=U.x,z=U.y,G=U.z,J=0,X=(v=h.elements).length;J<X;J++){var Z=v[J];F.findIntoBuilderIf(H(Z),z(Z),G(Z),r,M,r5e),M.addToUnit(h.id,Z)}i.throwIfTimedOut()}return ht.Sequence(i.inputStructure,[M.getStructure()])}return ht.Sequence(i.inputStructure,[I])}}var t5e=ot.entity.type;function r5e(e){return"water"===t5e(e)}var YA,XA,Y4,i5e=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=o2.getLabel(t),a=o2.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),Ya(this.edges.get(n),a),Ya(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=o2.getLabel(t);if(this.vertices.has(n)){var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),c=0,l=this.edges.get(s);c<l.length;c++){var d=l[c];if(!a.has(d)&&(o.push(d),!i.has(d))){i.add(d);var f=this.vertices.get(d);r.add(u.operator_name===f.operator_name?R(R({},f),{operator_name:t.operator_name}):f)}}}}else r.add(t)},e}();function u5e(e,t){return function(r){var n=e(r),a=ht.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),ht.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function c5e(e){return function(t){var r=e(t),n=ht.LinearBuilder(t.inputStructure);if("singletons"===r.kind){if(r.structure.elementCount>0){var a=r.structure.units[0],i=Ze.create([a.getChild(Ye.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function KA(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,c=t;if(c){for(var l=0,d=u.length;l<d;l++)a.element=u[l],r.add(c(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function d5e(e,t,r){return function(n){var a=e(n),i=function l5e(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),ht.forEach(a,function(i,o){e.currentStructure=i,KA(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}(n,t,r),o=ht.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),ht.forEach(a,function(s,u){n.currentStructure=s;var c=KA(n,r,new Set);sa.isSuperset(i,c)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function f5e(e,t){return function(r){var n=ht.unionStructure(t(r)),a=ht.LinearBuilder(r.inputStructure);return ht.forEach(e(r),function(i,o){GA(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function p5e(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return 0===r.minRadius&&typeof e.minRadius>"u"?function m5e(e){var t=e.queryCtx,r=e.selection,a=e.maxRadius,i=e.invert,o=ht.unionStructure(e.target).lookup3d,s=ht.LinearBuilder(t.inputStructure),u=b.zero();return ht.forEach(r,function(c,l){for(var d=c.units,f=!1,p=0,m=d.length;p<m;p++){for(var h=d[p],v=h.elements,g=h.conformation,y=g.position,S=g.r,C=0,_=v.length;C<_;C++){var x=v[C];if(y(x,u),o.check(u[0],u[1],u[2],a+S(x))){f=!0;break}}if(f)break}i&&(f=!f),f&&s.add(c),l%10==0&&t.throwIfTimedOut()}),s.getSelection()}(r):0===r.minRadius?function h5e(e){var t=e.queryCtx,r=e.selection,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=ht.unionStructure(e.target),u=ht.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),ht.forEach(r,function(c,l){var d=function s5e(e,t,r,n,a){return 0===t.elementCount||0===r.elementCount||(t.elementCount<=r.elementCount?XA.check(e,t,r,n,a):XA.check(e,r,t,n,a))}(t,s,c,a,o);i&&(d=!d),d&&u.add(c),l%10==0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}(r):function v5e(e){var t=e.queryCtx,r=e.selection,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=ht.unionStructure(e.target),c=ht.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),ht.forEach(r,function(l,d){var f=function o5e(e,t,r,n,a,i){return 0===t.elementCount||0===r.elementCount||(t.elementCount<=r.elementCount?YA.check(e,t,r,n,a,i):YA.check(e,r,t,n,a,i))}(t,u,l,a,i,s);o&&(f=!f),f&&c.add(l),d%10==0&&t.throwIfTimedOut()}),t.popCurrentElement(),c.getSelection()}(r)}}function y5e(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(ht.isEmpty(s))return s;var u=t(o);if(ht.isEmpty(u))return u;var c={queryCtx:o,input:o.inputStructure,disjunct:n,target:ht.unionStructure(s)},l=ht.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),ht.forEach(u,function(d,f){(function g5e(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,c=t.units;u<c.length;u++){var l=c[u];if(Fe.isAtomic(l))for(var d=n.unitMap.get(l.id),f=d.bonds,p=f.offset,m=f.b,h=f.edgeProps,v=h.flags,g=h.order,y=h.key,S=s.getConnectedUnits(l.id),C=S.length,_=l.elements,x=d.elements,D=0,w=_.length;D<w;D++){var A=Ye.indexOf(x,_[D]);o.a.unit=d,o.b.unit=d;for(var E=p[A],I=p[A+1];E<I;E++)if(o.b.element=d.elements[m[E]],(!i||!Ye.has(l.elements,o.b.element))&&a.hasElement(o.b)&&(o.aIndex=A,o.a.element=_[D],o.bIndex=m[E],o.type=v[E],o.order=g[E],o.key=y[E],o.test(r,!0)))return!0;for(var M=0;M<C;M++)for(var F=S[M],N=n.unitMap.get(F.unitB),j=N.elements,U=F.getEdges(A),H=0,z=U.length;H<z;H++){var G=U[H];if(o.b.unit=N,o.b.element=j[G.indexB],a.hasElement(o.b)&&(!i||!t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=A,o.a.element=_[D],o.bIndex=G.indexB,o.type=G.props.flag,o.order=G.props.order,o.key=G.props.key,o.test(r,!0)))return!0}}}return!1}(c,d)||a)&&l.add(d),f%5==0&&o.throwIfTimedOut()}),o.popCurrentBond(),l.getSelection()}}function b5e(e){return 0===e.length?G4:1===e.length?e[0]:function(t){for(var r=ht.UniqueBuilder(t.inputStructure),n=function(i){ht.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function S5e(e){return 0===e.length?G4:1===e.length?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));var a=0,i=ht.structureCount(r[0]);for(n=1;n<r.length;n++){var o=ht.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=tF(function(l){return l.hashCode},Ze.areUnitIdsAndIndicesEqual);ht.forEach(r[a],function(l){return s.add(l)});for(var u=ht.UniqueBuilder(t.inputStructure),c=0;c<r.length;c++)c!==a&&(ht.forEach(r[c],function(l){s.has(l)&&u.add(l)}),t.throwIfTimedOut());return u.getSelection()}}function C5e(e){return e.currentStructure.elementCount}function x5e(e){return function(t){var r=e(t);return ht.structureCount(r)}}function _5e(e){return function(t){return KA(t,e,new Set)}}!function(e){var t=b.zero();function r(o,s,u,c,l,d,f){var p=s.elements,m=s.conformation.position,h=t;o.element.unit=s;for(var v=!1,g=0,y=p.length;g<y;g++){var S=p[g];o.element.element=S;var C=Math.max(0,b.distance(u,m(S,h))-c-f(o));if(C<l)return 0;C<d&&(v=!0)}return v?1:2}function n(o,s,u,c,l,d,f){for(var p=s.units,m=!1,h=0,v=p.length;h<v;h++){var g=r(o,p[h],u,c,l,d,f);if(0===g)return 0;1===g&&(m=!0)}return m?1:2}var a=b.zero();e.check=function i(o,s,u,c,l,d){if(0===s.elementCount||0===u.elementCount)return 0;var f=s.units,p=!1;o.element.structure=s;for(var m=0,h=f.length;m<h;m++){var v=f[m],g=v.elements,y=v.conformation.position;o.element.unit=v;for(var S=0,C=g.length;S<C;S++){var _=g[S];o.element.element=_;var x=n(o,u,y(_,a),d(o),c,l,d);if(0===x)return!1;1===x&&(p=!0)}}return p}}(YA||(YA={})),function(e){var t=b.zero();function r(o,s,u,c,l,d){var f=s.elements,p=s.conformation.position,m=t;o.element.unit=s;for(var h=0,v=f.length;h<v;h++){var g=f[h];if(o.element.element=g,Math.max(0,b.distance(u,p(g,m))-c-d(o))<=l)return!0}return!1}function n(o,s,u,c,l,d){for(var f=s.units,p=0,m=f.length;p<m;p++)if(r(o,f[p],u,c,l,d))return!0;return!1}var a=b.zero();e.check=function i(o,s,u,c,l){if(0===s.elementCount||0===u.elementCount)return 0;var d=s.units;o.element.structure=s;for(var f=0,p=d.length;f<p;f++){var m=d[f];o.element.unit=m;for(var h=m.elements,v=m.conformation.position,g=0,y=h.length;g<y;g++){var S=h[g];if(o.element.element=S,n(o,u,v(S,a),l(o),c,l))return!0}}return!1}}(XA||(XA={})),function(e){function s(f){return!0}function u(f){return!1}e.eq=function r(f,p){return function(m){return f(m)===p}},e.lt=function n(f,p){return function(m){return f(m)<p}},e.lte=function a(f,p){return function(m){return f(m)<=p}},e.gt=function i(f,p){return function(m){return f(m)>p}},e.gte=function o(f,p){return function(m){return f(m)>=p}},e.inSet=function c(f,p){if(function t(f){return!!f&&!!f.has}(p))return function(v){return p.has(f(v))};if(0===p.length)return u;for(var m=new Set,h=0;h<p.length;h++)m.add(p[h]);return function(v){return m.has(f(v))}},e.and=function l(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return s;case 1:return f[0];case 2:var m=f[0],h=f[1];return function(G){return m(G)&&h(G)};case 3:var v=f[0],g=f[1],y=f[2];return function(G){return v(G)&&g(G)&&y(G)};case 4:var S=f[0],C=f[1],_=f[2],x=f[3];return function(G){return S(G)&&C(G)&&_(G)&&x(G)};case 5:var D=f[0],w=f[1],A=f[2],E=f[3],I=f[4];return function(G){return D(G)&&w(G)&&A(G)&&E(G)&&I(G)};case 6:var M=f[0],F=f[1],N=f[2],j=f[3],U=f[4],H=f[5];return function(G){return M(G)&&F(G)&&N(G)&&j(G)&&U(G)&&H(G)};default:var z=f.length;return function(G){for(var J=0;J<z;J++)if(!f[J])return!1;return!0}}},e.or=function d(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return u;case 1:return f[0];case 2:var m=f[0],h=f[1];return function(G){return m(G)||h(G)};case 3:var v=f[0],g=f[1],y=f[2];return function(G){return v(G)||g(G)||y(G)};case 4:var S=f[0],C=f[1],_=f[2],x=f[3];return function(G){return S(G)||C(G)||_(G)||x(G)};case 5:var D=f[0],w=f[1],A=f[2],E=f[3],I=f[4];return function(G){return D(G)||w(G)||A(G)||E(G)||I(G)};case 6:var M=f[0],F=f[1],N=f[2],j=f[3],U=f[4],H=f[5];return function(G){return M(G)||F(G)||N(G)||j(G)||U(G)||H(G)};default:var z=f.length;return function(G){for(var J=0;J<z;J++)if(f[J])return!0;return!1}}}}(Y4||(Y4={}));var wd,gn={generators:dE,filters:pE,modifiers:fE,combinators:mE,pred:Y4,internal:lE,atomset:hE};function w5e(e){return gn.generators.atoms({chainTest:gn.pred.and(gn.pred.eq(function(t){return ot.unit.operator_name(t.element)},ra.DefaultName),gn.pred.inSet(function(t){return ot.chain.label_asym_id(t.element)},e))})}function yQ(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],c=o.cell.toFractional,l=b.transformMat4(b(),i,c),d=au.getSymmetryOperatorRef(o,t,r,n,a,l);if(s&&s.length)for(var f=0,p=s.length;f<p;++f){var m=s[f],h=he.mul(he(),d.matrix,m.matrix),v=ra.create("".concat(d.name," ").concat(m.name),h,{assembly:d.assembly,ncsId:m.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(v)}else u.push(d);return u}function bQ(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=au.getSymmetryOperator(a,0,0,0,0));for(var u=0;u<a.operators.length;u++)for(var c=t[0];c<=r[0];c++)for(var l=t[1];l<=r[1];l++)for(var d=t[2];d<=r[2];d++)!o&&0===u&&0===c&&0===l&&0===d||s.push.apply(s,yQ(e,u,c,l,d,n));return s}function SQ(e,t){for(var r=Ze.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++)r.addWithOperator(u[s],o);return r.getStructure()}!function(e){function o(l,d){return l.invariantId===d.invariantId&&l.model.id===d.model.id&&Ye.areEqual(l.elements,d.elements)}function s(){return function q_e(e,t){return new j_e(e,t)}(Fe.hashUnit,o)}e.buildAssembly=function t(l,d){var f=this;return Ve.create("Build Assembly",function(p){return ue(f,void 0,void 0,function(){var m,h,v,g,y,S,C,_,x,D,w,A,E,I,M;return ce(this,function(N){if(1!==(m=l.models).length)throw new Error("Can only build assemblies from structures based on 1 model.");if(!(h=KS.findAssembly(m[0],d)))throw new Error("Assembly '".concat(d,"' is not defined."));for(v=ra.create(h.id,he.identity(),{assembly:{id:h.id,operId:0,operList:[]}}),g=Ze.Builder({coordinateSystem:v,label:l.label,dynamicBonds:l.dynamicBonds}),y=new Rc(l),S=0,C=h.operatorGroups;S<C.length;S++)if(x=(_=C[S]).selector(y),0!==ht.structureCount(x))for(D=ht.unionStructure(x).units,w=0,A=_.operators;w<A.length;w++)for(E=A[w],I=0,M=D;I<M.length;I++)g.addWithOperator(M[I],E);return[2,g.getStructure()]})})})},e.buildSymmetryAssembly=function r(l,d,f){var p=this;return Ve.create("Build Symmetry Assembly",function(m){return ue(p,void 0,void 0,function(){var h,v,g,y,S,C,_,x,D,w,A,E,I,F,H,z,G,J,X,Z;return ce(this,function(Y){if(1!==(h=l.models).length)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(v=b(),g=Ze.Builder({label:l.label,representativeModel:h[0],dynamicBonds:l.dynamicBonds}),y=new Rc(l),S=0,C=d;S<C.length;S++)if(x=w5e((_=C[S]).asymIds),D=x(y),0!==ht.structureCount(D))for(w=ht.unionStructure(D).units,A=0,E=_.operators;A<E.length;A++)for(H=yQ(f,(I=E[A]).index,(F=I.shift)[0],F[1],F[2],v),z=0,G=w;z<G.length;z++)for(J=G[z],X=0,Z=H;X<Z.length;X++)g.addWithOperator(J,Z[X]);return[2,g.getStructure()]})})})},e.builderSymmetryMates=function n(l,d){return Ve.create("Find Symmetry Mates",function(f){return function E5e(e,t,r){return ue(this,void 0,void 0,function(){function n(E,I){return"".concat(E.invariantId,"|").concat(I.name)}var a,i,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,A;return ce(this,function(E){switch(E.label){case 0:if(1!==(a=t.models).length)throw new Error("Can only build symmetries from structures based on 1 model.");return(i=Ja.Provider.get(a[0]))?ns.isZero(i.spacegroup.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]:[2,t];case 1:E.sent(),E.label=2;case 2:s=ar.getCenter(a[0]),u=function A5e(e,t){return e._operators_333&&b.equals(t,e._operators_333.ref)||(e._operators_333={ref:b.clone(t),operators:bQ(e,b.create(-3,-3,-3),b.create(3,3,3),t)}),e._operators_333.operators}(i,s),c=t.lookup3d,l=new Set,d=Ze.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),f=t.units,p=b.zero(),m=0,h=u,E.label=3;case 3:if(!(m<h.length))return[3,6];for(v=h[m],g=0,y=f;g<y.length;g++)for(b.transformMat4(p,(C=(S=y[g]).lookup3d.boundary.sphere).center,v.matrix),_=c.findUnitIndices(p[0],p[1],p[2],C.radius+r),x=0,D=_.count;x<D;x++)f[_.indices[x]].lookup3d.check(p[0],p[1],p[2],C.radius+r)&&(A=n(S,v),l.has(A)||(d.addWithOperator(S,v),l.add(A)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:E.sent(),E.label=5;case 5:return m++,[3,3];case 6:return[2,d.getStructure()]}})})}(f,l,d)})},e.buildSymmetryRange=function a(l,d,f){return Ve.create("Build Symmetry",function(p){return function D5e(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,s,u;return ce(this,function(c){if(1!==(a=t.models).length)throw new Error("Can only build symmetries from structures based on 1 model.");return(i=Ja.Provider.get(a[0]))?ns.isZero(i.spacegroup.cell)?[2,t]:(s=ar.getCenter(a[0]),u=bQ(i,r,n,s),[2,SQ(t,u)]):[2,t]})})}(0,l,d,f)})},e.buildNcs=function i(l){return Ve.create("Build NCS",function(d){return function T5e(e,t){return ue(this,void 0,void 0,function(){var r,n,a;return ce(this,function(i){if(1!==(r=t.models).length)throw new Error("Can only build NCS from structures based on 1 model.");return(n=Ja.Provider.get(r[0]))&&(a=n.ncsOperators)&&a.length?[2,SQ(t,a)]:[2,t]})})}(0,l)})},e.areUnitsEquivalent=o,e.UnitEquivalenceBuilder=s,e.computeTransformGroups=function u(l){for(var d=s(),f=0,p=l.units;f<p.length;f++){var m=p[f];d.add(m.id,m)}for(var h=[],v=0,g=d.groups;v<g.length;v++)h.push(Fe.SymmetryGroup(g[v].map(function(S){return l.unitMap.get(S)})));return h},e.areTransformGroupsEquivalent=function c(l,d){if(l.length!==d.length)return!1;for(var f=0,p=l.length;f<p;++f){var m=l[f].units,h=d[f].units;if(m.length!==h.length||l[f].hashCode!==d[f].hashCode)return!1;for(var v=0,g=m.length;v<g;v++)if(m[v].conformation!==h[v].conformation)return!1}return!0}}(wd||(wd={}));var I5e=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=xc.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){0!==this.currentUnit.length&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return Ze.Empty;var r=[];bc(this.ids);for(var n=wd.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),c=!1;if(t&&(this.isSorted||bc(u),u=Ye.deduplicate(Ye.ofSortedArray(this.currentUnit)),c=!0),u.length!==s.elements.length){!this.isSorted&&!c&&u.length>1&&bc(u);var d=s.getChild(Ye.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}else r[r.length]=s,n.add(s.id,s)}return Ze.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.elementCount},enumerable:!1,configurable:!0}),e}();function CQ(e,t){for(var r=1;t--;)r*=e--;return r}var R5e=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=function P5e(e,t){return t>e?0:CQ(e,t)/CQ(t,t)}(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)1&n&&(this.value[r++]=this.array[t]);this.index=function M5e(e){var t=e&-e,r=e+t;return r|((r&-r)/t>>1)-1}(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function xQ(e,t){for(var r=[],n=new R5e(e,t);n.hasNext;)r.push(n.move().slice());return r}var av=[],O5e={links:av,terminalLinks:av,elements:av,partialElements:av,getElementIndices:function(){return av},getLinkIndices:function(){return av},getTerminalLinkIndices:function(){return av}},Ji=$h("C"),s2=$h("O"),F5e=[Mc.elementFingerprint([Ji,Ji,Ji,s2]),Mc.elementFingerprint([Ji,Ji,Ji,Ji,s2]),Mc.elementFingerprint([Ji,Ji,Ji,Ji,Ji,s2]),Mc.elementFingerprint([Ji,Ji,Ji,Ji,Ji,Ji,s2])];function B5e(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,c=s.label_atom_id,l=e.bonds,d=l.b,f=l.offset,p=0,m=t.length;p<m;++p){var h=o[t[p]];if(u.value(h)===Ji){for(var v=0,g=0,y=f[t[p]],S=f[t[p]+1];y<S;++y){var _=u.value(o[d[y]]);_===s2?++v:_===Ji&&++g}if(2===v){r=h;break}1===v&&1===g?n=h:c.value(h).startsWith("C1")?a=h:i=h}}return-1!==r?r:-1!==n?n:-1!==a?a:-1!==i?i:o[t[0]]}function k5e(e,t,r,n){return b.normalize(e,b.sub(e,n,(0,t.conformation.position)(r,e))),e}function _Q(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function L5e(e,t){if(t&&t.length){for(var r=e.unit,n=e.all,a=new Set,i=xQ(Bu(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],c=n[t[u[0]]],l=n[t[u[1]]];Ye.areIntersecting(c,l)&&Mc.getAltId(r,c)===Mc.getAltId(r,l)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){var d=[];for(o=0,s=t.length;o<s;++o)a.has(t[o])||d.push(t[o]);return d}return t}}function U5e(e,t){return t.properties.saccharideComponentMap.get(e)}var ZA=Pe(),z5e=new Lu("14"),H5e=new Lu("98");var Ze=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i?.child,this._target=i?.target,this._proxy=void 0}return e.prototype.subsetBuilder=function(t){return new I5e(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return-1===this.state.bondCount&&(this.state.bondCount=this.interUnitBonds.edgeCount+zt.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Sl),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return-1===this.state.polymerResidueCount&&(this.state.polymerResidueCount=function J5e(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return-1===this.state.polymerGapCount&&(this.state.polymerGapCount=function eUe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return-1===this.state.polymerUnitCount&&(this.state.polymerUnitCount=function tUe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return-1===this.state.uniqueElementCount&&(this.state.uniqueElementCount=function $5e(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return-1===this.state.atomicResidueCount&&(this.state.atomicResidueCount=function rUe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(Fe.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,c=-1,l=0,d=o.length;l<d;++l)(u=s[o[l]])!==c&&(r+=1,c=u)}return r}(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return ar.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.units.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return-1!==this.state.hashCode?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return-1!==this.state.transformHash||(this.state.transformHash=rs(this.units.map(function(t){return t.id}))),this.state.transformHash},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*(t=31*t+a.id|0)+Ye.hashCode(a.elements)|0}return-1===(t=Yq(t=31*t+this.elementCount|0))&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){var t;return null!==(t=this.state.parent)&&void 0!==t?t:this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary||(this.state.boundary=function q5e(e){var t=e.units,r=function j5e(e){return e>500?z5e:H5e}(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var o=(i=t[n]).boundary;(s=i.conformation.operator).isIdentity?r.includeSphere(o.sphere):(Pe.transform(ZA,o.sphere,s.matrix),r.includeSphere(ZA))}for(r.finishedIncludeStep(),n=0,a=t.length;n<a;n++){var i,s;o=(i=t[n]).boundary,(s=i.conformation.operator).isIdentity?r.radiusSphere(o.sphere):(Pe.transform(ZA,o.sphere,s.matrix),r.radiusSphere(ZA))}return{box:r.getBox(),sphere:r.getSphere()}}(this)),this.state.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d||(this.state.lookup3d=new Mke(this)),this.state.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds||(this.state.interUnitBonds=this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&0===this.parent.state.interUnitBonds.edgeCount?new JS(new Map):nke(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair})),this.state.interUnitBonds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dynamicBonds",{get:function(){return this.state.dynamicBonds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interBondsValidUnit",{get:function(){return this.state.interBondsValidUnit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interBondsValidUnitPair",{get:function(){return this.state.interBondsValidUnitPair},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups||(this.state.unitSymmetryGroups=wd.computeTransformGroups(this)),this.state.unitSymmetryGroups},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap||(this.state.unitSymmetryGroupsIndexMap=Fe.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups)),this.state.unitSymmetryGroupsIndexMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates||(this.state.carbohydrates=function V5e(e){if(0===e.models.reduce(function(me,de){return me+de.properties.saccharideComponentMap.size},0))return O5e;var t=[],r=[],n=[],a=[],i=new Map;function o(me,de,re){return"".concat(me,"|").concat(de,"|").concat(re)}function s(me,de){i.has(me)?i.get(me).push(de):i.set(me,[de])}function u(me,de){b.sub(n[me].geometry.direction,n[de].geometry.center,n[me].geometry.center),b.normalize(n[me].geometry.direction,n[me].geometry.direction)}var c=b();function l(me,de,re){var le=n[me].geometry;b.sub(le.direction,(0,re.conformation.position)(re.elements[de],c),le.center),b.normalize(le.direction,le.direction)}for(var d=0,f=e.units.length;d<f;++d)if(Fe.isAtomic(p=e.units[d]))for(var m=p.model,h=p.rings,v=m.atomicHierarchy,y=v.residueAtomSegments,C=v.atoms.label_comp_id,_=pr.transientSegments(v.chainAtomSegments,p.elements),x=pr.transientSegments(y,p.elements),D=void 0;_.hasNext;)for(x.setSegment(_.move());x.hasNext;){var w=x.move().index,A=U5e(C.value(y.offsets[w]),m);if(A){D||(D=UA.byFingerprintAndResidue(h,F5e));var E=L5e(h,D.get(w));if(!E||!E.length){a.push({unit:p,residueIndex:w,component:A});continue}for(var I=[],M=0,F=E.length;M<F;++M){var N=h.all[E[M]],j=B5e(p,N),U=gl.calculateMomentsAxes(WZ(p,N)),H=gl.calculateNormalizedAxes(U),z=b.copy(b(),H.origin),G=b.copy(b(),H.dirC),J=k5e(b(),p,j,z);b.orthogonalize(J,G,J);var X=Mc.getAltId(p,N),Z=n.length;I.push(Z),s(o(w,p.id,X),Z),X&&s(o(w,p.id,""),Z),n.push({geometry:{center:z,normal:G,direction:J},component:A,ringIndex:E[M],altId:X,unit:p,residueIndex:w})}var ne=xQ(Bu(new Array(E.length)),2);for(M=0,F=ne.length;M<F;++M){var Y=ne[M];if(fu.areVertexSetsConnected(p.bonds,h.all[E[Y[0]]],h.all[E[Y[1]]],3)){var $=I[Y[0]],K=I[Y[1]];n[$].altId===n[K].altId&&(u($,K),u(K,$),t.push({carbohydrateIndexA:$,carbohydrateIndexB:K}),t.push({carbohydrateIndexA:K,carbohydrateIndexB:$}))}}}}function q(me,de){return i.get(o(me.getResidueIndex(de),me.id,function N5e(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}(me,de)))||[]}for(d=0,f=n.length;d<f;++d){var V=n[d],p=V.unit;for(M=d+1;M<f;++M){var ee=n[M];p===ee.unit&&V.residueIndex!==ee.residueIndex&&fu.areVertexSetsConnected(p.bonds,p.rings.all[V.ringIndex],p.rings.all[ee.ringIndex],3)&&(u(d,M),u(M,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:M}),t.push({carbohydrateIndexA:M,carbohydrateIndexB:d}))}}for(d=0,f=e.units.length;d<f;++d)Fe.isAtomic(p=e.units[d])&&e.interUnitBonds.getConnectedUnits(p.id).forEach(function(te){te.connectedIndices.forEach(function(le){te.getEdges(le).forEach(function(ge){var Ge=ge.indexB;if(Gr.isCovalent(ge.props.flag)){var je=e.unitMap.get(te.unitA),L=e.unitMap.get(te.unitB),Q=q(je,le),ye=q(L,Ge);if(Q.length>0&&ye.length>0)for(var we=Q.length,De=ye.length,Oe=0,Ne=Math.max(we,De);Oe<Ne;++Oe){var Ue=Q[Math.min(Oe,we-1)],$e=ye[Math.min(Oe,De-1)];((Ie=_Q(je,le)).startsWith("O1")||Ie.startsWith("C1"))&&u(Ue,$e),t.push({carbohydrateIndexA:Ue,carbohydrateIndexB:$e})}else if(0===ye.length)for(var He=0,Je=Q;He<Je.length;He++){var Ie;Ue=Je[He],((Ie=_Q(je,le)).startsWith("O1")||Ie.startsWith("C1"))&&l(Ue,Ge,L),r.push({carbohydrateIndex:Ue,elementIndex:Ge,elementUnit:L,fromCarbohydrate:!0})}else if(0===Q.length)for(var mt=0,ut=ye;mt<ut.length;mt++)r.push({carbohydrateIndex:$e=ut[mt],elementIndex:le,elementUnit:je,fromCarbohydrate:!1})}})})});return R({links:t,terminalLinks:r,elements:n,partialElements:a},function G5e(e,t,r){function n(F,N){return Ou(F.id,N)}function a(F,N,j){var U=[],H=F.get(n(N,j));if(void 0!==H)for(var z=0,G=H;z<G.length;z++)Ya(U,G[z]);return U}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],f=0,p=(d=(c=u.unit).rings.all[u.ringIndex]).length;f<p;++f){var m=n(c,c.elements[d[f]]);void 0===(h=i.get(m))?i.set(m,[o]):h.push(o)}var g=new Map;for(o=0,s=t.length;o<s;++o){var S=e[t[o].carbohydrateIndexA];for(f=0,p=(d=(c=S.unit).rings.all[S.ringIndex]).length;f<p;++f)m=n(c,c.elements[d[f]]),void 0===(h=g.get(m))?g.set(m,[o]):h.push(o)}var _=new Map;for(o=0,s=r.length;o<s;++o){var x=r[o],A=x.elementUnit,E=x.elementIndex;if(x.fromCarbohydrate){var c,d,I=e[x.carbohydrateIndex];for(f=0,p=(d=(c=I.unit).rings.all[I.ringIndex]).length;f<p;++f)m=n(c,c.elements[d[f]]),void 0===(h=_.get(m))?_.set(m,[o]):h.push(o)}else{var h;m=n(A,A.elements[E]),void 0===(h=_.get(m))?_.set(m,[o]):h.push(o)}}return{getElementIndices:function v(F,N){return a(i,F,N)},getLinkIndices:function C(F,N){return a(g,F,N)},getTerminalLinkIndices:function M(F,N){return a(_,F,N)}}}(n,t,r))}(this)),this.state.carbohydrates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models||(this.state.models=function Y5e(e){for(var t=e.units,r=En.create(),n=0,a=t;n<a.length;n++){var i=a[n];En.add(r,i.model.id,i.model)}return r.array}(this)),this.state.models},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=function X5e(e){for(var t=ot.residue.microheterogeneityCompIds,r=new Set,n=at.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var s=i[a].units[0];if(Fe.isAtomic(s)){var u=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var c=u.move();n.element=s.elements[c.start];for(var d=0,f=t(n);d<f.length;d++)r.add(f[d])}}}return r}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=function K5e(e){for(var t=ot.atom.type_symbol,r=new Set,n=at.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var s=i[a].units[0];if(Fe.isAtomic(s)){n.unit=s;for(var u=0,c=s.elements.length;u<c;++u)n.element=s.elements[u],r.add(t(n))}}return r}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=function Z5e(e){for(var t=e.units,r=at.create(e),n=En.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=0===o.kind?ot.entity.key:ot.coarse.entityKey;r.unit=o;for(var u=o.elements,c=pr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);c.hasNext;){var l=c.move();r.element=u[l.start];var d=s(r);En.add(n,d,d)}}return bc(n.array),n.array}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=function Q5e(e){for(var t=new Map,r=[],a=0,i=e.unitSymmetryGroups;a<i.length;a++){var s=i[a].units[0];if(Fe.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=En.create(),r.push(s.model.id),t.set(s.model.id,u));for(var c=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);c.hasNext;){var l=c.move();En.add(u,l.index,l.index)}}}for(var d=new Map,f=0,p=r;f<p.length;f++){var m=p[f],h=t.get(m).array;bc(h),d.set(m,h)}return d}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(!Fe.isAtomic(r[t]))return!1;return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(Fe.isAtomic(r[t]))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(!Fe.isCoarse(r[t]))return!1;return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++)if(Fe.isCoarse(r[t]))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=function nUe(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,c=t.length;s<c;++s){a[s]=u;for(var l=t[s].elements,d=0,f=l.length;d<f;++d){var p=u+d;i[p]=s,o[p]=l[d]}u+=l.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(m,h){return a[n.get(m.id)]+ke.indexOf(m.elements,h)}}}(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return!!this.unitMap.has(t.unit.id)&&Ye.has(this.unitMap.get(t.unit.id).elements,t.element)},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=this.state,n=r.dynamicBonds,a=r.interUnitBonds,i=r.parent,o=[],s=0,u=this.unitSymmetryGroups;s<u.length;s++){var c=u[s],l=c.units[0].remapModel(t,n);o.push(l);for(var d=1,f=c.units.length;d<f;++d)o.push(c.units[d].remapModel(t,n,l.props))}return e.create(o,{parent:i?.remapModel(t),label:this.label,interUnitBonds:n?void 0:a,dynamicBonds:n,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})},e.prototype.asParent=function(){if(this._proxy)return this._proxy;if(this.parent){var t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,R(R({},r.state),{dynamicBonds:this.dynamicBonds}),{child:this,target:this.parent})}else this._proxy=this;return this._proxy},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return null!==(t=this._target)&&void 0!==t?t:this},enumerable:!1,configurable:!0}),e}();function W5e(e,t,r){return e[t].id-e[r].id}!function(e){function t(q){return{kind:"structure-loci",structure:q}}function u(q,V){void 0===V&&(V={});for(var ee=xc.Mutable(),ae=xc.Mutable(),pe=0,me=!0,de=q.length>0?q[0].id:0,re=0,te=q.length;re<te;re++){var le=q[re];ee.set(le.id,le),pe+=le.elements.length,le.id<de&&(me=!1),de=le.id}for(me||Wq(q,0,q.length,W5e,Rh),re=0,te=q.length;re<te;re++)ae.set(q[re].id,re);var ge={hashCode:-1,transformHash:-1,elementCount:pe,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:ra.Default,label:""};return V.parent&&(ge.parent=V.parent.parent||V.parent),V.interUnitBonds&&(ge.interUnitBonds=V.interUnitBonds),V.interBondsValidUnit?ge.interBondsValidUnit=V.interBondsValidUnit:V.parent&&(ge.interBondsValidUnit=V.parent.interBondsValidUnit),V.interBondsValidUnitPair?ge.interBondsValidUnitPair=V.interBondsValidUnitPair:V.parent&&(ge.interBondsValidUnitPair=V.parent.interBondsValidUnitPair),V.dynamicBonds?ge.dynamicBonds=V.dynamicBonds:V.parent&&(ge.dynamicBonds=V.parent.dynamicBonds),V.coordinateSystem?ge.coordinateSystem=V.coordinateSystem:V.parent&&(ge.coordinateSystem=V.parent.coordinateSystem),V.label?ge.label=V.label:V.parent&&(ge.label=V.parent.label),V.masterModel?ge.masterModel=V.masterModel:V.parent&&(ge.masterModel=V.parent.masterModel),V.representativeModel?ge.representativeModel=V.representativeModel:V.parent&&(ge.representativeModel=V.parent.representativeModel),new e(q,ee,ae,ge)}e.Empty=u([]),e.Loci=t,e.toStructureElementLoci=function r(q){for(var V=[],ee=0,ae=q.units;ee<ae.length;ee++){var pe=ae[ee];V.push({unit:pe,indices:_e.ofBounds(0,pe.elements.length)})}return Re(q,V)},e.toSubStructureElementLoci=function n(q,V){return ht.toLociWithSourceUnits(ht.Singletons(q,V))},e.isLoci=function a(q){return!!q&&"structure-loci"===q.kind},e.areLociEqual=function i(q,V){return q.structure===V.structure},e.isLociEmpty=function o(q){return q.structure.isEmpty},e.remapLoci=function s(q,V){return V===q.structure?q:t(V)},e.create=u,e.ofTrajectory=function c(q,V){return ue(this,void 0,void 0,function(){var ee,ae,pe,me,de,re,te,le,ge,xe,L;return ce(this,function(Q){switch(Q.label){case 0:if(0===q.frameCount)return[2,e.Empty];ee=[],ae=void 0,pe=0,me=0,de=q.frameCount,Q.label=1;case 1:return me<de?[4,Ve.resolveInContext(q.getFrameAtIndex(me),V)]:[3,4];case 2:for(re=Q.sent(),ae||(ae=re),te=d(re),le=0,ge=te.units.length;le<ge;++le)L=Fe.create(ee.length,(xe=te.units[le]).invariantId+pe,xe.chainGroupId+pe,xe.traits,xe.kind,xe.model,xe.conformation.operator,xe.elements),ee.push(L);pe=ee.length,Q.label=3;case 3:return++me,[3,1];case 4:return[2,u(ee,{representativeModel:ae,label:ae.label})]}})})};var l=!1;function d(q,V){void 0===V&&(V={});for(var ee=q.atomicHierarchy.chainAtomSegments,ae=q.atomicHierarchy.index,pe=q.atomicHierarchy.chains.auth_asym_id,me=q.atomicChainOperatorMappinng,de=new y(R({label:q.label},V)),re=0;re<ee.count;re++){var te=me.get(re)||ra.Default,le=ee.offsets[re],ge=rv.chainResidueCount(q.atomicHierarchy,re)===ee.offsets[re+1]-ee.offsets[re],xe=!1;if(f(q,re))for(;re+1<ee.count&&f(q,re+1)&&me.get(re)===me.get(re+1);)xe=!0,re++;else for(;re+1<ee.count&&ee.offsets[re+1]-ee.offsets[re]==1&&ee.offsets[re+2]-ee.offsets[re+1]==1&&(ge=!0,ae.getEntityFromChain(re)===ae.getEntityFromChain(re+1))&&pe.value(re)===pe.value(re+1)&&me.get(re)===me.get(re+1);)xe=!0,re++;var De=Ye.ofBounds(le,ee.offsets[re+1]);l?ge&&!p(q,re)?m(q,De,de,xe,te):De.length>2e5||f(q,re)?h(q,De,de,xe,te):de.addUnit(0,q,te,De,xe?Fe.Trait.MultiChain:Fe.Trait.None):de.addUnit(0,q,te,De,xe?Fe.Trait.MultiChain:Fe.Trait.None)}var Oe=q.coarseHierarchy;return Oe.isDefined&&(Oe.spheres.count>0&&v(de,q,q.coarseHierarchy.spheres,1),Oe.gaussians.count>0&&v(de,q,q.coarseHierarchy.gaussians,2)),de.getStructure()}function f(q,V){var ee=q.atomicHierarchy.index.getEntityFromChain(V);return"water"===q.entities.data.type.value(ee)}function p(q,V){var ee=q.atomicHierarchy.index.getEntityFromChain(V);return"polymer"===q.entities.data.type.value(ee)}function m(q,V,ee,ae,pe){var me=q.atomicConformation,le={x:me.x,y:me.y,z:me.z,indices:V},xe=Df(le,Jf(le),8192).buckets,Ge=xe.offset,je=xe.count,L=xe.array,Q=(ae?Fe.Trait.MultiChain:Fe.Trait.None)|(Ge.length>1?Fe.Trait.Partitioned:Fe.Trait.None);ee.beginChainGroup();for(var ye=0,we=Ge.length;ye<we;ye++){for(var De=Ge[ye],Oe=new Int32Array(je[ye]),Ne=0,Ue=je[ye];Ne<Ue;Ne++)Oe[Ne]=V[L[De+Ne]];ee.addUnit(0,q,pe,Ye.ofSortedArray(Oe),Q)}ee.endChainGroup()}function h(q,V,ee,ae,pe){for(var de=[],re=[],te=pr.transientSegments(q.atomicHierarchy.residueAtomSegments,V);te.hasNext;){var le=te.move();de[de.length]=V[le.start],re[re.length]=V[le.end]}var xe=512*(re[0]-de[0]),Ge=q.atomicConformation,ye={x:Ge.x,y:Ge.y,z:Ge.z,indices:Ye.ofSortedArray(de)},De=Df(ye,Jf(ye),xe).buckets,Oe=De.offset,Ne=De.count,Ue=De.array,$e=(ae?Fe.Trait.MultiChain:Fe.Trait.None)|(Oe.length>1?Fe.Trait.Partitioned:Fe.Trait.None);ee.beginChainGroup();for(var Ie=0,He=Oe.length;Ie<He;Ie++){for(var Je=Oe[Ie],mt=[],ut=0,St=Ne[Ie];ut<St;ut++)for(var wt=Ue[Je+ut],Le=de[wt],it=re[wt];Le<it;Le++)mt[mt.length]=Le;ee.addUnit(0,q,pe,Ye.ofSortedArray(new Int32Array(mt)),$e)}ee.endChainGroup()}function v(q,V,ee,ae){for(var pe=ee.chainElementSegments,me=0;me<pe.count;me++){var de=Ye.ofBounds(pe.offsets[me],pe.offsets[me+1]);q.addUnit(ae,V,ra.Default,de,Fe.Trait.None)}}e.ofModel=d,e.transform=function g(q,V){if(he.isIdentity(V))return q;if(!he.isRotationAndTranslation(V,ra.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var ee=[],ae=0,pe=q.units;ae<pe.length;ae++){var me=pe[ae],de=me.conformation.operator,re=ra.create(de.name,V,de);ee.push(me.applyOperator(me.id,re))}var te=q.coordinateSystem;return u(ee,{parent:q,coordinateSystem:ra.compose(ra.create(te.name,V,te),te)})};var y=function(){function q(V){void 0===V&&(V={}),this.props=V,this.units=[],this.invariantId=Jo(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=b(),this.singleElementUnits=new Map}return q.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},q.prototype.endChainGroup=function(){this.inChainGroup=!1},q.prototype.addUnit=function(V,ee,ae,pe,me,de){void 0===de&&(de=this.invariantId());var re=this.inChainGroup?this.chainGroupId:++this.chainGroupId,te=Fe.create(this.units.length,de,re,me,V,ee,ae,pe);return this.add(te)},q.prototype.add=function(V){if(1===V.elements.length){V.conformation.position(V.elements[0],this.p);var ee=[V.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(ee))return this.singleElementUnits.get(ee);this.singleElementUnits.set(ee,V)}return this.units.push(V),V},q.prototype.addWithOperator=function(V,ee,ae){return void 0===ae&&(ae=!1),this.add(V.applyOperator(this.units.length,ee,ae))},q.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(q.prototype,"isEmpty",{get:function(){return 0===this.units.length},enumerable:!1,configurable:!0}),q}();function x(q,V){if(q===V)return!0;if(q.elementCount!==V.elementCount)return!1;var ee=q.units.length;if(ee!==V.units.length)return!1;for(var ae=0;ae<ee;ae++)if(q.units[ae].id!==V.units[ae].id)return!1;return!0}function A(q,V){return q===V||q.hashCode===V.hashCode&&wd.areTransformGroupsEquivalent(q.unitSymmetryGroups,V.unitSymmetryGroups)}e.StructureBuilder=y,e.Builder=function S(q){return void 0===q&&(q={}),new y(q)},e.hashCode=function C(q){return q.hashCode},e.conformationHash=function _(q){return CO(q.units.map(function(V){return Fe.conformationId(V)}).join("|"))},e.areUnitIdsEqual=x,e.areUnitIdsAndIndicesEqual=function D(q,V){if(q===V)return!0;if(!x(q,V))return!1;for(var ee=0,ae=q.units.length;ee<ae;ee++)if(!Ye.areEqual(q.units[ee].elements,V.units[ee].elements))return!1;return!0},e.areHierarchiesEqual=function w(q,V){if(q.hashCode!==V.hashCode)return!1;var ee=q.models.length;if(ee!==V.models.length)return!1;for(var ae=0;ae<ee;ae++)if(!ar.areHierarchiesEqual(q.models[ae],V.models[ae]))return!1;return!0},e.areEquivalent=A,e.areRootsEquivalent=function E(q,V){return A(q.root,V.root)},e.areRootsEqual=function I(q,V){return q.root===V.root};var M=function(){function q(V){this.structure=V,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=at.create(V),this.hasNext=V.elementCount>0,this.hasNext&&(this.elements=V.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=V.units[0])}return q.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},q.prototype.advance=function(){if(this.idx<this.maxIdx)return this.idx++,void(this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length));this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length?this.hasNext=!1:(this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,0===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length))},q}();e.ElementLocationIterator=M;var F=b();function N(q,V,ee){for(var ae=q.elements,pe=q.conformation,me=pe.position,de=pe.r,re=F,te=Number.MAX_VALUE,le=0,ge=ae.length;le<ge;le++){var xe=ae[le],Ge=b.distance(V,me(xe,re))-ee-de(xe);Ge<te&&(te=Ge)}return te}function j(q,V,ee){for(var ae=q.units,pe=Number.MAX_VALUE,me=0,de=ae.length;me<de;me++){var te=N(ae[me],V,ee);te<pe&&(pe=te)}return pe}e.minDistanceToPoint=j;var k,q,U=b();function Z(q){return q.unitSymmetryGroups.filter(function(V){return V.units[0].polymerElements.length>0})}e.distance=function H(q,V){if(0===q.elementCount||0===V.elementCount)return 0;for(var ee=q.units,ae=Number.MAX_VALUE,pe=0,me=ee.length;pe<me;pe++)for(var de=ee[pe],re=de.elements,te=de.conformation,le=te.position,ge=te.r,xe=0,Ge=re.length;xe<Ge;xe++){var je=re[xe],L=j(V,le(je,U),ge(je));L<ae&&(ae=L)}return ae},e.elementDescription=function z(q){return 1===q.elementCount?"1 element":"".concat(q.elementCount," elements")},e.validUnitPair=function G(q,V,ee){return q.masterModel?V.model===ee.model||V.model===q.masterModel||ee.model===q.masterModel:V.model===ee.model},e.eachUnitPair=function J(q,V,ee){var ae=ee.maxRadius,pe=ee.validUnit,me=ee.validUnitPair;if(q.units.some(function(Q){return pe(Q)}))for(var de=q.lookup3d,re=b(),te=0,le=q.units;te<le.length;te++){var ge=le[te];if(pe(ge)){var xe=ge.boundary.sphere;b.transformMat4(re,xe.center,ge.conformation.operator.matrix);for(var Ge=de.findUnitIndices(re[0],re[1],re[2],xe.radius+ae),je=0;je<Ge.count;je++){var L=q.units[Ge.indices[je]];ge.id>=L.id||!pe(L)||!me(ge,L)||(L.elements.length>=ge.elements.length?V(ge,L):V(L,ge))}}}},e.eachAtomicHierarchyElement=function X(q,V){for(var ee=V.chain,ae=V.residue,pe=V.atom,me=at.create(q),de=0,re=q.units;de<re.length;de++){var te=re[de];if(0===te.kind){me.unit=te;for(var le=te.elements,ge=pr.transientSegments(te.model.atomicHierarchy.chainAtomSegments,le),xe=pr.transientSegments(te.model.atomicHierarchy.residueAtomSegments,le);ge.hasNext;){var Ge=ge.move();if(ee&&(me.element=le[Ge.start],ee(me)),ae||pe)for(xe.setSegment(Ge);xe.hasNext;){var je=xe.move();if(ae&&(me.element=le[je.start],ae(me)),pe)for(var L=je.start,Q=je.end;L<Q;L++)me.element=le[L],pe(me)}}}}},e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15},(q=k=e.Size||(e.Size={}))[q.Small=0]="Small",q[q.Medium=1]="Medium",q[q.Large=2]="Large",q[q.Huge=3]="Huge",q[q.Gigantic=4]="Gigantic",e.getSize=function W(q,V,ee){void 0===V&&(V={}),void 0===ee&&(ee=1);var ae=R(R({},e.DefaultSizeThresholds),V);return q.polymerResidueCount>=ae.largeResidueCount*ee?function Y(q,V){var ee=Z(q);return ee.length>=1&&ee[0].units.length>V.highSymmetryUnitCount}(q,ae)?k.Huge:k.Gigantic:function ne(q,V){var ee=Z(q);return 1===ee.length&&ee[0].units.length>2&&ee[0].units[0].polymerElements.length<V.fiberResidueCount}(q,ae)||q.polymerResidueCount<ae.smallResidueCount*ee?k.Small:q.polymerResidueCount<ae.mediumResidueCount*ee?k.Medium:k.Large},e.Index=ep.createSimple("index","root"),e.MaxIndex=ep.createSimple("max_index","root");var $="__PrincipalAxes__";e.getPrincipalAxes=function K(q){if(q.currentPropertyData[$])return q.currentPropertyData[$];var V=Re.getPrincipalAxes(e.toStructureElementLoci(q));return q.currentPropertyData[$]=V,V}}(Ze||(Ze={}));var Ad,iv,Td,aUe=vi.diff;function Re(e,t){return{kind:"element-loci",structure:e,elements:t}}!function(e){function n(K){for(var q=0,V=K.elements;q<V.length;q++)if(ke.size(V[q].indices)>0)return!1;return!0}function i(K){for(var q=0,V=0,ee=K.elements;V<ee.length;V++){var ae=ee[V].indices;q+="number"==typeof ae?aUe(ae):ae.length}return q}function c(K){return n(K)?K:e(K.structure,[{unit:K.elements[0].unit,indices:ke.ofSingleton(ke.start(K.elements[0].indices))}])}function C(K){return K.length>3&&Ye.isRange(K)?_e.ofRange(K[0],K[K.length-1]):Ye.ofSortedArray(K)}function _(K,q){for(var V=[],ee=new Set,ae=0,pe=K.elements;ae<pe.length;ae++){var me=pe[ae];if(D(me))V[V.length]=me;else if(0===me.unit.kind){for(var de=me.unit.elements,te=me.unit.model.atomicHierarchy.atoms.label_alt_id,le=me.unit.model.atomicHierarchy.residueAtomSegments,ge=le.index,xe=le.offsets,Ge=[],je=me.indices,L=ke.size(je),Q=0;Q<L;){ee.clear();var ye=de[ke.getAt(je,Q)],we=ge[ye];for(ee.add(te.value(ye)),Q++;Q<L;){var De=de[ke.getAt(je,Q)];if(ge[De]!==we)break;ee.add(te.value(De)),Q++}for(var Oe=ee.has(""),Ne=xe[we],Ue=xe[we+1];Ne<Ue;Ne++){var $e=ke.indexOf(de,Ne);if($e>=0){var Ie=te.value(Ne);(!q||Oe||!Ie||ee.has(Ie))&&(Ge[Ge.length]=$e)}}}V[V.length]={unit:me.unit,indices:C(Ge)}}else V[V.length]=me}return e(K.structure,V)}function x(K){switch(K.kind){case 0:return K.model.atomicHierarchy.chainAtomSegments;case 1:return K.model.coarseHierarchy.spheres.chainElementSegments;case 2:return K.model.coarseHierarchy.gaussians.chainElementSegments}}function D(K){return K.unit.elements.length===ke.size(K.indices)}function w(K,q,V){for(var ee=x(K).index,ae=K.elements,pe=0,me=0,de=ae.length;me<de;me++)q.has(ee[ae[me]])&&pe++;if(pe!==K.elements.length){var le=new Int32Array(pe);for(pe=0,me=0,de=ae.length;me<de;me++)q.has(ee[ae[me]])&&(le[pe++]=me);le.length>0&&(V[V.length]={unit:K,indices:C(le)})}else V[V.length]={unit:K,indices:_e.ofBounds(0,pe)}}function A(K,q,V,ee,ae){for(var pe=x(K.elements[0].unit).index,me=new Set,de=q;de<V;de++)for(var re=K.elements[de],te=re.indices,le=re.unit.elements,ge=0,xe=ke.size(te);ge<xe;ge++)me.add(pe[le[ke.getAt(te,ge)]]);if(ee)for(var Ge=K.elements[0].unit,je=0,L=K.structure.units;je<L.length;je++){var Q=L[je];Fe.areSameChainOperatorGroup(Q,Ge)&&w(Q,me,ae)}else for(de=q;de<V;de++)w(K.elements[de].unit,me,ae)}function E(K){for(var q=[],V=0,ee=K.elements.length;V<ee;V++){var ae=K.elements[V];if(Fe.Traits.is(ae.unit.traits,Fe.Trait.Partitioned)){for(var pe=V;V<ee&&Fe.areSameChainOperatorGroup(K.elements[V].unit,ae.unit);)V++;var me=V;V--,A(K,pe,me,!0,q)}else D(ae)?q[q.length]=ae:A(K,V,V+1,!1,q)}return e(K.structure,q)}function I(K){return"".concat(K.unit.model.id,"|").concat(ot.entity.id(K))}function N(K,q){for(var V=[],ee=0,ae=ke.size(q);ee<ae;++ee)V.push(K[ke.getAt(q,ee)]);return Ye.ofSortedArray(V)}function j(K,q){return Ye.isRange(K)&&Ye.areEqual(K,q)?_e.ofLength(K.length):C(Ye.indicesOf(K,q))}e.is=function t(K){return!!K&&"element-loci"===K.kind},e.areEqual=function r(K,q){if(K.structure!==q.structure||K.elements.length!==q.elements.length)return!1;for(var V=0,ee=K.elements.length;V<ee;++V){var ae=K.elements[V],pe=q.elements[V];if(ae.unit.id!==pe.unit.id||!ke.areEqual(ae.indices,pe.indices))return!1}return!0},e.isEmpty=n,e.isWholeStructure=function a(K){return i(K)===K.structure.elementCount},e.size=i,e.all=function o(K){return e(K,K.units.map(function(q){return{unit:q,indices:ke.ofBounds(0,q.elements.length)}}))},e.none=function s(K){return e(K,[])},e.getFirstLocation=function u(K,q){if(!n(K)){var V=K.elements[0].unit,ee=V.elements[ke.getAt(K.elements[0].indices,0)];return q?(q.structure=K.structure,q.unit=K.elements[0].unit,q.element=ee,q):at.create(K.structure,V,ee)}},e.firstElement=c,e.firstResidue=function l(K){return n(K)?K:_(c(K))},e.firstChain=function d(K){return n(K)?K:E(c(K))},e.toStructure=function f(K){for(var q=[],V=function(me){var de=me.unit,re=me.indices,te=new Int32Array(ke.size(re));ke.forEach(re,function(le,ge){return te[ge]=de.elements[le]}),q.push(de.getChild(Ye.ofSortedArray(te)))},ee=0,ae=K.elements;ee<ae.length;ee++)V(ae[ee]);return Ze.create(q,{parent:K.structure.parent})},e.forEachLocation=function p(K,q){if(!e.isEmpty(K))for(var V=at.create(K.structure),ee=0,ae=K.elements;ee<ae.length;ee++){var pe=ae[ee],de=pe.indices;V.unit=pe.unit;for(var re=pe.unit.elements,te=0,le=ke.size(de);te<le;te++)V.element=re[ke.getAt(de,te)],q(V)}},e.remap=function m(K,q){if(q===K.structure)return K;var V=[];return K.elements.forEach(function(ee){if(q.unitMap.has(ee.unit.id)){var ae=q.unitMap.get(ee.unit.id),pe=ke.indexedIntersect(ee.indices,ee.unit.elements,ae.elements);ke.size(pe)>0&&V.push({unit:ae,indices:pe})}}),e(q,V)},e.union=function h(K,q){if(K.elements.length>q.elements.length)return h(q,K);if(e.isEmpty(K))return q;for(var V=new Map,ee=0,ae=K.elements;ee<ae.length;ee++)V.set((pe=ae[ee]).unit.id,pe.indices);for(var me=[],de=0,re=q.elements;de<re.length;de++){var pe;V.has((pe=re[de]).unit.id)?(me[me.length]={unit:pe.unit,indices:ke.union(V.get(pe.unit.id),pe.indices)},V.delete(pe.unit.id)):me[me.length]=pe}return V.forEach(function(te,le){me[me.length]={unit:K.structure.unitMap.get(le),indices:te}}),e(K.structure,me)},e.subtract=function v(K,q){for(var V=new Map,ee=0,ae=q.elements;ee<ae.length;ee++)V.set((pe=ae[ee]).unit.id,pe.indices);for(var me=[],de=0,re=K.elements;de<re.length;de++){var pe;if(V.has((pe=re[de]).unit.id)){var te=ke.subtract(pe.indices,V.get(pe.unit.id));if(0===ke.size(te))continue;me[me.length]={unit:pe.unit,indices:te}}else me[me.length]=pe}return e(K.structure,me)},e.intersect=function g(K,q){for(var V=new Map,ee=0,ae=K.elements;ee<ae.length;ee++)V.set((pe=ae[ee]).unit.id,pe.indices);for(var me=[],de=0,re=q.elements;de<re.length;de++){var pe;if(V.has((pe=re[de]).unit.id)){var te=ke.intersect(V.get(pe.unit.id),pe.indices);0!==ke.size(te)&&(me[me.length]={unit:pe.unit,indices:te})}}return e(K.structure,me)},e.areIntersecting=function y(K,q){if(K.elements.length>q.elements.length)return y(q,K);if(e.isEmpty(K))return e.isEmpty(q);for(var V=new Map,ee=0,ae=K.elements;ee<ae.length;ee++)V.set((pe=ae[ee]).unit.id,pe.indices);for(var me=0,de=q.elements;me<de.length;me++){var pe;if(V.has((pe=de[me]).unit.id)&&ke.areIntersecting(V.get(pe.unit.id),pe.indices))return!0}return!1},e.isSubset=function S(K,q){if(e.isEmpty(K))return e.isEmpty(q);for(var V=new Map,ee=0,ae=K.elements;ee<ae.length;ee++)V.set((pe=ae[ee]).unit.id,pe.indices);for(var me=!1,de=0,re=q.elements;de<re.length;de++){var pe;if(V.has((pe=re[de]).unit.id)){if(!ke.isSubset(V.get(pe.unit.id),pe.indices))return!1;me=!0}}return me},e.extendToWholeResidues=_,e.extendToWholeChains=E,e.extendToWholeEntities=function M(K){for(var q=[],V=at.create(K.structure),ee=new Set,ae=K.structure.units,pe=0,me=K.elements.length;pe<me;pe++){var de=K.elements[pe];V.unit=de.unit,V.element=de.unit.elements[0],ee.add(I(V))}pe=0;for(var re=ae.length;pe<re;++pe){var te=ae[pe];if(V.unit=te,V.element=te.elements[0],ee.has(I(V))){var le=ke.ofBounds(0,te.elements.length);q[q.length]={unit:te,indices:le}}}return e(K.structure,q)},e.extendToWholeModels=function F(K){for(var q=[],V=new Set,ee=K.structure.units,ae=0,pe=K.elements.length;ae<pe;ae++)V.add(K.elements[ae].unit.model.id);ae=0;for(var de=ee.length;ae<de;++ae){var re=ee[ae];if(V.has(re.model.id)){var te=ke.ofBounds(0,re.elements.length);q[q.length]={unit:re,indices:te}}}return e(K.structure,q)},e.extendToAllInstances=function U(K){for(var q=[],V=new Map,ee=0,ae=K.elements.length;ee<ae;ee++){var pe=K.elements[ee],me=pe.unit.model,de=N(pe.unit.elements,pe.indices);V.has(me)?V.set(me,Ye.union(de,V.get(me))):V.set(me,de)}ee=0;for(var re=K.structure.units.length;ee<re;++ee){var te=K.structure.units[ee];if(de=V.get(te.model)){var le=j(te.elements,de);ke.size(le)&&(q[q.length]={unit:te,indices:le})}}return e(K.structure,q)},e.extendToWholeOperators=function H(K){for(var q=[],V=new Set,ee=K.structure.units,ae=0,pe=K.elements.length;ae<pe;ae++)V.add(K.elements[ae].unit.conformation.operator.name);ae=0;for(var de=ee.length;ae<de;++ae){var re=ee[ae];if(V.has(re.conformation.operator.name)){var te=ke.ofBounds(0,re.elements.length);q[q.length]={unit:re,indices:te}}}return e(K.structure,q)};var z=new Lu("98"),G=b();e.getBoundary=function J(K,q){z.reset();for(var V=0,ee=K.elements;V<ee.length;V++)for(var me=(ae=ee[V]).unit.conformation.position,de=ae.unit.conformation.r,re=ae.unit.elements,te=0,le=ke.size(pe=ae.indices);te<le;te++)me(ge=re[ke.getAt(pe,te)],G),q&&b.transformMat4(G,G,q),z.includePositionRadius(G,de(ge));z.finishedIncludeStep();for(var xe=0,Ge=K.elements;xe<Ge.length;xe++){var ae,pe;for(me=(ae=Ge[xe]).unit.conformation.position,de=ae.unit.conformation.r,re=ae.unit.elements,te=0,le=ke.size(pe=ae.indices);te<le;te++){var ge;me(ge=re[ke.getAt(pe,te)],G),q&&b.transformMat4(G,G,q),z.radiusPositionRadius(G,de(ge))}}return{box:z.getBox(),sphere:z.getSphere()}};var X=b();function Z(K,q,V){void 0===V&&(V=0);for(var ee=V,ae=0,pe=K.elements;ae<pe.length;ae++){for(var me=pe[ae],de=me.indices,re=me.unit.conformation.position,te=me.unit.elements,le=ke.size(de),ge=0;ge<le;ge++)re(te[ke.getAt(de,ge)],X),b.toArray(X,q,ee+3*ge);ee+=3*le}return q}function k(K,q){return Fe.isAtomic(K)?K.model.atomicHierarchy.atomSourceIndex.value(q):q}function $(K,q,V,ee,ae){bc(q);for(var pe=[],me=[],de=0,re=q.length;de<re;){var te=de;for(de++;de<re&&q[de-1]+1===q[de];)de++;var le=de;if(le-te>12)pe[pe.length]=q[te],pe[pe.length]=q[le-1];else for(var ge=te;ge<le;ge++)me[me.length]=q[ge]}return V?{atom:{set:me,ranges:pe},chain:{opName:[K]},entity:{modelLabel:ee,modelIndex:ae}}:{atom:{set:me,ranges:pe},chain:{opName:[K]}}}e.toPositionsArray=Z,e.getPrincipalAxes=function ne(K){var q=i(K),V=Z(K,new Float32Array(3*q));return gl.ofPositions(V)},e.getPrincipalAxesMany=function Y(K){var q=0;K.forEach(function(ae){q+=i(ae)});var V=new Float32Array(3*q),ee=0;return K.forEach(function(ae){Z(ae,V,ee),ee+=3*i(ae)}),gl.ofPositions(V)},e.toExpression=function W(K){var q;if(e.isEmpty(K))return fe.struct.generator.empty();for(var V=K.structure.models,ee=new Map,ae=0,pe=K.elements;ae<pe.length;ae++){var de=(me=pe[ae]).indices,re=me.unit.elements,le=void 0;ee.has(te=me.unit.conformation.operator.name)?le=ee.get(te).xs:(le=En.create(),ee.set(te,{modelLabel:me.unit.model.label,modelIndex:me.unit.model.modelNum,xs:le}));for(var ge=0,xe=ke.size(de);ge<xe;ge++){var Ge=k(me.unit,re[ke.getAt(de,ge)]);En.add(le,Ge,Ge)}}for(var je=[],L=ee.keys();;){var Q=L.next();if(Q.done)break;var me=ee.get(Q.value);je.push($(Q.value,me.xs.array,V.length>1,me.modelLabel,me.modelIndex))}for(var ye=new Map,we=(ge=0,je.length);ge<we;++ge){var De=je[ge],Oe=Oh(rs(De.atom.ranges),rs(De.atom.set)),te="".concat(Oe,"|").concat(De.entity?De.entity.modelLabel+De.entity.modelIndex:"");ye.has(te)?(q=ye.get(te).chain.opName).push.apply(q,De.chain.opName):ye.set(te,De)}var Ne=[];return ye.forEach(function(Ue){var $e=Ue.atom,Ie=$e.ranges,He=$e.set,Je=Ue.chain.opName,mt=fe.struct.atomProperty.core.operatorName(),ut=fe.struct.atomProperty.core.sourceIndex(),St=[];He.length>0&&(St[St.length]=fe.core.set.has([fe.core.type.set(He),ut]));for(var wt=0,Le=Ie.length/2;wt<Le;wt++)St[St.length]=fe.core.rel.inRange([ut,Ie[2*wt],Ie[2*wt+1]]);if(Ue.entity){var it=Ue.entity,Ct=it.modelLabel,bt=it.modelIndex;Ne.push(fe.struct.generator.atomGroups({"atom-test":St.length>1?fe.core.logic.or(St):St[0],"chain-test":Je.length>1?fe.core.set.has([fe.core.type.set(Je),mt]):fe.core.rel.eq([mt,Je[0]]),"entity-test":fe.core.logic.and([fe.core.rel.eq([fe.struct.atomProperty.core.modelLabel(),Ct]),fe.core.rel.eq([fe.struct.atomProperty.core.modelIndex(),bt])])}))}else Ne.push(fe.struct.generator.atomGroups({"atom-test":St.length>1?fe.core.logic.or(St):St[0],"chain-test":Je.length>1?fe.core.set.has([fe.core.type.set(Je),mt]):fe.core.rel.eq([mt,Je[0]])}))}),fe.struct.modifier.union([1===Ne.length?Ne[0]:fe.struct.combinator.merge(Ne.map(function(Ue){return fe.struct.modifier.union([Ue])}))])}}(Re||(Re={})),function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:at.create(void 0),firstConformationLoc:at.create(void 0),firstResidueLoc:at.create(void 0),firstChainLoc:at.create(void 0),firstUnitLoc:at.create(void 0),firstStructureLoc:at.create(void 0)}}function r(u,c,l){var d=u.get(c)||0;u.set(c,d+l)}function n(u,c,l){var d=l.indices,f=l.unit,p=f.elements,m=ke.size(d),h=new Map,v=new Map;if(m>0&&at.set(u.firstElementLoc,c,f,p[ke.start(d)]),m===p.length)u.unitCount+=1,1===u.unitCount&&at.set(u.firstUnitLoc,c,f,p[ke.start(d)]);else if(1===m){if(Fe.Traits.is(f.traits,Fe.Trait.MultiChain))return;u.elementCount+=1,1===u.elementCount&&at.set(u.firstElementLoc,c,f,p[ke.start(d)])}else if(Fe.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,S=g.offsets,C=f.model.atomicHierarchy.atoms.label_alt_id,_=0,x=function(){h.clear();var D=0,w=p[ke.getAt(d,_)],A=y[w];for(r(h,C.value(w),1),++_,++D;_<m;){var E=p[ke.getAt(d,_)];if(y[E]!==A)break;r(h,C.value(E),1),++_,++D}if(S[A+1]-S[A]===D)u.residueCount+=1,1===u.residueCount&&at.set(u.firstResidueLoc,c,f,S[A]);else{v.clear();for(var I=S[A],M=S[A+1];I<M;++I)r(v,C.value(I),1);v.get("")===h.get("")&&h.forEach(function(F,N){if(v.get(N)===F){if(""!==N&&(u.conformationCount+=1,1===u.conformationCount))for(var j=S[A],U=S[A+1];j<U;++j)if(N===C.value(j)){at.set(u.firstConformationLoc,c,f,j);break}D-=F}}),u.elementCount+=D}};_<m;)x();else u.elementCount+=m,1===u.elementCount&&at.set(u.firstElementLoc,c,f,p[ke.start(d)])}function a(u,c,l){var d=l.indices,f=l.unit,p=ke.size(d);if(0!==p){var m=f.elements;if(!Fe.Traits.is(f.traits,Fe.Trait.MultiChain))return void(p===m.length&&(u.chainCount+=1,1===u.chainCount&&at.set(u.firstChainLoc,c,f,m[ke.start(d)])));var h=Fe.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:Fe.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:Fe.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h)return void console.warn("StructureElement loci stats: unknown unit type");for(var v=h.index,g=h.offsets,y=0;y<p;){var S=0,C=m[ke.getAt(d,y)],_=v[C];for(++y,++S;y<p&&v[m[ke.getAt(d,y)]]===_;)++y,++S;g[_+1]-g[_]===S?(u.chainCount+=1,1===u.chainCount&&at.set(u.firstChainLoc,c,f,g[_])):1===p&&(u.elementCount+=1,1===u.elementCount&&at.set(u.firstElementLoc,c,f,C))}}}function i(u,c,l,d,f){var p=l[d],m=Fe.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:Fe.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:Fe.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(m){for(var h=m.index,v=m.offsets,g=new Map,y=d;y<f;y++){var C=(p=l[y]).unit;if(0!==(_=ke.size(S=p.indices))){var x=C.elements;if(!Fe.Traits.is(C.traits,Fe.Trait.MultiChain)){r(g,h[D=x[ke.start(S)]],x.length);continue}for(var w=0;w<_;){var A=0,E=h[D=x[ke.getAt(S,w)]];for(++w,++A;w<_&&h[x[ke.getAt(S,w)]]===E;)++w,++A;r(g,E,A)}}}var M=-1;if(g.forEach(function(F,N){v[N+1]-v[N]===F&&(u.chainCount+=1,1===u.chainCount&&(M=N))}),!(M<0))for(y=d;y<f;y++){var S,_;if(C=(p=l[y]).unit,0!==(_=ke.size(S=p.indices)))for(x=C.elements,w=0;w<_;){var D;if((E=h[D=x[ke.getAt(S,w)]])===M)return void at.set(u.firstChainLoc,c,C,D)}}}else console.warn("StructureElement loci stats: unknown unit type")}e.create=t,e.ofLoci=function o(u){var c=t();if(Re.isEmpty(u))return c;var l=!1;if(Re.isWholeStructure(u)){if(c.structureCount+=1,1===c.structureCount){var d=u.elements[0],f=d.unit;at.set(c.firstStructureLoc,u.structure,f,f.elements[ke.min(d.indices)])}}else for(var m=0,h=u.elements;m<h.length;m++)n(c,u.structure,v=h[m]),Fe.Traits.is(v.unit.traits,Fe.Trait.Partitioned)?l=!0:a(c,u.structure,v);if(l)for(var g=0,y=u.elements.length;g<y;g++){var v;if(Fe.Traits.is((v=u.elements[g]).unit.traits,Fe.Trait.Partitioned)){for(var S=g;g<y&&Fe.areSameChainOperatorGroup(u.elements[g].unit,v.unit);)g++;var C=g;g--,C-S==1?a(c,u.structure,v):i(c,u.structure,u.elements,S,C)}}return c},e.add=function s(u,c,l){return 1===c.elementCount&&0===l.elementCount?at.copy(u.firstElementLoc,c.firstElementLoc):0===c.elementCount&&1===l.elementCount&&at.copy(u.firstElementLoc,l.firstElementLoc),1===c.conformationCount&&0===l.conformationCount?at.copy(u.firstConformationLoc,c.firstConformationLoc):0===c.conformationCount&&1===l.conformationCount&&at.copy(u.firstConformationLoc,l.firstConformationLoc),1===c.residueCount&&0===l.residueCount?at.copy(u.firstResidueLoc,c.firstResidueLoc):0===c.residueCount&&1===l.residueCount&&at.copy(u.firstResidueLoc,l.firstResidueLoc),1===c.chainCount&&0===l.chainCount?at.copy(u.firstChainLoc,c.firstChainLoc):0===c.chainCount&&1===l.chainCount&&at.copy(u.firstChainLoc,l.firstChainLoc),1===c.unitCount&&0===l.unitCount?at.copy(u.firstUnitLoc,c.firstUnitLoc):0===c.unitCount&&1===l.unitCount&&at.copy(u.firstUnitLoc,l.firstUnitLoc),1===c.structureCount&&0===l.structureCount?at.copy(u.firstStructureLoc,c.firstStructureLoc):0===c.structureCount&&1===l.structureCount&&at.copy(u.firstStructureLoc,l.firstStructureLoc),u.elementCount=c.elementCount+l.elementCount,u.conformationCount=c.conformationCount+l.conformationCount,u.residueCount=c.residueCount+l.residueCount,u.chainCount=c.chainCount+l.chainCount,u.unitCount=c.unitCount+l.unitCount,u.structureCount=c.structureCount+l.structureCount,u}}(Ad||(Ad={})),function(e){function t(n){var a=this,i=n.descriptor.name,o="static"===n.type?"_staticPropertyData":"_dynamicPropertyData",s=function(c){return i in c[o]||(c[o][i]={props:R({},T.getDefaultValues(n.getParams(c))),data:zp.create(void 0)}),c[o][i]},u=function(c,l,d){var f=s(c);c[o][i]={props:l,data:zp.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(c){var l=T.clone(n.getParams(c));return T.setDefaultValues(l,s(c).props),l},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(c,l,d,f){return void 0===d&&(d={}),ue(a,void 0,void 0,function(){var p,m,h,v,g;return ce(this,function(y){switch(y.label){case 0:return f&&l.customProperties.reference(n.descriptor,!0),p=s(l),m=T.merge(n.defaultParams,p.props,d),p.data.value&&T.areEqual(n.defaultParams,p.props,m)?[2]:[4,n.obtain(c,l,m)];case 1:return h=y.sent(),v=h.value,g=h.assets,l.customProperties.add(n.descriptor),l.customProperties.assets(n.descriptor,g),u(l,m,v),[2]}})})},ref:function(c,l){return c.customProperties.reference(n.descriptor,l)},get:function(c){var l;return null===(l=s(c))||void 0===l?void 0:l.data},set:function(c,l,d){void 0===l&&(l={});var f=s(c),p=T.merge(n.defaultParams,f.props,l);T.areEqual(n.defaultParams,f.props,p)||(u(c,p,d),c.customProperties.assets(n.descriptor))},props:function(c){return s(c).props}}}e.createProvider=t,e.createSimple=function r(n,a,i){var o=this,s={value:T.Value(i,{isHidden:!0})};return t({label:yc(n),descriptor:Hu({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:T.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,c,l){return ue(o,void 0,void 0,function(){return ce(this,function(d){return[2,R(R({},T.getDefaultValues(s)),l)]})})}})}}(iv||(iv={})),function(e){var t=this;function r(o){if(!Dn.is(o.sourceData))return!1;var s=o.sourceData.data.db.atom_site;return s.pdbx_sifts_xref_db_name.isDefined&&s.pdbx_sifts_xref_db_acc.isDefined&&s.pdbx_sifts_xref_db_num.isDefined&&s.pdbx_sifts_xref_db_res.isDefined}function i(o){if(Dn.is(o.sourceData)){var s=o.sourceData.data.db.atom_site,u=s.pdbx_sifts_xref_db_name,c=s.pdbx_sifts_xref_db_acc,l=s.pdbx_sifts_xref_db_num,d=s.pdbx_sifts_xref_db_res;if(u.isDefined&&c.isDefined&&l.isDefined&&d.isDefined){for(var f=o.atomicHierarchy.atomSourceIndex,p=o.atomicHierarchy.residueAtomSegments,m=p.count,h=p.offsets,v=new Array(m),g=new Array(m),y=new Array(m),S=new Array(m),C=0;C<m;C++){var _=f.value(h[C]);0===u.valueKind(_)?(v[C]=u.value(_),g[C]=c.value(_),y[C]=l.value(_),S[C]=d.value(_)):(v[C]="",g[C]="",y[C]="",S[C]="")}return{dbName:v,accession:g,num:y,residue:S}}}}e.Provider=iv.createProvider({label:"SIFTS Mapping",descriptor:Hu({name:"sifts_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(o){return r(o)},obtain:function(o,s){return ue(t,void 0,void 0,function(){return ce(this,function(u){return[2,{value:i(s)}]})})}}),e.isAvailable=r,e.getKey=function n(o){var s=o.unit.model,u=e.Provider.get(s).value;return u?u.accession[s.atomicHierarchy.residueAtomSegments.index[o.element]]:""},e.getLabel=function a(o){var s=o.unit.model,u=e.Provider.get(s).value;if(u){var c=s.atomicHierarchy.residueAtomSegments.index[o.element],l=u.dbName[c];if(l)return"".concat(l," ").concat(u.accession[c]," ").concat(u.num[c]," ").concat(u.residue[c])}}}(Td||(Td={}));function u2(e,t){if(Dn.is(e.sourceData))return e.sourceData.data.db[t]}function IQ(e){if(0===e.length)return[];if(1===e.length)return e[0].entityIndices;for(var t=En.create(),r=0,n=e;r<n.length;r++)for(var i=0,o=n[r].entityIndices;i<o.length;i++){var s=o[i];En.add(t,s,s)}return bc(t.array),t.array}function Bc(e,t){return{name:e,instance:function(r){var n=r.structures;if(t&&!t(n[0]))return Pa.Category.Empty;var a=n[0].model;if(!Dn.is(a.sourceData))return Pa.Category.Empty;var i=a.sourceData.data.db[e];return i&&i._rowCount?Pa.Category.ofTable(i):Pa.Category.Empty}}}var PQ=Pa.Category;K4("struct_asym"),K4("entity_poly"),K4("entity_poly_seq");function K4(e){return{name:e,instance:function(t){return function TUe(e,t,r){var n=u2(e[0].model,t);if(!n)return PQ.Empty;var a=n.entity_id,i=r.uniqueEntityIds||(r.uniqueEntityIds=function gUe(e){if(0===e.length)return new Set;var t=e[0].model.entities.data.id;return new Set(IQ(e).map(function(r){return t.value(r)}))}(e)),o=ie.indicesOf(a,function(s){return i.has(s)});return PQ.ofTable(n,o)}(t.structures,e,t.cache)}}}var DUe={molstar_atom_site_operator_mapping:{label_asym_id:ie.Schema.Str(),auth_asym_id:ie.Schema.Str(),operator_name:ie.Schema.Str(),suffix:ie.Schema.Str(),assembly_id:ie.Schema.Str(),assembly_operator_id:ie.Schema.Int(),symmetry_operator_index:ie.Schema.Int(),symmetry_hkl:ie.Schema.Vector(3),ncs_id:ie.Schema.Int()}},MQ=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},Z4=function(e,t){return-1===t[e].operator.spgrOp?1:0};Pa.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return(null===(r=t[e].operator.assembly)||void 0===r?void 0:r.id)||""},{valueKind:MQ}).int("assembly_operator_id",function(e,t){var r;return(null===(r=t[e].operator.assembly)||void 0===r?void 0:r.operId)||0},{valueKind:MQ}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:Z4}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:Z4}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:Z4}).getFields();var Q4;!function(e){e.create=function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}}(Q4||(Q4={}));var eB,OQ;function $4(e){return e.units.every(function(t){return t.conformation.operator.isIdentity})}function J4(e){return $4(e)&&e.units.every(function(t){return!t.conformation.operator.assembly&&!t.conformation.operator.suffix})}function tB(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}Bc("entry"),Bc("exptl"),Bc("cell",$4),Bc("symmetry",$4),Bc("pdbx_struct_assembly",J4),Bc("pdbx_struct_assembly_gen",J4),Bc("pdbx_struct_oper_list",J4),Bc("pdbx_entity_branch"),Bc("pdbx_entity_branch_link"),Bc("pdbx_branch_scheme"),Bc("struct_conn"),Bc("atom_sites"),function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])}(eB||(eB={})),function(e){e.getCifDataSource=function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];var m=f.getElements(d),h={data:m,rowCount:m.elements.length};return p&&(p[f.id]=h),h},e.fromAtomMap=function r(d){return new FQ(d)},e.fromAtomArray=function n(d){return new FQ(tB(d))};var a=function(d){return d.atomicHierarchy.residueAtomSegments};e.fromResidueMap=function i(d){return new JA("residue",d,a,0)},e.fromResidueArray=function o(d){return new JA("residue",tB(d),a,0)};var s=function(d){return d.atomicHierarchy.chainAtomSegments};e.fromChainMap=function u(d){return new JA("chain",d,s,0)},e.fromChainArray=function c(d){return new JA("chain",tB(d),s,0)},e.fromEntityMap=function l(d){return new NUe(d)}}(OQ||(OQ={}));var Ja,JA=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=kn.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(1!==r.length)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var l=u[s].units[0];if(l.kind===this.kind)for(var d=pr.transientSegments(o,l.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),i[i.length]=at.create(t,l,l.elements[f.start]))}}return i.sort(function(p,m){return p.element-m.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),FQ=function(){function e(t){this.map=t,this.id=kn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){if(1!==t.models.length)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=[],o=0,s=t.unitSymmetryGroups;o<s.length;o++){var c=s[o].units[0];if(c.kind===this.kind)for(var l=c.elements,d=0,f=l.length;d<f;d++){var p=l[d];!this.has(p)||n.has(p)||(n.add(l[d]),i[i.length]=at.create(t,c,p))}}return i.sort(function(m,h){return m.element-h.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),NUe=function(){function e(t){this.map=t,this.id=kn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(1!==r.length)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,c=t.unitSymmetryGroups;u<c.length;u++){var d=c[u].units[0];if(d.kind===this.kind)for(var f=pr.transientSegments(s,d.elements);f.hasNext;){var p=f.move(),m=n.getEntityFromChain(p.index);!this.has(m)||a.has(m)||(a.add(m),o[o.length]=at.create(t,d,d.elements[p.start]))}}return o.sort(function(h,v){return h.element-v.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}(),rp=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function LUe(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,c=t.asym_id_list,l=0,d=t._rowCount;l<d;l++)s.value(l)===a&&(o[o.length]={assemblyId:a,expression:u.value(l),asymIds:c.value(l)});return T4.create(a,i,function UUe(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],s=GUe(HUe(i.expression)),u=zUe(t,s,n,i.assemblyId),c=gn.generators.atoms({chainTest:gn.pred.and(gn.pred.eq(function(l){return ot.unit.operator_name(l.element)},ra.DefaultName),gn.pred.inSet(function(l){return ot.chain.label_asym_id(l.element)},i.asymIds))});r[r.length]={selector:c,operators:u,asymIds:i.asymIds},n+=u.length}return r}}(o,n))}function GUe(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return BQ(e,t,e.length-1,r),t}function BQ(e,t,r,n){if(r<0)t[t.length]=n.slice(0);else for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],BQ(e,t,r-1,n)}function zUe(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],c=he.identity(),l=0;l<u.length;l++)he.mul(c,c,e.get(u[l]));i++,a[a.length]=ra.create("ASM_".concat(i),c,{assembly:{id:n,operId:i,operList:u}})}return a}function HUe(e){for(var a,t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[];a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var c=parseInt(s.substring(0,u)),l=parseInt(s.substr(u+1)),d=c;d<=l;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}function YUe(e){if(0!==e._rowCount){for(var t=e.id,r=e.matrix,n=e.vector,a=Br.struct_ncs_oper.matrix.space,i=Br.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Sr.toMat3(Qt(),a,r.value(s)),c=Sr.toVec3(b(),i,n.value(s));if(ra.checkIfRotationAndTranslation(u,c)&&("given"!==e.code.value(s)||Qt.isIdentity(u)||b.isZero(c))){var l=t.value(s);o[o.length]=ra.ofRotationAndOffset("ncs_".concat(l),u,c,l)}}return o}}!function(e){e.Descriptor={name:"model_symmetry"},e.Provider=_l.create(e.Descriptor),e.fromData=function t(n){var a=function kUe(e,t,r){if(!e._rowCount)return[];for(var n=function VUe(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=b(),s=0,u=e._rowCount;s<u;s++){var c=Sr.toMat4(he(),a.matrix.space,r.value(s));Sr.toVec3(o,a.vector.space,n.value(s)),he.setTranslation(c,o),he.setValue(c,3,3,1),i.set(t.value(s),c)}return i}(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=LUe(e,t,i,n);return a}(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=function WUe(e,t){if(0===e._rowCount||0===t._rowCount)return au.ZeroP1;var r=t.length_a.value(0),n=t.length_b.value(0),a=t.length_c.value(0);if(0===r||0===n||0===a)return au.ZeroP1;var i=t.angle_alpha.value(0),o=t.angle_beta.value(0),s=t.angle_gamma.value(0);if(0===i||0===o||0===s)return au.ZeroP1;var u=function qUe(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}(e),c=ns.create(u,b.create(r,n,a),b.scale(b(),b.create(i,o,s),Math.PI/180));return au.create(c)}(n.symmetry,n.cell);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:!1,ncsOperators:YUe(n.struct_ncs_oper)}},e.fromCell=function r(n,a){var i=ns.create("P 1",n,a);return{assemblies:[],spacegroup:au.create(i),isNonStandardCrystalFrame:!1}}}(Ja||(Ja={}));var Dd,ov,Dn,c2,ar,XUe={U:Br.atom_site_anisotrop.U,U_esd:Br.atom_site_anisotrop.U_esd};function rB(e,t){var r=Dn.fromFrame(e,void 0,void 0,t),n=Ic(r.data.db,!0);return Ve.create("Create mmCIF Model",function(a){return Ed(n,r,a)})}function t6e(e){var t=c2.fromFrame(e);return Ve.create("Create CCD Models",function(r){return function r6e(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s;return ce(this,function(u){switch(u.label){case 0:return[4,NQ(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},r)];case 1:return n=u.sent(),[4,NQ(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},r)];case 2:for(a=u.sent(),i=[],n&&i.push(n),a&&i.push(a),o=0,s=i.length;o<s;++o)ar.TrajectoryInfo.set(i[o],{index:o,size:i.length});return[2,new rp(i)]}})})}(t.data.db,c2.fromFrame(e),r)})}function NQ(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j,U,H,z,G,J,X,ne,Y,k;return ce(this,function(W){switch(W.label){case 0:for(i=e.chem_comp_atom,o=e.chem_comp_bond,s=r.coordinateType,u=r.cartn_x,c=r.cartn_y,l=r.cartn_z,d=(a=e.chem_comp).name.value(0),f=a.id.value(0),p=i.atom_id,m=i.charge,h=i.comp_id,v=i.pdbx_ordinal,g=i.type_symbol,y=i._rowCount,S=[],C=0;C<y;C++)i[u].valueKind(C)>0||(S[S.length]=C);return x=ie.ofConst("A",_=S.length,ie.Schema.str),D=ie.ofConst(1,_,ie.Schema.int),w=ie.ofConst("1",_,ie.Schema.str),A=ie.ofConst(1,_,ie.Schema.float),E=ie.ofConst(1,_,ie.Schema.int),I=ie.view(p,S),M=ie.view(h,S),F=ie.view(i[u],S),N=ie.view(i[c],S),j=ie.view(i[l],S),U=ie.view(v,S),H=ie.view(g,S),z=ie.view(m,S),G=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:x,auth_atom_id:I,auth_comp_id:M,auth_seq_id:D,Cartn_x:F,Cartn_y:N,Cartn_z:j,id:U,label_asym_id:x,label_atom_id:I,label_comp_id:M,label_seq_id:D,label_entity_id:w,occupancy:A,type_symbol:H,pdbx_PDB_model_num:E,pdbx_formal_charge:z},_),(J=new xl).setNames([[f,"".concat(d," (").concat(s,")")]]),J.getEntityId(f,0,"A"),(X=new Cl(D,g)).setNames([[f,"".concat(d," (").concat(s,")")]]),X.add(f,0),[4,Ed(Ic({entity:J.getEntityTable(),chem_comp:X.getChemCompTable(),atom_site:G}),t,n)];case 1:return(ne=W.sent()).representative?(Y=ne.representative,k=ev.getEntriesFromChemCompBond(o),ev.Provider.set(Y,{data:o,entries:k}),c2.CoordinateType.set(Y,s),[2,ne.representative]):[2]}})})}function iy(e,t){return t?1===t.length?Ou(t.charCodeAt(0),e):2===t.length?Ou(t.charCodeAt(0),Ou(t.charCodeAt(1),e)):"".concat(e," ").concat(t):e}function a6e(e,t,r,n){var a;e.has(t)?(a=e.get(t)).has(r)||a.set(r,n):(e.set(t,a=new Map),a.set(r,n))}function i6e(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}!function(e){e.Schema=XUe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){return e.Provider.get(n.firstModel)&&Dn.is(n.firstModel.sourceData)?Pa.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop):Pa.Category.Empty}}]}},e.Provider=_l.create(e.Descriptor),e.getElementToAnsiotrop=function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);for(u.fill(-1),o=0,s=a.rowCount;o<s;++o){var c=i[a.value(o)];-1!==c&&(u[c]=o)}return u},e.getElementToAnsiotropFromLabel=function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);for(u.fill(-1),o=0,s=a.rowCount;o<s;++o){var c=i[a.value(o)];void 0!==c&&(u[c]=o)}return u}}(Dd||(Dd={})),function(e){var t,r="molstar_global_model_transform_info";function a(u){return e.Provider.get(u)}e.Schema=((t={})[r]={matrix:ie.Schema.Matrix(4,4,ie.Schema.float)},t),e.Descriptor=Hu({name:r,cifExport:{categories:[{name:r,instance:function(u){var c=a(u.firstModel);if(!c)return Pa.Category.Empty;var l=Xr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:c}]);return Pa.Category.ofTable(l)}}],prefix:"molstar"}}),e.Provider=_l.create(e.Descriptor),e.attach=function n(u,c){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,c)},e.get=a,e.fromMmCif=function i(u){if(Dn.is(u.sourceData)){var c=u.sourceData.data.frame.categories[r];if(c){var l=function cDe(e,t){return new lY(t,e,!0)}(e.Schema[r],c);if(0!==l._rowCount)return l.matrix.value(0)}}},e.hasData=function o(u){if(!Dn.is(u.sourceData))return!1;var c=u.sourceData.data.frame.categories[r];return!!c&&c.rowCount>0},e.writeMmCif=function s(u,c){u.writeCategory({name:r,instance:function(){var l=Xr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:c}]);return Pa.Category.ofTable(l)}})}}(ov||(ov={})),Ja.Provider.formatRegistry.add("mmCIF",function KUe(e){if(Dn.is(e.sourceData))return Ja.fromData(e.sourceData.data.db)}),nv.Provider.formatRegistry.add("mmCIF",function ZUe(e){if(Dn.is(e.sourceData)){var t=e.sourceData.data.db;return nv.fromStruct(t.struct_conf,t.struct_sheet_range,e.atomicHierarchy)}}),Dd.Provider.formatRegistry.add("mmCIF",function QUe(e){if(Dn.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop;return{data:Xr.ofColumns(Dd.Schema,t),elementToAnsiotrop:Dd.getElementToAnsiotrop(e.atomicConformation.atomId,t.id)}}},function $Ue(e){return!!Dn.is(e.sourceData)&&e.sourceData.data.db.atom_site_anisotrop.U.isDefined}),ev.Provider.formatRegistry.add("mmCIF",function JUe(e){if(Dn.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(0!==t._rowCount)return{data:t,entries:ev.getEntriesFromChemCompBond(t)}}}),Yu.Provider.formatRegistry.add("mmCIF",function e6e(e){if(Dn.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(0!==t._rowCount){var r=Yu.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:Yu.getAtomIndexFromEntries(r),entries:r}}}}),ov.Provider.formatRegistry.add("mmCIF",ov.fromMmCif,ov.hasData),function(e){e.is=function t(n){return"mmCIF"===n?.kind},e.fromFrame=function r(n,a,i,o){return a||(a=hl.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,file:o,frame:n,source:i}}}}(Dn||(Dn={})),function(e){var t="__CcdCoordinateType__";e.CoordinateType={get:function(a){return a._staticPropertyData[t]},set:function(a,i){return a._staticPropertyData[t]=i}},e.is=function r(a){return"CCD"===a?.kind},e.fromFrame=function n(a,i){return i||(i=hl.schema.CCD(a)),{kind:"CCD",name:i._name,data:{db:i,frame:a}}}}(c2||(c2={})),function(e){function t(U,H){for(var z=[],G=H.frames,J=U.atomicHierarchy.atomSourceIndex,Z=ie.isIdentity(J)?void 0:J.toArray({array:Int32Array}),ne=h(U),Y=U.atomicHierarchy.atoms._rowCount,k=0,W=G.length;k<W;++k){var $=G[k];if($.elementCount!==Y)throw new Error("Frame element count mismatch, got ".concat($.elementCount," but expected ").concat(Y,"."));var K=R(R({},U),{id:kn.create22(),modelNum:k,atomicConformation:Qh.getAtomicConformation($,{atomId:U.atomicConformation.atomId,occupancy:U.atomicConformation.occupancy,B_iso_or_equiv:U.atomicConformation.B_iso_or_equiv},Z),customProperties:new Sl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if($.cell){var q=Ja.fromCell($.cell.size,$.cell.anglesInRadians);Ja.Provider.set(K,q)}e.TrajectoryInfo.set(K,{index:k,size:G.length}),e.CoarseGrained.set(K,ne),z.push(K)}return{trajectory:z,srcIndexArray:Z}}e.trajectoryFromModelAndCoordinates=function r(U,H){return new rp(t(U,H).trajectory)},e.trajectoryFromTopologyAndCoordinates=function n(U,H){var z=this;return Ve.create("Create Trajectory",function(G){return ue(z,void 0,void 0,function(){var J,X,Z,Y,k,W,$,K,q;return ce(this,function(V){switch(V.label){case 0:return[4,Ed(U.basic,U.sourceData,G)];case 1:if(0===(J=V.sent()).frameCount)throw new Error("found no model");for(Z=t(X=J.representative,H).trajectory,Y=Do.fromData({pairs:U.bonds,count:X.atomicHierarchy.atoms._rowCount}),k=h(X),W=0,$=0,K=Z;$<K.length;$++)Do.Provider.set(q=K[$],Y),e.TrajectoryInfo.set(q,{index:W++,size:Z.length}),e.CoarseGrained.set(q,k);return[2,new rp(Z)]}})})})};var a="__Center__";e.getCenter=function i(U){if(U._dynamicPropertyData[a])return U._dynamicPropertyData[a];var H=function LBe(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,Fu(e.x)),n.push.apply(n,Fu(e.y)),a.push.apply(a,Fu(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,Fu(t.spheres.x)),n.push.apply(n,Fu(t.spheres.y)),a.push.apply(a,Fu(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,Fu(t.gaussians.x)),n.push.apply(n,Fu(t.gaussians.y)),a.push.apply(a,Fu(t.gaussians.z))));var i=Fu(r),o=i[0],s=i[1],u=Fu(n),c=u[0],l=u[1],d=Fu(a),f=d[0];return b.create(o+(s-o)/2,c+(l-c)/2,f+(d[1]-f)/2)}(U.atomicConformation,U.coarseConformation);return U._dynamicPropertyData[a]=H,H};var s="__InvertedAtomSrcIndex__";e.getInvertedAtomSourceIndex=function u(U){if(U._staticPropertyData[s])return U._staticPropertyData[s];var H=function o(U){for(var H=new Int32Array(U.rowCount),z=!1,G=0,J=U.rowCount;G<J;G++){var X=U.value(G);X!==G&&(z=!1),H[X]=G}return{isIdentity:z,invertedIndex:H}}(U.atomicHierarchy.atomSourceIndex);return U._staticPropertyData[s]=H,H};var c="__TrajectoryInfo__";e.TrajectoryInfo={get:function(U){return U._dynamicPropertyData[c]||{index:0,size:1}},set:function(U,H){return U._dynamicPropertyData[c]=H}};var l="__AsymIdCount__";e.AsymIdCount={get:function(U){if(U._dynamicPropertyData[l])return U._dynamicPropertyData[l];var H=function UBe(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){t.add(n.auth_id),r.add(a)}),{auth:t.size,label:r.size}}(U);return U._dynamicPropertyData[l]=H,H}},e.AsymIdOffset=iv.createSimple("asym_id_offset","static"),e.Index=iv.createSimple("index","static"),e.MaxIndex=iv.createSimple("max_index","static"),e.getRoot=function d(U){return U.parent||U},e.areHierarchiesEqual=function f(U,H){return U.atomicHierarchy===H.atomicHierarchy&&U.coarseHierarchy===H.coarseHierarchy};var p="__CoordinatesHistory__";e.CoordinatesHistory={get:function(U){return U._staticPropertyData[p]},set:function(U,H){return U._staticPropertyData[p]=H}};var m="__CoarseGrained__";function h(U){var H=e.CoarseGrained.get(U);if(void 0===H){for(var z=0,G=U.atomicHierarchy.derived.residue.polymerType,J=0;J<G.length;++J)0!==G[J]&&(z+=1);var X=!1,Z=!1,ne=U.atomicHierarchy.atoms,Y=ne.label_atom_id,k=ne._rowCount;for(J=0;J<k;++J){var W=Y.value(J);if(!X&&"BB"===W&&(X=!0),!Z&&"SC1"===W&&(Z=!0),X&&Z)break}e.CoarseGrained.set(U,H=X&&Z||!(!z||!k)&&k/z<3)}return H}function C(U){return!!Dn.is(U.sourceData)&&(null!==U.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)||null!==U.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i))}e.CoarseGrained={get:function(U){return U._staticPropertyData[m]},set:function(U,H){return U._staticPropertyData[m]=H}},e.isCoarseGrained=h,e.hasCarbohydrate=function v(U){return U.properties.saccharideComponentMap.size>0},e.hasProtein=function g(U){for(var H=U.entities.subtype,z=0,G=H.rowCount;z<G;++z)if(H.value(z).startsWith("polypeptide"))return!0;return!1},e.hasNucleic=function y(U){for(var H=U.entities.subtype,z=0,G=H.rowCount;z<G;++z){var J=H.value(z);if(J.endsWith("ribonucleotide hybrid")||J.endsWith("ribonucleotide"))return!0}return!1},e.isFromPdbArchive=function S(U){if(!Dn.is(U.sourceData))return!1;for(var H=U.sourceData.data.db,z=0,G=H.database_2.database_id.rowCount;z<G;++z)if("pdb"===H.database_2.database_id.value(z))return!0;return!1},e.hasPdbId=C,e.hasSecondaryStructure=function _(U){if(Dn.is(U.sourceData)){var H=U.sourceData.data.db;return H.struct_conf.id.isDefined||H.struct_sheet_range.id.isDefined}return nv.Provider.isApplicable(U)};var x=b.create(1.5707963,1.5707963,1.5707963),D=b.create(1,1,1);function A(U){if(!Dn.is(U.sourceData))return!1;for(var H=U.sourceData.data.db,z=0;z<H.exptl.method.rowCount;z++)if(H.exptl.method.value(z).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}function E(U){if(!Dn.is(U.sourceData))return!1;for(var H=U.sourceData.data.db,z=0;z<H.exptl.method.rowCount;z++)if(H.exptl.method.value(z).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}function M(U){if(!Dn.is(U.sourceData)||!A(U))return!1;var z=U.sourceData.data.db.pdbx_database_status.status_code_sf;return z.isDefined&&"REL"===z.value(0)}function F(U){if(!Dn.is(U.sourceData))return!1;for(var H=U.sourceData.data.db,z=H.pdbx_database_related,G=z.db_name,J=z.content_type,X=0,Z=H.pdbx_database_related._rowCount;X<Z;++X)if("EMDB"===G.value(X).toUpperCase()&&"associated EM volume"===J.value(X))return!0;return!1}function N(U){return!!Dn.is(U.sourceData)&&(M(U)||F(U))}e.hasCrystalSymmetry=function w(U){var H,z=null===(H=Ja.Provider.get(U))||void 0===H?void 0:H.spacegroup;return!(!z||1===z.num&&b.equals(z.cell.anglesInRadians,x)&&b.equals(z.cell.size,D))},e.isFromXray=A,e.isFromEm=E,e.isFromNmr=function I(U){if(!Dn.is(U.sourceData))return!1;for(var H=U.sourceData.data.db,z=0;z<H.exptl.method.rowCount;z++)if(H.exptl.method.value(z).toUpperCase().indexOf("NMR")>=0)return!0;return!1},e.hasXrayMap=M,e.hasEmMap=F,e.hasDensityMap=N,e.probablyHasDensityMap=function j(U){if(!Dn.is(U.sourceData))return!1;var H=U.sourceData.data.db;return N(U)||C(U)&&(!H.exptl.method.isDefined||A(U)&&(!H.pdbx_database_status.status_code_sf.isDefined||2===H.pdbx_database_status.status_code_sf.valueKind(0))||E(U)&&!H.pdbx_database_related.db_name.isDefined)}}(ar||(ar={}));var l2=j4.EmptyResidueKey(),s6e=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return void 0!==r?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;1===arguments.length?i=t:(l2.label_entity_id=t,l2.label_asym_id=r,l2.auth_seq_id=n,l2.pdbx_PDB_ins_code=a,i=l2);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=iy(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueLabel=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=iy(t.label_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=iy(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=iy(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=Ye.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=rv.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=rv.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?nB(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):aB(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?nB(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):aB(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?nB(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):aB(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return function u6e(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e.prototype.findElementOnResidue=function(t,r){return function c6e(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)},e}();function nB(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function aB(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function v6e(e,t,r,n,a,i){var o=function d6e(e){if(0===e._rowCount)return{residues:[],chains:[]};for(var r=e._rowCount,n=[0],a=[0],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,c=e.pdbx_PDB_ins_code,l=1;l<r;l++){var d=!i.areValuesEqual(l-1,l)||!o.areValuesEqual(l-1,l);(d||!s.areValuesEqual(l-1,l)||!u.areValuesEqual(l-1,l)||!c.areValuesEqual(l-1,l))&&(n[n.length]=l),d&&(a[a.length]=l)}return{residues:n,chains:a}}(e),s=function f6e(e,t,r){var n=Xr.ofColumns(Xke,{type_symbol:ie.ofArray({array:ie.mapToArray(e.type_symbol,$h),schema:ie.Schema.Aliased(ie.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=Xr.view(e,Kke,r.residues),i=Xr.view(e,Zke,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,c=0,l=0,d=0,f=o.length;d<f;++d)s[d]>=u[c+1]&&(c+=1,l=0),o[d]=++l;a.label_seq_id=ie.ofIntArray(o)}return Xr.columnToArray(a,"label_seq_id",Int32Array),Xr.columnToArray(a,"auth_seq_id",Int32Array),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}(e,t,o),u=function h6e(e,t){var r=new Map;if(!Dn.is(t))return r;var n=cd(DUe,t.data.frame).molstar_atom_site_operator_mapping;if(0===n._rowCount)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=0===n.assembly_operator_id.valueKind(o)?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=ra.create(n.operator_name.value(o),he.identity(),{assembly:s,spgrOp:0===n.symmetry_operator_index.valueKind(o)?n.symmetry_operator_index.value(o):void 0,hkl:b.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),c=n.suffix.value(o),l=n.label_asym_id.value(o);a.set("".concat(l).concat(c),{name:l,operator:u});var d=n.auth_asym_id.value(o);i.set("".concat(d).concat(c),d)}var f=e.chains,p=f.label_asym_id,m=f.auth_asym_id,h=new Array(p.rowCount),v=new Array(p.rowCount);for(o=0;o<p.rowCount;o++)if(l=p.value(o),d=m.value(o),a.has(l)){var g=a.get(l),y=g.name;r.set(o,u=g.operator),h[o]=y,v[o]=i.get(d)||d}else h[o]=l,v[o]=d;return e.chains.label_asym_id=ie.ofArray({array:h,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ie.ofArray({array:v,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}(s,a);if(i&&function m6e(e,t){return Xr.areEqual(e.chains,t.chains)&&Xr.areEqual(e.residues,t.residues)&&Xr.areEqual(e.atoms,t.atoms)}(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var c={residueAtomSegments:pr.ofOffsets(o.residues,_e.ofBounds(0,e._rowCount)),chainAtomSegments:pr.ofOffsets(o.chains,_e.ofBounds(0,e._rowCount))},l=function l6e(e,t,r){for(var n=function o6e(e,t,r){return{entities:e,segments:r,label_seq_id:Ye.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,c=u.label_entity_id,l=u.label_asym_id,d=u.auth_asym_id,f=_e.ofBounds(0,e.atoms._rowCount),p=pr.transientSegments(r.chainAtomSegments,f);p.hasNext;){var m=p.move(),h=m.index,v=t.getEntityIndex(c.value(h));v<0&&i6e(c.value(h)),n.chain_index_entity_index[h]=v;var g=d.value(h),y=n.auth_asym_id_auth_seq_id.get(g);y||n.auth_asym_id_auth_seq_id.set(g,y=new Map);var S=l.value(h);n.label_asym_id.has(S)||n.label_asym_id.set(S,v),a6e(n.entity_index_label_asym_id,v,S,h);var C=new Map,_=new Map;n.chain_index_label_seq_id.set(h,C),n.chain_index_auth_seq_id.set(h,_);for(var x=pr.transientSegments(r.residueAtomSegments,f,m);x.hasNext;){var w=x.move().index,A=o.value(w),E=s.value(w);C.set(iy(i.value(w),E),w),_.set(iy(A,E),w),y.set(A,h)}}return new s6e(n)}(s,r,c),d=function n6e(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,c=t.residueAtomSegments.offsets,l=new Uint8Array(s),d=0;d<s;++d)l[d]=a2(o.value(d));var f=new Int32Array(u),p=new Int32Array(u),m=new Int32Array(u),h=new Uint8Array(u),v=new Uint8Array(u),g=new Map,y=new Map;for(d=0;d<u;++d){var S=i.value(c[d]),C=n,_=void 0,x=void 0;if(g.has(S))_=g.get(S),x=y.get(S);else{var D=void 0;C.has(S)?D=C.get(S).type:(uS||console.info("chemComp not found",S),D=uZ(S)),x=TBe(D,_=pm(D,S)),g.set(S,_),y.set(S,x)}h[d]=_,v[d]=x;var w=vm(x,"trace"),A=r.findAtomsOnResidue(d,w);if(-1===A){var E=vm(x,"coarseBackbone");-1===(A=r.findAtomsOnResidue(d,E))&&RA(_)&&(A=r.findElementOnResidue(d,$h("C")))}f[d]=A;var I=vm(x,"directionFrom");p[d]=r.findAtomsOnResidue(d,I);var M=vm(x,"directionTo");m[d]=r.findAtomsOnResidue(d,M)}return{atom:{atomicNumber:l},residue:{traceElementIndex:f,directionFromElementIndex:p,directionToElementIndex:m,moleculeType:h,polymerType:v}}}(s,c,l,n);return{sameAsPrevious:!1,hierarchy:R(R(R({},s),c),{index:l,derived:d}),chainOperatorMapping:u}}function kQ(e,t,r,n,a,i){var o=v6e(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,c=o.chainOperatorMapping,l=function p6e(e){return{id:kn.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:ie.ofConst(1,e._rowCount,ie.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}(e);return{sameAsPrevious:s,hierarchy:u,conformation:l,chainOperatorMapping:c}}var LQ={chainKey:[],entityKey:[],findSequenceKey:function(){return-1},findChainKey:function(){return-1},getEntityFromChain:function(){return-1},count:0,entity_id:ie.Undefined(0,ie.Schema.str),asym_id:ie.Undefined(0,ie.Schema.str),seq_id_begin:ie.Undefined(0,ie.Schema.int),seq_id_end:ie.Undefined(0,ie.Schema.int),chainElementSegments:pr.create([]),polymerRanges:Cn.ofSortedRanges([]),gapRanges:Cn.ofSortedRanges([])},UQ=function(e){return e.Empty={isDefined:!1,spheres:LQ,gaussians:LQ},e}(UQ||{});function g6e(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function y6e(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function S6e(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}function VQ(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,c=new Map,l={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count),m=0;m<o;m++)f[m]=t.getEntityIndex(r.value(m)),f[m]<0&&S6e(r.value(m));for(var h=0;h<s.count;h++){var v=s.offsets[h],g=s.offsets[h+1],y=f[v];p[h]=y;var C=g6e(y6e(c,y),n.value(v),l);for(m=v;m<g;m++)d[m]=C;var _=[],x=[];for(m=v;m<g;m++){var D=a.value(m),w=i.value(m);_.push(m),x.push(D,w)}var A={elementIndices:_,seqRanges:Cn.ofSortedRanges(x)};u.set(C,A)}var E=function b6e(e,t,r){var n=e.getEntityIndex;return{findChainKey:function(o,s){var u=n(o);if(u<0)return-1;var c=t.get(u);return c.has(s)?c.get(s):-1},findSequenceKey:function(o,s,u){var c=n(o);if(c<0)return-1;var l=t.get(c);if(void 0===l)return-1;var d=l.get(s);if(void 0===d)return-1;var f=r.get(d),p=f.elementIndices,h=Cn.firstIntersectionIndex(f.seqRanges,ke.ofSingleton(u));return-1!==h?p[h]:-1}}}(t,c,u);return{chainKey:d,entityKey:f,findSequenceKey:E.findSequenceKey,findChainKey:E.findChainKey,getEntityFromChain:function(N){return p[N]}}}function GQ(e,t){for(var r=[],n=[],a=pr.transientSegments(e.chainElementSegments,_e.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,c=s.end,l=-1,d=-1,f=u;f<c;++f){var p=o.value(f);f===u?(l=f,d=o.value(f)):i.value(f)-d>1&&(r.push(l,f-1),n.push(f-1,f),l=f),f===c-1&&r.push(l,f),d=p}return{polymerRanges:Cn.ofSortedRanges(r),gapRanges:Cn.ofSortedRanges(n)}}var zQ={hierarchy:UQ.Empty,conformation:void 0};function HQ(e){var t=e.entity_id,a=e.asym_id;return R({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:e.seq_id_begin,seq_id_end:e.seq_id_end},function w6e(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++)!e.areValuesEqual(a-1,a)&&(n[n.length]=a);return{chainElementSegments:pr.ofOffsets(n,_e.ofBounds(0,e.rowCount))}}(a))}function jQ(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return D4.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},c=[],l=i.rowCount,d=0;d<l;){for(var f=d;d<l-1&&i.areValuesEqual(d,d+1);)d++;d++;var p=i.value(f),m=ie.window(s,f,d),h=ie.window(o,f,d),v=t.getEntityIndex(p);u[v]={entityId:p,sequence:QS.ofResidueNames(m,h)},c.push(u[v])}return{byEntityKey:u,sequences:c}}function qQ(e,t,r,n){return ue(this,void 0,void 0,function(){var a,o,s,u,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return a=AO(r,n-1),o=t.label_asym_id,s=t.label_seq_id,u=SO(a,t.label_entity_id.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:h.sent(),h.label=2;case 2:c=0,l=u.length-1,h.label=3;case 3:if(!(c<l))return[3,10];d=SO(a,o.value,{start:u[c],end:u[c+1]}),f=0,p=d.length-1,h.label=4;case 4:return f<p?0!==s.valueKind(m=d[f])?[3,6]:(SO(a,s.value,{sort:!0,start:m,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6]):[3,7];case 5:h.sent(),h.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:h.sent(),h.label=9;case 9:return c++,[3,3];case 10:return function pAe(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:ie.ofIntArray(a)}]:[2,{atom_site:Xr.view(t,t._schema,a),sourceIndex:ie.ofIntArray(a)}]}})})}function WQ(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,c=i.directionToElementIndex,l=o[e],d=o[t];if(0===l||0===d||-1===s[e]||-1===s[t])return!1;var f=n.findAtomsOnResidue(e,vm(l,"backboneStart")),p=n.findAtomsOnResidue(t,vm(d,"backboneEnd"));(-1===f||-1===p)&&(f=n.findAtomsOnResidue(e,vm(l,"coarseBackbone")),p=n.findAtomsOnResidue(t,vm(d,"coarseBackbone")));var m=r.x,h=r.y,v=r.z,g=b.create(m[f],h[f],v[f]),y=b.create(m[p],h[p],v[p]),S=-1===u[e]||-1===c[e]||-1===u[t]||-1===c[t];return b.distance(g,y)<(S?10:3)}function YQ(e,t,r,n){for(var v,g,y,S,a=[],i=[],o=new Map,s=pr.transientSegments(e.chainAtomSegments,_e.ofBounds(0,e.atoms._rowCount)),u=pr.transientSegments(e.residueAtomSegments,_e.ofBounds(0,e.atoms._rowCount)),c=e.index,l=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,p=l.residue,m=p.moleculeType,h=p.traceElementIndex;s.hasNext;){var C=s.move();u.setSegment(C),v=-1,g=-1,y=-1,S=-1;var _=t.getEntityIndex(f.value(C.index)),x=n.byEntityKey[_],D=x?x.sequence.seqId.value(x.sequence.seqId.rowCount-1):-1,w=e.residueAtomSegments.index[C.start],A=e.residueAtomSegments.index[C.end-1],E=d.value(w),I=d.value(A);for(1===E&&I===D&&r.xyzDefined&&WQ(w,A,r,c,l)&&(o.set(w,A),o.set(A,w));u.hasNext;){var M=u.move(),F=M.index,N=d.value(F);RA(m[F])&&-1!==h[F]?-1!==S?N!==v+1?(a.push(S,y-1),i.push(g,M.end-1),S=M.start):u.hasNext?r.xyzDefined&&!WQ(e.residueAtomSegments.index[M.start],e.residueAtomSegments.index[y-1],r,e.index,l)&&(a.push(S,y-1),i.push(g,M.end-1),S=M.start):a.push(S,M.end-1):S=M.start:-1!==S&&(a.push(S,y-1),S=-1),g=M.start,y=M.end,v=N}}return{polymerRanges:Cn.ofSortedRanges(a),gapRanges:Cn.ofSortedRanges(i),cyclicPolymerMap:o}}function A6e(e){for(var t=new Map,r=function(s,u,c){return"".concat(s,"|").concat(u,"|").concat(c)},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,c){return t.has(r(s,u,c))},get:function(s,u,c){return t.get(r(s,u,c))},size:t.size}}function T6e(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),Xr.getRow(e.chem_comp,n));else XQ(e).forEach(function(o){t.set(o,function DBe(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:ey.has(e)?"y":"n",pdbx_synonyms:[],type:uZ(e)}}(o))});return t}function D6e(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0)for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if("SNFG CARBOHYDRATE SYMBOL"===a.value(o)||"SNFG CARB SYMBOL"===a.value(o)){var u=i.value(o),c=sBe.get(u);c?t.set(n.value(o),c):console.warn("Unknown SNFG name '".concat(u,"'"))}if(e.chem_comp._rowCount>0){var l=e.chem_comp,d=l.id;for(a=l.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var p=a.value(o);Kf.has(f)?t.set(f,Kf.get(f)):9===pm(p,f)&&t.set(f,C4)}}}else{var m=XQ(e);Kf.forEach(function(h,v){!t.has(v)&&m.has(v)&&t.set(v,h)})}return t}var XQ=pZ(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,i=n.isDefined?n:r.auth_comp_id,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function KQ(e,t){for(var r=new Map,n=e.chains,a=n.auth_asym_id,i=n.label_asym_id,o=n.label_entity_id,s=0,u=e.chains._rowCount;s<u;s++){var c=i.value(s);r.set(c,{id:c,auth_id:a.value(s),entity_id:o.value(s)})}if(t?.struct_asym._rowCount)for(var l=t.struct_asym,d=l.entity_id,f=(s=0,(c=l.id).rowCount);s<f;++s){var p=c.value(s);r.has(p)||r.set(p,{id:p,auth_id:"",entity_id:d.value(s)})}return r}var oB,E6e=ie.Schema.Aliased(ie.Schema.Str());function ZQ(e){var t;if(e.entity.id.isDefined)t=e.entity;else{for(var r=new Set,n=[],a=[],i=e.atom_site,o=i.label_entity_id,s=i.label_comp_id,u=0,c=e.atom_site._rowCount;u<c;u++){var l=o.value(u);r.has(l)||(n.push(l),a.push(EBe(s.value(u))),r.add(l))}var d=e.ihm_sphere_obj_site.entity_id;for(u=0,c=e.ihm_sphere_obj_site._rowCount;u<c;u++)l=d.value(u),r.has(l)||(n.push(l),a.push("polymer"),r.add(l));var f=e.ihm_gaussian_obj_site.entity_id;for(u=0,c=e.ihm_gaussian_obj_site._rowCount;u<c;u++)l=f.value(u),r.has(l)||(n.push(l),a.push("polymer"),r.add(l));t=Xr.ofPartialColumns(To.entity,{id:ie.ofArray({array:n,schema:To.entity.id}),type:ie.ofArray({array:a,schema:To.entity.type})},n.length)}var p=ie.createIndexer(t.id),m=new Array(t._rowCount);m.fill("other");var h=new Set,v=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){var g=e.entity_poly,y=g.entity_id,S=g.type,C=g._rowCount;for(u=0;u<C;++u)m[p(l=y.value(u))]=S.value(u),h.add(l)}else v=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){var _=e.pdbx_entity_branch;for(y=_.entity_id,S=_.type,C=_._rowCount,u=0;u<C;++u)m[p(l=y.value(u))]=S.value(u),h.add(l)}else v=!0;if(h.size<m.length&&(v=!0),v){var x=new Map;if(e.chem_comp){var D=e.chem_comp,w=D.id;for(S=D.type,u=0,c=e.chem_comp._rowCount;u<c;u++)x.set(w.value(u),S.value(u))}if(e.atom_site){var A=e.atom_site;for(o=A.label_entity_id,s=A.label_comp_id,u=0,c=e.atom_site._rowCount;u<c;u++)if(l=o.value(u),!h.has(l)){var E=s.value(u),I=x.get(E)||"other";m[p(l)]=IBe(E,I),h.add(l)}}}return{data:t,subtype:ie.ofArray({array:m,schema:E6e}),getEntityIndex:p}}function QQ(e,t,r){var n;if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;var a=new Array(t.data._rowCount);a.fill("");for(var i=e.pdbx_molecule,o=i.asym_id,s=i.prd_id,u=i._rowCount,c=0;c<u;++c){var l=o.value(c),d=null===(n=r.get(l))||void 0===n?void 0:n.entity_id;void 0!==d&&(a[t.getEntityIndex(d)]=s.value(c))}var f=ie.ofArray({array:a,schema:ie.Schema.str});return R(R({},t),{prd_id:f})}function Ed(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o;return ce(this,function(s){switch(s.label){case 0:return n=function I6e(e,t){return{missingResidues:A6e(e),chemicalComponentMap:T6e(e),saccharideComponentMap:D6e(e)}}(e),e.ihm_model_list._rowCount>0?[4,O6e(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,R6e(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)ar.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new rp(a)]}})})}function $Q(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function R6e(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,f;return ce(this,function(p){switch(p.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=ZQ(t),s=0,p.label=1;case 1:return s<i?(u=$Q(t.atom_site.pdbx_PDB_model_num,s),[4,qQ(e,t.atom_site,s,u)]):[3,3];case 2:return c=p.sent(),f=function P6e(e,t,r,n,a,i,o){var s=kQ(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return R(R({},o),{id:kn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var c=zQ,l=jQ(e,n,s.hierarchy,c.hierarchy),d=YQ(s.hierarchy,n,s.conformation,l),f=KQ(s.hierarchy),p=0===e.entry.id.valueKind(0)?e.entry.id.value(0):i.name,m=[];return p&&m.push(p),0===e.struct.title.valueKind(0)&&m.push(e.struct.title.value(0)),{id:kn.create22(),entryId:p,label:m.join(" | "),entry:p,sourceData:i,modelNum:u,parent:void 0,entities:QQ(e,n,f),sequence:l,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:c.hierarchy,coarseConformation:c.conformation,properties:R(R({},a),{structAsymMap:f}),customProperties:new Sl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}(t,c.atom_site,c.sourceIndex,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(f),s=u,[3,1];case 3:return[2,a]}})})}function iB(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=$Q(t,a),o=t.value(a);r.set(o,{table:Xr.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function O6e(e,t,r,n){return ue(this,void 0,void 0,function(){var a,o,s,u,c,l,d,f,p,m,h,v,g,y,_,x;return ce(this,function(D){switch(D.label){case 0:if(a=ZQ(t),o=iB(t.atom_site,t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num),s=iB(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=iB(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),c=[],!t.ihm_model_list)return[3,6];d=(l=t.ihm_model_list).model_id,f=l.model_name,p=0,D.label=1;case 1:return p<t.ihm_model_list._rowCount?(m=d.value(p),h=void 0,v=void 0,o.has(m)?(g=o.get(m),[4,qQ(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=D.sent(),h=y.atom_site,v=y.sourceIndex,[3,4];case 3:h=Xr.window(t.atom_site,t.atom_site._schema,0,0),v=ie.ofIntArray([]),D.label=4;case 4:_={model_id:m,model_name:f.value(p),model_group_name:MBe(m,t),entities:a,atom_site:h,atom_site_sourceIndex:v,ihm_sphere_obj_site:s.has(m)?s.get(m).table:Xr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(m)?u.get(m).table:Xr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},x=function M6e(e,t,r,n){var a=kQ(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=function C6e(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(0===r._rowCount&&0===n._rowCount)return zQ;var a=HQ(r),i=function x6e(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}(r),o=VQ(a,e.entities),s=GQ(a),u=HQ(n),c=function _6e(e){for(var t=To.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=Sr.toMat3(Qt(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}(n),l=VQ(u,e.entities),d=GQ(u);return{hierarchy:{isDefined:!0,spheres:R(R(R({},a),o),s),gaussians:R(R(R({},u),l),d)},conformation:{id:kn.create22(),spheres:i,gaussians:c}}}(t),o=jQ(e,t.entities,a.hierarchy,i.hierarchy),s=YQ(a.hierarchy,t.entities,a.conformation,o),u=0===e.entry.id.valueKind(0)?e.entry.id.value(0):n.name,c=[];u&&c.push(u),0===e.struct.title.valueKind(0)&&c.push(e.struct.title.value(0)),t.model_name&&c.push(t.model_name),t.model_group_name&&c.push(t.model_group_name);var l=KQ(a.hierarchy,e);return{id:kn.create22(),entryId:u,label:c.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:QQ(e,t.entities,l),sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:R(R({},r),{structAsymMap:l}),customProperties:new Sl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}(t,_,r,n),c.push(x),D.label=5;case 5:return p++,[3,1];case 6:return[2,c]}})})}function B6e(e){var t=this;return Ve.create("Parse GRO",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(c){switch(c.label){case 0:n=oB.fromGro(e),a=[],i=0,o=e.structures.length,c.label=1;case 1:return i<o?(s=function F6e(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Array(e.count),c=new xl,l=new Cl(e.residueNumber,e.atomName),d="",f=0,p="",m=0,h=0,v=-1,g=0,y=e.count;g<y;++g){var S=e.residueNumber.value(g);if(S!==v){var C=e.residueName.value(g),_=pm(l.add(C,g).type,C);(_!==h||S!==v+1&&!(99999===v&&0===S))&&(p=XS(f),f+=1,m=0),d=c.getEntityId(C,_,p),m+=1,v=S,h=_}a[g]=d,i[g]=p,o[g]=m,s[g]=g,u[g]=$0(e.atomName.value(g),e.residueName.value(g))}var x=ie.ofStringArray(i),D=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ie.ofFloatArray(ie.mapToArray(e.x,function(w){return 10*w},Float32Array)),Cartn_y:ie.ofFloatArray(ie.mapToArray(e.y,function(w){return 10*w},Float32Array)),Cartn_z:ie.ofFloatArray(ie.mapToArray(e.z,function(w){return 10*w},Float32Array)),id:ie.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:ie.ofIntArray(o),label_entity_id:ie.ofStringArray(a),occupancy:ie.ofConst(1,e.count,ie.Schema.float),type_symbol:ie.ofStringArray(u),pdbx_PDB_model_num:ie.ofConst(t,e.count,ie.Schema.int)},e.count);return Ic({entity:c.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:D})}(e.structures[i].atoms,i+1),[4,Ed(s,n,r)]):[3,4];case 2:1===(u=c.sent()).frameCount&&a.push(u.representative),c.label=3;case 3:return++i,[3,1];case 4:return[2,new rp(a)]}})})})}function N6e(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:pt.ofString(e),length_a:pt.ofString(r(6,9)),length_b:pt.ofString(r(15,9)),length_c:pt.ofString(r(24,9)),angle_alpha:pt.ofString(r(33,7)),angle_beta:pt.ofString(r(40,7)),angle_gamma:pt.ofString(r(47,7)),Z_PDB:pt.ofString(r(66,4)),pdbx_unique_axis:pt.ofString("?")},a={entry_id:pt.ofString(e),"space_group_name_H-M":pt.ofString(r(55,11)),Int_Tables_number:pt.ofString("?"),cell_setting:pt.ofString("?"),space_group_name_Hall:pt.ofString("?")};return[Zi.ofFields("cell",n),Zi.ofFields("symmetry",a)]}function JQ(e,t){return{id:e,details:t,groups:[]}}function k6e(e,t,r){for(var a,i,o,n=[],s=1,u=1,c=function(Y){return e.data.substring(e.indices[2*Y],e.indices[2*Y+1])},l=t;l<r;l++){var d=c(l);if("BIOMOLECULE:"===d.substr(11,12)){var f=d.substr(23).trim(),p="Biomolecule ".concat(f);"APPLY THE FOLLOWING TO CHAINS:"!==(d=c(l+1)).substr(11,30)&&(l++,p=d.substr(11).trim()),a=JQ(f,p),n.push(a)}else if("BIOMT"===d.substr(13,5)){var m=d.split(/\s+/);0==(h=parseInt(d[18])-1)&&(o=he.identity(),i.operators.push({id:s++,matrix:o})),he.setValue(o,h,0,parseFloat(m[4])),he.setValue(o,h,1,parseFloat(m[5])),he.setValue(o,h,2,parseFloat(m[6])),he.setValue(o,h,3,parseFloat(m[7]))}else if("APPLY THE FOLLOWING TO CHAINS:"===d.substr(11,30)||"                   AND CHAINS:"===d.substr(11,30)){"APPLY"===d.substr(11,5)&&a.groups.push(i={chains:[],operators:[]});for(var g=0,y=(v=d.substr(41,30).split(",")).length;g<y;++g)(S=v[g].trim())&&i.chains.push(S)}else if("APPLYING THE FOLLOWING TO CHAINS:"===d.substr(11,33)){var v;for(a=JQ("".concat(u),"Biomolecule ".concat(u)),n.push(a),u+=1,a.groups.push(i={chains:[],operators:[]}),g=0,y=(v=(d=c(++l)).substr(11,69).split(",")).length;g<y;++g){var S;(S=v[g].trim())&&i.chains.push(S)}}}if(0===n.length)return[];for(var C={id:pt.ofStrings(n.map(function(Y){return Y.id})),details:pt.ofStrings(n.map(function(Y){return Y.details}))},_=[],x=0,D=n;x<D.length;x++)for(var A=0,E=(w=D[x]).groups;A<E.length;A++){var I=E[A];_.push({assembly_id:w.id,oper_expression:I.operators.map(function(Y){return Y.id}).join(","),asym_id_list:I.chains.join(",")})}for(var M={assembly_id:pt.ofStrings(_.map(function(Y){return Y.assembly_id})),oper_expression:pt.ofStrings(_.map(function(Y){return Y.oper_expression})),asym_id_list:pt.ofStrings(_.map(function(Y){return Y.asym_id_list}))},F=[],N=0,j=n;N<j.length;N++)for(var w,U=0,H=(w=j[N]).groups;U<H.length;U++)for(var G=0,J=H[U].operators;G<J.length;G++){var X=J[G],h={id:""+X.id,type:"?",name:"?",symmetry_operation:"?"};for(l=0;l<3;l++){for(g=0;g<3;g++)h["matrix[".concat(l+1,"][").concat(g+1,"]")]=""+he.getValue(X.matrix,l,g);h["vector[".concat(l+1,"]")]=""+he.getValue(X.matrix,l,3)}F.push(h)}var Z={id:pt.ofStrings(F.map(function(Y){return Y.id})),type:pt.ofStrings(F.map(function(Y){return Y.type})),name:pt.ofStrings(F.map(function(Y){return Y.name})),symmetry_operation:pt.ofStrings(F.map(function(Y){return Y.symmetry_operation}))},ne=function(Y){for(var k=function(K){var q="matrix[".concat(Y+1,"][").concat(K+1,"]");Z[q]=pt.ofStrings(F.map(function(V){return V[q]}))},W=0;W<3;W++)k(W);var $="vector[".concat(Y+1,"]");Z[$]=pt.ofStrings(F.map(function(K){return K[$]}))};for(l=0;l<3;l++)ne(l);return[Zi.ofFields("pdbx_struct_assembly",C),Zi.ofFields("pdbx_struct_assembly_gen",M),Zi.ofFields("pdbx_struct_oper_list",Z)]}function L6e(e,t,r){for(var a,n=[],o=t;o<r;o++){var s=e.data.substring(e.indices[2*(y=o)],e.indices[2*y+1]),u=s.split(/\s+/);0==(c=parseInt(s[5])-1)&&(a=he.identity(),n.push(a)),he.setValue(a,c,0,parseFloat(u[2])),he.setValue(a,c,1,parseFloat(u[3])),he.setValue(a,c,2,parseFloat(u[4])),he.setValue(a,c,3,parseFloat(u[5]))}var y;if(0===n.length)return[];for(var l=[],d=1,f=0,p=n;f<p.length;f++){var m=p[f],c={id:"ncsop"+d++,code:".",details:"."};for(o=0;o<3;o++){for(var h=0;h<3;h++)c["matrix[".concat(o+1,"][").concat(h+1,"]")]=""+he.getValue(m,o,h);c["vector[".concat(o+1,"]")]=""+he.getValue(m,o,3)}l.push(c)}var v={id:pt.ofStrings(l.map(function(y){return y.id})),code:pt.ofStrings(l.map(function(y){return y.code})),details:pt.ofStrings(l.map(function(y){return y.details}))},g=function(y){for(var S=function(x){var D="matrix[".concat(y+1,"][").concat(x+1,"]");v[D]=pt.ofStrings(l.map(function(w){return w[D]}))},C=0;C<3;C++)S(C);var _="vector[".concat(y+1,"]");v[_]=pt.ofStrings(l.map(function(x){return x[_]}))};for(o=0;o<3;o++)g(o);return[Zi.ofFields("struct_ncs_oper",v)]}!function(e){e.is=function t(n){return"gro"===n?.kind},e.fromGro=function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}}(oB||(oB={}));var U6e={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function G6e(e,t,r){for(var n=[],i=t;i<r;i++){var o=e.data.substring(e.indices[2*(f=i)],e.indices[2*f+1]);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var f,s=pt.ofStrings(n.map(function(f){return f.initChainID})),u=pt.ofStrings(n.map(function(f){return f.initResName})),c=pt.ofStrings(n.map(function(f){return f.endChainID})),l=pt.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:pt.ofUndefined(n.length,ie.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:pt.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:pt.ofStrings(n.map(function(f){return function V6e(e){return U6e[e]||"helx_p"}(f.helixClass)})),details:pt.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:c,end_label_comp_id:l,end_label_seq_id:pt.ofUndefined(n.length,ie.Schema.int),end_auth_asym_id:c,end_auth_comp_id:l,end_auth_seq_id:pt.ofStrings(n.map(function(f){return f.endSeqNum})),id:pt.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:pt.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:pt.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:pt.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:pt.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:pt.ofStrings(n.map(function(f){return f.helixID}))};return Zi.ofFields("struct_conf",d)}function z6e(e,t,r){for(var n=[],i=t;i<r;i++){var o=e.data.substring(e.indices[2*(m=i)],e.indices[2*m+1]);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var m,s=pt.ofStrings(n.map(function(m){return m.initChainID})),u=pt.ofStrings(n.map(function(m){return m.initResName})),c=pt.ofStrings(n.map(function(m){return m.initSeqNum})),l=pt.ofStrings(n.map(function(m){return m.endChainID})),d=pt.ofStrings(n.map(function(m){return m.endResName})),f=pt.ofStrings(n.map(function(m){return m.endSeqNum})),p={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:c,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:c,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:f,end_auth_asym_id:l,end_auth_comp_id:d,end_auth_seq_id:f,id:pt.ofStrings(n.map(function(m){return m.strand})),sheet_id:pt.ofStrings(n.map(function(m){return m.sheetID})),pdbx_beg_PDB_ins_code:pt.ofStrings(n.map(function(m){return m.initICode})),pdbx_end_PDB_ins_code:pt.ofStrings(n.map(function(m){return m.endICode}))};return Zi.ofFields("struct_sheet_range",p)}var oy,sB,uB,H6e={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function j6e(e,t,r){for(var a,i={chains:[],description:""},o=[],s=t;s<r;s++){var c=e.data.substring(e.indices[2*(C=s)],e.indices[2*C+1]).substr(10,70).trim(),l=c.indexOf(":"),d=c.substring(0,l),f=void 0;d in H6e?(a=d,f=c.substring(l+2)):f=c,f=f.replace(/;$/,""),"MOL_ID"===a?o.push(i={chains:[],description:""}):"MOLECULE"===a?(i.description&&(i.description+=" "),i.description+=f):"CHAIN"===a&&Array.prototype.push.apply(i.chains,f.split(/\s*,\s*/))}for(var C,p=[],m=0,h=o;m<h.length;m++)for(var v=h[m],g=0,y=v.chains;g<y.length;g++)p.push({description:v.description,chains:[y[g]]});return p}function q6e(e,t,r){for(var a=new Map,i=t;i<r;i++){var o=e.data.substring(e.indices[2*(c=i)],e.indices[2*c+1]),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,"".concat(a.get(s)," ").concat(u)):a.set(s,u)}var c;return a}function e$(e,t,r,n,a,i){var o=r.data,s=a-n;Xe.addToken(e.group_PDB,lt.trim(r,n,n+6)),lt.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),Xe.addToken(e.auth_atom_id,lt.trim(r,n+12,n+16)),32===o.charCodeAt(n+16)?Xe.add(e.label_alt_id,0,0):Xe.add(e.label_alt_id,n+16,n+17),Xe.addToken(e.auth_comp_id,lt.trim(r,n+17,n+20)),Xe.add(e.auth_asym_id,n+21,n+22),Xe.addToken(e.auth_seq_id,lt.trim(r,n+22,n+26)),32===o.charCodeAt(n+26)?Xe.add(e.pdbx_PDB_ins_code,0,0):Xe.add(e.pdbx_PDB_ins_code,n+26,n+27),Xe.addToken(e.Cartn_x,lt.trim(r,n+30,n+38)),Xe.addToken(e.Cartn_y,lt.trim(r,n+38,n+46)),Xe.addToken(e.Cartn_z,lt.trim(r,n+46,n+54)),Xe.addToken(e.occupancy,lt.trim(r,n+54,n+60)),s>=66?Xe.addToken(e.B_iso_or_equiv,lt.trim(r,n+60,n+66)):Xe.add(e.B_iso_or_equiv,0,0),i&&Xe.addToken(e.partial_charge,lt.trim(r,n+70,n+76)),s>=78&&!i?(lt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?Xe.addToken(e.type_symbol,r):EA(e.type_symbol,o,n+12,n+16)):EA(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function K6e(e){var t=pt.ofTokens(e.pdbx_auth_seq_id),r=pt.ofTokens(e.pdbx_auth_comp_id),n=pt.ofTokens(e.pdbx_auth_asym_id),a=pt.ofTokens(e.pdbx_auth_atom_id),i={id:pt.ofStrings(e.id),type_symbol:pt.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:pt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:pt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=pt.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=pt.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=pt.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=pt.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=pt.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=pt.ofNumbers(e["U[2][3]"]),i}function Z6e(e,t,r,n,a){var i=r.data,o=a-n;lt.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),Xe.addToken(e.pdbx_auth_atom_id,lt.trim(r,n+12,n+16)),32===i.charCodeAt(n+16)?Xe.add(e.pdbx_label_alt_id,0,0):Xe.add(e.pdbx_label_alt_id,n+16,n+17),Xe.addToken(e.pdbx_auth_comp_id,lt.trim(r,n+17,n+20)),Xe.add(e.pdbx_auth_asym_id,n+21,n+22),Xe.addToken(e.pdbx_auth_seq_id,lt.trim(r,n+22,n+26)),32===i.charCodeAt(n+26)?Xe.add(e.pdbx_PDB_ins_code,0,0):Xe.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=Fh(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=Fh(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=Fh(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=Fh(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=Fh(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=Fh(i,n+63,n+70)/1e4,o>=78?(lt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?Xe.addToken(e.type_symbol,r):EA(e.type_symbol,i,n+12,n+16)):EA(e.type_symbol,i,n+12,n+16),e.index++}function $6e(e,t,r,n){var a=e.substring(t,r);n.id_code=a.substring(62,66).trim()||void 0,n.dep_date=a.substring(50,59).trim()||void 0,n.classification=a.substring(10,50).trim()||void 0}function J6e(e){return ue(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j,U,H,z,G,J,X,Z,ne;return ce(this,function(Y){for(n=(t=e.lines).indices,a=lt(r=t.data),i=!!e.isPdbqt,o=0,s=0,j=0,S=t.count;j<S;j++)switch(C=n[2*j],_=n[2*j+1],r[C]){case"A":Wa(r,C,_,"ATOM  ")?o++:Wa(r,C,_,"ANISOU")&&s++;break;case"H":Wa(r,C,_,"HETATM")&&o++}for(u={},c=function W6e(e,t){var n=function(){return Xe.create(e,2*t)};return{index:0,group_PDB:n(),id:[],auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:[],label_entity_id:[],partial_charge:n()}}(r,o),l=function X6e(e,t){var n=function(){return new Float32Array(t)},a=function(){return Xe.create(e,2*t)};return{index:0,count:t,id:[],type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}(r,s),d=new xl,f=[],p=[],m=0,h="",v=void 0,g=!1,y=new Set,j=0,S=t.count;j<S;j++)switch(C=n[2*j],_=n[2*j+1],r[C]){case"A":Wa(r,C,_,"ATOM  ")?(m||(m++,h=""+m),e$(c,h,a,C,_,i)):Wa(r,C,_,"ANISOU")&&Z6e(l,0,a,C,_);break;case"C":if(Wa(r,C,_,"CRYST1"))f.push.apply(f,N6e(e.id||"?",r.substring(C,_)));else if(Wa(r,C,_,"CONECT")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"CONECT");)x++;v?Cr&&console.log("only single CONECT block allowed, ignoring others"):v=[j,x],j=x-1}else if(Wa(r,C,_,"COMPND")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"COMPND");)x++;d.setCompounds(j6e(t,j,x)),j=x-1}break;case"H":if(Wa(r,C,_,"HEADER"))$6e(r,C,_,u);else if(Wa(r,C,_,"HETATM"))m||(m++,h=""+m),e$(c,h,a,C,_,i);else if(Wa(r,C,_,"HELIX")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"HELIX");)x++;f.push(G6e(t,j,x)),j=x-1}else if(Wa(r,C,_,"HETNAM")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"HETNAM");)x++;p.push.apply(p,Array.from(q6e(t,j,x).entries())),j=x-1}break;case"M":if(Wa(r,C,_,"MODEL ")&&(m++,h=""+m),Wa(r,C,_,"MTRIX")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"MTRIX");)x++;f.push.apply(f,L6e(t,j,x)),j=x-1}break;case"O":break;case"R":if(Wa(r,C,_,"REMARK 350")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"REMARK 350");)x++;f.push.apply(f,k6e(t,j,x)),j=x-1,g=!0}break;case"S":if(Wa(r,C,_,"SHEET")){for(x=j+1;Wa(r,C=n[2*x],_=n[2*x+1],"SHEET");)x++;f.push(z6e(t,j,x)),j=x-1}break;case"T":Wa(r,C,_,"TER")&&y.add(c.index)}for(u.id_code&&(D={id:pt.ofString(u.id_code)},f.push(Zi.ofFields("entry",D))),u.classification&&(w={pdbx_keywords:pt.ofString(u.classification)},f.push(Zi.ofFields("struct_keywords",w))),u.dep_date&&(A={recvd_initial_deposition_date:pt.ofString(u.dep_date)},f.push(Zi.ofFields("pdbx_database_status",A))),E=ie.ofIntTokens(c.auth_seq_id),I=ie.ofStringTokens(c.auth_atom_id),M=ie.ofStringTokens(c.auth_comp_id),F=ie.ofStringTokens(c.auth_asym_id),(N=new Cl(E,I)).setNames(p),d.setNames(p),j=0,U=M.rowCount;j<U;++j)H=M.value(j),z=pm(N.add(H,j).type,H),c.label_entity_id[j]=d.getEntityId(H,z,F.value(j));for(G=function Y6e(e,t,r){for(var n=pt.ofStrings(e.pdbx_PDB_model_num),a=pt.ofTokens(e.auth_asym_id),i=pt.ofTokens(e.auth_seq_id),o=pt.ofTokens(e.pdbx_PDB_ins_code),s=pt.ofTokens(e.auth_atom_id),u=pt.ofTokens(e.auth_comp_id),c=pt.ofStrings(e.id),l=n.str(0),d=a.str(0),f=i.int(0),p=o.str(0),m=d,h=f,v=new Map,g=new Map,y=[],S=[],C=[],_=!1,x=0,D=c.rowCount;x<D;++x)if(""!==o.str(x)){_=!0;break}for(x=0,D=c.rowCount;x<D;++x){var w=n.str(x),A=a.str(x),E=i.int(x),I=o.str(x),M=s.str(x);if(w!==l?(v.clear(),g.clear(),l=w,d=A,f=E,p=I,m=A,h=E):d!==A?(g.clear(),d=A,f=E,p=I,m=A,h=E):f!==E?(g.clear(),f===h?h=E:h+=1,f=E,p=I):p!==I&&(g.clear(),p=I,h+=1),v.has(A)){if(t.has(x)&&!r.hasAssemblies){var F=v.get(A)+1;v.set(A,F),m="".concat(A,"_").concat(F)}}else v.set(A,0);if(y[x]=m,g.has(M)){var N=g.get(M)+1;g.set(M,N),M="".concat(M,"_").concat(N)}else g.set(M,0);S[x]=M,_&&(C[x]=h)}var j=ie.ofStringArray(y),U=ie.ofStringArray(S),H=_?pt.ofColumn(ie.ofIntArray(C)):pt.ofUndefined(e.index,ie.Schema.int);return{auth_asym_id:a,auth_atom_id:s,auth_comp_id:u,auth_seq_id:i,B_iso_or_equiv:pt.ofTokens(e.B_iso_or_equiv),Cartn_x:pt.ofTokens(e.Cartn_x),Cartn_y:pt.ofTokens(e.Cartn_y),Cartn_z:pt.ofTokens(e.Cartn_z),group_PDB:pt.ofTokens(e.group_PDB),id:c,label_alt_id:pt.ofTokens(e.label_alt_id),label_asym_id:pt.ofColumn(j),label_atom_id:pt.ofColumn(U),label_comp_id:u,label_seq_id:H,label_entity_id:pt.ofStrings(e.label_entity_id),occupancy:cTe(e.occupancy)?pt.ofUndefined(e.index,ie.Schema.float):pt.ofTokens(e.occupancy),type_symbol:pt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:pt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:n,partial_charge:pt.ofTokens(e.partial_charge)}}(c,y,{hasAssemblies:g}),i||delete G.partial_charge,v&&f.push(function Q6e(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;var u=[],c=[],l=[],d=[],f=[],p=[],m=[],h=[],v=[],g=[],y=[],S=[],C=[11,16,21,26],_=1;for(i=t;i<r;i++){var x=e.data.substring(e.indices[2*(F=i)],e.indices[2*F+1]),D=a[parseInt(x.substr(6,5))],w={};if(void 0!==D)for(var A=0;A<4;++A){var E=parseInt(x.substr(C[A],5));if(!Number.isNaN(E)){var I=a[E];void 0!==I&&(D>I||void 0===w[I]&&(u.push("covale".concat(_)),c.push("covale"),l.push(n.label_asym_id.str(D)),d.push(n.auth_seq_id.int(D)),f.push(n.label_atom_id.str(D)),p.push(n.label_alt_id.str(D)),m.push(n.pdbx_PDB_ins_code.str(D)),h.push(n.label_asym_id.str(I)),v.push(n.auth_seq_id.int(I)),g.push(n.label_atom_id.str(I)),y.push(n.label_alt_id.str(I)),S.push(n.pdbx_PDB_ins_code.str(I)),_+=1))}}}var F,M={id:pt.ofStrings(u),conn_type_id:pt.ofStrings(c),ptnr1_label_asym_id:pt.ofStrings(l),ptnr1_auth_seq_id:pt.ofNumbers(d),ptnr1_label_atom_id:pt.ofStrings(f),pdbx_ptnr1_label_alt_id:pt.ofStrings(p),pdbx_ptnr1_PDB_ins_code:pt.ofStrings(m),ptnr2_label_asym_id:pt.ofStrings(h),ptnr2_auth_seq_id:pt.ofNumbers(v),ptnr2_label_atom_id:pt.ofStrings(g),pdbx_ptnr2_label_alt_id:pt.ofStrings(y),pdbx_ptnr2_PDB_ins_code:pt.ofStrings(S)};return Zi.ofFields("struct_conn",M)}(t,v[0],v[1],G)),J={entity:Zi.ofTable("entity",d.getEntityTable()),chem_comp:Zi.ofTable("chem_comp",N.getChemCompTable()),atom_site:Zi.ofFields("atom_site",G),atom_site_anisotrop:Zi.ofFields("atom_site_anisotrop",K6e(l))},X=0,Z=f;X<Z.length;X++)J[(ne=Z[X]).name]=ne;return[2,{header:e.id||"PDB",categoryNames:Object.keys(J),categories:J}]})})}function e8e(e){var t=this;return Ve.create("Parse PDB",function(r){return ue(t,void 0,void 0,function(){var n,a,o,s,u,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return h.sent(),[4,J6e(e)];case 2:return n=h.sent(),[4,Ed(Ic((a=Dn.fromFrame(n,void 0,sB.create(e))).data.db,!0),a,r)];case 3:return o=h.sent(),(s=null===(m=n.categories.atom_site)||void 0===m?void 0:m.getField("partial_charge"))&&1===o.frameCount&&(l=ie.isIdentity(c=(u=o.representative).atomicHierarchy.atomSourceIndex),d=l?void 0:c.toArray({array:Int32Array}),f=s.toFloatArray(),p=ie.ofFloatArray(d?ie.mapToArray(c,function(v){return f[v]},Float32Array):f),oy.Provider.set(u,{data:p,type:"GASTEIGER"})),[2,o]}})})})}function r8e(e){var t=this;return Ve.create("Parse PSF",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(c){return n=uB.fromPsf(e),a=function t8e(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new Array(e.count),o=new xl,s=new Cl(e.residueId,e.atomName),u="",c=0,l="",d=0,f=e.segmentName.value(0),p=!1,m=0,h=-1,v=0,g=e.count;v<g;++v){var y=e.residueId.value(v),S=e.segmentName.value(v);if(f!==S?(l=XS(c),c+=1,d=0,p=!0,f=S):p=!1,p||y!==h){var C=e.residueName.value(v),_=pm(s.add(C,v).type,C);!p&&(_!==m||y!==h+1)&&(l=XS(c),c+=1,d=0),u=o.getEntityId(C,_,l),d+=1,h=y,m=_}t[v]=u,r[v]=l,n[v]=d,a[v]=v,i[v]=$0(e.atomName.value(v),e.residueName.value(v))}var x=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ie.ofIntArray(a),label_asym_id:ie.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ie.ofIntArray(n),label_entity_id:ie.ofStringArray(t),occupancy:ie.ofConst(1,e.count,ie.Schema.float),type_symbol:ie.ofStringArray(i),pdbx_PDB_model_num:ie.ofConst(1,e.count,ie.Schema.int)},e.count);return Ic({entity:o.getEntityTable(),chem_comp:s.getChemCompTable(),atom_site:x})}(e.atoms),s=(i=e.bonds).atomIdB,u={indexA:ie.ofLambda({value:function(l){return o.value(l)-1},rowCount:(o=i.atomIdA).rowCount,schema:o.schema}),indexB:ie.ofLambda({value:function(l){return s.value(l)-1},rowCount:s.rowCount,schema:s.schema}),order:ie.ofConst(1,e.bonds.count,ie.Schema.int)},[2,ZS.create(e.id,a,u,n)]})})})}function n8e(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function cB(e,t,r){return e&&void 0!==e[t]?e[t]:r}function tt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function eT(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro.".concat(e.info.name),{kind:"macro",symbol:e,translate:t,aliases:or([e.info.name],r,!0)}}function a8e(e){return"alias"===e.kind||"macro"===e.kind}!function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=_l.create(e.Descriptor)}(oy||(oy={})),function(e){e.is=function t(n){return"pdb"===n?.kind},e.create=function r(n){return{kind:"pdb",name:n.id||"",data:n}}}(sB||(sB={})),function(e){e.is=function t(n){return"psf"===n?.kind},e.fromPsf=function r(n){return{kind:"psf",name:n.id,data:n}}}(uB||(uB={}));var i8e=[["Core symbols",tt(Se.core.type.bool,"bool"),tt(Se.core.type.num,"num"),tt(Se.core.type.str,"str"),tt(Se.core.type.regex,"regex"),tt(Se.core.type.list,"list"),tt(Se.core.type.set,"set"),tt(Se.core.type.compositeKey,"composite-key"),tt(Se.core.logic.not,"not"),tt(Se.core.logic.and,"and"),tt(Se.core.logic.or,"or"),tt(Se.core.ctrl.if,"if"),tt(Se.core.ctrl.fn,"fn"),tt(Se.core.ctrl.eval,"eval"),tt(Se.core.math.add,"add","+"),tt(Se.core.math.sub,"sub","-"),tt(Se.core.math.mult,"mult","*"),tt(Se.core.math.div,"div","/"),tt(Se.core.math.pow,"pow","**"),tt(Se.core.math.mod,"mod"),tt(Se.core.math.min,"min"),tt(Se.core.math.max,"max"),tt(Se.core.math.cantorPairing,"cantor-pairing"),tt(Se.core.math.sortedCantorPairing,"sorted-cantor-pairing"),tt(Se.core.math.invertCantorPairing,"invert-cantor-pairing"),tt(Se.core.math.floor,"floor"),tt(Se.core.math.ceil,"ceil"),tt(Se.core.math.roundInt,"round"),tt(Se.core.math.trunc,"trunc"),tt(Se.core.math.abs,"abs"),tt(Se.core.math.sign,"sign"),tt(Se.core.math.sqrt,"sqrt"),tt(Se.core.math.cbrt,"cbrt"),tt(Se.core.math.sin,"sin"),tt(Se.core.math.cos,"cos"),tt(Se.core.math.tan,"tan"),tt(Se.core.math.asin,"asin"),tt(Se.core.math.acos,"acos"),tt(Se.core.math.atan,"atan"),tt(Se.core.math.sinh,"sinh"),tt(Se.core.math.cosh,"cosh"),tt(Se.core.math.tanh,"tanh"),tt(Se.core.math.exp,"exp"),tt(Se.core.math.log,"log"),tt(Se.core.math.log10,"log10"),tt(Se.core.math.atan2,"atan2"),tt(Se.core.rel.eq,"eq","="),tt(Se.core.rel.neq,"neq","!="),tt(Se.core.rel.lt,"lt","<"),tt(Se.core.rel.lte,"lte","<="),tt(Se.core.rel.gr,"gr",">"),tt(Se.core.rel.gre,"gre",">="),tt(Se.core.rel.inRange,"in-range"),tt(Se.core.str.concat,"concat"),tt(Se.core.str.match,"regex.match"),tt(Se.core.list.getAt,"list.get"),tt(Se.core.set.has,"set.has"),tt(Se.core.set.isSubset,"set.subset")],["Structure",["Types",tt(Se.structureQuery.type.entityType,"ent-type"),tt(Se.structureQuery.type.authResidueId,"auth-resid"),tt(Se.structureQuery.type.labelResidueId,"label-resid"),tt(Se.structureQuery.type.ringFingerprint,"ringfp"),tt(Se.structureQuery.type.bondFlags,"bond-flags")],["Slots",tt(Se.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",tt(Se.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),tt(Se.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),tt(Se.structureQuery.generator.rings,"sel.atom.rings"),tt(Se.structureQuery.generator.empty,"sel.atom.empty"),tt(Se.structureQuery.generator.all,"sel.atom.all"),tt(Se.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),eT($S("sel.atom.atoms",Gt.Dictionary({0:ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Tt.ElementSelection,"A selection of singleton atom sets."),function(e){return fe.struct.generator.atomGroups({"atom-test":cB(e,0,!0)})}),eT($S("sel.atom.res",Gt.Dictionary({0:ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Tt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return fe.struct.generator.atomGroups({"residue-test":cB(e,0,!0),"group-by":fe.ammp("residueKey")})}),eT($S("sel.atom.chains",Gt.Dictionary({0:ft(Te.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Tt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return fe.struct.generator.atomGroups({"chain-test":cB(e,0,!0),"group-by":fe.ammp("chainKey")})})],["Modifiers",tt(Se.structureQuery.modifier.queryEach,"sel.atom.query-each"),tt(Se.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),tt(Se.structureQuery.modifier.exceptBy,"sel.atom.except-by"),tt(Se.structureQuery.modifier.unionBy,"sel.atom.union-by"),tt(Se.structureQuery.modifier.union,"sel.atom.union"),tt(Se.structureQuery.modifier.cluster,"sel.atom.cluster"),tt(Se.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),tt(Se.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),tt(Se.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),tt(Se.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",tt(Se.structureQuery.filter.pick,"sel.atom.pick"),tt(Se.structureQuery.filter.first,"sel.atom.first"),tt(Se.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),tt(Se.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),tt(Se.structureQuery.filter.within,"sel.atom.within"),tt(Se.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",tt(Se.structureQuery.combinator.intersect,"sel.atom.intersect"),tt(Se.structureQuery.combinator.merge,"sel.atom.merge"),tt(Se.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",tt(Se.structureQuery.atomSet.atomCount,"atom.set.atom-count"),tt(Se.structureQuery.atomSet.countQuery,"atom.set.count-query"),tt(Se.structureQuery.atomSet.reduce,"atom.set.reduce"),tt(Se.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",tt(Se.structureQuery.atomProperty.core.elementSymbol,"atom.el"),tt(Se.structureQuery.atomProperty.core.vdw,"atom.vdw"),tt(Se.structureQuery.atomProperty.core.mass,"atom.mass"),tt(Se.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),tt(Se.structureQuery.atomProperty.core.x,"atom.x"),tt(Se.structureQuery.atomProperty.core.y,"atom.y"),tt(Se.structureQuery.atomProperty.core.z,"atom.z"),tt(Se.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),tt(Se.structureQuery.atomProperty.core.operatorName,"atom.op-name"),tt(Se.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),tt(Se.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),tt(Se.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),tt(Se.structureQuery.atomProperty.core.atomKey,"atom.key"),tt(Se.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),tt(Se.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),tt(Se.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),tt(Se.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),tt(Se.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),tt(Se.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),tt(Se.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),tt(Se.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),tt(Se.structureQuery.atomProperty.macromolecular.id,"atom.id"),tt(Se.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),tt(Se.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),tt(Se.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),tt(Se.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),tt(Se.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),tt(Se.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),tt(Se.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),tt(Se.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),tt(Se.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),tt(Se.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),tt(Se.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),tt(Se.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),tt(Se.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),tt(Se.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),tt(Se.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),tt(Se.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),tt(Se.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),tt(Se.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),tt(Se.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),tt(Se.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),tt(Se.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),tt(Se.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),tt(Se.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",tt(Se.structureQuery.bondProperty.order,"bond.order"),tt(Se.structureQuery.bondProperty.length,"bond.length"),tt(Se.structureQuery.bondProperty.key,"bond.key"),tt(Se.structureQuery.bondProperty.atomA,"bond.atom-a"),tt(Se.structureQuery.bondProperty.atomB,"bond.atom-b"),eT($S("bond.is",Gt.List(Tt.BondFlag),Te.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: ".concat(Te.oneOfValues(Tt.BondFlag).join(", "))),function(e){return fe.core.flags.hasAny([fe.struct.bondProperty.flags(),fe.struct.type.bondFlags(n8e(e))])})]]],t$=[];!function r$(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];a8e(n)?t$.push(n):n instanceof Array&&r$(n)}}(i8e);var tT=function(){for(var e=[],t=Object.create(null),r=En.create(),n=En.create(),a=0,i=t$;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){if(e.push([c=u[s],o]),t[c])throw new Error("Alias '".concat(c,"' already in use."));t[c]=o}var l=o.symbol.args;if("dictionary"===l.kind)for(var d=0,f=Object.keys(l.map);d<f.length;d++){var c=f[d];isNaN(c)&&En.add(r,c,c);var p=l.map[c];"oneof"===p.type.kind&&Te.oneOfValues(p.type).forEach(function(h){return En.add(n,h,h)})}else"oneof"===l.type.kind&&Te.oneOfValues(l.type).forEach(function(m){return En.add(n,m,m)})}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),sy=tT.symbolMap;function d2(e){if($i.isLiteral(e))return e;if($i.isSymbol(e)){if(!sy[e.name])return e;var t=sy[e.name];if("alias"===t.kind)return $i.Symbol(sy[e.name].symbol.id);throw t.translate([])}var r=$i.isSymbol(e.head)&&!!sy[e.head.name]&&"macro"===sy[e.head.name].kind,n=r?e.head:d2(e.head),a=n!==e.head;if(!e.args)return r?d2(e.head):a?$i.Apply(n):e;var o,i=!1;if($i.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++)(c=e.args[s])!==(l=d2(c))&&(i=!0),o[o.length]=l;if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var c,l,p=f[d];(c=e.args[p])!==(l=d2(c))&&(i=!0),o[p]=l}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var m=sy[e.head.name];return"macro"!==m.kind?$i.Apply(n,o):m.translate(o)}return $i.Apply(n,o)}function o8e(e){return d2(e)}var dB,We=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:n$(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=function c8e(e,t){return"expected ".concat(function s8e(e){return 1===e.length?e[0]:"one of "+e.join(", ")}(t.expected)).concat(function u8e(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line ".concat(r.line," column ").concat(r.column,", got ").concat(a).concat(e.slice(n,n+12)).concat(i)}(e,t))}(t,r);throw new Error(n)},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return lB(1,"string"==typeof t?e.string(t):t,this,"string"==typeof r?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return lB(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;){if(!(i=Nc(t._(r,n),i)).status)return Nc(os(n,a),i);if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}})},e.prototype.times=function(t,r){var n=this,a=typeof r>"u"?t:r;return new e(function(i,o){var l,s=[],u=void 0,c=void 0;for(l=0;l<t;l++){if(c=Nc(u=n._(i,o),c),!u.status)return c;o=u.index,s.push(u.value)}for(;l<a&&(c=Nc(u=n._(i,o),c),u.status);l+=1)o=u.index,s.push(u.value);return Nc(os(o,s),c)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return or(or([],r[0],!0),r[1],!0)})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?Nc(os(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return lB(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){return(0,r[0])(r[1])})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?Nc(t(i.value)._(n,i.index),i):i})},e}();function lB(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new We(function(a,i){for(var o,s,u=i,c=0;c<n;c++){if(!(o=Nc(t[c]._(a,u),o)).status)return o;e===c&&(s=o.value),u=o.index}return Nc(os(u,s),o)})}function os(e,t){return{status:!0,index:e,value:t}}function np(e,t){return{status:!1,furthest:e,expected:[t]}}function Nc(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?function l8e(e,t){var r=e.length,n=t.length;if(0===r)return t;if(0===n)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function n$(e,t){var r=e.slice(0,t).split("\n");return{offset:t,line:r.length,column:r[r.length-1].length+1}}!function(e){function n(){for(var w=[],A=0;A<arguments.length;A++)w[A]=arguments[A];var E=w.length;return new e(function(I,M){for(var F,N=new Array(E),j=M,U=0;U<E;U++){if(!(F=Nc(w[U]._(I,j),F)).status)return F;N[U]=F.value,j=F.index}return Nc(os(j,N),F)})}function a(){for(var w=[],A=0;A<arguments.length;A++)w[A]=arguments[A];return 0===w.length?f("zero alternates"):new e(function(I,M){for(var F,N=0;N<w.length;N++)if((F=Nc(w[N]._(I,M),F)).status)return F;return F})}function o(w,A){return n(w,A.then(w).many()).map(function(I){return or([I[0]],I[1],!0)})}function s(w){var A="'".concat(w,"'");if(1===w.length){var E=w.charCodeAt(0);return new e(function(I,M){return I.charCodeAt(M)===E?os(M+1,w):np(M,A)})}return new e(function(I,M){var F=M+w.length;return I.slice(M,F)===w?os(F,w):np(M,A)})}function l(w,A){void 0===A&&(A=0);var E=function c(w){return RegExp("^(?:"+w.source+")",function u(w){var A=""+w;return A.slice(A.lastIndexOf("/")+1)}(w))}(w),I=""+w;return new e(function(M,F){var N=E.exec(M.slice(F));return N?0<=A&&A<=N.length?os(F+N[0].length,N[A]):np(F,"invalid match group (0 to ".concat(N.length,") in ").concat(I)):np(F,I)})}function d(w){return new e(function(A,E){return os(E,w)})}function f(w){return new e(function(A,E){return np(E,w)})}function h(w){return new e(function(A,E){var I=A.charAt(E);return E<A.length&&w(I)?os(E+1,I):np(E,"a character "+w)})}function C(w){var A=new e(function(E,I){var M=w()._;return A._=M,M(E,I)});return A}e.seqMap=function t(w,A,E){var I=[].slice.call(arguments);if(0===I.length)throw new Error("seqMap needs at least one argument");var M=I.pop();return function f8e(e){if("function"!=typeof e)throw new Error("not a function: "+e)}(M),n.apply(null,I).map(function(F){return M.apply(null,F)})},e.createLanguage=function r(w){for(var A={},E=0,I=Object.keys(w);E<I.length;E++)!function(F){A[F]=C(function(){return w[F](A)})}(I[E]);return A},e.seq=n,e.alt=a,e.sepBy=function i(w,A){return o(w,A).or(d([]))},e.sepBy1=o,e.string=s,e.regexp=l,e.succeed=d,e.fail=f,e.lookahead=function p(w){if(function d8e(e){return e instanceof We}(w))return new e(function(A,E){var I=w._(A,E);return I.status&&(I.index=E,I.value=null),I});if("string"==typeof w)return p(s(w));if(w instanceof RegExp)return p(l(w));throw new Error("not a string, regexp, or parser: "+w)},e.notFollowedBy=function m(w){return new e(function(A,E){var I=w._(A,E);return I.status?np(E,'not "'+A.slice(E,I.index)+'"'):os(E,null)})},e.test=h,e.oneOf=function v(w){return h(function(A){return w.indexOf(A)>=0})},e.noneOf=function g(w){return h(function(A){return w.indexOf(A)<0})},e.range=function y(w,A){return h(function(E){return w<=E&&E<=A}).desc(w+"-"+A)},e.takeWhile=function S(w){return new e(function(A,E){for(var I=E;I<A.length&&w(A.charAt(I));)I++;return os(I,A.slice(E,I))})},e.lazy=C,e.empty=function _(){return f("empty")},e.index=new e(function(w,A){return os(A,n$(w,A))}),e.anyChar=new e(function(w,A){return A>=w.length?np(A,"any character"):os(A+1,w.charAt(A))}),e.all=new e(function(w,A){return os(w.length,w.slice(A))}),e.eof=new e(function(w,A){return A<w.length?np(A,"EOF"):os(A,null)}),e.digit=l(/[0-9]/).desc("a digit"),e.digits=l(/[0-9]*/).desc("optional digits"),e.letter=l(/[a-z]/i).desc("a letter"),e.letters=l(/[a-z]*/i).desc("optional letters"),e.optWhitespace=l(/\s*/).desc("optional whitespace"),e.whitespace=l(/\s+/).desc("whitespace"),e.cr=s("\r"),e.lf=s("\n"),e.crlf=s("\r\n"),e.newline=a(e.crlf,e.lf,e.cr).desc("newline"),e.end=a(e.newline,e.eof),e.of=function x(w){return d(w)},e.regex=function D(w){return l(w)}}(We||(We={})),function(e){var t,C;(C=t||(t={})).str=function _(A){return{kind:"string",value:A}},C.symb=function x(A){return{kind:"symbol",value:A}},C.list=function D(A,E){return{kind:"list",bracket:A,nodes:E}},C.comment=function w(A){return{kind:"comment",value:A}};var r=We.regexp(/[\n\r\s]*/),n=We.lazy(function(){return We.alt(a,d,i,o).trim(r)}),a=We.takeWhile(function(C){return"`"!==C}).trim("`").map(t.str),i=We.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=We.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(C){return t.list("(",C)}),c=s.wrap("[","]").map(function(C){return t.list("[",C)}),l=s.wrap("{","}").map(function(C){return t.list("{",C)}),d=We.alt(u,c,l),f=n.many();function m(C){switch(C.kind){case"string":return C.value;case"symbol":var _=C.value;if(_.length>1)switch(_.charAt(0)){case".":return fe.atomName(_.substr(1));case"_":return fe.struct.type.elementSymbol([_.substr(1)])}return"true"===_||"false"!==_&&(function y(C){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(C)&&!isNaN(+C)}(_)?+_:$i.Symbol(_));case"list":switch(C.bracket){case"[":return fe.core.type.list(g(C.nodes).map(m));case"{":return fe.core.type.set(g(C.nodes).map(m));case"(":if("comment"===C.nodes[0].kind)throw new Error("Invalid expression");var D=m(C.nodes[0]);return $i.Apply(D,function h(C){if(!(C.length<=1)){if(!function v(C){for(var _=1,x=C.length;_<x;_++){var D=C[_];if("symbol"===D.kind&&D.value.length>1&&":"===D.value.charAt(0))return!0}return!1}(C)){for(var _=[],x=1,D=C.length;x<D;x++)"comment"!==(w=C[x]).kind&&(_[_.length]=m(w));return _}var A={},E=!0,I=0;for(x=1,D=C.length;x<D;x++){var w;if("comment"!==(w=C[x]).kind)if("symbol"===w.kind&&w.value.length>1&&":"===w.value.charAt(0)){var M=w.value.substr(1);for(++x;x<D&&"comment"===C[x].kind;)x++;if(x>=D)throw new Error("There must be a value foolowed a named arg ':".concat(M,"'."));if("comment"===C[x].kind)throw new Error("Invalid expression");A[M]=m(C[x]),isNaN(+M)&&(E=!1)}else A[I++]=m(w)}if(E){var F=Object.keys(A).map(function(U){return+U}).sort(function(U,H){return U-H}),N=!0;for(x=0,D=F.length;x<D;x++)if(F[x]!==x){N=!1;break}if(N){var j=[];for(x=0,D=F.length;x<D;x++)j[x]=A[x];return j}}return A}}(C.nodes));default:Sn()}default:Sn()}}function g(C){for(var _=!1,x=0,D=C.length;x<D;x++)if("comment"===C[x].kind){_=!0;break}return _?C.filter(function(w){return"comment"!==w.kind}):C}e.parse=function S(C){for(var _=function p(C){return f.tryParse(C)}(C),x=[],D=0,w=_;D<w.length;D++){var A=w[D];"comment"!==A.kind&&(x[x.length]=m(A))}return x}}(dB||(dB={}));var Vn=fe;function ss(e,t,r){var n=We.lazy(function(){return We.seq(e,n).map(function(a){return r.apply(void 0,a)}).or(t)});return n}function rT(e,t,r){return We.seqMap(t,e.many(),function(n,a){return a.reduce(function(i,o){return r(o,i)},n)})}function Us(e,t,r){return We.seqMap(t,We.seq(e,t).many(),function(n,a){return a.reduce(function(i,o){return r(o[0],i,o[1])},n)})}function f2(e,t){return e.reduce(function(n,a){var i=a.isUnsupported?Sm("operator '".concat(a.name,"' not supported")):a.map;return a.type(a.rule,n,i)},t)}function ap(e,t){return void 0===t&&(t=0),We.optWhitespace.then(We.regexp(e,t).skip(We.optWhitespace))}function Ku(e,t){return void 0===t&&(t=0),We.regexp(e,t).skip(We.optWhitespace)}function nT(e,t){return void 0===t&&(t=0),We.optWhitespace.then(We.regexp(e,t))}function fB(e,t){var r=t?"".concat(e,"|").concat(aS(t)):e;return ap(RegExp("(".concat(r,")\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF"),"i"),2).map(parseFloat)}function Sm(e){return function(){throw new Error(e)}}function pB(e){return 1===e.length?e[0]:e.length>1?Vn.core.logic.and(e):void 0}function mB(e,t){if(!t||void 0===t.op||void 0===t.val)return t&&void 0!==t.flags?Vn.core.flags.hasAny([e,t.flags]):t&&void 0!==t.min&&void 0!==t.max?Vn.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?Vn.core.set.has([Vn.core.type.set(t),e]):Vn.core.rel.eq([e,t[0]]):Vn.core.rel.eq([e,t]);var r=[e,t.val];switch(t.op){case"=":return Vn.core.rel.eq(r);case"!=":return Vn.core.rel.neq(r);case">":return Vn.core.rel.gr(r);case"<":return Vn.core.rel.lt(r);case">=":return Vn.core.rel.gre(r);case"<=":return Vn.core.rel.lte(r);default:throw new Error("operator '".concat(t.op,"' not supported"))}}function Zu(e){return Vn.struct.generator.queryInSelection({0:e,query:Vn.struct.generator.all(),"in-complement":!0})}function Id(e,t){return e.length<t.length?1:-1}function hB(e,t){var r=(t?[e].concat(t):[e]).sort(Id).map(aS).join("|");return RegExp("".concat(r),"i")}function a$(e){var t=[];return Object.keys(e).sort(Id).forEach(function(r){var n=e[r],a=Sm("property '".concat(r,"' not supported")),i=We.regexp(n.regex).map(function(u){return n.isUnsupported&&a(),mB(n.property,n.map(u))}),o=We.regexp(hB(r,n.abbr)).trim(We.optWhitespace),s=function(u){var c;return Vn.struct.generator.atomGroups(((c={})[n.level]=u,c))};t.push(n.isNumeric?o.then(We.seq(We.regexp(/>=|<=|=|!=|>|</).trim(We.optWhitespace),We.regexp(n.regex).map(n.map))).map(function(u){return n.isUnsupported&&a(),mB(n.property,{op:u[0],val:u[1]})}).map(s):o.then(i).map(s))}),t}function vB(e){var t=[];return Object.keys(e).sort(Id).forEach(function(r){var n=e[r],a=n.map?n.map:Sm("keyword '".concat(r,"' not supported")),i=We.regexp(hB(r,n.abbr)).map(a);t.push(i)}),t}function gB(e,t){var r=[];return Object.keys(e).sort(Id).forEach(function(n){var a=e[n],i=Sm("property '".concat(n,"' not supported")),o=We.regexp(hB(n,a.abbr)).lookahead(t).map(function(){return a.isUnsupported&&i(),a.property});r.push(o)}),r}function yB(e,t,r,n){var a=[];for(var i in e)a.push(i),e[i].abbr&&a.push.apply(a,e[i].abbr);for(var o in t)a.push(o),t[o].abbr&&a.push.apply(a,t[o].abbr);return r.forEach(function(s){a.push(s.name),s.abbr&&a.push.apply(a,s.abbr)}),a}function Pd(e){return Vn.core.type.set(e.map(Vn.atomName))}function Md(e){return Vn.struct.generator.queryInSelection({0:e,query:Vn.struct.generator.all()})}function p2(e,t,r){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return Vn.atomName(t);case"structure-query.atom-property.core.element-symbol":return Vn.es(t);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return r&&(t=[r[t.toUpperCase()]||"none"]),Vn.struct.type.secondaryStructureFlags([t]);default:return t}}var g8e=["entityKey","label_entity_id","entityType"],y8e=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],b8e=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"],C8e=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function Qr(e){return Vn.struct.generator.atomGroups({"residue-test":Vn.core.set.has([Vn.core.type.set(e),Vn.ammp("label_comp_id")])})}var oi=fe,kc=/[-+]?[0-9]*\.?[0-9]+/,m2=/[0-9]+/;function Jt(e){return e}var _8e={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function o$(e){if(e.head){if(e.head.name&&"core.type.regex"===e.head.name&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=_8e[e.toString().toLowerCase()]||"none",-1!==["dna","rna","carbohydrate"].indexOf(e))throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return oi.struct.type.secondaryStructureFlags([e])}}var s$={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:Jt,level:"atom-test",property:oi.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:Jt,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:m2,map:function(e){return parseInt(e)},level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:m2,map:function(e){return parseInt(e)},level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:function(e){return oi.atomName(e)},level:"atom-test",property:oi.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:m2,map:function(e){return parseInt(e)},level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:function(e){return oi.atomName(e)},level:"atom-test",property:oi.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:m2,map:function(e){return parseInt(e)},level:"atom-test",property:oi.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:m2,map:function(e){return parseInt(e)},level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:Jt,level:"chain-test",property:oi.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:function(e){return oi.es(e)},level:"atom-test",property:oi.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:function(e){return parseInt(e)},level:"atom-test",property:oi.acp("atomicNumber")},eta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},theta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:Jt,level:"residue-test",property:oi.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:Jt,level:"residue-test",property:oi.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:Jt,level:"atom-test",property:oi.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:kc,map:function(e){return parseFloat(e)},level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:function(e){return parseInt(e)},level:"residue-test",property:oi.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:Jt,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:Jt,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:kc,map:function(e){return parseFloat(e)},level:"atom-test",property:oi.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Jt,level:"atom-test"}},u$=fe,c$=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:ss,rule:We.alt(We.regex(/NOT/i).skip(We.whitespace),We.string("!").skip(We.optWhitespace)),map:function(e,t){return Zu(t)}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:Us,rule:ap(/AND|&/i),map:function(e,t,r){return u$.struct.modifier.intersectBy({0:t,by:r})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:Us,rule:ap(/OR|\||,/i),map:function(e,t,r){return u$.struct.combinator.merge([t,r])}}],Me=fe,fa={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},l$_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],l$_protein=["C","N","CA"];function h2(){return Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,fa.nucleic),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.and([Me.core.rel.eq([Me.struct.atomSet.atomCount(),1]),Me.core.rel.eq([Me.ammp("label_atom_id"),Me.atomName("P")])])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.or([Me.core.set.isSubset([Pd(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),Me.ammpSet("label_atom_id")]),Me.core.set.isSubset([Pd(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),Me.ammpSet("label_atom_id")])])})])}var d$={all:{"@desc":"all atoms; same as *",abbr:["*"],map:function(){return Me.struct.generator.all()}},bonded:{"@desc":"covalently bonded",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.gr([Me.struct.atomProperty.core.bondCount({flags:Me.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})}},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.gr([Me.struct.atomProperty.core.bondCount({flags:Me.struct.type.bondFlags()}),0])})}},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:function(){return Me.struct.generator.empty()}},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(Me.es)),Me.acp("elementSymbol")])})}},metal:{"@desc":"!nonmetal",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.logic.not([Me.core.set.has([Me.set.apply(Me,["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(Me.es)),Me.acp("elementSymbol")])])})}},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["Li","Na","K","Rb","Cs","Fr"].map(Me.es)),Me.acp("elementSymbol")])})}},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["Be","Mg","Ca","Sr","Ba","Ra"].map(Me.es)),Me.acp("elementSymbol")])})}},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["He","Ne","Ar","Kr","Xe","Rn"].map(Me.es)),Me.acp("elementSymbol")])})}},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.set.apply(Me,["B","Si","Ge","As","Sb","Te"].map(Me.es)),Me.acp("elementSymbol")])})}},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.logic.or([Me.core.rel.inRange([Me.acp("atomicNumber"),21,30]),Me.core.rel.inRange([Me.acp("atomicNumber"),39,48]),Me.core.rel.inRange([Me.acp("atomicNumber"),72,80]),Me.core.rel.inRange([Me.acp("atomicNumber"),104,112]),Me.core.set.has([Me.set(57,89),Me.acp("atomicNumber")])])})}},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.inRange([Me.acp("atomicNumber"),57,71])})}},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.inRange([Me.acp("atomicNumber"),89,103])})}},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.gr([Me.struct.atomProperty.core.bondCount({flags:Me.struct.type.bondFlags(["aromatic"])}),0])})}},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":'any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, \', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.',map:function(){return h2()}},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:function(){return Me.struct.modifier.intersectBy({0:h2(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["A","G","I","DA","DG","DI","+A","+G","+I"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.set.isSubset([Pd(["N7","C8","N9"]),Me.ammpSet("label_atom_id")])})])})}},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:function(){return Me.struct.modifier.intersectBy({0:h2(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["C","T","U","DC","DT","DU","+C","+T","+U"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.or([Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2*")]),Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2'")])])})])})}},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:function(){return Me.struct.modifier.intersectBy({0:h2(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.not([Me.core.logic.or([Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2*")]),Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2'")])])])})])})}},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:function(){return Me.struct.modifier.intersectBy({0:h2(),by:Me.struct.combinator.merge([Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,["G","C","A","U","I","+U","+I"]),Me.ammp("label_comp_id")])}),Me.struct.filter.pick({0:Me.struct.generator.atomGroups({"group-by":Me.ammp("residueKey")}),test:Me.core.logic.or([Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2*")]),Me.core.set.has([Me.ammpSet("label_atom_id"),Me.atomName("O2'")])])})])})}},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:function(){return function w8e(){return Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.set.apply(Me,fa.amino),Me.ammp("label_comp_id")])})}()}},acidic:{"@desc":"ASP GLU",map:function(){return Qr(fa.acidic)}},acyclic:{"@desc":"amino and not cyclic",map:function(){return Me.struct.modifier.intersectBy({0:Qr(fa.amino),by:Zu(Qr(fa.cyclic))})}},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:function(){return Qr(fa.aliphatic)}},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:function(){return Qr(fa.amino)}},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:function(){return Qr(fa.aromatic)}},basic:{"@desc":"ARG HIS LYS",map:function(){return Qr(fa.basic)}},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:function(){return Qr(fa.buried)}},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:function(){return Qr(fa.acidic.concat(fa.basic))}},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:function(){return Qr(fa.cyclic)}},helix:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["helix"]),Me.ammp("secondaryStructureFlags")])})}},helixalpha:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["alpha"]),Me.ammp("secondaryStructureFlags")])})}},helix310:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["3-10"]),Me.ammp("secondaryStructureFlags")])})}},helixpi:{"@desc":"secondary structure-related.",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["pi"]),Me.ammp("secondaryStructureFlags")])})}},hetero:{"@desc":"PDB atoms designated as HETATM",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.ammp("isHet")})}},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:function(){return Qr(fa.hydrophobic)}},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:function(){return Qr(fa.large)}},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:function(){return Qr(fa.medium)}},negative:{"@desc":"same as acidic -- ASP GLU",map:function(){return Qr(fa.acidic)}},neutral:{"@desc":"amino and not (acidic or basic)",map:function(){return Me.struct.modifier.intersectBy({0:Qr(fa.amino),by:Zu(Qr(fa.acidic.concat(fa.basic)))})}},polar:{"@desc":"amino and not hydrophobic",map:function(){return Me.struct.modifier.intersectBy({0:Qr(fa.amino),by:Zu(Qr(fa.hydrophobic))})}},positive:{"@desc":"same as basic -- ARG HIS LYS",map:function(){return Qr(fa.basic)}},sheet:{"@desc":"secondary structure-related",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["sheet"]),Me.ammp("secondaryStructureFlags")])})}},small:{"@desc":"ALA GLY SER",map:function(){return Qr(fa.small)}},surface:{"@desc":"amino and not buried",map:function(){return Me.struct.modifier.intersectBy({0:Qr(fa.amino),by:Zu(Qr(fa.buried))})}},turn:{"@desc":"secondary structure-related",map:function(){return Me.struct.generator.atomGroups({"residue-test":Me.core.flags.hasAny([Me.struct.type.secondaryStructureFlags(["turn"]),Me.ammp("secondaryStructureFlags")])})}},alpha:{"@desc":"(*.CA)",map:function(){return Me.struct.generator.atomGroups({"atom-test":Me.core.rel.eq([Me.atomName("CA"),Me.ammp("label_atom_id")])})}},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:function(){return function A8e(){return Me.struct.combinator.merge([Me.struct.modifier.intersectBy({0:Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.core.type.set(fa.amino),Me.ammp("label_comp_id")])}),by:Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.core.type.set(l$_protein),Me.ammp("label_atom_id")])})}),Me.struct.modifier.intersectBy({0:Me.struct.generator.atomGroups({"residue-test":Me.core.set.has([Me.core.type.set(fa.nucleic),Me.ammp("label_comp_id")])}),by:Me.struct.generator.atomGroups({"atom-test":Me.core.set.has([Me.core.type.set(l$_nucleic),Me.ammp("label_atom_id")])})})])}()}},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}},_r=fe,T8e=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:Us,rule:We.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:function(e,t,r){var n;if("structure"===t?n=_r.core.flags.hasAny([_r.ammp("secondaryStructureFlags"),o$(r)]):"structure"===r?n=_r.core.flags.hasAny([_r.ammp("secondaryStructureFlags"),o$(t)]):void 0!==t.head?"core.type.regex"===t.head.name&&(n=_r.core.str.match([t,_r.core.type.str([r])])):void 0!==r.head?"core.type.regex"===r.head.name&&(n=_r.core.str.match([r,_r.core.type.str([t])])):"LIKE"===e.toUpperCase()&&(n=_r.core.str.match(t.head?[_r.core.type.regex(["^".concat(r,"$"),"i"]),_r.core.type.str([t])]:[_r.core.type.regex(["^".concat(t,"$"),"i"]),_r.core.type.str([r])])),!n)switch(t.head&&(r=p2(t,r)),r.head&&(t=p2(r,t)),e){case"=":n=_r.core.rel.eq([t,r]);break;case"!=":n=_r.core.rel.neq([t,r]);break;case">":n=_r.core.rel.gr([t,r]);break;case"<":n=_r.core.rel.lt([t,r]);break;case">=":n=_r.core.rel.gre([t,r]);break;case"<=":n=_r.core.rel.lte([t,r]);break;default:throw new Error("value operator '".concat(e,"' not supported"))}return _r.struct.generator.atomGroups({"atom-test":n})}}];function D8e(e){var t=e[1],r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c={};o&&(c["chain-test"]=_r.core.rel.eq([_r.ammp("auth_asym_id"),o]));var l=[];r&&l.push(_r.core.rel.eq([_r.ammp("label_comp_id"),r])),n&&l.push(_r.core.logic.and([_r.core.rel.gre([_r.ammp("auth_seq_id"),n[0]]),_r.core.rel.lte([_r.ammp("auth_seq_id"),n[1]])])),a&&l.push(_r.core.rel.eq([_r.ammp("auth_seq_id"),a])),i&&l.push(_r.core.rel.eq([_r.ammp("pdbx_PDB_ins_code"),i])),l.length&&(c["residue-test"]=pB(l));var d=[];return s&&d.push(_r.core.rel.eq([_r.ammp("auth_atom_id"),s])),u&&d.push(_r.core.rel.eq([_r.ammp("label_alt_id"),u])),d.length&&(c["atom-test"]=pB(d)),_r.struct.generator.atomGroups(c)}var E8e=We.createLanguage({Integer:function(){return We.regexp(/-?[0-9]+/).map(Number).desc("integer")},Parens:function(e){return We.alt(e.Parens,e.Operator,e.Expression).wrap(We.regexp(/\(\s*/),We.regexp(/\s*\)/))},Expression:function(e){return We.alt(e.Keywords,e.AtomExpression.map(D8e),e.Within.map(function(t){return _r.struct.modifier.includeSurroundings({0:t[1],radius:t[0]})}),e.ValueQuery,e.Element.map(function(t){return _r.struct.generator.atomGroups({"atom-test":_r.core.rel.eq([_r.acp("elementSymbol"),_r.struct.type.elementSymbol(t)])})}),e.Resname.map(function(t){return _r.struct.generator.atomGroups({"residue-test":_r.core.rel.eq([_r.ammp("label_comp_id"),t])})}))},Operator:function(e){return f2(c$,We.alt(e.Parens,e.Expression))},AtomExpression:function(e){return We.seq(We.lookahead(e.AtomPrefix),We.seq(e.BracketedResname.or(We.of(null)),e.ResnoRange.or(We.of(null)),e.Resno.or(We.of(null)),e.Inscode.or(We.of(null)),e.Chainname.or(We.of(null)),e.Atomname.or(We.of(null)),e.Altloc.or(We.of(null)),e.Model.or(We.of(null)))).desc("expression")},AtomPrefix:function(){return We.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix")},Chainname:function(){return We.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname")},Model:function(){return We.regexp(/\/([0-9]+)/,1).map(Number).desc("model")},Element:function(){return We.regexp(/_([A-Za-z]{1,3})/,1).desc("element")},Atomname:function(){return We.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(_r.atomName).desc("atomname")},Resname:function(){return We.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname")},Resno:function(e){return e.Integer.desc("resno")},Altloc:function(){return We.regexp(/%([a-zA-Z0-9])/,1).desc("altloc")},Inscode:function(){return We.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode")},BracketedResname:function(){return We.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname")},ResnoRange:function(e){return We.seq(e.Integer.skip(We.seq(We.optWhitespace,We.string("-"),We.optWhitespace)),e.Integer).desc("resno-range")},Within:function(e){return We.regexp(/within/i).skip(We.regexp(/\s*\(\s*/)).then(We.seq(e.Integer.skip(We.regexp(/\s*,\s*/)),e.Query)).skip(We.regexp(/\)/))},Keywords:function(){var e;return(e=We).alt.apply(e,vB(d$)).desc("keyword")},Query:function(e){return We.alt(e.Operator,e.Parens,e.Expression).trim(We.optWhitespace)},Number:function(){return We.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){var e=yB(s$,d$,c$).sort(Id).map(aS).join("|");return We.alt(We.regexp(new RegExp("(?!(".concat(e,"))[A-Z0-9_]+"),"i")),We.regexp(/'((?:[^"\\]|\\.)*)'/,1),We.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(function(t){return _r.core.type.regex(["^".concat(t,"$"),"i"])})).desc("string")},Value:function(e){return We.alt(e.Number,e.String)},ValueParens:function(e){return We.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(We.string("("),We.string(")"))},ValuePropertyNames:function(){var e;return(e=We).alt.apply(e,gB(s$,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return f2(T8e,We.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return We.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return We.alt(e.ValueOperator.map(function(t){if(t.head){if(t.head.name.startsWith("structure-query.generator"))return t}else if("string"==typeof t&&t.length<=4)return _r.struct.generator.atomGroups({"residue-test":_r.core.rel.eq([_r.ammp("label_comp_id"),t])});throw new Error("values must be part of an comparison, value '".concat(t,"'"))}))}}),Eo=fe,aT=/[-+]?[0-9]*\.?[0-9]+/;function uy(e){return e.split("+").map(function(t){return t.replace(/^["']|["']$/g,"")})}function bB(e){if(e.includes("-")&&e.includes("+")){var t=e.split("+").map(function(u){return u.replace(/^["']|["']$/g,"")}),r=[];return t.forEach(function(u){if(u.includes("-")&&!u.startsWith("-"))for(var c=u.split("-").map(function(p){return parseInt(p)}),d=c[1],f=l=c[0];f<=d;f++)r.push(f);else if(u.includes("-")&&u.startsWith("-")&&u.match(/[0-9]+-[-0-9]+/)){var l=-parseInt(u.split("-")[1]);for(d=void 0,d=u.includes("--")?-parseInt(u.split("-")[3]):parseInt(u.split("-")[2]),f=l;f<=d;f++)r.push(f)}else u.includes("-")&&u.startsWith("-")&&u.match(/[0-9]+-[-0-9]+/),r.push(parseInt(u))}),r}if(e.includes("-")&&!e.includes("+")){var n=[];if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){var i=-parseInt(e.split("-")[1]),o=void 0;o=e.includes("--")?-parseInt(e.split("-")[3]):parseInt(e.split("-")[2]);for(var s=i;s<=o;s++)n.push(s)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),n.push(parseInt(e));else{var a=e.split("-").map(function(u){return parseInt(u)});for(o=a[1],s=i=a[0];s<=o;s++)n.push(s)}return n}return!e.includes("-")&&e.includes("+")?uy(e).map(function(u){return parseInt(u)}):[parseInt(e)]}var R8e={H:"helix",S:"beta",L:"none"},iT={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:function M8e(e){return e.split("+").map(Eo.struct.type.elementSymbol)},level:"atom-test",property:Eo.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:function P8e(e){return e.split("+").map(Eo.atomName)},level:"atom-test",property:Eo.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:uy,level:"residue-test",property:Eo.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:bB,level:"residue-test",property:Eo.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:uy,level:"atom-test",property:Eo.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:uy,level:"chain-test",property:Eo.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:uy,level:"chain-test",property:Eo.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:function(e){return parseInt(e)},level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:function(e){return parseInt(e)},level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:uy,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:bB,level:"atom-test",property:Eo.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:bB,level:"atom-test",property:Eo.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:function O8e(e){return{flags:Eo.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(function(t){return R8e[t]||"none"}))}},level:"residue-test",property:Eo.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:aT,map:function(e){return parseFloat(e)},level:"atom-test",property:Eo.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:aT,map:function(e){return parseFloat(e)},level:"atom-test",property:Eo.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:aT,map:function(e){return parseFloat(e)},level:"atom-test",property:Eo.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:aT,map:function(e){return parseFloat(e)},level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:function(e){return Eo.es(e)},level:"atom-test",property:Eo.acp("elementSymbol")}},cr=fe,f$=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:ss,rule:We.alt(We.regexp(/NOT/i).skip(We.whitespace),We.string("!").skip(We.optWhitespace)),map:function(e,t){return Zu(t)}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:Us,rule:ap(/AND|&/i),map:function(e,t,r){return cr.struct.modifier.intersectBy({0:t,by:r})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:Us,rule:ap(/OR|\|/i),map:function(e,t,r){return cr.struct.combinator.merge([t,r])}},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:Us,rule:ap(/IN/i),map:function(e,t,r){return cr.struct.filter.withSameAtomProperties({0:t,source:r,property:cr.core.type.compositeKey([cr.ammp("label_atom_id"),cr.ammp("label_seq_id"),cr.ammp("label_comp_id"),cr.ammp("auth_asym_id"),cr.ammp("label_asym_id")])})}},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:Us,rule:ap(/LIKE|l\./i),map:function(e,t,r){return cr.struct.filter.withSameAtomProperties({0:t,source:r,property:cr.core.type.compositeKey([cr.ammp("label_atom_id"),cr.ammp("label_seq_id")])})}},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:rT,rule:nT(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(function(e){return parseFloat(e)}),map:function(e,t){return cr.struct.filter.within({0:cr.struct.generator.all(),target:t,"atom-radius":cr.acp("vdw"),"max-radius":e,invert:!0})}},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:rT,rule:nT(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(function(e){return parseFloat(e)}),map:function(e,t){return cr.struct.modifier.exceptBy({0:cr.struct.filter.within({0:cr.struct.generator.all(),target:t,"max-radius":e}),by:t})}},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:rT,rule:nT(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(function(e){return parseFloat(e)}),map:function(e,t){return cr.struct.modifier.includeSurroundings({0:t,radius:e})}},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:Us,rule:fB("WITHIN","w."),map:function(e,t,r){return cr.struct.filter.within({0:t,target:r,"max-radius":e})}},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:Us,rule:fB("NEAR_TO","nto."),map:function(e,t,r){return cr.struct.modifier.exceptBy({0:cr.struct.filter.within({0:t,target:r,"max-radius":e}),by:r})}},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:Us,rule:fB("BEYOND","be."),map:function(e,t,r){return cr.struct.modifier.exceptBy({0:cr.struct.filter.within({0:t,target:r,"max-radius":e,invert:!0}),by:r})}},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:ss,rule:Ku(/BYRESIDUE|byresi|byres|br\./i),map:function(e,t){return Md(cr.struct.modifier.expandProperty({0:cr.struct.modifier.union({0:t}),property:cr.ammp("residueKey")}))}},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:ss,rule:Ku(/BYCALPHA|bca\./i),map:function(e,t){return cr.struct.generator.queryInSelection({0:cr.struct.modifier.expandProperty({0:cr.struct.modifier.union({0:t}),property:cr.ammp("residueKey")}),query:cr.struct.generator.atomGroups({"atom-test":cr.core.rel.eq([cr.atomName("CA"),cr.ammp("label_atom_id")])})})}},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:ss,rule:Ku(/BYMOLECULE|bymol|bm\./i),map:function(e,t){return Md(cr.struct.modifier.expandProperty({0:cr.struct.modifier.union({0:t}),property:cr.atp("connectedComponentKey")}))}},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:ss,rule:Ku(/BYFRAGMENT|byfrag|bf\./i),map:function(e,t){return[e,t]}},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:ss,rule:Ku(/BYSEGMENT|bysegi|byseg|bs\./i),map:function(e,t){return Md(cr.struct.modifier.expandProperty({0:cr.struct.modifier.union({0:t}),property:cr.ammp("chainKey")}))}},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:ss,rule:Ku(/BYOBJECT|byobj|bo\./i),map:function(e,t){return[e,t]}},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:ss,rule:Ku(/BYCELL/i),map:function(e,t){return[e,t]}},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:ss,rule:Ku(/BYRING/i),map:function(e,t){return Md(cr.struct.modifier.intersectBy({0:cr.struct.filter.pick({0:cr.struct.generator.rings(),test:cr.core.logic.and([cr.core.rel.lte([cr.struct.atomSet.atomCount(),7]),cr.core.rel.gr([cr.struct.atomSet.countQuery([t]),1])])}),by:t}))}},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:ss,abbr:["nbr."],rule:Ku(/NEIGHBOR|nbr\./i),map:function(e,t){return cr.struct.modifier.exceptBy({0:Md(cr.struct.modifier.includeConnected({0:cr.struct.modifier.union({0:t}),"bond-test":!0})),by:t})}},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:ss,rule:Ku(/BOUND_TO|bto\./i),map:function(e,t){return Md(cr.struct.modifier.includeConnected({0:cr.struct.modifier.union({0:t})}))}},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:rT,rule:nT(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(function(e){return parseInt(e)}),map:function(e,t){return Md(cr.struct.modifier.includeConnected({0:cr.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}}],Pt=fe,us={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},p$_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],p$_protein=["C","N","CA","O"];function m$(){return Pt.struct.combinator.merge([Pt.struct.modifier.intersectBy({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.protein),Pt.ammp("label_comp_id")])}),by:Pt.struct.generator.atomGroups({"atom-test":Pt.core.set.has([Pt.core.type.set(p$_protein),Pt.ammp("label_atom_id")])})}),Pt.struct.modifier.intersectBy({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.nucleic),Pt.ammp("label_comp_id")])}),by:Pt.struct.generator.atomGroups({"atom-test":Pt.core.set.has([Pt.core.type.set(p$_nucleic),Pt.ammp("label_atom_id")])})})])}var h$={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:function(){return Pt.struct.generator.all()}},none:{"@desc":"No atoms (empty selection)",map:function(){return Pt.struct.generator.empty()}},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:function(){return Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.acp("elementSymbol"),Pt.es("H")])})}},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:function(){return Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.ammp("isHet"),!0])})}},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.nucleic.concat(us.protein)),Pt.ammp("label_comp_id")])})}},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:function(){return Pt.struct.modifier.exceptBy({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.nucleic.concat(us.protein)),Pt.ammp("label_comp_id")])}),by:m$()})}},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:function(){return Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.gr([Pt.struct.atomProperty.core.bondCount({flags:Pt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})}},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:function(){return Md(Pt.struct.modifier.expandProperty({0:Pt.struct.modifier.union([Pt.struct.generator.queryInSelection({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.logic.not([Pt.core.set.has([Pt.core.type.set(us.nucleic.concat(us.protein)),Pt.ammp("label_comp_id")])])}),query:Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.es("C"),Pt.acp("elementSymbol")])})})]),property:Pt.ammp("residueKey")}))}},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:function(){return Md(Pt.struct.modifier.expandProperty({0:Pt.struct.modifier.union([Pt.struct.filter.pick({0:Pt.struct.generator.atomGroups({"residue-test":Pt.core.logic.not([Pt.core.set.has([Pt.core.type.set(us.nucleic.concat(us.protein).concat(us.solvent)),Pt.ammp("label_comp_id")])]),"group-by":Pt.ammp("residueKey")}),test:Pt.core.logic.not([Pt.core.set.has([Pt.struct.atomSet.propertySet([Pt.acp("elementSymbol")]),Pt.es("C")])])})]),property:Pt.ammp("residueKey")}))}},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.solvent),Pt.ammp("label_comp_id")])})}},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:function(){return Pt.struct.combinator.merge([Pt.struct.generator.atomGroups({"atom-test":Pt.core.rel.eq([Pt.atomName("CA"),Pt.ammp("label_atom_id")]),"residue-test":Pt.core.set.has([Pt.core.type.set(us.protein),Pt.ammp("label_comp_id")])}),Pt.struct.generator.atomGroups({"atom-test":Pt.core.set.has([Pd(["C4*","C4'"]),Pt.ammp("label_atom_id")]),"residue-test":Pt.core.set.has([Pt.core.type.set(us.nucleic),Pt.ammp("label_comp_id")])})])}},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:function(){return m$()}},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.protein),Pt.ammp("label_comp_id")])})}},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:function(){return Pt.struct.generator.atomGroups({"residue-test":Pt.core.set.has([Pt.core.type.set(us.nucleic),Pt.ammp("label_comp_id")])})}}},F8e=fe,si=function h8e(e){var t={};return Object.keys(e).sort(Id).forEach(function(r){var n=e[r],a=Sm("property '".concat(r,"' not supported")),i=We.regexp(n.regex).map(function(o){return n.isUnsupported&&a(),mB(n.property,n.map(o))});n.isNumeric||(t[r]=i)}),t}(iT),Si=We.string("/");function ua(e){return e.or(We.of(null))}function B8e(e){var t={},r={};for(var n in e){var a=iT[n];if(!a)throw new Error("property '".concat(n,"' not supported, value '").concat(e[n],"'"));null!==e[n]&&(r[a.level]||(r[a.level]=[]),r[a.level].push(e[n]))}for(var i in r)t[i]=pB(r[i]);return F8e.struct.generator.atomGroups(t)}var N8e=We.createLanguage({Parens:function(e){return We.alt(e.Parens,e.Operator,e.Expression).wrap(We.string("("),We.string(")"))},Expression:function(e){return We.alt(e.Keywords,e.AtomSelectionMacro.map(B8e),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return We.alt(Si.then(We.alt(We.seq(ua(e.ObjectProperty).skip(Si),ua(si.segi).skip(Si),ua(si.chain).skip(Si),ua(si.resi).skip(Si),ua(si.name)).map(function(t){return{object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]}}),We.seq(ua(e.ObjectProperty).skip(Si),ua(si.segi).skip(Si),ua(si.chain).skip(Si),ua(si.resi)).map(function(t){return{object:t[0],segi:t[1],chain:t[2],resi:t[3]}}),We.seq(ua(e.ObjectProperty).skip(Si),ua(si.segi).skip(Si),ua(si.chain)).map(function(t){return{object:t[0],segi:t[1],chain:t[2]}}),We.seq(ua(e.ObjectProperty).skip(Si),ua(si.segi)).map(function(t){return{object:t[0],segi:t[1]}}),We.seq(ua(e.ObjectProperty)).map(function(t){return{object:t[0]}}))),We.alt(We.seq(ua(e.ObjectProperty).skip(Si),ua(si.segi).skip(Si),ua(si.chain).skip(Si),ua(si.resi).skip(Si),ua(si.name)).map(function(t){return{object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]}}),We.seq(ua(si.segi).skip(Si),ua(si.chain).skip(Si),ua(si.resi).skip(Si),ua(si.name)).map(function(t){return{segi:t[0],chain:t[1],resi:t[2],name:t[3]}}),We.seq(ua(si.chain).skip(Si),ua(si.resi).skip(Si),ua(si.name)).map(function(t){return{chain:t[0],resi:t[1],name:t[2]}}),We.seq(ua(si.resi).skip(Si),ua(si.name)).map(function(t){return{resi:t[0],name:t[1]}})))},NamedAtomProperties:function(){var e;return(e=We).alt.apply(e,a$(iT))},Keywords:function(){var e;return(e=We).alt.apply(e,vB(h$))},ObjectProperty:function(){var e=yB(iT,h$,f$).sort(Id).map(aS).join("|");return We.regexp(new RegExp("(?!(".concat(e,"))[A-Z0-9_]+"),"i"))},Object:function(e){return e.ObjectProperty.notFollowedBy(Si).map(function(t){throw new Error("property 'object' not supported, value '".concat(t,"'"))})},Pepseq:function(){return We.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(Sm("operator 'pepseq' not supported"))},Rep:function(){return We.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(Sm("operator 'rep' not supported"))},Operator:function(e){return f2(f$,We.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return We.alt(e.Operator,e.Parens,e.Expression).trim(We.optWhitespace)}}),ei=fe,pu=/[-+]?[0-9]*\.?[0-9]+/,oT=/[+]?[0-9]+/,v2=/[-+]?[0-9]+/;function sv(e){return e}var v$={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function SB(e){return ei.struct.type.secondaryStructureFlags([v$[e.toUpperCase()]||"none"])}var uv={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:ei.atomName,level:"atom-test",property:ei.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:sv,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:oT,map:function(e){return parseInt(e)-1},level:"atom-test",property:ei.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:oT,map:function(e){return parseInt(e)},level:"atom-test",property:ei.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:oT,map:function(e){return parseInt(e)},level:"atom-test",property:ei.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:function(e){return ei.es(e)},level:"atom-test",property:ei.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:sv,level:"atom-test",property:ei.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:sv,level:"residue-test",property:ei.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:v2,map:function(e){return parseInt(e)},level:"residue-test",property:ei.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:v2,map:function(e){return parseInt(e)},level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:v2,map:function(e){return parseInt(e)},level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:v2,map:function(e){return parseInt(e)},level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:sv,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:oT,map:function(e){return parseInt(e)},level:"atom-test",property:ei.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:sv,level:"residue-test",property:ei.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:v2,map:function(e){return parseInt(e)},level:"residue-test",property:ei.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:sv,level:"residue-test",property:ei.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test",property:ei.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:sv,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:SB,level:"atom-test",property:ei.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:pu,map:function(e){return parseFloat(e)},level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:pu,map:function(e){return parseInt(e)},level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:pu,map:function(e){return parseInt(e)},level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:pu,map:function(e){return parseInt(e)},level:"atom-test"}},cv=fe,L8e=Object.keys(uv).sort(Id).filter(function(e){return!uv[e].isUnsupported}).join("|"),g$=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:ss,rule:We.regexp(/NOT/i).skip(We.whitespace),map:function(e,t){return Zu(t)}},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:ss,rule:Ku(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(function(e){return parseFloat(e)}),map:function(e,t){return cv.struct.modifier.includeSurroundings({0:t,radius:e})}},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:ss,rule:Ku(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(function(e){return parseFloat(e)}),map:function(e,t){return cv.struct.modifier.exceptBy({0:cv.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})}},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:ss,rule:Ku(new RegExp("SAME\\s+(".concat(L8e,")\\s+AS"),"i"),1).map(function(e){return uv[e].property}),map:function(e,t){return cv.struct.filter.withSameAtomProperties({0:cv.struct.generator.all(),source:t,property:e})}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:Us,rule:We.alt(ap(/AND/i),We.whitespace),map:function(e,t,r){return cv.struct.modifier.intersectBy({0:t,by:r})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:Us,rule:ap(/OR/i),map:function(e,t,r){return cv.struct.combinator.merge([t,r])}}],Tr=fe;function ip(){return Tr.struct.filter.pick({0:Tr.struct.generator.atomGroups({"group-by":Tr.ammp("residueKey")}),test:Tr.core.set.isSubset([Pd(["C","N","CA","O"]),Tr.ammpSet("label_atom_id")])})}function CB(){return Tr.struct.filter.pick({0:Tr.struct.generator.atomGroups({"group-by":Tr.ammp("residueKey")}),test:Tr.core.logic.and([Tr.core.set.isSubset([Pd(["P"]),Tr.ammpSet("label_atom_id")]),Tr.core.logic.or([Tr.core.set.isSubset([Pd(["O3'","C3'","C4'","C5'","O5'"]),Tr.ammpSet("label_atom_id")]),Tr.core.set.isSubset([Pd(["O3*","C3*","C4*","C5*","O5*"]),Tr.ammpSet("label_atom_id")])])])})}function y$(){return Tr.struct.combinator.merge([Tr.struct.generator.queryInSelection({0:ip(),query:Tr.struct.generator.atomGroups({"atom-test":Tr.core.set.has([Pd(b$.protein),Tr.ammp("label_atom_id")])})}),Tr.struct.generator.queryInSelection({0:CB(),query:Tr.struct.generator.atomGroups({"atom-test":Tr.core.set.has([Pd(b$.nucleic),Tr.ammp("label_atom_id")])})})])}function Rd(e){return Tr.struct.generator.atomGroups({"residue-test":Tr.core.flags.hasAll([Tr.ammp("secondaryStructureFlags"),Tr.struct.type.secondaryStructureFlags(e)])})}var C$,lv,g2,cy,b$={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},Ci={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},S$={all:{"@desc":"everything",map:function(){return Tr.struct.generator.all()}},none:{"@desc":"nothing",map:function(){return Tr.struct.generator.empty()}},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:function(){return ip()}},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:function(){return CB()}},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:function(){return y$()}},sidechain:{"@desc":"non-backbone atoms and bonds",map:function(){return Zu(y$())}},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:function(){return Qr(Ci.water)}},at:{"@desc":"residues named ADA A THY T",map:function(){return Qr(Ci.at)}},acidic:{"@desc":"residues named ASP GLU",map:function(){return Qr(Ci.acidic)}},acyclic:{"@desc":'"protein and not cyclic"',map:function(){return Tr.struct.modifier.intersectBy({0:ip(),by:Zu(Qr(Ci.cyclic))})}},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:function(){return Qr(Ci.aliphatic)}},alpha:{"@desc":"atom's residue is an alpha helix",map:function(){return Rd(["alpha"])}},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:function(){return ip()}},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:function(){return Qr(Ci.aromatic)}},basic:{"@desc":"residues named ARG HIS LYS",map:function(){return Qr(Ci.basic)}},bonded:{"@desc":"atoms for which numbonds > 0",map:function(){return Md(Tr.struct.filter.pick({0:Tr.struct.modifier.includeConnected({0:Tr.struct.generator.all(),"bond-test":Tr.core.flags.hasAny([Tr.struct.bondProperty.flags(),Tr.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:Tr.core.rel.gr([Tr.struct.atomSet.atomCount(),1])}))}},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:function(){return Qr(Ci.buried)}},cg:{"@desc":"residues named CYT C GUA G",map:function(){return Qr(Ci.cg)}},charged:{"@desc":'"basic or acidic"',map:function(){return Qr(Ci.basic.concat(Ci.acidic))}},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:function(){return Qr(Ci.cyclic)}},hetero:{"@desc":'"not (protein or nucleic)"',map:function(){return Zu(Tr.struct.combinator.merge([ip(),CB()]))}},hydrogen:{"@desc":'name "[0-9]?H.*"',map:function(){return Tr.struct.generator.atomGroups({"atom-test":Tr.core.str.match([Tr.core.type.regex(["^[0-9]?[H].*$","i"]),Tr.core.type.str([Tr.ammp("label_atom_id")])])})}},large:{"@desc":'"protein and not (small or medium)"',map:function(){return Tr.struct.modifier.intersectBy({0:ip(),by:Zu(Qr(Ci.small.concat(Ci.medium)))})}},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:function(){return Qr(Ci.medium)}},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:function(){return Qr(Ci.neutral)}},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:function(){return Qr(Ci.hydrophobic)}},polar:{"@desc":'"protein and not hydrophobic"',map:function(){return Tr.struct.modifier.intersectBy({0:ip(),by:Zu(Qr(Ci.hydrophobic))})}},purine:{"@desc":"residues named ADE A GUA G",map:function(){return Qr(Ci.purine)}},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:function(){return Qr(Ci.pyrimidine)}},small:{"@desc":"residues named ALA GLY SER",map:function(){return Qr(Ci.small)}},surface:{"@desc":'"protein and not buried"',map:function(){return Tr.struct.modifier.intersectBy({0:ip(),by:Zu(Qr(Ci.buried))})}},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:function(){return Rd(["alpha"])}},pi_helix:{"@desc":"atom's residue is in a pi helix",map:function(){return Rd(["pi"])}},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:function(){return Rd(["3-10"])}},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:function(){return Rd(["helix"])}},extended_beta:{"@desc":"atom's residue is a beta sheet",map:function(){return Rd(["sheet"])}},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:function(){return Rd(["strand"])}},sheet:{"@desc":"atom's residue is a beta sheet",map:function(){return Rd(["beta"])}},turn:{"@desc":"atom's residue is in a turn conformation",map:function(){return Rd(["turn"])}},coil:{"@desc":"atom's residue is in a coil conformation",map:function(){return Tr.struct.modifier.intersectBy({0:ip(),by:Rd(["none"])})}}},jo=fe,U8e={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:function(e){return jo.core.math.pow([e,2])}},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:function(e){return jo.core.math.sqrt([e])}},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:function(e){return jo.core.math.abs([e])}},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:function(e){return jo.core.math.floor([e])}},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:function(e){return jo.core.math.ceil([e])}},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:function(e){return jo.core.math.sin([e])}},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:function(e){return jo.core.math.cos([e])}},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:function(e){return jo.core.math.tan([e])}},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:function(e){return jo.core.math.atan([e])}},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:function(e){return jo.core.math.asin([e])}},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:function(e){return jo.core.math.acos([e])}},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:function(e){return jo.core.math.sinh([e])}},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:function(e){return jo.core.math.cosh([e])}},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:function(e){return jo.core.math.tanh([e])}},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:function(e){return jo.core.math.exp([e])}},log:{"@desc":"natural log of x","@examples":["log(2)"],map:function(e){return jo.core.math.log([e])}},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:function(e){return jo.core.math.log10([e])}}},Sa=fe,V8e=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:Us,rule:We.regexp(/\s*(\*|\/)\s*/,1),map:function(e,t,r){switch(e){case"*":return Sa.core.math.mult([t,r]);case"/":return Sa.core.math.div([t,r]);default:throw new Error("value operator '".concat(e,"' not supported"))}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:Us,rule:We.regexp(/\s*(-|\+)\s*/,1),map:function(e,t,r){switch(e){case"-":return Sa.core.math.sub([t,r]);case"+":return Sa.core.math.add([t,r]);default:throw new Error("value operator '".concat(e,"' not supported"))}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:Us,rule:We.alt(We.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),We.whitespace.result("=")),map:function(e,t,r){var n;if(void 0!==t.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===t.head.name&&(n=Sa.core.flags.hasAny([t,SB(r)])),"core.type.regex"===t.head.name&&(n=Sa.core.str.match([t,Sa.core.type.str([r])]))):void 0!==r.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===r.head.name&&(n=Sa.core.flags.hasAny([r,SB(t)])),"core.type.regex"===r.head.name&&(n=Sa.core.str.match([r,Sa.core.type.str([t])]))):"=~"===e&&(n=Sa.core.str.match(t.head?[Sa.core.type.regex(["^".concat(r,"$"),"i"]),Sa.core.type.str([t])]:[Sa.core.type.regex(["^".concat(t,"$"),"i"]),Sa.core.type.str([r])])),!n)switch(t.head&&(r=p2(t,r)),r.head&&(t=p2(r,t)),e){case"=":case"==":n=Sa.core.rel.eq([t,r]);break;case"!=":n=Sa.core.rel.neq([t,r]);break;case">":n=Sa.core.rel.gr([t,r]);break;case"<":n=Sa.core.rel.lt([t,r]);break;case">=":n=Sa.core.rel.gre([t,r]);break;case"<=":n=Sa.core.rel.lte([t,r]);break;default:throw new Error("value operator '".concat(e,"' not supported"))}return Sa.struct.generator.atomGroups({"atom-test":n})}}],G8e=We.createLanguage({Parens:function(e){return We.alt(e.Parens,e.Operator,e.Expression).wrap(We.string("("),We.string(")"))},Expression:function(e){return We.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){var e;return(e=We).alt.apply(e,a$(uv))},Keywords:function(){var e;return(e=We).alt.apply(e,vB(S$))},ValueRange:function(e){return We.seq(e.Value.skip(We.regexp(/\s+TO\s+/i)),e.Value).map(function(t){return{range:t}})},RangeListProperty:function(e){var t;return We.seq((t=We).alt.apply(t,gB(uv,/\s/)).skip(We.whitespace),We.alt(e.ValueRange,e.Value).sepBy1(We.whitespace)).map(function(r){var n,a=r[0],o=[],s=[];r[1].forEach(function(d){d.range?s.push(Sa.core.rel.inRange([a,d.range[0],d.range[1]])):o.push(p2(a,d,v$))});var l,u=function m8e(e){return 1===e.length?e[0]:e.length>1?Vn.core.logic.or(e):void 0}(s),c=function x8e(e,t){if(C8e.includes(e.head.name)){var r=t[0].head,n=[];return t.forEach(function(a){return n.push.apply(n,a.args[0])}),Vn.core.flags.hasAny([e,{head:r,args:n}])}return 1===t.length?Vn.core.rel.eq([e,t[0]]):t.length>1?Vn.core.set.has([Vn.core.type.set(t),e]):void 0}(a,o);return l=u&&c?Sa.core.logic.or([u,c]):u||c,Sa.struct.generator.atomGroups(((n={})[function S8e(e){if(e.head.name.startsWith("structure-query.atom-property.macromolecular.")){var t=e.head.name.substr(45);if(g8e.includes(t))return"entity-test";if(y8e.includes(t))return"chain-test";if(b8e.includes(t))return"residue-test"}return"atom-test"}(a)]=l,n))})},Operator:function(e){return f2(g$,We.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return We.alt(e.Operator,e.Parens,e.Expression).trim(We.optWhitespace)},Number:function(){return We.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){var e=yB(uv,S$,g$).sort(Id).map(aS).join("|");return We.alt(We.regexp(new RegExp("(?!(".concat(e,"))[A-Z0-9_]+"),"i")),We.regexp(/'((?:[^"\\]|\\.)*)'/,1),We.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(function(t){return Sa.core.type.regex(["^".concat(t,"$"),"i"])})).desc("string")},Value:function(e){return We.alt(e.Number,e.String)},ValueParens:function(e){return We.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(We.string("("),We.string(")"))},ValuePropertyNames:function(){var e;return(e=We).alt.apply(e,gB(uv,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return f2(V8e,We.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return We.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){var t;return(t=We).alt.apply(t,function v8e(e,t){var r=[],n=We.regexp(/\(\s*/),a=We.regexp(/\s*\)/);return Object.keys(e).sort(Id).forEach(function(i){var o=e[i],s=o.map?o.map:Sm("function '".concat(i,"' not supported")),u=We.regexp(new RegExp(i,"i")).skip(n).then(t).skip(a).map(s);r.push(u)}),r}(U8e,e.ValueOperator))},ValueQuery:function(e){return We.alt(e.ValueOperator.map(function(t){if(!t.head.name||!t.head.name.startsWith("structure-query.generator"))throw new Error("values must be part of an comparison, value '".concat(t,"'"));return t}))}}),H8e={pymol:function(e){return N8e.Query.tryParse(e)},vmd:function(e){return G8e.Query.tryParse(e)},jmol:function(e){return E8e.Query.tryParse(e)}},j8e=H8e,W8e=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '".concat(t.symbol.id,"' already added. Call removeSymbol/removeCustomProps re-adding the symbol.")),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++)this.addSymbol(t.symbols[n[r]])},e.prototype.removeCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++)this.removeSymbol(t.symbols[n[r]])},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),sT=new W8e,Y8e=function e(t){this.table=t,this.constQueryContext=new Rc(Ze.Empty)};!function(e){e.Const=function t(n){return{kind:"const",value:n}},e.Dynamic=function r(n){return{kind:"dynamic",runtime:n}}}(C$||(C$={})),function(e){e.Const=function t(n){return{isConst:!0,fn:function(i){return n}}},e.Dynamic=function r(n){return{isConst:!1,fn:n}}}(lv||(lv={})),function(e){e.forEachEval=function t(r,n,a,i){if("number"==typeof r.length)for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else{o=0;for(var u=0,c=Object.keys(r);u<c.length;u++)a(r[c[u]](n),o++,i)}return i}}(g2||(g2={})),function(e){e.Const=function t(n,a){return new x$(n,a,!0)},e.Dynamic=function r(n,a){return new x$(n,a,!1)}}(cy||(cy={}));var x$=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(r)if($i.isArgumentsArray(r)){n=[],a=!0;for(var i=0,o=r;i<o.length;i++){var u=xB(t,o[i]);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!0;for(var c=0,l=Object.keys(r);c<l.length;c++){var d=l[c];u=xB(t,r[d]),a=a&&u.isConst,n[d]=u.fn}}else n=void 0,a=!0;return this.isConst&&this.isConst&&a?lv.Const(this.fn(t.constQueryContext,n)):lv.Dynamic(function _$(e,t){return function(n){return e(n,t)}}(this.fn,n))},e}();function xB(e,t){if($i.isLiteral(t))return lv.Const(t);if($i.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):lv.Const(t.name)}if(!$i.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '".concat(t.head.name,"' is not implemented."));return n.compile(e,t.args)}function y2(e){return xB(new Y8e(sT),e).fn}var rr=cy.Const,Ht=cy.Dynamic,X8e=[rr(Se.core.type.bool,function(t,r){return!!r[0](t)}),rr(Se.core.type.num,function(t,r){return+r[0](t)}),rr(Se.core.type.str,function(t,r){return""+r[0](t)}),rr(Se.core.type.list,function(t,r){return g2.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),rr(Se.core.type.set,function(t,r){return g2.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),rr(Se.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),rr(Se.core.type.bitflags,function(t,r){return+r[0](t)}),rr(Se.core.type.compositeKey,function(t,r){return g2.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),rr(Se.core.logic.not,function(e,t){return!t[0](e)}),rr(Se.core.logic.and,function(e,t){if("number"==typeof t.length){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++)if(!t[i[a]](e))return!1;return!0}),rr(Se.core.logic.or,function(e,t){if("number"==typeof t.length){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++)if(t[i[a]](e))return!0;return!1}),rr(Se.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),rr(Se.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),rr(Se.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),rr(Se.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),rr(Se.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),rr(Se.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),rr(Se.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),rr(Se.core.math.add,function(e,t){var r=0;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++)r+=t[o[i]](e);return r}),rr(Se.core.math.sub,function(e,t){var r=0;if("number"==typeof t.length){if(1===t.length)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(1===i.length)return-t[i[0]](e);for(r=t[i[0]](e)||0,n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),rr(Se.core.math.mult,function(e,t){var r=1;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++)r*=t[o[i]](e);return r}),rr(Se.core.math.div,function(e,t){return t[0](e)/t[1](e)}),rr(Se.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),rr(Se.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),rr(Se.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++)r=Math.min(t[o[i]](e),r);return r}),rr(Se.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++)r=Math.max(t[o[i]](e),r);return r}),rr(Se.core.math.cantorPairing,function(e,t){return Ou(t[0](e),t[1](e))}),rr(Se.core.math.sortedCantorPairing,function(e,t){return iS(t[0](e),t[1](e))}),rr(Se.core.math.invertCantorPairing,function(e,t){return Xq([0,0],t[0](e))}),rr(Se.core.math.floor,function(e,t){return Math.floor(t[0](e))}),rr(Se.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),rr(Se.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),rr(Se.core.math.trunc,function(e,t){return Math.trunc(t[0](e))}),rr(Se.core.math.abs,function(e,t){return Math.abs(t[0](e))}),rr(Se.core.math.sign,function(e,t){return Math.sign(t[0](e))}),rr(Se.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),rr(Se.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),rr(Se.core.math.sin,function(e,t){return Math.sin(t[0](e))}),rr(Se.core.math.cos,function(e,t){return Math.cos(t[0](e))}),rr(Se.core.math.tan,function(e,t){return Math.tan(t[0](e))}),rr(Se.core.math.asin,function(e,t){return Math.asin(t[0](e))}),rr(Se.core.math.acos,function(e,t){return Math.acos(t[0](e))}),rr(Se.core.math.atan,function(e,t){return Math.atan(t[0](e))}),rr(Se.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),rr(Se.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),rr(Se.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),rr(Se.core.math.exp,function(e,t){return Math.exp(t[0](e))}),rr(Se.core.math.log,function(e,t){return Math.log(t[0](e))}),rr(Se.core.math.log10,function(e,t){return Math.log10(t[0](e))}),rr(Se.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),rr(Se.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),rr(Se.core.str.concat,function(e,t){var r=[];if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++)r.push(t[o[i]](e).toString());return r.join("")}),rr(Se.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),rr(Se.core.list.equal,function(e,t){return DW(t[0](e),t[1](e))}),rr(Se.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),rr(Se.core.set.isSubset,function(t,r){return sa.isSuperset(r[1](t),r[0](t))}),rr(Se.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?0!=(n&r):!!n}),rr(Se.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),rr(Se.structureQuery.type.elementSymbol,function(e,t){return $h(t[0](e))}),rr(Se.structureQuery.type.atomName,function(e,t){return function F_e(e){return e?"string"==typeof e?e.toUpperCase():"".concat(e).toUpperCase():""}(t[0](e))}),rr(Se.structureQuery.type.bondFlags,function(e,t){var r=0;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=w$(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++)r=w$(r,t[o[i]](e));return r}),rr(Se.structureQuery.type.ringFingerprint,function(e,t){return Mc.elementFingerprint(function K8e(e,t){var r=[];if(!t)return r;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else{var i=Object.keys(t);for(n=1,a=i.length;n<a;n++)r.push(t[i[n]](e))}return r}(e,t))}),rr(Se.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if("number"==typeof t.length)for(var n=0,a=t.length;n<a;n++)r=A$(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++)r=A$(r,t[o[i]](e));return r}),Ht(Se.structureQuery.filter.pick,function(e,t){return gn.filters.pick(t[0],t.test)(e)}),Ht(Se.structureQuery.filter.first,function(e,t){return gn.filters.first(t[0])(e)}),Ht(Se.structureQuery.filter.withSameAtomProperties,function(e,t){return gn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),Ht(Se.structureQuery.filter.intersectedBy,function(e,t){return gn.filters.areIntersectedBy(t[0],t.by)(e)}),Ht(Se.structureQuery.filter.within,function(e,t){var r,n,a;return gn.filters.within({query:t[0],target:t.target,minRadius:null===(r=t["min-radius"])||void 0===r?void 0:r.call(t,e),maxRadius:null===(n=t["max-radius"])||void 0===n?void 0:n.call(t,e),elementRadius:t["atom-radius"],invert:null===(a=t.invert)||void 0===a?void 0:a.call(t,e)})(e)}),Ht(Se.structureQuery.filter.isConnectedTo,function(e,t){var r,n;return gn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:null===(r=t.disjunct)||void 0===r?void 0:r.call(t,e),invert:null===(n=t.invert)||void 0===n?void 0:n.call(t,e),bondTest:t["bond-test"]})(e)}),Ht(Se.structureQuery.generator.atomGroups,function(t,r){return gn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),Ht(Se.structureQuery.generator.all,function(t){return gn.generators.all(t)}),Ht(Se.structureQuery.generator.empty,function(t){return gn.generators.none(t)}),Ht(Se.structureQuery.generator.bondedAtomicPairs,function(t,r){return gn.generators.bondedAtomicPairs(r&&r[0])(t)}),Ht(Se.structureQuery.generator.rings,function(t,r){var n,a;return gn.generators.rings(null===(n=r?.fingerprint)||void 0===n?void 0:n.call(r,t),null===(a=r?.["only-aromatic"])||void 0===a?void 0:a.call(r,t))(t)}),Ht(Se.structureQuery.generator.queryInSelection,function(t,r){var n;return gn.generators.querySelection(r[0],r.query,null===(n=r["in-complement"])||void 0===n?void 0:n.call(r,t))(t)}),Ht(Se.structureQuery.modifier.includeSurroundings,function(t,r){return gn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!(!r["as-whole-residues"]||!r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),Ht(Se.structureQuery.modifier.surroundingLigands,function(t,r){return gn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!(!r["include-water"]||!r["include-water"](t))})(t)}),Ht(Se.structureQuery.modifier.wholeResidues,function(t,r){return gn.modifiers.wholeResidues(r[0])(t)}),Ht(Se.structureQuery.modifier.union,function(t,r){return gn.modifiers.union(r[0])(t)}),Ht(Se.structureQuery.modifier.expandProperty,function(t,r){return gn.modifiers.expandProperty(r[0],r.property)(t)}),Ht(Se.structureQuery.modifier.exceptBy,function(t,r){return gn.modifiers.exceptBy(r[0],r.by)(t)}),Ht(Se.structureQuery.modifier.includeConnected,function(t,r){var n,a;return gn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!(!r["as-whole-residues"]||!r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:null!==(a=null===(n=r["fixed-point"])||void 0===n?void 0:n.call(r,t))&&void 0!==a&&a})(t)}),Ht(Se.structureQuery.modifier.intersectBy,function(t,r){return gn.modifiers.intersectBy(r[0],r.by)(t)}),Ht(Se.structureQuery.combinator.merge,function(e,t){return gn.combinators.merge(t)(e)}),Ht(Se.structureQuery.atomProperty.core.elementSymbol,Bn(ot.atom.type_symbol)),Ht(Se.structureQuery.atomProperty.core.vdw,function(e,t){return n2(ot.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ht(Se.structureQuery.atomProperty.core.mass,function(e,t){return function rLe(e){var t=HA[e];return void 0===t?10.81:$ke[t]}(ot.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ht(Se.structureQuery.atomProperty.core.atomicNumber,function(e,t){return a2(ot.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ht(Se.structureQuery.atomProperty.core.x,Bn(ot.atom.x)),Ht(Se.structureQuery.atomProperty.core.y,Bn(ot.atom.y)),Ht(Se.structureQuery.atomProperty.core.z,Bn(ot.atom.z)),Ht(Se.structureQuery.atomProperty.core.sourceIndex,Bn(ot.atom.sourceIndex)),Ht(Se.structureQuery.atomProperty.core.operatorName,Bn(ot.unit.operator_name)),Ht(Se.structureQuery.atomProperty.core.operatorKey,Bn(ot.unit.operator_key)),Ht(Se.structureQuery.atomProperty.core.modelIndex,Bn(ot.unit.model_index)),Ht(Se.structureQuery.atomProperty.core.modelLabel,Bn(ot.unit.model_label)),Ht(Se.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return Ou(r.unit.id,r.element)}),Ht(Se.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return function iUe(e){return Fe.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}(t&&t[0]&&t[0](e)||e.element)}),Ht(Se.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return function oUe(e){return Fe.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}(t&&t[0]&&t[0](e)||e.element)}),Ht(Se.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return function sUe(e){return ot.entity.key(e)}(t&&t[0]&&t[0](e)||e.element)}),Ht(Se.structureQuery.atomProperty.macromolecular.id,Bn(ot.atom.id)),Ht(Se.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return"ATOM"!==ot.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)}),Ht(Se.structureQuery.atomProperty.macromolecular.label_atom_id,Bn(ot.atom.label_atom_id)),Ht(Se.structureQuery.atomProperty.macromolecular.label_alt_id,Bn(ot.atom.label_alt_id)),Ht(Se.structureQuery.atomProperty.macromolecular.label_comp_id,Bn(ot.atom.label_comp_id)),Ht(Se.structureQuery.atomProperty.macromolecular.label_seq_id,Bn(ot.residue.label_seq_id)),Ht(Se.structureQuery.atomProperty.macromolecular.label_asym_id,Bn(ot.chain.label_asym_id)),Ht(Se.structureQuery.atomProperty.macromolecular.label_entity_id,Bn(ot.entity.id)),Ht(Se.structureQuery.atomProperty.macromolecular.auth_atom_id,Bn(ot.atom.auth_atom_id)),Ht(Se.structureQuery.atomProperty.macromolecular.auth_comp_id,Bn(ot.atom.auth_comp_id)),Ht(Se.structureQuery.atomProperty.macromolecular.auth_seq_id,Bn(ot.residue.auth_seq_id)),Ht(Se.structureQuery.atomProperty.macromolecular.auth_asym_id,Bn(ot.chain.auth_asym_id)),Ht(Se.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,Bn(ot.residue.pdbx_PDB_ins_code)),Ht(Se.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,Bn(ot.atom.pdbx_formal_charge)),Ht(Se.structureQuery.atomProperty.macromolecular.occupancy,Bn(ot.atom.occupancy)),Ht(Se.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,Bn(ot.atom.B_iso_or_equiv)),Ht(Se.structureQuery.atomProperty.macromolecular.entityType,Bn(ot.entity.type)),Ht(Se.structureQuery.atomProperty.macromolecular.entitySubtype,Bn(ot.entity.subtype)),Ht(Se.structureQuery.atomProperty.macromolecular.entityPrdId,Bn(ot.entity.prd_id)),Ht(Se.structureQuery.atomProperty.macromolecular.entityDescription,Bn(ot.entity.pdbx_description)),Ht(Se.structureQuery.atomProperty.macromolecular.objectPrimitive,Bn(ot.unit.object_primitive)),Ht(Se.structureQuery.atomProperty.macromolecular.isNonStandard,Bn(ot.residue.isNonStandard)),Ht(Se.structureQuery.atomProperty.macromolecular.secondaryStructureKey,Bn(ot.residue.secondary_structure_key)),Ht(Se.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,Bn(ot.residue.secondary_structure_type)),Ht(Se.structureQuery.atomProperty.macromolecular.chemCompType,Bn(ot.residue.chem_comp_type)),Ht(Se.structureQuery.atomSet.atomCount,function(t,r){return gn.atomset.atomCount(t)}),Ht(Se.structureQuery.atomSet.countQuery,function(t,r){return gn.atomset.countQuery(r[0])(t)}),Ht(Se.structureQuery.atomSet.propertySet,function(t,r){return gn.atomset.propertySet(r[0])(t)}),Ht(Se.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),Ht(Se.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),Ht(Se.structureQuery.bondProperty.key,function(e,t){return e.atomicBond.key}),Ht(Se.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),Ht(Se.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),Ht(Se.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),Ht(Se.internal.generator.bundleElement,function(t,r){return $Z(r.groupedUnits(t),r.ranges(t),r.set(t))}),Ht(Se.internal.generator.bundle,function(t,r){return JZ(r.elements(t))(t)}),Ht(Se.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function Bn(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function w$(e,t){return e|(Gr.isName(t)?Gr.fromName(t):0)}function A$(e,t){switch(t.toLowerCase()){case"helix":return 2|e;case"alpha":return 4098|e;case"pi":return 32770|e;case"310":return 2050|e;case"beta":return 4|e;case"strand":return 4194308|e;case"sheet":return 8388612|e;case"turn":return 16|e;case"bend":return 8|e;case"coil":return 536870912|e;default:return e}}function Ni(e,t){return{expression:e,language:t}}!function(){for(var e=0,t=X8e;e<t.length;e++)sT.addSymbol(t[e])}(),function(e){function n(s){switch(s.language){case"mol-script":var u=function p8e(e){return dB.parse(e)}(s.expression);if(0===u.length)throw new Error("No query");return o8e(u[0]);case"pymol":case"jmol":case"vmd":return function q8e(e,t){try{return j8e[e](t)}catch(n){throw console.error(n.message),n}}(s.language,s.expression);default:Sn()}}function a(s){return y2(n(s))}e.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"},e.is=function t(s){return!!s&&"string"==typeof s.expression&&!!s.language},e.areEqual=function r(s,u){return s.language===u.language&&s.expression===u.expression},e.toExpression=n,e.toQuery=a,e.toLoci=function i(s,u){var l=a(s)(new Rc(u));return ht.toLociWithSourceUnits(l)},e.getStructureSelection=function o(s,u,c){return y2("function"==typeof s?s(fe):s)(new Rc(u,c))}}(Ni||(Ni={}));var dv,cs,ly={dynamicBonds:T.Optional(T.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))};!function(e){function n(u,c,l,d,f){return ue(this,void 0,void 0,function(){var p,m,h,v,g,y;return ce(this,function(S){switch(S.label){case 0:return p=void 0,m=Ja.Provider.get(l),!d&&m&&0!==m.assemblies.length&&(d=m.assemblies[0].id),m&&0!==m.assemblies.length?(p=KS.findAssembly(l,d||""))||u.log.warn("Model '".concat(l.entryId,"' has no assembly called '").concat(d,"', returning model structure.")):u.log.warn("Model '".concat(l.entryId,"' has no assembly, returning model structure.")),h=Ze.ofModel(l,f),p?[4,wd.buildAssembly(h,d=p.id).runInContext(c)]:(v={label:"Model",description:Ze.elementDescription(h)},[2,new ve.Molecule.Structure(h,v)]);case 1:return g=S.sent(),y={label:"Assembly ".concat(d),description:Ze.elementDescription(g)},[2,new ve.Molecule.Structure(g,y)]}})})}function a(u,c,l,d,f){return ue(this,void 0,void 0,function(){var p,m,h;return ce(this,function(v){switch(v.label){case 0:return p=Ze.ofModel(c,f),[4,wd.buildSymmetryRange(p,l,d).runInContext(u)];case 1:return m=v.sent(),h={label:"Symmetry [".concat(l,"] to [").concat(d,"]"),description:Ze.elementDescription(m)},[2,new ve.Molecule.Structure(m,h)]}})})}function i(u,c,l,d){return ue(this,void 0,void 0,function(){var f,p,m;return ce(this,function(h){switch(h.label){case 0:return f=Ze.ofModel(c,d),[4,wd.builderSymmetryMates(f,l).runInContext(u)];case 1:return p=h.sent(),m={label:"Symmetry Mates",description:Ze.elementDescription(p)},[2,new ve.Molecule.Structure(p,m)]}})})}function o(u,c,l,d,f){return ue(this,void 0,void 0,function(){var p,m,h;return ce(this,function(v){switch(v.label){case 0:return p=Ze.ofModel(c,f),[4,wd.buildSymmetryAssembly(p,l,d).runInContext(u)];case 1:return m=v.sent(),h={label:"Symmetry Assembly",description:Ze.elementDescription(m)},[2,new ve.Molecule.Structure(m,h)]}})})}e.getParams=function t(u,c){var l=u&&Ja.Provider.get(u),d=l?l.assemblies.map(function(C){return[C.id,"".concat(C.id,": ").concat(yc(C.details))]}):[],f=!l||!ns.isZero(l.spacegroup.cell),p=[];if(l)for(var m=l.spacegroup.operators,h=0,v=m.length;h<v;h++)p.push([h,"".concat(h+1,": ").concat(au.getOperatorXyz(m[h]))]);var g=[];u&&u.properties.structAsymMap.forEach(function(C){var _=C.id===C.auth_id?C.id:"".concat(C.id," [auth ").concat(C.auth_id,"]");g.push([C.id,_])});var y={auto:T.Group(ly),model:T.Group(ly),assembly:T.Group(R({id:T.Optional(u?T.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):T.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},ly),{isFlat:!0}),"symmetry-mates":T.Group(R({radius:T.Numeric(5,{min:0,max:50,step:1})},ly),{isFlat:!0}),symmetry:T.Group(R({ijkMin:T.Vec3(b.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:T.Vec3(b.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},ly),{isFlat:!0}),"symmetry-assembly":T.Group(R({generators:T.ObjectList({operators:T.ObjectList({index:T.Select(0,p),shift:T.Vec3(b(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(C){return"".concat(C.index+1,"_").concat(C.shift.map(function(_){return _+5}).join(""))},{defaultValue:[]}),asymIds:T.MultiSelect([],g)},function(C){return"".concat(C.asymIds.length," asym ids, ").concat(C.operators.length," operators")},{defaultValue:[]})},ly),{isFlat:!0})},S=[];return"auto"===c&&S.push(["auto","Auto"]),S.push(["model","Model"]),d.length>0&&S.push(["assembly","Assembly"]),f&&(S.push(["symmetry-mates","Symmetry Mates"]),S.push(["symmetry","Symmetry (indices)"]),S.push(["symmetry-assembly","Symmetry (assembly)"])),{type:T.MappedStatic(c||"model",y,{options:S})}},e.canAutoUpdate=function r(u,c){return!("symmetry-assembly"===c.name||"symmetry"===c.name&&"symmetry"===u.name)},e.create=function s(u,c,l,d){return ue(this,void 0,void 0,function(){var f,p,m;return ce(this,function(h){return f=d?.params,(p=Ja.Provider.get(l))&&d&&"model"!==d.name?"auto"===d.name?0===p.assemblies.length?(m=Ze.ofModel(l,f),[2,new ve.Molecule.Structure(m,{label:"Model",description:Ze.elementDescription(m)})]):[2,n(u,c,l,void 0,f)]:"assembly"===d.name?[2,n(u,c,l,d.params.id,f)]:"symmetry"===d.name?[2,a(c,l,d.params.ijkMin,d.params.ijkMax,f)]:"symmetry-mates"===d.name?[2,i(c,l,d.params.radius,f)]:"symmetry-assembly"===d.name?[2,o(c,l,d.params.generators,p,f)]:(Sn(),[2]):(m=Ze.ofModel(l,f),[2,new ve.Molecule.Structure(m,{label:"Model",description:Ze.elementDescription(m)})])})})}}(dv||(dv={})),function(e){function r(s,u){var c=Ni.is(u)?u:void 0,l=Ni.is(u)?Ni.toExpression(u):u;return{script:c,expression:l,compiled:y2(l),originalStructure:s,currentStructure:s}}function n(s,u){return s.compiled(new Rc(u))}e.isUnchanged=function t(s,u,c){return s.currentStructure===c&&(Ni.is(u)?!!s.script&&Ni.areEqual(s.script,u):s.expression===u)},e.create=r,e.run=n,e.createAndRun=function a(s,u){var c=r(s,u);return{entry:c,selection:n(c,s)}},e.updateStructure=function i(s,u){return s.currentStructure=u,s.compiled(new Rc(u))},e.updateStructureObject=function o(s,u,c){var l=ht.unionStructure(u);s.label="".concat(c||"Selection"),s.description=Ze.elementDescription(l),s.data=l}}(cs||(cs={}));var Z8e=new Set(["LI","NA","K","RB","CS","FR"]),$8e=new Set(["BE","MG","CA","SR","BA","RA"]),oVe=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]),cVe=new Set(["F","CL","BR","I","AT"]);function lVe(e){return cVe.has(e)}function T$(e){var t=a2(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function pVe(e){return function Q8e(e){return Z8e.has(e)}(e)||function J8e(e){return $8e.has(e)}(e)||function dVe(e){var t=a2(e);return t>=57&&t<=71}(e)||function fVe(e){var t=a2(e);return t>=89&&t<=103}(e)||T$(e)||function sVe(e){return oVe.has(e)}(e)}var ln=function(e){return e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal",e}(ln||{});function un(e,t,r){var n,a;return void 0===r&&(r={}),{label:e,expression:t,description:r.description||"",category:null!==(n=r.category)&&void 0!==n?n:ln.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=y2(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return ue(this,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=i.managers.structure.selection.getStructure(s),c=u?ht.Sequence(s,[u]):ht.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:l.sent(),l.label=2;case 2:return a||(a=y2(t)),[2,a(new Rc(s,{currentSelection:c}))]}})})}}}var mVe=un("All",fe.struct.generator.all(),{category:"",priority:1e3}),hVe=un("Current Selection",fe.internal.generator.current(),{category:"",referencesCurrent:!0}),vVe=un("Polymer",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.logic.and([fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),fe.core.str.match([fe.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),fe.ammp("entitySubtype")])])})]),{category:ln.Type}),gVe=un("Trace",fe.struct.modifier.union([fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),"chain-test":fe.core.set.has([fe.set("sphere","gaussian"),fe.ammp("objectPrimitive")])})]),fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"atom-test":fe.core.set.has([fe.set("CA","P"),fe.ammp("label_atom_id")])})])])]),{category:ln.Structure}),dy=fe.core.logic.and([fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),fe.core.str.match([fe.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),fe.ammp("entitySubtype")])]),uT=fe.core.logic.and([fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),fe.core.str.match([fe.re("(nucleotide|peptide nucleic acid)","i"),fe.ammp("entitySubtype")])]),fv=fe.core.str.match([fe.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),fe.ammp("chemCompType")]),yVe=un("Backbone",fe.struct.modifier.union([fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":dy,"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fv]),"atom-test":fe.core.set.has([fe.set.apply(fe,sa.toArray(Qf)),fe.ammp("label_atom_id")])})]),fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":uT,"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fv]),"atom-test":fe.core.set.has([fe.set.apply(fe,sa.toArray(IA)),fe.ammp("label_atom_id")])})])])]),{category:ln.Structure}),bVe=un("Sidechain",fe.struct.modifier.union([fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":dy,"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fv]),"atom-test":fe.core.logic.or([fe.core.logic.not([fe.core.set.has([fe.set.apply(fe,sa.toArray(Qf)),fe.ammp("label_atom_id")])])])})]),fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":uT,"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fv]),"atom-test":fe.core.logic.or([fe.core.logic.not([fe.core.set.has([fe.set.apply(fe,sa.toArray(IA)),fe.ammp("label_atom_id")])])])})])])]),{category:ln.Structure}),SVe=un("Sidechain with Trace",fe.struct.modifier.union([fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":dy,"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fv]),"atom-test":fe.core.logic.or([fe.core.logic.not([fe.core.set.has([fe.set.apply(fe,sa.toArray(Qf)),fe.ammp("label_atom_id")])]),fe.core.rel.eq([fe.ammp("label_atom_id"),"CA"]),fe.core.logic.and([fe.core.rel.eq([fe.ammp("auth_comp_id"),"PRO"]),fe.core.rel.eq([fe.ammp("label_atom_id"),"N"])])])})]),fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":uT,"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fv]),"atom-test":fe.core.logic.or([fe.core.logic.not([fe.core.set.has([fe.set.apply(fe,sa.toArray(IA)),fe.ammp("label_atom_id")])]),fe.core.rel.eq([fe.ammp("label_atom_id"),"P"])])})])])]),{category:ln.Structure}),CVe=un("Protein",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":dy})]),{category:ln.Type}),xVe=un("Nucleic",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":uT})]),{category:ln.Type}),_Ve=un("Helix",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":dy,"residue-test":fe.core.flags.hasAny([fe.ammp("secondaryStructureFlags"),fe.core.type.bitflags([2])])})]),{category:ln.Structure,ensureCustomProperties:function(e,t){return Oc.attach(e,t)}}),wVe=un("Beta Strand/Sheet",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":dy,"residue-test":fe.core.flags.hasAny([fe.ammp("secondaryStructureFlags"),fe.core.type.bitflags([4])])})]),{category:ln.Structure,ensureCustomProperties:function(e,t){return Oc.attach(e,t)}}),AVe=un("Water",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entityType"),"water"])})]),{category:ln.Type}),TVe=un("Ion",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entitySubtype"),"ion"])})]),{category:ln.Type}),DVe=un("Lipid",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entitySubtype"),"lipid"])})]),{category:ln.Type}),cT=un("Carbohydrate",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.logic.or([fe.core.rel.eq([fe.ammp("entityType"),"branched"]),fe.core.logic.and([fe.core.rel.eq([fe.ammp("entityType"),"non-polymer"]),fe.core.str.match([fe.re("oligosaccharide","i"),fe.ammp("entitySubtype")])])])})]),{category:ln.Type}),D$=un("Carbohydrate with Connected",fe.struct.modifier.union([fe.struct.modifier.includeConnected({0:cT.expression,"layer-count":1,"as-whole-residues":!0})]),{category:ln.Internal,isHidden:!0}),E$=un("Connected to Carbohydrate",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:D$.expression,by:cT.expression})]),{category:ln.Internal,isHidden:!0}),_B=un("Ligand",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:fe.struct.modifier.union([fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.logic.and([fe.core.logic.or([fe.core.rel.eq([fe.ammp("entityType"),"non-polymer"]),fe.core.rel.neq([fe.ammp("entityPrdId"),""])]),fe.core.logic.not([fe.core.str.match([fe.re("(oligosaccharide|lipid|ion)","i"),fe.ammp("entitySubtype")])])]),"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.logic.not([fe.core.str.match([fe.re("saccharide","i"),fe.ammp("chemCompType")])])})]),fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fv})])])]),by:fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.set.has([fe.set.apply(fe,sa.toArray(ey)),fe.ammp("label_comp_id")])})]),fe.struct.generator.atomGroups({"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.core.set.has([fe.set.apply(fe,sa.toArray(_Be)),fe.ammp("label_comp_id")])})])})]),{category:ln.Type}),I$=un("Ligand with Connected",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:fe.struct.modifier.union([fe.struct.modifier.includeConnected({0:_B.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":fe.core.flags.hasAny([fe.struct.bondProperty.flags(),fe.core.type.bitflags([3])])})]),by:cT.expression})]),{category:ln.Internal,isHidden:!0}),P$=un("Connected to Ligand",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:I$.expression,by:_B.expression})]),{category:ln.Internal,isHidden:!0}),EVe=un("Connected to Ligand or Carbohydrate",fe.struct.modifier.union([fe.struct.combinator.merge([E$.expression,P$.expression])]),{category:ln.Internal,isHidden:!0}),IVe=un("Disulfide Bridges",fe.struct.modifier.union([fe.struct.combinator.merge([fe.struct.modifier.union([fe.struct.modifier.wholeResidues([fe.struct.filter.isConnectedTo({0:fe.struct.generator.atomGroups({"residue-test":fe.core.set.has([fe.set("CYS"),fe.ammp("auth_comp_id")]),"atom-test":fe.core.set.has([fe.set("SG"),fe.ammp("label_atom_id")])}),target:fe.struct.generator.atomGroups({"residue-test":fe.core.set.has([fe.set("CYS"),fe.ammp("auth_comp_id")]),"atom-test":fe.core.set.has([fe.set("SG"),fe.ammp("label_atom_id")])}),"bond-test":!0})])]),fe.struct.modifier.union([fe.struct.modifier.wholeResidues([fe.struct.modifier.union([fe.struct.generator.bondedAtomicPairs({0:fe.core.flags.hasAny([fe.struct.bondProperty.flags(),fe.core.type.bitflags([8])])})])])])])]),{category:ln.Bond}),PVe=un("NOS Bridges",fe.struct.modifier.union([fe.struct.modifier.wholeResidues([fe.struct.filter.isConnectedTo({0:fe.struct.generator.atomGroups({"residue-test":fe.core.set.has([fe.set("CSO","LYS"),fe.ammp("auth_comp_id")]),"atom-test":fe.core.set.has([fe.set("OD","NZ"),fe.ammp("label_atom_id")])}),target:fe.struct.generator.atomGroups({"residue-test":fe.core.set.has([fe.set("CSO","LYS"),fe.ammp("auth_comp_id")]),"atom-test":fe.core.set.has([fe.set("OD","NZ"),fe.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:ln.Bond}),MVe=un("Non-standard Residues in Polymers",fe.struct.modifier.union([fe.struct.generator.atomGroups({"entity-test":fe.core.rel.eq([fe.ammp("entityType"),"polymer"]),"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":fe.ammp("isNonStandard")})]),{category:ln.Residue}),RVe=un("Coarse Elements",fe.struct.modifier.union([fe.struct.generator.atomGroups({"chain-test":fe.core.set.has([fe.set("sphere","gaussian"),fe.ammp("objectPrimitive")])})]),{category:ln.Type}),OVe=un("Rings in Residues",fe.struct.modifier.union([fe.struct.generator.rings()]),{category:ln.Residue}),FVe=un("Aromatic Rings in Residues",fe.struct.modifier.union([fe.struct.generator.rings({"only-aromatic":!0})]),{category:ln.Residue}),BVe=un("Surrounding Residues (5 \u212b) of Selection",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:fe.struct.modifier.includeSurroundings({0:fe.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:fe.internal.generator.current()})]),{description:"Select residues within 5 \u212b of the current selection.",category:ln.Manipulate,referencesCurrent:!0}),NVe=un("Surrounding Ligands (5 \u212b) of Selection",fe.struct.modifier.union([fe.struct.modifier.surroundingLigands({0:fe.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212b of the current selection.",category:ln.Manipulate,referencesCurrent:!0}),kVe=un("Surrounding Atoms (5 \u212b) of Selection",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:fe.struct.modifier.includeSurroundings({0:fe.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:fe.internal.generator.current()})]),{description:"Select atoms within 5 \u212b of the current selection.",category:ln.Manipulate,referencesCurrent:!0}),LVe=un("Inverse / Complement of Selection",fe.struct.modifier.union([fe.struct.modifier.exceptBy({0:fe.struct.generator.all(),by:fe.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:ln.Manipulate,referencesCurrent:!0}),UVe=un("Residues Covalently Bonded to Selection",fe.struct.modifier.union([fe.struct.modifier.includeConnected({0:fe.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:ln.Manipulate,referencesCurrent:!0}),VVe=un("Covalently Bonded Component",fe.struct.modifier.union([fe.struct.modifier.includeConnected({0:fe.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:ln.Manipulate,referencesCurrent:!0}),GVe=un("Residues with Cov. or Metallic Bond to Selection",fe.struct.modifier.union([fe.struct.modifier.includeConnected({0:fe.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":fe.core.flags.hasAny([fe.struct.bondProperty.flags(),fe.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:ln.Manipulate,referencesCurrent:!0}),zVe=un("Whole Residues of Selection",fe.struct.modifier.union([fe.struct.modifier.wholeResidues({0:fe.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:ln.Manipulate,referencesCurrent:!0}),HVe=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),jVe=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function wB(e,t,r){var n=e[0],a=e[1];void 0===r&&(r=0);var i=1!==n.length||M$.has(n[0])?"".concat(a," (").concat(n.join(", "),")"):"[".concat(n[0],"] ").concat(a);return un(i,fe.struct.modifier.union([fe.struct.generator.atomGroups({"residue-test":fe.core.set.has([fe.set.apply(fe,n),fe.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}var AB,b2,TB,M$=sa.unionMany(x4,WS,YS,PA),xi={all:mVe,current:hVe,polymer:vVe,trace:gVe,backbone:yVe,sidechain:bVe,sidechainWithTrace:SVe,protein:CVe,nucleic:xVe,helix:_Ve,beta:wVe,water:AVe,ion:TVe,lipid:DVe,branched:cT,branchedPlusConnected:D$,branchedConnectedOnly:E$,ligand:_B,ligandPlusConnected:I$,ligandConnectedOnly:P$,connectedOnly:EVe,disulfideBridges:IVe,nosBridges:PVe,nonStandardPolymer:MVe,coarse:RVe,ring:OVe,aromaticRing:FVe,surroundings:BVe,surroundingLigands:NVe,surroundingAtoms:kVe,complement:LVe,covalentlyBonded:UVe,covalentlyOrMetallicBonded:GVe,covalentlyBondedComponent:VVe,wholeResidues:zVe},YVe=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,or(or(or([],Object.values(xi),!1),HVe.map(function(n){return wB(n,ln.AminoAcid)}),!1),jVe.map(function(n){return wB(n,ln.NucleicBase)}),!1)),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);-1!==r&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}();function QVe(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:case 4:return 0;case 3:return 1;case 2:return 2;case 1:return 3;default:return console.error("Value ".concat(e," is outside the 0-7 range, defaulting to 0.")),0}}function R$(e,t){for(var r=Xe.create(e.data,2*t),n=Xe.create(e.data,2*t),a=Xe.create(e.data,2*t),i=Xe.create(e.data,2*t),o=Xe.create(e.data,2*t),s=0;s<t;++s){lt.markLine(e);var u=e.tokenStart,c=e.position;lt.trim(e,u,u+10),Xe.addUnchecked(r,e.tokenStart,e.tokenEnd),lt.trim(e,u+10,u+20),Xe.addUnchecked(n,e.tokenStart,e.tokenEnd),lt.trim(e,u+20,u+30),Xe.addUnchecked(a,e.tokenStart,e.tokenEnd),lt.trim(e,u+31,u+34),Xe.addUnchecked(i,e.tokenStart,e.tokenEnd),lt.trim(e,u+36,u+39),Xe.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=c}return{count:t,x:er(r)(ie.Schema.float),y:er(n)(ie.Schema.float),z:er(a)(ie.Schema.float),type_symbol:er(i)(ie.Schema.str),formal_charge:er(o)(ie.Schema.int)}}function O$(e,t){for(var r=Xe.create(e.data,2*t),n=Xe.create(e.data,2*t),a=Xe.create(e.data,2*t),i=0;i<t;++i){lt.markLine(e);var o=e.tokenStart,s=e.position;lt.trim(e,o,o+3),Xe.addUnchecked(r,e.tokenStart,e.tokenEnd),lt.trim(e,o+3,o+6),Xe.addUnchecked(n,e.tokenStart,e.tokenEnd),lt.trim(e,o+6,o+9),Xe.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:er(r)(ie.Schema.int),atomIdxB:er(n)(ie.Schema.int),order:er(a)(ie.Schema.int)}}function $Ve(e,t,r){lt.trim(e,t+6,t+9);for(var n=parseInt(lt.getTokenString(e)),a=0;a<n;++a){var i=9+8*a;lt.trim(e,t+i,t+i+4);var o=lt.getTokenString(e);r.atomIdx.push(+o),lt.trim(e,t+i+4,t+i+8);var s=lt.getTokenString(e);r.charge.push(+s)}lt.eatLine(e)}function F$(e){for(var n={atomIdx:[],charge:[]};e.position<e.length;){var a=e.position;lt.trim(e,a+3,a+6);var i=lt.getTokenString(e);if("END"===i)break;"CHG"===(lt.eatLine(e),i)&&$Ve(e,a,n)}return{atomIdx:ie.ofIntArray(n.atomIdx),charge:ie.ofIntArray(n.charge)}}function JVe(e){var t=lt(e),r=lt.readLine(t).trim(),n=lt.readLine(t).trim(),a=lt.readLine(t).trim(),i=lt.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=R$(t,o),c=O$(t,s),l=F$(t);return In.success({title:r,program:n,comment:a,atoms:u,bonds:c,formalCharges:l})}function eGe(e){var t=this;return Ve.create("Parse Mol",function(){return ue(t,void 0,void 0,function(){return ce(this,function(r){return[2,JVe(e)]})})})}function B$(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,v,g,y,S,C;return ce(this,function(_){switch(_.label){case 0:if(n=e.atoms,a=e.bonds,i=e.formalCharges,o=ie.ofConst("MOL",e.atoms.count,ie.Schema.str),s=ie.ofConst("A",e.atoms.count,ie.Schema.str),u=ie.asArrayColumn(n.type_symbol),c=ie.ofConst(1,n.count,ie.Schema.int),l=new Int32Array(e.atoms.count),i.atomIdx.rowCount>0)for(d=0;d<i.atomIdx.rowCount;d++)l[i.atomIdx.value(d)-1]=i.charge.value(d);else for(d=0;d<e.atoms.count;d++)l[d]=QVe(n.formal_charge.value(d));return f=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:s,auth_atom_id:u,auth_comp_id:o,auth_seq_id:c,Cartn_x:ie.asArrayColumn(n.x,Float32Array),Cartn_y:ie.asArrayColumn(n.y,Float32Array),Cartn_z:ie.asArrayColumn(n.z,Float32Array),id:ie.range(0,n.count-1),label_asym_id:s,label_atom_id:u,label_comp_id:o,label_seq_id:c,label_entity_id:ie.ofConst("1",n.count,ie.Schema.str),occupancy:ie.ofConst(1,n.count,ie.Schema.float),type_symbol:u,pdbx_PDB_model_num:ie.ofConst(1,n.count,ie.Schema.int),pdbx_formal_charge:ie.ofIntArray(l)},n.count),(p=new xl).setNames([["MOL","Unknown Entity"]]),p.getEntityId("MOL",0,"A"),(m=new Cl(c,u)).setNames([["MOL","Unknown Molecule"]]),m.add("MOL",0),[4,Ed(Ic({entity:p.getEntityTable(),chem_comp:m.getChemCompTable(),atom_site:f}),t??AB.create(e),r)];case 1:return(v=_.sent()).frameCount>0&&(g=ie.ofIntArray(ie.mapToArray(a.atomIdxA,function(x){return x-1},Int32Array)),y=ie.ofIntArray(ie.mapToArray(a.atomIdxB,function(x){return x-1},Int32Array)),S=ie.asArrayColumn(a.order,Int32Array),C=Do.fromData({pairs:{indexA:g,indexB:y,order:S},count:n.count},{maxDistance:1/0}),Do.Provider.set(v.representative,C)),[2,v]}})})}function tGe(e){return Ve.create("Parse MOL",function(t){return B$(e,void 0,t)})}function sGe(e){var t=b2.fromFrame(e);return Ve.create("Parse CIF Core",function(r){return function aGe(e,t,r){var n;return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,U,H,z,G,J,X,Z,ne,Y,k,W,$,K,q,V,ee,ae,pe,me,de,re,te,le,ge;return ce(this,function(xe){switch(xe.label){case 0:for(i=ie.ofConst("MOL",a=e.atom_site._rowCount,ie.Schema.str),o=ie.ofConst("A",a,ie.Schema.str),s=ie.ofConst(1,a,ie.Schema.int),u=function nGe(e){var t=e.cell,n=function rGe(e){var t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?t:r}(e.space_group),a=ns.create(n,b.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),b.scale(b(),b.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:au.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}(e),c=u.spacegroup.cell.fromFractional,d=(l=e.atom_site).fract_x,f=l.fract_y,p=l.fract_z,m=new Float32Array(a),h=new Float32Array(a),v=new Float32Array(a),g=b(),de=0;de<a;++de)b.set(g,d.value(de),f.value(de),p.value(de)),b.transformMat4(g,g,c),m[de]=g[0],h[de]=g[1],v[de]=g[2];if(C=(y=e.atom_site).label,(S=y.type_symbol).isDefined){for(E=new Array(a),D=new Int8Array(a),de=0;de<a;++de)"+"===(w=S.value(de))[(A=w.length)-1]?(E[de]=w.substring(0,A-2),D[de]=parseInt(w[A-2])):"+"===w[A-2]?(E[de]=w.substring(0,A-2),D[de]=parseInt(w[A-1])):"-"===w[A-1]?(E[de]=w.substring(0,A-2),D[de]=-parseInt(w[A-2])):"-"===w[A-2]?(E[de]=w.substring(0,A-2),D[de]=-parseInt(w[A-1])):(E[de]=w,D[de]=0);_=ie.ofStringArray(E),x=ie.ofIntArray(D)}else{for(E=new Array(a),de=0;de<a;++de)E[de]=$0(C.value(de),"");_=ie.ofStringArray(E),x=ie.Undefined(a,ie.Schema.int)}return I=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:o,auth_atom_id:C,auth_comp_id:i,auth_seq_id:s,Cartn_x:ie.ofFloatArray(m),Cartn_y:ie.ofFloatArray(h),Cartn_z:ie.ofFloatArray(v),id:ie.range(0,a-1),label_asym_id:o,label_atom_id:C,label_comp_id:i,label_seq_id:s,label_entity_id:ie.ofConst("1",a,ie.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ie.ofConst(1,a,ie.Schema.float),type_symbol:_,pdbx_formal_charge:x,pdbx_PDB_model_num:ie.ofConst(1,a,ie.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},a),M=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),(F=new xl).setNames([["MOL",M||"Unknown Entity"]]),F.getEntityId("MOL",0,"A"),(N=new Cl(s,e.atom_site.type_symbol)).setNames([["MOL",M||"Unknown Molecule"]]),N.add("MOL",0),[4,Ed(Ic({entity:F.getEntityTable(),chem_comp:N.getChemCompTable(),atom_site:I}),t,r)];case 1:if((U=xe.sent()).frameCount>0&&(Ja.Provider.set(H=U.representative,u),(z=e.geom_bond._rowCount)>0)){for(G={},de=0,X=(J=e.atom_site.label).rowCount;de<X;++de)G[J.value(de)]=de;for(Z=null===(n=t.data.frame.categories.ccdc_geom_bond_type)||void 0===n?void 0:n.getField(""),ne=[],Y=[],k=[],W=[],$=[],K=new Set,q=0,ee=(V=e.geom_bond).atom_site_label_1,ae=V.atom_site_label_2,pe=V.valence,me=V.distance,de=0;de<z;++de)re=G[ee.value(de)],te=G[ae.value(de)],le=re<te?Ou(re,te):Ou(te,re),!K.has(le)&&(K.add(le),ne[q]=re,Y[q]=te,W[q]=me.value(de)||-1,Z?"D"===(ge=Z.str(de))?(k[q]=2,$[q]=1):"A"===ge?(k[q]=1,$[q]=17):(k[q]=1,$[q]=1):($[q]=1,k[q]=pe.isDefined?pe.value(de):1),q+=1);Do.Provider.set(H,Do.fromData({pairs:{indexA:ie.ofIntArray(ne),indexB:ie.ofIntArray(Y),order:ie.ofIntArray(k),distance:ie.ofFloatArray(W),flag:ie.ofIntArray($)},count:a}))}return[2,U]}})})}(t.data.db,t,r)})}function cGe(e){return Ve.create("Parse Cube",function(t){return function uGe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c;return ce(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ie.ofConst("MOL",e.atoms.count,ie.Schema.str),a=ie.ofConst("A",e.atoms.count,ie.Schema.str),i=ie.ofArray({array:ie.mapToArray(r.number,function(f){return function pBe(e){return $K.has(e)?$K.get(e):$h("H")}(f)}),schema:ie.Schema.Aliased(ie.Schema.str)}),o=ie.ofConst(1,r.count,ie.Schema.int),s=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:ie.asArrayColumn(r.x,Float32Array),Cartn_y:ie.asArrayColumn(r.y,Float32Array),Cartn_z:ie.asArrayColumn(r.z,Float32Array),id:ie.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:ie.ofConst("1",r.count,ie.Schema.str),occupancy:ie.ofConst(1,r.count,ie.Schema.float),type_symbol:i,pdbx_PDB_model_num:ie.ofConst(1,r.count,ie.Schema.int)},r.count),(u=new xl).setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),(c=new Cl(o,i)).setNames([["MOL","Unknown Molecule"]]),c.add("MOL",0),[4,Ed(Ic({entity:u.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:s}),TB.create(e),t)];case 1:return[2,d.sent()]}})})}(e,t)})}!function(e){e.is=function t(n){return"mol"===n?.kind},e.create=function r(n){return{kind:"mol",name:n.title,data:n}}}(AB||(AB={})),Dd.Provider.formatRegistry.add("cifCore",function iGe(e){if(b2.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso;return{data:Xr.ofPartialColumns(Dd.Schema,{U:n.u},n._rowCount),elementToAnsiotrop:Dd.getElementToAnsiotropFromLabel(r.label,n.label)}}},function oGe(e){return!!b2.is(e.sourceData)&&e.sourceData.data.db.atom_site_aniso.u.isDefined}),function(e){e.is=function t(n){return"cifCore"===n?.kind},e.fromFrame=function r(n,a){return a||(a=hl.schema.cifCore(n)),{kind:"cifCore",name:a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.icsd.value(0)||a.database_code.mdf.value(0)||a.database_code.nbs.value(0)||a.database_code.csd.value(0)||a.database_code.cod.value(0)||a._name,data:{db:a,frame:n}}}}(b2||(b2={})),function(e){e.is=function t(n){return"cube"===n?.kind},e.create=function r(n){return{kind:"cube",name:n.header.comment1,data:n}}}(TB||(TB={}));var EB,DB=lt.skipWhitespace,N$=lt.eatValue,Lc=lt.markLine,Uc=lt.getTokenString,k$=lt.readLine,L$=/\s+/g;function pGe(e){return ue(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x;return ce(this,function(w){switch(w.label){case 0:for(t=e.tokenizer,r=e.molecule;"@<TRIPOS>ATOM"!==Uc(t)&&t.position<t.data.length;)Lc(t);return n=t.position,a=t.lineNumber,i=k$(t),o=i.trim().split(/\s+/g),s=o.length,u=Xe.create(t.data,2*r.num_atoms),c=Xe.create(t.data,2*r.num_atoms),l=Xe.create(t.data,2*r.num_atoms),d=Xe.create(t.data,2*r.num_atoms),f=Xe.create(t.data,2*r.num_atoms),p=Xe.create(t.data,2*r.num_atoms),m=Xe.create(t.data,2*r.num_atoms),h=Xe.create(t.data,2*r.num_atoms),v=Xe.create(t.data,2*r.num_atoms),g=Xe.create(t.data,2*r.num_atoms),y=ie.Undefined(r.num_atoms,ie.Schema.float),S=ie.Undefined(r.num_atoms,ie.Schema.int),C=ie.Undefined(r.num_atoms,ie.Schema.str),t.position=n,t.lineNumber=a,_=t.length,x=0,[4,vf(e.runtimeCtx,1e5,void 0,function(A){for(var E=Math.min(r.num_atoms-x,A),I=0;I<E;I++)for(var M=0;M<s;M++)switch(DB(t),t.tokenStart=t.position,N$(t),M){case 0:Xe.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:Xe.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:Xe.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 3:Xe.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:Xe.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:Xe.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:Xe.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 7:Xe.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 8:Xe.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 9:Xe.addUnchecked(g,t.tokenStart,t.tokenEnd)}return x+=E,E},function(A){return A.update({message:"Parsing...",current:t.position,max:_})})];case 1:return w.sent(),[2,{count:r.num_atoms,atom_id:er(u)(ie.Schema.int),atom_name:er(c)(ie.Schema.str),x:er(l)(ie.Schema.float),y:er(d)(ie.Schema.float),z:er(f)(ie.Schema.float),atom_type:s>5?er(p)(ie.Schema.str):C,subst_id:s>6?er(m)(ie.Schema.int):S,subst_name:s>7?er(h)(ie.Schema.str):C,charge:s>8?er(v)(ie.Schema.float):y,status_bit:s>9?er(g)(ie.Schema.str):C}]}})})}function mGe(e){return ue(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,m;return ce(this,function(v){switch(v.label){case 0:for(t=e.tokenizer,r=e.molecule;"@<TRIPOS>BOND"!==Uc(t)&&t.position<t.data.length;)Lc(t);return n=t.position,a=t.lineNumber,i=k$(t),o=i.trim().split(/\s+/g),s=o.length,u=Xe.create(t.data,2*r.num_bonds),c=Xe.create(t.data,2*r.num_bonds),l=Xe.create(t.data,2*r.num_bonds),d=Xe.create(t.data,2*r.num_bonds),f=Xe.create(t.data,2*r.num_bonds),t.position=n,t.lineNumber=a,p=t.length,m=0,[4,vf(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-m,g),S=0;S<y;S++)for(var C=0;C<s;C++)switch(DB(t),t.tokenStart=t.position,N$(t),C){case 0:Xe.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:Xe.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:Xe.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 3:Xe.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:Xe.addUnchecked(f,t.tokenStart,t.tokenEnd)}return m+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:p})})];case 1:return v.sent(),[2,{count:r.num_bonds,bond_id:er(u)(ie.Schema.int),origin_atom_id:er(c)(ie.Schema.int),target_atom_id:er(l)(ie.Schema.int),bond_type:er(d)(ie.Schema.str),status_bits:s>4?er(f)(ie.Schema.str):ie.Undefined(r.num_bonds,ie.Schema.str)}]}})})}function vGe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(l){switch(l.label){case 0:n=lt(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],l.label=1;case 1:return n.position<t.length?(i=function dGe(e,t){return{tokenizer:e,molecule:{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""},runtimeCtx:t}}(n,e),function fGe(e){for(var t=e.tokenizer,r=e.molecule;"@<TRIPOS>MOLECULE"!==Uc(t)&&t.position<t.data.length;)Lc(t);Lc(t),r.mol_name=Uc(t),Lc(t);var n=Uc(t).trim().split(L$);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Lc(t);var a=Uc(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,Lc(t);var i=Uc(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,Lc(t);var o=Uc(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,Lc(t);var s=Uc(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}(i),[4,pGe(i)]):[3,4];case 2:return o=l.sent(),[4,mGe(i)];case 3:for(s=l.sent(),u=function hGe(e){for(var t=e.tokenizer;t.position<t.data.length;){var r=Uc(t);if("@<TRIPOS>MOLECULE"===r)return;if("@<TRIPOS>CRYSIN"===r)break;Lc(t)}if(!(t.position>=t.data.length)){Lc(t);var n=Uc(t).trim().split(L$);return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}}(i),a.push({molecule:i.molecule,atoms:o,bonds:s,crysin:u}),DB(n);"@<TRIPOS>MOLECULE"!==Uc(n)&&n.position<n.data.length;)Lc(n);return[3,1];case 4:return[2,In.success({name:r,structures:a})]}})})}function gGe(e,t){var r=this;return Ve.create("Parse MOL2",function(n){return ue(r,void 0,void 0,function(){return ce(this,function(a){switch(a.label){case 0:return[4,vGe(n,e,t)];case 1:return[2,a.sent()]}})})})}function SGe(e){return Ve.create("Parse MOL2",function(t){return function yGe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,_,x,D,w,A,E,I,M,F;return ce(this,function(N){switch(N.label){case 0:r=[],n=0,a=e.structures.length,N.label=1;case 1:if(!(n<a))return[3,4];for(o=(i=e.structures[n]).molecule,u=i.bonds,c=i.crysin,l=ie.ofConst("A",(s=i.atoms).count,ie.Schema.str),d=new Array(s.count),f=!1,p=0;p<s.count;++p)if(s.atom_type.value(p).includes(".")){f=!0;break}for(m=0;m<s.count;++m)d[m]=f?s.atom_type.value(m).split(".")[0].toUpperCase():$0(s.atom_name.value(m),s.subst_name.value(m));for(h=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:l,auth_atom_id:ie.asArrayColumn(s.atom_name),auth_comp_id:s.subst_name,auth_seq_id:s.subst_id,Cartn_x:ie.asArrayColumn(s.x,Float32Array),Cartn_y:ie.asArrayColumn(s.y,Float32Array),Cartn_z:ie.asArrayColumn(s.z,Float32Array),id:ie.asArrayColumn(s.atom_id),label_asym_id:l,label_atom_id:ie.asArrayColumn(s.atom_name),label_comp_id:s.subst_name,label_seq_id:s.subst_id,label_entity_id:ie.ofConst("1",s.count,ie.Schema.str),occupancy:ie.ofConst(1,s.count,ie.Schema.float),type_symbol:ie.ofStringArray(d),pdbx_PDB_model_num:ie.ofConst(n,s.count,ie.Schema.int)},s.count),(v=new xl).setNames([["MOL",o.mol_name||"Unknown Entity"]]),v.getEntityId("MOL",0,"A"),g=new Cl(s.subst_id,s.atom_name),y=0,S=s.subst_name.rowCount;y<S;++y)g.add(s.subst_name.value(y),y);return[4,Ed(Ic({entity:v.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:h}),EB.create(e),t)];case 2:(_=N.sent()).frameCount>0&&(x=ie.ofIntArray(ie.mapToArray(u.origin_atom_id,function(j){return j-1},Int32Array)),D=ie.ofIntArray(ie.mapToArray(u.target_atom_id,function(j){return j-1},Int32Array)),w=u.bond_id,A=ie.ofIntArray(ie.mapToArray(u.bond_type,function(j){switch(j){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(j)}},Int8Array)),E=ie.ofIntArray(ie.mapToArray(u.bond_type,function(j){switch(j){case"ar":case"am":return 17;case"du":case"nc":return 0;default:return 1}},Int8Array)),I=Do.fromData({pairs:{key:w,indexA:x,indexB:D,order:A,flag:E},count:s.count},{maxDistance:c?-1:1/0}),Do.Provider.set(M=_.representative,I),oy.Provider.set(M,{data:s.charge,type:o.charge_type}),c&&(F=function bGe(e){if(1===e.setting){var t=ns.create(e.spaceGroup,b.create(e.a,e.b,e.c),b.scale(b(),b.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:au.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}}(c),F&&Ja.Provider.set(M,F)),r.push(M)),N.label=3;case 3:return++n,[3,1];case 4:return[2,new rp(r)]}})})}(e,t)})}!function(e){e.is=function t(n){return"mol2"===n?.kind},e.create=function r(n){return{kind:"mol2",name:n.name,data:n}}}(EB||(EB={}));var mu,PB,fy=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),IB=9;function CGe(){throw new Error("(xdrfile error) Undefined error.")}function xGe(e,t){return ue(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j,U,H,z;return ce(this,function(G){switch(G.label){case 0:r=new DataView(t.buffer,t.byteOffset),a=(n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0}).frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],c=[0,0,0],l=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,m=mu.buf,G.label=1;case 1:for(h=void 0,v=r.getInt32(p+4),o.push(r.getFloat32(p+=12)),p+=4,g=new Float32Array(9),F=0;F<9;++F)g[F]=10*r.getFloat32(p),p+=4;if(i.push(g),v<=9)for(h={count:v/3,x:new Float32Array(v/3),y:new Float32Array(v/3),z:new Float32Array(v/3)},F=0;F<v/3;++F)h.x[F]=r.getFloat32(p),h.y[F]=r.getFloat32(p),h.z[F]=r.getFloat32(p),p+=4;else{for(m[0]=m[1]=m[2]=0,u[0]=u[1]=u[2]=0,l[0]=l[1]=l[2]=0,c[0]=c[1]=c[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,h={count:v,x:new Float32Array(v),y:new Float32Array(v),z:new Float32Array(v)},y=0,S=r.getInt32(p),C=r.getFloat32(p+=4),s[0]=r.getInt32(p+=4),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,p+=24,_=void 0,(u[0]|u[1]|u[2])>16777215?(c[0]=mu.sizeOfInt(u[0]),c[1]=mu.sizeOfInt(u[1]),c[2]=mu.sizeOfInt(u[2]),_=0):_=mu.sizeOfInts(3,u),x=r.getInt32(p),p+=4,w=fy[D=IB>(D=x-1)?IB:D]/2|0,A=fy[x]/2|0,l[0]=l[1]=l[2]=fy[x],E=4*Math.ceil(r.getInt32(p)/4),p+=4,I=1/C,M=0,F=0,d[0]=d[1]=d[2]=0;F<S;){if(0===_?(d[0]=mu.decodeBits(t,p,c[0]),d[1]=mu.decodeBits(t,p,c[1]),d[2]=mu.decodeBits(t,p,c[2])):mu.decodeInts(t,p,_,u,d),F++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],N=mu.decodeBits(t,p,1),j=0,1===N&&(M=mu.decodeBits(t,p,5),M-=j=M%3,j--),M>0)for(d[0]=d[1]=d[2]=0,U=0;U<M;U+=3)mu.decodeInts(t,p,x,l,d),F++,d[0]+=f[0]-A,d[1]+=f[1]-A,d[2]+=f[2]-A,0===U?(H=d[0],d[0]=f[0],f[0]=H,H=d[1],d[1]=f[1],f[1]=H,H=d[2],d[2]=f[2],f[2]=H,h.x[y]=f[0]*I,h.y[y]=f[1]*I,h.z[y]=f[2]*I,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),h.x[y]=d[0]*I,h.y[y]=d[1]*I,h.z[y]=d[2]*I,y++;else h.x[y]=d[0]*I,h.y[y]=d[1]*I,h.z[y]=d[2]*I,y++;x+=j,j<0?(A=w,w=x>IB?fy[x-1]/2|0:0):j>0&&(w=A,A=fy[x]/2|0),l[0]=l[1]=l[2]=fy[x],(0===l[0]||0===l[1]||0===l[2])&&CGe()}p+=E}for(z=0;z<v;z++)h.x[z]*=10,h.y[z]*=10,h.z[z]*=10;return a.push(h),e.shouldUpdate?[4,e.update({current:p,max:t.length})]:[3,3];case 2:G.sent(),G.label=3;case 3:return p>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function _Ge(e){var t=this;return Ve.create("Parse XTC",function(r){return ue(t,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,xGe(r,e)];case 1:return n=i.sent(),[2,In.success(n)];case 2:return a=i.sent(),[2,In.error(""+a)];case 3:return[2]}})})})}function wGe(e){var t=this;return Ve.create("Parse XTC",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=cu(e.deltaTime,"step"),a=cu(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],c=b.fromArray(b(),u,0),l=b.fromArray(b(),u,3),d=b.fromArray(b(),u,6),i.push({elementCount:e.frames[o].count,cell:Xf.fromBasis(c,l,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:cu(a.value+n.value*o,n.unit)});return[2,Qh.create(i,n,a)]}})})})}function AGe(e){var t=e.position>=e.data.length-1?0:+lt.readLine(e);isNaN(t)&&(t=0);for(var r=lt.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var c=lt.readLineTrim(e).split(/\s+/g);o[s]=c[0],n[s]=+c[1],a[s]=+c[2],i[s]=+c[3]}return{count:t,comment:r,x:ie.ofFloatArray(n),y:ie.ofFloatArray(a),z:ie.ofFloatArray(i),type_symbol:ie.ofStringArray(o)}}function TGe(e){for(var t=lt(e),r=[];;){var n=AGe(t);if(0===n.count)break;r.push(n)}return In.success({molecules:r})}function DGe(e){var t=this;return Ve.create("Parse Mol",function(){return ue(t,void 0,void 0,function(){return ce(this,function(r){return[2,TGe(e)]})})})}function IGe(e){return Ve.create("Parse XYZ",function(t){return function EGe(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++)n+=(o=i[a]).count;for(var s=new Array(n),u=new Int32Array(n),c=new Float32Array(n),l=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),p=0,m=0;m<r.length;m++)for(var o=r[m],h=0;h<o.count;h++)s[p]=o.type_symbol.value(h),c[p]=o.x.value(h),l[p]=o.y.value(h),d[p]=o.z.value(h),u[p]=h,f[p]=m,p++;var v=ie.ofConst("MOL",n,ie.Schema.str),g=ie.ofConst("A",n,ie.Schema.str),y=ie.ofConst(1,n,ie.Schema.int),S=ie.ofStringArray(s),C=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:g,auth_atom_id:S,auth_comp_id:v,auth_seq_id:y,Cartn_x:ie.ofFloatArray(c),Cartn_y:ie.ofFloatArray(l),Cartn_z:ie.ofFloatArray(d),id:ie.ofIntArray(u),label_asym_id:g,label_atom_id:S,label_comp_id:v,label_seq_id:y,label_entity_id:ie.ofConst("1",n,ie.Schema.str),occupancy:ie.ofConst(1,n,ie.Schema.float),type_symbol:S,pdbx_PDB_model_num:ie.ofIntArray(f)},n),_=new xl;_.setNames([["MOL","Unknown Entity"]]),_.getEntityId("MOL",0,"A");var x=new Cl(y,S);return x.setNames([["MOL","Unknown Molecule"]]),x.add("MOL",0),Ed(Ic({entity:_.getEntityTable(),chem_comp:x.getChemCompTable(),atom_site:C}),PB.create(e),t)}(e,t)})}function op(e){lt.skipWhitespace(e),lt.eatValue(e)}function sp(e,t){var r=e.position;lt.skipWhitespace(e),lt.eatValue(e),lt.trim(e,r,e.position),Xe.addUnchecked(t,e.tokenStart,e.tokenEnd)}!function(e){e.sizeOfInt=function t(l){for(var d=1,f=0;l>=d&&f<32;)f++,d<<=1;return f};var r=new Uint8Array(32);e.sizeOfInts=function n(l,d){var f=1,p=0;r[0]=1;for(var m=0;m<l;m++){var h=void 0,v=0;for(h=0;h<f;h++)r[h]=255&(v+=r[h]*d[m]),v>>=8;for(;0!==v;)r[h++]=255&v,v>>=8;f=h}var g=1;for(f--;r[f]>=g;)p++,g*=2;return p+8*f};var a=new ArrayBuffer(24);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(l,d,f){for(var p=f,m=(1<<p)-1,h=i[1],v=i[2],g=e.buf[0],y=0;p>=8;)y|=(v=v<<8|l[d+g++])>>h<<p-8,p-=8;return p>0&&(h<p&&(h+=8,v=v<<8|l[d+g++]),y|=v>>(h-=p)&(1<<p)-1),y&=m,e.buf[0]=g,e.buf[1]=h,e.buf[2]=v,y}function s(l,d){var f=i[2],p=e.buf[0];return f=f<<8|l[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>i[1]&255}e.decodeBits=o;var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];e.decodeInts=function c(l,d,f,p,m){var h=f,v=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;h>8;)u[v++]=s(l,d),h-=8;h>0&&(u[v++]=o(l,d,h));for(var g=2;g>0;g--){for(var y=0,S=p[g],C=v-1;C>=0;C--){var _=(y=y<<8|u[C])/S|0;u[C]=_,y-=_*S}m[g]=y}m[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}}(mu||(mu={})),function(e){e.is=function t(n){return"xyz"===n?.kind},e.create=function r(n){return{kind:"xyz",name:"xyz",data:n}}}(PB||(PB={}));var RB,MB="$$$$";function NGe(e){var t=lt.readLine(e).trim(),r=lt.readLine(e).trim(),n=lt.readLine(e).trim(),a=lt.readLine(e),i=function PGe(e){return e.trim().endsWith("V3000")}(a),o=i?function MGe(e){var t=Xe.create(e.data,1),r=Xe.create(e.data,1);return lt.eatLine(e),op(e),op(e),op(e),sp(e,t),sp(e,r),lt.eatLine(e),{atomCount:er(t)(ie.Schema.int).value(0),bondCount:er(r)(ie.Schema.int).value(0)}}(e):function BGe(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}(a),s=o.atomCount,u=o.bondCount;if(!Number.isNaN(s)&&!Number.isNaN(u)){var l={atomIdx:ie.ofConst(0,s,ie.Schema.int),charge:ie.ofConst(0,s,ie.Schema.int)},d=i?function RGe(e,t){for(var r=Xe.create(e.data,2*t),n=Xe.create(e.data,2*t),a=Xe.create(e.data,2*t),i=Xe.create(e.data,2*t),o=0;o<t;++o){lt.markLine(e),op(e),op(e),op(e);var s=e.position;sp(e,i),sp(e,r),sp(e,n),sp(e,a),e.position=s}return lt.eatLine(e),lt.eatLine(e),{count:t,x:er(r)(ie.Schema.float),y:er(n)(ie.Schema.float),z:er(a)(ie.Schema.float),type_symbol:er(i)(ie.Schema.str),formal_charge:ie.ofConst(0,t,ie.Schema.int)}}(e,s):R$(e,s),f=i?function OGe(e,t){for(var r=Xe.create(e.data,2*t),n=Xe.create(e.data,2*t),a=Xe.create(e.data,2*t),i=0;i<t;++i){lt.markLine(e),op(e),op(e),op(e);var o=e.position;sp(e,a),sp(e,r),sp(e,n),e.position=o}return lt.eatLine(e),lt.eatLine(e),{count:t,atomIdxA:er(r)(ie.Schema.float),atomIdxB:er(n)(ie.Schema.float),order:er(a)(ie.Schema.float)}}(e,u):O$(e,u),p=i?l:F$(e),m=function FGe(e){for(var t=Xe.create(e.data,32),r=Xe.create(e.data,32);e.position<e.length;){var n=lt.readLine(e);if(n.startsWith(MB))break;if(n&&n.startsWith("> ")){Xe.add(t,e.tokenStart+2,e.tokenEnd),lt.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=lt.readLine(e);if(!s||s.startsWith(MB)||s.startsWith("> ")){Xe.add(r,a,i),o=!0;break}i=e.tokenEnd}o||Xe.add(r,a,i)}}return{dataHeader:er(t)(ie.Schema.str),data:er(r)(ie.Schema.str)}}(e);return{molFile:{title:t,program:r,comment:n,atoms:d,bonds:f,formalCharges:p},dataItems:m}}for(;e.position<e.length&&!lt.readLine(e).startsWith(MB););}function kGe(e){for(var t=lt(e),r=[];t.position<t.length;){var n=NGe(t);n&&r.push(n)}return In.success({compounds:r})}function LGe(e){var t=this;return Ve.create("Parse Sdf",function(){return ue(t,void 0,void 0,function(){return ce(this,function(r){return[2,kGe(e)]})})})}function UGe(e){return Ve.create("Parse SDF",function(t){return B$(e.molFile,RB.create(e),t)})}function VGe(e){return ue(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w;return ce(this,function(A){for(t=new DataView(e.buffer),n=(r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0}).frames,a=r.boxes,i=r.times,o=0;;){if(s=t.getInt32(o+=8),o+=4,u=t.getInt32((o+=s)+8),c=t.getInt32(o+12),l=t.getInt32(o+16),d=t.getInt32(o+28),f=t.getInt32(o+32),p=t.getInt32(o+36),m=t.getInt32(o+40),o+=52,v=3*m,i.push(8==(h=u/9)?t.getFloat64(o):t.getFloat32(o)),o+=2*h,u){if(g=new Float32Array(9),8===h)for(w=0;w<9;++w)g[w]=10*t.getFloat64(o),o+=8;else for(w=0;w<9;++w)g[w]=10*t.getFloat32(o),o+=4;a.push(g)}if(o+=c,o+=l,d){if(y=new Float32Array(m),S=new Float32Array(m),C=new Float32Array(m),8===h)for(w=0;w<m;++w)y[w]=10*t.getFloat64(o),S[w]=10*t.getFloat64(o+8),C[w]=10*t.getFloat64(o+16),o+=24;else{for(_=new Uint32Array(e.buffer,o,v),w=0;w<v;++w)_[w]=(255&(x=_[w]))<<24|(65280&x)<<8|x>>8&65280|x>>24&255;for(D=new Float32Array(e.buffer,o,v),w=0;w<m;++w)y[w]=10*D[3*w],S[w]=10*D[3*w+1],C[w]=10*D[3*w+2],o+=12}n.push({count:m,x:y,y:S,z:C})}if(o+=f,(o+=p)>=e.byteLength)break}return i.length>=1&&(r.timeOffset=i[0]),i.length>=2&&(r.deltaTime=i[1]-i[0]),[2,r]})})}function GGe(e){var t=this;return Ve.create("Parse TRR",function(r){return ue(t,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,VGe(e)];case 1:return n=i.sent(),[2,In.success(n)];case 2:return a=i.sent(),[2,In.error(""+a)];case 3:return[2]}})})})}function zGe(e){var t=this;return Ve.create("Parse TRR",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=cu(e.deltaTime,"step"),a=cu(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],c=b.fromArray(b(),u,0),l=b.fromArray(b(),u,3),d=b.fromArray(b(),u,6),i.push({elementCount:e.frames[o].count,cell:Xf.fromBasis(c,l,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:cu(a.value+n.value*o,n.unit)});return[2,Qh.create(i,n,a)]}})})})}!function(e){e.is=function t(n){return"sdf"===n?.kind},e.create=function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}}(RB||(RB={}));var OB=[],jGe=function(){function e(t,r){void 0===r&&(r={}),this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;var n=!1;void 0===t&&(t=8192),"number"==typeof t?t=new ArrayBuffer(t):n=!0;var a=r.offset?r.offset>>>0:0,i=t.byteLength-a,o=a;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+a),t=t.buffer),this._lastWrittenByte=n?i:0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=o,this._data=new DataView(this.buffer,o,i)}return e.prototype.available=function(t){return void 0===t&&(t=1),this.offset+t<=this.length},e.prototype.isLittleEndian=function(){return this.littleEndian},e.prototype.setLittleEndian=function(){return this.littleEndian=!0,this},e.prototype.isBigEndian=function(){return!this.littleEndian},e.prototype.setBigEndian=function(){return this.littleEndian=!1,this},e.prototype.skip=function(t){return void 0===t&&(t=1),this.offset+=t,this},e.prototype.seek=function(t){return this.offset=t,this},e.prototype.mark=function(){return this._mark=this.offset,this},e.prototype.reset=function(){return this.offset=this._mark,this},e.prototype.pushMark=function(){return this._marks.push(this.offset),this},e.prototype.popMark=function(){var t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this},e.prototype.rewind=function(){return this.offset=0,this},e.prototype.ensureAvailable=function(t){if(void 0===t&&(t=1),!this.available(t)){var n=2*(this.offset+t),a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this},e.prototype.readBoolean=function(){return 0!==this.readUint8()},e.prototype.readInt8=function(){return this._data.getInt8(this.offset++)},e.prototype.readUint8=function(){return this._data.getUint8(this.offset++)},e.prototype.readByte=function(){return this.readUint8()},e.prototype.readBytes=function(t){void 0===t&&(t=1);for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=this.readByte();return r},e.prototype.readInt16=function(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},e.prototype.readUint16=function(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},e.prototype.readInt32=function(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.readUint32=function(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.readFloat32=function(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.readFloat64=function(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},e.prototype.readChar=function(){return String.fromCharCode(this.readInt8())},e.prototype.readChars=function(t){void 0===t&&(t=1),OB.length=t;for(var r=0;r<t;r++)OB[r]=this.readChar();return OB.join("")},e.prototype.writeBoolean=function(t){return void 0===t&&(t=!1),this.writeUint8(t?255:0),this},e.prototype.writeInt8=function(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this},e.prototype.writeUint8=function(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this},e.prototype.writeByte=function(t){return this.writeUint8(t)},e.prototype.writeBytes=function(t){this.ensureAvailable(t.length);for(var r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this},e.prototype.writeInt16=function(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},e.prototype.writeUint16=function(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},e.prototype.writeInt32=function(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},e.prototype.writeUint32=function(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},e.prototype.writeFloat32=function(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},e.prototype.writeFloat64=function(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this},e.prototype.writeChar=function(t){return this.writeUint8(t.charCodeAt(0))},e.prototype.writeChars=function(t){for(var r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this},e.prototype.toArray=function(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)},e.prototype._updateLastWrittenByte=function(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)},e}();function Vc(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function U$(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function FB(e){var t=e.readUint32(),r=e.readChars(t);return U$(e),r}var ti={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function V$(e){switch(Number(e)){case ti.BYTE:return"byte";case ti.CHAR:return"char";case ti.SHORT:return"short";case ti.INT:return"int";case ti.FLOAT:return"float";case ti.DOUBLE:return"double";default:return"undefined"}}function G$(e){switch(Number(e)){case ti.BYTE:case ti.CHAR:return 1;case ti.SHORT:return 2;case ti.INT:case ti.FLOAT:return 4;case ti.DOUBLE:return 8;default:return-1}}function z$(e){switch(String(e)){case"byte":return ti.BYTE;case"char":return ti.CHAR;case"short":return ti.SHORT;case"int":return ti.INT;case"float":return ti.FLOAT;case"double":return ti.DOUBLE;default:return-1}}function lT(e,t){if(1!==e){for(var r=new Array(e),n=0;n<e;n++)r[n]=t();return r}return t()}function BB(e,t,r){switch(t){case ti.BYTE:return e.readBytes(r);case ti.CHAR:return function qGe(e){return 0===e.charCodeAt(e.length-1)?e.substring(0,e.length-1):e}(e.readChars(r));case ti.SHORT:return lT(r,e.readInt16.bind(e));case ti.INT:return lT(r,e.readInt32.bind(e));case ti.FLOAT:return lT(r,e.readFloat32.bind(e));case ti.DOUBLE:return lT(r,e.readFloat64.bind(e));default:return void Vc(!0,"non valid type "+t)}}var py=0,ZGe=12;function H$(e){var t,r=e.readUint32();if(r===py)return Vc(e.readUint32()!==py,"wrong empty tag for list of attributes"),[];Vc(r!==ZGe,"wrong tag for list of attributes");var n=e.readUint32();t=new Array(n);for(var a=0;a<n;a++){var i=FB(e),o=e.readUint32();Vc(o<1||o>6,"non valid type "+o);var s=e.readUint32(),u=BB(e,o,s);U$(e),t[a]={name:i,type:V$(o),value:u}}return t}var NB,kB,eze=function(){function e(t){var r=new jGe(t);r.setBigEndian(),Vc("CDF"!==r.readChars(3),"should start with CDF");var n=r.readByte();Vc(n>2,"unknown version"),this.header=function QGe(e,t){var r={recordDimension:{length:e.readUint32()}};r.version=t;var n=function $Ge(e){var t,r,n,a=e.readUint32();if(a===py)return Vc(e.readUint32()!==py,"wrong empty tag for list of dimensions"),[];Vc(10!==a,"wrong tag for list of dimensions");var i=e.readUint32();t=new Array(i);for(var o=0;o<i;o++){var s=FB(e),u=e.readUint32();0===u&&(r=o,n=s),t[o]={name:s,size:u}}return{dimensions:t,recordId:r,recordName:n}}(e);r.recordDimension.id=n.recordId,r.recordDimension.name=n.recordName,r.dimensions=n.dimensions,r.globalAttributes=H$(e);var a=function JGe(e,t,r){var i,n=e.readUint32(),a=0;if(n===py)return Vc(e.readUint32()!==py,"wrong empty tag for list of variables"),[];Vc(11!==n,"wrong tag for list of variables");var o=e.readUint32();i=new Array(o);for(var s=0;s<o;s++){for(var u=FB(e),c=e.readUint32(),l=new Array(c),d=0;d<c;d++)l[d]=e.readUint32();var f=H$(e),p=e.readUint32();Vc(p<1&&p>6,"non valid type "+p);var m=e.readUint32(),h=e.readUint32();2===r&&(Vc(h>0,"offsets larger than 4GB not supported"),h=e.readUint32()),l[0]===t&&(a+=m),i[s]={name:u,dimensions:l,attributes:f,type:V$(p),size:m,offset:h,record:l[0]===t}}return{variables:i,recordStep:a}}(e,n.recordId,t);return r.variables=a.variables,r.recordDimension.recordStep=a.recordStep,r}(r,n),this.buffer=r}return Object.defineProperty(e.prototype,"version",{get:function(){return 1===this.header.version?"classic format":"64-bit offset format"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"recordDimension",{get:function(){return this.header.recordDimension},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dimensions",{get:function(){return this.header.dimensions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalAttributes",{get:function(){return this.header.globalAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"variables",{get:function(){return this.header.variables},enumerable:!1,configurable:!0}),e.prototype.hasDataVariable=function(t){return this.header.variables&&-1!==this.header.variables.findIndex(function(r){return r.name===t})},e.prototype.getDataVariable=function(t){var r,n;if(void 0===(n="string"==typeof t?null===(r=this.header.variables)||void 0===r?void 0:r.find(function(a){return a.name===t}):t))throw new Error("variable not found");return this.buffer.seek(n.offset),n.record?function YGe(e,t,r){for(var n=z$(t.type),a=t.size?t.size/G$(n):1,i=r.length,o=new Array(i),s=r.recordStep,u=0;u<i;u++){var c=e.offset;o[u]=BB(e,n,a),e.seek(c+s)}return o}(this.buffer,n,this.header.recordDimension):function WGe(e,t){for(var r=z$(t.type),n=t.size/G$(r),a=new Array(n),i=0;i<n;i++)a[i]=BB(e,r,1);return a}(this.buffer,n)},e}();function tze(e){return ue(this,void 0,void 0,function(){var t,r,n,a,o,s,u,l,d,f,m,h,v,y,S,C,x,D,w;return ce(this,function(E){for(t=new eze(e),r={coordinates:[],time:[],timeOffset:0,deltaTime:1},n=0,a=t.getDataVariable("coordinates");n<a.length;n++)r.coordinates.push(a[n]);if(t.hasDataVariable("velocities")){for(o=[],s=0,u=t.getDataVariable("velocities");s<u.length;s++)o.push(u[s]);r.velocities=o}if(t.hasDataVariable("forces")){for(l=[],d=0,f=t.getDataVariable("forces");d<f.length;d++)l.push(f[d]);r.forces=l}if(t.hasDataVariable("cell_lengths")){for(m=[],h=0,v=t.getDataVariable("cell_lengths");h<v.length;h++)m.push(v[h]);r.cell_lengths=m}if(t.hasDataVariable("cell_angles")){for(y=[],S=0,C=t.getDataVariable("cell_angles");S<C.length;S++)y.push(C[S]);r.cell_angles=y}if(t.hasDataVariable("time")){for(x=[],D=0,w=t.getDataVariable("time");D<w.length;D++)x.push(w[D]);r.time=x}return r.time&&(r.time.length>=1&&(r.timeOffset=r.time[0]),r.time.length>=2&&(r.deltaTime=r.time[1]-r.time[0])),[2,r]})})}function rze(e){var t=this;return Ve.create("Parse NCTRAJ",function(r){return ue(t,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,tze(e)];case 1:return n=i.sent(),[2,In.success(n)];case 2:return a=i.sent(),[2,In.error(""+a)];case 3:return[2]}})})})}function nze(e){var t=this;return Ve.create("Parse NCTRAJ",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S;return ce(this,function(C){switch(C.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(C.sent(),n=cu(e.deltaTime,"step"),a=cu(e.timeOffset,n.unit),i=[],o=0,s=e.coordinates.length;o<s;++o){for(c=(u=e.coordinates[o]).length/3,l=new Float32Array(c),d=new Float32Array(c),f=new Float32Array(c),p=0,m=u.length;p<m;p+=3)l[p/3]=u[p],d[p/3]=u[p+1],f[p/3]=u[p+2];h={elementCount:c,x:l,y:d,z:f,xyzOrdering:{isIdentity:!0},time:cu(a.value+n.value*o,n.unit)},e.cell_lengths&&(v=e.cell_lengths[o],g=b.scale(b(),b.unitX,v[0]),y=b.scale(b(),b.unitY,v[1]),S=b.scale(b(),b.unitZ,v[2]),h.cell=Xf.fromBasis(g,y,S)),i.push(h)}return[2,Qh.create(i,n,a)]}})})})}function ize(e){var t=this;return Ve.create("Parse PRMTOP",function(r){return ue(t,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return ce(this,function(f){return n=NB.fromPrmtop(e),a=function aze(e){for(var t=e.pointers,r=e.residuePointer,n=e.residueLabel,a=e.atomName,i=t.NATOM,o=t.NRES,s=new Uint32Array(i),u=[],c=function(z,G,J){for(var X=n.value(z),Z=G,ne=J;Z<ne;++Z)s[Z]=z+1,u[Z]=X},l=0,d=o-1;l<d;++l)c(l,r.value(l)-1,r.value(l+1)-1);c(o-1,r.value(o-1)-1,i);var f=ie.ofIntArray(s),p=ie.ofStringArray(u),m=new Array(i),h=new Array(i),v=new Uint32Array(i),g=new Uint32Array(i),y=new xl,S=new Cl(f,a),C="",_=0,x="",D=0,w=0,A=-1;for(l=0,d=i;l<d;++l){var E=f.value(l);if(E!==A){var I=p.value(l),M=pm(S.add(I,l).type,I);M!==w&&(x=XS(_),_+=1,D=0),C=y.getEntityId(I,M,x),D+=1,A=E,w=M}m[l]=C,h[l]=x,v[l]=D,g[l]=l}var F=ie.ofIntArray(g),N=ie.ofStringArray(h),j=new Array(i);for(l=0;l<i;++l)j[l]=$0(a.value(l),p.value(l));var U=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:N,auth_atom_id:ie.asArrayColumn(a),auth_comp_id:p,auth_seq_id:f,id:ie.asArrayColumn(F),label_asym_id:N,label_atom_id:ie.asArrayColumn(a),label_comp_id:p,label_seq_id:ie.ofIntArray(v),label_entity_id:ie.ofStringArray(m),occupancy:ie.ofConst(1,i,ie.Schema.float),type_symbol:ie.ofStringArray(j),pdbx_PDB_model_num:ie.ofConst(1,i,ie.Schema.int)},i);return Ic({entity:y.getEntityTable(),chem_comp:S.getChemCompTable(),atom_site:U})}(e),u=e.bondsIncHydrogen,c=e.bondsWithoutHydrogen,d={indexA:ie.ofLambda({value:function(p){return p<o?u.value(3*p)/3:c.value(3*(p-o))/3},rowCount:l=(o=(i=e.pointers).NBONH)+i.NBONA,schema:ie.Schema.int}),indexB:ie.ofLambda({value:function(p){return p<o?u.value(3*p+1)/3:c.value(3*(p-o)+1)/3},rowCount:l,schema:ie.Schema.int}),order:ie.ofConst(1,l,ie.Schema.int)},[2,ZS.create(e.title.join(" ")||"PRMTOP",a,d,n)]})})})}function uze(e){var t=this;return Ve.create("Parse TOP",function(r){return ue(t,void 0,void 0,function(){var n,a,i;return ce(this,function(o){return n=kB.fromTop(e),a=function oze(e){for(var t=e.molecules,r=e.compounds,n={},a=0,i=0,o=t._rowCount;i<o;++i){var s=t.compound.value(i),u=t.molCount.value(i);ie.asArrayColumn((c=r[s].atoms).atom),ie.asArrayColumn(c.resnr),ie.asArrayColumn(c.residu),a+=u*c._rowCount;var l=c.resnr.value(0);n[s]=!0;for(var d=1,f=c._rowCount;d<f;++d){var p=c.resnr.value(d);if(p!==l){n[s]=!1;break}l=p}}var m=new Array(a),h=new Uint32Array(a),v=new Array(a),g=0;for(i=0,o=t._rowCount;i<o;++i){s=t.compound.value(i),u=t.molCount.value(i);var c=r[s].atoms,y=n[s];for(d=0;d<u;++d)for(var S=0,C=c._rowCount;S<C;++S)m[g]=c.atom.value(S),h[g]=c.resnr.value(S),v[g]=c.residu.value(S),y&&(h[g]+=d),g+=1}var _=ie.ofStringArray(m),x=ie.ofIntArray(h),D=ie.ofStringArray(v),w=new Array(a),A=new Array(a),E=new Uint32Array(a),I=new Uint32Array(a),M=new xl,F=new Cl(x,_),N="",j=0,U="",H=0,z=0,G=-1;for(i=0,o=a;i<o;++i){var J=x.value(i);if(J!==G){var X=D.value(i),Z=pm(F.add(X,i).type,X);Z!==z&&(U=XS(j),j+=1,H=0),N=M.getEntityId(X,Z,U),H+=1,G=J,z=Z}w[i]=N,A[i]=U,E[i]=H,I[i]=i}var ne=ie.ofIntArray(I),Y=ie.ofStringArray(A),k=new Array(a);for(i=0;i<a;++i)k[i]=$0(_.value(i),D.value(i));var W=Xr.ofPartialColumns(To.atom_site,{auth_asym_id:Y,auth_atom_id:ie.asArrayColumn(_),auth_comp_id:D,auth_seq_id:x,id:ie.asArrayColumn(ne),label_asym_id:Y,label_atom_id:ie.asArrayColumn(_),label_comp_id:D,label_seq_id:ie.ofIntArray(E),label_entity_id:ie.ofStringArray(w),occupancy:ie.ofConst(1,a,ie.Schema.float),type_symbol:ie.ofStringArray(k),pdbx_PDB_model_num:ie.ofConst(1,a,ie.Schema.int)},a);return Ic({entity:M.getEntityTable(),chem_comp:F.getChemCompTable(),atom_site:W})}(e),i=function sze(e){for(var t=e.molecules,r=e.compounds,n=[],a=[],i=0,o=0,s=t._rowCount;o<s;++o){var u=t.compound.value(o),c=t.molCount.value(o),l=r[u],d=l.atoms,f=l.bonds;if(f)for(var p=0;p<c;++p){for(var m=0,h=f._rowCount;m<h;++m)n.push(f.ai.value(m)-1+i),a.push(f.aj.value(m)-1+i);i+=d._rowCount}else if("TIP3"===u)for(p=0;p<c;++p)n.push(0+i),a.push(1+i),n.push(0+i),a.push(2+i),i+=d._rowCount;else i+=c*d._rowCount}return{indexA:ie.ofIntArray(n),indexB:ie.ofIntArray(a),order:ie.ofConst(1,n.length,ie.Schema.int)}}(e),[2,ZS.create(e.system||"TOP",a,i,n)]})})})}!function(e){e.is=function t(n){return"prmtop"===n?.kind},e.fromPrmtop=function r(n){return{kind:"prmtop",name:n.title.join(" ")||"PRMTOP",data:n}}}(NB||(NB={})),function(e){e.is=function t(n){return"top"===n?.kind},e.fromTop=function r(n){return{kind:"top",name:n.system||"TOP",data:n}}}(kB||(kB={}));var cze=Bt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DCD",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,tIe(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,eBe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),lze=Bt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse XTC",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,_Ge(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,wGe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),dze=Bt.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse TRR",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,GGe(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,zGe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),fze=Bt.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[ve.Data.Binary],to:ve.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse NCTRAJ",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,rze(r.data).runInContext(n)];case 1:if((a=o.sent()).isError)throw new Error(a.message);return[4,nze(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ve.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),pze=Bt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[ve.Format.Psf],to:ve.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Ve.create("Create Topology",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,r8e(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ve.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}}),mze=Bt.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[ve.Format.Prmtop],to:ve.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Ve.create("Create Topology",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,ize(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ve.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}}),hze=Bt.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[ve.Format.Top],to:ve.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Ve.create("Create Topology",function(n){return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,uze(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ve.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function vze(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(i){switch(i.label){case 0:return t.type!==ve.Molecule.Topology.type?[3,2]:[4,ar.trajectoryFromTopologyAndCoordinates(t.data,r).runInContext(e)];case 1:return[2,i.sent()];case 2:if(t.type===ve.Molecule.Model.type)return[2,ar.trajectoryFromModelAndCoordinates(t.data,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var LB=Bt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ve.Root,to:ve.Molecule.Trajectory,params:{modelRef:T.Text("",{isHidden:!0}),coordinatesRef:T.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return Ve.create("Create trajectory from model/topology and coordinates",function(a){return ue(t,void 0,void 0,function(){var o,s;return ce(this,function(u){switch(u.label){case 0:return[4,vze(a,n[r.modelRef],n[r.coordinatesRef].data)];case 1:return o=u.sent(),s={label:"Trajectory",description:"".concat(o.frameCount," model").concat(1===o.frameCount?"":"s")},[2,new ve.Molecule.Trajectory(o,s)]}})})})}}),gze=Bt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ve.Format.Blob,to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse Format Blob",function(n){return ue(t,void 0,void 0,function(){var a,i,o,s,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:a=[],i=0,o=r.data,p.label=1;case 1:return i<o.length?"cif"!==(s=o[i]).kind?[3,6]:[4,rB(s.data.blocks[0]).runInContext(n)]:[3,7];case 2:if(0===(c=p.sent()).frameCount)throw new Error("No models found.");d=0,p.label=3;case 3:return d<c.frameCount?[4,Ve.resolveInContext(c.getFrameAtIndex(d),n)]:[3,6];case 4:l=p.sent(),a.push(l),p.label=5;case 5:return d++,[3,3];case 6:return i++,[3,1];case 7:for(d=0;d<a.length;d++)ar.TrajectoryInfo.set(a[d],{index:d,size:a.length});return f={label:"Trajectory",description:"".concat(a.length," model").concat(1===a.length?"":"s")},[2,new ve.Molecule.Trajectory(new rp(a),f)]}})})})}});function up(e){return{label:"".concat(e.representative.entry),description:"".concat(e.frameCount," model").concat(1===e.frameCount?"":"s")}}var yze=Bt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ve.Format.Cif,to:ve.Molecule.Trajectory,params:function(e){if(!e)return{loadAllBlocks:T.Optional(T.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:T.Optional(T.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:function(n){return!0===n.loadAllBlocks}})),blockIndex:T.Optional(T.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:function(n){return!0===n.loadAllBlocks||n.blockHeader}}))};var t=e.data.blocks,r=t.map(function(n){return[n.header,n.header]});return r.push(["","[Use Block Index]"]),{loadAllBlocks:T.Optional(T.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:T.Optional(T.Select(t[0]&&t[0].header,r,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:function(n){return!0===n.loadAllBlocks}})),blockIndex:T.Optional(T.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:function(n){return!0===n.loadAllBlocks||n.blockHeader}}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse mmCIF",function(a){return ue(t,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,v,g,y;return ce(this,function(S){switch(S.label){case 0:if(!n.loadAllBlocks)return[3,10];o=[],s=0,u=r.data.blocks,S.label=1;case 1:return s<u.length?(m=u[s],a.shouldUpdate?[4,a.update("Parsing ".concat(m.header,"..."))]:[3,3]):[3,9];case 2:S.sent(),S.label=3;case 3:return[4,rB(m).runInContext(a)];case 4:c=S.sent(),l=0,S.label=5;case 5:return l<c.frameCount?(f=(d=o).push,[4,Ve.resolveInContext(c.getFrameAtIndex(l),a)]):[3,8];case 6:f.apply(d,[S.sent()]),S.label=7;case 7:return l++,[3,5];case 8:return s++,[3,1];case 9:return i=new rp(o),[3,15];case 10:if(p=n.blockHeader||r.data.blocks[null!==(y=n.blockIndex)&&void 0!==y?y:0].header,!(m=r.data.blocks.find(function(C){return C.header===p})))throw new Error("Data block '".concat([p],"' not found."));return!m.categoryNames.includes("chem_comp_atom")||m.categoryNames.includes("atom_site")||m.categoryNames.includes("ihm_sphere_obj_site")||m.categoryNames.includes("ihm_gaussian_obj_site")?[3,12]:[4,t6e(m).runInContext(a)];case 11:return v=S.sent(),[3,14];case 12:return[4,rB(m,r.data).runInContext(a)];case 13:v=S.sent(),S.label=14;case 14:i=v,S.label=15;case 15:if(0===i.frameCount)throw new Error("No models found.");return g=up(i),[2,new ve.Molecule.Trajectory(i,g)]}})})})}}),bze=Bt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory,params:{isPdbqt:T.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse PDB",function(a){return ue(t,void 0,void 0,function(){var i,o,s;return ce(this,function(u){switch(u.label){case 0:return[4,fIe(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if((i=u.sent()).isError)throw new Error(i.message);return[4,e8e(i.result).runInContext(a)];case 2:return o=u.sent(),s=up(o),[2,new ve.Molecule.Trajectory(o,s)]}})})})}}),Sze=Bt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse GRO",function(n){return ue(t,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return[4,dIe(r.data).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,B6e(a.result).runInContext(n)];case 2:return i=s.sent(),o=up(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),Cze=Bt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse XYZ",function(n){return ue(t,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return[4,DGe(r.data).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,IGe(a.result).runInContext(n)];case 2:return i=s.sent(),o=up(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),xze=Bt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse MOL",function(n){return ue(t,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return[4,eGe(r.data).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,tGe(a.result).runInContext(n)];case 2:return i=s.sent(),o=up(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),_ze=Bt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse SDF",function(n){return ue(t,void 0,void 0,function(){var a,i,o,s,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return[4,LGe(r.data).runInContext(n)];case 1:if((a=h.sent()).isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,h.label=2;case 2:return o<s.length?[4,UGe(s[o]).runInContext(n)]:[3,8];case 3:c=h.sent(),l=0,h.label=4;case 4:return l<c.frameCount?(f=(d=i).push,[4,Ve.resolveInContext(c.getFrameAtIndex(l),n)]):[3,7];case 5:f.apply(d,[h.sent()]),h.label=6;case 6:return l++,[3,4];case 7:return o++,[3,2];case 8:return p=new rp(i),m=up(p),[2,new ve.Molecule.Trajectory(p,m)]}})})})}}),wze=Bt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ve.Data.String],to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse MOL2",function(n){return ue(t,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return[4,gGe(r.data,r.label).runInContext(n)];case 1:if((a=s.sent()).isError)throw new Error(a.message);return[4,SGe(a.result).runInContext(n)];case 2:return i=s.sent(),o=up(i),[2,new ve.Molecule.Trajectory(i,o)]}})})})}}),Aze=Bt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ve.Format.Cube,to:ve.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse MOL",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,cGe(r.data).runInContext(n)];case 1:return a=o.sent(),i=up(a),[2,new ve.Molecule.Trajectory(a,i)]}})})})}}),Tze=Bt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ve.Format.Cif,to:ve.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:T.Optional(T.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:T.Optional(T.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse CIF Core",function(a){return ue(t,void 0,void 0,function(){var i,o,s,u;return ce(this,function(c){switch(c.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,!(o=r.data.blocks.find(function(l){return l.header===i})))throw new Error("Data block '".concat([i],"' not found."));return[4,sGe(o).runInContext(a)];case 1:if(0===(s=c.sent()).frameCount)throw new Error("No models found.");return u=up(s),[2,new ve.Molecule.Trajectory(s,u)]}})})})}}),Dze=function(e){return e+1},Eze=function(e){return e-1},j$=Bt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ve.Molecule.Trajectory,to:ve.Molecule.Model,params:function(e){return e?{modelIndex:T.Converted(Dze,Eze,T.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:T.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Model from Trajectory",function(a){return ue(t,void 0,void 0,function(){var i,o,s,u;return ce(this,function(c){switch(c.label){case 0:return(i=n.modelIndex%r.data.frameCount)<0&&(i+=r.data.frameCount),[4,Ve.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=c.sent(),s="Model ".concat(i+1),u=1===r.data.frameCount?void 0:"of ".concat(r.data.frameCount),[2,new ve.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){return{modelIndex:r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r)}},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Ize=Bt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ve.Molecule.Trajectory,to:ve.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return Ve.create("Build Structure",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,Ze.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:Ze.elementDescription(a)},[2,new ve.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Pze=Bt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ve.Molecule.Model,to:ve.Molecule.Structure,params:function(e){return dv.getParams(e&&e.data)}})({canAutoUpdate:function(e){return dv.canAutoUpdate(e.oldParams.type,e.newParams.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Build Structure",function(i){return ue(r,void 0,void 0,function(){return ce(this,function(o){return[2,dv.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b;return rd(e.oldParams,e.newParams)?r.data.model===t.data?rt.UpdateResult.Unchanged:ar.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),rt.UpdateResult.Updated):rt.UpdateResult.Recreate:rt.UpdateResult.Recreate},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),q$=b(),W$=he(),Y$=he(),Mze=Bt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:{transform:T.MappedStatic("components",{components:T.Group({axis:T.Vec3(b.create(1,0,0)),angle:T.Numeric(0,{min:-180,max:180,step:.1}),translation:T.Vec3(b.create(0,0,0))},{isFlat:!0}),matrix:T.Group({data:T.Mat4(he.identity()),transpose:T.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){return"matrix"!==e.newParams.transform.name},apply:function(e){var t=e.a,r=e.params,n=he();if("components"===r.transform.name){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;he.fromTranslation(W$,b.negate(q$,u)),he.fromTranslation(Y$,b.add(q$,u,s));var c=he.fromRotation(he(),Math.PI/180*o,b.normalize(b(),i));he.mul3(n,Y$,c,W$)}else"matrix"===r.transform.name&&(he.copy(n,r.transform.params.data),r.transform.params.transpose&&he.transpose(n,n));var l=Ze.transform(t.data,n);return new ve.Molecule.Structure(l,{label:t.label,description:"".concat(t.description," [Transformed]")})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Rze=Bt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{expression:T.Value(fe.struct.generator.all,{isHidden:!0}),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){var r=e.params,n=e.cache,a=cs.createAndRun(e.a.data,r.expression),i=a.selection;if(n.entry=a.entry,ht.isEmpty(i))return Jn.Null;var s=ht.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:Ze.elementDescription(s)};return new ve.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,a=e.newParams;if(e.oldParams.expression!==a.expression)return rt.UpdateResult.Recreate;var o=e.cache.entry;if(o.currentStructure===t.data)return rt.UpdateResult.Unchanged;var s=cs.updateStructure(o,t.data);return ht.isEmpty(s)?rt.UpdateResult.Null:(cs.updateStructureObject(r,s,a.label),rt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Oze=Bt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ve.Root,to:ve.Molecule.Structure.Selections,params:function(){return{selections:T.ObjectList({key:T.Text(void 0,{description:"A unique key."}),ref:T.Text(),groupId:T.Optional(T.Text()),expression:T.Value(fe.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:T.Optional(T.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var c=u[s],l=cs.createAndRun(n[c.ref].data,c.expression),d=l.selection;a.set(c.key,l.entry);var p=ht.toLociWithSourceUnits(d);i.push({key:c.key,loci:p,groupId:c.groupId}),o+=Re.size(p)}r.entries=a;var m={label:"".concat(t.label||"Multi-selection"),description:"".concat(t.selections.length," source(s), ").concat(o," element(s) total")};return new ve.Molecule.Structure.Selections(i,m)},update:function(e){var t=e.b,n=e.newParams,a=e.cache,i=e.dependencies;if(!!e.oldParams.isTransitive!=!!n.isTransitive)return rt.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,c=0,l=t.data;c<l.length;c++){var d=l[c];u.set(d.key,d)}for(var f=!1,p=0,m=[],h=0,v=n.selections;h<v.length;h++){var g=v[h],y=i[g.ref].data,S=!1;if(o.has(g.key)){var C=o.get(g.key);if(cs.isUnchanged(C,g.expression,y)&&u.has(g.key)){(_=u.get(g.key)).groupId!==g.groupId&&(_.groupId=g.groupId,f=!0),s.set(g.key,C),m.push(_),p+=Re.size(_.loci);continue}if(C.expression!==g.expression)S=!0;else{var x=!1;if(n.isTransitive)if(Ze.areUnitIdsAndIndicesEqual(C.originalStructure,y)){var D=cs.run(C,C.originalStructure);C.currentStructure=y,s.set(g.key,C);var _=Re.remap(ht.toLociWithSourceUnits(D),y);m.push({key:g.key,loci:_,groupId:g.groupId}),p+=Re.size(_),f=!0}else x=!0;else x=!0;x&&(f=!0,D=cs.updateStructure(C,y),s.set(g.key,C),_=ht.toLociWithSourceUnits(D),m.push({key:g.key,loci:_,groupId:g.groupId}),p+=Re.size(_))}}else S=!0;if(S){f=!0;var w=cs.createAndRun(y,g.expression);D=w.selection,s.set(g.key,C=w.entry),_=ht.toLociWithSourceUnits(D),m.push({key:g.key,loci:_}),p+=Re.size(_)}}return f?(a.entries=s,t.data=m,t.label="".concat(n.label||"Multi-selection"),t.description="".concat(m.length," source(s), ").concat(p," element(s) total"),rt.UpdateResult.Updated):rt.UpdateResult.Unchanged}}),Fze=Bt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{script:T.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:T.Optional(T.Text(""))}}})({apply:function(e){var r=e.params,n=e.cache,a=cs.createAndRun(e.a.data,r.script),i=a.selection;n.entry=a.entry;var s=ht.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:Ze.elementDescription(s)};return new ve.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,a=e.newParams,i=e.cache;if(!Ni.areEqual(e.oldParams.script,a.script))return rt.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return rt.UpdateResult.Unchanged;var s=cs.updateStructure(o,t.data);return cs.updateStructureObject(r,s,a.label),rt.UpdateResult.Updated},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Bze=Bt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{bundle:T.Value(rn.Empty,{isHidden:!0}),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params;if(r.bundle.hash!==t.data.hashCode)return Jn.Null;e.cache.source=t.data;var a=rn.toStructure(r.bundle,t.data);if(0===a.elementCount)return Jn.Null;var i={label:"".concat(r.label||"Selection"),description:Ze.elementDescription(a)};return new ve.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,a=e.newParams,i=e.cache;if(!rn.areEqual(e.oldParams.bundle,a.bundle))return rt.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return rt.UpdateResult.Null;if(i.source===t.data)return rt.UpdateResult.Unchanged;i.source=t.data;var o=rn.toStructure(a.bundle,t.data);return 0===o.elementCount?rt.UpdateResult.Null:(r.label="".concat(a.label||"Selection"),r.description=Ze.elementDescription(o),r.data=o,rt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),X$={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},Nze=T.objectToOptions(X$),kze=Bt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:{type:T.Select("atomic-sequence",Nze,{isHidden:!0})}})({apply:function(e){var n,a,t=e.a;switch(e.params.type){case"polymer":n=xi.polymer.query,a="Polymer";break;case"protein":n=xi.protein.query,a="Protein";break;case"nucleic":n=xi.nucleic.query,a="Nucleic";break;case"water":n=gn.internal.water(),a="Water";break;case"branched":n=xi.branchedPlusConnected.query,a="Branched";break;case"ligand":n=xi.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=xi.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=xi.coarse.query,a="Coarse";break;case"atomic-sequence":n=gn.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=gn.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=gn.internal.spheres(),a="Coarse Spheres";break;default:Sn()}var i=n(new Rc(t.data)),o=ht.unionStructure(i);return 0===o.elementCount?Jn.Null:new ve.Molecule.Structure(o,{label:a,description:Ze.elementDescription(o)})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),Lze=Bt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(){return{type:T.MappedStatic("static",{static:T.Text("polymer"),expression:T.Value(fe.struct.generator.all),bundle:T.Value(rn.Empty),script:T.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:T.Optional(T.Boolean(!0,{isHidden:!0})),label:T.Text("",{isHidden:!0})}}})({apply:function(e){return function KVe(e,t,r){r.source=e;var n=Ze.Empty,a=void 0;switch(t.type.name){case"static":var i=void 0;switch(t.type.params){case"all":i=xi.all.query,a="All";break;case"polymer":i=xi.polymer.query,a="Polymer";break;case"protein":i=xi.protein.query,a="Protein";break;case"nucleic":i=xi.nucleic.query,a="Nucleic";break;case"water":i=gn.internal.water(),a="Water";break;case"ion":i=xi.ion.query,a="Ion";break;case"lipid":i=xi.lipid.query,a="Lipid";break;case"branched":i=xi.branchedPlusConnected.query,a="Branched";break;case"ligand":i=xi.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=xi.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=xi.coarse.query,a="Coarse";break;default:Sn()}var o=i(new Rc(e));n=ht.unionStructure(o);break;case"script":case"expression":var s=cs.createAndRun(e,t.type.params),u=s.selection;r.entry=s.entry,n=ht.unionStructure(u);break;case"bundle":if(t.type.params.hash!==e.hashCode)break;n=rn.toStructure(t.type.params,e)}if(t.nullIfEmpty&&0===n.elementCount)return Jn.Null;var l={label:"".concat(t.label||a||"Component"),description:Ze.elementDescription(n)};return new ve.Molecule.Structure(n,l)}(e.a.data,e.params,e.cache)},update:function(e){return function ZVe(e,t,r,n,a){if(r.type.name!==n.type.name)return rt.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params===n.type.params&&Ze.areEquivalent(e,a.source)?t.data.model===e.model?rt.UpdateResult.Unchanged:ar.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),rt.UpdateResult.Updated):rt.UpdateResult.Recreate:rt.UpdateResult.Recreate;case"script":if(!Ni.areEqual(r.type.params,n.type.params))return rt.UpdateResult.Recreate;case"expression":if(r.type.params!==n.type.params)return rt.UpdateResult.Recreate;if(e===a.source)break;var s=cs.updateStructure(a.entry,e);a.source=e,t.data=ht.unionStructure(s),cs.updateStructureObject(t,s,n.label),i=!0;break;case"bundle":if(e===a.source&&rn.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=0!==t.data.elementCount,t.data=0===t.data.elementCount?t.data:Ze.Empty):(i=!0,t.data=rn.toStructure(n.type.params,e))}if(i){if(n.nullIfEmpty&&0===t.data.elementCount)return rt.UpdateResult.Null;t.description=Ze.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label="".concat(n.label||t.label)),i?rt.UpdateResult.Updated:rt.UpdateResult.Unchanged}(e.a.data,e.b,e.oldParams,e.newParams,e.cache)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),K$=Bt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ve.Molecule.Model,to:ve.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e?.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Custom Props",function(i){return ue(r,void 0,void 0,function(){return ce(this,function(o){switch(o.label){case 0:return[4,Z$(n.data,t,i,a)];case 1:return o.sent(),[2,new ve.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Ve.create("Custom Props",function(s){return ue(r,void 0,void 0,function(){var u,c,d;return ce(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,c=i.autoAttach;u<c.length;u++)(d=t.customModelProperties.get(c[u]))&&n.data.customProperties.reference(d.descriptor,!1);return[4,Z$(n.data,t,s,o)];case 1:return f.sent(),[2,rt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}});function Z$(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=t.customModelProperties.get(c=u[s]),d=o[c],!i.includes(c)&&!l.isHidden)return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,l.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching model prop '".concat(c,"': ").concat(f)),[3,5];case 5:return[3,7];case 6:l.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var Q$=Bt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ve.Molecule.Structure,to:ve.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e?.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Custom Props",function(i){return ue(r,void 0,void 0,function(){return ce(this,function(o){switch(o.label){case 0:return[4,$$(n.data.root,t,i,a)];case 1:return o.sent(),[2,new ve.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?rt.UpdateResult.Recreate:Ve.create("Custom Props",function(s){return ue(r,void 0,void 0,function(){var u,c,d;return ce(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,c=i.autoAttach;u<c.length;u++)(d=t.customStructureProperties.get(c[u]))&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,$$(n.data.root,t,s,o)];case 1:return f.sent(),[2,rt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}});function $$(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=t.customStructureProperties.get(c=u[s]),d=o[c],!i.includes(c)&&!l.isHidden)return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,l.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching structure prop '".concat(c,"': ").concat(f)),[3,5];case 5:return[3,7];case 6:l.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var UB,VB,GB,zB,Uze=Bt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ve.Format.Ply,to:ve.Shape.Provider,params:function(e){return{transforms:T.Optional(T.Value([],{isHidden:!0})),label:T.Optional(T.Text("",{isHidden:!0}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create shape from PLY",function(a){return ue(t,void 0,void 0,function(){var i;return ce(this,function(s){switch(s.label){case 0:return[4,$4e(r.data,n).runInContext(a)];case 1:return i=s.sent(),[2,new ve.Shape.Provider(i,{label:n.label||"Shape"})]}})})})}});function zze(e,t){var r=this;return Ve.create("Create Volume",function(n){return ue(r,void 0,void 0,function(){var a,i,o,s,c,l,d,f,p,m,h,v,g,y,S,C;return ce(this,function(_){return i=e.values,o=b.create((a=e.header).xLength,a.yLength,a.zLength),t&&t.voxelSize&&b.mul(o,o,t.voxelSize),s=b.create(Yr(a.alpha),Yr(a.beta),Yr(a.gamma)),c=ns.create((a.ISPG>65536?0:a.ISPG)||"P 1",o,s),l=b.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),d=Sr.convertToCanonicalAxisIndicesFastToSlow(l),f=[a.NX,a.NY,a.NZ],p=d([a.NC,a.NR,a.NS]),m=function Vze(e){return 0===e.originX&&0===e.originY&&0===e.originZ?b.create(e.NCSTART,e.NRSTART,e.NSSTART):b.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}(a),t?.offset&&b.add(m,m,t.offset),h=d(m),v=b.create(h[0]/f[0],h[1]/f[1],h[2]/f[2]),g=b.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),y=Sr.Space(p,Sr.invertAxisOrder(l),function Gze(e){var t=YW(e);switch(t){case Ki.Float32:return Float32Array;case Ki.Int8:return Int8Array;case Ki.Int16:return Int16Array;case Ki.Uint16:return Uint16Array}throw Error("".concat(t," is not a supported value format."))}(a)),S=Sr.create(y,Sr.Data1(i)),C=0===a.AMIN&&0===a.AMAX&&0===a.AMEAN&&0===a.ARMS,[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:c,fractionalBox:Nt.create(v,b.add(b.zero(),v,g))},cells:S,stats:{min:isNaN(a.AMIN)||C?Aw(i):a.AMIN,max:isNaN(a.AMAX)||C?id(i):a.AMAX,mean:isNaN(a.AMEAN)||C?Tw(i):a.AMEAN,sigma:isNaN(a.ARMS)||0===a.ARMS?Dw(i):a.ARMS}},sourceData:UB.create(e),customProperties:new Sl,_propertyData:Object.create(null)}]})})})}function Hze(e,t){var r=this;return Ve.create("Create Volume",function(n){return ue(r,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,m,h;return ce(this,function(v){return i=e.values,o=b.create((a=e.header).xlen,a.ylen,a.zlen),t&&t.voxelSize&&b.mul(o,o,t.voxelSize),s=b.create(Yr(a.alpha),Yr(a.beta),Yr(a.gamma)),u=ns.create("P 1",o,s),l=[a.xExtent,a.yExtent,a.zExtent],f=b.create((d=[a.xStart,a.yStart,a.zStart])[0]/(c=[a.xRate,a.yRate,a.zRate])[0],d[1]/c[1],d[2]/c[2]),p=b.create(l[0]/c[0],l[1]/c[1],l[2]/c[2]),m=Sr.Space(l,[0,1,2],Float32Array),h=Sr.create(m,Sr.Data1(i)),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Nt.create(f,b.add(b.zero(),f,p))},cells:h,stats:{min:Aw(i),max:id(i),mean:Tw(i),sigma:void 0!==a.sigma?a.sigma:Dw(i)}},sourceData:VB.create(e),customProperties:new Sl,_propertyData:Object.create(null)}]})})})}function jze(e,t){var r=this;return Ve.create("Create Volume",function(){return ue(r,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(c){return a=e.values,i=Sr.Space((n=e.header).dim,[0,1,2],Float64Array),o=Sr.create(i,Sr.Data1(a)),s=he.fromTranslation(he(),n.min),u=he.fromScaling(he(),n.h),he.mul(s,s,u),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:Aw(a),max:id(a),mean:Tw(a),sigma:Dw(a)}},sourceData:GB.create(e),customProperties:new Sl,_propertyData:Object.create(null)}]})})})}function qze(e,t){var r=this;return Ve.create("Create Segmentation Volume",function(n){return ue(r,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,F,N,j,U,H,z,G,J,X,Z;return ce(this,function(ne){for(i=e.segmentation_data_3d,o=ns.create((a=e.volume_data_3d_info).spacegroup_number.value(0),b.ofArray(a.spacegroup_cell_size.value(0)),b.scale(b(),b.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Sr.convertToCanonicalAxisIndicesFastToSlow(s),c=u(a.sample_count.value(0)),l=Sr.Space(c,Sr.invertAxisOrder(s),Float32Array),d=Sr.create(l,Sr.Data1(i.values.toArray({array:Float32Array}))),f=b.ofArray(u(a.origin.value(0))),p=b.ofArray(u(a.dimensions.value(0))),m={label:t?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Nt.create(f,b.add(b(),f,p))},cells:d,stats:{min:0,max:1,mean:0,sigma:1}},sourceData:zB.create(e),customProperties:new Sl,_propertyData:{ownerId:t?.ownerId}},nt.PickingGranularity.set(m,"object"),h=new Map,v=new Map,S=(g=e.segmentation_data_table).set_id,H=0,z=(y=g.segment_id).rowCount;H<z;++H)C=y.value(H),0!==(_=S.value(H))&&0!==C&&(v.has(_)||v.set(_,new Set),v.get(_).add(C));for(v.forEach(function(Y,k){Y.forEach(function(W){h.has(W)||h.set(W,new Set),h.get(W).add(k)})}),x=[0,0,0],D=d.space.getCoords,w=d.data,F=(A=m.grid.cells.space.dimensions)[0]-1,N=A[1]-1,j=A[2]-1,U={},v.forEach(function(Y,k){U[k]=[F,N,j,-1,-1,-1]}),H=0,z=w.length;H<z;++H)0!==(G=w[H])&&(D(H,x),x[0]<(J=U[G])[0]&&(J[0]=x[0]),x[1]<J[1]&&(J[1]=x[1]),x[2]<J[2]&&(J[2]=x[2]),x[0]>J[3]&&(J[3]=x[0]),x[1]>J[4]&&(J[4]=x[1]),x[2]>J[5]&&(J[5]=x[2]));return X={},h.forEach(function(Y,k){X[k]=Nt.create(b.create(F,N,j),b.create(-1,-1,-1))}),Fs(U,function(Y,k){v.get(parseInt(k)).forEach(function(W){var $=X[W];Y[0]<$.min[0]&&($.min[0]=Y[0]),Y[1]<$.min[1]&&($.min[1]=Y[1]),Y[2]<$.min[2]&&($.min[2]=Y[2]),Y[3]>$.max[0]&&($.max[0]=Y[3]),Y[4]>$.max[1]&&($.max[1]=Y[4]),Y[5]>$.max[2]&&($.max[2]=Y[5])})}),nt.Segmentation.set(m,{segments:h,sets:v,bounds:X,labels:null!==(Z=t?.segmentLabels)&&void 0!==Z?Z:{}}),[2,m]})})})}!function(e){e.is=function t(n){return"ccp4"===n?.kind},e.create=function r(n){return{kind:"ccp4",name:n.name,data:n}}}(UB||(UB={})),function(e){e.is=function t(n){return"dsn6"===n?.kind},e.create=function r(n){return{kind:"dsn6",name:n.name,data:n}}}(VB||(VB={})),function(e){e.is=function t(n){return"dx"===n?.kind},e.create=function r(n){return{kind:"dx",name:n.name,data:n}}}(GB||(GB={})),function(e){e.is=function t(n){return"segcif"===n?.kind},e.create=function r(n){return{kind:"segcif",name:n._name,data:n}}}(zB||(zB={}));var Wze=Bt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ve.Format.Ccp4,to:ve.Volume.Data,params:function(e){return{voxelSize:T.Vec3(b.create(1,1,1)),offset:T.Vec3(b.create(0,0,0)),entryId:T.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create volume from CCP4/MRC/MAP",function(a){return ue(t,void 0,void 0,function(){var i,o;return ce(this,function(s){switch(s.label){case 0:return[4,zze(r.data,R(R({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.NX,"\xd7").concat(r.data.header.NX,"\xd7").concat(r.data.header.NX)},[2,new ve.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Yze=Bt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ve.Format.Dsn6,to:ve.Volume.Data,params:function(e){return{voxelSize:T.Vec3(b.create(1,1,1)),entryId:T.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create volume from DSN6/BRIX",function(a){return ue(t,void 0,void 0,function(){var i,o;return ce(this,function(s){switch(s.label){case 0:return[4,Hze(r.data,R(R({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.xExtent,"\xd7").concat(r.data.header.yExtent,"\xd7").concat(r.data.header.zExtent)},[2,new ve.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Xze=Bt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ve.Format.Cube,to:ve.Volume.Data,params:function(e){return{dataIndex:e?T.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,"".concat(r)]})):T.Numeric(0),entryId:T.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Create volume from Cube",function(a){return ue(t,void 0,void 0,function(){var i,o;return ce(this,function(s){switch(s.label){case 0:return[4,YFe(r.data,R(R({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xd7").concat(r.data.header.dim[1],"\xd7").concat(r.data.header.dim[2])},[2,new ve.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Kze=Bt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ve.Format.Dx,to:ve.Volume.Data})({apply:function(e){var t=this,r=e.a;return Ve.create("Parse DX",function(n){return ue(t,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return[4,jze(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xd7").concat(r.data.header.dim[1],"\xd7").concat(r.data.header.dim[2])},[2,new ve.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Zze=Bt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ve.Format.Cif,to:ve.Volume.Data,params:function(e){if(!e)return{blockHeader:T.Optional(T.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:T.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:T.Optional(T.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:T.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse density-server CIF",function(a){return ue(t,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,!(o=r.data.blocks.find(function(v){return v.header===i})))throw new Error("Data block '".concat([i],"' not found."));return[4,FK(s=hl.schema.densityServer(o),{entryId:n.entryId}).runInContext(a)];case 1:return u=h.sent(),l=(c=u.grid.cells.space.dimensions)[0],d=c[1],f=c[2],p={label:null!==(m=n.entryId)&&void 0!==m?m:s.volume_data_3d_info.name.value(0),description:"Volume ".concat(l,"\xd7").concat(d,"\xd7").concat(f)},[2,new ve.Volume.Data(u,p)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),Qze=Bt.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:ve.Format.Cif,to:ve.Volume.Data,params:function(e){var t=e?.data.blocks.slice(1);return{blockHeader:T.Optional(t?T.Select(t[0]&&t[0].header,t.map(function(n){return[n.header,n.header]}),{description:"Header of the block to parse"}):T.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:T.ObjectList({id:T.Numeric(-1),label:T.Text("")},function(n){return"".concat(n.id," = ").concat(n.label)},{description:"Mapping of segment IDs to segment labels"}),ownerId:T.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Ve.create("Parse segmentation CIF",function(a){return ue(t,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,h,v,g;return ce(this,function(y){switch(y.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,!(o=r.data.blocks.find(function(S){return S.header===i})))throw new Error("Data block '".concat([i],"' not found."));for(s=hl.schema.segmentation(o),u={},c=0,l=n.segmentLabels;c<l.length;c++)u[(d=l[c]).id]=d.label;return[4,qze(s,{segmentLabels:u,ownerId:n.ownerId}).runInContext(a)];case 1:return f=y.sent(),m=(p=f.grid.cells.space.dimensions)[0],h=p[1],v=p[2],g={label:s.volume_data_3d_info.name.value(0),description:"Segmentation ".concat(m,"\xd7").concat(h,"\xd7").concat(v)},[2,new ve.Volume.Data(f,g)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),$ze=Bt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ve.Volume.Data,to:ve.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:T.Text()};var r=t.state.data.select(xr.Generators.root.subtree().ofType(ve.Volume.Data).filter(function(n){var a;return!(!n.obj||null!==(a=n.obj)&&void 0!==a&&a.data.colorVolume||n.obj===e)}));return 0===r.length?{ref:T.Text("",{isHidden:!0})}:{ref:T.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return Ve.create("Assign Color Volume",function(i){return ue(t,void 0,void 0,function(){var o,s;return ce(this,function(c){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=R(R({},r.data),{colorVolume:o}),[2,new ve.Volume.Data(s,{label:r.label,description:"Volume + Colors"})]})})})}}),dT=dt(13421772),J$={},tHe={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:Xn.Residue,factory:function eJ(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!Fe.isAtomic(s))return dT;var c=i(s,u);return c.length>0?a[c[0]].component.color:dT};r=function(s,u){return u?15854817:at.is(s)?o(s.unit,s.element):zt.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):dT}}else r=function(){return dT};return{factory:eJ,granularity:"group",color:r,props:t,description:"Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",legend:sm(uBe)}},getParams:function eHe(e){return J$},defaultValues:T.getDefaultValues(J$),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return ar.hasCarbohydrate(t)})}},tJ={hue:T.Interval([1,360],{min:0,max:360,step:1}),chroma:T.Interval([40,70],{min:0,max:100,step:1}),luminance:T.Interval([15,85],{min:0,max:100,step:1}),sort:T.Select("contrast",T.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:T.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:T.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:T.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},my=2,pv=[0,0,0],mv=[0,0,0];function rHe(e,t){return Ii.toHcl(pv,e),Ii.fromColor(mv,Ii.toColor(e)),pv[0]>=t.hue[0]&&pv[0]<=t.hue[1]&&pv[1]>=t.chroma[0]&&pv[1]<=t.chroma[1]&&pv[2]>=t.luminance[0]&&pv[2]<=t.luminance[1]&&mv[0]>=e[0]-my&&mv[0]<=e[0]+my&&mv[1]>=e[1]-my&&mv[1]<=e[1]+my&&mv[2]>=e[2]-my&&mv[2]<=e[2]+my}function rJ(e,t){for(var r=1/0,n=0,a=0;a<e.length;a++){var i=Ii.distance(t,e[a]);i<r&&(r=i,n=a)}return n}var nJ={type:"generate",colorList:"red-yellow-blue"};function ls(e){void 0===e&&(e={});var t=R(R({},nJ),e);return{palette:T.MappedStatic(t.type,{colors:T.Group({list:T.ColorList(t.colorList)},{isFlat:!0}),generate:T.Group(R(R({},tJ),{maxCount:T.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}T.getDefaultValues(ls());var aJ={valueLabel:function(e){return"".concat(e+1)},minLabel:"Start",maxLabel:"End"};function Vs(e,t,r){var n,a,i;if(void 0===r&&(r={}),"colors"===t.palette.name&&"interpolate"===t.palette.params.list.kind){var o=t.palette.params.list,s=[0,e-1],u=R(R({},aJ),r),c=u.minLabel,l=u.maxLabel,d=o.colors;0===d.length&&(d=pf(nJ.colorList).list);var f=_c.create({listOrName:d,domain:s,minLabel:c,maxLabel:l});i=f.legend,a=f.color}else{var p;"colors"===t.palette.name?0===(p=t.palette.params.list.colors.map(function(S){return Array.isArray(S)?S[0]:S})).length&&(p=pf("dark-2").list.map(function(S){return Array.isArray(S)?S[0]:S})):(e=Math.min(e,t.palette.params.maxCount),p=function iHe(e,t){void 0===t&&(t={});var r=R(R({},T.getDefaultValues(tJ)),t);if(e<=0)return[];var n=function aHe(e,t){for(var r=new Map,n=Math.ceil(Math.cbrt(e)),a=pl(),i=Math.max((t.hue[1]-t.hue[0])/n,1),o=Math.max((t.chroma[1]-t.chroma[0])/n,1),s=Math.max((t.luminance[1]-t.luminance[0])/n,1),u=t.hue[0]+i/2;u<=t.hue[1];u+=i)for(var c=t.chroma[0]+o/2;c<=t.chroma[1];c+=o)for(var l=t.luminance[0]+s/2;l<=t.luminance[1];l+=s){var d=Ii.fromHcl(Ii(),pl.set(a,u,c,l));rHe(d,t)&&r.set(Ii.toColor(d),d)}return Array.from(r.values())}(Math.max(r.minSampleCount,e*r.sampleCountFactor),r);if(n.length<e)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(e).fill(vr.lightgrey);for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){var c=fl(i),l=fl(n);for(s=0;s<a.length;++s){var d=rJ(l,a[s]);c[s].push(n[d]),l.splice(d,1)}for(s=0;s<l.length;++s)c[rJ(a,n[s])].push(n[s]);var p=fl(a);for(s=0;s<c.length;++s){var m=c[s],h=m.length;if(0!==h){for(var v=0,g=0,y=0,S=0,C=m;S<C.length;S++){var _=C[S];v+=_[0],g+=_[1],y+=_[2]}a[s]=[v/h,g/h,y/h]}}if(rd(p,a))break}var A="contrast"===r.sort?function nHe(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.NEGATIVE_INFINITY,o=0;o<t.length;++o){var s=Ii.distance(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}(a):a;return A.map(function(E){return Ii.toColor(E)})}(e,t.palette.params));for(var m=null!==(n=r.valueLabel)&&void 0!==n?n:aJ.valueLabel,h=p.length,v=[],g=0;g<e;++g){var y=g%h;void 0===v[y]?v[y]=[m(g),p[y]]:v[y][0]+=", ".concat(m(g))}i=sm(v),a=function(S){return p[S%h]}}return{color:a,legend:i}}var iJ=dt(16448250),sHe="Gives every chain a color based on its `asym_id` value.",S2=R({asymId:T.Select("auth",T.arrayToOptions(["auth","label"]))},ls({type:"colors",colorList:"many-distinct"}));function oJ(e,t){var r=function cHe(e,t){switch(e.kind){case 0:return"auth"===t?ot.chain.auth_asym_id:ot.chain.label_asym_id;case 1:case 2:return ot.coarse.asym_id}}(e.unit,t)(e);return e.structure.root.models.length>1?sJ(e.unit.model,r):r}function sJ(e,t){return"".concat(t,"|").concat((ar.Index.get(e).value||0)+1)}function C2(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=function lHe(e,t){for(var r=new Map,n=function(s){var u=ar.AsymIdOffset.get(s).value,c=("auth"===t?u?.auth:u?.label)||0,l=0;s.properties.structAsymMap.forEach(function(d,f){var m="auth"===t?d.auth_id:f,h=e.models.length>1?sJ(s,m):m;r.has(h)||(r.set(h,l+c),++l)})},a=0,i=e.models;a<i.length;a++)n(i[a]);return r}(e.structure.root,t.asymId),o=Array.from(i.keys()),u=Vs(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var d=oJ(c,t.asymId);l=i.get(d)}else zt.isLocation(c)&&(a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],d=oJ(a,t.asymId),l=i.get(d));return void 0===l?iJ:u.color(l)}}else r=function(){return iJ};return{factory:C2,granularity:"group",color:r,props:t,description:sHe,legend:n}}var uJ={name:"chain-id",label:"Chain Id",category:Xn.Chain,factory:C2,getParams:function uHe(e){var t,r=T.clone(S2);return!(null===(t=e.structure)||void 0===t)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r},defaultValues:T.getDefaultValues(S2),isApplicable:function(e){return!!e.structure}},cJ=dt(13421772),lJ=R({},ls({type:"colors",colorList:"red-yellow-blue"})),pHe={name:"element-index",label:"Element Index",category:Xn.Atom,factory:function dJ(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,c=0;c<i;++c)o.set(c,u),u+=a[c].elements.length,s.set(a[c].id,c);var l=Vs(u,t);n=l.legend,r=function(d){if(at.is(d)){var f=s.get(d.unit.id),p=ke.findPredecessorIndex(a[f].elements,d.element);return l.color(o.get(f)+p)}return zt.isLocation(d)?(f=s.get(d.aUnit.id),p=ke.findPredecessorIndex(a[f].elements,d.aUnit.elements[d.aIndex]),l.color(o.get(f)+p)):cJ}}else r=function(){return cJ};return{factory:dJ,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:"Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",legend:n}},getParams:function fHe(e){return lJ},defaultValues:T.getDefaultValues(lJ),isApplicable:function(e){return!!e.structure}};function fT(e){var t={};return Fs(e,function(r,n){t[n]=T.Color(e[n])}),t}var fJ=dt(13421772),hHe="Assigns a color based on the operator name of a transformed chain.",HB=R({},ls({type:"colors",colorList:"many-distinct"}));function jB(e,t){var r,n;if(e.structure){var a=function gHe(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}(e.structure.root),i=Array.from(a.keys()),s=Vs(a.size,t,{valueLabel:function(u){return i[u]}});n=s.legend,r=function(u){var c=void 0;return at.is(u)?c=a.get(u.unit.conformation.operator.name):zt.isLocation(u)&&(c=a.get(u.aUnit.conformation.operator.name)),void 0===c?fJ:s.color(c)}}else r=function(){return fJ};return{factory:jB,granularity:"instance",color:r,props:t,description:hHe,legend:n}}var qB={name:"operator-name",label:"Operator Name",category:Xn.Symmetry,factory:jB,getParams:function vHe(e){return T.clone(HB)},defaultValues:T.getDefaultValues(HB),isApplicable:function(e){return!!e.structure}},pJ=dt(16448250),bHe="Gives every chain a color based on its `label_entity_id` value.",x2=R({},ls({type:"colors",colorList:"many-distinct"}));function _2(e,t){return"".concat(e,"|").concat(t)}function mJ(e){switch(e.unit.kind){case 0:return ot.chain.label_entity_id(e);case 1:case 2:return ot.coarse.entity_id(e)}}function w2(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=function CHe(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r){for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=_2(a.value(i),r);t.has(s)||t.set(s,t.size)}var u=e.models[r].coarseHierarchy;if(u.isDefined){var c=u.spheres.entity_id;for(i=0,o=c.rowCount;i<o;++i)s=_2(c.value(i),r),t.has(s)||t.set(s,t.size);var l=u.gaussians.entity_id;for(i=0,o=l.rowCount;i<o;++i)s=_2(l.value(i),r),t.has(s)||t.set(s,t.size)}}return t}(e.structure.root),o=Array.from(i.keys()),u=Vs(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var p=_2(mJ(c),c.structure.models.indexOf(c.unit.model));l=i.get(p)}else zt.isLocation(c)&&(a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],p=_2(mJ(a),a.structure.models.indexOf(a.unit.model)),l=i.get(p));return void 0===l?pJ:u.color(l)}}else r=function(){return pJ};return{factory:w2,granularity:"group",color:r,props:t,description:bHe,legend:n}}var xHe={name:"entity-id",label:"Entity Id",category:Xn.Chain,factory:w2,getParams:function SHe(e){return T.clone(x2)},defaultValues:T.getDefaultValues(x2),isApplicable:function(e){return!!e.structure}},WB="dark-2",pT=dt(16448250),_He="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",A2=R({},ls({type:"colors",colorList:WB}));function hJ(e,t){return"".concat(e,"|").concat(t)}function AHe(e,t,r,n,a,i){return"".concat(e,"|").concat(t,"|").concat(r,"|").concat(i||a||n)}function YB(e,t,r,n,a,i,o,s){for(var u=a.entity_id,c=a.pdbx_src_id,l=a.pdbx_beg_seq_num,d=a.pdbx_end_seq_num,f=0,p=a._rowCount;f<p;++f){var m=u.value(f),h=hJ(r,m),v=void 0;if(e.has(h))v=e.get(h);else{var g=n.entities.getEntityIndex(m);v=new Int16Array(n.sequence.sequences[g].sequence.length),e.set(h,v)}var S=o?o.value(f):"",C=s?s.value(f)[0]:"",_=AHe(r,m,i.value(f),c.value(f),S,C),x=0===l.valueKind(f)?l.value(f):1,D=0===d.valueKind(f)?d.value(f):v.length,w=void 0;t.has(_)?w=t.get(_):t.set(_,w=t.size+1);for(var A=x,E=D;A<=E;++A)v[A-1]=w}}function vJ(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(Dn.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,c=o.pdbx_entity_src_syn;YB(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),YB(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),YB(t,r,n,i,c,c.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function T2(e,t){var r,n;if(e.structure){var a=at.create(e.structure),i=e.structure.root.models,o=vJ(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,c=function THe(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=function nDe(e){e=e.trim();var t=parseInt(e,10);return!isNaN(t)&&t.toString()===e}(n[3])?"Unnamed ".concat(++t):n[3];return"".concat(i).concat(a?" (".concat(a,")"):"")})}(u),d=Vs(u.size,t,{valueLabel:function(p){return c[p]}});n=d.legend;var f=function(p){var v=hJ(i.indexOf(p.unit.model),ot.entity.id(p)),g=s.get(v);if(g){var y=g[ot.residue.label_seq_id(p)-1]-1;return-1===y?pT:d.color(y)}return pT};r=function(p){return at.is(p)?f(p):zt.isLocation(p)?(a.unit=p.aUnit,a.element=p.aUnit.elements[p.aIndex],f(a)):pT}}else r=function(){return pT};return{factory:T2,granularity:"group",color:r,props:t,description:_He,legend:n}}var DHe={name:"entity-source",label:"Entity Source",category:Xn.Chain,factory:T2,getParams:function wHe(e){var t=T.clone(A2);return e.structure&&vJ(e.structure.root.models).srcKeySerialMap.size>ru[WB].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:pf(WB).list}})),t},defaultValues:T.getDefaultValues(A2),isApplicable:function(e){return!!e.structure}},gJ=dt(13421772),EHe="Gives every model a unique color based on its index.",D2=R({},ls({type:"colors",colorList:"many-distinct"}));function E2(e,t){var r,n,a;if(e.structure){var o=Vs((null!==(r=ar.MaxIndex.get(e.structure.models[0]).value)&&void 0!==r?r:-1)+1,t);a=o.legend,n=function(s){return at.is(s)?o.color(ar.Index.get(s.unit.model).value||0):zt.isLocation(s)?o.color(ar.Index.get(s.aUnit.model).value||0):gJ}}else n=function(){return gJ};return{factory:E2,granularity:"instance",color:n,props:t,description:EHe,legend:a}}var PHe={name:"model-index",label:"Model Index",category:Xn.Chain,factory:E2,getParams:function IHe(e){return T.clone(D2)},defaultValues:T.getDefaultValues(D2),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0}},yJ=dt(13421772),MHe="Gives every structure a unique color based on its index.",I2=R({},ls({type:"colors",colorList:"many-distinct"}));function P2(e,t){var r,n,a;if(e.structure){var o=Vs((null!==(r=Ze.MaxIndex.get(e.structure).value)&&void 0!==r?r:-1)+1,t);a=o.legend,n=function(s){return at.is(s)?o.color(Ze.Index.get(s.structure).value||0):zt.isLocation(s)?o.color(Ze.Index.get(s.aStructure).value||0):yJ}}else n=function(){return yJ};return{factory:P2,granularity:"instance",color:n,props:t,description:MHe,legend:a}}var OHe={name:"structure-index",label:"Structure Index",category:Xn.Chain,factory:P2,getParams:function RHe(e){return T.clone(I2)},defaultValues:T.getDefaultValues(I2),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0}},XB="dark-2",bJ=dt(13421772),FHe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",KB=R({},ls({type:"colors",colorList:XB}));function ZB(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=Vs(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(c){return at.is(c)?o.get(c.unit.id):zt.isLocation(c)?o.get(c.aUnit.id):bJ}}else r=function(){return bJ};return{factory:ZB,granularity:"instance",color:r,props:t,description:FHe,legend:n}}var NHe={name:"unit-index",label:"Chain Instance",category:Xn.Chain,factory:ZB,getParams:function BHe(e){var t=T.clone(KB);return e.structure&&e.structure.root.units.length>ru[XB].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:pf(XB).list}})),t},defaultValues:T.getDefaultValues(KB),isApplicable:function(e){return!!e.structure}},SJ={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},CJ=dt(16777215),QB={carbonColor:T.MappedStatic("chain-id",{"chain-id":T.Group(S2),"unit-index":T.Group(KB,{label:"Chain Instance"}),"entity-id":T.Group(x2),"entity-source":T.Group(A2),"operator-name":T.Group(HB),"model-index":T.Group(D2),"structure-index":T.Group(I2),uniform:T.Group(z0),"element-symbol":T.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(.2,{min:-6,max:6,step:.1}),colors:T.MappedStatic("default",{default:T.EmptyGroup(),custom:T.Group(fT(SJ))})};function $B(e,t){var r,n=vw("default"===t.colors.name?SJ:t.colors.params,t.saturation,t.lightness),a=null===(r=function VHe(e,t){switch(t.name){case"chain-id":return C2(e,t.params);case"unit-index":return ZB(e,t.params);case"entity-id":return w2(e,t.params);case"entity-source":return T2(e,t.params);case"operator-name":return jB(e,t.params);case"model-index":return E2(e,t.params);case"structure-index":return P2(e,t.params);case"uniform":return Kh(0,t.params);case"element-symbol":return;default:Sn()}}(e,t.carbonColor))||void 0===r?void 0:r.color;function i(u,c){return a&&"C"===u?a(c,!1):function UHe(e,t){var r=e[t];return void 0===r?CJ:r}(n,u)}return{factory:$B,granularity:"operator-name"===t.carbonColor.name||"unit-index"===t.carbonColor.name?"groupInstance":"group",preferSmoothing:!0,color:function o(u){if(at.is(u)){if(Fe.isAtomic(u.unit))return i(u.unit.model.atomicHierarchy.atoms.type_symbol.value(u.element),u)}else if(zt.isLocation(u)&&Fe.isAtomic(u.aUnit))return i(u.aUnit.model.atomicHierarchy.atoms.type_symbol.value(u.aUnit.elements[u.aIndex]),u);return CJ},props:t,description:"Assigns a color to every atom according to its chemical element.",legend:sm(Object.keys(n).map(function(u){return[u,n[u]]}))}}var GHe={name:"element-symbol",label:"Element Symbol",category:Xn.Atom,factory:$B,getParams:function LHe(e){return T.clone(QB)},defaultValues:T.getDefaultValues(QB),isApplicable:function(e){return!!e.structure}},xJ={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},JB=dt(16777113),mT={saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(0,{min:-6,max:6,step:.1}),colors:T.MappedStatic("default",{default:T.EmptyGroup(),custom:T.Group(fT(xJ))})};function _J(e,t,r){switch(N4(t,r)){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return JB}function hT(e,t){var r=vw("default"===t.colors.name?xJ:t.colors.params,t.saturation,t.lightness);return{factory:hT,granularity:"group",color:function n(a){return at.is(a)?_J(r,a.unit,a.element):zt.isLocation(a)?_J(r,a.aUnit,a.aUnit.elements[a.aIndex]):JB},props:t,description:"Assigns a color based on the molecule type of a residue.",legend:sm(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Other/unknown",JB]]))}}var jHe={name:"molecule-type",label:"Molecule Type",category:Xn.Residue,factory:hT,getParams:function HHe(e){return mT},defaultValues:T.getDefaultValues(mT),isApplicable:function(e){return!!e.structure}},eN="dark-2",wJ=dt(16448250),AJ=R({},ls({type:"colors",colorList:eN}));function TJ(e){switch(e.kind){case 0:return ot.chain.label_asym_id;case 1:case 2:return ot.coarse.asym_id}}function DJ(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(Fe.isAtomic(a))for(var o=i.atomicHierarchy,u=o.chains,c=pr.transientSegments(o.chainAtomSegments,a.elements);c.hasNext;){var l=c.move().index,d=u.label_entity_id.value(l),f=i.entities.getEntityIndex(d);if("polymer"===i.entities.data.type.value(f)){var p=u.label_asym_id.value(l);t.has(p)||t.set(p,t.size)}}else if(Fe.isCoarse(a)){var m=Fe.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,h=m.chainElementSegments,v=m.asym_id,g=m.entity_id;for(c=pr.transientSegments(h,a.elements);c.hasNext;){l=c.move().index;var y=h.offsets[l];d=g.value(y),f=i.entities.getEntityIndex(d),"polymer"===i.entities.data.type.value(f)&&(p=v.value(y),t.has(p)||t.set(p,t.size))}}}return t}var YHe={name:"polymer-id",label:"Polymer Chain Id",category:Xn.Chain,factory:function EJ(e,t){var r,n;if(e.structure){var a=at.create(e.structure),i=DJ(e.structure.root),o=Array.from(i.keys()),u=Vs(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var d=TJ(c.unit);l=i.get(d(c))}else zt.isLocation(c)&&(d=TJ(c.aUnit),a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],l=i.get(d(a)));return void 0===l?wJ:u.color(l)}}else r=function(){return wJ};return{factory:EJ,granularity:"group",color:r,props:t,description:"Gives every polymer chain a color based on its `asym_id` value.",legend:n}},getParams:function WHe(e){var t=T.clone(AJ);return e.structure&&DJ(e.structure.root).size>ru[eN].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:pf(eN).list}})),t},defaultValues:T.getDefaultValues(AJ),isApplicable:function(e){return!!e.structure}},tN="dark-2",IJ=dt(13421772),PJ=R({},ls({type:"colors",colorList:tN}));function MJ(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}var ZHe={name:"polymer-index",label:"Polymer Chain Instance",category:Xn.Chain,factory:function RJ(e,t){var r,n;if(e.structure){var a=Vs(MJ(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,c=i.length;s<c;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(l){var d;return at.is(l)?d=o.get(l.unit.id):zt.isLocation(l)&&(d=o.get(l.aUnit.id)),void 0!==d?d:IJ}}else r=function(){return IJ};return{factory:RJ,granularity:"instance",color:r,props:t,description:"Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",legend:n}},getParams:function KHe(e){var t=T.clone(PJ);return e.structure&&MJ(e.structure.root)>ru[tN].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:pf(tN).list}})),t},defaultValues:T.getDefaultValues(PJ),isApplicable:function(e){return!!e.structure}},OJ={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},rN=dt(16711935),nN={saturation:T.Numeric(0,{min:-6,max:6,step:.1}),lightness:T.Numeric(1,{min:-6,max:6,step:.1}),colors:T.MappedStatic("default",{default:T.EmptyGroup(),custom:T.Group(fT(OJ))})};function FJ(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function BJ(e,t){var r=e.coarseElements.seq_id_begin.value(t);if(r===e.coarseElements.seq_id_end.value(t))return e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence.compId.value(r-1)}function vT(e,t){var r=e[t];return void 0===r?rN:r}function aN(e,t){var r=vw("default"===t.colors.name?OJ:t.colors.params,t.saturation,t.lightness);return{factory:aN,granularity:"group",preferSmoothing:!0,color:function n(a){if(at.is(a)){if(Fe.isAtomic(a.unit)){var i=FJ(a.unit,a.element);return vT(r,i)}if(i=BJ(a.unit,a.element))return vT(r,i)}else if(zt.isLocation(a)){if(Fe.isAtomic(a.aUnit))return i=FJ(a.aUnit,a.aUnit.elements[a.aIndex]),vT(r,i);if(i=BJ(a.aUnit,a.aUnit.elements[a.aIndex]))return vT(r,i)}return rN},props:t,description:"Assigns a color to every residue according to its name.",legend:sm(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Unknown",rN]]))}}var JHe={name:"residue-name",label:"Residue Name",category:Xn.Residue,factory:aN,getParams:function $He(e){return nN},defaultValues:T.getDefaultValues(nN),isApplicable:function(e){return!!e.structure}},NJ={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},iN=dt(8421504),oN={saturation:T.Numeric(-1,{min:-6,max:6,step:.1}),lightness:T.Numeric(0,{min:-6,max:6,step:.1}),colors:T.MappedStatic("default",{default:T.EmptyGroup(),custom:T.Group(fT(NJ))})};function kJ(e,t,r,n){var a=sn.create(0);if(n&&Fe.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(sn.is(a,2))return sn.is(a,2048)?e.threeTenHelix:sn.is(a,32768)?e.piHelix:e.alphaHelix;if(sn.is(a,4))return e.betaStrand;if(sn.is(a,8))return e.bend;if(sn.is(a,16))return e.turn;var o=N4(t,r);return 7===o?e.dna:6===o?e.rna:9===o?e.carbohydrate:5===o?e.coil:iN}function sN(e,t){var r=e.structure&&Oc.get(e.structure),n=r?Oh(r.id,r.version):-1,a=vw("default"===t.colors.name?NJ:t.colors.params,t.saturation,t.lightness);return{factory:sN,granularity:"group",preferSmoothing:!0,color:function i(o){return at.is(o)?kJ(a,o.unit,o.element,r?.value):zt.isLocation(o)?kJ(a,o.aUnit,o.aUnit.elements[o.aIndex],r?.value):iN},props:t,contextHash:n,description:"Assigns a color based on the type of secondary structure and basic molecule type.",legend:sm(Object.keys(a).map(function(o){return[o,a[o]]}).concat([["Other",iN]]))}}var r7e={name:"secondary-structure",label:"Secondary Structure",category:Xn.Residue,factory:sN,getParams:function t7e(e){return oN},defaultValues:T.getDefaultValues(oN),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Oc.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Oc.ref(e.structure,!1)}}},n7e=dt(13421772),LJ={list:T.ColorList("turbo",{presetKind:"scale"})};function UJ(e,t){var r=e.model;switch(e.kind){case 0:return r.atomicHierarchy.residues.label_seq_id.value(r.atomicHierarchy.residueAtomSegments.index[t]);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function VJ(e,t){var r=e.model,n="";switch(e.kind){case 0:n=r.atomicHierarchy.chains.label_entity_id.value(r.atomicHierarchy.chainAtomSegments.index[t]);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t)}if(""===n)return 0;var i=r.entities.getEntityIndex(n);if(-1===i)return 0;var o=r.sequence.byEntityKey[i];return void 0===o?0:o.sequence.length}var o7e={name:"sequence-id",label:"Sequence Id",category:Xn.Residue,factory:function GJ(e,t){var r=_c.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:GJ,granularity:"group",preferSmoothing:!0,color:function(a){if(at.is(a)){var i=a.unit,o=a.element;if((s=UJ(i,o))>0&&(u=VJ(i,o)))return r.setDomain(0,u-1),r.color(s)}else if(zt.isLocation(a)){var s,u,c=a.aUnit,l=a.aIndex;if((s=UJ(c,c.elements[l]))>0&&(u=VJ(c,c.elements[l])))return r.setDomain(0,u-1),r.color(s)}return n7e},props:t,description:"Gives every polymer residue a color based on its `seq_id` value.",legend:r?r.legend:void 0}},getParams:function i7e(e){return LJ},defaultValues:T.getDefaultValues(LJ),isApplicable:function(e){return!!e.structure}},s7e=dt(16777113),zJ={domain:T.Interval([0,100]),list:T.ColorList("red-white-blue",{presetKind:"scale"})};function HJ(e,t){return Fe.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Fe.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}var l7e={name:"uncertainty",label:"Uncertainty/Disorder",category:Xn.Atom,factory:function jJ(e,t){var r=_c.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});return{factory:jJ,granularity:"group",preferSmoothing:!0,color:function n(a){return at.is(a)?r.color(HJ(a.unit,a.element)):zt.isLocation(a)?r.color(HJ(a.aUnit,a.aUnit.elements[a.aIndex])):s7e},props:t,description:"Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",legend:r?r.legend:void 0}},getParams:function c7e(e){return zJ},defaultValues:T.getDefaultValues(zJ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},d7e=dt(15658734),qJ={style:T.MappedStatic("entity-id",{uniform:T.Group(z0),"chain-id":T.Group(S2),"entity-id":T.Group(x2),"entity-source":T.Group(A2),"molecule-type":T.Group(mT),"model-index":T.Group(D2),"structure-index":T.Group(I2)}),carbonLightness:T.Numeric(.8,{min:-6,max:6,step:.1})},h7e={name:"illustrative",label:"Illustrative",category:Xn.Misc,factory:function WJ(e,t){var r=function m7e(e,t){switch(t.name){case"uniform":return Kh(0,t.params);case"chain-id":return C2(e,t.params);case"entity-id":return w2(e,t.params);case"entity-source":return T2(e,t.params);case"molecule-type":return hT(0,t.params);case"model-index":return E2(e,t.params);case"structure-index":return P2(e,t.params);default:Sn()}}(e,t.style),n=r.color;function i(s,u){var c=n(s,!1);return"C"===u?dt.lighten(c,t.carbonLightness):c}return{factory:WJ,granularity:"group",preferSmoothing:!0,color:function o(s){if(at.is(s)&&Fe.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}return zt.isLocation(s)&&Fe.isAtomic(s.aUnit)?(u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(s.aUnit.elements[s.aIndex]),i(s,u)):d7e},props:t,description:"Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",legend:r.legend}},getParams:function p7e(e){return T.clone(qJ)},defaultValues:T.getDefaultValues(qJ),isApplicable:function(e){return!!e.structure}},YJ={list:T.ColorList("red-yellow-green",{presetKind:"scale"}),scale:T.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])},y7e={DGwif:0,DGwoct:1,"Oct-IF":2};function XJ(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function KJ(e,t){var r=e.coarseElements.seq_id_begin.value(t);if(r===e.coarseElements.seq_id_end.value(t))return e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence.compId.value(r-1)}var S7e={name:"hydrophobicity",label:"Hydrophobicity",category:Xn.Residue,factory:function ZJ(e,t){var r=y7e[t.scale],n=1/0,a=-1/0;for(var i in w4){var o=w4[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=_c.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});return{factory:ZJ,granularity:"group",preferSmoothing:!0,color:function u(c){var l;return at.is(c)?l=Fe.isAtomic(c.unit)?XJ(c.unit,c.element):KJ(c.unit,c.element):zt.isLocation(c)&&(l=Fe.isAtomic(c.aUnit)?XJ(c.aUnit,c.aUnit.elements[c.aIndex]):KJ(c.aUnit,c.aUnit.elements[c.aIndex])),s.color(l?function b7e(e,t){var r=w4[e];return void 0===r?0:r[t]}(l,r):0)},props:t,description:'Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',legend:s?s.legend:void 0}},getParams:function g7e(e){return YJ},defaultValues:T.getDefaultValues(YJ),isApplicable:function(e){return!!e.structure}},QJ=dt(13421772),$J=R({},ls({type:"colors",colorList:"purples"})),_7e={name:"trajectory-index",label:"Trajectory Index",category:Xn.Chain,factory:function JJ(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,c=o;u<c.length;u++)s=Math.max(s,(null===(r=ar.TrajectoryInfo.get(c[u]))||void 0===r?void 0:r.size)||0);var d=Vs(s,t);i=d.legend;for(var f=new Map,p=0,m=o.length;p<m;++p){var h=(null===(n=ar.TrajectoryInfo.get(o[p]))||void 0===n?void 0:n.index)||0;f.set(h,d.color(h))}a=function(v){return at.is(v)?f.get(ar.TrajectoryInfo.get(v.unit.model).index):zt.isLocation(v)?f.get(ar.TrajectoryInfo.get(v.aUnit.model).index):QJ}}else a=function(){return QJ};return{factory:JJ,granularity:"instance",color:a,props:t,description:"Gives every model (frame) a unique color based on the index in its trajectory.",legend:i}},getParams:function x7e(e){return T.clone($J)},defaultValues:T.getDefaultValues($J),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&ar.TrajectoryInfo.get(e.structure.models[0]).size>1}},w7e=dt(13421772),eee={domain:T.Interval([0,1]),list:T.ColorList("purples",{presetKind:"scale"})};function tee(e,t){return Fe.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}var D7e={name:"occupancy",label:"Occupancy",category:Xn.Atom,factory:function ree(e,t){var r=_c.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});return{factory:ree,granularity:"group",preferSmoothing:!0,color:function n(a){return at.is(a)?r.color(tee(a.unit,a.element)):zt.isLocation(a)?r.color(tee(a.aUnit,a.aUnit.elements[a.aIndex])):w7e},props:t,description:"Assigns a color based on the occupancy of an atom.",legend:r?r.legend:void 0}},getParams:function T7e(e){return eee},defaultValues:T.getDefaultValues(eee),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},uN="dark-2",nee=dt(13421772),aee=R({},ls({type:"colors",colorList:uN})),M2=1e4;function cN(e){return e.map(function(t){return"".concat(t+M2).padStart(5,"0")}).join("")}function lN(e){var t=function tDe(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}(M2,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return b.create(r-M2,n-M2,a-M2)}function dN(e){return e.map(function(t){return t+5}).join("")}function iee(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=cN(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();return o.forEach(function(c){return t.set(c,t.size)}),{min:lN(o[0]),max:lN(o[o.length-1]),map:t}}var P7e={name:"operator-hkl",label:"Operator HKL",category:Xn.Symmetry,factory:function oee(e,t){var r,n;if(e.structure){var a=iee(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(d,f){var p=d%s.size,m=dN(lN(f));void 0===u[p]?u[p]=m:u[p]+=", ".concat(m)});var c={minLabel:dN(i),maxLabel:dN(o),valueLabel:function(d){return u[d]}},l=Vs(s.size,t,c);n=l.legend,r=function(d){var f=void 0;if(at.is(d)){var p=cN(d.unit.conformation.operator.hkl);f=s.get(p)}else zt.isLocation(d)&&(p=cN(d.aUnit.conformation.operator.hkl),f=s.get(p));return void 0===f?nee:l.color(f)}}else r=function(){return nee};return{factory:oee,granularity:"instance",color:r,props:t,description:"Assigns a color based on the operator HKL value of a transformed chain.",legend:n}},getParams:function I7e(e){var t=T.clone(aee);return e.structure&&iee(e.structure.root).map.size>ru[uN].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=R(R({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:pf(uN).list}})),t},defaultValues:T.getDefaultValues(aee),isApplicable:function(e){return!!e.structure}},fN=dt(16777113),see={domain:T.Interval([-1,1]),list:T.ColorList("red-white-blue",{presetKind:"scale"})};function uee(e,t){var r;return null===(r=oy.Provider.get(e.model))||void 0===r?void 0:r.data.value(t)}var hu,O7e={name:"partial-charge",label:"Partial Charge",category:Xn.Atom,factory:function cee(e,t){var r=_c.create({domain:t.domain,listOrName:t.list.colors});return{factory:cee,granularity:"group",preferSmoothing:!0,color:function n(a){var i;return at.is(a)?void 0!==(i=uee(a.unit,a.element))?r.color(i):fN:zt.isLocation(a)&&void 0!==(i=uee(a.aUnit,a.aUnit.elements[a.aIndex]))?r.color(i):fN},props:t,description:"Assigns a color based on the partial charge of an atom.",legend:r?r.legend:void 0}},getParams:function R7e(e){return see},defaultValues:T.getDefaultValues(see),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return void 0!==oy.Provider.get(t)})}},lee=dt(16448250),dee=R({},ls({type:"colors",colorList:"many-distinct"})),L7e={name:"atom-id",label:"Atom Id",category:Xn.Atom,factory:function fee(e,t){var r,n;if(e.structure){var a=at.create(e.structure.root),i=function k7e(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var i=n[r].atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}(e.structure.root),o=Array.from(i.keys()),u=Vs(i.size,t,{valueLabel:function(c){return o[c]}});n=u.legend,r=function(c){var l=void 0;if(at.is(c)){var d=ot.atom.label_atom_id(c);l=i.get(d)}else zt.isLocation(c)&&(a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],d=ot.atom.label_atom_id(a),l=i.get(d));return void 0===l?lee:u.color(l)}}else r=function(){return lee};return{factory:fee,granularity:"group",preferSmoothing:!0,color:r,props:t,description:"Gives every atom a color based on its `label_atom_id` value.",legend:n}},getParams:function N7e(e){return T.clone(dee)},defaultValues:T.getDefaultValues(dee),isApplicable:function(e){return!!e.structure}},pee={colorList:T.ColorList({kind:"interpolate",colors:[[vr.white,0],[vr.red,.25],[vr.white,.5],[vr.blue,.75],[vr.white,1]]},{offsets:!0,isEssential:!0})},G7e={name:"volume-value",label:"Volume Value",category:Xn.Misc,factory:function mee(e,t){for(var r=_c.create({domain:[0,1],listOrName:t.colorList.colors}),n=[],a=0;a<256;++a)n[a]=r.color(a/255);return{factory:mee,granularity:"direct",props:t,description:"Assign color based on the given value of a volume cell.",legend:r.legend,palette:{colors:n,filter:"linear"}}},getParams:function V7e(e){return pee},defaultValues:T.getDefaultValues(pee),isApplicable:function(e){return!!e.volume&&!nt.Segmentation.get(e.volume)}},hee=dt(13421772),vee=R({},ls({type:"colors",colorList:"many-distinct"})),j7e={name:"volume-segment",label:"Volume Segment",category:Xn.Misc,factory:function gee(e,t){var r,n,a=e.volume&&nt.Segmentation.get(e.volume);if(a){var i=a.segments.size,o=Array.from(a.segments.keys()),s=Vs(i,t);n=s.legend,r=function(u){return nt.Segment.isLocation(u)?s.color(o.indexOf(u.segment)):hee}}else r=function(){return hee};return{factory:gee,granularity:"instance",color:r,props:t,description:"Gives every volume segment a unique color.",legend:n}},getParams:function H7e(e){return T.clone(vee)},defaultValues:T.getDefaultValues(vee),isApplicable:function(e){return!!e.volume&&!!nt.Segmentation.get(e.volume)}},yee={volume:T.ValueRef(function(e){return e.state.data.selectQ(function(r){return r.root.subtree().filter(function(n){var a;return nt.is(null===(a=n.obj)||void 0===a?void 0:a.data)})}).map(function(r){var n,a;return[r.transform.ref,null!==(a=null===(n=r.obj)||void 0===n?void 0:n.label)&&void 0!==a?a:"<unknown>"]})},function(e,t){return t(e)}),coloring:T.MappedStatic("absolute-value",{"absolute-value":T.Group({domain:T.MappedStatic("auto",{custom:T.Interval([-1,1]),auto:T.Group({symmetric:T.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:T.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":T.Group({domain:T.MappedStatic("auto",{custom:T.Interval([-1,1]),auto:T.Group({symmetric:T.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:T.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:T.Color(dt(13421772))},W7e={name:"external-volume",label:"External Volume",category:Xn.Misc,factory:function bee(e,t){var r,n;try{r=t.volume.getValue()}catch{}if(r){var a=t.coloring.params,i=r.grid.stats,o="custom"===a.domain.name?a.domain.params:[i.min,i.max],s="relative-value"===t.coloring.name;if("auto"===a.domain.name&&s&&(o[0]=(o[0]-i.mean)/i.sigma,o[1]=(o[1]-i.mean)/i.sigma),"auto"===t.coloring.params.domain.name&&t.coloring.params.domain.params.symmetric){var u=Math.max(Math.abs(o[0]),Math.abs(o[1]));o[0]=-u,o[1]=u}var c=_c.create({domain:o,listOrName:a.list.colors}),l=Ri.getGridToCartesianTransform(r.grid);he.invert(l,l);var d=b(),f=r.grid.cells.space,p=f.dimensions,m=f.get,h=r.grid.cells.data,v=p[0],g=p[1],y=p[2];n=function(S){if(!function APe(e){return!!e&&"position-location"===e.kind}(S))return t.defaultColor;b.copy(d,S.position),b.transformMat4(d,d,l);var C=Math.floor(d[0]),_=Math.floor(d[1]),x=Math.floor(d[2]);if(C<0||C>=v||_<0||_>=g||x<0||x>=y)return t.defaultColor;var D=d[0]-C,w=d[1]-_,A=d[2]-x,E=Math.min(C+1,v-1),I=Math.min(_+1,g-1),M=Math.min(x+1,y-1),F=m(h,C,_,x),N=m(h,E,_,x),j=m(h,C,I,x),U=m(h,E,I,x),H=ta(ta(F,N,D),ta(j,U,D),w);F=m(h,C,_,M),N=m(h,E,_,M),j=m(h,C,I,M),U=m(h,E,I,M);var z=ta(ta(F,N,D),ta(j,U,D),w),G=ta(H,z,A);return s&&(G=(G-i.mean)/i.sigma),c.color(G)}}else n=function(){return t.defaultColor};return{factory:bee,granularity:"vertex",preferSmoothing:!0,color:n,props:t,description:"Assigns a color based volume value at a given vertex."}},getParams:function(){return yee},defaultValues:T.getDefaultValues(yee),isApplicable:function(e){return!0}},See={mainchain:T.MappedStatic("molecule-type",{uniform:T.Group(z0),"chain-id":T.Group(S2),"entity-id":T.Group(x2),"entity-source":T.Group(A2),"molecule-type":T.Group(mT),"model-index":T.Group(D2),"structure-index":T.Group(I2),"secondary-structure":T.Group(oN)}),sidechain:T.MappedStatic("residue-name",{uniform:T.Group(z0),"residue-name":T.Group(nN),"element-symbol":T.Group(QB)})},Q7e={name:"cartoon",label:"Cartoon",category:Xn.Misc,factory:function Cee(e,t){var r,n,a=function K7e(e,t){switch(t.name){case"uniform":return Kh(0,t.params);case"chain-id":return C2(e,t.params);case"entity-id":return w2(e,t.params);case"entity-source":return T2(e,t.params);case"molecule-type":return hT(0,t.params);case"model-index":return E2(e,t.params);case"structure-index":return P2(e,t.params);case"secondary-structure":return sN(e,t.params);default:Sn()}}(e,t.mainchain),i=function Z7e(e,t){switch(t.name){case"uniform":return Kh(0,t.params);case"residue-name":return aN(0,t.params);case"element-symbol":return $B(e,t.params);default:Sn()}}(e,t.sidechain),s=a.legend;return"table-legend"===(null===(r=a.legend)||void 0===r?void 0:r.kind)&&"table-legend"===(null===(n=i.legend)||void 0===n?void 0:n.kind)&&(s={kind:"table-legend",table:or(or([],a.legend.table,!0),i.legend.table,!0)}),{factory:Cee,granularity:"group",preferSmoothing:!1,color:function o(u,c){return c?a.color(u,!1):i.color(u,!1)},props:t,description:"Uses separate themes for coloring mainchain and sidechain visuals.",legend:s}},getParams:function X7e(e){return T.clone(See)},defaultValues:T.getDefaultValues(See),isApplicable:function(e){return!!e.structure}};!function(e){e.Category=Xn,e.PaletteScale=16777215,e.EmptyFactory=function(){return e.Empty};var t=dt(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}},e.areEqual=function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&rd(a.props,i.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}},e.createRegistry=function n(){return new Eee(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={"atom-id":L7e,"carbohydrate-symbol":tHe,cartoon:Q7e,"chain-id":uJ,"element-index":pHe,"element-symbol":GHe,"entity-id":xHe,"entity-source":DHe,hydrophobicity:S7e,illustrative:h7e,"model-index":PHe,"molecule-type":jHe,occupancy:D7e,"operator-hkl":P7e,"operator-name":qB,"partial-charge":O7e,"polymer-id":YHe,"polymer-index":ZHe,"residue-name":JHe,"secondary-structure":r7e,"sequence-id":o7e,"shape-group":T4e,"structure-index":OHe,"trajectory-index":_7e,uncertainty:l7e,"unit-index":NHe,uniform:XOe,"volume-segment":j7e,"volume-value":G7e,"external-volume":W7e}}(hu||(hu={}));var xee={scale:T.Numeric(1,{min:.1,max:5,step:.1})};function pN(e,t){return Fe.isAtomic(e)?n2(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Fe.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}var t9e={name:"physical",label:"Physical",category:"",factory:function _ee(e,t){var r=void 0===t.scale?1:t.scale;return{factory:_ee,granularity:"group",size:function n(a){return at.is(a)?r*pN(a.unit,a.element):zt.isLocation(a)?r*Math.min(pN(a.aUnit,a.aUnit.elements[a.aIndex]),pN(a.bUnit,a.bUnit.elements[a.bIndex])):1*r},props:t,description:"Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres."}},getParams:function e9e(e){return xee},defaultValues:T.getDefaultValues(xee),isApplicable:function(e){return!!e.structure}},wee={bfactorFactor:T.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:T.Numeric(.05,{min:0,max:1,step:.01}),baseSize:T.Numeric(.2,{min:0,max:2,step:.1})};function Aee(e,t,r){return Fe.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:Fe.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}var ki,_i,a9e={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:function Tee(e,t){return{factory:Tee,granularity:"group",size:function r(n){var a=t.baseSize;return at.is(n)?a+=Aee(n.unit,n.element,t):zt.isLocation(n)&&(a+=Aee(n.aUnit,n.aUnit.elements[n.aIndex],t)),a},props:t,description:"Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique."}},getParams:function n9e(e){return wee},defaultValues:T.getDefaultValues(wee),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}};function Dee(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}!function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}},e.areEqual=function t(n,a){return n.contextHash===a.contextHash&&n.factory===a.factory&&rd(n.props,a.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}},e.createRegistry=function r(){return new Eee(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={physical:t9e,"shape-group":x4e,uncertainty:a9e,uniform:QOe}}(ki||(ki={})),function(e){function r(){return{color:hu.Empty,size:ki.Empty}}e.create=function t(i,o,s,u){u=u||r();var c=s.colorTheme,l=s.sizeTheme;return u.color=i.colorThemeRegistry.create(c.name,o,c.params),u.size=i.sizeThemeRegistry.create(l.name,o,l.params),u},e.createEmpty=r,e.ensureDependencies=function n(i,o,s,u){var c,l;return ue(this,void 0,void 0,function(){return ce(this,function(d){switch(d.label){case 0:return[4,null===(c=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)||void 0===c?void 0:c.attach(i,s)];case 1:return d.sent(),[4,null===(l=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)||void 0===l?void 0:l.attach(i,s)];case 2:return d.sent(),[2]}})})},e.releaseDependencies=function a(i,o,s){var u,c;null===(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)||void 0===u||u.detach(o),null===(c=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)||void 0===c||c.detach(o)}}(_i||(_i={}));var ds,Eee=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,Fs(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. ".concat(a.name," ").concat(i));n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return Dee(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered theme provider."));return this._name.get(t)},e.prototype.create=function(t,r,n){void 0===n&&(n={});var a=this.get(t);return a.factory(r,R(R({},T.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return Dee(this.getApplicableList(t))},e.prototype.clear=function(){this._list.length=0,this._map.clear(),this._name.clear()},e}(),Ut=function(e){return e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear",e}(Ut||{});function mN(e,t,r){switch(r){case Ut.Highlight:e[t]|=1;break;case Ut.RemoveHighlight:e[t]&=-2;break;case Ut.Select:e[t]|=2;break;case Ut.Deselect:e[t]&=-3;break;case Ut.Toggle:e[t]^=2;break;case Ut.Clear:e[t]=0}}function hN(e,t,r){if(r===Ut.None)return!1;if(_e.is(t)){var n=_e.start(t),a=_e.end(t),i=n+3>>2,o=i+(a-4*i>>2);if(o<=i){for(var s=n;s<a;++s)mN(e,s,r);return!0}var u=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),c=n,l=Math.min(4*i,a),d=Math.max(n,4*o),f=a;switch(r){case Ut.Highlight:for(s=i;s<o;++s)u[s]|=16843009;break;case Ut.RemoveHighlight:for(s=i;s<o;++s)u[s]&=-16843010;break;case Ut.Select:for(s=i;s<o;++s)u[s]|=33686018;break;case Ut.Deselect:for(s=i;s<o;++s)u[s]&=-33686019;break;case Ut.Toggle:for(s=i;s<o;++s)u[s]^=33686018;break;case Ut.Clear:for(s=i;s<o;++s)u[s]=0;break;default:Sn()}for(s=c;s<l;++s)mN(e,s,r);for(s=d;s<f;++s)mN(e,s,r)}else switch(r){case Ut.Highlight:s=0;for(var p=t.length;s<p;++s)e[t[s]]|=1;break;case Ut.RemoveHighlight:for(s=0,p=t.length;s<p;++s)e[t[s]]&=-2;break;case Ut.Select:for(s=0,p=t.length;s<p;++s)e[t[s]]|=2;break;case Ut.Deselect:for(s=0,p=t.length;s<p;++s)e[t[s]]&=-3;break;case Ut.Toggle:for(s=0,p=t.length;s<p;++s)e[t[s]]^=2;break;case Ut.Clear:for(s=0,p=t.length;s<p;++s)e[t[s]]=0;break;default:Sn()}return!0}!function(e){e.is=Vo.has,e.All=Ut.Highlight|Ut.RemoveHighlight|Ut.Select|Ut.Deselect|Ut.Toggle|Ut.Clear,e.Highlighting=Ut.Highlight|Ut.RemoveHighlight|Ut.Clear,e.Selecting=Ut.Select|Ut.Deselect|Ut.Toggle|Ut.Clear,e.isReverse=function t(r,n){return r===Ut.Highlight&&n===Ut.RemoveHighlight||r===Ut.RemoveHighlight&&n===Ut.Highlight||r===Ut.Select&&n===Ut.Deselect||r===Ut.Deselect&&n===Ut.Select||r===Ut.Toggle&&n===Ut.Toggle}}(ds||(ds={}));var gT={kind:"every-loci"};function vu(e){return!!e&&"every-loci"===e.kind}var fr,Od,Wr={kind:"empty-loci"};function fs(e){return!!e&&"empty-loci"===e.kind}function R2(e){return!!e&&"data-loci"===e.kind}function yT(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}function Io(e,t){return{kind:e,layers:t}}function Po(e,t){return{kind:e,layers:t}}!function(e){var t=new Lu("98");function s(h,v){var g;if("every-loci"!==h.kind&&"empty-loci"!==h.kind){if(v||(v=Pe()),"structure-loci"===h.kind)return Pe.copy(v,h.structure.boundary.sphere);if("element-loci"===h.kind)return Pe.copy(v,Re.getBoundary(h).sphere);if("bond-loci"===h.kind)return zt.getBoundingSphere(h,v);if("shape-loci"===h.kind)return Pe.copy(v,h.shape.geometry.boundingSphere);if("group-loci"===h.kind)return Ho.getBoundingSphere(h,v);if("data-loci"===h.kind)return null===(g=h.getBoundingSphere)||void 0===g?void 0:g.call(h,v);if("volume-loci"===h.kind)return nt.getBoundingSphere(h.volume,v);if("isosurface-loci"===h.kind)return nt.Isosurface.getBoundingSphere(h.volume,h.isoValue,v);if("cell-loci"===h.kind)return nt.Cell.getBoundingSphere(h.volume,h.indices,v);if("segment-loci"===h.kind)return nt.Segment.getBoundingSphere(h.volume,h.segments,v)}}e.getBundleBoundingSphere=function r(h){var v=h.loci.map(function(x){return s(x)}).filter(function(x){return!!x});t.reset();for(var g=0,y=v;g<y.length;g++)t.includePositionRadius((S=y[g]).center,S.radius);t.finishedIncludeStep();for(var C=0,_=v;C<_.length;C++){var S;t.radiusPositionRadius((S=_[C]).center,S.radius)}return t.getSphere()},e.areEqual=function n(h,v){return!!(vu(h)&&vu(v)||fs(h)&&fs(v))||(R2(h)&&R2(v)?function u9e(e,t){if(!R1(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!R1(e.elements[r],t.elements[r]))return!1;return!0}(h,v):Ze.isLoci(h)&&Ze.isLoci(v)?Ze.areLociEqual(h,v):Re.is(h)&&Re.is(v)?Re.areEqual(h,v):zt.isLoci(h)&&zt.isLoci(v)?zt.areLociEqual(h,v):qr.isLoci(h)&&qr.isLoci(v)?qr.areLociEqual(h,v):Ho.isLoci(h)&&Ho.isLoci(v)?Ho.areLociEqual(h,v):nt.isLoci(h)&&nt.isLoci(v)?nt.areLociEqual(h,v):nt.Isosurface.isLoci(h)&&nt.Isosurface.isLoci(v)?nt.Isosurface.areLociEqual(h,v):nt.Cell.isLoci(h)&&nt.Cell.isLoci(v)?nt.Cell.areLociEqual(h,v):!(!nt.Segment.isLoci(h)||!nt.Segment.isLoci(v))&&nt.Segment.areLociEqual(h,v))},e.isEvery=function a(h){return!!h&&"every-loci"===h.kind},e.isEmpty=function i(h){return!vu(h)&&(!!fs(h)||(R2(h)?function c9e(e){return 0===e.elements.length}(h):Ze.isLoci(h)?Ze.isLociEmpty(h):Re.is(h)?Re.isEmpty(h):zt.isLoci(h)?zt.isLociEmpty(h):qr.isLoci(h)?qr.isLociEmpty(h):Ho.isLoci(h)?Ho.isLociEmpty(h):nt.isLoci(h)?nt.isLociEmpty(h):nt.Isosurface.isLoci(h)?nt.Isosurface.isLociEmpty(h):nt.Cell.isLoci(h)?nt.Cell.isLociEmpty(h):!!nt.Segment.isLoci(h)&&nt.Segment.isLociEmpty(h)))},e.remap=function o(h,v){return v instanceof Ze&&(Re.is(h)?h=Re.remap(h,v):Ze.isLoci(h)?h=Ze.remapLoci(h,v):zt.isLoci(h)&&(h=zt.remapLoci(h,v))),h},e.getBoundingSphere=s;var u=Pe.zero();e.getCenter=function c(h,v){var g=s(h,u);return g?b.copy(v||b(),g.center):void 0},e.getPrincipalAxes=function l(h){if("every-loci"!==h.kind&&"empty-loci"!==h.kind){if("structure-loci"===h.kind)return Re.getPrincipalAxes(Ze.toStructureElementLoci(h.structure));if("element-loci"===h.kind)return Re.getPrincipalAxes(h);if("bond-loci"===h.kind)return;if("shape-loci"===h.kind)return;if("group-loci"===h.kind)return;if("data-loci"===h.kind)return;if("volume-loci"===h.kind)return;if("isosurface-loci"===h.kind)return;if("cell-loci"===h.kind)return;if("segment-loci"===h.kind)return}};var d={element:function(h){return h},residue:function(h){return Re.is(h)?Re.extendToWholeResidues(h,!0):h},chain:function(h){return Re.is(h)?Re.extendToWholeChains(h):h},entity:function(h){return Re.is(h)?Re.extendToWholeEntities(h):h},model:function(h){return Re.is(h)?Re.extendToWholeModels(h):h},operator:function(h){return Re.is(h)?Re.extendToWholeOperators(h):h},structure:function(h){return Re.is(h)?Ze.toStructureElementLoci(h.structure):Ho.isLoci(h)?qr.Loci(h.shape):nt.Cell.isLoci(h)?nt.Loci(h.volume):h},elementInstances:function(h){return Re.is(h)?Re.extendToAllInstances(h):h},residueInstances:function(h){return Re.is(h)?Re.extendToAllInstances(Re.extendToWholeResidues(h,!0)):h},chainInstances:function(h){return Re.is(h)?Re.extendToAllInstances(Re.extendToWholeChains(h)):h}};function p(h,v){return d[v](h)}e.GranularityOptions=T.objectToOptions(d,function(h){switch(h){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return h.indexOf("Instances")?[yc(h),"With Symmetry"]:yc(h)}}),e.simpleGranularity=function f(h){return h.replace("Instances","")},e.applyGranularity=p,e.normalize=function m(h,v,g){return void 0===g&&(g=!1),("element"!==v||g)&&zt.isLoci(h)&&(h=zt.toStructureElementLoci(h)),Ze.isLoci(h)&&(h=Ze.toStructureElementLoci(h.structure)),Re.is(h)&&(h=Re.remap(h,h.structure.root)),v&&(h=p(h,v)),h}}(fr||(fr={})),function(e){function r(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,l){if(0===c.layers.length&&0===l.layers.length)return!0;if(c.layers.length!==l.layers.length)return!1;for(var d=0,f=c.layers.length;d<f;++d)if(c.layers[d].clear!==l.layers[d].clear||c.layers[d].color!==l.layers[d].color||!fr.areEqual(c.layers[d].loci,l.layers[d].loci))return!1;return!0},e.isEmpty=r,e.remap=function n(c,l){if("element-loci"===c.kind){for(var d=[],f=0,p=c.layers;f<p.length;f++){var m=p[f],h=m.loci,v=m.color,g=m.clear;h=Re.remap(h,l),Re.isEmpty(h)||d.push({loci:h,color:v,clear:g})}return{kind:"element-loci",layers:d}}return c},e.merge=function a(c){if(r(c))return c;if("element-loci"===c.kind){for(var l=c.layers[0].loci.structure,d=new Map,f=Re.none(l),p=0,m=c.layers.length;p<m;++p){var h=c.layers[m-p-1],v=h.loci,g=h.color,y=h.clear;if(v=Re.subtract(v,f),f=Re.union(v,f),!Re.isEmpty(v)){var S=y?-1:g;d.has(S)&&(v=Re.union(v,d.get(S))),d.set(S,v)}}var C=[];return d.forEach(function(_,x){var D=-1===x,w=D?dt(0):x;C.push({loci:_,color:w,clear:D})}),{kind:"element-loci",layers:C}}return c},e.filter=function i(c,l){if(r(c))return c;if("element-loci"===c.kind){for(var d=c.layers[0].loci.structure,f=[],p=0,m=c.layers;p<m.length;p++){var h=m[p],v=h.loci,g=h.color,y=h.clear,S=Re.remap(v,l);v=Re.remap(S,d),Re.isEmpty(v)||f.push({loci:v,color:g,clear:y})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function o(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var m=c[f],v=m.color,g=m.clear,y=Ni.toLoci(m.script,l);Re.isEmpty(y)||d.push({loci:y,color:v,clear:g})}return{kind:"element-loci",layers:d}},e.ofBundle=function s(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var m=c[f],v=m.color,g=m.clear,y=rn.toLoci(m.bundle,l.root);d.push({loci:y,color:v,clear:g})}return{kind:"element-loci",layers:d}},e.toBundle=function u(c){for(var l=[],d=0,f=c.layers.length;d<f;++d){var p=c.layers[d],h=p.color,v=p.clear,g=rn.fromLoci(p.loci);l.push({bundle:g,color:h,clear:v})}return{kind:"element-loci",layers:l}}}(Io||(Io={})),function(e){function r(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,l){if(0===c.layers.length&&0===l.layers.length)return!0;if(c.layers.length!==l.layers.length)return!1;for(var d=0,f=c.layers.length;d<f;++d)if(c.layers[d].value!==l.layers[d].value||!fr.areEqual(c.layers[d].loci,l.layers[d].loci))return!1;return!0},e.isEmpty=r,e.remap=function n(c,l){if("element-loci"===c.kind){for(var d=[],f=0,p=c.layers;f<p.length;f++){var m=p[f],h=Re.remap(m.loci,l);Re.isEmpty(h)||d.push({loci:h,value:m.value})}return{kind:"element-loci",layers:d}}return c},e.merge=function a(c){if(r(c))return c;if("element-loci"===c.kind){for(var l=c.layers[0].loci.structure,d=new Map,f=Re.none(l),p=0,m=c.layers.length;p<m;++p){var h=c.layers[m-p-1],v=h.loci,g=h.value;v=Re.subtract(v,f),f=Re.union(v,f),Re.isEmpty(v)||(d.has(g)&&(v=Re.union(v,d.get(g))),d.set(g,v))}var y=[];return d.forEach(function(S,C){y.push({loci:S,value:C})}),{kind:"element-loci",layers:y}}return c},e.filter=function i(c,l){if(r(c))return c;if("element-loci"===c.kind){for(var d=c.layers[0].loci.structure,f=[],p=0,m=c.layers;p<m.length;p++){var h=m[p],v=h.loci,g=h.value,y=Re.remap(v,l);v=Re.remap(y,d),Re.isEmpty(v)||f.push({loci:v,value:g})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function o(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var m=c[f],v=m.value,g=Ni.toLoci(m.script,l);Re.isEmpty(g)||d.push({loci:g,value:v})}return{kind:"element-loci",layers:d}},e.ofBundle=function s(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var m=c[f],v=m.value,g=rn.toLoci(m.bundle,l.root);d.push({loci:g,value:v})}return{kind:"element-loci",layers:d}},e.toBundle=function u(c){for(var l=[],d=0,f=c.layers.length;d<f;++d){var p=c.layers[d],h=p.value,v=rn.fromLoci(p.loci);l.push({bundle:v,value:h})}return{kind:"element-loci",layers:l}}}(Po||(Po={})),function(e){e.create=function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}},e.reset=function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}}(Od||(Od={}));var l9e={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function Iee(e,t){void 0===t&&(t={});var r=R(R({},l9e),t),n=e.elementCount*r.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function vN(e,t){var r=po(e.quality,"auto"),n=po(e.detail,1),a=po(e.radialSegments,12),i=po(e.linearSegments,8),o=po(e.resolution,2),s=po(e.probePositions,12),u=po(e.doubleSided,!0),c=0;if("auto"===r)if(t instanceof Ze)r=Iee(t.root),c=function d9e(e){if(1===e.root.models.length){var t=Ja.Provider.get(e.root.model);if(t&&"P 1"===t.spacegroup.name&&!ns.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Nt.volume(e.root.boundary.box)}(t);else if(nt.is(t)){var l=t.grid.cells.space.dimensions;r=(c=l[0]*l[1]*l[2])<1e7?"medium":"low"}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1}return o=Math.max(o,c/5e8),o=Math.min(o,20),"off"===e.transparentBackfaces&&(void 0!==e.alpha&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var bT=b.set,Pee=b.normalize,Mee=b.sub,Ree=b.addScalar,ST=b.scale,Oee=b.toArray;function CT(e,t,r,n){var a=!1;if(nt.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;n(_e.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(nt.Isosurface.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;if(r?.isoValue){if(!nt.IsoValue.areSame(e.isoValue,r.isoValue,t.grid.stats))return!1;n(_e.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,c=nt.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,l=0,d=s.length;l<d;++l)ea(c,s[l],u)&&n(_e.ofSingleton(l))&&(a=!0)}else if(nt.Cell.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;_e.is(e.indices)?n(e.indices)&&(a=!0):ke.forEach(e.indices,function(v){n(_e.ofSingleton(v))&&(a=!0)})}else if(nt.Segment.isLoci(e)){if(!nt.areEquivalent(e.volume,t))return!1;if(r?.segments){if(!Ye.areIntersecting(e.segments,r.segments))return!1;n(_e.ofLength(t.grid.cells.data.length))&&(a=!0)}else{var f=nt.Segmentation.get(t);if(f){var p=new Set;for(l=0,d=e.segments.length;l<d;++l)sa.add(p,f.segments.get(e.segments[l]));var m=Array.from(p.values()),h=t.grid.cells.data;for(l=0,d=h.length;l<d;++l)m.includes(h[l])&&n(_e.ofSingleton(l))&&(a=!0)}}}return a}function Cm(e,t){void 0===t&&(t=0);var n=Math.sqrt(e[0]*e[1]*e[2]),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(i*=u=Math.floor(a/i),o*=s=Math.ceil(e[2]/u)):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:2*a}}function Fee(e,t,r){void 0===r&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,c=s.min,l=i.dimensions,d=i.dataOffset,f=Cm(l,r),p=f.width,m=f.height,h="data"===t?1:4,v=new Uint8Array(p*m*h),g={array:v,width:p,height:m},y=u-c,S=l[0],C=l[1],_=l[2],x=S+r,D=C+r,w=b(),A=b(),E=S-1,I=C-1,M=_-1,F=0;F<_;++F)for(var N=0;N<C;++N)for(var j=0;j<S;++j){var U=Math.floor(F*x%p/x),G=h*(Math.floor(F*x/p)*D*p+N*p+(U*x+j)),J=d(j,N,F);"data"===t?v[G]=Math.round((o[J]-c)/y*255):("groups"===t?GS(J,v,G):(bT(w,o[d(Math.max(0,j-1),N,F)],o[d(j,Math.max(0,N-1),F)],o[d(j,N,Math.max(0,F-1))]),bT(A,o[d(Math.min(E,j+1),N,F)],o[d(j,Math.min(I,N+1),F)],o[d(j,N,Math.min(M,F+1))]),Pee(w,Mee(w,w,A)),Ree(w,ST(w,w,.5),.5),Oee(ST(w,w,255),v,G)),v[G+3]=Math.round((o[J]-c)/y*255))}return g}function xT(e,t,r,n,a){var o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,c=e.transformBuffer,l=e.groupBuffer,d=e.itemSize,f=e.colorType.endsWith("Instance"),p=Nt.fromSphere3D(Nt(),f?e.boundingSphere:e.invariantBoundingSphere),m=1+t,h=Nt.expand(Nt(),p,b.create(m,m,m)),v=1/t,g=Nt.scale(Nt(),h,v),y=Nt.size(b(),g);b.ceil(y,y),b.add(y,y,b.create(2,2,2));for(var Je,mt,ut,St,S=h.min,C=y[0],_=y[1],x=Cm(y),D=x.width,w=x.height,A=new Float32Array(D*w*d),E=new Float32Array(D*w),I=new Uint8Array(D*w*d),M={array:I,width:D,height:w,filter:"linear"},F=f?e.instanceCount:1,N=e.colorData.array,H=y[0],z=y[1],G=y[2],J=b(),X=0;X<F;++X)for(var Z=0;Z<o;Z+=r){b.fromArray(J,u,3*Z),f&&b.transformMat4Offset(J,J,c,0,0,16*X),b.sub(J,J,S),b.scale(J,J,v);for(var ne=J[0],Y=J[1],k=J[2],W=Math.floor(ne),$=Math.floor(Y),K=Math.floor(k),q=(X*s+l[Z])*d,V=Math.max(0,W-2),ee=Math.max(0,$-2),ae=Math.max(0,K-2),pe=Math.min(H,W+2+2),me=Math.min(z,$+2+2),de=Math.min(G,K+2+2),re=V;re<pe;++re)for(var te=re-ne,le=ee;le<me;++le)for(var ge=le-Y,xe=ae;xe<de;++xe){var Ge=xe-k,je=Math.sqrt(te*te+ge*ge+Ge*Ge);if(!(je>2)){for(var L=2-je,Q=(Je=re,mt=le,ut=xe,void 0,void 0,St=Math.floor(ut*C%D/C),d*(Math.floor(ut*C/D)*_*D+mt*D+(St*C+Je))),ye=0;ye<d;++ye)A[Q+ye]+=N[q+ye]*L;E[Q/d]+=L}}}X=0;for(var we=E.length;X<we;++X){var De=X*d,Oe=E[X];for(ye=0;ye<d;++ye)I[De+ye]=Math.round(A[De+ye]/Oe)}var Ne=Be.create(D,w),Ue=dr.create(S[0],S[1],S[2],v),$e=f?"volumeInstance":"volume";if(n)return a||(a=n.resources.texture("image-uint8",4===d?"rgba":3===d?"rgb":"alpha","ubyte","linear")),a.load(M),{kind:"volume",texture:a,gridTexDim:Ne,gridDim:y,gridTransform:Ue,type:$e};var He=function m9e(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,c=e.colorStride,l=e.itemOffset||0,d=e.outputStride;if(d+l>c)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");var f=e.colorType.endsWith("Instance"),p=f?e.instanceCount:1,m=gi(Math.max(1,p*t),d,Uint8Array),h=m.array,v=i[0],g=i[1],y=o[0],S=b.fromArray(b(),s,0),C=s[3];function _(ye,we,De){var Oe=Math.floor(De*v%y/v),Ne=Math.floor(De*v/y);return c*(Ne*g*y+we*y+(Oe*v+ye))}for(var x=b(),D=b(),w=b(),A=b(),E=0;E<p;++E)for(var I=0;I<t;++I){b.fromArray(x,r,I*u),f&&b.transformMat4Offset(x,x,n,0,0,16*E),b.sub(x,x,S),b.scale(x,x,C),b.floor(D,x),b.ceil(w,x),b.sub(A,x,D),b.sub(x,w,D),b.div(A,A,x);for(var M=D[0],F=D[1],N=D[2],j=w[0],U=w[1],H=w[2],z=A[0],G=A[1],J=A[2],X=_(M,F,N)+l,Z=_(j,F,N)+l,ne=_(M,F,H)+l,Y=_(j,F,H)+l,k=_(M,U,N)+l,W=_(j,U,N)+l,$=_(M,U,H)+l,K=_(j,U,H)+l,q=(E*t+I)*d,V=0;V<d;++V){var pe=a[ne+V],me=a[Y+V],de=a[k+V],re=a[W+V],te=a[$+V],le=a[K+V],ge=ta(a[X+V],a[Z+V],z),xe=ta(pe,me,z),Ge=ta(de,re,z),je=ta(te,le,z),L=ta(ge,Ge,G),Q=ta(xe,je,G);h[q+V]=ta(L,Q,J)}}return m}({vertexCount:o,instanceCount:F,transformBuffer:c,positionBuffer:u,colorType:$e,grid:I,gridDim:y,gridTexDim:Ne,gridTransform:Ue,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:He,texDim:Be.create(He.width,He.height),type:f?"vertexInstance":"vertex"}}function _T(e,t,r,n,a){if(function h9e(e){return"group"===e||"groupInstance"===e}(e.dColorType.ref.value)){var i=xT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dColorType,i.type),O.update(e.tColorGrid,i.texture),O.update(e.uColorTexDim,i.gridTexDim),O.update(e.uColorGridDim,i.gridDim),O.update(e.uColorGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dColorType,i.type),O.update(e.tColor,i.texture),O.update(e.uColorTexDim,i.texDim))}}var x9e="\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tCount;\nuniform vec2 uTexSize;\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n    float count = texture2D(tCount, coords).r;\n\n    gl_FragColor = color / count;\n}\n",_9e="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uResolution;\n\nconst float p = 2.0;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition);\n    if (dist > p) discard;\n\n    float f = p - dist;\n    gl_FragColor = vColor * f;\n    gl_FragData[1] = vec4(f);\n}\n",w9e="\nprecision highp float;\n\n#include common\n#include read_from_texture\n\nuniform int uGroupCount;\n\nattribute float aSample;\n#define SampleID int(aSample)\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform vec2 uGeoTexDim;\nuniform sampler2D tPosition;\nuniform sampler2D tGroup;\n\nuniform vec2 uColorTexDim;\nuniform sampler2D tColor;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;\n    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);\n\n    position = (aTransform * vec4(position, 1.0)).xyz;\n    gl_PointSize = 7.0;\n    vPosition = (position - uBboxMin) / uResolution;\n    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n\n    #if defined(dColorType_group)\n        vColor = readFromTexture(tColor, group, uColorTexDim);\n    #elif defined(dColorType_groupInstance)\n        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);\n    #endif\n}\n",A9e={drawCount:oa("number"),instanceCount:oa("number"),stride:oa("number"),uGroupCount:Ae("i","material"),aTransform:Tn("float32",16,1),aInstance:Tn("float32",1,1),aSample:Tn("float32",1,0),uGeoTexDim:Ae("v2","material"),tPosition:Xt("texture","rgba","float","nearest","material"),tGroup:Xt("texture","rgba","float","nearest","material"),uColorTexDim:Ae("v2","material"),tColor:Xt("texture","rgba","ubyte","nearest","material"),dColorType:Lt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ae("f"),uCurrentX:Ae("f"),uCurrentY:Ae("f"),uBboxMin:Ae("v3","material"),uBboxSize:Ae("v3","material"),uResolution:Ae("f","material")},Qu="color-accumulate",O2="color-count";function Bee(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}var I9e=R(R({},yi),{tColor:Xt("texture","rgba","float","nearest"),tCount:Xt("texture","alpha","float","nearest"),uTexSize:Ae("v2")}),F2="color-normalize";function wT(e,t,r,n,a){var i=n.extensions.drawBuffers;if(!i)throw new Error("need WebGL draw buffers");xt&&n.timer.mark("calcTextureMeshColorSmoothing");var o=n.gl,s=n.resources,u=n.state,c=n.extensions,l=c.colorBufferHalfFloat,d=c.textureHalfFloat,f=e.colorType.endsWith("Instance"),p=Nt.fromSphere3D(Nt(),f?e.boundingSphere:e.invariantBoundingSphere),m=1+t,h=Nt.expand(Nt(),p,b.create(m,m,m)),v=1/t,g=Nt.scale(Nt(),h,v),y=Nt.size(b(),g);b.ceil(y,y),b.add(y,y,b.create(2,2,2));var S=h.min,C=y[0],_=y[1],x=y[2],D=function O9e(e){var r=Math.sqrt(e[0]*e[1]*e[2]),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:2*n}}(y),w=D.texDimX,A=D.texDimY,E=D.texCols;n.namedFramebuffers[Qu]||(n.namedFramebuffers[Qu]=n.resources.framebuffer());var I=n.namedFramebuffers[Qu];$t(o)?(n.namedTextures[Qu]||(n.namedTextures[Qu]=l&&d?s.texture("image-float16","rgba","fp16","nearest"):s.texture("image-float32","rgba","float","nearest")),n.namedTextures[O2]||(n.namedTextures[O2]=s.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[Qu]||(n.namedTextures[Qu]=s.texture("image-float32","rgba","float","nearest")),n.namedTextures[O2]||(n.namedTextures[O2]=s.texture("image-float32","rgba","float","nearest")));var M=n.namedTextures[Qu],F=n.namedTextures[O2];M.define(w,A),F.define(w,A),M.attachFramebuffer(I,0),F.attachFramebuffer(I,1);var N=function T9e(e,t,r,n,a){if(e.namedComputeRenderables[Qu]){var i=b.sub(b(),r.max,r.min),o=e.namedComputeRenderables[Qu].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&O.update(o.aSample,Bee(s,a)),O.updateIfChanged(o.drawCount,s),O.updateIfChanged(o.instanceCount,t.instanceCount),O.updateIfChanged(o.stride,a),O.updateIfChanged(o.uGroupCount,t.groupCount),O.update(o.aTransform,t.transformBuffer),O.update(o.aInstance,t.instanceBuffer),O.update(o.uGeoTexDim,Be.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),O.update(o.tPosition,t.positionTexture),O.update(o.tGroup,t.groupTexture),O.update(o.uColorTexDim,Be.set(o.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),O.update(o.tColor,t.colorData),O.updateIfChanged(o.dColorType,t.colorType),O.updateIfChanged(o.uCurrentSlice,0),O.updateIfChanged(o.uCurrentX,0),O.updateIfChanged(o.uCurrentY,0),O.update(o.uBboxMin,r.min),O.update(o.uBboxSize,i),O.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[Qu].update()}else e.namedComputeRenderables[Qu]=function D9e(e,t,r,n,a){var i=b.sub(b(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:O.create(o),instanceCount:O.create(t.instanceCount),stride:O.create(a),uGroupCount:O.create(t.groupCount),aTransform:O.create(t.transformBuffer),aInstance:O.create(t.instanceBuffer),aSample:O.create(Bee(o,a)),uGeoTexDim:O.create(Be.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:O.create(t.positionTexture),tGroup:O.create(t.groupTexture),uColorTexDim:O.create(Be.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:O.create(t.colorData),dColorType:O.create(t.colorType),uCurrentSlice:O.create(0),uCurrentX:O.create(0),uCurrentY:O.create(0),uBboxMin:O.create(r.min),uBboxSize:O.create(i),uResolution:O.create(n)},u=R({},A9e);return Va(Ua(e,"points",Fn("accumulate",w9e,_9e,{drawBuffers:"required"}),u,s),s)}(e,t,r,n,a);return e.namedComputeRenderables[Qu]}(n,e,h,t,r);u.currentRenderItemId=-1,I.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);var j=N.values,U=j.uCurrentSlice,H=j.uCurrentX,z=j.uCurrentY;xt&&n.timer.mark("ColorAccumulate.render"),function E9e(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}(n),u.viewport(0,0,w,A),u.scissor(0,0,w,A),o.clear(o.COLOR_BUFFER_BIT),O.update(z,0);for(var G=0,J=0,X=0,Z=0;Z<x;++Z)G>=E&&(G-=E,X=0,O.update(z,J+=_)),O.update(H,X),O.update(U,Z),u.viewport(X,J,C,_),u.scissor(X,J,C,_),N.render(),++G,X+=C;M.detachFramebuffer(I,0),F.detachFramebuffer(I,1),i.drawBuffers([o.COLOR_ATTACHMENT0,o.NONE]),xt&&n.timer.markEnd("ColorAccumulate.render"),xt&&n.timer.mark("ColorNormalize.render"),(!a||function FOe(e){return e.format===zX}(a))&&(a=s.texture("image-uint8","rgba","ubyte","linear")),a.define(w,A);var ne=function P9e(e,t,r){if(e.namedComputeRenderables[F2]){var n=e.namedComputeRenderables[F2].values;O.update(n.tColor,t),O.update(n.tCount,r),O.update(n.uTexSize,Be.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[F2].update()}else e.namedComputeRenderables[F2]=function M9e(e,t,r){var n=R(R({},bi),{tColor:O.create(t),tCount:O.create(r),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight()))}),a=R({},I9e);return Va(Ua(e,"triangles",Fn("normalize",bo,x9e),a,n),n)}(e,t,r);return e.namedComputeRenderables[F2]}(n,M,F);u.currentRenderItemId=-1,function R9e(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}(n),a.attachFramebuffer(I,0),u.viewport(0,0,w,A),u.scissor(0,0,w,A),o.clear(o.COLOR_BUFFER_BIT),ne.render(),xt&&n.timer.markEnd("ColorNormalize.render");var Y=dr.create(S[0],S[1],S[2],v),k=f?"volumeInstance":"volume";return xt&&n.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:a,gridDim:y,gridTexDim:Be.create(w,A),gridTransform:Y,type:k}}var gr,kee,gN="color-smoothing-rgb",hy="color-smoothing-rgba",yN="color-smoothing-alpha";function Nee(e,t,r,n,a){if(function F9e(e){return"group"===e||"groupInstance"===e}(e.dColorType.ref.value)){r*=3,n.namedTextures[gN]||(n.namedTextures[gN]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));var i=n.namedTextures[gN];i.load(e.tColor.ref.value);var o=wT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dColorType,o.type),O.update(e.tColorGrid,o.texture),O.update(e.uColorTexDim,o.gridTexDim),O.update(e.uColorGridDim,o.gridDim),O.update(e.uColorGridTransform,o.gridTransform)}}function Gn(e,t){return{kind:e,layers:t}}function Mo(e,t){return{kind:e,layers:t}}!function(e){e.setVisibility=function t(f,p){f&&(f.state.visible=p)},e.setAlphaFactor=function r(f,p){f&&(f.state.alphaFactor=p)},e.setPickable=function n(f,p){f&&(f.state.pickable=p)},e.setColorOnly=function a(f,p){f&&(f.state.colorOnly=p)},e.mark=function i(f,p,m,h,v){if(!f||fs(p))return!1;var g=f.values,y=g.tMarker,S=g.uMarker,C=g.markerAverage,_=g.markerStatus,D=g.instanceCount,A=g.instanceGranularity.ref.value?D.ref.value:g.uGroupCount.ref.value*D.ref.value,E=y.ref.value.array,I=_.ref.value;if(!vu(p)){var M=0;if(h(p,function(H){return M+=_e.size(H),!0},!0),0===M)return!1;M===A&&(p=gT)}var F=!1,N=-1,j=-1;if(vu(p)){var U=function o9e(e,t){var r=-1,n=-1;switch(e){case Ut.Highlight:0===t||1===t?(r=1,n=1):2===t||3===t?(r=1,n=3):r=1;break;case Ut.RemoveHighlight:0===t||1===t?(r=0,n=0):(2===t||3===t)&&(r=1,n=2);break;case Ut.Select:1===t||3===t?(r=1,n=3):0===t||2===t?(r=1,n=2):r=1;break;case Ut.Deselect:1===t||3===t?(r=1,n=1):(0===t||2===t)&&(r=0,n=0);break;case Ut.Toggle:1===t?(r=1,n=3):2===t?(r=0,n=0):3===t?(r=1,n=1):0===t&&(r=1,n=2);break;case Ut.Clear:r=0,n=0}return{average:r,status:n}}(m,I);-1!==U.status?(F=I!==U.status)&&function i9e(e,t,r){e.fill(t,0,r)}(E,U.status,A):F=hN(E,_e.ofLength(A),m),N=U.average,j=U.status}else(F=h(p,function(H){return hN(E,H,m)},!0))&&(N=function s9e(e,t){switch(e){case Ut.Highlight:return.5;case Ut.RemoveHighlight:return 0===t?0:2===t||3===t?.5:-1;case Ut.Select:return.5;case Ut.Deselect:return 1===t||3===t?.5:0===t?0:-1;case Ut.Toggle:return-1===t?-1:.5;case Ut.Clear:return-1===t?-1:0===t?0:.5;case Ut.None:return-1;default:Sn()}}(m,I),v&&-1!==v.status&&-1===N&&ds.isReverse(v.action,m)&&fr.areEqual(p,v.loci)&&(N=0===(j=v.status)?0:.5));return F&&(-1===N&&0===(N=aX(E,A))&&(j=0),v&&(v.action=m,v.loci=p,v.status=I),O.updateIfChanged(S,j),-1===j&&O.update(y,y.ref.value),O.updateIfChanged(C,N),O.updateIfChanged(_,j)),F},e.setOverpaint=function o(f,p,m,h,v){if(f){var g=f.values,y=g.tOverpaint,S=g.dOverpaintType,C=g.dOverpaint,x=g.instanceCount,D=g.instanceGranularity,w=D.ref.value?x.ref.value:g.uGroupCount.ref.value*x.ref.value,A=D.ref.value?"instance":"groupInstance";!function tFe(e,t,r){var n=gi(Math.max(1,e),4,Uint8Array,r&&r.tOverpaint.ref.value.array);r?(O.update(r.tOverpaint,n),O.update(r.uOverpaintTexDim,Be.create(n.width,n.height)),O.updateIfChanged(r.dOverpaint,e>0),O.updateIfChanged(r.dOverpaintType,t)):(O.create(n),O.create(Be.create(n.width,n.height)),O.create(e>0),O.create(Ao()),O.create(b.create(1,1,1)),O.create(dr.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?w:0,A,f.values);var E=y.ref.value.array;h&&ZX(E,0,w);for(var I=function(Z,ne){var Y=p.layers[Z],W=Y.color,$=Y.clear;m(Y.loci,function(q){var V=_e.start(q),ee=_e.end(q);return $?ZX(E,V,ee):function eFe(e,t,r,n){for(var a=t;a<r;++a)dt.toArray(n,e,4*a),e[4*a+3]=255;return!0}(E,V,ee,W)},!1)},M=0,F=p.layers.length;M<F;++M)I(M);if(O.update(y,y.ref.value),O.updateIfChanged(S,A),O.updateIfChanged(C,p.layers.length>0),0!==p.layers.length&&"instance"!==A&&v&&If(v.props)){var N=v.geometry,j=v.props,U=v.webgl;if("mesh"===N.kind){var H=N.meta,G=H.overpaintTexture;(J=Tc(j.smoothColors,!0,H.resolution))&&(function g9e(e,t,r,n,a){if(function v9e(e){return"groupInstance"===e}(e.dOverpaintType.ref.value)){var i=xT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dOverpaintType,i.type),O.update(e.tOverpaintGrid,i.texture),O.update(e.uOverpaintTexDim,i.gridTexDim),O.update(e.uOverpaintGridDim,i.gridDim),O.update(e.uOverpaintGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dOverpaintType,i.type),O.update(e.tOverpaint,i.texture),O.update(e.uOverpaintTexDim,i.texDim))}}(f.values,J.resolution,J.stride,U,G),N.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}else if(U&&"texture-mesh"===N.kind){var J,X=N.meta;G=X.overpaintTexture,(J=Tc(j.smoothColors,!0,X.resolution))&&(function N9e(e,t,r,n,a){if(function B9e(e){return"groupInstance"===e}(e.dOverpaintType.ref.value)){r*=3,n.namedTextures[hy]||(n.namedTextures[hy]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[hy];i.load(e.tOverpaint.ref.value);var o=wT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dOverpaintType,o.type),O.update(e.tOverpaintGrid,o.texture),O.update(e.uOverpaintTexDim,o.gridTexDim),O.update(e.uOverpaintGridDim,o.gridDim),O.update(e.uOverpaintGridTransform,o.gridTransform)}}(f.values,J.resolution,J.stride,U,G),N.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}}}},e.setTransparency=function s(f,p,m,h,v){if(f){var g=f.values,y=g.tTransparency,S=g.dTransparencyType,C=g.transparencyAverage,_=g.dTransparency,D=g.instanceCount,w=g.instanceGranularity,A=w.ref.value?D.ref.value:g.uGroupCount.ref.value*D.ref.value,E=w.ref.value?"instance":"groupInstance";!function aFe(e,t,r){var n=gi(Math.max(1,e),1,Uint8Array,r&&r.tTransparency.ref.value.array);r?(O.update(r.tTransparency,n),O.update(r.uTransparencyTexDim,Be.create(n.width,n.height)),O.updateIfChanged(r.dTransparency,e>0),O.updateIfChanged(r.transparencyAverage,$X(n.array,e)),O.updateIfChanged(r.dTransparencyType,t)):(O.create(n),O.create(Be.create(n.width,n.height)),O.create(e>0),O.create(0),O.create(Ao()),O.create(b.create(1,1,1)),O.create(dr.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?A:0,E,f.values);var I=y.ref.value.array;h&&function nFe(e,t,r){e.fill(0,t,r)}(I,0,A);for(var M=function(ne,Y){var k=p.layers[ne],$=k.value;m(k.loci,function(q){var V=_e.start(q),ee=_e.end(q);return function rFe(e,t,r,n){for(var a=t;a<r;++a)e[a]=255*n;return!0}(I,V,ee,$)},!1)},F=0,N=p.layers.length;F<N;++F)M(F);if(O.update(y,y.ref.value),O.updateIfChanged(C,$X(I,A)),O.updateIfChanged(S,E),O.updateIfChanged(_,p.layers.length>0),0!==p.layers.length&&"instance"!==E&&v&&If(v.props)){var j=v.geometry,U=v.props,H=v.webgl;if("mesh"===j.kind){var z=j.meta,J=z.transparencyTexture;(X=Tc(U.smoothColors,!0,z.resolution))&&(function b9e(e,t,r,n,a){if(function y9e(e){return"groupInstance"===e}(e.dTransparencyType.ref.value)){var i=xT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dTransparencyType,i.type),O.update(e.tTransparencyGrid,i.texture),O.update(e.uTransparencyTexDim,i.gridTexDim),O.update(e.uTransparencyGridDim,i.gridDim),O.update(e.uTransparencyGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dTransparencyType,i.type),O.update(e.tTransparency,i.texture),O.update(e.uTransparencyTexDim,i.texDim))}}(f.values,X.resolution,X.stride,H,J),j.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}else if(H&&"texture-mesh"===j.kind){var X,Z=j.meta;J=Z.transparencyTexture,(X=Tc(U.smoothColors,!0,Z.resolution))&&(function L9e(e,t,r,n,a){if(function k9e(e){return"groupInstance"===e}(e.dTransparencyType.ref.value)){r*=3,n.namedTextures[yN]||(n.namedTextures[yN]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));var i=n.namedTextures[yN];i.load(e.tTransparency.ref.value);var o=wT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dTransparencyType,o.type),O.update(e.tTransparencyGrid,o.texture),O.update(e.uTransparencyTexDim,o.gridTexDim),O.update(e.uTransparencyGridDim,o.gridDim),O.update(e.uTransparencyGridTransform,o.gridTransform)}}(f.values,X.resolution,X.stride,H,J),j.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}}}},e.setSubstance=function u(f,p,m,h,v){if(f){var g=f.values,y=g.tSubstance,S=g.dSubstanceType,C=g.dSubstance,x=g.instanceCount,D=g.instanceGranularity,w=D.ref.value?x.ref.value:g.uGroupCount.ref.value*x.ref.value,A=D.ref.value?"instance":"groupInstance";!function cFe(e,t,r){var n=gi(Math.max(1,e),4,Uint8Array,r&&r.tSubstance.ref.value.array);r?(O.update(r.tSubstance,n),O.update(r.uSubstanceTexDim,Be.create(n.width,n.height)),O.updateIfChanged(r.dSubstance,e>0),O.updateIfChanged(r.dSubstanceType,t)):(O.create(n),O.create(Be.create(n.width,n.height)),O.create(e>0),O.create(Ao()),O.create(b.create(1,1,1)),O.create(dr.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?w:0,A,f.values);var E=y.ref.value.array;h&&tK(E,0,w);for(var I=function(Z,ne){var Y=p.layers[Z],W=Y.material,$=Y.clear;m(Y.loci,function(q){var V=_e.start(q),ee=_e.end(q);return $?tK(E,V,ee):function uFe(e,t,r,n){for(var a=t;a<r;++a)as.toArray(n,e,4*a),e[4*a+3]=255;return!0}(E,V,ee,W)},!1)},M=0,F=p.layers.length;M<F;++M)I(M);if(O.update(y,y.ref.value),O.updateIfChanged(S,A),O.updateIfChanged(C,p.layers.length>0),0!==p.layers.length&&"instance"!==A&&v&&If(v.props)){var N=v.geometry,j=v.props,U=v.webgl;if("mesh"===N.kind){var H=N.meta,G=H.substanceTexture;(J=Tc(j.smoothColors,!0,H.resolution))&&(function C9e(e,t,r,n,a){if(function S9e(e){return"groupInstance"===e}(e.dSubstanceType.ref.value)){var i=xT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);"volume"===i.kind?(O.updateIfChanged(e.dSubstanceType,i.type),O.update(e.tSubstanceGrid,i.texture),O.update(e.uSubstanceTexDim,i.gridTexDim),O.update(e.uSubstanceGridDim,i.gridDim),O.update(e.uSubstanceGridTransform,i.gridTransform)):"vertex"===i.kind&&(O.updateIfChanged(e.dSubstanceType,i.type),O.update(e.tSubstance,i.texture),O.update(e.uSubstanceTexDim,i.texDim))}}(f.values,J.resolution,J.stride,U,G),N.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}else if(U&&"texture-mesh"===N.kind){var J,X=N.meta;G=X.substanceTexture,(J=Tc(j.smoothColors,!0,X.resolution))&&(function V9e(e,t,r,n,a){if(function U9e(e){return"groupInstance"===e}(e.dSubstanceType.ref.value)){r*=3,n.namedTextures[hy]||(n.namedTextures[hy]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[hy];i.load(e.tSubstance.ref.value);var o=wT({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);O.updateIfChanged(e.dSubstanceType,o.type),O.update(e.tSubstanceGrid,o.texture),O.update(e.uSubstanceTexDim,o.gridTexDim),O.update(e.uSubstanceGridDim,o.gridDim),O.update(e.uSubstanceGridTransform,o.gridTransform)}}(f.values,J.resolution,J.stride,U,G),N.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}}}},e.setClipping=function c(f,p,m,h){if(f){var v=f.values,g=v.tClipping,y=v.dClippingType,S=v.dClipping,_=v.instanceCount,x=v.instanceGranularity,D=x.ref.value?_.ref.value:v.uGroupCount.ref.value*_.ref.value,A=x.ref.value?"instance":"groupInstance";!function sFe(e,t,r){var n=gi(Math.max(1,e),1,Uint8Array,r&&r.tClipping.ref.value.array);r?(O.update(r.tClipping,n),O.update(r.uClippingTexDim,Be.create(n.width,n.height)),O.updateIfChanged(r.dClipping,e>0),O.updateIfChanged(r.dClippingType,t)):(O.create(n),O.create(Be.create(n.width,n.height)),O.create(e>0),O.create(t))}(p.layers.length?D:0,A,f.values);var E=g.ref.value.array;h&&function oFe(e,t,r){e.fill(0,t,r)}(E,0,D);for(var I=function(N,j){var U=p.layers[N],z=U.groups;m(U.loci,function(J){var X=_e.start(J),Z=_e.end(J);return function iFe(e,t,r,n){return e.fill(n,t,r),!0}(E,X,Z,z)},!1)},M=0,F=p.layers.length;M<F;++M)I(M);O.update(g,g.ref.value),O.updateIfChanged(y,A),O.updateIfChanged(S,p.layers.length>0)}},e.setThemeStrength=function l(f,p){f&&(O.updateIfChanged(f.values.uOverpaintStrength,p.overpaint),O.updateIfChanged(f.values.uTransparencyStrength,p.transparency),O.updateIfChanged(f.values.uSubstanceStrength,p.substance))},e.setTransform=function d(f,p,m){if(f&&(p||m)){var h=f.values;p&&(he.copy(h.matrix.ref.value,p),O.update(h.matrix,h.matrix.ref.value)),m?(h.extraTransform.ref.value.set(m),O.update(h.extraTransform,h.extraTransform.ref.value)):null===m&&(hA(h.extraTransform.ref.value,h.instanceCount.ref.value),O.update(h.extraTransform,h.extraTransform.ref.value)),WX(h);var v=Qi(h.invariantBoundingSphere.ref.value,h.aTransform.ref.value,h.instanceCount.ref.value,0);O.update(h.boundingSphere,v)}}}(gr||(gr={})),function(e){function n(l){return 0===l.layers.length}e.Empty={kind:"empty-loci",layers:[]},function(l){var d,g;function m(g){switch(g){case"one":return d.One;case"two":return d.Two;case"three":return d.Three;case"four":return d.Four;case"five":return d.Five;case"six":return d.Six}}l.is=Vo.has,(g=d=l.Flag||(l.Flag={}))[g.None=0]="None",g[g.One=1]="One",g[g.Two=2]="Two",g[g.Three=4]="Three",g[g.Four=8]="Four",g[g.Five=16]="Five",g[g.Six=32]="Six",l.create=function f(g){return Vo.create(g)},l.Names={one:d.One,two:d.Two,three:d.Three,four:d.Four,five:d.Five,six:d.Six},l.isName=function p(g){return g in l.Names},l.fromName=m,l.fromNames=function h(g){for(var y=d.None,S=0,C=g.length;S<C;++S)y|=m(g[S]);return y},l.toNames=function v(g){var y=[];return l.is(g,d.One)&&y.push("one"),l.is(g,d.Two)&&y.push("two"),l.is(g,d.Three)&&y.push("three"),l.is(g,d.Four)&&y.push("four"),l.is(g,d.Five)&&y.push("five"),l.is(g,d.Six)&&y.push("six"),y}}(e.Groups||(e.Groups={})),e.areEqual=function r(l,d){if(l.layers.length!==d.layers.length)return!1;for(var f=0,p=l.layers.length;f<p;++f)if(l.layers[f].groups!==d.layers[f].groups||!fr.areEqual(l.layers[f].loci,d.layers[f].loci))return!1;return!0},e.isEmpty=n,e.remap=function a(l,d){if("element-loci"===l.kind){for(var f=[],p=0,m=l.layers;p<m.length;p++){var h=m[p],v=h.loci,g=h.groups;v=Re.remap(v,d),Re.isEmpty(v)||f.push({loci:v,groups:g})}return{kind:"element-loci",layers:f}}return l},e.merge=function i(l){if(n(l))return l;if("element-loci"===l.kind){for(var d=l.layers[0].loci.structure,f=new Map,p=Re.none(d),m=0,h=l.layers.length;m<h;++m){var v=l.layers[h-m-1],g=v.loci,y=v.groups;g=Re.subtract(g,p),p=Re.union(g,p),Re.isEmpty(g)||(f.has(y)&&(g=Re.union(g,f.get(y))),f.set(y,g))}var S=[];return f.forEach(function(C,_){S.push({loci:C,groups:_})}),{kind:"element-loci",layers:S}}return l},e.filter=function o(l,d){if(n(l))return l;if("element-loci"===l.kind){for(var f=l.layers[0].loci.structure,p=[],m=0,h=l.layers;m<h.length;m++){var v=h[m],g=v.loci,y=v.groups,S=Re.remap(g,d);g=Re.remap(S,f),Re.isEmpty(g)||p.push({loci:g,groups:y})}return{kind:"element-loci",layers:p}}return l},e.ofScript=function s(l,d){for(var f=[],p=0,m=l.length;p<m;++p){var h=l[p],g=h.groups,y=Ni.toLoci(h.script,d);Re.isEmpty(y)||f.push({loci:y,groups:g})}return{kind:"element-loci",layers:f}},e.ofBundle=function u(l,d){for(var f=[],p=0,m=l.length;p<m;++p){var h=l[p],g=h.groups,y=rn.toLoci(h.bundle,d.root);f.push({loci:y,groups:g})}return{kind:"element-loci",layers:f}},e.toBundle=function c(l){for(var d=[],f=0,p=l.layers.length;f<p;++f){var m=l.layers[f],v=m.groups,g=rn.fromLoci(m.loci);d.push({bundle:g,groups:v})}return{kind:"element-loci",layers:d}}}(Gn||(Gn={})),function(e){function r(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,l){if(0===c.layers.length&&0===l.layers.length)return!0;if(c.layers.length!==l.layers.length)return!1;for(var d=0,f=c.layers.length;d<f;++d)if(c.layers[d].clear!==l.layers[d].clear||!gO(c.layers[d].material,l.layers[d].material)||!fr.areEqual(c.layers[d].loci,l.layers[d].loci))return!1;return!0},e.isEmpty=r,e.remap=function n(c,l){if("element-loci"===c.kind){for(var d=[],f=0,p=c.layers;f<p.length;f++){var m=p[f],h=m.loci,v=m.material,g=m.clear;h=Re.remap(h,l),Re.isEmpty(h)||d.push({loci:h,material:v,clear:g})}return{kind:"element-loci",layers:d}}return c},e.merge=function a(c){if(r(c))return c;if("element-loci"===c.kind){for(var l=c.layers[0].loci.structure,d=void 0,f=new Map,p=Re.none(l),m=0,h=c.layers.length;m<h;++m){var v=c.layers[h-m-1],g=v.loci,y=v.material,S=v.clear;g=Re.subtract(g,p),p=Re.union(g,p),Re.isEmpty(g)||(S?d=d?Re.union(g,d):g:(f.has(y)&&(g=Re.union(g,f.get(y))),f.set(y,g)))}var C=[];return d&&C.push({loci:d,material:as(),clear:!0}),f.forEach(function(_,x){C.push({loci:_,material:x,clear:!1})}),{kind:"element-loci",layers:C}}return c},e.filter=function i(c,l){if(r(c))return c;if("element-loci"===c.kind){for(var d=c.layers[0].loci.structure,f=[],p=0,m=c.layers;p<m.length;p++){var h=m[p],v=h.loci,g=h.material,y=h.clear,S=Re.remap(v,l);v=Re.remap(S,d),Re.isEmpty(v)||f.push({loci:v,material:g,clear:y})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function o(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var m=c[f],v=m.material,g=m.clear,y=Ni.toLoci(m.script,l);Re.isEmpty(y)||d.push({loci:y,material:v,clear:g})}return{kind:"element-loci",layers:d}},e.ofBundle=function s(c,l){for(var d=[],f=0,p=c.length;f<p;++f){var m=c[f],v=m.material,g=m.clear,y=rn.toLoci(m.bundle,l.root);d.push({loci:y,material:v,clear:g})}return{kind:"element-loci",layers:d}},e.toBundle=function u(c){for(var l=[],d=0,f=c.layers.length;d<f;++d){var p=c.layers[d],h=p.material,v=p.clear,g=rn.fromLoci(p.loci);l.push({bundle:g,material:h,clear:v})}return{kind:"element-loci",layers:l}}}(Mo||(Mo={})),function(e){e.getDetaultParams=function t(r,n,a){return T.getDefaultValues(r.getParams(n,a))}}(kee||(kee={}));var G9e={name:"",label:"",description:"",factory:function(){return lr.Empty},getParams:function(){return{}},defaultValues:{},defaultColorTheme:hu.EmptyProvider,defaultSizeTheme:ki.EmptyProvider,isApplicable:function(){return!0}};function Lee(e){return e.map(function(t){return[t.name,t.provider.label]})}var lr,Uee=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return Lee(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered represenatation provider."));return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||G9e},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return Lee(this.getApplicableList(t))},e.prototype.clear=function(){this._list.length=0,this._map.clear(),this._name.clear()},e}();function Li(e,t,r){void 0===r&&(r={});var u,c,m,h,n=0,a=new bn,i=lr.createState(),o=Wf(),s=[],l=-1,d=_i.createEmpty(),f=T.getDefaultValues(t.Params);r.modifyState&&lr.updateState(i,r.modifyState(i));var v=Od.create();function C(_,x){return vu(_)||qr.isLoci(_)&&_.shape===c?x(_e.ofBounds(0,f.instanceGranularity?c.transforms.length:c.groupCount*c.transforms.length)):f.instanceGranularity?function S(_,x,D){var w=!1;if(!Ho.isLoci(_)||Ho.isLociEmpty(_)||_.shape!==x)return!1;for(var A=0,E=_.groups;A<E.length;A++)D(_e.ofSingleton(E[A].instance))&&(w=!0);return w}(_,c,x):function z9e(e,t,r){if(!Ho.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,o=0,s=e.groups;o<s.length;o++){var u=s[o],c=u.ids,l=u.instance;if(_e.is(c)){var d=l*a+_e.start(c),f=l*a+_e.end(c);r(_e.ofBounds(d,f))&&(n=!0)}else for(var p=0,m=c.length;p<m;p++)r(_e.ofSingleton(l*a+c[p]))&&(n=!0)}return n}(_,c,x)}return{label:"Shape geometry",get groupCount(){return m?m.count:0},get props(){return f},get params(){},get state(){return i},get theme(){return d},renderObjects:s,get geometryVersion(){return l},updated:a,createOrUpdate:function y(_,x){var D=this;return void 0===_&&(_={}),r.modifyProps&&(_=r.modifyProps(_)),Ve.create("ShapeRepresentation.create",function(w){return ue(D,void 0,void 0,function(){var A,E,I,M,F,N,j,U;return ce(this,function(H){switch(H.label){case 0:return A=Object.assign(f,_),x?[4,e(w,x,A,c)]:[3,2];case 1:return I=H.sent(),[3,3];case 2:I=void 0,H.label=3;case 3:if(function g(_,x){void 0===_&&(_={}),Od.reset(v),(x||c)&&(x&&!c?v.createNew=!0:x&&c&&x.id===c.id||(x&&c&&x.id!==c.id?(v.updateTransform=!0,v.createGeometry=!0):x&&console.warn("unexpected state")),_.instanceGranularity!==f.instanceGranularity&&(v.updateTransform=!0),v.updateTransform&&(v.updateColor=!0,v.updateSize=!0),v.createGeometry&&(v.updateColor=!0,v.updateSize=!0))}(_,E=I),E&&(c=E,Object.assign(d,qr.getTheme(c))),v.createNew)s.length=0,m=qr.groupIterator(c),M=qr.createTransform(c.transforms),F=t.createValues(c.geometry,M,m,d,A),N=t.createRenderableState(A),r.modifyState&&Object.assign(N,r.modifyState(N)),lr.updateState(i,N),(u=Q0(c.geometry.kind,F,N,o))&&s.push(u),h=t.createPositionIterator(c.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");v.updateTransform&&(qr.createTransform(c.transforms,u.values),m=qr.groupIterator(c),j=m.instanceCount,U=m.groupCount,_.instanceGranularity?Ia(j,"instance",u.values):Ia(j*U,"groupInstance",u.values)),v.createGeometry&&(O.updateIfChanged(u.values.drawCount,Oi.getDrawCount(c.geometry)),O.updateIfChanged(u.values.uVertexCount,Oi.getVertexCount(c.geometry)),O.updateIfChanged(u.values.uGroupCount,Oi.getGroupCount(c.geometry))),(v.updateTransform||v.createGeometry)&&(t.updateBoundingSphere(u.values,c.geometry),h=t.createPositionIterator(c.geometry,u.values)),v.updateColor&&Vu(m,h,d.color,u.values),v.updateSize&&"uSize"in u.values&&Bf(m,d.size,u.values),t.updateValues(u.values,A),t.updateRenderableState(u.state,A)}return f=A,(v.createGeometry||v.createNew)&&(l+=1),a.next(n++),[2]}})})})},getLoci:function(_){var w=_.instanceId;return u&&u.id===_.objectId?Ho.Loci(c,[{ids:ke.ofSingleton(_.groupId),instance:w}]):Wr},getAllLoci:function(){return[qr.Loci(c)]},eachLocation:function(_){for(m.reset();m.hasNext;){var x=m.move();_(x.location,x.isSecondary)}},mark:function(_,x){if(!ds.is(i.markerActions,x))return!1;if(Ho.isLoci(_)||qr.isLoci(_)){if(_.shape!==c)return!1}else if(!vu(_))return!1;return gr.mark(u,_,x,C)},setState:function(_){r.modifyState&&(_=r.modifyState(_)),u&&(void 0!==_.visible&&gr.setVisibility(u,_.visible),void 0!==_.alphaFactor&&gr.setAlphaFactor(u,_.alphaFactor),void 0!==_.pickable&&gr.setPickable(u,_.pickable),void 0!==_.colorOnly&&gr.setColorOnly(u,_.colorOnly),void 0!==_.overpaint&&gr.setOverpaint(u,_.overpaint,C,!0),void 0!==_.transparency&&gr.setTransparency(u,_.transparency,C,!0),void 0!==_.substance&&gr.setSubstance(u,_.substance,C,!0),void 0!==_.transform&&gr.setTransform(u,_.transform)),lr.updateState(i,_)},setTheme:function(_){Cr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}!function(e){var s;function r(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:he.identity(),overpaint:Io.Empty,transparency:Po.Empty,substance:Mo.Empty,clipping:Gn.Empty,themeStrength:{overpaint:1,transparency:1,substance:1},markerActions:ds.All}}function n(s,u){void 0!==u.visible&&(s.visible=u.visible),void 0!==u.alphaFactor&&(s.alphaFactor=u.alphaFactor),void 0!==u.pickable&&(s.pickable=u.pickable),void 0!==u.colorOnly&&(s.colorOnly=u.colorOnly),void 0!==u.overpaint&&(s.overpaint=u.overpaint),void 0!==u.transparency&&(s.transparency=u.transparency),void 0!==u.substance&&(s.substance=u.substance),void 0!==u.clipping&&(s.clipping=u.clipping),void 0!==u.themeStrength&&(s.themeStrength=u.themeStrength),void 0!==u.syncManually&&(s.syncManually=u.syncManually),void 0!==u.transform&&he.copy(s.transform,u.transform),void 0!==u.markerActions&&(s.markerActions=u.markerActions)}(s=e.Loci||(e.Loci={})).areEqual=function u(l,d){return l.repr===d.repr&&fr.areEqual(l.loci,d.loci)},s.isEmpty=function c(l){return fr.isEmpty(l.loci)},s.Empty={loci:Wr},e.createState=r,e.updateState=n,e.StateBuilder={create:r,update:n},e.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new bn,state:r(),theme:_i.createEmpty(),createOrUpdate:function(){return Ve.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return Wr},getAllLoci:function(){return[]},eachLocation:function(){},mark:function(){return!1},destroy:function(){}};var a=function(){function s(){this.curr=new Set,this.next=new Set,this._version=-1}return Object.defineProperty(s.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),s.prototype.add=function(u,c){this.next.add(Ou(u,c))},s.prototype.snapshot=function(){var u;sa.areEqual(this.curr,this.next)||(this._version+=1),this.curr=(u=[this.next,this.curr])[0],this.next=u[1],this.next.clear()},s}();e.GeometryState=a,e.createMulti=function i(s,u,c,l,d){var y,S,C,f=this,p=0,m=new bn,h=new a,v=l.create(),g=_i.createEmpty(),_={},x=Object.keys(d).map(function(D,w){_[w]=D;var A=d[D](u,c);return A.setState(v),A});return{label:s,updated:m,get groupCount(){var D=0;if(S)for(var w=S.visuals,A=0,E=x.length;A<E;++A)(!w||w.includes(_[A]))&&(D+=x[A].groupCount);return D},get renderObjects(){var D=[];if(S)for(var w=S.visuals,A=0,E=x.length;A<E;++A)(!w||w.includes(_[A]))&&D.push.apply(D,x[A].renderObjects);return D},get geometryVersion(){return h.version},get props(){return S},get params(){return y},createOrUpdate:function(D,w){void 0===D&&(D={}),w&&w!==C&&(y=c(u,w),C=w,S||(S=T.getDefaultValues(y)));var A=vN(Object.assign({},S,D),C);Object.assign(S,D,A);var E=S.visuals;return Ve.create("Creating or updating '".concat(s,"' representation"),function(I){return ue(f,void 0,void 0,function(){var M,F;return ce(this,function(N){switch(N.label){case 0:M=0,F=x.length,N.label=1;case 1:return M<F?!E||E.includes(_[M])?[4,x[M].createOrUpdate(S,C).runInContext(I)]:[3,3]:[3,5];case 2:N.sent(),N.label=3;case 3:h.add(M,x[M].geometryVersion),N.label=4;case 4:return++M,[3,1];case 5:return h.snapshot(),m.next(p++),[2]}})})})},get state(){return v},get theme(){return g},getLoci:function(D){for(var w=S.visuals,A=0,E=x.length;A<E;++A)if(!w||w.includes(_[A])){var I=x[A].getLoci(D);if(!fs(I))return I}return Wr},getAllLoci:function(){for(var D=[],w=S.visuals,A=0,E=x.length;A<E;++A)(!w||w.includes(_[A]))&&D.push.apply(D,x[A].getAllLoci());return D},eachLocation:function(D){for(var w=S.visuals,A=0,E=x.length;A<E;++A)(!w||w.includes(_[A]))&&x[A].eachLocation(D)},mark:function(D,w){for(var A=!1,E=0,I=x.length;E<I;++E)A=x[E].mark(D,w)||A;return A},setState:function(D){l.update(v,D);for(var w=0,A=x.length;w<A;++w)x[w].setState(D)},setTheme:function(D){g=D;for(var w=0,A=x.length;w<A;++w)x[w].setTheme(D)},destroy:function(){for(var D=0,w=x.length;D<w;++D)x[D].destroy()}}},e.fromRenderObject=function o(s,u){var c=this,l=0,d=new bn,f=new a,p=e.createState(),m=_i.createEmpty(),h=T.clone(st.Params),v=T.getDefaultValues(st.Params);return{label:s,updated:d,get groupCount(){return u.values.uGroupCount.ref.value},get renderObjects(){return[u]},get geometryVersion(){return f.version},get props(){return v},get params(){return h},createOrUpdate:function(g){void 0===g&&(g={});var y=vN(Object.assign({},v,g));return Object.assign(v,g,y),Ve.create("Updating '".concat(s,"' representation"),function(S){return ue(c,void 0,void 0,function(){return ce(this,function(C){return f.add(0,u.id),f.snapshot(),d.next(l++),[2]})})})},get state(){return p},get theme(){return m},getLoci:function(){return Wr},getAllLoci:function(){return[]},eachLocation:function(){},mark:function(g,y){return!1},setState:function(g){void 0!==g.visible&&gr.setVisibility(u,g.visible),void 0!==g.alphaFactor&&gr.setAlphaFactor(u,g.alphaFactor),void 0!==g.pickable&&gr.setPickable(u,g.pickable),void 0!==g.colorOnly&&gr.setColorOnly(u,g.colorOnly),void 0!==g.themeStrength&&gr.setThemeStrength(u,g.themeStrength),void 0!==g.transform&&gr.setTransform(u,g.transform),e.updateState(p,g)},setTheme:function(){},destroy:function(){}}}}(lr||(lr={}));var Vee=he(),vy=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=xc.Mutable(),this.groupIndexMap=xc.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(16*t.units.length),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+16*i.units.length);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+16*s);r+=16*i.units.length}}return e.prototype.reset=function(){this.version=0,hA(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(void 0===this._isIdentity){this._isIdentity=!0;for(var t=0,r=16*this.size;t<r;t+=16)if(he.fromArray(Vee,this.unitTransforms,t),!he.isIdentity(Vee)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,he.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return he.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),Gee=he();function zee(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];ra.lerpFromIdentity(Gee,i.conformation.operator,r),t.setTransform(Gee,i)}}var Hee=b(),gy=b(),AT=he();function jee(e,t,r,n){for(var a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];b.transformMat4(Hee,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),b.sub(gy,Hee,n.center),b.setMagnitude(gy,gy,a),he.fromTranslation(AT,gy),t.setTransform(AT,s)}}var H9e={axis:T.MappedStatic("custom",{structure:T.Group({principalAxis:T.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:T.Group({vector:T.Vec3(b.create(0,0,1))})}),origin:T.MappedStatic("structure",{structure:T.Group({}),custom:T.Group({vector:T.Vec3(b.create(0,0,0))})})};function qee(e,t){return{axis:"custom"===t.axis.name?t.axis.params.vector:Ze.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],origin:"custom"===t.origin.name?t.origin.params.vector:Ze.getPrincipalAxes(e).momentsAxes.origin}}var Wee=he(),Yee=he(),TT=he();function Xee(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];b.negate(gy,a),he.fromTranslation(AT,gy),he.fromRotation(Wee,Math.PI*r*2,n),he.fromTranslation(Yee,a),he.mul(TT,Wee,AT),he.mul(TT,Yee,TT),t.setTransform(TT,s)}}var j9e=he.fromTranslation(he(),b.create(.5,.5,.5)),q9e=sK(oK(PK()),j9e),wl=b(),Kee=he(),X9e=R(R({},Vt.Params),{cellColor:T.Color(vr.orange),cellScale:T.Numeric(2,{min:.1,max:5,step:.1}),ref:T.Select("model",T.objectToOptions({origin:"Origin",model:"Model"}),{isEssential:!0}),attachment:T.Select("corner",T.objectToOptions({corner:"Corner",center:"Center"}),{isEssential:!0})}),K9e={mesh:function(e,t){return Li(Q9e,Vt.Utils)}},Zee=R({},X9e);function Q9e(e,t,r,n){var a=function Z9e(e,t,r){var n=yt.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;b.copy(wl,e.ref),"center"===t.attachment?(b.trunc(wl,wl),b.subScalar(wl,wl,.5)):b.floor(wl,wl),he.fromTranslation(Kee,wl);var i=sK(oK(q9e),Kee),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,yt.addCage(n,a,i,o,2,20);var s=Pe.fromDimensionsAndTransform(Pe(),b.unit,a);b.transformMat4(wl,wl,a),Pe.translate(s,s,wl),Pe.expand(s,s,o);var u=yt.getMesh(n);return u.setBoundingSphere(s),u}(t,r,n&&n.geometry),i=KS.getUnitcellLabel(t.symmetry);return qr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function Qee(e,t,r){var n=b();return"model"===r.ref&&b.transformMat4(n,ar.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}var Fd,Gc=new Uint16Array([0,1,2,1,3,2]),hv=qe.add3,Ro=qe.add2,$ee=qe.add;!function(e){e.create=function t(r,n,a,i){void 0===r&&(r={}),void 0===n&&(n=2048),void 0===a&&(a=1024),n*=2,a*=2;var o=qe.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=qe.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=qe.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),c=qe.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),l=qe.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),d=qe.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),f=R(R({},T.getDefaultValues(zu.Params)),r),p=f.attachment,m=f.background,h=f.backgroundMargin,v=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,S=function zFe(e){var t=JSON.stringify(e);return void 0===l4[t]&&(l4[t]=new HFe(e)),l4[t]}(f),C=.4*h,_=S.buffer/S.lineHeight,x=function(D,w,A,E,I){hv(o,D,w,A),$ee(u,E),$ee(l,I)};return{add:function(D,w,A,E,I,M,F){for(var N=0,j=D.length,U=0;U<j;++U)N+=(H=S.get(D[U])).nw-2*_;var G,J;if(G=p.startsWith("top")?.8:p.startsWith("middle")?.4:0,J=p.endsWith("right")?N:p.endsWith("center")?N/2:0,v)switch(p){case"bottom-left":J-=g/2+C+.1,G-=g/2+C;break;case"bottom-center":G-=g+C;break;case"bottom-right":J+=g/2+C+.1,G-=g/2+C;break;case"middle-left":J-=g+C+.1;break;case"middle-center":break;case"middle-right":J+=g+C+.1;break;case"top-left":J-=g/2+C+.1,G+=g/2+C;break;case"top-center":G+=g+C;break;case"top-right":J+=g/2+C+.1,G+=g/2+C}var X=(-J-C-.1)*M,Z=(N-J+C+.1)*M,ne=(.8-G+C)*M,Y=(-G-C)*M;if(m){Ro(s,X,ne),Ro(s,X,Y),Ro(s,Z,ne),Ro(s,Z,Y);for(var k=o.elementCount,W=0;W<4;++W)Ro(d,10,10),x(w,A,E,I,F);hv(c,k+Gc[0],k+Gc[1],k+Gc[2]),hv(c,k+Gc[3],k+Gc[4],k+Gc[5])}if(v){var $=void 0,K=void 0,q=void 0,V=void 0,ee=void 0,ae=void 0,pe=void 0,me=void 0,de=g*M,re=y*M;switch(p){case"bottom-left":$=X-de/2,q=X+re/2,ee=X,pe=X,K=Y-de/2,V=Y,ae=Y+re/2,me=Y;break;case"bottom-center":$=0,q=re/2,ee=-re/2,pe=0,K=Y-de,V=Y,ae=Y,me=Y;break;case"bottom-right":$=Z+de/2,q=Z,ee=Z-re/2,pe=Z,K=Y-de/2,V=Y+re/2,ae=Y,me=Y;break;case"middle-left":$=X-de,q=X,ee=X,pe=X,K=0,V=-re/2,ae=re/2,me=0;break;case"middle-center":$=0,q=0,ee=0,pe=0,K=0,V=0,ae=0,me=0;break;case"middle-right":$=Z+de,q=Z,ee=Z,pe=Z,K=0,V=re/2,ae=-re/2,me=0;break;case"top-left":$=X-de/2,q=X+re/2,ee=X,pe=X,K=ne+de/2,V=ne,ae=ne-re/2,me=ne;break;case"top-center":$=0,q=re/2,ee=-re/2,pe=0,K=ne+de,V=ne,ae=ne,me=ne;break;case"top-right":$=Z+de/2,q=Z,ee=Z-re/2,pe=Z,K=ne+de/2,V=ne-re/2,ae=ne,me=ne;break;default:Sn()}for(Ro(s,$,K),Ro(s,q,V),Ro(s,ee,ae),Ro(s,pe,me),k=o.elementCount,W=0;W<4;++W)Ro(d,10,10),x(w,A,E,I,F);hv(c,k,k+1,k+3),hv(c,k,k+3,k+2)}J+=_,G+=_;var te=0;for(U=0;U<j;++U){var H,le=(te-J)*M,ge=(te+(H=S.get(D[U])).nw-J)*M,xe=(H.nh-G)*M,Ge=-G*M;Ro(s,le,xe),Ro(s,le,Ge),Ro(s,ge,xe),Ro(s,ge,Ge);var je=S.texture.width,L=S.texture.height;for(Ro(d,H.x/je,H.y/L),Ro(d,H.x/je,(H.y+H.h)/L),Ro(d,(H.x+H.w)/je,H.y/L),Ro(d,(H.x+H.w)/je,(H.y+H.h)/L),te+=H.nw-2*_,k=o.elementCount,W=0;W<4;++W)x(w,A,E,I,F);hv(c,k+Gc[0],k+Gc[1],k+Gc[2]),hv(c,k+Gc[3],k+Gc[4],k+Gc[5])}},getText:function(){var D=S.texture,w=qe.compact(o,!0),A=qe.compact(s,!0),E=qe.compact(u,!0),I=qe.compact(c,!0),M=qe.compact(l,!0),F=qe.compact(d,!0);return zu.create(D,w,A,E,I,M,F,c.elementCount/2,i)}}}}(Fd||(Fd={}));var yy={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function DT(e,t){var r;switch(void 0===t&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(f){return f.entry}).filter(function(f){return!!f}).join(", ");case"element-loci":return ET(Ad.ofLoci(e),t);case"bond-loci":var n=e.bonds[0];return n?bN(n,t):"";case"shape-loci":return e.shape.name;case"group-loci":var a=e.groups[0];return a?e.shape.getLabel(ke.start(a.ids),a.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return["".concat(e.volume.label||"Volume"),"Isosurface at ".concat(nt.IsoValue.toString(e.isoValue))].join(" | ");case"cell-loci":var i=ke.size(e.indices),o=ke.start(e.indices),s=nt.IsoValue.absolute(e.volume.grid.cells.data[o]),u=nt.IsoValue.toRelative(s,e.volume.grid.stats),c=["".concat(e.volume.label||"Volume"),"".concat(1===i?"Cell #".concat(o):"".concat(i," Cells"))];return 1===i&&c.push("".concat(nt.IsoValue.toString(s)," (").concat(nt.IsoValue.toString(u),")")),c.join(" | ");case"segment-loci":var l=null===(r=nt.Segmentation.get(e.volume))||void 0===r?void 0:r.labels;if(l&&1===e.segments.length){var d=l[e.segments[0]];if(d)return d}return["".concat(e.volume.label||"Volume"),"".concat(1===e.segments.length?"Segment ".concat(e.segments[0]):"".concat(e.segments.length," Segments"))].join(" | ")}}function by(e,t){return 1===e?"1 ".concat(t):"".concat(e," ").concat(t,"s")}function B2(e,t,r,n,a,i){return"".concat(cp(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})," <small>[+ ").concat(by(e-1,"other ".concat(Mh(r))),"]</small>")}function ET(e,t){void 0===t&&(t={});var r=R(R({},yy),t),n=function eje(e,t,r,n,a){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===a&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,c=e.elementCount;if(!t&&1===c&&0===s&&0===o)return cp(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&0===c&&1===s&&0===o)return cp(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(t||0!==c||0!==s||1!==o){if(t){var f=[];return i>0&&f.push(by(i,"Structure")),o>0&&f.push(by(o,"Chain")),s>0&&f.push(by(s,"Residue")),u>0&&f.push(by(u,"Conformation")),c>0&&f.push(by(c,"Element")),f.join("<small> + </small>")}return f=[],i>0&&f.push(1===i?cp(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):B2(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(f.push(1===o?cp(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):B2(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(f.push(1===s?cp(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):B2(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(f.push(1===u?cp(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):B2(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),c>0&&f.push(1===c?cp(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):B2(c,e.firstElementLoc,"element",r,a,n)),f.join("<small> + </small>")}var l=e.firstChainLoc.unit,d=Fe.isAtomic(l)&&1===function J9e(e){var t=e.elements,n=e.model.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments;return i.index[a.offsets[a.index[t[t.length-1]]+1]-1]-i.index[a.offsets[a.index[t[0]]]]+1}(l)||Fe.Traits.is(l.traits,Fe.Trait.MultiChain)?"residue":"chain";return cp(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:a})}(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:yO(n)}function IT(e,t){void 0===t&&(t={});for(var r=Ad.create(),n=0,a=e;n<a.length;n++)Ad.add(r,r,Ad.ofLoci(a[n]));return ET(r,t)}function bN(e,t){return void 0===t&&(t={}),PT({loci:[Re(e.aStructure,[{unit:e.aUnit,indices:ke.ofSingleton(e.aIndex)}]),Re(e.bStructure,[{unit:e.bUnit,indices:ke.ofSingleton(e.bIndex)}])]},t)}function PT(e,t){void 0===t&&(t={});var r=R(R({},yy),t),n=function tje(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var c=u[s];if(!Re.is(c)||1!==Re.size(c)){o=!1;break}}if(o){var d=e.loci.map(function(S){var C=S.elements[0],_=C.unit;return at.create(S.structure,_,_.elements[ke.start(C.indices)])}).map(function(S){return Jee(S,r,n,a||i)});if(i)return d.map(function(S){return S[0].replace(/\[.*\]/g,"").trim()}).filter(function(S){return!!S}).join(" \u2014 ");for(var f=0,p=0,m=Math.min.apply(Math,d.map(function(S){return S.length}))-1;p<m;++p){for(var h=!0,v=1,g=d.length;v<g;++v)if(d[0][p]!==d[v][p]){h=!1;break}if(!h)break;f+=1}if(f>0){var y=[d[0].join(" | ")];for(v=1,g=d.length;v<g;++v)y.push(d[v].slice(f).filter(function(_){return!!_}).join(" | "));return y.join(" \u2014 ")}return d.map(function(S){return S.filter(function(C){return!!C}).join(" | ")}).filter(function(S){return!!S}).join("</br>")}return(d=e.loci.map(function(C){return DT(C,t)})).filter(function(C){return!!C}).join(i?" \u2014 ":"</br>")}(e,r);return r.htmlStyling?n:yO(n)}function cp(e,t){var r,n;void 0===t&&(t={});var a=R(R({},yy),t),i=Jee(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?null!==(n=null===(r=i[0])||void 0===r?void 0:r.replace(/\[.*\]/g,"").trim())&&void 0!==n?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:yO(o)}function Jee(e,t,r,n){void 0===t&&(t="element"),void 0===r&&(r=!1),void 0===n&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),a.push("<small>".concat(i,"</small>")),"structure"!==t&&(a.push("<small>Model ".concat(e.unit.model.modelNum,"</small>")),a.push("<small>Instance ".concat(e.unit.conformation.operator.name,"</small>")))}return Fe.isAtomic(e.unit)?a.push.apply(a,function rje(e,t,r){void 0===r&&(r=!1);var n=at.residueIndex(e),a=ot.chain.label_asym_id(e),i=ot.chain.auth_asym_id(e),o=0===e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n),s=ot.residue.label_seq_id(e),u=ot.residue.auth_seq_id(e),c=ot.residue.pdbx_PDB_ins_code(e),l=ot.atom.label_comp_id(e),d=ot.atom.label_atom_id(e),f=ot.atom.label_alt_id(e),p=ot.atom.occupancy(e),m=ot.residue.microheterogeneityCompIds(e),h="residue"===t&&m.length>1?"(".concat(m.join("|"),")"):l,v=[];switch(t){case"element":v.push("<b>".concat(d,"</b>").concat(f?"%".concat(f):""));case"conformation":"conformation"===t&&f&&v.push("<small>Conformation</small> <b>".concat(f,"</b>"));case"residue":var g=s!==u&&o?s:u;v.push("<b>".concat(h," ").concat(g,"</b>").concat(g!==u?" <small>[auth</small> <b>".concat(u,"</b><small>]</small>"):"","<b>").concat(c||"","</b>"));case"chain":a===i?v.push("<b>".concat(a,"</b>")):"chain"===t&&Fe.Traits.is(e.unit.traits,Fe.Trait.MultiChain)?v.push("<small>[auth</small> <b>".concat(i,"</b><small>]</small>")):v.push("<b>".concat(a,"</b> <small>[auth</small> <b>").concat(i,"</b><small>]</small>"))}return v.length>0&&1!==p&&!r&&(v[0]="".concat(v[0]," <small>[occupancy</small> <b>").concat(Math.round(100*p)/100,"</b><small>]</small>")),v.reverse()}(e,t,n)):Fe.isCoarse(e.unit)?a.push.apply(a,function nje(e,t){var r=ot.coarse.asym_id(e),n=ot.coarse.seq_id_begin(e),a=ot.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=ot.coarse.entityKey(e),u=e.unit.model.sequence.byEntityKey[o].sequence.compId.value(n-1);i.push("<b>".concat(u," ").concat(n,"</b>"))}else i.push("<b>".concat(n,"-").concat(a,"</b>"));case"chain":i.push("<b>".concat(r,"</b>"))}return i.reverse()}(e,t)):a.push("Unknown"),n?a.reverse():a}function SN(e,t){void 0===t&&(t={});var r=R(R(R({},yy),{measureOnly:!1,unitLabel:"\u212b"}),t),n=e.loci.map(function(u){return fr.getCenter(u)}),o="".concat(b.distance(n[0],n[1]).toFixed(2)," ").concat(r.unitLabel);if(r.measureOnly)return o;var s=PT(e,r);return r.condensed?"".concat(o," | ").concat(s):"Distance ".concat(o,"</br>").concat(s)}function CN(e,t){void 0===t&&(t={});var r=R(R(R({},yy),{measureOnly:!1}),t),n=e.loci.map(function(d){return fr.getCenter(d)}),a=n[0],i=n[1],o=n[2],s=b.sub(b(),a,i),u=b.sub(b(),o,i),c="".concat(Ru(b.angle(s,u)).toFixed(2),"\xb0");if(r.measureOnly)return c;var l=PT(e,r);return r.condensed?"".concat(c," | ").concat(l):"Angle ".concat(c,"</br>").concat(l)}function xN(e,t){void 0===t&&(t={});var r=R(R(R({},yy),{measureOnly:!1}),t),n=e.loci.map(function(l){return fr.getCenter(l)}),u="".concat(Ru(b.dihedralAngle(n[0],n[1],n[2],n[3])).toFixed(2),"\xb0");if(r.measureOnly)return u;var c=PT(e,r);return r.condensed?"".concat(u," | ").concat(c):"Dihedral ".concat(u,"</br>").concat(c)}var ete={customText:T.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:T.Color(vr.black,{isEssential:!0}),textSize:T.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},MT=R(R(R({},zu.Params),ete),{borderWidth:T.Numeric(.2,{min:0,max:.5,step:.01})}),tte={unitLabel:T.Text("\u212b",{isEssential:!0})},aje=R(R(R({},na.Params),tte),{lineSizeAttenuation:T.Boolean(!0),linesColor:T.Color(vr.lightgreen,{isEssential:!0}),linesSize:T.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:T.Numeric(.2,{min:.01,max:.2,step:.01})}),ije=R(R({},MT),tte),rte={lines:function(e,t){return Li(uje,na.Utils,{modifyState:function(r){return R(R({},r),{markerActions:ds.Highlighting})}})},text:function(e,t){return Li(lje,zu.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Ut.None})}})}},nte=R(R(R({},aje),ije),{visuals:T.MultiSelect(["lines","text"],T.objectToOptions(rte))});function ate(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,s=i[1];return fr.getBoundingSphere(i[0],r),fr.getBoundingSphere(s,n),b.add(a,r.center,n.center),b.scale(a,a,.5),t.distance=b.distance(r.center,n.center),t}var xm=function oje(){return{sphereA:Pe(),sphereB:Pe(),center:b(),distance:0}}();function ite(e,t){return 1===e.pairs.length?"Distance ".concat(SN(e.pairs[0],{unitLabel:t,measureOnly:!0})):"".concat(e.pairs.length," Distances")}function uje(e,t,r,n){var a=function sje(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)ate(e.pairs[a],xm),n.addFixedLengthDashes(xm.sphereA.center,xm.sphereB.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=ite(t,r.unitLabel);return qr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},function(s){return SN(t.pairs[s],r)})}function lje(e,t,r,n){var a=function cje(e,t,r){for(var n=Fd.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){ate(e.pairs[a],xm);var o=xm.center,u=xm.sphereA,c=xm.sphereB,l=t.customText||"".concat(xm.distance.toFixed(2)," ").concat(t.unitLabel),d=Math.max(2,u.radius,c.radius);n.add(l,o[0],o[1],o[2],1,d/2,a)}return n.getText()}(t,r,n&&n.geometry),i=ite(t,r.unitLabel);return qr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},function(s){return SN(t.pairs[s],r)})}function ote(e){return{pairs:[{loci:[e[0].loci,e[1].loci]}]}}function ste(e){return{triples:[{loci:[e[0].loci,e[1].loci,e[2].loci]}]}}function ute(e){return{quads:[{loci:[e[0].loci,e[1].loci,e[2].loci,e[3].loci]}]}}function cte(e){return{infos:[{loci:e[0].loci}]}}function lte(e){return{locis:e.map(function(t){return t.loci})}}function dte(e){return{locis:e.map(function(t){return t.loci})}}var fje=R(R({},MT),{offsetZ:T.Numeric(2,{min:0,max:10,step:.1})}),fte={text:function(e,t){return Li(vje,zu.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})}},pte=R(R({},fje),{scaleByRadius:T.Boolean(!0),visuals:T.MultiSelect(["text"],T.objectToOptions(fte))}),pje=Pe();function _N(e,t){return void 0===t&&(t=!1),e.label||DT(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function vje(e,t,r,n){var a=function hje(e,t,r){for(var n=Fd.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=fr.getBoundingSphere(s.loci,pje);if(u){var c=u.center,l=u.radius,d=a||_N(s,!0);n.add(d,c[0],c[1],c[2],t.scaleByRadius?l/.9:0,t.scaleByRadius?Math.max(1,l):1,i)}}return n.getText()}(t,r,n&&n.geometry),i=function mje(e){return 1===e.infos.length?_N(e.infos[0]):"".concat(e.infos.length," Labels")}(t),o=r.customText.trim();return qr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o?function(u){return o}:function(u){return _N(t.infos[u])})}var vv=b(),yje=he.identity(),gv=new Float32Array(18),bje=new Uint8Array([0,1,2,3,4,5]);b.zero(),b.zero();var _m=b(),Cje=b(),xje=b(),_je=b(),wje=he.identity(),mte=new Float32Array(24),Aje=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]),Dje=he.identity(),hte=b();function wN(e,t,r,n,a,i){yt.addPrimitive(e,function Eje(e,t,r,n,a){return b.add(hte,t,r),he.targetTo(e,t,hte,n),he.setTranslation(e,t),he.scale(e,e,a)}(Dje,t,r,n,a),dK(i))}var AN={color:T.Color(vr.orange),scaleFactor:T.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:T.Numeric(2,{min:.1,max:10,step:.1})},Ije=R(R({},Vt.Params),AN),Pje=R(R({},Vt.Params),AN),Mje=R(R({},Vt.Params),AN),vte={axes:function(e,t){return Li(Fje,Vt.Utils)},box:function(e,t){return Li(kje,Vt.Utils)},ellipsoid:function(e,t){return Li(Vje,Vt.Utils)}},gte=R(R(R(R({},Ije),Pje),Mje),{visuals:T.MultiSelect(["box"],T.objectToOptions(vte))});function Fje(e,t,r,n){var a=function Oje(e,t,r){var n=yt.createState(256,128,r),a=Re.getPrincipalAxesMany(e.locis);return wo.scale(a.momentsAxes,a.momentsAxes,t.scaleFactor),n.currentGroup=0,function Sje(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;b.add(vv,i,o),b.toArray(b.add(vv,i,o),gv,0),b.toArray(b.sub(vv,i,o),gv,3),b.toArray(b.add(vv,i,s),gv,6),b.toArray(b.sub(vv,i,s),gv,9),b.toArray(b.add(vv,i,u),gv,12),b.toArray(b.sub(vv,i,u),gv,15);var c=NS(gv,bje),l=wo.volume(t),d=Math.cbrt(l)/300*r;yt.addCage(e,yje,c,d,n,a)}(n,a.momentsAxes,t.radiusScale,2,20),yt.getMesh(n)}(t,r,n&&n.geometry),i=function Rje(e){var t=IT(e,{countsOnly:!0});return"Principal Axes of ".concat(t)}(t.locis);return qr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function kje(e,t,r,n){var a=function Nje(e,t,r){var n=yt.createState(256,128,r),a=Re.getPrincipalAxesMany(e.locis);return wo.scale(a.boxAxes,a.boxAxes,t.scaleFactor),n.currentGroup=0,function Tje(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,c=b.negate(Cje,o),l=b.negate(xje,s),d=b.negate(_je,u),f=0,p=function(g,y,S){b.copy(_m,i),b.add(_m,_m,g),b.add(_m,_m,y),b.add(_m,_m,S),b.toArray(_m,mte,f),f+=3};p(o,s,u),p(o,s,d),p(o,l,d),p(o,l,u),p(c,l,d),p(c,l,u),p(c,s,u),p(c,s,d);var m=NS(mte,Aje),h=wo.volume(t),v=Math.cbrt(h)/300*r;yt.addCage(e,wje,m,v,n,a)}(n,a.boxAxes,t.radiusScale,2,20),yt.getMesh(n)}(t,r,n&&n.geometry),i=function Bje(e){var t=IT(e,{countsOnly:!0});return"Oriented Box of ".concat(t)}(t.locis);return qr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function Vje(e,t,r,n){var a=function Uje(e,t,r){var n=yt.createState(256,128,r),i=Re.getPrincipalAxesMany(e.locis).boxAxes,o=i.origin,s=i.dirA,u=i.dirB,c=wo.size(b(),i);b.scale(c,c,.5*t.scaleFactor);var l=b.create(c[2],c[1],c[0]);return n.currentGroup=0,wN(n,o,s,u,l,2),yt.getMesh(n)}(t,r,n&&n.geometry),i=function Lje(e){var t=IT(e,{countsOnly:!0});return"Oriented Ellipsoid of ".concat(t)}(t.locis);return qr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}var zje={radius:1,segments:36,thetaStart:0,thetaLength:2*Math.PI};function yte(e){var m,t=R(R({},zje),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===2*Math.PI,s=o?n+1:n+2,u=new Float32Array(3*s),c=new Float32Array(3*s),l=new Uint32Array(3*n);u[0]=0,u[1]=0,u[2]=0,c[0]=0,c[1]=1,c[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var p=a+d/n*i;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),c[f]=0,c[f+1]=1,c[f+2]=0}for(d=1,f=0;d<n;++d,f+=3)l[f]=d,l[f+1]=d+1,l[f+2]=0;o?(l[m=3*(n-1)]=n,l[m+1]=1,l[m+2]=0):(p=a+i,u[f=3*(n+1)]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),c[f]=0,c[f+1]=1,c[f+2]=0,l[m=3*(n-1)]=n,l[m+1]=n+1,l[m+2]=0);return{vertices:u,normals:c,indices:l}}var bte={color:T.Color(vr.lightgreen),arcScale:T.Numeric(.7,{min:.01,max:1,step:.01})},Ste=R(R(R({},na.Params),bte),{lineSizeAttenuation:T.Boolean(!0),linesSize:T.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:T.Numeric(.04,{min:.01,max:.2,step:.01})}),Hje=R({},Ste),jje=R({},Ste),qje=R(R(R({},Vt.Params),bte),{ignoreLight:T.Boolean(!0),sectorOpacity:T.Numeric(.75,{min:0,max:1,step:.01})}),Cte={vectors:function(e,t){return Li(Xje,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},arc:function(e,t){return Li(Zje,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},sector:function(e,t){return Li($je,Vt.Utils,{modifyProps:function(r){return R(R({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return R(R({},r),{markerActions:ds.Highlighting})}})},text:function(e,t){return Li(eqe,zu.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Ut.None})}})}},xte=R(R(R(R(R({},Hje),jje),qje),MT),{visuals:T.MultiSelect(["vectors","sector","text"],T.objectToOptions(Cte))}),wm=b(),N2=he();function RT(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,c=e.loci,d=c[1],f=c[2];fr.getBoundingSphere(c[0],n),fr.getBoundingSphere(d,a),fr.getBoundingSphere(f,i),b.sub(o,n.center,a.center),b.sub(s,i.center,a.center),b.cross(u,o,s);var p=Math.min(b.magnitude(o),b.magnitude(s));return t.radius=p*r,t.angle=b.angle(o,s),t}function _te(e,t){var r=e.radius,n=e.angle,a=t?Uq(n,r)/t:32;return he.targetTo(N2,e.sphereB.center,e.sphereA.center,e.arcNormal),he.setTranslation(N2,e.sphereB.center),he.mul(N2,N2,he.rotY180),YF(yte({radius:r,thetaLength:n,segments:a}),N2)}var Oo=function Wje(){return{sphereA:Pe(),sphereB:Pe(),sphereC:Pe(),arcDirA:b(),arcDirC:b(),arcNormal:b(),radius:0,angle:0}}();function OT(e){return 1===e.triples.length?"Angle ".concat(CN(e.triples[0],{measureOnly:!0})):"".concat(e.triples.length," Angles")}function Xje(e,t,r,n){var a=function Yje(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.triples.length;a<i;++a)RT(e.triples[a],Oo,t.arcScale),n.addFixedLengthDashes(Oo.sphereB.center,Oo.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Oo.sphereB.center,Oo.sphereC.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=OT(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Zje(e,t,r,n){var a=function Kje(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.triples.length;a<i;++a){RT(e.triples[a],Oo,t.arcScale);for(var o=_te(Oo,t.dashLength),s=o.indices,u=o.vertices,c=0,l=s.length;c<l;c+=3)if(c%2!=1){var d=3*s[c],f=3*s[c+1];n.add(u[d],u[d+1],u[d+2],u[f],u[f+1],u[f+2],a)}}return n.getLines()}(t,r,n&&n.geometry),i=OT(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function $je(e,t,r,n){var a=function Qje(e,t,r){for(var n=yt.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){RT(e.triples[a],Oo,t.arcScale);var o=_te(Oo);n.currentGroup=a,yt.addPrimitive(n,he.id,o),yt.addPrimitiveFlipped(n,he.id,o)}return yt.getMesh(n)}(t,r,n&&n.geometry),i=OT(t);return qr.create(i,t,a,function(){return r.color},function(){return 1},function(s){return CN(t.triples[s])})}function eqe(e,t,r,n){var a=function Jje(e,t,r){for(var n=Fd.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){RT(e.triples[a],Oo,t.arcScale),b.add(wm,Oo.arcDirA,Oo.arcDirC),b.setMagnitude(wm,wm,Oo.radius),b.add(wm,Oo.sphereB.center,wm);var o=Ru(Oo.angle).toFixed(2),s=t.customText||"".concat(o,"\xb0"),u=Math.max(2,Oo.sphereA.radius,Oo.sphereB.radius,Oo.sphereC.radius);n.add(s,wm[0],wm[1],wm[2],.1,u/2,a)}return n.getText()}(t,r,n&&n.geometry),i=OT(t);return qr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},function(s){return CN(t.triples[s])})}var wte={color:T.Color(vr.lightgreen),arcScale:T.Numeric(.7,{min:.01,max:1,step:.01})},FT=R(R(R({},na.Params),wte),{lineSizeAttenuation:T.Boolean(!0),linesSize:T.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:T.Numeric(.04,{min:.01,max:.2,step:.01})}),rqe=R({},FT),nqe=R({},FT),aqe=R({},FT),iqe=R({},FT),oqe=R(R(R({},Vt.Params),wte),{ignoreLight:T.Boolean(!0),sectorOpacity:T.Numeric(.75,{min:0,max:1,step:.01})}),Ate={vectors:function(e,t){return Li(cqe,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},extenders:function(e,t){return Li(hqe,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},connector:function(e,t){return Li(dqe,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},arms:function(e,t){return Li(pqe,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},arc:function(e,t){return Li(gqe,na.Utils,{modifyState:function(r){return R(R({},r),{pickable:!1})}})},sector:function(e,t){return Li(bqe,Vt.Utils,{modifyProps:function(r){return R(R({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return R(R({},r),{markerActions:ds.Highlighting})}})},text:function(e,t){return Li(Cqe,zu.Utils,{modifyState:function(r){return R(R({},r),{markerActions:Ut.None})}})}},Tte=R(R(R(R(R(R(R({},rqe),nqe),aqe),iqe),oqe),MT),{visuals:T.MultiSelect(["extenders","arms","sector","text"],T.objectToOptions(Ate))}),ps=b(),k2=he();function yv(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,c=t.projA,l=t.projD,d=t.arcPointA,f=t.arcPointD,p=t.arcDirA,m=t.arcDirD,h=t.arcCenter,v=t.arcNormal,g=e.loci,S=g[1],C=g[2],_=g[3];fr.getBoundingSphere(g[0],n),fr.getBoundingSphere(S,a),fr.getBoundingSphere(C,i),fr.getBoundingSphere(_,o),b.add(h,a.center,i.center),b.scale(h,h,.5),b.sub(s,n.center,a.center),b.sub(u,o.center,i.center),b.add(d,h,s),b.add(f,h,u),b.sub(v,i.center,a.center),b.orthogonalize(p,v,s),b.orthogonalize(m,v,u),b.projectPointOnVector(c,d,p,h),b.projectPointOnVector(l,f,m,h);var D=Math.min(b.distance(c,h),b.distance(l,h))*r;b.setMagnitude(p,p,D),b.setMagnitude(m,m,D),b.add(d,h,p),b.add(f,h,m),t.radius=D,t.angle=b.dihedralAngle(n.center,a.center,i.center,o.center),b.matchDirection(ps,v,b.sub(ps,d,n.center));var w=b.angle(s,ps),A=D/Math.cos(w-rS);b.add(c,a.center,b.setMagnitude(ps,s,A)),b.matchDirection(ps,v,b.sub(ps,f,o.center));var E=b.angle(u,ps),I=D/Math.cos(E-rS);return b.add(l,i.center,b.setMagnitude(ps,u,I)),t}function Dte(e,t){var r=e.radius,n=e.angle,a=t?Uq(n,r)/t:32;return he.targetTo(k2,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),he.setTranslation(k2,e.arcCenter),he.mul(k2,k2,he.rotY180),YF(yte({radius:r,thetaLength:Math.abs(n),segments:a}),k2)}var zn=function sqe(){return{sphereA:Pe(),sphereB:Pe(),sphereC:Pe(),sphereD:Pe(),dirBA:b(),dirCD:b(),projA:b(),projD:b(),arcPointA:b(),arcPointD:b(),arcDirA:b(),arcDirD:b(),arcCenter:b(),arcNormal:b(),radius:0,angle:0}}();function bv(e){return 1===e.quads.length?"Dihedral ".concat(xN(e.quads[0],{measureOnly:!0})):"".concat(e.quads.length," Dihedrals")}function cqe(e,t,r,n){var a=function uqe(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.quads.length;a<i;++a)yv(e.quads[a],zn,t.arcScale),n.addFixedLengthDashes(zn.arcCenter,zn.arcPointA,t.dashLength,a),n.addFixedLengthDashes(zn.arcCenter,zn.arcPointD,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function dqe(e,t,r,n){var a=function lqe(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.quads.length;a<i;++a)yv(e.quads[a],zn,t.arcScale),n.addFixedLengthDashes(zn.sphereB.center,zn.sphereC.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function pqe(e,t,r,n){var a=function fqe(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.quads.length;a<i;++a)yv(e.quads[a],zn,t.arcScale),n.addFixedLengthDashes(zn.sphereB.center,zn.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(zn.sphereC.center,zn.sphereD.center,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function hqe(e,t,r,n){var a=function mqe(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.quads.length;a<i;++a)yv(e.quads[a],zn,t.arcScale),n.addFixedLengthDashes(zn.arcPointA,zn.projA,t.dashLength,a),n.addFixedLengthDashes(zn.arcPointD,zn.projD,t.dashLength,a);return n.getLines()}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function gqe(e,t,r,n){var a=function vqe(e,t,r){for(var n=uu.create(128,64,r),a=0,i=e.quads.length;a<i;++a){yv(e.quads[a],zn,t.arcScale);for(var o=Dte(zn,t.dashLength),s=o.indices,u=o.vertices,c=0,l=s.length;c<l;c+=3)if(c%2!=1){var d=3*s[c],f=3*s[c+1];n.add(u[d],u[d+1],u[d+2],u[f],u[f+1],u[f+2],a)}}return n.getLines()}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function bqe(e,t,r,n){var a=function yqe(e,t,r){for(var n=yt.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){yv(e.quads[a],zn,t.arcScale);var o=Dte(zn);n.currentGroup=a,yt.addPrimitive(n,he.id,o),yt.addPrimitiveFlipped(n,he.id,o)}return yt.getMesh(n)}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.color},function(){return 1},function(s){return xN(t.quads[s])})}function Cqe(e,t,r,n){var a=function Sqe(e,t,r){for(var n=Fd.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){yv(e.quads[a],zn,t.arcScale),b.add(ps,zn.arcDirA,zn.arcDirD),b.setMagnitude(ps,ps,zn.radius),b.add(ps,zn.arcCenter,ps);var o=Ru(zn.angle).toFixed(2);"-0.00"===o&&(o="0.00");var s=t.customText||"".concat(o,"\xb0"),u=Math.max(2,zn.sphereA.radius,zn.sphereB.radius,zn.sphereC.radius,zn.sphereD.radius);n.add(s,ps[0],ps[1],ps[2],.1,u/2,a)}return n.getText()}(t,r,n&&n.geometry),i=bv(t);return qr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},function(s){return xN(t.quads[s])})}var _qe=Bt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ve.Root,to:ve.Shape.Provider,params:{bottomLeft:T.Vec3(b()),topRight:T.Vec3(b.create(1,1,1)),radius:T.Numeric(.15,{min:.01,max:4,step:.01}),color:T.Color(vr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return Ve.create("Shape Representation",function(n){return ue(t,void 0,void 0,function(){return ce(this,function(a){return[2,new ve.Shape.Provider({label:"Box",data:r,params:Vt.Params,getShape:function(i,o){var s=TN(Nt.create(r.bottomLeft,r.topRight),r.radius);return qr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Vt.Utils},{label:"Box"})]})})})}});function TN(e,t,r){var n=b.sub(b(),e.max,e.min),a=he.fromTranslation(he(),b.create(.5,.5,.5)),i=he.fromScaling(he(),n),o=he.fromTranslation(he(),e.min),s=he.mul3(he(),o,i,a),u=yt.createState(256,128,r);u.currentGroup=1,yt.addCage(u,s,PK(),t,2,20);var c=yt.getMesh(u),l=b.scaleAndAdd(b(),e.min,n,.5),d=b.distance(e.min,l);return c.setBoundingSphere(Pe.create(l,d)),c}var Ete={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};new Uint32Array([0,1,2,3,3,1,2,0]);var Tqe=R(R({},Vt.Params),{color:T.Color(vr.orange),scaleFactor:T.Numeric(1,{min:.1,max:10,step:.1})}),Ite={plane:function(e,t){return Li(Iqe,Vt.Utils)}},Pte=R(R({},Tqe),{visuals:T.MultiSelect(["plane"],T.objectToOptions(Ite))}),Am=he(),DN=b();function Iqe(e,t,r,n){var a=function Eqe(e,t,r){var n=yt.createState(256,128,r),i=Re.getPrincipalAxesMany(e.locis).boxAxes,o=function Aqe(){return Ete}();return b.add(DN,i.origin,i.dirC),he.targetTo(Am,DN,i.origin,i.dirB),he.scale(Am,Am,wo.size(DN,i)),he.scaleUniformly(Am,Am,t.scaleFactor),he.setTranslation(Am,i.origin),n.currentGroup=0,yt.addPrimitive(n,Am,o),yt.addPrimitiveFlipped(n,Am,o),yt.getMesh(n)}(t,r,n&&n.geometry),i=function Dqe(e){var t=IT(e,{countsOnly:!0});return"Best Fit Plane of ".concat(t)}(t.locis);return qr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}var Bd,BT=Bt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ve.Molecule.Structure,to:ve.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(c){var d=c.params,p=a.colorThemeRegistry.get(c.name).factory({},d);return{description:p.description,legend:p.legend}}};return{type:T.Mapped(n.default.name,n.types,function(c){return T.Group(n.get(c).getParams(a,Ze.Empty))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(c){return T.Group(a.colorThemeRegistry.get(c).getParams({structure:Ze.Empty}))},o),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(c){return T.Group(a.sizeThemeRegistry.get(c).getParams({structure:Ze.Empty}))})}}var s={structure:e.data},u={help:function(c){var d=c.params,p=a.colorThemeRegistry.get(c.name).factory(s,d);return{description:p.description,legend:p.legend}}};return{type:T.Mapped(n.default.name,n.getApplicableTypes(e.data),function(c){return T.Group(n.get(c).getParams(a,e.data))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(c){return T.Group(a.colorThemeRegistry.get(c).getParams(s))},u),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(s),function(c){return T.Group(a.sizeThemeRegistry.get(c).getParams(s))})}}})({canAutoUpdate:function(e){var n=e.newParams;return e.a.data.elementCount<1e4||e.oldParams.type.name===n.type.name&&"custom"!==n.type.params.quality},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Representation",function(o){return ue(r,void 0,void 0,function(){var s,u,c,l,f,p;return ce(this,function(m){switch(m.label){case 0:return s={runtime:o,assetManager:t.managers.asset},u=t.representation.structure.registry.get(a.type.name),c=(null===(f=u.getData)||void 0===f?void 0:f.call(u,n.data,a.type.params))||n.data,u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(s,c)]:[3,2];case 1:m.sent(),m.label=2;case 2:return l=u.factory(R({webgl:null===(p=t.canvas3d)||void 0===p?void 0:p.webgl},t.representation.structure.themes),u.getParams),[4,_i.ensureDependencies(s,t.representation.structure.themes,{structure:c},a)];case 3:return m.sent(),l.setTheme(_i.create(t.representation.structure.themes,{structure:c},a)),[4,l.createOrUpdate(a.type.params||{},c).runInContext(o)];case 4:return m.sent(),[2,new ve.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:u.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Ve.create("Structure Representation",function(u){return ue(r,void 0,void 0,function(){var c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return o.type.name!==i.type.name?[2,rt.UpdateResult.Recreate]:(c=t.representation.structure.registry.get(o.type.name),null!==(p=c.mustRecreate)&&void 0!==p&&p.call(c,i.type.params,o.type.params)?[2,rt.UpdateResult.Recreate]:(l=(null===(m=c.getData)||void 0===m?void 0:m.call(c,n.data,o.type.params))||n.data,d={runtime:u,assetManager:t.managers.asset},c.ensureCustomProperties?[4,c.ensureCustomProperties.attach(d,l)]:[3,2]));case 1:h.sent(),h.label=2;case 2:return _i.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,_i.ensureDependencies(d,t.representation.structure.themes,{structure:l},o)];case 3:return h.sent(),a.data.repr.setTheme(_i.create(t.representation.structure.themes,{structure:l},o)),f=R(R({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(f,l).runInContext(u)];case 4:return h.sent(),a.data.sourceData=n.data,[2,rt.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(r&&n){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),_i.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if("uniform"!==e.colorTheme.name||"uniform"!==t.colorTheme.name)return r<=.5?e:t;var i=dt.interpolate(e.colorTheme.params.value,t.colorTheme.params.value,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),Mqe=Bt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:{t:T.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new vy(n);return zee(n,a,r.t),new ve.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new vy(n)},info:n,repr:t.data.repr},{label:"Unwind T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info;return t.data.sourceData!==i||t.data.repr!==r.data.repr?rt.UpdateResult.Recreate:e.oldParams.t===n.t?rt.UpdateResult.Unchanged:(zee(i,r.data.state.unitTransforms,n.t),r.label="Unwind T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,rt.UpdateResult.Updated)}}),Rqe=Bt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:{t:T.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new vy(n);return jee(n,a,r.t,n.root.boundary.sphere),new ve.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new vy(n)},info:n,repr:t.data.repr},{label:"Explode T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=t.data.sourceData;return r.data.info!==i||t.data.repr!==r.data.repr?rt.UpdateResult.Recreate:e.oldParams.t===n.t?rt.UpdateResult.Unchanged:(jee(i,r.data.state.unitTransforms,n.t,i.root.boundary.sphere),r.label="Explode T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,rt.UpdateResult.Updated)}}),Oqe=Bt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:R({t:T.Numeric(0,{min:0,max:1,step:.01})},H9e)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new vy(n),i=qee(n.root,r);return Xee(n,a,r.t,i.axis,i.origin),new ve.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new vy(n)},info:n,repr:t.data.repr},{label:"Spin T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return rt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=qee(i.root,n);return Xee(i,o,n.t,s.axis,s.origin),r.label="Spin T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,rt.UpdateResult.Updated}}),Fqe=Bt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Ni("(sel.atom.all)","mol-script")),color:T.Color(vr.blueviolet),clear:T.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":dt.toRgbString(e.color))},{defaultValue:[{script:Ni("(sel.atom.all)","mol-script"),color:vr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Io.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Io.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&If(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.overpaint,c=Io.ofScript(n.layers,o);return Io.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.overpaint=c,r.data.repr=t.data.repr,r.label="Overpaint (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),Bqe=Bt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(rn.Empty),color:T.Color(vr.blueviolet),clear:T.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":dt.toRgbString(e.color))},{defaultValue:[{bundle:rn.Empty,color:vr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Io.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Io.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&If(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.overpaint,c=Io.ofBundle(n.layers,o);return Io.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.overpaint=c,r.data.repr=t.data.repr,r.label="Overpaint (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),Nqe=Bt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Ni("(sel.atom.all)","mol-script")),value:T.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{script:Ni("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Po.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Po.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&If(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.transparency,c=Po.ofScript(n.layers,o);return Po.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.transparency=c,r.data.repr=t.data.repr,r.label="Transparency (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),kqe=Bt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(rn.Empty),value:T.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{bundle:rn.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Po.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Po.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&If(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.transparency,c=Po.ofBundle(n.layers,o);return Po.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.transparency=c,r.data.repr=t.data.repr,r.label="Transparency (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),Lqe=Bt.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Ni("(sel.atom.all)","mol-script")),material:as.getParam(),clear:T.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":as.toString(e.material))},{defaultValue:[{script:Ni("(sel.atom.all)","mol-script"),material:as({roughness:1}),clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Mo.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:Mo.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&If(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.substance,c=Mo.ofScript(n.layers,o);return Mo.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.substance=c,r.data.repr=t.data.repr,r.label="Substance (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),Uqe=Bt.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(rn.Empty),material:as.getParam(),clear:T.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":as.toString(e.material))},{defaultValue:[{bundle:rn.Empty,material:as({roughness:1}),clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Mo.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:Mo.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=r.data.info,o=t.data.sourceData;if(o!==i.structure||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var s=t.data.repr.geometryVersion;if(s!==i.geometryVersion&&If(t.data.repr.props))return rt.UpdateResult.Recreate;var u=r.data.state.substance,c=Mo.ofBundle(n.layers,o);return Mo.areEqual(u,c)?rt.UpdateResult.Unchanged:(i.geometryVersion=s,r.data.state.substance=c,r.data.repr=t.data.repr,r.label="Substance (".concat(c.layers.length," Layers)"),rt.UpdateResult.Updated)}}),Vqe=Bt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({script:T.Script(Ni("(sel.atom.all)","mol-script")),groups:T.Converted(function(e){return Gn.Groups.toNames(e)},function(e){return Gn.Groups.fromNames(e)},T.MultiSelect(pw(Gn.Groups.Names),T.objectToOptions(Gn.Groups.Names)))},function(e){return"".concat(Gn.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{script:Ni("(sel.atom.all)","mol-script"),groups:Gn.Groups.Flag.None}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=Gn.ofScript(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:Gn.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var o=r.data.state.clipping,s=Gn.ofScript(e.newParams.layers,i);return Gn.areEqual(o,s)?rt.UpdateResult.Unchanged:(r.data.state.clipping=s,r.data.repr=t.data.repr,r.label="Clipping (".concat(s.layers.length," Layers)"),rt.UpdateResult.Updated)}}),Gqe=Bt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{layers:T.ObjectList({bundle:T.Value(rn.Empty),groups:T.Converted(function(e){return Gn.Groups.toNames(e)},function(e){return Gn.Groups.fromNames(e)},T.MultiSelect(pw(Gn.Groups.Names),T.objectToOptions(Gn.Groups.Names)))},function(e){return"".concat(Gn.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{bundle:rn.Empty,groups:Gn.Groups.Flag.None}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,n=t.data.sourceData,a=Gn.ofBundle(e.params.layers,n);return new ve.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:Gn.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return rt.UpdateResult.Recreate;var o=r.data.state.clipping,s=Gn.ofBundle(e.newParams.layers,i);return Gn.areEqual(o,s)?rt.UpdateResult.Unchanged:(r.data.state.clipping=s,r.data.repr=t.data.repr,r.label="Clipping (".concat(s.layers.length," Layers)"),rt.UpdateResult.Updated)}}),zqe=Bt.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:ve.Molecule.Structure.Representation3D,to:ve.Molecule.Structure.Representation3DState,params:function(){return{overpaintStrength:T.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:T.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:T.Numeric(1,{min:0,max:1,step:.01})}}})({canAutoUpdate:function(){return!0},apply:function(e){var r=e.params;return new ve.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:r.overpaintStrength,transparency:r.transparencyStrength,substance:r.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,substance:1}},info:{},repr:e.a.data.repr},{label:"Theme Strength",description:"".concat(r.overpaintStrength.toFixed(2),", ").concat(r.transparencyStrength.toFixed(2),", ").concat(r.substanceStrength.toFixed(2))})},update:function(e){var t,r,n,a=e.a,i=e.b,o=e.newParams;return o.overpaintStrength===(null===(t=i.data.state.themeStrength)||void 0===t?void 0:t.overpaint)&&o.transparencyStrength===(null===(r=i.data.state.themeStrength)||void 0===r?void 0:r.transparency)&&o.substanceStrength===(null===(n=i.data.state.themeStrength)||void 0===n?void 0:n.substance)?rt.UpdateResult.Unchanged:(i.data.state.themeStrength={overpaint:o.overpaintStrength,transparency:o.transparencyStrength,substance:o.substanceStrength},i.data.repr=a.data.repr,i.label="Theme Strength",i.description="".concat(o.overpaintStrength.toFixed(2),", ").concat(o.transparencyStrength.toFixed(2),", ").concat(o.substanceStrength.toFixed(2)),rt.UpdateResult.Updated)},interpolate:function(e,t,r){return{overpaintStrength:ta(e.overpaintStrength,t.overpaintStrength,r),transparencyStrength:ta(e.transparencyStrength,t.transparencyStrength,r),substanceStrength:ta(e.substanceStrength,t.substanceStrength,r)}}});!function(e){e.getDefaultParams=function t(a,i,o,s,u,c,l,d){var f=a.representation.volume.registry.get(i),p=a.representation.volume.themes.colorThemeRegistry.get(u||f.defaultColorTheme.name),m=a.representation.volume.themes.sizeThemeRegistry.get(l||f.defaultSizeTheme.name),h=T.getDefaultValues(f.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?R(R({},h),s):h},colorTheme:{name:p.name,params:c?R(R({},p.defaultValues),c):p.defaultValues},sizeTheme:{name:m.name,params:d?R(R({},m.defaultValues),d):m.defaultValues}}},e.getDefaultParamsStatic=function r(a,i,o,s,u,c,l){var d=a.representation.volume.registry.get(i),f=a.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),p=a.representation.volume.themes.sizeThemeRegistry.get(c||d.defaultSizeTheme.name);return{type:{name:i,params:o?R(R({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?R(R({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:l?R(R({},p.defaultValues),l):p.defaultValues}}},e.getDescription=function n(a){var i,o,s,u;return a.isoValue?nt.IsoValue.toString(a.isoValue):null!==(o=null===(i=a.renderMode)||void 0===i?void 0:i.params)&&void 0!==o&&o.isoValue?nt.IsoValue.toString(null===(u=null===(s=a.renderMode)||void 0===s?void 0:s.params)||void 0===u?void 0:u.isoValue):void 0}}(Bd||(Bd={}));var Hqe=Bt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ve.Volume.Data,to:ve.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:T.Mapped(n.default.name,n.types,function(s){return T.Group(n.get(s).getParams(a,nt.One))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return T.Group(a.colorThemeRegistry.get(s).getParams({volume:nt.One}))}),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return T.Group(a.sizeThemeRegistry.get(s).getParams({volume:nt.One}))})};var o={volume:e.data};return{type:T.Mapped(n.default.name,n.types,function(s){return T.Group(n.get(s).getParams(a,e.data))}),colorTheme:T.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return T.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:T.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(o),function(s){return T.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){return e.oldParams.type.name===e.newParams.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Volume Representation",function(i){return ue(r,void 0,void 0,function(){var o,s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return o={runtime:i,assetManager:t.managers.asset},(s=t.representation.volume.registry.get(a.type.name)).ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return(u=s.factory(R({webgl:null===(l=t.canvas3d)||void 0===l?void 0:l.webgl},t.representation.volume.themes),s.getParams)).setTheme(_i.create(t.representation.volume.themes,{volume:n.data},a)),[4,u.createOrUpdate(c=a.type.params||{},n.data).runInContext(i)];case 3:return d.sent(),[2,new ve.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:Bd.getDescription(c)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Ve.create("Volume Representation",function(s){return ue(r,void 0,void 0,function(){var u,c,l;return ce(this,function(d){switch(d.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),null===(l=u.ensureCustomProperties)||void 0===l||l.detach(n.data),[2,rt.UpdateResult.Recreate]):(c=R(R({},a.data.repr.props),o.type.params),a.data.repr.setTheme(_i.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(c,n.data).runInContext(s)]);case 1:return d.sent(),a.data.sourceData=n.data,a.description=Bd.getDescription(c),[2,rt.UpdateResult.Updated]}})})})}}),jqe=Bt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ve.Shape.Provider,to:ve.Shape.Representation3D,params:function(e,t){return e?e.data.params:st.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Shape Representation",function(i){return ue(r,void 0,void 0,function(){var o,s;return ce(this,function(u){switch(u.label){case 0:return o=R(R({},T.getDefaultValues(n.data.params)),a),[4,(s=Li(n.data.getShape,n.data.geometryUtils)).createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Shape Representation",function(s){return ue(r,void 0,void 0,function(){var u;return ce(this,function(c){switch(c.label){case 0:return u=R(R({},a.data.repr.props),o),[4,a.data.repr.createOrUpdate(u,n.data.data).runInContext(s)];case 1:return c.sent(),a.data.sourceData=n.data,[2,rt.UpdateResult.Updated]}})})})}}),qqe=Bt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ve.Molecule.Model,to:ve.Shape.Representation3D,params:function(){return R({},Zee)}})({isApplicable:function(e){return!!Ja.Provider.get(e.data)},canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Model Unit Cell",function(i){return ue(r,void 0,void 0,function(){var o,s,u,c;return ce(this,function(l){switch(l.label){case 0:return(o=Ja.Provider.get(n.data))?(s=Qee(n.data,o,a),u=function $9e(e,t){return lr.createMulti("Unit Cell",e,t,lr.StateBuilder,K9e)}(R({webgl:null===(c=t.canvas3d)||void 0===c?void 0:c.webgl},t.representation.structure.themes),function(){return Zee}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,Jn.Null];case 1:return l.sent(),[2,new ve.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return Ve.create("Model Unit Cell",function(i){return ue(t,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return(o=Ja.Provider.get(r.data))?(s=R(R({},n.data.repr.props),a),u=Qee(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,rt.UpdateResult.Null];case 1:return c.sent(),n.data.sourceData=u,[2,rt.UpdateResult.Updated]}})})})}}),Wqe=Bt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ve.Molecule.Structure,to:ve.Shape.Representation3D,params:R({radius:T.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:T.Color(vr.red,{isEssential:!0})},Vt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Bounding Box",function(i){return ue(r,void 0,void 0,function(){var o;return ce(this,function(s){switch(s.label){case 0:return[4,(o=Li(function(u,c,l,d){var f=TN(c.box,c.radius,d?.geometry);return qr.create("Bouding Box",c,f,function(){return c.color},function(){return 1},function(){return"Bounding Box"})},Vt.Utils)).createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new ve.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Bounding Box",function(s){return ue(r,void 0,void 0,function(){return ce(this,function(u){switch(u.label){case 0:return[4,a.data.repr.createOrUpdate(o,{box:n.data.boundary.box,radius:o.radius,color:o.color}).runInContext(s)];case 1:return u.sent(),a.data.sourceData=n.data,[2,rt.UpdateResult.Updated]}})})})}}),Yqe=Bt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},nte)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Distance",function(i){return ue(r,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return o=ote(n.data),s=function dje(e,t){return lr.createMulti("Distance",e,t,lr.StateBuilder,rte)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return nte}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Distance",function(s){return ue(r,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=ote(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),Xqe=Bt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},xte)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Angle",function(i){return ue(r,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return o=ste(n.data),s=function tqe(e,t){return lr.createMulti("Angle",e,t,lr.StateBuilder,Cte)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return xte}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Angle",function(s){return ue(r,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=ste(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),Kqe=Bt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},Tte)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Dihedral",function(i){return ue(r,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return o=ute(n.data),s=function xqe(e,t){return lr.createMulti("Dihedral",e,t,lr.StateBuilder,Ate)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return Tte}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Dihedral",function(s){return ue(r,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=ute(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),Zqe=Bt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},pte)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Label",function(i){return ue(r,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return o=cte(n.data),s=function gje(e,t){return lr.createMulti("Label",e,t,lr.StateBuilder,fte)}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return pte}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Label",function(s){return ue(r,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=cte(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),Qqe=Bt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},gte)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Orientation",function(i){return ue(r,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return o=lte(n.data),s=function Gje(e,t){var r=lr.createMulti("Orientation",e,t,lr.StateBuilder,vte);return r.setState({markerActions:ds.Highlighting}),r}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return gte}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Orientation",function(s){return ue(r,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=lte(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),$qe=Bt.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:ve.Molecule.Structure.Selections,to:ve.Shape.Representation3D,params:function(){return R({},Pte)}})({canAutoUpdate:function(e){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Ve.create("Structure Plane",function(i){return ue(r,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return o=dte(n.data),s=function Pqe(e,t){var r=lr.createMulti("Plane",e,t,lr.StateBuilder,Ite);return r.setState({markerActions:ds.Highlighting}),r}(R({webgl:null===(u=t.canvas3d)||void 0===u?void 0:u.webgl},t.representation.structure.themes),function(){return Pte}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new ve.Shape.Representation3D({repr:s,sourceData:o},{label:"Plane"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,o=e.newParams;return Ve.create("Structure Plane",function(s){return ue(r,void 0,void 0,function(){var u,c;return ce(this,function(l){switch(l.label){case 0:return u=R(R({},a.data.repr.props),o),c=dte(n.data),[4,a.data.repr.createOrUpdate(u,c).runInContext(s)];case 1:return l.sent(),a.data.sourceData=c,[2,rt.UpdateResult.Updated]}})})})}}),et={Data:Jy,Misc:cE,Model:vE,Volume:gE,Representation:bE,Shape:yE};function Kn(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=kn.create22(),e}var Jqe=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||this.subs.set(t.id,a=[]),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){n.disposing?i("disposed"):n.subs.get(t.id)?n.resolve({cmd:t,params:r,resolve:a,reject:i}):a()})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ue(this,void 0,void 0,function(){var r,n,a,o;return ce(this,function(s){switch(s.label){case 0:if(!(r=this.subs.get(t.cmd.id)))return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?[4,(0,a[n])(t.params)]:[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),yr={State:{SetCurrentObject:Kn(),ApplyAction:Kn(),Update:Kn(),RemoveObject:Kn(),ToggleExpanded:Kn(),ToggleVisibility:Kn(),Snapshots:{Add:Kn(),Replace:Kn(),Move:Kn(),Remove:Kn(),Apply:Kn(),Clear:Kn(),Upload:Kn(),Fetch:Kn(),DownloadToFile:Kn(),OpenFile:Kn(),OpenUrl:Kn()}},Interactivity:{Object:{Highlight:Kn()},Structure:{Highlight:Kn(),Select:Kn()},ClearHighlights:Kn()},Layout:{Update:Kn()},Toast:{Show:Kn(),Hide:Kn()},Camera:{Reset:Kn(),SetSnapshot:Kn(),Focus:Kn(),OrientAxes:Kn(),ResetAxes:Kn()},Canvas3D:{SetSettings:Kn(),ResetSettings:Kn()}},eWe=lf.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],n=0,a=e.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Structure));n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:T.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:T.Boolean(!1),target:T.Select(t[0][0],t)}},canApply:function(e){return{canApply:e.state.data.select(xr.Generators.ofType(ve.Molecule.Structure.Representation3D,on.RootRef)).length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,i=n.select(xr.Generators.ofType(ve.Molecule.Structure.Representation3D,e.target&&"all"!==e.target?e.target:on.RootRef)),o=n.build(),s=!1,u=0,c=i;u<c.length;u++){var l=c[u];n.select(xr.Generators.ofTransformer(et.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref)).length>0||(s=!0,o.to(l).apply(et.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(xr.Generators.ofType(ve.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(0!==a.length){for(var i=n.build(),o=0,s=a;o<s.length;o++)i.delete(s[o].transform.ref);return i.commit()}},apply:function(e,t,r){return ue(this,void 0,void 0,function(){var n,i,o,u,c,l,d;return ce(this,function(p){switch(p.label){case 0:if(0===(i=(n=r.plugin.state.data).select(xr.Generators.ofTransformer(et.Representation.UnwindStructureAssemblyRepresentation3D,r.params.target&&"all"!==r.params.target?r.params.target:on.RootRef))).length)return[2,{kind:"finished"}];for(o=n.build(),u=e.t+(t.current-t.lastApplied)/r.params.durationInMs,c=!1,r.params.playOnce&&u>=1?(c=!0,u=1):u%=1,l=0,d=i;l<d.length;l++)o.to(d[l]).update({t:u});return[4,yr.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return p.sent(),c?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),NT=b(),Mte=b(),Rte=hn(),tWe=lf.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:T.Numeric(4e3,{min:100,max:2e4,step:100}),speed:T.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:T.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:null===(r=t.canvas3d)||void 0===r?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;null===(n=r.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ue(this,void 0,void 0,function(){var i,o,s,u;return ce(this,function(c){return 0===t.current?[2,{kind:"next",state:e}]:(i=e.snapshot).radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?(null===(n=t.animation)||void 0===n?void 0:n.currentFrame)/(t.animation.frameCount+1):Xi(t.current/r.params.durationInMs,0,1),s=2*Math.PI*o*r.params.speed*("ccw"===r.params.direction?-1:1),b.sub(NT,i.position,i.target),b.normalize(Mte,i.up),hn.setAxisAngle(Rte,Mte,s),b.transformQuat(NT,NT,Rte),u=b.add(b(),i.target,NT),null===(a=r.plugin.canvas3d)||void 0===a||a.requestCameraReset({snapshot:R(R({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}])})})}}),rWe=lf.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:T.MappedStatic("loop",{palindrome:T.Group({}),loop:T.Group({direction:T.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:T.Group({direction:T.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:T.MappedStatic("fixed",{fixed:T.Group({durationInS:T.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:T.Group({targetFps:T.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:T.Group({maxFps:T.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,n=0,a=t.select(xr.Generators.ofTransformer(et.Model.ModelFromTrajectory));n<a.length;n++){var o=xr.findAncestorOfType(t.tree,t.cells,a[n].transform.ref,ve.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if("fixed"===(null===(r=e.duration)||void 0===r?void 0:r.name))return{kind:"fixed",durationMs:1e3*e.duration.params.durationInS};if("computed"===e.duration.name){for(var n=t.state.data,i=0,o=0,s=n.select(xr.Generators.ofTransformer(et.Model.ModelFromTrajectory));o<s.length;o++){var c=xr.findAncestorOfType(n.tree,n.cells,s[o].transform.ref,ve.Molecule.Trajectory);c&&c.obj&&(i=Math.max(Math.ceil(1e3*c.obj.data.frameCount/e.duration.params.targetFps),i))}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f;return ce(this,function(m){switch(m.label){case 0:if("sequential"===r.params.duration.name&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(0===(a=(n=r.plugin.state.data).select(xr.Generators.ofTransformer(et.Model.ModelFromTrajectory))).length)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,c=!0,l=function(h){var v=xr.findAncestorOfType(n.tree,n.cells,h.transform.ref,ve.Molecule.Trajectory);if(!v||!v.obj)return"continue";var g=v.obj;if(g.data.frameCount<=1)return"continue";i.to(h).update(function(y){var S=g.data.frameCount;if(1===S)return y;if(c=!1,"sequential"===o.duration.name){var C=1;if("once"===o.mode.name){if(-1==(C="backward"===o.mode.params.direction?-1:1)&&0===y.modelIndex||1===C&&y.modelIndex===S-1)return u=!0,y}else"palindrome"===o.mode.name&&(C=0===y.modelIndex?1:y.modelIndex===S-1?-1:s[h.transform.ref]||1);return s[h.transform.ref]=C,(_=(y.modelIndex+C)%S)<0&&(_+=S),u=u||-1===C&&0===_||1===C&&_===S-1,{modelIndex:_}}var x="fixed"===o.duration.name?1e3*o.duration.params.durationInS:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps);if("once"===o.mode.name&&t.current>=x)return u=!0,{modelIndex:g.data.frameCount-1};var _,D=t.current%x/x;return"loop"===o.mode.name&&"backward"===o.mode.params.direction&&(D=1-D),"palindrome"===o.mode.name&&(D*=2)>1&&(D=2-D),{modelIndex:_=Math.min(Math.floor(g.data.frameCount*D),g.data.frameCount-1)}})},d=0,f=a;d<f.length;d++)l(f[d]);return c?[3,2]:[4,yr.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:m.sent(),m.label=2;case 2:return c||"once"===o.mode.name&&u?[2,{kind:"finished"}]:"palindrome"===o.mode.name?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function Ote(e,t,r){var n;return void 0===r&&(r=!1),ue(this,void 0,void 0,function(){return ce(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&(null===(n=e.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||"instant"===t.snapshot.camera.transitionStyle?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var $r,nWe=lf.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!r?.snapshot.startAnimation})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);Ote(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+(null!==(a=n.snapshot.durationInMs)&&void 0!==a?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+(null!==(i=a.snapshot.durationInMs)&&void 0!==i?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ue(this,void 0,void 0,function(){var a,i,o,s;return ce(this,function(c){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(a+=null!==(n=s[o].snapshot.durationInMs)&&void 0!==n?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(Ote(r.plugin,e.snapshots[i]),[2,{kind:"next",state:R(R({},e),{currentIndex:i})}])})})}});!function(e){var t=function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return jt(d,l),d}(ve.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return jt(d,l),d}(ve.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return jt(d,l),d}(ve.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=Bt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:T.Text("",{isHidden:!0})}})({apply:function(l){return new r({},{label:l.params.label})}});var a=new Map;e.getCategoryId=function i(l){return a.get(l.id)},e.create=function o(l){var d=Bt.CreateBuiltIn({name:l.name,display:l.display,from:[t],to:[n],params:l.params,apply:function(f,p){var m=f.params,h=l.label?l.label(m):{label:l.display.name,description:l.display.description};return new n(new l.ctor(p,m),h)},update:function(f){var p=this,m=f.b,h=f.newParams;return Ve.create("Update Behavior",function(){return ue(p,void 0,void 0,function(){return ce(this,function(g){switch(g.label){case 0:return m.data.update?[4,m.data.update(h)]:[2,rt.UpdateResult.Unchanged];case 1:return[2,g.sent()?rt.UpdateResult.Updated:rt.UpdateResult.Unchanged]}})})})},canAutoUpdate:l.canAutoUpdate});return a.set(d.id,l.category),d},e.simpleCommandHandler=function s(l,d){return function(){function f(p){this.ctx=p,this.sub=void 0}return f.prototype.register=function(){var p=this;this.sub=l.subscribe(this.ctx,function(m){return d(m,p.ctx)})},f.prototype.dispose=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()};var u=function(){function l(d,f){this.ctx=d,this.params=f,this.subs=[]}return l.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},l.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},l.prototype.track=function(d){this.subs.push(d)},l.prototype.dispose=function(){for(var d=0,f=this.subs;d<f.length;d++)f[d].unsubscribe();this.subs=[]},l.prototype.update=function(d){return!K_(d,this.params)&&(this.params=d,!0)},l}();e.Handler=u;var c=function(){function l(d,f){this.plugin=d,this.params=f,this.subs=[]}return l.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},l.prototype.subscribeObservable=function(d,f){var p=this,m=d.subscribe(f);return this.subs.push(m),{unsubscribe:function(){var h=p.subs.indexOf(m);h>=0&&(p.subs.splice(h,1),m.unsubscribe())}}},l.prototype.dispose=function(){for(var d=0,f=this.subs;d<f.length;d++)f[d].unsubscribe();this.subs=[]},l}();e.WithSubscribers=c}($r||($r={}));var L2=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&Lh(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=bf.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++)r[t].unsubscribe();this.subs=void 0}},e}(),lp=function(e){function t(r){var n=e.call(this)||this;return n._state=r,n}return jt(t,e),t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=function Vq(e,t){for(var r=e,n=0;n<t.length;n++)if(t[n]&&(r=I_e(e,t[n]))!==e){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}(a,r);return i!==a&&(this._state=i,!0)},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(L2),aWe=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1701552301846);function IN(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):function sWe(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),c=0,l=0;l<o;++l)u[l]=a.charCodeAt(c++)|a.charCodeAt(c++)<<8|a.charCodeAt(c++)<<16|a.charCodeAt(c++)<<24;for(var d=3&i;d--;)s[c]=a.charCodeAt(c++);t(new Blob([s],{type:r||"image/png"}))}(e,o,t,r)})]})})}var Sy=function(e){function t(r){var n=e.call(this,{current:void 0,entries:ff(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.defaultSnapshotId=void 0,n.events={changed:n.ev(),opened:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ue(n,void 0,void 0,function(){var a,i,o;return ce(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,(a=this.getNextId(this.state.current,1))&&a!==this.state.current?(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]):(this.stop(),[2]);case 1:return s.sent(),o=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return jt(t,e),t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);n&&(n?.image&&this.plugin.managers.asset.delete(n.image),this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next(void 0))},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next(void 0)},t.prototype.replace=function(r,n,a){var i,o,s,u=this.getEntry(r);if(u){this.defaultSnapshotId=void 0,u?.image&&this.plugin.managers.asset.delete(u.image);var c=this.getIndex(u),l=t.Entry(n,{key:null!==(i=a?.key)&&void 0!==i?i:u.key,name:null!==(o=a?.name)&&void 0!==o?o:u.name,description:null!==(s=a?.description)&&void 0!==s?s:u.description,image:a?.image});this.entryMap.set(n.id,l),this.updateState({current:l.snapshot.id,entries:this.state.entries.set(c,l)}),this.events.changed.next(void 0)}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),c=this.state.entries.asMutable();c.set(s,i),c.set(o,u),this.updateState({current:i.snapshot.id,entries:c.asImmutable()}),this.events.changed.next(void 0)}}},t.prototype.update=function(r,n){var a,i,o,s=this.getIndex(r);if(!(s<0)){var u=this.state.entries.set(s,R(R({},r),{key:(null===(a=n.key)||void 0===a?void 0:a.trim())||void 0,name:(null===(i=n.name)||void 0===i?void 0:i.trim())||void 0,description:(null===(o=n.description)||void 0===o?void 0:o.trim())||void 0}));this.updateState({entries:u}),this.entryMap.set(r.snapshot.id,this.state.entries.get(s)),this.events.changed.next(void 0)}},t.prototype.clear=function(){var r=this;0!==this.state.entries.size&&(this.entryMap.forEach(function(n){n?.image&&r.plugin.managers.asset.delete(n.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:ff()}),this.events.changed.next(void 0))},t.prototype.applyKey=function(r){var n=this.state.entries.find(function(a){return a.key===r});n&&(this.updateState({current:n.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(n.snapshot))},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next(void 0)),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(0===a)return;return this.state.entries.get(-1===n?a-1:0).snapshot.id}var o=this.getEntry(r);if(o){var s=this.getIndex(o);if(!(s<0))return(s=(s+n)%a)<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ce(this,function(l){switch(l.label){case 0:for(this.clear(),n=ff().asMutable(),a=0,i=r.entries;a<i.length;a++)this.entryMap.set((o=i[a]).snapshot.id,o),n.push(o);return this.updateState({current:s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),s?(u=this.getEntry(s),(c=u&&u.snapshot)?[4,this.plugin.state.setSnapshot(c)]:[2]):[2];case 1:return l.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,c]}})})},t.prototype.syncCurrent=function(r){var n,a;return ue(this,void 0,void 0,function(){var i,o,s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return o=1===this.state.entries.size&&this.state.current&&this.state.current===this.defaultSnapshotId,(i=0===this.state.entries.size)||o?(s=this.plugin.state.getSnapshot(r?.params),(null!==(a=null===(n=r?.params)||void 0===n?void 0:n.image)&&void 0!==a?a:this.plugin.state.snapshotParams.value.image)?[4,t.getCanvasImageAsset(this.plugin,"".concat(s.id,"-image.png"))]:[3,2]):[2];case 1:return c=d.sent(),[3,3];case 2:c=void 0,d.label=3;case 3:return u=c,i?this.add(t.Entry(s,{name:r?.name,description:r?.description,image:u})):o&&(l=this.getEntry(this.state.current),l?.image&&this.plugin.managers.asset.delete(l.image),this.replace(this.state.current,s,{image:u})),this.defaultSnapshotId=s.id,[2]}})})},t.prototype.getStateSnapshot=function(r){return ue(this,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,this.syncCurrent(r)];case 1:return n.sent(),[2,{timestamp:+new Date,version:"3.43.0",name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!(!r||!r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}]}})})},t.prototype.serialize=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S;return ce(this,function(C){switch(C.label){case 0:return i=(a=JSON).stringify,[4,this.getStateSnapshot({params:r?.params})];case 1:return n=i.apply(a,[C.sent(),null,2]),r?.type&&"json"!==r.type&&"molj"!==r.type?[3,2]:[2,new Blob([n],{type:"application/json;charset=utf-8"})];case 2:I0(o=new Uint8Array(xw(n)),0,n),s={"state.json":o},u=[],c=0,l=this.plugin.managers.asset.assets,C.label=3;case 3:return c<l.length?(p=(d=l[c]).file,u.push([(f=d.asset).id,f]),m=s,h="assets/".concat(f.id),v=Uint8Array.bind,[4,p.arrayBuffer()]):[3,6];case 4:m[h]=new(v.apply(Uint8Array,[void 0,C.sent()])),C.label=5;case 5:return c++,[3,3];case 6:return u.length>0&&(g=JSON.stringify(u,null,2),I0(y=new Uint8Array(xw(g)),0,g),s["assets.json"]=y),[4,this.plugin.runTask(Jwe(s))];case 7:return S=C.sent(),[2,new Blob([S],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,v,g,y;return ce(this,function(S){switch(S.label){case 0:return S.trys.push([0,15,,16]),(n=r.name.toLowerCase()).endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(yf(r,"string"))]:[3,8];case 1:return a=S.sent(),g=JSON.parse(a),t.isStateSnapshot(g)?[4,this.setStateSnapshot(g)]:[3,3];case 2:return S.sent(),[3,7];case 3:return t.isStateSnapshot(g.data)?[4,this.setStateSnapshot(g.data)]:[3,5];case 4:return S.sent(),[3,7];case 5:return[4,this.plugin.state.setSnapshot(g)];case 6:S.sent(),S.label=7;case 7:return[3,14];case 8:return[4,this.plugin.runTask(yf(r,"zip"))];case 9:return a=S.sent(),i=Object.create(null),Fs(a,function(C,_){if("state.json"!==_&&"assets.json"!==_){var x=_.substring(_.indexOf("/")+1);i[x]=C}}),o=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(yf(o,"string"))];case 10:return s=S.sent(),a["assets.json"]?(u=new File([a["assets.json"]],"assets.json"),d=(l=JSON).parse,[4,this.plugin.runTask(yf(u,"string"))]):[3,12];case 11:for(c=d.apply(l,[S.sent()]),f=0,p=c;f<p.length;f++)this.plugin.managers.asset.set(v=(m=p[f])[1],new File([i[m[0]]],v.name));S.label=12;case 12:return g=JSON.parse(s),[4,this.setStateSnapshot(g)];case 13:S.sent(),S.label=14;case 14:return this.events.opened.next(void 0),[3,16];case 15:return y=S.sent(),console.error(y),this.plugin.log.error("Error reading state"),[3,16];case 16:return[2]}})})},t.prototype.play=function(r){if(void 0===r&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n)return void this.next();this.events.changed.next(void 0);var a=n.snapshot;this.timeoutHandle=setTimeout(this.next,typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.entryMap.clear()},t.DefaultNextSnapshotDelayInMs=1500,t}(lp);function Fte(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function Bte(e,t){if(void 0===t&&(t="download"),e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener","string"==typeof e?(r.href=e,Fte(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return Fte(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(c){!function cWe(e){window.open(e,"_blank")||(window.location.href=e)}(i?c:c.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL("string"==typeof e?new Blob([e]):e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function PN(e,t){return"".concat(e).concat("/"===e[e.length-1]||"/"===t[0]?"":"/").concat(t)}!function(e){e.Entry=function t(a,i){return R({timestamp:+new Date,snapshot:a},i)},e.isStateSnapshot=function r(a){return!!a&&!!a.timestamp&&!!a.entries},e.getCanvasImageAsset=function n(a,i){return ue(this,void 0,void 0,function(){var o,s,u,c;return ce(this,function(l){switch(l.label){case 0:return a.helpers.viewportScreenshot&&(o=a.helpers.viewportScreenshot.getPreview(512))?[4,IN(o.canvas,"png")]:[2];case 1:return s=l.sent(),u=new File([s],i),c={kind:"file",id:kn.create22(),name:i},a.managers.asset.set(c,u),[2,c]}})})}}(Sy||(Sy={}));var lWe={get preferWebGl1(){if(typeof navigator>"u"||typeof window>"u")return!1;if(["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(function(a){return navigator.userAgent.indexOf(a)>0}))return!0;var t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=navigator.userAgent.includes("Macintosh"),n=navigator.maxTouchPoints>=4;return!window.MSStream&&(t||r&&n)}},dWe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function Hn(e,t){return new dWe(e,t)}var pa={item:Hn,General:{IsBusyTimeoutMs:Hn("plugin-config.is-busy-timeout",750),DisableAntialiasing:Hn("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:Hn("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:Hn("plugin-config.pixel-scale",1),PickScale:Hn("plugin-config.pick-scale",.25),PickPadding:Hn("plugin-config.pick-padding",3),EnableWboit:Hn("plugin-config.enable-wboit",!0),EnableDpoit:Hn("plugin-config.enable-dpoit",!1),PreferWebGl1:Hn("plugin-config.prefer-webgl1",lWe.preferWebGl1),AllowMajorPerformanceCaveat:Hn("plugin-config.allow-major-performance-caveat",!1),PowerPreference:Hn("plugin-config.power-preference","high-performance")},State:{DefaultServer:Hn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:Hn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:Hn("history-capacity.server",5)},VolumeStreaming:{Enabled:Hn("volume-streaming.enabled",!0),DefaultServer:Hn("volume-streaming.server","https://ds.litemol.org"),CanStream:Hn("volume-streaming.can-stream",function(e,t){return 1===e.models.length&&ar.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:Hn("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:Hn("viewer.show-expand-button",!0),ShowControls:Hn("viewer.show-controls-button",!0),ShowSettings:Hn("viewer.show-settings-button",!0),ShowSelectionMode:Hn("viewer.show-selection-model-button",!0),ShowAnimation:Hn("viewer.show-animation-button",!0),ShowTrajectoryControls:Hn("viewer.show-trajectory-controls",!0)},Download:{DefaultPdbProvider:Hn("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:Hn("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:Hn("structure.size-thresholds",Ze.DefaultSizeThresholds),DefaultRepresentationPreset:Hn("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:Hn("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:Hn("structure.saccharide-comp-id-map-type","default")},Background:{Styles:Hn("background.styles",[])}},fWe=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){return r._config.set(n[0],n[1])})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function pWe(e){Nte(e),kte(e),Lte(e),Ute(e),Vte(e),Gte(e),zte(e),Hte(e),jte(e),qte(e)}function Nte(e){e.state.events.object.created.subscribe(function(t){ve.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){var r,n,a,i;ve.isBehavior(t.obj)&&(null===(n=(r=t.obj.data).unregister)||void 0===n||n.call(r),null===(i=(a=t.obj.data).dispose)||void 0===i||i.call(a))}),e.state.events.object.updated.subscribe(function(t){var r,n,a,i;"recreate"===t.action&&(t.oldObj&&ve.isBehavior(t.oldObj)&&(null===(n=(r=t.oldObj.data).unregister)||void 0===n||n.call(r),null===(i=(a=t.oldObj.data).dispose)||void 0===i||i.call(a)),t.obj&&ve.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function kte(e){yr.State.SetCurrentObject.subscribe(e,function(t){return t.state.setCurrent(t.ref)})}function Lte(e){yr.State.Update.subscribe(e,function(t){return e.runTask(t.state.updateTree(t.tree,t.options))})}function Ute(e){yr.State.ApplyAction.subscribe(e,function(t){var n=t.action;return e.runTask(t.state.applyAction(n.action,n.params,t.ref))})}function Vte(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}yr.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref;if(!r.removeParentGhosts)return t(n,a);var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var c=o.transforms.get(s.parent);if(!c.state.isGhost)return t(n,s.ref);s=c}})}function Gte(e){yr.State.ToggleExpanded.subscribe(e,function(t){return t.state.updateCellState(t.ref,function(a){return{isCollapsed:!a.isCollapsed}})})}function zte(e){yr.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return Cy(r,n,!r.cells.get(n).state.isHidden)})}function Cy(e,t,r){ii.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},mWe)}function mWe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function Hte(e){yr.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(e.canvas3d&&!e.isBusy){e.managers.interactivity.lociHighlights.clearHighlights();for(var i=0,o="string"==typeof n?[n]:n;i<o.length;i++){var u=r.cells.get(o[i]);if(u)if(ve.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:Ze.Loci(u.obj.data)},!1);else if(u&&ve.isRepresentation3D(u.obj))for(var c=u.obj.data.repr,l=0,d=c.getAllLoci();l<d.length;l++)e.managers.interactivity.lociHighlights.highlight({loci:d[l],repr:c},!1);else if(ve.Molecule.Structure.Selections.is(u.obj))for(var p=0,m=u.obj.data;p<m.length;p++)e.managers.interactivity.lociHighlights.highlight({loci:m[p].loci},!1)}}})}function jte(e){yr.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function qte(e){var t=this;e.config.set(pa.State.CurrentServer,e.config.get(pa.State.DefaultServer)),yr.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),yr.State.Snapshots.Remove.subscribe(e,function(r){e.managers.snapshot.remove(r.id)}),yr.State.Snapshots.Add.subscribe(e,function(r){var n=r.key,a=r.name,i=r.description,o=r.params;return ue(t,void 0,void 0,function(){var s,c,l,d;return ce(this,function(f){switch(f.label){case 0:return s=e.state.getSnapshot(o),(null!==(d=o?.image)&&void 0!==d?d:e.state.snapshotParams.value.image)?[4,Sy.getCanvasImageAsset(e,"".concat(s.id,"-image.png"))]:[3,2];case 1:return c=f.sent(),[3,3];case 2:c=void 0,f.label=3;case 3:return l=Sy.Entry(s,{key:n,name:a,description:i,image:c}),e.managers.snapshot.add(l),[2]}})})}),yr.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;return ue(t,void 0,void 0,function(){var i,o,s,u;return ce(this,function(c){switch(c.label){case 0:return i=e.state.getSnapshot(a),(null!==(u=a?.image)&&void 0!==u?u:e.state.snapshotParams.value.image)?[4,Sy.getCanvasImageAsset(e,"".concat(i.id,"-image.png"))]:[3,2];case 1:return s=c.sent(),[3,3];case 2:s=void 0,c.label=3;case 3:return o=s,e.managers.snapshot.replace(n,e.state.getSnapshot(a),{image:o}),[2]}})})}),yr.State.Snapshots.Move.subscribe(e,function(r){e.managers.snapshot.move(r.id,r.dir)}),yr.State.Snapshots.Apply.subscribe(e,function(r){var a=e.managers.snapshot.setCurrent(r.id);if(a)return e.state.setSnapshot(a)}),yr.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return ue(t,void 0,void 0,function(){var u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:return u=fetch,c=[PN(o,"set?name=".concat(encodeURIComponent(n||""),"&description=").concat(encodeURIComponent(a||"")))],f={method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"}},d=(l=JSON).stringify,[4,e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i})];case 1:return[2,u.apply(void 0,c.concat([(f.body=d.apply(l,[p.sent()]),f)]))]}})})}),yr.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ue(t,void 0,void 0,function(){var a;return ce(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),yr.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return ue(t,void 0,void 0,function(){var o;return ce(this,function(u){switch(u.label){case 0:return o="mol-star_state_".concat(n||function uWe(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()}(),".").concat("json"===a?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return Bte(u.sent(),"".concat(o)),[2]}})})}),yr.State.Snapshots.OpenFile.subscribe(e,function(r){return e.managers.snapshot.open(r.file)}),yr.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return ue(t,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state.".concat(a)))]}})})})}function hWe(e){Wte(e),Yte(e),Xte(e)}function Wte(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;ve.isRepresentation3D(r.obj)&&(MN(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),null===(n=e.canvas3d)||void 0===n||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&ve.isRepresentation3D(r.oldObj)&&(null===(n=e.canvas3d)||void 0===n||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ve.isRepresentation3D(r.obj)&&(MN(r.state.cells.get(r.ref),r.obj.data.repr),"recreate"===r.action&&r.obj.data.repr.setState({syncManually:!0}),null===(a=e.canvas3d)||void 0===a||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;ve.isRepresentation3D(r.obj)&&(null===(n=e.canvas3d)||void 0===n||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function Yte(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(ve.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),null===(n=e.canvas3d)||void 0===n||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(ve.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),null===(n=e.canvas3d)||void 0===n||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(ve.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),null===(n=e.canvas3d)||void 0===n||n.update(a.repr)}})}function Xte(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);ve.isRepresentation3D(n.obj)&&MN(n,n.obj.data.repr)&&(null===(r=e.canvas3d)||void 0===r||r.syncVisibility())})}function MN(e,t){return t.state.visible===!!e.state.isHidden&&(t.setState({visible:!e.state.isHidden}),!0)}function vWe(e){Kte(e),Qte(e),Zte(e),$te(e),Jte(e)}function Kte(e){yr.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function Zte(e){yr.Camera.SetSnapshot.subscribe(e,function(t){e.managers.camera.setSnapshot(t.snapshot,t.durationMs)})}function Qte(e){yr.Camera.Focus.subscribe(e,function(t){e.managers.camera.focusSphere({center:t.center,radius:t.radius},{durationMs:t.durationMs}),e.events.canvas3d.settingsUpdated.next(void 0)})}function $te(e){yr.Camera.OrientAxes.subscribe(e,function(t){e.managers.camera.orientAxes(t.structures,t.durationMs)})}function Jte(e){yr.Camera.ResetAxes.subscribe(e,function(t){e.managers.camera.resetAxes(t.durationMs)})}function eo(){return eo.zero()}!function(e){e.zero=function t(){return{x:0,y:0,width:0,height:0}},e.create=function r(u,c,l,d){return{x:u,y:c,width:l,height:d}},e.clone=function n(u){return R({},u)},e.copy=function a(u,c){return Object.assign(u,c)},e.set=function i(u,c,l,d,f){return u.x=c,u.y=l,u.width=d,u.height=f,u},e.toVec4=function o(u,c){return u[0]=c.x,u[1]=c.y,u[2]=c.width,u[3]=c.height,u},e.equals=function s(u,c){return u.x===c.x&&u.y===c.y&&u.width===c.width&&u.height===c.height}}(eo||(eo={}));var Nd=dr();function kT(e,t,r,n){var s=r.height,c=t[1]-r.y,l=t[2];return e[0]=2*(t[0]-r.x)/r.width-1,e[1]=2*c/s-1,e[2]=2*l-1,b.transformMat4(e,e,n)}function RN(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(2===t)return 4;if(3===t)return 2;if(t>0)return 1<<t-1}}return 0}function ere(e){if("object"==typeof e&&"button"in e){var t=e.button;if(1===t)return 4;if(2===t)return 2;if(t>=0)return 1<<t}return 0}var $u,Ga,tre={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:function(e,t){return!0},pixelScale:1};!function(e){function t(i,o){return i.shift===o.shift&&i.alt===o.alt&&i.control===o.control&&i.meta===o.meta}function a(i){return void 0===i&&(i={}),{shift:!!i.shift,alt:!!i.alt,control:!!i.control,meta:!!i.meta}}e.None=a(),e.areEqual=t,e.areNone=function r(i){return t(i,e.None)},e.size=function n(i){if(!i)return 0;var o=0;return i.shift&&o++,i.alt&&o++,i.control&&o++,i.meta&&o++,o},e.create=a}($u||($u={})),function(e){var r;e.has=Vo.has,e.create=Vo.create,(r=e.Flag||(e.Flag={}))[r.None=0]="None",r[r.Primary=1]="Primary",r[r.Secondary=2]="Secondary",r[r.Auxilary=4]="Auxilary",r[r.Forth=8]="Forth",r[r.Five=16]="Five"}(Ga||(Ga={}));var rre={key:"",code:"",modifiers:$u.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:m0},Sv=function(e){return e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Moving=2]="Moving",e}(Sv||{});function nre(){return{drag:new bn,interactionEnd:new bn,click:new bn,move:new bn,wheel:new bn,pinch:new bn,gesture:new bn,resize:new bn,leave:new bn,enter:new bn,modifiers:new bn,key:new bn,keyUp:new bn,keyDown:new bn,lock:new bn}}var ON,yWe=["Backspace","Delete"];!function(e){e.create=function t(n){void 0===n&&(n={});var a=R(R({},tre),n);return R(R({noScroll:a.noScroll,noContextMenu:a.noContextMenu,pointerLock:!1,width:0,height:0,pixelRatio:1},nre()),{requestPointerLock:m0,exitPointerLock:m0,dispose:m0})},e.fromElement=function r(n,a){void 0===a&&(a={});var i=R(R({},tre),a),o=i.noScroll,u=i.noContextMenu,c=i.noPinchZoom,l=i.noTextSelect,d=i.mask,f=i.pixelScale,p=i.preventGestures,m=n.clientWidth*I(),h=n.clientHeight*I(),v=!1,g=eo(),y=0,S=0,C=Be(),_=Be(),x=Be(),D=Be(),w=Be(),A={shift:!1,alt:!1,control:!1,meta:!1},E={x:-1,y:-1,pageX:-1,pageY:-1};function I(){return window.devicePixelRatio*f}function M(){return R({},A)}function F(ze){return ze.target===document.body||ze.target===n}var J,N=Sv.Stopped,j=!1,U=Ga.create(Ga.Flag.None),H=Ga.Flag.None,z=!1,G=!1;typeof window.ResizeObserver<"u"&&(J=new window.ResizeObserver(Dr));var X=nre(),Z=X.drag,ne=X.interactionEnd,Y=X.wheel,k=X.pinch,W=X.gesture,$=X.click,K=X.move,q=X.leave,V=X.enter,ee=X.resize,ae=X.modifiers,pe=X.key,me=X.keyUp,de=X.keyDown,re=X.lock;function ge(){Qm(v=n.ownerDocument.pointerLockElement===n),re.next(v)}function xe(){console.error("Unable to use Pointer Lock API"),Qm(v=!1),re.next(v)}function Ge(ze){d(ze.clientX,ze.clientY)&&u&&ze.preventDefault()}function je(ze){A.alt=ze.altKey,A.shift=ze.shiftKey,A.control=ze.ctrlKey,A.meta=ze.metaKey}function L(){(U||A.shift||A.alt||A.meta||A.control)&&(U=0,A.shift=A.alt=A.control=A.meta=!1)}function Q(ze){var Ke=!1;!A.alt&&ze.altKey&&(Ke=!0,A.alt=!0),!A.shift&&ze.shiftKey&&(Ke=!0,A.shift=!0),!A.control&&ze.ctrlKey&&(Ke=!0,A.control=!0),!A.meta&&ze.metaKey&&(Ke=!0,A.meta=!0),Ke&&z&&ae.next(M()),F(ze)&&z&&de.next(R(R({key:ze.key,code:ze.code,modifiers:M()},E),{preventDefault:function(){return ze.preventDefault()}}))}function ye(ze){var Ke=!1;A.alt&&!ze.altKey&&(Ke=!0,A.alt=!1),A.shift&&!ze.shiftKey&&(Ke=!0,A.shift=!1),A.control&&!ze.ctrlKey&&(Ke=!0,A.control=!1),A.meta&&!ze.metaKey&&(Ke=!0,A.meta=!1),Ke&&z&&ae.next(M()),yWe.includes(ze.key)&&we(ze),F(ze)&&z&&me.next(R(R({key:ze.key,code:ze.code,modifiers:M()},E),{preventDefault:function(){return ze.preventDefault()}}))}function we(ze){!F(ze)||!z||pe.next(R(R({key:ze.key,code:ze.code,modifiers:M()},E),{preventDefault:function(){return ze.preventDefault()}}))}function De(ze){var Ke=ze.touches[0],gt=ze.touches[1];return{clientX:(Ke.clientX+gt.clientX)/2,clientY:(Ke.clientY+gt.clientY)/2,pageX:(Ke.pageX+gt.pageX)/2,pageY:(Ke.pageY+gt.pageY)/2,target:ze.target}}function Oe(ze){var Ke=ze.touches[0].pageX-ze.touches[1].pageX,gt=ze.touches[0].pageY-ze.touches[1].pageY;return Math.sqrt(Ke*Ke+gt*gt)}!function te(){n.addEventListener("contextmenu",Ge,!1),n.addEventListener("wheel",Rt,!1),n.addEventListener("mousedown",St,!1),window.addEventListener("mousemove",wt,!1),window.addEventListener("mouseup",Le,!1),n.addEventListener("touchstart",Je,!1),n.addEventListener("touchmove",ut,!1),n.addEventListener("touchend",mt,!1),n.addEventListener("gesturechange",At,!1),n.addEventListener("gesturestart",Qe,!1),n.addEventListener("gestureend",Zt,!1),window.addEventListener("blur",L),window.addEventListener("keyup",ye,!1),window.addEventListener("keydown",Q,!1),window.addEventListener("keypress",we,!1),document.addEventListener("pointerlockchange",ge,!1),document.addEventListener("pointerlockerror",xe,!1),null!=J?J.observe(n.parentElement):window.addEventListener("resize",Dr,!1)}();var Ne=-1,Ue=void 0,$e=Be(),Ie=Be();function Je(ze){if(ze.preventDefault(),Ue=void 0,Ne=-1,1===ze.touches.length)Ne=0,Be.set($e,ze.touches[0].pageX,ze.touches[0].pageY),Ue=ze.touches[0],U=H=Ga.Flag.Primary,Ct(ze.touches[0]);else if(2===ze.touches.length){U=Ga.Flag.Secondary&Ga.Flag.Auxilary,H=Ga.Flag.Secondary,Ct(De(ze));var Ke=Oe(ze);y=Ke,k.next({distance:Ke,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:U,button:H,modifiers:M()})}else 3===ze.touches.length&&(U=H=Ga.Flag.Forth,Ct(De(ze)))}function mt(ze){if(it(),Ue&&Ne<=4){var Ke=Ue;if(!d(Ke.clientX,Ke.clientY))return;Qn(Ie,Ke);var gt=ao(Ke);$.next({x:Ie[0],y:Ie[1],pageX:gt.pageX,pageY:gt.pageY,buttons:U,button:H,modifiers:M()})}Ue=void 0}function ut(ze){if(H=Ga.Flag.None,c&&(ze.preventDefault(),ze.stopPropagation(),ze.originalEvent&&(ze.originalEvent.preventDefault(),ze.originalEvent.stopPropagation())),Ue=void 0,1===ze.touches.length)U=Ga.Flag.Primary,Ue=ze.touches[0],function He(ze){Ne<0||(Be.set(Ie,ze.touches[0].pageX,ze.touches[0].pageY),Ne+=Be.distance($e,Ie),Be.copy($e,Ie))}(ze),Mt(ze.touches[0]);else if(2===ze.touches.length){var Ke=Oe(ze),gt=y-Ke;if(Math.abs(gt)<4)U=Ga.Flag.Secondary,Mt(De(ze));else{U=Ga.Flag.Auxilary,je(ze);var Wt=y/Ke;k.next({delta:gt,fraction:Wt,fractionDelta:S-Wt,distance:Ke,isStart:!1,buttons:U,button:H,modifiers:M()}),S=Wt}y=Ke}else 3===ze.touches.length&&(U=Ga.Flag.Forth,Mt(De(ze)))}function St(ze){je(ze),U=RN(ze),H=ere(ze),Ct(ze)}function wt(ze){je(ze),U=RN(ze),H=Ga.Flag.None,Mt(ze)}function Le(ze){je(ze),U=RN(ze),H=ere(ze),function bt(ze){if(N=Sv.Stopped,d(ze.clientX,ze.clientY)){if(Qn(x,ze),!G&&Be.distance(x,C)<4){var Ke=ao(ze);$.next({x:x[0],y:x[1],pageX:Ke.pageX,pageY:Ke.pageY,buttons:U,button:H,modifiers:M()})}G=!1}}(ze),it()}function it(){ne.next(void 0)}function Ct(ze){d(ze.clientX,ze.clientY)&&(Qn(_,ze),Be.copy(C,_),tr(_)&&(N=Sv.Started))}function Mt(ze){var Ke;Qn(x,ze);var gt=ao(ze),Wt=gt.pageX,wr=gt.pageY,ca=x[0],xa=x[1],Wo=ze.movementX,Zc=ze.movementY,Yo=tr(x)&&d(ze.clientX,ze.clientY);if(z&&!Yo?q.next(void 0):!z&&Yo&&V.next(void 0),z=Yo,E.x=ca,E.y=xa,E.pageX=Wt,E.pageY=wr,K.next({x:ca,y:xa,pageX:Wt,pageY:wr,movementX:Wo,movementY:Zc,buttons:U,button:H,modifiers:M(),inside:Yo,onElement:ze.target===n}),N!==Sv.Stopped&&(l&&(null===(Ke=ze.preventDefault)||void 0===Ke||Ke.call(ze)),Be.div(D,Be.sub(D,x,_),function fn(ze){return ze[0]=n.clientWidth,ze[1]=n.clientHeight,ze}(w)),!(Be.magnitude(D)<mn))){var xp=N===Sv.Started;xp&&!d(ze.clientX,ze.clientY)||(Be.distance(x,C)>=4&&(G=!0),Z.next({x:ca,y:xa,dx:D[0],dy:D[1],pageX:Wt,pageY:wr,buttons:U,button:H,modifiers:M(),isStart:xp}),Be.copy(_,x),N=Sv.Moving)}}function Rt(ze){if(d(ze.clientX,ze.clientY)){Qn(x,ze);var Ke=ao(ze),gt=Ke.pageX,Wt=Ke.pageY,wr=x[0],ca=x[1];o&&ze.preventDefault();var xa=function bWe(e){var a=0,i=0,o=0,s=0,u=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(a=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(a=i,i=0),o=10*a,s=10*i,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(o=e.deltaX),"deltaZ"in e&&(u=e.deltaZ),(o||s||u)&&e.deltaMode&&(1===e.deltaMode?(o*=40,s*=40,u*=40):(o*=800,s*=800,u*=800)),o&&!a&&(a=o<1?-1:1),s&&!i&&(i=s<1?-1:1),{spinX:a,spinY:i,dx:o,dy:s,dz:u}}(ze);U=H=Ga.Flag.Auxilary,(xa.dx||xa.dy||xa.dz)&&Y.next(R(R({x:wr,y:ca,pageX:gt,pageY:Wt},xa),{buttons:U,button:H,modifiers:M()}))}}function oe(ze){var Ke,gt;p&&(ze.preventDefault(),null===(Ke=ze.stopImmediatePropagation)||void 0===Ke||Ke.call(ze),null===(gt=ze.stopPropagation)||void 0===gt||gt.call(ze))}var be=0,Ce=0;function Qe(ze){oe(ze),be=ze.scale,Ce=ze.rotation,W.next({scale:ze.scale,rotation:ze.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function Et(ze,Ke){W.next({scale:ze.scale,rotation:ze.rotation,deltaRotation:Ce-ze.rotation,deltaScale:be-ze.scale,isEnd:Ke}),Ce=ze.rotation,be=ze.scale}function At(ze){oe(ze),Et(ze)}function Zt(ze){oe(ze),Et(ze,!0)}function Dr(){ee.next({})}function tr(ze){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Ke=n.getBoundingClientRect();return ze[0]>=0&&ze[1]>=0&&ze[0]<Ke.width&&ze[1]<Ke.height}function Qn(ze,Ke){if(m=n.clientWidth*I(),h=n.clientHeight*I(),v){var gt=I();ze[0]=(g.x+g.width/2)/gt,ze[1]=(h-(g.y+g.height/2))/gt}else{var Wt=n.getBoundingClientRect();ze[0]=(Ke.clientX||0)-Wt.left,ze[1]=(Ke.clientY||0)-Wt.top}return ze}function ao(ze){return v?{pageX:Math.round(window.innerWidth/2)+g.x,pageY:Math.round(window.innerHeight/2)+g.y}:{pageX:ze.pageX,pageY:ze.pageY}}var ja=30,Gi=function Wd(){var ze,Ke=document.createElement("div"),wr="#000 ".concat("30%",", #0000 0 calc(100% - ").concat("30%","), #000 0"),ca="linear-gradient(0deg, ".concat(wr,") 50%/").concat("10%"," 100% no-repeat"),xa="linear-gradient(90deg, ".concat(wr,") 50%/100% ").concat("10%"," no-repeat");return Object.assign(Ke.style,{width:"".concat(ja,"px"),aspectRatio:1,background:"".concat(ca,", ").concat(xa,", ").concat("radial-gradient(circle at 50%, #000 5%, #0000 5%)"),display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),null===(ze=n.parentElement)||void 0===ze||ze.appendChild(Ke),Ke}();function Qm(ze){if(Gi.style.display=ze?"block":"none",ze){var Ke=I(),gt=(g.x+g.width/2)/Ke,Wt=(g.y+g.height/2)/Ke;Gi.style.width="".concat(ja,"px"),Gi.style.left="calc(".concat(gt,"px - ").concat(ja/2,"px)"),Gi.style.bottom="calc(".concat(Wt,"px - ").concat(ja/2,"px)")}}return R(R({get noScroll(){return o},set noScroll(ze){o=ze},get noContextMenu(){return u},set noContextMenu(ze){u=ze},get width(){return m},get height(){return h},get pixelRatio(){return I()},get pointerLock(){return v}},X),{requestPointerLock:function(ze){g=ze,v||n.requestPointerLock()},exitPointerLock:function(){v&&n.ownerDocument.exitPointerLock()},dispose:function le(){j||(j=!0,n.removeEventListener("contextmenu",Ge,!1),n.removeEventListener("wheel",Rt,!1),n.removeEventListener("mousedown",St,!1),window.removeEventListener("mousemove",wt,!1),window.removeEventListener("mouseup",Le,!1),n.removeEventListener("touchstart",Je,!1),n.removeEventListener("touchmove",ut,!1),n.removeEventListener("touchend",mt,!1),n.removeEventListener("gesturechange",At,!1),n.removeEventListener("gesturestart",Qe,!1),n.removeEventListener("gestureend",Zt,!1),window.removeEventListener("blur",L),window.removeEventListener("keyup",ye,!1),window.removeEventListener("keydown",Q,!1),window.removeEventListener("keypress",we,!1),document.removeEventListener("pointerlockchange",ge,!1),document.removeEventListener("pointerlockerror",xe,!1),Gi.remove(),null!=J?(J.unobserve(n.parentElement),J.disconnect()):window.removeEventListener("resize",Dr,!1))}})}}(ON||(ON={}));var NN,Cv=function(e){return e[e.None=0]="None",e[e.Object=1]="Object",e[e.Instance=2]="Instance",e[e.Group=3]="Group",e}(Cv||{}),LT=function(e){return e[e.None=0]="None",e[e.Depth=1]="Depth",e[e.Mask=2]="Mask",e}(LT||{}),FN={backgroundColor:T.Color(dt(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:T.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:T.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:T.Boolean(!0,{label:"Use Interior Color"}),interiorColor:T.Color(dt.fromNormalizedRgb(.3,.3,.3)),colorMarker:T.Boolean(!0,{description:"Enable color marker"}),highlightColor:T.Color(dt.fromNormalizedRgb(1,.4,.6)),selectColor:T.Color(dt.fromNormalizedRgb(.2,1,.1)),dimColor:T.Color(dt.fromNormalizedRgb(1,1,1)),highlightStrength:T.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:T.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:T.Numeric(0,{min:0,max:1,step:.1}),markerPriority:T.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:T.Numeric(1,{min:0,max:3,step:.1}),exposure:T.Numeric(1,{min:0,max:3,step:.01}),light:T.ObjectList({inclination:T.Numeric(150,{min:0,max:180,step:1}),azimuth:T.Numeric(320,{min:0,max:360,step:1}),color:T.Color(dt.fromNormalizedRgb(1,1,1)),intensity:T.Numeric(.6,{min:0,max:5,step:.01})},function(e){return dt.toHexString(e.color)},{defaultValue:[{inclination:150,azimuth:320,color:dt.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:T.Color(dt.fromNormalizedRgb(1,1,1)),ambientIntensity:T.Numeric(.4,{min:0,max:2,step:.01})},are=b(),BN=b();function ire(e,t){for(var r=e.length,n=t||{direction:new Array(3*r).fill(0),color:new Array(3*r).fill(0)},a=n.direction,i=n.color,o=0;o<r;++o){var s=e[o];b.directionFromSpherical(are,Yr(s.inclination),Yr(s.azimuth),1),b.toArray(are,a,3*o),b.scale(BN,dt.toVec3Normalized(BN,s.color),s.intensity),b.toArray(BN,i,3*o)}return{count:r,direction:a,color:i}}function Dt(e,t,r){return void 0===t&&(t=""),void 0===r&&(r=""),Dt.create(e,t,r)}!function(e){e.create=function t(r,n){void 0===n&&(n={});var a=r.gl,i=r.state,o=r.stats,s=T.merge(FN,T.getDefaultValues(FN),n),u=ire(s.light),c=eo(),l=Be.create(a.drawingBufferWidth,a.drawingBufferHeight),d=dt.toVec3Normalized(b(),s.backgroundColor),f=!1,p=r.resources.texture("image-uint8","rgba","ubyte","nearest");p.define(1,1),p.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});var m=[["tDepth",p]],h=he(),v=he(),g=he(),y=he(),S=he(),C=he(),_=he(),x=b(),D=Be(),w=b();b.scale(w,dt.toArrayNormalized(s.ambientColor,w,0),s.ambientIntensity);var A={uModel:O.create(he.identity()),uView:O.create(h),uInvView:O.create(v),uModelView:O.create(g),uInvModelView:O.create(y),uInvProjection:O.create(S),uProjection:O.create(he()),uModelViewProjection:O.create(C),uInvModelViewProjection:O.create(_),uIsOrtho:O.create(1),uViewOffset:O.create(D),uPixelRatio:O.create(r.pixelRatio),uViewport:O.create(eo.toVec4(dr(),c)),uDrawingBufferSize:O.create(l),uCameraPosition:O.create(b()),uCameraDir:O.create(x),uNear:O.create(1),uFar:O.create(1e4),uFog:O.create(!0),uFogNear:O.create(1),uFogFar:O.create(1e4),uFogColor:O.create(d),uRenderMask:O.create(0),uMarkingDepthTest:O.create(!1),uPickType:O.create(Cv.None),uMarkingType:O.create(LT.None),uTransparentBackground:O.create(!1),uLightDirection:O.create(u.direction),uLightColor:O.create(u.color),uAmbientColor:O.create(w),uPickingAlphaThreshold:O.create(s.pickingAlphaThreshold),uInteriorDarkening:O.create(s.interiorDarkening),uInteriorColorFlag:O.create(s.interiorColorFlag),uInteriorColor:O.create(dt.toVec3Normalized(b(),s.interiorColor)),uHighlightColor:O.create(dt.toVec3Normalized(b(),s.highlightColor)),uSelectColor:O.create(dt.toVec3Normalized(b(),s.selectColor)),uDimColor:O.create(dt.toVec3Normalized(b(),s.dimColor)),uHighlightStrength:O.create(s.highlightStrength),uSelectStrength:O.create(s.selectStrength),uDimStrength:O.create(s.dimStrength),uMarkerPriority:O.create(s.markerPriority),uMarkerAverage:O.create(0),uXrayEdgeFalloff:O.create(s.xrayEdgeFalloff),uExposure:O.create(s.exposure)},E=Object.entries(A),I=!0,M=function(V,ee,ae){var pe,me,de;if(!V.state.disposed&&V.state.visible&&(V.state.pickable||"pick"!==ee)){var re=!1;V.values.dLightCount.ref.value!==u.count&&(O.update(V.values.dLightCount,u.count),re=!0),V.values.dColorMarker.ref.value!==s.colorMarker&&(O.update(V.values.dColorMarker,s.colorMarker),re=!0),re&&V.update();var te=V.getProgram(ee);if(i.currentProgramId!==te.id&&(I=!0,te.use()),I&&(te.setUniforms(E),te.bindTextures(m,0),I=!1),"directVolume"===V.values.dGeometryType.ref.value){if("colorDpoit"!==ee&&"colorWboit"!==ee&&"colorBlended"!==ee)return;i.disable(a.CULL_FACE),i.frontFace(a.CCW),"colorBlended"===ee&&(i.disable(a.DEPTH_TEST),i.depthMask(!1))}else 1===ae?(i.enable(a.CULL_FACE),null!==(pe=V.values.dFlipSided)&&void 0!==pe&&pe.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK))):2===ae?(i.enable(a.CULL_FACE),null!==(me=V.values.dFlipSided)&&void 0!==me&&me.ref.value?(i.frontFace(a.CW),i.cullFace(a.BACK)):(i.frontFace(a.CCW),i.cullFace(a.FRONT))):(V.values.uDoubleSided?V.values.uDoubleSided.ref.value||V.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),null!==(de=V.values.dFlipSided)&&void 0!==de&&de.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK)));V.render(ee,m.length)}},N=function(V,ee,ae,pe,me){Iw(m,"tDepth",ae||p),O.update(A.uModel,V.view),O.update(A.uModelView,he.mul(g,ee.view,V.view)),O.update(A.uInvModelView,he.invert(y,g)),O.update(A.uModelViewProjection,he.mul(C,g,ee.projection)),O.update(A.uInvModelViewProjection,he.invert(_,C)),O.updateIfChanged(A.uRenderMask,pe),O.updateIfChanged(A.uMarkingDepthTest,me),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var de=c.x,re=c.y,te=c.width,le=c.height;i.viewport(de,re,te,le),i.scissor(de,re,te,le),I=!0,i.currentRenderItemId=-1},Z=function(V,ee,ae){var pe,me;xt&&r.timer.mark("Renderer.renderBlendedOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,1,!1);for(var de=V.renderables,re=0,te=de.length;re<te;++re){var le=de[re];le.state.opaque?M(le,"colorBlended",0):null!==(pe=le.values.uDoubleSided)&&void 0!==pe&&pe.ref.value&&"opaque"===(null===(me=le.values.dTransparentBackfaces)||void 0===me?void 0:me.ref.value)&&M(le,"colorBlended",2)}xt&&r.timer.markEnd("Renderer.renderBlendedOpaque")},ne=function(V,ee,ae){var pe,me;xt&&r.timer.mark("Renderer.renderBlendedTransparent"),i.enable(a.DEPTH_TEST),N(V,ee,ae,2,!1);var de=V.renderables;f?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var re=0,te=de.length;re<te;++re)!(le=de[re]).state.opaque&&le.state.writeDepth&&M(le,"colorBlended",0);for(i.depthMask(!1),re=0,te=de.length;re<te;++re){var le;(!(le=de[re]).state.opaque&&!le.state.writeDepth||le.values.transparencyAverage.ref.value>0)&&(null!==(pe=le.values.uDoubleSided)&&void 0!==pe&&pe.ref.value?("opaque"!==(null===(me=le.values.dTransparentBackfaces)||void 0===me?void 0:me.ref.value)&&M(le,"colorBlended",2),M(le,"colorBlended",1)):M(le,"colorBlended",0))}xt&&r.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:function(V,ee){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),f&&!ee?i.clearColor(0,0,0,0):V?i.clearColor(d[0],d[1],d[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(V){void 0===V&&(V=!1),i.enable(a.SCISSOR_TEST),V?(i.colorMask(!0,!0,!0,!0),i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):(i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT))},update:function(V,ee){O.update(A.uView,V.view),O.update(A.uInvView,he.invert(v,V.view)),O.update(A.uProjection,V.projection),O.update(A.uInvProjection,he.invert(S,V.projection)),O.updateIfChanged(A.uIsOrtho,"orthographic"===V.state.mode?1:0),O.update(A.uViewOffset,V.viewOffset.enabled?Be.set(D,16*V.viewOffset.offsetX,16*V.viewOffset.offsetY):Be.set(D,0,0)),O.update(A.uCameraPosition,V.state.position),O.update(A.uCameraDir,b.normalize(x,b.sub(x,V.state.target,V.state.position))),O.updateIfChanged(A.uFar,V.far),O.updateIfChanged(A.uNear,V.near),O.updateIfChanged(A.uFogFar,V.fogFar),O.updateIfChanged(A.uFogNear,V.fogNear),O.updateIfChanged(A.uTransparentBackground,f),O.updateIfChanged(A.uMarkerAverage,ee.markerAverage)},renderPick:function(V,ee,ae,pe,me){xt&&r.timer.mark("Renderer.renderPick"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,pe,0,!1),O.updateIfChanged(A.uPickType,me);for(var de=V.renderables,re=0,te=de.length;re<te;++re)de[re].state.colorOnly||M(de[re],ae,0);xt&&r.timer.markEnd("Renderer.renderPick")},renderDepth:function(V,ee,ae){xt&&r.timer.mark("Renderer.renderDepth"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,0,!1);for(var pe=V.renderables,me=0,de=pe.length;me<de;++me)M(pe[me],"depth",0);xt&&r.timer.markEnd("Renderer.renderDepth")},renderDepthOpaque:function(V,ee,ae){var pe,me;xt&&r.timer.mark("Renderer.renderDepthOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,1,!1);for(var de=V.renderables,re=0,te=de.length;re<te;++re){var le=de[re],ge="on"===(null===(pe=le.values.dXrayShaded)||void 0===pe?void 0:pe.ref.value)||"inverted"===(null===(me=le.values.dXrayShaded)||void 0===me?void 0:me.ref.value);le.state.opaque&&1!==le.values.transparencyAverage.ref.value&&!ge&&M(le,"depth",0)}xt&&r.timer.markEnd("Renderer.renderDepthOpaque")},renderDepthTransparent:function(V,ee,ae){var pe,me;xt&&r.timer.mark("Renderer.renderDepthTransparent"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,2,!1);for(var de=V.renderables,re=0,te=de.length;re<te;++re){var le=de[re],ge="on"===(null===(pe=le.values.dXrayShaded)||void 0===pe?void 0:pe.ref.value)||"inverted"===(null===(me=le.values.dXrayShaded)||void 0===me?void 0:me.ref.value);(!le.state.opaque||le.values.transparencyAverage.ref.value>0||ge)&&M(le,"depth",0)}xt&&r.timer.markEnd("Renderer.renderDepthTransparent")},renderMarkingDepth:function(V,ee,ae){xt&&r.timer.mark("Renderer.renderMarkingDepth"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,0,!1),O.updateIfChanged(A.uMarkingType,LT.Depth);for(var pe=V.renderables,me=0,de=pe.length;me<de;++me){var re=pe[me];0!==Xi(re.values.alpha.ref.value*re.state.alphaFactor,0,1)&&1!==re.values.markerAverage.ref.value&&M(pe[me],"marking",0)}xt&&r.timer.markEnd("Renderer.renderMarkingDepth")},renderMarkingMask:function(V,ee,ae){xt&&r.timer.mark("Renderer.renderMarkingMask"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,0,!!ae),O.updateIfChanged(A.uMarkingType,LT.Mask);for(var pe=V.renderables,me=0,de=pe.length;me<de;++me)pe[me].values.markerAverage.ref.value>0&&M(pe[me],"marking",0);xt&&r.timer.markEnd("Renderer.renderMarkingMask")},renderBlended:function(V,ee){V.hasOpaque&&Z(V,ee,null),V.opacityAverage<1&&ne(V,ee,null)},renderBlendedOpaque:Z,renderBlendedTransparent:ne,renderBlendedVolume:function(V,ee,ae){xt&&r.timer.mark("Renderer.renderBlendedVolume"),i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),N(V,ee,ae,2,!1);for(var pe=V.renderables,me=0,de=pe.length;me<de;++me){var re=pe[me];"directVolume"===re.values.dGeometryType.ref.value&&M(re,"colorBlended",0)}xt&&r.timer.markEnd("Renderer.renderBlendedVolume")},renderWboitOpaque:function(V,ee,ae){var pe,me,de,re;xt&&r.timer.mark("Renderer.renderWboitOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,1,!1);for(var te=V.renderables,le=0,ge=te.length;le<ge;++le){var xe=te[le],Ge=Xi(xe.values.alpha.ref.value*xe.state.alphaFactor,0,1),je="on"===(null===(pe=xe.values.dXrayShaded)||void 0===pe?void 0:pe.ref.value)||"inverted"===(null===(me=xe.values.dXrayShaded)||void 0===me?void 0:me.ref.value);(1===Ge&&1!==xe.values.transparencyAverage.ref.value&&"directVolume"!==xe.values.dGeometryType.ref.value&&"fuzzy"!==(null===(de=xe.values.dPointStyle)||void 0===de?void 0:de.ref.value)&&!je||"opaque"===(null===(re=xe.values.dTransparentBackfaces)||void 0===re?void 0:re.ref.value))&&M(xe,"colorWboit",0)}xt&&r.timer.markEnd("Renderer.renderWboitOpaque")},renderWboitTransparent:function(V,ee,ae){var pe,me,de;xt&&r.timer.mark("Renderer.renderWboitTransparent"),N(V,ee,ae,2,!1);for(var re=V.renderables,te=0,le=re.length;te<le;++te){var ge=re[te],xe=Xi(ge.values.alpha.ref.value*ge.state.alphaFactor,0,1),Ge="on"===(null===(pe=ge.values.dXrayShaded)||void 0===pe?void 0:pe.ref.value)||"inverted"===(null===(me=ge.values.dXrayShaded)||void 0===me?void 0:me.ref.value);(xe<1&&0!==xe||ge.values.transparencyAverage.ref.value>0||"directVolume"===ge.values.dGeometryType.ref.value||"fuzzy"===(null===(de=ge.values.dPointStyle)||void 0===de?void 0:de.ref.value)||"text"===ge.values.dGeometryType.ref.value||Ge)&&M(ge,"colorWboit",0)}xt&&r.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitOpaque:function(V,ee,ae){var pe,me,de,re;xt&&r.timer.mark("Renderer.renderDpoitOpaque"),i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(V,ee,ae,1,!1);for(var te=V.renderables,le=0,ge=te.length;le<ge;++le){var xe=te[le],Ge=Xi(xe.values.alpha.ref.value*xe.state.alphaFactor,0,1),je="on"===(null===(pe=xe.values.dXrayShaded)||void 0===pe?void 0:pe.ref.value)||"inverted"===(null===(me=xe.values.dXrayShaded)||void 0===me?void 0:me.ref.value);(1===Ge&&1!==xe.values.transparencyAverage.ref.value&&"fuzzy"!==(null===(de=xe.values.dPointStyle)||void 0===de?void 0:de.ref.value)&&!je||"opaque"===(null===(re=xe.values.dTransparentBackfaces)||void 0===re?void 0:re.ref.value))&&M(xe,"colorDpoit",0)}xt&&r.timer.markEnd("Renderer.renderDpoitOpaque")},renderDpoitTransparent:function(V,ee,ae,pe){var me,de,re;xt&&r.timer.mark("Renderer.renderDpoitTransparent"),i.enable(a.BLEND),Iw(m,"tDpoitDepth",pe.depth),Iw(m,"tDpoitFrontColor",pe.frontColor),Iw(m,"tDpoitBackColor",pe.backColor),N(V,ee,ae,2,!1);for(var te=V.renderables,le=0,ge=te.length;le<ge;++le){var xe=te[le],Ge=Xi(xe.values.alpha.ref.value*xe.state.alphaFactor,0,1),je="on"===(null===(me=xe.values.dXrayShaded)||void 0===me?void 0:me.ref.value)||"inverted"===(null===(de=xe.values.dXrayShaded)||void 0===de?void 0:de.ref.value);(Ge<1&&0!==Ge||xe.values.transparencyAverage.ref.value>0||"fuzzy"===(null===(re=xe.values.dPointStyle)||void 0===re?void 0:re.ref.value)||"text"===xe.values.dGeometryType.ref.value||je)&&M(xe,"colorDpoit",0)}xt&&r.timer.markEnd("Renderer.renderDpoitTransparent")},renderDpoitVolume:function(V,ee,ae){xt&&r.timer.mark("Renderer.renderDpoitVolume"),i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),N(V,ee,ae,2,!1);for(var pe=V.renderables,me=0,de=pe.length;me<de;++me){var re=pe[me];"directVolume"===re.values.dGeometryType.ref.value&&M(re,"colorDpoit",0)}xt&&r.timer.markEnd("Renderer.renderDpoitVolume")},setProps:function(V){void 0!==V.backgroundColor&&V.backgroundColor!==s.backgroundColor&&(s.backgroundColor=V.backgroundColor,dt.toVec3Normalized(d,s.backgroundColor),O.update(A.uFogColor,b.copy(A.uFogColor.ref.value,d))),void 0!==V.pickingAlphaThreshold&&V.pickingAlphaThreshold!==s.pickingAlphaThreshold&&(s.pickingAlphaThreshold=V.pickingAlphaThreshold,O.update(A.uPickingAlphaThreshold,s.pickingAlphaThreshold)),void 0!==V.interiorDarkening&&V.interiorDarkening!==s.interiorDarkening&&(s.interiorDarkening=V.interiorDarkening,O.update(A.uInteriorDarkening,s.interiorDarkening)),void 0!==V.interiorColorFlag&&V.interiorColorFlag!==s.interiorColorFlag&&(s.interiorColorFlag=V.interiorColorFlag,O.update(A.uInteriorColorFlag,s.interiorColorFlag)),void 0!==V.interiorColor&&V.interiorColor!==s.interiorColor&&(s.interiorColor=V.interiorColor,O.update(A.uInteriorColor,dt.toVec3Normalized(A.uInteriorColor.ref.value,s.interiorColor))),void 0!==V.colorMarker&&V.colorMarker!==s.colorMarker&&(s.colorMarker=V.colorMarker),void 0!==V.highlightColor&&V.highlightColor!==s.highlightColor&&(s.highlightColor=V.highlightColor,O.update(A.uHighlightColor,dt.toVec3Normalized(A.uHighlightColor.ref.value,s.highlightColor))),void 0!==V.selectColor&&V.selectColor!==s.selectColor&&(s.selectColor=V.selectColor,O.update(A.uSelectColor,dt.toVec3Normalized(A.uSelectColor.ref.value,s.selectColor))),void 0!==V.dimColor&&V.dimColor!==s.dimColor&&(s.dimColor=V.dimColor,O.update(A.uDimColor,dt.toVec3Normalized(A.uDimColor.ref.value,s.dimColor))),void 0!==V.highlightStrength&&V.highlightStrength!==s.highlightStrength&&(s.highlightStrength=V.highlightStrength,O.update(A.uHighlightStrength,s.highlightStrength)),void 0!==V.selectStrength&&V.selectStrength!==s.selectStrength&&(s.selectStrength=V.selectStrength,O.update(A.uSelectStrength,s.selectStrength)),void 0!==V.dimStrength&&V.dimStrength!==s.dimStrength&&(s.dimStrength=V.dimStrength,O.update(A.uDimStrength,s.dimStrength)),void 0!==V.markerPriority&&V.markerPriority!==s.markerPriority&&(s.markerPriority=V.markerPriority,O.update(A.uMarkerPriority,s.markerPriority)),void 0!==V.xrayEdgeFalloff&&V.xrayEdgeFalloff!==s.xrayEdgeFalloff&&(s.xrayEdgeFalloff=V.xrayEdgeFalloff,O.update(A.uXrayEdgeFalloff,s.xrayEdgeFalloff)),void 0!==V.exposure&&V.exposure!==s.exposure&&(s.exposure=V.exposure,O.update(A.uExposure,s.exposure)),void 0!==V.light&&!rd(V.light,s.light)&&(s.light=V.light,Object.assign(u,ire(V.light,u)),O.update(A.uLightDirection,u.direction),O.update(A.uLightColor,u.color)),void 0!==V.ambientColor&&V.ambientColor!==s.ambientColor&&(s.ambientColor=V.ambientColor,b.scale(w,dt.toArrayNormalized(s.ambientColor,w,0),s.ambientIntensity),O.update(A.uAmbientColor,w)),void 0!==V.ambientIntensity&&V.ambientIntensity!==s.ambientIntensity&&(s.ambientIntensity=V.ambientIntensity,b.scale(w,dt.toArrayNormalized(s.ambientColor,w,0),s.ambientIntensity),O.update(A.uAmbientColor,w))},setViewport:function(V,ee,ae,pe){i.viewport(V,ee,ae,pe),i.scissor(V,ee,ae,pe),(V!==c.x||ee!==c.y||ae!==c.width||pe!==c.height)&&(eo.set(c,V,ee,ae,pe),O.update(A.uViewport,dr.set(A.uViewport.ref.value,V,ee,ae,pe)))},setTransparentBackground:function(V){f=V},setDrawingBufferSize:function(V,ee){(V!==l[0]||ee!==l[1])&&O.update(A.uDrawingBufferSize,Be.set(l,V,ee))},setPixelRatio:function(V){O.update(A.uPixelRatio,V)},props:s,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},get light(){return u},dispose:function(){}}}}(NN||(NN={})),function(e){function o(l){return l.triggers.map(u.format).join(" or ")}function u(l,d){return u.create(l,d)}var l;e.create=function t(l,d,f){return void 0===d&&(d=""),void 0===f&&(f=""),{triggers:l,action:d,description:f}},e.isBinding=function r(l){return!!l&&Array.isArray(l.triggers)&&"string"==typeof l.action},e.Empty={triggers:[],action:"",description:""},e.isEmpty=function n(l){return 0===l.triggers.length||l.triggers.every(function(d){return void 0===d.buttons&&void 0===d.modifiers&&!d.code})},e.match=function a(l,d,f){return l.triggers.some(function(p){return u.match(p,d,f)})},e.matchKey=function i(l,d,f,p){return l.triggers.some(function(m){return u.matchKey(m,d,f,p)})},e.formatTriggers=o,e.format=function s(l,d){return void 0===d&&(d=""),function B_e(e,t){var r=Object.keys(t),n=Object.values(t);return(new(Function.bind.apply(Function,or(or([void 0],r,!1),["return `".concat(e,"`;")],!1)))).apply(void 0,n)}(l.description||yc(d),{triggers:"<i>"+o(l)+"</i>"})},e.Trigger=u,e.TriggerKey=function c(l,d){return u.create(void 0,d,l)},(l=u=e.Trigger||(e.Trigger={})).create=function d(h,v,g){return{buttons:h,modifiers:v,code:g}},l.Empty={},l.match=function f(h,v,g){var y=h.buttons,S=h.modifiers;return void 0!==y&&(y===v||Ga.has(y,v))&&(!S||$u.areEqual(S,g))},l.matchKey=function p(h,v,g,y){var S=h.modifiers,C=h.code;return void 0!==C&&(C===v||1===C.length&&4===v.length&&v.startsWith("Key")&&!!y&&1===y.length&&y.toUpperCase()===C.toUpperCase())&&(!S||$u.areEqual(S,g))},l.format=function m(h){var v=[],g=function SWe(e,t){var r=[];return void 0!==e||t?0===e?r.push("mouse hover"):void 0!==e&&(Tm.has(e,Tm.Flag.Primary)&&r.push("left mouse button"),Tm.has(e,Tm.Flag.Secondary)&&r.push("right mouse button"),Tm.has(e,Tm.Flag.Auxilary)&&r.push("wheel/middle mouse button"),Tm.has(e,Tm.Flag.Forth)&&r.push("three fingers")):r.push("any mouse button"),r.join(" + ")}(h.buttons,h.code);g&&v.push(g);var y=function xWe(e){return e?.startsWith("Key")&&(e=e.substring(3)),e&&function R_e(e){return Mh(Gq(e))}(e).toLowerCase()}(h.code);y&&v.push(y);var S=function CWe(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&0===r.length&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}(h.modifiers);return S&&v.push(S),v.join(" + ")}}(Dt||(Dt={}));var kN,UT,Tm=Ga,Dm=Ga,Ju=$u,Em=Dt.Trigger,gu=Dt.TriggerKey,ore={dragRotate:Dt([Em(Dm.Flag.Primary,Ju.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:Dt([Em(Dm.Flag.Primary,Ju.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:Dt([Em(Dm.Flag.Secondary,Ju.create()),Em(Dm.Flag.Primary,Ju.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:Dt.Empty,dragFocus:Dt([Em(Dm.Flag.Forth,Ju.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:Dt([Em(Dm.Flag.Auxilary,Ju.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:Dt([Em(Dm.Flag.Auxilary,Ju.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:Dt([Em(Dm.Flag.Auxilary,Ju.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:Dt.Empty,keyMoveForward:Dt([gu("KeyW")],"Move forward","Press ${triggers}"),keyMoveBack:Dt([gu("KeyS")],"Move back","Press ${triggers}"),keyMoveLeft:Dt([gu("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:Dt([gu("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:Dt([gu("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:Dt([gu("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:Dt([gu("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:Dt([gu("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:Dt([gu("ArrowUp",Ju.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:Dt([gu("ArrowDown",Ju.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:Dt([gu("ArrowLeft",Ju.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:Dt([gu("ArrowRight",Ju.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:Dt([gu("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:Dt([gu("Space",Ju.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},sre={noScroll:T.Boolean(!0,{isHidden:!0}),rotateSpeed:T.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:T.Numeric(7,{min:1,max:15,step:1}),panSpeed:T.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:T.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:T.Numeric(5,{min:.1,max:10,step:.1}),flyMode:T.Boolean(!1),animate:T.MappedStatic("off",{off:T.EmptyGroup(),spin:T.Group({speed:T.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:T.Group({speed:T.Numeric(.3,{min:-5,max:5,step:.1}),angle:T.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:T.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:T.Numeric(.2,{},{isHidden:!0}),minDistance:T.Numeric(.01,{},{isHidden:!0}),maxDistance:T.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:T.Numeric(1,{},{isHidden:!0}),maxWheelDelta:T.Numeric(.02,{},{isHidden:!0}),bindings:T.Value(ore,{isHidden:!0}),autoAdjustMinMaxDistance:T.MappedStatic("on",{off:T.EmptyGroup(),on:T.Group({minDistanceFactor:T.Numeric(0),minDistancePadding:T.Numeric(5),maxDistanceFactor:T.Numeric(10),maxDistanceMin:T.Numeric(20)})},{isHidden:!0})};!function(e){e.create=function t(r,n,a,i){void 0===i&&(i={});var o=R(R(R({},T.getDefaultValues(sre)),i),{bindings:R(R({},ore),i.bindings)}),s=o.bindings,u=eo.clone(n.viewport),c=!1,l=r.drag.subscribe(function Ct(Ke){var gt=Ke.x,Wt=Ke.y,wr=Ke.pageX,ca=Ke.pageY,xa=Ke.buttons,Wo=Ke.modifiers,Zc=Ke.isStart,Yo=St(gt,Wt);if((!Zc||!Yo)&&(Zc||C)){C=!0,Qm();var xp=Dt.match(s.dragRotate,xa,Wo),$m=Dt.match(s.dragRotateZ,xa,Wo),Jm=Dt.match(s.dragPan,xa,Wo),Qy=Dt.match(s.dragZoom,xa,Wo),io=Dt.match(s.dragFocus,xa,Wo),Yd=Dt.match(s.dragFocusZoom,xa,Wo);K(wr,ca),function W(Ke,gt){Be.set(k,(Ke-u.x)/u.width,(gt-u.y)/u.height)}(wr,ca);var ys=r.pixelRatio,sE=(gt*ys-u.width/2-u.x)/u.width,uE=-(r.height-Wt*ys-u.height/2-u.y)/u.height;if(Zc&&(xp&&(Be.copy(w,$),Be.copy(D,w)),$m&&(Be.set(M,sE,uE),Be.copy(I,M)),(Qy||Yd)&&(Be.copy(U,k),Be.copy(H,U)),io&&(Be.copy(z,k),Be.copy(G,z)),Jm&&(Be.copy(J,k),Be.copy(X,J))),xp&&Be.copy(w,$),$m&&Be.set(M,sE,uE),(Qy||Yd)&&Be.copy(H,k),io&&Be.copy(G,k),Yd){var Yv=b.distance(n.state.position,n.state.target);n.setState({radius:Yv/5})}Jm&&Be.copy(X,k)}}),d=r.interactionEnd.subscribe(function bt(){C=!1}),f=r.wheel.subscribe(function Mt(Ke){var wr=Ke.spinX,ca=Ke.spinY,xa=Ke.dz,Wo=Ke.buttons,Zc=Ke.modifiers;if(!St(Ke.x,Ke.y)){var Yo=function T_e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}(.075*wr,.075*ca,1e-4*xa);Yo<-o.maxWheelDelta?Yo=-o.maxWheelDelta:Yo>o.maxWheelDelta&&(Yo=o.maxWheelDelta),Dt.match(s.scrollZoom,Wo,Zc)&&(H[1]+=Yo),Dt.match(s.scrollFocus,Wo,Zc)&&(G[1]+=Yo)}}),p=r.pinch.subscribe(function Rt(Ke){var gt=Ke.fractionDelta;Dt.match(s.scrollZoom,Ke.buttons,Ke.modifiers)&&(C=!0,H[1]+=o.gestureScaleFactor*gt)}),m=r.gesture.subscribe(function oe(Ke){C=!0,H[1]+=o.gestureScaleFactor*Ke.deltaScale}),h=r.keyDown.subscribe(function Ce(Ke){var gt=Ke.modifiers,Wt=Ke.code,wr=Ke.key;St(Ke.x,Ke.y)||(Dt.matchKey(s.keyMoveForward,Wt,gt,wr)?Ie.moveForward=1:Dt.matchKey(s.keyMoveBack,Wt,gt,wr)?Ie.moveBack=1:Dt.matchKey(s.keyMoveLeft,Wt,gt,wr)?Ie.moveLeft=1:Dt.matchKey(s.keyMoveRight,Wt,gt,wr)?Ie.moveRight=1:Dt.matchKey(s.keyMoveUp,Wt,gt,wr)?Ie.moveUp=1:Dt.matchKey(s.keyMoveDown,Wt,gt,wr)?Ie.moveDown=1:Dt.matchKey(s.keyRollLeft,Wt,gt,wr)?Ie.rollLeft=1:Dt.matchKey(s.keyRollRight,Wt,gt,wr)?Ie.rollRight=1:Dt.matchKey(s.keyPitchUp,Wt,gt,wr)?Ie.pitchUp=1:Dt.matchKey(s.keyPitchDown,Wt,gt,wr)?Ie.pitchDown=1:Dt.matchKey(s.keyYawLeft,Wt,gt,wr)?Ie.yawLeft=1:Dt.matchKey(s.keyYawRight,Wt,gt,wr)&&(Ie.yawRight=1),Dt.matchKey(s.boostMove,Wt,gt,wr)&&(Ie.boostMove=1),Dt.matchKey(s.enablePointerLock,Wt,gt,wr)&&r.requestPointerLock(u))}),v=r.keyUp.subscribe(function Qe(Ke){var gt,Wt,wr,ca,xa,Wo,Zc,Yo,xp,$m,Jm,Qy,io=Ke.modifiers,Yd=Ke.code,ys=Ke.key;if(!St(Ke.x,Ke.y)){var Yv=!1;Yd.startsWith("Alt")?(Yv=!0,io.alt=!0):Yd.startsWith("Shift")?(Yv=!0,io.shift=!0):Yd.startsWith("Control")?(Yv=!0,io.control=!0):Yd.startsWith("Meta")&&(Yv=!0,io.meta=!0);var xu=[];Yv?(Ie.moveForward&&xu.push((null===(gt=s.keyMoveForward.triggers[0])||void 0===gt?void 0:gt.code)||""),Ie.moveBack&&xu.push((null===(Wt=s.keyMoveBack.triggers[0])||void 0===Wt?void 0:Wt.code)||""),Ie.moveLeft&&xu.push((null===(wr=s.keyMoveLeft.triggers[0])||void 0===wr?void 0:wr.code)||""),Ie.moveRight&&xu.push((null===(ca=s.keyMoveRight.triggers[0])||void 0===ca?void 0:ca.code)||""),Ie.moveUp&&xu.push((null===(xa=s.keyMoveUp.triggers[0])||void 0===xa?void 0:xa.code)||""),Ie.moveDown&&xu.push((null===(Wo=s.keyMoveDown.triggers[0])||void 0===Wo?void 0:Wo.code)||""),Ie.rollLeft&&xu.push((null===(Zc=s.keyRollLeft.triggers[0])||void 0===Zc?void 0:Zc.code)||""),Ie.rollRight&&xu.push((null===(Yo=s.keyRollRight.triggers[0])||void 0===Yo?void 0:Yo.code)||""),Ie.pitchUp&&xu.push((null===(xp=s.keyPitchUp.triggers[0])||void 0===xp?void 0:xp.code)||""),Ie.pitchDown&&xu.push((null===($m=s.keyPitchDown.triggers[0])||void 0===$m?void 0:$m.code)||""),Ie.yawLeft&&xu.push((null===(Jm=s.keyYawLeft.triggers[0])||void 0===Jm?void 0:Jm.code)||""),Ie.yawRight&&xu.push((null===(Qy=s.keyYawRight.triggers[0])||void 0===Qy?void 0:Qy.code)||"")):xu.push(Yd);for(var x5=0,tue=xu;x5<tue.length;x5++){var Qc=tue[x5];Dt.matchKey(s.keyMoveForward,Qc,io,ys)?Ie.moveForward=0:Dt.matchKey(s.keyMoveBack,Qc,io,ys)?Ie.moveBack=0:Dt.matchKey(s.keyMoveLeft,Qc,io,ys)?Ie.moveLeft=0:Dt.matchKey(s.keyMoveRight,Qc,io,ys)?Ie.moveRight=0:Dt.matchKey(s.keyMoveUp,Qc,io,ys)?Ie.moveUp=0:Dt.matchKey(s.keyMoveDown,Qc,io,ys)?Ie.moveDown=0:Dt.matchKey(s.keyRollLeft,Qc,io,ys)?Ie.rollLeft=0:Dt.matchKey(s.keyRollRight,Qc,io,ys)?Ie.rollRight=0:Dt.matchKey(s.keyPitchUp,Qc,io,ys)?Ie.pitchUp=0:Dt.matchKey(s.keyPitchDown,Qc,io,ys)?Ie.pitchDown=0:Dt.matchKey(s.keyYawLeft,Qc,io,ys)?Ie.yawLeft=0:Dt.matchKey(s.keyYawRight,Qc,io,ys)&&(Ie.yawRight=0)}Dt.matchKey(s.boostMove,Yd,io,ys)&&(Ie.boostMove=0)}}),g=r.move.subscribe(function be(Ke){var gt=Ke.movementX,Wt=Ke.movementY;if(r.pointerLock&&void 0!==gt&&void 0!==Wt){var wr=.5*u.width-u.x,ca=.5*u.height-u.y;Be.copy(D,K(wr,ca)),Be.copy(w,K(gt+wr,Wt+ca))}}),y=r.lock.subscribe(function Zt(Ke){Ke?Et():At()}),S=r.leave.subscribe(function tr(){!function Dr(){Ie.moveForward=0,Ie.moveBack=0,Ie.moveLeft=0,Ie.moveRight=0,Ie.moveUp=0,Ie.moveDown=0,Ie.rollLeft=0,Ie.rollRight=0,Ie.pitchUp=0,Ie.pitchDown=0,Ie.yawLeft=0,Ie.yawRight=0,Ie.boostMove=0}()}),C=!1,_=b(),x=b(),D=Be(),w=Be(),A=b(),E=0,I=Be(),M=Be(),F=0,N=0,j=0,U=Be(),H=Be(),z=Be(),G=Be(),J=Be(),X=Be(),Z=b.clone(n.target),ne=b.clone(n.position),Y=b.clone(n.up),k=Be(),$=Be();function K(Ke,gt){return Be.set($,(Ke-.5*u.width-u.x)/(.5*u.width),(u.height+2*(u.y-gt))/u.width)}function q(){return o.rotateSpeed*r.pixelRatio*(r.width/r.height)}var V=b(),ee=hn(),ae=b(),pe=b(),me=b(),de=b(),te=hn(),le=b(),xe=hn(),Ge=b(),L=hn(),Q=b(),Oe=Be(),Ne=b(),Ue=b(),Ie={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},He=b(),Je=b();function ut(){var Ke=Math.min(Math.max(1e3*n.state.radiusMax,.01),o.maxDistance);b.squaredMagnitude(x)>Ke*Ke&&(b.setMagnitude(x,x,Ke),b.add(n.position,n.target,x),Be.copy(U,H),Be.copy(z,G)),b.squaredMagnitude(x)<o.minDistance*o.minDistance&&(b.setMagnitude(x,x,o.minDistance),b.add(n.position,n.target,x),Be.copy(U,H),Be.copy(z,G))}function St(Ke,gt){return gt*=r.pixelRatio,(Ke*=r.pixelRatio)>u.x+u.width||r.height-gt>u.y+u.height||Ke<u.x||r.height-gt<u.y}var wt=-1;function Le(Ke){if(wt!==Ke){var gt=Ke-wt;wt>0&&("spin"===o.animate.name?function ao(Ke){if("spin"===o.animate.name&&0!==o.animate.params.speed&&!C){var gt=o.animate.params.speed/1e3;Qn[0]=60*Math.min(Math.abs(Ke),125)/1e3*gt,Be.add(w,D,Qn)}}(gt):"rock"===o.animate.name&&function Wd(Ke){if("rock"===o.animate.name&&0!==o.animate.params.speed&&!C){var gt=Ke/1e3*o.animate.params.speed,Wt=Yr(o.animate.params.angle)/q(),wr=Math.sin(ja*Math.PI*2)*Wt,ca=Math.sin((ja+gt)*Math.PI*2)*Wt;Gi[0]=ca-wr,Be.add(w,D,Gi),(ja+=gt)>=1&&(ja=0)}}(gt)),b.sub(x,n.position,n.target),function re(){var Ke=w[0]-D[0],gt=w[1]-D[1];b.set(de,Ke,gt,0);var Wt=b.magnitude(de)*q();Wt?(b.sub(x,n.position,n.target),b.normalize(ae,x),b.normalize(pe,n.up),b.normalize(me,b.cross(me,pe,ae)),b.setMagnitude(pe,pe,gt),b.setMagnitude(me,me,Ke),b.add(de,pe,me),b.normalize(V,b.cross(V,de,x)),hn.setAxisAngle(ee,V,Wt),b.transformQuat(x,x,ee),b.transformQuat(n.up,n.up,ee),b.copy(A,V),E=Wt):!o.staticMoving&&E&&(E*=Math.sqrt(1-o.dynamicDampingFactor),b.sub(x,n.position,n.target),hn.setAxisAngle(ee,A,E),b.transformQuat(x,x,ee),b.transformQuat(n.up,n.up,ee)),Be.copy(D,w)}(),function ge(){var Ke=(Ie.rollRight-Ie.rollLeft)/45,gt=(M[0]-I[0])*-Math.sign(M[1]),Wt=(M[1]-I[1])*-Math.sign(M[0]),wr=-o.rotateSpeed*(-gt+Wt)+Ke;wr?(b.normalize(le,x),hn.setAxisAngle(te,le,wr),b.transformQuat(n.up,n.up,te),F=wr):!o.staticMoving&&F&&(F*=Math.sqrt(1-o.dynamicDampingFactor),b.normalize(le,x),hn.setAxisAngle(te,le,F),b.transformQuat(n.up,n.up,te)),Be.copy(I,M)}(),function je(){var gt=(Ie.pitchUp-Ie.pitchDown)/(o.flyMode?360:90)*-o.rotateSpeed;gt?(b.cross(Ge,x,n.up),b.normalize(Ge,Ge),hn.setAxisAngle(xe,Ge,gt),b.transformQuat(x,x,xe),b.transformQuat(n.up,n.up,xe),N=gt):!o.staticMoving&&N&&(N*=Math.sqrt(1-o.dynamicDampingFactor),b.cross(Ge,x,n.up),b.normalize(Ge,Ge),hn.setAxisAngle(xe,Ge,N),b.transformQuat(x,x,xe),b.transformQuat(n.up,n.up,xe))}(),function ye(){var gt=(Ie.yawRight-Ie.yawLeft)/(o.flyMode?360:90)*-o.rotateSpeed;gt?(b.normalize(Q,n.up),hn.setAxisAngle(L,Q,gt),b.transformQuat(x,x,L),b.transformQuat(n.up,n.up,L),j=gt):!o.staticMoving&&j&&(j*=Math.sqrt(1-o.dynamicDampingFactor),b.normalize(Q,n.up),hn.setAxisAngle(L,Q,j),b.transformQuat(x,x,L),b.transformQuat(n.up,n.up,L))}(),function we(){var Ke=1+(H[1]-U[1])*o.zoomSpeed;1!==Ke&&Ke>0&&b.scale(x,x,Ke),o.staticMoving?Be.copy(U,H):U[1]+=(H[1]-U[1])*o.dynamicDampingFactor}(),function De(){var Ke=(G[1]-z[1])*o.zoomSpeed;if(0!==Ke){var gt=Math.max(1,n.state.radius+n.state.radius*Ke);n.setState({radius:gt})}o.staticMoving?Be.copy(z,G):z[1]+=(G[1]-z[1])*o.dynamicDampingFactor}(),function $e(){if(Be.sub(Oe,Be.copy(Oe,X),J),Be.squaredMagnitude(Oe)){var Ke=r.pixelRatio*o.panSpeed;Oe[0]*=1/n.zoom*n.viewport.width*Ke,Oe[1]*=1/n.zoom*n.viewport.height*Ke,b.cross(Ue,b.copy(Ue,x),n.up),b.setMagnitude(Ue,Ue,Oe[0]),b.setMagnitude(Ne,n.up,Oe[1]),b.add(Ue,Ue,Ne),b.add(n.position,n.position,Ue),b.add(n.target,n.target,Ue),o.staticMoving?Be.copy(J,X):(Be.sub(Oe,X,J),Be.scale(Oe,Oe,o.dynamicDampingFactor),Be.add(J,J,Oe))}}(),b.add(n.position,n.target,x),ut(),wt>0&&function mt(Ke){b.sub(Je,n.position,n.target);var gt=Math.max(n.state.minNear,o.minDistance);b.setMagnitude(Je,Je,gt);var Wt=.06*Ke*o.moveSpeed*(1===Ie.boostMove?o.boostMoveFactor:1);if(1===Ie.moveForward&&(b.normalize(He,Je),b.scaleAndSub(n.position,n.position,He,Wt),(o.flyMode||r.pointerLock)&&b.sub(n.target,n.position,Je)),1===Ie.moveBack&&(b.normalize(He,Je),b.scaleAndAdd(n.position,n.position,He,Wt),(o.flyMode||r.pointerLock)&&b.sub(n.target,n.position,Je)),1===Ie.moveLeft&&(b.cross(He,Je,n.up),b.normalize(He,He),o.flyMode||r.pointerLock?(b.scaleAndAdd(n.position,n.position,He,Wt),b.sub(n.target,n.position,Je)):(b.scaleAndSub(n.position,n.position,He,Wt),b.sub(n.target,n.position,x))),1===Ie.moveRight&&(b.cross(He,Je,n.up),b.normalize(He,He),o.flyMode||r.pointerLock?(b.scaleAndSub(n.position,n.position,He,Wt),b.sub(n.target,n.position,Je)):(b.scaleAndAdd(n.position,n.position,He,Wt),b.sub(n.target,n.position,x))),1===Ie.moveUp&&(b.normalize(He,n.up),o.flyMode||r.pointerLock?(b.scaleAndAdd(n.position,n.position,He,Wt),b.sub(n.target,n.position,Je)):(b.scaleAndSub(n.position,n.position,He,Wt),b.sub(n.target,n.position,x))),1===Ie.moveDown&&(b.normalize(He,n.up),o.flyMode||r.pointerLock?(b.scaleAndSub(n.position,n.position,He,Wt),b.sub(n.target,n.position,Je)):(b.scaleAndAdd(n.position,n.position,He,Wt),b.sub(n.target,n.position,x))),o.flyMode||r.pointerLock){var wr=b.distance(n.position,a.boundingSphereVisible.center);n.setState({minFar:wr+a.boundingSphereVisible.radius})}}(Math.min(gt,250)),b.sub(x,n.position,n.target),ut(),b.squaredDistance(_,n.position)>mn&&b.copy(_,n.position),wt=Ke}}function Et(){b.sub(Je,n.position,n.target);var Ke=Math.max(n.state.minNear,o.minDistance);b.setMagnitude(Je,Je,Ke),b.sub(n.target,n.position,Je);var gt=b.distance(n.position,a.boundingSphereVisible.center);n.setState({minFar:gt+a.boundingSphereVisible.radius})}function At(){var Ke=a.boundingSphereVisible,gt=Ke.center,Wt=Ke.radius;if(b.distance(n.position,gt)>Wt){var ca=n.getFocus(gt,Wt);n.setState(R(R({},ca),{minFar:0}))}else n.setState({minFar:0,radius:a.boundingSphereVisible.radius})}var Qn=Be.create(.005,0),ja=0,Gi=Be.create(.005,0);function Qm(){ja=0}return{viewport:u,get isAnimating(){return"off"!==o.animate.name},get isMoving(){return 1===Ie.moveForward||1===Ie.moveBack||1===Ie.moveLeft||1===Ie.moveRight||1===Ie.moveUp||1===Ie.moveDown||1===Ie.rollLeft||1===Ie.rollRight||1===Ie.pitchUp||1===Ie.pitchDown||1===Ie.yawLeft||1===Ie.yawRight},get props(){return o},setProps:function(Ke){var gt;"rock"===(null===(gt=Ke.animate)||void 0===gt?void 0:gt.name)&&"rock"!==o.animate.name&&Qm(),void 0!==Ke.flyMode&&Ke.flyMode!==o.flyMode&&(Ke.flyMode?Et():At()),Object.assign(o,Ke),Object.assign(s,Ke.bindings)},start:function ze(Ke){wt=-1,Le(Ke)},update:Le,reset:function it(){b.copy(n.target,Z),b.copy(n.position,ne),b.copy(n.up,Y),b.sub(x,n.position,n.target),b.copy(_,n.position)},dispose:function fn(){c||(c=!0,l.unsubscribe(),f.unsubscribe(),p.unsubscribe(),m.unsubscribe(),d.unsubscribe(),h.unsubscribe(),v.unsubscribe(),g.unsubscribe(),y.unsubscribe(),S.unsubscribe())}}}}(kN||(kN={})),function(e){e.create=function t(){return{view:he.identity(),position:b.create(0,0,0),direction:b.create(0,0,-1),up:b.create(0,1,0)}};var r=b.zero();e.update=function n(a){b.add(r,a.position,a.direction),he.lookAt(a.view,a.position,r,a.up)}}(UT||(UT={}));var xy,_We=function(){function e(){this.removeList=rF(),this.removeMap=new Map,this.addList=rF(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.removeList.count&&0===this.addList.count},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.removeMap.size+this.addMap.size},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),U2=new Lu("98");function ure(e,t,r){U2.reset();for(var n=0,a=e.length;n<a;++n)if(!r||e[n].state.visible){var i=e[n].values.boundingSphere.ref.value;i.radius&&U2.includeSphere(i)}for(U2.finishedIncludeStep(),n=0,a=e.length;n<a;++n)if(!r||e[n].state.visible){var o=e[n].values.boundingSphere.ref.value;o.radius&&U2.radiusSphere(o)}return U2.getSphere(t)}function wWe(e,t){var r=(e.getProgram("colorBlended")||e.getProgram("colorWboit")||e.getProgram("colorDpoit")).id,n=(t.getProgram("colorBlended")||t.getProgram("colorWboit")||t.getProgram("colorDpoit")).id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}!function(e){e.create=function t(r,n){void 0===n&&(n=TA);var a=new Map,i=[],o=Pe(),s=Pe(),u=[],c=[],l=!0,d=!0,f=!0,p=!0,m=!0,h=0,v=0,g=!1,y=UT.create(),S=y.view,C=y.position,_=y.direction,x=y.up;function D(z){if(a.has(z))console.warn("RenderObject with id '".concat(z.id,"' already present"));else{var G=function W4e(e,t,r){switch(t.type){case"mesh":return function P4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),I4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",pX,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"points":return function R4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),M4e),s={uObjectId:O.create(t)};return jf(Hf(e,"points",OMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"spheres":return function N4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),B4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",FMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"cylinders":return function j4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),H4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",BMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"text":return function L4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),k4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",NMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"lines":return function F4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),O4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",kMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"direct-volume":return function E4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),D4e);e.isWebGL2||(o.uMaxSteps=Lt("number"));var s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",LMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"image":return function z4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),G4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",UMe,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r);case"texture-mesh":return function V4e(e,t,r,n,a,i){var o=R(R(R(R({},Uf),Vf),Gf),U4e),s={uObjectId:O.create(t)};return jf(Hf(e,"triangles",pX,o,R(R({},r),s),a,i),r,n)}(e,t.id,t.values,t.state,t.materialId,r)}throw new Error("unsupported type")}(r,z,n);i.push(G),"direct-volume"===z.type?c.push(G):u.push(G),a.set(z,G),l=!0,d=!0}}function w(z){var G=a.get(z);G&&(G.dispose(),Lh(i,G),Lh(u,G),Lh(c,G),a.delete(z),l=!0,d=!0)}var I=new _We,M=-1;function N(){var z=function F(){for(var z=23,G=0,J=i.length;G<J;++G)i[G].state.visible&&(z=31*z+i[G].id|0);return-1===(z=Yq(z))&&(z=0),z}();return z!==M&&(d=!0,f=!0,p=!0,m=!0,M=z,!0)}return{view:S,position:C,direction:_,up:x,renderables:i,primitives:{view:S,position:C,direction:_,up:x,renderables:u},volumes:{view:S,position:C,direction:_,up:x,renderables:c},syncVisibility:N,update:function(z,G){var J;if(UT.update(y),z)for(var X=0,Z=z.length;X<Z;++X)null===(J=a.get(z[X]))||void 0===J||J.update();else for(X=0,Z=i.length;X<Z;++X)i[X].update();G?N():(l=!0,d=!0),f=!0,p=!0,m=!0},add:function(z){return I.add(z)},remove:function(z){return I.remove(z)},commit:function(z){return void 0===z&&(z=Number.MAX_VALUE),function E(z){for(var G=ia(),J=0;X=I.tryGetRemove();)if(w(X),++J%100==0&&ia()-G>z)return!1;for(;;){var X;if(!(X=I.tryGetAdd()))break;if(D(X),++J%100==0&&ia()-G>z)return!1}return i.sort(wWe),f=!0,p=!0,m=!0,!0}(z)},get commitQueueSize(){return I.size},get needsCommit(){return!I.isEmpty},has:function(z){return a.has(z)},clear:function(){for(var z=0,G=i.length;z<G;++z)i[z].dispose();i.length=0,u.length=0,c.length=0,a.clear(),l=!0,d=!0},forEach:function(z){a.forEach(z)},get count(){return i.length},get boundingSphere(){return l&&(ure(i,o,!1),l=!1),o},get boundingSphereVisible(){return d&&(ure(i,s,!0),d=!1),s},get markerAverage(){return f&&(h=function j(){if(0===u.length)return 0;for(var z=0,G=0,J=0,X=u.length;J<X;++J)u[J].state.visible&&(G+=u[J].values.markerAverage.ref.value,z+=1);return z>0?G/z:0}(),f=!1),h},get opacityAverage(){return p&&(v=function U(){var z,G;if(0===u.length)return 0;for(var J=0,X=0,Z=0,ne=u.length;Z<ne;++Z){var Y=u[Z];if(Y.state.visible){var k=Xi(Y.values.alpha.ref.value*Y.state.alphaFactor,0,1),W=null!==(z=Y.values.dXrayShaded)&&void 0!==z&&z.ref.value?.5:1,$="fuzzy"===(null===(G=Y.values.dPointStyle)||void 0===G?void 0:G.ref.value)?.5:1;X+=(1-Y.values.transparencyAverage.ref.value)*k*W*$*("text"===Y.values.dGeometryType.ref.value?.5:1),J+=1}}return J>0?X/J:0}(),p=!1),v},get hasOpaque(){return m&&(g=function H(){var z;if(0===u.length)return!1;for(var G=0,J=u.length;G<J;++G){var X=u[G];if(X.state.visible&&(X.state.opaque||1===X.state.alphaFactor&&1===X.values.alpha.ref.value&&1!==X.values.transparencyAverage.ref.value||"opaque"===(null===(z=X.values.dTransparentBackfaces)||void 0===z?void 0:z.ref.value)))return!0}return!1}(),m=!1),g}}}}(xy||(xy={}));var LN=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=za.createDefaultSnapshot(),this._target=za.createDefaultSnapshot(),this._current=za.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){void 0===r&&(r=0),(!this.inTransition||r>0)&&za.copySnapshot(this._source,this.camera.state),this.inTransition||za.copySnapshot(this._target,this.camera.state),za.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode?this.finish(this._target):(this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r))},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){za.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(1===t)return void this.finish(this._target);this.func(this._current,t,this._source,this._target),za.copySnapshot(this.camera.state,this._current)}},e}();!function(e){var t=hn.identity();e.defaultTransition=function r(n,a,i,o){za.copySnapshot(n,o),hn.slerp(t,hn.Identity,hn.rotationTo(t,i.up,o.up),a),b.transformQuat(n.up,i.up,t),b.lerp(n.target,i.target,o.target,a),b.lerp(n.position,i.position,o.position,a),n.radius=ta(i.radius,o.radius,a),n.radiusMax=ta(i.radiusMax,o.radiusMax,a),n.fov=ta(i.fov,o.fov,a),n.fog=ta(i.fog,o.fog,a)}}(LN||(LN={}));var cre=b(),lre=b(),VT=dr(),za=function(){function e(t,r,n){void 0===r&&(r=eo.create(0,0,128,128)),void 0===n&&(n={}),this.view=he.identity(),this.projection=he.identity(),this.projectionView=he.identity(),this.inverseProjectionView=he.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new LN(this),this.stateChanged=new Ai(this.state),this.prevProjection=he.identity(),this.prevView=he.identity(),this.deltaDirection=b(),this.newPosition=b(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return(typeof window<"u"?window.devicePixelRatio:1)*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){b.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){b.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){b.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(0===t.radiusMax)return!1;var r=2*Math.tan(t.fov/2)*b.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,function DWe(e){var t=e.state,r=t.radius,n=t.radiusMax,i=t.fog,s=t.minNear;r<.01&&(r=.01);var c=Math.max(t.clipFar?r:n,t.minFar),l=b.distance(e.position,e.target),d=l-r,f=l+c;(d=Math.max(Math.min(n,s),d))===(f=Math.max(s,f))&&(f=d+.01);var m=l-c*(-(50-i)/50),h=f;e.near=d,e.far=f,e.fogNear=m,e.fogFar=h}(this),this.state.mode){case"orthographic":!function AWe(e){var t=e.viewport,r=e.zoom,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,c=-t.height/2,l=(s-o)/(2*r),d=(u-c)/(2*r),f=(s+o)/2,p=(u+c)/2,m=f-l,h=f+l,v=p+d,g=p-d;if(i.enabled){var y=r/(i.width/i.fullWidth),S=r/(i.height/i.fullHeight),C=(s-o)/i.width,_=(u-c)/i.height;h=(m+=C*(i.offsetX/y))+C*(i.width/y),g=(v-=_*(i.offsetY/S))-_*(i.height/S)}he.ortho(e.projection,m,h,v,g,e.near,e.far),he.lookAt(e.view,e.position,e.target,e.up)}(this);break;case"perspective":!function TWe(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),he.perspective(e.projection,u,u+s,i,i-o,r,n),he.lookAt(e.view,e.position,e.target,e.up)}(this);break;default:Sn()}var n=!he.areEqual(this.projection,this.prevProjection,mn)||!he.areEqual(this.view,this.prevView,mn);if(n){if(he.mul(this.projectionView,this.projection,this.view),!he.tryInvert(this.inverseProjectionView,this.projectionView))return he.copy(this.view,this.prevView),he.copy(this.projection,this.prevProjection),he.mul(this.projectionView,this.projection,this.view),!1;he.copy(this.prevView,this.view),he.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a,i){var o,s,u=Math.max(r,.01),c=this.getTargetDistance(u);b.sub(this.deltaDirection,null!==(o=i?.target)&&void 0!==o?o:this.target,null!==(s=i?.position)&&void 0!==s?s:this.position),a&&b.matchDirection(this.deltaDirection,a,this.deltaDirection),b.setMagnitude(this.deltaDirection,this.deltaDirection,c),b.sub(this.newPosition,t,this.deltaDirection);var l=e.copySnapshot(e.createDefaultSnapshot(),this.state);return l.target=b.clone(t),l.radius=u,l.position=b.clone(this.newPosition),n&&b.matchDirection(l.up,n,l.up),l},e.prototype.getCenter=function(t,r){b.sub(this.deltaDirection,this.target,this.position),b.sub(this.newPosition,t,this.deltaDirection);var n=e.copySnapshot(e.createDefaultSnapshot(),this.state);return n.target=b.clone(t),n.position=b.clone(this.newPosition),r&&(n.radius=Math.max(r,.01)),n},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);b.copy(this.deltaDirection,a),b.setMagnitude(this.deltaDirection,this.deltaDirection,o),b.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=b.clone(t),s.radius=i,s.position=b.clone(this.newPosition),b.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.center=function(t,r){this.setState(this.getCenter(t),r)},e.prototype.project=function(t,r){return function gWe(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;dr.set(Nd,t[0],t[1],t[2],1),dr.transformMat4(Nd,Nd,n);var u=Nd[3];return 0!==u&&(Nd[0]/=u,Nd[1]/=u,Nd[2]/=u),e[0]=(Nd[0]+1)*o*.5+a,e[1]=(Nd[1]+1)*s*.5+i,e[2]=.5*(Nd[2]+1),e[3]=0===u?0:1/u,e}(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return kT(t,r,this.viewport,this.inverseProjectionView)},e.prototype.getPixelSize=function(t){return this.project(VT,t),this.unproject(cre,VT),VT[0]+=1,this.unproject(lre,VT),b.distance(cre,lre)},e}();!function(e){e.ViewOffset=function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}},e.setViewOffset=function r(u,c,l,d,f,p,m){u.fullWidth=c,u.fullHeight=l,u.offsetX=d,u.offsetY=f,u.width=p,u.height=m},e.copyViewOffset=function n(u,c){u.enabled=c.enabled,u.fullWidth=c.fullWidth,u.fullHeight=c.fullHeight,u.offsetX=c.offsetX,u.offsetY=c.offsetY,u.width=c.width,u.height=c.height},e.targetDistance=function a(u,c,l,d,f){var p=Math.max(u,.01),h=f<d?1:d/f;return Math.abs("orthographic"===c?p/h/Math.tan(l/2):p/h/Math.sin(l/2))},e.createDefaultSnapshot=function i(){return{mode:"perspective",fov:Math.PI/4,position:b.create(0,0,100),up:b.create(0,1,0),target:b.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}},e.copySnapshot=function o(u,c){return c&&(typeof c.mode<"u"&&(u.mode=c.mode),typeof c.fov<"u"&&(u.fov=c.fov),typeof c.position<"u"&&b.copy(u.position,c.position),typeof c.up<"u"&&b.copy(u.up,c.up),typeof c.target<"u"&&b.copy(u.target,c.target),typeof c.radius<"u"&&(u.radius=c.radius),typeof c.radiusMax<"u"&&(u.radiusMax=c.radiusMax),typeof c.fog<"u"&&(u.fog=c.fog),typeof c.clipFar<"u"&&(u.clipFar=c.clipFar),typeof c.minNear<"u"&&(u.minNear=c.minNear),typeof c.minFar<"u"&&(u.minFar=c.minFar)),u},e.areSnapshotsEqual=function s(u,c){return u.mode===c.mode&&u.fov===c.fov&&u.radius===c.radius&&u.radiusMax===c.radiusMax&&u.fog===c.fog&&u.clipFar===c.clipFar&&u.minNear===c.minNear&&u.minFar===c.minFar&&b.exactEquals(u.position,c.position)&&b.exactEquals(u.up,c.up)&&b.exactEquals(u.target,c.target)}}(za||(za={}));var UN={sceneBoundingSpheres:T.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:T.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:T.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:T.Boolean(!1,{description:"Show bounding spheres of visible instances."})},EWe=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=xy.create(t,DA),this.parent=r,this._props=R(R({},T.getDefaultValues(UN)),n)}return e.prototype.update=function(){var t=this,r=GT(this.scene,this.parent.boundingSphere,this.sceneData,vr.lightgrey,PWe);r&&(this.sceneData=r);var n=GT(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,vr.black,MWe);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=GT(t.scene,a.values.boundingSphere.ref.value,o,vr.tomato,RWe);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),c=GT(t.scene,a.values.invariantBoundingSphere.ref.value,u,vr.skyblue,OWe,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});c&&t.instancesData.set(i,c)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function GT(e,t,r,n,a,i){if(!r||!Pe.equals(r.boundingSphere,t)){var o=function IWe(e,t){var n=kS(2),a=yt.createState(n,n/2,t);if(e.radius&&(Mi(a,e.center,e.radius,2),Pe.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++)Mi(a,o[i],1,0);return yt.getMesh(a)}(t,r&&r.mesh),s=r?r.renderObject:function FWe(e,t,r,n){return Q0("mesh",Vt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n),{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}(o,n,a,i);return r?O.updateIfChanged(s.values.drawCount,Oi.getDrawCount(o)):e.add(s),{boundingSphere:Pe.clone(t),renderObject:s,mesh:o}}}var PWe=Wf(),MWe=Wf(),RWe=Wf(),OWe=Wf(),xv=function(e){return e[e.Move=0]="Move",e[e.Click=1]="Click",e[e.Drag=2]="Drag",e}(xv||{}),VN=b(),GN=b(),dre=b(),fre={maxFps:T.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:T.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})},BWe=function(){function e(t,r,n,a,i,o){void 0===o&&(o={});var s=this;this.canvasIdentify=t,this.lociGetter=r,this.input=n,this.camera=a,this.controls=i,this.ev=bf.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=lr.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=Ga.create(0),this.button=Ga.create(0),this.modifiers=$u.None,this.props=R(R({},T.getDefaultValues(fre)),o),n.drag.subscribe(function(u){var c=u.x,l=u.y,d=u.buttons,f=u.button,p=u.modifiers;s.isInteracting=!0,s.drag(c,l,d,f,p)}),n.move.subscribe(function(u){var c=u.x,l=u.y,f=u.buttons,p=u.button,m=u.modifiers;if(u.inside&&!s.isInteracting){if(!u.onElement)return void s.leave();s.move(c,l,f,p,m)}}),n.leave.subscribe(function(){s.leave()}),n.click.subscribe(function(u){var c=u.x,l=u.y,d=u.buttons,f=u.button,p=u.modifiers;s.outsideViewport(c,l)||s.click(c,l,d,f,p)}),n.interactionEnd.subscribe(function(){s.isInteracting=!1}),n.modifiers.subscribe(function(u){s.modify(u)})}return e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving;if(t!==xv.Drag){if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a?.id,this.position=a?.position,this.startX=this.endX,this.startY=this.endY}if(t===xv.Click){var i=this.getLoci(this.id,this.position);return this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Be.create(this.endX,this.endY),position:this.position}),void(this.prevLoci=i)}if(this.inside&&this.currentIdentifyT===r&&n&&!this.outsideViewport(this.endX,this.endY)){var o=this.getLoci(this.id,this.position);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Be.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}}else n&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Be.create(this.startX,this.startY),pageEnd:Be.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY)},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?xv.Drag:xv.Move,t))},e.prototype.leave=function(){this.inside=!1,lr.Loci.isEmpty(this.prevLoci)||(this.prevLoci=lr.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(xv.Click,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(xv.Drag,0)},e.prototype.modify=function(t){$u.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Be.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var a=this.input,i=this.camera.viewport;return r*=a.pixelRatio,(t*=a.pixelRatio)>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.getLoci=function(t,r){var n,a=this.lociGetter(t),i=a.repr,o=a.loci;if(r&&i&&zt.isLoci(o)&&2===o.bonds.length){var s=o.bonds[0],u=s.aUnit;u.conformation.position(u.elements[s.aIndex],VN),b.sub(dre,this.camera.state.position,this.camera.state.target),b.projectPointOnPlane(GN,r,dre,VN);var l=this.camera.getPixelSize(GN),d=i.theme.size.size(o.bonds[0])*(null!==(n=i.props.sizeFactor)&&void 0!==n?n:1);if(!1===i.props.lineSizeAttenuation&&(d*=l/2),d+=this.props.preferAtomPixelPadding*l,b.distance(GN,VN)<d)return{repr:i,loci:zt.toFirstStructureElementLoci(o)}}return{repr:i,loci:o}},e.prototype.dispose=function(){this.ev.dispose()},e}(),GWe={edgeThresholdMin:T.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:T.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:T.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:T.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},zWe=function(){function e(t,r){this.webgl=t,this.renderable=function qWe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},bi),{tColor:O.create(t),uTexSizeInv:O.create(Be.create(1/r,1/n)),dEdgeThresholdMin:O.create(.0312),dEdgeThresholdMax:O.create(.125),dIterations:O.create(12),dSubpixelQuality:O.create(.3)}),i=R({},HWe);return Va(Ua(e,"triangles",jWe,i,a),a)}(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){O.update(this.renderable.values.uTexSizeInv,Be.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(O.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),O.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),O.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),O.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),O.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){xt&&this.webgl.timer.mark("FxaaPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),xt&&this.webgl.timer.markEnd("FxaaPass.render")},e}(),HWe=R(R({},yi),{tColor:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Ae("v2"),dEdgeThresholdMin:Lt("number"),dEdgeThresholdMax:Lt("number"),dIterations:Lt("number"),dSubpixelQuality:Lt("number")}),jWe=Fn("fxaa",bo,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\n// adapted from https://github.com/kosua20/Rendu\n// MIT License Copyright (c) 2017 Simon Rodriguez\n\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n\nfloat rgb2luma(vec3 rgb){\n    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));\n}\n\nfloat sampleLuma(vec2 uv) {\n    return rgb2luma(texture2D(tColor, uv).rgb);\n}\n\nfloat sampleLuma(vec2 uv, float uOffset, float vOffset) {\n    uv += uTexSizeInv * vec2(uOffset, vOffset);\n    return sampleLuma(uv);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec2 inverseScreenSize = uTexSizeInv;\n\n    vec4 colorCenter = texture2D(tColor, coords);\n\n    // Luma at the current fragment\n    float lumaCenter = rgb2luma(colorCenter.rgb);\n\n    // Luma at the four direct neighbours of the current fragment.\n    float lumaDown = sampleLuma(coords, 0.0, -1.0);\n    float lumaUp = sampleLuma(coords, 0.0, 1.0);\n    float lumaLeft = sampleLuma(coords, -1.0, 0.0);\n    float lumaRight = sampleLuma(coords, 1.0, 0.0);\n\n    // Find the maximum and minimum luma around the current fragment.\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\n\n    // Compute the delta.\n    float lumaRange = lumaMax - lumaMin;\n\n    // If the luma variation is lower that a threshold (or if we are in a really dark area),\n    // we are not on an edge, don't perform any AA.\n    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {\n        gl_FragColor = colorCenter;\n        return;\n    }\n\n    // Query the 4 remaining corners lumas.\n    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);\n    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);\n    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);\n    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);\n\n    // Combine the four edges lumas (using intermediary variables for future computations\n    // with the same values).\n    float lumaDownUp = lumaDown + lumaUp;\n    float lumaLeftRight = lumaLeft + lumaRight;\n\n    // Same for corners\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\n\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\n\n    // Is the local edge horizontal or vertical ?\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\n\n    // Choose the step size (one pixel) accordingly.\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\n\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\n    // Compute gradients in this direction.\n    float gradient1 = luma1 - lumaCenter;\n    float gradient2 = luma2 - lumaCenter;\n\n    // Which direction is the steepest ?\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\n\n    // Gradient in the corresponding direction, normalized.\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\n\n    // Average luma in the correct direction.\n    float lumaLocalAverage = 0.0;\n    if(is1Steepest){\n        // Switch the direction\n        stepLength = -stepLength;\n        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\n    } else {\n        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\n    }\n\n    // Shift UV in the correct direction by half a pixel.\n    vec2 currentUv = coords;\n    if(isHorizontal){\n        currentUv.y += stepLength * 0.5;\n    } else {\n        currentUv.x += stepLength * 0.5;\n    }\n\n    // Compute offset (for each iteration step) in the right direction.\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\n    // Compute UVs to explore on each side of the edge, orthogonally.\n    // The QUALITY allows us to step faster.\n    vec2 uv1 = currentUv - offset * QUALITY(0);\n    vec2 uv2 = currentUv + offset * QUALITY(0);\n\n    // Read the lumas at both current extremities of the exploration segment,\n    // and compute the delta wrt to the local average luma.\n    float lumaEnd1 = sampleLuma(uv1);\n    float lumaEnd2 = sampleLuma(uv2);\n    lumaEnd1 -= lumaLocalAverage;\n    lumaEnd2 -= lumaLocalAverage;\n\n    // If the luma deltas at the current extremities is larger than the local gradient,\n    // we have reached the side of the edge.\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\n    bool reachedBoth = reached1 && reached2;\n\n    // If the side is not reached, we continue to explore in this direction.\n    if(!reached1){\n        uv1 -= offset * QUALITY(1);\n    }\n    if(!reached2){\n        uv2 += offset * QUALITY(1);\n    }\n\n    // If both sides have not been reached, continue to explore.\n    if(!reachedBoth){\n        for(int i = 2; i < dIterations; i++){\n            // If needed, read luma in 1st direction, compute delta.\n            if(!reached1){\n                lumaEnd1 = sampleLuma(uv1);\n                lumaEnd1 = lumaEnd1 - lumaLocalAverage;\n            }\n            // If needed, read luma in opposite direction, compute delta.\n            if(!reached2){\n                lumaEnd2 = sampleLuma(uv2);\n                lumaEnd2 = lumaEnd2 - lumaLocalAverage;\n            }\n            // If the luma deltas at the current extremities is larger than the local gradient,\n            // we have reached the side of the edge.\n            reached1 = abs(lumaEnd1) >= gradientScaled;\n            reached2 = abs(lumaEnd2) >= gradientScaled;\n            reachedBoth = reached1 && reached2;\n\n            // If the side is not reached, we continue to explore in this direction,\n            // with a variable quality.\n            if(!reached1){\n                uv1 -= offset * QUALITY(i);\n            }\n            if(!reached2){\n                uv2 += offset * QUALITY(i);\n            }\n\n            // If both sides have been reached, stop the exploration.\n            if(reachedBoth){\n                break;\n            }\n        }\n    }\n\n    // Compute the distances to each side edge of the edge (!).\n    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);\n    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);\n\n    // In which direction is the side of the edge closer ?\n    bool isDirection1 = distance1 < distance2;\n    float distanceFinal = min(distance1, distance2);\n\n    // Thickness of the edge.\n    float edgeThickness = (distance1 + distance2);\n\n    // Is the luma at center smaller than the local average ?\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\n\n    // If the luma at center is smaller than at its neighbour,\n    // the delta luma at each end should be positive (same variation).\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\n\n    // Only keep the result in the direction of the closer side of the edge.\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\n\n    // UV offset: read in the direction of the closest side of the edge.\n    float pixelOffset = - distanceFinal / edgeThickness + 0.5;\n\n    // If the luma variation is incorrect, do not offset.\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\n\n    // Sub-pixel shifting\n    // Full weighted average of the luma over the 3x3 neighborhood.\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\n    // Ratio of the delta between the global average and the center luma,\n    // over the luma range in the 3x3 neighborhood.\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\n    // Compute a sub-pixel offset based on this delta.\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);\n\n    // Pick the biggest of the two offsets.\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\n\n    // Compute the final UV coordinates.\n    vec2 finalUv = coords;\n    if(isHorizontal){\n        finalUv.y += finalOffset * stepLength;\n    } else {\n        finalUv.x += finalOffset * stepLength;\n    }\n\n    // Read the color at the new UV coordinates, and use it.\n    gl_FragColor = texture2D(tColor, finalUv);\n}\n"),$We={edgeThreshold:T.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:T.Numeric(16,{min:0,max:32,step:1})},JWe=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u")Cr&&console.log('Missing "HTMLImageElement" required for "SMAA"');else{var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=function rYe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},bi),{tColor:O.create(t),uTexSizeInv:O.create(Be.create(1/r,1/n)),uViewport:O.create(dr()),dEdgeThreshold:O.create(.1)}),i=R({},eYe);return Va(Ua(e,"triangles",tYe,i,a),a)}(t,r),this.weightsRenderable=function iYe(e,t){var r=t.getWidth(),n=t.getHeight(),a=e.resources.texture("image-uint8","rgb","ubyte","linear"),i=e.resources.texture("image-uint8","rgba","ubyte","nearest"),o=R(R({},bi),{tEdges:O.create(t),tArea:O.create(a),tSearch:O.create(i),uTexSizeInv:O.create(Be.create(1/r,1/n)),uViewport:O.create(dr()),dMaxSearchSteps:O.create(16)});GX("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=",o.tArea,a),GX("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=",o.tSearch,i);var s=R({},nYe);return Va(Ua(e,"triangles",aYe,s,o),o)}(t,this.edgesTarget.texture),this.blendRenderable=function uYe(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=R(R({},bi),{tColor:O.create(t),tWeights:O.create(r),uTexSizeInv:O.create(Be.create(1/n,1/a)),uViewport:O.create(dr())}),o=R({},oYe);return Va(Ua(e,"triangles",sYe,o,i),i)}(t,r,this.weightsTarget.texture),this._supported=!0}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),O.update(this.edgesRenderable.values.uViewport,eo.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),O.update(this.weightsRenderable.values.uViewport,eo.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),O.update(this.blendRenderable.values.uViewport,eo.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),O.update(this.edgesRenderable.values.uTexSizeInv,Be.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),O.update(this.weightsRenderable.values.uTexSizeInv,Be.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),O.update(this.blendRenderable.values.uTexSizeInv,Be.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(O.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(O.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(O.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(O.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){xt&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render(),xt&&this.webgl.timer.markEnd("SmaaPass.render")},e}(),eYe=R(R({},yi),{tColor:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Ae("v2"),uViewport:Ae("v4"),dEdgeThreshold:Lt("number")}),tYe=Fn("smaa-edges","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvoid SMAAEdgeDetectionVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAAEdgeDetectionVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {\n    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);\n\n    // Calculate color deltas:\n    vec4 delta;\n    vec3 C = texture2D(colorTex, texcoord).rgb;\n\n    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;\n    vec3 t = abs(C - Cleft);\n    delta.x = max(max(t.r, t.g), t.b);\n\n    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;\n    t = abs(C - Ctop);\n    delta.y = max(max(t.r, t.g), t.b);\n\n    // We do the usual threshold:\n    vec2 edges = step(threshold, delta.xy);\n\n    // Then discard if there is no edge:\n    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)\n        discard;\n\n    // Calculate right and bottom deltas:\n    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;\n    t = abs( C - Cright );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;\n    t = abs(C - Cbottom);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the maximum delta in the direct neighborhood:\n    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );\n\n    // Calculate left-left and top-top deltas:\n    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;\n    t = abs( C - Cleftleft );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;\n    t = abs(C - Ctoptop);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the final maximum delta:\n    maxDelta = max(max(maxDelta, delta.z), delta.w);\n\n    // Local contrast adaptation in action:\n    edges.xy *= step(0.5 * maxDelta, delta.xy);\n\n    return vec4(edges, 0.0, 0.0);\n}\n\nvoid main() {\n    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);\n}\n"),nYe=R(R({},yi),{tEdges:Xt("texture","rgba","ubyte","linear"),tArea:Xt("texture","rgb","ubyte","linear"),tSearch:Xt("texture","rgba","ubyte","nearest"),uTexSizeInv:Ae("v2"),uViewport:Ae("v4"),dMaxSearchSteps:Lt("number")}),aYe=Fn("smaa-weights","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\nvoid SMAABlendingWeightCalculationVS(vec2 texCoord) {\n    vPixCoord = texCoord / uTexSizeInv;\n\n    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components\n\n    // And these for the searches, they indicate the ends of the loops:\n    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAABlendingWeightCalculationVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)\n\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))\n#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)\n\nuniform sampler2D tEdges;\nuniform sampler2D tArea;\nuniform sampler2D tSearch;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\n#if __VERSION__ == 100\n    vec2 round(vec2 x) {\n        return sign(x) * floor(abs(x) + 0.5);\n    }\n#endif\n\nfloat SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {\n    // Not required if searchTex accesses are set to point:\n    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n    e.r = bias + e.r * scale;\n    return 255.0 * texture2D(searchTex, e, 0.0).r;\n}\n\nfloat SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    /**\n     * @PSEUDO_GATHER4\n     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to\n     * sample between edge, thus fetching four edges in a row.\n     * Sampling with different offsets in each direction allows to disambiguate\n     * which edges are active from the four fetched ones.\n     */\n    vec2 e = vec2(0.0, 1.0);\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D( edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    // We correct the previous (-0.25, -0.125) offset we applied:\n    texCoord.x += 0.25 * uTexSizeInv.x;\n\n    // The searches are bias by 1, so adjust the coords accordingly:\n    texCoord.x += uTexSizeInv.x;\n\n    // Disambiguate the length added by the last step:\n    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step\n    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n    return texCoord.x;\n}\n\nfloat SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 0.0, 1.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    texCoord.x -= 0.25 * uTexSizeInv.x;\n    texCoord.x -= uTexSizeInv.x;\n    texCoord.x -= 2.0 * uTexSizeInv.x;\n    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n    return texCoord.x;\n}\n\nfloat SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nfloat SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nvec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {\n    // Rounding prevents precision errors of bilinear filtering:\n    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;\n\n    // We do a scale and bias for mapping to texel space:\n    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);\n\n    // Move to proper place, according to the subpixel offset:\n    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n    return texture2D(areaTex, texCoord, 0.0).rg;\n}\n\nvec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {\n    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 e = texture2D(edgesTex, texCoord).rg;\n\n    if (e.g > 0.0) { // Edge at north\n        vec2 d;\n\n        // Find the distance to the left:\n        vec2 coords;\n        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );\n        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)\n        d.x = coords.x;\n\n        // Now fetch the left crossing edges, two at a time using bilinear\n        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n        // discern what value each edge has:\n        float e1 = texture2D(edgesTex, coords, 0.0).r;\n\n        // Find the distance to the right:\n        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);\n        d.y = coords.x;\n\n        // We want the distances to be in pixel units (doing this here allow to\n        // better interleave arithmetic and memory accesses):\n        d = d / uTexSizeInv.x - pixCoord.x;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the right crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;\n\n        // Ok, we know how this pattern looks like, now it is time for getting\n        // the actual area:\n        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));\n    }\n\n    if (e.r > 0.0) { // Edge at west\n        vec2 d;\n\n        // Find the distance to the top:\n        vec2 coords;\n\n        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );\n        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;\n        d.x = coords.y;\n\n        // Fetch the top crossing edges:\n        float e1 = texture2D(edgesTex, coords, 0.0).g;\n\n        // Find the distance to the bottom:\n        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);\n        d.y = coords.y;\n\n        // We want the distances to be in pixel units:\n        d = d / uTexSizeInv.y - pixCoord.y;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the bottom crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;\n\n        // Get the area for this direction:\n        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));\n    }\n\n    return weights;\n}\n\nvoid main() {\n    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));\n}\n"),oYe=R(R({},yi),{tColor:Xt("texture","rgba","ubyte","linear"),tWeights:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Ae("v2"),uViewport:Ae("v4")}),sYe=Fn("smaa-blend","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvoid SMAANeighborhoodBlendingVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAANeighborhoodBlendingVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tWeights;\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {\n    // Fetch the blending weights for current pixel:\n    vec4 a;\n    a.xz = texture2D(blendTex, texCoord).xz;\n    a.y = texture2D(blendTex, offset[1].zw).g;\n    a.w = texture2D(blendTex, offset[1].xy).a;\n\n    // Is there any blending weight with a value greater than 0.0?\n    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {\n        return texture2D(colorTex, texCoord, 0.0);\n    } else {\n        // Up to 4 lines can be crossing a pixel (one through each edge). We\n        // favor blending by choosing the line with the maximum weight for each\n        // direction:\n        vec2 offset;\n        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n        // Then we go in the direction that has the maximum weight:\n        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical\n            offset.y = 0.0;\n        } else {\n            offset.x = 0.0;\n        }\n\n        // Fetch the opposite color and lerp by hand:\n        vec4 C = texture2D(colorTex, texCoord, 0.0);\n        texCoord += sign(offset) * uTexSizeInv;\n        vec4 Cop = texture2D(colorTex, texCoord, 0.0);\n        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);\n\n        // WebGL port note: Added gamma correction\n        C.xyz = pow(C.xyz, vec3(2.2));\n        Cop.xyz = pow(Cop.xyz, vec3(2.2));\n        vec4 mixed = mix(C, Cop, s);\n        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n        return mixed;\n    }\n}\n\nvoid main() {\n    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);\n}\n"),pre={opacity:T.Numeric(1,{min:0,max:1,step:.01}),saturation:T.Numeric(0,{min:-1,max:1,step:.01}),lightness:T.Numeric(0,{min:-1,max:1,step:.01})},pYe=R({faces:T.MappedStatic("urls",{urls:T.Group({nx:T.Text("",{label:"Negative X / Left"}),ny:T.Text("",{label:"Negative Y / Bottom"}),nz:T.Text("",{label:"Negative Z / Back"}),px:T.Text("",{label:"Positive X / Right"}),py:T.Text("",{label:"Positive Y / Top"}),pz:T.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:T.Group({nx:T.File({label:"Negative X / Left",accept:"image/*"}),ny:T.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:T.File({label:"Negative Z / Back",accept:"image/*"}),px:T.File({label:"Positive X / Right",accept:"image/*"}),py:T.File({label:"Positive Y / Top",accept:"image/*"}),pz:T.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:T.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'})},pre),mYe=R(R({source:T.MappedStatic("url",{url:T.Text(""),file:T.File({accept:"image/*"})}),blur:T.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'})},pre),{coverage:T.Select("viewport",T.arrayToOptions(["viewport","canvas"]))}),hYe={topColor:T.Color(dt(14540253)),bottomColor:T.Color(dt(15658734)),ratio:T.Numeric(.5,{min:0,max:1,step:.01}),coverage:T.Select("viewport",T.arrayToOptions(["viewport","canvas"]))},vYe={centerColor:T.Color(dt(14540253)),edgeColor:T.Color(dt(15658734)),ratio:T.Numeric(.5,{min:0,max:1,step:.01}),coverage:T.Select("viewport",T.arrayToOptions(["viewport","canvas"]))},gYe={variant:T.MappedStatic("off",{off:T.EmptyGroup(),skybox:T.Group(pYe,{isExpanded:!0}),image:T.Group(mYe,{isExpanded:!0}),horizontalGradient:T.Group(hYe,{isExpanded:!0}),radialGradient:T.Group(vYe,{isExpanded:!0})},{label:"Environment"})},yYe=function(){function e(t,r,n,a){this.webgl=t,this.assetManager=r,this.camera=new za,this.target=b(),this.position=b(),this.dir=b(),this.renderable=function DYe(e,t,r){var n={drawCount:O.create(6),instanceCount:O.create(1),aPosition:O.create(v4),tSkybox:O.create(Ao()),tImage:O.create(Ao()),uImageScale:O.create(Be()),uImageOffset:O.create(Be()),uTexSize:O.create(Be.create(t,r)),uViewport:O.create(dr()),uViewportAdjusted:O.create(!0),uViewDirectionProjectionInverse:O.create(he()),uGradientColorA:O.create(b()),uGradientColorB:O.create(b()),uGradientRatio:O.create(.5),uBlur:O.create(0),uOpacity:O.create(1),uSaturation:O.create(0),uLightness:O.create(0),dVariant:O.create("skybox")},a=R({},AYe);return Va(Ua(e,"triangles",TYe,a,n),n)}(t,n,a)}return e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value;(t!==n[0]||r!==n[1])&&O.update(this.renderable.values.uTexSize,Be.set(this.renderable.values.uTexSize.ref.value,t,r))},e.prototype.clearSkybox=function(){var t=this;void 0!==this.skybox&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(function(r){return t.assetManager.release(r)}),this.skybox=void 0)},e.prototype.updateSkybox=function(t,r,n){var i,a=this,o=null===(i=this.skybox)||void 0===i?void 0:i.props.faces,s=r.faces.params;if(!(s.nx&&s.ny&&s.nz&&s.px&&s.py&&s.pz))return this.clearSkybox(),void n?.(!1);if(this.skybox&&o&&function CYe(e,t){return hre(e)===hre(t)}(r.faces,this.skybox.props.faces))n?.(!1);else{this.clearSkybox();var u=function xYe(e,t,r,n){var a=function bYe(e,t){return"urls"===t.name?{nx:dn.getUrlAsset(e,t.params.nx),ny:dn.getUrlAsset(e,t.params.ny),nz:dn.getUrlAsset(e,t.params.nz),px:dn.getUrlAsset(e,t.params.px),py:dn.getUrlAsset(e,t.params.py),pz:dn.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}(t,r),i=function SYe(e,t){var r=function(n){return e.resolve(n,"binary").run().then(function(a){return new Blob([a.data])})};return{nx:r(t.nx),ny:r(t.ny),nz:r(t.nz),px:r(t.px),py:r(t.py),pz:r(t.pz)}}(t,a),o=[a.nx,a.ny,a.nz,a.px,a.py,a.pz];return typeof HTMLImageElement>"u"?(console.error('Missing "HTMLImageElement" required for background skybox'),n?.(!0),{texture:Ao(),assets:o}):{texture:e.resources.cubeTexture(i,!0,n),assets:o}}(this.webgl,this.assetManager,r.faces,function(p){a.skybox&&(a.skybox.loaded=!p),n?.(!0)}),c=u.texture,l=u.assets;this.skybox={texture:c,props:R({},r),assets:l,loaded:!1},O.update(this.renderable.values.tSkybox,c),this.renderable.update()}if(this.skybox){var d=t;"orthographic"===t.state.mode&&(this.camera.setState(R(R({},t.state),{mode:"perspective"})),this.camera.update(),d=this.camera);var f=this.renderable.values.uViewDirectionProjectionInverse.ref.value;b.sub(this.dir,d.state.position,d.state.target),b.setMagnitude(this.dir,this.dir,.1),b.copy(this.position,this.dir),he.lookAt(f,this.position,this.target,d.state.up),he.mul(f,d.projection,f),he.invert(f,f),O.update(this.renderable.values.uViewDirectionProjectionInverse,f),O.updateIfChanged(this.renderable.values.uBlur,r.blur),O.updateIfChanged(this.renderable.values.uOpacity,r.opacity),O.updateIfChanged(this.renderable.values.uSaturation,r.saturation),O.updateIfChanged(this.renderable.values.uLightness,r.lightness),O.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}},e.prototype.clearImage=function(){void 0!==this.image&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)},e.prototype.updateImage=function(t,r){var n=this;if(!t.source.params)return this.clearImage(),void r?.(!1);if(this.image&&this.image.props.source.params&&function _Ye(e,t){return gre(e)===gre(t)}(t.source,this.image.props.source))r?.(!1);else{this.clearImage();var a=function wYe(e,t,r,n){var a="url"===r.name?dn.getUrlAsset(t,r.params):r.params;if(typeof HTMLImageElement>"u")return console.error('Missing "HTMLImageElement" required for background image'),n?.(!0),{texture:Ao(),asset:a};var i=e.resources.texture("image-uint8","rgba","ubyte","linear"),o=new Image;return o.onload=function(){i.load(o),(e.isWebGL2||nS(o.width)&&nS(o.height))&&i.mipmap(),n?.()},o.onerror=function(){n?.(!0)},t.resolve(a,"binary").run().then(function(s){var u=new Blob([s.data]);o.src=URL.createObjectURL(u)}),{texture:i,asset:a}}(this.webgl,this.assetManager,t.source,function(s){n.image&&(n.image.loaded=!s),r?.(!0)}),i=a.texture,o=a.asset;this.image={texture:i,props:R({},t),asset:o,loaded:!1},O.update(this.renderable.values.tImage,i),this.renderable.update()}this.image&&(O.updateIfChanged(this.renderable.values.uBlur,t.blur),O.updateIfChanged(this.renderable.values.uOpacity,t.opacity),O.updateIfChanged(this.renderable.values.uSaturation,t.saturation),O.updateIfChanged(this.renderable.values.uLightness,t.lightness),O.updateIfChanged(this.renderable.values.uViewportAdjusted,"viewport"===t.coverage),O.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())},e.prototype.updateImageScaling=function(){var t,r,n=this.renderable.values,a=n.uTexSize.ref.value,i=a[0],o=a[1],s=(null===(t=this.image)||void 0===t?void 0:t.texture.getWidth())||0,u=(null===(r=this.image)||void 0===r?void 0:r.texture.getHeight())||0,c=i/o;O.update(n.uImageScale,c<s/u?Be.set(n.uImageScale.ref.value,s*o/u,o):Be.set(n.uImageScale.ref.value,i,u*i/s));var d=n.uImageScale.ref.value,m=d[0]/d[1];O.update(n.uImageOffset,m>c?Be.set(n.uImageOffset.ref.value,(1-c/m)/2,0):Be.set(n.uImageOffset.ref.value,0,(1-m/c)/2))},e.prototype.updateGradient=function(t,r,n,a,i){O.update(this.renderable.values.uGradientColorA,dt.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,t)),O.update(this.renderable.values.uGradientColorB,dt.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,r)),O.updateIfChanged(this.renderable.values.uGradientRatio,n),O.updateIfChanged(this.renderable.values.uViewportAdjusted,i),O.updateIfChanged(this.renderable.values.dVariant,a),this.renderable.update()},e.prototype.update=function(t,r,n){if("off"===r.variant.name)return this.clearSkybox(),this.clearImage(),void n?.(!1);"skybox"===r.variant.name?(this.clearImage(),this.updateSkybox(t,r.variant.params,n)):"image"===r.variant.name?(this.clearSkybox(),this.updateImage(r.variant.params,n)):"horizontalGradient"===r.variant.name?(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.topColor,r.variant.params.bottomColor,r.variant.params.ratio,r.variant.name,"viewport"===r.variant.params.coverage),n?.(!1)):"radialGradient"===r.variant.name&&(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.centerColor,r.variant.params.edgeColor,r.variant.params.ratio,r.variant.name,"viewport"===r.variant.params.coverage),n?.(!1));var a=t.viewport;O.update(this.renderable.values.uViewport,dr.set(this.renderable.values.uViewport.ref.value,a.x,a.y,a.width,a.height))},e.prototype.isEnabled=function(t){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===t.variant.name||"radialGradient"===t.variant.name)},e.prototype.isReady=function(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===this.renderable.values.dVariant.ref.value||"radialGradient"===this.renderable.values.dVariant.ref.value)},e.prototype.render=function(){this.isReady()&&("image"===this.renderable.values.dVariant.ref.value&&this.updateImageScaling(),xt&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),xt&&this.webgl.timer.markEnd("BackgroundPass.render"))},e.prototype.dispose=function(){this.clearSkybox(),this.clearImage()},e}(),mre="background-skybox";function hre(e){var t,r,n,a,i,o;return"urls"===e.name?"".concat(mre,"_").concat(e.params.nx,"|").concat(e.params.ny,"|").concat(e.params.nz,"|").concat(e.params.px,"|").concat(e.params.py,"|").concat(e.params.pz):"".concat(mre,"_").concat(null===(t=e.params.nx)||void 0===t?void 0:t.id,"|").concat(null===(r=e.params.ny)||void 0===r?void 0:r.id,"|").concat(null===(n=e.params.nz)||void 0===n?void 0:n.id,"|").concat(null===(a=e.params.px)||void 0===a?void 0:a.id,"|").concat(null===(i=e.params.py)||void 0===i?void 0:i.id,"|").concat(null===(o=e.params.pz)||void 0===o?void 0:o.id)}var vre="background-image";function gre(e){var t;return"url"===e.name?"".concat(vre,"_").concat(e.params):"".concat(vre,"_").concat(null===(t=e.params)||void 0===t?void 0:t.id)}var AYe={drawCount:oa("number"),instanceCount:oa("number"),aPosition:Tn("float32",2,0),tSkybox:Xt("texture","rgba","ubyte","linear"),tImage:Xt("texture","rgba","ubyte","linear"),uImageScale:Ae("v2"),uImageOffset:Ae("v2"),uTexSize:Ae("v2"),uViewport:Ae("v4"),uViewportAdjusted:Ae("b"),uViewDirectionProjectionInverse:Ae("m4"),uGradientColorA:Ae("v3"),uGradientColorB:Ae("v3"),uGradientRatio:Ae("f"),uBlur:Ae("f"),uOpacity:Ae("f"),uSaturation:Ae("f"),uLightness:Ae("f"),dVariant:Lt("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},TYe=Fn("background","\nprecision mediump float;\n\nattribute vec2 aPosition;\n\nvarying vec4 vPosition;\n\nvoid main() {\n    vPosition = vec4(aPosition, 1.0, 1.0);\n    gl_Position = vec4(aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\nprecision mediump samplerCube;\nprecision mediump sampler2D;\n\n#if defined(dVariant_skybox)\n    uniform samplerCube tSkybox;\n    uniform mat4 uViewDirectionProjectionInverse;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_image)\n    uniform sampler2D tImage;\n    uniform vec2 uImageScale;\n    uniform vec2 uImageOffset;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)\n    uniform vec3 uGradientColorA;\n    uniform vec3 uGradientColorB;\n    uniform float uGradientRatio;\n#endif\n\nuniform vec2 uTexSize;\nuniform vec4 uViewport;\nuniform bool uViewportAdjusted;\nvarying vec4 vPosition;\n\n// TODO: add as general pp option to remove banding?\n// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\nvec3 ScreenSpaceDither(vec2 vScreenPos) {\n    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));\n    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));\n    return vDither.rgb / 255.0;\n}\n\nvec3 saturateColor(vec3 c, float amount) {\n    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(c, W));\n    return mix(intensity, c, 1.0 + amount);\n}\n\nvec3 lightenColor(vec3 c, float amount) {\n    return c + amount;\n}\n\nvoid main() {\n    #if defined(dVariant_skybox)\n        vec4 t = uViewDirectionProjectionInverse * vPosition;\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = textureCubeLodEXT(tSkybox, normalize(t.xyz / t.w), uBlur * 8.0);\n        #else\n            gl_FragColor = textureCube(tSkybox, normalize(t.xyz / t.w));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_image)\n        vec2 coords;\n        if (uViewportAdjusted) {\n            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;\n        } else {\n            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;\n        }\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);\n        #else\n            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_horizontalGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        } else {\n            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #elif defined(dVariant_radialGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;\n        } else {\n            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #endif\n}\n",{shaderTextureLod:"optional"}),PYe={sharpness:T.Numeric(.5,{min:0,max:1,step:.05}),denoise:T.Boolean(!0)},MYe=function(){function e(t,r){this.webgl=t,this.renderable=function FYe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},bi),{tColor:O.create(t),uTexSizeInv:O.create(Be.create(1/r,1/n)),uSharpness:O.create(.5),dDenoise:O.create(!0)}),i=R({},RYe);return Va(Ua(e,"triangles",OYe,i,a),a)}(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){O.update(this.renderable.values.uTexSizeInv,Be.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.sharpness,i=r.denoise,o=!1;n.tColor.ref.value!==t&&(O.update(this.renderable.values.tColor,t),o=!0),O.updateIfChanged(n.uSharpness,2-2*Math.pow(a,.25)),n.dDenoise.ref.value!==i&&(o=!0),O.updateIfChanged(n.dDenoise,i),o&&this.renderable.update()},e.prototype.render=function(t,r){xt&&this.webgl.timer.mark("CasPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),xt&&this.webgl.timer.markEnd("CasPass.render")},e}(),RYe=R(R({},yi),{tColor:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Ae("v2"),uSharpness:Ae("f"),dDenoise:Lt("boolean")}),OYe=Fn("cas",bo,"\nprecision mediump float;\nprecision mediump sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nuniform float uSharpness;\n\n// adapted from https://www.shadertoy.com/view/stXSWB\n\n/*\n* FidelityFX Super Resolution scales up a low resolution\n* image, while adding fine detail.\n*\n* MIT Open License\n*\n* https://gpuopen.com/fsr\n*\n* Left: FSR processed\n* Right: Original texture, bilinear interpolation\n*\n* Mouse at top: Sharpness 0 stops (maximum)\n* Mouse at bottom: Sharpness 2 stops (minimum)\n*\n* It works in two passes-\n*   EASU upsamples the image with a clamped Lanczos kernel.\n*   RCAS sharpens the image at the target resolution.\n*\n* I needed to make a few changes to improve readability and\n* WebGL compatibility in an algorithm I don't fully understand.\n* Expect bugs.\n*\n* Shader not currently running for WebGL1 targets (eg. mobile Safari)\n*\n* There is kind of no point to using FSR in Shadertoy, as it renders buffers\n* at full target resolution. But this might be useful for WebGL based demos\n* running smaller-than-target render buffers.\n*\n* For sharpening with a full resolution render buffer,\n* FidelityFX CAS is a better option.\n* https://www.shadertoy.com/view/ftsXzM\n*\n* For readability and compatibility, these optimisations have been removed:\n*   * Fast approximate inverse and inversesqrt\n*   * textureGather fetches (not WebGL compatible)\n*   * Multiplying by reciprocal instead of division\n*\n* Apologies to AMD for the numerous slowdowns and errors I have introduced.\n*\n*/\n\n/***** RCAS *****/\n#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))\n\n// Input callback prototypes that need to be implemented by calling shader\nvec4 FsrRcasLoadF(vec2 p);\n//------------------------------------------------------------------------------------------------------------------------------\nvoid FsrRcasCon(\n    out float con,\n    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.\n    float sharpness\n) {\n    // Transform from stops to linear value.\n    con = exp2(-sharpness);\n}\n\nvec3 FsrRcasF(\n    vec2 ip, // Integer pixel position in output.\n    float con\n) {\n    // Constant generated by RcasSetup().\n    // Algorithm uses minimal 3x3 pixel neighborhood.\n    //    b\n    //  d e f\n    //    h\n    vec2 sp = vec2(ip);\n    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;\n    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;\n    vec3 e = FsrRcasLoadF(sp).rgb;\n    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;\n    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;\n\n    // Luma times 2.\n    float bL = b.g + .5 * (b.b + b.r);\n    float dL = d.g + .5 * (d.b + d.r);\n    float eL = e.g + .5 * (e.b + e.r);\n    float fL = f.g + .5 * (f.b + f.r);\n    float hL = h.g + .5 * (h.b + h.r);\n\n    // Noise detection.\n    #ifdef dDenoise\n        float nz = .25 * (bL + dL + fL + hL) - eL;\n        nz=clamp(\n            abs(nz)\n            /(\n                max(max(bL,dL),max(eL,max(fL,hL)))\n                -min(min(bL,dL),min(eL,min(fL,hL)))\n            ),\n            0., 1.\n        );\n        nz=1.-.5*nz;\n    #endif\n\n    // Min and max of ring.\n    vec3 mn4 = min(b, min(f, h));\n    vec3 mx4 = max(b, max(f, h));\n\n    // Immediate constants for peak range.\n    vec2 peakC = vec2(1., -4.);\n\n    // Limiters, these need to be high precision RCPs.\n    vec3 hitMin = mn4 / (4. * mx4);\n    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);\n    vec3 lobeRGB = max(-hitMin, hitMax);\n    float lobe = max(\n        -FSR_RCAS_LIMIT,\n        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)\n    )*con;\n\n    // Apply noise removal.\n    #ifdef dDenoise\n        lobe *= nz;\n    #endif\n\n    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.\n    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);\n}\n\n\nvec4 FsrRcasLoadF(vec2 p) {\n    return texture2D(tColor, p * uTexSizeInv);\n}\n\nvoid main() {\n    // Set up constants\n    float con;\n    FsrRcasCon(con, uSharpness);\n\n    // Perform RCAS pass\n    vec3 col = FsrRcasF(gl_FragCoord.xy, con);\n\n    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);\n}\n"),BYe=R(R({},yi),{tDepthOpaque:Xt("texture","rgba","ubyte","nearest"),tDepthTransparent:Xt("texture","rgba","ubyte","nearest"),uTexSize:Ae("v2"),dOrthographic:Lt("number"),uNear:Ae("f"),uFar:Ae("f"),uInvProjection:Ae("m4"),uOutlineThreshold:Ae("f"),dTransparentOutline:Lt("boolean")}),kYe=R(R({},yi),{tDepth:Xt("texture","rgba","ubyte","nearest"),uTexSize:Ae("v2"),uProjection:Ae("m4"),uInvProjection:Ae("m4"),uBounds:Ae("v4"),dOrthographic:Lt("number"),uNear:Ae("f"),uFar:Ae("f"),dSteps:Lt("number"),uMaxDistance:Ae("f"),uTolerance:Ae("f"),uBias:Ae("f"),uLightDirection:Ae("v3[]"),uLightColor:Ae("v3[]"),dLightCount:Lt("number")}),UYe=R(R({},yi),{tDepth:Xt("texture","rgba","ubyte","nearest"),tDepthHalf:Xt("texture","rgba","ubyte","nearest"),tDepthQuarter:Xt("texture","rgba","ubyte","nearest"),uSamples:Ae("v3[]"),dNSamples:Lt("number"),uProjection:Ae("m4"),uInvProjection:Ae("m4"),uBounds:Ae("v4"),uTexSize:Ae("v2"),uRadius:Ae("f"),uBias:Ae("f"),dMultiScale:Lt("boolean"),dLevels:Lt("number"),uLevelRadius:Ae("f[]"),uLevelBias:Ae("f[]"),uNearThreshold:Ae("f"),uFarThreshold:Ae("f")}),GYe=R(R({},yi),{tSsaoDepth:Xt("texture","rgba","ubyte","nearest"),uTexSize:Ae("v2"),uKernel:Ae("f[]"),dOcclusionKernelSize:Lt("number"),uBlurDirectionX:Ae("f"),uBlurDirectionY:Ae("f"),uInvProjection:Ae("m4"),uNear:Ae("f"),uFar:Ae("f"),uBounds:Ae("v4"),dOrthographic:Lt("number")});function yre(e,t,r){var n=R(R({},bi),{tSsaoDepth:O.create(t),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight())),uKernel:O.create(bre(15)),dOcclusionKernelSize:O.create(15),uBlurDirectionX:O.create("horizontal"===r?1:0),uBlurDirectionY:O.create("vertical"===r?1:0),uInvProjection:O.create(he.identity()),uNear:O.create(0),uFar:O.create(1e4),uBounds:O.create(dr()),dOrthographic:O.create(0)}),a=R({},GYe);return Va(Ua(e,"triangles",Fn("ssao_blur",bo,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uKernel[dOcclusionKernelSize];\n\nuniform float uBlurDirectionX;\nuniform float uBlurDirectionY;\n\nuniform mat4 uInvProjection;\nuniform float uNear;\nuniform float uFar;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;\n\n    if (outsideBounds(coords)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfDepth = unpackRGToUnitInterval(packedDepth);\n    // if background and if second pass\n    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfViewZ = getViewZ(selfDepth);\n    float pixelSize = getPixelSize(coords, selfDepth);\n    float maxDiffViewZ = pixelSize * 10.0;\n\n    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;\n\n    float sum = 0.0;\n    float kernelSum = 0.0;\n    // only if kernelSize is odd\n    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {\n        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;\n\n        vec2 sampleCoords = coords + float(i) * offset;\n        if (outsideBounds(sampleCoords)) {\n            continue;\n        }\n\n        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);\n\n        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);\n        if (isBackground(sampleDepth)) {\n            continue;\n        }\n\n        if (abs(float(i)) > 1.0) {\n            float sampleViewZ = getViewZ(sampleDepth);\n            if (abs(selfViewZ - sampleViewZ) > maxDiffViewZ) {\n                continue;\n            }\n        }\n\n        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1\n        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);\n\n        sum += kernel * sampleValue;\n        kernelSum += kernel;\n    }\n\n    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);\n}\n"),a,n),n)}function bre(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}for(var zT=[],Sre=0;Sre<256;Sre++){var Im=b();Im[0]=2*Math.random()-1,Im[1]=2*Math.random()-1,Im[2]=Math.random(),b.normalize(Im,Im),b.scale(Im,Im,Math.random()),zT.push(Im)}function Cre(e){for(var t=[],r=0;r<e;r++){var n=(r*r+2*r+1)/(e*e);t.push(zT[r][0]*(n=.1+.9*n)),t.push(zT[r][1]*n),t.push(zT[r][2]*n)}return t}var zYe=R(R({},yi),{tSsaoDepth:Xt("texture","rgba","ubyte","nearest"),tColor:Xt("texture","rgba","ubyte","nearest"),tDepthOpaque:Xt("texture","rgba","ubyte","nearest"),tDepthTransparent:Xt("texture","rgba","ubyte","nearest"),tShadows:Xt("texture","rgba","ubyte","nearest"),tOutlines:Xt("texture","rgba","ubyte","nearest"),uTexSize:Ae("v2"),dOrthographic:Lt("number"),uNear:Ae("f"),uFar:Ae("f"),uFogNear:Ae("f"),uFogFar:Ae("f"),uFogColor:Ae("v3"),uOutlineColor:Ae("v3"),uOcclusionColor:Ae("v3"),uTransparentBackground:Ae("b"),dOcclusionEnable:Lt("boolean"),uOcclusionOffset:Ae("v2"),dShadowEnable:Lt("boolean"),dOutlineEnable:Lt("boolean"),dOutlineScale:Lt("number"),dTransparentOutline:Lt("boolean")}),xre={occlusion:T.MappedStatic("on",{on:T.Group({samples:T.Numeric(32,{min:1,max:256,step:1}),multiScale:T.MappedStatic("off",{on:T.Group({levels:T.ObjectList({radius:T.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:T.Numeric(1,{min:0,max:3,step:.1})},function(e){return"".concat(e.radius,", ").concat(e.bias)},{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:T.Numeric(10,{min:0,max:50,step:1}),farThreshold:T.Numeric(1500,{min:0,max:1e4,step:100})}),off:T.Group({})},{cycle:!0}),radius:T.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:function(e){return"on"===e?.multiScale.name}}),bias:T.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:T.Numeric(15,{min:1,max:25,step:2}),resolutionScale:T.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:T.Color(dt(0))}),off:T.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),shadow:T.MappedStatic("off",{on:T.Group({steps:T.Numeric(1,{min:1,max:64,step:1}),bias:T.Numeric(.6,{min:0,max:1,step:.01}),maxDistance:T.Numeric(3,{min:0,max:256,step:1}),tolerance:T.Numeric(1,{min:0,max:10,step:.1})}),off:T.Group({})},{cycle:!0,description:"Simplistic shadows"}),outline:T.MappedStatic("off",{on:T.Group({scale:T.Numeric(1,{min:1,max:5,step:1}),threshold:T.Numeric(.33,{min:.01,max:1,step:.01}),color:T.Color(dt(0)),includeTransparent:T.Boolean(!0,{description:"Whether to show outline for transparent objects"})}),off:T.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:T.MappedStatic("smaa",{fxaa:T.Group(GWe),smaa:T.Group($We),off:T.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"}),sharpening:T.MappedStatic("off",{on:T.Group(PYe),off:T.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening"}),background:T.Group(gYe,{isFlat:!0})},zs=function(){function e(t,r,n){this.webgl=t,this.drawPass=n,this.bgColor=b(),this.occlusionOffset=[0,0],this.transparentBackground=!1;var a=n.colorTarget,i=n.depthTextureTransparent,o=n.depthTextureOpaque,s=a.getWidth(),u=a.getHeight();this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.levels=[],this.target=t.createRenderTarget(s,u,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(s,u,!1),this.outlinesRenderable=function NYe(e,t,r,n){var a=t.getWidth(),i=t.getHeight(),o=R(R({},bi),{tDepthOpaque:O.create(t),tDepthTransparent:O.create(r),uTexSize:O.create(Be.create(a,i)),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),uInvProjection:O.create(he.identity()),uOutlineThreshold:O.create(.33),dTransparentOutline:O.create(n)}),s=R({},BYe);return Va(Ua(e,"triangles",Fn("outlines",bo,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform mat4 uInvProjection;\n\nuniform float uOutlineThreshold;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    float backgroundViewZ = 2.0 * uFar;\n\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float selfDepthOpaque = getDepthOpaque(coords);\n    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);\n    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;\n\n    float selfDepthTransparent = getDepthTransparent(coords);\n    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);\n    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;\n\n    float outline = 1.0;\n    float bestDepth = 1.0;\n    float transparentFlag = 0.0;\n\n    for (int y = -1; y <= 1; y++) {\n        for (int x = -1; x <= 1; x++) {\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            float sampleDepthOpaque = getDepthOpaque(sampleCoords);\n            float sampleDepthTransparent = getDepthTransparent(sampleCoords);\n\n            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);\n            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestDepth) {\n                outline = 0.0;\n                bestDepth = sampleDepthOpaque;\n            }\n\n            if (sampleDepthTransparent < sampleDepthOpaque) {\n                float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);\n                if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestDepth) {\n                    outline = 0.0;\n                    bestDepth = sampleDepthTransparent;\n                    transparentFlag = 1.0;\n                }\n            }\n        }\n    }\n\n    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), transparentFlag);\n}\n"),s,o),o)}(t,o,i,!0),this.shadowsTarget=t.createRenderTarget(s,u,!1),this.shadowsRenderable=function LYe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},bi),{tDepth:O.create(t),uTexSize:O.create(Be.create(r,n)),uProjection:O.create(he.identity()),uInvProjection:O.create(he.identity()),uBounds:O.create(dr()),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),dSteps:O.create(1),uMaxDistance:O.create(3),uTolerance:O.create(1),uBias:O.create(.6),uLightDirection:O.create([]),uLightColor:O.create([]),dLightCount:O.create(0)}),i=R({},kYe);return Va(Ua(e,"triangles",Fn("shadows",bo,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uNear;\nuniform float uFar;\n\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\nuniform float uMaxDistance;\nuniform float uTolerance;\nuniform float uBias;\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat screenFade(const in vec2 coords) {\n    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);\n    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));\n    return saturate(1.0 - dot(fade, fade));\n}\n\n// based on https://panoskarabelas.com/posts/screen_space_shadows/\nfloat screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in float stepLength) {\n    // Ray position and direction (in view-space)\n    vec3 rayPos = position;\n    vec3 rayDir = -lightDirection;\n\n    // Compute ray step\n    vec3 rayStep = rayDir * stepLength;\n\n    // Ray march towards the light\n    float occlusion = 0.0;\n    vec4 rayCoords = vec4(0.0);\n    for (int i = 0; i < dSteps; ++i) {\n        // Step the ray\n        rayPos += rayStep;\n\n        rayCoords = uProjection * vec4(rayPos, 1.0);\n        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;\n\n        if (outsideBounds(rayCoords.xy))\n            return 1.0;\n\n        // Compute the difference between the ray's and the camera's depth\n        float depth = getDepth(rayCoords.xy);\n        float viewZ = getViewZ(depth);\n        float zDelta = rayPos.z - viewZ;\n\n        if (zDelta < uTolerance) {\n            occlusion = 1.0;\n\n            // Fade out as we approach the edges of the screen\n            occlusion *= screenFade(rayCoords.xy);\n\n            break;\n        }\n    }\n\n    return 1.0 - (uBias * occlusion);\n}\n\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n    float stepLength = uMaxDistance / float(dSteps);\n\n    float o = 1.0;\n    #if dLightCount != 0\n        float sh[dLightCount];\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            sh[i] = screenSpaceShadow(selfViewPos, uLightDirection[i], stepLength);\n            o = min(o, sh[i]);\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    gl_FragColor = vec4(o);\n}\n"),i,a),a)}(t,o),this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var c=Math.floor(s*this.ssaoScale),l=Math.floor(u*this.ssaoScale),d=Math.max(1,Math.floor(.5*c)),f=Math.max(1,Math.floor(.5*l)),p=Math.max(1,Math.floor(.25*c)),m=Math.max(1,Math.floor(.25*l));this.downsampledDepthTarget=n.packedDepth?t.createRenderTarget(c,l,!1,"uint8","linear","rgba"):t.createRenderTarget(c,l,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderable=K0(t,o);var h=1===this.ssaoScale?o:this.downsampledDepthTarget.texture;this.depthHalfTarget=n.packedDepth?t.createRenderTarget(d,f,!1,"uint8","linear","rgba"):t.createRenderTarget(d,f,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.depthHalfRenderable=K0(t,h),this.depthQuarterTarget=n.packedDepth?t.createRenderTarget(p,m,!1,"uint8","linear","rgba"):t.createRenderTarget(p,m,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderable=K0(t,this.depthHalfTarget.texture),this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTexture.define(c,l),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthBlurProxyTexture.define(c,l),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=function VYe(e,t,r,n){var a=R(R({},bi),{tDepth:O.create(t),tDepthHalf:O.create(r),tDepthQuarter:O.create(n),uSamples:O.create(Cre(32)),dNSamples:O.create(32),uProjection:O.create(he.identity()),uInvProjection:O.create(he.identity()),uBounds:O.create(dr()),uTexSize:O.create(Be.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:O.create(Math.pow(2,5)),uBias:O.create(.8),dMultiScale:O.create(!1),dLevels:O.create(3),uLevelRadius:O.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:O.create([.8,.8,.8]),uNearThreshold:O.create(10),uFarThreshold:O.create(1500)}),i=R({},UYe);return Va(Ua(e,"triangles",Fn("ssao",bo,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform sampler2D tDepthHalf;\nuniform sampler2D tDepthQuarter;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform vec3 uSamples[dNSamples];\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\n#ifdef dMultiScale\n    uniform float uLevelRadius[dLevels];\n    uniform float uLevelBias[dLevels];\n    uniform float uNearThreshold;\n    uniform float uFarThreshold;\n#else\n    uniform float uRadius;\n#endif\nuniform float uBias;\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\nfloat noise(const in vec2 coords) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(coords, vec2(a,b));\n    float sn = mod(dt, PI);\n    return abs(fract(sin(sn) * c)); // is abs necessary?\n}\n\nvec2 getNoiseVec2(const in vec2 coords) {\n    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, c).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, c));\n    #endif\n}\n\n#define dQuarterThreshold 0.1\n#define dHalfThreshold 0.05\n\nfloat getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    float d = distance(coords, selfCoords);\n    #ifdef depthTextureSupport\n        if (d > dQuarterThreshold) {\n            return texture2D(tDepthQuarter, c).r;\n        } else if (d > dHalfThreshold) {\n            return texture2D(tDepthHalf, c).r;\n        } else {\n            return texture2D(tDepth, c).r;\n        }\n    #else\n        if (d > dQuarterThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));\n        } else if (d > dHalfThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthHalf, c));\n        } else {\n            return unpackRGBAToDepth(texture2D(tDepth, c));\n        }\n    #endif\n}\n\nvec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {\n    vec3 p1 = vec3(offset1, depth1 - depth);\n    vec3 p2 = vec3(offset2, depth2 - depth);\n\n    vec3 normal = cross(p1, p2);\n    normal.z = -normal.z;\n\n    return normalize(normal);\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\n// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);\n        return;\n    }\n\n    vec2 offset1 = vec2(0.0, invTexSize.y);\n    vec2 offset2 = vec2(invTexSize.x, 0.0);\n\n    float selfDepth1 = getDepth(selfCoords + offset1);\n    float selfDepth2 = getDepth(selfCoords + offset2);\n\n    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n\n    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));\n    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));\n    vec3 bitangent = cross(selfViewNormal, tangent);\n    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);\n\n    float occlusion = 0.0;\n    #ifdef dMultiScale\n        float pixelSize = getPixelSize(selfCoords, selfDepth);\n\n        for(int l = 0; l < dLevels; l++) {\n            // TODO: smooth transition\n            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;\n            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;\n\n            float levelOcclusion = 0.0;\n            for(int i = 0; i < dNSamples; i++) {\n                vec3 sampleViewPos = TBN * uSamples[i];\n                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];\n\n                vec4 offset = vec4(sampleViewPos, 1.0);\n                offset = uProjection * offset;\n                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n                float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n                float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n                levelOcclusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];\n            }\n            occlusion = max(occlusion, levelOcclusion);\n        }\n    #else\n        for(int i = 0; i < dNSamples; i++) {\n            vec3 sampleViewPos = TBN * uSamples[i];\n            sampleViewPos = selfViewPos + sampleViewPos * uRadius;\n\n            vec4 offset = vec4(sampleViewPos, 1.0);\n            offset = uProjection * offset;\n            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n            float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n            float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n            occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));\n        }\n    #endif\n    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));\n\n    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));\n\n    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);\n}\n"),i,a),a)}(t,h,this.depthHalfTarget.texture,this.depthQuarterTarget.texture),this.ssaoBlurFirstPassRenderable=yre(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=yre(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=function HYe(e,t,r,n,a,i,o,s){var u=R(R({},bi),{tSsaoDepth:O.create(o),tColor:O.create(t),tDepthOpaque:O.create(r),tDepthTransparent:O.create(n),tShadows:O.create(a),tOutlines:O.create(i),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight())),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),uFogNear:O.create(1e4),uFogFar:O.create(1e4),uFogColor:O.create(b.create(1,1,1)),uOutlineColor:O.create(b.create(0,0,0)),uOcclusionColor:O.create(b.create(0,0,0)),uTransparentBackground:O.create(!1),dOcclusionEnable:O.create(!0),uOcclusionOffset:O.create(Be.create(0,0)),dShadowEnable:O.create(!1),dOutlineEnable:O.create(!1),dOutlineScale:O.create(1),dTransparentOutline:O.create(s)}),c=R({},zYe);return Va(Ua(e,"triangles",Fn("postprocessing",bo,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform sampler2D tColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform sampler2D tShadows;\nuniform sampler2D tOutlines;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\nuniform vec3 uOutlineColor;\nuniform vec3 uOcclusionColor;\nuniform bool uTransparentBackground;\nuniform vec2 uOcclusionOffset;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getOutline(const in vec2 coords, const in float opaqueDepth, out float closestTexel) {\n    float backgroundViewZ = 2.0 * uFar;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float transparentDepth = getDepthTransparent(coords);\n    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);\n    float transparentSelfViewZ = isBackground(transparentDepth) ? backgroundViewZ : getViewZ(transparentDepth);\n    float selfDepth = min(opaqueDepth, transparentDepth);\n\n    float outline = 1.0;\n    closestTexel = 1.0;\n    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {\n        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {\n            if (x * x + y * y > dOutlineScale * dOutlineScale) {\n                continue;\n            }\n\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);\n            float sampleOutline = sampleOutlineCombined.r;\n            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);\n            float sampleOutlineViewZ = isBackground(sampleOutlineDepth) ? backgroundViewZ : getViewZ(sampleOutlineDepth);\n\n            float selfViewZ = sampleOutlineCombined.a == 0.0 ? opaqueSelfViewZ : transparentSelfViewZ;\n            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {\n                outline = 0.0;\n                closestTexel = sampleOutlineDepth;\n            }\n        }\n    }\n    return closestTexel < opaqueDepth ? outline : 1.0;\n}\n\nfloat getSsao(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n\n    float viewDist;\n    float fogFactor;\n    float opaqueDepth = getDepthOpaque(coords);\n\n    #ifdef dOcclusionEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            float occlusionFactor = getSsao(coords + uOcclusionOffset);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);\n            } else {\n                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);\n            }\n        }\n    #endif\n\n    #ifdef dShadowEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            vec4 shadow = texture2D(tShadows, coords);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);\n            } else {\n                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);\n            }\n        }\n    #endif\n\n    // outline needs to be handled after occlusion and shadow to keep them clean\n    #ifdef dOutlineEnable\n        float closestTexel;\n        float outline = getOutline(coords, opaqueDepth, closestTexel);\n        if (outline == 0.0) {\n            viewDist = abs(getViewZ(closestTexel));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            if (!uTransparentBackground) {\n                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);\n            } else {\n                color.a = 1.0 - fogFactor;\n                color.rgb = mix(uOutlineColor, color.rgb, fogFactor);\n            }\n        }\n    #endif\n\n    gl_FragColor = color;\n}\n"),c,u),u)}(t,a.texture,o,i,this.shadowsTarget.texture,this.outlinesTarget.texture,this.ssaoDepthTexture,!0),this.background=new yYe(t,r,s,u)}return e.isEnabled=function(t){return"on"===t.occlusion.name||"on"===t.shadow.name||"on"===t.outline.name||"off"!==t.background.variant.name},e.isTransparentOutlineEnabled=function(t){return"on"===t.outline.name&&t.outline.params.includeTransparent},e.prototype.calcSsaoScale=function(t){return Math.min(1,1/this.webgl.pixelRatio)*t},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale(1);if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o,this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.shadowsTarget.setSize(t,r);var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.downsampledDepthTarget.setSize(s,u),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u);var c=Math.max(1,Math.floor(.5*s)),l=Math.max(1,Math.floor(.5*u));this.depthHalfTarget.setSize(c,l);var d=Math.max(1,Math.floor(.25*s)),f=Math.max(1,Math.floor(.25*u));this.depthQuarterTarget.setSize(d,f),O.update(this.renderable.values.uTexSize,Be.set(this.renderable.values.uTexSize.ref.value,t,r)),O.update(this.outlinesRenderable.values.uTexSize,Be.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),O.update(this.shadowsRenderable.values.uTexSize,Be.set(this.shadowsRenderable.values.uTexSize.ref.value,t,r)),O.update(this.downsampleDepthRenderable.values.uTexSize,Be.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,s,u)),O.update(this.depthHalfRenderable.values.uTexSize,Be.set(this.depthHalfRenderable.values.uTexSize.ref.value,c,l)),O.update(this.depthQuarterRenderable.values.uTexSize,Be.set(this.depthQuarterRenderable.values.uTexSize.ref.value,d,f)),O.update(this.ssaoRenderable.values.uTexSize,Be.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),O.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Be.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),O.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Be.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u));var p=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;O.update(this.depthHalfRenderable.values.tColor,p),O.update(this.ssaoRenderable.values.tDepth,p),this.depthHalfRenderable.update(),this.ssaoRenderable.update(),this.background.setSize(t,r)}},e.prototype.updateState=function(t,r,n,a,i){var o,s=!1,u=!1,c=!1,l=!1,d=!1,f=!1,p="orthographic"===t.state.mode?1:0,m="on"===a.outline.name,h="on"===a.shadow.name,v="on"===a.occlusion.name,g=he.identity();he.invert(g,t.projection);var y=this.renderable.values.uTexSize.ref.value,S=y[0],C=y[1],_=t.viewport;if("on"===a.occlusion.name){O.update(this.ssaoRenderable.values.uProjection,t.projection),O.update(this.ssaoRenderable.values.uInvProjection,g);var x=this.ssaoRenderable.values.uBounds,D=this.ssaoScale;dr.set(x.ref.value,Math.floor(_.x*D)/(S*D),Math.floor(_.y*D)/(C*D),Math.ceil((_.x+_.width)*D)/(S*D),Math.ceil((_.y+_.height)*D)/(C*D)),O.update(x,x.ref.value),O.update(this.ssaoBlurFirstPassRenderable.values.uBounds,x.ref.value),O.update(this.ssaoBlurSecondPassRenderable.values.uBounds,x.ref.value),O.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),O.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),O.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),O.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),O.update(this.ssaoBlurFirstPassRenderable.values.uInvProjection,g),O.update(this.ssaoBlurSecondPassRenderable.values.uInvProjection,g),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==p&&(l=!0,O.update(this.ssaoBlurFirstPassRenderable.values.dOrthographic,p),O.update(this.ssaoBlurSecondPassRenderable.values.dOrthographic,p)),this.nSamples!==a.occlusion.params.samples&&(c=!0,this.nSamples=a.occlusion.params.samples,O.update(this.ssaoRenderable.values.uSamples,Cre(this.nSamples)),O.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples));var w="on"===a.occlusion.params.multiScale.name;if(this.ssaoRenderable.values.dMultiScale.ref.value!==w&&(c=!0,O.update(this.ssaoRenderable.values.dMultiScale,w)),"on"===a.occlusion.params.multiScale.name){var A=a.occlusion.params.multiScale.params;if(!rd(this.levels,A.levels)){c=!0,this.levels=A.levels;var E=function jYe(e,t){var r=e.length,n=t||{radius:new Array(3*r).fill(0),bias:new Array(3*r).fill(0)},a=n.radius,i=n.bias;e=e.slice().sort(function(u,c){return u.radius-c.radius});for(var o=0;o<r;++o){var s=e[o];a[o]=Math.pow(2,s.radius),i[o]=s.bias}return{count:r,radius:a,bias:i}}(A.levels);O.updateIfChanged(this.ssaoRenderable.values.dLevels,E.count),O.update(this.ssaoRenderable.values.uLevelRadius,E.radius),O.update(this.ssaoRenderable.values.uLevelBias,E.bias)}O.updateIfChanged(this.ssaoRenderable.values.uNearThreshold,A.nearThreshold),O.updateIfChanged(this.ssaoRenderable.values.uFarThreshold,A.farThreshold)}else O.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius));if(O.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){l=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var I=bre(this.blurKernelSize);O.update(this.ssaoBlurFirstPassRenderable.values.uKernel,I),O.update(this.ssaoBlurSecondPassRenderable.values.uKernel,I),O.update(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),O.update(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}var M=this.calcSsaoScale(a.occlusion.params.resolutionScale);if(this.ssaoScale!==M){c=!0,d=!0,this.ssaoScale=M;var F=Math.floor(S*this.ssaoScale),N=Math.floor(C*this.ssaoScale);this.downsampledDepthTarget.setSize(F,N),this.ssaoDepthTexture.define(F,N),this.ssaoDepthBlurProxyTexture.define(F,N);var j=Math.floor(.5*F),U=Math.floor(.5*N);this.depthHalfTarget.setSize(j,U);var H=Math.floor(.25*F),z=Math.floor(.25*N);this.depthQuarterTarget.setSize(H,z);var G=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;O.update(this.depthHalfRenderable.values.tColor,G),O.update(this.ssaoRenderable.values.tDepth,G),O.update(this.ssaoRenderable.values.tDepthHalf,this.depthHalfTarget.texture),O.update(this.ssaoRenderable.values.tDepthQuarter,this.depthQuarterTarget.texture),O.update(this.downsampleDepthRenderable.values.uTexSize,Be.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,F,N)),O.update(this.depthHalfRenderable.values.uTexSize,Be.set(this.depthHalfRenderable.values.uTexSize.ref.value,j,U)),O.update(this.depthQuarterRenderable.values.uTexSize,Be.set(this.depthQuarterRenderable.values.uTexSize.ref.value,H,z)),O.update(this.ssaoRenderable.values.uTexSize,Be.set(this.ssaoRenderable.values.uTexSize.ref.value,F,N)),O.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Be.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,F,N)),O.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Be.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,F,N))}O.update(this.renderable.values.uOcclusionColor,dt.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,a.occlusion.params.color))}if("on"===a.shadow.name&&(O.update(this.shadowsRenderable.values.uProjection,t.projection),O.update(this.shadowsRenderable.values.uInvProjection,g),dr.set(this.shadowsRenderable.values.uBounds.ref.value,_.x/S,_.y/C,(_.x+_.width)/S,(_.y+_.height)/C),O.update(this.shadowsRenderable.values.uBounds,this.shadowsRenderable.values.uBounds.ref.value),O.updateIfChanged(this.shadowsRenderable.values.uNear,t.near),O.updateIfChanged(this.shadowsRenderable.values.uFar,t.far),this.shadowsRenderable.values.dOrthographic.ref.value!==p&&(O.update(this.shadowsRenderable.values.dOrthographic,p),s=!0),O.updateIfChanged(this.shadowsRenderable.values.uMaxDistance,a.shadow.params.maxDistance),O.updateIfChanged(this.shadowsRenderable.values.uTolerance,a.shadow.params.tolerance),O.updateIfChanged(this.shadowsRenderable.values.uBias,a.shadow.params.bias),this.shadowsRenderable.values.dSteps.ref.value!==a.shadow.params.steps&&(O.update(this.shadowsRenderable.values.dSteps,a.shadow.params.steps),s=!0),O.update(this.shadowsRenderable.values.uLightDirection,i.direction),O.update(this.shadowsRenderable.values.uLightColor,i.color),this.shadowsRenderable.values.dLightCount.ref.value!==i.count&&(O.update(this.shadowsRenderable.values.dLightCount,i.count),s=!0)),"on"===a.outline.name){var J=null===(o=a.outline.params.includeTransparent)||void 0===o||o,X=Math.max(1,Math.round(a.outline.params.scale*this.webgl.pixelRatio))-1,Z=50*a.outline.params.threshold*this.webgl.pixelRatio;O.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),O.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),O.update(this.outlinesRenderable.values.uInvProjection,g),this.outlinesRenderable.values.dTransparentOutline.ref.value!==J&&(f=!0,O.update(this.outlinesRenderable.values.dTransparentOutline,J)),this.outlinesRenderable.values.dOrthographic.ref.value!==p&&(f=!0,O.update(this.outlinesRenderable.values.dOrthographic,p)),O.updateIfChanged(this.outlinesRenderable.values.uOutlineThreshold,Z),O.update(this.renderable.values.uOutlineColor,dt.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,a.outline.params.color)),this.renderable.values.dOutlineScale.ref.value!==X&&(u=!0,O.update(this.renderable.values.dOutlineScale,X)),this.renderable.values.dTransparentOutline.ref.value!==J&&(u=!0,O.update(this.renderable.values.dTransparentOutline,J))}O.updateIfChanged(this.renderable.values.uFar,t.far),O.updateIfChanged(this.renderable.values.uNear,t.near),O.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),O.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),O.update(this.renderable.values.uFogColor,dt.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),O.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==p&&(u=!0,O.update(this.renderable.values.dOrthographic,p)),this.renderable.values.dOutlineEnable.ref.value!==m&&(u=!0,O.update(this.renderable.values.dOutlineEnable,m)),this.renderable.values.dShadowEnable.ref.value!==h&&(u=!0,O.update(this.renderable.values.dShadowEnable,h)),this.renderable.values.dOcclusionEnable.ref.value!==v&&(u=!0,O.update(this.renderable.values.dOcclusionEnable,v)),f&&this.outlinesRenderable.update(),s&&this.shadowsRenderable.update(),c&&this.ssaoRenderable.update(),l&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),d&&this.depthHalfRenderable.update(),u&&this.renderable.update();var ne=this.webgl,Y=ne.gl,k=ne.state;k.enable(Y.SCISSOR_TEST),k.disable(Y.BLEND),k.disable(Y.DEPTH_TEST),k.depthMask(!1)},e.prototype.setOcclusionOffset=function(t,r){this.occlusionOffset[0]=t,this.occlusionOffset[1]=r,O.update(this.renderable.values.uOcclusionOffset,Be.set(this.renderable.values.uOcclusionOffset.ref.value,t,r))},e.prototype.setTransparentBackground=function(t){this.transparentBackground=t},e.prototype.render=function(t,r,n,a,i,o){xt&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(t,n,a,i,o);var s=this.webgl,u=s.gl,c=s.state,l=t.viewport,d=l.x,f=l.y,p=l.width,m=l.height;if("on"===i.occlusion.name&&0===this.occlusionOffset[0]&&0===this.occlusionOffset[1]){xt&&this.webgl.timer.mark("SSAO.render");var h=Math.floor(d*this.ssaoScale),v=Math.floor(f*this.ssaoScale),g=Math.ceil(p*this.ssaoScale),y=Math.ceil(m*this.ssaoScale);c.viewport(h,v,g,y),c.scissor(h,v,g,y),this.ssaoScale<1&&(xt&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTarget.bind(),this.downsampleDepthRenderable.render(),xt&&this.webgl.timer.markEnd("SSAO.downsample")),xt&&this.webgl.timer.mark("SSAO.half"),this.depthHalfTarget.bind(),this.depthHalfRenderable.render(),xt&&this.webgl.timer.markEnd("SSAO.half"),xt&&this.webgl.timer.mark("SSAO.quarter"),this.depthQuarterTarget.bind(),this.depthQuarterRenderable.render(),xt&&this.webgl.timer.markEnd("SSAO.quarter"),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),xt&&this.webgl.timer.markEnd("SSAO.render")}c.viewport(d,f,p,m),c.scissor(d,f,p,m),"on"===i.outline.name&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),"on"===i.shadow.name&&(this.shadowsTarget.bind(),this.shadowsRenderable.render()),r?this.webgl.unbindFramebuffer():this.target.bind(),this.background.update(t,i.background),this.background.isEnabled(i.background)?(this.transparentBackground?c.clearColor(0,0,0,0):(dt.toVec3Normalized(this.bgColor,a),c.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),u.clear(u.COLOR_BUFFER_BIT),c.enable(u.BLEND),c.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),this.background.render()):(c.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT)),this.renderable.render(),xt&&this.webgl.timer.markEnd("PostprocessingPass.render")},e}(),zN=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.internalTarget=t.createRenderTarget(a,i,!1),this.fxaa=new zWe(t,this.target.texture),this.smaa=new JWe(t,this.target.texture),this.cas=new MYe(t,this.target.texture)}return e.isEnabled=function(t){return"off"!==t.antialiasing.name},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.internalTarget.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r),this.cas.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if("fxaa"===n.antialiasing.name){var a=zs.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r)}},e.prototype._renderSmaa=function(t,r,n){if("smaa"===n.antialiasing.name){var a=zs.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r)}},e.prototype._renderAntialiasing=function(t,r,n){"fxaa"===n.antialiasing.name?this._renderFxaa(t,r,n):"smaa"===n.antialiasing.name&&this._renderSmaa(t,r,n)},e.prototype._renderCas=function(t,r,n){if("on"===n.sharpening.name){var a="off"!==n.antialiasing.name?this.internalTarget.texture:zs.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.cas.update(a,n.sharpening.params),this.cas.render(t.viewport,r)}},e.prototype.render=function(t,r,n){if("off"!==n.antialiasing.name||"off"!==n.sharpening.name){if("smaa"===n.antialiasing.name&&!this.smaa.supported)return void console.error('SMAA not supported, missing "HTMLImageElement"');var a=r?void 0:this.target;"off"===n.sharpening.name?this._renderAntialiasing(t,a,n):("off"===n.antialiasing.name||this._renderAntialiasing(t,this.internalTarget,n),this._renderCas(t,a,n))}},e}(),WYe=R(R({},yi),{tColor:Xt("texture","rgba","ubyte","nearest"),uTexSize:Ae("v2"),uWeight:Ae("f")}),YYe=Fn("compose",bo,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\nuniform float uWeight;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords) * uWeight;\n}\n"),_re={mode:T.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:T.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:T.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'})},HT=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),c=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,c,!1),this.composeTarget=t.createRenderTarget(u,c,!1,o&&s?"fp16":a&&i?"float32":"uint8"),this.holdTarget=t.createRenderTarget(u,c,!1),this.compose=function XYe(e,t){var r=R(R({},bi),{tColor:O.create(t),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight())),uWeight:O.create(1)}),n=R({},WYe);return Va(Ua(e,"triangles",YYe,n,r),r)}(t,r.colorTarget.texture)}return e.isEnabled=function(t){return"off"!==t.mode},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value;(t!==n[0]||r!==n[1])&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),O.update(this.compose.values.uTexSize,Be.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i){return"temporal"!==n.multiSample.mode||i?(this.renderMultiSample(r,a,n),-2):this.renderTemporalMultiSample(t,r,n,a)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n){var a=t.camera,i=this,o=i.compose,s=i.composeTarget,u=i.drawPass,c=i.webgl,l=c.gl,d=c.state;xt&&c.timer.mark("MultiSamplePass.renderMultiSample");var f=HN[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],p=a.viewport,m=p.x,h=p.y,v=p.width,g=p.height,y=1/f.length;a.viewOffset.enabled=!0,O.update(o.values.tColor,u.getColorTarget(n.postprocessing).texture),o.update();for(var C=0;C<f.length;++C){var _=f[C];za.setViewOffset(a.viewOffset,v,g,_[0],_[1],v,g),a.update(),O.update(o.values.uWeight,y+.03125*((C+.5)/f.length-.5)),0===C?u.postprocessing.setOcclusionOffset(0,0):u.postprocessing.setOcclusionOffset(_[0]/v,_[1]/g),u.render(t,n,!1),s.bind(),d.enable(l.BLEND),d.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),d.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE),d.disable(l.DEPTH_TEST),d.depthMask(!1),d.viewport(m,h,v,g),d.scissor(m,h,v,g),0===C&&(d.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT)),o.render()}u.postprocessing.setOcclusionOffset(0,0),O.update(o.values.uWeight,1),O.update(o.values.tColor,s.texture),o.update(),this.bindOutputTarget(r),d.viewport(m,h,v,g),d.scissor(m,h,v,g),d.disable(l.BLEND),o.render(),a.viewOffset.enabled=!1,a.update(),xt&&c.timer.markEnd("MultiSamplePass.renderMultiSample")},e.prototype.renderTemporalMultiSample=function(t,r,n,a){var i=r.camera,o=this,s=o.compose,u=o.composeTarget,c=o.holdTarget,l=o.drawPass,d=o.webgl,f=d.gl,p=d.state;xt&&d.timer.mark("MultiSamplePass.renderTemporalMultiSample");var m=HN[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(-2===t||t>=m.length)return-2;var h=i.viewport,v=h.x,g=h.y,y=h.width,S=h.height,C=1/m.length;if(-1===t)l.render(r,n,!1),O.update(s.values.uWeight,1),O.update(s.values.tColor,l.getColorTarget(n.postprocessing).texture),s.update(),c.bind(),p.disable(f.BLEND),p.disable(f.DEPTH_TEST),p.depthMask(!1),p.viewport(v,g,y,S),p.scissor(v,g,y,S),s.render(),t+=1;else{i.viewOffset.enabled=!0,O.update(s.values.tColor,l.getColorTarget(n.postprocessing).texture),O.update(s.values.uWeight,C),s.update();for(var _=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2)),x=0;x<_;++x){var D=m[t];if(za.setViewOffset(i.viewOffset,y,S,D[0],D[1],y,S),i.update(),0===t?l.postprocessing.setOcclusionOffset(0,0):l.postprocessing.setOcclusionOffset(D[0]/y,D[1]/S),l.render(r,n,!1),u.bind(),p.enable(f.BLEND),p.blendEquationSeparate(f.FUNC_ADD,f.FUNC_ADD),p.blendFuncSeparate(f.ONE,f.ONE,f.ONE,f.ONE),p.disable(f.DEPTH_TEST),p.depthMask(!1),p.viewport(v,g,y,S),p.scissor(v,g,y,S),0===t&&(p.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),s.render(),(t+=1)>=m.length)break}}l.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(a),p.viewport(v,g,y,S),p.scissor(v,g,y,S);var w=t*C;return w>0&&(O.update(s.values.uWeight,1),O.update(s.values.tColor,u.texture),s.update(),p.disable(f.BLEND),s.render()),w<1&&(O.update(s.values.uWeight,1-w),O.update(s.values.tColor,c.texture),s.update(),0===w?p.disable(f.BLEND):p.enable(f.BLEND),s.render()),i.viewOffset.enabled=!1,i.update(),xt&&d.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),t>=m.length?-2:t},e}(),HN=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];HN.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var wre=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),"temporal"===r.mode&&-2!==this.sampleIndex},e.prototype.render=function(t,r,n,a){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!a),this.sampleIndex<0},e}(),Are={eyeSeparation:T.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:T.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},KYe=T.getDefaultValues(Are),_y=function(){function e(t,r){void 0===r&&(r={}),this.parent=t,this.left=new Tre,this.right=new Tre,this.props=R(R({},KYe),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),function ZYe(e,t,r,n){eo.copy(r.viewport,e.viewport),he.copy(r.view,e.view),he.copy(r.projection,e.projection),za.copySnapshot(r.state,e.state),za.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,eo.copy(n.viewport,e.viewport),he.copy(n.view,e.view),he.copy(n.projection,e.projection),za.copySnapshot(n.state,e.state),za.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var c,l,o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(.5*e.state.fov);Dre[12]=-o,Ere[12]=o,r.projection[0]=2*e.near/((l=u*i+s)-(c=-u*i+s)),r.projection[8]=(l+c)/(l-c),he.mul(r.view,r.view,Dre),he.mul(r.projectionView,r.projection,r.view),he.invert(r.inverseProjectionView,r.projectionView),n.projection[0]=2*e.near/((l=u*i-s)-(c=-u*i-s)),n.projection[8]=(l+c)/(l-c),he.mul(n.view,n.view,Ere),he.mul(n.projectionView,n.projection,n.view),he.invert(n.inverseProjectionView,n.projectionView)}(this.parent,this.props,this.left,this.right)},e}();!function(e){e.is=function t(r){return"left"in r&&"right"in r}}(_y||(_y={}));var Tre=function e(){this.viewport=eo.create(0,0,0,0),this.view=he(),this.projection=he(),this.projectionView=he(),this.inverseProjectionView=he(),this.state=za.createDefaultSnapshot(),this.viewOffset=za.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0},Dre=he.identity(),Ere=he.identity(),jN=Math.pow(2,24)-2,QYe=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a);var i=t.resources,o=t.extensions.drawBuffers,s=t.gl;o?(this.objectPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=i.framebuffer(),this.objectPickFramebuffer=i.framebuffer(),this.instancePickFramebuffer=i.framebuffer(),this.groupPickFramebuffer=i.framebuffer(),this.depthPickFramebuffer=i.framebuffer(),this.framebuffer.bind(),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1,o.COLOR_ATTACHMENT2,o.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=$t(s)?i.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):i.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight))}return e.prototype.bindObject=function(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()},e.prototype.bindInstance=function(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()},e.prototype.bindGroup=function(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()},e.prototype.bindDepth=function(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()},Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))},e.prototype.renderVariant=function(t,r,n,a,i,o){t.clear(!1),t.update(r,n),t.renderPick(n.primitives,r,i,null,o),a.handle.isEnabled&&t.renderPick(a.handle.scene,r,i,null,o),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera,a.camera.scene),t.renderPick(a.camera.scene,a.camera.camera,i,null,o))},e.prototype.render=function(t,r,n,a){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(t,r,n,a,"pick",Cv.None)):(this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",Cv.Object),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pick",Cv.Instance),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",Cv.Group),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth",Cv.None))},e}(),$Ye=function(){function e(t,r,n,a,i,o,s){void 0===s&&(s=1),this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.pickPadding=s,this.dirty=!0,this.viewport=eo(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){eo.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=function D_e(e){for(var t,r=0,n=0,a=[0,-1],i=2*e+1,o=i/2,s=[],u=Math.pow(i,2);u>0;--u)-o<r&&r<=o&&-o<n&&n<=o&&s.push([r,n]),(r===n||r<0&&r===-n||r>0&&r===1-n)&&(a[0]=(t=[-a[1],a[0]])[0],a[1]=t[1]),r+=a[0],n+=a[1];return s}(Math.round(this.pickScale*this.pickPadding))},e.prototype.syncBuffers=function(){xt&&this.webgl.timer.mark("PickHelper.syncBuffers");var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.bindObject(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.bindInstance(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.bindGroup(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.bindDepth(),this.webgl.readPixels(r,n,a,i,this.depthBuffer),xt&&this.webgl.timer.markEnd("PickHelper.syncBuffers")},e.prototype.getBufferIdx=function(t,r){return 4*(r*this.pickWidth+t)},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return function FFe(e,t,r,n){return dr.set(_K,e/255,t/255,r/255,n/255),dr.dot(_K,OFe)}(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return s4(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){xt&&this.webgl.timer.mark("PickHelper.render",!0);var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,c=u.renderer,l=u.scene,d=u.helper;c.setTransparentBackground(!1),c.setDrawingBufferSize(i,o),c.setPixelRatio(this.pickScale),_y.is(t)?(c.setViewport(n,a,s,o),this.pickPass.render(c,t.left,l,d),c.setViewport(n+s,a,i-s,o),this.pickPass.render(c,t.right,l,d)):(c.setViewport(n,a,i,o),this.pickPass.render(c,t,l,d)),this.dirty=!1,xt&&this.webgl.timer.markEnd("PickHelper.render")},e.prototype.identifyInternal=function(t,r,n){var i=this.webgl,o=this.pickScale;if(!i.isContextLost){r=this.pickPass.drawingBufferHeight-(r*=i.pixelRatio);var s=this.viewport;if(!((t*=i.pixelRatio)<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(xt&&this.webgl.timer.mark("PickHelper.identify"),this.render(n),this.syncBuffers(),xt&&this.webgl.timer.markEnd("PickHelper.identify"));var u=t-s.x,c=r-s.y,l=Math.floor(u*o),d=Math.floor(c*o),f=this.getId(l,d,this.objectBuffer);if(-1!==f&&f!==jN){var p=this.getId(l,d,this.instanceBuffer);if(-1!==p&&p!==jN){var m=this.getId(l,d,this.groupBuffer);if(-1!==m&&m!==jN){var h=this.getDepth(l,d),v=b.create(t,r,h);if(_y.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(v[0]=s.x+2*(u-g),kT(v,v,s,n.right.inverseProjectionView)):(v[0]=s.x+2*u,kT(v,v,s,n.left.inverseProjectionView))}else kT(v,v,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:p,groupId:m},position:v}}}}}}},e.prototype.identify=function(t,r,n){for(var a=0,i=this.spiral;a<i.length;a++){var o=i[a],s=this.identifyInternal(t+o[0],r+o[1],n);if(s)return s}},e}(),eXe=R(R({},yi),{tWboitA:Xt("texture","rgba","float","nearest"),tWboitB:Xt("texture","rgba","float","nearest"),uTexSize:Ae("v2")}),tXe=Fn("evaluate-wboit",bo,"\nprecision highp float;\n\nuniform sampler2D tWboitA;\nuniform sampler2D tWboitB;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec4 accum = texture2D(tWboitA, coords);\n    float r = 1.0 - accum.a;\n\n    accum.a = texture2D(tWboitB, coords).r;\n    // divisor needs to allow very small values for nice fading\n    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);\n}\n"),nXe=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,e.isSupported(t)){var a=t.resources,i=t.gl;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.depthRenderbuffer=$t(i)?a.renderbuffer("depth32f","depth",r,n):a.renderbuffer("depth16","depth",r,n),this.renderable=function rXe(e,t,r){var n=R(R({},bi),{tWboitA:O.create(t),tWboitB:O.create(r),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight()))}),a=R({},eXe);return Va(Ua(e,"triangles",tXe,a,n),n)}(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){xt&&this.webgl.timer.mark("WboitPass.render");var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render(),xt&&this.webgl.timer.markEnd("WboitPass.render")},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value;(t!==n[0]||r!==n[1])&&(this.textureA.define(t,r),this.textureB.define(t,r),this.depthRenderbuffer.setSize(t,r),O.update(this.renderable.values.uTexSize,Be.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(a&&i&&o&&n)return!0;if(Cr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'.concat(s.join('", "'),'" extensions required for "wboit"'))}return!1},e}(),oXe=R(R({},yi),{tDpoitBackColor:Xt("texture","rgba","float","nearest"),uTexSize:Ae("v2")}),sXe=Fn("blend-back-dpoit",bo,"\n    precision highp float;\n\n    uniform sampler2D tDpoitBackColor;\n    uniform vec2 uTexSize;\n\n    void main() {\n        vec2 coords = gl_FragCoord.xy / uTexSize;\n        gl_FragColor = texture2D(tDpoitBackColor, coords);\n        if (gl_FragColor.a == 0.0) {\n            discard;\n        }\n    }\n"),cXe=R(R({},yi),{tDpoitFrontColor:Xt("texture","rgba","float","nearest"),uTexSize:Ae("v2")}),lXe=Fn("evaluate-dpoit",bo,"\nprecision highp float;\n\nuniform sampler2D tDpoitFrontColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tDpoitFrontColor, coords);\n}\n"),fXe=function(){function e(t,r,n){if(this.webgl=t,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,e.isSupported(t)){var a=t.resources,i=t.extensions,o=i.colorBufferHalfFloat,s=i.textureHalfFloat;$t(t.gl)?(this.depthTextures=[a.texture("image-float32","rg","float","nearest"),a.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=o&&s?[a.texture("image-float16","rgba","fp16","nearest"),a.texture("image-float16","rgba","fp16","nearest")]:[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=o&&s?[a.texture("image-float16","rgba","fp16","nearest"),a.texture("image-float16","rgba","fp16","nearest")]:[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[a.texture("image-float32","rgba","float","nearest"),a.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(r,n),this.depthTextures[1].define(r,n),this.colorFrontTextures[0].define(r,n),this.colorFrontTextures[1].define(r,n),this.colorBackTextures[0].define(r,n),this.colorBackTextures[1].define(r,n),this.depthFramebuffers=[a.framebuffer(),a.framebuffer()],this.colorFramebuffers=[a.framebuffer(),a.framebuffer()],this.blendBackRenderable=function uXe(e,t){var r=R(R({},bi),{tDpoitBackColor:O.create(t),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight()))}),n=R({},oXe);return Va(Ua(e,"triangles",sXe,n,r),r)}(t,this.colorBackTextures[0]),this.renderable=function dXe(e,t){var r=R(R({},bi),{tDpoitFrontColor:O.create(t),uTexSize:O.create(Be.create(t.getWidth(),t.getHeight()))}),n=R({},cXe);return Va(Ua(e,"triangles",lXe,n,r),r)}(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl,a=t.extensions.blendMinMax;return this.passCount=0,this.depthFramebuffers[0].bind(),r.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),r.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),r.blendEquation(a.MAX),r.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}},e.prototype.bindDualDepthPeeling=function(){var t=this.webgl,r=t.state,n=t.gl,a=t.extensions.blendMinMax;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),r.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),r.blendEquation(a.MAX),r.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}},e.prototype.renderBlendBack=function(){xt&&this.webgl.timer.mark("DpoitPass.renderBlendBack");var t=this.webgl,r=t.state,n=t.gl;r.blendEquation(n.FUNC_ADD),r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),O.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),xt&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")},e.prototype.render=function(){xt&&this.webgl.timer.mark("DpoitPass.render");var t=this.webgl,n=t.gl;t.state.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),O.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),xt&&this.webgl.timer.markEnd("DpoitPass.render")},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value;if(t!==n[0]||r!==n[1]){for(var o=0;o<2;o++)this.depthTextures[o].define(t,r),this.colorFrontTextures[o].define(t,r),this.colorBackTextures[o].define(t,r);O.update(this.renderable.values.uTexSize,Be.set(this.renderable.values.uTexSize.ref.value,t,r)),O.update(this.blendBackRenderable.values.uTexSize,Be.set(this.blendBackRenderable.values.uTexSize.ref.value,t,r))}},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){for(var t=this.webgl.extensions.drawBuffers,r=0;r<2;r++)this.depthFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.colorFrontTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color1"),this.depthTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color2"),this.colorFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.colorFrontTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.blendMinMax;if(a&&i&&n&&o)return!0;if(Cr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),n||s.push("drawBuffers"),o||s.push("blendMinMax"),console.log('Missing "'.concat(s.join('", "'),'" extensions required for "dpoit"'))}return!1},e}(),Ire={enabled:T.Boolean(!0),highlightEdgeColor:T.Color(dt.darken(dt.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:T.Color(dt.darken(dt.fromNormalizedRgb(.2,1,.1),1)),edgeScale:T.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:T.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:T.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:T.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:T.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},Pre=function(){function e(t,r,n){this.webgl=t,this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=function gXe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},bi),{tMaskTexture:O.create(t),uTexSizeInv:O.create(Be.create(1/r,1/n)),dEdgeScale:O.create(1)}),i=R({},hXe);return Va(Ua(e,"triangles",vXe,i,a),a)}(t,this.maskTarget.texture),this.overlay=function SXe(e,t){var r=t.getWidth(),n=t.getHeight(),a=R(R({},bi),{tEdgeTexture:O.create(t),uTexSizeInv:O.create(Be.create(1/r,1/n)),uHighlightEdgeColor:O.create(b()),uSelectEdgeColor:O.create(b()),uHighlightEdgeStrength:O.create(1),uSelectEdgeStrength:O.create(1),uGhostEdgeStrength:O.create(0),uInnerEdgeFactor:O.create(0)}),i=R({},yXe);return Va(Ua(e,"triangles",bXe,i,a),a)}(t,this.edgesTarget.texture)}return e.isEnabled=function(t){return t.enabled},e.prototype.setEdgeState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.ONE,n.ONE),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u),a.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setOverlayState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;a.viewport(i,o,s,u),a.scissor(i,o,s,u)},e.prototype.setSize=function(t,r){var n=this.depthTarget.getWidth(),a=this.depthTarget.getHeight();(t!==n||r!==a)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),O.update(this.edge.values.uTexSizeInv,Be.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),O.update(this.overlay.values.uTexSizeInv,Be.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t){var r=t.highlightEdgeColor,n=t.selectEdgeColor,i=t.innerEdgeFactor,o=t.ghostEdgeStrength,s=t.highlightEdgeStrength,u=t.selectEdgeStrength,c=this.edge.values,l=Math.max(1,Math.round(t.edgeScale*this.webgl.pixelRatio));c.dEdgeScale.ref.value!==l&&(O.update(c.dEdgeScale,l),this.edge.update());var d=this.overlay.values;O.update(d.uHighlightEdgeColor,dt.toVec3Normalized(d.uHighlightEdgeColor.ref.value,r)),O.update(d.uSelectEdgeColor,dt.toVec3Normalized(d.uSelectEdgeColor.ref.value,n)),O.updateIfChanged(d.uInnerEdgeFactor,i),O.updateIfChanged(d.uGhostEdgeStrength,o),O.updateIfChanged(d.uHighlightEdgeStrength,s),O.updateIfChanged(d.uSelectEdgeStrength,u)},e.prototype.render=function(t,r){xt&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(t),this.overlay.render(),xt&&this.webgl.timer.markEnd("MarkingPass.render")},e}(),hXe=R(R({},yi),{tMaskTexture:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Ae("v2"),dEdgeScale:Lt("number")}),vXe=Fn("edge",bo,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tMaskTexture;\nuniform vec2 uTexSizeInv;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);\n    vec4 c0 = texture2D(tMaskTexture, coords);\n    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);\n    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);\n    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);\n    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);\n    float diff1 = (c1.r - c2.r) * 0.5;\n    float diff2 = (c3.r - c4.r) * 0.5;\n    float d = length(vec2(diff1, diff2));\n    if (d <= 0.0)\n        discard;\n    float a1 = min(c1.g, c2.g);\n    float a2 = min(c3.g, c4.g);\n    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;\n    float mask = c0.r;\n    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));\n    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));\n    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);\n}\n"),yXe=R(R({},yi),{tEdgeTexture:Xt("texture","rgba","ubyte","linear"),uTexSizeInv:Ae("v2"),uHighlightEdgeColor:Ae("v3"),uSelectEdgeColor:Ae("v3"),uHighlightEdgeStrength:Ae("f"),uSelectEdgeStrength:Ae("f"),uGhostEdgeStrength:Ae("f"),uInnerEdgeFactor:Ae("f")}),bXe=Fn("overlay",bo,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\nuniform sampler2D tEdgeTexture;\nuniform vec3 uHighlightEdgeColor;\nuniform vec3 uSelectEdgeColor;\nuniform float uHighlightEdgeStrength;\nuniform float uSelectEdgeStrength;\nuniform float uGhostEdgeStrength;\nuniform float uInnerEdgeFactor;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 edgeValue = texture2D(tEdgeTexture, coords);\n    if (edgeValue.a > 0.0) {\n        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;\n        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;\n        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;\n        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;\n        gl_FragColor.a *= edgeStrength;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}\n"),Mre=function(){function e(t,r,n,a,i,o){this.webgl=t;var s=t.extensions,u=t.resources,c=t.isWebGL2;this.drawTarget=function LRe(e){return{id:_X(),texture:Ao(e),framebuffer:{id:sX(),bind:function(){},reset:function(){},destroy:function(){}},depthRenderbuffer:null,getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}(t.gl),this.colorTarget=t.createRenderTarget(n,a,!0,"uint8","linear"),this.packedDepth=!s.depthTexture,this.depthTargetTransparent=t.createRenderTarget(n,a),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?t.createRenderTarget(n,a):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:u.texture("image-depth","depth",c?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(n,a),this.wboit=i?new nXe(t,n,a):void 0,this.dpoit=o?new fXe(t,n,a):void 0,this.marking=new Pre(t,n,a),this.postprocessing=new zs(t,r,this),this.antialiasing=new zN(t,this),this.copyFboTarget=K0(t,this.colorTarget.texture),this.copyFboPostprocessing=K0(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!(null===(t=this.wboit)||void 0===t||!t.supported)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dpoitEnabled",{get:function(){var t;return!(null===(t=this.dpoit)||void 0===t||!t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t,r;null===(t=this.wboit)||void 0===t||t.reset(),null===(r=this.dpoit)||void 0===r||r.reset()},e.prototype.setSize=function(t,r){var n,a,i=this.colorTarget.getWidth(),o=this.colorTarget.getHeight();(t!==i||r!==o)&&(this.colorTarget.setSize(t,r),this.depthTargetTransparent.setSize(t,r),this.depthTargetOpaque?this.depthTargetOpaque.setSize(t,r):this.depthTextureOpaque.define(t,r),O.update(this.copyFboTarget.values.uTexSize,Be.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),O.update(this.copyFboPostprocessing.values.uTexSize,Be.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r))),!(null===(n=this.wboit)||void 0===n)&&n.supported&&this.wboit.setSize(t,r),!(null===(a=this.dpoit)||void 0===a)&&a.supported&&this.dpoit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r)},e.prototype._renderDpoit=function(t,r,n,a,i,o){var s;if(null===(s=this.dpoit)||void 0===s||!s.supported)throw new Error("expected dpoit to be supported");if(this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderDpoitOpaque(n.primitives,r,null),zs.isEnabled(o)&&(zs.isTransparentOutlineEnabled(o)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,i,t.props.backgroundColor,o,t.light)),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),n.opacityAverage<1){var u=zs.isEnabled(o)?this.postprocessing.target:this.colorTarget,c=this.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,c);for(var l=0;l<a;l++){xt&&this.webgl.timer.mark("DpoitPass.layer");var d=this.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,d),u.bind(),this.dpoit.renderBlendBack(),xt&&this.webgl.timer.markEnd("DpoitPass.layer")}u.bind(),this.dpoit.render()}n.volumes.renderables.length>0&&t.renderDpoitVolume(n.volumes,r,this.depthTextureOpaque)},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(null===(o=this.wboit)||void 0===o||!o.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderWboitOpaque(n.primitives,r,null),zs.isEnabled(i)&&(zs.isTransparentOutlineEnabled(i)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,a,t.props.backgroundColor,i,t.light)),(n.opacityAverage<1||n.volumes.renderables.length>0)&&(this.wboit.bind(),n.opacityAverage<1&&t.renderWboitTransparent(n.primitives,r,this.depthTextureOpaque),n.volumes.renderables.length>0&&t.renderWboitTransparent(n.volumes,r,this.depthTextureOpaque),zs.isEnabled(i)?this.postprocessing.target.bind():this.colorTarget.bind(),this.wboit.render())},e.prototype._renderBlended=function(t,r,n,a,i,o){var s,u,c,l;if(a?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderBlendedOpaque(n.primitives,r,null),!a&&(this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),t.clearDepth(!0),t.renderDepthOpaque(n.primitives,r,null),this.colorTarget.bind()),zs.isEnabled(o)&&(this.packedDepth?null===(s=this.colorTarget.depthRenderbuffer)||void 0===s||s.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),zs.isTransparentOutlineEnabled(o)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,i,t.props.backgroundColor,o,t.light),this.packedDepth?null===(u=this.colorTarget.depthRenderbuffer)||void 0===u||u.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),n.volumes.renderables.length>0)){var d=zs.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth?null===(c=this.colorTarget.depthRenderbuffer)||void 0===c||c.detachFramebuffer(d.framebuffer):this.depthTextureOpaque.detachFramebuffer(d.framebuffer,"depth"),d.bind(),t.renderBlendedVolume(n.volumes,r,this.depthTextureOpaque),this.packedDepth?null===(l=this.colorTarget.depthRenderbuffer)||void 0===l||l.attachFramebuffer(d.framebuffer):this.depthTextureOpaque.attachFramebuffer(d.framebuffer,"depth"),d.bind()}n.opacityAverage<1&&t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o,s){var u=n.volumes.renderables.length>0,c=zs.isEnabled(s.postprocessing),l=zN.isEnabled(s.postprocessing),d=Pre.isEnabled(s.marking),f=r.viewport;t.setViewport(f.x,f.y,f.width,f.height),t.update(r,n),o&&!l&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s.postprocessing):this.dpoitEnabled?this._renderDpoit(t,r,n,s.dpoitIterations,o,s.postprocessing):this._renderBlended(t,r,n,!u&&!c&&!l&&i,o,s.postprocessing);var g=c?this.postprocessing.target:!i||u||this.wboitEnabled||this.dpoitEnabled?this.colorTarget:this.drawTarget;if(d&&n.markerAverage>0){var y=s.marking.ghostEdgeStrength<1;y&&1!==n.markerAverage&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r,null)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,y?this.marking.depthTarget.texture:null),this.marking.update(s.marking),this.marking.render(r.viewport,g)}else g.bind();a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera,a.camera.scene),t.renderBlended(a.camera.scene,a.camera.camera)),l?this.antialiasing.render(r,i,s.postprocessing):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),c?this.copyFboPostprocessing.render():(u||this.wboitEnabled||this.dpoitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n){xt&&this.webgl.timer.mark("DrawPass.render");var a=t.renderer,i=t.camera,o=t.scene,s=t.helper;this.postprocessing.setTransparentBackground(r.transparentBackground);var u=r.transparentBackground||this.postprocessing.background.isEnabled(r.postprocessing.background);a.setTransparentBackground(u),a.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),a.setPixelRatio(this.webgl.pixelRatio),_y.is(i)?(xt&&this.webgl.timer.mark("StereoCamera.left"),this._render(a,i.left,o,s,n,u,r),xt&&this.webgl.timer.markEnd("StereoCamera.left"),xt&&this.webgl.timer.mark("StereoCamera.right"),this._render(a,i.right,o,s,n,u,r),xt&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(a,i,o,s,n,u,r),xt&&this.webgl.timer.markEnd("DrawPass.render")},e.prototype.getColorTarget=function(t){return zN.isEnabled(t)?this.antialiasing.target:zs.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),CXe={alpha:T.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:T.Color(vr.red,{isEssential:!0}),colorY:T.Color(vr.green,{isEssential:!0}),colorZ:T.Color(vr.blue,{isEssential:!0}),scale:T.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:T.Select("bottom-left",T.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:T.Numeric(0),locationOffsetY:T.Numeric(0),originColor:T.Color(vr.grey),radiusScale:T.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:T.Boolean(!0),planeColorXY:T.Color(vr.grey,{label:"Plane Color XY"}),planeColorXZ:T.Color(vr.grey,{label:"Plane Color XZ"}),planeColorYZ:T.Color(vr.grey,{label:"Plane Color YZ"}),showLabels:T.Boolean(!1),labelX:T.Text("X"),labelY:T.Text("Y"),labelZ:T.Text("Z"),labelColorX:T.Color(vr.grey),labelColorY:T.Color(vr.grey),labelColorZ:T.Color(vr.grey),labelOpacity:T.Numeric(1,{min:0,max:1,step:.01}),labelScale:T.Numeric(.25,{min:.1,max:1,step:.01})},jT={axes:T.MappedStatic("on",{on:T.Group(CXe),off:T.Group({})},{cycle:!0,description:"Show camera orientation axes"})},Rre=function(){function e(t,r){void 0===r&&(r={});var n=this;this.webgl=t,this.props={axes:{name:"off",params:{}}},this.pixelRatio=1,this.eachGroup=function(a,i){if(!qN(a))return!1;var o=!1;if(n.meshRenderObject)for(var s=n.meshRenderObject.values.uGroupCount.ref.value,u=0,c=a.elements;u<c.length;u++){var l=c[u];i(_e.ofSingleton(l.instanceId*s+l.groupId))&&(o=!0)}if(n.textRenderObject){s=n.textRenderObject.values.uGroupCount.ref.value;for(var m=0,h=a.elements;m<h.length;m++){var v=h[m];i(_e.ofSingleton(v.instanceId*s+v.groupId))&&(o=!0)}}return o},this.scene=xy.create(t,DA),this.camera=new za,b.set(this.camera.up,0,1,0),b.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=eF(this.props,function(n){if(void 0!==t.axes&&(n.axes.name=t.axes.name,"on"===t.axes.name)){r.scene.clear(),r.pixelRatio=r.webgl.pixelRatio;var a=R(R({},t.axes.params),{scale:t.axes.params.scale*r.pixelRatio,labelScale:t.axes.params.labelScale*r.pixelRatio});r.meshRenderObject=function DXe(e){var t=function TXe(e,t){var r=100*e.scale,n=function AXe(e,t){var r=yt.createState(512,256,t),n=100*e.scale,a=e.radiusScale*n,i=e.showLabels?100*e.labelScale/3:0,o=b.scale(b(),b.unitX,n-i),s=b.scale(b(),b.unitY,n-i),u=b.scale(b(),b.unitZ,n-i),c={radiusTop:a,radiusBottom:a,radialSegments:32};if(r.currentGroup=yn.Origin,Mi(r,b.origin,a,2),r.currentGroup=yn.X,Mi(r,o,a,2),yo(r,b.origin,o,1,c),r.currentGroup=yn.Y,Mi(r,s,a,2),yo(r,b.origin,s,1,c),r.currentGroup=yn.Z,Mi(r,u,a,2),yo(r,b.origin,u,1,c),e.showPlanes){b.scale(o,o,.5),b.scale(s,s,.5),b.scale(u,u,.5),r.currentGroup=yn.XY,yt.addTriangle(r,b.origin,o,s),yt.addTriangle(r,b.origin,s,o);var l=b.add(b(),o,s);yt.addTriangle(r,l,o,s),yt.addTriangle(r,l,s,o),r.currentGroup=yn.XZ,yt.addTriangle(r,b.origin,o,u),yt.addTriangle(r,b.origin,u,o);var d=b.add(b(),o,u);yt.addTriangle(r,d,o,u),yt.addTriangle(r,d,u,o),r.currentGroup=yn.YZ,yt.addTriangle(r,b.origin,s,u),yt.addTriangle(r,b.origin,u,s);var f=b.add(b(),s,u);yt.addTriangle(r,f,s,u),yt.addTriangle(r,f,u,s)}return yt.getMesh(r)}(e,t?.geometry);n.setBoundingSphere(Pe.create(b.create(r/2,r/2,r/2),r+r/4));return qr.create("axes-mesh",{},n,function(i){switch(i){case yn.X:return e.colorX;case yn.Y:return e.colorY;case yn.Z:return e.colorZ;case yn.XY:return e.planeColorXY;case yn.XZ:return e.planeColorXZ;case yn.YZ:return e.planeColorYZ;case yn.Origin:return e.originColor;default:return vr.grey}},function(){return 1},function(){return""})}(e);return qr.createRenderObject(t,R(R(R({},T.getDefaultValues(Vt.Params)),e),{ignoreLight:!0}))}(a),r.scene.add(r.meshRenderObject),t.axes.params.showLabels?(r.textRenderObject=function PXe(e){var t=function IXe(e,t){var r=100*e.scale,n=function EXe(e,t){var r=Fd.create(e,8,8,t),n=100*e.scale,a=b.scale(b(),b.unitX,n),i=b.scale(b(),b.unitY,n),o=b.scale(b(),b.unitZ,n),s=100*e.labelScale;return r.add(e.labelX,a[0],a[1],a[2],0,s,yn.X),r.add(e.labelY,i[0],i[1],i[2],0,s,yn.Y),r.add(e.labelZ,o[0],o[1],o[2],0,s,yn.Z),r.getText()}(e,t?.geometry);n.setBoundingSphere(Pe.create(b.create(r/2,r/2,r/2),r));return qr.create("axes-text",{},n,function(i){switch(i){case yn.X:return e.labelColorX;case yn.Y:return e.labelColorY;case yn.Z:return e.labelColorZ;default:return vr.grey}},function(){return 1},function(){return""})}(e);return qr.createRenderObject(t,R(R(R({},T.getDefaultValues(zu.Params)),e),{alpha:e.labelOpacity}))}(a),r.scene.add(r.textRenderObject)):r.textRenderObject=void 0,r.scene.commit(),b.set(r.camera.position,0,0,200*a.scale),he.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=R({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return"on"===this.props.axes.name},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId;return(this.meshRenderObject&&r===this.meshRenderObject.id||this.textRenderObject&&r===this.textRenderObject.id)&&n!==yn.None?function _Xe(e,t,r){return yT("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return function xXe(e,t){var r=t.props.axes,n="on"===r.name?r.params.labelX:"X",a="on"===r.name?r.params.labelY:"Y",i="on"===r.name?r.params.labelZ:"Z";switch(e){case yn.X:return"".concat(n," Axis");case yn.Y:return"".concat(a," Axis");case yn.Z:return"".concat(i," Axis");case yn.XY:return"".concat(n).concat(a," Plane");case yn.XZ:return"".concat(n).concat(i," Plane");case yn.YZ:return"".concat(a).concat(i," Plane");case yn.Origin:return"Origin";default:return"Axes"}}(t,e)})}(this,n,t.instanceId):Wr},e.prototype.mark=function(t,r){return!(!ds.is(ds.Highlighting,r)||!(vu(t)||qN(t)&&t.data===this))&&(gr.mark(this.meshRenderObject,t,r,this.eachGroup)||gr.mark(this.textRenderObject,t,r,this.eachGroup))},e.prototype.update=function(t){if(this.meshRenderObject&&"off"!==this.props.axes.name){this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),function wXe(e,t,r){var i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,c=(o-i)/2,l=(s-u)/2,d=(o+i)/2,f=(s+u)/2,p=d-c,m=d+c,h=f+l,v=f-l;if(r.enabled){var g=(o-i)/r.width,y=(s-u)/r.height;m=(p+=g*r.offsetX)+g*r.width,v=(h-=y*r.offsetY)-y*r.height}he.ortho(e.projection,p,m,h,v,e.near,e.far)}(this.camera,t.viewport,t.viewOffset),he.extractRotation(this.scene.view,t.view);var r=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,a=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio;"bottom-left"===n?he.setTranslation(this.scene.view,b.create(-t.viewport.width/2+r+a,-t.viewport.height/2+r+i,0)):"bottom-right"===n?he.setTranslation(this.scene.view,b.create(t.viewport.width/2-r-a,-t.viewport.height/2+r+i,0)):"top-left"===n?he.setTranslation(this.scene.view,b.create(-t.viewport.width/2+r+a,t.viewport.height/2-r-i,0)):"top-right"===n?he.setTranslation(this.scene.view,b.create(t.viewport.width/2-r-a,t.viewport.height/2-r-i,0)):Sn()}},e}(),yn=function(e){return e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z",e[e.XY=4]="XY",e[e.XZ=5]="XZ",e[e.YZ=6]="YZ",e[e.Origin=7]="Origin",e}(yn||{});function qN(e){return"data-loci"===e.kind&&"camera-axes"===e.tag}var MXe={transparentBackground:T.Boolean(!1),dpoitIterations:T.Numeric(2,{min:1,max:10,step:1}),multiSample:T.Group(_re),postprocessing:T.Group(xre),marking:T.Group(Ire),cameraHelper:T.Group(jT)},RXe=function(){function e(t,r,n,a,i,o,s,u,c){this.webgl=t,this.renderer=n,this.scene=a,this.camera=i,this._width=0,this._height=0,this._camera=new za,this.props=R(R({},T.getDefaultValues(MXe)),c),this.drawPass=new Mre(t,r,128,128,s,u),this.multiSamplePass=new HT(t,this.drawPass),this.multiSampleHelper=new wre(this.multiSamplePass),this.helper={camera:new Rre(t,this.props.cameraHelper),debug:o.debug,handle:o.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.updateBackground=function(){var t=this;return new Promise(function(r){t.drawPass.postprocessing.background.update(t.camera,t.props.postprocessing.background,function(){r()})})},e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){void 0===t&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){za.copySnapshot(this._camera.state,this.camera.state),eo.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();var t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};HT.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=null!==(a=n?.width)&&void 0!==a?a:t,s=null!==(i=n?.height)&&void 0!==i?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var c=Xh.create(u,o,s);return Xh.flipY(c),Xh.divideByAlpha(c),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),OXe=R(R({},Vt.Params),{alpha:R(R({},Vt.Params.alpha),{defaultValue:1}),ignoreLight:R(R({},Vt.Params.ignoreLight),{defaultValue:!0}),colorX:T.Color(vr.red,{isEssential:!0}),colorY:T.Color(vr.green,{isEssential:!0}),colorZ:T.Color(vr.blue,{isEssential:!0}),scale:T.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),Ore={handle:T.MappedStatic("off",{on:T.Group(OXe),off:T.Group({})},{cycle:!0,description:"Show handle tool"})},FXe=function(){function e(t,r){void 0===r&&(r={});var n=this;this.webgl=t,this.props={handle:{name:"off",params:{}}},this.pixelRatio=1,this._transform=he(),this.eachGroup=function(a,i){if(!n.renderObject||!Fre(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,c=0,l=a.elements;c<l.length;c++){var d=l[c];i(_e.ofSingleton(d.instanceId*s+d.groupId))&&(o=!0)}return o},this.scene=xy.create(t,DA),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Pe.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),he.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,16*r),Pe.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=eF(this.props,function(n){if(void 0!==t.handle&&(n.handle.name=t.handle.name,"on"===t.handle.name)){r.scene.clear(),r.pixelRatio=r.webgl.pixelRatio;var a=R(R({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=function LXe(e){var t=function kXe(e,t){var r=10*e.scale,n=function BXe(e,t){var r=yt.createState(512,256,t),n=.05*e,a=b.scale(b(),b.unitX,e),i=b.scale(b(),b.unitY,e),o=b.scale(b(),b.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=_v.TranslateScreenXY,Mi(r,b.origin,3*n,2),r.currentGroup=_v.TranslateObjectX,Mi(r,a,n,2),yo(r,b.origin,a,1,s),r.currentGroup=_v.TranslateObjectY,Mi(r,i,n,2),yo(r,b.origin,i,1,s),r.currentGroup=_v.TranslateObjectZ,Mi(r,o,n,2),yo(r,b.origin,o,1,s),yt.getMesh(r)}(r,t?.geometry);n.setBoundingSphere(Pe.create(b.create(r/2,r/2,r/2),r+r/4));return qr.create("handle",{},n,function(i){switch(i){case _v.TranslateObjectX:return e.colorX;case _v.TranslateObjectY:return e.colorY;case _v.TranslateObjectZ:return e.colorZ;default:return vr.grey}},function(){return 1},function(){return""})}(e);return qr.createRenderObject(t,e)}(a),r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=R({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return"on"===this.props.handle.name},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),he.setTranslation(this.renderObject.values.aTransform.ref.value,r),he.fromMat3(this.renderObject.values.aTransform.ref.value,n),O.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){return this.renderObject&&t.objectId===this.renderObject.id?function NXe(e,t,r){return yT("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id ".concat(t," | Instance Id ").concat(r)})}(this,t.groupId,t.instanceId):Wr},e.prototype.mark=function(t,r){return!(!ds.is(ds.Highlighting,r)||!(vu(t)||Fre(t)&&t.data===this))&&gr.mark(this.renderObject,t,r,this.eachGroup)},e}(),_v={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function Fre(e){return"data-loci"===e.kind&&"handle"===e.tag}var YN,UXe={debug:T.Group(UN),camera:T.Group({helper:T.Group(jT)}),handle:T.Group(Ore)},VXe=T.getDefaultValues(UXe),GXe=function e(t,r,n){void 0===n&&(n={});var a=R(R({},VXe),n);this.debug=new EWe(t,r,a.debug),this.camera=new Rre(t,a.camera.helper),this.handle=new FXe(t,a.handle)},zXe=function(){function e(t,r,n){void 0===n&&(n={}),this.webgl=t;var a=t.gl;this.draw=new Mre(t,r,a.drawingBufferWidth,a.drawingBufferHeight,n.enableWboit||!1,n.enableDpoit||!1),this.pick=new QYe(t,this.draw,n.pickScale||.25),this.multiSample=new HT(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl,r=Math.max(t.drawingBufferWidth,2),n=Math.max(t.drawingBufferHeight,2);this.draw.setSize(r,n),this.pick.syncSize(),this.multiSample.syncSize()},e}(),Bre={camera:T.Group({mode:T.Select("perspective",T.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:T.Group(jT,{isFlat:!0}),stereo:T.MappedStatic("off",{on:T.Group(Are),off:T.Group({})},{cycle:!0,hideIf:function(e){return"perspective"!==e?.mode}}),fov:T.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:T.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:T.MappedStatic("on",{on:T.Group({intensity:T.Numeric(15,{min:1,max:100,step:1})}),off:T.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:T.Group({radius:T.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:T.Boolean(!0,{description:"Hide scene in the distance"}),minNear:T.Numeric(5,{min:.1,max:100,step:.1},{description:"Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:T.MappedStatic("canvas",{canvas:T.Group({}),"static-frame":T.Group({x:T.Numeric(0),y:T.Numeric(0),width:T.Numeric(128),height:T.Numeric(128)}),"relative-frame":T.Group({x:T.Numeric(.33,{min:0,max:1,step:.01}),y:T.Numeric(.33,{min:0,max:1,step:.01}),width:T.Numeric(.5,{min:.01,max:1,step:.01}),height:T.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:T.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:T.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:T.Boolean(!1),dpoitIterations:T.Numeric(2,{min:1,max:10,step:1}),multiSample:T.Group(_re),postprocessing:T.Group(xre),marking:T.Group(Ire),renderer:T.Group(FN),trackball:T.Group(sre),interaction:T.Group(fre),debug:T.Group(UN),handle:T.Group(Ore)},WN=T.getDefaultValues(Bre);!function(e){e.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,pickPadding:1,enableWboit:!0,enableDpoit:!1,preferWebGl1:!1},e.fromCanvas=function t(r,n,a){void 0===a&&(a={});var i=R(R({},e.DefaultAttribs),a);if(i.enableWboit&&i.enableDpoit)throw new Error("Multiple transparency methods not allowed.");var l=i.pixelScale,f=function jRe(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=(t?.preferWebGl1?null:r("webgl2"))||r("webgl")||r("experimental-webgl");return Cr&&console.log("isWebgl2: ".concat($t(n))),n}(r,{powerPreference:i.powerPreference,failIfMajorPerformanceCaveat:i.failIfMajorPerformanceCaveat,antialias:i.antialias,preserveDrawingBuffer:i.preserveDrawingBuffer,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:i.preferWebGl1});if(null===f)throw new Error("Could not create a WebGL rendering context");var p=ON.fromElement(r,{pixelScale:l,preventGestures:!0}),m=function KRe(e,t){var r=this;void 0===t&&(t={});var n=cX(e),a=function IPe(e,t){var r={},n=e.getParameter(e.FRONT_FACE),a=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),o=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),u=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),l=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),m=e.getParameter(e.BLEND_COLOR),h=e.getParameter(e.BLEND_EQUATION_RGB),v=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),y=e.getParameter(e.STENCIL_VALUE_MASK),S=e.getParameter(e.STENCIL_REF),C=e.getParameter(e.STENCIL_BACK_FUNC),_=e.getParameter(e.STENCIL_BACK_VALUE_MASK),x=e.getParameter(e.STENCIL_BACK_REF),D=e.getParameter(e.STENCIL_WRITEMASK),w=e.getParameter(e.STENCIL_BACK_WRITEMASK),A=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),M=e.getParameter(e.STENCIL_BACK_FAIL),F=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),N=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),j=e.getParameter(e.MAX_VERTEX_ATTRIBS),U=[],H=e.getParameter(e.VIEWPORT),z=e.getParameter(e.SCISSOR_BOX),G=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,J=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1,X=function(){for(var Z=0;Z<j;++Z)U[Z]=0};return X(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(Z){!0!==r[Z]&&(e.enable(Z),r[Z]=!0)},disable:function(Z){!1!==r[Z]&&(e.disable(Z),r[Z]=!1)},frontFace:function(Z){Z!==n&&(e.frontFace(Z),n=Z)},cullFace:function(Z){Z!==a&&(e.cullFace(Z),a=Z)},depthMask:function(Z){Z!==i&&(e.depthMask(Z),i=Z)},clearDepth:function(Z){Z!==o&&(e.clearDepth(Z),o=Z)},depthFunc:function(Z){Z!==s&&(e.depthFunc(Z),s=Z)},colorMask:function(Z,ne,Y,k){(Z!==u[0]||ne!==u[1]||Y!==u[2]||k!==u[3])&&(e.colorMask(Z,ne,Y,k),u[0]=Z,u[1]=ne,u[2]=Y,u[3]=k)},clearColor:function(Z,ne,Y,k){(Z!==c[0]||ne!==c[1]||Y!==c[2]||k!==c[3])&&(e.clearColor(Z,ne,Y,k),c[0]=Z,c[1]=ne,c[2]=Y,c[3]=k)},blendFunc:function(Z,ne){(Z!==l||ne!==d||Z!==f||ne!==p)&&(e.blendFunc(Z,ne),l=Z,d=ne,f=Z,p=ne)},blendFuncSeparate:function(Z,ne,Y,k){(Z!==l||ne!==d||Y!==f||k!==p)&&(e.blendFuncSeparate(Z,ne,Y,k),l=Z,d=ne,f=Y,p=k)},blendEquation:function(Z){(Z!==h||Z!==v)&&(e.blendEquation(Z),h=Z,v=Z)},blendEquationSeparate:function(Z,ne){(Z!==h||ne!==v)&&(e.blendEquationSeparate(Z,ne),h=Z,v=ne)},blendColor:function(Z,ne,Y,k){(Z!==m[0]||ne!==m[1]||Y!==m[2]||k!==m[3])&&(e.blendColor(Z,ne,Y,k),m[0]=Z,m[1]=ne,m[2]=Y,m[3]=k)},stencilFunc:function(Z,ne,Y){(Z!==g||ne!==S||Y!==y||Z!==C||ne!==x||Y!==_)&&(e.stencilFunc(Z,ne,Y),g=Z,S=ne,y=Y,C=Z,x=ne,_=Y)},stencilFuncSeparate:function(Z,ne,Y,k){Z===e.FRONT?(ne!==g||Y!==S||k!==y)&&(e.stencilFuncSeparate(Z,ne,Y,k),g=ne,S=Y,y=k):Z===e.BACK?(ne!==C||Y!==x||k!==_)&&(e.stencilFuncSeparate(Z,ne,Y,k),C=ne,x=Y,_=k):Z===e.FRONT_AND_BACK&&(ne!==g||Y!==S||k!==y||ne!==C||Y!==x||k!==_)&&(e.stencilFuncSeparate(Z,ne,Y,k),g=ne,S=Y,y=k,C=ne,x=Y,_=k)},stencilMask:function(Z){(Z!==D||Z!==w)&&(e.stencilMask(Z),D=Z,w=Z)},stencilMaskSeparate:function(Z,ne){Z===e.FRONT?ne!==D&&(e.stencilMaskSeparate(Z,ne),D=ne):Z===e.BACK?ne!==w&&(e.stencilMaskSeparate(Z,ne),w=ne):Z===e.FRONT_AND_BACK&&(ne!==D||ne!==w)&&(e.stencilMaskSeparate(Z,ne),D=ne,w=ne)},stencilOp:function(Z,ne,Y){(Z!==A||ne!==I||Y!==E||Z!==M||ne!==N||Y!==F)&&(e.stencilOp(Z,ne,Y),A=Z,I=ne,E=Y,M=Z,N=ne,F=Y)},stencilOpSeparate:function(Z,ne,Y,k){Z===e.FRONT?(ne!==A||Y!==I||k!==E)&&(e.stencilOpSeparate(Z,ne,Y,k),A=ne,I=Y,E=k):Z===e.BACK?(ne!==M||Y!==N||k!==F)&&(e.stencilOpSeparate(Z,ne,Y,k),M=ne,N=Y,F=k):Z===e.FRONT_AND_BACK&&(ne!==A||Y!==I||k!==E||ne!==M||Y!==N||k!==F)&&(e.stencilOpSeparate(Z,ne,Y,k),A=ne,I=Y,E=k,M=ne,N=Y,F=k)},enableVertexAttrib:function(Z){e.enableVertexAttribArray(Z),U[Z]=1},clearVertexAttribsState:X,disableUnusedVertexAttribs:function(){for(var Z=0;Z<j;++Z)0===U[Z]&&e.disableVertexAttribArray(Z)},viewport:function(Z,ne,Y,k){(Z!==H[0]||ne!==H[1]||Y!==H[2]||k!==H[3])&&(e.viewport(Z,ne,Y,k),H[0]=Z,H[1]=ne,H[2]=Y,H[3]=k)},scissor:function(Z,ne,Y,k){(Z!==z[0]||ne!==z[1]||Y!==z[2]||k!==z[3])&&(e.scissor(Z,ne,Y,k),z[0]=Z,z[1]=ne,z[2]=Y,z[3]=k)},clipControl:t.clipControl?function(Z,ne){(Z!==G||ne!==J)&&(t.clipControl.clipControl(Z,ne),G=Z,J=ne)}:void 0,reset:function(){r={},n=e.getParameter(e.FRONT_FACE),a=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),o=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),u=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),l=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),m=e.getParameter(e.BLEND_COLOR),h=e.getParameter(e.BLEND_EQUATION_RGB),v=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),y=e.getParameter(e.STENCIL_VALUE_MASK),S=e.getParameter(e.STENCIL_REF),C=e.getParameter(e.STENCIL_BACK_FUNC),_=e.getParameter(e.STENCIL_BACK_VALUE_MASK),x=e.getParameter(e.STENCIL_BACK_REF),D=e.getParameter(e.STENCIL_WRITEMASK),w=e.getParameter(e.STENCIL_BACK_WRITEMASK),A=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),M=e.getParameter(e.STENCIL_BACK_FAIL),F=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),N=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),j=e.getParameter(e.MAX_VERTEX_ATTRIBS),U.length=0;for(var Z=0;Z<j;++Z)U[Z]=0;H=e.getParameter(e.VIEWPORT),z=e.getParameter(e.SCISSOR_BOX),G=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,J=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}(e,n),i={resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,counts:0}},o=NRe(e,a,i,n),s=function zRe(e,t,r,n){var a,i=t.disjointTimerQuery,o=null!==(a=n?.avgCount)&&void 0!==a?a:30,s=new Map,u=new Map,c=[],l=new wX(o),d=new wX(o),f=[],p=null,m=!1,h=function(){i&&(s.forEach(function(g,y){i.deleteQuery(y)}),u.clear(),f=[],p=null)},v=function(){if(i){var g=function GRe(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}(t);g&&(i.beginQuery(i.TIME_ELAPSED,g),u.forEach(function(y,S){y.queries.push(g)}),s.set(g,{refCount:u.size}),p=g)}};return{resolve:function(){var g=[];if(!i||!f.length)return g;s.forEach(function(D,w){if(void 0===D.timeElapsed){var A=i.getQueryParameter(w,i.QUERY_RESULT_AVAILABLE),E=e.getParameter(i.GPU_DISJOINT);if(A&&!E){var I=i.getQueryParameter(w,i.QUERY_RESULT);D.timeElapsed=I}(A||E)&&i.deleteQuery(w)}});for(var y=[],S=function(D){if(D.queries.every(function(U){var H;return void 0!==(null===(H=s.get(U))||void 0===H?void 0:H.timeElapsed)})){for(var w=0,A=0,E=D.queries;A<E.length;A++){var M=s.get(E[A]);w+=M.timeElapsed,M.refCount-=1}if(D.timeElapsed=w,D.root){var F=[],N=function(U,H){for(var z=0,G=U;z<G.length;z++){var J=G[z],X=J.timeElapsed,Z=J.cpu.end-J.cpu.start,ne={label:J.label,gpuElapsed:X,gpuAvg:l.add(J.label,X),cpuElapsed:Z,cpuAvg:d.add(J.label,Z),children:[],calls:J.calls};H.push(ne),N(J.children,ne.children)}};N(D.children,F);var j=D.cpu.end-D.cpu.start;g.push({label:D.label,gpuElapsed:w,gpuAvg:l.add(D.label,w),cpuElapsed:j,cpuAvg:d.add(D.label,j),children:F,calls:D.calls})}}else y.push(D)},C=0,_=f;C<_.length;C++)S(_[C]);return f=y,s.forEach(function(D,w){0===D.refCount&&s.delete(w)}),g},mark:function(g,y){if(void 0===y&&(y=!1),i){if(u.has(g))throw new Error("Timer mark for '".concat(g,"' already exists"));null!==p&&i.endQuery(i.TIME_ELAPSED);var S={label:g,queries:[],children:[],root:null===p,cpu:{start:ia(),end:-1},captureCalls:y};if(u.set(g,S),c.length&&c[c.length-1].children.push(S),c.push(S),y){if(m)throw new Error("Already capturing calls");(function VRe(e){e.calls.drawInstanced=0,e.calls.counts=0})(r),m=!0}v()}},markEnd:function(g){var y;if(i){var S=u.get(g);if(!S)throw new Error("Timer mark for '".concat(g,"' does not exist"));if((null===(y=c.pop())||void 0===y?void 0:y.label)!==g)throw new Error("Timer mark for '".concat(g,"' has pending nested mark"));i.endQuery(i.TIME_ELAPSED),u.delete(g),S.cpu.end=ia(),S.captureCalls&&(S.calls={drawInstanced:r.calls.drawInstanced,counts:r.calls.counts},m=!1),f.push(S),u.size>0?v():p=null}},stats:function(){return{gpu:l.stats(),cpu:d.stats()}},formatedStats:function(){for(var g={},y=l.stats(),S=d.stats(),C=0,_=Object.keys(y);C<_.length;C++){var x=_[C],D="".concat((y[x]/1e3/1e3).toFixed(2)),w="".concat(S[x].toFixed(2));g[x]="".concat(D," ms | CPU: ").concat(w," ms")}return g},clear:h,destroy:function(){h()}}}(e,n,i),u={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:$t(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(u.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var c=n.provokingVertex;c?.provokingVertex(c.FIRST_VERTEX_CONVENTION);var f,l=!1,d=new Ai(0);if($t(e)){var p=e.createBuffer(),m=void 0,h=void 0,v=!1,g=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,p),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,m),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,h(),h=void 0,m=void 0};f=function(S,C,_,x,D){return new Promise(function(w,A){v?A("Can not call multiple readPixelsAsync at the same time"):(v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,p),e.bufferData(e.PIXEL_PACK_BUFFER,_*x*4,e.STREAM_READ),e.readPixels(S,C,_,x,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),h=w,m=D,PX(e,g))})}}else f=function(S,C,_,x,D){return ue(r,void 0,void 0,function(){return ce(this,function(w){return VF(e,S,C,_,x,D),[2]})})};var y=new Set;return{gl:e,isWebGL2:$t(e),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,timer:s,get maxTextureSize(){return u.maxTextureSize},get max3dTextureSize(){return u.max3dTextureSize},get maxRenderbufferSize(){return u.maxRenderbufferSize},get maxDrawBuffers(){return u.maxDrawBuffers},get maxTextureImageUnits(){return u.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return l||e.isContextLost()},contextRestored:d,setContextLost:function(){l=!0},handleContextRestored:function(S){Object.assign(n,cX(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),y.forEach(function(C){return C.reset()}),S?.(),l=!1,d.next(ia())},createRenderTarget:function(S,C,_,x,D,w){var A=function kRe(e,t,r,n,a,i,o,s){if(void 0===a&&(a=!0),void 0===i&&(i="uint8"),void 0===o&&(o="nearest"),void 0===s&&(s="rgba"),"alpha"===s&&!$t(e))throw new Error("cannot render to alpha format in webgl1");var u=t.framebuffer(),c="fp16"===i?t.texture("image-float16",s,"fp16",o):"float32"===i?t.texture("image-float32",s,"float",o):t.texture("image-uint8",s,"ubyte",o),l=a?$t(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function d(){c.define(r,n),c.attachFramebuffer(u,"color0"),l&&l.attachFramebuffer(u)}d();var f=!1;return{id:_X(),texture:c,framebuffer:u,depthRenderbuffer:l,getWidth:function(){return r},getHeight:function(){return n},bind:function(){u.bind()},setSize:function(p,m){r===p&&n===m||(c.define(r=p,n=m),l&&l.setSize(r,n))},reset:function(){d()},destroy:function(){f||(c.destroy(),u.destroy(),l&&l.destroy(),f=!0)}}}(e,o,S,C,_,x,D,w);return y.add(A),R(R({},A),{destroy:function(){A.destroy(),y.delete(A)}})},unbindFramebuffer:function(){return pA(e)},readPixels:function(S,C,_,x,D){VF(e,S,C,_,x,D)},readPixelsAsync:f,waitForGpuCommandsComplete:function(){return function WRe(e){return new Promise(function(t){$t(e)?PX(e,t):(MX||(console.info("Sync object not supported in WebGL"),MX=!0),RX(e),t())})}(e)},waitForGpuCommandsCompleteSync:function(){return RX(e)},getDrawingBufferPixelData:function(){return function YRe(e,t){var r=e.drawingBufferWidth,n=e.drawingBufferHeight,a=new Uint8Array(r*n*4);return pA(e),t.viewport(0,0,r,n),VF(e,0,0,r,n,a),Xh.flipY(Xh.create(a,r,n))}(e,a)},clear:function(S,C,_,x){pA(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(S,C,_,x),a.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),a.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(S){var C,_;o.destroy(),function qRe(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),$t(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);var a=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),pA(e)}(e),S?.doNotForceWebGLContextLoss||(null===(C=e.getExtension("WEBGL_lose_context"))||void 0===C||C.loseContext(),null===(_=e.getExtension("STACKGL_destroy_context"))||void 0===_||_.destroy())}}}(f,{pixelScale:l}),h=new zXe(m,n,i);if(Cr){var v=f.getExtension("WEBGL_lose_context");v&&r.addEventListener("mousedown",function(C){m.isContextLost||!C.shiftKey||!C.ctrlKey||!C.altKey||(Cr&&console.log("lose context"),v.loseContext(),setTimeout(function(){m.isContextLost&&(Cr&&console.log("restore context"),v.restoreContext())},1e3))},!1)}var g=new Ai(0),y=function(C){m.setContextLost(),C.preventDefault(),Cr&&console.log("context lost"),g.next(ia())},S=function(){m.isContextLost&&(m.handleContextRestored(function(){h.draw.reset()}),Cr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",y,!1),r.addEventListener("webglcontextrestored",S,!1),{canvas:r,webgl:m,input:p,passes:h,attribs:i,contextLost:g,contextRestored:m.contextRestored,assetManager:n,dispose:function(C){p.dispose(),r.removeEventListener("webglcontextlost",y,!1),r.removeEventListener("webglcontextrestored",S,!1),m.destroy(C)}}}}(YN||(YN={}));var XN,HXe=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},Nre=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)};function jXe(e){kre(e)}function kre(e){yr.Canvas3D.ResetSettings.subscribe(e,function(){var t;null===(t=e.canvas3d)||void 0===t||t.setProps(WN),e.events.canvas3d.settingsUpdated.next(void 0)}),yr.Canvas3D.SetSettings.subscribe(e,function(t){var r;e.canvas3d&&(null===(r=e.canvas3d)||void 0===r||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}!function(e){e.create=function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs,u=r.assetManager;void 0===n&&(n={});var c=R(R({},fl(WN)),fl(n)),l=new Map,d=new Map,f=new Ai(0),p=ia(),m=new Ai(0),h=new Ai(0),v=new Ai(0),g=a.gl,y=a.contextRestored,S=0,C=0,_=128,x=128,D=!1,w=0;St();var A=xy.create(a,o.draw.dpoitEnabled?u4e:o.draw.wboitEnabled?s4e:DA);function E(){return A.boundingSphere.radius*c.sceneRadiusFactor}var I=new za({position:b.create(0,0,100),mode:c.camera.mode,fog:"on"===c.cameraFog.name?c.cameraFog.params.intensity:0,clipFar:c.cameraClipping.far,minNear:c.cameraClipping.minNear,fov:Yr(c.camera.fov)},{x:S,y:C,width:_,height:x},{pixelScale:s.pixelScale}),M=new _y(I,c.camera.stereo.params),F=kN.create(i,I,A,c.trackball),N=NN.create(a,c.renderer),j=new GXe(a,A,c),U=new $Ye(a,N,A,j,o.pick,{x:S,y:C,width:_,height:x},s.pickPadding),H=new BWe(xe,Y,i,I,F,c.interaction),z=new wre(o.multiSample);o.draw.postprocessing.background.update(I,c.postprocessing.background,function(Le){Le&&pe()});var G=!1,J=void 0,X=void 0,Z=!1,ne=!0;function Y(Le){var it=Wr,Ct=lr.Empty;if(Le){var bt=j.camera.getLoci(Le);if(bt!==Wr)return{loci:bt,repr:Ct};it=j.handle.getLoci(Le),l.forEach(function(Mt,Rt){var oe=Rt.getLoci(Le);fs(oe)||(fs(it)||console.warn("found another loci, this should not happen"),it=oe,Ct=Rt)})}return{loci:it,repr:Ct}}var k=[];function K(Le,it){var Ct=Le.repr,bt=Le.loci,Mt=!1;return Ct?Mt=Ct.mark(bt,it)||Mt:l.forEach(function(Rt,oe){Mt=oe.mark(bt,it)||Mt}),Mt=j.handle.mark(bt,it)||Mt,Mt=j.camera.mark(bt,it)||Mt}var V=!1,ee=!1;function ae(Le){ee||function q(Le){if(a.isContextLost)return!1;var it=!1;if(Z&&(ut(!1),Z=!1,it=!0),S>g.drawingBufferWidth||S+_<0||C>g.drawingBufferHeight||C+x<0)return!1;var Ct=function $(){for(var Le=!1,it=0,Ct=k;it<Ct.length;it++){var bt=Ct[it];Le=K(bt[0],bt[1])||Le}return k=[],Le&&(A.update(void 0,!0),j.handle.scene.update(void 0,!0),j.camera.scene.update(void 0,!0)),Le}()&&(N.props.colorMarker||c.marking.enabled),bt=!1;F.update(w);var Mt=I.update(),Rt=Le||Mt||it||D;D=!1;var oe=z.update(Ct||Rt,c.multiSample);if(Rt||oe||Ct){var be=I;"on"===c.camera.stereo.name&&(M.update(),be=M),xt&&a.timer.mark("Canvas3D.render",!0);var Ce={renderer:N,camera:be,scene:A,helper:j};HT.isEnabled(c.multiSample)?z.render(Ce,c,!0,c.multiSample.reduceFlicker&&!Mt&&Ct&&!F.isAnimating):o.draw.render(Ce,c,!0),xt&&a.timer.markEnd("Canvas3D.render"),U.dirty=U.dirty||Rt,bt=!0}return bt}(!!Le?.force)&&ne&&m.next(ia()-p)}function pe(){D=!0}var me=0;function de(Le,it){w=Le,Ge(it?.isSynchronous),I.transition.tick(w),!it?.manualDraw&&(ae(),!I.transition.inTransition&&!a.isContextLost&&H.tick(w))}function re(){de(ia()),me=HXe(re)}function xe(Le,it){return a.isContextLost?void 0:U.identify(Le,it,"on"===c.camera.stereo.name?M:I)}function Ge(Le){void 0===Le&&(Le=!1);var it=function De(Le){return!A.needsCommit||(Pe.copy(L,A.boundingSphereVisible),A.commit(Le?void 0:we)?(v.next(0),j.debug.isEnabled&&j.debug.update(),!c.camera.manualReset&&(0===f.value||function ye(){if(0===I.state.radiusMax)return!0;if(I.transition.inTransition||X)return!1;var Le=!0,it=!0;Pe.set(Q,I.state.target,I.state.radius);for(var Ct=0,bt=A.renderables;Ct<bt.length;Ct++){var Mt=bt[Ct];if(Mt.state.visible){var Rt=Mt.values.boundingSphere.ref.value;if(Rt.radius){it=!1;var oe=b.distance(Q.center,Rt.center);if((oe>Q.radius||oe>Rt.radius||Rt.radius>I.state.radiusMax)&&!Pe.includes(L,Rt))return!0;Pe.overlaps(Q,Rt)&&(Le=!1)}}}return Le||!it&&Q.radius<=.1}())&&(G=!0),0===L.radius&&(J=0),c.camera.manualReset||I.setState({radiusMax:E()},0),f.next(l.size),Cr&&Oe(),!0):(v.next(A.commitQueueSize),!1))}(Le);it&&(function je(){if(G){var Le=A.boundingSphereVisible,it=Le.center,Ct=Le.radius,bt=F.props.autoAdjustMinMaxDistance;if("on"===bt.name){var Mt=bt.params.minDistanceFactor*Ct+bt.params.minDistancePadding,Rt=Math.max(bt.params.maxDistanceFactor*Ct,bt.params.maxDistanceMin);F.setProps({minDistance:Mt,maxDistance:Rt})}if(Ct>0){var oe=void 0===J?c.cameraResetDurationMs:J,be=I.getFocus(it,Ct),Ce="function"==typeof X?X(A,I):X,Qe=Ce?R(R({},be),Ce):be;I.setState(R(R({},Qe),{radiusMax:E()}),oe)}J=void 0,X=void 0,G=!1}}(),V&&(j.debug.isEnabled&&j.debug.update(),ae({force:!0}),V=!1),h.next(ia()))}var L=Pe(),Q=Pe(),we=250;function Oe(){var Le=A.renderables.map(function(Rt){return{drawCount:Rt.values.drawCount.ref.value,instanceCount:Rt.values.instanceCount.ref.value,materialId:Rt.materialId,renderItemId:Rt.id}});console.groupCollapsed("".concat(Le.length," RenderItems")),Le.length<50?console.table(Le):console.log(Le),console.log(JSON.stringify(a.stats,void 0,4));var it=a.resources.getByteCounts(),bt=it.attribute,Mt=it.elements;console.log(JSON.stringify({texture:"".concat((it.texture/1024/1024).toFixed(3)," MiB"),attribute:"".concat((bt/1024/1024).toFixed(3)," MiB"),elements:"".concat((Mt/1024/1024).toFixed(3)," MiB")},void 0,4)),console.log(JSON.stringify(a.timer.formatedStats(),void 0,4)),console.groupEnd()}function He(){var Le=A.boundingSphere.radius>0?100-Math.round(I.transition.target.radius/E()*100):0;return{camera:{mode:I.state.mode,helper:R({},j.camera.props),stereo:R({},c.camera.stereo),fov:Math.round(Ru(I.state.fov)),manualReset:!!c.camera.manualReset},cameraFog:I.state.fog>0?{name:"on",params:{intensity:I.state.fog}}:{name:"off",params:{}},cameraClipping:{far:I.state.clipFar,radius:Le,minNear:I.state.minNear},cameraResetDurationMs:c.cameraResetDurationMs,sceneRadiusFactor:c.sceneRadiusFactor,transparentBackground:c.transparentBackground,dpoitIterations:c.dpoitIterations,viewport:c.viewport,postprocessing:R({},c.postprocessing),marking:R({},c.marking),multiSample:R({},c.multiSample),renderer:R({},N.props),trackball:R({},F.props),interaction:R({},H.props),debug:R({},j.debug.props),handle:R({},j.handle.props)}}var Je=y.subscribe(function(){U.dirty=!0,ae({force:!0}),ae({force:!0})}),mt=new Ai(0);function ut(Le){void 0===Le&&(Le=!0),o.updateSize(),St(),wt(),Le&&pe(),mt.next(+new Date)}return function bwe(e){cS.includes(e)||cS.push(e)}(Oe),{webgl:a,add:function Ne(Le){!function $e(Le){d.has(Le)||d.set(Le,Le.updated.subscribe(function(it){Le.state.syncManually||Ne(Le)}))}(Le);var it=l.get(Le),Ct=new Set;Le.renderObjects.forEach(function(bt){return Ct.add(bt)}),it?sa.areEqual(Ct,it)||(Ct.forEach(function(bt){it.has(bt)||A.add(bt)}),it.forEach(function(bt){Ct.has(bt)||A.remove(bt)})):Le.renderObjects.forEach(function(bt){return A.add(bt)}),l.set(Le,Ct),A.update(Le.renderObjects,!1),V=!0,Cr&&Oe()},remove:function Ue(Le){!function Ie(Le){var it=d.get(Le);it&&(it.unsubscribe(),d.delete(Le))}(Le);var it=l.get(Le);it&&(it.forEach(function(Ct){return A.remove(Ct)}),l.delete(Le),V=!0,Cr&&Oe())},commit:Ge,update:function(Le,it){if(Le){if(!l.has(Le))return;A.update(Le.renderObjects,!!it)}else A.update(void 0,!!it);V=!0},clear:function(){d.forEach(function(Le){return Le.unsubscribe()}),d.clear(),l.clear(),A.clear(),j.debug.clear(),pe(),f.next(l.size)},syncVisibility:function(){0===I.state.radiusMax&&(G=!0,J=0),A.syncVisibility()&&j.debug.isEnabled&&j.debug.update(),pe()},requestDraw:pe,tick:de,animate:function le(){ee=!1,F.start(ia()),0===me&&re()},resetTime:function te(Le){p=Le,F.start(Le)},pause:function ge(Le){void 0===Le&&(Le=!1),ee=Le,Nre(me),me=0},resume:function(){ee=!1},identify:xe,mark:function W(Le,it){k.push([Le,it])},getLoci:Y,handleResize:ut,requestResize:function(){Z=!0},requestCameraReset:function(Le){J=Le?.durationMs,X=Le?.snapshot,G=!0},camera:I,boundingSphere:A.boundingSphere,boundingSphereVisible:A.boundingSphereVisible,get notifyDidDraw(){return ne},set notifyDidDraw(Le){ne=Le},didDraw:m,commited:h,commitQueueSize:v,reprCount:f,resized:mt,setProps:function(Le,it){var Ct,bt,Mt,Rt;void 0===it&&(it=!1);var oe="function"==typeof Le?AS(He(),Le):Le;void 0!==oe.sceneRadiusFactor&&(c.sceneRadiusFactor=oe.sceneRadiusFactor,I.setState({radiusMax:E()},0));var be=Object.create(null);oe.camera&&void 0!==oe.camera.mode&&oe.camera.mode!==I.state.mode&&(be.mode=oe.camera.mode);var Ce=Math.round(Ru(I.state.fov));if(oe.camera&&void 0!==oe.camera.fov&&oe.camera.fov!==Ce&&(be.fov=Yr(oe.camera.fov)),void 0!==oe.cameraFog&&oe.cameraFog.params){var Qe="on"===oe.cameraFog.name?oe.cameraFog.params.intensity:0;Qe!==I.state.fog&&(be.fog=Qe)}if(void 0!==oe.cameraClipping&&(void 0!==oe.cameraClipping.far&&oe.cameraClipping.far!==I.state.clipFar&&(be.clipFar=oe.cameraClipping.far),void 0!==oe.cameraClipping.minNear&&oe.cameraClipping.minNear!==I.state.minNear&&(be.minNear=oe.cameraClipping.minNear),void 0!==oe.cameraClipping.radius)){var Et=E()/100*(100-oe.cameraClipping.radius);Et>0&&Et!==be.radius&&(be.radius=Math.max(Et,.01))}Object.keys(be).length>0&&I.setState(be),!(null===(Ct=oe.camera)||void 0===Ct)&&Ct.helper&&j.camera.setProps(oe.camera.helper),void 0!==(null===(bt=oe.camera)||void 0===bt?void 0:bt.manualReset)&&(c.camera.manualReset=oe.camera.manualReset),void 0!==(null===(Mt=oe.camera)||void 0===Mt?void 0:Mt.stereo)&&(Object.assign(c.camera.stereo,oe.camera.stereo),M.setProps(c.camera.stereo.params)),void 0!==oe.cameraResetDurationMs&&(c.cameraResetDurationMs=oe.cameraResetDurationMs),void 0!==oe.transparentBackground&&(c.transparentBackground=oe.transparentBackground),void 0!==oe.dpoitIterations&&(c.dpoitIterations=oe.dpoitIterations),void 0!==oe.viewport&&(c.viewport===oe.viewport||c.viewport.name===oe.viewport.name&&R1(c.viewport.params,oe.viewport.params)||(c.viewport=oe.viewport,St(),wt())),!(null===(Rt=oe.postprocessing)||void 0===Rt)&&Rt.background&&(Object.assign(c.postprocessing.background,oe.postprocessing.background),o.draw.postprocessing.background.update(I,c.postprocessing.background,function(Zt){Zt&&!it&&pe()})),oe.postprocessing&&Object.assign(c.postprocessing,oe.postprocessing),oe.marking&&Object.assign(c.marking,oe.marking),oe.multiSample&&Object.assign(c.multiSample,oe.multiSample),oe.renderer&&N.setProps(oe.renderer),oe.trackball&&F.setProps(oe.trackball),oe.interaction&&H.setProps(oe.interaction),oe.debug&&j.debug.setProps(oe.debug),oe.handle&&j.handle.setProps(oe.handle),"orthographic"===be.mode&&(c.camera.stereo.name="off"),it||pe()},getImagePass:function(Le){return void 0===Le&&(Le={}),new RXe(a,u,N,A,I,j,o.draw.wboitEnabled,o.draw.dpoitEnabled,Le)},getRenderObjects:function(){var Le=[];return A.forEach(function(it,Ct){return Le.push(Ct)}),Le},get props(){return He()},get input(){return i},get stats(){return N.stats},get interaction(){return H.events},dispose:function(){Je.unsubscribe(),Nre(me),k=[],A.clear(),j.debug.clear(),F.dispose(),N.dispose(),H.dispose(),function Swe(e){var t=cS.indexOf(e);-1!==t&&cS.splice(t,1)}(Oe)}};function St(){var Le=S,it=C,Ct=_,bt=x;"canvas"===c.viewport.name?(S=0,C=0,_=g.drawingBufferWidth,x=g.drawingBufferHeight):"static-frame"===c.viewport.name?(S=c.viewport.params.x*a.pixelRatio,C=g.drawingBufferHeight-(x=c.viewport.params.height*a.pixelRatio)-c.viewport.params.y*a.pixelRatio,_=c.viewport.params.width*a.pixelRatio):"relative-frame"===c.viewport.name&&(S=Math.round(c.viewport.params.x*g.drawingBufferWidth),x=Math.round(c.viewport.params.height*g.drawingBufferHeight),C=Math.round(g.drawingBufferHeight-x-c.viewport.params.y*g.drawingBufferHeight),_=Math.round(c.viewport.params.width*g.drawingBufferWidth)),(Le!==S||it!==C||Ct!==_||bt!==x)&&(D=!0)}function wt(){U.setViewport(S,C,_,x),N.setViewport(S,C,_,x),eo.set(I.viewport,S,C,_,x),eo.set(F.viewport,S,C,_,x)}}}(XN||(XN={}));var wv=Ga,Pm=$u,Av=Dt.Trigger,qXe={hoverHighlightOnly:Dt([Av(wv.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:Dt([Av(wv.Flag.None,Pm.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},WXe={bindings:T.Value(qXe,{isHidden:!0}),ignore:T.Value([],{isHidden:!0}),preferAtoms:T.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:T.Boolean(!0)},YXe=$r.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a)},r}return jt(t,e),t.prototype.getLoci=function(r){return this.params.preferAtoms&&zt.isLoci(r)&&2===r.bonds.length?zt.toFirstStructureElementLoci(r):r},t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a=n.current,i=n.buttons,o=n.modifiers;if(r.ctx.canvas3d&&!r.ctx.isBusy){var s=r.getLoci(a.loci);if(r.params.ignore.includes(s.kind))return void r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Wr});var u=!1;Dt.match(r.params.bindings.hoverHighlightOnly,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:s}),u=!0),Dt.match(r.params.bindings.hoverHighlightOnlyExtend,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:s}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Wr})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}($r.Handler),params:function(){return WXe},display:{name:"Highlight Loci on Canvas"}}),Lre={clickSelect:Dt.Empty,clickToggleExtend:Dt([Av(wv.Flag.Primary,Pm.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickSelectOnly:Dt.Empty,clickToggle:Dt([Av(wv.Flag.Primary,Pm.create())],"Toggle selection","Click on element using ${triggers}"),clickDeselect:Dt.Empty,clickDeselectAllOnEmpty:Dt([Av(wv.Flag.Primary,Pm.create())],"Deselect all","Click on nothing using ${triggers}")},XXe={bindings:T.Value(Lre,{isHidden:!0}),ignore:T.Value([],{isHidden:!0}),preferAtoms:T.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:T.Boolean(!0)},KXe=$r.create({name:"representation-select-loci",category:"interaction",ctor:function(e){function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o)},a.spine=new Lw.Impl(r.state.data.cells),a}return jt(t,e),t.prototype.getLoci=function(r){return this.params.preferAtoms&&zt.isLoci(r)&&2===r.bonds.length?zt.toFirstStructureElementLoci(r):r},t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&ve.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(ve.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:Ze.Loci(i.data)},Ut.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},Ut.Select)}}},t.prototype.register=function(){var r=this,a=function(o){return!fr.isEmpty(o)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},function(o){return fr.isEmpty(o)}]];i.sort(function(o,s){var u=r.params.bindings[o[0]],c=r.params.bindings[s[0]],l=0===u.triggers.length?0:id(u.triggers.map(function(f){return Pm.size(f.modifiers)}));return(0===c.triggers.length?0:id(c.triggers.map(function(f){return Pm.size(f.modifiers)})))-l}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s=o.current,u=o.button,c=o.modifiers;if(r.ctx.canvas3d&&!r.ctx.isBusy&&r.ctx.selectionMode){var l=r.getLoci(s.loci);if(!r.params.ignore.includes(l.kind))for(var d=0,f=i;d<f.length;d++){var p=f[d],h=p[1],v=p[2];if(Dt.match(r.params.bindings[p[0]],u,c)&&(!v||v(l))){h({repr:s.repr,loci:l});break}}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){return r.applySelectMark(o.ref)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,c=o.oldObj,l=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ve.Molecule.Structure.is(f.obj)){var p=u.data,m="recreate"===d?c?.data:"in-place"===d?l:void 0;if(m&&Ze.areEquivalent(p,m)&&Ze.areHierarchiesEqual(p,m))return;for(var v=0,g=r.ctx.state.data.select(xr.children(s).ofType(ve.Molecule.Structure.Representation3D));v<g.length;v++)r.applySelectMark(g[v].transform.ref,!0)}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}($r.Handler),params:function(){return XXe},display:{name:"Select Loci on Canvas"}}),ZXe=$r.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Re.is(r)){for(var a=new Set,i=0,o=r.elements;i<o.length;i++){var s=o[i].unit,u=at.create(r.structure,s,s.elements[0]),c=ot.entity.pdbx_description(u).join(", ");a.add(c)}1===a.size&&a.forEach(function(l){return n.push(l)})}return n.push(DT(r)),n.filter(function(l){return!!l}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),Ure={clickFocus:Dt([Av(wv.Flag.Primary,Pm.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:Dt([Av(wv.Flag.Primary,Pm.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:Dt([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:Dt([],"Representation Focus Add","Click element using ${triggers}")},QXe={bindings:T.Value(Ure,{isHidden:!0})},$Xe=$r.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocusAdd,f=u.clickFocusAddSelectMode,p=r.ctx.managers.interactivity.props.granularity;if("residue"===p||"element"===p){var h=Dt.match(r.ctx.selectionMode?u.clickFocusSelectMode:u.clickFocus,o,s),g=Dt.match(r.ctx.selectionMode?f:l,o,s);if(h||g){var y=fr.normalize(i.loci,"residue"),S=r.ctx.managers.structure.focus.current;if(S&&fr.areEqual(S.loci,y))r.ctx.managers.structure.focus.clear();else if(h)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var C=null===(a=r.ctx.managers.structure.focus.current)||void 0===a?void 0:a.loci;C&&r.ctx.managers.camera.focusLoci(C)}}}})},t}($r.Handler),params:function(){return QXe},display:{name:"Representation Focus Loci on Canvas"}}),kd=Ga,Al=$u,Ld=Dt.Trigger,qT=Dt.TriggerKey,KN=Dt([Ld(kd.Flag.Primary,Al.create()),Ld(kd.Flag.Secondary,Al.create()),Ld(kd.Flag.Primary,Al.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),ZN=Dt([Ld(kd.Flag.Secondary,Al.create()),Ld(kd.Flag.Primary,Al.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),Vre={clickCenterFocus:Dt([Ld(kd.Flag.Primary,Al.create()),Ld(kd.Flag.Secondary,Al.create()),Ld(kd.Flag.Primary,Al.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:Dt([Ld(kd.Flag.Secondary,Al.create()),Ld(kd.Flag.Primary,Al.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickResetCameraOnEmpty:KN,clickResetCameraOnEmptySelectMode:ZN},JXe={minRadius:T.Numeric(8,{min:1,max:50,step:1}),extraRadius:T.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:T.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:T.Value(Vre,{isHidden:!0})},eKe=$r.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i,o=n.current,s=n.button,u=n.modifiers;if(r.ctx.canvas3d){var c=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus,l=r.ctx.selectionMode?null!==(a=r.params.bindings.clickResetCameraOnEmptySelectMode)&&void 0!==a?a:ZN:null!==(i=r.params.bindings.clickResetCameraOnEmpty)&&void 0!==i?i:KN;if(fr.isEmpty(o.loci)&&Dt.match(l,s,u))return void yr.Camera.Reset(r.ctx,{});if(Dt.match(c,s,u)){var d=fr.normalize(o.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(d,r.params)}}})},t}($r.Handler),params:function(){return JXe},display:{name:"Camera Focus Loci on Canvas"}}),tKe=$r.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t.prototype.register=function(){var r=this,n=yn.None,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(r.ctx.canvas3d&&qN(o.loci)){var s=o.loci.elements[0].groupId;if(s===yn.None)return n=yn.None,void(a=0);var c,l,u=r.ctx.canvas3d.camera;if(s>=yn.X&&s<=yn.Z){n=yn.None,a=0;var d=b.sub(b(),u.target,u.position),f=b.cross(b(),d,u.up);(l=b())[s-1]=1,c=b.cross(b(),l,f),0===b.magnitude(c)&&(c=d)}else n===s?a=(a+1)%2:(n=s,a=0),s===yn.XY?(l=a?b.unitX:b.unitY,c=b.negUnitZ):s===yn.XZ?(l=a?b.unitX:b.unitZ,c=b.negUnitY):(l=a?b.unitY:b.unitZ,c=b.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(p,m){return m.getInvariantFocus(p.boundingSphereVisible.center,p.boundingSphereVisible.radius,l,c)}})}})},t}($r.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}}),Gre={keySpinAnimation:Dt([qT("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:Dt([qT("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:Dt([qT("Space",Al.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:Dt([qT("T")],"Reset View","Press ${triggers}")},rKe={bindings:T.Value(Gre,{isHidden:!0})},nKe=$r.create({name:"camera-controls",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.key,function(n){var a,i=n.code,o=n.key,s=n.modifiers;if(r.ctx.canvas3d){var u=R(R({},Gre),r.params.bindings),c=r.ctx.canvas3d.props.trackball;if(Dt.matchKey(u.keySpinAnimation,i,s,o)){var l="spin"!==c.animate.name?"spin":"off";r.ctx.canvas3d.setProps("off"===l?{trackball:{animate:{name:l,params:{}}}}:{trackball:{animate:{name:l,params:{speed:1}}}})}if(Dt.matchKey(u.keyRockAnimation,i,s,o)){var d="rock"!==c.animate.name?"rock":"off";r.ctx.canvas3d.setProps("off"===d?{trackball:{animate:{name:d,params:{}}}}:{trackball:{animate:{name:d,params:{speed:.3,angle:10}}}})}if(Dt.matchKey(u.keyToggleFlyMode,i,s,o)){var f=!c.flyMode;r.ctx.canvas3d.setProps({trackball:{flyMode:f}}),null!==(a=r.ctx.canvas3dContext)&&void 0!==a&&a.canvas&&(r.ctx.canvas3dContext.canvas.style.cursor=f?"crosshair":"unset")}Dt.matchKey(u.keyResetView,i,s,o)&&yr.Camera.Reset(r.ctx,{})}})},t}($r.Handler),params:function(){return rKe},display:{name:"Camera Controls on Canvas"}}),aKe=$r.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,o=0,s=this.ctx.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Model));o<s.length;o++){var u=s[o],c=(null===(r=u.obj)||void 0===r?void 0:r.data)&&ar.Index.get(null===(n=u.obj)||void 0===n?void 0:n.data).value;void 0!==c&&c>a&&(a=c)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,o=0,s=this.ctx.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Structure));o<s.length;o++){var u=s[o],c=(null===(r=u.obj)||void 0===r?void 0:r.data)&&Ze.Index.get(null===(n=u.obj)||void 0===n?void 0:n.data).value;void 0!==c&&c>a&&(a=c)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,o=0,s=this.ctx.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Model));o<s.length;o++){var c=null===(r=s[o].obj)||void 0===r?void 0:r.data;if(c){var l=ar.AsymIdCount.get(c),d=ar.AsymIdOffset.get(c).value;void 0!==l&&void 0!==d&&(n=Math.max(n,d.auth+l.auth),a=Math.max(a,d.label+l.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.setModelMaxIndex=function(){for(var r,n=this.maxModelIndex,i=0,o=this.ctx.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Model));i<o.length;i++){var u=null===(r=o[i].obj)||void 0===r?void 0:r.data;u&&ar.MaxIndex.get(u).value!==n&&ar.MaxIndex.set(u,{value:n},n)}},t.prototype.setStructureMaxIndex=function(){for(var r,n=this.maxModelIndex,i=0,o=this.ctx.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Structure));i<o.length;i++){var u=null===(r=o[i].obj)||void 0===r?void 0:r.data;u&&Ze.MaxIndex.get(u).value!==n&&Ze.MaxIndex.set(u,{value:n},n)}},t.prototype.handleModel=function(r,n){if(void 0===ar.Index.get(r).value){var a=n&&ar.Index.get(n).value;ar.Index.set(r,{value:i=a??this.maxModelIndex+1},i)}if(void 0===ar.AsymIdOffset.get(r).value){var i=(n&&ar.AsymIdOffset.get(n).value)??R({},this.asymIdOffset);ar.AsymIdOffset.set(r,{value:i},i)}},t.prototype.handleStructure=function(r,n){if(void 0===r.parent&&void 0===Ze.Index.get(r).value){var i=(n&&Ze.Index.get(n).value)??this.maxStructureIndex+1;Ze.Index.set(r,{value:i},i)}},t.prototype.handle=function(r,n,a){ve.Molecule.Structure.is(n)?!this.ctx.state.data.tree.transforms.get(r).transformer.definition.isDecorator&&void 0===n.data.parent&&this.handleStructure(n.data,a?.data):ve.Molecule.Model.is(n)&&(this.ctx.state.data.tree.transforms.get(r).transformer.definition.isDecorator||this.handleModel(n.data,a?.data))},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(ar.AsymIdOffset,!0),this.ctx.customModelProperties.register(ar.Index,!0),this.ctx.customModelProperties.register(ar.MaxIndex,!0),this.ctx.customStructureProperties.register(Ze.Index,!0),this.ctx.customStructureProperties.register(Ze.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj),r.setModelMaxIndex(),r.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(ar.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(ar.Index.descriptor.name),this.ctx.customModelProperties.unregister(ar.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(Ze.Index.descriptor.name),this.ctx.customStructureProperties.unregister(Ze.MaxIndex.descriptor.name)},t}($r.Handler)}),Mm=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],zre={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165};function sKe(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return"NZ"===e?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return"CD"===e?1:2}}}return QN(t)}function uKe(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return QN(t)}function QN(e){var t=n2(e),r=Mm.indexOf(t);return-1===r&&(Mm[r=Mm.length]=t),r}function cKe(e,t){return ue(this,void 0,void 0,function(){var r,n;return ce(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:(function lKe(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,c=e.maxLookupRadius,l=e.probeSize,d=n.lookup3d,f=n.serialMapping,p=n.unitIndexMap,m=n.units,h=f.cumulativeUnitElementCount,v=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var S=Mm[a[y]];if(S!==Mm[0]){for(var C=m[g[y]],_=v[y],x=C.conformation.x(_),D=C.conformation.y(_),w=C.conformation.z(_),A=d.find(x,D,w,c),E=A.count,I=A.units,M=A.indices,F=A.squaredDistances,N=l+S,j=l+N,U=[],H=0;H<E;++H){var z=I[H],G=h[p.get(z.id)]+M[H],X=Mm[a[G]];if((C!==z||_!==v[G])&&X!==Mm[0]){var Z=l+X;if(F[H]<(j+X)*(j+X)){var ne=v[G];U[U.length]=[F[H],(F[H]+N*N-Z*Z)/(2*N),z.conformation.x(ne)-x,z.conformation.y(ne)-D,z.conformation.z(ne)-w]}}}U.sort(function(te,le){return te[0]-le[0]});var Y=0;e:for(var k=0;k<s.length;++k){for(var W=s[k],$=W[0],K=W[1],q=W[2],V=0;V<U.length;++V){var ee=U[V];if($*ee[2]+K*ee[3]+q*ee[4]>ee[1])continue e}++Y}o[i[y]]+=u*Y*N*N}}})(t,n,Math.min(n+5e3,r.length)),a.label=4;case 4:return n+=5e3,[3,1];case 5:return[2]}})})}var wy,jre={numberOfSpherePoints:T.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:T.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:T.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:T.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};!function(e){function r(c,l,d){return ue(this,void 0,void 0,function(){var f;return ce(this,function(h){switch(h.label){case 0:return f=function n(c,l){var d=c.elementCount,f=c.atomicResidueCount,v=l.numberOfSpherePoints;return{structure:c,probeSize:l.probeSize,nonPolymer:l.nonPolymer,traceOnly:l.traceOnly,spherePoints:a(v),scalingConstant:4*Math.PI/v,maxLookupRadius:2*l.probeSize+2*Mm[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}(l,d),function oKe(e){var t=ot.residue.key,r=ot.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,c=at.create(o),l=0,d=0,f=-1;c.structure=o;for(var p=0,m=0,h=o.units.length;p<h;++p){var v=o.units[p],g=v.elements;c.unit=v,l=-1;for(var y=0,S=g.length;y<S;++y){var C=g[y],_=m+y;c.element=C,l!==(d=t(c))&&++f,l=d;var x=n(c);if($f(_d(x)))s[_]=0,u[_]=-1;else{var w=a(c),A=N4(v,C);if(2!==A&&(e.nonPolymer||RA(A))){var E=i(c);!e.traceOnly||("CA"===w||"BB"===w)&&zre[E]?(s[_]=xd(A)?uKe(0,x):5===A?sKe(w,x,E):QN(x),u[_]=f):(s[_]=0,u[_]=f)}else s[_]=0,u[_]=-1}}m+=g.length}}(f),[4,cKe(c,f)];case 1:return h.sent(),[2,{area:f.area,serialResidueIndex:f.serialResidueIndex}]}})})}function a(c){for(var l=[],d=Math.PI*(3-Math.sqrt(5)),f=2/c,p=0;p<c;++p){var m=p*f-1+f/2,h=Math.sqrt(1-m*m),v=p*d;l[l.length]=b.create(Math.cos(v)*h,m,Math.sin(v)*h)}return l}function i(c,l){return l/(zre[c]||121)}function o(c,l){var d=l.area,p=l.serialResidueIndex[Ye.indexOf(Ye.ofSortedArray(c.structure.root.serialMapping.elementIndices),c.element)];return-1===p?-1:d[p]}function s(c,l){var d=o(c,l);return-1===d?-1:i(ot.atom.label_comp_id(c),d)}e.compute=function t(c,l){var d=this;void 0===l&&(l={});var f=R(R({},T.getDefaultValues(jre)),l);return Ve.create("Compute Accessible Surface Area",function(p){return ue(d,void 0,void 0,function(){return ce(this,function(m){switch(m.label){case 0:return[4,r(p,c,f)];case 1:return[2,m.sent()]}})})})},e.Flag={NA:0,Buried:1,Accessible:2},e.normalize=i,e.getValue=o,e.getNormalizedValue=s,e.getFlag=function u(c,l){var d=s(c,l);return-1===d?0:d<.16?1:2}}(wy||(wy={}));var $N=R({},jre),JN={isBuried:cy.Dynamic(yZ("computed","accessible-surface-area.is-buried",Te.Bool),function(e){if(!Fe.isAtomic(e.element.unit))return!1;var t=zc.get(e.element.structure).value;return!!t&&1===wy.getFlag(e.element,t)}),isAccessible:cy.Dynamic(yZ("computed","accessible-surface-area.is-accessible",Te.Bool),function(e){if(!Fe.isAtomic(e.element.unit))return!1;var t=zc.get(e.element.structure).value;return!!t&&2===wy.getFlag(e.element,t)})},zc=ep.createProvider({label:"Accessible Surface Area",descriptor:Hu({name:"molstar_accessible_surface_area",symbols:JN}),type:"root",defaultParams:$N,getParams:function(e){return $N},isApplicable:function(e){return!0},obtain:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=R(R({},T.getDefaultValues($N)),r),a={},[4,wy.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),ek=dt(16448250),qre={list:T.ColorList("rainbow",{presetKind:"scale"})},Yre={name:"accessible-surface-area",label:"Accessible Surface Area",category:hu.Category.Residue,factory:function Wre(e,t){var r,n=_c.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&zc.get(e.structure),i=a?Oh(a.id,a.version):-1;if(a?.value&&e.structure){var o=at.create(e.structure),s=a.value,u=function(c){var l=wy.getNormalizedValue(c,s);return-1===l?ek:n.color(l)};r=function(c){return at.is(c)&&Fe.isAtomic(c.unit)?u(c):zt.isLocation(c)?(o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex],u(o)):ek}}else r=function(){return ek};return{factory:Wre,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:"Assigns a color based on the relative accessible surface area of a residue.",legend:n?n.legend:void 0}},getParams:function fKe(e){return qre},defaultValues:T.getDefaultValues(qre),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?zc.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&zc.ref(e.structure,!1)}}},pKe=$r.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=zc,r.labelProvider={label:function(n){if(r.params.showTooltip)return function mKe(e){if("element-loci"===e.kind){if(0===e.elements.length)return;if(!(t=zc.get(e.structure).value)||e.structure.customPropertyDescriptors.hasReference(zc.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(m,h){var v=h.elements;ke.forEach(m,function(g){var y=a[r(h,v[g])];-1!==y&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,c=e.elements;u<c.length;u++){var l=c[u];s(l.indices,l.unit)}if(0===i.size)return;var p="<small>(".concat(i.size," ").concat(i.size>1?"Residues sum":"Residue",")</small>");return"Accessible Surface Area ".concat(p,": ").concat(o.toFixed(2)," \u212b<sup>2</sup>")}var t;if("structure-loci"===e.kind)return!(t=zc.get(e.structure).value)||e.structure.customPropertyDescriptors.hasReference(zc.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: ".concat(TW(t.area).toFixed(2)," \u212b<sup>2</sup>")}(n)}},r}return jt(t,e),t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){sT.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Yre),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(Xre),this.ctx.query.structure.registry.add(Kre)},t.prototype.unregister=function(){sT.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Yre),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(Xre),this.ctx.query.structure.registry.remove(Kre)},t}($r.Handler),params:function(){return{autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)}}}),Xre=un("Buried Protein Residues",fe.struct.modifier.union([fe.struct.modifier.wholeResidues([fe.struct.modifier.union([fe.struct.generator.atomGroups({"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":JN.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:ln.Residue,ensureCustomProperties:function(e,t){return zc.attach(e,t)}}),Kre=un("Accessible Protein Residues",fe.struct.modifier.union([fe.struct.modifier.wholeResidues([fe.struct.modifier.union([fe.struct.generator.atomGroups({"chain-test":fe.core.rel.eq([fe.ammp("objectPrimitive"),"atomistic"]),"residue-test":JN.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:ln.Residue,ensureCustomProperties:function(e,t){return zc.attach(e,t)}});function nn(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function Zre(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function V2(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function WT(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function tk(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function Ud(e,t,r){return function hKe(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i)Gr.isCovalent(e.interUnitBonds.edges[a[i]].props.flag)&&(n+=1);return n}(e,t,r)+function vKe(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)Gr.isCovalent(i[o])&&(r+=1);return r}(t,r)}function Hs(e,t,r,n){var a=0;return js(e,t,r,function(i,o){nn(i,o)===n&&(a+=1)}),a}function rk(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)Gr.isCovalent(o[s])&&r(e,i[s])}function js(e,t,r,n){(function SKe(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);Gr.isCovalent(s.props.flag)&&n(u,s.indexB)}})(e,t,r,n),rk(t,r,n)}var ma=function(e){return e[e.Spherical=0]="Spherical",e[e.Terminal=1]="Terminal",e[e.Linear=2]="Linear",e[e.Trigonal=3]="Trigonal",e[e.Tetrahedral=4]="Tetrahedral",e[e.TrigonalBiPyramidal=5]="TrigonalBiPyramidal",e[e.Octahedral=6]="Octahedral",e[e.SquarePlanar=7]="SquarePlanar",e[e.Unknown=8]="Unknown",e}(ma||{});function CKe(e){switch(e){case ma.Spherical:return"Spherical";case ma.Terminal:return"Terminal";case ma.Linear:return"Linear";case ma.Trigonal:return"Trigonal";case ma.Tetrahedral:return"Tetrahedral";case ma.TrigonalBiPyramidal:return"Trigonal Bi-Pyramidal";case ma.Octahedral:return"Octahedral";case ma.SquarePlanar:return"Square Planar";case ma.Unknown:return"Unknown"}}function Ay(e){switch(e){case 0:return ma.Spherical;case 1:return ma.Terminal;case 2:return ma.Linear;case 3:return ma.Trigonal;case 4:return ma.Tetrahedral;default:return ma.Unknown}}var Qre=new Map([[ma.Linear,Yr(180)],[ma.Trigonal,Yr(120)],[ma.Tetrahedral,Yr(109.4721)],[ma.Octahedral,Yr(90)]]),YT=b(),XT=b(),Tv=b(),KT=b(),Ty=b();function ZT(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],Tv),n.conformation.position(n.elements[a],KT),b.sub(YT,KT,Tv),js(e,t,r,function(o,s){"H"!==nn(o,s)&&(o.conformation.position(o.elements[s],Ty),b.sub(XT,Ty,Tv),i.push(b.angle(YT,XT)))}),i}function $re(e,t,r,n,a){t.conformation.position(t.elements[r],Tv),n.conformation.position(n.elements[a],KT),b.sub(YT,KT,Tv);var s,u,i=[b(),b()],o=0;if(js(e,t,r,function(c,l){o>1||"H"!==nn(c,l)&&(s=c,u=l,c.conformation.position(c.elements[l],Ty),b.sub(i[o++],Ty,Tv))}),1===o&&s&&u&&js(e,s,u,function(c,l){o>1||c===t&&l===r||"H"!==nn(c,l)&&(c.conformation.position(c.elements[l],Ty),b.sub(i[o++],Ty,Tv))}),2===o)return b.cross(XT,i[0],i[1]),Math.abs(Math.PI/2-b.angle(XT,YT))}var nk=new zt.ElementBondIterator,ak=new zt.ElementBondIterator,Dy=new zt.ElementBondIterator,ik=new zt.ElementBondIterator;function wKe(e,t,r,n){var a=Hs(e,t,r,"H"),i=nn(t,r),o=Zre(t,r),s="always"===n.assignCharge||"auto"===n.assignCharge&&0===o,u="always"===n.assignH||"auto"===n.assignH&&0===a,c=Ud(e,t,r),l=function _Ke(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,c=i[r],l=i[r+1];c<l;++c)Gr.isCovalent(s[c])&&(n+=u[c]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];Gr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}(e,t,r),d=function xKe(e,t,r){var n=nn(t,r),a="O"===n||"N"===n;if(a&&4===Ud(e,t,r))return!1;for(nk.setElement(e,t,r);nk.hasNext;){var i=nk.move();if(i.order>1)return!0;if(a){var o=nn(i.otherUnit,i.otherIndex);for(ak.setElement(e,i.otherUnit,i.otherIndex);ak.hasNext;){var s=ak.move();if(s.order>1){if(("P"===o||"S"===o)&&"O"===nn(s.otherUnit,s.otherIndex))continue;return!0}}}}return!1}(e,t,r),f=l-c>0,p=0,m=ma.Unknown;switch(i){case"H":s&&(0===c?(o=1,m=ma.Spherical):1===c&&(o=0,m=ma.Terminal));break;case"C":s&&(o=0),u&&(p=Math.max(0,4-l-Math.abs(o))),m=Ay(c+p+Math.max(0,-o));break;case"N":if(s)if(u)if(d&&l<4)o=c-a==1&&l-a==2?1:0;else for(Dy.setElement(e,t,r);Dy.hasNext;){var h=Dy.move(),v=nn(h.otherUnit,h.otherIndex);if("S"===v||pVe(v)){o=0;break}o=1}else o=l-3;u&&(p=Math.max(0,3-l+o)),m=Ay(d&&!f?c+p-o:c+p+1-o);break;case"O":if(s&&(u||(o=l-2),1===l)){Dy.setElement(e,t,r);e:for(;Dy.hasNext;){var g=Dy.move();for(ik.setElement(e,g.otherUnit,g.otherIndex);ik.hasNext;){var y=ik.move();if((y.otherUnit!==t||y.otherIndex!==r)&&"O"===nn(y.otherUnit,y.otherIndex)&&2===y.order){o=-1;break e}}}}u&&(p=Math.max(0,2-l+o)),m=Ay(d&&!f?c+p-o+1:c+p-o+2);break;case"S":s&&(u||(o=l<=3&&0===Hs(e,t,r,"O")?l-2:0)),u&&l<2&&(p=Math.max(0,2-l+o)),l<=3&&(m=Ay(c+p-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=l-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-l);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-l);break;default:Cr&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,p,p+a,m]}function AKe(e,t,r){var c,n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent;if(u){var l=e.root.unitMap.get(t.id);if((c=Ye.indicesOf(l.elements,t.elements)).length!==t.elements.length)throw new Error("expected to find an index for every element");t=l,e=e.root}for(var d=0;d<n;++d){var p=wKe(e,t,u?c[d]:d,r),h=p[1],v=p[2],g=p[3];a[d]=p[0],i[d]=h,o[d]=v,s[d]=g}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var Jre={assignCharge:T.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:T.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function TKe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(c){for(n=R(R({},T.getDefaultValues(Jre)),r),a=new Map,i=0,o=t.units.length;i<o;++i)Fe.isAtomic(s=t.units[i])&&(u=AKe(t,s,n),a.set(s.id,u));return[2,a]})})}var ha,sk,uk,ok=R({},Jre),G2=ep.createProvider({label:"Valence Model",descriptor:Hu({name:"molstar_computed_valence_model"}),type:"local",defaultParams:ok,getParams:function(e){return ok},isApplicable:function(e){return!0},obtain:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=R(R({},T.getDefaultValues(ok)),r),a={},[4,TKe(0,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}});!function(e){function r(d,f){for(var p=new Int32Array(f+1),m=new Int32Array(f),h=new Int32Array(f),v=d.members,g=d.count,y=d.offsets,S=0,C=y[g];S<C;++S)++h[v[S]];var _=0;for(S=0;S<f;S++)p[S]=_,_+=h[S];p[f]=_;var x=new Int32Array(_);for(S=0;S<g;++S)for(var D=y[S],w=y[S+1];D<w;++D){var A=v[D];x[p[A]+m[A]]=S,++m[A]}return{indices:x,offsets:p}}function a(d,f){for(var p,m=d.count,h=d.types,v=[],g=0;g<m;++g)f.has(h[g])&&v.push(g);var y=Ye.ofSortedArray(v);return{indices:y,get lookup3d(){if(!p){var S={x:d.x,y:d.y,z:d.z,indices:y};p=Df(S,Jf(S))}return p}}}e.setPosition=function t(d,f,p,m){return b.set(d,m.x[p],m.y[p],m.z[p]),b.transformMat4(d,d,f.conformation.operator.matrix),d},e.createElementsIndex=r,e.create=function n(d,f){var p,m;return R(R({},f),{get lookup3d(){if(!p){var h={x:f.x,y:f.y,z:f.z,indices:ke.ofBounds(0,f.count)};p=Df(h,Jf(h))}return p},get elementsIndex(){return m||(m=r(f,d))},subset:function(h){return a(f,h)}})},e.createSubset=a,e.Info=function i(d,f,p){var m=G2.get(d).value;if(!m||!m.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:m.get(f.id).idealGeometry}},e.position=function o(d,f){return b.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),b.transformMat4(d,d,f.unit.conformation.operator.matrix),d};var s=b(),u=b();e.distance=function c(d,f){var m=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[d.members[d.offsets[d.feature]]],s),f.unit.conformation.position(f.unit.elements[m],u),b.distance(s,u)},e.Provider=function l(d,f){return{types:new Set(d),add:f}}}(ha||(ha={})),function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,1,n,a?a.x:r),o=qe.create(Float32Array,1,n,a?a.y:r),s=qe.create(Float32Array,1,n,a?a.z:r),u=qe.create(Uint8Array,1,n,a?a.types:r),c=qe.create(Uint8Array,1,n,a?a.groups:r),l=qe.create(Uint32Array,1,n,a?a.offsets:r),d=qe.create(Uint32Array,1,n,a?a.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(p,m,h,v){qe.add(d,v),f.x+=p,f.y+=m,f.z+=h,f.count+=1},finishState:function(p,m){var h=f.count;0!==h&&(qe.add(u,p),qe.add(c,m),qe.add(i,f.x/h),qe.add(o,f.y/h),qe.add(s,f.z/h),qe.add(l,f.offset))},add:function(p,m,h,v,g,y){qe.add(u,p),qe.add(c,m),qe.add(i,h),qe.add(o,v),qe.add(s,g),qe.add(l,d.elementCount),qe.add(d,y)},getFeatures:function(p){qe.add(l,d.elementCount);var m=qe.compact(i,!0),h=qe.compact(o,!0),v=qe.compact(s,!0);return ha.create(p,{x:m,y:h,z:v,count:i.elementCount,types:qe.compact(u,!0),groups:qe.compact(c,!0),offsets:qe.compact(l,!0),members:qe.compact(d,!0)})}}}}(sk||(sk={})),function(e){e.createElementsIndex=function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,c=n.offsets,l=0,d=2*r.edgeCount;l<d;++l)if(!((f=r.a[l])>(p=r.b[l]))){for(var m=c[f],h=c[f+1];m<h;++m)++s[u[m]];for(m=c[p],h=c[p+1];m<h;++m)++s[u[m]]}var v=0;for(l=0;l<a;l++)i[l]=v,v+=s[l];i[a]=v;var g=new Int32Array(v);for(l=0,d=2*r.edgeCount;l<d;++l){var f,p;if(!((f=r.a[l])>(p=r.b[l]))){for(m=c[f],h=c[f+1];m<h;++m)g[i[y=u[m]]+o[y]]=l,++o[y];for(m=c[p],h=c[p+1];m<h;++m){var y;g[i[y=u[m]]+o[y]]=l,++o[y]}}}return{indices:g,offsets:i}}}(uk||(uk={}));var DKe=function(e){function t(r,n){var a=e.call(this,r)||this;a.elementKeyIndex=new Map;for(var i=0,o=a.edges.length;i<o;++i)for(var s=a.edges[i],u=s.unitA,c=s.indexA,l=n.get(u),d=l.offsets,f=l.members,p=d[c],m=d[c+1];p<m;++p){var h=a.getElementKey(f[p],u),v=a.elementKeyIndex.get(h);void 0===v?a.elementKeyIndex.set(h,[i]):v.push(i)}return a}return jt(t,e),t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return"".concat(r,"|").concat(n)},t}(Jh),Vd=function(e){return e[e.None=0]="None",e[e.Filtered=1]="Filtered",e}(Vd||{}),Rr=function(e){return e[e.Unknown=0]="Unknown",e[e.Ionic=1]="Ionic",e[e.CationPi=2]="CationPi",e[e.PiStacking=3]="PiStacking",e[e.HydrogenBond=4]="HydrogenBond",e[e.HalogenBond=5]="HalogenBond",e[e.Hydrophobic=6]="Hydrophobic",e[e.MetalCoordination=7]="MetalCoordination",e[e.WeakHydrogenBond=8]="WeakHydrogenBond",e}(Rr||{});function ene(e){switch(e){case Rr.HydrogenBond:return"Hydrogen Bond";case Rr.Hydrophobic:return"Hydrophobic Contact";case Rr.HalogenBond:return"Halogen Bond";case Rr.Ionic:return"Ionic Interaction";case Rr.MetalCoordination:return"Metal Coordination";case Rr.CationPi:return"Cation-Pi Interaction";case Rr.PiStacking:return"Pi Stacking";case Rr.WeakHydrogenBond:return"Weak Hydrogen Bond";case Rr.Unknown:return"Unknown Interaction"}}function IKe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}var ck,lk,xn=function(e){return e[e.None=0]="None",e[e.QuaternaryAmine=1]="QuaternaryAmine",e[e.TertiaryAmine=2]="TertiaryAmine",e[e.Sulfonium=3]="Sulfonium",e[e.SulfonicAcid=4]="SulfonicAcid",e[e.Sulfate=5]="Sulfate",e[e.Phosphate=6]="Phosphate",e[e.Halocarbon=7]="Halocarbon",e[e.Guanidine=8]="Guanidine",e[e.Acetamidine=9]="Acetamidine",e[e.Carboxylate=10]="Carboxylate",e}(xn||{});function PKe(e){switch(e){case xn.None:return"None";case xn.QuaternaryAmine:return"Quaternary Amine";case xn.TertiaryAmine:return"Tertiary Amine";case xn.Sulfonium:return"Sulfonium";case xn.SulfonicAcid:return"Sulfonic Acid";case xn.Sulfate:return"Sulfate";case xn.Phosphate:return"Phosphate";case xn.Halocarbon:return"Halocarbon";case xn.Guanidine:return"Guanidine";case xn.Acetamidine:return"Acetamidine";case xn.Carboxylate:return"Carboxylate"}}!function(e){e.create=function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,c){a[a.length]=s,i[i.length]=u,o[o.length]=c},getContacts:function(){for(var s=new fu.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),c=new Int8Array(s.slotCount),l=0,d=s.edgeCount;l<d;l++)s.addNextEdge(),s.assignProperty(u,o[l]);var p,f=s.createGraph({type:u,flag:c});return Object.defineProperty(f,"elementsIndex",{get:function(){return p||(p=uk.createElementsIndex(f,r,n))}})}}}}(ck||(ck={})),function(e){e.create=function t(){var r=new Jh.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:Vd.None})},getContacts:function(n){return new DKe(r.getMap(),n)}}}}(lk||(lk={}));var MKe={lineOfSightDistFactor:T.Numeric(1,{min:0,max:3,step:.1})},RKe=3;function tne(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=WT(t.unit,n),o=WT(r.unit,a);return!(i&&o&&i!==o||t.unit===r.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]||function bKe(e,t,r,n,a){return t===n?function gKe(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&Gr.isCovalent(o[s]))return!0;return!1}(t,r,a):function yKe(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&Gr.isCovalent(i.props.flag)}(e,t,r,n,a)}(e,t.unit,n,r.unit,a))}function rne(e,t,r,n){var a=WT(e,t),i=WT(r,n);return a&&i&&a!==i}function nne(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var Rm=b(),dk=b(),fk=b(),OKe=ZZ();function ane(e,t,r,n){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];ha.position(dk,t),ha.position(fk,r),b.scale(Rm,b.add(Rm,dk,fk),.5);var c=e.lookup3d.find(Rm[0],Rm[1],Rm[2],n*RKe,OKe),l=c.count,d=c.indices,f=c.units,p=c.squaredDistances;if(0===l)return!0;for(var m=0;m<l;++m){var h=d[m],v=f[m];if(Fe.isAtomic(v)){var g=nn(v,h);if("H"!==g){var y=n2(g);if(!(y*y*n*n<=p[m]||rne(v,h,t.unit,o)||rne(v,h,r.unit,s)||t.unit===v&&nne(h,t)||r.unit===v&&nne(h,r)||(v.conformation.position(v.elements[h],Rm),b.squaredDistance(Rm,dk)<1||b.squaredDistance(Rm,fk)<1)))return!1}}}return!0}function BKe(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,c=r.subset(a.requiredFeatures),l=c.lookup3d,d=c.indices,f=ha.Info(e,t,r),p=R({},f),m=i.lineOfSightDistFactor,h=0,v=ke.size(d);h<v;++h){var g=ke.getAt(d,h),y=l.find(o[g],s[g],u[g],a.maxDistance),S=y.count,C=y.indices,_=y.squaredDistances;if(0!==S){f.feature=g;for(var x=0;x<S;++x){var D=ke.getAt(d,C[x]);if(!(D<=g)&&(p.feature=D,tne(e,f,p))){var w=a.getType(e,f,p,_[x]);w&&ane(e,f,p,m)&&n.add(g,D,w)}}}}}var NKe=he(),LKe={distanceMax:T.Numeric(4,{min:1,max:5,step:.1}),angleMax:T.Numeric(30,{min:0,max:60,step:1})},UKe=["CL","BR","I","AT"],GKe=["N","O","S"],zKe=["C","N","P","S"],qKe=Yr(180),WKe=Yr(120),KKe=ha.Provider([6],function VKe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=nn(t,u);UKe.includes(l)&&r.add(6,xn.None,i[n[u]],o[n[u]],s[n[u]],u)}}),ZKe=ha.Provider([7],function HKe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=nn(t,d);if(GKe.includes(p)){var m=!1;js(e,t,d,function(h,v){zKe.includes(nn(h,v))&&(m=!0)}),m&&r.add(7,xn.None,i[n[d]],o[n[d]],s[n[d]],d)}},c=0,l=n.length;c<l;++c)u(c)}),QKe={name:"halogen-bonds",params:LKe,createTester:function(e){var t=function YKe(e){return{angleMax:Yr(e.angleMax)}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return function XKe(e,t,r,n){var a=t.types[t.feature];if(function jKe(e,t){return 7===e&&6===t||6===e&&7===t}(a,r.types[r.feature])){var o=6===a?[t,r]:[r,t],s=o[0],u=o[1],c=s.members[s.offsets[s.feature]],l=u.members[u.offsets[u.feature]],d=ZT(e,s.unit,c,u.unit,l);if(1===d.length&&!(qKe-d[0]>n.angleMax)){var f=ZT(e,u.unit,l,s.unit,c);if(0!==f.length&&!f.some(function(p){return WKe-p>n.angleMax}))return Rr.HalogenBond}}}(r,n,a,t)}}}},ine={distanceMax:T.Numeric(3.5,{min:1,max:5,step:.1}),backbone:T.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:T.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:T.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:T.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:T.Numeric(45,{min:0,max:180,step:1})},$Ke=R(R({},ine),{water:T.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:T.Numeric(4.1,{min:1,max:5,step:.1})}),JKe=R({},ine);function pk(e,t){var r=G2.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function rZe(e,t){var r=e.rings,a=r.all,i=r.elementAromaticRingIndices.get(t);if(void 0===i)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],c=0,l=u.length;c<l;++c){var d=nn(e,u[c]);if("N"===d||"O"===d)return!0}return!1}function one(e,t){return 2===e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]}function sne(e,t){return Qf.has(V2(e,t))}function une(e,t){return"HIS"===tk(e,t)&&"N"===nn(e,t)&&function aZe(e,t){return e.rings.elementRingIndices.has(t)}(e,t)}function cne(e){return{includeBackbone:e.backbone,maxAccAngleDev:Yr(e.accAngleDevMax),maxDonAngleDev:Yr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Yr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Yr(e.donOutOfPlaneAngleMax)}}var lne=Yr(120);function dne(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(n.includeBackbone||!function iZe(e,t,r,n){return sne(e,t)&&sne(r,n)}(t.unit,a,r.unit,i)){var o=ZT(e,t.unit,a,r.unit,i),s=Qre.get(t.idealGeometry[a])||lne;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[a]===ma.Trigonal&&void 0!==(u=$re(e,t.unit,a,r.unit,i))&&u>n.maxDonOutOfPlaneAngle)return;var c=ZT(e,r.unit,i,t.unit,a),l=Qre.get(r.idealGeometry[i])||lne;if(!c.some(function(d){return l-d>n.maxAccAngleDev})){var u;if(r.idealGeometry[i]===ma.Trigonal&&void 0!==(u=$re(e,r.unit,i,t.unit,a))&&u>n.maxAccOutOfPlaneAngle)return;return!0}}}}var fZe=ha.Provider([4],function eZe(e,t,r){for(var n=pk(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=0,l=a.length;c<l;++c){var d=nn(t,c);(une(t,c)||n[c]>0&&("N"===d||"O"===d||"S"===d))&&r.add(4,xn.None,o[a[c]],s[a[c]],u[a[c]],c)}}),pZe=ha.Provider([9],function tZe(e,t,r){for(var n=pk(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=0,l=a.length;c<l;++c)"C"===nn(t,c)&&n[c]>0&&(Hs(e,t,c,"N")>0||Hs(e,t,c,"O")>0||rZe(t,c))&&r.add(9,xn.None,o[a[c]],s[a[c]],u[a[c]],c)}),mZe=ha.Provider([5],function nZe(e,t,r){for(var n=pk(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,c=u.x,l=u.y,d=u.z,f=function(S){r.add(5,xn.None,c[s[S]],l[s[S]],d[s[S]],S)},p=0,m=s.length;p<m;++p){var h=nn(t,p);if("O"===h)f(p);else if("N"===h){if(une(t,p))f(p);else if(a[p]<1){var v=Ud(e,t,p)+i[p],g=o[p];(g===ma.Tetrahedral&&v<4||g===ma.Trigonal&&v<3||g===ma.Linear&&v<2)&&f(p)}}else if("S"===h){var y=tk(t,p);("CYS"===y||"MET"===y||-1===Zre(t,p))&&f(p)}}}),hZe={name:"hydrogen-bonds",params:$Ke,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=function cZe(e){return R(R({},cne(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return function lZe(e,t,r,n,a){var o=r.types[r.feature];if(function sZe(e,t){return 5===e&&4===t||4===e&&5===t}(t.types[t.feature],o)){var s=5===o?[t,r]:[r,t],u=s[0],c=s[1],l=u.members[u.offsets[u.feature]],d=c.members[c.offsets[c.feature]];if(!(n>("S"===nn(u.unit,l)||"S"===nn(c.unit,d)?a.maxSulfurDistSq:a.maxDistSq))&&(a.includeWater||!function oZe(e,t,r,n){return one(e,t)&&one(r,n)}(u.unit,l,c.unit,d))&&dne(e,u,c,a))return Rr.HydrogenBond}}(n,a,i,o,r)}}}},vZe={name:"weak-hydrogen-bonds",params:JKe,createTester:function(e){var t=cne(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return function dZe(e,t,r,n,a){var o=r.types[r.feature];if(function uZe(e,t){return 9===e&&5===t||5===e&&9===t}(t.types[t.feature],o)){var s=5===o?[t,r]:[r,t];if(dne(e,s[0],s[1],a))return Rr.WeakHydrogenBond}}(r,n,a,0,t)}}}};function yZe(e,t,r){return"S"===nn(t,r)&&3===Hs(e,t,r,"O")}function bZe(e,t,r){return"S"===nn(t,r)&&4===Hs(e,t,r,"O")}function pne(e,t,r){return"P"===nn(t,r)&&Hs(e,t,r,"O")===Ud(e,t,r)}function CZe(e,t,r){var n=0;return"C"===nn(t,r)&&2===Hs(e,t,r,"O")&&1===Hs(e,t,r,"C")&&js(e,t,r,function(a,i){"O"===nn(a,i)&&Ud(e,a,i)-Hs(e,a,i,"H")==1&&(n+=1)}),2===n}function xZe(e,t,r){var n=0;return"C"===nn(t,r)&&3===Ud(e,t,r)&&3===Hs(e,t,r,"N")&&js(e,t,r,function(a,i){Ud(e,a,i)-Hs(e,a,i,"H")==1&&(n+=1)}),2===n}function _Ze(e,t,r){var n=0;return"C"===nn(t,r)&&3===Ud(e,t,r)&&2===Hs(e,t,r,"N")&&1===Hs(e,t,r,"C")&&js(e,t,r,function(a,i){Ud(e,a,i)-Hs(e,a,i,"H")==1&&(n+=1)}),2===n}var wZe=new Set(["N","O","S","F","CL","BR","I"]);var DZe={distanceMax:T.Numeric(5,{min:0,max:8,step:.1})},EZe={distanceMax:T.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:T.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:T.Numeric(30,{min:0,max:180,step:1})},IZe={distanceMax:T.Numeric(6,{min:1,max:8,step:.1}),offsetMax:T.Numeric(2,{min:0,max:4,step:.1})},PZe=["ARG","HIS","LYS"],MZe=["GLU","ASP"];function mne(e,t){var r=G2.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}var hne=b(),vne=b(),QT=b(),Ey=b(),$T=b(),JT=b();function mk(e,t){var i=t.members,o=t.unit.elements,s=t.offsets[t.feature];return t.unit.conformation.position(o[i[s]],QT),t.unit.conformation.position(o[i[s+1]],Ey),t.unit.conformation.position(o[i[s+2]],$T),b.triangleNormal(e,QT,Ey,$T)}var hk=function(e,t,r){return ha.position(QT,e),ha.position(Ey,t),b.sub($T,QT,Ey),b.projectOnPlane(JT,$T,r),b.add(JT,JT,Ey),b.distance(JT,Ey)},zZe=Yr(180),gne=Yr(90),z2=b(),vk=b();var WZe=ha.Provider([2],function OZe(e,t,r){for(var n=mne(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=new Set,l=t.model.atomicHierarchy.atoms.label_comp_id,d=pr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),m=f.start,h=f.end,v=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[f.index]);if(MZe.includes(v)){r.startState();for(var g=m;g<h;++g)"O"===nn(t,g)&&!Qf.has(V2(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(2,xn.None)}else if(MA.has(v))for(g=m;g<h;++g)pne(e,t,g)&&(r.startState(),js(e,t,g,function(C,_){"O"===nn(t,_)&&r.pushMember(o[a[_]],s[a[_]],u[a[_]],_)}),r.finishState(2,xn.Phosphate));else if(!ey.has(v)){for(g=m;g<h;++g){r.startState(),"N"===nn(t,g)&&!Qf.has(V2(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g),r.finishState(2,xn.None);var y=xn.None;yZe(e,t,g)?y=xn.SulfonicAcid:pne(e,t,g)?y=xn.Phosphate:bZe(e,t,g)?y=xn.Sulfate:CZe(e,t,g)&&(y=xn.Carboxylate),y&&(r.startState(),js(e,t,g,function(C,_){"O"===nn(t,_)&&(c.add(_),r.pushMember(o[a[_]],s[a[_]],u[a[_]],_))}),r.finishState(2,y))}for(g=m;g<h;++g)n[g]<0&&!c.has(g)&&r.add(2,xn.None,o[a[g]],s[a[g]],u[a[g]],g)}}}),YZe=ha.Provider([1],function RZe(e,t,r){for(var n=mne(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=new Set,l=t.model.atomicHierarchy.atoms.label_comp_id,d=pr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),m=f.start,h=f.end,v=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[f.index]);if(PZe.includes(v)){r.startState();for(var g=m;g<h;++g)"N"===nn(t,g)&&!Qf.has(V2(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(1,xn.None)}else if(!ey.has(v)){for(c.clear(),g=m;g<h;++g){var y=xn.None;xZe(e,t,g)?y=xn.Guanidine:_Ze(e,t,g)&&(y=xn.Acetamidine),y&&(r.startState(),js(e,t,g,function(C,_){"N"===nn(t,_)&&(c.add(_),r.pushMember(o[a[_]],s[a[_]],u[a[_]],_))}),r.finishState(1,y))}for(g=m;g<h;++g)n[g]>0&&!c.has(g)&&r.add(1,xn.None,o[a[g]],s[a[g]],u[a[g]],g)}}}),XZe=ha.Provider([3],function FZe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=t.rings.aromaticRings;u<c.length;u++){var d=t.rings.all[c[u]];r.startState();for(var f=0,p=d.length;f<p;++f){var m=d[f];r.pushMember(i[n[m]],o[n[m]],s[n[m]],m)}r.finishState(3,xn.None)}}),KZe={name:"ionic",params:DZe,createTester:function(e){var t=function UZe(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return function HZe(e,t,r,n,a){if(function BZe(e,t){return 2===e&&1===t||1===e&&2===t}(t.types[t.feature],r.types[r.feature])&&function LZe(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,c=a[n],l=a[n+1];c<l;++c){e.unit.conformation.position(e.unit.elements[i[c]],hne);for(var f=s[o],p=s[o+1];f<p;++f)if(t.unit.conformation.position(t.unit.elements[u[f]],vne),b.squaredDistance(hne,vne)<r)return!0}return!1}(t,r,a.distanceMaxSq))return Rr.Ionic}(0,n,a,0,t)}}}},ZZe={name:"pi-stacking",params:EZe,createTester:function(e){var t=function VZe(e){return{offsetMax:e.offsetMax,angleDevMax:Yr(e.angleDevMax)}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return function jZe(e,t,r,n,a){if(function NZe(e,t){return 3===e&&3===t}(t.types[t.feature],r.types[r.feature])){mk(z2,t),mk(vk,r);var s=b.angle(z2,vk);if(Math.min(hk(t,r,vk),hk(r,t,z2))<=a.offsetMax){if(s<=a.angleDevMax||s>=zZe-a.angleDevMax)return Rr.PiStacking;if(s<=a.angleDevMax+gne&&s>=gne-a.angleDevMax)return Rr.PiStacking}}}(0,n,a,0,t)}}}},QZe={name:"cation-pi",params:IZe,createTester:function(e){var t=function GZe(e){return{offsetMax:e.offsetMax}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return function qZe(e,t,r,n,a){var i=t.types[t.feature];if(function kZe(e,t){return 3===e&&1===t||1===e&&3===t}(i,r.types[r.feature])){var s=3===i?[t,r]:[r,t],u=s[0],c=s[1];if(mk(z2,u),hk(c,u,z2)<=a.offsetMax)return Rr.CationPi}}(0,n,a,0,t)}}}},$Ze={distanceMax:T.Numeric(4,{min:1,max:5,step:.1})},rQe=ha.Provider([8],function JZe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=nn(t,d),m=!1;"C"===p?(m=!0,js(e,t,d,function(h,v){var g=nn(h,v);"C"!==g&&"H"!==g&&(m=!1)})):"F"===p&&(m=!0),m&&r.add(8,xn.None,i[n[d]],o[n[d]],s[n[d]],d)},c=0,l=n.length;c<l;++c)u(c)}),nQe={name:"hydrophobic",params:$Ze,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return function tQe(e,t,r,n){if(function eQe(e,t){return 8===e&&8===t}(t.types[t.feature],r.types[r.feature])){var s=r.members[r.offsets[r.feature]];if("F"!==nn(t.unit,t.members[t.offsets[t.feature]])||"F"!==nn(r.unit,s))return Rr.Hydrophobic}}(0,r,n)}}}},aQe={distanceMax:T.Numeric(3,{min:1,max:5,step:.1})},iQe=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function yne(e){return!Qf.has(e)}function sQe(e){return Qf.has(e)}function uQe(e){return IA.has(e)}function bne(e,t){return 12===e?11===t||12===t:13===e?10===t:void 0}var dp,dQe=ha.Provider([13,12],function oQe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=nn(t,u),d=0;iQe.includes(l)?d=13:(T$(l)||"ZN"===l||"CD"===l)&&(d=12),d&&r.add(d,xn.None,i[n[u]],o[n[u]],s[n[u]],u)}}),fQe=ha.Provider([10,11],function cQe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=nn(t,u),d=tk(t,u),f=V2(t,u),p=!1,m=!1,h=qS.has(d),v=MA.has(d);h||v?h?"O"===l?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&yne(f)||sQe(f))&&(p=!0,m=!0):"S"!==l||"CYS"!==d&&"MET"!==d?"N"===l&&"HIS"===d&&yne(f)&&(p=!0):(p=!0,m=!0):v&&("O"===l&&uQe(f)?(p=!0,m=!0):["N3","N4","N7"].includes(f)?p=!0:["O2","O4","O6"].includes(f)&&(p=!0,m=!0)):lVe(l)||"O"===l||"S"===l?(p=!0,m=!0):"N"===l&&(p=!0),p&&r.add(11,xn.None,i[n[u]],o[n[u]],s[n[u]],u),m&&r.add(10,xn.None,i[n[u]],o[n[u]],s[n[u]],u)}}),pQe={name:"metal-coordination",params:aQe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return function lQe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(bne(a,i)||bne(i,a))return Rr.MetalCoordination}(0,r,n)}}}};function hQe(e,t){var r=t.contacts,n=function(c,l,d,f,p){var m=f.get(d)||[1/0,-1],v=m[1];c<m[0]?(-1!==v&&p(v),f.set(d,[c,l])):p(l)};function a(c,l,d,f,p){var m=l.members[l.offsets[l.feature]],h=d.members[d.offsets[d.feature]],v=l.unit.getResidueIndex(m),g=d.unit.getResidueIndex(h),y="".concat(m,"|").concat(l.unit.id,"|").concat(g,"|").concat(d.unit.id,"|A"),S="".concat(h,"|").concat(d.unit.id,"|").concat(v,"|").concat(l.unit.id,"|B"),C=ha.distance(l,d);n(C,c,y,f,p),n(C,c,S,f,p)}var s,u,i=new Map,o=function(c){return r.edges[c].props.flag=Vd.Filtered};return{isApplicable:function(c){return c===Rr.Hydrophobic},handleInterContact:function(c,l,d){a(c,l,d,i,o)},startUnit:function(c,l,d){s=new Map,u=function(f){return l.edgeProps.flag[f]=Vd.Filtered}},handleIntraContact:function(c,l,d){a(c,l,d,s,u)}}}function vQe(e,t){var r=t.contacts,n=function(a,i){for(var o=9===a.types[a.feature]?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),c=u.edgeProps.type,l=u.elementsIndex,d=l.offsets,f=l.indices,p=d[s],m=d[s+1];p<m;++p)if(c[f[p]]===Rr.HydrogenBond)return!0;var h=r.getEdgeIndices(o.feature,o.unit.id);for(p=0,m=h.length;p<m;++p)if(r.edges[h[p]].props.type===Rr.HydrogenBond)return!0;return!1};return{isApplicable:function(a){return a===Rr.WeakHydrogenBond},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=Vd.Filtered)},startUnit:function(){},handleIntraContact:function(a,i,o){n(i,o)&&(t.unitsContacts.get(i.unit.id).edgeProps.flag[a]=Vd.Filtered)}}}function gk(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,c=i[o],l=i[o+1];c<l;++c)for(var f=a.getContactIndicesForElement(r.members[c],r.unit),p=0,m=f.length;p<m;++p){var h=f[p];if(e.includes(a.edges[h].props.type))for(var v=s[u],g=s[u+1];v<g;++v)if(a.getContactIndicesForElement(n.members[v],n.unit).includes(h))return void(a.edges[t].props.flag=Vd.Filtered)}}function yk(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,c=u.offsets,l=u.indices,d=r.offsets,f=r.feature,p=n.offsets,m=n.feature,h=d[f],v=d[f+1];h<v;++h)for(var g=r.members[h],y=c[g],S=c[g+1];y<S;++y){var C=l[y];if(e.includes(o[C]))for(var _=p[m],x=p[m+1];_<x;++_)for(var D=n.members[_],w=c[D],A=c[D+1];w<A;++w)if(C===l[w])return void(s[t]=Vd.Filtered)}}function gQe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===Rr.Ionic},handleInterContact:function(n,a,i){gk([Rr.HydrogenBond,Rr.WeakHydrogenBond],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){yk([Rr.HydrogenBond,Rr.WeakHydrogenBond],n,a,i,t.unitsContacts.get(a.unit.id))}}}function yQe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===Rr.Hydrophobic||n===Rr.CationPi},handleInterContact:function(n,a,i){gk([Rr.PiStacking],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){yk([Rr.PiStacking],n,a,i,t.unitsContacts.get(a.unit.id))}}}function bQe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===Rr.Ionic},handleInterContact:function(n,a,i){gk([Rr.MetalCoordination],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){yk([Rr.MetalCoordination],n,a,i,t.unitsContacts.get(a.unit.id))}}}!function(e){function a(l,d){var f=d.unitA,p=d.indexA,m=d.unitB,h=d.indexB,v=l.contacts;if(f===m){var y=l.unitsContacts.get(f.id),S=y.getDirectedEdgeIndex(p,h);return ene(y.edgeProps.type[S])}return S=v.getEdgeIndex(p,f.id,h,m.id),ene(v.edges[S].props.type)}function u(l,d,f){var p=l.unitsFeatures;return Yh.fromPairProvider(d.length,function(m,h,v){var g=d[m];ha.setPosition(h,g.unitA,g.indexA,p.get(g.unitA.id)),ha.setPosition(v,g.unitB,g.indexB,p.get(g.unitB.id))},f)}function c(l,d,f){var p=f[0];if(void 0===p)return"";var m=p.unitA,h=p.indexA,v=p.unitB,g=p.indexB,y=d.unitsFeatures,S=y.get(m.id),C=S.members,_=S.offsets,x=y.get(v.id),D=x.members,w=x.offsets,A={granularity:"element"};return(_[h+1]-_[h]>1||w[g+1]-w[g]>1)&&(A.granularity="residue"),[a(d,p),bN(zt.Location(l,m,C[_[h]],l,v,D[w[g]]),A)].join("</br>")}e.Location=function t(l,d,f,p,m,h){return oX("interactions",{structure:d,interactions:l},{unitA:f,indexA:p,unitB:m,indexB:h})},e.isLocation=function r(l){return!!l&&"data-location"===l.kind&&"interactions"===l.tag},e.areLocationsEqual=function n(l,d){return l.data.structure===d.data.structure&&l.data.interactions===d.data.interactions&&l.element.indexA===d.element.indexA&&l.element.indexB===d.element.indexB&&l.element.unitA===d.element.unitA&&l.element.unitB===d.element.unitB},e.locationLabel=function i(l){return a(l.data.interactions,l.element)},e.Loci=function o(l,d,f){return yT("interactions",{structure:l,interactions:d},f,function(p){return u(d,f,p)},function(){return c(l,d,f)})},e.isLoci=function s(l){return!!l&&"data-loci"===l.kind&&"interactions"===l.tag},e.getBoundingSphere=u,e.getLabel=c}(dp||(dp={}));var SQe=[fZe,pZe,mZe,WZe,YZe,XZe,KKe,ZKe,rQe,dQe,fQe],eD={ionic:KZe,"pi-stacking":ZZe,"cation-pi":QZe,"halogen-bonds":QKe,"hydrogen-bonds":hZe,"weak-hydrogen-bonds":vZe,hydrophobic:nQe,"metal-coordination":pQe},xQe=function CQe(e){void 0===e&&(e=[]);var t=Object.create(null);return Object.keys(eD).forEach(function(r){t[r]=T.MappedStatic(e.includes(r)?"on":"off",{on:T.Group(eD[r].params),off:T.Group({})},{cycle:!0})}),t}(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),Sne={providers:T.Group(xQe,{isFlat:!0}),contacts:T.Group(MKe,{label:"Advanced Options"})};function _Qe(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y;return ce(this,function(S){switch(S.label){case 0:return n=R(R({},T.getDefaultValues(Sne)),r),[4,G2.attach(e,t)];case 1:S.sent(),a=[],pw(eD).forEach(function(C){var _=n.providers[C];"on"===_.name&&a.push(eD[C].createTester(_.params))}),i=new Set,a.forEach(function(C){return sa.add(i,C.requiredFeatures)}),o=SQe.filter(function(C){return sa.areIntersecting(i,C.types)}),s=xc.Mutable(),u=xc.Mutable(),c=0,l=t.unitSymmetryGroups.length,S.label=2;case 2:return c<l?(d=t.unitSymmetryGroups[c],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:c,max:l})]:[3,4]):[3,6];case 3:S.sent(),S.label=4;case 4:for(f=function wQe(e,t,r){var n=t.elements.length,a=sk.create(n,n/2);if(Fe.isAtomic(t))for(var i=0,o=r;i<o.length;i++)o[i].add(e,t,a);return a.getFeatures(n)}(t,d.units[0],o),p=function AQe(e,t,r,n,a){var i=ck.create(r,t.elements.length);return Fe.isAtomic(t)&&function FKe(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++)BKe(e,t,r,n,s[o],i)}(e,t,r,i,n,a),i.getContacts()}(t,d.units[0],f,a,n.contacts),m=0,h=d.units.length;m<h;++m)s.set((v=d.units[m]).id,f),u.set(v.id,p);S.label=5;case 5:return++c,[3,2];case 6:return g=function TQe(e,t,r,n){var a=lk.create();return Ze.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);!function kKe(e,t,r,n,a,i,o,s){var u=r.count,c=r.x,l=r.y,d=r.z,f=a.lookup3d,p=he.mul(NKe,n.conformation.operator.inverse,t.conformation.operator.matrix),m=!he.isIdentity(p),h=b(),v=Math.max.apply(Math,o.map(function(J){return J.maxDistance})),g=f.boundary.sphere,y=g.center,S=g.radius,C=(S+v)*(S+v),_=s.lineOfSightDistFactor,x=ha.Info(e,t,r),D=ha.Info(e,n,a);i.startUnitPair(t,n);for(var w=0;w<u;++w)if(b.set(h,c[w],l[w],d[w]),m&&b.transformMat4(h,h,p),!(b.squaredDistance(h,y)>C)){var A=f.find(h[0],h[1],h[2],v),E=A.indices,I=A.count,M=A.squaredDistances;if(0!==I){x.feature=w;for(var F=0;F<I;++F){var N=E[F];if(D.feature=N,tne(e,x,D))for(var j=M[F],U=0,H=o;U<H.length;U++){var z=H[U];if(j<z.maxDistance*z.maxDistance){var G=z.getType(e,x,D,j);if(G&&ane(e,x,D,_)){i.add(w,N,G);break}}}}}}i.finishUnitPair()}(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return Fe.isAtomic(i)},validUnitPair:function(i,o){return Ze.validUnitPair(e,i,o)}}),a.getContacts(t)}(t,s,a,n.contacts),function mQe(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[hQe(0,t),vQe(0,t),gQe(0,t),yQe(0,t),bQe(0,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],c=e.unitMap.get(u.unitA),l=e.unitMap.get(u.unitB);(d=ha.Info(e,c,a.get(u.unitA))).feature=u.indexA,(f=ha.Info(e,l,a.get(u.unitB))).feature=u.indexB;for(var p=0,m=i;p<m.length;p++)(h=m[p]).isApplicable(u.props.type)&&h.handleInterContact(o,d,f)}for(var v=n.keys();;){var g=v.next(),S=g.value;if(g.done)break;var C=n.get(S),_=a.get(S),x=e.unitMap.get(S);if(Fe.isAtomic(x)){for(var d=ha.Info(e,x,_),f=ha.Info(e,x,_),D=0,w=i;D<w.length;D++)(h=w[D]).startUnit(x,C,_);for(o=0,s=2*C.edgeCount;o<s;++o){d.feature=C.a[o],f.feature=C.b[o];for(var A=0,E=i;A<E.length;A++){var h;(h=E[A]).isApplicable(C.edgeProps.type[o])&&h.handleIntraContact(o,d,f)}}}}}(t,y={unitsFeatures:s,unitsContacts:u,contacts:g}),[2,y]}})})}var bk=R({},Sne),Ha=ep.createProvider({label:"Interactions",descriptor:Hu({name:"molstar_computed_interactions"}),type:"local",defaultParams:bk,getParams:function(e){return bk},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=R(R({},T.getDefaultValues(bk)),r),a={},[4,_Qe(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),Sk=dt(13421772),ms_HydrogenBond=2851770,ms_Hydrophobic=8421504,ms_HalogenBond=4259775,ms_Ionic=15779860,ms_MetalCoordination=9191577,ms_CationPi=16744448,ms_PiStacking=9220966,ms_WeakHydrogenBond=12967404,EQe=[["Hydrogen Bond",ms_HydrogenBond],["Hydrophobic",ms_Hydrophobic],["Halogen Bond",ms_HalogenBond],["Ionic",ms_Ionic],["Metal Coordination",ms_MetalCoordination],["Cation Pi",ms_CationPi],["Pi Stacking",ms_PiStacking],["Weak HydrogenBond",ms_WeakHydrogenBond]];function Cne(e){switch(e){case Rr.HydrogenBond:return ms_HydrogenBond;case Rr.Hydrophobic:return ms_Hydrophobic;case Rr.HalogenBond:return ms_HalogenBond;case Rr.Ionic:return ms_Ionic;case Rr.MetalCoordination:return ms_MetalCoordination;case Rr.CationPi:return ms_CationPi;case Rr.PiStacking:return ms_PiStacking;case Rr.WeakHydrogenBond:return ms_WeakHydrogenBond;case Rr.Unknown:return Sk}}var xne={},Ck={name:"interaction-type",label:"Interaction Type",category:hu.Category.Misc,factory:function _ne(e,t){var n=e.structure?Ha.get(e.structure):void 0,a=n?Oh(n.id,n.version):-1;return{factory:_ne,granularity:"group",color:n&&n.value?function(i){if(dp.isLocation(i)){var o=i.data.interactions,u=o.contacts,c=i.element,l=c.unitA,d=c.unitB,f=c.indexA,p=c.indexB;if(l===d){var m=o.unitsContacts.get(l.id),h=m.getDirectedEdgeIndex(f,p);return Cne(m.edgeProps.type[h])}return h=u.getEdgeIndex(f,l.id,p,d.id),Cne(u.edges[h].props.type)}return Sk}:function(){return Sk},props:t,contextHash:a,description:"Assigns colors according the interaction type of a link.",legend:sm(EQe)}},getParams:function IQe(e){return xne},defaultValues:T.getDefaultValues(xne),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Ha.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ha.ref(e.structure,!1)}}};function ec(e,t,r,n){var d,f,p,m,a=0,i=t.webgl,o=new bn,s=new lr.GeometryState,u=Wf(),c=[],l=to.create(),h=_i.createEmpty();function _(w){if(to.update(l,w),void 0!==w.visible&&d&&d.setVisibility(w.visible&&(null===l.unitTransforms||l.unitTransforms.isIdentity)),void 0!==w.alphaFactor&&d&&d.setAlphaFactor(w.alphaFactor),void 0!==w.pickable&&d&&d.setPickable(w.pickable),void 0!==w.overpaint&&d){var A=Io.remap(w.overpaint,f);d.setOverpaint(A,i)}if(void 0!==w.transparency&&d){var E=Po.remap(w.transparency,f);d.setTransparency(E,i)}if(void 0!==w.substance&&d){var I=Mo.remap(w.substance,f);d.setSubstance(I,i)}if(void 0!==w.clipping&&d){var M=Gn.remap(w.clipping,f);d.setClipping(M)}void 0!==w.themeStrength&&d&&d.setThemeStrength(w.themeStrength),void 0!==w.transform&&d&&d.setTransform(w.transform),void 0!==w.unitTransforms&&d&&d.setVisibility(l.visible&&(null===w.unitTransforms||w.unitTransforms.isIdentity))}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return m},get params(){return p},get state(){return l},get theme(){return h},get geometryVersion(){return s.version},renderObjects:c,updated:o,createOrUpdate:function v(w,A){var E=this;return void 0===w&&(w={}),A&&A!==f&&(p=r(t,A),f=A,m||(m=T.getDefaultValues(p))),m=Object.assign({},m,w),Ve.create("Creating or updating ComplexRepresentation",function(I){return ue(E,void 0,void 0,function(){var M,F,N;return ce(this,function(j){switch(j.label){case 0:return M=!1,d?!(null===(N=d.mustRecreate)||void 0===N)&&N.call(d,f,m,i)&&(d.destroy(),d=n(u,f,m,i),M=!0):(d=n(u,f,m,i),M=!0),(F=d.createOrUpdate({webgl:i,runtime:I},h,m,A))?[4,F]:[3,2];case 1:j.sent(),j.label=2;case 2:return M&&_(l),c.length=0,d&&d.renderObject&&(c.push(d.renderObject),s.add(d.renderObject.id,d.geometryVersion)),s.snapshot(),o.next(a+=1),[2]}})})})},setState:_,setTheme:function x(w){h=w},getLoci:function g(w){return d?d.getLoci(w):Wr},getAllLoci:function y(){var w;return[Ze.Loci(null!==(w=f.child)&&void 0!==w?w:f)]},eachLocation:function S(w){d?.eachLocation(w)},mark:function C(w,A){if(!f||!ds.is(l.markerActions,A))return!1;if(Ze.isLoci(w)||Re.is(w)||zt.isLoci(w)){if(!Ze.areRootsEquivalent(w.structure,f))return!1;w=fr.remap(w,f),(Ze.isLoci(w)||Re.is(w)&&Re.isWholeStructure(w))&&(w=gT)}else if(!vu(w)&&!R2(w))return!1;return!fr.isEmpty(w)&&!!d&&d.mark(w,A)},destroy:function D(){d&&d.destroy()}}}function wne(e,t,r){var n=t.elements,a=t.model;if(-1!==ke.indexOf(n,r)){for(var i=a.atomicHierarchy.residueAtomSegments,s=i.offsets,u=i.index[r],c=[],l=s[u],d=s[u+1];l<d;++l){var f=ke.indexOf(n,l);-1!==f&&c.push(f)}return Re(e,[{unit:t,indices:ke.ofSortedArray(Ye.ofSortedArray(c))}])}return Wr}function H2(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],c=s[r],l=s[r+1];c<l;++c){var d=ke.indexOf(a,c);if(-1!==d){var f=o.value(c);(n===f||""===f)&&u.push(d)}}return Re(e,[{unit:t,indices:ke.ofSortedArray(Ye.ofSortedArray(u))}])}function Ane(e,t,r){for(var n=e.structure.child,a=t&&n?e.group.units.filter(function(c){return n.unitMap.has(c.id)}):e.group.units,i=a.length,o=16*i,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<i;u++)he.toArray(a[u].conformation.operator.matrix,s,16*u);return zF(s,i,r)}var RQe=T.objectToOptions({atomic:{},spheres:{},gaussians:{}}),Tne=5e8;function Dne(e,t,r){void 0===r&&(r=Tne);var n=Nt.size(b(),e);b.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1];return{area:i,areaCells:Math.ceil(i/(t*t)),maxAreaCells:a}}function Om(e,t,r){void 0===r&&(r=Tne);var n=Dne(e,t.resolution,r),o=n.maxAreaCells,s=n.areaCells>o?Math.sqrt(n.area/o):t.resolution;return R(R({},t),{resolution:s})}var tD={ignoreHydrogens:T.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),traceOnly:T.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:T.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},BQe=(T.getDefaultValues(tD),b());function Ene(e,t,r,n){return b.squaredDistance(b.set(BQe,e,t,r),n)}function rD(e,t,r,n){var C,_,a=n.ignoreHydrogens,i=n.ignoreHydrogensVariant,o=n.traceOnly,s=n.includeParent,u=s?e.root.unitMap.get(t.id):t,c=s&&u!==t,l=function FQe(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}(u),d=l.x,f=l.y,p=l.z,m=u.elements,h=t.boundary.sphere,v=h.center,g=h.radius,S=(g+11)*(g+11);if(a||o||c){for(var x=[],D=[],w=0,A=m.length;w<A;++w){var E=m[w];a&&Tl(e,u,E,i)||o&&!xk(u,E)||c&&Ene(d[E],f[E],p[E],v)>S||(x.push(E),D.push(w))}C=Ye.ofSortedArray(x),_=D}else C=m,_=Bu(new Int32Array(C.length));s&&u!==t&&function NQe(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=Ye.indexOfInRange(t,r[i],n,a);-1===s?e[i]=-2:(e[i]=s,n=s)}}(_,t.elements,C);var I={indices:C,x:d,y:f,z:p,id:_},M=c?Jf(I):t.boundary,F=at.create(e,u);return{position:I,boundary:M,radius:function(j){return F.element=j,r.size(F)}}}function nD(e,t,r){var m,h,v,g,y,S,n=r.ignoreHydrogens,a=r.ignoreHydrogensVariant,i=r.traceOnly,s=r.includeParent&&!!e.parent,u=at.create(e.root),c=e.boundary.sphere,l=c.center,d=c.radius,p=(d+11)*(d+11);if(n||i||s){for(var C=e.serialMapping.getSerialIndex,_=s?e.root.units:e.units,x=[],D=[],w=[],A=[],E=[],I=0,M=_.length;I<M;++I){var N=(F=_[I]).elements,j=F.conformation,U=j.x,H=j.y,z=j.z,G=e.unitMap.get(F.id);u.unit=F;for(var J=0,X=N.length;J<X;++J){var Z=N[J];if((!n||!Tl(e,F,Z,a))&&(!i||xk(F,Z))){var ne=U(Z),Y=H(Z),k=z(Z);if(!(s&&Ene(ne,Y,k,l)>p))if(x.push(ne),D.push(Y),w.push(k),u.element=Z,A.push(t.size(u)),s){var W=G?Ye.indexOf(G.elements,Z):-1;E.push(-1===W?-2:C(G,Z))}else E.push(C(F,Z))}}}m=x,h=D,v=w,g=A,S=ke.ofRange(0,(y=E).length)}else{var $=e.elementCount,K=(x=new Float32Array($),D=new Float32Array($),w=new Float32Array($),A=new Float32Array($),I=0,0);for(M=e.units.length;I<M;++I){N=(F=e.units[I]).elements;var F,q=F.conformation;for(U=q.x,H=q.y,z=q.z,u.unit=F,J=0,X=N.length;J<X;++J){var V=K+J;x[V]=U(Z=N[J]),D[V]=H(Z),w[V]=z(Z),u.element=Z,A[V]=t.size(u)}K+=N.length}m=x,h=D,v=w,g=A,y=Bu(new Uint32Array($)),S=ke.ofRange(0,y.length)}var ee={indices:S,x:m,y:h,z:v,id:y};return{position:ee,boundary:s?Jf(ee):e.boundary,radius:function(me){return g[me]}}}var Ine=HA.H;function Tl(e,t,r,n){if(Fe.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[r]!==Ine)return!1;if("all"===n)return!0;var a=function TZe(e,t,r){var n=!1;return js(e,t,r,function(a,i){(function AZe(e){return wZe.has(e)})(nn(a,i))&&(n=!0)}),n}(e,t,Ye.indexOf(t.elements,r));return!!(a&&"polar"===n||!a&&"non-polar"===n)}function kQe(e,t){return e[t]===Ine}function xk(e,t){if(Fe.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return"CA"===r||"BB"===r||"P"===r}function j2(e){return T.MultiSelect(e,RQe,{description:"For which kinds of units/chains to show the representation visuals."})}var qs={unitKinds:j2(["atomic","spheres"]),includeParent:T.Boolean(!1,{isHidden:!0})},Pne=R({},Vt.Params),Mne=R({},Cd.Params),Rne=R({},qu.Params),LQe=R({},fm.Params),One=R({},na.Params),Fne=R({},zu.Params),Bne=R({},ju.Params),Nne=R({},is.Params);function Dv(e,t){var y,S,C,_,w,A,I,M,r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.processValues,l=e.dispose,d=e.geometryUtils,f=d.updateValues,p=d.updateBoundingSphere,m=d.updateRenderableState,h=d.createPositionIterator,v=Od.create(),g={loci:Wr,action:Ut.None,status:-1},x=Object.assign({},r),D=_i.createEmpty(),E=-1;function N(G){if(v.createNew){if(I=a(_),!G)throw new Error("expected geometry to be given");y=function UQe(e,t,r,n,a,i){var o=Oi.getUtils(t),u=o.createRenderableState,l=(0,o.createValues)(t,jF(),r,n,a),d=u(a);return Q0(t.kind,l,d,i)}(0,G,I,C,S,t),M=h(G,y.values)}else{if(!y)throw new Error("expected renderObject to be available");if(v.updateTransform){var J=(I=a(_)).instanceCount,X=I.groupCount;S.instanceGranularity?Ia(J,"instance",y.values):Ia(J*X,"groupInstance",y.values)}if(v.createGeometry){if(!G)throw new Error("expected geometry to be given");O.updateIfChanged(y.values.drawCount,Oi.getDrawCount(G)),O.updateIfChanged(y.values.uVertexCount,Oi.getVertexCount(G)),O.updateIfChanged(y.values.uGroupCount,Oi.getGroupCount(G))}(v.updateTransform||v.createGeometry)&&(p(y.values,G||A),M=h(A,y.values)),v.updateSize&&"uSize"in y.values&&Bf(I,C.size,y.values),v.updateColor&&Vu(I,M,C.color,y.values),f(y.values,S),m(y.state,S)}x=S,D=C,w=_,G&&(A=G,E+=1)}function H(G,J,X){return function j(G){return!!(vu(G)||Ze.isLoci(G)&&Ze.areRootsEquivalent(G.structure,w)||Re.is(G)&&Ze.areRootsEquivalent(G.structure,w)&&Re.isWholeStructure(G))}(G)?J(_e.ofBounds(0,x.instanceGranularity?I.instanceCount:I.groupCount*I.instanceCount)):x.instanceGranularity?function U(G,J,X){var Z=!1;return!(!Re.is(G)&&!zt.isLoci(G)||!Ze.areEquivalent(G.structure,J))&&(X(_e.ofSingleton(0))&&(Z=!0),Z)}(G,w,J):o(G,w,J,X)}function z(G){y&&c?.(y.values,A,x,D,G.webgl)}return{get groupCount(){return I?I.count:0},get renderObject(){return I&&I.count?y:void 0},get geometryVersion(){return E},createOrUpdate:function(G,J,X,Z){if(void 0===X&&(X={}),function F(G,J,X){if(!X&&!w)throw new Error("missing structure");if(S=Object.assign({},x,J),C=G,_=X,Od.reset(v),!y||!w)return v.createNew=!0,void(v.createGeometry=!0);s(v,S,x,C,D,_,w),Ze.areEquivalent(_,w)||(v.createGeometry=!0),Ze.areHierarchiesEqual(_,w)||(v.updateTransform=!0,v.createGeometry=!0),hu.areEqual(G.color,D.color)||(v.updateColor=!0),rd(S.unitKinds,x.unitKinds)||(v.createGeometry=!0),w.child!==_.child&&(v.createGeometry=!0),S.instanceGranularity!==x.instanceGranularity&&(v.updateTransform=!0),v.updateSize&&!("uSize"in y.values)&&(v.createGeometry=!0),v.createGeometry&&(v.updateColor=!0,v.updateSize=!0)}(J,X,Z||w),v.createGeometry){var ne=n(G,_,C,S,A);if(mw(ne))return ne.then(function(Y){N(Y),z(G)});N(ne)}else N();z(G)},getLoci:function(G){return y?i(G,w,y.id):Wr},eachLocation:function(G){for(I.reset();I.hasNext;){var J=I.move();G(J.location,J.isSecondary)}},mark:function(G,J){return gr.mark(y,G,J,H,g)},setVisibility:function(G){gr.setVisibility(y,G)},setAlphaFactor:function(G){gr.setAlphaFactor(y,G)},setPickable:function(G){gr.setPickable(y,G)},setColorOnly:function(G){gr.setColorOnly(y,G)},setTransform:function(G,J){gr.setTransform(y,G,J)},setOverpaint:function(G,J){gr.setOverpaint(y,G,H,!0,{geometry:A,props:x,webgl:J})},setTransparency:function(G,J){gr.setTransparency(y,G,H,!0,{geometry:A,props:x,webgl:J})},setSubstance:function(G,J){gr.setSubstance(y,G,H,!0,{geometry:A,props:x,webgl:J})},setClipping:function(G){gr.setClipping(y,G,H,!0)},setThemeStrength:function(G){gr.setThemeStrength(y,G)},destroy:function(){l?.(A),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var Iy=R(R({},Pne),qs);function fp(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Vt.Utils}),t)}var VQe=R(R({},Mne),qs),zQe=R(R({},Rne),qs),jQe=R(R({},One),qs),WQe=R(R({},Fne),qs),XQe=R(R({},Bne),qs),ZQe=R(R({},Nne),qs);function Oa(e,t,r,n){var f,p,m,h,a=0,i=t.webgl,o=new bn,s=Wf(),u=[],c=new lr.GeometryState,l=to.create(),d=new Map,v=_i.createEmpty();function x(E,I,M){var F=M.visible,N=M.alphaFactor,j=M.pickable,U=M.overpaint,H=M.transparency,z=M.substance,G=M.clipping,J=M.themeStrength,X=M.transform,Z=M.unitTransforms;void 0!==F&&E.setVisibility(F),void 0!==N&&E.setAlphaFactor(N),void 0!==j&&E.setPickable(j),void 0!==U&&E.setOverpaint(U,i),void 0!==H&&E.setTransparency(H,i),void 0!==z&&E.setSubstance(z,i),void 0!==G&&E.setClipping(G),void 0!==J&&E.setThemeStrength(J),void 0!==X&&(X!==l.transform||!he.areEqual(X,l.transform,mn))&&E.setTransform(X),void 0!==Z&&(Z?E.setTransform(void 0,Z.getSymmetryGroupTransforms(I)):Z!==l.unitTransforms&&E.setTransform(void 0,null))}return{label:e,get groupCount(){var E=0;return d.forEach(function(I){var M=I.visual;M.renderObject&&(E+=M.groupCount)}),E},get geometryVersion(){return c.version},get props(){return h},get params(){return m},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:function g(E,I){var M=this;return void 0===E&&(E={}),I&&I!==f&&(m=r(t,I),h||(h=T.getDefaultValues(m))),h=Object.assign({},h,E),Ve.create("Creating or updating UnitsRepresentation",function(F){return ue(M,void 0,void 0,function(){var N,j,U,H,z,G,J,X,Z,ne,Y,k,W;return ce(this,function($){switch($.label){case 0:if(f||I)return[3,1];throw new Error("missing structure");case 1:if(!I||f)return[3,8];p=I.unitSymmetryGroups,z=0,$.label=2;case 2:return z<p.length?(Z=p[z],X=n(s,I,h,i),(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:I}))?[4,ne]:[3,4]):[3,7];case 3:$.sent(),$.label=4;case 4:return x(X,Z,l),d.set(Z.hashCode,{visual:X,group:Z}),F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:z,max:p.length})]:[3,6];case 5:$.sent(),$.label=6;case 6:return z++,[3,2];case 7:return[3,43];case 8:if(!I||Ze.areUnitIdsAndIndicesEqual(I,f)&&I.child===f.child)return[3,22];p=I.unitSymmetryGroups,N=d,d=new Map,z=0,$.label=9;case 9:return z<p.length?(U=N.get((Z=p[z]).hashCode))?null!==(Y=(X=U.visual).mustRecreate)&&void 0!==Y&&Y.call(X,{group:Z,structure:I},h,i)?(X.destroy(),X=n(s,I,h,i),(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:I}))?[4,ne]:[3,11]):[3,12]:[3,15]:[3,21];case 10:$.sent(),$.label=11;case 11:return x(X,Z,l),[3,14];case 12:return(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:I}))?[4,ne]:[3,14];case 13:$.sent(),$.label=14;case 14:return d.set(Z.hashCode,{visual:X,group:Z}),N.delete(Z.hashCode),X.renderObject&&hN(j=X.renderObject.values.tMarker.ref.value.array,_e.ofBounds(0,j.length),Ut.RemoveHighlight),[3,18];case 15:return X=n(s,I,h,i),(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:I}))?[4,ne]:[3,17];case 16:$.sent(),$.label=17;case 17:x(X,Z,l),d.set(Z.hashCode,{visual:X,group:Z}),$.label=18;case 18:return F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:z,max:p.length})]:[3,20];case 19:$.sent(),$.label=20;case 20:return z++,[3,9];case 21:return N.forEach(function(K){K.visual.destroy()}),[3,43];case 22:if(!I||I===f||!Ze.areUnitIdsAndIndicesEqual(I,f))return[3,34];p=I.unitSymmetryGroups,z=0,$.label=23;case 23:return z<p.length?(U=d.get((Z=p[z]).hashCode))?null!==(k=(X=U.visual).mustRecreate)&&void 0!==k&&k.call(X,{group:Z,structure:I},h,t.webgl)?(X.destroy(),X=n(s,I,h,t.webgl),U.visual=X,(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:I}))?[4,ne]:[3,25]):[3,26]:[3,29]:[3,33];case 24:$.sent(),$.label=25;case 25:return x(X,Z,l),[3,28];case 26:return(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:I}))?[4,ne]:[3,28];case 27:$.sent(),$.label=28;case 28:return U.group=Z,[3,30];case 29:throw new Error("expected to find visual for hashCode ".concat(Z.hashCode));case 30:return F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:z,max:p.length})]:[3,32];case 31:$.sent(),$.label=32;case 32:return z++,[3,23];case 33:return[3,43];case 34:H=[],d.forEach(function(K){return H.push(K)}),z=0,G=H.length,$.label=35;case 35:return z<G?(Z=(J=H[z]).group,null!==(W=(X=J.visual).mustRecreate)&&void 0!==W&&W.call(X,{group:Z,structure:f},h,t.webgl)?(X.destroy(),X=n(s,f,h,i),H[z].visual=X,(ne=X.createOrUpdate({webgl:i,runtime:F},v,h,{group:Z,structure:f}))?[4,ne]:[3,37]):[3,38]):[3,43];case 36:$.sent(),$.label=37;case 37:return x(X,Z,l),[3,40];case 38:return(ne=X.createOrUpdate({webgl:i,runtime:F},v,h))?[4,ne]:[3,40];case 39:$.sent(),$.label=40;case 40:return F.shouldUpdate?[4,F.update({message:"Creating or updating UnitsVisual",current:z,max:G})]:[3,42];case 41:$.sent(),$.label=42;case 42:return++z,[3,35];case 43:return u.length=0,d.forEach(function(K){var q=K.visual;q.renderObject&&(u.push(q.renderObject),c.add(q.renderObject.id,q.geometryVersion))}),c.snapshot(),I&&(f=I),o.next(a++),[2]}})})})},setState:function D(E){var I=E.visible,M=E.alphaFactor,F=E.pickable,N=E.overpaint,j=E.transparency,U=E.substance,H=E.clipping,z=E.themeStrength,G=E.transform,J=E.unitTransforms,X=E.syncManually,Z=E.markerActions,ne={};void 0!==I&&(ne.visible=I),void 0!==M&&(ne.alphaFactor=M),void 0!==F&&(ne.pickable=F),void 0!==N&&f&&(ne.overpaint=Io.remap(N,f)),void 0!==j&&f&&(ne.transparency=Po.remap(j,f)),void 0!==U&&f&&(ne.substance=Mo.remap(U,f)),void 0!==H&&f&&(ne.clipping=Gn.remap(H,f)),void 0!==z&&(ne.themeStrength=z),void 0!==G&&!he.areEqual(G,l.transform,mn)&&(ne.transform=G),(J!==l.unitTransforms||J?.version!==l.unitTransformsVersion)&&(ne.unitTransforms=J,l.unitTransformsVersion=J?J?.version:-1),void 0!==X&&(ne.syncManually=X),void 0!==Z&&(ne.markerActions=Z),d.forEach(function(Y){return x(Y.visual,Y.group,ne)}),to.update(l,ne)},setTheme:function w(E){v=E},getLoci:function y(E){var I=Wr;return d.forEach(function(M){var N=M.visual.getLoci(E);fs(N)||(I=N)}),I},getAllLoci:function C(){var E;return[Ze.Loci(null!==(E=f.child)&&void 0!==E?E:f)]},eachLocation:function S(E){d.forEach(function(I){I.visual.eachLocation(E)})},mark:function _(E,I){if(!f||!ds.is(l.markerActions,I))return!1;if(Ze.isLoci(E)||Re.is(E)||zt.isLoci(E)){if(!Ze.areRootsEquivalent(E.structure,f))return!1;E=fr.remap(E,f),(Ze.isLoci(E)||Re.is(E)&&Re.isWholeStructure(E))&&(E=gT)}else if(!vu(E)&&!R2(E))return!1;if(fr.isEmpty(E))return!1;var M=!1;return d.forEach(function(F){M=F.visual.mark(E,I)||M}),M},destroy:function A(){d.forEach(function(E){return E.visual.destroy()}),d.clear()}}}function Fm(e,t){var S,x,D,w,A,E,M,F,r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.processValues,l=e.dispose,d=e.geometryUtils,f=d.createEmpty,p=d.updateValues,m=d.updateBoundingSphere,h=d.updateRenderableState,v=d.createPositionIterator,g=Od.create(),y={loci:Wr,action:Ut.None,status:-1},C=Object.assign({},r),_=_i.createEmpty(),I=-1;function j(X){if(g.createNew){if(M=a(x),!X)throw new Error("expected geometry to be given");S=function $Qe(e,t,r,n,a,i){var o=Oi.getUtils(t),u=o.createRenderableState,l=(0,o.createValues)(t,Ane(e,a.includeParent),r,n,a),d=u(a);return Q0(t.kind,l,d,i)}(x,X,M,_,C,t),F=v(X,S.values)}else{if(!S)throw new Error("expected renderObject to be available");if(g.updateTransform){var Z=(M=a(x)).instanceCount,ne=M.groupCount;C.instanceGranularity?Ia(Z,"instance",S.values):Ia(Z*ne,"groupInstance",S.values)}if(g.updateMatrix&&Ane(x,C.includeParent,S.values),g.createGeometry){if(!X)throw new Error("expected geometry to be given");O.updateIfChanged(S.values.drawCount,Oi.getDrawCount(X)),O.updateIfChanged(S.values.uVertexCount,Oi.getVertexCount(X)),O.updateIfChanged(S.values.uGroupCount,Oi.getGroupCount(X))}(g.updateTransform||g.createGeometry)&&(m(S.values,X||E),F=v(X||E,S.values)),g.updateSize&&"uSize"in S.values&&Bf(M,_.size,S.values),g.updateColor&&Vu(M,F,_.color,S.values),p(S.values,C),h(S.state,C)}D=C,w=_,A=x,X&&(E=X,I+=1)}function G(X,Z,ne){return function H(X){return!!(vu(X)||Ze.isLoci(X)&&Ze.areRootsEquivalent(X.structure,A.structure)||Re.is(X)&&Ze.areRootsEquivalent(X.structure,A.structure)&&Re.isWholeStructure(X))}(X)?Z(_e.ofBounds(0,D.instanceGranularity?M.instanceCount:M.groupCount*M.instanceCount)):D.instanceGranularity?function z(X,Z,ne){var Y=!1;if(zt.isLoci(X)){var W=Z.group;if(!Ze.areEquivalent(X.structure,Z.structure))return!1;for(var $=0,K=X.bonds;$<K.length;$++){var q=K[$];q.aUnit===q.bUnit&&void 0!==(V=W.unitIndexMap.get(q.aUnit.id))&&ne(_e.ofSingleton(V))&&(Y=!0)}}else if(Re.is(X)){if(W=Z.group,!Ze.areEquivalent(X.structure,Z.structure))return!1;for(var ee=0,ae=X.elements;ee<ae.length;ee++){var V;void 0!==(V=W.unitIndexMap.get(ae[ee].unit.id))&&ne(_e.ofSingleton(V))&&(Y=!0)}}return Y}(X,A,Z):o(X,A,Z,ne)}function J(X){S&&c?.(S.values,E,D,w,X.webgl)}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?S:void 0},get geometryVersion(){return I},createOrUpdate:function(X,Z,ne,Y){if(function N(X,Z,ne){if(!ne&&!A)throw new Error("missing structureGroup");if(C=Z,_=X,x=ne,Od.reset(g),!S||!A)return g.createNew=!0,void(g.createGeometry=!0);s(g,C,D,_,w,x,A),Ze.areHierarchiesEqual(A.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),hu.areEqual(_.color,w.color)||(g.updateColor=!0),A.structure.child!==x.structure.child&&(g.createGeometry=!0),C.instanceGranularity!==D.instanceGranularity&&(g.updateTransform=!0),rd(C.unitKinds,D.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==A.group.transformHash&&(x.group.units.length!==A.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var Y=x.group.units[0],k=A.group.units[0];Fe.areOperatorsEqual(Y,k)||(g.updateTransform=!0),Fe.areConformationsEqual(Y,k)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in S.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(A.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(_.color.granularity.startsWith("vertex")||S.values.dColorType.ref.value.startsWith("vertex")||_.color.granularity.startsWith("volume")||S.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}(Z,ne,Y||A),g.createGeometry){var k=function U(X,Z,ne,Y,k,W){return function OQe(e,t){for(var r=0,n=e.length;r<n;++r)if(Fe.isAtomic(t)&&"atomic"===e[r]||Fe.isSpheres(t)&&"spheres"===e[r]||Fe.isGaussians(t)&&"gaussians"===e[r])return!0;return!1}(k.unitKinds,Z)?n(X,Z,ne,Y,k,W):f(W)}(X,x.group.units[0],x.structure,_,C,E);if(mw(k))return k.then(function(W){j(W),J(X)});j(k)}else j();J(X)},getLoci:function(X){return S?i(X,A,S.id):Wr},eachLocation:function(X){for(M.reset();M.hasNext;){var Z=M.move();X(Z.location,Z.isSecondary)}},mark:function(X,Z){var ne=!0;if(Re.is(X)){ne=!1;for(var Y=A.group.units[0].invariantId,k=0,W=X.elements;k<W.length;k++)if(W[k].unit.invariantId===Y){ne=!0;break}}return!!ne&&gr.mark(S,X,Z,G,y)},setVisibility:function(X){gr.setVisibility(S,X)},setAlphaFactor:function(X){gr.setAlphaFactor(S,X)},setPickable:function(X){gr.setPickable(S,X)},setColorOnly:function(X){gr.setColorOnly(S,X)},setTransform:function(X,Z){gr.setTransform(S,X,Z)},setOverpaint:function(X,Z){gr.setOverpaint(S,X,G,!0,{geometry:E,props:D,webgl:Z})},setTransparency:function(X,Z){gr.setTransparency(S,X,G,!0,{geometry:E,props:D,webgl:Z})},setSubstance:function(X,Z){gr.setSubstance(S,X,G,!0,{geometry:E,props:D,webgl:Z})},setClipping:function(X){gr.setClipping(S,X,G,!0)},setThemeStrength:function(X){gr.setThemeStrength(S,X)},destroy:function(){l?.(E),S&&(S.state.disposed=!0,S=void 0)},mustRecreate:u}}var qo=R(R({},Pne),qs);function Ws(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Vt.Utils}),t)}var kne=R(R({},Mne),qs);function Lne(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Cd.Utils}),t)}var Une=R(R({},Rne),qs);function Vne(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:qu.Utils}),t)}var JQe=R(R({},LQe),qs),aD=R(R({},One),qs);function iD(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:na.Utils}),t)}R(R({},Fne),qs);var oD,t$e=R(R({},Bne),qs),n$e=R(R({},Nne),qs),to={create:function(){return R(R({},lr.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){lr.updateState(e,t),void 0!==t.unitTransforms&&(e.unitTransforms=t.unitTransforms)}},pp=b(),q2=b(),W2=b(),_k=qe.add,Gne=qe.add3;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=qe.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),c=qe.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),l=function(f,p,m,h,v,g,y,S,C,_){for(var x=0;x<6;++x)Gne(o,f,p,m),Gne(s,h,v,g),_k(i,_),_k(u,y),_k(c,(S?1:0)+(C?2:0))},d=function(f,p,m,h,v,g,y,S){var C=b.distance(f,p),_=m%2!=0,x=Math.floor((m+1)/2),D=C/(m+.5);b.setMagnitude(W2,b.sub(W2,p,f),D),b.copy(pp,f);for(var w=0;w<x;++w)b.add(pp,pp,W2),_&&w===x-1?(b.copy(q2,p),y||(g=!1)):b.add(q2,pp,W2),l(pp[0],pp[1],pp[2],q2[0],q2[1],q2[2],h,v,g,S),b.add(pp,pp,W2)};return{add:l,addFixedCountDashes:d,addFixedLengthDashes:function(f,p,m,h,v,g,y){var S=b.distance(f,p);d(f,p,S/m,h,v,g,!0,y)},getCylinders:function(){var f=i.elementCount/6,p=qe.compact(i,!0),m=qe.compact(o,!0),h=qe.compact(s,!0),v=qe.compact(u,!0),g=qe.compact(c,!0),y=a&&f<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(18*f),S=a&&f<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(12*f);return(!a||f>a.cylinderCount)&&function i$e(e,t,r){for(var n=0;n<e;++n){var a=18*n;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(n=0;n<e;++n){var i=6*n,o=12*n;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}(f,y,S),qu.create(y,S,p,m,h,v,g,f,a)}}}}(oD||(oD={}));var Ev={linkScale:T.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:T.Numeric(1,{min:0,max:2,step:.01}),linkCap:T.Boolean(!1),aromaticScale:T.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:T.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:T.Numeric(2,{min:1,max:6,step:1}),dashCount:T.Numeric(4,{min:0,max:10,step:1}),dashScale:T.Numeric(.8,{min:0,max:2,step:.1}),dashCap:T.Boolean(!0),stubCap:T.Boolean(!0),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo)},zne=(T.getDefaultValues(Ev),{linkScale:T.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:T.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:T.Numeric(2,{min:1,max:6,step:1}),dashCount:T.Numeric(4,{min:0,max:10,step:1})}),Mn=(T.getDefaultValues(zne),b()),Bm=b(),Hc=b(),o$e=b.create(0,1,0);function wk(e,t,r,n){b.normalize(Bm,b.sub(Bm,t,r)),null!==n?b.sub(Hc,t,n):b.copy(Hc,t),b.normalize(Hc,Hc);var a=b.dot(Bm,Hc);return 1-Math.abs(a)<1e-5&&(b.set(Hc,1,0,0),a=b.dot(Bm,Hc),1-Math.abs(a)<1e-5&&(b.set(Hc,0,1,0),a=b.dot(Bm,Hc))),b.setMagnitude(Bm,Bm,a),b.sub(Hc,Hc,Bm),b.normalize(e,Hc)}var Dl=b.scale,Ca=b.add,ui=b.sub,Fo=b.setMagnitude,s$e=b.dot;function Iv(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,c=t.ignore,l=t.stub;if(!a)return{mesh:Vt.createEmpty(n)};for(var d=r.linkScale,f=r.linkSpacing,p=r.radialSegments,m=r.linkCap,h=r.aromaticScale,v=r.aromaticSpacing,g=r.aromaticDashCount,y=r.dashCount,S=r.dashScale,C=r.dashCap,_=r.stubCap,x=2*p*a*2,D=yt.createState(x,x/4,n),w=b(),A=b(),E=b(),I=b(),M=0,F={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:m,bottomCap:m},N=0,j=a;N<j;++N)if(!c||!c(N)){o(w,A,N),Ca(I,I,w),Ca(I,I,A),M+=2,ui(Mn,A,w);var U=s$e(Mn,o$e)>0,H=u(N),z=s?s(N):0,G=_&&!!l&&l(N),J=U?[G,m]:[m,G],X=J[0],Z=J[1];if(D.currentGroup=N,0===z)F.radiusTop=F.radiusBottom=H,F.topCap=X,F.bottomCap=Z,yo(D,w,A,.5,F);else if(1===z)F.radiusTop=F.radiusBottom=H*S,F.topCap=F.bottomCap=C,VS(D,w,A,.5,y,G,F);else if(2===z||3===z||4===z||5===z||7===z||8===z){var ne=2===z||3===z?2:4===z||5===z?3:1.5,Y=H*(d/(.5*ne)),k=(H-Y)*f;if(wk(E,w,A,i?i(N):null),F.topCap=X,F.bottomCap=Z,7===z||8===z){F.radiusTop=F.radiusBottom=H,yo(D,w,A,.5,F);var W=H+h*H+h*H*v;Fo(Mn,ui(Mn,A,w),.5*H),Ca(w,w,Mn),ui(A,A,Mn),F.radiusTop=F.radiusBottom=H*h,F.topCap=F.bottomCap=C,Fo(E,E,W),ui(w,w,E),ui(A,A,E),VS(D,w,A,.5,g,G,F),8===z&&(Fo(E,E,2*W),Ca(w,w,E),Ca(A,A,E),VS(D,w,A,.5,g,G,F))}else if(3===z||5===z){var $=H+Y+d*H*f;Fo(E,E,$),F.radiusTop=F.radiusBottom=H,yo(D,w,A,.5,F),Dl(Mn,Mn,f*d*.2),Ca(w,w,Mn),ui(A,A,Mn),F.radiusTop=F.radiusBottom=Y,F.topCap=U?G:C,F.bottomCap=U?C:G,Fo(E,E,$),ui(w,w,E),ui(A,A,E),yo(D,w,A,.5,F),3===ne&&(Fo(E,E,2*$),Ca(w,w,E),Ca(A,A,E),yo(D,w,A,.5,F))}else Fo(E,E,k),F.radiusTop=F.radiusBottom=Y,3===ne&&yo(D,w,A,.5,F),MFe(D,w,A,.5,E,F)}else 6===z&&(Dl(Mn,Mn,.475),Ca(w,w,Mn),ui(A,A,Mn),F.radiusTop=F.radiusBottom=H,F.topCap=X,F.bottomCap=Z,yo(D,w,A,.5,F))}var K=n?Pe.clone(n.boundingSphere):void 0,q=yt.getMesh(D);return 0===M?{mesh:q}:(b.scale(I,I,1/M),K&&b.distance(I,K.center)/K.radius<.1?{mesh:q,boundingSphere:K}:{mesh:q})}function Hne(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,c=t.ignore,l=t.stub;if(!a)return{cylinders:qu.createEmpty(n)};for(var d=r.linkScale,f=r.linkSpacing,p=r.linkCap,m=r.aromaticScale,h=r.aromaticSpacing,v=r.aromaticDashCount,g=r.dashCount,y=r.dashScale,S=r.dashCap,C=r.stubCap,_=2*a,x=oD.create(_,_/4,n),D=b(),w=b(),A=b(),E=b(),I=b(),M=0,F=0,N=a;F<N;++F)if(!c||!c(F)){o(D,w,F),Ca(I,I,D),Ca(I,I,w),M+=2;var j=u(F),U=s?s(F):0,H=C&&!!l&&l(F);if(0===U)Dl(A,Ca(A,D,w),.5),x.add(D[0],D[1],D[2],A[0],A[1],A[2],1,p,H,F);else if(1===U)Dl(A,Ca(A,D,w),.5),x.addFixedCountDashes(D,A,g,y,S,S,H,F);else if(2===U||3===U||4===U||5===U||7===U||8===U){var z=2===U||3===U?2:4===U||5===U?3:1.5,G=d/(.5*z),J=(j-G*j)*f;if(Dl(A,Ca(A,D,w),.5),wk(E,D,w,i?i(F):null),7===U||8===U){x.add(D[0],D[1],D[2],A[0],A[1],A[2],1,p,H,F);var X=j+m*j+m*j*h;Fo(Mn,ui(Mn,w,D),.5*j),Ca(D,D,Mn),Fo(E,E,X),ui(D,D,E),ui(A,A,E),x.addFixedCountDashes(D,A,v,m,S,S,H,F),8===U&&(Fo(E,E,2*X),Ca(D,D,E),Ca(A,A,E),x.addFixedCountDashes(D,A,v,m,S,S,H,F))}else 3===U||5===U?(Fo(E,E,j+G*j+d*j*f),x.add(D[0],D[1],D[2],A[0],A[1],A[2],1,p,H,F),Fo(Mn,ui(Mn,D,A),j/1.5),ui(D,D,Mn),3===z&&x.add(D[0]+E[0],D[1]+E[1],D[2]+E[2],A[0]+E[0],A[1]+E[1],A[2]+E[2],G,p,H,F),x.add(D[0]-E[0],D[1]-E[1],D[2]-E[2],A[0]-E[0],A[1]-E[1],A[2]-E[2],G,S,H,F)):(Fo(E,E,J),3===z&&x.add(D[0],D[1],D[2],A[0],A[1],A[2],G,p,H,F),x.add(D[0]+E[0],D[1]+E[1],D[2]+E[2],A[0]+E[0],A[1]+E[1],A[2]+E[2],G,p,H,F),x.add(D[0]-E[0],D[1]-E[1],D[2]-E[2],A[0]-E[0],A[1]-E[1],A[2]-E[2],G,p,H,F))}else 6===U&&(Dl(Mn,ui(Mn,A,D),.475),Ca(D,D,Mn),ui(A,A,Mn),x.add(D[0],D[1],D[2],A[0],A[1],A[2],1,p,H,F))}var ne=n?Pe.clone(n.boundingSphere):void 0,Y=x.getCylinders();return 0===M?{cylinders:Y}:(b.scale(I,I,1/M),ne&&b.distance(I,ne.center)/ne.radius<.1?{cylinders:Y,boundingSphere:ne}:{cylinders:Y})}function jne(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return{lines:na.createEmpty(n)};for(var c=r.linkScale,l=r.linkSpacing,d=r.aromaticDashCount,f=r.dashCount,p=2*a,m=uu.create(p,p/4,n),h=b(),v=b(),g=b(),y=b(),S=b(),C=0,D=0,w=a;D<w;++D)if(!u||!u(D)){o(h,v,D),Ca(S,S,h),Ca(S,S,v),C+=2;var A=s?s(D):0;if(0===A)Dl(g,Ca(g,h,v),.5),m.add(h[0],h[1],h[2],g[0],g[1],g[2],D);else if(1===A)Dl(g,Ca(g,h,v),.5),m.addFixedCountDashes(h,g,f,D);else if(2===A||3===A||4===A||5===A||7===A||8===A){var E=2===A||3===A?2:4===A||5===A?3:1.5,M=(1-c/(.5*E)*1)*l;if(Dl(g,Ca(g,h,v),.5),wk(y,h,v,i?i(D):null),7===A||8===A){m.add(h[0],h[1],h[2],g[0],g[1],g[2],D);var F=4.5*M;Fo(Mn,ui(Mn,v,h),.5*F),Ca(h,h,Mn),Fo(y,y,F),ui(h,h,y),ui(g,g,y),m.addFixedCountDashes(h,g,d,D),8===A&&(Fo(y,y,2*F),Ca(h,h,y),Ca(g,g,y),m.addFixedCountDashes(h,g,d,D))}else 3===A||5===A?(Fo(y,y,3*M),m.add(h[0],h[1],h[2],g[0],g[1],g[2],D),Dl(Mn,ui(Mn,h,g),l*c),ui(h,h,Mn),3===E&&m.add(h[0]+y[0],h[1]+y[1],h[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],D),m.add(h[0]-y[0],h[1]-y[1],h[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],D)):(Fo(y,y,1.5*M),3===E&&m.add(h[0],h[1],h[2],g[0],g[1],g[2],D),m.add(h[0]+y[0],h[1]+y[1],h[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],D),m.add(h[0]-y[0],h[1]-y[1],h[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],D))}else 6===A&&(Dl(Mn,ui(Mn,g,h),.475),Ca(h,h,Mn),ui(g,g,Mn),m.add(h[0],h[1],h[2],g[0],g[1],g[2],D))}var N=n?Pe.clone(n.boundingSphere):void 0,j=m.getLines();return 0===C?{lines:j}:(b.scale(S,S,1/C),N&&b.distance(S,N.center)/N.radius<.1?{lines:j,boundingSphere:N}:{lines:j})}var qne={sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),dashCount:T.Numeric(6,{min:1,max:10,step:1}),dashScale:T.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),includeParent:T.Boolean(!1),parentDisplay:T.Select("stub",T.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};function u$e(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j,H,z,G,J;return ce(this,function(X){return Fe.isAtomic(t)?(o=r.child,s=o?.unitMap.get(t.id),o&&!s?[2,Vt.createEmpty(i)]:(u=at.create(r,t),c=Ha.get(r).value,l=c.unitsFeatures.get(t.id),d=c.unitsContacts.get(t.id),f=l.x,p=l.y,m=l.z,h=l.members,v=l.offsets,y=d.a,S=d.b,_=(C=d.edgeProps).flag,x=C.type,D=a.sizeFactor,w=a.ignoreHydrogens,A=a.ignoreHydrogensVariant,E=a.parentDisplay,(g=d.edgeCount)?(I=t.conformation.invariantPosition,M=t.elements,F=b(),N=b(),j=b(),H=Iv(0,{linkCount:2*g,position:function(Z,ne,Y){var k=x[Y];if(w&&"all"===A||k!==Rr.HydrogenBond&&k!==Rr.WeakHydrogenBond)b.set(Z,f[y[Y]],p[y[Y]],m[y[Y]]),b.set(ne,f[S[Y]],p[S[Y]],m[S[Y]]);else{var W=h[v[y[Y]]],$=h[v[S[Y]]];I(M[W],N),I(M[$],j);var K=b.distance(N,j),q=K;b.copy(Z,N),b.copy(ne,j),rk(t,W,function(V,ee){if(Tl(r,t,M[ee],"polar")){I(M[ee],F);var ae=b.distance(F,j);ae<K&&(K=ae,b.copy(Z,F))}}),rk(t,$,function(V,ee){if(Tl(r,t,M[ee],"polar")){I(M[ee],F);var ae=b.distance(F,N);ae<q&&(q=ae,b.copy(ne,F))}})}},style:function(Z){return 1},radius:function(Z){u.element=M[h[v[y[Z]]]];var ne=n.size.size(u);u.element=M[h[v[S[Z]]]];var Y=n.size.size(u);return Math.min(ne,Y)*D},ignore:function(Z){if(_[Z]===Vd.Filtered)return!0;if(s)if("stub"===E){for(var ne=y[Z],Y=v[ne],k=v[ne+1];Y<k;++Y)if(!Ye.has(s.elements,M[h[v[Y]]]))return!0}else{if("full"===E||"between"===E){var $=!1,K=!1,q=y[Z];for(Y=v[q],k=v[q+1];Y<k;++Y)Ye.has(s.elements,M[h[v[Y]]])||($=!0);var ee=S[Z];for(Y=v[ee],k=v[ee+1];Y<k;++Y)Ye.has(s.elements,M[h[v[Y]]])||(K=!0);return"full"===E?$&&K:$===K}Sn()}return!1}},a,i),z=H.mesh,(G=H.boundingSphere)?z.setBoundingSphere(G):z.triangleCount>0&&(J=Pe.expand(Pe(),(s??t).boundary.sphere,1*D),z.setBoundingSphere(J)),[2,z]):[2,Vt.createEmpty(i)])):[2,Vt.createEmpty(i)]})})}var Wne=R(R(R({},qo),Ev),qne);function c$e(e){return Ws({defaultProps:T.getDefaultValues(Wne),createGeometry:u$e,createLocationIterator:f$e,getLoci:l$e,eachLocation:d$e,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;var u=Ha.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function l$e(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=o.unitMap.get(t.group.units[e.instanceId].id),c=Ha.get(o).value,l=c.unitsContacts.get(u.id),d=l.a,f=l.b;return dp.Loci(o,c,[{unitA:u,indexA:d[i],unitB:u,indexB:f[i]},{unitA:u,indexA:f[i],unitB:u,indexB:d[i]}])}return Wr}var Ak=new Set;function d$e(e,t,r,n){var a=!1;if(dp.isLoci(e)){var o=t.group;if(!Ze.areEquivalent(e.data.structure,i=t.structure))return!1;var s=Ha.get(i).value;if(e.data.interactions!==s)return!1;for(var c=s.unitsContacts.get((u=o.units[0]).id),l=2*c.edgeCount,d=0,f=e.elements;d<f.length;d++)if((p=f[d]).unitA===p.unitB){var m=o.unitIndexMap.get(p.unitA.id);if(void 0!==m){var h=c.getDirectedEdgeIndex(p.indexA,p.indexB);-1!==h&&r(_e.ofSingleton(m*l+h))&&(a=!0)}}}else if(Re.is(e)){var i;if(o=t.group,!Ze.areEquivalent(e.structure,i=t.structure))return!1;if(!(s=Ha.get(i).value))return!1;for(var u,v=s.unitsContacts.get((u=o.units[0]).id),g=s.unitsFeatures.get(u.id),y=2*v.edgeCount,S=v.offset,C=g.elementsIndex,_=C.offsets,x=C.indices,D=g.members,w=g.offsets,A=function(U){var H=o.unitIndexMap.get(U.unit.id);if(void 0===H)return"continue";ke.forEach(U.indices,function(z){for(var G=_[z],J=_[z+1];G<J;++G)for(var X=x[G],Z=S[X],ne=S[X+1];Z<ne;++Z)Ak.add(Z)}),Ak.forEach(function(z){if(n){for(var G=v.a[z],J=w[G],X=w[G+1];J<X;++J)if(!ke.has(U.indices,D[J]))return;var Z=v.b[z];for(J=w[Z],X=w[Z+1];J<X;++J)if(!ke.has(U.indices,D[J]))return}r(_e.ofSingleton(H*y+z))&&(a=!0)}),Ak.clear()},E=0,I=e.elements;E<I.length;E++){var p;A(p=I[E])}}return a}function f$e(e){var t=e.structure,r=e.group,n=r.units[0],a=Ha.get(t).value,i=a.unitsContacts.get(n.id),o=2*i.edgeCount,s=r.units.length,u=dp.Location(a,t),c=u.element;return On(o,s,1,function(d,f){var p=r.units[f];return c.unitA=p,c.indexA=i.a[d],c.unitB=p,c.indexB=i.b[d],u})}function p$e(e,t,r,n,a){if(!t.hasAtomic)return Vt.createEmpty(a);var i=at.create(t),o=Ha.get(t).value,s=o.contacts,u=o.unitsFeatures,c=s.edgeCount,l=s.edges,d=n.sizeFactor,f=n.ignoreHydrogens,p=n.ignoreHydrogensVariant,m=n.parentDisplay;if(!c)return Vt.createEmpty(a);var h=t.child,v=b(),g=b(),y=b(),C=Iv(0,{linkCount:c,position:function(A,E,I){var M=l[I],F=M.unitA,N=M.indexA,j=M.unitB,U=M.indexB,H=M.props.type,z=u.get(F),G=u.get(j),J=t.unitMap.get(F),X=t.unitMap.get(j);if(f&&"all"===p||H!==Rr.HydrogenBond&&H!==Rr.WeakHydrogenBond)b.set(A,z.x[N],z.y[N],z.z[N]),b.transformMat4(A,A,J.conformation.operator.matrix),b.set(E,G.x[U],G.y[U],G.z[U]),b.transformMat4(E,E,X.conformation.operator.matrix);else{var Z=z.members[z.offsets[N]],ne=G.members[G.offsets[U]];J.conformation.position(J.elements[Z],g),X.conformation.position(X.elements[ne],y);var Y=b.distance(g,y),k=Y;b.copy(A,g),b.copy(E,y),js(t,J,Z,function(W,$){var K=W.elements[$];if(Tl(t,W,K,"polar")){W.conformation.position(K,v);var q=b.distance(v,y);q<Y&&(Y=q,b.copy(A,v))}}),js(t,X,ne,function(W,$){var K=W.elements[$];if(Tl(t,W,K,"polar")){W.conformation.position(K,v);var q=b.distance(v,g);q<k&&(k=q,b.copy(E,v))}})}},style:function(A){return 1},radius:function(A){var E=l[A],I=u.get(E.unitA);i.unit=t.unitMap.get(E.unitA),i.element=i.unit.elements[I.members[I.offsets[E.indexA]]];var M=r.size.size(i),F=u.get(E.unitB);i.unit=t.unitMap.get(E.unitB),i.element=i.unit.elements[F.members[F.offsets[E.indexB]]];var N=r.size.size(i);return Math.min(M,N)*d},ignore:function(A){if(l[A].props.flag===Vd.Filtered)return!0;if(h){var E=l[A];if("stub"===m){if(!(I=h.unitMap.get(E.unitA)))return!0;for(var M=t.unitMap.get(E.unitA),F=u.get(E.unitA),j=F.members,U=(N=F.offsets)[E.indexA],H=N[E.indexA+1];U<H;++U)if(!Ye.has(I.elements,M.elements[j[U]]))return!0}else{if("full"===m||"between"===m){var I,G=!1,J=!1;if(I=h.unitMap.get(E.unitA)){M=t.unitMap.get(E.unitA);var X=u.get(E.unitA);for(j=X.members,U=(N=X.offsets)[E.indexA],H=N[E.indexA+1];U<H;++U)Ye.has(I.elements,M.elements[j[U]])||(G=!0)}else G=!0;var Z=h.unitMap.get(E.unitB);if(Z){var N,ne=t.unitMap.get(E.unitB),Y=u.get(E.unitB);for(j=Y.members,U=(N=Y.offsets)[E.indexB],H=N[E.indexB+1];U<H;++U)Ye.has(Z.elements,ne.elements[j[U]])||(J=!0)}else J=!0;return"full"===m?G&&J:G===J}Sn()}}return!1}},n,a),_=C.mesh,x=C.boundingSphere;if(x)_.setBoundingSphere(x);else if(_.triangleCount>0){var D=t.child,w=Pe.expand(Pe(),(D??t).boundary.sphere,1*d);_.setBoundingSphere(w)}return _}var Yne=R(R(R({},Iy),Ev),qne);function m$e(e){return fp({defaultProps:T.getDefaultValues(Yne),createGeometry:p$e,createLocationIterator:g$e,getLoci:h$e,eachLocation:v$e,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;var u=Ha.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function h$e(e,t,r){var a=e.groupId;if(r===e.objectId){var i=Ha.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return dp.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return Wr}var sD=new Map,Tk=new Set;function v$e(e,t,r,n){var a=!1;if(dp.isLoci(e)){if(!Ze.areEquivalent(e.data.structure,t))return!1;var i=Ha.get(t).value;if(e.data.interactions!==i)return!1;for(var o=i.contacts,s=0,u=e.elements;s<u.length;s++){var c=u[s],l=o.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);-1!==l&&r(_e.ofSingleton(l))&&(a=!0)}}else if(Re.is(e)){if(!Ze.areEquivalent(e.structure,t)||n&&1===e.elements.length)return!1;if(!(i=Ha.get(t).value))return!1;for(var d=i.contacts,f=i.unitsFeatures,p=0,m=e.elements;p<m.length;p++)sD.set((h=m[p]).unit.id,h.indices);for(var v=function(C){var _=C.unit;if(!Fe.isAtomic(_))return"continue";ke.forEach(C.indices,function(x){for(var D=0,w=d.getContactIndicesForElement(x,_);D<w.length;D++)Tk.add(w[D])})},g=0,y=e.elements;g<y.length;g++){var h;v(h=y[g])}Tk.forEach(function(C){if(n){var _=d.edges[C],x=_.indexA,D=_.unitA,w=_.indexB,A=_.unitB,E=sD.get(D),I=sD.get(A);if(!E||!I)return;for(var M=f.get(D),F=M.offsets,N=M.members,j=F[x],U=F[x+1];j<U;++j)if(!ke.has(E,N[j]))return;var H=f.get(A),z=H.offsets,G=H.members;for(j=z[w],U=z[w+1];j<U;++j)if(!ke.has(I,G[j]))return}r(_e.ofSingleton(C))&&(a=!0)}),sD.clear(),Tk.clear()}return a}function g$e(e){var t=Ha.get(e).value,r=t.contacts,n=r.edgeCount,i=dp.Location(t,e),o=i.element;return On(n,1,1,function(u){var c=r.edges[u];return o.unitA=e.unitMap.get(c.unitA),o.indexA=c.indexA,o.unitB=e.unitMap.get(c.unitB),o.indexB=c.indexB,i},!0)}var mp,Xne={"intra-unit":function(e,t){return Oa("Intra-unit interactions cylinder",e,t,c$e)},"inter-unit":function(e,t){return ec("Inter-unit interactions cylinder",e,t,m$e)}},Kne=R(R(R({},Wne),Yne),{unitKinds:j2(["atomic"]),sizeFactor:T.Numeric(.2,{min:.01,max:1,step:.01}),visuals:T.MultiSelect(["intra-unit","inter-unit"],T.objectToOptions(Xne))}),uD={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:function b$e(e,t){return lr.createMulti("Interactions",e,t,to,Xne)},getParams:function y$e(e,t){return T.clone(Kne)},defaultValues:T.getDefaultValues(Kne),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Ha.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Ha.attach(e,t,void 0,!0)},detach:function(e){return Ha.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},S$e=$r.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=Ha,r.labelProvider={label:function(n){if(r.params.showTooltip&&"element-loci"===n.kind){if(0===n.elements.length)return;for(var a=[],o=0,s=r.getStructures(n.structure);o<s.length;o++){var u=s[o],c=r.provider.get(u).value;if(c){var l=Re.remap(n,u);if(1===l.elements.length){var d=l.elements[0];if(1===ke.size(d.indices)){var f=c.unitsFeatures.get(d.unit.id);if(f){for(var p=[],m=[],h=[],v=ke.start(d.indices),g=f.types,y=f.groups,S=f.elementsIndex,C=S.indices,_=S.offsets,x=_[v],D=_[v+1];x<D;++x){var w=C[x],A=g[w],E=y[w];A&&p.push(IKe(A)),E&&m.push(PKe(E))}p.length&&h.push("<small>Types</small> ".concat(p.join(", "))),m.length&&h.push("<small>Groups</small> ".concat(m.join(", "))),h.length&&a.push("Interaction Feature: ".concat(h.join(" | ")))}}}}}return a.length?a.join("<br/>"):void 0}}},r}return jt(t,e),t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var s=0,u=this.ctx.state.data.select(xr.Generators.ofType(ve.Molecule.Structure,a.transform.ref));s<u.length;s++){var c=u[s];c.obj&&Ya(n,c.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Ck),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(uD)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Ck),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(uD)},t}($r.Handler),params:function(){return{autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)}}}),C$e=$r.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=Oc,r}return jt(t,e),t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}($r.Handler),params:function(){return{autoAttach:T.Boolean(!1)}}}),x$e=$r.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=G2,r.labelProvider={label:function(n){if(r.params.showTooltip&&"element-loci"===n.kind){if(0===n.elements.length)return;for(var a=[],o=0,s=r.getStructures(n.structure);o<s.length;o++){var u=s[o],c=r.provider.get(u).value;if(c){var l=Re.remap(n,u);if(1===l.elements.length){var d=l.elements[0];if(1===ke.size(d.indices)){var f=c.get(d.unit.id);if(f){var p=ke.start(d.indices),h=f.idealGeometry[p],v=f.implicitH[p],g=f.totalH[p];a.push("Valence Model: <small>Charge</small> ".concat(f.charge[p]," | <small>Ideal Geometry</small> ").concat(CKe(h)," | <small>Implicit H</small> ").concat(v," | <small>Total H</small> ").concat(g))}}}}}return a.length?a.join("<br/>"):void 0}}},r}return jt(t,e),t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var s=0,u=this.ctx.state.data.select(xr.Generators.ofType(ve.Molecule.Structure,a.transform.ref));s<u.length;s++){var c=u[s];c.obj&&Ya(n,c.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}($r.Handler),params:function(){return{autoAttach:T.Boolean(!1),showTooltip:T.Boolean(!0)}}}),Dk=dt(16448250),Y2=new Map,Zne=R({},ls({type:"colors",colorList:"set-1"})),$ne={name:"sifts-mapping",label:"SIFTS Mapping",category:hu.Category.Residue,factory:function Qne(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var o=Td.Provider.get(a[n]).value;if(o)for(var s=0,u=o.accession;s<u.length;s++){var c=u[s];!c||Y2.has(c)||Y2.set(c,Y2.size)}}var l=at.create(e.structure),d=Vs(Y2.size+1,t,{valueLabel:function(m){return"".concat(m)}}),f=new Map,p=function(m){var h=Td.getKey(m);if(!h)return Dk;if(f.has(h))return f.get(h);var v=d.color(Y2.get(h));return f.set(h,v),v};r=function(m){return at.is(m)&&Fe.isAtomic(m.unit)?p(m):zt.isLocation(m)?(l.unit=m.aUnit,l.element=m.aUnit.elements[m.aIndex],p(l)):Dk}}else r=function(){return Dk};return{factory:Qne,granularity:"group",preferSmoothing:!0,color:r,props:t,description:"Assigns a color based on SIFTS mapping."}},getParams:function w$e(e){return Zne},defaultValues:T.getDefaultValues(Zne),isApplicable:function(e){var t;return!(null===(t=e.structure)||void 0===t||!t.models.some(function(r){return Td.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n;return ce(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?[4,Td.Provider.attach(e,n[r],void 0,!0)]:[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(e.structure)for(var t=0,r=e.structure.models;t<r.length;t++)Td.Provider.ref(r[t],!1)}}},A$e=$r.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=Td.Provider,r.labelProvider={label:function(n){if(r.params.showTooltip)return function T$e(e){if("element-loci"===e.kind){if(0===e.elements.length)return;var t=e.elements[0],r=t.unit,n=at.create(e.structure,r,r.elements[ke.getAt(t.indices,0)]);return Td.getLabel(n)}}(n)}},r}return jt(t,e),t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add($ne),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove($ne),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}($r.Handler),params:function(){return{autoAttach:T.Boolean(!0),showTooltip:T.Boolean(!0)}}});!function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=_l.create(e.Descriptor),e.fromTable=function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(m,h,v){var g=m.get(h);g?g.push(v):m.set(h,[v])}function s(m,h){var v=h.entity_id.value(m),g=h.asym_id.value(m),y=h.seq_id.value(m);if("by-atom"===r.model_granularity.value(m)){var S=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:h.atom_id.value(m),label_entity_id:v});S>=0&&o(c,S,m)}else if(n.coarseHierarchy.isDefined){var C=n.coarseHierarchy.spheres.findSequenceKey(v,g,y);if(C>=0)o(l,C,m);else{var _=n.coarseHierarchy.gaussians.findSequenceKey(v,g,y);_>=0&&o(d,_,m)}}}for(var c=new Map,l=new Map,d=new Map,f=[],p=0;p<r._rowCount;++p)s(p,a),s(p,i);return{getIndicesByElement:function(m,h){var v=function u(m){switch(m){case 0:return c;case 1:return l;case 2:return d}}(h),g=v.get(m);return void 0!==g?g:f},data:r}}}(mp||(mp={}));var D$e=[];function Jne(e,t,r,n){return"".concat(e,"|").concat(t.id,"|").concat(r,"|").concat(n.id)}var El,eae=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=Jne(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=Jne(t,r,n,a);return this.pairKeyIndices.get(i)||D$e},e.prototype.getPairs=function(t,r,n,a){var i=this;return this.getPairIndices(t,r,n,a).map(function(s){return i.pairs[s]})},e}(),hp=ep.createProvider({label:"Cross Link Restraint",descriptor:Hu({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!mp.Provider.get(t)})},obtain:function(e,t,r){return ue(void 0,void 0,void 0,function(){return ce(this,function(n){return[2,{value:P$e(t)}]})})}});function tae(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){r.getIndicesByElement(n[u],i).forEach(function(l){return e.set(l,u)})},s=0;s<a;s++)o(s)}function E$e(e,t,r){if(t.model===r.model&&"mmCIF"===t.model.sourceData.kind){var n=mp.Provider.get(t.model);if(n){var a=new Map,i=new Map;tae(a,t,n),tae(i,r,n),a.forEach(function(o,s){var u=i.get(s);void 0!==u&&e.push(cD(t,o,r,u,n,s),cD(r,u,t,o,n,s))})}}}function I$e(e,t){if("mmCIF"===t.model.sourceData.kind){var r=mp.Provider.get(t.model);if(r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(c){r.getIndicesByElement(n[c],i).forEach(function(d){var f=o.get(d);f?f.push(c):o.set(d,[c])})},u=0;u<a;u++)s(u);o.forEach(function(c,l){if(!(c.length<2)){var d=c[0],f=c[1];e.push(cD(t,d,t,f,r,l),cD(t,f,t,d,r,l))}})}}}function cD(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function P$e(e){var t=[];if(!e.models.some(function(s){return mp.Provider.get(s)}))return new eae(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];I$e(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&E$e(t,a,o)}}return new eae(t)}function M$e(e,t,r,n,a){var i=hp.get(t).value;if(!i.count)return Vt.createEmpty(a);var o=n.sizeFactor,s=at.create(t),c=Iv(0,{linkCount:i.count,position:function(p,m,h){var v=i.pairs[h],g=v.unitA,y=v.unitB;g.conformation.position(g.elements[v.indexA],p),y.conformation.position(y.elements[v.indexB],m)},radius:function(p){var m=i.pairs[p];return s.unit=m.unitA,s.element=m.unitA.elements[m.indexA],r.size.size(s)*o}},n,a),l=c.mesh,d=c.boundingSphere;if(d)l.setBoundingSphere(d);else if(l.triangleCount>0){var f=Pe.expand(Pe(),t.boundary.sphere,1*o);l.setBoundingSphere(f)}return l}!function(e){(e.Tag||(e.Tag={})).CrossLinkRestraint="cross-link-restraint",e.isApplicable=function r(h){return h.models.some(function(v){return!!mp.Provider.get(v)})};var n=b(),a=b();function i(h){return h.unitA.conformation.position(h.unitA.elements[h.indexA],n),h.unitB.conformation.position(h.unitB.elements[h.indexB],a),b.distance(n,a)}function c(h,v){var g=h.pairs[v];return"Cross Link Restraint | Type: ".concat(g.restraintType," | Threshold: ").concat(g.distanceThreshold," \u212b | Psi: ").concat(g.psi," | Sigma 1: ").concat(g.sigma1," | Sigma 2: ").concat(g.sigma2," | Distance: ").concat(i(g).toFixed(2)," \u212b")}function p(h,v,g){return Yh.fromPairProvider(v.length,function(y,S,C){var _=h.pairs[v[y]];_.unitA.conformation.position(_.unitA.elements[_.indexA],S),_.unitB.conformation.position(_.unitB.elements[_.indexB],C)},g)}function m(h,v,g){var y=g[0];if(void 0===y)return"";var S=v.pairs[y];return[c(v,y),bN(zt.Location(h,S.unitA,S.indexA,h,S.unitB,S.indexB))].join("</br>")}e.distance=i,e.Location=function o(h,v,g){return oX("cross-link-restraints",{structure:v,crossLinkRestraints:h},g)},e.isLocation=function s(h){return!!h&&"data-location"===h.kind&&"cross-link-restraints"===h.tag},e.areLocationsEqual=function u(h,v){return h.data.structure===v.data.structure&&h.data.crossLinkRestraints===v.data.crossLinkRestraints&&h.element===v.element},e.locationLabel=function l(h){return c(h.data.crossLinkRestraints,h.element)},e.Loci=function d(h,v,g){return yT("cross-link-restraints",{structure:h,crossLinkRestraints:v},g,function(y){return p(v,g,y)},function(){return m(h,v,g)})},e.isLoci=function f(h){return!!h&&"data-loci"===h.kind&&"interactions"===h.tag},e.getBoundingSphere=p,e.getLabel=m}(El||(El={}));var rae=R(R(R({},Iy),Ev),{sizeFactor:T.Numeric(.5,{min:0,max:10,step:.1})});function R$e(e){return fp({defaultProps:T.getDefaultValues(rae),createGeometry:M$e,createLocationIterator:O$e,getLoci:F$e,eachLocation:B$e,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function O$e(e){var t=hp.get(e).value,n=t.pairs.length,i=El.Location(t,e);return On(n,1,1,function(s){return i.element=s,i},!0)}function F$e(e,t,r){var a=e.groupId;if(r===e.objectId){var i=hp.get(t).value;if(i.pairs[a])return El.Loci(t,i,[a])}return Wr}function B$e(e,t,r){var n=!1;if(El.isLoci(e)){if(!Ze.areEquivalent(e.data.structure,t))return!1;var a=hp.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++)r(_e.ofSingleton(o[i]))&&(n=!0)}return n}var N$e={"cross-link-restraint":function(e,t){return ec("Cross-link restraint",e,t,R$e)}},nae=R({},rae),aae={name:El.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:function L$e(e,t){return lr.createMulti("CrossLinkRestraint",e,t,to,N$e)},getParams:function k$e(e,t){return T.clone(nae)},defaultValues:T.getDefaultValues(nae),defaultColorTheme:{name:El.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return El.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return hp.attach(e,t,void 0,!0)},detach:function(e){return hp.ref(e,!1)}}},iae=dt(13421772),oae={domain:T.Interval([.5,1.5],{step:.01}),list:T.ColorList("red-grey",{presetKind:"scale"})},uae={name:"cross-link",label:"Cross Link",category:hu.Category.Misc,factory:function sae(e,t){var r,n=void 0,a=e.structure&&hp.get(e.structure).value;if(a){var i=(n=_c.create({domain:t.domain,listOrName:t.list.colors})).color;r=function(o){if(El.isLocation(o)){var s=a.pairs[o.element];if(s)return i(El.distance(s)/s.distanceThreshold)}return iae}}else r=function(){return iae};return{factory:sae,granularity:"group",color:r,props:t,description:"Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",legend:n?n.legend:void 0}},getParams:function V$e(e){return oae},defaultValues:T.getDefaultValues(oae),isApplicable:function(e){return!!e.structure&&El.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?hp.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&hp.ref(e.structure,!1)}}},G$e=$r.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.provider=mp.Provider,r}return jt(t,e),t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",z$e),this.ctx.representation.structure.themes.colorThemeRegistry.add(uae),this.ctx.representation.structure.registry.add(aae)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(uae),this.ctx.representation.structure.registry.remove(aae)},t}($r.Handler)});function z$e(e){if(Dn.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(0!==t._rowCount)return mp.fromTable(t,e)}}var lD={State:SE,Representation:CE,Camera:xE,Misc:_E},yu={Representation:wE,Camera:AE,CustomProps:TE};function dD(e,t,r){return void 0===r&&(r={}),"string"==typeof r.type||"string"==typeof r.color||"string"==typeof r.size?function H$e(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return lae(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}(e,t||Ze.Empty,r):lae(e,t||Ze.Empty,r)}function Ek(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),c=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),l=T.getDefaultValues(c.getParams({structure:t||Ze.Empty}));return c.name===u.defaultColorTheme.name&&Object.assign(l,u.defaultColorTheme.props),{name:c.name,params:Object.assign(l,a)}}function cae(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),c=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),l=T.getDefaultValues(c.getParams({structure:t||Ze.Empty}));return c.name===u.defaultSizeTheme.name&&Object.assign(l,u.defaultSizeTheme.props),{name:c.name,params:Object.assign(l,a)}}function lae(e,t,r){void 0===r&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=T.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=T.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);var l=Object.assign(c,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=T.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:l},sizeTheme:{name:d.name,params:p}}}var dae=["target","surroundings","interactions"],Zn=function(e){return e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr",e}(Zn||{}),q$e=new Set([Zn.TargetSel,Zn.TargetRepr,Zn.SurrSel,Zn.SurrRepr,Zn.SurrNciRepr]),W$e=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return jt(t,e),Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings (".concat(this.params.expandRadius," \xc5)")},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return R(R({},r),{type:{name:r.type.name,params:R(R({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=xr.findUniqueTagsInSubtree(i,r.transform.ref,q$e);s[Zn.TargetSel]||(s[Zn.TargetSel]=o.to(r).apply(et.Model.StructureSelectionFromBundle,{bundle:rn.Empty,label:"[Focus] Target"},{tags:Zn.TargetSel}).ref),s[Zn.SurrSel]||(s[Zn.SurrSel]=o.to(r).apply(et.Model.StructureSelectionFromExpression,{expression:fe.struct.generator.empty(),label:this.surrLabel},{tags:Zn.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[Zn.TargetRepr]&&(s[Zn.TargetRepr]=o.to(s[Zn.TargetSel]).apply(et.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:Zn.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[Zn.SurrRepr]&&(s[Zn.SurrRepr]=o.to(s[Zn.SurrSel]).apply(et.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:Zn.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[Zn.SurrNciRepr]&&r.obj&&uD.isApplicable(null===(n=r.obj)||void 0===n?void 0:n.data)&&(s[Zn.SurrNciRepr]=o.to(s[Zn.SurrSel]).apply(et.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:Zn.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(xr.Generators.byRef(r).subtree().withTag(Zn.TargetSel)),i=n.select(xr.Generators.byRef(r).subtree().withTag(Zn.SurrSel));if(0!==a.length||0!==i.length){for(var o=n.build(),s=rn.Empty,u=0,c=a;u<c.length;u++)o.to(c[u]).update(et.Model.StructureSelectionFromBundle,function(h){return R(R({},h),{bundle:s})});for(var d=fe.struct.generator.empty(),f=0,p=i;f<p.length;f++)o.to(p[f]).update(et.Model.StructureSelectionFromExpression,function(h){return R(R({},h),{expression:d})});return yr.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p=this;return ce(this,function(m){switch(m.label){case 0:return(n=this.plugin.helpers.substructureParent.get(r.structure))&&n.obj?(this.currentSource=r,a=Re.remap(r,n.obj.data),i=Re.extendToWholeResidues(a),o=rn.fromLoci(i),s=rn.toExpression(o),u=fe.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=fe.struct.modifier.exceptBy({0:u,by:s})),c=this.ensureShape(n),l=c.state,(d=c.builder).to((f=c.refs)[Zn.TargetSel]).update(et.Model.StructureSelectionFromBundle,function(h){return R(R({},h),{bundle:o})}),d.to(f[Zn.SurrSel]).update(et.Model.StructureSelectionFromExpression,function(h){return R(R({},h),{expression:u,label:p.surrLabel})}),[4,yr.State.Update(this.plugin,{state:l,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]):[2];case 1:return m.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(on.RootRef)})},t.prototype.update=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h;return ce(this,function(v){switch(v.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(i=(a=this.plugin.state.data).build(),o=xr.Generators.root.subtree(),u=(s=this.params.components).indexOf("target")>=0,c=0,l=a.select(o.withTag(Zn.TargetRepr));c<l.length;c++)h=l[c],u?i.to(h).update(this.getReprParams(this.params.targetParams)):i.delete(h.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=a.select(o.withTag(Zn.SurrRepr));d<f.length;d++)h=f[d],u?i.to(h).update(this.getReprParams(this.params.surroundingsParams)):i.delete(h.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,m=a.select(o.withTag(Zn.SurrNciRepr));p<m.length;p++)h=m[p],u?i.to(h).update(this.getReprParams(this.params.nciParams)):i.delete(h.transform.ref);return[4,yr.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return v.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}($r.WithSubscribers),fD=$r.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:W$e,params:function(e,t){return function(e){var t=et.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:T.Numeric(5,{min:1,max:10,step:1}),targetParams:T.Group(t,{label:"Target",customDefault:dD(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:T.Group(t,{label:"Surroundings",customDefault:dD(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:T.Group(t,{label:"Non-covalent Int.",customDefault:dD(e,void 0,{type:uD,color:Ck,size:ki.BuiltIn.uniform})}),components:T.MultiSelect(dae,T.arrayToOptions(dae)),excludeTargetFromSurroundings:T.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),ignoreLight:T.Boolean(!1),material:as.getParam(),clip:T.Group(dm.Params)}}(t)}});function hs(e){return e}!function(e){function t(i){return"chain-id"===i?{name:i,params:uJ.defaultValues}:"operator-name"===i?{name:i,params:qB.defaultValues}:{name:i,params:{}}}e.CommonParams={ignoreHydrogens:T.Optional(T.Boolean(!1)),ignoreHydrogensVariant:T.Optional(T.Select("all",T.arrayToOptions(["all","non-polar"]))),ignoreLight:T.Optional(T.Boolean(!1)),quality:T.Optional(T.Select("auto",WF)),theme:T.Optional(T.Group({globalName:T.Optional(T.Text("")),globalColorParams:T.Optional(T.Value({},{isHidden:!0})),carbonColor:T.Optional(T.Select("chain-id",T.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:T.Optional(T.Text("")),symmetryColorParams:T.Optional(T.Value({},{isHidden:!0})),focus:T.Optional(T.Group({name:T.Optional(T.Text("")),params:T.Optional(T.Value({}))}))}))},e.reprBuilder=function n(i,o,s){var u,c,l,d,f,p,m,h,v,g,y,S,C,_,x=i.state.data.build(),D=i.builders.structure.representation,w=i.managers.structure.component.state.options.hydrogens,A={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:"all"!==w,ignoreHydrogensVariant:"only-polar"===w?"non-polar":"all",ignoreLight:i.managers.structure.component.state.options.ignoreLight};o.quality&&"auto"!==o.quality&&(A.quality=o.quality),void 0!==o.ignoreHydrogens&&(A.ignoreHydrogens=!!o.ignoreHydrogens),void 0!==o.ignoreHydrogensVariant&&(A.ignoreHydrogensVariant=o.ignoreHydrogensVariant),void 0!==o.ignoreLight&&(A.ignoreLight=!!o.ignoreLight);var E=null!==(u=o.theme)&&void 0!==u&&u.globalName?null===(c=o.theme)||void 0===c?void 0:c.globalName:void 0,I=void 0!==(null===(l=o.theme)||void 0===l?void 0:l.carbonColor)?R({carbonColor:t(null===(d=o.theme)||void 0===d?void 0:d.carbonColor)},null===(f=o.theme)||void 0===f?void 0:f.globalColorParams):R({},null===(p=o.theme)||void 0===p?void 0:p.globalColorParams),M=s&&null!==(m=o.theme)&&void 0!==m&&m.symmetryColor&&function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}(s)?null===(h=o.theme)||void 0===h?void 0:h.symmetryColor:E;return{update:x,builder:D,color:E,symmetryColor:M,symmetryColorParams:null!==(v=o.theme)&&void 0!==v&&v.symmetryColorParams?R(R({},null===(g=o.theme)||void 0===g?void 0:g.globalColorParams),null===(y=o.theme)||void 0===y?void 0:y.symmetryColorParams):R({},null===(S=o.theme)||void 0===S?void 0:S.globalColorParams),globalColorParams:null!==(C=o.theme)&&void 0!==C&&C.globalColorParams?R({},null===(_=o.theme)||void 0===_?void 0:_.globalColorParams):void 0,typeParams:A,ballAndStickColor:I}},e.updateFocusRepr=function a(i,o,s,u){if(i.state.hasBehavior(fD))return i.state.updateBehavior(fD,function(c){var l=Ek(i,o,"ball-and-stick",s||"element-symbol",u);c.surroundingsParams.colorTheme=l,c.targetParams.colorTheme=l})}}(hs||(hs={}));var Pv=hs.CommonParams,Py=hs.reprBuilder,My=hs.updateFocusRepr,Y$e=hs({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return Pv},apply:function(e,t,r){var n,a,i=null===(a=null===(n=mo.resolveAndCheck(r.state.data,e))||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(!i)return{};var o=r.config.get(pa.Structure.SizeThresholds)||Ze.DefaultSizeThresholds,s=Ze.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case Ze.Size.Gigantic:case Ze.Size.Huge:return pae.apply(e,t,r);case Ze.Size.Large:return mae.apply(e,t,r);case Ze.Size.Medium:if(u>3)return fae.apply(e,t,r);case Ze.Size.Small:return hae.apply(e,R(R({},t),{showCarbohydrateSymbol:!0}),r);default:Sn()}}}),X$e=hs({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(n){return[2,{}]})})}}),X2="Basic",fae=hs({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:X2,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return Pv},apply:function(e,t,r){var n,a,i,o,s,u,c,l,d,f;return ue(this,void 0,void 0,function(){var p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F;return ce(this,function(N){switch(N.label){case 0:return(p=mo.resolveAndCheck(r.state.data,e))?(F={},[4,bu(r,p,"polymer")]):[2,{}];case 1:return F.polymer=N.sent(),[4,bu(r,p,"ligand")];case 2:return F.ligand=N.sent(),[4,bu(r,p,"non-standard")];case 3:return F.nonStandard=N.sent(),[4,bu(r,p,"branched",{label:"Carbohydrate"})];case 4:return F.branched=N.sent(),[4,bu(r,p,"water")];case 5:return F.water=N.sent(),[4,bu(r,p,"ion")];case 6:return F.ion=N.sent(),[4,bu(r,p,"lipid")];case 7:return F.lipid=N.sent(),[4,bu(r,p,"coarse")];case 8:return F.coarse=N.sent(),v={sizeFactor:(h=p.obj.data).isCoarseGrained?.8:.2},g=((null===(i=null===(a=null===(n=(m=F).water)||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data)||void 0===i?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=((null===(u=null===(s=null===(o=m.lipid)||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data)||void 0===u?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",S=Py(r,t,h),D=S.color,w=S.symmetryColor,A=S.symmetryColorParams,E=S.globalColorParams,I=S.ballAndStickColor,M={polymer:(_=S.builder).buildRepresentation(C=S.update,m.polymer,{type:"cartoon",typeParams:R(R({},x=S.typeParams),v),color:w,colorParams:A},{tag:"polymer"}),ligand:_.buildRepresentation(C,m.ligand,{type:"ball-and-stick",typeParams:x,color:D,colorParams:I},{tag:"ligand"}),nonStandard:_.buildRepresentation(C,m.nonStandard,{type:"ball-and-stick",typeParams:x,color:D,colorParams:I},{tag:"non-standard"}),branchedBallAndStick:_.buildRepresentation(C,m.branched,{type:"ball-and-stick",typeParams:R(R({},x),{alpha:.3}),color:D,colorParams:I},{tag:"branched-ball-and-stick"}),branchedSnfg3d:_.buildRepresentation(C,m.branched,{type:"carbohydrate",typeParams:x,color:D,colorParams:E},{tag:"branched-snfg-3d"}),water:_.buildRepresentation(C,m.water,{type:g,typeParams:R(R({},x),{alpha:.6,visuals:"line"===g?["intra-bond","element-point"]:void 0}),color:D,colorParams:R({carbonColor:{name:"element-symbol",params:{}}},E)},{tag:"water"}),ion:_.buildRepresentation(C,m.ion,{type:"ball-and-stick",typeParams:x,color:D,colorParams:R({carbonColor:{name:"element-symbol",params:{}}},E)},{tag:"ion"}),lipid:_.buildRepresentation(C,m.lipid,{type:y,typeParams:R(R({},x),{alpha:.6,visuals:"line"===y?["intra-bond"]:void 0}),color:D,colorParams:R({carbonColor:{name:"element-symbol",params:{}}},E)},{tag:"lipid"}),coarse:_.buildRepresentation(C,m.coarse,{type:"spacefill",typeParams:x,color:D||"chain-id",colorParams:E},{tag:"coarse"})},[4,C.commit({revertOnError:!1})];case 9:return N.sent(),[4,My(r,h,null===(l=null===(c=t.theme)||void 0===c?void 0:c.focus)||void 0===l?void 0:l.name,null===(f=null===(d=t.theme)||void 0===d?void 0:d.focus)||void 0===f?void 0:f.params)];case 10:return N.sent(),[2,{components:m,representations:M}]}})})}}),K$e=hs({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:X2,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return Pv},apply:function(e,t,r){var n,a,i,o;return ue(this,void 0,void 0,function(){var s,u,c,l,d,f,p,m,h,v,g,y,S;return ce(this,function(C){switch(C.label){case 0:return(s=mo.resolveAndCheck(r.state.data,e))?(S={},[4,vae(r,s,"protein")]):[2,{}];case 1:return S.protein=C.sent(),[4,vae(r,s,"nucleic")];case 2:return S.nucleic=C.sent(),u=S,l={sizeFactor:(c=s.obj.data).isCoarseGrained?.8:.2},d={radiusOffset:c.isCoarseGrained?2:0,smoothness:c.isCoarseGrained?1:1.5},f=Py(r,t,c),v=f.symmetryColor,g=f.symmetryColorParams,y={protein:(m=f.builder).buildRepresentation(p=f.update,u.protein,{type:"cartoon",typeParams:R(R({},h=f.typeParams),l),color:v,colorParams:g},{tag:"protein"}),nucleic:m.buildRepresentation(p,u.nucleic,{type:"gaussian-surface",typeParams:R(R({},h),d),color:v,colorParams:g},{tag:"nucleic"})},[4,p.commit({revertOnError:!0})];case 3:return C.sent(),[4,My(r,c,null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name,null===(o=null===(i=t.theme)||void 0===i?void 0:i.focus)||void 0===o?void 0:o.params)];case 4:return C.sent(),[2,{components:u,representations:y}]}})})}}),pae=hs({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:X2,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return Pv},apply:function(e,t,r){var n,a,i,o;return ue(this,void 0,void 0,function(){var s,u,c,l,d,f,p,m,h,v,g,y,S;return ce(this,function(C){switch(C.label){case 0:return(s=mo.resolveAndCheck(r.state.data,e))?(S={},[4,bu(r,s,"polymer")]):[2,{}];case 1:return S.polymer=C.sent(),[4,bu(r,s,"lipid")];case 2:return S.lipid=C.sent(),u=S,l=Ze.getSize(c=s.obj.data),d=Object.create(null),l===Ze.Size.Gigantic?Object.assign(d,{traceOnly:!c.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):l===Ze.Size.Huge?Object.assign(d,{radiusOffset:c.isCoarseGrained?2:0,smoothness:1}):c.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=Py(r,t,c),v=f.symmetryColor,g=f.symmetryColorParams,y={polymer:(m=f.builder).buildRepresentation(p=f.update,u.polymer,{type:"gaussian-surface",typeParams:R(R({},h=f.typeParams),d),color:v,colorParams:g},{tag:"polymer"}),lipid:m.buildRepresentation(p,u.lipid,{type:"gaussian-surface",typeParams:R(R({},h),d),color:v,colorParams:g},{tag:"lipid"})},[4,p.commit({revertOnError:!0})];case 3:return C.sent(),[4,My(r,c,null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name,null===(o=null===(i=t.theme)||void 0===i?void 0:i.focus)||void 0===o?void 0:o.params)];case 4:return C.sent(),[2,{components:u,representations:y}]}})})}}),mae=hs({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:X2,description:"Shows polymers as Cartoon."},params:function(){return Pv},apply:function(e,t,r){var n,a,i,o;return ue(this,void 0,void 0,function(){var s,u,c,l,d,f,h,v,g,y;return ce(this,function(S){switch(S.label){case 0:return(s=mo.resolveAndCheck(r.state.data,e))?(y={},[4,bu(r,s,"polymer")]):[2,{}];case 1:return y.polymer=S.sent(),u=y,l={sizeFactor:(c=s.obj.data).isCoarseGrained?.8:.2},d=Py(r,t,c),h=d.symmetryColor,v=d.symmetryColorParams,g={polymer:d.builder.buildRepresentation(f=d.update,u.polymer,{type:"cartoon",typeParams:R(R({},d.typeParams),l),color:h,colorParams:v},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return S.sent(),[4,My(r,c,null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name,null===(o=null===(i=t.theme)||void 0===i?void 0:i.focus)||void 0===o?void 0:o.params)];case 3:return S.sent(),[2,{components:u,representations:g}]}})})}}),hae=hs({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:X2,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return R(R({},Pv),{showCarbohydrateSymbol:T.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s,u;return ue(this,void 0,void 0,function(){var c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j;return ce(this,function(U){switch(U.label){case 0:return(c=mo.resolveAndCheck(r.state.data,e))?(N={},[4,bu(r,c,"all")]):[2,{}];case 1:return N.all=U.sent(),N.branched=void 0,l=N,f=(d=c.obj.data).elementCount>1e5,p=d.atomicResidueCount&&d.elementCount>1e3&&d.atomicResidueCount/d.elementCount<3,h=!!Do.Provider.get(m=d.models[0])||Yu.isExhaustive(m),v="ball-and-stick",d.isCoarseGrained?v=d.elementCount>1e6?"point":"spacefill":p&&!h?v="spacefill":f&&(v="line"),(g=t.showCarbohydrateSymbol&&!f&&!p)?(S=(y=Object).assign,C=[l],j={},[4,bu(r,c,"branched",{label:"Carbohydrate"})]):[3,3];case 2:S.apply(y,C.concat([(j.branched=U.sent(),j)])),U.label=3;case 3:return _=Py(r,t,d),x=_.update,D=_.builder,w=_.typeParams,A=_.color,E=_.ballAndStickColor,I=_.globalColorParams,M=p&&!h?R({carbonColor:{name:"element-symbol",params:{}}},I):E,F={all:D.buildRepresentation(x,l.all,{type:v,typeParams:w,color:A,colorParams:M},{tag:"all"})},g&&Object.assign(F,{snfg3d:D.buildRepresentation(x,l.branched,{type:"carbohydrate",typeParams:R(R({},w),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:A,colorParams:I},{tag:"snfg-3d"})}),[4,x.commit({revertOnError:!0})];case 4:return U.sent(),[4,My(r,d,null!==(i=null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name)&&void 0!==i?i:A,null!==(u=null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params)&&void 0!==u?u:M)];case 5:return U.sent(),[2,{components:l,representations:F}]}})})}}),Z$e=hs({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:function(){return R(R({},Pv),{showCarbohydrateSymbol:T.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s;return ue(this,void 0,void 0,function(){var u,c,l,d,f,h,v,g;return ce(this,function(y){switch(y.label){case 0:return(u=mo.resolveAndCheck(r.state.data,e))?(g={},[4,bu(r,u,"all")]):[2,{}];case 1:return g.all=y.sent(),g.branched=void 0,c=g,d=Py(r,t,l=u.obj.data),h=d.color,v={all:d.builder.buildRepresentation(f=d.update,c.all,{type:"spacefill",typeParams:R(R({},d.typeParams),{ignoreLight:!0}),color:"illustrative"},{tag:"all"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,My(r,l,null!==(i=null===(a=null===(n=t.theme)||void 0===n?void 0:n.focus)||void 0===a?void 0:a.name)&&void 0!==i?i:h,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params)];case 3:return y.sent(),[2,{components:c,representations:v}]}})})}});function bu(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function vae(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,xi[r],"selection-".concat(r),n)}var Gd={empty:X$e,auto:Y$e,"atomic-detail":hae,"polymer-cartoon":mae,"polymer-and-ligand":fae,"protein-and-nucleic":K$e,"coarse-surface":pae,illustrative:Z$e};function pD(e,t){if("bcif"===e.ext)try{var r=sY(t).encoder;if(r.startsWith("VolumeServer"))return"dscif";if(r.startsWith("volseg-volume-server"))return"segcif"}catch(a){console.error(a)}else if("cif"===e.ext){var n=t;if(n.startsWith("data_SERVER\n#\n_density_server_result"))return"dscif";if(n.startsWith("data_SERVER\n#\ndata_SEGMENTATION_DATA"))return"segcif";if(n.includes("atom_site_fract_x")||n.includes("atom_site.fract_x"))return"coreCif"}return-1}var Il="Trajectory";function vp(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var Q$e={label:"mmCIF",description:"mmCIF",category:Il,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return"mmcif"===e.ext||"mcif"===e.ext||("cif"===e.ext||"bcif"===e.ext)&&-1===pD(e,t)},parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var a,i,o,s;return ce(this,function(u){switch(u.label){case 0:return[4,(a=e.state.data.build().to(t).apply(et.Data.ParseCif,void 0,{state:{isGhost:!0}})).apply(et.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),((null===(s=null===(o=a.selector.cell)||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:vp},$$e={label:"cifCore",description:"CIF Core",category:Il,stringExtensions:["cif"],isApplicable:function(e,t){return"cif"===e.ext&&"coreCif"===pD(e,t)},parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var a,i,o,s;return ce(this,function(u){switch(u.label){case 0:return[4,(a=e.state.data.build().to(t).apply(et.Data.ParseCif,void 0,{state:{isGhost:!0}})).apply(et.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),((null===(s=null===(o=a.selector.cell)||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:vp};function Mv(e,t){var r=this;return function(n,a,i){return ue(r,void 0,void 0,function(){return ce(this,function(u){switch(u.label){case 0:return[4,n.state.data.build().to(a).apply(e,t,{tags:i?.trajectoryTags}).commit({revertOnError:!0})];case 1:return[2,{trajectory:u.sent()}]}})})}}var J$e={label:"PDB",description:"PDB",category:Il,stringExtensions:["pdb","ent"],parse:Mv(et.Model.TrajectoryFromPDB),visuals:vp},eJe={label:"PDBQT",description:"PDBQT",category:Il,stringExtensions:["pdbqt"],parse:Mv(et.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:vp},tJe={label:"XYZ",description:"XYZ",category:Il,stringExtensions:["xyz"],parse:Mv(et.Model.TrajectoryFromXYZ),visuals:vp},gae=[["mmcif",Q$e],["cifCore",$$e],["pdb",J$e],["pdbqt",eJe],["gro",{label:"GRO",description:"GRO",category:Il,stringExtensions:["gro"],binaryExtensions:[],parse:Mv(et.Model.TrajectoryFromGRO),visuals:vp}],["xyz",tJe],["mol",{label:"MOL",description:"MOL",category:Il,stringExtensions:["mol"],parse:Mv(et.Model.TrajectoryFromMOL),visuals:vp}],["sdf",{label:"SDF",description:"SDF",category:Il,stringExtensions:["sdf","sd"],parse:Mv(et.Model.TrajectoryFromSDF),visuals:vp}],["mol2",{label:"MOL2",description:"MOL2",category:Il,stringExtensions:["mol2"],parse:Mv(et.Model.TrajectoryFromMOL2),visuals:vp}]],oJe=["gz","zip"];function Ry(e){var t=e,r="",n=t.lastIndexOf("?"),a=-1!==n?t.substring(n):"",i=(t=t.substring(0,-1===n?t.length:n)).replace(/^.*[\\/]/,""),o=i.substring(0,i.lastIndexOf(".")),s=i.split("."),u=s.length>1?(s.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(r=c[1].toLowerCase(),t=c[2]||"");var l=t.substring(0,t.lastIndexOf("/")+1);return oJe.includes(u)&&(u=(t.substr(0,t.length-u.length-1).split(".").pop()||"").toLowerCase(),o=o.substr(0,o.length-u.length-1)),{path:t,name:i,ext:u,base:o,dir:l,protocol:r,query:a}}var K2="Topology",sJe={label:"PSF",description:"PSF",category:K2,stringExtensions:["psf"],parse:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n;return ce(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(et.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},uJe={label:"PRMTOP",description:"PRMTOP",category:K2,stringExtensions:["prmtop","parm7"],parse:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n;return ce(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParsePrmtop,{},{state:{isGhost:!0}}),n=r.apply(et.Model.TopologyFromPrmtop),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},cJe={label:"TOP",description:"TOP",category:K2,stringExtensions:["top"],parse:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n;return ce(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParseTop,{},{state:{isGhost:!0}}),n=r.apply(et.Model.TopologyFromTop),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},lJe=[["psf",sJe],["prmtop",uJe],["top",cJe]],Oy="Coordinates",dJe={label:"DCD",description:"DCD",category:Oy,binaryExtensions:["dcd"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromDcd).commit()}},fJe={label:"XTC",description:"XTC",category:Oy,binaryExtensions:["xtc"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromXtc).commit()}},pJe={label:"TRR",description:"TRR",category:Oy,binaryExtensions:["trr"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromTrr).commit()}},mJe={label:"NCTRAJ",description:"NCTRAJ",category:Oy,binaryExtensions:["nc","nctraj"],parse:function(e,t){return e.state.data.build().to(t).apply(et.Model.CoordinatesFromNctraj).commit()}},hJe=[["dcd",dJe],["xtc",fJe],["trr",pJe],["nctraj",mJe]],yae={rcsb:T.Group({encoding:T.Select("bcif",T.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:T.Group({variant:T.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:T.EmptyGroup({label:"PDBj"})},gJe=Bs.build({from:ve.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=function(e){var t=e.config.get(pa.Structure.DefaultRepresentationPreset)||Gd.auto.id;return T.Group({type:dv.getParams(void 0,"auto").type,representation:T.Select(t,e.builders.structure.representation.getPresets().map(function(r){return[r.id,r.display.name,r.display.group]}),{description:"Which representation preset to use."}),representationParams:T.Group(hs.CommonParams,{isHidden:!0}),asTrajectory:T.Optional(T.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})}(t),n=t.config.get(pa.Download.DefaultPdbProvider)||"pdbe";return{source:T.MappedStatic("pdb",{pdb:T.Group({provider:T.Group({id:T.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:T.MappedStatic(n,yae)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":T.Group({provider:T.Group({id:T.Text("PDBDEV_00000001",{label:"PDB-Dev Id(s)",description:"One or more comma/space separated ids."}),encoding:T.Select("bcif",T.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB-Dev"}),swissmodel:T.Group({id:T.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:T.Group({id:T.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:T.Group({id:T.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:T.Group({id:T.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:T.Group({url:T.Url(""),format:T.Select("mmcif",T.arrayToOptions(gae.map(function(a){return a[0]}),function(a){return a})),isBinary:T.Boolean(!1),label:T.Optional(T.Text("")),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Download Structure",function(a){return ue(void 0,void 0,void 0,function(){var i,o,s,u,l,d,f;return ce(this,function(p){switch(p.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),s=!1,u="mmcif",(i=r.source).name){case"url":return[3,1];case"pdb":return[3,2];case"pdb-dev":return[3,4];case"swissmodel":return[3,6];case"alphafolddb":return[3,8];case"modelarchive":return[3,10];case"pubchem":return[3,12]}return[3,14];case 1:return o=[{url:i.params.url,isBinary:i.params.isBinary,label:i.params.label||void 0}],u=i.params.format,[3,15];case 2:return[4,"pdbe"===i.params.provider.server.name?yJe(i):"pdbj"===i.params.provider.server.name?bJe(i):"rcsb"===i.params.provider.server.name?SJe(i):Sn()];case 3:return o=p.sent(),s=!!i.params.options.asTrajectory,[3,15];case 4:return[4,Pl(i.params.provider.id,function(m){var h=m.toUpperCase().startsWith("PDBDEV_")?m:"PDBDEV_".concat(m.padStart(8,"0"));return"bcif"===i.params.provider.encoding?"https://pdb-dev.wwpdb.org/bcif/".concat(h.toUpperCase(),".bcif"):"https://pdb-dev.wwpdb.org/cif/".concat(h.toUpperCase(),".cif")},function(m){return m.toUpperCase().startsWith("PDBDEV_")?m:"PDBDEV_".concat(m.padStart(8,"0"))},"bcif"===i.params.provider.encoding)];case 5:return o=p.sent(),s=!!i.params.options.asTrajectory,[3,15];case 6:return[4,Pl(i.params.id,function(m){return"https://swissmodel.expasy.org/repository/uniprot/".concat(m.toUpperCase(),".pdb")},function(m){return"SWISS-MODEL: ".concat(m)},!1)];case 7:return o=p.sent(),s=!!i.params.options.asTrajectory,u="pdb",[3,15];case 8:return[4,Pl(i.params.id,function(m){return ue(void 0,void 0,void 0,function(){var h,v;return ce(this,function(g){switch(g.label){case 0:return h="https://www.alphafold.ebi.ac.uk/api/prediction/".concat(m.toUpperCase()),[4,t.runTask(t.fetch({url:h,type:"json"}))];case 1:if(v=g.sent(),Array.isArray(v)&&v.length>0)return[2,v[0].cifUrl];throw new Error("No AlphaFold DB entry for '".concat(m,"'"))}})})},function(m){return"AlphaFold DB: ".concat(m)},!1)];case 9:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 10:return[4,Pl(i.params.id,function(m){return"https://www.modelarchive.org/doi/10.5452/".concat(m.toLowerCase(),".cif")},function(m){return"Model Archive: ".concat(m)},!1)];case 11:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 12:return[4,Pl(i.params.id,function(m){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/".concat(m.trim(),"/record/SDF/?record_type=3d")},function(m){return"PubChem: ".concat(m)},!1)];case 13:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mol",[3,15];case 14:Sn(),p.label=15;case 15:return l=r.source.params.options.representation||t.config.get(pa.Structure.DefaultRepresentationPreset)||Gd.auto.id,d=l!==Gd.empty.id,f="auto"===i.params.options.type.name?void 0:i.params.options.type,[4,n.transaction(function(){return ue(void 0,void 0,void 0,function(){var m,h,v,g,y,S,C,_;return ce(this,function(x){switch(x.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(D,w){return{id:""+w,url:D.url,isBinary:D.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return m=x.sent(),[4,t.builders.structure.parseTrajectory(m,{formats:o.map(function(D,w){return{id:""+w,format:"cif"}})})];case 2:return C=x.sent(),[4,t.builders.structure.hierarchy.applyPreset(C,"default",{structure:f,showUnitcell:d,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return x.sent(),[3,10];case 4:h=0,v=o,x.label=5;case 5:return h<v.length?[4,t.builders.data.download(g=v[h],{state:{isGhost:!0}})]:[3,10];case 6:if(y=x.sent(),!(S="auto"===u?t.dataFormats.auto(Ry(dn.getUrl(g.url)),null===(_=y.cell)||void 0===_?void 0:_.obj):t.dataFormats.get(u)))throw new Error("unknown file format");return[4,t.builders.structure.parseTrajectory(y,S)];case 7:return C=x.sent(),[4,t.builders.structure.hierarchy.applyPreset(C,"default",{structure:f,showUnitcell:d,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:x.sent(),x.label=9;case 9:return h++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 16:return p.sent(),[2]}})})})});function Pl(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,f,p;return ce(this,function(m){switch(m.label){case 0:a=e.split(/[,\s]/).map(function(h){return h.trim()}).filter(function(h){return!!h&&(h.length>=4||/^[1-9][0-9]*$/.test(h))}),i=[],o=0,s=a,m.label=1;case 1:return o<s.length?(l=(c=i).push,p={},f=(d=dn).Url,[4,t(u=s[o])]):[3,4];case 2:l.apply(c,[(p.url=f.apply(d,[m.sent()]),p.isBinary=n,p.label=r(u),p)]),m.label=3;case 3:return o++,[3,1];case 4:return[2,i]}})})}function yJe(e){return ue(this,void 0,void 0,function(){return ce(this,function(t){if("pdb"!==e.name||"pdbe"!==e.params.provider.server.name)throw new Error("expected pdbe");return[2,"updated"===e.params.provider.server.params.variant?Pl(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),"_updated.cif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!1):"updated-bcif"===e.params.provider.server.params.variant?Pl(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/entry-files/download/".concat(r.toLowerCase(),".bcif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!0):Pl(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),".cif")},function(r){return"PDBe: ".concat(r," (cif)")},!1)]})})}function bJe(e){return ue(this,void 0,void 0,function(){return ce(this,function(t){if("pdb"!==e.name||"pdbj"!==e.params.provider.server.name)throw new Error("expected pdbj");return[2,Pl(e.params.provider.id,function(r){return"https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/".concat(r.toLowerCase().substring(1,3),"/").concat(r.toLowerCase(),".cif")},function(r){return"PDBj: ".concat(r," (cif)")},!1)]})})}function SJe(e){return ue(this,void 0,void 0,function(){return ce(this,function(t){if("pdb"!==e.name||"rcsb"!==e.params.provider.server.name)throw new Error("expected rcsb");return[2,"cif"===e.params.provider.server.params.encoding?Pl(e.params.provider.id,function(r){return"https://files.rcsb.org/download/".concat(r.toUpperCase(),".cif")},function(r){return"RCSB PDB: ".concat(r," (cif)")},!1):Pl(e.params.provider.id,function(r){return"https://models.rcsb.org/".concat(r.toUpperCase(),".bcif")},function(r){return"RCSB PDB: ".concat(r," (bcif)")},!0)]})})}var CJe=Bs.build({display:{name:"Update Trajectory"},params:{action:T.Select("advance",T.arrayToOptions(["advance","reset"])),by:T.Optional(T.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(et.Model.ModelFromTrajectory)}),a=r.build();if("reset"===t.action)for(var i=0,o=n;i<o.length;i++)a.to(o[i]).update({modelIndex:0});else for(var u=function(d){var f=xr.findAncestorOfType(r.tree,r.cells,d.transform.ref,ve.Molecule.Trajectory);if(!f||!f.obj)return"continue";var p=f.obj;a.to(d).update(function(m){var h=(m.modelIndex+t.by)%p.data.frameCount;return h<0&&(h+=p.data.frameCount),{modelIndex:h}})},c=0,l=n;c<l.length;c++)u(l[c]);return r.updateTree(a)}),xJe=Bs.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ve.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable:function(e,t,r){return t.transformer!==K$}})(function(e,t){return t.builders.structure.insertModelProperties(e.ref,e.params)}),_Je=Bs.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ve.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable:function(e,t,r){return t.transformer!==Q$}})(function(e,t){return t.builders.structure.insertStructureProperties(e.ref,e.params)}),wJe=Bs.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ve.Root,params:function(e,t){var r=t.state.data,a=or(or([],r.selectQ(function(s){return s.rootsOfType(ve.Molecule.Model)}),!0),r.selectQ(function(s){return s.rootsOfType(ve.Molecule.Topology)}),!0).map(function(s){return[s.transform.ref,s.obj.label]}),o=r.selectQ(function(s){return s.rootsOfType(ve.Molecule.Coordinates)}).map(function(s){return[s.transform.ref,s.obj.label]});return{model:T.Select(a.length?a[0][0]:"",a),coordinates:T.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Add Trajectory",function(a){return n.transaction(function(){return ue(void 0,void 0,void 0,function(){var i,o,s;return ce(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(LB,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(et.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})}),AJe=Bs.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:ve.Root,params:function(e,t){for(var r=t.dataFormats.options,n=r.filter(function(l){return l[2]===Il||l[2]===K2}),a=r.filter(function(l){return l[2]===Oy}),i=[],o=[],s=0,u=t.dataFormats.list;s<u.length;s++){var c=u[s].provider;c.category===Il||c.category===K2?(c.binaryExtensions&&i.push.apply(i,c.binaryExtensions),c.stringExtensions&&i.push.apply(i,c.stringExtensions)):c.category===Oy&&(c.binaryExtensions&&o.push.apply(o,c.binaryExtensions),c.stringExtensions&&o.push.apply(o,c.stringExtensions))}return{source:T.MappedStatic("file",{url:T.Group({model:T.Group({url:T.Url(""),format:T.Select(n[0][0],n),isBinary:T.Boolean(!1)},{isExpanded:!0}),coordinates:T.Group({url:T.Url(""),format:T.Select(a[0][0],a)},{isExpanded:!0})},{isFlat:!0}),file:T.Group({model:T.File({accept:i.map(function(l){return".".concat(l)}).join(","),label:"Model"}),coordinates:T.File({accept:o.map(function(l){return".".concat(l)}).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Load Trajectory",function(a){return n.transaction(function(){return ue(void 0,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:if("file"===(i=r.source).name&&(null===i.params.model||null===i.params.coordinates))return t.log.error("No file(s) selected"),[2];if(!("url"!==i.name||i.params.model&&i.params.coordinates))return t.log.error("No URL(s) given"),[2];o=function(y,S,C){return ue(void 0,void 0,void 0,function(){var _,x;return ce(this,function(D){switch(D.label){case 0:return[4,t.builders.data.download({url:y,isBinary:C})];case 1:return _=D.sent(),(x=t.dataFormats.get(S))?[2,x.parse(t,_)]:(t.log.warn("LoadTrajectory: could not find data provider for '".concat(S,"'")),[2])}})})},s=function(y){return ue(void 0,void 0,void 0,function(){var S,C,_,x,D,w,A;return ce(this,function(E){switch(E.label){case 0:if(!y)throw new Error("No file selected");return S=Ry(null!==(w=null===(D=y.file)||void 0===D?void 0:D.name)&&void 0!==w?w:""),C=t.dataFormats.binaryExtensions.has(S.ext),[4,t.builders.data.readFile({file:y,isBinary:C})];case 1:return _=E.sent().data,(x=t.dataFormats.auto(S,null===(A=_.cell)||void 0===A?void 0:A.obj))?[3,3]:(t.log.warn("LoadTrajectory: could not find data provider for '".concat(S.ext,"'")),[4,t.state.data.build().delete(_).commit()]);case 2:return E.sent(),[2];case 3:return[2,x.parse(t,_)]}})})},g.label=1;case 1:return g.trys.push([1,16,,17]),"url"!==i.name?[3,3]:[4,o(i.params.model.url,i.params.model.format,i.params.model.isBinary)];case 2:return c=g.sent(),[3,5];case 3:return[4,s(i.params.model)];case 4:c=g.sent(),g.label=5;case 5:return l=void 0,"trajectory"in(u=c)?[4,n.build().to(u.trajectory).apply(j$,{modelIndex:0}).commit()]:[3,7];case 6:return l=g.sent(),[3,8];case 7:l=u.topology,g.label=8;case 8:return"url"!==i.name?[3,10]:[4,o(i.params.coordinates.url,i.params.coordinates.format,!0)];case 9:return f=g.sent(),[3,12];case 10:return[4,s(i.params.coordinates)];case 11:f=g.sent(),g.label=12;case 12:return p=[l.ref,(d=f).ref],m=n.build().toRoot().apply(LB,{modelRef:l.ref,coordinatesRef:d.ref},{dependsOn:p}).apply(et.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(m).runInContext(a)];case 13:return g.sent(),[4,t.builders.structure.createStructure(m.selector)];case 14:return h=g.sent(),[4,t.builders.structure.representation.applyPreset(h,"auto")];case 15:return g.sent(),[3,17];case 16:return v=g.sent(),console.error(v),t.log.error("Error loading trajectory"),[3,17];case 17:return[2]}})})}).runInContext(a)})}),TJe=Bs.build({from:ve.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:T.MappedStatic("pdb-xray",{"pdb-xray":T.Group({provider:T.Group({id:T.Text("1tqn",{label:"Id"}),server:T.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:T.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":T.Group({provider:T.Group({id:T.Text("1tqn",{label:"Id"}),server:T.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:T.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":T.Group({provider:T.Group({id:T.Text("emd-8004",{label:"Id"}),server:T.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:T.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:T.Group({url:T.Url(""),isBinary:T.Boolean(!1),format:T.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return Ve.create("Download Density",function(n){return ue(void 0,void 0,void 0,function(){var a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:switch((a=r.source).name){case"url":i=a.params;break;case"pdb-xray":i="pdbe"===a.params.provider.server?{url:dn.Url("https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.params.provider.id.toLowerCase(),"2fofc"===a.params.type?".ccp4":"_diff.ccp4")),isBinary:!0,label:"PDBe X-ray map: ".concat(a.params.provider.id)}:{url:dn.Url("https://edmaps.rcsb.org/maps/".concat(a.params.provider.id.toLowerCase(),"2fofc"===a.params.type?"_2fofc.dsn6":"_fofc.dsn6")),isBinary:!0,label:"RCSB X-ray map: ".concat(a.params.provider.id)};break;case"pdb-emd-ds":i="pdbe"===a.params.provider.server?{url:dn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe EMD Density Server: ".concat(a.params.provider.id)}:{url:dn.Url("https://maps.rcsb.org/em/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB EMD Density Server: ".concat(a.params.provider.id)};break;case"pdb-xray-ds":i="pdbe"===a.params.provider.server?{url:dn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe X-ray Density Server: ".concat(a.params.provider.id)}:{url:dn.Url("https://maps.rcsb.org/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB X-ray Density Server: ".concat(a.params.provider.id)};break;default:Sn()}return[4,t.builders.data.download(i)];case 1:switch(s=f.sent(),u=void 0,a.name){case"url":i=a.params,o="auto"===a.params.format?t.dataFormats.auto(Ry(dn.getUrl(i.url)),null===(l=s.cell)||void 0===l?void 0:l.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=t.dataFormats.get("pdbe"===a.params.provider.server?"ccp4":"dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:Sn()}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return c=f.sent(),[4,null===(d=o.visuals)||void 0===d?void 0:d.call(o,t,c)];case 3:return f.sent(),[2]}})})})}),bae=Bs.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ve.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(xr.Generators.root.subtree().ofType(ve.Volume.Data).filter(function(n){var a;return!(!n.obj||null!==(a=n.obj)&&void 0!==a&&a.data.colorVolume||n.obj===e)}));return 0===r.length?{ref:T.Text("",{isHidden:!0,label:"Volume"})}:{ref:T.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return t.build().to(r).apply(et.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()});function mD(e,t,r,n){var a,i,o,s;return ue(this,void 0,void 0,function(){var u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:return u=Ry(null!==(i=null===(a=e.file)||void 0===a?void 0:a.name)&&void 0!==i?i:""),c=t.dataFormats.binaryExtensions.has(u.ext),[4,t.builders.data.readFile({file:e,isBinary:c})];case 1:return l=p.sent().data,(d="auto"===r?t.dataFormats.auto(u,null===(o=l.cell)||void 0===o?void 0:o.obj):t.dataFormats.get(r))?[3,3]:(t.log.warn("OpenFiles: could not find data provider for '".concat(u.ext,"'")),[4,t.state.data.build().delete(l).commit()]);case 2:return p.sent(),[2];case 3:return[4,d.parse(t,l)];case 4:return f=p.sent(),n?[4,null===(s=d.visuals)||void 0===s?void 0:s.call(d,t,f)]:[3,6];case 5:p.sent(),p.label=6;case 6:return[2]}})})}var Cae,Z2,Sae=Bs.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ve.Root,params:function(e,t){var r=t.dataFormats,a=r.options;return{files:T.FileList({accept:Array.from(r.extensions.values()).map(function(i){return".".concat(i)}).join(",")+",.gz,.zip",multiple:!0}),format:T.MappedStatic("auto",{auto:T.EmptyGroup(),specific:T.Select(a[0][0],a)}),visuals:T.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Open Files",function(a){return ue(void 0,void 0,void 0,function(){return ce(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ue(void 0,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m,h,v,S;return ce(this,function(C){switch(C.label){case 0:if(null===r.files)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,C.label=1;case 1:if(!(o<s.length))return[3,14];u=s[o],C.label=2;case 2:return C.trys.push([2,12,,13]),u.file&&u.name.toLowerCase().endsWith(".zip")?(l=vS,d=[a],[4,u.file.arrayBuffer()]):[3,9];case 3:return[4,l.apply(void 0,d.concat([C.sent()]))];case 4:c=C.sent(),f=0,p=Object.entries(c),C.label=5;case 5:return f<p.length?(h=(m=p[f])[0],(v=m[1])instanceof Uint8Array&&0!==v.length?[4,mD(dn.File(new File([v],h)),t,"auto",r.visuals)]:[3,7]):[3,8];case 6:C.sent(),C.label=7;case 7:return f++,[3,5];case 8:return[3,11];case 9:return[4,mD(u,t,"auto"===r.format.name?"auto":r.format.params,r.visuals)];case 10:C.sent(),C.label=11;case 11:return[3,13];case 12:return S=C.sent(),console.error(S),t.log.error("Error opening file '".concat(u.name,"'")),[3,13];case 13:return o++,[3,1];case 14:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),DJe=Bs.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ve.Root,params:function(e,t){var r=or(or([],t.dataFormats.options,!0),[["zip","Zip"],["gzip","Gzip"]],!1);return{url:T.Url(""),format:T.Select(r[0][0],r),isBinary:T.Boolean(!1),visuals:T.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Ve.create("Open Files",function(a){return ue(void 0,void 0,void 0,function(){return ce(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ue(void 0,void 0,void 0,function(){var o,s,u,c,l,d,p,m,h,v,g,y,S,C,_;return ce(this,function(x){switch(x.label){case 0:return x.trys.push([0,15,,16]),"zip"===r.format||"gzip"===r.format?[4,t.builders.data.download({url:r.url,isBinary:!0})]:[3,10];case 1:return v=x.sent(),"zip"!==r.format?[3,7]:[4,vS(a,(null===(S=v.obj)||void 0===S?void 0:S.data).buffer)];case 2:o=x.sent(),s=0,u=Object.entries(o),x.label=3;case 3:return s<u.length?(l=(c=u[s])[0],(d=c[1])instanceof Uint8Array&&0!==d.length?[4,mD(dn.File(new File([d],l)),t,"auto",r.visuals)]:[3,5]):[3,6];case 4:x.sent(),x.label=5;case 5:return s++,[3,3];case 6:return[3,9];case 7:return p=dn.getUrl(r.url),m=Ry(p).name,[4,mD(dn.File(new File([null===(C=v.obj)||void 0===C?void 0:C.data],m)),t,"auto",r.visuals)];case 8:x.sent(),x.label=9;case 9:return[3,14];case 10:return(h=t.dataFormats.get(r.format))?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '".concat(r.format,"'")),[2]);case 11:return v=x.sent(),[4,h.parse(t,v)];case 12:return g=x.sent(),r.visuals?[4,null===(_=h.visuals)||void 0===_?void 0:_.call(h,t,g)]:[3,14];case 13:x.sent(),x.label=14;case 14:return[3,16];case 15:return y=x.sent(),console.error(y),t.log.error("Error downloading '".concat("string"==typeof r.url?r.url:r.url.url,"'")),[3,16];case 16:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),Rv={Structure:DE,Volume:EE,DataFormat:IE},Ik=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t}(ve.Create({name:"Volume Streaming",typeClass:"Object"}));function xae(e,t,r,n){return ue(this,void 0,void 0,function(){return ce(this,function(a){switch(e){case"emdb":return[2,_ae(t,r,n)];case"pdbe":return[2,RJe(t,r,n)]}return[2]})})}function _ae(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u;return ce(this,function(l){switch(l.label){case 0:return n=e.config.get(pa.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:"".concat(n,"/").concat(r.toUpperCase(),"/header/").concat(r.toLowerCase(),".xml"),type:"xml"}).runInContext(t)];case 1:for(a=l.sent(),i=a.getElementsByTagName("map")[0],o=i.getElementsByTagName("contour"),s=o[0],u=1;u<o.length;u++)if("true"===o[u].getAttribute("primary")){s=o[u];break}return[2,parseFloat(s.getElementsByTagName("level")[0].textContent)]}})})}function RJe(e,t,r){var n,a,i,o;return ue(this,void 0,void 0,function(){var s,u;return ce(this,function(c){switch(c.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return s=c.sent(),(u=null===(a=null===(n=s?.map)||void 0===n?void 0:n.contour_list)||void 0===a?void 0:a.contour)&&0!==u.length?[2,null!==(o=null===(i=u.find(function(l){return l.primary}))||void 0===i?void 0:i.level)&&void 0!==o?o:u[0].level]:[2,OJe(e,t,r)]}})})}function OJe(e,t,r){var n,a,i;return ue(this,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return o=c.sent(),s=o?.[r],u=void 0,void 0!==(null===(i=null===(a=null===(n=s?.[0])||void 0===n?void 0:n.map)||void 0===a?void 0:a.contour_level)||void 0===i?void 0:i.value)&&(u=+s[0].map.contour_level.value),[2,u]}})})}function FJe(e,t,r){var n;return ue(this,void 0,void 0,function(){var a,i,o,s;return ce(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/".concat(r),type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a?.[r],o=[],null===(n=i?.[0])||void 0===n||!n.related_structures)throw new Error("No related EMDB entry found for '".concat(r,"'."));if(!(s=i[0].related_structures.filter(function(c){return"EMDB"===c.resource&&"associated EM volume"===c.relationship})).length)throw new Error("No related EMDB entry found for '".concat(r,"'."));return o.push.apply(o,s.map(function(c){return c.accession})),[2,o]}})})}!function(e){var r;(r=e.ValueType||(e.ValueType={})).Float32="float32",r.Int8="int8"}(Cae||(Cae={})),function(e){e.create=function r(o){return{entries:rF(),capacity:Math.max(1,o)}},e.get=function n(o,s){for(var u=o.entries.first;u;u=u.next)if(u.value.key===s)return o.entries.remove(u),o.entries.addLast(u.value),u.value.data},e.set=function a(o,s,u){var c=void 0;if(o.entries.count>=o.capacity){var l=o.entries.first;c=l.value.data,o.entries.remove(l)}return o.entries.addLast(function t(o,s){return{key:o,data:s}}(s,u)),c},e.remove=function i(o,s){for(var u=o.entries.first;u;u=u.next)if(u.value.key===s){o.entries.remove(u);break}}}(Z2||(Z2={}));class BJe extends Xs{constructor(t,r){super()}schedule(t,r=0){return this}}const hD={setInterval(e,t,...r){const{delegate:n}=hD;return n?.setInterval?n.setInterval(e,t,...r):setInterval(e,t,...r)},clearInterval(e){const{delegate:t}=hD;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class Q2{constructor(t,r=Q2.now){this.schedulerActionCtor=t,this.now=r}schedule(t,r=0,n){return new this.schedulerActionCtor(this,t).schedule(n,r)}}Q2.now=vR.now;const Pk=new class kJe extends Q2{constructor(t,r=Q2.now){super(t,r),this.actions=[],this._active=!1}flush(t){const{actions:r}=this;if(this._active)return void r.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=r.shift());if(this._active=!1,n){for(;t=r.shift();)t.unsubscribe();throw n}}}(class NJe extends BJe{constructor(t,r){super(t,r),this.scheduler=t,this.work=r,this.pending=!1}schedule(t,r=0){var n;if(this.closed)return this;this.state=t;const a=this.id,i=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(i,a,r)),this.pending=!0,this.delay=r,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,r),this}requestAsyncId(t,r,n=0){return hD.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,r,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return r;null!=r&&hD.clearInterval(r)}execute(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,r);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,r){let a,n=!1;try{this.work(t)}catch(i){n=!0,a=i||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),a}unsubscribe(){if(!this.closed){const{id:t,scheduler:r}=this,{actions:n}=r;this.work=this.state=this.scheduler=null,this.pending=!1,xC(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,super.unsubscribe()}}}),LJe=Pk;function wae(e,t=Pk,r){const n=function GJe(e=0,t,r=LJe){let n=-1;return null!=t&&(nU(t)?r=t:n=t),new zi(a=>{let i=function VJe(e){return e instanceof Date&&!isNaN(e)}(e)?+e-r.now():e;i<0&&(i=0);let o=0;return r.schedule(function(){a.closed||(a.next(o++),0<=n?this.schedule(void 0,n):a.complete())},i)})}(e,t);return function UJe(e,t){return di((r,n)=>{const{leading:a=!0,trailing:i=!1}=t??{};let o=!1,s=null,u=null,c=!1;const l=()=>{u?.unsubscribe(),u=null,i&&(p(),c&&n.complete())},d=()=>{u=null,c&&n.complete()},f=m=>u=_u(e(m)).subscribe(fi(n,l,d)),p=()=>{if(o){o=!1;const m=s;s=null,n.next(m),!c&&f(m)}};r.subscribe(fi(n,m=>{o=!0,s=m,(!u||u.closed)&&(a?p():f(m))},()=>{c=!0,(!(i&&o&&u)||u.closed)&&n.complete()}))})}(()=>n,r)}var zJe=function(){function e(t){void 0===t&&(t=!1),this.isRunning=!1,this.queue=[],this.counter=0,this.log=t}return e.prototype.enqueue=function(t){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:t},this.counter++,this.run()},e.prototype.run=function(){return ue(this,void 0,void 0,function(){var t;return ce(this,function(r){switch(r.label){case 0:if(this.isRunning)return[2];if(!(t=this.queue.pop()))return[2];this.isRunning=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),this.log&&console.log("SingleAsyncQueue run",t.id),[4,t.func()];case 2:return r.sent(),this.log&&console.log("SingleAsyncQueue complete",t.id),[3,4];case 3:return this.isRunning=!1,this.run(),[7];case 4:return[2]}})})},e}(),tc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jt(t,e),t}(ve.CreateBehavior({name:"Volume Streaming"}));function Nm(e,t,r){return{i:e,j:t,k:r}}function jc(e,t){return{a:e,b:t}}!function(e){function t(u,c,l,d,f){var p,m,h,v;return void 0===f&&(f={}),T.Group({isoValue:nt.createIsoValueParam(null!==(p=f.isoValue)&&void 0!==p?p:l,d),color:T.Color(null!==(m=f.color)&&void 0!==m?m:c),wireframe:T.Boolean(null!==(h=f.wireframe)&&void 0!==h&&h),opacity:T.Numeric(null!==(v=f.opacity)&&void 0!==v?v:.3,{min:0,max:1,step:.01})},{label:u,isExpanded:!0})}e.RootTag="volume-streaming-info";var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function a(u){var l=u.defaultView,d=u.structure,f=u.channelParams,p=void 0===f?{}:f,m=u.entryData||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:nt.IsoValue.relative(0)},h=d&&d.boundary.box||Nt();return{view:T.MappedStatic(l||("em"===m.kind?"auto":"selection-box"),{off:T.Group({}),box:T.Group({bottomLeft:T.Vec3(h.min),topRight:T.Vec3(h.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":T.Group({radius:T.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),bottomLeft:T.Vec3(b.create(0,0,0),{},{isHidden:!0}),topRight:T.Vec3(b.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":T.Group({radius:T.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:i(m.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:T.Vec3(b.create(0,0,0),{},{isHidden:!0}),topRight:T.Vec3(b.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:T.Group({}),auto:T.Group({radius:T.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),selectionDetailLevel:i(m.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:T.Boolean(!1,{isHidden:!0}),bottomLeft:T.Vec3(h.min,{},{isHidden:!0}),topRight:T.Vec3(h.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:i(m.header.availablePrecisions,3),channels:T.Group("em"===m.kind?{em:t("EM",dt(6524815),m.emDefaultContourLevel||nt.IsoValue.relative(1),m.header.sampling[0].valuesInfo[0],p.em)}:{"2fo-fc":t("2Fo-Fc",dt(3367602),nt.IsoValue.relative(1.5),m.header.sampling[0].valuesInfo[0],p["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",dt(3390259),nt.IsoValue.relative(3),m.header.sampling[0].valuesInfo[1],p["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",dt(12268339),nt.IsoValue.relative(-3),m.header.sampling[0].valuesInfo[1],p["fo-fc(-ve)"])},{isFlat:!0})}}function i(u,c,l){return T.Select(Math.min(c,u.length-1),u.map(function(d,f){return[f,"".concat(f+1," [ ").concat(0|Math.pow(d.maxVoxels,1/3),"^3 cells ]")]}),R({description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels)."},l))}function o(u){return{entry:{name:u.entry.name,params:{detailLevel:u.entry.params.detailLevel,channels:u.entry.params.channels,view:{name:u.entry.params.view.name,params:R({},u.entry.params.view.params)}}}}}e.createParams=function n(u){void 0===u&&(u={});var c=u.data,l=u.defaultView,d=u.channelParams,f=new Map;c&&c.entries.forEach(function(h){return f.set(h.dataId,h)});var p=c?c.entries.map(function(h){return[h.dataId,h.dataId]}):[];return{entry:T.Mapped(c?c.entries[0].dataId:"",p,function(h){return T.Group(a({entryData:f.get(h),defaultView:l,structure:c&&c.structure,channelParams:d}))})}},e.createEntryParams=a,e.copyParams=o,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var s=function(u){function c(l,d){var f=u.call(this,l,{})||this;return f.plugin=l,f.data=d,f.cache=Z2.create(25),f.params={},f.lastLoci=Wr,f.ref="",f.cameraTargetObservable=f.plugin.canvas3d.didDraw.pipe(wae(500,void 0,{leading:!0,trailing:!0}),$n(function(){var p;return null===(p=f.plugin.canvas3d)||void 0===p?void 0:p.camera.getSnapshot()}),uU(function(p,m){return f.isCameraTargetSame(p,m)}),uf(function(p){return void 0!==p})),f.cameraTargetSubscription=void 0,f.channels={},f._invTransform=he(),f.infoMap=new Map,f.data.entries.forEach(function(p){return f.infoMap.set(p.dataId,p)}),f.updateQueue=new zJe,f}return jt(c,u),Object.defineProperty(c.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),c.prototype.queryData=function(l){return ue(this,void 0,void 0,function(){var d,p,m,h,v,g,y,S;return ce(this,function(C){switch(C.label){case 0:return d=PN(this.data.serverUrl,"".concat(this.info.kind,"/").concat(this.info.dataId.toLowerCase())),l?(p=l.max,d+="/box"+"/".concat(l.min.map(function(_){return Math.round(1e3*_)/1e3}).join(","))+"/".concat(p.map(function(_){return Math.round(1e3*_)/1e3}).join(","))):d+="/cell",m=this.params.entry.params.detailLevel,"auto"===this.params.entry.params.view.name&&this.params.entry.params.view.params.isSelection&&(m=this.params.entry.params.view.params.selectionDetailLevel),"camera-target"===this.params.entry.params.view.name&&l&&(m=this.decideDetail(l,this.params.entry.params.view.params.dynamicDetailLevel)),d+="?detail=".concat(m),(h=Z2.get(this.cache,d))?[2,h.data]:(v=dn.getUrlAsset(this.plugin.managers.asset,d),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return g=C.sent(),[4,this.parseCif(g.data)];case 2:return(y=C.sent())?((S=Z2.set(this.cache,d,{data:y,asset:g}))&&S.asset.dispose(),[2,y]):[2]}})})},c.prototype.parseCif=function(l){return ue(this,void 0,void 0,function(){var d,f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:return[4,this.plugin.runTask(hl.parseBinary(l))];case 1:if((d=g.sent()).isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+d.toString()),[2];if(d.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];f={},p=1,g.label=2;case 2:return p<d.result.blocks.length?(h=hl.schema.densityServer(m=d.result.blocks[p]),[4,this.plugin.runTask(FK(h))]):[3,5];case 3:v=g.sent(),f[m.header]=v,g.label=4;case 4:return p++,[3,2];case 5:return[2,f]}})})},c.prototype.updateParams=function(l,d){return void 0===d&&(d=!1),ue(this,void 0,void 0,function(){var f,p,m,h;return ce(this,function(v){switch(v.label){case 0:return f=o(this.params),"off"!==(p=f.entry.params.view.name)&&"cell"!==p&&(f.entry.params.view.params.bottomLeft=l?.min||b.zero(),f.entry.params.view.params.topRight=l?.max||b.zero()),"auto"===p&&(f.entry.params.view.params.isSelection=d),h=(m=this.plugin.state.data).build().to(this.ref).update(f),[4,yr.State.Update(this.plugin,{state:m,tree:h,options:{doNotUpdateCurrent:!0}})];case 1:return v.sent(),[2]}})})},c.prototype.getStructureRoot=function(){return this.plugin.state.data.select(xr.Generators.byRef(this.ref).rootOfType(ve.Molecule.Structure))[0]},c.prototype.register=function(l){var d=this;this.ref=l,this.subscribeObservable(this.plugin.state.events.object.removed,function(f){!ve.Molecule.Structure.is(f.obj)||!Re.is(d.lastLoci)||d.lastLoci.structure===f.obj.data&&(d.lastLoci=Wr)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(f){!ve.Molecule.Structure.is(f.oldObj)||!Re.is(d.lastLoci)||d.lastLoci.structure===f.oldObj.data&&(d.lastLoci=Wr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(f){if(d.plugin.state.data.tree.children.has(d.ref)){var p=f?f.loci:Wr;switch(d.params.entry.params.view.name){case"auto":d.updateAuto(p);break;case"selection-box":d.updateSelectionBox(p);break;default:d.lastLoci=p}}})},c.prototype.unregister=function(){for(var l=this.cache.entries.first;l;)l.value.data.asset.dispose(),l=l.next},c.prototype.isCameraTargetSame=function(l,d){if(!l||!d)return!1;var f=b.equals(l.target,d.target),p=b.squaredDistance(l.target,l.position),m=b.squaredDistance(d.target,d.position),h=Math.abs(p-m)/p<.001;return f&&h},c.prototype.cameraTargetDistance=function(l){return b.distance(l.target,l.position)},c.prototype.getBoxFromLoci=function(l){var d,f,p;if(fr.isEmpty(l)||fs(l))return Nt();var m=this.plugin.helpers.substructureParent.get(l.structure,!0);if(!m)return Nt();var h=this.getStructureRoot();if(!h||(null===(d=h.obj)||void 0===d?void 0:d.data)!==(null===(f=m.obj)||void 0===f?void 0:f.data))return Nt();var v=ov.get(null===(p=h.obj)||void 0===p?void 0:p.data.models[0]);v&&he.invert(this._invTransform,v);var g=Re.extendToWholeResidues(l),y=Re.getBoundary(g,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return 1===Re.size(g)&&Nt.expand(y,y,b.create(1,1,1)),y},c.prototype.updateAuto=function(l){var d=this;this.updateQueue.enqueue(function(){return ue(d,void 0,void 0,function(){return ce(this,function(f){switch(f.label){case 0:return this.lastLoci=l,fs(l)?[4,this.updateParams("x-ray"===this.info.kind?this.data.structure.boundary.box:void 0,!1)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this.updateParams(this.getBoxFromLoci(l),!0)];case 3:f.sent(),f.label=4;case 4:return[2]}})})})},c.prototype.updateSelectionBox=function(l){var d=this;this.updateQueue.enqueue(function(){return ue(d,void 0,void 0,function(){var f;return ce(this,function(p){switch(p.label){case 0:return this.lastLoci=fr.areEqual(this.lastLoci,l)?Wr:l,f=this.getBoxFromLoci(this.lastLoci),[4,this.updateParams(f)];case 1:return p.sent(),[2]}})})})},c.prototype.updateCameraTarget=function(l){var d=this;this.updateQueue.enqueue(function(){return ue(d,void 0,void 0,function(){var f,p,m,h,v;return ce(this,function(g){switch(g.label){case 0:f=null===(m=this.plugin.canvas3d)||void 0===m?void 0:m.props.camera.manualReset,g.label=1;case 1:return g.trys.push([1,,3,4]),f||null===(h=this.plugin.canvas3d)||void 0===h||h.setProps({camera:{manualReset:!0}}),p=this.boxFromCameraTarget(l,!0),[4,this.updateParams(p)];case 2:return g.sent(),[3,4];case 3:return f||null===(v=this.plugin.canvas3d)||void 0===v||v.setProps({camera:{manualReset:f}}),[7];case 4:return[2]}})})})},c.prototype.boxFromCameraTarget=function(l,d){var f,S,C,_,p=l.target,m=this.cameraTargetDistance(l),v=Math.tan(.5*l.fov)*m,g=null===(f=this.plugin.canvas3d)||void 0===f?void 0:f.camera.viewport;if(g&&g.width>g.height&&(v*=g.width/g.height),v*="camera-target"===this.params.entry.params.view.name?this.params.entry.params.view.params.radius:.5,d){var x=b.zero();Nt.size(x,this.data.structure.boundary.box),S=Math.min(v,.5*x[0]),C=Math.min(v,.5*x[1]),_=Math.min(v,.5*x[2])}else S=C=_=v;return Nt.create(b.create(p[0]-S,p[1]-C,p[2]-_),b.create(p[0]+S,p[1]+C,p[2]+_))},c.prototype.decideDetail=function(l,d){for(var f="x-ray"===this.info.kind?Nt.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce(function(g,y){return g*y},1),m=Nt.volume(l)/f,h=this.info.header.availablePrecisions.length-1,v=d;m<=.5&&v<h;)m*=2,v+=1;return v},c.prototype.update=function(l){return ue(this,void 0,void 0,function(){var d,f,p,m,h,v,g,y=this;return ce(this,function(S){switch(S.label){case 0:switch(d="selection-box"===l.entry.params.view.name&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&"selection-box"!==this.params.entry.params.view.name,this.params=l,f=void 0,p=!1,"camera-target"!==l.entry.params.view.name&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),l.entry.params.view.name){case"off":p=!0;break;case"box":f=Nt.create(l.entry.params.view.params.bottomLeft,l.entry.params.view.params.topRight),p=Nt.volume(f)<1e-4;break;case"selection-box":f=d?this.getBoxFromLoci(this.lastLoci)||Nt():Nt.create(b.clone(l.entry.params.view.params.bottomLeft),b.clone(l.entry.params.view.params.topRight)),m=l.entry.params.view.params.radius,p=Nt.volume(f)<1e-4,Nt.expand(f,f,b.create(m,m,m));break;case"camera-target":this.cameraTargetSubscription||(this.cameraTargetSubscription=this.subscribeObservable(this.cameraTargetObservable,function(C){return y.updateCameraTarget(C)})),f=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":f="x-ray"===this.info.kind?this.data.structure.boundary.box:void 0;break;case"auto":(f=l.entry.params.view.params.isSelection||"x-ray"===this.info.kind?Nt.create(b.clone(l.entry.params.view.params.bottomLeft),b.clone(l.entry.params.view.params.topRight)):void 0)&&(p=Nt.volume(f)<1e-4,l.entry.params.view.params.isSelection&&Nt.expand(f,f,b.create(m=l.entry.params.view.params.radius,m,m)))}return p?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(f)];case 2:v=S.sent(),S.label=3;case 3:return(h=v)?(g=l.entry.params.channels,"x-ray"===this.info.kind?(this.channels["2fo-fc"]=this.createChannel(h["2FO-FC"]||nt.One,g["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(h["FO-FC"]||nt.One,g["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(h["FO-FC"]||nt.One,g["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(h.EM||nt.One,g.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},c.prototype.createChannel=function(l,d,f){return{data:l,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:"relative"===d.isoValue.kind?d.isoValue:nt.IsoValue.toRelative(d.isoValue,f)}},c.prototype.getDescription=function(){return"selection-box"===this.params.entry.params.view.name?"Selection":"camera-target"===this.params.entry.params.view.name?"Camera":"box"===this.params.entry.params.view.name?"Static Box":"cell"===this.params.entry.params.view.name?"Cell":""},c}($r.WithSubscribers);e.Behavior=s}(tc||(tc={}));var ri=[Nm(0,0,0),Nm(1,0,0),Nm(1,1,0),Nm(0,1,0),Nm(0,0,1),Nm(1,0,1),Nm(1,1,1),Nm(0,1,1)],HJe=[jc(ri[0],ri[1]),jc(ri[1],ri[2]),jc(ri[2],ri[3]),jc(ri[3],ri[0]),jc(ri[4],ri[5]),jc(ri[5],ri[6]),jc(ri[6],ri[7]),jc(ri[7],ri[4]),jc(ri[0],ri[4]),jc(ri[1],ri[5]),jc(ri[2],ri[6]),jc(ri[3],ri[7])],jJe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],qJe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Fy=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],Mk=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function Aae(e){return R(R({},e),{bottomLeft:po(e.bottomLeft,[0,0,0]),topRight:po(e.topRight,e.scalarField.space.dimensions)})}function Tae(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function By(e,t){var r=this;return Ve.create("Marching Cubes Mesh",function(n){return ue(r,void 0,void 0,function(){var a,i,c,l;return ce(this,function(d){switch(d.label){case 0:return a=Aae(e),i=Tae(a),c=Math.min(262144,Math.max(i.dX*i.dY*i.dZ/32,1024)),l=function WJe(e,t){var r=Math.min(65536,4*e),n=qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(c,l,d){return++s,qe.add3(n,c,l,d)},addNormal:function(c,l,d){qe.add3(a,c,l,d)},addGroup:function(c){qe.add(i,c)},addTriangle:function(c,l,d,f){var p=c[l],m=c[d],h=c[f];p>=0&&m>=0&&h>=0&&(++u,qe.add3(o,p,m,h))},get:function(){var c=qe.compact(n,!0),l=qe.compact(a,!0),d=qe.compact(o,!0),f=qe.compact(i,!0);return Vt.create(c,d,l,f,s,u,t)}}}(c,t),[4,new Dae(n,l,a).run()];case 1:return d.sent(),[2,l.get()]}})})})}function Rk(e,t){var r=this;return Ve.create("Marching Cubes Lines",function(n){return ue(r,void 0,void 0,function(){var a,i,c,l;return ce(this,function(d){switch(d.label){case 0:return a=Aae(e),i=Tae(a),c=Math.min(262144,Math.max(i.dX*i.dY*i.dZ/32,1024)),l=function YJe(e,t){var r=qe.create(Float32Array,3,e),n=qe.create(Float32Array,1,e),a=qe.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return qe.add3(r,o,s,u)},addNormal:function(){return m0},addGroup:function(o){qe.add(n,o)},addTriangle:function(o,s,u,c,l){o[s]>=0&&o[u]>=0&&o[c]>=0&&(Mk[s][u]&l&&(++i,qe.add2(a,o[s],o[u])),Mk[u][c]&l&&(++i,qe.add2(a,o[u],o[c])),Mk[s][c]&l&&(++i,qe.add2(a,o[s],o[c])))},get:function(){for(var o=qe.compact(r,!0),s=qe.compact(a,!0),u=qe.compact(n,!0),c=uu.create(i,i/10,t),l=0;l<i;++l){var d=s[2*l],f=s[2*l+1];c.add(o[3*d],o[3*d+1],o[3*d+2],o[3*f],o[3*f+1],o[3*f+2],u[d])}return c.getLines()}}}(c,t),[4,new Dae(n,l,a).run()];case 1:return d.sent(),[2,l.get()]}})})})}var Dae=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new XJe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ue(this,void 0,void 0,function(){var t,r;return ce(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ue(this,void 0,void 0,function(){return ce(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),XJe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){this.verticesOnEdges.fill(0,t%2==0?0:3*this.nX*this.nY,t%2==0?3*this.nX*this.nY:this.verticesOnEdges.length)},e.prototype.interpolate=function(t){var r=jJe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=HJe[t],u=s.a,c=s.b,l=u.i+this.i,d=u.j+this.j,f=u.k+this.k,p=c.i+this.i,m=c.j+this.j,h=c.k+this.k,v=o(i,l,d,f),g=o(i,p,m,h),y=(this.isoLevel-v)/(v-g);if(this.idField){var S=this.idFieldGet(this.idField,l,d,f),C=this.idFieldGet(this.idField,p,m,h),_=y<.5?S:C;if(-1===_&&(_=y<.5?C:S),-2===_)return-1;this.builder.addGroup(_)}else this.builder.addGroup(0);var x=this.builder.addVertex(l+y*(l-p),d+y*(d-m),f+y*(f-h));this.verticesOnEdges[n]=x+1;var D=o(i,Math.max(0,l-1),d,f)-o(i,Math.min(this.nX-1,l+1),d,f),w=o(i,l,Math.max(0,d-1),f)-o(i,l,Math.min(this.nY-1,d+1),f),A=o(i,l,d,Math.max(0,f-1))-o(i,l,d,Math.min(this.nZ,f+1)),F=D+y*(D-(o(i,Math.max(0,p-1),m,h)-o(i,Math.min(this.nX-1,p+1),m,h))),N=w+y*(w-(o(i,p,Math.max(0,m-1),h)-o(i,p,Math.min(this.nY-1,m+1),h))),j=A+y*(A-(o(i,p,m,Math.max(0,h-1))-o(i,p,m,Math.min(this.nZ-1,h+1))));return this.isoLevel>=0?this.builder.addNormal(F,N,j):this.builder.addNormal(-F,-N,-j),x},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),0!==i&&255!==i){this.i=t,this.j=r,this.k=n;var o=qJe[i];(1&o)>0&&(this.vertList[0]=this.interpolate(0)),(2&o)>0&&(this.vertList[1]=this.interpolate(1)),(4&o)>0&&(this.vertList[2]=this.interpolate(2)),(8&o)>0&&(this.vertList[3]=this.interpolate(3)),(16&o)>0&&(this.vertList[4]=this.interpolate(4)),(32&o)>0&&(this.vertList[5]=this.interpolate(5)),(64&o)>0&&(this.vertList[6]=this.interpolate(6)),(128&o)>0&&(this.vertList[7]=this.interpolate(7)),(256&o)>0&&(this.vertList[8]=this.interpolate(8)),(512&o)>0&&(this.vertList[9]=this.interpolate(9)),(1024&o)>0&&(this.vertList[10]=this.interpolate(10)),(2048&o)>0&&(this.vertList[11]=this.interpolate(11));for(var s=Fy[i],u=0;u<s.length;u+=3){var c=s[u],l=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,c,l,d,a):this.builder.addTriangle(this.vertList,d,l,c,a)}}},e}();function Ov(e,t){var v,g,y,S,C,D,w,A,I,M,r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.dispose,l=e.geometryUtils,d=l.updateValues,f=l.updateBoundingSphere,p=l.updateRenderableState,m=l.createPositionIterator,h=Od.create(),_=Object.assign({},r),x=_i.createEmpty(),E=-1;function N(H){if(h.createNew){if(I=a(S,C),!H)throw new Error("expected geometry to be given");v=function KJe(e,t,r,n,a,i){var o=Oi.getUtils(t),u=o.createRenderableState,l=(0,o.createValues)(t,jF(),r,n,a),d=u(a);return Q0(t.kind,l,d,i)}(0,H,I,y,g,t),M=m(H,v.values)}else{if(!v)throw new Error("expected renderObject to be available");if(h.updateTransform){var z=(I=a(S,C)).instanceCount,G=I.groupCount;g.instanceGranularity?Ia(z,"instance",v.values):Ia(z*G,"groupInstance",v.values)}else I.reset();if(h.createGeometry){if(!H)throw new Error("expected geometry to be given");O.updateIfChanged(v.values.drawCount,Oi.getDrawCount(H)),O.updateIfChanged(v.values.uVertexCount,Oi.getVertexCount(H)),O.updateIfChanged(v.values.uGroupCount,Oi.getGroupCount(H))}(h.updateTransform||h.createGeometry)&&(f(v.values,H||A),M=m(H||A,v.values)),h.updateSize&&"uSize"in v.values&&Bf(I,y.size,v.values),h.updateColor&&Vu(I,M,y.color,v.values),d(v.values,g),p(v.state,g)}_=g,x=y,D=S,w=C,H&&(A=H,E+=1)}function U(H,z){return vu(H)?z(_e.ofBounds(0,_.instanceGranularity?I.instanceCount:I.groupCount*I.instanceCount)):_.instanceGranularity?function j(H,z,G,J){var X=!1;if(nt.Cell.isLoci(H)){if(nt.Cell.isLociEmpty(H)||!nt.areEquivalent(H.volume,z))return!1;J(_e.ofSingleton(0))&&(X=!0)}else if(nt.Segment.isLoci(H)){if(nt.Segment.isLociEmpty(H)||!nt.areEquivalent(H.volume,z)||!Ye.has(H.segments,G))return!1;J(_e.ofSingleton(0))&&(X=!0)}return X}(H,D,w,z):o(H,D,w,_,z)}return{get groupCount(){return I?I.count:0},get renderObject(){return v},get geometryVersion(){return E},createOrUpdate:function(H,z,G,J){return void 0===G&&(G={}),ue(this,void 0,void 0,function(){var X;return ce(this,function(Z){return function F(H,z,G,J){if(!G&&!D)throw new Error("missing volume");g=Object.assign({},_,z),y=H,S=G,C=J,Od.reset(h),v?(!nt.areEquivalent(S,D)||C!==w)&&(h.createNew=!0):h.createNew=!0,h.createNew?h.createGeometry=!0:(s(h,G,g,_,y,x),hu.areEqual(H.color,x.color)||(h.updateColor=!0),h.createGeometry&&(h.updateColor=!0),g.instanceGranularity!==_.instanceGranularity&&(h.updateTransform=!0))}(z,G,J?.volume||D,J?.key||w),h.createGeometry?[2,mw(X=n(H,S,C,y,g,A))?X.then(N):N(X)]:(N(),[2])})})},getLoci:function(H){return v?i(H,D,w,_,v.id):Wr},eachLocation:function(H){for(I.reset();I.hasNext;){var z=I.move();H(z.location,z.isSecondary)}},mark:function(H,z){return gr.mark(v,H,z,U)},setVisibility:function(H){gr.setVisibility(v,H)},setAlphaFactor:function(H){gr.setAlphaFactor(v,H)},setPickable:function(H){gr.setPickable(v,H)},setColorOnly:function(H){gr.setColorOnly(v,H)},setTransform:function(H,z){gr.setTransform(v,H,z)},setOverpaint:function(H){return gr.setOverpaint(v,H,U,!0)},setTransparency:function(H){return gr.setTransparency(v,H,U,!0)},setSubstance:function(H){return gr.setSubstance(v,H,U,!0)},setClipping:function(H){return gr.setClipping(v,H,U,!0)},setThemeStrength:function(H){gr.setThemeStrength(v,H)},destroy:function(){c?.(A),v&&(v.state.disposed=!0,v=void 0)},mustRecreate:u}}function $2(e,t,r,n,a,i){void 0===i&&(i=function(){return[-1]});var m,h,v,g,o=0,s=t.webgl,u=new bn,c=new lr.GeometryState,l=Wf(),d=[],f=lr.createState(),p=new Map,y=_i.createEmpty();return{label:e,get groupCount(){var E=0;return p.forEach(function(I){I.renderObject&&(E+=I.groupCount)}),E},get props(){return g},get params(){return v},get state(){return f},get theme(){return y},get geometryVersion(){return c.version},renderObjects:d,updated:u,createOrUpdate:function C(E,I){var M=this;void 0===E&&(E={}),I&&I!==m&&(v=r(t,I),m=I,g||(g=T.getDefaultValues(v)));var F=vN(Object.assign({},g,E),m);return Object.assign(g,E,F),h=i(g),Ve.create("Creating or updating VolumeRepresentation",function(N){return ue(M,void 0,void 0,function(){var j,U,H,z,G;return ce(this,function(J){switch(J.label){case 0:j=new Set(p.keys()),U=0,H=h.length,J.label=1;case 1:return U<H?(j.delete(z=h[U]),G=function S(E,I){var M;return ue(this,void 0,void 0,function(){var F;return ce(this,function(N){return(F=p.get(I))?!(null===(M=F.mustRecreate)||void 0===M)&&M.call(F,{volume:m,key:I},g,s)&&(F.destroy(),F=n(l,m,I,g,s),p.set(I,F)):(F=n(l,m,I,g,s),p.set(I,F)),[2,F.createOrUpdate({webgl:s,runtime:E},y,g,{volume:m,key:I})]})})}(N,z),G?[4,G]:[3,3]):[3,4];case 2:J.sent(),J.label=3;case 3:return++U,[3,1];case 4:return j.forEach(function(X){var Z;null===(Z=p.get(X))||void 0===Z||Z.destroy(),p.delete(X)}),d.length=0,p.forEach(function(X){X.renderObject&&(d.push(X.renderObject),c.add(X.renderObject.id,X.geometryVersion))}),c.snapshot(),u.next(o++),[2]}})})})},setState:function D(E){var I=E.visible,M=E.alphaFactor,F=E.pickable,N=E.overpaint,j=E.transparency,U=E.substance,H=E.clipping,z=E.transform,G=E.themeStrength,J=E.syncManually,X=E.markerActions,Z={};void 0!==I&&(Z.visible=I),void 0!==M&&(Z.alphaFactor=M),void 0!==F&&(Z.pickable=F),void 0!==N&&(Z.overpaint=N),void 0!==j&&(Z.transparency=j),void 0!==U&&(Z.substance=U),void 0!==H&&(Z.clipping=H),void 0!==G&&(Z.themeStrength=G),void 0!==z&&!he.areEqual(z,f.transform,mn)&&(Z.transform=z),void 0!==J&&(Z.syncManually=J),void 0!==X&&(Z.markerActions=X),p.forEach(function(ne){return function x(E,I){void 0!==I.visible&&E&&E.setVisibility(I.visible),void 0!==I.alphaFactor&&E&&E.setAlphaFactor(I.alphaFactor),void 0!==I.pickable&&E&&E.setPickable(I.pickable),void 0!==I.overpaint&&E&&E.setOverpaint(I.overpaint),void 0!==I.transparency&&E&&E.setTransparency(I.transparency),void 0!==I.substance&&E&&E.setSubstance(I.substance),void 0!==I.clipping&&E&&E.setClipping(I.clipping),void 0!==I.transform&&E&&E.setTransform(I.transform),void 0!==I.themeStrength&&E&&E.setThemeStrength(I.themeStrength)}(ne,Z)}),lr.updateState(f,E)},setTheme:function w(E){y=E},getLoci:function(E){var I=Wr;return p.forEach(function(M){var F=M.getLoci(E);fs(F)||(I=F)}),I},getAllLoci:function(){return[a(m,g)]},eachLocation:function(E){p.forEach(function(I){I.eachLocation(E)})},mark:function _(E,I){var M=!1;return p.forEach(function(F){M=F.mark(E,I)||M}),M},destroy:function A(){p.forEach(function(E){return E.destroy()}),p.clear()}}}R({},st.Params);var ZJe="\nprecision highp float;\nprecision highp int;\n\n#if __VERSION__ == 100\n    precision highp sampler2D;\n    uniform sampler2D tTexture;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tTexture;\n#endif\n\nvoid main(void) {\n    #if __VERSION__ == 100\n        gl_FragColor = texture2D(tTexture, vec2(0.5));\n    #else\n        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);\n    #endif\n}\n",QJe=R(R({},yi),{tTexture:Xt("texture","rgba","float","nearest")}),qc="histopyramid-sum";var J2,eC,vD=new Uint8Array(4),Eae=new Int32Array(4),ret="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInputLevel;\n\n// previous level used to evaluate the new level\n#if __VERSION__ == 100\n    uniform sampler2D tPreviousLevel;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tPreviousLevel;\n#endif\n\n// inverted size of the previous level texture.\nuniform float uSize;\nuniform float uTexSize;\nuniform bool uFirst;\n\n#include common\n\nvoid main(void) {\n    float k = 0.5 * uSize;\n    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;\n\n    #if __VERSION__ == 100\n        float a, b, c, d;\n\n        if (uFirst) {\n            a = texture2D(tInputLevel, position).r * 255.0;\n            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;\n            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;\n            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;\n        } else {\n            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);\n            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);\n            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);\n            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);\n        }\n        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);\n    #else\n        int a, b, c, d;\n\n        if (uFirst) {\n            a = int(texture2D(tInputLevel, position).r * 255.0);\n            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);\n            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);\n            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);\n        } else {\n            a = texture2D(tPreviousLevel, position).r;\n            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;\n            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;\n            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;\n        }\n        gl_FragColor = ivec4(a + b + c + d);\n    #endif\n}\n",net=R(R({},yi),{tInputLevel:Xt("texture","rgba","float","nearest"),tPreviousLevel:Xt("texture","rgba","float","nearest"),uSize:Ae("f"),uTexSize:Ae("f"),uFirst:Ae("b")}),km="histogram-pyramid";function oet(e,t){var r=Math.pow(2,t),n="level".concat(t),a=e.isWebGL2?gD(n,e,"image-int32","alpha","int","nearest"):gD(n,e,"image-uint8","rgba","ubyte","nearest");a.define(r,r);var i=function uet(e,t){var r="".concat(km,"-").concat(e);return t.namedFramebuffers[r]}(n,e);return i||(i=Iae(n,e),a.attachFramebuffer(i,0)),{texture:a,framebuffer:i}}function Iae(e,t){var r="".concat(km,"-").concat(e);return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function gD(e,t,r,n,a,i){var o="".concat(km,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function cet(e,t,r,n){xt&&e.timer.mark("createHistogramPyramid");var a=e.gl,i=e.state,o=t.getWidth();if(o!==t.getHeight()||!nS(o))throw new Error("inputTexture must be of square power-of-two size");var u=Math.ceil(Math.log(o)/Math.log(2)),c=Math.pow(2,u),l=Math.pow(2,u),d=Math.pow(2,u-1),f=e.isWebGL2?gD("pyramid",e,"image-int32","alpha","int","nearest"):gD("pyramid",e,"image-uint8","rgba","ubyte","nearest");f.define(l,d);var p=Iae("pyramid",e);f.attachFramebuffer(p,0),i.viewport(0,0,l,d),$t(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var m=[],h=0;h<u;++h)m.push(oet(e,h));var v=function aet(e,t,r){if(e.namedComputeRenderables[km]){var n=e.namedComputeRenderables[km].values;O.update(n.tInputLevel,t),O.update(n.tPreviousLevel,r),e.namedComputeRenderables[km].update()}else e.namedComputeRenderables[km]=function iet(e,t,r){var n=R(R({},bi),{tInputLevel:O.create(t),tPreviousLevel:O.create(r),uSize:O.create(0),uTexSize:O.create(0),uFirst:O.create(!0)}),a=R({},net);return Va(Ua(e,"triangles",Fn("reduction",bo,ret,{},{0:"ivec4"}),a,n),n)}(e,t,r);return e.namedComputeRenderables[km]}(e,t,m[0].texture);i.currentRenderItemId=-1,function set(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e);var g=0;for(h=0;h<u;h++){var y=u-1-h;m[y].framebuffer.bind();var C=Math.pow(2,y);O.update(v.values.uSize,Math.pow(2,h+1)/c),O.update(v.values.uTexSize,C),O.updateIfChanged(v.values.uFirst,0===h),h>0&&(O.update(v.values.tPreviousLevel,m[u-h].texture),v.update()),i.currentRenderItemId=-1,i.viewport(0,0,C,C),i.scissor(0,0,C,C),$t(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),v.render(),f.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,g,0,0,0,C,C),f.unbind(0),g+=C}a.finish(),xt&&e.timer.markEnd("createHistogramPyramid");var _=Math.max(1,function tet(e,t){xt&&e.timer.mark("getHistopyramidSum");var r=e.gl,n=e.state,a=e.resources,i=function $Je(e,t){return e.namedComputeRenderables[qc]?(O.update(e.namedComputeRenderables[qc].values.tTexture,t),e.namedComputeRenderables[qc].update()):e.namedComputeRenderables[qc]=function JJe(e,t){var r=R(R({},bi),{tTexture:O.create(t)}),n=R({},QJe);return Va(Ua(e,"triangles",Fn("sum",bo,ZJe,{},{0:"ivec4"}),n,r),r)}(e,t),e.namedComputeRenderables[qc]}(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[qc]||(e.namedFramebuffers[qc]=a.framebuffer());var o=e.namedFramebuffers[qc];return e.namedTextures[qc]||(e.namedTextures[qc]=$t(r)?a.texture("image-int32","rgba","int","nearest"):a.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[qc].define(1,1)),e.namedTextures[qc].attachFramebuffer(o,0),function eet(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e),n.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,$t(r)?Eae:vD),e.unbindFramebuffer(),xt&&e.timer.markEnd("getHistopyramidSum"),$t(r)?Eae[0]:s4(vD[0],vD[1],vD[2])}(e,m[0].texture));return{pyramidTex:f,count:_,height:Math.ceil(_/Math.pow(2,u)),levels:u,scale:r}}function det(){if(void 0!==J2)return J2;for(var e=(J2=gi(256,1,Uint8Array)).array,t=0,r=Fy.length;t<r;++t)e[t]=Fy[t].length/3;return J2}function fet(){if(void 0!==eC)return eC;for(var e=(eC=gi(4096,1,Uint8Array)).array,t=0,r=Fy.length;t<r;++t)for(var n=0;n<16;++n)e[16*t+n]=n<Fy[t].length?Fy[t][n]:255;return eC}var pet="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#if __VERSION__ == 100\n    uniform sampler2D tActiveVoxelsPyramid;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tActiveVoxelsPyramid;\n#endif\n\nuniform sampler2D tActiveVoxelsBase;\nuniform sampler2D tVolumeData;\nuniform sampler2D tTriIndices;\n\nuniform float uIsoValue;\nuniform float uLevels;\nuniform float uSize;\nuniform float uCount;\nuniform bool uInvert;\n\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform mat4 uGridTransform;\n\n// scale to volume data coord\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord + 0.5 / (texDim / uScale));\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvec4 voxelPadded(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nint idot2(const in ivec2 a, const in ivec2 b) {\n    return a.x * b.x + a.y * b.y;\n}\n\nint idot4(const in ivec4 a, const in ivec4 b) {\n    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n}\n\n#if __VERSION__ == 100\n    int pyramidVoxel(vec2 pos) {\n        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));\n    }\n#else\n    int pyramidVoxel(vec2 pos) {\n        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;\n    }\n#endif\n\nvec4 baseVoxel(vec2 pos) {\n    return texture2D(tActiveVoxelsBase, pos / uSize);\n}\n\nvec4 getGroup(const in vec3 p) {\n    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding\n    // note that we swap x and z because the texture is flipped around y\n    #if defined(dAxisOrder_012)\n        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210\n    #elif defined(dAxisOrder_021)\n        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120\n    #elif defined(dAxisOrder_102)\n        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201\n    #elif defined(dAxisOrder_120)\n        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021\n    #elif defined(dAxisOrder_201)\n        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102\n    #elif defined(dAxisOrder_210)\n        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012\n    #endif\n    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);\n}\n\nvoid main(void) {\n    // get 1D index\n    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);\n\n    // ignore 1D indices outside of the grid\n    if(vI >= int(uCount)) discard;\n\n    ivec2 offset = ivec2(int(uSize) - 2, 0);\n\n    int start = 0;\n    ivec4 starts = ivec4(0);\n    ivec4 ends = ivec4(0);\n    int diff = 2;\n    ivec4 m = ivec4(0);\n    ivec2 position = ivec2(0);\n    ivec4 vI4 = ivec4(vI);\n\n    ivec2 relativePosition = ivec2(0);\n    int end = 0;\n    ivec2 pos1 = ivec2(0);\n    ivec2 pos2 = ivec2(0);\n    ivec2 pos3 = ivec2(0);\n    ivec2 pos4 = ivec2(0);\n    ivec3 vI3 = ivec3(vI);\n    ivec3 mask = ivec3(0);\n\n    // traverse the different levels of the pyramid\n    for(int i = 1; i < 14; i++) {\n        if(float(i) >= uLevels) break;\n\n        offset.x -= diff;\n        diff *= 2;\n        relativePosition = position + offset;\n\n        end = start + pyramidVoxel(vec2(relativePosition));\n        pos1 = ivec2(relativePosition);\n        starts.x = start;\n        ends.x = end;\n        pos2 = ivec2(relativePosition + ivec2(1, 0));\n        starts.y = ends.x;\n        ends.y = ends.x + pyramidVoxel(vec2(pos2));\n        pos3 = relativePosition + ivec2(0, 1);\n        starts.z = ends.y;\n        ends.z = ends.y + pyramidVoxel(vec2(pos3));\n        pos4 = relativePosition + ivec2(1, 1);\n        starts.w = ends.z;\n        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n        m = ivec4(mask, 1 - int(any(bvec3(mask))));\n\n        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n        start = idot4(m, starts);\n        position = 2 * (relativePosition - offset);\n    }\n\n    end = start + int(baseVoxel(vec2(position)).r * 255.0);\n    pos1 = position;\n    starts.x = start;\n    ends.x = end;\n    pos2 = position + ivec2(1, 0);\n    starts.y = ends.x;\n    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);\n    pos3 = position + ivec2(0, 1);\n    starts.z = ends.y;\n    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);\n    pos4 = position + ivec2(1, 1);\n    starts.w = ends.z;\n    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n    m = ivec4(mask, 1 - int(any(bvec3(mask))));\n    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n\n    vec2 coord2d = (vec2(position) / uSize) / uScale;\n    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);\n\n    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);\n\n    // current vertex for the up to 15 MC cases\n    int currentVertex = vI - idot4(m, starts);\n\n    // ensure winding-order is the same for negative and positive iso-levels\n    if (uInvert) {\n        int v = imod(currentVertex + 1, 3);\n        if (v == 1) currentVertex += 2;\n        else if (v == 0) currentVertex -= 2;\n    }\n\n    // get index into triIndices table\n    int mcIndex = 16 * int(edgeIndex) + currentVertex;\n    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);\n\n    // bit mask to avoid conditionals (see comment below) for getting MC case corner\n    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));\n\n    // get edge value masks\n    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));\n    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));\n    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));\n\n    // apply bit masks\n    vec3 b0 = coord3d +\n                m1.y * c1 +\n                m1.z * c2 +\n                m1.w * c3 +\n                m2.x * c4 +\n                m2.y * c5 +\n                m2.z * c6 +\n                m2.w * c7 +\n                m3.y * c1 +\n                m3.z * c2 +\n                m3.w * c3;\n    vec3 b1 = coord3d +\n                m1.x * c1 +\n                m1.y * c2 +\n                m1.z * c3 +\n                m2.x * c5 +\n                m2.y * c6 +\n                m2.z * c7 +\n                m2.w * c4 +\n                m3.x * c4 +\n                m3.y * c5 +\n                m3.z * c6 +\n                m3.w * c7;\n\n    // the conditionals that are avoided by above bitmasks\n    // vec3 b0 = coord3d;\n    // vec3 b1 = coord3d;\n    // if (mcIndex == 0.0) {\n    //     b1 += c1;\n    // } else if (mcIndex == 1.0) {\n    //     b0 += c1; b1 += c2;\n    // } else if (mcIndex == 2.0) {\n    //     b0 += c2; b1 += c3;\n    // } else if (mcIndex == 3.0) {\n    //     b0 += c3;\n    // } else if (mcIndex == 4.0) {\n    //     b0 += c4; b1 += c5;\n    // } else if (mcIndex == 5.0) {\n    //     b0 += c5; b1 += c6;\n    // } else if (mcIndex == 6.0) {\n    //     b0 += c6; b1 += c7;\n    // } else if (mcIndex == 7.0) {\n    //     b0 += c7; b1 += c4;\n    // } else if (mcIndex == 8.0) {\n    //     b1 += c4;\n    // } else if (mcIndex == 9.0) {\n    //     b0 += c1; b1 += c5;\n    // } else if (mcIndex == 10.0) {\n    //     b0 += c2; b1 += c6;\n    // } else if (mcIndex == 11.0) {\n    //     b0 += c3; b1 += c7;\n    // }\n    // b0 = floor(b0 + 0.5);\n    // b1 = floor(b1 + 0.5);\n\n    vec4 d0 = voxel(b0);\n    vec4 d1 = voxel(b1);\n\n    float v0 = d0.a;\n    float v1 = d1.a;\n\n    float t = (uIsoValue - v0) / (v0 - v1);\n    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;\n\n    // group id\n    #if __VERSION__ == 100 || defined(dConstantGroup)\n        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)\n        // ensure a constant group id per triangle as needed\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(coord3d);\n        #endif\n    #else\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);\n        #endif\n    #endif\n\n    // normals from gradients\n    vec3 n0 = -normalize(vec3(\n        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,\n        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,\n        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a\n    ));\n    vec3 n1 = -normalize(vec3(\n        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,\n        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,\n        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a\n    ));\n    gl_FragData[2].xyz = -vec3(\n        n0.x + t * (n0.x - n1.x),\n        n0.y + t * (n0.y - n1.y),\n        n0.z + t * (n0.z - n1.z)\n    );\n\n    // ensure normal-direction is the same for negative and positive iso-levels\n    if (uInvert) {\n        gl_FragData[2].xyz *= -1.0;\n    }\n\n    // apply normal matrix\n    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));\n}\n",met="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tTriCount;\nuniform sampler2D tVolumeData;\n\nuniform float uIsoValue;\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord);\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvoid main(void) {\n    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;\n    vec3 posXYZ = index3dFrom2d(uv);\n\n    // get MC case as the sum of corners that are below the given iso level\n    float c = step(voxel(posXYZ).a, uIsoValue)\n        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)\n        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)\n        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)\n        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)\n        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)\n        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)\n        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);\n    c *= step(c, 254.);\n\n    // handle out of bounds positions\n    posXYZ += 1.0;\n    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)\n    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)\n        c = 0.0;\n\n    // get total triangles to generate for calculated MC case from triCount texture\n    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;\n    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);\n}\n",het=R(R({},yi),{tTriCount:Xt("image-uint8","alpha","ubyte","nearest"),tVolumeData:Xt("texture","rgba","ubyte","nearest"),uIsoValue:Ae("f"),uGridDim:Ae("v3"),uGridTexDim:Ae("v3"),uScale:Ae("v2")}),Ml="active-voxels";var Cet=R(R({},yi),{tTriIndices:Xt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:Xt("texture","rgba","float","nearest"),tActiveVoxelsBase:Xt("texture","rgba","float","nearest"),tVolumeData:Xt("texture","rgba","ubyte","nearest"),uIsoValue:Ae("f"),uSize:Ae("f"),uLevels:Ae("f"),uCount:Ae("f"),uInvert:Ae("b"),uGridDim:Ae("v3"),uGridTexDim:Ae("v3"),uGridTransform:Ae("m4"),uScale:Ae("v2"),dPackedGroup:Lt("boolean"),dAxisOrder:Lt("string",["012","021","102","120","201","210"]),dConstantGroup:Lt("boolean")}),Lm="isosurface";function yD(e,t,r,n,a,i,o,s,u,c,l,d,f,p){xt&&e.timer.mark("extractIsosurface");var m=function bet(e,t,r,n,a,i){xt&&e.timer.mark("calcActiveVoxels");var o=e.gl,s=e.state,u=e.resources,c=t.getWidth(),l=t.getHeight();e.namedFramebuffers[Ml]||(e.namedFramebuffers[Ml]=u.framebuffer());var d=e.namedFramebuffers[Ml];d.bind(),e.namedTextures[Ml]||(e.namedTextures[Ml]=u.texture("image-uint8","rgba","ubyte","nearest"));var f=e.namedTextures[Ml];f.define(c,l);var p=function vet(e,t,r,n,a,i){if(e.namedComputeRenderables[Ml]){var o=e.namedComputeRenderables[Ml].values;O.update(o.uQuadScale,i),O.update(o.tVolumeData,t),O.updateIfChanged(o.uIsoValue,a),O.update(o.uGridDim,r),O.update(o.uGridTexDim,n),O.update(o.uScale,i),e.namedComputeRenderables[Ml].update()}else e.namedComputeRenderables[Ml]=function get(e,t,r,n,a,i){var o=R(R({},bi),{tTriCount:O.create(det()),uQuadScale:O.create(i),tVolumeData:O.create(t),uIsoValue:O.create(a),uGridDim:O.create(r),uGridTexDim:O.create(n),uScale:O.create(i)}),s=R({},het);return Va(Ua(e,"triangles",Fn("active-voxels",bo,met),s,o),o)}(e,t,r,n,a,i);return e.namedComputeRenderables[Ml]}(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,f.attachFramebuffer(d,0),function yet(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e),s.viewport(0,0,c,l),s.scissor(0,0,c,l),o.clear(o.COLOR_BUFFER_BIT),s.scissor(0,0,n[0],n[1]),p.render(),o.finish(),xt&&e.timer.markEnd("calcActiveVoxels"),f}(e,t,r,n,o,a),v=function Aet(e,t,r,n,a,i,o,s,u,c,l,d,f,p,m){var h=e.extensions.drawBuffers;if(!h)throw new Error("need WebGL draw buffers");xt&&e.timer.mark("createIsosurfaceBuffers");var v=e.gl,g=e.state,y=e.resources,S=e.extensions,C=n.pyramidTex,_=n.height,x=n.levels,D=n.scale,w=n.count,A=C.getWidth();e.namedFramebuffers[Lm]||(e.namedFramebuffers[Lm]=y.framebuffer());var E=e.namedFramebuffers[Lm];$t(v)?(f||(f=y.texture("image-float32","rgba","float","nearest")),p||(p=y.texture("image-uint8","rgba","ubyte","nearest")),m||(m=S.colorBufferHalfFloat&&S.textureHalfFloat?y.texture("image-float16","rgba","fp16","nearest"):y.texture("image-float32","rgba","float","nearest"))):(f||(f=y.texture("image-float32","rgba","float","nearest")),p||(p=y.texture("image-float32","rgba","float","nearest")),m||(m=y.texture("image-float32","rgba","float","nearest"))),f.define(A,_),p.define(A,_),m.define(A,_),f.attachFramebuffer(E,0),p.attachFramebuffer(E,1),m.attachFramebuffer(E,2);var I=function xet(e,t,r,n,a,i,o,s,u,c,l,d,f,p,m){if(e.namedComputeRenderables[Lm]){var h=e.namedComputeRenderables[Lm].values;O.update(h.tActiveVoxelsPyramid,t),O.update(h.tActiveVoxelsBase,r),O.update(h.tVolumeData,n),O.updateIfChanged(h.uIsoValue,s),O.updateIfChanged(h.uSize,Math.pow(2,u)),O.updateIfChanged(h.uLevels,u),O.updateIfChanged(h.uCount,l),O.updateIfChanged(h.uInvert,d),O.update(h.uGridDim,a),O.update(h.uGridTexDim,i),O.update(h.uGridTransform,o),O.update(h.uScale,c),O.updateIfChanged(h.dPackedGroup,f),O.updateIfChanged(h.dAxisOrder,p.join("")),O.updateIfChanged(h.dConstantGroup,m),e.namedComputeRenderables[Lm].update()}else e.namedComputeRenderables[Lm]=function _et(e,t,r,n,a,i,o,s,u,c,l,d,f,p,m){var h=R(R({},bi),{tTriIndices:O.create(fet()),tActiveVoxelsPyramid:O.create(t),tActiveVoxelsBase:O.create(r),tVolumeData:O.create(n),uIsoValue:O.create(s),uSize:O.create(Math.pow(2,u)),uLevels:O.create(u),uCount:O.create(l),uInvert:O.create(d),uGridDim:O.create(a),uGridTexDim:O.create(i),uGridTransform:O.create(o),uScale:O.create(c),dPackedGroup:O.create(f),dAxisOrder:O.create(p.join("")),dConstantGroup:O.create(m)}),v=R({},Cet);return Va(Ua(e,"triangles",Fn("isosurface",bo,pet,{drawBuffers:"required"}),v,h),h)}(e,t,r,n,a,i,o,s,u,c,l,d,f,p,m);return e.namedComputeRenderables[Lm]}(e,C,t,r,a,i,o,s,x,D,w,u,c,l,d);return e.state.currentRenderItemId=-1,E.bind(),h.drawBuffers([h.COLOR_ATTACHMENT0,h.COLOR_ATTACHMENT1,h.COLOR_ATTACHMENT2]),function wet(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}(e),g.viewport(0,0,A,_),v.clear(v.COLOR_BUFFER_BIT),I.render(),v.finish(),xt&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:f,groupTexture:p,normalTexture:m,vertexCount:w}}(e,m,t,cet(e,m,a,n),r,n,i,o,s,u,c,l,d,f,p);return xt&&e.timer.markEnd("extractIsosurface"),v}var Pae={isoValue:nt.IsoValueParam},tC=1;function Ok(e,t){return!(e.grid.cells.data.length<Math.pow(10,3))&&Cm(e.grid.cells.space.dimensions,tC).powerOfTwoSize<=t.maxTextureSize/2}function Det(e,t,r,n,a){return n.tryUseGpu&&a&&function Tet(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(a)&&Ok(t,a)?function Met(e){return Ov({defaultProps:T.getDefaultValues(Nk),createGeometry:Pet,createLocationIterator:function(t){return On(t.grid.cells.data.length,1,1,function(){return Uu})},getLoci:Fk,eachLocation:Bk,setUpdateState:function(t,r,n,a){nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:is.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Ok(t.volume,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}(e):function Iet(e){return Ov({defaultProps:T.getDefaultValues(Nk),createGeometry:Eet,createLocationIterator:function(t){return On(t.grid.cells.data.length,1,1,function(){return Uu})},getLoci:Fk,eachLocation:Bk,setUpdateState:function(t,r,n,a){nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Vt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Ok(t.volume,n)}},e)}(e)}function Mae(e,t){return nt.Isosurface.Loci(e,t.isoValue)}function Fk(e,t,r,n,a){var o=e.groupId;if(a===e.objectId){var s=nt.PickingGranularity.get(t);return"volume"===s?nt.Loci(t):"object"===s?nt.Isosurface.Loci(t,n.isoValue):nt.Cell.Loci(t,_e.ofSingleton(o))}return Wr}function Bk(e,t,r,n,a){return CT(e,t,{isoValue:n.isoValue},a)}function Eet(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return e.runtime.update({message:"Marching cubes..."}),o=Bu(new Int32Array(t.grid.cells.data.length)),[4,By({isoLevel:nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Sr.create(t.grid.cells.space,Sr.Data1(o))},i).runAsChild(e.runtime)];case 1:return s=c.sent(),u=Ri.getGridToCartesianTransform(t.grid),Vt.transform(s,u),e.webgl&&!e.webgl.isWebGL2?(Vt.uniformTriangleGroup(s,!1),O.updateIfChanged(s.varyingGroup,!1)):O.updateIfChanged(s.varyingGroup,!0),s.setBoundingSphere(nt.Isosurface.getBoundingSphere(t,a.isoValue)),[2,s]}})})}var kk,Nk=R(R(R(R({},Vt.Params),is.Params),Pae),{quality:R(R({},Vt.Params.quality),{isEssential:!1}),tryUseGpu:T.Boolean(!0)});function Pet(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D;return ce(this,function(w){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return t.grid.cells.data.length<=1?[2,is.createEmpty(i)]:(c=(o=t.grid.stats).max-(u=o.min),l=nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,d=(l-u)/c,f=kk.get(t,e.webgl),p=f.texture,m=f.gridDimension,h=f.gridTexDim,v=f.gridTexScale,g=f.transform,y=t.grid.cells.space.axisOrderSlowToFast,S=i?.doubleBuffer.get(),C=yD(e.webgl,p,m,h,v,g,d,l<0,!1,y,!0,S?.vertex,S?.group,S?.normal),_=t.grid.cells.data.length,x=nt.getBoundingSphere(t),(D=is.create(C.vertexCount,_,C.vertexTexture,C.groupTexture,C.normalTexture,x,i)).meta.webgl=e.webgl,[2,D])})})}function Ret(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:return e.runtime.update({message:"Marching cubes..."}),o=Bu(new Int32Array(t.grid.cells.data.length)),[4,Rk({isoLevel:nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Sr.create(t.grid.cells.space,Sr.Data1(o))},i).runAsChild(e.runtime)];case 1:return s=c.sent(),u=Ri.getGridToCartesianTransform(t.grid),na.transform(s,u),s.setBoundingSphere(nt.Isosurface.getBoundingSphere(t,a.isoValue)),[2,s]}})})}!function(e){var t="volume-isosurface-texture";e.descriptor=Hu({name:t}),e.get=function r(n,a){var i=a.resources,o=Ri.getGridToCartesianTransform(n.grid),s=b.clone(n.grid.cells.space.dimensions),u=Cm(s,tC),c=u.width,l=u.height,d=u.powerOfTwoSize,f=b.create(c,l,0),p=Be.create(c/d,l/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var m=n._propertyData[t];m.define(d,d),m.load(Fee(n,"data",tC),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return m.destroy()}}])}return s[0]+=tC,s[1]+=tC,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}}(kk||(kk={}));var Rae=R(R(R({},na.Params),Pae),{quality:R(R({},na.Params.quality),{isEssential:!1}),sizeFactor:T.Numeric(3,{min:0,max:10,step:.1})});function Oet(e){return Ov({defaultProps:T.getDefaultValues(Rae),createGeometry:Ret,createLocationIterator:function(t){return On(t.grid.cells.data.length,1,1,function(){return Uu})},getLoci:Fk,eachLocation:Bk,setUpdateState:function(t,r,n,a){nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:na.Utils},e)}var Oae={solid:function(e,t){return $2("Isosurface mesh",e,t,Det,Mae)},wireframe:function(e,t){return $2("Isosurface wireframe",e,t,Oet,Mae)}},Fae=R(R(R({},Nk),Rae),{visuals:T.MultiSelect(["solid"],T.objectToOptions(Oae)),bumpFrequency:T.Numeric(1,{min:0,max:10,step:.1},st.ShadingCategory)}),Net={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:function Bet(e,t){return lr.createMulti("Isosurface",e,t,lr.StateBuilder,Oae)},getParams:function Fet(e,t){var r=T.clone(Fae);return r.isoValue=nt.createIsoValueParam(nt.IsoValue.relative(2),t.grid.stats),r},defaultValues:T.getDefaultValues(Fae),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!nt.Segmentation.get(e)}};function ket(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j,U,H,z,G,J,X,Z,ne,Y,k,W;return ce(this,function(K){for((o=a.dimension.name,c=(u=t.grid.cells).space,l=u.data,f=(d=t.grid.stats).min,p=d.max,m=nt.IsoValue.toAbsolute(a.isoValue,t.grid.stats).absoluteValue,h="color"in n.color?n.color.color(Uu,!1):dt(16777215),v=dt.toRgbNormalized(h),g=v[0],y=v[1],S=v[2],C=Lk(t.grid,a),_=C.width,x=C.height,D=C.x,w=C.y,A=C.z,E=C.x0,I=C.y0,M=C.z0,F=C.nx,N=C.ny,j=C.nz,U=new Float32Array("x"===o?[D,0,0,D,w,0,D,0,A,D,w,A]:"y"===o?[0,w,0,D,w,0,0,w,A,D,w,A]:[0,0,A,0,w,A,D,0,A,D,w,A]),H=new Uint8Array(_*x*4),z=function Let(e,t){for(var r=e.cells.space,n=Lk(e,t),o=n.x0,s=n.y0,u=n.z0,c=n.nx,l=n.ny,d=n.nz,f=new Uint8Array(n.width*n.height*4),p=0,m=s;m<l;++m)for(var h=o;h<c;++h)for(var v=u;v<d;++v)GS(r.dataOffset(h,m,v),f,p),p+=4;return f}(t.grid,a),G=0,J=I);J<N;++J)for(X=E;X<F;++X)for(Z=M;Z<j;++Z)ne=c.get(l,X,J,Z),H[G]=g*(Y=(ne-f)/(p-f))*2*255,H[G+1]=y*Y*2*255,H[G+2]=S*Y*2*255,H[G+3]=ne>=m?255:0,G+=4;return k={width:_,height:x,array:H,flipY:!0},W={width:_,height:x,array:z,flipY:!0},Wh(Ri.getGridToCartesianTransform(t.grid),U,0,4),[2,qf.create(k,U,W,i)]})})}function Lk(e,t){var o,s,u,c,l,r=t.dimension,n=r.name,a=r.params,d=0,f=0,p=0,m=e.cells.space.dimensions,h=m[0],v=m[1],g=m[2];return"x"===n?(c=v-1,l=g-1,o=g,s=v,h=(d=u=a)+1):"y"===n?(u=h-1,l=g-1,o=g,s=h,v=(f=c=a)+1):(u=h-1,c=v-1,o=h,s=v,g=(p=l=a)+1),{width:o,height:s,x:u,y:c,z:l,x0:d,y0:f,z0:p,nx:h,ny:v,nz:g}}function Bae(e,t){var r=function Uet(e,t){for(var r=e.cells.space,n=Lk(e,t),o=n.x0,s=n.y0,u=n.z0,c=n.nx,l=n.ny,d=n.nz,f=new Uint32Array(n.width*n.height),p=0,m=s;m<l;++m)for(var h=o;h<c;++h)for(var v=u;v<d;++v)f[p]=r.dataOffset(h,m,v),p+=1;return f}(e.grid,t);return nt.Cell.Loci(e,Ye.ofUnsortedArray(r))}function Vet(e,t,r,n,a){var o=e.groupId;if(a===e.objectId){var s=nt.PickingGranularity.get(t);return"volume"===s?nt.Loci(t):"object"===s?Bae(t,n):nt.Cell.Loci(t,_e.ofSingleton(o))}return Wr}function Get(e,t,r,n,a){return CT(e,t,void 0,a)}var Uk=R(R({},qf.Params),{quality:R(R({},qf.Params.quality),{isEssential:!1}),dimension:T.MappedStatic("x",{x:T.Numeric(0,{min:0,max:0,step:1}),y:T.Numeric(0,{min:0,max:0,step:1}),z:T.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:nt.IsoValueParam});function Het(e){return Ov({defaultProps:T.getDefaultValues(Uk),createGeometry:ket,createLocationIterator:function(t){return On(t.grid.cells.data.length,1,1,function(){return Uu})},getLoci:Vet,eachLocation:Get,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!nt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!hu.areEqual(i.color,o.color)},geometryUtils:R(R({},qf.Utils),{createRenderableState:function(t){var r=qf.Utils.createRenderableState(t);return Nae(r,t),r},updateRenderableState:Nae})},e)}function Nae(e,t){qf.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}var qet={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:function jet(e,t){return $2("Slice",e,t,Het,Bae)},getParams:function zet(e,t){var r=T.clone(Uk),n=t.grid.cells.space.dimensions;return r.dimension=T.MappedStatic("x",{x:T.Numeric(0,{min:0,max:n[0]-1,step:1}),y:T.Numeric(0,{min:0,max:n[1]-1,step:1}),z:T.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=nt.createIsoValueParam(nt.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r},defaultValues:T.getDefaultValues(Uk),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!nt.Segmentation.get(e)}};function kae(e,t){var r=Nt();return Nt.add(r,e),Nt.transform(r,r,t),r}function Wet(e,t,r,n){var a=r.grid.cells.space.dimensions,i=Cm(a);if(Math.max(i.width,i.height)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=Fee(r,"normals"),c=Ri.getGridToCartesianTransform(r.grid),l=kae(a,c),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=Lae(r.grid);return ju.create(l,a,c,f.unitToCartn,f.cellDim,d,r.grid.stats,!1,r.grid.cells.space.axisOrderSlowToFast,n)}function Lae(e){if("matrix"===e.transform.kind)return{unitToCartn:he.mul(he(),e.transform.matrix,he.fromScaling(he(),e.cells.space.dimensions)),cellDim:he.getScaling(b(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Nt.size(b(),t);return{unitToCartn:he.mul3(he(),e.transform.cell.fromFractional,he.fromTranslation(he(),t.min),he.fromScaling(he(),r)),cellDim:b.div(b(),e.transform.cell.size,e.cells.space.dimensions)}}function Yet(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=function f9e(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,c=u[0],l=u[1],d=u[2],f=n.dataOffset,p=new Uint8Array(c*l*d*4),m={array:p,width:c,height:l,depth:d},h=o-s,v=b(),g=b(),y=c-1,S=l-1,C=d-1,_=0,x=0;x<d;++x)for(var D=0;D<l;++D)for(var w=0;w<c;++w){var A=f(w,D,x);bT(v,a[f(Math.max(0,w-1),D,x)],a[f(w,Math.max(0,D-1),x)],a[f(w,D,Math.max(0,x-1))]),bT(g,a[f(Math.min(y,w+1),D,x)],a[f(w,Math.min(S,D+1),x)],a[f(w,D,Math.min(C,x+1))]),Pee(v,Mee(v,v,g)),Ree(v,ST(v,v,.5),.5),Oee(ST(v,v,255),p,_),p[_+3]=Math.round((a[A]-s)/h*255),_+=4}return m}(r),o=Ri.getGridToCartesianTransform(r.grid),s=kae(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var c=Lae(r.grid);return ju.create(s,a,o,c.unitToCartn,c.cellDim,u,r.grid.stats,!1,r.grid.cells.space.axisOrderSlowToFast,n)}function Xet(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var s;return ce(this,function(u){if(void 0===(s=e.webgl))throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,s.isWebGL2?Yet(0,s,t,i):Wet(0,s,t,i)]})})}function Ket(e,t){return nt.Loci(e)}function Zet(e,t,r,n,a){return a===e.objectId?nt.Cell.Loci(t,_e.ofSingleton(e.groupId)):Wr}function Qet(e,t,r,n,a){return CT(e,t,void 0,a)}var Vk=R(R({},ju.Params),{quality:R(R({},ju.Params.quality),{isEssential:!1})});function Jet(e){return Ov({defaultProps:T.getDefaultValues(Vk),createGeometry:Xet,createLocationIterator:function(t){return On(t.grid.cells.data.length,1,1,function(){return Uu})},getLoci:Zet,eachLocation:Qet,setUpdateState:function(t,r,n,a){},geometryUtils:ju.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var ttt={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:function ett(e,t){return $2("Direct Volume",e,t,Jet,Ket)},getParams:function $et(e,t){var r=T.clone(Vk);return r.controlPoints.getVolume=function(){return t},r},defaultValues:T.getDefaultValues(Vk),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!nt.Segmentation.get(e)}},rtt={segments:T.Converted(function(e){return e.map(function(t){return"".concat(t)})},function(e){return e.map(function(t){return parseInt(t)})},T.MultiSelect(["0"],T.arrayToOptions(["0"]),{isEssential:!0}))},rC=1;function Gk(e,t){return!(e.grid.cells.data.length<Math.pow(10,3))&&Cm(e.grid.cells.space.dimensions,rC).powerOfTwoSize<=t.maxTextureSize/2}var att=he();function Uae(e,t){var r=Ri.getGridToCartesianTransform(e),n=he.fromTranslation(att,t.min);return he.mul(he(),r,n)}function itt(e,t,r,n,a){return n.tryUseGpu&&a&&function ntt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(a)&&Gk(t,a)?function ftt(e){return Ov({defaultProps:T.getDefaultValues(zk),createGeometry:dtt,createLocationIterator:function(t,r){var n=nt.Segment.Location(t,r);return On(t.grid.cells.data.length,1,1,function(){return n})},getLoci:Vae,eachLocation:Gae,setUpdateState:function(t,r,n,a){},geometryUtils:is.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Gk(t.volume,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}(e):function ctt(e){return Ov({defaultProps:T.getDefaultValues(zk),createGeometry:utt,createLocationIterator:function(t,r){var n=nt.Segment.Location(t,r);return On(t.grid.cells.data.length,1,1,function(){return n})},getLoci:Vae,eachLocation:Gae,setUpdateState:function(t,r,n,a){},geometryUtils:Vt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Gk(t.volume,n)}},e)}(e)}function ott(e,t){return nt.Segment.Loci(e,t.segments)}function Vae(e,t,r,n,a){var o=e.groupId;if(a===e.objectId){var s=nt.PickingGranularity.get(t);return"volume"===s?nt.Loci(t):"object"===s?nt.Segment.Loci(t,[r]):nt.Cell.Loci(t,_e.ofSingleton(o))}return Wr}function Gae(e,t,r,n,a){return CT(e,t,{segments:Ye.ofSingleton(r)},a)}function utt(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l,d,f;return ce(this,function(p){switch(p.label){case 0:if(!(o=nt.Segmentation.get(t)))throw new Error("missing volume segmentation");return e.runtime.update({message:"Marching cubes..."}),s=Nt.clone(o.bounds[r]),Nt.expand(s,s,b.create(2,2,2)),u=Array.from(o.segments.get(r).values()),c=function stt(e,t,r){for(var n=r.data,a=r.space.dataOffset,i=Nt.size(b(),t),o=i[0],s=i[1],u=i[2],c=o-1,l=s-1,d=u-1,f=t.min,p=f[0],m=f[1],h=f[2],v=t.max,g=v[0],y=v[1],S=v[2],C=or([],r.space.axisOrderSlowToFast,!0),_=Sr.Space(i,C,Uint8Array),x=Sr.create(_,_.create()),D=x.data,w=_.set,A=0;A<u;++A)for(var E=0;E<s;++E)for(var I=0;I<o;++I){var M=e.includes(n[a(I+p,E+m,A+h)])?255:0,F=e.includes(n[a(Math.min(c+g,I+1+p),E+m,A+h)])?255:0,N=e.includes(n[a(Math.max(0,I-1+p),E+m,A+h)])?255:0,j=e.includes(n[a(I+p,Math.min(l+y,E+1+m),A+h)])?255:0,U=e.includes(n[a(I+p,Math.max(0,E-1+m),A+h)])?255:0,H=e.includes(n[a(I+p,E+m,Math.min(d+S,A+1+h))])?255:0,z=e.includes(n[a(I+p,E+m,Math.max(0,A-1+h))])?255:0;w(D,I,E,A,Math.round((M+M+F+N+j+U+H+z)/8))}return x}(u,s,t.grid.cells),l=Bu(new Int32Array(c.data.length)),[4,By({isoLevel:128,scalarField:c,idField:Sr.create(c.space,Sr.Data1(l))},i).runAsChild(e.runtime)];case 1:return d=p.sent(),f=Uae(t.grid,s),Vt.transform(d,f),e.webgl&&!e.webgl.isWebGL2?(Vt.uniformTriangleGroup(d,!1),O.updateIfChanged(d.varyingGroup,!1)):O.updateIfChanged(d.varyingGroup,!0),d.setBoundingSphere(nt.Segment.getBoundingSphere(t,[r])),[2,d]}})})}var zk=R(R(R(R({},Vt.Params),is.Params),rtt),{quality:R(R({},Vt.Params.quality),{isEssential:!1}),tryUseGpu:T.Boolean(!0)}),Hk="segment-texture";function dtt(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m;return ce(this,function(g){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh");return t.grid.cells.data.length<=1?[2,is.createEmpty(i)]:(o=function ltt(e,t,r){var n=nt.Segmentation.get(e);if(!n)throw new Error("missing volume segmentation");var a=r.resources,i=Nt.clone(n.bounds[t]);Nt.expand(i,i,b.create(2,2,2));var o=Uae(e.grid,i),s=Nt.size(b(),i),u=Cm(s,rC),c=u.width,l=u.height,d=u.powerOfTwoSize,f=b.create(c,l,0),p=Be.create(c/d,l/d);if(d>r.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");r.namedTextures[Hk]||(r.namedTextures[Hk]=a.texture("image-uint8","alpha","ubyte","linear"));var m=r.namedTextures[Hk];m.define(d,d);var h=Array.from(n.segments.get(t).values());return m.load(function p9e(e,t,r,n){void 0===n&&(n=0);for(var a=e.grid.cells.data,i=Nt.size(b(),r),o=e.grid.cells.space.dataOffset,s=Cm(i,n),u=s.width,c=s.height,d=new Uint8Array(u*c*1),f={array:d,width:u,height:c},p=i[0],m=i[1],h=i[2],v=p-1,g=m-1,y=h-1,S=p+n,C=m+n,_=r.min,x=_[0],D=_[1],w=_[2],A=r.max,E=A[0],I=A[1],M=A[2],F=0;F<h;++F)for(var N=0;N<m;++N)for(var j=0;j<p;++j){var U=Math.floor(F*S%u/S),G=1*(Math.floor(F*S/u)*C*u+N*u+(U*S+j)),J=t.includes(a[o(j+x,N+D,F+w)])?255:0,X=t.includes(a[o(Math.min(v+E,j+1+x),N+D,F+w)])?255:0,Z=t.includes(a[o(Math.max(0,j-1+x),N+D,F+w)])?255:0,ne=t.includes(a[o(j+x,Math.min(g+I,N+1+D),F+w)])?255:0,Y=t.includes(a[o(j+x,Math.max(0,N-1+D),F+w)])?255:0,k=t.includes(a[o(j+x,N+D,Math.min(y+M,F+1+w))])?255:0,W=t.includes(a[o(j+x,N+D,Math.max(0,F-1+w))])?255:0;d[G]=Math.round((J+J+X+Z+ne+Y+k+W)/8)}return f}(e,h,i,rC),!0),s[0]+=rC,s[1]+=rC,{texture:m,transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}(t,r,e.webgl),s=o.texture,u=o.gridDimension,c=o.gridTexDim,l=o.gridTexScale,d=o.transform,f=t.grid.cells.space.axisOrderSlowToFast,p=i?.doubleBuffer.get(),m=yD(e.webgl,s,u,c,l,d,.5,!1,!1,f,!0,p?.vertex,p?.group,p?.normal),[2,is.create(m.vertexCount,t.grid.cells.data.length,m.vertexTexture,m.groupTexture,m.normalTexture,nt.Segment.getBoundingSphere(t,[r]),i)])})})}function ptt(e){return Ye.ofUnsortedArray(e.segments)}var zae={segment:function(e,t){return $2("Segment mesh",e,t,itt,ott,ptt)}},Hae=R(R({},zk),{visuals:T.MultiSelect(["segment"],T.objectToOptions(zae)),bumpFrequency:T.Numeric(1,{min:0,max:10,step:.1},st.ShadingCategory)}),vtt={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:function htt(e,t){return lr.createMulti("Segment",e,t,lr.StateBuilder,zae)},getParams:function mtt(e,t){var r=T.clone(Hae),n=nt.Segmentation.get(t);if(n){var a=Array.from(n.segments.keys());r.segments=T.Converted(function(i){return i.map(function(o){return"".concat(o)})},function(i){return i.map(function(o){return parseInt(o)})},T.MultiSelect(a.map(function(i){return"".concat(i)}),T.arrayToOptions(a.map(function(i){return"".concat(i)})),{isEssential:!0}))}return r},defaultValues:T.getDefaultValues(Hae),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!nt.isEmpty(e)&&!!nt.Segmentation.get(e)}},bD=function(e){function t(){var r=e.call(this)||this;return Fs(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return jt(t,e),t}(Uee);function jae(e,t,r,n){e.push({source:"em"===t?{name:"em",params:{isoValue:nt.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}!function(e){e.BuiltIn={isosurface:Net,slice:qet,"direct-volume":ttt,segment:vtt}}(bD||(bD={}));var gtt=Bs.build({display:{name:"Volume Streaming"},from:ve.Molecule.Structure,params:function(e,t){var r=function EJe(e,t){if(void 0===t&&(t="x-ray"),!e)return t;var r=e.models[0];return Dn.is(r.sourceData)?ar.hasEmMap(r)?"em":ar.hasXrayMap(r)?"x-ray":ar.isFromEm(r)?"em":ar.isFromXray(r)?"x-ray":t:t}(e&&e.data),n=function MJe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return function IJe(e){var t=[];if(!Dn.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)"EMDB"===a.value(o).toUpperCase()&&"associated EM volume"===i.value(o)&&t.push(n.value(o));return t}(r);case"x-ray":return function PJe(e){return[e.entryId]}(r)}}(r,e&&e.data);return{method:T.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:T.ObjectList({id:T.Text(n[0]||"")},function(a){return a.id},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:T.Select("em"===r?"auto":"selection-box",tc.ViewTypeOptions),options:T.Group({serverUrl:T.Text(t.config.get(pa.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:T.Text("",{isHidden:!0}),emContourProvider:T.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:T.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(pa.VolumeStreaming.CanStream);return n?n(e.data,r):1===e.data.models.length&&ar.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return Ve.create("Volume Streaming",function(i){return ue(void 0,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x;return ce(this,function(D){switch(D.label){case 0:o=[],s=0,u=a.entries.length,D.label=1;case 1:return s<u?(c=a.entries[s].id.toLowerCase(),l=void 0,"em"!==a.method?[3,14]:c.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return D.sent(),[4,FJe(t,i,c)];case 3:d=D.sent(),f=0,p=d.length,D.label=4;case 4:if(!(f<p))return[3,10];m=d[f],h=void 0,D.label=5;case 5:return D.trys.push([5,7,,8]),[4,xae(a.options.emContourProvider,t,i,m)];case 6:return h=D.sent(),[3,8];case 7:return v=D.sent(),console.info("Could not get map info for ".concat(m,": ").concat(v)),[3,9];case 8:jae(o,a.method,m,h||0),D.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return D.trys.push([11,13,,14]),[4,xae(a.options.emContourProvider,t,i,c)];case 12:return l=D.sent(),[3,14];case 13:return g=D.sent(),console.info("Could not get map info for ".concat(c,": ").concat(g)),[3,15];case 14:jae(o,a.method,c,l||0),D.label=15;case 15:return++s,[3,1];case 16:return[4,(y=n.build().to(r).applyOrUpdateTagged(tc.RootTag,Stt,{serverUrl:a.options.serverUrl,entries:o})).commit()];case 17:return D.sent(),(S=y.selector).isOk?(C=n.tree.children.get(S.ref),C?.size>0?[4,t.managers.structure.hierarchy.remove(C?.toArray())]:[3,19]):[2];case 18:D.sent(),D.label=19;case 19:return _=S.cell.obj,x=n.build().to(y.ref).apply(qae,T.getDefaultValues(tc.createParams({data:_.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),"em"===a.method?x.apply(SD,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(x.apply(SD,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),x.apply(SD,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),x.apply(SD,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(x).runInContext(i)];case 20:return D.sent(),[2]}})})})}),ytt=Bs.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:tc,isApplicable:function(e){return"selection-box"===e.data.params.entry.params.view.name}})(function(e,t){var n=e.ref,a=e.state,i=e.a.data.params;if("selection-box"===i.entry.params.view.name){var o=Nt.create(b.clone(i.entry.params.view.params.bottomLeft),b.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Nt.expand(o,o,b.create(s,s,s));var u=R(R({},i),{entry:{name:i.entry.name,params:R(R({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),btt={dataId:T.Text(""),source:T.MappedStatic("x-ray",{em:T.Group({isoValue:nt.createIsoValueParam(nt.IsoValue.relative(1))}),"x-ray":T.Group({})})},Stt=Bt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ve.Molecule.Structure,to:Ik,params:function(e){return{serverUrl:T.Text("https://ds.litemol.org"),entries:T.ObjectList(btt,function(t){return t.dataId},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return Ve.create("",function(a){return ue(void 0,void 0,void 0,function(){var i,o,s,u,c,l,d;return ce(this,function(p){switch(p.label){case 0:i=[],o=0,s=n.entries.length,p.label=1;case 1:return o<s?(c=(u=n.entries[o]).dataId,l="em"===u.source.name?u.source.params.isoValue:nt.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return p.sent(),[4,t.fetch({url:PN(n.serverUrl,"".concat(u.source.name,"/").concat(c.toLocaleLowerCase())),type:"json"}).runInContext(a)];case 3:d=p.sent(),i.push({dataId:c,kind:u.source.name,header:d,emDefaultContourLevel:l}),p.label=4;case 4:return++o,[3,1];case 5:return[2,new Ik({serverUrl:n.serverUrl,entries:i,structure:r.data},{label:"Volume Server",description:"".concat(i.map(function(m){return m.dataId}).join(", "))})]}})})})}}),qae=Bt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:Ik,to:tc,params:function(e){return tc.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var r=e.newParams;return e.oldParams.entry.params.view===r.entry.params.view||"selection-box"===r.entry.params.view.name||"camera-target"===r.entry.params.view.name||"off"===r.entry.params.view.name},apply:function(e,t){var r=e.a,n=e.params;return Ve.create("Volume streaming",function(a){return ue(void 0,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return[4,(i=new tc.Behavior(t,r.data)).update(n)];case 1:return o.sent(),[2,new tc(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this,n=e.b,a=e.oldParams,i=e.newParams;return Ve.create("Update Volume Streaming",function(o){return ue(t,void 0,void 0,function(){var s,u;return ce(this,function(c){switch(c.label){case 0:return a.entry.name!==i.entry.name&&"em"in i.entry.params.channels&&(s=n.data.infoMap.get(i.entry.name).emDefaultContourLevel)&&(i.entry.params.channels.em.isoValue=s),[4,n.data.update(i)];case 1:return u=c.sent()?rt.UpdateResult.Updated:rt.UpdateResult.Unchanged,n.description=n.data.getDescription(),[2,u]}})})})}}),SD=Bt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:tc,to:ve.Volume.Representation3D,params:{channel:T.Select("em",tc.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return Ve.create("Volume Representation",function(i){return ue(void 0,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return(o=r.data.channels[n.channel])?(s=Wae(r.data,n.channel),c=s.type.params||{},(l=(u=bD.BuiltIn.isosurface).factory(R({webgl:null===(p=t.canvas3d)||void 0===p?void 0:p.webgl},t.representation.volume.themes),u.getParams)).setTheme(_i.create(t.representation.volume.themes,{volume:o.data},s)),d=null===(m=a.getAncestorOfType(ve.Molecule.Structure))||void 0===m?void 0:m.data,f=0===d?.models.length?void 0:ov.get(d?.models[0]),[4,l.createOrUpdate(c,o.data).runInContext(i)]):[2,Jn.Null];case 1:return h.sent(),f&&l.setState({transform:f}),[2,new ve.Volume.Representation3D({repr:l,sourceData:o.data},{label:"".concat(Math.round(100*o.isoValue.relativeValue)/100," \u03c3 [").concat(n.channel,"]")})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return Ve.create("Volume Representation",function(o){return ue(void 0,void 0,void 0,function(){var s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return(s=r.data.channels[a.channel])?(u=n.data.repr.state.visible,c=Wae(r.data,a.channel),l=R(R({},n.data.repr.props),c.type.params),n.data.repr.setTheme(_i.create(t.representation.volume.themes,{volume:s.data},c)),[4,n.data.repr.createOrUpdate(l,s.data).runInContext(o)]):[2,rt.UpdateResult.Unchanged];case 1:return d.sent(),n.data.repr.setState({visible:u}),n.data.sourceData=s.data,[2,rt.UpdateResult.Updated]}})})})}});function Wae(e,t){var r=e.channels[t];return Bd.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var ir,xD,Ctt=lf.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:T.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x;return ce(this,function(D){switch(D.label){case 0:if((n=r.plugin.managers.snapshot.state.entries).size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,(o=Math.ceil(t.current/r.params.transtionDurationInMs))===i&&o++,o%=n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(c=s.data.tree.transforms,l=u.data.tree.transforms,f=(d=r.plugin.state.data).build(),p=0,m=c;p<m.length;p++)for(h=m[p],v=0,g=l;v<g.length;v++)(y=g[v]).ref===h.ref&&y.version!==h.version&&(S=on.fromJSON(h),C=on.fromJSON(y),(_=d.cells.get(h.ref))&&(void 0,x=S.transformer.definition.interpolate?S.transformer.definition.interpolate(S.params,C.params,a,r.plugin):a<=.5?S.params:C.params,R1(_,x)||f.to(h.ref).update(x)));return[4,yr.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return D.sent(),[2,{kind:"next",state:{}}]}})})}}),xtt=lf.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:T.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ce(this,function(d){for(a=(n=r.state.data).select(xr.Generators.ofType(ve.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)!(n.select(xr.Generators.ofTransformer(et.Representation.SpinStructureRepresentation3D,(c=u[s]).transform.ref)).length>0)&&(o=!0,i.to(c.transform.ref).apply(et.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(xr.Generators.ofType(ve.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(0!==a.length){for(var i=n.build(),o=0,s=a;o<s.length;o++)i.delete(s[o].transform.ref);return i.commit()}},apply:function(e,t,r){var n;return ue(this,void 0,void 0,function(){var a,i,o,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:if(0===(i=(a=r.plugin.state.data).select(xr.Generators.ofTransformer(et.Representation.SpinStructureRepresentation3D))).length)return[2,{kind:"finished"}];for(o=a.build(),u=(e.t+(t.current-t.lastApplied)/r.params.durationInMs)%1,c=0,l=i;c<l.length;c++)o.to(d=l[c]).update(R(R({},null===(n=d.params)||void 0===n?void 0:n.values),{t:u}));return[4,yr.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),CD=b(),Yae=b(),Xae=hn(),_tt=lf.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:T.Numeric(4e3,{min:100,max:2e4,step:100}),speed:T.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:T.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}},initialState:function(e,t){return{snapshot:t.canvas3d.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;null===(n=r.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ue(this,void 0,void 0,function(){var i,o,s,u;return ce(this,function(c){return 0===t.current?[2,{kind:"next",state:e}]:(i=e.snapshot).radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?(null===(n=t.animation)||void 0===n?void 0:n.currentFrame)/(t.animation.frameCount+1):Xi(t.current/r.params.durationInMs,0,1),s=Math.sin(o*r.params.speed*Math.PI*2)*Yr(r.params.angle),b.sub(CD,i.position,i.target),b.normalize(Yae,i.up),hn.setAxisAngle(Xae,Yae,s),b.transformQuat(CD,CD,Xae),u=b.add(b(),i.target,CD),null===(a=r.plugin.canvas3d)||void 0===a||a.requestCameraReset({snapshot:R(R({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}])})})}});!function(e){e.Action=function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}},e.Behavior=function r(n,a){return void 0===a&&(a={}),{transformer:n,defaultParams:a}}}(ir||(ir={})),function(e){var t=function(){function r(){this.providers=vc().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var c=u.value;c.isApplicable(n)&&(c.isHidden||(i.push([c.descriptor.name,c.label]),this.defaultAutoAttachValues.get(c.descriptor.name)&&o.push(c.descriptor.name)),a[c.descriptor.name]=T.Group(R({},c.getParams(n)),{label:c.label,isHidden:c.isHidden}))}return{autoAttach:T.MultiSelect(o,i),properties:T.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){if(!this.providers.get(n))throw new Error("Custom property '".concat(n,"' is not registered."));return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t}(xD||(xD={}));var Ttt=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){return this.dataState.build().toRoot().apply(wY,t,r).commit({revertOnError:!0})},e.prototype.download=function(t,r){return this.dataState.build().toRoot().apply(xY,t,r).commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){return this.dataState.build().toRoot().apply(_Y,t,r).commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n,a,i;return ue(this,void 0,void 0,function(){var o,s;return ce(this,function(u){switch(u.label){case 0:return[4,this.dataState.build().toRoot().apply(AY,t,r).commit({revertOnError:!0})];case 1:return o=u.sent(),s=Ry(null!==(i=null===(a=null===(n=t.file)||void 0===n?void 0:n.file)||void 0===a?void 0:a.name)&&void 0!==i?i:""),[2,{data:o,fileInfo:s}]}})})},e}(),Dtt=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=Gd.auto,Fs(Gd,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return"string"==typeof t?null!==(r=Gd[t])&&void 0!==r?r:wO(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return T.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?T.Group(o.params(t,this.plugin)):T.EmptyGroup())}return 0===r.length?T.MappedStatic("",{"":T.EmptyGroup()}):T.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),gS(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i,a=this,o=this.resolveProvider(r);if(o){var u=mo.resolveAndCheck(this.plugin.state.data,t);if(!u)return void(uS||console.warn("Applying structure repr. provider to bad cell."));var c=(null===(i=o.params)||void 0===i?void 0:i.call(o,u.obj,this.plugin))||{},l=n||(o.params?T.getDefaultValues(c):{}),d=this.plugin.config.get(pa.Structure.DefaultRepresentationPresetParams);l=T.merge(c,d,l);var f=Ve.create("".concat(o.display.name),function(){return o.apply(u,l,a.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return ue(this,void 0,void 0,function(){var a,i;return ce(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),(i=this.buildRepresentation(a,t,r,n))?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(r){var s=null===(o=null===(i=mo.resolveAndCheck(this.dataState,r))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data;if(s){var u=dD(this.plugin,s,n);return a?.tag?t.to(r).applyOrUpdateTagged(a.tag,BT,u,{state:a?.initialState}).selector:t.to(r).apply(BT,u,{state:a?.initialState}).selector}}},e}();function Um(e){return e}!function(e){e.CommonParams=function(t,r){return{modelProperties:T.Optional(T.Group(rt.getParamDefinition(et.Model.CustomModelProperties,void 0,r))),structureProperties:T.Optional(T.Group(rt.getParamDefinition(et.Model.CustomStructureProperties,void 0,r))),representationPreset:T.Optional(T.Text("auto"))}}}(Um||(Um={}));var _D=Um.CommonParams,Kae=Um({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:function(e,t){return R({model:T.Optional(T.Group(rt.getParamDefinition(et.Model.ModelFromTrajectory,e,t))),showUnitcell:T.Optional(T.Boolean(!1)),structure:T.Optional(dv.getParams(void 0,"assembly").type),representationPresetParams:T.Optional(T.Group(hs.CommonParams))},_D(e,t))},apply:function(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return[4,(n=r.builders.structure).createModel(e,t.model)];case 1:return a=f.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=f.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=f.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=f.sent(),void 0===t.showUnitcell||t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return c=f.sent(),[3,7];case 6:c=void 0,f.label=7;case 7:return u=c,l=t.representationPreset||r.config.get(pa.Structure.DefaultRepresentationPreset)||Gd.auto.id,[4,r.builders.structure.representation.applyPreset(s,l,t.representationPresetParams)];case 8:return d=f.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:d}]}})})}}),Ptt=Um({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:function(e){return e.data.frameCount>1},params:function(e,t){return R({useDefaultIfSingleModel:T.Optional(T.Boolean(!1)),representationPresetParams:T.Optional(T.Group(hs.CommonParams))},_D(e,t))},apply:function(e,t,r){var n,a;return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,h;return ce(this,function(v){switch(v.label){case 0:if(!(i=null===(a=null===(n=mo.resolveAndCheck(r.state.data,e))||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data))return[2,{}];if(1===i.frameCount&&t.useDefaultIfSingleModel)return[2,Kae.apply(e,t,r)];o=r.builders.structure,s=[],u=[],c=0,v.label=1;case 1:return c<i.frameCount?[4,o.createModel(e,{modelIndex:c})]:[3,8];case 2:return l=v.sent(),[4,o.insertModelProperties(l,t.modelProperties,{isCollapsed:!0})];case 3:return d=v.sent(),[4,o.createStructure(d||l,{name:"model",params:{}})];case 4:return f=v.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return p=v.sent(),s.push(l),u.push(f),m=f.obj?Iee(f.obj.data,{elementCountFactor:i.frameCount}):"medium",h=t.representationPreset||r.config.get(pa.Structure.DefaultRepresentationPreset)||Gd.auto.id,[4,o.representation.applyPreset(p,h,{theme:{globalName:"trajectory-index"},quality:m})];case 6:v.sent(),v.label=7;case 7:return c++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),Zae=function(e,t){return R({model:T.Optional(T.Group(rt.getParamDefinition(et.Model.ModelFromTrajectory,e,t)))},_D(e,t))};function Qae(e,t,r,n){return ue(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return[4,(a=n.builders.structure).createModel(t,r.model)];case 1:return i=f.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=f.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=f.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=f.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return c=f.sent(),l=r.representationPreset||n.config.get(pa.Structure.DefaultRepresentationPreset)||Gd.auto.id,[4,n.builders.structure.representation.applyPreset(u,l,{theme:{globalName:e.theme}})];case 6:return d=f.sent(),[2,{model:i,modelProperties:o,unitcell:c,structure:s,structureProperties:u,representation:d}]}})})}var qk,wD,Mtt=Um({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return ar.hasCrystalSymmetry(e.data.representative)},params:Zae,apply:function(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,Qae({ijkMin:b.create(0,0,0),ijkMax:b.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),Rtt=Um({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return ar.hasCrystalSymmetry(e.data.representative)},params:Zae,apply:function(e,t,r){return ue(this,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,Qae({ijkMin:b.create(-1,-1,-1),ijkMax:b.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),Ftt=Um({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212b, i.e., symmetry mates."},isApplicable:function(e){return ar.hasCrystalSymmetry(e.data.representative)},params:function(e,t){return R({model:T.Optional(T.Group(rt.getParamDefinition(et.Model.ModelFromTrajectory,e,t)))},_D(e,t))},apply:function(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return[4,(n=r.builders.structure).createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=d.sent(),c=t.representationPreset||r.config.get(pa.Structure.DefaultRepresentationPreset)||Gd.auto.id,[4,r.builders.structure.representation.applyPreset(s,c,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:qB.defaultValues}}}}})];case 6:return l=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),jk={default:Kae,"all-models":Ptt,unitcell:Mtt,supercell:Rtt,crystalContacts:Ftt},Btt=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=jk.default,Fs(jk,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return"string"==typeof t?null!==(r=jk[t])&&void 0!==r?r:wO(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return T.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?T.Group(o.params(t,this.plugin)):T.EmptyGroup())}return 0===r.length?T.MappedStatic("",{"":T.EmptyGroup()}):T.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),gS(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(i){var s=mo.resolveAndCheck(this.plugin.state.data,t);if(!s)return void(uS||console.warn("Applying hierarchy preset provider to bad cell."));var u=n||(i.params?T.getDefaultValues(i.params(s.obj,this.plugin)):{}),c=Ve.create("".concat(i.display.name),function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(c)}},e}(),Ntt=function(){function e(t){this.plugin=t,this.hierarchy=new Btt(this.plugin),this.representation=new Dtt(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ue(this,void 0,void 0,function(){var n;return ce(this,function(i){switch(i.label){case 0:if(!(n="string"==typeof r?this.plugin.dataFormats.get(r):r))throw new Error("'".concat(r,"' is not a supported data format."));return[4,n.parse(this.plugin,t)];case 1:return[2,i.sent().trajectory]}})})},e.prototype.parseTrajectoryBlob=function(t,r){return this.dataState.build().to(t).apply(et.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(et.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=mo.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ve.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){return this.dataState.build().to(t).apply(et.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n}).commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){return this.dataState.build().to(t).apply(et.Model.CustomModelProperties,r,{state:n}).commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=null===(i=null===(a=mo.resolveAndCheck(s,t))||void 0===a?void 0:a.obj)||void 0===i?void 0:i.data;if(u){var c=null===(o=Ja.Provider.get(u))||void 0===o?void 0:o.spacegroup.cell;if(!ns.isZero(c))return s.build().to(t).apply(et.Representation.ModelUnitcell3D,r,{state:n}).commit({revertOnError:!0})}},e.prototype.createStructure=function(t,r,n,a){var i,o=this.dataState;if(!r){var s=mo.resolveAndCheck(o,t);if(s){var u=Ja.Provider.get(null===(i=s.obj)||void 0===i?void 0:i.data);(!u||0===u?.assemblies.length)&&(r={name:"model",params:{}})}}return o.build().to(t).apply(et.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n,tags:a}).commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){return this.dataState.build().to(t).apply(et.Model.CustomStructureProperties,r).commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===et.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return ue(this,void 0,void 0,function(){var s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return u=(s=this.dataState).build().to(t),c="structure-component-".concat(n),[4,(l=u.applyOrUpdateTagged(c,et.Model.StructureComponent,r,{tags:a?or(or([],a,!0),[c],!1):[c]})).commit()];case 1:return f.sent(),(d=l.selector).isOk&&0!==(null===(o=null===(i=d.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.elementCount)?[3,3]:[4,s.build().delete(d.ref).commit()];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:(a?.label||"").trim()},n,a?.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:(n?.label||"").trim()},"static-".concat(r),n?.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(Ve.create("Query Component",function(o){return ue(i,void 0,void 0,function(){var s,u,c,l,d,f,p,m,h,v,g,y;return ce(this,function(S){switch(S.label){case 0:return c=(s=a||{}).tags,u=((u=s.label)||"").trim(),(l=null===(y=null===(g=mo.resolveAndCheck(this.dataState,t))||void 0===g?void 0:g.obj)||void 0===y?void 0:y.data)?r.referencesCurrent?(h={},v={name:"bundle"},m=(p=rn).fromSelection,[4,r.getSelection(this.plugin,o,l)]):[3,2]:[2];case 1:return h.type=(v.params=m.apply(p,[S.sent()]),v),h.nullIfEmpty=!0,h.label=u||r.label,f=h,[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},S.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},l)]:[3,5];case 4:S.sent(),S.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,c)]}})})}))},e}();function nC(e,t,r){return void 0===r&&(r={}),"string"==typeof r.type||"string"==typeof r.color||"string"==typeof r.size?function ktt(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return $ae(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}(e,t||nt.One,r):$ae(e,t||nt.One,r)}function $ae(e,t,r){void 0===r&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=T.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=T.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);var l=Object.assign(c,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=T.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:l},sizeTheme:{name:d.name,params:p}}}!function(e){e.create=function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}}(qk||(qk={})),function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=qk.create(e.Descriptor)}(wD||(wD={}));var Ny="Volume";function aC(e,t){return ue(this,void 0,void 0,function(){var r,n=this;return ce(this,function(a){return t&&(r=t.entryId)&&r.toLowerCase().startsWith("emd")?[2,e.runTask(Ve.create("Try Set Recommended IsoValue",function(i){return ue(n,void 0,void 0,function(){var o,s;return ce(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,_ae(e,i,r)];case 1:return o=u.sent(),wD.Provider.set(t,nt.IsoValue.absolute(o)),[3,3];case 2:return s=u.sent(),console.warn(s),[3,3];case 3:return[2]}})})}))]:[2]})})}function Jae(e){var t=wD.Provider.get(e);if(t)return"relative"===t.kind?t:nt.adjustedIsoValue(e,t.absoluteValue,"absolute")}function Wk(e,t){return ue(this,void 0,void 0,function(){var r,n;return ce(this,function(i){switch(i.label){case 0:return r={},(n=t.volume.data&&Jae(t.volume.data))&&(r.isoValue=n),[4,e.build().to(t.volume).apply(et.Representation.VolumeRepresentation3D,nC(e,t.volume.data,{type:"isosurface",typeParams:r})).commit()];case 1:return[2,[i.sent()]]}})})}var Ltt={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:Ny,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(et.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(et.Volume.VolumeFromCcp4,{entryId:r?.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,aC(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:Wk},Utt={label:"DSN6/BRIX",description:"DSN6/BRIX",category:Ny,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(et.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(et.Volume.VolumeFromDsn6,{entryId:r?.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,aC(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:Wk},Vtt={label:"DX",description:"DX",category:Ny,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(et.Data.ParseDx,{},{state:{isGhost:!0}}),[4,(a=n.apply(et.Volume.VolumeFromDx,{entryId:r?.entryId})).commit({revertOnError:!0})];case 1:return i.sent(),[4,aC(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:Wk},Gtt={label:"Cube",description:"Cube",category:Ny,stringExtensions:["cub","cube"],parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a,i;return ce(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(et.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(et.Volume.VolumeFromCube,{entryId:r?.entryId}),i=n.apply(et.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(et.Model.ModelFromTrajectory).apply(et.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,aC(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],(a=null===(d=null===(l=t.volume.cell)||void 0===l?void 0:l.obj)||void 0===d?void 0:d.data)&&nt.isOrbitals(a)?(i=r.to(t.volume).apply(et.Representation.VolumeRepresentation3D,nC(e,a,{type:"isosurface",typeParams:{isoValue:nt.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:vr.blue}})),o=r.to(t.volume).apply(et.Representation.VolumeRepresentation3D,nC(e,a,{type:"isosurface",typeParams:{isoValue:nt.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:vr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(et.Representation.VolumeRepresentation3D,nC(e,a,{type:"isosurface",typeParams:{isoValue:nt.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:vr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),c=[],Fs(u?.representations,function(p){p&&c.push(p)}),[2,or(or([],n,!0),c,!0)]}})})}},ztt={label:"DensityServer CIF",description:"DensityServer CIF",category:Ny,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return"dscif"===pD(e,t)},parse:function(e,t,r){return ue(void 0,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d,f,p,h;return ce(this,function(v){switch(v.label){case 0:return[4,e.build().to(t).apply(et.Data.ParseCif).commit()];case 1:if(n=v.sent(),a=e.build().to(n),0===(i=n.obj.data.blocks).length)throw new Error("no data blocks");for(o=[],s=0,u=0,c=i;u<c.length;u++)"SERVER"!==(l=c[u]).header.toUpperCase()&&(d=Array.isArray(r?.entryId)?r?.entryId[s]:r?.entryId,(null===(h=l.categories.volume_data_3d_info)||void 0===h?void 0:h.rowCount)>0&&(o.push(a.apply(et.Volume.VolumeFromDensityServerCif,{blockHeader:l.header,entryId:d}).selector),s++));return[4,a.commit()];case 2:v.sent(),f=0,p=o,v.label=3;case 3:return f<p.length?[4,aC(e,p[f].data)]:[3,6];case 4:v.sent(),v.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return ce(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&Jae(r[0].data)||nt.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(et.Representation.VolumeRepresentation3D,Bd.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:vr.teal})).selector),r.length>1&&(o=Bd.getDefaultParamsStatic(e,"isosurface",{isoValue:nt.IsoValue.relative(3),alpha:.3},"uniform",{value:vr.green}),s=Bd.getDefaultParamsStatic(e,"isosurface",{isoValue:nt.IsoValue.relative(-3),alpha:.3},"uniform",{value:vr.red}),a[a.length]=n.to(r[1]).apply(et.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(et.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}},Htt={label:"Segmentation CIF",description:"Segmentation CIF",category:Ny,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return"segcif"===pD(e,t)},parse:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,c;return ce(this,function(l){switch(l.label){case 0:return[4,e.build().to(t).apply(et.Data.ParseCif).commit()];case 1:if(r=l.sent(),n=e.build().to(r),0===(a=r.obj.data.blocks).length)throw new Error("no data blocks");for(i=[],o=0,s=a;o<s.length;o++)"SERVER"!==(u=s[o]).header.toUpperCase()&&(null===(c=u.categories.volume_data_3d_info)||void 0===c?void 0:c.rowCount)>0&&i.push(n.apply(et.Volume.VolumeFromSegmentationCif,{blockHeader:u.header}).selector);return[4,n.commit()];case 2:return l.sent(),[2,{volumes:i}]}})})},visuals:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n,a;return ce(this,function(o){switch(o.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&nt.Segmentation.get(r[0].data)&&(a[a.length]=n.to(r[0]).apply(et.Representation.VolumeRepresentation3D,Bd.getDefaultParams(e,"segment",r[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),[4,n.commit()];case 1:return o.sent(),[2,a]}})})}},jtt=[["ccp4",Ltt],["dsn6",Utt],["cube",Gtt],["dx",Vtt],["dscif",ztt],["segcif",Htt]],Wtt={label:"PLY",description:"PLY",category:"Shape",stringExtensions:["ply"],parse:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n;return ce(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(et.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(et.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){return e.state.data.build().to(t.shape).apply(et.Representation.ShapeRepresentation3D).commit()}},Ytt=[["ply",Wtt]],Xtt=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=jtt;t<r.length;t++){var n=r[t];this.add(n[0],n[1])}for(var o=0,s=lJe;o<s.length;o++){var u=s[o];this.add(u[0],u[1])}for(var c=0,l=hJe;c<l.length;c++){var d=l[c];this.add(d[0],d[1])}for(var f=0,p=Ytt;f<p.length;f++){var m=p[f];this.add(m[0],m[1])}for(var h=0,v=gae;h<v.length;h++){var g=v[h];this.add(g[0],g[1])}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;null===(n=i.stringExtensions)||void 0===n||n.forEach(function(o){return t.add(o)}),null===(a=i.binaryExtensions)||void 0===a||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n;return null===(n=r.provider.binaryExtensions)||void 0===n?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var a=r.provider;return t.push([r.name,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n,a,i=0,o=this.list.length;i<o;++i){var s=this._list[i].provider,u=!1;if((!(null===(n=s.binaryExtensions)||void 0===n)&&n.includes(t.ext)||!(null===(a=s.stringExtensions)||void 0===a)&&a.includes(t.ext))&&(u=!0),u&&(!s.isApplicable||s.isApplicable(t,r.data)))return s}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '".concat(t,"'"))},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),Ktt=function(e){function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return jt(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._animations.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next(void 0)},t.prototype.triggerApply=function(){this.events.applied.next(void 0)},t.prototype.getParams=function(){return this._params||(this._params={current:T.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:R(R({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:T.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=R(R({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){this.map.has(r.name)?this.context.log.error("Animation '".concat(r.name,"' is already registered.")):(this._params=void 0,this.map.set(r.name,r),this._animations.push(r),1===this._animations.length?this.updateParams({current:r.name}):this.triggerUpdate())},t.prototype.play=function(r,n){return ue(this,void 0,void 0,function(){return ce(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n,a){return ue(this,void 0,void 0,function(){return ce(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n||a?[4,this.applyFrame(a)]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ue(this,void 0,void 0,function(){var r,n,a;return ce(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:(a=i.sent())&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ue(this,void 0,void 0,function(){var r;return ce(this,function(n){switch(n.label){case 0:return this.isStopped=!0,"stopped"===this.state.animationState?[3,3]:(r=this._current.anim).teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return"playing"===this.state.animationState},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ue(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(r){return ue(this,void 0,void 0,function(){var n,a;return ce(this,function(i){switch(i.label){case 0:return n=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=n),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:n-this._current.startedTime,animation:r},{params:this._current.paramValues,plugin:this.context})];case 1:return"finished"===(a=i.sent()).kind?this.stop():"next"===a.kind&&(this._current.state=a.state,this._current.lastTime=n-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),"playing"===this.state.animationState&&this.resume()))},t.prototype.resume=function(){return ue(this,void 0,void 0,function(){var r;return ce(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(lp);function eie(e,t,r){var n=r[0],a=r[1],i=r[2];return(n*e[0]+a*e[1]+i*e[2]+(-n*t[0]-a*t[1]-i*t[2]))/Math.sqrt(n*n+a*a+i*i)}var zd={identity:Qt.create(1,0,0,0,1,0,0,0,1),rotX90:Qt.create(1,0,0,0,0,1,0,-1,0),rotY90:Qt.create(0,0,-1,0,1,0,1,0,0),rotZ90:Qt.create(0,1,0,-1,0,0,0,0,1),rotX270:Qt.create(1,0,0,0,0,-1,0,1,0),rotY270:Qt.create(0,0,1,0,1,0,-1,0,0),rotZ270:Qt.create(0,-1,0,1,0,0,0,0,1),rotX180:Qt.create(1,0,0,0,-1,0,0,0,-1),rotY180:Qt.create(-1,0,0,0,1,0,0,0,-1),rotZ180:Qt.create(-1,0,0,0,-1,0,0,0,1)};function Yk(e,t){for(var r=t.onlyTrace,n=t.skipHydrogens,a=t.skipWater,i=ot.atom,o=i.x,s=i.y,u=i.z,c=i.type_symbol,l=i.label_comp_id,d=[],f=0,p=e;f<p.length;f++)for(var m=p[f],h=at.create(m),v=0,g=m.units;v<g.length;v++){var y=g[v];h.unit=y;for(var S=r?y.polymerElements:y.elements,C=0;C<S.length;C++)h.element=S[C],(!n||"H"!==c(h))&&(a&&"HOH"===l(h)||d.push(o(h),s(h),u(h)))}return d}function ort(e,t){var r=Math.floor(t/2);return e<r?t%2?r-e:r-e-1:e-r}function tie(e,t){var r=Qt.invert(Qt(),t),n=b.distance(e.position,e.target),a=b.transformMat3(b(),b.create(0,0,n),r),i=b.transformMat3(b(),b.create(0,1,0),r),o=b.add(b(),e.target,a);return R(R({},e),{position:o,up:i})}var crt={minRadius:5,extraRadius:4,durationMs:250},lrt=function(){function e(t){this.plugin=t,this.boundaryHelper=new Lu("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Re.is(t)){var a=null===(n=null===(r=this.plugin.helpers.substructureParent.get(t.structure))||void 0===r?void 0:r.obj)||void 0===n?void 0:n.data;a&&(t=Re.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(t){for(var n=[],a=0,i=t;a<i.length;a++){var s=i[a].values.boundingSphere.ref.value;0!==s.radius&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++)(u=fr.getBoundingSphere(this.transformedLoci(o[i])))&&a.push(u);if(0===a.length)return;this.boundaryHelper.reset();for(var c=0,l=a;c<l.length;c++)this.boundaryHelper.includeSphere(u=l[c]);this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u;this.boundaryHelper.radiusSphere(u=f[d])}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(0===t.length)return;n=fr.getBoundingSphere(this.transformedLoci(t[0]))}else n=fr.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++)(u=r(o[i]))&&a.push(u);if(0!==a.length){if(1===a.length)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var c=0,l=a;c<l.length;c++)this.boundaryHelper.includeSphere(u=l[c]);this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u;this.boundaryHelper.radiusSphere(u=f[d])}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a=this.plugin.canvas3d;if(a){var i=R(R({},crt),r),u=i.durationMs,c=Math.max(t.radius+i.extraRadius,i.minRadius);if(r?.principalAxes){var l=function Jtt(e,t,r){if(e.canvas3d){var n=r.principalAxes.boxAxes,a=n.origin,o=n.dirB,s=n.dirC,u=b.clone(n.dirA),c=b.clone(s);if(r.positionToFlip){var l=function Qtt(e,t,r,n){var a=eie(e,t,n);return{aroundX:eie(e,t,r)<0,aroundY:a<0}}(r.positionToFlip,a,u,o),f=l.aroundY;l.aroundX&&(b.negate(c,c),b.negate(u,u)),f&&b.negate(c,c)}var p=b.scale(b(),a,-100);return b.dot(p,u)<=0&&b.negate(c,c),b.dot(b.unitY,c)<=0&&b.negate(u,u),e.canvas3d.camera.getFocus(a,t,u,c,za.createDefaultSnapshot())}}(this.plugin,c,r);null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({durationMs:u,snapshot:l})}else l=a.camera.getFocus(t.center,c),a.requestCameraReset({durationMs:u,snapshot:l})}},e.prototype.orientAxes=function(t,r){if(this.plugin.canvas3d){t||(t=this.plugin.state.data.selectQ(function(s){return s.ofType(ve.Molecule.Structure)}).filter(function(s){return s.obj&&!s.transform.transformer.definition.isDecorator&&!s.obj.data.parent}).map(function(s){var u;return null===(u=s.obj)||void 0===u?void 0:u.data}).filter(function(s){return!!s}));var i=function trt(e,t){var r=function nrt(e,t){var r;return(r=Yk(e,{onlyTrace:!0})).length>=3*t||(r=Yk(e,{skipHydrogens:!0,skipWater:!0})).length>=3*t||(r=Yk(e,{})),r}(e,3);return function rrt(e,t){if(0===e.length)return console.warn("Skipping PCA, no atoms"),{rotation:zd.identity,origin:b.zero()};var r=gl.calculateMomentsAxes(e),n=gl.calculateNormalizedAxes(r),a=function srt(e,t,r){var n=Qt();return Qt.setValue(n,0,0,e[0]),Qt.setValue(n,0,1,e[1]),Qt.setValue(n,0,2,e[2]),Qt.setValue(n,1,0,t[0]),Qt.setValue(n,1,1,t[1]),Qt.setValue(n,1,2,t[2]),Qt.setValue(n,2,0,r[0]),Qt.setValue(n,2,1,r[1]),Qt.setValue(n,2,2,r[2]),n}(n.dirA,n.dirB,n.dirC);!function urt(e){Qt.determinant(e)<0&&(Qt.setValue(e,2,0,-Qt.getValue(e,2,0)),Qt.setValue(e,2,1,-Qt.getValue(e,2,1)),Qt.setValue(e,2,2,-Qt.getValue(e,2,2)))}(a);var i=t?function art(e,t){for(var r=zd.identity,n=0,a=Qt(),i=0,o=[zd.identity,zd.rotX180,zd.rotY180,zd.rotZ180];i<o.length;i++){var s=o[i],u=Qt.innerProduct(Qt.mul(a,s,e),t);u>n&&(r=s,n=u)}return r}(a,t):function irt(e,t,r){for(var n=b.create(Qt.getValue(t,0,0),Qt.getValue(t,0,1),Qt.getValue(t,0,2)),a=b.create(Qt.getValue(t,1,0),Qt.getValue(t,1,1),Qt.getValue(t,1,2)),i=b.create(Qt.getValue(t,2,0),Qt.getValue(t,2,1),Qt.getValue(t,2,2)),o=Math.floor(e.length/3),s=b(),u=0,c=0,l=0,d=0;d<o;d++)b.fromArray(s,e,3*d),b.sub(s,s,r),u+=d*b.dot(s,n),c+=d*b.dot(s,a),l+=ort(d,o)*b.dot(s,i);var f=l<0,p=f?u+c<0:u-c<0;return p&&f?zd.rotY180:f?zd.rotX180:p?zd.rotZ180:zd.identity}(e,a,r.origin);return Qt.mul(a,i,a),{rotation:a,origin:n.origin}}(r,t)}(t).rotation,o=tie(this.plugin.canvas3d.camera.getSnapshot(),i);this.setSnapshot(o,r)}},e.prototype.resetAxes=function(t){if(this.plugin.canvas3d){var r=tie(this.plugin.canvas3d.camera.getSnapshot(),Qt.Identity);this.setSnapshot(r,t)}},e.prototype.setSnapshot=function(t,r){var n;null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),Xk=function(e){function t(r,n){void 0===n&&(n={});var a=e.call(this,{props:R(R({},T.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=T.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return jt(t,e),Object.defineProperty(t.prototype,"props",{get:function(){return R({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=R(R({},this.state.props),r);gO(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next(void 0))},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.lociSelects.dispose(),this.lociHighlights.dispose()},t}(lp);!function(e){e.Params={granularity:T.Select("residue",fr.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){void 0===o&&(o={}),this.ctx=i,this.providers=[],this.props=T.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o,s){void 0===s&&(s=!1);var c=i.repr;return{loci:fr.normalize(i.loci,o?this.props.granularity:void 0,s),repr:c}},a.prototype.mark=function(i,o,s){if(void 0===s&&(s=!1),!fr.isEmpty(i.loci))for(var u=0,c=this.providers;u<c.length;u++)(0,c[u])(i,o,s)},a.prototype.dispose=function(){this.providers.length=0,this.sel.dispose()},a}();e.LociMarkManager=t;var r=function(a){function i(){var o=null!==a&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(s){void 0===s&&(s=!1);for(var u=0,c=o.prev;u<c.length;u++)o.mark(c[u],Ut.RemoveHighlight,s);o.prev.length=0},o}return jt(i,a),i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++)if(lr.Loci.areEqual(u[s],o))return!0;return!1},i.prototype.addHighlight=function(o){this.mark(o,Ut.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(fr.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))},i.prototype.highlightOnlyExtend=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var c={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(c)||(fr.isEmpty(c.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(c)))}},i.prototype.dispose=function(){a.prototype.dispose.call(this),this.prev.length=0},i}(t);e.LociHighlightManager=r;var n=function(a){function i(){return null!==a&&a.apply(this,arguments)||this}return jt(i,a),i.prototype.toggle=function(o,s){if(void 0===s&&(s=!0),!fr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,Ut.Toggle)}},i.prototype.toggleExtend=function(o,s){if(void 0===s&&(s=!0),!fr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);if(Re.is(u.loci)){var c=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:c,repr:u.repr})}}},i.prototype.select=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,Ut.Select)},i.prototype.selectJoin=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,Ut.Select)},i.prototype.selectOnly=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&(this.mark({loci:Ze.Loci(u.loci.structure),repr:u.repr},Ut.Deselect),this.sel.modify("set",u.loci)),this.mark(u,Ut.Select)},i.prototype.deselect=function(o,s){void 0===s&&(s=!0);var u=this.normalizedLoci(o,s,!0);Re.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,Ut.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:gT},Ut.Deselect)},i.prototype.deselectAllOnEmpty=function(o){fs(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;if(!fr.isEmpty(u))if(Re.is(u)){var c=this.sel.getLoci(u.structure);a.prototype.mark.call(this,{loci:Ze.Loci(u.structure)},Ut.Deselect,!fr.isEmpty(c)),a.prototype.mark.call(this,{loci:c},Ut.Select)}else a.prototype.mark.call(this,o,s)},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,Ut.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,Ut.Select))},i}(t);e.LociSelectManager=n}(Xk||(Xk={}));var drt=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a,i){0!==r.providers.length&&(r.mark(n,a),i||r.showLabels())})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return lr.Loci.areEqual(t,a)});-1===n&&r===Ut.Highlight?(this.locis.push(t),this.isDirty=!0):-1!==n&&r===Ut.RemoveHighlight&&(yS(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!fr.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var c=a.group?a.group(u):u.toString(),l=this.groupedLabels.get(c);l?l.push(u):this.groupedLabels.set(c,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var p=d.length,m=p>1&&d[0]!==d[1]?f:d[0];t.labels.push(1===p?m:"".concat(m," <small>|| \xd7 ").concat(p,"</small>"))}),this.isDirty=!1}return this.labels},e}(),rie="overpaint-controls";function nie(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i=this;return ce(this,function(o){switch(o.label){case 0:return[4,aie(e,t,function(s,u,c){return ue(i,void 0,void 0,function(){var l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=h.sent(),fr.isEmpty(d)||fs(d)||(f={bundle:rn.fromLoci(d),color:-1===r?dt(0):r,clear:-1===r},c?(p=or(or([],c.params.values.layers,!0),[f],!1),m=iie(p,l),s.to(c).update(Io.toBundle(m))):(m=iie([f],l),s.to(u.transform.ref).apply(et.Representation.OverpaintStructureRepresentation3DFromBundle,Io.toBundle(m),{tags:rie}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function aie(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(xr.Generators.ofTransformer(et.Representation.OverpaintStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(rie)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function iie(e,t){var r=Io.ofBundle(e,t.root),n=Io.merge(r);return Io.filter(n,t)}var oie="clipping-controls";function frt(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i=this;return ce(this,function(o){switch(o.label){case 0:return[4,prt(e,t,function(s,u,c){return ue(i,void 0,void 0,function(){var l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=h.sent(),fr.isEmpty(d)||fs(d)||(f={bundle:rn.fromLoci(d),groups:r},c?(p=or(or([],c.params.values.layers,!0),[f],!1),m=sie(p,l),s.to(c).update(Gn.toBundle(m))):(m=sie([f],l),s.to(u.transform.ref).apply(et.Representation.ClippingStructureRepresentation3DFromBundle,Gn.toBundle(m),{tags:oie}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function prt(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(xr.Generators.ofTransformer(et.Representation.ClippingStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(oie)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function sie(e,t){var r=Gn.ofBundle(e,t.root),n=Gn.merge(r);return Gn.filter(n,t)}var uie="transparency-controls";function mrt(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i=this;return ce(this,function(o){switch(o.label){case 0:return[4,cie(e,t,function(s,u,c){return ue(i,void 0,void 0,function(){var l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=h.sent(),fr.isEmpty(d)||fs(d)||(f={bundle:rn.fromLoci(d),value:r},c?(p=or(or([],c.params.values.layers,!0),[f],!1),m=lie(p,l),s.to(c).update(Po.toBundle(m))):(m=lie([f],l),s.to(u.transform.ref).apply(et.Representation.TransparencyStructureRepresentation3DFromBundle,Po.toBundle(m),{tags:uie}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function cie(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(xr.Generators.ofTransformer(et.Representation.TransparencyStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(uie)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function lie(e,t){var r=Po.ofBundle(e,t.root),n=Po.merge(r);return Po.filter(n,t)}var die="substance-controls";function fie(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i=this;return ce(this,function(o){switch(o.label){case 0:return[4,pie(e,t,function(s,u,c){return ue(i,void 0,void 0,function(){var l,d,f,p,m;return ce(this,function(h){switch(h.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:[4,n((l=u.obj.data.sourceData).root)];case 1:return d=h.sent(),fr.isEmpty(d)||fs(d)||(f={bundle:rn.fromLoci(d),material:r??as(),clear:!r},c?(p=or(or([],c.params.values.layers,!0),[f],!1),m=mie(p,l),s.to(c).update(Mo.toBundle(m))):(m=mie([f],l),s.to(u.transform.ref).apply(et.Representation.SubstanceStructureRepresentation3DFromBundle,Mo.toBundle(m),{tags:die}))),[2]}})})})];case 1:return o.sent(),[2]}})})}function pie(e,t,r){return ue(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:a=(n=e.state.data).build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];u=0,c=o[i].representations,f.label=2;case 2:return u<c.length?(d=n.select(xr.Generators.ofTransformer(et.Representation.SubstanceStructureRepresentation3DFromBundle,(l=c[u]).cell.transform.ref).withTag(die)),[4,r(a,l.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function mie(e,t){var r=Mo.ofBundle(e,t.root),n=Mo.merge(r);return Mo.filter(n,t)}var Kk=function(e){function t(r){var n=e.call(this,{options:T.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return jt(t,e),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype._setSnapshotState=function(r){this.updateState({options:r}),this.events.optionsUpdated.next(void 0)},t.prototype.setOptions=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,u,c,d=this;return ce(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(void 0),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(u=0,c=o[i].components;u<c.length;u++)this.updateReprParams(a,c[u]);return[2,this.plugin.dataTransaction(function(){return ue(d,void 0,void 0,function(){return ce(this,function(p){switch(p.label){case 0:return[4,a.commit()];case 1:return p.sent(),[4,this.plugin.state.updateBehavior(fD,function(m){m.ignoreHydrogens="all"!==r.hydrogens,m.ignoreHydrogensVariant="only-polar"===r.hydrogens?"non-polar":"all",m.ignoreLight=r.ignoreLight,m.material=r.materialStyle,m.clip=r.clipObjects})];case 2:return p.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:p.sent(),p.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.hydrogens,o=a.visualQuality,s=a.ignoreLight,u=a.materialStyle,c=a.clipObjects,l="all"!==i,d="only-polar"===i?"non-polar":"all",f=0,p=n.representations;f<p.length;f++){var m=p[f];if(m.cell.transform.transformer===BT){var h=m.cell.transform.params;(!!h.type.params.ignoreHydrogens!==l||h.type.params.ignoreHydrogensVariant!==d||h.type.params.quality!==o||h.type.params.ignoreLight!==s||!R1(h.type.params.material,u)||!T.areEqual(dm.Params,h.type.params.clip,c))&&r.to(m.cell).update(function(v){v.type.params.ignoreHydrogens=l,v.type.params.ignoreHydrogensVariant=d,v.type.params.quality=o,v.type.params.ignoreLight=s,v.type.params.material=u,v.type.params.clip=c})}}},t.prototype.updateInterationProps=function(){var r,n,a;return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f=this;return ce(this,function(p){switch(p.label){case 0:i=0,o=this.currentStructures,p.label=1;case 1:return i<o.length?(u=Ha.getParams(null===(r=(s=o[i]).cell.obj)||void 0===r?void 0:r.data),s.properties?(c=null===(n=s.properties.cell.transform.params)||void 0===n?void 0:n.properties[Ha.descriptor.name],T.areEqual(u,c,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(m){m.properties[Ha.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return p.sent(),[3,5];case 3:return l=this.plugin.customStructureProperties.getParams(null===(a=s.cell.obj)||void 0===a?void 0:a.data),d=T.getDefaultValues(l),T.areEqual(u,d.properties[Ha.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Ha.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:p.sent(),p.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ue(i,void 0,void 0,function(){var o,s,u,c;return ce(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?[4,this.plugin.builders.structure.representation.applyPreset((u=s[o]).cell,n,a)]:[3,5];case 2:return c=l.sent(),[4,this.syncPreset(u,c)];case 3:l.sent(),l.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(Fs(n.components,function(y){y&&a.add(y.ref)}),n.representations&&Fs(n.representations,function(y){y&&a.add(y.ref)}),0===a.size)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,c=r.components;u<c.length;u++){var l=c[u];s(l);for(var d=0,f=l.representations;d<f.length;d++)s(f[d]);if(l.genericRepresentations)for(var m=0,h=l.genericRepresentations;m<h.length;m++)s(h[m])}if(r.genericRepresentations)for(var v=0,g=r.genericRepresentations;v<g.length;v++)s(g[v]);return i?o.commit():void 0},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=Ze.toSubStructureElementLoci(s.structure.cell.obj.data,null===(n=s.cell.obj)||void 0===n?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(Ve.create("Modify Component",function(i){return ue(a,void 0,void 0,function(){var o,s,u,c,l;return ce(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)this.canBeModified(c=u[s])&&(l=this.plugin.managers.structure.selection.getStructure(c.structure.cell.obj.data))&&0!==l.elementCount&&this.modifyComponent(o,c,l,n);return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(0!==r.length)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,c=0,l=r;c<l.length;c++){var d=l[c].representations[u];d&&Cy(this.dataState,d.cell.transform.ref,a)}else{a=!r[0].cell.state.isHidden;for(var i=0,o=r;i<o.length;i++)Cy(this.dataState,o[i].cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(0!==r.length){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++)(u=s[o]).representations[i]&&a.push(u.representations[i])}else for(var c=0,l=r;c<l.length;c++)for(var u,d=0,f=(u=l[c]).representations;d<f.length;d++)a.push(f[d]);return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(0===r.length)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s].representations[i];l&&l.cell.transform.transformer===n.cell.transform.transformer&&o.to(l.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(0!==r.length){for(var u=this.dataState.build(),c=0,l=r;c<l.length;c++)for(var d=l[c],f=function(g){var y=g.cell.transform.params,S="function"==typeof n?n(d,g):n,C="default"===S.color?Ek(p.plugin,null===(a=d.structure.cell.obj)||void 0===a?void 0:a.data,y?.type.name):S.color?Ek(p.plugin,null===(i=d.structure.cell.obj)||void 0===i?void 0:i.data,y?.type.name,S.color,S.colorParams):void 0,_="default"===S.size?cae(p.plugin,null===(o=d.structure.cell.obj)||void 0===o?void 0:o.data,y?.type.name):S.color?cae(p.plugin,null===(s=d.structure.cell.obj)||void 0===s?void 0:s.data,y?.type.name,S.size,S.sizeParams):void 0;(C||_)&&u.to(g.cell).update(function(x){C&&(x.colorTheme=C),_&&(x.sizeTheme=_)})},p=this,m=0,h=d.representations;m<h.length;m++)f(h[m]);return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(0!==r.length){var i=this.state.options,o=i.hydrogens,p={ignoreHydrogens:"all"!==o,ignoreHydrogensVariant:"only-polar"===o?"non-polar":"all",quality:i.visualQuality,ignoreLight:i.ignoreLight,material:i.materialStyle,clip:i.clipObjects};return this.plugin.dataTransaction(function(){return ue(a,void 0,void 0,function(){var m,h;return ce(this,function(g){switch(g.label){case 0:m=0,h=r,g.label=1;case 1:return m<h.length?[4,this.plugin.builders.structure.representation.addRepresentation(h[m].cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:p})]:[3,4];case 2:g.sent(),g.label=3;case 3:return m++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(0!==r.components.length)return this.plugin.runTask(Ve.create("Find Component",function(i){return ue(a,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m,h;return ce(this,function(v){switch(v.label){case 0:return(o=null===(m=r.cell.obj)||void 0===m?void 0:m.data)?(c=(u=ht).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=c.apply(u,[v.sent()]),l=0,d=r.components;l<d.length;l++)if((p=null===(h=(f=d[l]).cell.obj)||void 0===h?void 0:h.data)&&f.cell.parent&&Oke(s,p))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ue(this,void 0,void 0,function(){var a=this;return ce(this,function(i){return[2,this.plugin.dataTransaction(function(){return ue(a,void 0,void 0,function(){var o,s,u,h,v,g,y,S,C;return ce(this,function(_){switch(_.label){case 0:if(0===(o=n||this.currentStructures).length)return[2];h={ignoreHydrogens:"all"!==(u=(s=this.state.options).hydrogens),ignoreHydrogensVariant:"only-polar"===u?"non-polar":"all",quality:s.visualQuality,ignoreLight:s.ignoreLight,material:s.materialStyle,clip:s.clipObjects},v=kn.create22(),g=0,y=o,_.label=1;case 1:return g<y.length?(S=y[g],C=void 0,r.options.checkExisting?[4,this.tryFindComponent(S,r.selection)]:[3,3]):[3,8];case 2:C=_.sent(),_.label=3;case 3:return C?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(S.cell,r.selection,v,{label:r.options.label||(r.selection===xi.current?"Custom Selection":"")})];case 4:C=_.sent(),_.label=5;case 5:return"none"!==r.representation&&C?[4,this.plugin.builders.structure.representation.addRepresentation(C,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:h})]:[3,7];case 6:_.sent(),_.label=7;case 7:return g++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ue(this,void 0,void 0,function(){var a=this;return ce(this,function(i){return[2,this.plugin.dataTransaction(function(o){return ue(a,void 0,void 0,function(){var s,u,c,l,d,p=this;return ce(this,function(m){switch(m.label){case 0:if(0===(s=n||this.currentStructures).length)return[2];u=function(h){return ue(p,void 0,void 0,function(){var v,g;return ce(this,function(y){switch(y.label){case 0:return g=(v=ht).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,h)];case 1:return[2,g.apply(v,[y.sent()])]}})})},c=0,l=s,m.label=1;case 1:return c<l.length?(d=l[c],"color"!==r.action.name?[3,3]:[4,nie(this.plugin,d.components,r.action.params.color,u,r.representations)]):[3,14];case 2:return m.sent(),[3,13];case 3:return"resetColor"!==r.action.name?[3,5]:[4,nie(this.plugin,d.components,-1,u,r.representations)];case 4:return m.sent(),[3,13];case 5:return"transparency"!==r.action.name?[3,7]:[4,mrt(this.plugin,d.components,r.action.params.value,u,r.representations)];case 6:return m.sent(),[3,13];case 7:return"material"!==r.action.name?[3,9]:[4,fie(this.plugin,d.components,r.action.params.material,u,r.representations)];case 8:return m.sent(),[3,13];case 9:return"resetMaterial"!==r.action.name?[3,11]:[4,fie(this.plugin,d.components,void 0,u,r.representations)];case 10:return m.sent(),[3,13];case 11:return"clipping"!==r.action.name?[3,13]:[4,frt(this.plugin,d.components,Gn.Groups.fromNames(r.action.params.excludeGroups),u,r.representations)];case 12:m.sent(),m.label=13;case 13:return c++,[3,1];case 14:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,c=null===(o=n.cell.obj)||void 0===o?void 0:o.data;if(c&&("subtract"!==i&&"intersect"!==i||GA(c,a))){var l=null===(s=n.structure.cell.obj)||void 0===s?void 0:s.data,d="union"===i?r2(l,[c,a]):"intersect"===i?QZ(c,a):L4(c,a);if(0===d.elementCount)r.delete(n.cell.transform.ref);else{var p={type:{name:"bundle",params:rn.fromSubStructure(l,d)},nullIfEmpty:!0,label:null===(u=n.cell.obj)||void 0===u?void 0:u.label};r.to(n.cell).update(p)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:null===(a=r.cell.params)||void 0===a?void 0:a.values.type,nullIfEmpty:null===(i=r.cell.params)||void 0===i?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var s=0,u=i[a].components;s<u.length;s++)n.delete(u[s].cell.transform.ref);return n.commit({canUndo:"Clear Selections"})},t}(lp);!function(e){function n(i,o){var s,u;return null!==(s=o?.cell.obj)&&void 0!==s&&s.data?i.representation.structure.registry.getApplicableTypes(null===(u=o.cell.obj)||void 0===u?void 0:u.data):i.representation.structure.registry.types}function a(i,o,s,u){var c=or(or([],s,!0),n(i,o),!0);return T.Select(c[0][0],c,{label:u})}e.OptionsParams={hydrogens:T.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:T.Select("auto",WF,{description:"Control the visual/rendering quality of representations"}),ignoreLight:T.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:as.getParam(),clipObjects:T.Group(dm.Params),interactions:T.Group(Ha.defaultParams,{label:"Non-covalent Interactions"})},e.getAddParams=function t(i,o){var s=i.query.structure.registry.options;return o=R({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:T.Select(s[1][0],s,{isHidden:o?.hideSelection}),representation:a(i,o?.pivot,o?.allowNone?[["none","< Create Later >"]]:[]),options:T.Group({label:T.Text(""),checkExisting:T.Boolean(!!o?.checkExisting,{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}},e.getThemeParams=function r(i,o){var s=i.query.structure.registry.options;return{selection:T.Select(s[1][0],s,{isHidden:!1}),action:T.MappedStatic("color",{color:T.Group({color:T.Color(vr.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:T.EmptyGroup({label:"Reset Color"}),transparency:T.Group({value:T.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:T.Group({material:as.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:T.EmptyGroup({label:"Reset Material"}),clipping:T.Group({excludeGroups:T.MultiSelect([],T.objectToOptions(Gn.Groups.Names))},{isFlat:!0})}),representations:T.MultiSelect([],n(i,o),{emptyValue:"All"})}},e.getRepresentationTypes=n}(Kk||(Kk={}));var vrt=function(e){function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(ve.Molecule.Structure.is(u)){(null===(s=n.current)||void 0===s?void 0:s.loci.structure)===u.data&&n.clear();for(var c=[],l=0,d=n.history;l<d.length;l++){var f=d[l];f.loci.structure===u.data&&c.push(f)}c.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,c),n.events.historyUpdated.next(void 0))}});var a=Pe();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,c=i.action;if(ve.Molecule.Structure.is(u)&&s!==u.data&&"in-place"===c){var l=n.state.current;if(l&&l.loci.structure===s){var f=Re.remap(l.loci,u.data);n.state.current=R(R({},l),{loci:f}),n.behaviors.current.next(n.state.current),fr.getBoundingSphere(f,a);var p=null===(o=n.plugin.canvas3d)||void 0===o?void 0:o.camera,m=p.getTargetDistance(a.radius+4);(b.distance(p.target,a.center)>a.radius||m>p.viewport.height/p.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return jt(t,e),Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Re.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(Re.areEqual(s.loci,r.loci)){a=s;break}n++}if(a)return yS(this.state.history,n),this.state.history.unshift(r),void this.events.historyUpdated.next(void 0);this.state.history.unshift(r),this.state.history.length>8&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Re.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=fr.normalize(r);Re.is(n)&&!Re.isEmpty(n)?this.set({loci:n,label:DT(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}):this.clear()},t.prototype.addFromLoci=function(r){var n=this.state.current&&Re.is(r)&&r.structure===this.state.current.loci.structure?Re.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r?.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:rn.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(r.current){var i=r.current,o=i.label,u=i.bundle,c=i.category,l=null===(a=null===(n=this.plugin.state.data.select(xr.Generators.byRef(i.ref))[0])||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(l){var d=rn.toLoci(u,l);this.set({label:o,loci:d,category:c})}}else this.clear()},t}(lp);function Zk(){return{trajectories:[],models:[],structures:[],refs:new Map}}function yrt(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function hie(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function brt(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function Srt(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function vie(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function Crt(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function xrt(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function _rt(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function wrt(e){return e.transform.tags?or([],e.transform.tags,!0).sort().join():e.transform.ref}function Art(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:wrt(e),representations:[]}}function Trt(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function Drt(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function ky(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Fv(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function gie(e){return function(t){return e.is(t.obj)}}function yie(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function AD(e){return function(t){return t.transform.transformer===e}}function Bv(){}var Irt=[[gie(ve.Molecule.Trajectory),function(e,t){e.currentTrajectory=ky(e,t,e.hierarchy.trajectories,yrt,t)},function(e){return e.currentTrajectory=void 0}],[yie(ve.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentModel=e.currentTrajectory?ky(e,t,e.currentTrajectory.models,hie,t,e.currentTrajectory):Fv(e,t,hie,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[AD(et.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=Fv(e,t,brt,t,e.currentModel)},Bv],[AD(et.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=Fv(e,t,Srt,t,e.currentModel)},Bv],[yie(ve.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentStructure=e.currentModel?ky(e,t,e.currentModel.structures,vie,t,e.currentModel):Fv(e,t,vie,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[AD(et.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=Fv(e,t,Crt,t,e.currentStructure)},Bv],[AD(et.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=Fv(e,t,xrt,t,e.currentStructure)},Bv],[gie(tc),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=Fv(e,t,_rt,t,e.currentStructure)),!1},Bv],[function(e,t){return!(t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator)&&ve.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=ky(e,t,e.currentStructure.components,Art,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ve.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&ky(e,t,e.currentComponent.representations,Trt,t,e.currentComponent),!1},Bv],[function(e){return!e.state.isGhost&&ve.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),ky(e,t,r.genericRepresentations,Drt,t,r))},Bv]];function bie(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===Jn.Null||"ok"!==e.status&&"error"!==e.status)}function Prt(e){bie(e.cell)||(this.changed=!0)}function Mrt(e){Sie(this,this.tree.transforms.get(e))}function Sie(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(bie(n)){for(var a=void 0,i=!1,o=0,s=Irt;o<s.length;o++){var u=s[o],l=u[1],d=u[2];if((0,u[0])(n,r)){if(!1===l(r,n)){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(Mrt,e),a&&a(r)}}}var Qk=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:Zk(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return jt(t,e),Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups||(this._currentComponentGroups=t.getComponentGroups(this.selection.structures)),this._currentComponentGroups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++)this._currentSelectionSet.add(n[r].cell.transform.ref);for(var i=0,o=this.selection.models;i<o.length;i++)this._currentSelectionSet.add(o[i].cell.transform.ref);for(var s=0,u=this.selection.structures;s<u.length;s++)this._currentSelectionSet.add(u[s].cell.transform.ref);return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var n=[],a=0,i=this.plugin.managers.structure.hierarchy.current.structures;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.findStructure=function(r){if(r){var n=this.plugin.helpers.substructureParent.get(r);if(n){var a=this.plugin.state.data.selectQ(function(i){return i.byValue(n).rootOfType(ve.Molecule.Structure)})[0];if(a)return this.behaviors.selection.value.structures.find(function(i){return i.cell===a})}}},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],c=u.cell.transform.ref;(a.has(c)||n.has(c))&&i.push(u)}return 0===i.length?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(r||!this.dataState.inUpdate){if(this.state.syncedTree===this.dataState.tree)return void(r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(R({hierarchy:this.state.hierarchy},this.state.selection))));this.state.syncedTree=this.dataState.tree;var n=function grt(e,t){var r=function Ert(e,t){return{state:e,oldHierarchy:t,hierarchy:Zk(),changed:!1,added:new Set}}(e,t||Zk());return function Rrt(e,t){Sie({tree:e,state:t},e.root)}(e.tree,r),t&&t.refs.forEach(Prt,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}(this.plugin.state.data,this.current);if(n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i="add"===n?sa.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):sa.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],c=0,l=a.trajectories;c<l.length;c++){var d=l[c];i.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,p=a.models;f<p.length;f++){var m=p[f];i.has(m.cell.transform.ref)&&s.push(m)}for(var h=0,v=a.structures;h<v.length;h++){var g=v[h];i.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(0!==r.length){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete("string"==typeof s?s:s.cell.transform.ref)}return a.commit({canUndo:!!n&&"Remove"})}},t.prototype.toggleVisibility=function(r,n){if(0!==r.length)for(var a=void 0!==n?"show"!==n:!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++)Cy(this.dataState,o[i].cell.transform.ref,a)},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ue(i,void 0,void 0,function(){var o,s,u;return ce(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o]).models.length>0?[4,this.clearTrajectory(u)]:[3,3]:[3,6];case 2:c.sent(),c.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:c.sent(),c.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ue(this,void 0,void 0,function(){var a=this;return ce(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return ue(a,void 0,void 0,function(){var o,s;return ce(this,function(u){switch(u.label){case 0:return o=ii.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),yr.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++)n.delete(i[a].cell);return n.commit()},t}(L2);!function(e){e.getComponentGroups=function t(n){if(!n.length)return[];if(1===n.length)return n[0].components.map(function(m){return[m]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var c=0,l=s[o].components;c<l.length;c++){var d=l[c],f=d.key;if(f){var p=i.get(f);p||(i.set(f,p=[]),a.push(p)),p.push(d)}}return a},e.getSelectedStructuresDescription=function r(n){var a,i,o,s,u,c,l,d,f,p=n.managers.structure.hierarchy.selection.structures;if(0===p.length)return"";if(1===p.length){var h=null===(a=(m=p[0]).cell.obj)||void 0===a?void 0:a.data;if(!h)return(null===(i=m.cell.obj)||void 0===i?void 0:i.label)||"Structure";var v=h.models[0]||h.representativeModel||h.masterModel;if(!v)return(null===(o=m.cell.obj)||void 0===o?void 0:o.label)||"Structure";var g=v.entryId;return null!==(u=null===(s=m.model)||void 0===s?void 0:s.trajectory)&&void 0!==u&&u.models&&1===m.model.trajectory.models.length?g:m.model?"".concat(null===(c=m.model.cell.obj)||void 0===c?void 0:c.label," | ").concat(g):g}for(var y=p[0],S=null===(l=y?.model)||void 0===l?void 0:l.trajectory,C=!0,_=0,x=p;_<x.length;_++){var m=x[_];if((null===(d=m?.model)||void 0===d?void 0:d.trajectory)!==S){C=!1;break}}return C&&S?"".concat(null===(f=S.cell.obj)||void 0===f?void 0:f.label," | ").concat(p.length," structures"):"".concat(p.length," structures")}}(Qk||(Qk={}));var $k="measurement-group",TD="measurement-order-label",Ort={distanceUnitLabel:T.Text("\u212b",{isEssential:!0}),textColor:ete.textColor},Frt=T.getDefaultValues(Ort),Brt=function(e){function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:Frt})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return jt(t,e),t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var n=xr.findTagInSubtree(this.plugin.state.data.tree,on.RootRef,$k),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(et.Misc.CreateGroup,{label:"Measurements"},{tags:$k})},t.prototype.setOptions=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,d;return ce(this,function(p){switch(p.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)n.to(i[a]).update(function(m){m.unitLabel=r.distanceUnitLabel,m.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)n.to(s[o]).update(function(m){m.textColor=r.textColor});for(u=0,c=this.state.angles;u<c.length;u++)n.to(c[u]).update(function(m){m.textColor=r.textColor});for(l=0,d=this.state.dihedrals;l<d.length;l++)n.to(d[l]).update(function(m){m.textColor=r.textColor});return 0===n.editInfo.count?[2]:[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return p.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return ue(this,void 0,void 0,function(){var i,o,s,u;return ce(this,function(l){switch(l.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),i&&o?(Ya(s=[i.transform.ref],o.transform.ref),(u=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:Re.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Re.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a?.selectionTags}).apply(et.Representation.StructureSelectionsDistance3D,R(R(R({customText:a?.customText||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a?.lineParams),a?.labelParams),a?.visualParams),{tags:a?.reprTags}),[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:u,options:{doNotLogTiming:!0}})]):[2];case 1:return l.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l;return ce(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),o&&s&&u?(Ya(c=[o.transform.ref],s.transform.ref),Ya(c,u.transform.ref),(l=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Re.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:c,tags:i?.selectionTags}).apply(et.Representation.StructureSelectionsAngle3D,R(R(R({customText:i?.customText||"",textColor:this.state.options.textColor},i?.lineParams),i?.labelParams),i?.visualParams),{tags:i?.reprTags}),[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:l,options:{doNotLogTiming:!0}})]):[2];case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return ue(this,void 0,void 0,function(){var s,u,c,l,d,f;return ce(this,function(m){switch(m.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),c=this.plugin.helpers.substructureParent.get(a.structure),l=this.plugin.helpers.substructureParent.get(i.structure),s&&u&&c&&l?(Ya(d=[s.transform.ref],u.transform.ref),Ya(d,c.transform.ref),Ya(d,l.transform.ref),(f=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:c.transform.ref,expression:Re.toExpression(a)},{key:"d",ref:l.transform.ref,expression:Re.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o?.selectionTags}).apply(et.Representation.StructureSelectionsDihedral3D,R(R(R({customText:o?.customText||"",textColor:this.state.options.textColor},o?.lineParams),o?.labelParams),o?.visualParams),{tags:o?.reprTags}),[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:f,options:{doNotLogTiming:!0}})]):[2];case 1:return m.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ue(this,void 0,void 0,function(){var a,i,o;return ce(this,function(u){switch(u.label){case 0:return(a=this.plugin.helpers.substructureParent.get(r.structure))?(i=[a.transform.ref],(o=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n?.selectionTags}).apply(et.Representation.StructureSelectionsLabel3D,R(R({textColor:this.state.options.textColor},n?.labelParams),n?.visualParams),{tags:n?.reprTags}),[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ce(this,function(d){switch(d.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)(u=this.plugin.helpers.substructureParent.get((s=r[i]).structure))&&(Ya(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:Re.toExpression(s)}));return 0===n.length?[2]:((c=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(et.Representation.StructureSelectionsOrientation3D),[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:c,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addPlane=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ce(this,function(d){switch(d.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)(u=this.plugin.helpers.substructureParent.get((s=r[i]).structure))&&(Ya(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:Re.toExpression(s)}));return 0===n.length?[2]:((c=this.getGroup()).apply(et.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Plane"},{dependsOn:a}).apply(et.Representation.StructureSelectionsPlane3D),[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:c,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addOrderLabels=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,u,c,l,d,f,p;return ce(this,function(h){switch(h.label){case 0:for(n=this.getGroup(),a=this.plugin.state.data.select(xr.Generators.ofType(ve.Molecule.Structure.Selections).withTag(TD)),i=0,o=a;i<o.length;i++)n.delete(o[i]);for(u=1,c=0,l=r;c<l.length;c++)(f=this.plugin.helpers.substructureParent.get((d=l[c]).structure))&&(p=[f.transform.ref],n.apply(et.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:f.transform.ref,expression:Re.toExpression(d)}],isTransitive:!0,label:"Order"},{dependsOn:p,tags:TD}).apply(et.Representation.StructureSelectionsLabel3D,{textColor:dt.fromRgb(255,255,255),borderColor:dt.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:"".concat(u++)},{tags:TD}));return[4,yr.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return h.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=xr.findTagInSubtree(n.tree,on.RootRef,$k),i=a?n.select(xr.Generators.ofTransformer(r,a)):this._empty;return 0===i.length?this._empty:i},t.prototype.sync=function(){for(var r=[],n=0,a=this.getTransforms(et.Representation.StructureSelectionsLabel3D);n<a.length;n++){var i=a[n],o=i.obj.tags;(!o||!o.includes(TD))&&r.push(i)}this.updateState({labels:r,distances:this.getTransforms(et.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(et.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(et.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(et.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(et.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()},t}(lp),iC=new Lu("98"),krt=function(e){function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:{structureCount:0,elementCount:0,label:"Nothing Selected"}})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return jt(t,e),Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats||(this.state.stats=this.calcStats()),this.state.stats},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new Jk(Re(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=Ad.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,c=s.length;u<c;++u)n+=ke.size(s[u].indices);Ad.add(a,a,Ad.ofLoci(o.selection))}});var i=ET(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Re.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Re.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.intersect(n.selection,r),this.referenceLoci=r,!Re.areEqual(a,n.selection)},t.prototype.set=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Re.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){void 0===i&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":yS(o,s);break;case"up":u=s-1;break;case"down":u=s+1}if(void 0!==u)for(var c=a?Math.min(o.length,a):o.length;;){if((u%=c)<0&&(u+=c),!i||o[s].loci.structure===o[u].loci.structure){var l=o[s];o[s]=o[u],o[u]=l;break}u+="up"===n?-1:1}this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.tryAddHistory=function(r){if(!fr.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(fr.areEqual(s.loci,r)){a=s;break}n++}if(a)return yS(this.additionsHistory,n),this.additionsHistory.unshift(a),void this.events.additionsHistoryUpdated.next(void 0);var c=ET(Ad.ofLoci(r),{reverse:!0});this.additionsHistory.unshift({id:kn.create22(),loci:r,label:c}),this.additionsHistory.length>24&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.clearHistory=function(){0!==this.state.additionsHistory.length&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++)(o=i[a]).loci.structure.root===r.root&&n.push(o);for(var s=0,u=n;s<u.length;s++){var o;this.modifyHistory(o=u[s],"remove")}0!==n.length&&this.events.additionsHistoryUpdated.next(void 0)},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),n?.data&&this.clearHistoryForStructure(n.data),(null===(a=this.referenceLoci)||void 0===a?void 0:a.structure)===n?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(n!==a&&n?.data!==a.data){var c=this.plugin.helpers.substructureParent.get(a.data,!0);if(c&&r===c.transform.ref&&this.entries.has(r)){var l=null===(o=null===(i=this.plugin.helpers.substructureParent.get(a.data))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data;if(l)if(!n?.data||Ze.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,function Urt(e,t){return new Jk(Re.remap(e.selection,t))}(this.entries.get(r),l)),(null===(s=this.referenceLoci)||void 0===s?void 0:s.structure.root)===l.root&&(this.referenceLoci=Re.remap(this.referenceLoci,l));for(var d=!1,f=0,p=this.state.additionsHistory;f<p.length;f++){var m=p[f];m.loci.structure.root===l.root&&(m.loci=Re.remap(m.loci,l),d=!0)}d&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(r,new Jk(Re(l,[]))),(null===(u=this.referenceLoci)||void 0===u?void 0:u.structure.root)===l.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(l),this.state.stats=void 0,this.events.changed.next(void 0)}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);Re.isEmpty(i.selection)||n.push(i.selection),i.selection=Re(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:Wr},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=null===(a=null===(n=r.cell)||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!Re.isEmpty(o.selection)},t.prototype.has=function(r){if(Re.is(r)){var n=this.getEntry(r.structure);if(n)return Re.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(Re.is(r)&&1===r.elements.length&&this.getEntry(r.structure)){var a=r.elements[0];if(a){var i=this.referenceLoci;if(i&&Re.is(i)&&i.structure===r.structure){for(var o,s=0,u=i.elements;s<u.length;s++){var c=u[s];if(a.unit===c.unit){o=c;break}}if(o&&a.unit===o.unit)return function Vrt(e,t,r){var n=Math.min(ke.min(t.indices),ke.min(r.indices)),a=Math.max(ke.max(t.indices),ke.max(r.indices));return Re(e,[{unit:t.unit,indices:ke.ofRange(n,a)}])}(r.structure,o,a)}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Re.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=b.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=b.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);iC.reset();var a=[];this.entries.forEach(function(l){var d=l.selection;Re.isEmpty(d)||a.push(Re.getBoundary(d))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,c=s.sphere;b.min(r,r,u.min),b.max(n,n,u.max),iC.includePositionRadius(c.center,c.radius)}for(iC.finishedIncludeStep(),i=0,o=a.length;i<o;++i)iC.radiusPositionRadius((c=a[i].sphere).center,c.radius);return{box:{min:r,max:n},sphere:iC.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=Cw(this.entries.values());return Re.getPrincipalAxesMany(r.map(function(n){return n.selection}))},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n)}a&&(this.state.stats=void 0,this.events.changed.next(void 0))},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(void 0===a&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a)}},t.prototype.fromLoci=function(r,n,a){void 0===a&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){void 0===a&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var u=n(new Rc(o[i]));this.triggerInteraction(r,ht.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;void 0===a&&(a=!0),this.plugin.runTask(Ve.create("Structure Selection",function(o){return ue(i,void 0,void 0,function(){var s,u,l;return ce(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?[4,n.getSelection(this.plugin,o,u[s])]:[3,4];case 2:l=d.sent(),this.triggerInteraction(r,ht.toLociWithSourceUnits(l),a),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=mo.resolveAndCheck(this.plugin.state.data,r);if(a&&a.obj){if(!ve.Molecule.Structure.Selections.is(a.obj))return void console.warn("fromSelections applied to wrong object type.",a.obj);this.clear();for(var i=0,o=null===(n=a.obj)||void 0===n?void 0:n.data;i<o.length;i++)this.fromLoci("set",o[i].loci)}},t.prototype.getSnapshot=function(){var r=[];return this.entries.forEach(function(n,a){r.push({ref:a,bundle:rn.fromLoci(n.selection)})}),{entries:r}},t.prototype.setSnapshot=function(r){var n,a;this.entries.clear();for(var i=0,o=r.entries;i<o.length;i++){var s=o[i],c=s.bundle,l=null===(a=null===(n=this.plugin.state.data.select(xr.Generators.byRef(s.ref))[0])||void 0===n?void 0:n.obj)||void 0===a?void 0:a.data;if(l){var d=rn.toLoci(c,l);this.fromLoci("set",d,!1)}}},t}(lp),Jk=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure||(this._structure=fr.isEmpty(this._selection)?void 0:Re.toStructure(this._selection)),this._structure},enumerable:!1,configurable:!0}),e}();function eL(){return{volumes:[],lazyVolumes:[],refs:new Map}}function zrt(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function Hrt(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function jrt(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function tL(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Cie(){}var Yrt=[[function Wrt(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}(ve.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=tL(e,t,e.hierarchy.volumes,zrt,t)},function(e){return e.currentVolume=void 0}],[function(e){return ve.Volume.Lazy.is(e.obj)},function(e,t){tL(e,t,e.hierarchy.lazyVolumes,Hrt,t)},Cie],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ve.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&tL(e,t,e.currentVolume.representations,jrt,t,e.currentVolume),!1},Cie]];function xie(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===Jn.Null||"ok"!==e.status&&"error"!==e.status)}function Xrt(e){xie(e.cell)||(this.changed=!0)}function Krt(e){_ie(this,this.tree.transforms.get(e))}function _ie(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(xie(n)){for(var a=void 0,i=!1,o=0,s=Yrt;o<s.length;o++){var u=s[o],l=u[1],d=u[2];if((0,u[0])(n,r)){if(!1===l(r,n)){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(Krt,e),a&&a(r)}}}var rL=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:eL(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return jt(t,e),Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(r||!this.dataState.inUpdate){if(this.state.syncedTree===this.dataState.tree)return void(r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection})));this.state.syncedTree=this.dataState.tree;var n=function Grt(e,t){var r=function qrt(e,t){return{state:e,oldHierarchy:t,hierarchy:eL(),changed:!1,added:new Set}}(e,t||eL());return function Zrt(e,t){_ie({tree:e,state:t},e.root)}(e.tree,r),t&&t.refs.forEach(Xrt,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}(this.plugin.state.data,this.current);if(n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection=this.state.selection&&a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(0!==r.length){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete("string"==typeof s?s:s.cell.transform.ref)}return a.commit({canUndo:!!n&&"Remove"})}},t.prototype.toggleVisibility=function(r,n){if(0!==r.length)for(var a=void 0!==n?"show"!==n:!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++)Cy(this.dataState,o[i].cell.transform.ref,a)},t.prototype.addRepresentation=function(r,n){var a;return this.dataState.build().to(r.cell).apply(et.Representation.VolumeRepresentation3D,nC(this.plugin,null===(a=r.cell.obj)||void 0===a?void 0:a.data,{type:n})).commit({canUndo:"Add Representation"})},t}(L2);!function(e){e.getRepresentationTypes=function t(r,n){var a,i;return null!==(a=n?.cell.obj)&&void 0!==a&&a.data?r.representation.volume.registry.getApplicableTypes(null===(i=n.cell.obj)||void 0===i?void 0:i.data):r.representation.volume.registry.types}}(rL||(rL={}));var Vm,nL=[["full","Full"],["hidden","Hidden"]],$rt={isExpanded:T.Boolean(!1),showControls:T.Boolean(!0),regionState:T.Group({left:T.Select("full",[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]]),top:T.Select("full",nL),right:T.Select("full",nL),bottom:T.Select("full",nL)}),controlsDisplay:T.Value("outside",{isHidden:!0})},Jrt=function(e){function t(r){var n=e.call(this,R(R({},T.getDefaultValues($rt)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,yr.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return jt(t,e),t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&"boolean"==typeof r.isExpanded&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next(void 0)},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:"viewport"===(a[s].name||"").toLowerCase()&&i.push(a[s]);for(var u=0,c=i;u<c.length;u++)n.removeChild(c[u]);o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement();this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:f.scrollTop,scrollLeft:f.scrollLeft,position:d.position,overflow:d.overflow,viewports:i,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var h=this.rootState,v=0,g=h.viewports;v<g.length;v++)n.appendChild(g[v]);(d=r.style).top=h.top,d.bottom=h.bottom,d.left=h.left,d.right=h.right,d.width=h.width,d.height=h.height,d.maxWidth=h.maxWidth,d.maxHeight=h.maxHeight,d.margin=h.margin,d.marginLeft=h.marginLeft,d.marginRight=h.marginRight,d.marginTop=h.marginTop,d.marginBottom=h.marginBottom,d.position=h.position,d.overflow=h.overflow||"",(f=this.getScrollElement()).scrollTop=h.scrollTop,f.scrollLeft=h.scrollLeft,this.rootState=void 0,this.root.style.zIndex=h.zIndex}}}catch(S){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,S)}},t}(lp),aL={includeTypes:T.MultiSelect(pw(Gr.Names),T.objectToOptions(Gr.Names)),excludeTypes:T.MultiSelect([],T.objectToOptions(Gr.Names)),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),aromaticBonds:T.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:T.Select("symmetric",T.arrayToOptions(["off","symmetric","offset"]))},iL=(T.getDefaultValues(aL),R(R(R({},Ev),aL),{adjustCylinderLength:T.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})})),oL=(T.getDefaultValues(iL),R(R({},zne),aL));function DD(e,t,r){return!Gr.is(e,r)||Gr.is(t,r)}function wie(e,t,r){var n=t.elements,a=t.bonds,i=a.a,o=a.b,u=a.edgeProps.flags,c=r.ignoreHydrogens,l=r.ignoreHydrogensVariant,f=r.excludeTypes,p=Gr.fromNames(r.includeTypes),m=Gr.fromNames(f),h=Gr.isAll(p)&&0===m,v=e.child,g=v?.unitMap.get(t.id);if(v&&!g)throw new Error("expected childUnit to exist if child exists");if(!h||c||v)return function(y){var S=i[y],C=o[y];return!!(g&&!Ye.has(g.elements,n[S])||!h&&DD(p,m,u[y]))||!!c&&!(!Tl(e,t,n[S],l)&&!Tl(e,t,n[C],l))}}function Aie(e,t){var n=e.interUnitBonds.edges,a=t.ignoreHydrogens,i=t.ignoreHydrogensVariant,s=t.excludeTypes,u=Gr.fromNames(t.includeTypes),c=Gr.fromNames(s),l=Gr.isAll(u)&&0===c,d=e.child;if(!l||a||d)return function(f){if(d){var m=d.unitMap.get((p=n[f]).unitA);if(!m)return!0;var h=e.unitMap.get(p.unitA);if(!Ye.has(m.elements,h.elements[p.indexA]))return!0}if(a){var p,g=e.unitMap.get((p=n[f]).unitA),y=e.unitMap.get(p.unitB);if(Tl(e,g,g.elements[p.indexA],i)||Tl(e,y,y.elements[p.indexB],i))return!0}return!(l||!DD(u,c,n[f].props.flag))}}function sL(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId];if(Fe.isAtomic(u)){var c=o.target,l=u.bonds.a[i],d=u.bonds.b[i];return zt.Loci(c,[zt.Location(c,u,l,c,u,d),zt.Location(c,u,d,c,u,l)])}}return Wr}function uL(e,t,r,n){var a=!1;if(zt.isLoci(e)){var o=t.group;if(!Ze.areEquivalent(e.structure,t.structure))return!1;if(!Fe.isAtomic(s=o.units[0]))return!1;for(var u=2*s.bonds.edgeCount,c=0,l=e.bonds;c<l.length;c++){var d=l[c];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(void 0!==f){var p=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);-1!==p&&r(_e.ofSingleton(f*u+p))&&(a=!0)}}}}else if(Re.is(e)){var s;if(o=t.group,!Ze.areEquivalent(e.structure,t.structure))return!1;if(!Fe.isAtomic(s=o.units[0]))return!1;for(var m=2*s.bonds.edgeCount,h=function(x){var D=o.unitIndexMap.get(x.unit.id);if(void 0!==D){var w=s.bonds,A=w.offset,E=w.b;ke.forEach(x.indices,function(I){for(var M=A[I],F=A[I+1];M<F;M++)(!n||ke.has(x.indices,E[M]))&&r(_e.ofSingleton(D*m+M))&&(a=!0)})}},v=0,g=e.elements;v<g.length;v++)h(g[v])}return a}function cL(e,t,r){if(r===e.objectId){var i=t.target,o=t.interUnitBonds.edges[e.groupId],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return zt.Loci(i,[zt.Location(i,s,o.indexA,i,u,o.indexB),zt.Location(i,u,o.indexB,i,s,o.indexA)])}return Wr}T.getDefaultValues(oL),function(e){e.fromGroup=function t(n){var a=n.group,i=n.structure,o=a.units[0],s=Fe.isAtomic(o)?2*o.bonds.edgeCount:0,u=a.units.length,c=zt.Location(i,void 0,void 0,i,void 0,void 0);return On(s,u,1,function(d,f){var p=a.units[f];return c.aUnit=p,c.bUnit=p,c.aIndex=p.bonds.a[d],c.bIndex=p.bonds.b[d],c})},e.fromStructure=function r(n){var a=n.interUnitBonds.edgeCount,o=zt.Location(n,void 0,void 0,n,void 0,void 0);return On(a,1,1,function(u){var c=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(c.unitA),o.aIndex=c.indexA,o.bUnit=n.unitMap.get(c.unitB),o.bIndex=c.indexB,o},!0)}}(Vm||(Vm={}));var lL=new Map;function dL(e,t,r,n){var a=!1;if(zt.isLoci(e)){if(!Ze.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var u=t.interUnitBonds.getBondIndexFromLocation(o[i]);-1!==u&&r(_e.ofSingleton(u))&&(a=!0)}}else if(Re.is(e)){if(!Ze.areEquivalent(e.structure,t)||n&&1===e.elements.length)return!1;for(var c=0,l=e.elements;c<l.length;c++)lL.set((d=l[c]).unit.id,d.indices);for(var f=function(h){var v=h.unit;if(!Fe.isAtomic(v))return"continue";t.interUnitBonds.getConnectedUnits(v.id).forEach(function(g){var y=lL.get(g.unitB);(!n||y)&&ke.forEach(h.indices,function(S){g.connectedIndices.includes(S)&&g.getEdges(S).forEach(function(C){if(!n||y&&ke.has(y,C.indexB)){var _=t.interUnitBonds.getEdgeIndex(S,v.id,C.indexB,g.unitB);r(_e.ofSingleton(_))&&(a=!0)}})})})},p=0,m=e.elements;p<m.length;p++){var d;f(d=m[p])}lL.clear()}return a}var fL=Gr.is;function Tie(e,t,r,n){var M,a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,c=i.edgeProps,l=i.offset,d=c.order,f=c.flags,p=n.sizeFactor,m=n.sizeAspectRatio,h=n.adjustCylinderLength,v=n.aromaticBonds,y=n.excludeTypes,S=n.multipleBonds,C="off"===S,_="symmetric"===S,w=DD(Gr.fromNames(n.includeTypes),Gr.fromNames(y),32),A=b(),E=b(),I=e.conformation.invariantPosition,F=at.create(t,e),N=zt.Location(t,e,void 0,t,e,void 0),j=t.child;if(n.includeParent&&j){var U=j.unitMap.get(e.id);if(!U)throw new Error("expected childUnit to exist");M=function(Y){var W=a[u[Y]];return Ye.has(U.elements,a[s[Y]])&&!Ye.has(U.elements,W)}}var J=e.rings,X=J.elementRingIndices,Z=J.elementAromaticRingIndices,ne=v?e.resonance.delocalizedTriplets:void 0;return{linkCount:2*o,referencePosition:function(Y){var k,W,$=s[Y],K=u[Y],q=ne?.getThirdElement($,K);if(void 0!==q)return I(a[q],A);$>K&&($=(k=[K,$])[0],K=k[1]),l[$+1]-l[$]==1&&($=(W=[K,$])[0],K=W[1]);for(var V=Z.get($)||X.get($),ee=0,ae=l[$],pe=l[$+1];ae<pe;++ae){var me=u[ae];if(me!==K&&me!==$){if(!V)return I(a[me],A);var de=Z.get(me)||X.get(me);if(!de)continue;var re=Ew(V,de);re>ee&&(ee=re,I(a[me],A))}}return ee>0?A:null},position:function(Y,k,W){if(I(a[s[W]],Y),I(a[u[W]],k),h){var $=function(Y){return F.element=a[s[Y]],r.size.size(F)*p}(W),K=function(Y){return F.element=a[u[Y]],r.size.size(F)*p}(W),q=Math.min($,K)*m,V=Math.sqrt(Math.max(0,$*$-q*q))-.05,ee=Math.sqrt(Math.max(0,K*K-q*q))-.05;if(V<=.01&&ee<=.01)return;b.normalize(E,b.sub(E,k,Y)),b.scaleAndAdd(Y,Y,E,V),b.scaleAndAdd(k,k,E,-ee)}},style:function(Y){var k=d[Y],W=f[Y];if(fL(W,2)||fL(W,4))return 1;if(3===k)return C?0:_?4:5;if(v){var K=u[Y],q=Z.get(s[Y]),V=Z.get(K),ee=q&&V?Ew(q,V):0;if(fL(W,16)||ee&&!w)return 2===ee?8:7}return 2!==k||C?0:_?2:3},radius:function(Y){return function(Y){return N.aIndex=s[Y],N.bIndex=u[Y],r.size.size(N)*p}(Y)*m},ignore:wie(t,e,n),stub:M}}function ent(e,t,r,n,a,i){if(!Fe.isAtomic(t)||!t.bonds.edgeCount)return qu.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return qu.createEmpty(i);var c=Hne(0,Tie(t,r,n,a),a,i),l=c.cylinders,d=c.boundingSphere;if(d)l.setBoundingSphere(d);else if(l.cylinderCount>0){var f=Pe.expand(Pe(),(s??t).boundary.sphere,1*a.sizeFactor);l.setBoundingSphere(f)}return l}function tnt(e,t,r,n,a,i){if(!Fe.isAtomic(t)||!t.bonds.edgeCount)return Vt.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Vt.createEmpty(i);var c=Iv(0,Tie(t,r,n,a),a,i),l=c.mesh,d=c.boundingSphere;if(d)l.setBoundingSphere(d);else if(l.triangleCount>0){var f=Pe.expand(Pe(),(s??t).boundary.sphere,1*a.sizeFactor);l.setBoundingSphere(f)}return l}var ED=R(R(R(R({},qo),Une),iL),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:T.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:T.Boolean(!0),includeParent:T.Boolean(!1)});function Die(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function rnt(e){return Vne({defaultProps:T.getDefaultValues(ED),createGeometry:ent,createLocationIterator:Vm.fromGroup,getLoci:sL,eachLocation:uL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Es(r.includeTypes,n.includeTypes)||!Es(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Fe.isAtomic(u)&&Fe.isAtomic(c)&&(fu.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function nnt(e){return Ws({defaultProps:T.getDefaultValues(ED),createGeometry:tnt,createLocationIterator:Vm.fromGroup,getLoci:sL,eachLocation:uL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Es(r.includeTypes,n.includeTypes)||!Es(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Fe.isAtomic(u)&&Fe.isAtomic(c)&&(fu.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var pL=new zt.ElementBondIterator;function Eie(e,t,r,n){for(pL.setElement(t,r,n);pL.hasNext;){var a=pL.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var Iie=b();function Pie(e,t,r){var v,n=at.create(e),a=zt.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,c=r.sizeAspectRatio,l=r.adjustCylinderLength,d=r.aromaticBonds,f=r.multipleBonds,p="off"===f,m="symmetric"===f,h=b(),g=e.child;return r.includeParent&&g&&(v=function(_){var x=s[_],D=g.unitMap.get(x.unitA),w=g.unitMap.get(x.unitB),E=e.unitMap.get(x.unitA).elements[x.indexA],M=e.unitMap.get(x.unitB).elements[x.indexB];return D&&Ye.has(D.elements,E)&&(!w||!Ye.has(w.elements,M))}),{linkCount:o,referencePosition:function(_){var D,w,A,E,x=s[_];if(x.unitA<x.unitB)D=e.unitMap.get(x.unitA),w=e.unitMap.get(x.unitB),A=x.indexA,E=x.indexB;else{if(!(x.unitA>x.unitB))throw new Error("same units in createInterUnitBondCylinderMesh");D=e.unitMap.get(x.unitB),w=e.unitMap.get(x.unitA),A=x.indexB,E=x.indexA}return Eie(Iie,e,D,A)||Eie(Iie,e,w,E)},position:function(_,x,D){var w=s[D],A=e.unitMap.get(w.unitA),E=e.unitMap.get(w.unitB);if(A.conformation.position(A.elements[w.indexA],_),E.conformation.position(E.elements[w.indexB],x),l){var I=function(_){var x=s[_];return n.unit=e.unitMap.get(x.unitA),n.element=n.unit.elements[x.indexA],t.size.size(n)*u}(D),M=function(_){var x=s[_];return n.unit=e.unitMap.get(x.unitB),n.element=n.unit.elements[x.indexB],t.size.size(n)*u}(D),F=Math.min(I,M)*c,N=Math.sqrt(Math.max(0,I*I-F*F))-.05,j=Math.sqrt(Math.max(0,M*M-F*F))-.05;if(N<=.01&&j<=.01)return;b.normalize(h,b.sub(h,x,_)),b.scaleAndAdd(_,_,h,N),b.scaleAndAdd(x,x,h,-j)}},style:function(_){var x=s[_].props.order,D=Vo.create(s[_].props.flag);return Gr.is(D,2)||Gr.is(D,4)?1:3===x?p?0:m?4:5:d&&Gr.is(D,16)?7:2!==x||p?0:m?2:3},radius:function(_){return function(_){var x=s[_];return a.aUnit=e.unitMap.get(x.unitA),a.aIndex=x.indexA,a.bUnit=e.unitMap.get(x.unitB),a.bIndex=x.indexB,t.size.size(a)*u}(_)*c},ignore:Aie(e,r),stub:v}}function ant(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return qu.createEmpty(a);var o=Hne(0,Pie(t,r,n),n,a),s=o.cylinders,u=o.boundingSphere;if(u)s.setBoundingSphere(u);else if(s.cylinderCount>0){var c=t.child,l=Pe.expand(Pe(),(c??t).boundary.sphere,1*n.sizeFactor);s.setBoundingSphere(l)}return s}function int(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Vt.createEmpty(a);var o=Iv(0,Pie(t,r,n),n,a),s=o.mesh,u=o.boundingSphere;if(u)s.setBoundingSphere(u);else if(s.triangleCount>0){var c=t.child,l=Pe.expand(Pe(),(c??t).boundary.sphere,1*n.sizeFactor);s.setBoundingSphere(l)}return s}var ID=R(R(R(R({},Iy),zQe),iL),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:T.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:T.Boolean(!0),includeParent:T.Boolean(!1)});function Mie(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function ont(e){return function HQe(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:qu.Utils}),t)}({defaultProps:T.getDefaultValues(ID),createGeometry:ant,createLocationIterator:Vm.fromStructure,getLoci:cL,eachLocation:dL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Es(r.includeTypes,n.includeTypes)||!Es(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function snt(e){return fp({defaultProps:T.getDefaultValues(ID),createGeometry:int,createLocationIterator:Vm.fromStructure,getLoci:cL,eachLocation:dL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Es(r.includeTypes,n.includeTypes)||!Es(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var oC,unt=qe.add3,cnt=qe.add;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,c,l){unt(i,s,u,c),cnt(o,l)},getSpheres:function(){var s=qe.compact(i,!0),u=qe.compact(o,!0);return Cd.create(s,u,i.elementCount,a)}}}}(oC||(oC={}));var ro,Ly=b.add;function Nv(e,t,r){var n=r.ignoreHydrogens,a=r.ignoreHydrogensVariant,i=r.traceOnly,o=Fe.isCoarse(t),s=e.child,u=s?.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(s||n||i)return function(c){return!!u&&!Ye.has(u.elements,c)||!o&&n&&Tl(e,t,c,a)||i&&!xk(t,c)}}function lnt(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Vt.createEmpty(i);for(var u=a.detail,c=a.sizeFactor,l=a.stride,d=t.elements,f=d.length,p=f*kS(u),m=yt.createState(p,p/2,i),h=b(),v=t.conformation.invariantPosition,g=Nv(r,t,a),y=at.create(r,t),S=n.size.size,C=b(),_=0,x=0,D=0;D<f;D++)if(!(l&&D%l!=0||g&&g(d[D]))){v(d[D],h),Ly(C,C,h),x+=1,y.element=d[D];var w=S(y);w>_&&(_=w),m.currentGroup=D,Mi(m,h,w*c,u)}var I,A=i?Pe.clone(i.boundingSphere):void 0,E=yt.getMesh(m);return 0===x||(b.scale(C,C,1/x),I=A&&b.distance(C,A.center)/A.radius<.1?A:Pe.expand(Pe(),(s??t).boundary.sphere,_*c+.05),E.setBoundingSphere(I)),E}function dnt(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Cd.createEmpty(i);var u=a.sizeFactor,c=a.stride,l=t.elements,d=l.length,f=oC.create(d,d/2,i),p=b(),m=t.conformation.invariantPosition,h=Nv(r,t,a),v=at.create(r,t),g=n.size.size,y=b(),S=0,C=0;if(c&&c>1||h||"uniform"!==n.size.granularity){for(var _=0;_<d;_++)if(!(c&&_%c!=0||h&&h(l[_]))){m(l[_],p),f.add(p[0],p[1],p[2],_),Ly(y,y,p),C+=1,v.element=l[_];var x=g(v);x>S&&(S=x)}}else{for(_=0;_<d;_++)m(l[_],p),f.add(p[0],p[1],p[2],_),Ly(y,y,p);C=d,S=g(v)}var A,D=i?Pe.clone(i.boundingSphere):void 0,w=f.getSpheres();return 0===C||(b.scale(y,y,1/C),A=D&&b.distance(y,D.center)/D.radius<.1?D:Pe.expand(Pe(),(s??t).boundary.sphere,S*u+.05),w.setBoundingSphere(A)),w}function Rl(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ze.areEquivalent(e.structure,t.structure))return!1;for(var o=i.elements.length,s=i.unitIndexMap,u=0,c=e.elements;u<c.length;u++){var l=c[u],d=s.get(l.unit.id);if(void 0!==d){var f=d*o;if(_e.is(l.indices)){var p=f+_e.start(l.indices),m=f+_e.end(l.indices);r(_e.ofBounds(p,m))&&(n=!0)}else for(var h=0,v=l.indices.length;h<v;h++){p=l.indices[h];for(var g=h+1;g<v&&l.indices[g]===p;)g++;n=r(_e.ofRange(f+p,f+(m=l.indices[h=g-1])))||n}}}return n}function Ol(e,t,r){if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId],c=ke.ofSingleton(e.groupId);return Re(o.target,[{unit:u,indices:c}])}return Wr}function fnt(e,t,r,n,a){for(var i=t.child,o=n.detail,s=n.sizeFactor,u=n.stride,c=t.serialMapping.getSerialIndex,d=t.elementCount*kS(o),f=yt.createState(d,d/2,a),p=r.size.size,m=b(),h=0,v=0,g=0,y=t.units;g<y.length;g++){var S=y[g],C=i?.unitMap.get(S.id);if(!i||C)for(var _=S.elements,x=_.length,D=b(),w=S.conformation.position,A=Nv(t,S,n),E=at.create(t,S),I=0;I<x;I++){var M=_[I];if(!(u&&I%u!=0||A&&A(M))){w(M,D),Ly(m,m,D),v+=1,E.element=M;var F=p(E);F>h&&(h=F),f.currentGroup=c(S,M),Mi(f,D,F*s,o)}}}var U,N=a?Pe.clone(a.boundingSphere):void 0,j=yt.getMesh(f);return 0===v||(b.scale(m,m,1/v),U=N&&b.distance(m,N.center)/N.radius<1?N:Pe.expand(Pe(),(i??t).boundary.sphere,h*s+.05),j.setBoundingSphere(U)),j}function pnt(e,t,r,n,a){for(var i=t.child,o=n.sizeFactor,s=n.stride,u=t.serialMapping.getSerialIndex,c=t.elementCount,l=oC.create(c,c/2,a),d=r.size.size,f=b(),p=0,m=0,h=0,v=t.units;h<v.length;h++){var g=v[h],y=i?.unitMap.get(g.id);if(i&&!y)return Cd.createEmpty(a);var S=g.elements,C=S.length,_=b(),x=g.conformation.position,D=Nv(t,g,n),w=at.create(t,g);if(s&&s>1||D||"uniform"!==r.size.granularity)for(var A=0;A<C;A++){var E=S[A];if(!(s&&A%s!=0||D&&D(E))){x(E,_),l.add(_[0],_[1],_[2],u(g,E)),Ly(f,f,_),m+=1,w.element=E;var I=d(w);I>p&&(p=I)}}else{for(A=0;A<C;A++)x(E=S[A],_),l.add(_[0],_[1],_[2],u(g,E)),Ly(f,f,_);m+=C,p=d(w)}}var N,M=a?Pe.clone(a.boundingSphere):void 0,F=l.getSpheres();return 0===m||(b.scale(f,f,1/m),N=M&&b.distance(f,M.center)/M.radius<1?M:Pe.expand(Pe(),(i??t).boundary.sphere,p*o+.05),F.setBoundingSphere(N)),F}function kv(e,t,r){var n=!1;if(!Re.is(e)||!Ze.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(void 0!==u)if(_e.is(s.indices)){var c=a[u]+_e.start(s.indices),l=a[u]+_e.end(s.indices);r(_e.ofBounds(c,l))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++)r(_e.ofSingleton(a[u]+s.indices[d]))&&(n=!0)}return n}function Lv(e,t,r){var a=e.groupId;if(r===e.objectId){var i=t.serialMapping,u=i.unitIndices[a];return Re(t,[{unit:t.units[u],indices:ke.ofSingleton(a-i.cumulativeUnitElementCount[u])}])}return Wr}!function(e){e.fromGroup=function t(n){var a=n.group,o=a.elements.length,s=a.units.length,u=at.create(n.structure);return On(o,s,1,function(l,d){var f=a.units[d];return u.unit=f,u.element=f.elements[l],u})},e.fromStructure=function r(n){var a=n.units,o=n.elementCount,u=n.serialMapping,c=u.unitIndices,l=u.elementIndices,d=at.create(n);return On(o,1,1,function(p){return d.unit=a[c[p]],d.element=l[p],d},!0)}}(ro||(ro={}));var Rie={sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),traceOnly:T.Boolean(!1),tryUseImpostor:T.Boolean(!0),stride:T.Numeric(1,{min:1,max:100,step:1})},MD=R(R(R({},qo),kne),Rie);function Oie(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?function mnt(e){return Lne({defaultProps:T.getDefaultValues(MD),createGeometry:dnt,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function hnt(e){return Ws({defaultProps:T.getDefaultValues(MD),createGeometry:lnt,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var Fie=R(R(R({},Iy),VQe),Rie);function vnt(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?function gnt(e){return function GQe(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Cd.Utils}),t)}({defaultProps:T.getDefaultValues(Fie),createGeometry:pnt,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function ynt(e){return fp({defaultProps:T.getDefaultValues(Fie),createGeometry:fnt,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}var Bie={"element-sphere":function(e,t){return Oa("Element sphere",e,t,Oie)},"intra-bond":function(e,t){return Oa("Intra-unit bond cylinder",e,t,Die)},"inter-bond":function(e,t){return ec("Inter-unit bond cylinder",e,t,Mie)}},Nie=R(R(R(R(R({},MD),{traceOnly:T.Boolean(!1,{isHidden:!0})}),ED),ID),{includeParent:T.Boolean(!1),unitKinds:j2(["atomic"]),sizeFactor:T.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:T.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:T.MultiSelect(["element-sphere","intra-bond","inter-bond"],T.objectToOptions(Bie)),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory)}),Cnt={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:function Snt(e,t){return lr.createMulti("Ball & Stick",e,t,to,Bie)},getParams:function bnt(e,t){return Nie},defaultValues:T.getDefaultValues(Nie),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function xnt(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,c=at.create(t),d=Iv(0,{linkCount:o.length,position:function(h,v,g){var y=o[g];b.copy(h,s[y.carbohydrateIndexA].geometry.center),b.copy(v,s[y.carbohydrateIndexB].geometry.center)},radius:function(h){var g=s[o[h].carbohydrateIndexA],y=g.unit.rings.all[g.ringIndex];return c.unit=g.unit,c.element=g.unit.elements[y[0]],r.size.size(c)*u}},n,a),f=d.mesh,p=d.boundingSphere;if(p)f.setBoundingSphere(p);else if(f.triangleCount>0){var m=Pe.expand(Pe(),t.boundary.sphere,1*u);f.setBoundingSphere(m)}return f}var kie=R(R(R({},qo),Ev),{linkSizeFactor:T.Numeric(.3,{min:0,max:3,step:.01})});function _nt(e){return fp({defaultProps:T.getDefaultValues(kie),createGeometry:xnt,createLocationIterator:wnt,getLoci:Ant,eachLocation:Tnt,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function wnt(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,o=at.create(e);return On(a,1,1,function(u){var l=r[n[u].carbohydrateIndexA],d=l.unit.rings.all[l.ringIndex];return o.unit=l.unit,o.element=l.unit.elements[d[0]],o},!0)}function Ant(e,t,r){if(r===e.objectId){var i=t.carbohydrates,s=i.elements,u=i.links[e.groupId],c=s[u.carbohydrateIndexA],l=s[u.carbohydrateIndexB];return Re.union(H2(t,c.unit,c.residueIndex,c.altId),H2(t,l.unit,l.residueIndex,l.altId))}return Wr}var mL=new Set;function Tnt(e,t,r){var n=!1;if(!Re.is(e)||!Ze.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(d,f){if(!Fe.isAtomic(d))return"continue";mL.clear(),ke.forEach(f,function(p){for(var m=a(d,d.elements[p]),h=0,v=m.length;h<v;++h)mL.has(m[h])||(mL.add(m[h]),r(_e.ofSingleton(m[h]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o];i(u.unit,u.indices)}return n}var vL,gL,Dnt=b.create(0,0,-.5),RD=b.create(0,0,.5),Gm=b(),zm=b(),OD=b(),Lie=b();var wL,AL,Mnt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},bL=b.zero(),SL=b.zero(),CL=b.zero(),sC=b.zero(),xL=b.zero(),_L=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],Ont=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],Fnt=[0,2,4,0,4,3,1,2,5,1,5,3];NS(_L,[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5]);var qt=he.identity(),gp=b(),Vie=b(),Unt=1.612,Gie=f4(),zie=function qFe(){return p4||(p4=IK(!0)),p4}(),Vnt=function Ent(){return vL||(vL=function Uie(e){for(var t=e.length/3,n=(3===t?1:4===t?2:t)+t,i=H0(n,4===t?3*t+4:3*n),o=0;o<t;++o){var s=(o+1)%t;b.set(Gm,e[3*o],e[3*o+1],-.5),b.set(zm,e[3*s],e[3*s+1],-.5),i.add(Gm,zm,RD)}if(3===t)b.set(Gm,e[0],e[1],-.5),b.set(zm,e[3],e[4],-.5),b.set(OD,e[6],e[7],-.5),i.add(OD,zm,Gm);else if(4===t)b.set(Gm,e[0],e[1],-.5),b.set(zm,e[3],e[4],-.5),b.set(OD,e[6],e[7],-.5),b.set(Lie,e[9],e[10],-.5),i.addQuad(Lie,OD,zm,Gm);else for(o=0;o<t;++o)s=(o+1)%t,b.set(Gm,e[3*o],e[3*o+1],-.5),b.set(zm,e[3*s],e[3*s+1],-.5),i.add(Dnt,zm,Gm);return i.getPrimitive()}(hd(8,!0))),vL}(),Hie=function Int(){if(!gL){for(var e=hd(8,!0),t=new Float32Array(30),r=0;r<8;++r)t[3*r]=e[3*r],t[3*r+1]=e[3*r+1],t[3*r+2]=-.5;t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5,gL=vA(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return gL}(),Gnt=function Rnt(e){for(var t=R(R({},Mnt),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,s=H0(2*i*2),u=new Float32Array(2*i),c=new Float32Array(2*i),l=0;l<i;++l){var d=2*l,f=2*l+1,p=(d+1)/i*Math.PI,m=(f+1)/i*Math.PI;c[d]=Math.cos(p)*r,c[f]=Math.sin(p)*r,u[d]=Math.cos(m)*n,u[f]=Math.sin(m)*n}for(b.set(bL,0,0,a/2),b.set(SL,0,0,-a/2),l=0;l<i;++l){var h=(l+1)%i;b.set(CL,c[2*l],c[2*l+1],0),b.set(sC,u[2*l],u[2*l+1],0),b.set(xL,c[2*h],c[2*h+1],0),s.add(bL,CL,sC),s.add(sC,CL,SL),s.add(bL,sC,xL),s.add(xL,sC,SL)}return s.getPrimitive()}({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),znt=function Nnt(){return wL||(wL=vA(_L,Ont)),wL}(),jie=function knt(){return AL||(AL=vA(_L,Fnt)),AL}(),qie=function AFe(){return ZF||(ZF=W0(hd(4,!1))),ZF}(),Hnt=function TFe(){return QF||(QF=W0(hd(5,!1))),QF}(),jnt=function DFe(){return $F||($F=W0(hd(6,!1))),$F}(),qnt=function EFe(){return JF||(JF=W0(hd(6,!0))),JF}(),Wnt=function IFe(){return e4||(e4=W0(hd(7,!1))),e4}();function Ynt(e,t,r,n,a){for(var i=yt.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,c=u.elements.length,l=at.create(t),d=0;d<c;++d){var f=u.elements[d],p=f.unit.rings.all[f.ringIndex],m=oBe(f.component.type,p.length);l.unit=f.unit,l.element=f.unit.elements[p[0]];var h=r.size.size(l),v=h*s,g=h*s*Unt,y=f.geometry,S=y.center,C=y.normal;switch(b.add(Vie,S,y.direction),he.targetTo(qt,S,Vie,C),he.setTranslation(qt,S),i.currentGroup=2*d,m){case Pn.FilledSphere:Mi(i,S,v,o);break;case Pn.FilledCube:he.scaleUniformly(qt,qt,g),yt.addPrimitive(i,qt,Gie);break;case Pn.CrossedCube:he.scaleUniformly(qt,qt,g),yt.addPrimitive(i,qt,zie),he.mul(qt,qt,he.rotZ90X180),i.currentGroup+=1,yt.addPrimitive(i,qt,zie);break;case Pn.FilledCone:he.scaleUniformly(qt,qt,1.2*g),yt.addPrimitive(i,qt,Vnt);break;case Pn.DevidedCone:he.scaleUniformly(qt,qt,1.2*g),yt.addPrimitive(i,qt,Hie),he.mul(qt,qt,he.rotZ90),i.currentGroup+=1,yt.addPrimitive(i,qt,Hie);break;case Pn.FlatBox:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,g,g,g/2)),yt.addPrimitive(i,qt,Gie);break;case Pn.FilledStar:he.scaleUniformly(qt,qt,g),he.mul(qt,qt,he.rotZY90),yt.addPrimitive(i,qt,Gnt);break;case Pn.FilledDiamond:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,1.4*g,1.4*g,1.4*g)),yt.addPrimitive(i,qt,znt);break;case Pn.DividedDiamond:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,1.4*g,1.4*g,1.4*g)),yt.addPrimitive(i,qt,jie),he.mul(qt,qt,he.rotY90),i.currentGroup+=1,yt.addPrimitive(i,qt,jie);break;case Pn.FlatDiamond:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,g,g/2,g/2)),yt.addPrimitive(i,qt,qie);break;case Pn.DiamondPrism:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,g,g,g/2)),yt.addPrimitive(i,qt,qie);break;case Pn.PentagonalPrism:case Pn.Pentagon:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,g,g,g/2)),yt.addPrimitive(i,qt,Hnt);break;case Pn.HexagonalPrism:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,g,g,g/2)),yt.addPrimitive(i,qt,jnt);break;case Pn.HeptagonalPrism:he.mul(qt,qt,he.rotZY90),he.scale(qt,qt,b.set(gp,g,g,g/2)),yt.addPrimitive(i,qt,Wnt);break;default:he.mul(qt,qt,he.rotZYZ90),he.scale(qt,qt,b.set(gp,g/1.5,g,g/2)),yt.addPrimitive(i,qt,qnt)}}return yt.getMesh(i)}var Wie=R(R({},Iy),{detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo),sizeFactor:T.Numeric(1.75,{min:0,max:10,step:.01})});function Xnt(e){return fp({defaultProps:T.getDefaultValues(Wie),createGeometry:Ynt,createLocationIterator:Knt,getLoci:Znt,eachLocation:Qnt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Knt(e){var t=e.carbohydrates.elements,r=2*t.length,a=at.create(e);return On(r,1,1,function i(s,u){var c=t[Math.floor(s/2)],l=c.unit.rings.all[c.ringIndex];return a.unit=c.unit,a.element=c.unit.elements[l[0]],a},!0,function o(s,u){return s%2==1})}function Znt(e,t,r){if(r===e.objectId){var i=t.carbohydrates.elements[Math.floor(e.groupId/2)];return H2(t,i.unit,i.residueIndex,i.altId)}return Wr}var TL=new Set;function Qnt(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!Re.is(e)||!Ze.areEquivalent(e.structure,t))return!1;for(var i=function(d,f){if(!Fe.isAtomic(d))return"continue";TL.clear(),ke.forEach(f,function(p){for(var m=n(d,d.elements[p]),h=0,v=m.length;h<v;++h)TL.has(m[h])||(TL.add(m[h]),r(_e.ofSingleton(2*m[h]))&&(a=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o];i(u.unit,u.indices)}return a}function $nt(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,c=at.create(t),d=Iv(0,{linkCount:o.length,position:function(h,v,g){var y=o[g];y.fromCarbohydrate?(b.copy(h,s[y.carbohydrateIndex].geometry.center),y.elementUnit.conformation.position(y.elementUnit.elements[y.elementIndex],v)):(y.elementUnit.conformation.position(y.elementUnit.elements[y.elementIndex],h),b.copy(v,s[y.carbohydrateIndex].geometry.center))},radius:function(h){var v=o[h];if(v.fromCarbohydrate){var g=s[v.carbohydrateIndex],y=g.unit.rings.all[g.ringIndex];c.unit=g.unit,c.element=g.unit.elements[y[0]]}else c.unit=v.elementUnit,c.element=v.elementUnit.elements[v.elementIndex];return r.size.size(c)*u},style:function(h){var v=o[h],y=_d(v.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(v.elementUnit.elements[v.elementIndex]));return e2.has(y)?1:0}},n,a),f=d.mesh,p=d.boundingSphere;if(p)f.setBoundingSphere(p);else if(f.triangleCount>0){var m=Pe.expand(Pe(),t.boundary.sphere,1*u);f.setBoundingSphere(m)}return f}var Yie=R(R(R({},qo),Ev),{terminalLinkSizeFactor:T.Numeric(.2,{min:0,max:3,step:.01})});function Jnt(e){return fp({defaultProps:T.getDefaultValues(Yie),createGeometry:$nt,createLocationIterator:eat,getLoci:tat,eachLocation:rat,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function eat(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,o=at.create(e);return On(a,1,1,function(u){var c=n[u];if(c.fromCarbohydrate){var l=r[c.carbohydrateIndex],d=l.unit.rings.all[l.ringIndex];o.unit=l.unit,o.element=l.unit.elements[d[0]]}else o.unit=c.elementUnit,o.element=c.elementUnit.elements[c.elementIndex];return o},!0)}function tat(e,t,r){if(r===e.objectId){var i=t.carbohydrates,u=i.terminalLinks[e.groupId],c=i.elements[u.carbohydrateIndex];return Re.union(H2(t,c.unit,c.residueIndex,c.altId),function PQe(e,t,r){var n=t.elements,a=t.model,o=a.atomicHierarchy.atoms.label_alt_id.value(r);return-1!==ke.indexOf(n,r)?H2(e,t,a.atomicHierarchy.residueAtomSegments.index[r],o):Re(e,[])}(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return Wr}var DL=new Set;function rat(e,t,r){var n=!1;if(!Re.is(e)||!Ze.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(d,f){if(!Fe.isAtomic(d))return"continue";DL.clear(),ke.forEach(f,function(p){for(var m=a(d,d.elements[p]),h=0,v=m.length;h<v;++h)DL.has(m[h])||(DL.add(m[h]),r(_e.ofSingleton(m[h]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o];i(u.unit,u.indices)}return n}var Xie={"carbohydrate-symbol":function(e,t){return ec("Carbohydrate symbol mesh",e,t,Xnt)},"carbohydrate-link":function(e,t){return ec("Carbohydrate link cylinder",e,t,_nt)},"carbohydrate-terminal-link":function(e,t){return ec("Carbohydrate terminal link cylinder",e,t,Jnt)}},Kie=R(R(R(R({},Wie),kie),Yie),{visuals:T.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],T.objectToOptions(Xie)),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory)}),iat={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:function aat(e,t){return lr.createMulti("Carbohydrate",e,t,to,Xie)},getParams:function nat(e,t){return Kie},defaultValues:T.getDefaultValues(Kie),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return ar.hasCarbohydrate(t)})}};function Zie(e,t){switch(e.kind){case 0:return function oat(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=Cn.transientSegments(cC(e),e.elements),a=pr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,c=!0,l=-1,d=0;n.hasNext;){for(c=!0,l=d,a.setSegment(n.move());a.hasNext;){if(c){var f=a.move().index;if(++d,!a.hasNext)continue;c=!1,u=f}var p=a.move().index;t(i[s=u],i[u=p],d-1,d,o[s]),++d}r.has(u)&&(u=r.get(s=u),t(i[s],i[u],d-1,l,o[s]))}}(e,t);case 1:case 2:return function sat(e,t){for(var r=Cn.transientSegments(cC(e),e.elements),n=e.elements,a=!0,i=0;r.hasNext;){a=!0;for(var o=r.move(),c=o.start,l=o.end;c<l;++c){if(a){if(++i,++c>l)continue;a=!1}t(n[c-1],n[c],i-1,i,0),++i}}}(e,t)}}function Qie(e,t){switch(e.kind){case 0:return function uat(e,t){for(var r=Cn.transientSegments(cC(e),e.elements),n=pr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;)t(a[n.move().index],i),++i}(e,t);case 1:case 2:return function cat(e,t){for(var r=Cn.transientSegments(cC(e),e.elements),n=e.elements,a=0;r.hasNext;)for(var i=r.move(),u=i.start,c=i.end;u<c;++u)t(n[u],a),++a}(e,t)}}function $ie(e,t){return{centerA:at.create(e,t),centerB:at.create(e,t)}}var dat=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Cn.transientSegments(soe(r),r.elements),this.value=$ie(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),fat=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Cn.transientSegments(soe(r),r.elements),this.value=$ie(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function pat(e){for(var t=e.atomicConformation,r=t.x,n=t.y,a=t.z,i=e.atomicHierarchy.derived.residue,s=i.traceElementIndex,u=i.polymerType.length,c=ke.ofBounds(0,e.atomicConformation.atomId.rowCount),l=Cn.transientSegments(e.atomicRanges.polymerRanges,c),d=pr.transientSegments(e.atomicHierarchy.residueAtomSegments,c),f=new Float32Array(3*u),p=new Float32Array(3*u),m=0,h=-1,v=-1,g=b(),y=b(),S=b(),C=b(),_=b(),x=b(),D=b(),w=b(),A=b(),E=b(),I=b(),M=b(),F=b(),N=b();l.hasNext;){var j=l.move();for(d.setSegment(j),m=-1,v=-1;d.hasNext;){m+=1;var U=d.move().index;0===m&&(v=U);var H=3*(h=U-2);b.copy(g,y),b.copy(y,S),b.copy(S,C);var z=s[U];if(b.set(C,r[z],n[z],a[z]),!(m<3)){b.sub(_,y,g),b.sub(x,S,y),b.sub(D,C,S),b.sub(I,_,x),b.sub(M,x,D),b.cross(F,I,M),b.normalize(F,F),b.toArray(F,p,H);var G=Math.cos(b.angle(I,M)),J=b.magnitude(I),X=b.magnitude(M),Z=Math.sqrt(X*J)/Math.max(2,2*(1-G));b.scale(w,I,Z/J),b.sub(w,y,w),b.toArray(w,f,H),b.scale(A,M,Z/X),b.sub(A,S,A),b.toArray(A,f,H+3),b.copy(N,F)}}var ne=3*v;b.fromArray(w,f,ne+3),b.fromArray(A,f,ne+6),b.normalize(F,b.sub(F,w,A));var Y=s[v];b.set(g,r[Y],n[Y],a[Y]),b.copy(E,g),b.projectPointOnVector(E,E,F,w),b.toArray(E,f,ne);var k=h+2,W=3*k;b.fromArray(w,f,W-3),b.fromArray(A,f,W-6),b.normalize(F,b.sub(F,w,A));var $=s[k];b.set(g,r[$],n[$],a[$]),b.copy(E,g),b.projectPointOnVector(E,E,F,w),b.toArray(E,f,W)}return{centers:f}}var EL=iv.createProvider({label:"Helix Orientation",descriptor:Hu({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ue(void 0,void 0,void 0,function(){return ce(this,function(r){return[2,{value:pat(t)}]})})}});function Fl(e){return sn.is(e,2)}function IL(e,t,r){switch(void 0===r&&(r={}),e.kind){case 0:return new hat(e,t,r);case 1:case 2:return new vat(e,t)}}var FD=sn.create(536870912);function Jie(e,t){return{center:at.create(e,t),centerPrev:at.create(e,t),centerNext:at.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:FD,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:b(),p1:b(),p2:b(),p3:b(),p4:b(),d12:b(),d23:b()}}var nr=b(),BD=b(),ND=b(),hat=function(){function e(t,r,n){var a;if(void 0===n&&(n={}),this.unit=t,this.state=0,this.p0=b(),this.p1=b(),this.p2=b(),this.p3=b(),this.p4=b(),this.p5=b(),this.p6=b(),this.d01=b(),this.d12=b(),this.d23=b(),this.d34=b(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Cn.transientSegments(this.polymerRanges,t.elements),this.residueIt=pr.transientSegments(this.residueAtomSegments,t.elements),this.value=Jie(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=null===(a=Oc.get(r).value)||void 0===a?void 0:a.get(t.invariantId)),n.useHelixOrientation){var i=EL.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}return e.prototype.atomicPos=function(t,r){-1!==r&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var a=this.traceElementIndex[r];this.helixOrientationCenters&&Fl(n)?b.fromArray(t,this.helixOrientationCenters,3*r):this.atomicPos(t,a)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[2*t.index]],this.residueSegmentMax=r[this.polymerRanges[2*t.index+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin)t=void 0!==(r=this.cyclicPolymerMap.get(this.residueSegmentMin))?r-(this.residueSegmentMin-t-1):this.residueSegmentMin;else if(t>this.residueSegmentMax){var r;t=void 0!==(r=this.cyclicPolymerMap.get(this.residueSegmentMax))?r+(t-this.residueSegmentMax-1):this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,i=r.type[(0,r.getIndex)(t)];return Fl(i)?2:i}return FD},e.prototype.setControlPoint=function(t,r,n,a,i){(function mat(e){return sn.is(e,4)})(i)||this.helixOrientationCenters&&Fl(i)?b.scale(t,b.add(t,r,b.add(t,a,b.add(t,n,n))),1/4):b.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&Fl(n)?b.set(t,1,0,0):(this.atomicPos(BD,this.directionFromElementIndex[r]),this.atomicPos(ND,this.directionToElementIndex[r]),b.sub(t,ND,BD))},e.prototype.setDirection=function(t,r,n,a){b.matchDirection(BD,r,n),b.matchDirection(ND,a,n),b.scale(t,b.add(t,BD,b.add(t,ND,b.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(0===this.state)for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?FD:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=-1===this.directionFromElementIndex[o]||-1===this.directionToElementIndex[o],this.nextCoarseBackbone=-1===this.directionFromElementIndex[i]||-1===this.directionToElementIndex[i];break}if(1===this.state){var s=r.move().index,u=this.getResidueIndex(s-3),c=this.getResidueIndex(s-2),l=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),p=this.getResidueIndex(s+3);this.prevSecStrucType=this.getSecStruc(l),this.currSecStrucType=this.getSecStruc(s),this.nextSecStrucType=s===d?FD:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=-1===this.directionFromElementIndex[d]||-1===this.directionToElementIndex[d],a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.initial=s===l,a.final=s===d,a.centerPrev.element=this.traceElementIndex[l],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[d];var m=this.getSecStruc(u),h=this.getSecStruc(c),v=this.getSecStruc(l),g=this.getSecStruc(s),y=this.getSecStruc(d),S=this.getSecStruc(f),C=this.getSecStruc(p);this.pos(this.p0,u,m),this.pos(this.p1,c,h),this.pos(this.p2,l,v),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,S),this.pos(this.p6,p,C);var _=Fl(m),x=Fl(h),D=Fl(v),w=Fl(g),A=Fl(y),E=Fl(S),I=Fl(C);this.helixOrientationCenters&&(w!==D?w?(b.copy(this.p0,this.p3),b.copy(this.p1,this.p3),b.copy(this.p2,this.p3)):D&&(b.scale(nr,b.sub(nr,this.p2,this.p3),2),b.add(this.p2,this.p3,nr),b.add(this.p1,this.p2,nr),b.add(this.p0,this.p1,nr)):w!==x?w?(b.copy(this.p0,this.p2),b.copy(this.p1,this.p2)):x&&(b.scale(nr,b.sub(nr,this.p1,this.p2),2),b.add(this.p1,this.p2,nr),b.add(this.p0,this.p1,nr)):w!==_&&(w?b.copy(this.p0,this.p1):_&&(b.scale(nr,b.sub(nr,this.p0,this.p1),2),b.add(this.p0,this.p1,nr))),w!==A?w?(b.copy(this.p4,this.p3),b.copy(this.p5,this.p3),b.copy(this.p6,this.p3)):A&&(b.scale(nr,b.sub(nr,this.p4,this.p3),2),b.add(this.p4,this.p3,nr),b.add(this.p5,this.p4,nr),b.add(this.p6,this.p5,nr)):w!==E?w?(b.copy(this.p5,this.p4),b.copy(this.p6,this.p4)):E&&(b.scale(nr,b.sub(nr,this.p5,this.p4),2),b.add(this.p5,this.p4,nr),b.add(this.p6,this.p5,nr)):w!==I&&(w?b.copy(this.p6,this.p5):I&&(b.scale(nr,b.sub(nr,this.p6,this.p5),2),b.add(this.p6,this.p5,nr)))),this.setFromToVector(this.d01,l,v),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,S);var M=w&&this.helixOrientationCenters,F=1.5;s===l||g!==v&&M?(b.setMagnitude(nr,b.sub(nr,this.p3,this.p4),F),b.add(this.p2,this.p3,nr),b.add(this.p1,this.p2,nr),b.add(this.p0,this.p1,nr)):l===c||g!==h&&M?(b.setMagnitude(nr,b.sub(nr,this.p2,this.p3),F),b.add(this.p1,this.p2,nr),b.add(this.p0,this.p1,nr)):(c===u||g!==m&&M)&&(b.setMagnitude(nr,b.sub(nr,this.p1,this.p2),F),b.add(this.p0,this.p1,nr)),s===d||g!==y&&M?(b.setMagnitude(nr,b.sub(nr,this.p3,this.p2),F),b.add(this.p4,this.p3,nr),b.add(this.p5,this.p4,nr),b.add(this.p6,this.p5,nr)):d===f||g!==S&&M?(b.setMagnitude(nr,b.sub(nr,this.p4,this.p3),F),b.add(this.p5,this.p4,nr),b.add(this.p6,this.p5,nr)):(f===p||g!==C&&M)&&(b.setMagnitude(nr,b.sub(nr,this.p5,this.p4),F),b.add(this.p6,this.p5,nr)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,h),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,v),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,S),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),vat=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Cn.transientSegments(cC(t),t.elements),this.value=Jie(r,t),b.set(this.value.d12,1,0,0),b.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(0===this.state)for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}if(1===this.state){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(b.scale(nr,b.sub(nr,this.value.p2,this.value.p3),i),b.add(this.value.p1,this.value.p2,nr),b.add(this.value.p0,this.value.p1,nr)):r===t&&(b.scale(nr,b.sub(nr,this.value.p1,this.value.p2),i),b.add(this.value.p0,this.value.p1,nr)),this.elementIndex===n?(b.scale(nr,b.sub(nr,this.value.p2,this.value.p1),i),b.add(this.value.p3,this.value.p2,nr),b.add(this.value.p4,this.value.p3,nr)):n===a&&(b.scale(nr,b.sub(nr,this.value.p3,this.value.p2),i),b.add(this.value.p4,this.value.p3,nr)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),Uv=b.fromArray,Uy=b.toArray,PL=b.normalize,gat=b.sub,Vy=b.spline,yat=b.slerp,eoe=b.copy,toe=b.cross,ML=b.orthogonalize,bat=b.matchDirection,Sat=b.scale,roe=b.add;function RL(e){var t=e+1,r=3*t;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function OL(e,t,r,n){(function Cat(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,c=t.p2,l=t.p3,d=t.p4,m=1-n,h=t.secStrucFirst?.5:r,v=t.secStrucLast?.5:r,g=0;g<=o;++g){var y=1*g/o;if(y<m){var S=ta(h,r,y);Vy(NL,s,u,c,l,y+n,S),Vy(FL,s,u,c,l,y+n+.01,h),Vy(BL,s,u,c,l,y+n-.01,h)}else S=ta(r,v,y),Vy(NL,u,c,l,d,y-m,S),Vy(FL,u,c,l,d,y-m+.01,S),Vy(BL,u,c,l,d,y-m-.01,S);Uy(NL,a,3*g),PL(Hm,gat(Hm,FL,BL)),Uy(Hm,i,3*g)}})(e,t,r,n),function _at(e,t){var n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=e.curvePoints.length/3;Uv(aoe,n,0),Uv(ioe,n,3*(u-1)),ML(kL,aoe,o),ML(kD,ioe,s),bat(kD,kD,kL),eoe(uC,kL);for(var c=u-1,l=0;l<u;++l){var d=kq(0,c,l)*c,f=0===l?0:1/(u-d);Uv(Hm,n,3*l),ML(Bl,Hm,yat(xat,uC,kD,f)),Uy(Bl,a,3*l),eoe(uC,Bl),PL(Gy,toe(Gy,Hm,Bl)),Uy(Gy,i,3*l)}for(l=1;l<c;++l)Uv(uC,a,3*(l-1)),Uv(Bl,a,3*l),Uv(noe,a,3*(l+1)),Sat(Bl,roe(Bl,uC,roe(Bl,noe,Bl)),1/3),Uy(Bl,a,3*l),Uv(Hm,n,3*l),PL(Gy,toe(Gy,Hm,Bl)),Uy(Gy,i,3*l)}(e,t)}var FL=b(),BL=b(),NL=b(),xat=b(),Hm=b(),Bl=b(),Gy=b(),uC=b(),noe=b(),aoe=b(),ioe=b(),kL=b(),kD=b();function LL(e,t,r,n,a,i,o,s){for(var u=e.widthValues,c=e.heightValues,l=e.linearSegments,d=1-s,f=0;f<=l;++f){var p=1*f/l;p<d?(u[f]=ta(t,r,p+s),c[f]=ta(a,i,p+s)):(u[f]=ta(r,n,p-d),c[f]=ta(i,o,p-d))}}var yp,UL,GD,ooe=.5,wat=.9,LD=.5,UD=.3,VD=2;function cC(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function soe(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}function Vv(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId];if(Fe.isAtomic(u))return wne(o,u,u.polymerElements[i]);var d=ke.indexOf(u.elements,u.polymerElements[i]);if(-1!==d)return Re(o,[{unit:u,indices:ke.ofSingleton(d)}])}return Wr}function uoe(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++)if(!((c=r[u])<0)&&(o=ke.indexOf(t,c))>=0){s=u;break}if(o<0)return!1;var l=o;for(u=i;u>s;u--){var c;if(!((c=r[u])<0)){var d=ke.indexOf(t,c);if(d>=0){l=d;break}}}return n(_e.ofRange(e+o,e+l))}function coe(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,c=r(a.unit);if(_e.is(a.indices))i=0===_e.start(a.indices)&&_e.end(a.indices)===a.unit.elements.length?n(_e.ofBounds(e,e+t))||i:uoe(e,c,s,n,l=u[o[_e.min(a.indices)]],d=u[o[_e.max(a.indices)]])||i;else for(var f=a.indices,p=0,m=f.length;p<m;p++){for(var l,d=l=u[o[f[p]]],h=p+1;h<m;){var v=u[o[f[h]]];if(v-d>1)break;d=v,h++}p=h-1,i=uoe(e,c,s,n,l,d)||i}return i}function Aat(e){return e.polymerElements}function Gv(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ze.areEquivalent(e.structure,t.structure))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var c=u[s];if(i.unitIndexMap.has(c.unit.id)){var l=i.unitIndexMap.get(c.unit.id)*o;if(Fe.isAtomic(c.unit))n=coe(l,o,Aat,r,c)||n;else if(_e.is(c.indices)){var d=l+_e.start(c.indices),f=l+_e.end(c.indices);n=r(_e.ofBounds(d,f))||n}else for(var p=0,m=c.indices.length;p<m;p++){d=c.indices[p];for(var h=p+1;h<m&&c.indices[h]===d;)h++;n=r(_e.ofRange(l+d,l+(f=c.indices[p=h-1])))||n}}}return n}function Tat(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId],c=ke.indexOf(u.elements,u.gapElements[i]),l=ke.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(-1!==c&&-1!==l)return zt.Loci(o,[zt.Location(o,u,c,o,u,l),zt.Location(o,u,l,o,u,c)])}return Wr}function Dat(e,t,r){var n=!1;if(zt.isLoci(e)){var i=t.group;if(!Ze.areRootsEquivalent(e.structure,a=t.structure))return!1;e=zt.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var c=u[s],l=i.unitIndexMap.get(c.aUnit.id);if(void 0!==l){var d=ke.indexOf(c.aUnit.gapElements,c.aUnit.elements[c.aIndex]),f=ke.indexOf(c.bUnit.gapElements,c.bUnit.elements[c.bIndex]);-1!==d&&-1!==f&&r(_e.ofSingleton(l*o+d))&&(n=!0)}}}else if(Re.is(e)){var a;if(i=t.group,!Ze.areRootsEquivalent(e.structure,a=t.structure))return!1;e=Re.remap(e,a);for(var p=i.units[0].gapElements.length,m=function(C){var _=i.unitIndexMap.get(C.unit.id);void 0!==_&&ke.forEach(C.indices,function(x){var D=ke.indexOf(C.unit.gapElements,C.unit.elements[x]);-1!==D&&r(_e.ofSingleton(_*p+D))&&(n=!0)})},h=0,v=e.elements;h<v.length;h++)m(v[h])}return n}function loe(e,t,r){var i=e.groupId;if(r===e.objectId){var o=t.structure,u=t.group.units[e.instanceId];if(Fe.isAtomic(u))return wne(o,u,u.nucleotideElements[i])}return Wr}function Eat(e){return e.nucleotideElements}function doe(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ze.areEquivalent(e.structure,t.structure))return!1;var o=i.units[0];if(!Fe.isAtomic(o))return!1;for(var u=o.nucleotideElements.length,c=0,l=e.elements;c<l.length;c++){var d=l[c];if(Fe.isAtomic(d.unit)&&i.unitIndexMap.has(d.unit.id)){var f=i.unitIndexMap.get(d.unit.id)*u;Fe.isAtomic(d.unit)&&(n=coe(f,u,Eat,r,d)||n)}}return n}!function(e){e.fromGroup=function t(r,n){void 0===n&&(n=!1);var a=r.group,o=a.units[0].polymerElements,s=o.length,u=a.units.length,c=at.create(r.structure);return On(s,u,1,function(f,p){return c.unit=a.units[p],c.element=o[f],c},!1,function d(f,p){return n})}}(yp||(yp={})),function(e){e.fromGroup=function t(r){var n=r.group,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=at.create(r.structure);return On(o,s,1,function(l,d){return u.unit=n.units[d],u.element=i[l],u})}}(UL||(UL={})),function(e){e.fromGroup=function t(r){var n=r.group,a=r.structure,i=n.units[0],o=Fe.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,c=at.create(a);return On(s,u,1,function(d,f){return c.unit=n.units[f],c.element=o[d],c})}}(GD||(GD={}));var lC=b(),zD=b(),foe=b(),poe=b(),moe=b(),hoe=b(),HD=b(),VL=b(),GL=b(),voe=b(),dC=he.identity(),Iat=b(),goe=f4(),yoe={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo)};function Pat(e,t,r,n,a,i){if(!Fe.isAtomic(t))return Vt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Vt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=o*(goe.vertices.length/3+2*u),l=yt.createState(c,c/4,i),d=t.elements,f=t.model,p=f.atomicHierarchy,h=p.residueAtomSegments,g=p.index,y=f.atomicHierarchy.derived.residue,S=y.moleculeType,C=y.traceElementIndex,_=p.atoms.label_comp_id,x=t.conformation.invariantPosition,D=pr.transientSegments(p.chainAtomSegments,d),w=pr.transientSegments(h,d),A={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},E=0;D.hasNext;)for(w.setSegment(D.move());w.hasNext;){var I=w.move().index;if(xd(S[I])){var M=_.value(h.offsets[I]),F=-1,N=-1,j=-1,U=-1,H=-1,z=-1,J=2.5*s,X=4.5,Z=oZ(M),ne=sZ(M);if(!Z&&!ne){var Y=g.findAtomOnResidue(I,"C4"),k=g.findAtomOnResidue(I,"N9");-1!==Y&&-1!==k&&b.distance(x(Y,lC),x(k,zD))<1.6?Z=!0:ne=!0}Z?(X=4.5,F=g.findAtomOnResidue(I,"N1"),N=g.findAtomOnResidue(I,"C4"),j=g.findAtomOnResidue(I,"C6"),U=g.findAtomOnResidue(I,"C2"),H=g.findAtomOnResidue(I,"N9"),z=C[I]):ne&&(X=3,F=g.findAtomOnResidue(I,"N3"),N=g.findAtomOnResidue(I,"C6"),j=g.findAtomOnResidue(I,"C4"),U=g.findAtomOnResidue(I,"C2"),-1===(H=g.findAtomOnResidue(I,"N1"))&&(H=g.findAtomOnResidue(I,"C1")),z=C[I]),-1!==H&&-1!==z&&(x(H,moe),x(z,hoe),l.currentGroup=E,yo(l,moe,hoe,1,A),-1!==F&&-1!==N&&-1!==j&&-1!==U&&(x(F,lC),x(N,zD),x(j,foe),x(U,poe),b.normalize(HD,b.sub(HD,zD,lC)),b.normalize(VL,b.sub(VL,poe,foe)),b.normalize(GL,b.cross(GL,HD,VL)),he.targetTo(dC,lC,zD,GL),b.scaleAndAdd(voe,lC,HD,X/2-.2),he.scale(dC,dC,b.set(Iat,4.5,J,X)),he.setTranslation(dC,voe),yt.addPrimitive(l,dC,goe))),++E}}var W=yt.getMesh(l),$=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return W.setBoundingSphere($),W}T.getDefaultValues(yoe);var boe=R(R({},qo),yoe);function Mat(e){return Ws({defaultProps:T.getDefaultValues(boe),createGeometry:Pat,createLocationIterator:GD.fromGroup,getLoci:loe,eachLocation:doe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var jD=b.zero(),jm=b.zero(),qD=b.zero(),WD=b.zero(),zv=b.zero(),zy=b.zero(),YD=b.zero(),Soe=b.zero(),Coe=b.zero(),fC=b.zero(),qm=b.zero(),xoe={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo)},XD=(T.getDefaultValues(xoe),new Float32Array(54)),Rat=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Oat=new Uint32Array([8,12,14,16,6,4,2,0,10]),Fat=new Uint32Array([9,11,1,3,5,7,17,15,13]),KD=new Float32Array(36),Bat=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Nat=new Uint32Array([0,10,8,6,4,2]),kat=new Uint32Array([1,3,5,7,9,11]),_oe=b.zero();function woe(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];b.toArray(b.add(_oe,o,t),e,2*a*3),b.toArray(b.sub(_oe,o,t),e,3*(2*a+1))}}function Lat(e,t,r,n,a,i){if(!Fe.isAtomic(t))return Vt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Vt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=a.detail,l=o*(26+2*u),d=yt.createState(l,l/4,i),f=t.elements,p=t.model,m=p.atomicHierarchy,v=m.residueAtomSegments,y=m.index,S=p.atomicHierarchy.derived.residue,C=S.moleculeType,_=S.traceElementIndex,x=m.atoms.label_comp_id,D=t.conformation.invariantPosition,w=pr.transientSegments(m.chainAtomSegments,f),A=pr.transientSegments(v,f),E=1*s,I=1.25*s,M={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},F=0;w.hasNext;)for(A.setSegment(w.move());A.hasNext;){var N=A.move().index;if(xd(C[N])){var j=x.value(v.offsets[N]),U=-1,H=-1,z=-1,G=-1,J=-1,X=-1,Z=-1,ne=-1,Y=-1,k=-1;d.currentGroup=F;var W=oZ(j),$=sZ(j);if(!W&&!$){var K=y.findAtomOnResidue(N,"C4"),q=y.findAtomOnResidue(N,"N9");-1!==K&&-1!==q&&b.distance(D(K,zv),D(q,fC))<1.6?W=!0:$=!0}W?(U=_[N],H=y.findAtomOnResidue(N,"N1"),z=y.findAtomOnResidue(N,"C2"),G=y.findAtomOnResidue(N,"N3"),J=y.findAtomOnResidue(N,"C4"),-1===(X=y.findAtomOnResidue(N,"C5"))&&(X=y.findAtomOnResidue(N,"N5")),Z=y.findAtomOnResidue(N,"C6"),-1===(ne=y.findAtomOnResidue(N,"N7"))&&(ne=y.findAtomOnResidue(N,"C7")),Y=y.findAtomOnResidue(N,"C8"),-1!==(k=y.findAtomOnResidue(N,"N9"))&&-1!==U&&(D(k,fC),D(U,jD),d.currentGroup=F,yo(d,fC,jD,1,M),Mi(d,fC,E,c)),-1!==H&&-1!==z&&-1!==G&&-1!==J&&-1!==X&&-1!==Z&&-1!==ne&&-1!==Y&&-1!==k&&(D(H,jm),D(z,qD),D(G,WD),D(J,zv),D(X,zy),D(Z,YD),D(ne,Soe),D(Y,Coe),b.triangleNormal(qm,jm,zv,zy),b.scale(qm,qm,I),woe(XD,qm,jm,qD,WD,zv,zy,YD,Soe,Coe,fC),yt.addTriangleStrip(d,XD,Rat),yt.addTriangleFan(d,XD,Oat),yt.addTriangleFan(d,XD,Fat))):$&&(U=_[N],-1===(H=y.findAtomOnResidue(N,"N1"))&&(H=y.findAtomOnResidue(N,"C1")),z=y.findAtomOnResidue(N,"C2"),G=y.findAtomOnResidue(N,"N3"),J=y.findAtomOnResidue(N,"C4"),X=y.findAtomOnResidue(N,"C5"),Z=y.findAtomOnResidue(N,"C6"),-1!==H&&-1!==U&&(D(H,jm),D(U,jD),d.currentGroup=F,yo(d,jm,jD,1,M),Mi(d,jm,E,c)),-1!==H&&-1!==z&&-1!==G&&-1!==J&&-1!==X&&-1!==Z&&(D(z,qD),D(G,WD),D(J,zv),D(X,zy),D(Z,YD),b.triangleNormal(qm,jm,zv,zy),b.scale(qm,qm,I),woe(KD,qm,jm,qD,WD,zv,zy,YD),yt.addTriangleStrip(d,KD,Bat),yt.addTriangleFan(d,KD,Nat),yt.addTriangleFan(d,KD,kat))),++F}}var V=yt.getMesh(d),ee=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return V.setBoundingSphere(ee),V}var Aoe=R(R({},qo),xoe);function Uat(e){return Ws({defaultProps:T.getDefaultValues(Aoe),createGeometry:Lat,createLocationIterator:GD.fromGroup,getLoci:loe,eachLocation:doe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var zL,Hv=b.zero(),Hy=b.zero(),jv=b.zero(),Toe=b.zero(),Ui=hd(3,!1),qv=he.identity(),zat=b.zero(),Doe=b.zero(),Eoe=b.zero(),jL=b.zero(),Hat=4,jat=4,qat=6,Wat=function Gat(){return zL||(zL=function Vat(){for(var e=H0(8),t=0;t<3;++t){var r=(t+1)%3;b.set(Hv,Ui[3*t],Ui[3*t+1],-.5),b.set(Hy,Ui[3*r],Ui[3*r+1],-.5),b.set(jv,Ui[3*r],Ui[3*r+1],.5),b.set(Toe,Ui[3*t],Ui[3*t+1],.5),e.add(Hv,Hy,jv),e.add(jv,Toe,Hv)}return b.set(Hv,Ui[0],Ui[1],-.5),b.set(Hy,Ui[3],Ui[4],-.5),b.set(jv,Ui[6],Ui[7],-.5),e.add(jv,Hy,Hv),b.set(Hv,Ui[0],Ui[1],.5),b.set(Hy,Ui[3],Ui[4],.5),b.set(jv,Ui[6],Ui[7],.5),e.add(Hv,Hy,jv),e.getPrimitive()}()),zL}(),Ioe={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01})};function Yat(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Vt.createEmpty(i);for(var s=a.sizeFactor,u=24*o,c=yt.createState(u,u/10,i),d=RL(1),f=d.normalVectors,p=d.binormalVectors,m=0,h=IL(t,r);h.hasNext;){var v=h.move();c.currentGroup=m;var g=xd(v.moleculeType),y=sn.is(v.secStrucType,4);if(OL(d,v,g||y?.5:.9,g?.3:.5),y&&!v.secStrucLast||!y){var _=n.size.size(v.center)*s,x=Hat*_,D=jat*_,w=qat*_,A=g?p:f;b.fromArray(Doe,A,0),b.fromArray(Eoe,A,3),b.normalize(jL,b.add(jL,Doe,Eoe)),he.targetTo(qv,v.p3,v.p1,jL),he.mul(qv,qv,he.rotY90Z180),he.scale(qv,qv,b.set(zat,w,D,x)),he.setTranslation(qv,v.p2),yt.addPrimitive(c,qv,Wat)}++m}var E=yt.getMesh(c),I=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return E.setBoundingSphere(I),E}T.getDefaultValues(Ioe);var Poe=R(R({},qo),Ioe);function Xat(e){return Ws({defaultProps:T.getDefaultValues(Poe),createGeometry:Yat,createLocationIterator:yp.fromGroup,getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var qL=10,Moe={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo)};function Kat(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return Vt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=qL*u*2*o*2,l=yt.createState(c,c/10,i),d=t.conformation.invariantPosition,f=b.zero(),p=b.zero(),m={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},h=0,v=function lat(e,t){switch(t.kind){case 0:return new dat(e,t);case 1:case 2:return new fat(e,t)}}(r,t);v.hasNext;){var g=v.move(),y=g.centerA,S=g.centerB;y.element===S.element||(d(y.element,f),d(S.element,p),m.radiusTop=m.radiusBottom=n.size.size(y)*s,l.currentGroup=h,VS(l,f,p,.5,qL,!1,m),m.radiusTop=m.radiusBottom=n.size.size(S)*s,l.currentGroup=h+1,VS(l,p,f,.5,qL,!1,m)),h+=2}var C=yt.getMesh(l),_=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return C.setBoundingSphere(_),C}T.getDefaultValues(Moe);var ZD=R(R({},qo),Moe);function WL(e){return Ws({defaultProps:T.getDefaultValues(ZD),createGeometry:Kat,createLocationIterator:UL.fromGroup,getLoci:Tat,eachLocation:Dat,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Jr=b(),_n=b(),Zat=b(),rc=b(),Hd=b(),QD=b(),$D=b(),pC=b(),Nl=b(),jd=b(),YL=b(),Wm=b(),Ym=b(),Xm=b(),Km=b(),Wc=b.fromArray,jy=b.scale,Yc=b.add,bp=b.sub,Qat=b.magnitude,Roe=b.negate,XL=b.copy,Ooe=b.cross,$at=b.set,Rn=qe.add3,Jat=qe.add;function JD(e,t,r,n,a,i,o,s,u){var c=t.vertices,l=t.normals,d=t.indices,f=c.elementCount;if(Wc(Jr,n,e),jy($D,Jr,o),jy(QD,Jr,s),Wc(_n,a,e),jy(rc,_n,i),Ooe(jd,_n,Jr),Wc(Nl,r,e),Yc(Wm,Yc(Wm,Nl,rc),QD),bp(Ym,Yc(Ym,Nl,rc),$D),bp(Xm,bp(Xm,Nl,rc),$D),Yc(Km,bp(Km,Nl,rc),QD),o<s?(Rn(c,Km[0],Km[1],Km[2]),Rn(c,Xm[0],Xm[1],Xm[2]),Rn(c,Ym[0],Ym[1],Ym[2]),Rn(c,Wm[0],Wm[1],Wm[2]),XL(Hd,QD)):(Rn(c,Wm[0],Wm[1],Wm[2]),Rn(c,Ym[0],Ym[1],Ym[2]),Rn(c,Xm[0],Xm[1],Xm[2]),Rn(c,Km[0],Km[1],Km[2]),XL(Hd,$D)),u){for(var p=0;p<4;++p)Rn(l,-jd[0],-jd[1],-jd[2]);Rn(d,f,f+1,f+2),Rn(d,f+2,f+3,f)}else{for(p=0;p<4;++p)Rn(l,jd[0],jd[1],jd[2]);Rn(d,f+2,f+1,f),Rn(d,f,f+3,f+2)}}function eE(e,t,r,n,a,i,o,s,u,c){var l=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,m=e.groups,h=d.elementCount,v=0;s>0?(Wc(Jr,t,0),Wc(_n,t,3*a),v=s/Qat(bp(Zat,_n,Jr))):$at(pC,0,0,0);for(var g=0;g<=a;++g){var y=i[g],S=o[g],C=0===s?S:s*(1-g/a),_=3*g;Wc(Hd,r,_),jy(Hd,Hd,C),Wc(rc,n,_),jy(rc,rc,y),s>0&&(Wc(Jr,r,_),Wc(_n,n,_),jy(pC,Ooe(pC,Jr,_n),v)),Wc(Nl,t,_),Wc(jd,r,_),Wc(YL,n,_),Yc(Jr,Yc(Jr,Nl,rc),Hd),Yc(_n,jd,pC),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),Yc(Jr,bp(Jr,Nl,rc),Hd),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),Roe(_n,YL),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),bp(Jr,bp(Jr,Nl,rc),Hd),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),Yc(_n,Roe(_n,jd),pC),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),bp(Jr,Yc(Jr,Nl,rc),Hd),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),XL(_n,YL),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2]),Yc(Jr,Yc(Jr,Nl,rc),Hd),Rn(d,Jr[0],Jr[1],Jr[2]),Rn(f,_n[0],_n[1],_n[2])}for(g=0;g<a;++g){for(var x=0;x<2;x++)Rn(p,h+8*g+2*x,h+8*(g+1)+2*x+1,h+8*g+2*x+1),Rn(p,h+8*g+2*x,h+8*(g+1)+2*x,h+8*(g+1)+2*x+1);for(x=2;x<4;x++)Rn(p,h+8*g+2*x,h+8*(g+1)+2*x,h+8*g+2*x+1),Rn(p,h+8*(g+1)+2*x,h+8*(g+1)+2*x+1,h+8*g+2*x+1)}if(u){S=o[0];var D=0===s?S:s;JD(0,e,t,r,n,y=i[0],D,D,!1)}else s>0&&(JD(0,e,t,r,n,y=i[0],s,-(S=o[0]),!1),JD(0,e,t,r,n,y,-s,S,!1));c&&0===s&&JD(3*a,e,t,r,n,y=i[a],S=o[a],S,!0),g=0;for(var A=8*(a+1)+(u?4:s>0?8:0)+(c&&0===s?4:0);g<A;++g)Jat(m,l)}var ci=b(),Vi=b(),Ys=b(),Bo=b(),vs=b();function tE(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function qy(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var Sp=b.fromArray,eit=b.normalize,KL=b.scaleAndAdd,Foe=b.cross,tit=b.dot,rit=b.unitX,gs=qe.add3,ZL=new Map;function QL(e,t,r,n,a,i,o,s,u,c,l){for(var d=e.currentGroup,f=e.vertices,p=e.normals,m=e.indices,h=e.groups,v=f.elementCount,g=function nit(e,t){var r=t?1:0,n=Ou(e,r);if(!ZL.has(n)){for(var a=[],i=[],o=0;o<e;++o){var s=(2*o+r)/e*Math.PI;a[o]=Math.cos(s),i[o]=Math.sin(s)}ZL.set(n,{cos:a,sin:i})}return ZL.get(n)}(i,"rounded"===l),y=g.cos,S=g.sin,C=Math.round(i/4),_=3*C,x=0;x<=a;++x){var D=3*x;Sp(Bo,r,D),Sp(vs,n,D),Sp(Ys,t,D);for(var w=o[x],A=s[x],E="rounded"===l&&A>w,I=0;I<i;++I){if(E){qy(Vi,Bo,vs,Ys,w*y[I],w*S[I]);var M=tit(vs,rit)<0?I<C||I>=_?A-w:-A+w:I>=C&&I<_?-A+w:A-w;KL(Vi,Vi,Bo,M),I===C||I===C-1?tE(ci,Bo,vs,0,1):I===_||I===_-1?tE(ci,Bo,vs,0,-1):tE(ci,Bo,vs,y[I],S[I])}else qy(Vi,Bo,vs,Ys,A*y[I],w*S[I]),tE(ci,Bo,vs,w*y[I],A*S[I]);eit(ci,ci),gs(f,Vi[0],Vi[1],Vi[2]),gs(p,ci[0],ci[1],ci[2])}}var N,F=Math.round(i/2);for(x=0;x<a;++x){for(I=0;I<F;++I)gs(m,v+x*i+(I+1)%i,v+(x+1)*i+(I+1)%i,v+x*i+I),gs(m,v+(x+1)*i+(I+1)%i,v+(x+1)*i+I,v+x*i+I);for(I=F;I<i;++I)gs(m,v+x*i+(I+1)%i,v+(x+1)*i+I,v+x*i+I),gs(m,v+(x+1)*i+(I+1)%i,v+(x+1)*i+I,v+x*i+(I+1)%i)}if(u){var j=f.elementCount;for(Sp(Bo,r,N=0),Sp(vs,n,N),Sp(Ys,t,N),Foe(ci,vs,Bo),gs(f,Ys[0],Ys[1],Ys[2]),gs(p,ci[0],ci[1],ci[2]),w=o[0],A=s[0],(E="rounded"===l&&A>w)&&(A-=w),v=f.elementCount,x=0;x<i;++x)E?(qy(Vi,Bo,vs,Ys,w*y[x],w*S[x]),KL(Vi,Vi,Bo,x<C||x>=_?A:-A)):qy(Vi,Bo,vs,Ys,A*y[x],w*S[x]),gs(f,Vi[0],Vi[1],Vi[2]),gs(p,ci[0],ci[1],ci[2]),gs(m,v+(x+1)%i,v+x,j)}if(c)for(j=f.elementCount,Sp(Bo,r,N=3*a),Sp(vs,n,N),Sp(Ys,t,N),Foe(ci,Bo,vs),gs(f,Ys[0],Ys[1],Ys[2]),gs(p,ci[0],ci[1],ci[2]),w=o[a],A=s[a],(E="rounded"===l&&A>w)&&(A-=w),v=f.elementCount,x=0;x<i;++x)E?(qy(Vi,Bo,vs,Ys,w*y[x],w*S[x]),KL(Vi,Vi,Bo,x<C||x>=_?A:-A)):qy(Vi,Bo,vs,Ys,A*y[x],w*S[x]),gs(f,Vi[0],Vi[1],Vi[2]),gs(p,ci[0],ci[1],ci[2]),gs(m,v+x,v+(x+1)%i,j);qe.addRepeat(h,(a+1)*i+(u?i+1:0)+(c?i+1:0),d)}var Cp=b.fromArray,ait=b.magnitude,$L=b.sub,Boe=b.add,JL=b.scale,iit=b.negate,oit=b.copy,sit=b.cross,Xc=qe.add3,uit=qe.add,no=b(),No=b(),cit=b(),e5=b(),Wv=b(),Noe=b(),mC=b(),lit=b(),t5=b();function rE(e,t,r,n,a,i,o,s){var u=e.currentGroup,c=e.vertices,l=e.normals,d=e.indices,f=e.groups,p=c.elementCount,m=0;s>0&&(Cp(no,t,0),Cp(No,t,3*a),m=s/ait($L(cit,No,no)));for(var h=0;h<=a;++h){var v=i[h],y=0===s?o[h]:s*(1-h/a),S=3*h;Cp(Wv,r,S),JL(Wv,Wv,y),Cp(e5,n,S),JL(e5,e5,v),s>0&&(Cp(no,r,S),Cp(No,n,S),JL(Noe,sit(Noe,no,No),m)),Cp(mC,t,S),Cp(lit,r,S),Cp(t5,n,S),Boe(no,mC,Wv),iit(No,t5),Xc(c,no[0],no[1],no[2]),Xc(l,No[0],No[1],No[2]),$L(no,mC,Wv),Xc(c,no[0],no[1],no[2]),Xc(l,No[0],No[1],No[2]),Boe(no,mC,Wv),oit(No,t5),Xc(c,no[0],no[1],no[2]),Xc(l,No[0],No[1],No[2]),$L(no,mC,Wv),Xc(c,no[0],no[1],no[2]),Xc(l,No[0],No[1],No[2])}for(h=0;h<a;++h)Xc(d,p+4*h,p+4*(h+1)+1,p+4*h+1),Xc(d,p+4*h,p+4*(h+1),p+4*(h+1)+1),Xc(d,p+4*h+2+1,p+4*(h+1)+2+1,p+4*h+2),Xc(d,p+4*h+2,p+4*(h+1)+2+1,p+4*(h+1)+2);h=0;for(var _=4*(a+1);h<_;++h)uit(f,u)}var koe={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:T.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:T.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:T.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:T.Select("elliptical",T.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:T.Select("square",T.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo),linearSegments:T.Numeric(8,{min:1,max:48,step:1},st.CustomQualityParamInfo),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo)},Su=(T.getDefaultValues(koe),b());function dit(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Vt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=a.linearSegments,l=a.radialSegments,d=a.aspectRatio,f=a.arrowFactor,p=a.tubularHelices,m=a.helixProfile,h=a.nucleicProfile,v=c*l*o+(l+1)*o*2,g=yt.createState(v,v/10,i),y=Fe.isCoarse(t),S=RL(c),C=S.curvePoints,_=S.normalVectors,x=S.binormalVectors,D=S.widthValues,w=S.heightValues,A=0,E=IL(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:p});E.hasNext;){var I=E.move();g.currentGroup=A;var M=xd(I.moleculeType),F=sn.is(I.secStrucType,4),N=sn.is(I.secStrucType,2),U=M?UD:LD;OL(S,I,N&&!p?wat:ooe,U);var H=n.size.size(I.centerPrev)*s,z=n.size.size(I.center)*s,G=n.size.size(I.centerNext)*s;y&&(H*=d/2,z*=d/2,G*=d/2);var J=I.secStrucFirst||I.coarseBackboneFirst||I.first,X=I.secStrucLast||I.coarseBackboneLast||I.last,Z=c;if(I.initial){var ne=c-(Z=Math.max(Math.round(c*U),1));C.copyWithin(0,3*ne),x.copyWithin(0,3*ne),_.copyWithin(0,3*ne),b.fromArray(Su,C,3),b.normalize(Su,b.sub(Su,I.p2,Su)),b.scaleAndAdd(Su,I.p2,Su,z*VD),b.toArray(Su,C,0)}else I.final&&(Z=Math.max(Math.round(c*(1-U)),1),b.fromArray(Su,C,3*Z-3),b.normalize(Su,b.sub(Su,I.p2,Su)),b.scaleAndAdd(Su,I.p2,Su,z*VD),b.toArray(Su,C,3*Z));if(!0===I.initial&&!0===I.final)Mi(g,I.p2,2*z,u);else if(F){var k=z*d,$=I.secStrucLast?k*f:0;LL(S,H,z,G,Y=H*d,k,W=G*d,U),2===l?rE(g,C,_,x,Z,D,w,$):eE(g,C,_,x,Z,D,w,$,J,X)}else{var Y=void 0,W=void(k=void 0);N&&!I.isCoarseBackbone?p?(Y=H*=1.5*d,k=z*=1.5*d,W=G*=1.5*d):(Y=H*d,k=z*d,W=G*d):M&&!I.isCoarseBackbone?(Y=H*d,k=z*d,W=G*d):(Y=H,k=z,W=G),LL(S,H,z,G,Y,k,W,U);var K=M&&!I.isCoarseBackbone?[x,_]:[_,x],q=K[0],V=K[1];if(M&&!I.isCoarseBackbone)for(var ee=0,ae=q.length;ee<ae;ee++)q[ee]*=-1;var pe=M?h:m;2===l?M&&!I.isCoarseBackbone?rE(g,C,q,V,Z,w,D,0):rE(g,C,q,V,Z,D,w,0):4===l?eE(g,C,q,V,Z,D,w,0,J,X):k===z?QL(g,C,q,V,Z,l,D,w,J,X,"elliptical"):"square"===pe?eE(g,C,q,V,Z,D,w,0,J,X):QL(g,C,q,V,Z,l,D,w,J,X,pe)}++A}var me=yt.getMesh(g),de=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return me.setBoundingSphere(de),me}var Loe=R(R({},qo),koe);function fit(e){return Ws({defaultProps:T.getDefaultValues(Loe),createGeometry:dit,createLocationIterator:function(t){return yp.fromGroup(t,!0)},getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile||r.nucleicProfile!==n.nucleicProfile;var u=Oc.get(o.structure).version;t.info.secondaryStructureHash!==u&&(void 0!==t.info.secondaryStructureHash&&(t.createGeometry=!0),t.info.secondaryStructureHash=u)}},e)}var Uoe={"polymer-trace":function(e,t){return Oa("Polymer trace mesh",e,t,fit)},"polymer-gap":function(e,t){return Oa("Polymer gap cylinder",e,t,WL)},"nucleotide-block":function(e,t){return Oa("Nucleotide block mesh",e,t,Mat)},"nucleotide-ring":function(e,t){return Oa("Nucleotide ring mesh",e,t,Uat)},"direction-wedge":function(e,t){return Oa("Polymer direction wedge",e,t,Xat)}},Voe=R(R(R(R(R(R({},Loe),ZD),boe),Aoe),Poe),{sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),visuals:T.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring"],T.objectToOptions(Uoe)),bumpFrequency:T.Numeric(2,{min:0,max:10,step:.1},st.ShadingCategory)}),hit={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:function mit(e,t){return lr.createMulti("Cartoon",e,t,to,Uoe)},getParams:function pit(e,t){var r=T.clone(Voe),n=!1,a=!1;return t.units.forEach(function(i){!n&&Fe.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-ring"),a&&r.visuals.defaultValue.push("polymer-gap"),r},defaultValues:T.getDefaultValues(Voe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ue(void 0,void 0,void 0,function(){var r,n;return ce(this,function(i){switch(i.label){case 0:return[4,Oc.attach(e,t,void 0,!0)];case 1:i.sent(),r=0,n=t.models,i.label=2;case 2:return r<n.length?[4,EL.attach(e,n[r],void 0,!0)]:[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){Oc.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++)EL.ref(r[t],!1)}}},Goe=R(R({},qo),{sizeFactor:T.Numeric(1,{min:0,max:10,step:.1}),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo),ignoreHydrogens:T.Boolean(!1)});function vit(e){return Ws({defaultProps:T.getDefaultValues(Goe),createGeometry:git,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function git(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Vt.createEmpty(i);var u=a.detail,c=a.sizeFactor,l=a.ignoreHydrogens,d=t.elements,f=t.model,p=t.model.atomicHierarchy.derived.atom.atomicNumber,m=d.length,h=m*kS(u),v=yt.createState(h,h/2,i),g=Dd.Provider.get(f);if(!g)return Vt.createEmpty(i);var y=b(),S=Qt(),C=b(),_=b(),x=b(),D=g.elementToAnsiotrop,w=g.data,A=w.U,E=w._schema.U.space,I=t.conformation.invariantPosition,M=at.create(r);M.unit=t;for(var F=0;F<m;F++){var N=d[F],j=D[N];if(-1!==j&&!(s&&!Ye.has(s.elements,N)||l&&kQe(p,N))){M.element=N,I(N,y),v.currentGroup=F,Sr.toMat3(S,E,A.value(j)),Qt.symmtricFromLower(S,S),Qt.symmetricEigenvalues(C,S),Qt.eigenvector(_,S,C[1]),Qt.eigenvector(x,S,C[2]);for(var U=0;U<3;++U)C[U]=1.5958*c*Math.sqrt(Math.abs(C[U]));ea(C[0],C[1],mn)&&ea(C[1],C[2],mn)?Mi(v,y,C[0],u):wN(v,y,x,_,C,u)}}var H=yt.getMesh(v),z=Pe.expand(Pe(),(s||t).boundary.sphere,1*c);return H.setBoundingSphere(z),H}var zoe={"ellipsoid-mesh":function(e,t){return Oa("Ellipsoid Mesh",e,t,vit)},"intra-bond":function(e,t){return Oa("Intra-unit bond cylinder",e,t,Die)},"inter-bond":function(e,t){return ec("Inter-unit bond cylinder",e,t,Mie)}},Hoe=R(R(R(R({},Goe),ED),ID),{includeParent:T.Boolean(!1),adjustCylinderLength:T.Boolean(!1,{isHidden:!0}),unitKinds:j2(["atomic"]),sizeFactor:T.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:T.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:T.Boolean(!0),visuals:T.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],T.objectToOptions(zoe)),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory)}),Sit={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:function bit(e,t){return lr.createMulti("Ellipsoid",e,t,to,zoe)},getParams:function yit(e,t){return Hoe},defaultValues:T.getDefaultValues(Hoe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return Dd.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},Cit="\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute float aRadius;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n\n#if defined(dCalcType_groupId)\n    attribute float aGroup;\n    varying float vGroup;\n#endif\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vRadiusSqInv = 1.0 / (aRadius * aRadius);\n    #if defined(dCalcType_groupId)\n        vGroup = aGroup;\n    #endif\n    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);\n    vPosition = (aPosition - uBboxMin) / uResolution;\n    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n}\n",xit="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        precision highp sampler2D;\n        uniform sampler2D tMinDistanceTex;\n        uniform vec3 uGridTexDim;\n    #elif defined(dGridTexType_3d)\n        precision highp sampler3D;\n        uniform sampler3D tMinDistanceTex;\n    #endif\n    varying float vGroup;\n#endif\n\n#include common\n\nuniform vec3 uGridDim;\nuniform vec2 uGridTexScale;\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uAlpha;\nuniform float uResolution;\nuniform float uRadiusFactorInv;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition) * uResolution;\n\n    #if defined(dCalcType_density)\n        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));\n        gl_FragColor.a = density * uRadiusFactorInv;\n    #elif defined(dCalcType_minDistance)\n        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;\n    #elif defined(dCalcType_groupId)\n        #if defined(dGridTexType_2d)\n            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;\n        #elif defined(dGridTexType_3d)\n            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;\n        #endif\n        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)\n            discard;\n        gl_FragColor.rgb = packIntToRGB(vGroup);\n    #endif\n}\n",_it={drawCount:oa("number"),instanceCount:oa("number"),aRadius:Tn("float32",1,0),aPosition:Tn("float32",3,0),aGroup:Tn("float32",1,0),uCurrentSlice:Ae("f"),uCurrentX:Ae("f"),uCurrentY:Ae("f"),uBboxMin:Ae("v3","material"),uBboxSize:Ae("v3","material"),uGridDim:Ae("v3","material"),uGridTexDim:Ae("v3","material"),uGridTexScale:Ae("v2","material"),uAlpha:Ae("f","material"),uResolution:Ae("f","material"),uRadiusFactorInv:Ae("f","material"),tMinDistanceTex:Xt("texture","rgba","float","nearest","material"),dGridTexType:Lt("string",["2d","3d"]),dCalcType:Lt("string",["density","minDistance","groupId"])},qd="gaussian-density";function r5(e){return e.namedFramebuffers[qd]||(e.namedFramebuffers[qd]=e.resources.framebuffer()),e.namedFramebuffers[qd]}function n5(e,t,r,n,a,i){var o="".concat(qd,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function joe(e,t,r,n,a,i){return e.isWebGL2?function wit(e,t,r,n,a,i){xt&&e.timer.mark("GaussianDensityTexture3d");var o=function Ait(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,c=e.extensions,l=c.colorBufferFloat,d=c.textureFloat,f=c.colorBufferHalfFloat,p=c.textureHalfFloat,m=a.smoothness,h=a.resolution,v=Xoe(t,r,n,a),g=v.drawCount,y=v.positions,S=v.radii,C=v.groups,_=v.scale,x=v.expandedBox,D=v.dim,w=v.maxRadius,A=D[0],E=D[1],I=D[2],M=n5("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");M.define(A,E,I);var F=Be.create(1,1),N=2*w,j=Koe(e,g,y,S,C,M,x,D,D,F,m,h,N),U=j.values.uCurrentSlice,H=r5(e);function z(G,J){u.currentRenderItemId=-1;for(var X=0;X<I;++X)O.update(U,X),G.attachFramebuffer(H,0,X),J&&o.clear(o.COLOR_BUFFER_BIT),j.render();o.flush()}return H.bind(),Zoe(e),u.viewport(0,0,A,E),u.scissor(0,0,A,E),i||(i=f&&p?s.texture("volume-float16","rgba","fp16","linear"):l&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(A,E,I),$oe(e,j),z(i,!0),Qoe(e,j),z(M,!0),Joe(e,j),z(i,!1),{texture:i,scale:_,bbox:x,gridDim:D,gridTexDim:D,gridTexScale:F,radiusFactor:N,resolution:h,maxRadius:w}}(e,t,r,n,a,i);return xt&&e.timer.markEnd("GaussianDensityTexture3d"),qoe(o)}(e,t,r,n,a,i):a5(e,t,r,n,!1,a,i)}function a5(e,t,r,n,a,i,o){xt&&e.timer.mark("GaussianDensityTexture2d");var s=function Yoe(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,c=e.state,l=e.extensions,d=l.colorBufferFloat,f=l.textureFloat,p=l.colorBufferHalfFloat,m=l.textureHalfFloat,h=l.blendMinMax,v=i.smoothness,g=i.resolution,y=Xoe(t,r,n,i),S=y.drawCount,C=y.positions,_=y.radii,x=y.groups,D=y.scale,w=y.expandedBox,A=y.dim,E=y.maxRadius,I=A[0],M=A[1],F=A[2],N=function Dit(e){var r=Math.sqrt(e[0]*e[1]*e[2]),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:2*n}}(A),j=N.texDimX,U=N.texDimY,H=N.texCols,z=N.powerOfTwoSize,G=b.create(j,U,0),J=Be.create(j/z,U/z),X=2*E,Z=a?z:j,ne=a?z:U,Y=n5("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");Y.define(Z,ne);var k=Koe(e,S,C,_,x,Y,w,A,G,J,v,g,X),W=k.values,$=W.uCurrentSlice,K=W.uCurrentX,q=W.uCurrentY,V=r5(e);function ee(ae,pe){c.currentRenderItemId=-1,ae.attachFramebuffer(V,0),pe&&(c.viewport(0,0,Z,ne),c.scissor(0,0,Z,ne),s.clear(s.COLOR_BUFFER_BIT)),O.update(q,0);for(var me=0,de=0,re=0,te=0;te<F;++te)me>=H&&(me-=H,re=0,O.update(q,de+=M)),O.update(K,re),O.update($,te),c.viewport(re,de,I,M),c.scissor(re,de,I,M),k.render(),++me,re+=I;s.flush()}return V.bind(),Zoe(e),o||(o=p&&m?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(Z,ne),$oe(e,k),ee(o,!0),h&&(Qoe(e,k),ee(Y,!0),Joe(e,k),ee(o,!1)),{texture:o,scale:D,bbox:w,gridDim:A,gridTexDim:G,gridTexScale:J,radiusFactor:X,resolution:g,maxRadius:E}}(e,t,r,n,a,i,o);return xt&&e.timer.markEnd("GaussianDensityTexture2d"),qoe(s)}function qoe(e){var t=e.texture,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution,c=e.maxRadius;return{transform:Woe(e.scale,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u,maxRadius:c}}function Woe(e,t){var r=he.identity();return he.fromScaling(r,e),he.setTranslation(r,t.min),r}function Xoe(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,c=e.y,l=e.z,d=e.id,f=ke.size(s),p=new Float32Array(3*f),m=new Float32Array(f),h=new Float32Array(f),v=0,g=0;g<f;++g){var y=ke.getAt(s,g);p[3*g]=u[y],p[3*g+1]=c[y],p[3*g+2]=l[y];var S=r(y)+i;v<S&&(v=S),m[g]=S,h[g]=d?d[g]:g}var C=2*v+4*a,_=Nt.expand(Nt(),t,b.create(C,C,C)),x=Nt.scale(Nt(),_,o),D=Nt.size(b(),x);return b.ceil(D,D),{drawCount:f,positions:p,radii:m,groups:h,scale:b.create(a,a,a),expandedBox:_,dim:D,maxRadius:v}}function Koe(e,t,r,n,a,i,o,s,u,c,l,d,f){if(e.namedComputeRenderables[qd]){var p=b.sub(b(),o.max,o.min),m=e.namedComputeRenderables[qd].values;O.updateIfChanged(m.drawCount,t),O.updateIfChanged(m.instanceCount,1),O.update(m.aRadius,n),O.update(m.aPosition,r),O.update(m.aGroup,a),O.updateIfChanged(m.uCurrentSlice,0),O.updateIfChanged(m.uCurrentX,0),O.updateIfChanged(m.uCurrentY,0),O.update(m.uBboxMin,o.min),O.update(m.uBboxSize,p),O.update(m.uGridDim,s),O.update(m.uGridTexDim,u),O.update(m.uGridTexScale,c),O.updateIfChanged(m.uAlpha,l),O.updateIfChanged(m.uResolution,d),O.updateIfChanged(m.uRadiusFactorInv,1/f),O.update(m.tMinDistanceTex,i),O.updateIfChanged(m.dGridTexType,i.getDepth()>0?"3d":"2d"),O.updateIfChanged(m.dCalcType,"density"),e.namedComputeRenderables[qd].update()}else e.namedComputeRenderables[qd]=function Tit(e,t,r,n,a,i,o,s,u,c,l,d,f){var p=b.sub(b(),o.max,o.min),m={drawCount:O.create(t),instanceCount:O.create(1),aRadius:O.create(n),aPosition:O.create(r),aGroup:O.create(a),uCurrentSlice:O.create(0),uCurrentX:O.create(0),uCurrentY:O.create(0),uBboxMin:O.create(o.min),uBboxSize:O.create(p),uGridDim:O.create(s),uGridTexDim:O.create(u),uGridTexScale:O.create(c),uAlpha:O.create(l),uResolution:O.create(d),uRadiusFactorInv:O.create(1/f),tMinDistanceTex:O.create(i),dGridTexType:O.create(i.getDepth()>0?"3d":"2d"),dCalcType:O.create("density")},h=R({},_it);return Va(Ua(e,"points",Fn(qd,Cit,xit),h,m),m)}(e,t,r,n,a,i,o,s,u,c,l,d,f);return e.namedComputeRenderables[qd]}function Zoe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function Qoe(e,t){var r=e.gl,n=e.state;if(O.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function $oe(e,t){var r=e.gl,n=e.state;O.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function Joe(e,t){var r=e.gl,n=e.state;O.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}var ese=new ArrayBuffer(4);new Int32Array(ese),new Float32Array(ese);var tse=new ArrayBuffer(4),Rit=new Int32Array(tse),Oit=new Float32Array(tse);function Wy(e){return function Fit(e){return Rit[0]=(1<<23)*((e<-126?-126:e)+126.94269504),Oit[0]}(1.44269504*e)}var rse=new ArrayBuffer(8);new Int32Array(rse),new Float32Array(rse);var ase=new ArrayBuffer(4);new Int32Array(ase),new Float32Array(ase),Math,Math,Math,Math,Math,Math,Math,Math,Math;var use=new ArrayBuffer(16);new Int32Array(use),new Float32Array(use);var cse=new ArrayBuffer(8);new Int32Array(cse),new Float32Array(cse);var dse=new ArrayBuffer(4);function pse(e,t,r,n,a){return ue(this,void 0,void 0,function(){function o(){return ue(this,void 0,void 0,function(){var K;return ce(this,function(q){switch(q.label){case 0:K=0,q.label=1;case 1:return K<v?(function i(K,q){for(var V=K;V<q;++V)for(var ee=ke.getAt(d,V),ae=f[ee],pe=p[ee],me=m[ee],de=g[V],te=1/(de*de),le=2*de,ge=le*le,xe=Math.ceil(le*l),Ge=Math.floor(l*(ae-D[0])),je=Math.floor(l*(pe-D[1])),L=Math.floor(l*(me-D[2])),Q=Math.max(0,Ge-xe),ye=Math.max(0,je-xe),we=Math.max(0,L-xe),De=Math.min(j,Ge+xe+2),Oe=Math.min(U,je+xe+2),Ne=Math.min(H,L+xe+2),Ue=Q;Ue<De;++Ue)for(var $e=X[Ue]-ae,Ie=Ue*J,He=ye;He<Oe;++He)for(var Je=Z[He]-pe,mt=$e*$e+Je*Je,ut=He*z+Ie,St=we;St<Ne;++St){var wt=ne[St]-me,Le=mt+wt*wt;if(Le<=ge){var it=Wy(Le*te*-k),Ct=St+ut;I[Ct]+=it,it>Y[Ct]&&(Y[Ct]=it,F[Ct]=h?h[V]:V)}}}(K,Math.min(K+W,v)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:K,max:v})]:[3,3]):[3,4];case 2:q.sent(),q.label=3;case 3:return K+=W,[3,1];case 4:return[2]}})})}var s,u,c,l,d,f,p,m,h,v,g,y,S,C,_,x,D,w,A,E,I,M,F,N,j,U,H,z,J,X,Z,ne,Y,k,W,$;return ce(this,function(K){switch(K.label){case 0:for(u=a.radiusOffset,c=a.smoothness,l=1/(s=a.resolution),f=t.x,p=t.y,m=t.z,h=t.id,v=ke.size(d=t.indices),g=new Float32Array(v),y=0,S=0;S<v;++S)C=n(ke.getAt(d,S))+u,y<C&&(y=C),g[S]=C;return _=2*y+s,x=Nt.expand(Nt(),r,b.create(_,_,_)),D=x.min,w=Nt.scale(Nt(),x,l),A=Nt.size(b(),w),b.ceil(A,A),E=Sr.Space(A,[0,1,2],Float32Array),I=E.create(),M=Sr.create(E,I),(F=E.create()).fill(-1),N=Sr.create(E,F),j=A[0],J=(z=H=A[2])*(U=A[1]),X=L0(A[0],D[0],s),Z=L0(A[1],D[1],s),ne=L0(A[2],D[2],s),Y=E.create(),k=c,W=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*l)),[4,o()];case 1:return K.sent(),$=he.identity(),he.fromScaling($,b.create(s,s,s)),he.setTranslation($,x.min),[2,{field:M,idField:N,transform:$,radiusFactor:1,resolution:s,maxRadius:y}]}})})}new Int32Array(dse),new Float32Array(dse),Math;var gC=R({resolution:T.Numeric(1,{min:.1,max:20,step:.1},R({description:"Grid resolution/cell spacing."},st.CustomQualityParamInfo)),radiusOffset:T.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:T.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},tD);function mse(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function hse(e,t,r,n){var a=this,i=rD(e,t,r,n),o=i.position,s=i.boundary,u=i.radius,c=Om(s.box,n);return Ve.create("Gaussian Density",function(l){return ue(a,void 0,void 0,function(){return ce(this,function(d){switch(d.label){case 0:return[4,pse(l,o,s.box,u,c)];case 1:return[2,d.sent()]}})})})}function Kit(e,t,r,n,a,i){var o=this,s=rD(e,t,r,n),u=s.position,c=s.boundary,l=s.radius,d=Om(c.box,n,mse(a,e));return Ve.create("Gaussian Density",function(f){return ue(o,void 0,void 0,function(){return ce(this,function(p){return[2,joe(a,u,c.box,l,d,i)]})})})}function Zit(e,t,r,n,a,i,o){var s=this,u=rD(e,t,r,a),c=u.position,l=u.boundary,d=u.radius,f=Om(l.box,a,mse(i,e));return Ve.create("Gaussian Density",function(p){return ue(s,void 0,void 0,function(){return ce(this,function(m){return[2,a5(i,c,l.box,d,n,f,o)]})})})}function Qit(e,t,r){var n=this,a=nD(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=Om(o.box,r);return Ve.create("Gaussian Density",function(c){return ue(n,void 0,void 0,function(){return ce(this,function(l){switch(l.label){case 0:return[4,pse(c,i,o.box,s,u)];case 1:return[2,l.sent()]}})})})}function $it(e,t,r,n,a){var i=this,o=nD(e,t,r),s=o.position,u=o.boundary,c=o.radius,l=Om(u.box,r);return Ve.create("Gaussian Density",function(d){return ue(i,void 0,void 0,function(){return ce(this,function(f){return[2,joe(n,s,u.box,c,l,a)]})})})}function Jit(e,t,r,n,a,i){var o=this,s=e.lookup3d.boundary.box,u=nD(e,t,n),c=u.position,d=u.radius,f=Om(u.boundary.box,n);return Ve.create("Gaussian Density",function(p){return ue(o,void 0,void 0,function(){return ce(this,function(m){return[2,a5(a,c,s,d,r,f,i)]})})})}T.getDefaultValues(gC);var vse=R(R(R({},gC),KX),{ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),tryUseGpu:T.Boolean(!0),includeParent:T.Boolean(!1,{isHidden:!0})}),c5=R(R(R({},qo),n$e),vse),gse=R(R(R({},Iy),ZQe),vse);function yse(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function Xy(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=Dne(e.boundary.box,t.resolution,n*n);return a.areaCells<a.maxAreaCells}function eot(e,t,r,n){return r.tryUseGpu&&n&&yse(n)&&Xy(t,r,n)?function sot(e){return function a$e(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:is.Utils}),t)}({defaultProps:T.getDefaultValues(c5),createGeometry:oot,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Xy(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=Tc(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&i&&(Nee(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e):function not(e){return Ws({defaultProps:T.getDefaultValues(c5),createGeometry:rot,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Xy(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=Tc(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(_T(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e)}function tot(e,t,r,n){return r.tryUseGpu&&n&&yse(n)&&Xy(t,r,n)?function cot(e){return function QQe(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:is.Utils}),t)}({defaultProps:T.getDefaultValues(gse),createGeometry:uot,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Xy(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=Tc(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&i&&(Nee(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e):function iot(e){return fp({defaultProps:T.getDefaultValues(gse),createGeometry:aot,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Xy(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=Tc(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(_T(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}(e)}function rot(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,h,v;return ce(this,function(g){switch(g.label){case 0:return o=a.smoothness,[4,hse(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=g.sent(),u=s.transform,c=s.field,l=s.idField,d=s.radiusFactor,f=s.resolution,p=s.maxRadius,[4,By({isoLevel:Math.exp(-o)/d,scalarField:c,idField:l},i).runAsChild(e.runtime)];case 2:return(h=g.sent()).meta.resolution=f,Vt.transform(h,u),e.webgl&&!e.webgl.isWebGL2?(Vt.uniformTriangleGroup(h),O.updateIfChanged(h.varyingGroup,!1)):O.updateIfChanged(h.varyingGroup,!0),v=Pe.expand(Pe(),t.boundary.sphere,p),h.setBoundingSphere(v),[2,h]}})})}function aot(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,m,h;return ce(this,function(v){switch(v.label){case 0:return i=n.smoothness,[4,Qit(t,r.size,n).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,c=o.idField,l=o.radiusFactor,d=o.resolution,f=o.maxRadius,[4,By({isoLevel:Math.exp(-i)/l,scalarField:u,idField:c},a).runAsChild(e.runtime)];case 2:return(m=v.sent()).meta.resolution=d,Vt.transform(m,s),e.webgl&&!e.webgl.isWebGL2?(Vt.uniformTriangleGroup(m),O.updateIfChanged(m.varyingGroup,!1)):O.updateIfChanged(m.varyingGroup,!0),h=Pe.expand(Pe(),t.boundary.sphere,f),m.setBoundingSphere(h),[2,m]}})})}var Ky="gaussian-surface";function oot(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l,d,f,p,m,h,v,g,y,S,C,_;return ce(this,function(x){switch(x.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return xt&&e.webgl.timer.mark("createGaussianSurfaceTextureMesh"),u=(o=e.webgl).resources,l=(c=o.extensions).colorBufferFloat,d=c.textureFloat,f=c.colorBufferHalfFloat,p=c.textureHalfFloat,(s=o.namedTextures)[Ky]||(s[Ky]=f&&p?u.texture("image-float16","rgba","fp16","linear"):l&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,Zit(r,t,n.size,!0,a,e.webgl,s[Ky]).runInContext(e.runtime)];case 1:return m=x.sent(),h=Math.exp(-a.smoothness)/m.radiusFactor,v=b.create(0,1,2),g=i?.doubleBuffer.get(),y=yD(e.webgl,m.texture,m.gridDim,m.gridTexDim,m.gridTexScale,m.transform,h,!1,!0,v,!0,g?.vertex,g?.group,g?.normal),xt&&e.webgl.timer.markEnd("createGaussianSurfaceTextureMesh"),S=t.elements.length,C=Pe.expand(Pe(),t.boundary.sphere,m.maxRadius),(_=is.create(y.vertexCount,S,y.vertexTexture,y.groupTexture,y.normalTexture,C,i)).meta.resolution=m.resolution,_.meta.webgl=e.webgl,[2,_]}})})}function uot(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,s,u,c,l,d,f,p,m,h,v,g,y,S,C;return ce(this,function(_){switch(_.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return xt&&e.webgl.timer.mark("createStructureGaussianSurfaceTextureMesh"),s=(i=e.webgl).resources,c=(u=i.extensions).colorBufferFloat,l=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,(o=i.namedTextures)[Ky]||(o[Ky]=d&&f?s.texture("image-float16","rgba","fp16","linear"):c&&l?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,Jit(t,r.size,!0,n,e.webgl,o[Ky]).runInContext(e.runtime)];case 1:return p=_.sent(),m=Math.exp(-n.smoothness)/p.radiusFactor,h=b.create(0,1,2),v=a?.doubleBuffer.get(),g=yD(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,m,!1,!0,h,!0,v?.vertex,v?.group,v?.normal),xt&&e.webgl.timer.markEnd("createStructureGaussianSurfaceTextureMesh"),y=t.elementCount,S=Pe.expand(Pe(),t.boundary.sphere,p.maxRadius),(C=is.create(g.vertexCount,y,g.vertexTexture,g.groupTexture,g.normalTexture,S,a)).meta.resolution=p.resolution,C.meta.webgl=e.webgl,[2,C]}})})}function lot(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,u,c,l,d,p,m;return ce(this,function(h){switch(h.label){case 0:return o=a.smoothness,[4,hse(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=h.sent(),u=s.transform,c=s.field,l=s.idField,d=s.maxRadius,[4,Rk({isoLevel:Math.exp(-o),scalarField:c,idField:l},i).runAsChild(e.runtime)];case 2:return p=h.sent(),na.transform(p,u),m=Pe.expand(Pe(),t.boundary.sphere,d),p.setBoundingSphere(m),[2,p]}})})}var bse=R(R(R({},aD),gC),{sizeFactor:T.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:T.Boolean(!1),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),includeParent:T.Boolean(!1,{isHidden:!0})});function dot(e){return iD({defaultProps:T.getDefaultValues(bse),createGeometry:lot,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Sse={"gaussian-surface-mesh":function(e,t){return Oa("Gaussian surface mesh",e,t,eot)},"structure-gaussian-surface-mesh":function(e,t){return ec("Structure-Gaussian surface mesh",e,t,tot)},"gaussian-surface-wireframe":function(e,t){return Oa("Gaussian surface wireframe",e,t,dot)}},Cse=R(R(R({},c5),bse),{visuals:T.MultiSelect(["gaussian-surface-mesh"],T.objectToOptions(Sse)),bumpFrequency:T.Numeric(1,{min:0,max:10,step:.1},st.ShadingCategory)}),mot={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:function pot(e,t){return lr.createMulti("Gaussian Surface",e,t,to,Sse)},getParams:function fot(e,t){return Cse},defaultValues:T.getDefaultValues(Cse),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},xse=R(R({},WQe),{background:T.Boolean(!1),backgroundMargin:T.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:T.Color(vr.black),backgroundOpacity:T.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:T.Numeric(.25,{min:0,max:.5,step:.01}),level:T.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),chainScale:T.Numeric(10,{min:0,max:20,step:.1}),residueScale:T.Numeric(1,{min:0,max:20,step:.1}),elementScale:T.Numeric(.5,{min:0,max:20,step:.1})});function hot(e){return function YQe(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:zu.Utils}),t)}({defaultProps:T.getDefaultValues(xse),createGeometry:vot,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||"chain"===r.level&&r.chainScale!==n.chainScale||"residue"===r.level&&r.residueScale!==n.residueScale||"element"===r.level&&r.elementScale!==n.elementScale||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function vot(e,t,r,n,a){switch(n.level){case"chain":return function got(e,t,r,n,a){for(var i=at.create(t),o=t.units,u=ot.chain,c=u.auth_asym_id,l=u.label_asym_id,d=t.serialMapping.cumulativeUnitElementCount,f=o.length,p=n.chainScale,m=Fd.create(n,f,f/2,a),h=0,v=o.length;h<v;++h){var g=o[h];i.unit=g,i.element=g.elements[0];var y=g.lookup3d.boundary.sphere,C=y.radius;b.transformMat4(Kc,y.center,g.conformation.operator.matrix);var _=c(i),x=l(i),D=_===x?x:"".concat(x," [").concat(_,"]");m.add(D,Kc[0],Kc[1],Kc[2],C,p,d[h])}return m.getText()}(0,t,0,n,a);case"residue":return function yot(e,t,r,n,a){for(var i=at.create(t),o=t.units,u=ot.atom.label_comp_id,c=ot.residue.auth_seq_id,l=t.serialMapping.cumulativeUnitElementCount,d=2*t.polymerResidueCount,f=n.residueScale,p=Fd.create(n,d,d/2,a),m=0,h=o.length;m<h;++m){var v=o[m],g=v.conformation.position,y=v.elements;i.unit=v,i.element=v.elements[0];for(var S=v.model.atomicHierarchy.residueAtomSegments.index,C=l[m],_=0,x=y.length;_<x;){var D=_,w=S[y[_]];for(_++;_<x&&S[y[_]]===w;)_++;yC.reset();for(var A=D;A<_;A++)g(y[A],Kc),yC.includePosition(Kc);for(yC.finishedIncludeStep(),A=D;A<_;A++)g(y[A],Kc),yC.radiusPosition(Kc);i.element=y[D];var E=yC.getSphere(),I=E.center,M=E.radius,F=c(i),N=u(i),j="".concat(N," ").concat(F);p.add(j,I[0],I[1],I[2],M,f,C+D)}}return p.getText()}(0,t,0,n,a);case"element":return function bot(e,t,r,n,a){for(var i=at.create(t),o=t.units,u=ot.atom,c=u.label_atom_id,l=u.label_alt_id,d=t.serialMapping.cumulativeUnitElementCount,f=r.size,p=t.elementCount,m=n.elementScale,h=Fd.create(n,p,p/2,a),v=0,g=o.length;v<g;++v){var y=o[v],S=y.conformation.position,C=y.elements;i.unit=y;for(var _=d[v],x=Nv(t,y,R(R({},n),{traceOnly:!1})),D=0,w=C.length;D<w;D++)if(!x||!x(C[D])){i.element=C[D],S(i.element,Kc);var A=c(i),E=l(i),I=E?"".concat(A,"%").concat(E):A;h.add(I,Kc[0],Kc[1],Kc[2],f.size(i),m,_+D)}}return h.getText()}(0,t,r,n,a)}}var Kc=b(),yC=new Lu("98"),_se={"label-text":function(e,t){return ec("Label text",e,t,hot)}},wse=R(R({},xse),{visuals:T.MultiSelect(["label-text"],T.objectToOptions(_se))}),xot={name:"label",label:"Label",description:"Displays labels.",factory:function Cot(e,t){var r=lr.createMulti("Label",e,t,to,_se);return r.setState({pickable:!1,markerActions:Ut.None}),r},getParams:function Sot(e,t){return wse},defaultValues:T.getDefaultValues(wse),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},l5={probeRadius:T.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:T.Numeric(.5,{min:.01,max:20,step:.01},R({description:"Grid resolution/cell spacing."},st.CustomQualityParamInfo)),probePositions:T.Numeric(36,{min:12,max:90,step:1},R({description:"Number of positions tested for probe target intersection."},st.CustomQualityParamInfo))};function Aot(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){function o(Q,ye,we,De,Oe){if(-1!==p){if((Ne=p)!==De&&Ne!==Oe&&s(Ne,Q,ye,we))return Ne;p=-1}for(var Ue=0,$e=A.count;Ue<$e;++Ue){var Ne;if((Ne=ke.getAt(E,A.indices[Ue]))!==De&&Ne!==Oe&&s(Ne,Q,ye,we))return p=Ne,Ne}return-1}function s(Q,ye,we,De){var Oe=j[Q],Ne=I[Q]-ye,Ue=M[Q]-we,$e=F[Q]-De;return Ne*Ne+Ue*Ue+$e*$e<Oe*Oe}function c(){return ue(this,void 0,void 0,function(){var Q;return ce(this,function(ye){switch(ye.label){case 0:Q=0,ye.label=1;case 1:return Q<U?(function u(Q,ye){for(var we=Q;we<ye;++we){var De=ke.getAt(E,we),Oe=I[De],Ne=M[De],Ue=F[De],$e=j[De],Ie=$e*$e;w.find(Oe,Ne,Ue,$e);for(var He=Math.ceil($e*_),Je=Math.floor(_*(Oe-J)),mt=Math.floor(_*(Ne-X)),ut=Math.floor(_*(Ue-Z)),St=Math.max(0,Je-He),wt=Math.max(0,mt-He),Le=Math.max(0,ut-He),it=Math.min(k,Je+He+2),Ct=Math.min(W,mt+He+2),bt=Math.min($,ut+He+2),Mt=St;Mt<it;++Mt)for(var Rt=te[Mt]-Oe,oe=Mt*V,be=wt;be<Ct;++be)for(var Ce=le[be]-Ne,Qe=Rt*Rt+Ce*Ce,Et=be*K+oe,At=Le;At<bt;++At){var Zt=ge[At]-Ue,Dr=Qe+Zt*Zt;if(Dr<Ie){var tr=At+Et;de[tr]<0&&(de[tr]*=-1);var fn=Math.sqrt(Dr),Qn=$e/fn;if(-1===o(Rt*Qn+Oe,Ce*Qn+Ne,Zt*Qn+Ue,De,-1)){var Wd=$e-fn;Wd<de[tr]&&(de[tr]=Wd,re[tr]=N[we])}}}}}(Q,Math.min(Q+xe,U)),e.shouldUpdate?[4,e.update({message:"projecting points",current:Q,max:U})]:[3,3]):[3,4];case 2:ye.sent(),ye.label=3;case 3:return Q+=xe,[3,1];case 4:return[2]}})})}function l(Q,ye){var we=j[Q],De=j[ye],Oe=m[0]=I[ye]-I[Q],Ne=m[1]=M[ye]-M[Q],Ue=m[2]=F[ye]-F[Q],Ie=Math.sqrt(Oe*Oe+Ne*Ne+Ue*Ue),Je=we*((we*we+Ie*Ie-De*De)/(2*we*Ie));b.normalize(m,m),function _ot(e,t){e[0]=e[1]=e[2]=1,0!==t[0]?e[0]=(t[1]+t[2])/-t[0]:0!==t[1]?e[1]=(t[0]+t[2])/-t[1]:0!==t[2]&&(e[2]=(t[0]+t[1])/-t[2])}(v,m),b.normalize(v,v),b.cross(g,m,v),b.normalize(g,g);var mt=Math.sqrt(we*we-Je*Je);b.scale(v,v,mt),b.scale(g,g,mt),b.scale(m,m,Je),h[0]=m[0]+I[Q],h[1]=m[1]+M[Q],h[2]=m[2]+F[Q],p=-1;for(var ut=0;ut<C;++ut){var St=ae[ut],wt=pe[ut],Le=h[0]+St*v[0]+wt*g[0],it=h[1]+St*v[1]+wt*g[1],Ct=h[2]+St*v[2]+wt*g[2];if(-1===o(Le,it,Ct,Q,ye))for(var bt=Math.floor(_*(Le-J)),Mt=Math.floor(_*(it-X)),Rt=Math.floor(_*(Ct-Z)),oe=Math.max(0,bt-x),be=Math.max(0,Mt-x),Ce=Math.max(0,Rt-x),Qe=Math.min(k,bt+x+2),Et=Math.min(W,Mt+x+2),At=Math.min($,Rt+x+2),Zt=oe;Zt<Qe;++Zt)for(var Dr=Le-te[Zt],tr=Zt*V,fn=be;fn<Et;++fn)for(var Qn=it-le[fn],ao=Dr*Dr+Qn*Qn,ja=fn*K+tr,Gi=Ce;Gi<At;++Gi){var Wd=Ct-ge[Gi],Qm=ao+Wd*Wd,ze=Gi+ja,Ke=de[ze];Ke>0&&Qm<Ke*Ke&&(de[ze]=Math.sqrt(Qm),re[ze]=N[ke.indexOf(E,Dr*m[0]+Qn*m[1]+Wd*m[2]<0?ye:Q)])}}}function f(){return ue(this,void 0,void 0,function(){var Q;return ce(this,function(ye){switch(ye.label){case 0:Q=0,ye.label=1;case 1:return Q<U?(function d(Q,ye){for(var we=Q;we<ye;++we){var De=ke.getAt(E,we);w.find(I[De],M[De],F[De],j[De]);for(var Oe=0,Ne=A.count;Oe<Ne;++Oe){var Ue=ke.getAt(E,A.indices[Oe]);De<Ue&&l(De,Ue)}}}(Q,Math.min(Q+xe,U)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:Q,max:U})]:[3,3]):[3,4];case 2:ye.sent(),ye.label=3;case 3:return Q+=xe,[3,1];case 4:return[2]}})})}var p,m,h,v,g,y,C,_,x,D,w,A,E,I,M,F,N,j,U,H,z,G,J,X,Z,ne,Y,k,W,$,K,V,ee,ae,pe,me,de,re,te,le,ge,xe,Ge,je,L;return ce(this,function(Q){switch(Q.label){case 0:return p=-1,m=b(),h=b(),v=b(),g=b(),C=i.probePositions,_=1/(y=i.resolution),x=Math.max(5,2+Math.floor(i.probeRadius*_)),D=b.create(n,n,n),b.scale(D,D,2),w=Df(t,r,D),A=w.result,null===a&&(a=w.boundary.box),I=t.x,M=t.y,F=t.z,N=t.id,j=t.radius,U=ke.size(E=t.indices),H=n+y,z=Nt.expand(Nt(),a,b.create(H,H,H)),J=(G=z.min)[0],X=G[1],Z=G[2],ne=Nt.scale(Nt(),z,_),Y=Nt.size(b(),ne),b.ceil(Y,Y),k=Y[0],V=(K=$=Y[2])*(W=Y[1]),ee=function wot(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}(C),ae=ee.cosTable,pe=ee.sinTable,me=Sr.Space(Y,[0,1,2],Float32Array),de=me.create(),re=me.create(),de.fill(-1001),re.fill(-1),te=L0(k,J,y),le=L0(W,X,y),ge=L0($,Z,y),xe=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*_)),[4,c()];case 1:return Q.sent(),[4,f()];case 2:return Q.sent(),Ge=Sr.create(me,de),je=Sr.create(me,re),L=he.identity(),he.fromScaling(L,b.create(y,y,y)),he.setTranslation(L,z.min),[2,{field:Ge,idField:je,transform:L,resolution:y,maxRadius:n}]}})})}function Ase(e,t,r,n){var a=this,i=function Tot(e,t,r,n){for(var a=n.probeRadius,i=rD(e,t,r,n),o=i.position,s=i.boundary,u=i.radius,c=o.indices,l=ke.size(c),d=new Float32Array(ke.end(c)),f=0,p=0;p<l;++p){var m=ke.getAt(c,p),h=u(m);f<h&&(f=h),d[m]=h+a}return{position:R(R({},o),{radius:d}),boundary:s,maxRadius:f}}(e,t,r,n),o=i.position,s=i.boundary,u=i.maxRadius,c=Om(s.box,n);return Ve.create("Molecular Surface",function(l){return ue(a,void 0,void 0,function(){return ce(this,function(d){switch(d.label){case 0:return[4,Tse(l,o,s,u,s.box,c)];case 1:return[2,d.sent()]}})})})}function Eot(e,t,r){var n=this,a=function Dot(e,t,r){for(var n=r.probeRadius,a=nD(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=i.indices,c=ke.size(u),l=new Float32Array(ke.end(u)),d=0,f=0;f<c;++f){var p=ke.getAt(u,f),m=s(p);d<m&&(d=m),l[p]=m+n}return{position:R(R({},i),{radius:l}),boundary:o,maxRadius:d}}(e,t,r),i=a.position,o=a.boundary,s=a.maxRadius,u=Om(o.box,r);return Ve.create("Molecular Surface",function(c){return ue(n,void 0,void 0,function(){return ce(this,function(l){switch(l.label){case 0:return[4,Tse(c,i,o,s,o.box,u)];case 1:return[2,l.sent()]}})})})}function Tse(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){return ce(this,function(o){return[2,Aot(e,t,r,n,a,i)]})})}T.getDefaultValues(l5);var d5=R(R(R(R({},qo),l5),tD),KX);function Iot(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,l,d,p,m,h;return ce(this,function(v){switch(v.label){case 0:return[4,Ase(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,l=o.resolution,d=o.maxRadius,[4,By({isoLevel:a.probeRadius,scalarField:o.field,idField:o.idField},i).runAsChild(e.runtime)];case 2:return p=v.sent(),a.includeParent&&(m=Math.ceil(2/a.resolution),Vt.smoothEdges(p,{iterations:m,maxNewEdgeLength:Math.sqrt(2)})),Vt.transform(p,s),e.webgl&&!e.webgl.isWebGL2?(Vt.uniformTriangleGroup(p),O.updateIfChanged(p.varyingGroup,!1)):O.updateIfChanged(p.varyingGroup,!0),h=Pe.expand(Pe(),t.boundary.sphere,d),p.setBoundingSphere(h),p.meta.resolution=l,[2,p]}})})}function Pot(e){return Ws({defaultProps:T.getDefaultValues(d5),createGeometry:Iot,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=Tc(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(_T(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}function Mot(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,c,l,f,p,m;return ce(this,function(h){switch(h.label){case 0:return[4,Eot(t,r.size,n).runInContext(e.runtime)];case 1:return i=h.sent(),o=i.transform,c=i.resolution,l=i.maxRadius,[4,By({isoLevel:n.probeRadius,scalarField:i.field,idField:i.idField},a).runAsChild(e.runtime)];case 2:return f=h.sent(),n.includeParent&&(p=Math.ceil(2/n.resolution),Vt.smoothEdges(f,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})),Vt.transform(f,o),e.webgl&&!e.webgl.isWebGL2?(Vt.uniformTriangleGroup(f),O.updateIfChanged(f.varyingGroup,!1)):O.updateIfChanged(f.varyingGroup,!0),m=Pe.expand(Pe(),t.boundary.sphere,l),f.setBoundingSphere(m),f.meta.resolution=c,[2,f]}})})}function Rot(e){return fp({defaultProps:T.getDefaultValues(d5),createGeometry:Mot,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:"on"===r.smoothColors.name&&"on"===n.smoothColors.name&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,u=o.colorTexture,c=Tc(n.smoothColors,a.color.preferSmoothing,o.resolution);c&&(_T(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;null===(r=t.meta.colorTexture)||void 0===r||r.destroy()}},e)}var Dse=R(R(R(R({},aD),l5),tD),{sizeFactor:T.Numeric(1.5,{min:0,max:10,step:.1})});function Oot(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,l,f,p;return ce(this,function(m){switch(m.label){case 0:return[4,Ase(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=m.sent(),s=o.transform,l=o.maxRadius,[4,Rk({isoLevel:a.probeRadius,scalarField:o.field,idField:o.idField},i).runAsChild(e.runtime)];case 2:return f=m.sent(),na.transform(f,s),p=Pe.expand(Pe(),t.boundary.sphere,l),f.setBoundingSphere(p),[2,f]}})})}function Fot(e){return iD({defaultProps:T.getDefaultValues(Dse),createGeometry:Oot,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Ese={"molecular-surface-mesh":function(e,t){return Oa("Molecular surface mesh",e,t,Pot)},"structure-molecular-surface-mesh":function(e,t){return ec("Structure Molecular surface mesh",e,t,Rot)},"molecular-surface-wireframe":function(e,t){return Oa("Molecular surface wireframe",e,t,Fot)}},Ise=R(R(R({},d5),Dse),{visuals:T.MultiSelect(["molecular-surface-mesh"],T.objectToOptions(Ese)),bumpFrequency:T.Numeric(1,{min:0,max:10,step:.1},st.ShadingCategory)}),kot={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:function Not(e,t){return lr.createMulti("Molecular Surface",e,t,to,Ese)},getParams:function Bot(e,t){return Ise},defaultValues:T.getDefaultValues(Ise),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},Pse=R(R({},qo),{sizeFactor:T.Numeric(1,{min:0,max:2,step:.1}),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo)});function Lot(e){return Ws({defaultProps:T.getDefaultValues(Pse),createGeometry:Vot,createLocationIterator:Got,getLoci:zot,eachLocation:Hot,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Vot(e,t,r,n,a,i){if(!function Uot(e){if(Fe.Traits.is(e.traits,Fe.Trait.MultiChain)||Fe.Traits.is(e.traits,Fe.Trait.Partitioned))return!1;if(Fe.isCoarse(e))return!0;if(0===e.elements.length)return!1;var r=e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[0]]];return!(3===r||2===r)}(t))return Vt.createEmpty(i);var o=a.detail,s=a.sizeFactor,c=yt.createState(256,128,i),l=t.principalAxes.boxAxes,d=l.origin,f=l.dirA,p=l.dirB,m=wo.size(b(),l);b.scale(m,m,s/2);var h=b.create(m[2],m[1],m[0]);c.currentGroup=0,wN(c,d,f,p,h,o+1);var v=yt.getMesh(c),g=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(g),v}function Got(e){var t=e.group,a=t.units.length,i=at.create(e.structure);return On(1,a,1,function(s,u){var c=t.units[u];return i.unit=c,i.element=c.elements[s],i})}function zot(e,t,r){if(r===e.objectId){var s=t.group.units[e.instanceId];return Re(t.structure,[{unit:s,indices:ke.ofBounds(0,s.elements.length)}])}return Wr}function Hot(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.group;if(!Ze.areEquivalent(e.structure,t.structure))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var c=u[s],l=i.unitIndexMap.get(c.unit.id);void 0!==l&&ke.size(c.indices)===o&&r(_e.ofSingleton(l))&&(n=!0)}return n}var f5,Mse={"orientation-ellipsoid-mesh":function(e,t){return Oa("Orientation ellipsoid mesh",e,t,Lot)}},Rse=R(R({},Pse),{visuals:T.MultiSelect(["orientation-ellipsoid-mesh"],T.objectToOptions(Mse)),bumpFrequency:T.Numeric(1,{min:0,max:10,step:.1},st.ShadingCategory)}),Wot={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:function qot(e,t){return lr.createMulti("Orientation",e,t,to,Mse)},getParams:function jot(e,t){return Rse},defaultValues:T.getDefaultValues(Rse),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Yot=qe.add3,Xot=qe.add;!function(e){e.create=function t(r,n,a){void 0===r&&(r=2048),void 0===n&&(n=1024);var i=qe.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,c,l){Yot(i,s,u,c),Xot(o,l)},getPoints:function(){var s=qe.compact(i,!0),u=qe.compact(o,!0);return fm.create(s,u,i.elementCount,a)}}}}(f5||(f5={}));var Ose=b.add,p5=R(R({},JQe),{pointSizeAttenuation:T.Boolean(!1),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),traceOnly:T.Boolean(!1),stride:T.Numeric(1,{min:1,max:100,step:1})});function Kot(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return fm.createEmpty(i);var s=t.elements,u=s.length,c=f5.create(u,u/10,i),l=b(),d=t.conformation.invariantPosition,f=Nv(r,t,a),p=b(),m=0;if(f)for(var h=0;h<u;++h)f(s[h])||(d(s[h],l),Ose(p,p,l),m+=1,c.add(l[0],l[1],l[2],h));else for(h=0;h<u;++h)d(s[h],l),Ose(p,p,l),m+=1,c.add(l[0],l[1],l[2],h);var y,v=i?Pe.clone(i.boundingSphere):void 0,g=c.getPoints();return 0===m||(b.scale(p,p,1/m),y=v&&b.distance(p,v.center)/v.radius<.1?v:Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor),g.setBoundingSphere(y)),g}function Fse(e){return function e$e(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:fm.Utils}),t)}({defaultProps:T.getDefaultValues(p5),createGeometry:Kot,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}var Zot={"element-point":function(e,t){return Oa("Points",e,t,Fse)}},Bse=R({},p5),Jot={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:function $ot(e,t){return lr.createMulti("Point",e,t,to,Zot)},getParams:function Qot(e,t){return Bse},defaultValues:T.getDefaultValues(Bse),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Nse={sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo),linearSegments:T.Numeric(8,{min:1,max:48,step:1},st.CustomQualityParamInfo),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo)},Cu=(T.getDefaultValues(Nse),b());function est(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Vt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=a.linearSegments,l=a.radialSegments,d=c*l*o+(l+1)*o*2,f=yt.createState(d,d/10,i),p=RL(c),m=p.curvePoints,h=p.normalVectors,v=p.binormalVectors,g=p.widthValues,y=p.heightValues,S=0,C=IL(t,r,{ignoreSecondaryStructure:!0});C.hasNext;){var _=C.move();f.currentGroup=S;var D=xd(_.moleculeType)?UD:LD;OL(p,_,ooe,D);var w=_.coarseBackboneFirst||_.first,A=_.coarseBackboneLast||_.last,E=n.size.size(_.centerPrev)*s,I=n.size.size(_.center)*s,M=n.size.size(_.centerNext)*s;LL(p,E,I,M,E,I,M,D);var F=c;if(_.initial){var N=c-(F=Math.max(Math.round(c*D),1));m.copyWithin(0,3*N),v.copyWithin(0,3*N),h.copyWithin(0,3*N),g.copyWithin(0,3*N),y.copyWithin(0,3*N),b.fromArray(Cu,m,3),b.normalize(Cu,b.sub(Cu,_.p2,Cu)),b.scaleAndAdd(Cu,_.p2,Cu,I*VD),b.toArray(Cu,m,0)}else _.final&&(F=Math.max(Math.round(c*(1-D)),1),b.fromArray(Cu,m,3*F-3),b.normalize(Cu,b.sub(Cu,_.p2,Cu)),b.scaleAndAdd(Cu,_.p2,Cu,I*VD),b.toArray(Cu,m,3*F));!0===_.initial&&!0===_.final?Mi(f,_.p2,2*I,u):2===l?rE(f,m,h,v,F,g,y,0):4===l?eE(f,m,h,v,F,g,y,0,w,A):QL(f,m,h,v,F,l,g,y,w,A,"elliptical"),++S}var j=yt.getMesh(f),U=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return j.setBoundingSphere(U),j}var kse=R(R({},qo),Nse);function tst(e){return Ws({defaultProps:T.getDefaultValues(kse),createGeometry:est,createLocationIterator:function(t){return yp.fromGroup(t,!0)},getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var oE,Lse={"polymer-tube":function(e,t){return Oa("Polymer tube mesh",e,t,tst)},"polymer-gap":function(e,t){return Oa("Polymer gap cylinder",e,t,WL)}},Use=R(R(R({},kse),ZD),{sizeFactor:T.Numeric(.2,{min:0,max:10,step:.01}),visuals:T.MultiSelect(["polymer-tube","polymer-gap"],T.objectToOptions(Lse)),bumpFrequency:T.Numeric(2,{min:0,max:10,step:.1},st.ShadingCategory)}),ast={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:function nst(e,t){return lr.createMulti("Putty",e,t,to,Lse)},getParams:function rst(e,t){var r=T.clone(Use),n=!1,a=!1;return t.units.forEach(function(i){!n&&Fe.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r},defaultValues:T.getDefaultValues(Use),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},Vse={"element-sphere":function(e,t){return Oa("Sphere mesh/impostor",e,t,Oie)},"structure-element-sphere":function(e,t){return ec("Structure sphere mesh/impostor",e,t,vnt)}},m5=R(R({},MD),{bumpFrequency:T.Numeric(1,{min:0,max:10,step:.1},st.ShadingCategory),visuals:T.MultiSelect(["element-sphere"],T.objectToOptions(Vse))}),sst={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:function ost(e,t){return lr.createMulti("Spacefill",e,t,to,Vse)},getParams:function ist(e,t){return t.isCoarseGrained?(oE||((oE=T.clone(m5)).sizeFactor.defaultValue=2),oE):m5},defaultValues:T.getDefaultValues(m5),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},h5=Gr.is;function ust(e,t,r,n,a,i){if(!Fe.isAtomic(t))return na.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return na.createEmpty(i);var u=at.create(r,t),c=t.elements,l=t.bonds,d=l.edgeCount,f=l.a,p=l.b,m=l.edgeProps,h=l.offset;if(!d)return na.createEmpty(i);var v=m.order,g=m.flags,y=a.sizeFactor,S=a.aromaticBonds,_=a.excludeTypes,x=a.multipleBonds,D="off"===x,w="symmetric"===x,I=DD(Gr.fromNames(a.includeTypes),Gr.fromNames(_),32),M=b(),F=t.conformation.invariantPosition,N=t.rings,j=N.elementRingIndices,U=N.elementAromaticRingIndices,H=S?t.resonance.delocalizedTriplets:void 0,G=jne(0,{linkCount:2*d,referencePosition:function(ne){var Y,k,W=f[ne],$=p[ne],K=H?.getThirdElement(W,$);if(void 0!==K)return F(c[K],M);W>$&&(W=(Y=[$,W])[0],$=Y[1]),h[W+1]-h[W]==1&&(W=(k=[$,W])[0],$=k[1]);for(var q=U.get(W)||j.get(W),V=0,ee=h[W],ae=h[W+1];ee<ae;++ee){var pe=p[ee];if(pe!==$&&pe!==W){if(!q)return F(c[pe],M);var me=U.get(pe)||j.get(pe);if(!me)continue;var de=Ew(q,me);de>V&&(V=de,F(c[pe],M))}}return V>0?M:null},position:function(ne,Y,k){F(c[f[k]],ne),F(c[p[k]],Y)},style:function(ne){var Y=v[ne],k=g[ne];if(h5(k,2)||h5(k,4))return 1;if(3===Y)return D?0:w?4:5;if(S){var $=p[ne],K=U.get(f[ne]),q=U.get($),V=K&&q?Ew(K,q):0;if(h5(k,16)||V&&!I)return 2===V?8:7}return 2!==Y||D?0:w?2:3},radius:function(ne){u.element=c[f[ne]];var Y=n.size.size(u);u.element=c[p[ne]];var k=n.size.size(u);return Math.min(Y,k)*y},ignore:wie(r,t,a)},a,i),J=G.lines,X=G.boundingSphere;if(X)J.setBoundingSphere(X);else if(J.lineCount>0){var Z=Pe.expand(Pe(),(s??t).boundary.sphere,1*y);J.setBoundingSphere(Z)}return J}var Gse=R(R(R({},aD),oL),{includeParent:T.Boolean(!1)});function cst(e){return iD({defaultProps:T.getDefaultValues(Gse),createGeometry:ust,createLocationIterator:Vm.fromGroup,getLoci:sL,eachLocation:uL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Es(r.includeTypes,n.includeTypes)||!Es(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Fe.isAtomic(u)&&Fe.isAtomic(c)&&(fu.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var v5=new zt.ElementBondIterator;function zse(e,t,r,n){for(v5.setElement(t,r,n);v5.hasNext;){var a=v5.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function lst(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges;if(!o)return na.createEmpty(a);var u=n.sizeFactor,c=n.aromaticBonds,l=n.multipleBonds,d="off"===l,f="symmetric"===l,p=b(),m=at.create(),v=jne(0,{linkCount:o,referencePosition:function(_){var D,w,A,E,x=s[_];if(x.unitA<x.unitB)D=t.unitMap.get(x.unitA),w=t.unitMap.get(x.unitB),A=x.indexA,E=x.indexB;else{if(!(x.unitA>x.unitB))throw new Error("same units in createInterUnitBondLines");D=t.unitMap.get(x.unitB),w=t.unitMap.get(x.unitA),A=x.indexB,E=x.indexA}return zse(p,t,D,A)||zse(p,t,w,E)},position:function(_,x,D){var w=s[D],A=t.unitMap.get(w.unitA),E=t.unitMap.get(w.unitB);A.conformation.position(A.elements[w.indexA],_),E.conformation.position(E.elements[w.indexB],x)},style:function(_){var x=s[_].props.order,D=Vo.create(s[_].props.flag);return Gr.is(D,2)||Gr.is(D,4)?1:3===x?d?0:f?4:5:c&&Gr.is(D,16)?7:2!==x||d?0:f?2:3},radius:function(_){var x=s[_];m.structure=t,m.unit=t.unitMap.get(x.unitA),m.element=m.unit.elements[x.indexA];var D=r.size.size(m);m.unit=t.unitMap.get(x.unitB),m.element=m.unit.elements[x.indexB];var w=r.size.size(m);return Math.min(D,w)*u},ignore:Aie(t,n)},n,a),g=v.lines,y=v.boundingSphere;if(y)g.setBoundingSphere(y);else if(g.lineCount>0){var S=t.child,C=Pe.expand(Pe(),(S??t).boundary.sphere,1*u);g.setBoundingSphere(C)}return g}var Hse=R(R(R({},jQe),oL),{includeParent:T.Boolean(!1)});function dst(e){return function qQe(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:na.Utils}),t)}({defaultProps:T.getDefaultValues(Hse),createGeometry:lst,createLocationIterator:Vm.fromStructure,getLoci:cL,eachLocation:dL,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Es(r.includeTypes,n.includeTypes)||!Es(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var Zy=b.scaleAndAdd,jse=b.unitX,qse=b.unitY,Wse=b.unitZ,Yse=R(R({},aD),{lineSizeAttenuation:T.Boolean(!1),ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),traceOnly:T.Boolean(!1),crosses:T.Select("lone",T.arrayToOptions(["lone","all"])),crossSize:T.Numeric(.35,{min:0,max:2,step:.01})});function fst(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return na.createEmpty(i);for(var s=t.elements,u=s.length,c=uu.create(u,u/10,i),l=b(),d=b(),f=b(),p=t.conformation.invariantPosition,m=Nv(r,t,a),h=a.crossSize/2,v="lone"===a.crosses,g=0;g<u;++g)m&&m(s[g])||v&&Fe.isAtomic(t)&&0!==Ud(r,t,g)||(p(s[g],l),Zy(d,l,jse,h),Zy(f,l,jse,-h),c.add(d[0],d[1],d[2],f[0],f[1],f[2],g),Zy(d,l,qse,h),Zy(f,l,qse,-h),c.add(d[0],d[1],d[2],f[0],f[1],f[2],g),Zy(d,l,Wse,h),Zy(f,l,Wse,-h),c.add(d[0],d[1],d[2],f[0],f[1],f[2],g));var y=c.getLines(),S=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(S),y}function pst(e){return iD({defaultProps:T.getDefaultValues(Yse),createGeometry:fst,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var Xse={"intra-bond":function(e,t){return Oa("Intra-unit bond line",e,t,cst)},"inter-bond":function(e,t){return ec("Inter-unit bond line",e,t,dst)},"element-point":function(e,t){return Oa("Points",e,t,Fse)},"element-cross":function(e,t){return Oa("Crosses",e,t,pst)}},Kse=R(R(R(R(R({},Gse),Hse),p5),Yse),{pointStyle:T.Select("circle",T.objectToOptions(fm.StyleTypes)),multipleBonds:T.Select("offset",T.arrayToOptions(["off","symmetric","offset"])),includeParent:T.Boolean(!1),sizeFactor:T.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:j2(["atomic"]),visuals:T.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],T.objectToOptions(Xse))}),vst={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:function hst(e,t){return lr.createMulti("Line",e,t,to,Xse)},getParams:function mst(e,t){return Kse},defaultValues:T.getDefaultValues(Kse),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function gst(e,t,r,n,a){return ue(this,void 0,void 0,function(){var i,o,u,c,l,d,f,p,m,h,v,g,y;return ce(this,function(S){switch(S.label){case 0:if(i=e.runtime,!(o=e.webgl)||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return[4,$it(t,r.size,n,o,a?a.gridTexture.ref.value:void 0).runInContext(i)];case 1:return u=S.sent(),c=u.transform,l=u.texture,d=u.bbox,f=u.gridDim,p={min:0,max:1,mean:.04,sigma:.01},m=he.mul(he(),c,he.fromScaling(he(),f)),h=he.getScaling(b(),c),v=b.create(0,1,2),g=ju.create(d,f,c,m,h,l,p,!0,v,a),y=Pe.expand(Pe(),t.boundary.sphere,u.maxRadius),g.setBoundingSphere(y),[2,g]}})})}var Zse=R(R(R({},XQe),gC),{ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),includeParent:T.Boolean(!1,{isHidden:!0})});function yst(e){return function KQe(e,t){return Dv(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ju.Utils}),t)}({defaultProps:T.getDefaultValues(Zse),createGeometry:gst,createLocationIterator:ro.fromStructure,getLoci:Lv,eachLocation:kv,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function bst(e,t,r,n,a,i){return ue(this,void 0,void 0,function(){var o,s,c,l,d,f,p,m,h,v,g,y,S;return ce(this,function(C){switch(C.label){case 0:if(o=e.runtime,!(s=e.webgl))throw new Error("GaussianDensityVolume requires `webgl`");return[4,Kit(r,t,n.size,a,s,i?i.gridTexture.ref.value:void 0).runInContext(o)];case 1:return c=C.sent(),l=c.transform,d=c.texture,f=c.bbox,p=c.gridDim,m={min:0,max:1,mean:.04,sigma:.01},h=he.mul(he(),l,he.fromScaling(he(),p)),v=he.getScaling(b(),l),g=b.create(0,1,2),y=ju.create(f,p,l,h,v,d,m,!0,g,i),S=Pe.expand(Pe(),t.boundary.sphere,c.maxRadius),y.setBoundingSphere(S),[2,y]}})})}var Sst=R(R(R({},t$e),gC),{ignoreHydrogens:T.Boolean(!1),ignoreHydrogensVariant:T.Select("all",T.arrayToOptions(["all","non-polar"])),includeParent:T.Boolean(!1,{isHidden:!0})});function Cst(e){return function r$e(e,t){return Fm(R(R({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ki.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ju.Utils}),t)}({defaultProps:T.getDefaultValues(Sst),createGeometry:bst,createLocationIterator:ro.fromGroup,getLoci:Ol,eachLocation:Rl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var Qse={"gaussian-volume":function(e,t){return ec("Gaussian volume",e,t,yst)},"units-gaussian-volume":function(e,t){return Oa("Units-Gaussian volume",e,t,Cst)}},$se=R(R({},Zse),{jumpLength:T.Numeric(4,{min:0,max:20,step:.1}),visuals:T.MultiSelect(["gaussian-volume"],T.objectToOptions(Qse))}),wst={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:function _st(e,t){return lr.createMulti("Gaussian Volume",e,t,to,Qse)},getParams:function xst(e,t){return $se},defaultValues:T.getDefaultValues($se),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},Ast=b.scale,Tst=b.add,Dst=b.sub,g5=R(R(R({},qo),Une),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:T.Numeric(16,{min:2,max:56,step:2},st.CustomQualityParamInfo),tryUseImpostor:T.Boolean(!0)});function Est(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?function Pst(e){return Vne({defaultProps:T.getDefaultValues(g5),createGeometry:Ist,createLocationIterator:yp.fromGroup,getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function Rst(e){return Ws({defaultProps:T.getDefaultValues(g5),createGeometry:Mst,createLocationIterator:yp.fromGroup,getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}function Ist(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return qu.createEmpty(i);var s=2*o,u=oD.create(s,s/4,i),c=t.conformation.invariantPosition,l=b(),d=b(),f=b();Zie(t,function(v,g,y,S,C){c(v,l),c(g,d);var x=xd(C)?UD:LD;Tst(f,l,Ast(f,Dst(f,d,l),x)),u.add(l[0],l[1],l[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,S)});var m=u.getCylinders(),h=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return m.setBoundingSphere(h),m}function Mst(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Vt.createEmpty(i);var s=a.radialSegments,u=a.sizeFactor,c=2*s*o*2,l=yt.createState(c,c/10,i),d=t.conformation.invariantPosition,f=b(),p=b(),m={radiusTop:1,radiusBottom:1,radialSegments:s},h=at.create(r,t),v=at.create(r,t);Zie(t,function(C,_,x,D,w){h.element=C,v.element=_,d(h.element,f),d(v.element,p);var E=xd(w)?UD:LD;m.radiusTop=m.radiusBottom=n.size.size(h)*u,l.currentGroup=x,yo(l,f,p,E,m),m.radiusTop=m.radiusBottom=n.size.size(v)*u,l.currentGroup=D,yo(l,p,f,1-E,m)});var y=yt.getMesh(l),S=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(S),y}var y5=R(R(R({},qo),kne),{sizeFactor:T.Numeric(.3,{min:0,max:10,step:.01}),detail:T.Numeric(0,{min:0,max:3,step:1},st.CustomQualityParamInfo),tryUseImpostor:T.Boolean(!0)});function Ost(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?function Bst(e){return Lne({defaultProps:T.getDefaultValues(y5),createGeometry:Fst,createLocationIterator:yp.fromGroup,getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}(e):function kst(e){return Ws({defaultProps:T.getDefaultValues(y5),createGeometry:Nst,createLocationIterator:yp.fromGroup,getLoci:Vv,eachLocation:Gv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}(e)}function Fst(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Cd.createEmpty(i);var s=oC.create(o,o/2,i),u=t.conformation.invariantPosition,c=b();Qie(t,function(p,m){u(p,c),s.add(c[0],c[1],c[2],m)});var d=s.getSpheres(),f=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return d.setBoundingSphere(f),d}function Nst(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Vt.createEmpty(i);var s=a.detail,u=a.sizeFactor,c=o*kS(s),l=yt.createState(c,c/2,i),d=t.conformation.invariantPosition,f=b(),p=at.create(r,t);Qie(t,function(g,y){p.element=g,d(p.element,f),l.currentGroup=y,Mi(l,f,n.size.size(p)*u,s)});var h=yt.getMesh(l),v=Pe.expand(Pe(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(v),h}var Jse={"polymer-backbone-cylinder":function(e,t){return Oa("Polymer backbone cylinder",e,t,Est)},"polymer-backbone-sphere":function(e,t){return Oa("Polymer backbone sphere",e,t,Ost)},"polymer-gap":function(e,t){return Oa("Polymer gap cylinder",e,t,WL)}},eue=R(R(R(R({},y5),g5),ZD),{sizeAspectRatio:T.Numeric(1,{min:.1,max:3,step:.1}),visuals:T.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],T.objectToOptions(Jse)),bumpFrequency:T.Numeric(0,{min:0,max:10,step:.1},st.ShadingCategory)}),Vst={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:function Ust(e,t){return lr.createMulti("Backbone",e,t,to,Jse)},getParams:function Lst(e,t){var r=T.clone(eue),n=!1;return t.units.forEach(function(a){!n&&a.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r},defaultValues:T.getDefaultValues(eue),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},b5=function(e){function t(){var r=e.call(this)||this;return Fs(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return jt(t,e),t}(Uee);!function(e){e.BuiltIn={cartoon:hit,backbone:Vst,"ball-and-stick":Cnt,carbohydrate:iat,ellipsoid:Sit,"gaussian-surface":mot,"gaussian-volume":wst,label:xot,line:vst,"molecular-surface":kot,orientation:Wot,point:Jot,putty:ast,spacefill:sst}}(b5||(b5={}));var Gst=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(ia()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n,a;return ue(this,void 0,void 0,function(){var i,o,s;return ce(this,function(c){switch(c.label){case 0:return[4,this.plugin.managers.animation.tick(t,r?.isSynchronous,r?.animation)];case 1:if(c.sent(),null===(n=this.plugin.canvas3d)||void 0===n||n.tick(t,r),xt&&(i=null===(a=this.plugin.canvas3d)||void 0===a?void 0:a.webgl.timer.resolve()))for(o=0,s=i;o<s.length;o++)AX([s[o]]);return[2]}})})},e.prototype.resetTime=function(t){var r;void 0===t&&(t=ia()),null===(r=this.plugin.canvas3d)||void 0===r||r.resetTime(t)},e.prototype.start=function(t){var r;null===(r=this.plugin.canvas3d)||void 0===r||r.resume(),this._isAnimating=!0,this.resetTime(),t?.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,void 0!==this.currentFrame&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t?.noDraw&&(null===(r=this.plugin.canvas3d)||void 0===r||r.pause(t?.noDraw))},e}(),S5=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=Uw.create(new ve.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(pa.State.HistoryCapacity)}),n.behaviors=Uw.create(new $r.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:Ll(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:Ll(n.data.events.cell.created,n.behaviors.events.cell.created),removed:Ll(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:Ll(n.data.events.object.created,n.behaviors.events.object.created),removed:Ll(n.data.events.object.removed,n.behaviors.events.object.removed),updated:Ll(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(R(R({},t.DefaultSnapshotParams),a))},n}return jt(t,e),Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=R(R({},this.snapshotParams.value),r);return{id:kn.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:"animate"===(null===(n=i?.cameraTransition)||void 0===n?void 0:n.name)?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:null===(a=this.plugin.canvas3d)||void 0===a?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:i.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:i.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:i?.durationInMs}},t.prototype.setSnapshot=function(r){var n,a,i;return ue(this,void 0,void 0,function(){var o;return ce(this,function(s){switch(s.label){case 0:return[4,this.animation.stop()];case 1:return s.sent(),!(null===(n=r.structureComponentManager)||void 0===n)&&n.options&&this.plugin.managers.structure.component._setSnapshotState(null===(a=r.structureComponentManager)||void 0===a?void 0:a.options),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:s.sent(),s.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:s.sent(),s.label=5;case 5:return null!==(i=r.canvas3d)&&void 0!==i&&i.props?(o=T.normalizeParams(Bre,r.canvas3d.props,"children"),[4,yr.Canvas3D.SetSettings(this.plugin,{settings:o})]):[3,7];case 6:s.sent(),s.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(r.structureSelection),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&yr.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:"animate"===r.camera.transitionStyle?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return yr.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.hasBehavior=function(r){return this.behaviors.tree.transforms.has(r.id)},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to($r.getCategoryId(r)).apply(r,AS(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){var n,a,i,o;$r.Behavior.is(r.obj)&&(null===(a=(n=r.obj.data).unregister)||void 0===a||a.call(n),null===(o=(i=r.obj.data).dispose)||void 0===o||o.call(i))}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(L2);!function(e){e.SnapshotParams={durationInMs:T.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:T.Boolean(!0),behavior:T.Boolean(!1),structureSelection:T.Boolean(!1),componentManager:T.Boolean(!0),animation:T.Boolean(!0),startAnimation:T.Boolean(!1),canvas3d:T.Boolean(!0),interactivity:T.Boolean(!0),camera:T.Boolean(!0),cameraTransition:T.MappedStatic("animate",{animate:T.Group({durationInMs:T.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:T.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:T.Boolean(!1)},e.DefaultSnapshotParams=T.getDefaultValues(e.SnapshotParams)}(S5||(S5={}));var zst=function(){function e(t){var r=this;this.plugin=t,this.ev=bf.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(1!==n.size)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){void 0===r&&(r=!1);var n=this.root.get(t);if(n)return this.plugin.state.data.cells.get(r?n.ref:this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ve.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data))this.root.get(n.data).count++;else{var i=t.select(xr.Generators.byRef(r).rootOfType([ve.Molecule.Structure]))[0];this.root.set(n.data,i?{ref:i.transform.ref,count:1}:{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return!!ve.Molecule.Structure.is(a)&&(this.removeMapping(r),this.addMapping(t,r,a),!0)},e.prototype.dispose=function(){this.ev.dispose()},e}(),C5=function(){function e(){this.ev=bf.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var i=this.tryGetAbortTaskId(n[r]);if(void 0!==i)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);void 0!==o&&a.requestAbort(n.abortRequests.get(o))}var s=ia()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:null===(i=n.options.get(r))||void 0===i?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return ue(this,void 0,void 0,function(){var n,a;return ce(this,function(o){switch(o.label){case 0:n=this.id++,r?.createNewContext||0===this.currentContext.length?a={ctx:_we(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1]).refCount++,o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!r?.useOverlay}),this.runningTasks.add(t.id),[4,eW(a.ctx,t)];case 2:return[2,o.sent()];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,0===a.refCount&&gS(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){this.abortRequests.set("number"==typeof t?t:t.root.progress.taskId,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();!function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}e.testTask=function r(n){var a=this;return Ve.create("Test",function(i){return ue(a,void 0,void 0,function(){var o;return ce(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+200*Math.random())]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}}(C5||(C5={}));var Hst=function(e){function t(r){var n=e.call(this,{entries:vc()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,yr.Toast.Show.subscribe(r,function(a){return n.show(a)}),yr.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return jt(t,e),t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var s,n=this,a=this.state.entries,i=void 0,o=++this.serialId;r.key&&(i=this.findByKey(r.key))?(void 0!==i.timeout&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next(void 0)},t.prototype.timeout=function(r,n){var a=this;if(void 0!==n)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){r&&(void 0!==r.timeout&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next(void 0))},t}(lp),jst=function(e){function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=document.createElement("canvas"),n.previewCanvas=document.createElement("canvas"),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:dt(0),transparent:!1},n}return jt(t,e),t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:T.MappedStatic("viewport",{viewport:T.Group({}),hd:T.Group({}),"full-hd":T.Group({}),"ultra-hd":T.Group({}),custom:T.Group({width:T.Numeric(1920,{min:128,max:r,step:1}),height:T.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:T.Boolean(!1),axes:jT.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:(null===(r=this.plugin.canvas3d)||void 0===r?void 0:r.webgl.gl.drawingBufferWidth)||0,height:(null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=n.props.postprocessing.occlusion;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:R(R({},n.props.multiSample),{mode:r?"on":"off",sampleLevel:i&&o?4:2}),postprocessing:R(R({},n.props.postprocessing),{occlusion:"on"===s.name?{name:"on",params:R(R({},s.params),{samples:128,resolutionScale:n.webgl.pixelRatio})}:s}),marking:R({},n.props.marking)})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d,n=r.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:R(R({},r.props.postprocessing),{occlusion:"on"===n.name?{name:"on",params:R(R({},n.params),{samples:128,resolutionScale:r.webgl.pixelRatio})}:n}),marking:R({},r.props.marking)}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){void 0===r&&(r=".png");var n=this.plugin.state.data.select(xr.Generators.rootsOfType(ve.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=sa.toArray(a).join("-");return"".concat(i||"molstar-image").concat(r)},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(R(R({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(R(R({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return ea(r.x,0,1e-5)&&ea(r.y,0,1e-5)&&ea(r.width,1,1e-5)&&ea(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){void 0===r&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,c=i,l=0,d=o,f=0,p=0;p<o;p++)for(var m=p*i,h=0;h<i;h++){var v=4*(m+h);if(s){if(0===a[v+3])continue}else if((a[v]<<16|a[v+1]<<8|a[v+2]|a[v+3]<<24)===u)continue;h<c&&(c=h),h>l&&(l=h),p<d&&(d=p),p>f&&(f=p)}if(c>l){var y=c;c=l,l=y}d>f&&(y=d,d=f,f=y);var S=l-c+1,C=f-d+1;c-=r*S,l+=r*S,d-=r*C,f+=r*C;var _={x:Math.max(0,c/i),y:Math.max(0,d/o),width:Math.min(1,(l-c+1)/i),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(_)},t.prototype.getPreview=function(r){void 0===r&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var c=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:c.postprocessing,marking:c.marking});var l=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=l.width,d.height=l.height,this.previewData.image=l,this.previewData.background=c.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(l,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return ce(this,function(d){switch(d.label){case 0:return n=this.getSizeAndViewport(),i=n.height,o=n.viewport,(a=n.width)<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return d.sent(),[4,(s=this.imagePass).updateBackground()];case 2:return d.sent(),u=s.getImageData(a,i,o),[4,r.update("Encoding image...")];case 3:if(d.sent(),(c=this.canvas).width=u.width,c.height=u.height,!(l=c.getContext("2d")))throw new Error("Could not create canvas 2d context");return l.putImageData(u,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(n?.write)return Ve.create("Copy Image",function(a){return ue(r,void 0,void 0,function(){var i,o;return ce(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,IN(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})});this.plugin.log.error("clipboard.write not supported!")},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(Ve.create("Generate Image",function(n){return ue(r,void 0,void 0,function(){return ce(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return Ve.create("Download Image",function(a){return ue(n,void 0,void 0,function(){return ce(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,IN(this.canvas,"png")];case 3:return Bte(o.sent(),r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(L2),qst=function(){function e(t){this.plugin=t,this.handlers=[]}return e.prototype.addHandler=function(t,r){var n=this.handlers.findIndex(function(a){return a[0]===t});n<0?this.handlers.push([t,r]):this.handlers[n][1]=r},e.prototype.removeHandler=function(t){var r=this.handlers.findIndex(function(n){return n[0]===t});r>=0&&this.handlers.splice(r,1)},e.prototype.handle=function(t){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:r=this.handlers.length-1,i.label=1;case 1:return r>=0?[4,(0,this.handlers[r][1])(t,this.plugin)]:[3,4];case 2:if(i.sent())return[2];i.label=3;case 3:return r--,[3,1];case 4:return function Wst(e,t){var r=t.filter(function(n){var a=n.name.toLowerCase();return a.endsWith(".molx")||a.endsWith(".molj")});r.length>0?yr.State.Snapshots.OpenFile(e,{file:r[0]}):e.runTask(e.state.data.applyAction(Sae,{files:t.map(function(n){return dn.File(n)}),format:{name:"auto",params:{}},visuals:!0}))}(this.plugin,t),[2]}})})},e.prototype.dispose=function(){this.handlers.length=0},e}(),Yst=function(){function e(t){var n,r=this;this.spec=t,this.runTask=function(a,i){return r.managers.task.run(a,i)},this.resolveTask=function(a){if(a)return Ve.is(a)?r.runTask(a):a},this.subs=[],this.initCanvas3dPromiseCallbacks=[function(){},function(){}],this._isInitialized=!1,this.initializedPromiseCallbacks=[function(){},function(){}],this.disposed=!1,this.canvasContainer=void 0,this.ev=bf.create(),this.config=new fWe(this.spec.config),this.state=new S5(this),this.commands=new Jqe,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:lr.Loci.Empty,modifiers:$u.None,buttons:0,button:0}),click:this.ev.behavior({current:lr.Loci.Empty,modifiers:$u.None,buttons:0,button:0}),drag:this.ev.behavior({current:lr.Loci.Empty,modifiers:$u.None,buttons:0,button:0,pageStart:Be(),pageEnd:Be()}),key:this.ev.behavior(rre),keyReleased:this.ev.behavior(rre),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(uf(function(a){return!!a}),bh(1))}},this.canvas3dInitialized=new Promise(function(a,i){r.initCanvas3dPromiseCallbacks=[a,i]}),this.initialized=new Promise(function(a,i){r.initializedPromiseCallbacks=[a,i]}),this.layout=new Jrt(this),this.animationLoop=new Gst(this),this.representation={structure:{registry:new b5,themes:{colorThemeRegistry:hu.createRegistry(),sizeThemeRegistry:ki.createRegistry()}},volume:{registry:new bD,themes:{colorThemeRegistry:hu.createRegistry(),sizeThemeRegistry:ki.createRegistry()}}},this.query={structure:{registry:new YVe}},this.dataFormats=new Xtt,this.builders={data:new Ttt(this),structure:void 0},this.helpers={substructureParent:new zst(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new Qk(this),component:new Kk(this),measurement:new Brt(this),selection:new krt(this),focus:new vrt(this)},volume:{hierarchy:new rL(this)},interactivity:void 0,camera:new lrt(this),animation:new Ktt(this),snapshot:new Sy(this),lociLabels:void 0,toast:new Hst(this),asset:new dAe,task:new C5,dragAndDrop:new qst(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new xD.Registry,this.customStructureProperties=new xD.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:ff(),entry:function(a){return r.events.log.next(a)},error:function(a){return r.events.log.next(ud.error(a))},message:function(a){return r.events.log.next(ud.message(a))},info:function(a){return r.events.log.next(ud.info(a))},warn:function(a){return r.events.log.next(ud.warning(a))}},this.fetch=LO,MAe(!1),function dBe(e){Kf="default"===e?KK:lBe}(null!==(n=this.config.get(pa.Structure.SaccharideCompIdMapType))&&void 0!==n?n:"default")}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype.build=function(){return this.state.data.build()},e.prototype.initContainer=function(t){var r;if(this.canvasContainer)return!0;var n=document.createElement("div");Object.assign(n.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});var a=null===(r=t?.canvas3dContext)||void 0===r?void 0:r.canvas;return a||(a=document.createElement("canvas"),t?.checkeredCanvasBackground&&Object.assign(a.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}),n.appendChild(a)),!!this.initViewer(a,n,t?.canvas3dContext)&&(this.canvasContainer=n,!0)},e.prototype.mount=function(t,r){var n;if(this.disposed)throw new Error("Cannot mount a disposed context");return!!this.initContainer(r)&&(this.canvasContainer.parentElement!==t&&(null===(n=this.canvasContainer.parentElement)||void 0===n||n.removeChild(this.canvasContainer)),t.appendChild(this.canvasContainer),this.handleResize(),!0)},e.prototype.unmount=function(){var t,r;null===(r=null===(t=this.canvasContainer)||void 0===t?void 0:t.parentElement)||void 0===r||r.removeChild(this.canvasContainer)},e.prototype.initViewer=function(t,r,n){var i,o,s,u,c,l,d,a=this;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var f=!(null!==(i=this.config.get(pa.General.DisableAntialiasing))&&void 0!==i&&i),p=!(null!==(o=this.config.get(pa.General.DisablePreserveDrawingBuffer))&&void 0!==o&&o),m=this.config.get(pa.General.PixelScale)||1,h=this.config.get(pa.General.PickScale)||.25,v=null!==(s=this.config.get(pa.General.PickPadding))&&void 0!==s?s:1,g=this.config.get(pa.General.EnableWboit)||!1,y=this.config.get(pa.General.EnableDpoit)||!1,S=this.config.get(pa.General.PreferWebGl1)||!1,C=!(null!==(u=this.config.get(pa.General.AllowMajorPerformanceCaveat))&&void 0!==u&&u),_=this.config.get(pa.General.PowerPreference)||"high-performance";this.canvas3dContext=YN.fromCanvas(t,this.managers.asset,{antialias:f,preserveDrawingBuffer:p,pixelScale:m,pickScale:h,pickPadding:v,enableWboit:g,enableDpoit:y,preferWebGl1:S,failIfMajorPerformanceCaveat:C,powerPreference:_})}this.canvas3d=XN.create(this.canvas3dContext),this.canvas3dInit.next(!0);var x=this.spec.canvas3d,D=dt(16579577);return x?(void 0===(null===(l=x.renderer)||void 0===l?void 0:l.backgroundColor)&&(x=eF(x,function(w){w.renderer?w.renderer.backgroundColor=D:w.renderer={backgroundColor:D}})),null===(d=this.canvas3d)||void 0===d||d.setProps(x)):null===(c=this.canvas3d)||void 0===c||c.setProps({renderer:{backgroundColor:D}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new jst(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(w){return a.behaviors.interaction.click.next(w)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(w){return a.behaviors.interaction.drag.next(w)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(w){return a.behaviors.interaction.hover.next(w)})),this.subs.push(this.canvas3d.input.resize.pipe(function Att(e,t=Pk){return di((r,n)=>{let a=null,i=null,o=null;const s=()=>{if(a){a.unsubscribe(),a=null;const c=i;i=null,n.next(c)}};function u(){const c=o+e,l=t.now();if(l<c)return a=this.schedule(void 0,c-l),void n.add(a);s()}r.subscribe(fi(n,c=>{i=c,o=t.now(),a||(a=t.schedule(u,e),n.add(a))},()=>{s(),n.complete()},void 0,()=>{i=a=null}))})}(50),wae(100,void 0,{leading:!1,trailing:!0})).subscribe(function(){return a.handleResize()})),this.subs.push(this.canvas3d.input.keyDown.subscribe(function(w){return a.behaviors.interaction.key.next(w)})),this.subs.push(this.canvas3d.input.keyUp.subscribe(function(w){return a.behaviors.interaction.keyReleased.next(w)})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),sS.setImmediate(function(){return a.initCanvas3dPromiseCallbacks[0]()}),!0}catch(w){return this.log.error(""+w),console.error(w),sS.setImmediate(function(){return a.initCanvas3dPromiseCallbacks[1](w)}),!1}},e.prototype.handleResize=function(){var t,r,n=null===(t=this.canvas3dContext)||void 0===t?void 0:t.canvas,a=this.layout.root;a&&n&&(function oWe(e,t,r){void 0===r&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),function iWe(e,t,r,n){void 0===n&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:"".concat(t,"px"),height:"".concat(r,"px")})}(e,n,a,r)}(n,a,this.config.get(pa.General.PixelScale)||1),null===(r=this.canvas3d)||void 0===r||r.requestResize())},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return void 0===t&&(t=!1),t&&(null===(r=this.canvas3d)||void 0===r||r.setProps(WN)),yr.State.RemoveObject(this,{state:this.state.data,ref:on.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++)i[a].unsubscribe();this.subs=[],this.animationLoop.stop(),this.commands.dispose(),null===(r=this.canvas3d)||void 0===r||r.dispose(),null===(n=this.canvas3dContext)||void 0===n||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),Fs(this.managers,function(s){var u;return null===(u=s?.dispose)||void 0===u?void 0:u.call(s)}),Fs(this.managers.structure,function(s){var u;return null===(u=s?.dispose)||void 0===u?void 0:u.call(s)}),Fs(this.managers.volume,function(s){var u;return null===(u=s?.dispose)||void 0===u?void 0:u.call(s)}),this.unmount(),this.canvasContainer=void 0,this.customState={},this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(Ll(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(pa.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){void 0!==a&&clearTimeout(a),a=void 0};this.subs.push(Ll(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){t.behaviors.state.isUpdating.value||t.behaviors.state.isAnimating.value?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||null===(u=t.managers.interactivity)||void 0===u||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;lD.State.registerDefault(this),lD.Representation.registerDefault(this),lD.Camera.registerDefault(this),lD.Misc.registerDefault(this),this.subs.push(Ll(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ue(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c;return ce(this,function(l){switch(l.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys($r.Categories);r<n.length;r++)c=n[r],t.toRoot().apply($r.CreateCategory,{label:$r.Categories[c]},{ref:c,state:{isLocked:!0}});for(a=0,i=this.spec.behaviors;a<i.length;a++)"custom-props"===(c=$r.getCategoryId((u=i[a]).transformer))&&t.to($r.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(l.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)"custom-props"!==(c=$r.getCategoryId((u=s[o]).transformer))&&t.to($r.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return l.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++)this.managers.animation.register(r[t])},e.prototype.initDataActions=function(){if(this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++)this.state.data.actions.add(r[t].action)},e.prototype.init=function(){return ue(this,void 0,void 0,function(){var t,r=this;return ce(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.subs.push(this.events.log.subscribe(function(a){return r.log.entries=r.log.entries.push(a)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new Xk(this),this.managers.lociLabels=new drt(this),this.builders.structure=new Ntt(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return n.sent(),this.log.message("Mol* Plugin ".concat("3.43.0"," [").concat(aWe.toLocaleString(),"]")),uS||this.log.message("Development mode enabled"),Cr&&this.log.message("Debug mode enabled"),this._isInitialized=!0,this.initializedPromiseCallbacks[0](),[3,3];case 2:throw t=n.sent(),this.initializedPromiseCallbacks[1](t),t;case 3:return[2]}})})},e}();const Xst=["parent"],Kst=["canvas"];let Zst=(()=>{class e{set source(r){this.source$.next(r)}set loci(r){this.loci$.next(r)}set contacts(r){this.contacts$.next(r)}constructor(){this.parent$=new P1(1),this.source$=new P1(1),this.loci$=new P1(1),this.contacts$=new P1(1),this.selected=new Uo,this.highlighted=new Uo,this.plugin$=this.initPlugin(),this.structure$=this.initStructure(),this.update$=this.updateRepresentation(),this._update=this.update$.subscribe()}initPlugin(){const r={actions:[ir.Action(Rv.Structure.DownloadStructure),ir.Action(Rv.Volume.DownloadDensity),ir.Action(Rv.DataFormat.DownloadFile),ir.Action(Rv.DataFormat.OpenFiles),ir.Action(Rv.Structure.LoadTrajectory),ir.Action(Rv.Structure.EnableModelCustomProps),ir.Action(Rv.Structure.EnableStructureCustomProps),ir.Action(gtt),ir.Action(ytt),ir.Action(qae),ir.Action(et.Data.Download),ir.Action(et.Data.ParseCif),ir.Action(et.Data.ParseCcp4),ir.Action(et.Data.ParseDsn6),ir.Action(et.Model.TrajectoryFromMmCif),ir.Action(et.Model.TrajectoryFromCifCore),ir.Action(et.Model.TrajectoryFromPDB),ir.Action(et.Model.TransformStructureConformation),ir.Action(et.Model.StructureFromModel),ir.Action(et.Model.StructureFromTrajectory),ir.Action(et.Model.ModelFromTrajectory),ir.Action(et.Model.StructureSelectionFromScript),ir.Action(et.Representation.StructureRepresentation3D),ir.Action(et.Representation.StructureSelectionsDistance3D),ir.Action(et.Representation.StructureSelectionsAngle3D),ir.Action(et.Representation.StructureSelectionsDihedral3D),ir.Action(et.Representation.StructureSelectionsLabel3D),ir.Action(et.Representation.StructureSelectionsOrientation3D),ir.Action(et.Representation.ModelUnitcell3D),ir.Action(et.Representation.StructureBoundingBox3D),ir.Action(et.Representation.ExplodeStructureRepresentation3D),ir.Action(et.Representation.SpinStructureRepresentation3D),ir.Action(et.Representation.UnwindStructureAssemblyRepresentation3D),ir.Action(et.Representation.OverpaintStructureRepresentation3DFromScript),ir.Action(et.Representation.TransparencyStructureRepresentation3DFromScript),ir.Action(et.Representation.ClippingStructureRepresentation3DFromScript),ir.Action(et.Representation.SubstanceStructureRepresentation3DFromScript),ir.Action(et.Representation.ThemeStrengthRepresentation3D),ir.Action(bae),ir.Action(et.Volume.VolumeFromCcp4),ir.Action(et.Volume.VolumeFromDsn6),ir.Action(et.Volume.VolumeFromCube),ir.Action(et.Volume.VolumeFromDx),ir.Action(et.Representation.VolumeRepresentation3D)],behaviors:[ir.Behavior(yu.Representation.HighlightLoci),ir.Behavior(yu.Representation.SelectLoci),ir.Behavior(yu.Representation.DefaultLociLabelProvider),ir.Behavior(yu.Representation.FocusLoci),ir.Behavior(yu.Camera.FocusLoci),ir.Behavior(yu.Camera.CameraAxisHelper),ir.Behavior(yu.Camera.CameraControls),ir.Behavior(fD),ir.Behavior(yu.CustomProps.StructureInfo),ir.Behavior(yu.CustomProps.AccessibleSurfaceArea),ir.Behavior(yu.CustomProps.BestDatabaseSequenceMapping),ir.Behavior(yu.CustomProps.Interactions),ir.Behavior(yu.CustomProps.SecondaryStructure),ir.Behavior(yu.CustomProps.ValenceModel),ir.Behavior(yu.CustomProps.CrossLinkRestraint)],animations:[rWe,tWe,_tt,nWe,eWe,xtt,Ctt]};return this.parent$.pipe($n(()=>({parent:this._parent.nativeElement,canvas:this._canvas.nativeElement})),nc(({parent:n,canvas:a})=>So(mj(function*(){const i=new Yst(r);if(yield i.init(),!i.initViewer(a,n))throw new Error("Could not render the Mol* plugin");return i})())),function Sxe(e,t,r){let n,a=!1;return e&&"object"==typeof e?({bufferSize:n=1/0,windowTime:t=1/0,refCount:a=!1,scheduler:r}=e):n=e??1/0,YE({connector:()=>new P1(n,t,r),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}(1))}initStructure(){return this.plugin$.pipe(vj(this.source$),nc(([r,n])=>So(mj(function*(){let a;const i=n.label||"structure",o=n.format||"mmcif",s=!0===n.compressed;if("string"==typeof n.data){const c=dn.Url(n.data);a=yield r.builders.data.download({url:c,label:i,isBinary:s})}else{const c=dn.File(n.data instanceof Blob?new File([n.data],`${i}.${o}`):n.data);a=yield r.builders.data.readFile({file:c,label:i,isBinary:s})}const u=yield r.builders.structure.parseTrajectory(a,o);return yield r.builders.structure.hierarchy.applyPreset(u,"default"),r.managers.structure.hierarchy.current.structures[0]?.cell.obj?.data})())))}updateRepresentation(){return this.structure$.pipe(vj(this.loci$,this.contacts$),$n(()=>{}))}ngAfterViewInit(){this.parent$.next(this._parent.nativeElement)}ngOnDestroy(){this._update.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=NC({type:e,selectors:[["ngx-structure-viewer"]],viewQuery:function(n,a){if(1&n&&(qP(Xst,5),qP(Kst,5)),2&n){let i;i_(i=o_())&&(a._parent=i.first),i_(i=o_())&&(a._canvas=i.first)}},inputs:{source:"source",loci:"loci",contacts:"contacts"},outputs:{selected:"selected",highlighted:"highlighted"},standalone:!0,features:[t_],decls:4,vars:0,consts:[[2,"position","relative","width","100%","height","100%"],["parent",""],[2,"position","absolute","left","0","top","0","width","100%","height","100%"],["canvas",""]],template:function(n,a){1&n&&(Yg(0,"div",0,1),$b(2,"canvas",2,3),Xg())}})}return e})();(function PSe(e,t){return Lye({rootComponent:e,...n9(t)})})((()=>{class e{constructor(){this.title="demo-showcase",this.source={data:"https://files.rcsb.org/view/1CU4.cif",label:"1CU4",compressed:!1},this.loci=[{start:"1",end:"10",chain:"A",color:"#ff0000"},{start:"11",end:"20",chain:"A",color:"#00ff00"},{start:"21",end:"30",chain:"A",color:"#0000ff"}],this.contacts=[]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=NC({type:e,selectors:[["app-root"]],standalone:!0,features:[t_],decls:4,vars:3,consts:[[2,"width","600px","height","600px","outline","2px solid orangered"],[3,"source","loci"]],template:function(n,a){1&n&&(Yg(0,"h1"),function qz(e,t=""){const r=ct(),n=wn(),a=e+Ur,i=n.firstCreatePass?Eg(n,a,1,t,null):n.data[a],o=Wz(n,r,i,t,e);r[a]=o,HC()&&hx(n,r,o,i),ql(i,!1)}(1),Xg(),Yg(2,"div",0),$b(3,"ngx-structure-viewer",1),Xg()),2&n&&(F3(1),PP(a.title),F3(2),tP("source",a.source)("loci",a.loci))},dependencies:[U1e,Zst]})}return e})(),bxe).catch(e=>console.error(e))},744:$y=>{$y.exports=XMLHttpRequest}},$y=>{$y($y.s=269)}]);